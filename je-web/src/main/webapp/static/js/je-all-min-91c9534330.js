/*
  * ===========================================================
  *  je-all-min.js Form JEPAAS 
  *  version:V7.0.0 (2019-10-10) 
  *  This file using the AGPL3.0, if need to revise this file, please use the same agreement.
  * =========================================================== 
*/
!function(){var n=window.JE=window.JE||{};n.static=n.static||{};Ext.iterate({"JE.common":{image:{user:"/static/project/images/user.png",logo:"/static/project/images/logo.png",error:"/static/project/images/error.png","logo-small":"/static/project/images/logo-small.png"}},"JE.app.view.MainView":{image:{"no-perm":"/static/project/images/perm-empty.png"}},"JE.core.util.func.Grid":{image:{nodata:"/static/project/images/data-empty.png"}},"JE.core.ux.form.FilesUploadSet":{image:{search:"/static/images/form/search.png",download:"/static/images/form/download.png",remove:"/static/images/form/remove.png"}},"JE.core.view.industry.Cell":{image:{image:"/static/images/industry/image.png",on:"/static/images/industry/on.png",off:"/static/images/industry/off.png"}},"JE.sys.chart.view.MainView":{image:{chart:"/static/images/plantform/chart.png"}},"JE.sys.funccfg.view.field.FieldFormTitle":{image:{formedit:"/static/images/form/formedit.png"}},"JE.sys.funccfg.view.Func":{image:{FUNCINFO_OCFORM:"/static/images/FUNCINFO_OCFORM.png",FUNCINFO_ONETOFORM:"/static/images/FUNCINFO_ONETOFORM.png"}},"JE.sys.im.view.MainView":{image:{mibg:"/static/images/mibg.jpg"}},"JE.sys.plantform.view.MainView":{image:{"plantform-logo":"/static/images/plantform/plantform-logo.png",product:"/static/images/plantform/product.png","plantform-show1":"/static/images/plantform/plantform-show1.png","plantform-show2":"/static/images/plantform/plantform-show2.png"}},"JE.sys.saas.controller.CpPermController":{image:{CustomDevelop:"/static/images/saas/CustomDevelop.jpg"}},"JE.sys.saas.view.market.OrderView":{image:{nocp:"/static/images/saas/market/nocp.png"}},"JE.sys.saas.view.market.TypeView":{image:{star:"/static/images/saas/market/star.png","star-selected":"/static/images/saas/market/star-selected.png",buy:"/static/images/saas/market/buy.png","buy-selected":"/static/images/saas/market/buy-selected.png",plugin:"/static/images/saas/market/plugin.png","plugin-selected":"/static/images/saas/market/plugin-selected.png"}},"JE.sys.table.view.MainView":{image:{table:"/static/images/plantform/table.png"}},"JE.sys.workflowfunc.view.CenterView":{image:{new:"/static/images/new.gif"}},"JE.core.ux.mxgraph.cells.WorkFlowCells":{image:{start:"/static/images/workflow/start.png",end:"/static/images/workflow/end.png",decision:"/static/images/workflow/decision.png",fork:"/static/images/workflow/fork.png",join:"/static/images/workflow/join.png",countersign:"/static/images/workflow/countersign.png",joint:"/static/images/workflow/joint.png",to_assignee:"/static/images/workflow/to_assignee.png",child_flow:"/static/images/workflow/child_flow.png",auto:"/static/images/workflow/auto.png",circular:"/static/images/workflow/circular.png"}},"JE.core.ux.mxgraph.cells.IndustryCells":{image:{image:"/static/images/industry/image.png",on:"/static/images/industry/on.png",off:"/static/images/industry/off.png","背景":"/static/images/industry/背景.png","开关":"/static/images/industry/开关.png","刻度":"/static/images/industry/刻度.png","指示灯":"/static/images/industry/指示灯.png","指示灯2":"/static/images/industry/指示灯2.png","文字":"/static/images/industry/文字.png","文本域":"/static/images/industry/文本域.png","自定义":"/static/images/industry/自定义.png",APP:"/static/images/industry/custom/APP.png",CHART:"/static/images/industry/custom/CHART.png",HTML:"/static/images/industry/custom/HTML.png",REPORT:"/static/images/industry/custom/REPORT.png"}},"JE.app":{image:{folder:"/static/ux/phone/images/folder.png",app:"/static/ux/phone/images/app.png",logo:"/static/ux/phone/images/logo.png"}},"JE.qrcode":{image:{vcardbg7:"/static/ux/qrcode/img/vcardbg7.jpg",file:"/static/ux/qrcode/img/file.png",maku:"/static/ux/qrcode/img/maku.png","upload-file":"/static/ux/qrcode/img/upload-file.png","upload-image":"/static/ux/qrcode/img/upload-image.png"}},"JE.core.util.PortalUtil":{swf:{"时钟1":"/static/ux/colckSWF/时钟1.swf","时钟2":"/static/ux/colckSWF/时钟2.swf","时钟3":"/static/ux/colckSWF/时钟3.swf","时钟4":"/static/ux/colckSWF/时钟4.swf","时钟5":"/static/ux/colckSWF/时钟5.swf","时钟6":"/static/ux/colckSWF/时钟6.swf","时钟7":"/static/ux/colckSWF/时钟7.swf","时钟8":"/static/ux/colckSWF/时钟8.swf","时钟9":"/static/ux/colckSWF/时钟9.swf","时钟10":"/static/ux/colckSWF/时钟10.swf","时钟11":"/static/ux/colckSWF/时钟11.swf","时钟12":"/static/ux/colckSWF/时钟12.swf"}},"JE.common.file":{swf:{swfupload:"/static/ux/uploadPanel/swfupload/swfupload.swf",swfupload_fp9:"/static/ux/uploadPanel/swfupload/swfupload_fp9.swf",Uploader:"/static/ux/webuploader/swf/Uploader.swf",cmp:"/static/ux/cmpplayer/cmp.swf"}}},function(a,e){Ext.iterate(e,function(i,e){n.static[i]=n.static[i]||{},Ext.iterate(e,function(e,t){n.static[i][a+"."+e]=t})})})}(),Ext.define("JE.util.EChartUtil",{EColors:["#c23531","#2f4554","#61a0a8","#d48265","#91c7ae","#749f83","#ca8622","#bda29a","#6e7074","#546570","#c4ccd3"],drawEChart:function(e,i){var a=Ext.getCmp(e);if(a){a.chart&&a.chart.timeFn&&clearInterval(a.chart.timeFn);var n=this.buildEChartCfg(a,i);if(a.store&&0==a.store.getCount())return a.destroyChart(),void a.getCmp("chartBox").update('<div class="empty-msg" style="width:100%;height:100%;background-color:#ffffff;display:table;"><span style="display: table-cell;text-align: center;vertical-align: middle;">没有数据展示！</span></div>');var t=Ext.value(i.echart.theme,"macarons");if(a.chart=echarts.init(a.getCmp("chartBox").getEl().dom,t),a.chart.setOption(n,!0,!1),"AngularGauge"==i.type){i.realTime=JE.toBool(i.chart.realTime),i.times=Number(Ext.value(i.chart.times,1e4));function o(){var t=i.ds[i.dsCfg.data.split(".")[0]].load(i.params);Ext.isArray(t)&&(t=t[0]),Ext.each(n.series,function(e){e.data[0].value=t[e.name]}),a.chart.setOption(n)}o(),i.realTime&&0<i.times&&(a.chart.timeFn=setInterval(o,i.times))}return a.hasListener("labelclick")&&a.chart.on("click",function(e){var t=e.data;Ext.isArray(e.value)&&Ext.isNumber(e.special)&&(t=e.value[e.special]),a.fireEvent("labelclick",a,t,a.chart)}),a.hasListener("load")&&a.fireEvent("load",a),a.chart}},buildEChartCfg:function(e,t){var i=this;t.typeInfo=i.getEChartTypes(t),t.dataInfo=i.buildEChartData(e,t);var a=i.buildOption(e,t);if(a=i.buildEChartEnd(e,t,a),JE.toBool(t.echart.enableIDIT)&&JE.isNotEmpty(t.echart.iditOption)){var n=JE.eval(t.echart.iditOption,JE.getLocalLang("core.jechartview").echartCfgError);JE.isNotEmpty(n)&&(a=n(a,e,t))}return a},buildOption:function(e,t){var a=this,i=t.chart,n=Ext.value(t.echart,{}),o=t.typeInfo,r=t.dataInfo,l={animation:JE.toBool(Ext.value(i.animation,"1")),backgroundColor:Ext.value(i.bgcolor,"#ffffff"),title:{show:!JE.toBool(n.hideTitle),left:Ext.value(n.titleX,"center"),top:Ext.value(n.titleY,"top"),text:i.caption,subtext:i.subcaption,textStyle:JE.toObj(n.textStyle),subtextStyle:JE.toObj(n.subtextStyle)},grid:{backgroundColor:Ext.value(i.canvasbgcolor,"rgba(0,0,0,0)"),borderWidth:JE.toNum(Ext.value(i.canvasborderthickness,0)),borderColor:Ext.value(i.canvasbordercolor,"#ccc")},legend:{show:JE.toBool(i.showlegend),padding:5,left:Ext.value(n.legendX,"center"),top:Ext.value(n.legendY,"bottom"),orient:Ext.value(n.legendOrient,"horizontal"),itemGap:10,data:r.legends},series:r.series};Ext.each(["top","right","bottom","left"],function(e){var t=n["grid_"+e];JE.isNotEmpty(t)&&(l.grid[e]=Ext.isNumber(t)?JE.toNum(t):t)}),l=Ext.apply(l,o.options),-1!=["vintage","dark"].indexOf(n.theme)&&JE.isEmpty(i.bgcolor)&&delete l.backgroundColor,l.title.show||delete l.title;var s=e.getCmp("chartBox").getEl();s&&(JE.isNotEmpty(i.bgimage)?(l.grid.backgroundColor="rgba(0,0,0,0)",l.grid.borderWidth=0,s.setStyle({backgroundImage:"url("+i.bgimage+")",backgroundRepeat:"tile"==i.bgimagedisplaymode?"repeat":"no-repeat",backgroundPositionX:Ext.value(i.bgimagehalign,"left"),backgroundPositionY:Ext.value(i.bgimagevalign,"top")})):s.setStyle({backgroundImage:"none"}));var d=JE.decode(Ext.value(n.mark,"[]")),c={},u={max:JE.getLocalLang("core.jechartview").max,min:JE.getLocalLang("core.jechartview").min,average:JE.getLocalLang("core.jechartview").average};return Ext.each(d,function(e){if(JE.isNotEmpty(e.serie)){c[e.serie]=Ext.value(c[e.serie],{markLine:{data:[]},markPoint:{data:[]}});var t="markPoint";"line"==e.type&&(t="markLine");var i={type:e.value,name:Ext.value(e.name,u[e.value])};JE.isNotEmpty(e.color)&&(i.itemStyle={normal:{color:e.color}}),Ext.isNumeric(i.type)&&(i.yAxis=i.type,delete i.type,"point"==e.type&&JE.alert("标注点不支持数值的标注值！")),JE.isNotEmpty(e.label)&&(i.label={normal:{formatter:a.echartFormatter(e.label)}}),c[e.serie][t].data.push(i)}}),Ext.each(l.series,function(e){c[e.name]&&Ext.apply(e,c[e.name])}),l},buildEChartData:function(e,i){var d=i.typeInfo,c=Ext.value(d.series,{}),u=(d.itemStyle,[]),p=[],f=[],E=0,m=0,g=0,h=!1;if("gauge"!=d.type){var t=this.buildDataSet(e,i),a=t.dataset;JE.isEmpty(a)&&t.data&&(a=[{data:t.data,seriesname:t.seriesname}]);var x=d.options.color||this.EColors;if(Ext.each(a,function(e,a){var t=Ext.value(e.renderas,d.type).toLowerCase(),n=["id","name","value","seriesname","bean"],o=[],r=0,l=0,s=0;Ext.each(e.data,function(t){0==a&&u.push(t.label),t.name=t.label;var i={};Ext.each(n,function(e){i[e]=t[e]}),i.value>r&&(r=i.value),i.value<l&&(l=i.value),!d.Column&&!d.Bar||d.MS||d.Stacked||(s>x.length&&(s=0),i.itemStyle={normal:{color:x[s]}},s++),o.push(i)});var i={type:t,data:o,_max:r};JE.isNotEmpty(e.renderas)&&("column"==i.type?i.type="bar":(Ext.apply(i,d.lineInfo),"area"==i.type&&(i.type="line",i.areaStyle={normal:{}}))),"S"==e.parentyaxis?(i.yAxisIndex=1,h=!0,m<r&&(m=r),g<l&&(g=l)):(E<r&&(E=r),0<l&&(yMix=l)),JE.isNotEmpty(e.seriesname)&&(i.name=e.seriesname,p.push(i.name)),d.Stacked&&(i.stack="echartStack"),Ext.applyIf(i,c),f.push(i)}),"radar"==d.type){var n=Ext.clone(c);n.data=[],Ext.each(f,function(e){var t=e.data,i=[];Ext.each(t,function(e){i.push(e.value)}),n.data.push({name:Ext.value(e.name,""),value:i,data:t}),n._max=n._max>e._max?n._max:e._max}),f=[n]}}else Ext.each(i.dsCfg.data.split(","),function(e){i.realDS=e.split(".")[0];var t={name:e=e.split(".")[1],data:[{id:e,name:e,value:0}]};Ext.applyIf(t,c),f.push(t)});return d.columnBar&&(Ext.each(f,function(e){e.data.reverse()}),u.reverse()),{labels:u,legends:p,series:f,yMM:[{max:E,min:0,useY:!0},{max:m,min:g,useY:h}]}},buildEChartEnd:function(e,t,i){var o=this,r=t.chart,a=Ext.value(t.echart,{}),n=t.typeInfo,l=t.dataInfo,s=l.labels;l.legends,l.series;if(-1!=["pie","radar","funnel","gauge"].indexOf(n.type)){if(delete i.grid,-1!=["pie","funnel"].indexOf(n.type))i.legend.data=s;else if("radar"==n.type){var d=i.radar,c=JE.isNotEmpty(i.series)?i.series[0]._max:0;Ext.each(s,function(e){d.indicator.push({text:e,max:c})}),JE.isNotEmpty(r.radarfillcolor)&&(d.splitArea={show:!0,areaStyle:{color:r.radarfillcolor}}),JE.isNotEmpty(r.radarbordercolor)&&(d.splitLine={show:!0,lineStyle:{color:r.radarbordercolor,width:JE.toNum(Ext.value(r.radarborderthickness,1)),type:"solid"}}),JE.toBool(r.showyaxisvalues)}}else{var u=[],p=[{prefix:r.numberprefix,suffix:r.numbersuffix},{prefix:r.snumberprefix,suffix:r.snumbersuffix}],f=[{max:r.pyaxismaxvalue,min:r.pyaxisminvalue},{max:r.syaxismaxvalue,min:r.syaxisminvalue}];Ext.each([r.yaxisname,r.syaxisname],function(e,t){var i=l.yMM[t],a=f[t];if(i.useY){var n={type:"value",name:e,splitNumber:JE.toNum(Ext.value(r.numdivlines,4))+1,axisLabel:{show:JE.toBool(r.showyaxisvalues),formatter:Ext.value(p[t].prefix,"")+"{value}"+Ext.value(p[t].suffix,"")}};JE.isNotEmpty(a.max)?n.max=JE.toNum(a.max):(n.max=i.max,n.max=o.buildEMaxNum(n)),JE.isNotEmpty(a.min)&&(n.min=JE.toNum(a.min)),u.push(n)}}),i.yAxis=u,a.rotate_x=Ext.value(a.rotate_x,"1"==r.slantlabels?50:0),i.xAxis=[{type:"category",data:s,boundaryGap:[.1,.1],name:r.xaxisname,axisLabel:{show:JE.toBool(r.showlabels),interval:JE.toNum(r.labelstep),rotate:JE.toNum(a.rotate_x)}}];var E=JE.decode(Ext.value(a.xyTitletextStyle,"{}")),m=JE.decode(Ext.value(a.xyLabeltextStyle,"{}"));if(splits=[{width:r.vdivlinethickness,color:r.vdivlinecolor,dashed:r.vdivlineisdashed,area:r.showalternatevgridcolor,areaColor:r.alternatevgridcolor},{width:Ext.value(r.divlinethickness,"1"),color:r.divlinecolor,dashed:r.divlineisdashed,area:r.showalternatehgridcolor,areaColor:r.alternatehgridcolor}],Ext.each([i.xAxis,i.yAxis],function(e,a){Ext.each(e,function(e,t){if(e.nameTextStyle=E,e.nameTextStyle.fontWeight=Ext.value(e.nameTextStyle.fontWeight,"bold"),e.axisLabel.textStyle=m,0==t){var i=splits[a];e.splitLine={show:0<JE.toNum(i.width),lineStyle:{color:[Ext.value(i.color,"#ccc")],width:JE.toNum(i.width),type:JE.toBool(i.dashed)?"dashed":"solid"}},e.splitArea={show:JE.toBool(i.area),areaStyle:{color:Ext.isEmpty(i.areaColor)?["rgba(250,250,250,0.3)","rgba(200,200,200,0.3)"]:[i.areaColor]}}}})}),n.columnBar){var g=i.xAxis;i.xAxis=i.yAxis,i.yAxis=g}}return JE.isEmpty(i.legend.data)&&delete i.legend,i},getEChartTypes:function(e){var t=this,i=e.chart,a=Ext.value(e.echart,{}),n=e.type,o={code:n,type:"bar",options:{},series:{}};if(Ext.each(["Stacked","Scroll","DY","Combi","MS","Column","Bar","Pareto","Line","Area","Pie","Doughnut","Pyramid","Radar","AngularGauge"],function(e){o[e]=t.isExist(e,n)}),o.Column||o.Bar||o.Pareto)o.type="bar",o.columnBar=o.Bar,o.useColors=!o.MS;else if(o.Line||o.Area)o.type="line",Ext.apply(o.series,{smooth:JE.toBool(a.lineSmooth),lineStyle:{normal:{type:Ext.value(a.lineType,"solid")}}}),o.Area&&(o.series.areaStyle={normal:{}});else if(o.Combi)o.lineInfo={smooth:JE.toBool(a.lineSmooth),lineStyle:{normal:{type:Ext.value(a.lineType,"solid")}}};else if(o.Pie||o.Doughnut)o.useColors=!0,o.type="pie",o.radius="series",Ext.apply(o.series,{radius:[0,"60%"],selectedMode:"multiple",startAngle:0,clockwise:!1,label:{normal:{formatter:Ext.value(a.EPieLabelFormatter,"{name} : "+(JE.toBool(i.showpercentvalues)?"{percent}%":"{value}"))}}}),o.Doughnut&&(o.series.radius=["30%","60%"]),o.options.tooltip={formatter:"{name} : {value} ({percent}%)"};else if(o.Pyramid)o.type="funnel",o.useColors=!0,Ext.apply(o.series,{sort:"ascending",maxSize:"50%",label:{normal:{formatter:Ext.value(a.EPieLabelFormatter,"{name} : "+(JE.toBool(i.showpercentvalues)?"{percent}%":"{value}"))}}}),o.options.tooltip={formatter:"{name} : {value} ({percent}%)"};else if(o.Radar)o.type="radar",o.radius="radar",Ext.apply(o.options,{radar:{radius:"75%",indicator:[]},tooltip:{formatter:function(e){var t=[],i=e.data.data;return Ext.each(i,function(e){t.push(e.name+" : "+e.value)}),t.join("</br>")}}});else if(o.AngularGauge){o.type="gauge",o.radius="series";var r=Ext.apply(o.series,{startAngle:JE.toNum(Ext.value(i.gaugestartangle,225)),endAngle:JE.toNum(Ext.value(i.gaugeendangle,-45)),max:JE.toNum(Ext.value(i.upperLimit,100)),min:JE.toNum(Ext.value(i.lowerLimit,0)),splitNumber:JE.toNum(Ext.value(i.majorTMNumber,11))-1,axisTick:{show:!JE.toBool(a.gaugeHideAT),splitNumber:JE.toNum(Ext.value(i.minorTMNumber,5)),length:JE.toNum(Ext.value(a.gaugeAT,8))},precision:2,splitLine:{show:!JE.toBool(a.gaugeHideSL),length:JE.toNum(Ext.value(a.gaugeSL,30))},title:{show:!JE.toBool(a.gaugeHideTitle)},axisLabel:{show:JE.toBool(i.showtickvalues),formatter:Ext.value(i.numbersuffix,"")+"{value}"+Ext.value(i.numberprefix,"")},detail:{show:JE.toBool(i.showvalue),formatter:Ext.value(i.numbersuffix,"")+"{value}"+Ext.value(i.numberprefix,"")},radius:"75%",axisLine:{lineStyle:{color:[],width:10}},pointer:{length:"80%",width:8,color:"auto"}}),l=r.max,s=r.min,d=[];Ext.each(Ext.decode(Ext.value(i.colorrange,"[]")),function(e){d.push([(JE.toNum(e.maxvalue)-s)/(l-s),e.code])}),0<(r.axisLine.lineStyle.color=d).length?(r.axisTick.lineStyle={color:"#eee",width:1,type:"solid"},r.splitLine.lineStyle={color:"#eee",width:2,type:"solid"},r.axisLabel.textStyle={color:"#333"}):delete r.axisLine.lineStyle.color,JE.isNotEmpty(a.ERadius)&&(r.radius=Ext.isNumeric(a.ERadius)?JE.toNum(a.ERadius):a.ERadius),JE.isNotEmpty(a.ERadius2)&&(r.axisLine.lineStyle.width=Ext.isNumeric(a.ERadius2)?JE.toNum(a.ERadius2):a.ERadius2)}if(o.series.type=o.type,JE.toBool(i.enablecolors)&&JE.isNotEmpty(i.palettecolors)&&(o.options.color=i.palettecolors.split(",")),o.radius){var c=("radar"==o.type?o.options:o)[o.radius],u=c.radius,p=a.ERadius,f=a.ERadius2;Ext.isString(u)?(u=Ext.value(p,u),u=Ext.isNumeric(u)?JE.toNum(u):u):(u[0]=Ext.value(f,u[0]),u[1]=Ext.value(p,u[1]),u[0]=Ext.isNumeric(u[0])?JE.toNum(u[0]):u[0],u[1]=Ext.isNumeric(u[1])?JE.toNum(u[1]):u[1]),c.radius=u;var E=Ext.value(a.ECenterX,"50%"),m=Ext.value(a.ECenterY,"50%");E=Ext.isNumeric(E)?JE.toNum(E):E,m=Ext.isNumeric(m)?JE.toNum(m):m,c.center=[E,m]}return(o.Pie||o.Doughnut||o.Pyramid)&&(o.series.label={normal:{formatter:Ext.value(a.EPieLabelFormatter,"{name} : "+(JE.toBool(i.showpercentvalues)?"{percent}%":"{value}"))}}),o.series.label=o.series.label||{normal:{}},o.series.labelLine=o.series.labelLine||{normal:{}},o.series.label.normal.show=o.series.labelLine.normal.show=JE.toBool(e.chart.showvalues),o.series.label.normal.textStyle=JE.toObj(Ext.value(a.itemtextStyle,"{}")),o.series.label.normal.formatter=t.echartFormatter(o.series.label.normal.formatter),JE.isNotEmpty(a.labelPosition)&&(o.series.label.normal.position=a.labelPosition),o.Pie&&JE.toBool(a.EPieLabelPosition)&&(o.series.label.normal.position="inner",o.series.labelLine.normal.show=!1,o.series.label.emphasis={show:!0,formatter:o.series.label.normal.formatter}),o.options.tooltip=Ext.value(o.options.tooltip,{}),Ext.apply(o.options.tooltip,{show:JE.toBool(i.showtooltip),trigger:Ext.value(a.tooltipTrigger,"item"),axisPointer:{type:Ext.value(a.tooltipPointer,"none")}}),o.options.tooltip.formatter=t.echartFormatter(Ext.value(a.formatter,o.options.tooltip.formatter)),o},echartFormatter:function(e){if(JE.isNotEmpty(e))return Ext.isString(e)?JE.toXT(e,{seriesName:"{a}",name:"{b}",value:"{c}",percent:"{d}"}):e},buildEMaxNum:function(e){var t=JE.toNum(Ext.Number.toFixed(e.max,0)),i=e.splitNumber,a=t.toString(),n=a.length,o=t,r=1;if(2<n)for(var l=n<7?1:n-5,s=(o=JE.toNum(a.substring(0,l))+1,r=.1,0);s<n-l;s++)o*=10,r*=10;else o=t+(5-t%5);for(;o%i!=0;)o+=r;var d=o/i;for(s=1;d*s<t;)s++;for(o=d*s;o%i!=0;)o+=r;e.max=o,e.minInterval=e.max/i},isExist:function(e,t){return t.replace(e,"")!=t}}),Ext.define("JE.util.ChartUtil",{mixins:["JE.util.EChartUtil"],drawChart:function(e,t,i){return"echart"==i?this.drawEChart(e,t):this.drawFChart(e,t)},drawFChart:function(e,a){var t=this,i=Ext.getCmp(e);if(i){i.chart&&i.chart.timeFn&&clearInterval(i.chart.timeFn);var n=i.body.id,o=i.getCmp("chartBox");o&&(n=o.getEl().id);var r=new FusionCharts({swfUrl:t.loadSwf(a.type,!0),width:"100%",height:"100%"}),l={};if(l.chart=t.buildChart(i,a),l.styles=t.buildStyles(i,a),"AngularGauge"==a.type)l.renderId=n,t.buildAngularGauge(l,a);else{var s=t.buildDataSet(i,a);Ext.apply(l,s);var d=t.buildTrendlines(i,a);Ext.apply(l,d)}return r.setJSONData(l),Ext.defer(function(){if(r.render(n),"AngularGauge"==a.type){a.realDS;r.addEventListener("Rendered",function(e,t){function i(){var e=a.ds[a.realDS].load(a.params);Ext.isArray(e)&&(e=e[0]),Ext.iterate(e,function(e,t){r.setDataForId(e,t)})}i(),a.realTime&&0<a.times&&(r.timeFn=setInterval(i,a.times))})}i.hasListener("load")&&r.addEventListener("Rendered",function(e,t){i.fireEvent("load",i)})},10),r}},buildAngularGauge:function(t,i){var e=JE.toObj(t.chart.colorrange),a=JE.toObj(t.chart.trendpoints),n=JE.toObj(i.dsCfg.dialsCfg);i.realTime=JE.toBool(t.chart.realTime),i.times=Number(Ext.value(t.chart.times,1e4));var o=Ext.get(t.renderId);delete t.chart.colorrange,delete t.chart.trendpoints,delete t.chart.dialsCfg,delete t.chart.realTime,delete t.chart.times,delete t.renderId;var r=Ext.value(t.chart.gaugeOriginX,"50%"),l=Ext.value(t.chart.gaugeOriginY,"50%");r=Ext.isNumeric(r)?JE.toNum(r):JE.toNum(r.replace("%",""))/100*o.getWidth(),l=Ext.isNumeric(l)?JE.toNum(l):JE.toNum(l.replace("%",""))/100*o.getHeight(),t.chart.gaugeOriginX=r,t.chart.gaugeOriginY=l,t.colorrange={color:[]},Ext.each(e,function(e){t.colorrange.color.push(e)}),t.trendpoints={point:[]},Ext.each(a,function(e){e.displayvalue=JE.toXT(e.displayvalue,e),"1"==e.usemarker?Ext.apply(e,{markerColor:"#F1f1f1",markerBorderColor:"#666666",markerRadius:"10"}):delete e.usemarker,t.trendpoints.point.push(e)}),t.dials={dial:[]},Ext.each(i.dsCfg.data.split(","),function(e){i.realDS=e.split(".")[0];var a={id:e=e.split(".")[1],value:0,bgcolor:"#333333",bordercolor:"#333333",radius:t.chart.gaugeouterradius};Ext.each(n,function(i){if(i.id==e)return Ext.applyIf(a,i),Ext.iterate(a,function(e,t){JE.isNotEmpty(i[e])&&(a[e]=i[e])}),!1}),t.dials.dial.push(a)})},buildChart:function(e,t){var i={bgcolor:"#FFFFFF",canvasbgcolor:"#FFFFFF",canvasbordercolor:"#FFFFFF",showvalues:"0",showborder:"0",showalternatehgridcolor:"0",plotgradientcolor:"",showplotborder:"0",use3dlighting:"0",unescapeLinks:"0",formatNumberScale:"0",formatNumber:"0",exportEnabled:"1",exportDialogMessage:JE.getLocalLang("core.jechartview").exportDialogMessage,exportAtClient:"0",exportShowMenuItem:"0",palettecolors:"#008ee4,#f8bd19,#6baa01,#9b59b6,#e44a00,#d35400,#bdc3c7,#95a5a6,#34495e,#1abc9c"},a=Ext.clone(Ext.value(t.chart,{}));a.pyaxisname=a.yaxisname,a.yaxismaxvalue=a.pyaxismaxvalue,a.yaxisminvalue=a.pyaxisminvalue,delete(a=Ext.apply(a,Ext.decode(Ext.value(a.otherCfg,"{}")))).trendLines,delete a.otherCfg;var n={};return Ext.iterate(a,function(e,t){JE.isNotEmpty(t)&&(n[e]=t)}),n=Ext.applyIf(n,i)},buildStyles:function(e,t){},buildTrendlines:function(e,t){if(Ext.isEmpty(t.chart)||Ext.isEmpty(t.chart.trendLines))return{};var i=Ext.decode(t.chart.trendLines),a={},n=[],o=[],d=e.store;return Ext.each(i,function(e){var s={},t=e.vline;delete e.vline,Ext.iterate(e,function(e,t){JE.isNotEmpty(t)&&(s[e]=t)});Ext.each(["start","end"],function(e){var t=s[e+"GS"],i=Ext.value(s[e+"value"],""),a=s[e+"Format"],n=[];if(JE.isNotEmpty(t)){var o=i.split("."),r="S"==o[0]?"seriesname":"label",l=o[1];d.each(function(e){!Ext.isEmpty(i)&&e.data[r]!=l||n.push(Number(e.data.value))}),i="count"==t?n.length:Ext.Array[t](n),JE.isNotEmpty(a)&&(i=Ext.util.Format.number(i,a)),s[e+"value"]=i,delete s[e+"GS"],delete s[e+"Format"]}}),s.displayvalue=JE.toXT(s.displayvalue,s),s.tooltext=JE.toXT(s.tooltext,s),("1"==t?o:n).push(s)}),0<n.length&&(a.trendlines=[{line:n}]),0<o.length&&(a.vtrendlines=[{line:o}]),a},buildLabels:function(e,t,i){var a=e.dsCfg[t],n=a.split(".")[0],o=e.ds[n],r=a.split(".")[1],l=[],s=!1;if(JE.isEmpty(a))return l;var d="series"==t?"seriesname":t,c=(e.dsCfg.data||"").split(".")[0];if(o&&o.code!=c){i=o.load();Ext.each(i,function(e){var t={};t[d]=e[Ext.value(r,"name")],l.push(t)})}else if("DIC"==n){var u=JE.getDicItems(r);Ext.each(u,function(e){var t={};t[d]=e.text,t.dicData=e,l.push(t)})}else if("seriesname"==d)if(1<a.split(",").length)Ext.each(a.split(","),function(e){var t={};t[d]=e.split(".")[1],l.push(t)});else if("columns"==r){var p=Ext.isEmpty(e.dsCfg.labelField)?e.dsCfg.label:e.dsCfg.labelField;p=p.split(".")[1],Ext.each(Ext.value(o.config.fields,[]),function(e){if(e!=p){var t={};t[d]=e,l.push(t)}})}else s=!0;else s=!0;if(s){var f={};Ext.each(i,function(e){var t={},i=t[d]=e[r];f[i]||(l.push(t),f[i]=i)})}return l},buildStore:function(t,e){var i=e.labelList,a=e.seriesList,d=e.data,c=e.dataField,u=e.labelField,p=e.seriesField,n=e.dsCfg;JE.isNotEmpty(n.labelField)&&(u=n.labelField.split(".")[1]),JE.isNotEmpty(n.seriesField)&&(p=n.seriesField.split(".")[1]),JE.isEmpty(a)&&a.push({});var f=t.hasListener("labelclick"),E=Ext.create("Ext.data.Store",{fields:["id","label","value","seriesname","renderas","link","bean"],data:[]});return Ext.each(a,function(l){var s=l.seriesname;l.data=[],Ext.each(i,function(a){var n,o=a.label,r=0;Ext.each(d,function(e){var t=e[u],i=e[p];if(t=a.dicData&&a.dicData.code==t?a.dicData.text:t,i=l.dicData&&l.dicData.code==i?l.dicData.text:i,JE.isEmpty(c)){if(t==o)return r=JE.toNum(e[s]),n=Ext.clone(e),!1}else if(t==o&&i==s)return r=JE.toNum(e[c]),n=Ext.clone(e),!1});var e={id:JE.uuid(),value:r,label:o,bean:n};s&&(e.seriesname=s),f&&(e.link="j-JE.ChartUtil.labelClick-"+t.id+","+e.id),E.add(e),l.data.push(e)})}),E},buildDataSet:function(e,t){var i=t.ds,a=Ext.applyIf(t.dsCfg,{label:"",data:"",series:""}),n=a.label,o=a.data,r=a.series,l=o.split(".")[1],s=n.split(".")[1],d=r.split(".")[1],c=i[o.split(".")[0]].load(t.params),u=this.buildLabels(t,"label",c),p=this.buildLabels(t,"series",c),f=this.buildStore(e,{labelList:u,seriesList:p,data:c,dataField:l,labelField:s,seriesField:d,dsCfg:a}),E={},m=this.getChartCfgs(t.type);if(m.MS||m.Stacked||m.Scroll||m.DY){E.categories=[{category:u}];var g=Ext.decode(Ext.value(a.seriesCfg,"[]"));JE.isNotEmpty(g)&&Ext.each(p,function(t){Ext.each(g,function(e){t.seriesname==e.name&&(JE.isNotEmpty(e.color)&&(t.color=e.color),JE.isNotEmpty(e.type)&&(t.renderas=e.type),JE.toBool(e.rightY)&&(t.parentyaxis="S"),JE.toBool(e.showValues)&&(t.showvalues=e.showValues))})}),E.dataset=p}else{c=p[0].data;if(Ext.isEmpty(a.labelOrder)||c.sort(function(e,t){return"ASC"==a.labelOrder?Ext.value(e.value,0)-Ext.value(t.value,0):Ext.value(t.value,0)-Ext.value(e.value,0)}),t.type.replaceAll("Pareto","")!=t.type&&JE.isNotEmpty(t.chart.palettecolors)){var h=0,x=t.chart.palettecolors.split(","),v=x.length;Ext.each(c,function(e){h==v&&(h=0);var t=x[h];t&&(e.color=t),h++})}E.data=c,E.seriesname=l}return e.store=f,E},getChartsTypes:function(){var r=[],e=[];return Ext.each([{text:"柱状图",iconCls:"jeicon jeicon-chart-histogram",code:"column_",children:[{code:"Column2D",text:"2D"},{code:"MSColumn2D",text:"2D多数据集"},{code:"StackedColumn2D",text:"2D堆叠"},{code:"ScrollColumn2D",text:"2D滚动"},{code:"ScrollStackedColumn2D",text:"2D堆叠滚动"},{code:"Column3D",text:"3D"},{code:"MSColumn3D",text:"3D多数据集"},{code:"StackedColumn3D",text:"3D堆叠图"}]},{text:"折线图",code:"line_",iconCls:"jeicon jeicon-line-graph",children:[{code:"Line",text:"2D"},{code:"MSLine",text:"2D多数据集"},{code:"ScrollLine2D",text:"2D滚动"}]},{text:"面积图",code:"area_",iconCls:"jeicon jeicon-area-chart",children:[{code:"Area2D",text:"2D"},{code:"MSArea",text:"2D多数据集"},{code:"ScrollArea2D",text:"2D滚动"},{code:"StackedArea2D",text:"2D堆叠"}]},{text:"条形图",code:"bar_",iconCls:"jeicon jeicon-bar-chart",children:[{code:"Bar2D",text:"2D"},{code:"MSBar2D",text:"2D多数据集"},{code:"StackedBar2D",text:"2D堆叠"},{code:"MSBar3D",text:"3D多数据集"},{code:"StackedBar3D",text:"3D堆叠"}]},{text:"饼图",iconCls:"jeicon jeicon-pie-chart",code:"pie_",children:[{code:"Pie2D",text:"2D"},{code:"Doughnut2D",text:"2D环形图"},{code:"Pie3D",text:"3D"},{code:"Doughnut3D",text:"3D环形图"}]},{text:"组合图",code:"combi_",iconCls:"jeicon jeicon-combination-chart-tow",children:[{code:"MSCombi2D",text:"2D"},{code:"MSCombiDY2D",text:"2D双纵轴"},{code:"ScrollCombi2D",text:"2D滚动"},{code:"ScrollCombiDY2D",text:"2D滚动双纵轴"},{code:"MSCombi3D",text:"3D"}]},{text:"帕累托图",iconCls:"jeicon jeicon-chart-histogram-up",code:"pareto_",children:[{code:"Pareto2D",text:"2D"},{code:"Pareto3D",text:"3D"}]},{text:"雷达图",code:"Radar",iconCls:"jeicon jeicon-radar-chart",disabled:"0"},{text:"锥形图",code:"Pyramid",iconCls:"jeicon jeicon-cone-chart",disabled:"0"},{text:"仪表盘",code:"AngularGauge",iconCls:"jeicon jeicon-dashboard",disabled:"0"}],function(a){var n=a.text,o={id:a.code,code:a.code,text:a.text,expandable:!0,iconCls:a.iconCls,iconClss:a.iconCls,leaf:"0"==a.disabled,disabled:Ext.value(a.disabled,"1"),children:[]};"Radar"==a.code&&(a.MS=!0),Ext.each(a.children,function(e){var t=Ext.clone(e);Ext.apply(t,{type:n,TD:!1,MS:!1,Stacked:!1,Scroll:!1});var i=t.code;i.replace("MS","")!=i&&(t.MS=!0),i.replace("3D","")!=i&&(t.TD=!0),i.replace("Stacked","")!=i&&(t.Stacked=!0,t.MS=!0),i.replace("Scroll","")!=i&&(t.Scroll=!0),i.replace("DY","")!=i&&(t.DY=!0,t.MS=!0),i.replace("Combi","")!=i&&(t.Combi=!0,t.MS=!0),r.push(t),t.id=t.code,t.leaf=!0,t.iconClss=a.iconCls,o.children.push(t)}),e.push(o)}),e},getChartCfgs:function(e){var t={type:e,TD:!1,MS:!1,Stacked:!1,Scroll:!1};return"Radar"==e&&(t.MS=!0),e.replace("MS","")!=e&&(t.MS=!0),e.replace("3D","")!=e&&(t.TD=!0),e.replace("Stacked","")!=e&&(t.Stacked=!0),e.replace("Scroll","")!=e&&(t.Scroll=!0),e.replace("DY","")!=e&&(t.DY=!0),t},labelClick:function(e){var t=e.split(",")[0],i=e.split(",")[1],a=Ext.getCmp(t);if(a&&a.hasListener("labelclick")){var n=a.store.getById(i),o=n?n.data:{};a.fireEvent("labelclick",a,o,a.chart)}},loadSwf:function(e,t){var i=JE.buildCdnUrl("/static/ux/chart/FusionCharts/"+e+".swf");return t&&(i=JE.buildCdnUrl("/static/ux/chart/FusionCharts/fusionChartsCracker.swf?chartUrl="+i)),i},buildChartFile:function(){}}),Ext.define("JE.util.Common",{requestParams:{},browser:{isFocus:!0,title:"",noticeTitle:"",noticeTitleFn:void 0,focus:function(e){JE.browser.isFocus=!0,document.title=JE.browser.title,JE.browser.noticeTitleFn&&JE.browser.noticeTitleFn.clear()},blur:function(e){JE.browser.isFocus=!1}},currentUser:{},cacheFunc:{},nopermCacheFunc:{},staticCacheFunc:{},systemConfig:{},proConfig:{},helpMsg:{},jsEditor:{},dicListData:{},dicInfoData:{},userStaticData:{MENU:"",FUNC:{},PERM:{}},staticBeanInfo:{KEY_TABLE_CODE:"$TABLE_CODE$",KEY_ROWSET:"$ROWSET$",KEY_PAGE_COUNT:"$P_COUNT$",KEY_ALL_COUNT:"$A_COUNT$",KEY_COLUMNS:"$A_COLUMENS$",KEY_ROW_NUM:"$ROW_NUM$",KEY_SQL:"$SQL$",KEY_SELECT:"$SELECT$",KEY_WHERE:"$WHERE$",KEY_GROUP:"$GROUP$",KEY_ORDER:"$ORDER$",KEY_PK_CODE:"$PK_CODE$",KEY_TABLE_COLUMNS:"$TABLECOLUMNS$",KEY_TABLE_KEYS:"$TABLEKEYS$",KEY_LONG_FIELD:"$LONG$",KEY_DUPCODE:"$DUPCODE$",KEY_DOC_INFO:"$DOC_INFO$",PARAM_IS_DBMAP:"isDBMap",DEF_ALL_FIELDS:"ALL_FIELDS",DEF_PK_FIELDS:"PK_FIELDS",DEF_NPK_FIELDS:"NPK_FIELDS",KEY_VALUE_NULL:"~$￥$~::~￥$￥~",KEY_VALUE_ZERO:"~￥$￥~::~$￥$~"},initTheme:function(){var e=JE.USER,i=[window._JE_SYS_THEME_HEADER||"blue",window._JE_SYS_THEME_LEFTMENU||"black",window._JE_SYS_THEME_TOPMENU||"blue"];if(!Ext.isEmpty(e.theme)){var a=e.theme.split(",");Ext.each(i,function(e,t){i[t]=a[t]||e})}JE.changeTheme(i[0]),JE.changeTheme(i[1],!1,"leftMenu")},initCommon:function(e){var a=this;if(window.onerror=JE.error,JE.requestParams=Ext.urlDecode(window.location.search),Ext.Ajax.on({beforerequest:function(e,t){var i;(new RegExp("[.](js|css|json|html)","g").test(t.url)&&(t.method="GET",t.disableCaching=!1),t.url=JE.buildCdnUrl(JE.getUrlMaps(t.url)||t.url),t.headers=Ext.value(t.headers,{}),t.headers["Platform-Agent"]="AppleWebKit/537.36 (KHTML, like Gecko)",t.headers.authorization=Ext.util.Cookies.get("authorization"),t.headers.cachekey=t.params&&t.params.funcCode||"",JE.isEmpty(t.headers.authorization))?JE.logout(!0):"1"==a.systemConfig.JE_SYS_ENCRYPT&&(t.params?i=JE.DES(t.params):t.isUpload&&(i=JE.DES(t.form)),i&&(t.params||t.isUpload)&&(t.headers[i.code]=i.value))},requestcomplete:function(e,t,i){t.timedout?JE.msg("请求超时！"):JE.systemError(t.responseText)||(Ext.isObject(t.responseText)?"UNKOWN_LOGINUSER"==t.responseText.code&&JE.logout(!0):0==t.responseText.indexOf("\x3c!-- LOGIN --\x3e")||t.responseXML&&t.responseXML.URL&&-1!=t.responseXML.URL.lastIndexOf("/login.jsp")?(t.responseText='{success:false,obj:"logout!"}',JE.logout(!0)):-1!=t.responseText.indexOf('"UNKOWN_LOGINUSER"')&&JE.logout(!0))},requestexception:function(e,t,i){t.timedout?JE.msg("请求超时！"):Ext.isObject(t.responseText)?"UNKOWN_LOGINUSER"==t.responseText.code&&JE.logout(!0):0==t.responseText.indexOf("\x3c!-- LOGIN --\x3e")||t.responseXML&&t.responseXML.URL&&-1!=t.responseXML.URL.lastIndexOf("/login.jsp")?(t.responseText='{success:false,obj:"logout!"}',JE.logout(!0)):-1!=t.responseText.indexOf('"UNKOWN_LOGINUSER"')&&JE.logout(!0)}}),Ext.create("JE.util.VTypes").init(),Ext.create("JE.util.OverrideUtil").init(),JE.loadI18NScript(),JE.ajax({url:"/je/rbac/onLineUser/doLoginLog",params:{loginType:"PC"},async:!0}),JE.systemConfig=JE.ajax({url:JE.getUrlMaps("je.core.sys.config","loadSysVariables")}).obj,document.title=JE.systemConfig.JE_SYS_TITLE,a.USER||(a.currentUser=a.USER=JE.ajax({url:JE.getUrlMaps("je.core.rbac.user","getCurrentUserInfo")})),JE.initJSandCSS(),JE.WebSocket.init(),a.initTheme(),JE.CoreUtil.initUSInfo(),JE.systemConfig._JE_SAAS_CP={},"1"==JE.systemConfig.JE_SYSMODE&&!JE.currentUser.saas){var t=JE.ajax({url:JE.getUrlMaps("je.core.saasYh","loadUseCp")});Ext.each(t,function(e){JE.systemConfig._JE_SAAS_CP[e.JE_SAAS_CP_ID]={id:e.JE_SAAS_CP_ID,name:e.CPYH_CPMC,state:e.CPYH_AZZT_CODE}})}function i(){return"确认退出?"}function n(){return"谢谢光临"}JE.isEmpty(JE.requestParams.funcCode)&&(JE.loadModelFields(JE.systemConfig.JE_SYS_MULTIMODELS),JE.ajax({url:JE.getUrlMaps("je.core.dd.dd","initLoad"),params:{tableCode:"JE_CORE_DICTIONARY",limit:-1},async:!0,success:function(e){var t=Ext.decode(Ext.value(e.responseText,"{}")).rows;Ext.each(t,function(e){JE.dicInfoData[e.DICTIONARY_DDCODE]=e})}})),JE.updateMessageCount(),JE.loadAlertScript(),Ext.create("Ext.util.KeyMap",{target:Ext.getBody(),key:Ext.EventObject.BACKSPACE,fn:function(e,t){var i=t||window.event,a=i.target||i.srcElement,n=a.type||a.getAttribute("type"),o=a.readOnly,r=a.disabled;o=null!=o&&o,r=null==r||r,"password"==n||"text"==n||"textarea"==n?1!=o&&1!=r||t.stopEvent():"true"!=a.contentEditable&&t.stopEvent()}}),"1"===JE.systemConfig.IS_SHOW_LEAVE_TIP&&setTimeout(function(){window.onbeforeunload=i,window.onunload=n},1e3),window.history&&window.history.pushState&&(window.onpopstate=function(){window.history.pushState("forward",null,""),window.history.forward(1)},window.history.pushState("forward",null,""),window.history.forward(1)),JE.browser.title=document.title,window.onfocus=document.onfocusin=JE.browser.focus,window.onblur=document.onfocusout=JE.browser.blur,JE.requestParams.funcCode||(JE.CALENDAR_HOLIDAYS={},JE.ajax({url:JE.getUrlMaps("je.core.load"),params:{tableCode:"JE_SYS_HOLIDAYS",limit:-1},async:!0,success:function(e){var t=Ext.decode(Ext.value(e.responseText,"{}")).rows;Ext.each(t,function(e){if(JE.isNotEmpty(e.HOLIDAYS_YEAR)){var t=e.HOLIDAYS_YEAR,a={};Ext.iterate(Ext.decode(Ext.value(e.HOLIDAYS_INFO,"{}")),function(e,t){var i=[];Ext.each(Ext.decode(Ext.value(t,"[]")),function(e){JE.isNotEmpty(e.value)&&i.push(e.value+"  "+e.code)}),a[e]=i}),JE.CALENDAR_HOLIDAYS[t]=a}})}}),JE.USER.funcConfig&&(JE.ajax({url:JE.getUrlMaps("je.core.load"),params:{tableCode:"JE_CORE_HELPMSG",orderSql:"order by HELPMSG_TYPE",limit:-1},async:!0,success:function(e){var t=Ext.decode(Ext.value(e.responseText,"{}")).rows;Ext.each(t,function(e){a.helpMsg[e.HELPMSG_TYPE]||(a.helpMsg[e.HELPMSG_TYPE]={}),a.helpMsg[e.HELPMSG_TYPE][e.HELPMSG_CODE]=e.HELPMSG_MSG,"otherconfig"==e.HELPMSG_TYPE&&(a.helpMsg.otherconfigData=a.helpMsg.otherconfigData||{},a.helpMsg.otherconfigData[e.HELPMSG_CODE]=Ext.decode(e.HELPMSG_SJ||"[]"))})}}),JE.ajax({url:JE.getUrlMaps("je.core.load"),params:{tableCode:"JE_CORE_VIEWEVENTS",orderSql:"order by VIEWEVENTS_TYPE,SY_ORDERINDEX",limit:-1},async:!0,success:function(e){var t=Ext.decode(Ext.value(e.responseText,"{}")).rows;Ext.each(t,function(e){a.jsEditor[e.VIEWEVENTS_TYPE_CODE]||(a.jsEditor[e.VIEWEVENTS_TYPE_CODE]=[]),a.jsEditor[e.VIEWEVENTS_TYPE_CODE].push({name:e.VIEWEVENTS_NAME,code:e.VIEWEVENTS_CODE,func:e.VIEWEVENTS_FUNC})})}})))}}),Ext.define("JE.util.DataUtil",{modelFields:new Ext.util.MixedCollection,fieldsUrl:JE.getUrlMaps("je.core.doact","getModelFields"),refreshModel:function(e,t){var i=this.getModel(e,!0);t.setFields(this.modelFields.get(i))},getTreeModel:function(e){var t={modelName:"com.je.core.entity.extjs.JSONTreeNode",excludes:"checked"};return 1==e&&delete t.excludes,JE.getModel(t)},getModel:function(e,t){var i=Ext.isEmpty(e.modelName)&&!Ext.isEmpty(e.tableName)?"dynabean."+e.tableName:e.modelName;e.doTree&&(i+="_tree"),Ext.isEmpty(e.excludes)||(i+="_excludes_"+e.excludes);var a=Ext.ModelManager.getModel(i);if(t&&(Ext.ModelManager.unregister(a),a=void 0),!a){var n=(e=Ext.value(e,{})).fields;Ext.isEmpty(n)&&(n=this.getFields(e,t)),Ext.each(n,function(e){-1!=["int","float"].indexOf(e.type)&&(e.useNull=!0)}),i=Ext.value(i,JE.uuid());Ext.define(i,{extend:"Ext.data.Model",idProperty:Ext.value(e.id,"id"),fields:n})}return i},getFields:function(e,t){var i=this,a=Ext.value(e.excludes,"").split(","),n={modelName:Ext.value(e.modelName,""),tableName:Ext.value(e.tableName,""),doTree:Ext.value(e.doTree,!1)},o=n.modelName;if(Ext.isEmpty(n.modelName)&&!Ext.isEmpty(n.tableName)&&(o="dynabean."+n.tableName),o+=n.doTree?"_tree":"",t&&i.modelFields.removeAtKey(o),!i.modelFields.containsKey(o)){var r=JE.ajax({url:i.fieldsUrl,params:n});i.modelFields.add(o,r)}var l=i.modelFields.get(o),s=[];return Ext.isEmpty(a)?s=l:Ext.each(l,function(e){-1==a.indexOf(e.name)&&s.push(e)}),s},loadModelFields:function(e){if(!JE.isEmpty(e)){Ext.isString(e)&&(e=e.split(","));var i=this,t=[];Ext.each(e,function(e){!JE.isNotEmpty(e)||i.modelFields.containsKey(e)||i.modelFields.containsKey("dynabean."+e)||(2<JE.split(e,".").length?t.push({modelName:e,tableName:"",doTree:!1}):t.push({modelName:"",tableName:e,doTree:!1}))}),JE.isEmpty(t)||JE.ajax({url:JE.getUrlMaps("je.core.doact","loadMultiModels"),params:{strData:JE.toStr(t)},async:!0,success:function(e){var t=Ext.decode(Ext.value(e.responseText,"{}"));Ext.iterate(t,function(e,t){i.modelFields.containsKey(e)||i.modelFields.add(e,t)})}})}},getStore:function(e){var t=Ext.value(e.params,{});if("tree"==e.type)return t=Ext.apply({tableCode:e.tableName,excludes:1!=e.multi?"checked":""},t),Ext.create("Ext.data.TreeStore",{defaultRootId:"ROOT",sorters:[{property:"SY_ORDERINDEX",direction:"ASC"}],model:JE.getTreeModel(e.multi),proxy:{type:"ajax",method:"POST",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},extraParams:t,url:Ext.value(e.url,JE.getUrlMaps("je.core.getTree")),reader:"json"},autoLoad:e.autoLoad});t=Ext.apply({tableCode:e.tableName},t);var i=Ext.value(e.action,JE.getUrlMaps("je.core")),a=JE.getActionUrls(i);return Ext.create("Ext.data.Store",{pageSize:Ext.value(e.pageSize,30),remoteSort:!0,actUrls:a,autoLoad:e.autoLoad,sqls:Ext.value(e.sqls,{}),model:JE.getModel({fields:e.fields,doTree:e.doTree,id:e.id,tableName:e.tableName,entityName:e.entityName,excludes:e.excludes}),proxy:{type:"ajax",method:"POST",async:Ext.value(e.async,!0),url:Ext.value(e.url,a.load),actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},extraParams:t,reader:{type:"json",root:"rows",totalProperty:"totalCount"},writer:{type:"json"}}})},summaryType:function(e,t,i){var a={};return this.gridObj&&(a=this.gridObj.getColumn(t)),JE.getSummary(this,e,t,i,a)},getSummary:function(e,t,i,a,n,o){o=o||n.summary;var r="";if(1==a)return r=JE.getAllSummary({tableCode:e.proxy.extraParams.tableCode,whereSql:e.proxy.extraParams.whereSql,type:o,field:i});switch(o){case"count":return t.length;case"min":return e.getMin(t,i);case"max":return e.getMax(t,i);case"sum":return e.getSum(t,i);case"average":return e.getAverage(t,i);case"msg":case"zdy":return r}},getPageSummary:function(e,t){switch(e=Ext.value(e,[]),t){case"count":return e.length;case"min":return Ext.Array.min(e);case"max":return Ext.Array.max(e);case"sum":return Ext.Array.sum(e);case"average":var i=0<e.length?e.length:1;return Ext.Array.sum(e)/i}return""},getAllSummary:function(i,e){var a=[],n=[],o={};return Ext.each(i.types,function(e,t){-1!=["count","min","max","sum","average"].indexOf(e)&&(e="average"==e?"avg":e,a.push(e),n.push(i.fields[t]))}),0<n.length&&(i.types=a.join(","),i.fields=n.join(","),o=JE.ajax({url:JE.getUrlMaps("je.core.develop.funcInfo","doSummary"),params:i}),Ext.iterate(o,function(e,t){o[e]=JE.isEmpty(t)?0:t})),o}}),Ext.define("JE.util.DateUtil",{parseDateTime:function(e){return Ext.Date.parse(e,"Y-m-d H:i:s")},parseDate:function(e,t){var i="Y-m-d";return Ext.isEmpty(t)||(i=t),Ext.Date.parse(e,i)},formatDateTime:function(e){return Ext.Date.format(e,"Y-m-d H:i:s")},formatDate:function(e,t){var i="Y-m-d";return Ext.isEmpty(t)||(i=t),Ext.Date.format(e,i)},getBetweenArray:function(e,t,i,a,n){var o=this,r=1;a&&(r=1*a);var l=new Array;"0"==e&&(e=new Date);var s=o.parseDateTime(o.getDate(Ext.Date.clone(e),t)),d=s,c=e;for(s.getTime()>e.getTime()&&(d=e,c=s);d.getTime()<=c.getTime();)switch(i){case"y":l.push(o.formatDate(d,Ext.value(n,"Y"))),d.setYear(d.getYear()+r);break;case"m":l.push(o.formatDate(d,Ext.value(n,"Y-m"))),d.setMonth(d.getMonth()+r);break;case"w":l.push(o.formatDate(d,Ext.value(n,"Y-m-d"))),d.setDate(d.getDate()+7*r);break;case"d":l.push(o.formatDate(d,Ext.value(n,"Y-m-d"))),d.setDate(d.getDate()+r);break;case"h":l.push(o.formatDate(d,Ext.value(n,"Y-m-d H"))),d.setHours(d.getHours()+r);break;case"i":l.push(o.formatDate(d,Ext.value(n,"Y-m-d H:i"))),d.setMinutes(d.getMinutes()+r);break;case"s":l.push(o.formatDate(d,Ext.value(n,"Y-m-d H:i:s"))),d.setSeconds(d.getSeconds()+r)}return l},getBetweenArrayByDate:function(e,t,i,a,n,o){var r=this,l=1;n&&(l=1*n);var s=e,d=t;o="Y-m-d H:i:s";"date"==a?o="Y-m-d":"datemonth"==a&&(o="Y-m"),"string"==Ext.typeOf(e)&&(s=r.parseDate(e,o)),"string"==Ext.typeOf(t)&&(d=r.parseDate(t,o));var c=new Array,u=d,p=s;for(d.getTime()>s.getTime()&&(u=s,p=d);u.getTime()<=p.getTime();)switch(i){case"y":c.push(r.formatDate(u,Ext.value(o,"Y"))),u.setYear(u.getYear()+l);break;case"m":c.push(r.formatDate(u,Ext.value(o,"Y-m"))),u.setMonth(u.getMonth()+l);break;case"w":c.push(r.formatDate(u,Ext.value(o,"Y-m-d"))),u.setDate(u.getDate()+7*l);break;case"d":c.push(r.formatDate(u,Ext.value(o,"Y-m-d"))),u.setDate(u.getDate()+l);break;case"h":c.push(r.formatDate(u,Ext.value(o,"Y-m-d H"))),u.setHours(u.getHours()+l);break;case"i":c.push(r.formatDate(u,Ext.value(o,"Y-m-d H:i"))),u.setMinutes(u.getMinutes()+l);break;case"s":c.push(r.formatDate(u,Ext.value(o,"Y-m-d H:i:s"))),u.setSeconds(u.getSeconds()+l)}return c},getDate:function(i,e,t){"0"==i&&(i=new Date);var a="Y-m-d H:i:s";return"date"==t?a="Y-m-d":"datemonth"==t&&(a="Y-m"),Ext.each(e.split(","),function(e){var t=1*e.substring(0,e.length-1);switch(e.substring(e.length-1)){case"y":i.setYear(i.getYear()+t);break;case"m":i.setMonth(i.getMonth()+t);break;case"w":i.setDate(i.getDate()+7*t);break;case"d":i.setDate(i.getDate()+t);break;case"h":i.setHours(i.getHours()+t);break;case"i":i.setMinutes(i.getMinutes()+t);break;case"s":i.setSeconds(i.getSeconds()+t)}}),this.formatDate(i,a)},getWeekInfoOfMonth:function(e,t){var i=new Date;(i=Ext.Date.clearTime(i)).setDate(1),i.setYear(e),i.setMonth(t-1);var a=Ext.Date.getLastDateOfMonth(i);a=Ext.Date.clearTime(a);var n=new Array;for(i.setDate(i.getDate()-1);i.getTime()<a.getTime();){i.setDate(i.getDate()+1);var o={date:i.getDate()};switch(i.getDay()){case 0:o.week="日";break;case 1:o.week="一";break;case 2:o.week="二";break;case 3:o.week="三";break;case 4:o.week="四";break;case 5:o.week="五";break;case 6:o.week="六"}n.push(o)}return n},getWeekDates:function(e){var t=new Date;t=Ext.Date.clearTime(t);var i=null;i=Ext.isEmpty(e)?Ext.Date.getWeekOfYear(t):e;var a=Ext.Date.getWeekOfYear(t);t.setDate(t.getDate()+7*(i-a));for(var n=t.getDay(),o=[],r=1;r<=7;r++){var l=Ext.Date.clone(t);l.setDate(l.getDate()-(n-r)),o.push(this.formatDate(l))}return o},humanityDate:function(e){if(!e)return null;var t=new Date,i=Ext.Date.getDayOfYear(t),a=Ext.Date.getWeekOfYear(t),n=t.getMonth()+1,o=Ext.Date.getDayOfYear(e),r=Ext.Date.getWeekOfYear(e),l=e.getMonth()+1,s=JE.DATE.formatDate(e,"H:i"),d=JE.DATE.formatDate(e,"j日H:i"),c=JE.DATE.formatDate(e,"D H:i"),u=JE.DATE.formatDate(e,"Y/m/d");return i-o==0?s:i-o==1?"昨天"+s:r==a?c:l==n?"本月"+d:u},diffDays:function(e,t){var i=Ext.Date.clearTime,a=i(t,!0).getTime()-i(e,!0).getTime();return Math.ceil(a/864e5)},copyTime:function(e,t){var i=Ext.Date.clone(t);return i.setHours(e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()),i},compare:function(e,t,i){return!0!==i&&((e=Ext.Date.clone(e)).setMilliseconds(0),(t=Ext.Date.clone(t)).setMilliseconds(0)),t.getTime()-e.getTime()},isMidnight:function(e){return 0===e.getHours()&&0===e.getMinutes()&&0===e.getSeconds()&&0===e.getMilliseconds()},isMidnight:function(e){return 0===e.getHours()&&0===e.getMinutes()&&0===e.getSeconds()&&0===e.getMilliseconds()},maxOrMin:function(e){for(var t=e?0:Number.MAX_VALUE,i=0,a=arguments[1],n=a.length;i<n;i++)t=Math[e?"max":"min"](t,a[i].getTime());return new Date(t)},max:function(){return this.maxOrMin.apply(this,[!0,arguments])},min:function(){return this.maxOrMin.apply(this,[!1,arguments])},today:function(){return Ext.Date.clearTime(new Date)},add:function(e,t){if(!t)return e;var i=Ext.Date,a=i.add,n=i.clone(e);return t.years&&(n=a(n,i.YEAR,t.years)),t.months&&(n=a(n,i.MONTH,t.months)),t.weeks&&(t.days=(t.days||0)+7*t.weeks),t.days&&(n=a(n,i.DAY,t.days)),t.hours&&(n=a(n,i.HOUR,t.hours)),t.minutes&&(n=a(n,i.MINUTE,t.minutes)),t.seconds&&(n=a(n,i.SECOND,t.seconds)),t.millis&&(n=a(n,i.MILLI,t.millis)),t.clearTime?i.clearTime(n):n}}),Ext.define("JE.util.DevelopUtil",{singleton:!0}),Ext.define("JE.util.DwrMsgUtil",{showMsg:function(e){var t=JE.toObj(e)||{},i=t.context;Ext.isEmpty(t.showConfig)||(i=new Ext.XTemplate(t.showConfig).apply(t));JE.notice(i,t.title),t.wsConfig&&JE.sendWsSysMsg(t.wsConfig),t.login||window.jsCallback||JE.desktopNotice(t.title,JE.local.lang.core.util.DwrMsgUtil.noticeTitle)},showBatchMsg:function(e){var t=JE.toObj(e)||{},i=(t.totalCount,""),a=null,n=!1;Ext.each(t.rows,function(e){var t=e.context;a=e.title,Ext.isEmpty(e.showConfig)||(t=new Ext.XTemplate(e.showConfig).apply(e));i+=t+="<br/><br/><hr/>",n=e.login});var o={type:"msg",beanId:"",msg:i,title:a,see:"1",msgId:"",read:"0"};JE.sendWsSysMsg(o),JE.notice(i,a),n||window.jsCallback||JE.desktopNotice(a,JE.local.lang.core.util.DwrMsgUtil.noticeTitle)},showWfBatchMsg:function(e){var t=JE.toObj(e)||{},i=t.totalCount,a=JE.getLocalLang("core.util.DwrMsgUtil");if(1<i){var n=new Array,o=!1;Ext.each(t.rows,function(e){n.push(e.bean.SY_PIID),o=e.login}),window._crm_home_showworkflow?JE.notice(JE.format(a.taskNotice,i)+'<a href="javascript:void(0)" onclick="_crm_home_showworkflow();">'+a.taskNoticeDo+"</a>",a.taskNoticeTitle):JE.notice(JE.format(a.taskNotice,i)+'<a href="javascript:void(0)" onclick="JE.showIddt(\''+a.funcTitle+"','JE.sys.workflowfunc.controller.WorkflowFuncCtr','workflowfunc.mainview',{piids:'"+n.join(",")+"'});\">"+a.taskNoticeDo+"</a>",a.taskNoticeTitle,0);var r={type:"batchwf",beanId:n.join(","),msg:JE.format(a.taskNotice,i),title:a.taskNoticeTitle,see:"1",msgId:"",read:"0"};JE.sendWsSysMsg(r),o||window.jsCallback||JE.desktopNotice(JE.format(a.taskNoLoginNotice,i),a.taskNoLoginNoticeTitle)}else{var l=t.rows[0],s=l.context;if(!Ext.isEmpty(l.showConfig))s=new Ext.XTemplate(l.showConfig).apply(l);JE.notice(s,l.title),l.wsConfig&&JE.sendWsSysMsg(l.wsConfig),l.login||window.jsCallback||JE.desktopNotice(l.title,a.taskNoLoginNoticeTitle)}},refreshCurrentInfo:function(e){var t=JE.toObj(e)||{},i=JE.toObj(t.context)||{},a=Ext.getCmp("_jewestview");a&&a.refreshUserInfo(i),JE.isNotEmpty(JE.systemConfig.SYS_WF)&&JE.loadBadge(JE.systemConfig.SYS_WF)},doPushInfo:function(e){var t=JE.toObj(e)||{},i=JE.toObj(Ext.value(t.context,"[]"));window._crm_home_refreshBadge&&window._crm_home_refreshBadge(i),Ext.each(i,function(e){if("WF"==e.type){if(e.num)e.numObj;e.refresh}else"MSG"==e.type||"POSTIL"==e.type||"CALENDAR"==e.type||"BUBBLE"==e.type||"TRANSACTION"==e.type||e.type})},updateMessageCount:function(e){JE.defer(function(){if(Ext.get("___userMsg")){var e=JE.ajax({url:JE.getUrlMaps("je.core.load"),params:{tableCode:"JE_SYS_USERMSG",whereSql:" AND USERMSG_JSR_ID='"+JE.currentUser.userId+"' AND USERMSG_YD='0' ",orderSql:"",queryFields:"JE_SYS_USERMSG_ID",limit:-1}}),t=e&&e.rows?e.rows:JE.error("数据获取失败！"),i=Ext.value(t,[]).length;return Ext.get("___userMsg").dom.innerHTML=i,!1}},10)},refreshUpgradeInfo:function(e){var t=(JE.toObj(e)||{}).context,i=Ext.getCmp("jeupgradewindow");i&&i.down("displayfield[name=upgradeInfo]").setValue(t)},updateUpgradeProcess:function(e){var t=JE.toObj(e)||{},i=Ext.getCmp("_upgradeprocesswin"),a=t.title,n=JE.toObj(t.context)||{},o=n.count,r=n.index;if(i?i.show():i=JE.win({title:"升级进度",useButton:!1,id:"_upgradeprocesswin",autoShow:!0,width:480,height:130,maximizable:!1,closable:!0,layout:"column",items:[{columnWidth:1,height:40,name:"msg",padding:"1 5 1 5",xtype:"displayfield"},{columnWidth:1,name:"process",hideTrigger:!0,xtype:"barfield",padding:"1 5 1 5",configInfo:",1-99~orange,100-100~green"}]}),"start"==a)msg="开始升级，共"+o+"个升级包...",i.down("displayfield[name=msg]").setValue(msg),i.down("barfield[name=process]").setValue(1*Ext.Number.toFixed(100*Ext.Number.toFixed(r/o,2),0));else if("run"==a){var l="下载";"upgrade"==n.type&&(l="升级"),msg="正在"+l+"第"+r+"个升级包...",i.down("displayfield[name=msg]").setValue(msg),i.down("barfield[name=process]").setValue(1*Ext.Number.toFixed(100*Ext.Number.toFixed(r/o,2),0))}else"end"==a&&i.close()},showExpressMsg:function(e){},uploadAppProcess:function(e){var t="__appuploadwin",i=Ext.getCmp(t),a=JE.toObj(e)||{};i?i.body.dom.innerHTML+=a.context:JE.win({id:t,bodyPadding:10,title:"APP升级",width:300,height:500,autoScroll:!0,autoShow:!0,showFn:function(e){e.body.dom.innerHTML+=a.context}})},updateClusterFileSyncProcess:function(e){var t=JE.toObj(e)||{},i=Ext.getCmp("_upgradeClusterFileSyncWin"),a=t.title,n=JE.toObj(t.context)||{},o=n.sourceIp,r=n.targetIp;n.sourceDir,n.targetDir,n.syncMsg,n.count,n.index;i?i.show():i=JE.win({title:"集群文件同步进度",useButton:!1,id:"_upgradeClusterFileSyncWin",autoShow:!0,width:800,height:300,maximizable:!1,closable:!0,layout:"column",items:[{columnWidth:1,height:40,name:"msg",padding:"1 5 1 5",xtype:"displayfield"}]}),"start"==a&&(msg="开始从服务器"+o+"同步文件/目录到服务器"+r+"...",i.down("displayfield[name=msg]").setValue(msg))},refreshClusterFileSyncProcess:function(e){var t=(JE.toObj(e)||{}).context,i=Ext.getCmp("_upgradeClusterFileSyncWin");if(i){var a=i.down("displayfield[name=msg]");t=a.getValue()+"<br/>"+t,a.setValue(t)}},doWsMsg:function(e,t){if("see"==e){if("wf"==t.type){var i=t.funcCode,a=t.beanId;if(JE.isNotEmpty(a)&&JE.isNotEmpty(i)){var n=JE.getFuncView(i,"form");if(n){var o=n.up("window");o&&o.close()}JE.showFunc(i,{info:{useWFLog:!0},id:a,useChild:!0,readOnly:!1,type:"form"})}}else if("batchwf"==t.type){var r=JE.getLocalLang("core.util.DwrMsgUtil");JE.showIddt(r.funcTitle,"JE.sys.workflowfunc.controller.WorkflowFuncCtr","workflowfunc.mainview",{piids:t.beanId})}}else if("read"==e){var l=t.msgId;if(JE.isNotEmpty(l))JE.ajax({url:JE.getUrlMaps("je.core.update"),params:{tableCode:"JE_SYS_USERMSG",JE_SYS_USERMSG_ID:l,USERMSG_YD:"1"}}).success&&JE.updateMessageCount()}},sendWsSysMsg:function(e){var t=JE.toStr(e)||{};try{jsCallback.showMsg(t)}catch(e){}},sendWsMsg:function(e,t,i){var a={};a.type=e,a.id=t,a.msgContent=i,a=JE.toStr(a);try{jsCallback.showMsg(a)}catch(e){}}}),Ext.define("JE.util.OpenFileUtil",{doAct:function(e,t,i){var a={},n="",o={},r={};if(Ext.isObject(t)){n=(a=t).funcCode;var l=JE.getFuncData(n).basicFields[a.field],s=a.beanId;o=JE.toObj(l.otherConfig);var d=JE.getFuncView(n,"grid");d&&(r=d.store.getById(s).data)}else{if(!(l=Ext.getCmp(t))||Ext.isEmpty(l.baseFile.path))return;jQuery.powerTip.hide(l.inputEl.dom),a=l.baseFile,n=l.funcCode,r=l.up("form").getValues(),o=l.otherConfig}var c=a.name,u=a.path,p={filePath:a.path,editable:"0",history:"0",qianzhang:"0",taohong:"0"},f=Ext.decode(o.pageOfficeData);if((f&&(p=Ext.apply({filePath:a.path,editable:f.editable,history:f.history}),["taohong","qianzhang"].forEach(function(t){if(JE.isNotEmpty(f[t]))if("role"==f[t].type){var e=JE.USER.roleCodes.split(","),i=f[t].config.code.split(",");e.forEach(function(e){-1!=i.indexOf(e)&&("taohong"===t?p.taohong="1":"qianzhang"===t&&(p.qianzhang="1"))})}else if("field"==f[t].type){var a=f[t].config.field;r[a]==JE.USER.userId&&("taohong"===t?p.taohong="1":"qianzhang"===t&&(p.qianzhang="1"))}else if("self"==f[t].type){r.SY_CREATEUSERID==JE.USER.userId&&("taohong"===t?p.taohong="1":"qianzhang"===t&&(p.qianzhang="1"))}})),JE.File.checkFilePerm)&&0==JE.File.checkFilePerm(e,[a],n))return;if("download"==e)if(0==u.indexOf("http://"))window.open(u);else{var E=JE.getUrlMaps("je.core.doc.document","download"),m="";JE.isNotEmpty(i)&&(m="&beanTableCode="+i);var g=E+"?ieFlag="+(Ext.isIE?"1":"0")+"&enCode=1&fileName="+encodeURIComponent(c)+m+"&path="+u;window.open(g)}else if("preview"==e){var h=JE.systemConfig.JE_SYS_DOCFILETYPE,x=Ext.decode(h),v=u.lastIndexOf(".")+1,y=u.substring(v,u.length).toLowerCase();for(var b in x)if(-1!=$.inArray(y,x[b].value.split(","))){if("office"==x[b].code||"pdf"==x[b].code){if("1"!=JE.systemConfig.JE_SYS_PAGEOFFICE)return JE.alert("未启动pageoffice插件!"),!1;JE.File.office(p)}else JE.File.openFileByPath(u,c,!0,null,null,"","",i);break}}else"savedoc"==e&&JE.File.addDocFiles(u,c)},openFileByExtension:function(e,t,i,a){var n=e.get("DOCUMENTATION_ADDRESS"),o=e.get("DOCUMENTATION_TEXT"),r=e.get("JE_SYS_DOCUMENTATION_ID");this.openFileByPath(n,o,t,i,{},a,r)},openFileByPath:function(o,e,t,i,a,r,n,l){var s,d=JE.getLocalLang("core.util.OpenFileUtil"),c=JE.systemConfig.JE_SYS_DOCFILETYPE,u=Ext.decode(c),p=o.lastIndexOf(".")+1,f=o.substring(p,o.length).toLowerCase();for(var E in s=0==o.indexOf("http://")||0==o.indexOf("https://")?o:JE.getFileUrl(o,null,r,n,l),u)if(-1!=$.inArray(f,u[E].value.split(","))){var m,g;if("picture"==u[E].code){JE.loadScript(["/static/ux/Picasa/Picasa.js","/static/ux/Picasa/Picasa.css"]);var h=new Picasa,x=[],v=0,y=0;return i&&0<i.length?Ext.Array.each(i,function(e){var t=e.path,i=JE.getFileUrl(t,null,r,e.id,l);i=0==t.indexOf("http://")||0==t.indexOf("https://")?t:JE.getFileUrl(t,null,r,e.id,l);var a=e.name,n=t.split(".").pop();Ext.Array.contains(["jpg","jpeg","png","bmp","gif"],n)&&(t==o&&(v=y),x.push($("<div filetype='jpg' name='"+a+"' picasa='"+i+"' thumb='"+i+"' PicasaNo='"+y+++"'>")[0]))}):x.push($("<div filetype='jpg' name='"+e+"' picasa='"+s+"' thumb='"+s+"' PicasaNo='0'>")[0]),h.init(x),h.initData(),void setTimeout(function(){h.display(x[v])},200)}if("flash"==u[E].code)g={width:"50%",height:"50%",maximized:!0,html:m='<embed src="'+s+'" type="application/x-shockwave-flash" allowscriptaccess="always" wmode="opaque" width="100%" height="100%"></embed>'};else if("audio"==u[E].code){JE.loadScript("/static/ux/cmpplayer/cmp.js");var b={name:d.audio,src:s,type:f};g={width:590,height:410,html:m=CMP.create("cmp","100%","100%",JE.getStaticUrl("JE.common.file.cmp","swf"),b)}}else if("video"==u[E].code){JE.loadScript("/static/ux/cmpplayer/cmp.js");b={name:d.video,src:s,type:f};g={width:590,height:410,html:m=CMP.create("cmp","100%","100%",JE.getStaticUrl("JE.common.file.cmp","swf"),b)}}else if("video5"==u[E].code)g={width:380,height:410,html:m='<video src="'+s+'" width="100%" height="100%" autoplay="autoplay" controls="controls" preload="preload"></video>'};else if("pdf"==u[E].code)g={width:"50%",height:"50%",maximized:!0,html:m='<object data="'+s+'" type="application/pdf" width="100%" height="100%"></object>'};else if("html"==u[E].code)g={width:"50%",height:"50%",maximized:!0,html:m='<iframe width="100%" height="100%" src="'+s+'"/>'};else if("office"==u[E].code){if(0==o.indexOf("http://"))window.open(o);else{var C=JE.getUrlMaps("je.core.doc.document","download"),w="";JE.isNotEmpty(l)&&(w="&beanTableCode="+l);var S=C+"?ieFlag="+(Ext.isIE?"1":"0")+"&enCode=1&fileName="+encodeURIComponent(e)+w+"&path="+o;window.open(S)}return}else if("cad"==u[E].code)m='<object id = "viewer"',m+='classid   =   "clsid:A662DA7E-CCB7-4743-B71A-D817F6D575DF"',m+='CODEBASE="http://www.autodesk.com/global/expressviewer/installer/ExpressViewerSetup.cab"',m+=' width="100%" height="100%" border="2">',g={width:"50%",height:"50%",maximized:!0,html:m+='<param name = "Src" value= "'+s+'"></object>'};else if("txt"==u[E].code){if(m=JE.ajax({url:JE.getUrlMaps("je.core.doc.fileview","loadFileData"),params:{path:o,type:r,pkValue:n,beanTableCode:l}}).obj.data,g={width:"50%",height:"50%",overflowY:"hidden"},t)g.html='<textarea style="width:100%;height:100%;" readonly>'+m+"</textarea>";else{var I=Ext.create("JE.core.view.CodeEditor",{value:m,saveFn:function(e){var t=JE.ajax({url:JE.getUrlMaps("je.core.doc.fileview","saveFile"),params:{path:o,fileContent:e}});t.success?JE.msg(t.obj):JE.alert(t.obj)},useHelp:!1});g.items=[I]}}else if("eml"==u[E].code){var T;if((T=JE.ajax({url:JE.getUrlMaps("je.core.doc.fileview","loadEmlData"),params:{path:o,beanTableCode:l}})).success)return JE.initCtr("JE.sys.email.controller.EmailMainCtr"),void Ext.create("JE.sys.email.util.Util").editEmail({},"read",{title:d.email,data:T.obj,email:{}});JE.alert(T.obj)}return g=Ext.applyIf({title:d.openFileByPathTitle,resizable:!0,modal:!0,layout:"fit",maximizable:!0,autoScroll:!0,bodyStyle:"background-color:#ffffff;"},g),void Ext.create("Ext.window.Window",g).show()}JE.msg("该格式暂不支持...")},office:function(e){var t=e.filePath.substring(e.filePath.lastIndexOf("."),e.filePath.length);".xls"!=(t=t.toLowerCase())&&".xlsx"!=t||(e.history="0",e.taohong="0",e.qianzhang="0",e.editable="0");var i={userName:JE.currentUser.username,userId:JE.currentUser.userId,path:e.filePath,jeFileType:"",jeFileSaveType:"",history:e.history||"0",taohong:e.taohong||"0",qianzhang:e.qianzhang||"0",readOnly:("1"===e.editable?"0":"1")||"1"},a=JE.ajax({url:"/je/doc/document/openPageOffice",params:{path:e.filePath}});a.success&&(i.jeFileType=a.obj.jeFileType,i.jeFileSaveType=a.obj.jeFileSaveType),POBrowser.openWindowModeless("/static/ux/pageoffice/pageoffice.html?t="+(new Date).getTime(),"width=1200px;height=900px;",JSON.stringify(i))},addDocBatchFiles:function(n){var o=JE.getLocalLang("core.util.OpenFileUtil");JE.selectWin({parent:null,parentType:"self",title:o.addDocBatchFilesTitle,configInfo:"JE_SYS_DOCUMENTATION",whereSql:" AND SY_CREATEUSER='"+JE.currentUser.userCode+"' AND DOCUMENTATION_FILEMODE='USER'",type:"tree",treeConfig:{rootVisible:!0,listeners:{afterrender:function(e){var t=e.getRootNode();t.set("text",o.rootText),t.set("iconCls","jeicon jeicon-folders"),t.commit()}}},callback:function(e,t){if(e){if(!e[0])return JE.alert(o.moveFolder),!1;var i=e[0],a=JE.ajax({url:JE.getUrlMaps("je.core.doc.documentation","doSaveFile"),params:{strData:JE.toStr(n),tableCode:"JE_SYS_DOCUMENTATION",DOCUMENTATION_FILEMODE:"USER",SY_PATH:i.getPath(),SY_LAYER:i.get("layer")+1,SY_PARENT:i.get("id"),SY_NODETYPE:"LEAF",DOCUMENTATION_FILEMODE:"USER"}});if(!a.success)return JE.alert(a.obj),!1;JE.msg(a.obj)}}})},addDocFiles:function(e,t){this.addDocBatchFiles([{name:t,path:e}])},downloadFile:function(e,t,i){var a=JE.ajax({url:JE.getUrlMaps("je.core.getInfoById"),params:{tableCode:e,pkValue:t}});if(0!=a.success){var n=a[i];if(JE.isNotEmpty(n)){var o=n.split("*"),r=JE.getUrlMaps("je.core.doc.document","downloadUrl");window.open(r+"?ieFlag="+(Ext.isIE?"1":"0")+"&enCode=1&fileName="+encodeURIComponent(o[0])+"&path="+o[1])}else JE.alert("未找到附件信息!")}else JE.alert("未找到数据!")}}),Ext.define("JE.util.OverrideUtil",{obj:{"Ext.form.field.Text":{getErrors:function(e){var t=this.callParent(arguments);return JE.isEmpty(t)&&!this.allowBlank&&(JE.isEmpty(e)||Ext.isString(e)&&JE.isEmpty(e.trim()))&&t.push(this.blankText),t}},"Ext.Loader":{getPath:function(e){var t="",i=(e=e.trim()).split("?")[0].split("."),a=i[i.length-1].toLocaleLowerCase();if(-1!=["js","css"].indexOf(a))t=e;else{var n="",o=this.config.paths,r=this.getPrefix(e);if(0<r.length){if(r===e)return o[r];n=o[r],e=e.substring(r.length+1)}0<n.length&&(-1!=["JE","PRO"].indexOf(n)&&(n="/"+n),n+="/"),t=n.replace(/\/\.\//g,"/")+e.replace(/\./g,"/")+".js"}return t=JE.buildCdnUrl(t)},injectScriptElement:function(e,t,i,a,n){function o(){s||(s=!0,l.onload=l.onreadystatechange=l.onerror=null,"number"==typeof d.scriptChainDelay?defer(t,d.scriptChainDelay,a):t.call(a),r.cleanupScriptElement(l,!1===d.preserveScripts,d.garbageCollect))}var r=this,l=document.createElement("script"),s=!1,d=r.config;return l.type="text/javascript",l.onerror=function(e){defer(i,1,a),r.cleanupScriptElement(l,!1===d.preserveScripts,d.garbageCollect)},(n=n||d.scriptCharset)&&(l.charset=n),"addEventListener"in l?l.onload=o:"readyState"in l?l.onreadystatechange=function(){"loaded"!=this.readyState&&"complete"!=this.readyState||o()}:l.onload=o,-1!=e.indexOf(".css")?((l=document.createElement("link")).rel="stylesheet",l.href=e):l.src=e,(r.documentHead||document.getElementsByTagName("head")[0]).appendChild(l),l},loadScriptFile:function(e,t,i,a,n){var o=this;if(o.isFileLoaded[e])return o;var r,l,s,d=o.getConfig(),c=e+(d.disableCaching?"?"+d.disableCachingParam+"="+Ext.Date.now():""),u=!1,p="",f=JE.getOnlineInfo("cdn"),E=JE.getOnlineInfo("hash_map");if((f&&0==e.indexOf(f)||E)&&(c=e),a=a||o,o.isLoading=!0,n){r="undefined"!=typeof XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");try{r.open("GET",c,!1),r.send(null)}catch(e){u=!0}if(l=1223===r.status?204:0!==r.status||"file:"!=(self.location||{}).protocol&&"ionp:"!=(self.location||{}).protocol?r.status:200,(u=u||0===l)&&!isPhantomJS)i.call(o,"Failed loading synchronously via XHR: '"+e+"'; It's likely that the file is either being loaded from a different domain or from the local file system whereby cross origin requests are not allowed due to security reasons. Use asynchronous loading with Ext.require instead.",n);else if(200<=l&&l<300||304===l||isPhantomJS){Ext.isIE||(p="\n//@ sourceURL="+e);var m=o.documentHead||document.getElementsByTagName("head")[0],g=r.responseText+p;if(-1!=e.indexOf(".css"))Ext.util.CSS.createStyleSheet(g,e);else{var h=document.createElement("script");h.language="javascript",h.type="text/javascript",h.defer=!0,h.id=e,h.text=g,m.appendChild(h)}t.call(a)}else i.call(o,"Failed loading synchronously via XHR: '"+e+"'; please verify that the file exists. XHR status code: "+l,n);r=null}else s=function(){i.call(a,"Failed loading '"+e+"', please verify that the file exists",n)},o.scriptElements[e]=o.injectScriptElement(c,t,s,a)}},"Ext.selection.DataViewModel":{onItemClick:function(e,t,i,a,n){if(JE.isNotEmpty(e.itemTargetSelector)&&n&&!n.getTarget(e.itemTargetSelector,3))return;this.selectWithEvent(t,n||{})}},"Ext.form.field.Base":{afterRender:function(){var i=this;i.callParent(arguments),i.inputEl&&i.inputEl.on("focus",function(e,t){i.readOnly&&(t.readOnly=i.readOnly)})}},"Ext.form.field.Display":{getDisplayValue:function(){var e=this.callParent(arguments);return JE.isEmpty(e)&&(e="&nbsp;"),e}},"Ext.layout.container.Card":{setActiveItem:function(e){var t=this.owner,i=this.activeItem;this.callParent(arguments)&&t.fireEvent("activechange",t,e,i)}},"Ext.layout.container.Box":{calculateParallel:function(e,t,i){var a=this.callParent(arguments);if("plus"==JE.getTheme()&&"hbox"==this.type){for(var n=e.childItems,o=n.length,r=-1,l=o-1;0<=l;l--){if("tbfill"==this.owner.items.get(l).xtype){r=l;break}}if(-1<r)for(l=r+1;l<o;l++){childContext=n[l];var s=JE.toNum(childContext.getProp(t.x))+2;childContext.setProp(t.x,s)}}return a}},"Ext.view.BoundList":{renderTpl:["{%","var me=values.$comp, headerToolbar=me.headerToolbar;","if (headerToolbar) {","headerToolbar.ownerLayout = me.componentLayout;","Ext.DomHelper.generateMarkup(headerToolbar.getRenderTree(), out);","}","%}",'<div id="{id}-listEl" class="{baseCls}-list-ct ',Ext.dom.Element.unselectableCls,'" style="overflow:auto"></div>',"{%","var me=values.$comp, pagingToolbar=me.pagingToolbar;","if (pagingToolbar) {","pagingToolbar.ownerLayout = me.componentLayout;","Ext.DomHelper.generateMarkup(pagingToolbar.getRenderTree(), out);","}","%}",{disableFormats:!0}],initComponent:function(){this.headerTpl&&(this.headerToolbar=this.createHeaderToolbar()),this.callParent(arguments)},createHeaderToolbar:function(){return Ext.widget("box",{id:this.id+"-header-toolbar",cls:"x-boundlist-header",ownerCt:this,ownerLayout:this.getComponentLayout(),html:this.headerTpl,height:this.headerHeight||30})},createPagingToolbar:function(){return Ext.widget("uxpagingtoolbar",{id:this.id+"-paging-toolbar",pageSize:this.pageSize,store:this.store,border:!1,ownerCt:this,useTheme:!0,displayInfo:!1,height:this.pageHeight||30,ownerLayout:this.getComponentLayout()})},getRefItems:function(){var e=this.callParent(arguments);return this.headerToolbar&&e.push(this.headerToolbar),e},finishRenderChildren:function(){this.callParent(arguments),this.headerToolbar&&this.headerToolbar.finishRender()},refresh:function(){var e=this;e.callParent(arguments);var t=e.headerToolbar;e.rendered&&t&&t.rendered&&!e.preserveScrollOnRefresh&&e.el.insertFirst(t.el)}},"Ext.layout.component.BoundList":{beginLayout:function(e){this.callParent(arguments);var t=this.owner.headerToolbar;t&&(e.headerToolbarContext=e.context.getCmp(t))},getLayoutItems:function(){var e=this.owner.headerToolbar,t=this.callParent(arguments);return e&&t.push(e),t},publishInnerHeight:function(e,t){var i=e.toolbarContext,a=e.headerToolbarContext,n=0;if(i&&(n=i.getProp("height")),a){var o=a.getProp("height");void 0===n?n=o:void 0!==o&&(n+=o)}void 0===n?this.done=!1:e.listContext.setHeight(t-e.getFrameInfo().height-n)},calculateOwnerHeightFromContentHeight:function(e){var t=this.callParent(arguments),i=e.headerToolbarContext;return i&&(t+=i.getProp("height")),t}},"Ext.data.proxy.Ajax":{actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},doRequest:function(e,t,i){var a=this.getWriter(),n=this.buildRequest(e);return e.allowWrite()&&(n=a.write(n)),Ext.apply(n,{async:this.async,binary:this.binary,headers:this.headers,timeout:this.timeout,scope:this,callback:this.createRequestCallback(n,e,t,i),method:this.getMethod(n),disableCaching:!1}),Ext.Ajax.request(n),n}},"Ext.menu.Item":{removable:!1,removableCls:"x-menu-item-removable",removeHandler:Ext.emptyFn,initComponent:function(){var e=this;e.removable&&(e.cls=Ext.value(e.cls,"")+" "+e.removableCls),e.callParent(arguments)},afterRender:function(){var t=this;t.callParent(arguments);var e=document.createElement("i");e.setAttribute("class","fa fa-close removable"),(e=t.getEl().appendChild(e)).on("click",function(e){e.stopPropagation(),t.removeHandler(t)})}},"Ext.panel.Header":{adjustTitlePosition:function(){var e,t=this.titleCmp;!Ext.isIE9m&&t&&(e=t.el).setStyle("left",e.getWidth()/2+"px")},initIconCmp:function(){var e,t=this,i=[t.headerCls+"-icon",t.baseCls+"-icon",t.iconCls];t.glyph&&i.push(t.baseCls+"-glyph"),e={focusable:!1,src:Ext.BLANK_IMAGE_URL,cls:i,baseCls:t.baseCls+"-icon",id:t.id+"-iconEl",iconCls:t.iconCls,glyph:t.glyph,style:t.ownerCt.iconStyle},t.iconCmp=Ext.create("Ext.Component",e)}},"Ext.grid.ColumnManager":{getHeaderIndex:function(e){return e.isGroupHeader&&(e=e.down(":not([isGroupHeader])"),Ext.isEmpty(e))?0:Ext.Array.indexOf(this.getColumns(),e)}},"Ext.grid.ColumnComponentLayout":{publishOwnerHeight:function(e,t){var i=this.owner;if(this.callParent(arguments),!i.el.hasCls("sch-simple-timeaxis")){var a=i.titleEl.getHeight(),n=i.textEl.getHeight();-1==i.text.indexOf("<br>")&&-1==i.text.indexOf("<br/>")||(i.textEl.setStyle("height","auto"),n=i.textEl.getHeight());var o=Math.floor((a-n)/2),r=a-n-o;o<=a-n?(e.titleContext.setProp("padding-top",o),e.titleContext.setProp("padding-bottom",r)):e.titleContext.setProp("padding-top",0)}},publishInnerHeight:function(e,t){if(t){var i,a,n,o,r=this.owner,l=t-e.getBorderInfo().height,s=l;if(r.noWrap||e.hasDomProp("width")){var d=r.useField||"uxcheckcolumn"==r.xtype&&1==r.enableEdit;if(e.hasRawContent||d){if(a=s,i=r.textEl.getHeight())if(-1!=r.textEl.dom.innerHTML.indexOf("<br>")||-1!=r.textEl.dom.innerHTML.indexOf("<br/>")?(r.textEl.setStyle("height","auto"),i=r.textEl.getHeight()):s>r.titleEl.getHeight()&&r.titleEl.setStyle("height","auto"),0<(s-=i)){var c=0;o=t-i-(n=Math.floor(s/2)),d?(r.items.each(function(e){c+=e.getHeight()}),n-=c/2,o-=c/2,e.setProp("innerHeight",c,!1)):(c=0,e.titleContext.setProp("height","auto")),r.readOnly&&d&&(a+=c),n<=a-c-i&&(n.toString().includes(".")&&(n=parseInt(n)+1,o=parseInt(o)),e.titleContext.setProp("padding-top",n),e.titleContext.setProp("padding-bottom",o))}else e.titleContext.setProp("padding-top",0)}else a=r.titleEl.getHeight(),e.setProp("innerHeight",l-a,!1);(Ext.isIE6||Ext.isIEQuirks)&&e.triggerContext&&e.triggerContext.setHeight(a)}else this.done=!1}}},"Ext.data.Store":{constructor:function(e){this.addEvents("loadrecords"),this.callParent(arguments)},loadRecords:function(e,t){this.fireEvent("loadrecords",this,e),this.callParent(arguments)},group:function(e,t,i){e==this.groupField&&(t=Ext.value(t,this.groupDir)),this.callParent([e,t,i])}},"Ext.dom.Element":{getOffsetsTo:function(e){var t=this.getXY(),i=Ext.fly(e.el||e,"_internal").getXY();t[0],i[0];return[0,t[1]-i[1]]},scrollByEl:function(e,t){this.scrollBy(e.getOffsetsTo(this),Ext.value(t,!0))}},"Ext.form.FieldSet":{basicColor:void 0,borderColor:void 0,borderTopColor:void 0,titleColor:void 0,titleBgColor:void 0,bgColor:void 0,initComponent:function(){var e=this;"plus"==JE.getTheme()&&(e.style=Ext.value(e.style,""),e.titleStyle=Ext.value(e.titleStyle,""),e.legendStyle=Ext.value(e.legendStyle,""),JE.isNotEmpty(e.basicColor)&&(e.borderColor=e.borderTopColor=e.titleBgColor=e.basicColor,JE.isEmpty(e.titleColor)&&(e.titleColor="#ffffff")),JE.isNotEmpty(e.borderColor)&&(e.style+="border-color:"+e.borderColor+" !important;",e.legendStyle+="border-bottom-color:"+e.borderColor+";"),JE.isNotEmpty(e.borderTopColor)&&(e.style+="border-top-color:"+e.borderTopColor+" !important;"),JE.isNotEmpty(e.titleColor)&&(e.titleStyle="color:"+e.titleColor+";"),JE.isNotEmpty(e.titleBgColor)&&(e.legendStyle+="background-color:"+e.titleBgColor+";")),JE.isNotEmpty(e.bgColor)&&(e.style+="background-color:"+e.bgColor+";"),e.callParent(arguments)},createLegendCt:function(){var e=this.callParent(arguments);return e.style=this.legendStyle,e},createTitleCmp:function(){var e=this,t={xtype:"component",html:e.title,cls:e.baseCls+"-header-text",id:e.id+"-legendTitle",style:e.titleStyle};return e.collapsible&&e.toggleOnTitleClick&&(t.listeners={click:{element:"el",scope:e,fn:e.toggle}},t.cls+=" "+e.baseCls+"-header-text-collapsible"),e.titleCmp=Ext.widget(t)},createToggleCmp:function(){var e=this;return e.toggleCmp=Ext.widget({xtype:"tool",height:15,width:15,type:"toggle",handler:e.toggle,id:e.id+"-legendToggle",scope:e,style:e.titleStyle}),e.toggleCmp}},"Ext.grid.plugin.RowExpander":{setup:function(e,t){var i=1;try{Ext.Array.each(this.grid.plugins,function(e){e.hiddenFoldTool&&(i=0)})}catch(e){}this.self.prototype.setup.apply(this,arguments),this.grid.ownerLockable||(t.rowBodyColspan-=i)},bindView:function(e){this.hiddenFoldTool||(this.expandOnEnter&&e.on("itemkeydown",this.onKeyDown,this),this.expandOnDblClick&&e.on("itemdblclick",this.onDblClick,this))},getHeaderConfig:function(){var l=this;return{width:24,lockable:!1,sortable:!1,resizable:!1,draggable:!1,hideable:!1,menuDisabled:!0,tdCls:Ext.baseCSSPrefix+"grid-cell-special je-grid-cell-row-expander",innerCls:Ext.baseCSSPrefix+"grid-cell-inner-row-expander",renderer:function(e,t){return l.grid.ownerLockable||(t.tdAttr+=' rowspan="2"',l.hiddenFoldTool&&(t.tdAttr="style='display:none;'")),'<div class="'+Ext.baseCSSPrefix+'grid-row-expander"></div>'},processEvent:function(e,t,i,a,n,o,r){if("mousedown"==e&&o.getTarget(".x-grid-row-expander"))return l.toggleRow(a,r),l.selectRowOnExpand}}}},"Ext.layout.container.Column":{beginLayoutCycle:function(e){this.callParent(arguments),0<this.owner.layoutMinWidth&&this.outerCt.setStyle("width",this.owner.layoutMinWidth+24+"px")},renderTpl:["{% if (!(Ext.isIEQuirks || Ext.isIE7m)) { %}",'<span id="{ownerId}-outerCt" style="display:table;">','<div id="{ownerId}-innerCt" style="','<tpl if="Ext.isChrome">display: flex;flex-wrap: wrap;<tpl else>display:table-cell;height:100%;</tpl>','vertical-align:top;{%this.renderPadding(out, values)%}" class="{innerCtCls}">',"{%this.renderBody(out,values)%}","</div>","</span>","{% } else if (values.shrinkWrapWidth) { %}",'<table id="{ownerId}-outerCt" class="'+Ext.plainTableCls+'">',"<tr>",'<td id="{ownerId}-innerCt" style="vertical-align:top;padding:0;','{%this.renderPadding(out, values)%}" class="{innerCtCls}">',"{%this.renderBody(out,values)%}",'<div id="{ownerId}-clearEl" class="',Ext.baseCSSPrefix,'clear"','role="presentation"></div>',"</td>","</tr>","</table>","{% } else { %}",'<div id="{ownerId}-outerCt" style="zoom:1;{%this.renderPadding(out, values)%}">','<div id="{ownerId}-innerCt" style="zoom:1;height:100%;" class="{innerCtCls}">',"{%this.renderBody(out,values)%}",'<div id="{ownerId}-clearEl" class="',Ext.baseCSSPrefix,'clear"','role="presentation"></div>',"</div>","</div>","{% values.$layout.isShrinkWrapTpl = false %}","{% } %}"]},"Ext.grid.column.Column":{renderTpl:'<div id="{id}-titleEl" {tipMarkup} class="'+Ext.baseCSSPrefix+'column-header-inner" style="{henderInnerStyle}"><span id="{id}-textEl" class="'+Ext.baseCSSPrefix+'column-header-text{childElCls} {titleCls}" style="{titleStyle}">{text}</span><tpl if="!menuDisabled"><div id="{id}-triggerEl" class="'+Ext.baseCSSPrefix+'column-header-trigger{childElCls}"></div></tpl></div>{%this.renderContainer(out,values)%}',initRenderData:function(){return Ext.applyIf(this.callParent(arguments),{titleStyle:this.titleStyle,titleCls:this.titleCls,henderInnerStyle:this.henderInnerStyle})},toggleSortState:function(){var e,t=this;if(t.sortable&&(t.possibleSortStates=["ASC","DESC",null],e=(Ext.Array.indexOf(t.possibleSortStates,t.sortState)+1)%t.possibleSortStates.length,t.setSortState(t.possibleSortStates[e]),!t.possibleSortStates[e])){var i=t.up("tablepanel"),a=i.store;i.ownerLockable&&a.isNodeStore&&(a=i.ownerLockable.lockedGrid.store),a.sorters.clear(),a.load()}},initComponent:function(){this.addEvents("linkclick","beforeedit","edit"),this.callParent(arguments)}},"Ext.tree.Column":{cellTpl:['<tpl for="lines">','<img src="{parent.blankUrl}" class="{parent.childCls} {parent.elbowCls}-img ','{parent.elbowCls}-<tpl if=".">line<tpl else>empty</tpl>"/>',"</tpl>",'<tpl if="!hideElbow">','<tpl if="expandable">','<div src="{blankUrl}" class="{childCls} {elbowCls}-img {elbowCls}','<tpl if="isLast">-end</tpl><tpl if="expandable">-plus {expanderCls}</tpl>"></div>',"<tpl else>",'<img src="{blankUrl}" class="{childCls} {elbowCls}-img {elbowCls}','<tpl if="isLast">-end</tpl><tpl if="expandable">-plus {expanderCls}</tpl>"/>',"</tpl>","</tpl>",'<tpl if="checked !== null">','<div type="button" role="checkbox" <tpl if="checked">aria-checked="true" </tpl>','class="{childCls} {checkboxCls}<tpl if="checked"> {checkboxCls}-checked</tpl>"></div>',"</tpl>",'<tpl if="!hideIcon">','<div src="{blankUrl}" class="{childCls} {baseIconCls} ','{baseIconCls}-<tpl if="leaf">leaf<tpl else>parent</tpl> {iconCls}"','<tpl if="icon">style="background-image:url({icon})"</tpl>></div>',"</tpl>",'<tpl if="href">','<a href="{href}" target="{hrefTarget}" class="{textCls} {childCls}">{value}</a>',"<tpl else>",'<span class="{textCls} {childCls}">{value}</span>',"</tpl>"],treeRenderer:function(e,t,i,a,n,o,r){var l,s=this,d=i.get("cls"),c=s.origRenderer,u=i.data,p=i.parentNode,f=r.rootVisible,E=[],m=r.panel.nodeRenderer,g=Ext.value(r.panel.hideNodeIcon,!1),h=Ext.value(r.panel.hideNodeElbow,!1);for(m&&(e=m.apply(s.origScope,arguments)),d&&(t.tdCls+=" "+d);p&&(f||0<p.data.depth);)l=p.data,E[f?l.depth:l.depth-1]=l.isLast?0:1,p=p.parentNode;return s.getTpl("cellTpl").apply({record:i,baseIconCls:s.iconCls,iconCls:u.iconCls,icon:u.icon,checkboxCls:s.checkboxCls,checked:u.checked,elbowCls:s.elbowCls,expanderCls:s.expanderCls,textCls:s.textCls,leaf:u.leaf,expandable:i.isExpandable(),isLast:u.isLast,blankUrl:Ext.BLANK_IMAGE_URL,href:u.href,hrefTarget:u.hrefTarget,lines:E,metaData:t,hideIcon:g,hideElbow:h,childCls:s.getChildCls?s.getChildCls()+" ":"",value:c?c.apply(s.origScope,arguments):e})}},"Ext.view.Table":{getRecord:function(e){if(e=this.getNode(e)){var t=e.getAttribute("data-recordIndex");if(t&&-1<(t=parseInt(t,10))){var i=this.store.data.getAt(t),a=this.store.data.get(e.getAttribute("data-recordId"));return Ext.value(a,i)}return this.dataSource.data.get(e.getAttribute("data-recordId"))}},onCellClick:function(e,t,i,a,n,o){var r=this.getHeaderByCell(e),l=i.get(r.dataIndex);if(r.hasListener("linkclick")&&(r.rendererText||!Ext.isEmpty(l)&&o.getTarget(".link-text",3)))r.fireEvent("linkclick",r,l,i,this.panel);else if(r.useMark){var s=Ext.get(e).down(".je-field-markfield-view");JEMarkField.showMark(i,s,this.panel)}else if(r.usePostil){var d=this.panel.funcData.info,c=i.get(d.pkName);JE.CoreUtil.showPostil({funcCode:d.funcCode,pkValue:c,record:i})}},renderCell:function(e,t,i,a,n){var o,r,l=this,s=l.selModel,d=l.cellValues,c=d.classes,u=t.data[e.dataIndex],p=l.cellTpl;d.record=t,d.column=e,d.recordIndex=i,d.columnIndex=a,d.cellIndex=a,d.align=e.align,d.tdCls=e.tdCls,d.innerCls=e.innerCls,d.style=d.tdAttr="",d.unselectableAttr=l.enableTextSelection?"":'unselectable="on"',e.rowIndex=i,d.tdAttr=JE.buildRendererTDStyle(e),e.renderer&&e.renderer.call?(o=e.renderer.call(e.scope||l.ownerCt,u,d,t,i,a,l.dataSource,l),d.css&&(t.cssWarning=!0,d.tdCls+=" "+d.css,delete d.css)):o=u,d.value=null==o||""===o?"&#160;":o,c[1]=Ext.baseCSSPrefix+"grid-cell-"+e.getItemId(),r=2,e.tdCls&&(c[r++]=e.tdCls),l.markDirty&&t.isModified(e.dataIndex)&&(c[r++]=l.dirtyCls),e.isFirstVisible&&(c[r++]=l.firstCls),e.isLastVisible&&(c[r++]=l.lastCls),l.enableTextSelection||(c[r++]=Ext.baseCSSPrefix+"unselectable"),c[r++]=d.tdCls,s&&s.isCellSelected&&s.isCellSelected(l,i,a)&&(c[r++]=l.selectedCellCls),c.length=r,d.tdCls=c.join(" "),p.applyOut(d,n),d.column=null}},"Ext.view.TableLayout":{setColumnWidths:function(e){return!this.owner.body.dom||this.callParent(arguments)}},"Ext.grid.feature.Grouping":{onColumnMove:function(){var e,t,i,a,n,o,r=this.view.store;if(r.isGrouped())for(i=(e=r.getGroups()).length,t=0;t<i;t++)n=(a=e[t]).children[0],o=a.children[a.children.length-1],r.fireEvent("update",r,n,"edit",null),o!==n&&r.fireEvent("update",r,o,"edit",null)},groupTpl:["{%","var me = this.groupingFeature;","if (me.disabled) {","values.needsWrap = false;","} else {","me.setupRowData(values.record, values.recordIndex, values);","values.needsWrap = !me.disabled && (values.isFirstRow || values.summaryRecord);","}","%}",'<tpl if="needsWrap">','<tr data-boundView="{view.id}" data-recordId="{record.internalId}" data-recordIndex="{[values.isCollapsedGroup ? -1 : values.recordIndex]}"','class="{[values.itemClasses.join(" ")]} '+Ext.baseCSSPrefix+'grid-wrap-row<tpl if="!summaryRecord"> '+Ext.baseCSSPrefix+'grid-group-row</tpl>">','<td class="'+Ext.baseCSSPrefix+'group-hd-container" colspan="{columns.length}">','<tpl if="isFirstRow">',"{%",'var groupTitleStyle = (!values.view.lockingPartner || (values.view.ownerCt === values.view.ownerCt.ownerLockable.lockedGrid) || (values.view.lockingPartner.headerCt.getVisibleGridColumns().length === 0)) ? "" : "visibility:hidden";',"%}",'<div id="{groupId}" class="'+Ext.baseCSSPrefix+'grid-group-hd {collapsibleCls}" tabIndex="0">','<div class="'+Ext.baseCSSPrefix+'grid-group-title" style="{[groupTitleStyle]}">','{[values.groupHeaderTpl.apply(values.groupInfo, parent) || "&#160;"]}',"</div>","</div>","</tpl>",'<tpl if="summaryRecord || !isCollapsedGroup">','<table class="',Ext.baseCSSPrefix,"{view.id}-table ",Ext.baseCSSPrefix,"grid-table",'<tpl if="summaryRecord"> ',Ext.baseCSSPrefix,'grid-table-summary</tpl>"','border="0" cellspacing="0" cellpadding="0" style="width:100%">',"{[values.view.renderColumnSizer(out)]}",'<tpl if="!isCollapsedGroup">',"{%","values.itemClasses.length = 0;","this.nextTpl.applyOut(values, out, parent);","%}","</tpl>",'<tpl if="summaryRecord">',"{%me.outputSummaryRecord(values.summaryRecord, values, out);%}","</tpl>","</table>","</tpl>","</td>","</tr>","<tpl else>","{%this.nextTpl.applyOut(values, out, parent);%}","</tpl>",{priority:200,syncRowHeights:function(e,t){e=Ext.fly(e,"syncDest"),t=Ext.fly(t,"sycSrc");var i,a,n,o,r=this.owner,l=e.down(r.eventSelector,!0),s=e.down(r.summaryRowSelector,!0);l&&(i=t.down(r.eventSelector,!0))&&(l.style.height=i.style.height="",(n=l.offsetHeight)>(o=i.offsetHeight)?Ext.fly(i).setHeight(n):n<o&&Ext.fly(l).setHeight(o)),s&&(a=t.down(r.summaryRowSelector,!0))&&(s.style.height=a.style.height="",(n=s.offsetHeight)>(o=a.offsetHeight)?Ext.fly(a).setHeight(n):n<o&&Ext.fly(s).setHeight(o))},syncContent:function(e,t){e=Ext.fly(e,"syncDest"),t=Ext.fly(t,"sycSrc");var i=this.owner,a=e.down(i.eventSelector,!0),n=t.down(i.eventSelector,!0),o=e.query(i.summaryRowSelector),r=t.query(i.summaryRowSelector);a&&n&&Ext.fly(a).syncContent(n),JE.isNotEmpty(o)&&JE.isNotEmpty(r)&&Ext.each(o,function(e,t){Ext.fly(e).syncContent(r[t])})}}],populateRecord:function(e){for(var t,i,a,n=this.grid.ownerLockable?this.grid.ownerLockable.view:this.view,o=this.view.store,r=n.headerCt.getGridColumns(),l=r.length,s=1,d=[],c=0;c<s;c++){var u=e.getAggregateRecord();for(u.beginEdit(),t=0;t<l;++t){a=(i=r[t]).dataIndex||i.id;var p="";if(JE.isNotEmpty(i.summary)){var f=JE.decode(i.summary);s=f.length,p=JE.getSummary(o,e.records,i.dataIndex,!1,i,f[c].code)}u.set(a,p)}u.set("summary__index",c),u.endEdit(!0),u.commit(),d.push(u)}return e.aggregate=d,e.aggregate.isSummary=!0,d},outputSummaryRecord:function(e,t,i){var a,n,o=t.view,r=o.rowValues,l=t.columns||o.headerCt.getVisibleGridColumns(),s=l.length,d=this;for(a=0;a<s;a++)(n=l[a]).savedRenderer=n.renderer,n.summaryRenderer?n.renderer=n.summaryRenderer:n.summaryType||(n.renderer=Ext.emptyFn),n.dataIndex||(n.dataIndex=n.id);for(e=Ext.isArray(e)?e:[e],Ext.each(e,function(e){values={view:o,record:e,rowStyle:"",rowClasses:[d.summaryRowCls],itemClasses:[],recordIndex:-1,rowId:o.getRowId(e),columns:l},o.rowValues=values,o.self.prototype.rowTpl.applyOut(values,i)}),o.rowValues=r,a=0;a<s;a++)(n=l[a]).renderer=n.savedRenderer,n.savedRenderer=null}},"Ext.grid.feature.Summary":{getAllSummary:function(e,t,i,a){var n=a.records;if(t&&Ext.isFunction(t))return e.getAggregate(t,null,n,[i,!0])},renderTFoot:function(t,i){var e=t.view,a=e.findFeature("summary");a.showSummaryRow&&(i.push("<tfoot>"),Ext.each(a.createSummaryRecords(e,!1),function(e){a.outputSummaryRecord(e,t,i)}),i.push("</tfoot>"))},createSummaryRecords:function(a,n){var o=this,r=o[n?"summaryAllRecords":"summaryRecords"]=[],e=a.headerCt.getVisibleGridColumns(),l=(e.length,[]),s=[],d=[],c=[];return Ext.each(e,function(e){if(e.dataIndex||(e.dataIndex=e.id),JE.isNotEmpty(e.summary)){l.push(e),s.push(e.dataIndex);var t=JE.decode(e.summary),i=Ext.value(JE.decode(e.summaryFormat,!0),[]);Ext.each(t,function(e,t){d[t]=Ext.value(d[t],[]),d[t].push(e.code),c[t]=Ext.value(c[t],[]),c[t].push(i[t])})}}),0<l.length&&Ext.each(d,function(e,t){var i={types:e,formats:c[t],id:t,fields:s,columns:l};r.push(o.createSummaryRecord(a,n,i))}),r},createSummaryRecord:function(a,n,o){var r,e=a.headerCt.getVisibleGridColumns(),l={records:a.store.getRange()},t=(e.length,0==n?"":"All"),i=a.id+"-summary"+t+"-record-"+o.id,s=new a.store.model(null,i);return s.allRecord=0!=n,s.beginEdit(),Ext.each(o.columns,function(e,t){var i="";i=n?(Ext.isEmpty(r)&&(r=JE.getAllSummary({tableCode:a.store.proxy.extraParams.tableCode,whereSql:a.store.proxy.extraParams.whereSql,types:o.types,fields:o.fields})),r[e.dataIndex]):JE.getSummary(a.store,l.records,e.dataIndex,n,e,o.types[t]),i=isNaN(i)?0:i,s.set(e.dataIndex,i)}),s.set("summary__index",o.id),s.endEdit(!0),s.commit(!0),s.isSummary=!0,s},onStoreUpdate:function(e,t,i){var n=this,o=n.view;if(o.rendered){var a=[{name:"summaryRecords",all:!1},{name:"summaryAllRecords",all:!0}],r=[],l=[];if(0==(!(o.store.totalCount<=o.store.pageSize)&&n.useSummaryAll)&&a.pop(),e&&e.isStore&&(n.firstSummary?delete n.firstSummary:Ext.each(a,function(e){n.createSummaryRecords(o,e.all)})),Ext.each(a,function(e,i){if(Ext.isEmpty(n[e.name])&&(n.createSummaryRecords(o,e.all),n.firstSummary=!0),l[i]=[],r[i]=[],Ext.each(n[e.name],function(e,t){l[i].push(o.createRowElement(e,-1))}),0==i?n.showSummaryRow?Ext.each(n[e.name],function(e){var t=n.view.getNode(e);JE.isNotEmpty(t)&&r[i].push(t)}):0==n.useSummaryAll&&n.dock&&(r[i]=n.summaryBar.el.query("."+n.summaryRowCls)):1==i&&n.dock&&0!=n.useSummaryAll&&(r[i]=n.summaryBar.el.query("."+n.summaryRowCls)),JE.isNotEmpty(r[i])){var t=r[i][0],a=t.parentNode;Ext.each(l[i],function(e){a.insertBefore(e,t)}),Ext.each(r[i],function(e){a.removeChild(e)})}}),!Ext.isEmpty(r)){var s=n.lockingPartner;s&&s.grid.rendered&&!n.calledFromLockingPartner&&(s.calledFromLockingPartner=!0,s.onStoreUpdate(),s.calledFromLockingPartner=!1)}n.dock&&n.onColumnHeaderLayout()}},init:function(t){var i=this,a=i.view;i.superclass.init.call(i,t),i.dock&&(t.headerCt.on({afterlayout:i.onStoreUpdate,scope:i}),t.on({beforerender:function(){var e=["x-grid-table",i.summaryTableCls];a.columnLines&&(e[e.length]=a.ownerCt.colLinesCls),i.summaryBar=Ext.create("Ext.Component",{childEls:["innerCt"],gridView:t.view,renderTpl:['<div id="{id}-innerCt">','<table cellPadding="0" cellSpacing="0" class="'+e.join(" ")+'" style="table-layout: fixed;">','<tr class="'+i.summaryRowCls+'"></tr>',"</table>","</div>"],style:"overflow:hidden",itemId:"summaryBar",cls:[i.dockedSummaryCls,i.dockedSummaryCls+"-"+i.dock],xtype:"component",dock:i.dock,hidden:!0,weight:1e7}),t.addDocked(i.summaryBar)},afterrender:function(){t.body.addCls(i.panelBodyCls+i.dock),a.mon(a.el,{scroll:i.onViewScroll,scope:i}),i.onStoreUpdate()},single:!0}),t.headerCt.afterComponentLayout=Ext.Function.createSequence(t.headerCt.afterComponentLayout,function(){i.summaryBar.innerCt.setWidth(this.getFullWidth()+Ext.getScrollbarSize().width),i.summaryBar.innerCt.dom.style.paddingRight=Ext.getScrollbarSize().width+"px"})),i.showSummaryRow&&i.view.addFooterFn(i.renderTFoot),t.on({columnmove:i.onStoreUpdate,scope:i}),a.mon(a.store,{update:i.onStoreUpdate,datachanged:i.onStoreUpdate,load:function(e){var t=!(e.totalCount<=a.store.pageSize)&&i.useSummaryAll;i.summaryBar&&i.summaryBar.setVisible(t)},scope:i})}},"Ext.form.Basic":{getFields:function(){var e=this;return Ext.isEmpty(e.monitor)&&e.owner&&(e.monitor=e.owner.monitor),e.monitor&&(e.owner&&e.owner.funcData?e.monitor.selector="[isFormField][formCode="+e.owner.funcData.info.funcCode+"_form]":e.monitor.selector="[isFormField]"),e.callParent()},setValues:function(e,t){return this.callParent(arguments),this.owner&&this.owner.fireEvent("setvalues",this.owner,e,t),this},setItemsReadOnly:function(t){this.getFields().each(function(e){e.initialConfig.readOnly&&e.initialConfig.readOnly==e.readOnly||e.initialConfig.hidden||e.setReadOnly(t)})},getChanges:function(n){var o=new Ext.util.MixedCollection;return this.getFields().each(function(e){if((n||!e.isHidden())&&e.isDirty()){var t=e.getValue(),i=e.originalValue;if("uxfilefield"!=e.xtype){var a={};-1!=["cgroup","rgroup","cbbfield","yesnofield"].indexOf(e.xtype)?(a._newVal=t,a._oldVal=i,t=e.getText(t),i=e.getText(i)):"numberfield"==e.xtype&&(t=Ext.value(t,0),i=Ext.value(i,0)),t!=i&&(Ext.apply(a,{name:e.getName(),text:e.fieldLabel,newVal:t,oldVal:i,initialConfig:e.initialConfig}),o.add(a))}}}),o},doAction:function(e,t){return Ext.isString(e)&&(e=Ext.ClassManager.instantiateByAlias("formaction."+e,Ext.apply({},t,{form:this}))),!1!==this.fireEvent("beforeaction",this,e)&&(this.beforeAction(e),this.owner.funcData?e.run():Ext.defer(e.run,100,e)),this}},"Ext.layout.component.field.Trigger":{beginLayoutFixed:function(e,t,i){"100%"==e.target.width&&(t=100,i="%"),this.callParent([e,t,i])},updateEditState:function(){var e,t,i=this,a=i.owner,n=a.inputEl,o=Ext.baseCSSPrefix+"trigger-noedit";e=i.owner.readOnly?(n.addCls(o),!(t=!0)):(t=i.owner.editable?(n.removeCls(o),!1):(n.addCls(o),!0),!i.owner.hideTrigger),Ext.isEmpty(a.funcCode)?a.triggerCell.setDisplayed(e):a.triggerCell.setStyle("opacity",i.owner.readOnly?"0.5":"1"),n.dom.readOnly=t}},"Ext.form.field.Trigger":{hideTrigger1:!0,setReadOnly:function(e){var t=this;Ext.isEmpty(t.funcCode)||(t.readOnly=e,t.triggerCell&&t.triggerCell.setStyle("opacity",t.readOnly?"0.5":"1")),t.callParent(arguments),1!=t.editable&&t.inputEl&&(t.inputEl.dom.readOnly=!0)},getTriggerMarkup:function(){var e=this.hideTrigger;Ext.isEmpty(this.funcCode)&&(e=this.hideTrigger||this.readOnly);var t,i=this,a=0,n=i.triggerBaseCls,o=[],r=Ext.dom.Element.unselectableCls,l="width:"+i.triggerWidth+"px;"+(e?"display:none;":this.readOnly?"opacity:0.5;":""),s=i.extraTriggerCls+" "+Ext.baseCSSPrefix+"trigger-cell "+r;for(i.trigger1Cls||(i.trigger1Cls=i.triggerCls),a=0;(t=i["trigger"+(a+1)+"Cls"])||a<1;a++){var d="";i["hideTrigger"+(a+1)]&&(d+="display:none;"),0<i["trigger"+(a+1)+"Width"]&&(d+="width:"+i["trigger"+(a+1)+"Width"]+"px;"),o.push({tag:"td",valign:"top",cls:s,style:l+d,cn:{cls:[Ext.baseCSSPrefix+"trigger-index-"+a,n,t].join(" "),role:"button"}})}return o[0].cn.cls+=" "+n+"-first",Ext.DomHelper.markup(o)},getTriggerWidth:function(){var e=this,t=0;if(e.triggerWrap&&!e.hideTrigger&&!e.readOnly)for(var i=0;i<e.triggerEl.getCount();i++){var a=e["hideTrigger"+(i+1)],n=e["trigger"+(i+1)+"Width"];a||(t+=0<n?n:e.triggerWidth)}return t},initEvents:function(){var e=this;e.callParent(),!e.editable&&e.enableClick&&e.mon(e.inputEl,"click",function(){e.readOnly||e.disabled||JE.isNotEmpty(e.value)||e.onTrigger2Click&&e.onTrigger2Click()},e)}},"Ext.form.action.Action":{createCallback:function(){var e=this.callParent(arguments);return Ext.apply(e,{async:Ext.value(this.async,!0)})}},"Ext.data.Connection":{upload:function(n,e,t,o){var r=this;n=Ext.getDom(n),o=o||{};function i(e,t){var i=!0;s=document.createElement("input"),Ext.fly(s).set({type:"hidden",value:t,name:e});for(var a=0;a<n.length;a++)if(n[a].name==e)return void(i=!1);i&&n.appendChild(s),m.push(s)}function l(){for(f=0;f<m.length;f++)Ext.removeNode(m[f])}var s,a,d,c,u,p,f,E=Ext.id(),m=[],g="multipart/form-data",h={target:n.target,method:n.method,encoding:n.encoding,enctype:n.enctype,action:n.action};if(Ext.fly(n).set({target:E,method:"POST",enctype:g,encoding:g,action:e||h.action}),t)for(c in a=Ext.Object.fromQueryString(t)||{})if(a.hasOwnProperty(c))if(d=a[c],Ext.isArray(d))for(u=d.length,p=0;p<u;p++)i(c,d[p]);else i(c,d);var x={url:"url",type:"method",headers:"headers",async:"async",timeout:"timeout"},v={success:function(e){var t={responseText:e,responseXML:null},i=o.success;r.fireEvent("requestcomplete",r,t,o),JE.systemError(e)||(Ext.callback(i,o.scope,[t,o]),Ext.callback(o.callback,o.scope,[o,!0,t]),l())},error:function(e,t,i){var a={responseText:'{success:false,message:"'+t+'"}',responseXML:null},n=o.failure;r.fireEvent("requestcomplete",r,a,o),Ext.callback(n,o.scope,[a,o]),Ext.callback(o.callback,o.scope,[o,!1,a]),l()}};for(var y in x)x[y]&&(v[y]=o[y]);$(n).ajaxSubmit(v)}},"Ext.grid.column.Action":{defaultRenderer:function(e,t,i,a,n,o,r){var l,s,d,c,u,p=this,f=Ext.baseCSSPrefix,E=p.origScope||p,m=p.items,g=m.length,h=0;s=Ext.isFunction(p.origRenderer)&&p.origRenderer.apply(E,arguments)||"",t.tdCls+=" "+Ext.baseCSSPrefix+"action-col-cell";for(var x=[];h<g;h++){d=(l=m[h]).disabled||!!l.isDisabled&&l.isDisabled.call(l.scope||E,r,a,n,l,i),c=l.tooltip||(l.getTip?l.getTip.apply(l.scope||E,arguments):null),u=l.tooltipType||"qtip",l.hasActionConfiguration||(l.stopSelection=p.stopSelection,l.disable=Ext.Function.bind(p.disableAction,p,[h],0),l.enable=Ext.Function.bind(p.enableAction,p,[h],0),l.hasActionConfiguration=!0);var v=Ext.value(l.style,""),y=l.getStyle||p.getItemStyle;y&&(Ext.isString(y)&&(y=JE.eval(y)),v=y.apply(l.scope||E,arguments)||v),p.funcColumn&&JE.isNotEmpty(c)&&JE.isEmpty(l.icon)&&JE.isEmpty(l.iconCls)?(v+=l.fontStyle||l.iconStyle,x.push('<div style="'+v+'" class="'+f+"action-col-text "+f+"action-col-"+String(h)+" "+(d?f+"item-disabled":" ")+" je-button-actioncolumn "+(Ext.isFunction(l.getClass)?l.getClass.apply(l.scope||E,arguments):"")+'" >'+c+"</div>")):(c=d?null:c,JE.isNotEmpty(l.icon)&&(v+="background-image:url("+l.icon+")"),JE.isNotEmpty(l.iconStyle)&&(v+=l.iconStyle),x.push('<div role="button" alt="'+(l.altText||p.altText)+'" style="'+v+'" class="'+f+"action-col-icon "+f+"action-col-"+String(h)+" "+(d?f+"item-disabled":" ")+" "+(Ext.isFunction(l.getClass)?l.getClass.apply(l.scope||E,arguments):l.iconCls||p.iconCls||"")+'"'+(c?("title"==u?" title":" data-qtip")+'="'+c+'"':"")+" ></div>"))}return s+=x.join('<div class="x-action-col-split" style="color:#AAAAAA">'+(p.splitStr||"|")+"</div>","")}},"Ext.grid.header.Container":{getMenuItems:function(){var e=this.callParent(arguments);return e.push("-"),e.push({itemId:"updateItem",text:JE.local.lang.core.util.OverrideUtil.gridHeaderUpdateItem,iconCls:"jeicon jeicon-form-editing",handler:this.onUpdateItemClick,scope:this}),e},onUpdateItemClick:function(){var e=this.getMenu().activeHeader;e.updateColumnData&&e.updateColumnData()},showMenuBy:function(e,t){var i,a,n=this.getMenu(),o=n.down("#ascItem"),r=n.down("#descItem"),l=n.down("#updateItem"),s=n.down("#groupMenuItem"),d=n.down("#groupToggleMenuItem");n.activeHeader=n.ownerButton=t,t.setMenuActive(!0),i=t.sortable?"enable":"disable",o&&o[i](),r&&r[i]();var c=!1;this.grid.funcData?c=this.grid.readOnly:this.grid.ownerCt&&this.grid.ownerCt.funcData&&(c=this.grid.ownerCt.readOnly),a=(this.grid.updateButton||1!=c)&&t.enableUpdate&&"actioncolumn"!=t.xtype?"show":"hide",l&&(l.previousSibling()[a](),l[a]()),s&&s[t.enableGroup?"show":"hide"](),d&&d[!Ext.isEmpty(this.view.store.groupField)?"enable":"disable"]();n.showBy(e)}},"Ext.menu.Item":{initComponent:function(){this.addEvents("beforeclick"),this.callParent(arguments)},onClick:function(e){var t=this,i=t.clickHideDelay;t.href||e.stopEvent(),t.disabled||(t.hideOnClick&&(i?t.deferHideParentMenusTimer=Ext.defer(t.deferHideParentMenus,i,t):t.deferHideParentMenus()),!1!==t.fireEvent("beforeclick",t,e)&&(Ext.callback(t.handler,t.scope||t,[t,e]),t.fireEvent("click",t,e),t.hideOnClick||t.focus()))},renderTpl:['<tpl if="plain">',"{text}","<tpl else>",'<a id="{id}-itemEl"',' class="'+Ext.baseCSSPrefix+'menu-item-link{childElCls}"',' href="{href}"','<tpl if="hrefTarget"> target="{hrefTarget}"</tpl>',' hidefocus="true"',' unselectable="on"','<tpl if="tabIndex">',' tabIndex="{tabIndex}"',"</tpl>",">",'<div role="img" id="{id}-iconEl" class="'+Ext.baseCSSPrefix+"menu-item-icon {iconCls}",'{childElCls} {glyphCls}" style="<tpl if="icon">background-image:url({icon});</tpl> <tpl if="iconStyle">{iconStyle}</tpl>','<tpl if="glyph && glyphFontFamily">font-family:{glyphFontFamily};</tpl>">','<tpl if="glyph">&#{glyph};</tpl>',"</div>",'<span id="{id}-textEl" class="'+Ext.baseCSSPrefix+'menu-item-text" unselectable="on">{text}</span>','<img id="{id}-arrowEl" src="{blank}" class="{arrowCls}','{childElCls}"/>',"</a>","</tpl>"],beforeRender:function(){this.callParent(arguments),this.renderData.iconStyle=this.iconStyle}},"Ext.button.Button":{initComponent:function(){this.addEvents("beforeclick","afterclick"),this.callParent(arguments)},fireHandler:function(e){var t=this,i=t.handler;JE.doButtonLog(t),!1!==t.fireEvent("beforeclick",t,e)&&!1!==t.fireEvent("click",t,e)&&(i&&i.call(t.scope||t,t,e),0!=t.allowAfterClick&&t.fireEvent("afterclick",t,e))},renderTpl:['<span id="{id}-btnWrap" class="{baseCls}-wrap','<tpl if="splitCls"> {splitCls}</tpl>','{childElCls}" unselectable="on">','<span id="{id}-btnEl" class="{baseCls}-button">','<span id="{id}-btnInnerEl" class="{baseCls}-inner {innerCls}','{childElCls}" style="{textStyle}" unselectable="on">',"{text}","</span>",'<span role="img" id="{id}-btnIconEl" class="{baseCls}-icon-el {iconCls}','{childElCls} {glyphCls}" unselectable="on" style="{iconStyle}','<tpl if="iconUrl">background-image:url({iconUrl});</tpl>','<tpl if="glyph && glyphFontFamily">font-family:{glyphFontFamily};</tpl>">','<tpl if="glyph">&#{glyph};</tpl>',"</span>","</span>","</span>",'<tpl if="closable">','<span id="{id}-closeEl" class="{baseCls}-close-btn" title="{closeText}" tabIndex="0"></span>',"</tpl>"],getTemplateArgs:function(){var e=this.callParent(arguments);return e.textStyle=Ext.value(this.textStyle,""),e.iconStyle=Ext.value(this.iconStyle,""),e}},"Ext.tab.Panel":{initComponent:function(){var e=this,t=" je-tabpanel-body";if(e.bodyCls=Ext.isEmpty(e.bodyCls)?t:e.bodyCls+t,-1!=["top","bottom"].indexOf(e.tabPosition)){e.tabBar=Ext.value(e.tabBar,{}),e.tabBar.defaults=Ext.value(e.tabBar.defaults,{});var i=Ext.value(e.tabBar.height,34);Ext.apply(e.tabBar,{height:e.plain?i-2:i}),Ext.apply(e.tabBar.defaults,{height:Ext.value(e.tabBar.defaults.height,i-4)})}e.callParent(arguments)},setItemVisible:function(e,t,i){var a=this;if(1==a.tabBar.hidden)a.setVisible(t);else{var n,o=e;t||(n=e.tab.next("tab[hidden=false]")||e.tab.prev("tab[hidden=false]"))&&(o=n.card),e.tab.setVisible(t),i&&("first"==i?a.items.each(function(e){if(!e.tab.isHidden())return o=e,!1}):i.ownerCt==a&&(o=i)),a.setActiveTab(o),t?a.isHidden()&&a.show():n||a.hide()}}},"Ext.grid.CellEditor":{alignment:"tl-tl?"},"Ext.form.field.HtmlEditor":{fontFamilies:["黑体","微软雅黑","宋体","楷体","幼圆"]},"Ext.grid.plugin.CellEditing":{beforeEdit:function(e){if(this.disabled)return!1;var t=e.column;return t?t.fireEvent("beforeedit",t,e):void 0},onEditComplete:function(e,t,i){var a,n=this,o=n.getActiveColumn(),r=n.context;if(o){if(a=r.record,n.setActiveEditor(null),n.setActiveColumn(null),n.setActiveRecord(null),r.value=t,!n.validateEdit())return;a.isEqual(t,i)||a.set(o.dataIndex,t),r.view.focus(!1,!0),o.fireEvent("edit",o,r),n.fireEvent("edit",n,r),n.editing=!1}},showEditor:function(e,t,i){var a=this,n=t.record,o=t.column,r=a.grid.getSelectionModel(),l=r.getCurrentPosition();l&&l.view;a.setEditingContext(t),a.setActiveEditor(e),a.setActiveRecord(n),a.setActiveColumn(o),!r.selectByPosition||l&&l.column===t.colIdx&&l.row===t.rowIdx||r.selectByPosition({row:t.rowIdx,column:t.colIdx,view:a.view}),e.alignment="c-c",e.startEdit(a.getCell(n,o),i,t),a.editing=!0,a.scroll=a.view.el.getScroll()}},"Ext.tree.View":{treeRowTpl:["{%","this.processRowValues(values);","this.nextTpl.applyOut(values, out, parent);",'delete values.rowAttr["data-qtip"];','delete values.rowAttr["data-qtitle"];',"%}",{priority:10,processRowValues:function(e){var t=e.record,i=e.view,a=t.get("qtip"),n=t.get("qtitle");e.rowAttr={},n?e.rowAttr.title=n:a&&(e.rowAttr["data-qtip"]=a),t.isExpanded()&&e.rowClasses.push(i.expandedCls),t.isLeaf()&&e.rowClasses.push(i.leafCls),t.isLoading()&&e.rowClasses.push(i.loadingCls)}}],refresh:function(){var e=this;if(e.callParent(arguments),e.el&&!e.all.getCount()&&e.headerCt&&e.headerCt.tooNarrow){var t=e.el.child("div");t&&t.remove()}},treeCheckNodeCls:function(e,t){var i=this,a=i.indexOf(e);t?(i.getSelectionModel().selected.add(e),i.addRowCls(a,i.selectedItemCls)):(i.getSelectionModel().selected.remove(e),i.removeRowCls(a,[i.selectedItemCls,i.focusedItemCls]))},setNodeChecked:function(e,t){var i=Ext.get(this.getNode(e));if(e.data.checked=t,i){var a=i.down(".x-tree-checkbox");a&&a[t?"addCls":"removeCls"](Ext.baseCSSPrefix+"tree-checkbox-checked")}},eachChild:function(e,t){var i=this;e.expand(!1,function(){e.eachChild(function(e){null!==e.get("checked")&&(i.setNodeChecked(e,t),i.treeCheckNodeCls(e,t)),i.eachChild(e,t)})})},eachParent:function(e,t){e.isRoot()||1!=t||(Ext.isEmpty(e.get("checked"))||(this.setNodeChecked(e,t),this.treeCheckNodeCls(e,t)),this.eachParent(e.parentNode,t))},deselectParent:function(e){var t=e.parentNode;if(!this.panel.type&&t&&!t.isRoot()&&"ROOT"==t.get("parent")){var i=!1;t.eachChild(function(e){if(1==e.get("checked"))return!(i=!0)}),i||this.getSelectionModel().deselect(t)}},onRowSelect:function(e,t){var i=this,a=i.panel;if(i.callParent(arguments),1==a.funcTree){var n=i.getRecord(i.getNode(e));n&&null!=n.get("checked")&&(i.setNodeChecked(n,!0),t||("T"!=a.selectType&&"A"!=a.selectType||i.eachChild(n,!0),"D"!=a.selectType&&"A"!=a.selectType||i.eachParent(n,!0)))}},onRowDeselect:function(e,t){var i=this,a=i.panel;if(i.callParent(arguments),1==a.funcTree){var n=i.getRecord(i.getNode(e));n&&null!=n.get("checked")&&(i.setNodeChecked(n,!1),t||("T"!=a.selectType&&"A"!=a.selectType||i.eachChild(n,!1),i.deselectParent(n)))}},afterRender:function(){var e=this;e.callParent(arguments),1==e.panel.funcTree&&e.el.un("click",e.onCheckboxChange,e)}},"Ext.grid.plugin.HeaderResizer":{onHeaderCtMouseMove:function(e,t){var i,a,n,o,r,l,s=this;s.headerCt.dragging?s.activeHd&&(s.activeHd.el.dom.style.cursor="",delete s.activeHd):(a=e.getTarget("."+s.colHeaderCls,10,!0))&&((n=Ext.getCmp(a.id)).isOnLeftEdge(e)?(o=n.previousNode("gridcolumn:not([hidden]):not([isGroupHeader])"))&&(l=s.headerCt.up("tablepanel"),(r=o.up("tablepanel"))===l||l.ownerCt.isXType("tablepanel")&&l.ownerCt.view.lockedGrid===r||(o=null)):o=n.isOnRightEdge(e)?n:null,o?(o.isGroupHeader&&(o=(i=o.getGridColumns())[i.length-1]),!o||o.fixed||!1===o.resizable||s.disabled||(s.activeHd=o,n.el.dom.style.cursor=s.eResizeCursor,n.triggerEl&&(n.triggerEl.dom.style.cursor=s.eResizeCursor))):(n.el.dom.style.cursor="",n.triggerEl&&(n.triggerEl.dom.style.cursor=""),s.activeHd=null))}},"Ext.data.PageMap":{getRange:function(e,t){return Ext.isNumber(e)&&Ext.isNumber(t)&&(e<0&&(e=0),t<0&&(t=0)),this.callParent(arguments)}},"Ext.selection.Model":{getSelection:function(){var e=this.callParent(arguments),n=this.store,o=[];return Ext.each(e,function(e){var t;if(n.treeStore)t=n.treeStore.tree.nodeHash[e.internalId];else if(n.buffered){var i=parseInt(e.index/n.pageSize)+1,a=e.index%n.pageSize;t=n.data.get(i)[a]}else t=n.data.get(e.internalId);t&&o.push(t)}),o}},"Ext.container.AbstractContainer":{getCmp:function(e){return this.getComponent(e)}},"Ext.panel.Panel":{getDockedCmp:function(e){return this.getDockedComponent(e)}},"Ext.Component":{initComponent:function(){this.addEvents("boxrefresh"),this.callParent(arguments)},update:function(){this.callParent(arguments),this.getEl()&&this.fireEvent("boxrefresh",this)},onKeyDown:function(e){var t,i,a,n;if(e.getKey()==Ext.EventObject.TAB&&(t=e.shiftKey,a=(i=this.el.query(":focusable"))[0],n=i[i.length-1],a&&n&&e.target===(t?a:n))){e.stopEvent();try{(t?n:a).focus(!1,!0)}catch(e){console.log(e.message)}}}},"Ext.layout.component.field.Field":{beginLayoutFixed:function(e,t,i){t+i=="100%"&&(i=t="");this.callParent([e,t,i])},labelStrategies:function(){var e={prepare:function(e,t){var i=t.labelCls+"-"+t.labelAlign,a=t.labelEl;a&&a.addCls(i)},getHeight:function(){return 0},finishedLayout:Ext.emptyFn};return{base:e,top:Ext.applyIf({getHeight:function(e){var t=e.labelContext,i=t.props,a=i.height;return void 0===a&&(i.height=a=t.el.parent().getHeight()),a}},e),left:e,right:e}}()},"Ext.form.CheckboxGroup":{containerElCls:"checkboxgroup-container"},"Ext.form.field.Checkbox":{fieldSubTpl:["<tpl if=\"iconCls && (iconAlign=='left' || iconAlign=='top')\">",'<div class="{iconCls} x-form-cb-iconcls <tpl if="iconAlign==\'top\'">top</tpl>"></div>',"</tpl>","<tpl if=\"boxLabel && boxLabelAlign == 'before'\">","{beforeBoxLabelTpl}",'<label id="{cmpId}-boxLabelEl" {boxLabelAttrTpl} class="{boxLabelCls} {boxLabelCls}-{boxLabelAlign}" for="{id}">',"{beforeBoxLabelTextTpl}","{boxLabel}","{afterBoxLabelTextTpl}","</label>","{afterBoxLabelTpl}","</tpl>",'<div type="{inputTypeAttr}" id="{id}" {inputAttrTpl}','<tpl if="tabIdx"> tabIndex="{tabIdx}"</tpl>','<tpl if="disabled"> disabled="disabled"</tpl>','<tpl if="fieldStyle"> style="{fieldStyle}"</tpl>','<tpl if="ariaAttrs"> {ariaAttrs}</tpl>',' class="{fieldCls} {typeCls} {inputCls} {childElCls}" autocomplete="off" hidefocus="true" ></div>',"<tpl if=\"boxLabel && boxLabelAlign == 'after'\">","{beforeBoxLabelTpl}",'<label id="{cmpId}-boxLabelEl" {boxLabelAttrTpl} class="{boxLabelCls} {boxLabelCls}-{boxLabelAlign}" for="{id}">',"{beforeBoxLabelTextTpl}","{boxLabel}","{afterBoxLabelTextTpl}","</label>","{afterBoxLabelTpl}","</tpl>","<tpl if=\"iconCls && (iconAlign=='right' || iconAlign=='bottom')\">","<tpl if=\"iconAlign=='bottom'\">","</br>","</tpl>",'<div class="{iconCls} x-form-cb-iconcls" ></div>',"</tpl>",{disableFormats:!0,compiled:!0}],subTplInsertions:["beforeBoxLabelTpl","afterBoxLabelTpl","beforeBoxLabelTextTpl","afterBoxLabelTextTpl","boxLabelAttrTpl","inputAttrTpl","iconAlign","iconCls"],afterRender:function(){var e=this;e.callParent(arguments),e.boxLabelEl&&"switch"!=e.inputType&&e.boxLabelEl.on("click",e.onBoxClick,e)}}},init:function(){var me=this;Ext.iterate(me.obj,function(key,val){Ext.override(eval(key),val)});var field={initComponent:function(){var i=this;if(i.addEvents("setvalue","linkclick","labellinkclick"),"numberfield"==i.xtype&&1!=i.hideTrigger&&(i.clearButton=!1),0!=i.clearButton&&"text"==i.inputType&&(i.plugins=["clearbutton"],"textfield"!=i.xtype&&"textarea"!=i.xtype||!i.column||delete i.plugins),JE.isNotEmpty(i.unitListTpl)&&(i.unitListTpl=Ext.isString(i.unitListTpl)?JE.decode(i.unitListTpl):i.unitListTpl,Ext.each(i.unitListTpl,function(e){e.id=e.id||JE.uuid()})),JE.isNotEmpty(i.labelColor)&&(i.labelStyle=Ext.value(i.labelStyle,"")+"color:"+i.labelColor+";"),JE.isNotEmpty(i.fieldColor)&&(i.fieldStyle=Ext.value(i.fieldStyle,"")+"color:"+i.fieldColor+";"),!Ext.isEmpty(i.regex)&&Ext.isString(i.regex))try{i.regex=new RegExp(i.regex)}catch(e){JE.error("NaN字段:"+i.fieldLabel+"("+i.name+")</br>正则表达式:"+i.regex)}"textarea"==i.xtype&&(i.height=Ext.value(i.height,80),i.useFieldContainer&&JE.isNotEmpty(i.fieldLabel)&&"top"==i.labelAlign&&(i.height-="plus"==JE.getTheme()?34:28)),i.callParent(),Ext.isIE&&"fieldset"!=i.xtype&&i.on("resize",function(){var e=i.getEl().down(".je-field-label");-1!=["left","right"].indexOf(i.labelAlign)&&e&&e.setStyle("height",e.parent().getBox().height+"px");var t=i.getEl().down(".je-field-unittpl .unittpl-inner");t&&t.setStyle("height",t.parent().getBox().height+"px")})},setRawValue:function(){this.callParent(arguments),this.fireEvent("setvalue",this,this.value)},dirtyCls:Ext.baseCSSPrefix+"form-dirty",onDirtyChange:function(e){this.inputEl&&!this.isHidden()&&1==this.useDirty&&this.inputEl[e?"addCls":"removeCls"](this.dirtyCls)},setReadOnly:function(e){"x-form-field-notop"==this.fieldCls&&this.inputEl&&this.inputEl[e?"addCls":"removeCls"]("x-form-field-bottom"),this.callParent(arguments)},setAllowBlank:function(e,t){var i=this;i.allowBlank=e,0!=t&&i.validate&&i.validate();var a=i.getEl();i.useFieldContainer&&(a=i.ownerCt.getEl()),a[0==e?"addCls":"removeCls"]("je-field-required")},labelableRenderTpl:["<tpl if=\"labelAlign=='top'\">",'<tr role="presentation" class="{inputRowCls}">','<td role="presentation" class="je-field-label-top" colspan="2" id="{id}-labelCell" style="{labelCellStyle}" {labelCellAttrs}>',"{beforeLabelTpl}",'<div class="je-field-label" role="presentation" id="{id}-labelCell" style="{labelCellStyle}">','<label id="{id}-labelEl" {labelAttrTpl}<tpl if="bindLabel"><tpl if="inputId"> for="{inputId}"</tpl></tpl> class="{labelCls}"','<tpl if="labelStyle"> style="{labelStyle}"</tpl>',' unselectable="on"',">","{beforeLabelTextTpl}",'<tpl if="helpTpl"><i class="je-field-helptpl jeicon jeicon-question-circle"></i></tpl>','<tpl if="allowBlank==false"><span class="je-field-required-tpl"></span></tpl>','<tpl if="fieldLabel">{fieldLabel}<span class="je-field-label-separator">{labelSeparator}</span></tpl>',"{afterLabelTextTpl}","</label>","</div>","{afterLabelTpl}","</td>","{[this.getUnitTplTd(values)]}","</tr>","</tpl>",'<tr role="presentation" id="{id}-inputRow" <tpl if="inFormLayout">id="{id}"</tpl> class="{inputRowCls}">','<tpl if="labelOnLeft">','<td role="presentation" id="{id}-labelCell" style="{labelCellStyle}" {labelCellAttrs}>',"{beforeLabelTpl}",'<div class="je-field-label">','<label id="{id}-labelEl" {labelAttrTpl}<tpl if="bindLabel"><tpl if="inputId"> for="{inputId}"</tpl></tpl> class="{labelCls}"','<tpl if="labelStyle"> style="{labelStyle}"</tpl>',' unselectable="on"',">","{beforeLabelTextTpl}",'<tpl if="helpTpl"><i class="je-field-helptpl jeicon jeicon-question-circle"></i></tpl>','<tpl if="allowBlank==false"><span class="je-field-required-tpl"></span></tpl>','<tpl if="fieldLabel">{fieldLabel}<span class="je-field-label-separator">{labelSeparator}</span></tpl>',"{afterLabelTextTpl}","</label>","</div>","{afterLabelTpl}","</td>","</tpl>",'<td {fieldTdAttr} style = "{fieldBodyStyle}" role="presentation" class="{baseBodyCls} {fieldBodyCls} {extraFieldBodyCls} <tpl if="labelAlign==\'top\' && !hideLabel">je-field-label-top</tpl>"  id="{id}-bodyEl" colspan="{bodyColspan}" role="presentation">',"{beforeBodyEl}","{beforeSubTpl}","{[values.$comp.getSubTplMarkup(values)]}","{afterSubTpl}","<tpl if=\"msgTarget==='side'\">","{afterBodyEl}","</td>","<td role=\"presentation\" id=\"{id}-sideErrorCell\" vAlign=\"{[values.labelAlign==='top' && !values.hideLabel ? 'bottom' : 'middle']}\" style=\"{[values.autoFitErrors ? 'display:none' : '']}\" width=\"{errorIconWidth}\">",'<div role="presentation" id="{id}-errorEl" class="{errorMsgCls}" style="display:none"></div>',"</td>","<tpl elseif=\"msgTarget=='under'\">",'<div role="presentation" id="{id}-errorEl" class="{errorMsgClass}" colspan="2" style="display:none"></div>',"{afterBodyEl}","</td>","</tpl>",'<tpl if="unitListTpl">',"{% ","var width = 0,tpls=[],fieldId=values.id;","Ext.each(values.unitListTpl,function(obj){","\tif(JE.isNotEmpty(obj.text)){",'\tvar style="";',"\tif(JE.isNotEmpty(obj.handler)){",'\t\tstyle+="color: blue;cursor: pointer;";',"\t}","\tif(JE.isNotEmpty(obj.color)){",'\t\tstyle+="color:"+obj.color+";";',"\t}",'\tif(obj.bold == "1"){','\t\tstyle+="font-weight:bold;";',"\t}",'\tvar span = "<span id=\'"+fieldId+"_"+obj.id+"\' style=\'"+style+"\'>"+obj.text+"</span>";',"\ttpls.push(span);","   var _width = obj.text.strLen()*7;","\tif(JE.toNum(obj.width)>0){_width = JE.toNum(obj.width);}","   width += _width+7;","\t}","});","%}","{% ","if(width>0){%}",'<td class="je-field-unittpl" width = {[width]} ><div class="unittpl-inner" style="{unitTplStyle}">{[tpls.join("&nbsp;")]}</div></td>',"{%}%}",'<tpl elseif="unitTpl">',"{% ","var length = values.unitTpl.strLen(),width = length*7+(length<5?10:0);","if(values.unitTplWidth>0){width = values.unitTplWidth;}","%}",'<td class="je-field-unittpl" width = {[width]}><div class="unittpl-inner" style="{unitTplStyle}">{unitTpl}</div></td>',"</tpl>","</tr>",{disableFormats:!0,getUnitTplTd:function(e){var i=0;if(JE.isNotEmpty(e.unitListTpl))Ext.each(e.unitListTpl,function(e){if(JE.isNotEmpty(e.text)){var t=7*e.text.strLen();0<JE.toNum(e.width)&&(t=JE.toNum(e.width)),i+=t+7}});else if(e.unitTpl){var t=e.unitTpl.strLen();i=7*t+(t<5?10:0)}return 0<i?'<td width="'+i+'"></td>':""}}],getLabelableRenderData:function(){var e=this,t=e.callParent();return t.labelCellStyle+=Ext.value(e.labelBodyStyle,""),t.fieldBodyStyle=Ext.value(e.fieldBodyStyle,""),t.fieldTdAttr=Ext.value(e.fieldTdAttr,""),t.bindLabel=Ext.value(e.bindLabel,!1),t.helpTpl=Ext.value(e.helpTpl,""),JE.isNotEmpty(e.unitTpl)&&(t.unitTpl=Ext.value(e.unitTpl,""),t.unitTplWidth=JE.toNum(e.unitTplWidth),t.unitTplStyle=Ext.value(e.unitTplStyle,""),JE.isNotEmpty(e.unitTplHandler)&&(t.unitTplStyle+="cursor: pointer;")),JE.isNotEmpty(e.unitListTpl)&&(t.unitListTpl=e.unitListTpl),t},afterRender:function(){var t=this;if(t.callParent(),t.funcId&&"fieldcontainer"!=t.xtype&&(t.formObj=t.up("jeformview")),t.inputEl){var e=t.inputEl.dom;"TEXTAREA"===e.nodeName&&e.addEventListener&&(JE.loadScript("/static/ux/tabIndent.js"),tabIndent.render(t.inputEl.dom)),t.hasListener("linkclick")&&("TEXTAREA"===e.nodeName||"INPUT"===e.nodeName&&"text"==e.getAttribute("type"))&&(t.inputEl.setStyle({textDecoration:"underline",color:"blue",cursor:"pointer"}),t.inputEl.on("click",function(){t.fireEvent("linkclick",t)}))}t.hideLabel&&t.getEl().addCls("je-field-hidelabel"),t.labelEl&&(t.hideLabelText&&t.labelEl.addCls("je-field-hidelabeltext"),t.hasListener("labellinkclick")&&(t.labelEl.setStyle({textDecoration:"underline",color:"blue",cursor:"pointer"}),t.labelEl.on("click",function(){t.fireEvent("labellinkclick",t)})),"top"!=t.labelAlign&&t.getEl().hasCls("je-field-tablestyle")&&t.on("boxready",function(e){var t=e.labelEl.parent(),i=t.parent();t.setHeight(i.getHeight())}),JE.isNotEmpty(t.helpTpl)&&t.labelEl.on("click",function(e){e.getTarget(".je-field-helptpl",1)&&(t.hasListener("fieldhelp")?t.fireEvent("fieldhelp",t):JE.win({title:t.fieldLabel,width:660,height:400,buttonAlign:"center",autoScroll:!0,bodyStyle:"line-height:1.5;",html:t.helpTpl.replaceAll("\n","<br/>"),bodyPadding:"10",buttons:[{text:"关闭",cls:"btn JEPLUS_B_L10",width:100,handler:function(e){e.up("window").close()}}],autoShow:!0}),e.stopEvent())})),t.setAllowBlank&&t.setAllowBlank(t.allowBlank,!1),JE.isNotEmpty(t.unitListTpl)?Ext.each(t.unitListTpl,function(e){JE.isNotEmpty(e.handler)&&Ext.get(t.id+"_"+e.id).on("click",function(){e.readOnly&&t.readOnly||JE.eval(e.handler)(t)})}):JE.isNotEmpty(t.unitTpl)&&(t.unitTplEl=t.getEl().down(".je-field-unittpl .unittpl-inner"),JE.isNotEmpty(t.unitTplHandler)&&t.unitTplEl.on("click",function(){t.unitTplHandler(t)})),(JE.isNotEmpty(t.unitListTpl)||JE.isNotEmpty(t.unitTpl))&&t.on("boxready",function(e){var t=e.getEl().down(".je-field-unittpl .unittpl-inner");if(t){var i=t.parent();t.setHeight(i.getHeight()),i.prev().addCls("je-field-unittpl-prev")}})},commitChange:function(){this.resetOriginalValue()},reset:function(){var e=this;e.beforeReset(),e.setValue(JE.toDefVal(e.initialConfig.value)),e.clearInvalid(),delete e.wasValid},childEls:["labelCell","labelEl","bodyEl","sideErrorCell","errorEl","inputRow","requiredEl"]};Ext.override(Ext.form.field.Base,field),field.childEls=["containerEl","requiredEl"],delete field.initComponent,delete field.setValue,delete field.commitChange,field.initComponent=function(){var i=this;JE.isNotEmpty(i.labelColor)&&(i.labelStyle=Ext.value(i.labelStyle,"")+"color:"+i.labelColor+";"),JE.isNotEmpty(i.fieldColor)&&(i.fieldStyle=Ext.value(i.fieldStyle,"")+"color:"+i.fieldColor+";"),JE.isNotEmpty(i.unitListTpl)&&(i.unitListTpl=Ext.isString(i.unitListTpl)?JE.decode(i.unitListTpl):i.unitListTpl,Ext.each(i.unitListTpl,function(e){e.id=e.id||JE.uuid()})),i.callParent(),Ext.isIE&&"fieldset"!=i.xtype&&i.on("resize",function(){var e=i.getEl().down(".je-field-label");-1!=["left","right"].indexOf(i.labelAlign)&&e&&e.setStyle("height",e.parent().getBox().height+"px");var t=i.getEl().down(".je-field-unittpl .unittpl-inner");t&&t.setStyle("height",t.parent().getBox().height+"px")})},Ext.override(Ext.form.FieldContainer,field),String.prototype.strLen=function(){for(var e=0,t=0;t<this.length;t++)255<this.charCodeAt(t)||this.charCodeAt(t)<0?e+=2:e++;return e},autoAddEllipsis=function(e,t){var i=cutString(e,t),a=i.cutflag,n=i.cutstring;return"1"==a?n+"...":n},cutString=function(e,t){var i,a=e.length,n="1",o=0,r=!1;if(a<=t/2&&(i=e,r=!0),!r)for(var l=0;l<a;l++){if(isFull(e.charAt(l))?o+=2:o+=1,t<o){i=e.substring(0,l),r=!0;break}if(o==t){i=e.substring(0,l+1),r=!0;break}}return r||(i=e,r=!0),i.length==a&&(n="0"),{cutstring:i,cutflag:n}},isFull=function(e){return 128<e.charCodeAt(0)},String.prototype.ellipsis=function(e){return autoAddEllipsis(this,2*e)},String.prototype.replaceAll=function(e,t){return this.replace(new RegExp(e,"gm"),t)},String.prototype.trim=function(){return this.replace(/(^\s*)|(\s*$)/g,"")},String.prototype.ltrim=function(){return this.replace(/(^\s*)/g,"")},String.prototype.rtrim=function(){return this.replace(/(\s*$)/g,"")},Array.prototype.indexOf=function(e){for(var t=-1,i=0;i<this.length;++i)this[i]==e&&(t=i);return t}}}),Ext.define("JE.util.PinYinUtil",{toPinYin:function(e,t){if(!e)return"";for(var i={a:"啊阿锕",ai:"埃挨哎唉哀皑癌蔼矮艾碍爱隘诶捱嗳嗌嫒瑷暧砹锿霭",an:"鞍氨安俺按暗岸胺案谙埯揞犴庵桉铵鹌顸黯",ang:"肮昂盎",ao:"凹敖熬翱袄傲奥懊澳坳拗嗷噢岙廒遨媪骜聱螯鏊鳌鏖",ba:"芭捌扒叭吧笆八疤巴拔跋靶把耙坝霸罢爸茇菝萆捭岜灞杷钯粑鲅魃",bai:"白柏百摆佰败拜稗薜掰鞴",ban:"斑班搬扳般颁板版扮拌伴瓣半办绊阪坂豳钣瘢癍舨",bang:"邦帮梆榜膀绑棒磅蚌镑傍谤蒡螃",bao:"苞胞包褒雹保堡饱宝抱报暴豹鲍爆勹葆宀孢煲鸨褓趵龅",bo:"剥薄玻菠播拨钵波博勃搏铂箔伯帛舶脖膊渤泊驳亳蕃啵饽檗擘礴钹鹁簸跛",bei:"杯碑悲卑北辈背贝钡倍狈备惫焙被孛陂邶埤蓓呗怫悖碚鹎褙鐾",ben:"奔苯本笨畚坌锛",beng:"崩绷甭泵蹦迸唪嘣甏",bi:"逼鼻比鄙笔彼碧蓖蔽毕毙毖币庇痹闭敝弊必辟壁臂避陛匕仳俾芘荜荸吡哔狴庳愎滗濞弼妣婢嬖璧贲畀铋秕裨筚箅篦舭襞跸髀",bian:"鞭边编贬扁便变卞辨辩辫遍匾弁苄忭汴缏煸砭碥稹窆蝙笾鳊",biao:"标彪膘表婊骠飑飙飚灬镖镳瘭裱鳔",bie:"鳖憋别瘪蹩鳘",bin:"彬斌濒滨宾摈傧浜缤玢殡膑镔髌鬓",bing:"兵冰柄丙秉饼炳病并禀邴摒绠枋槟燹",bu:"捕卜哺补埠不布步簿部怖拊卟逋瓿晡钚醭",ca:"擦嚓礤",cai:"猜裁材才财睬踩采彩菜蔡",can:"餐参蚕残惭惨灿骖璨粲黪",cang:"苍舱仓沧藏伧",cao:"操糙槽曹草艹嘈漕螬艚",ce:"厕策侧册测刂帻恻",ceng:"层蹭噌",cha:"插叉茬茶查碴搽察岔差诧猹馇汊姹杈楂槎檫钗锸镲衩",chai:"拆柴豺侪茈瘥虿龇",chan:"搀掺蝉馋谗缠铲产阐颤冁谄谶蒇廛忏潺澶孱羼婵嬗骣觇禅镡裣蟾躔",chang:"昌猖场尝常长偿肠厂敞畅唱倡伥鬯苌菖徜怅惝阊娼嫦昶氅鲳",chao:"超抄钞朝嘲潮巢吵炒怊绉晁耖",che:"车扯撤掣彻澈坼屮砗",chen:"郴臣辰尘晨忱沉陈趁衬称谌抻嗔宸琛榇肜胂碜龀",cheng:"撑城橙成呈乘程惩澄诚承逞骋秤埕嵊徵浈枨柽樘晟塍瞠铖裎蛏酲",chi:"吃痴持匙池迟弛驰耻齿侈尺赤翅斥炽傺墀芪茌搋叱哧啻嗤彳饬沲媸敕胝眙眵鸱瘛褫蚩螭笞篪豉踅踟魑",chong:"充冲虫崇宠茺忡憧铳艟",chou:"抽酬畴踌稠愁筹仇绸瞅丑俦圳帱惆溴妯瘳雠鲋",chu:"臭初出橱厨躇锄雏滁除楚础储矗搐触处亍刍憷绌杵楮樗蜍蹰黜",chuan:"揣川穿椽传船喘串掾舛惴遄巛氚钏镩舡",chuang:"疮窗幢床闯创怆",chui:"吹炊捶锤垂陲棰槌",chun:"春椿醇唇淳纯蠢促莼沌肫朐鹑蝽",chuo:"戳绰蔟辶辍镞踔龊",ci:"疵茨磁雌辞慈瓷词此刺赐次荠呲嵯鹚螅糍趑",cong:"聪葱囱匆从丛偬苁淙骢琮璁枞",cu:"凑粗醋簇猝殂蹙",cuan:"蹿篡窜汆撺昕爨",cui:"摧崔催脆瘁粹淬翠萃悴璀榱隹",cun:"村存寸磋忖皴",cuo:"撮搓措挫错厝脞锉矬痤鹾蹉躜",da:"搭达答瘩打大耷哒嗒怛妲疸褡笪靼鞑",dai:"呆歹傣戴带殆代贷袋待逮怠埭甙呔岱迨逯骀绐玳黛",dan:"耽担丹单郸掸胆旦氮但惮淡诞弹蛋亻儋卩萏啖澹檐殚赕眈瘅聃箪",dang:"当挡党荡档谠凼菪宕砀铛裆",dao:"刀捣蹈倒岛祷导到稻悼道盗叨啁忉洮氘焘忑纛",de:"德得的锝",deng:"蹬灯登等瞪凳邓噔嶝戥磴镫簦",di:"堤低滴迪敌笛狄涤翟嫡抵底地蒂第帝弟递缔氐籴诋谛邸坻莜荻嘀娣柢棣觌砥碲睇镝羝骶",dian:"颠掂滇碘点典靛垫电佃甸店惦奠淀殿丶阽坫埝巅玷癜癫簟踮",diao:"碉叼雕凋刁掉吊钓调轺铞蜩粜貂",die:"跌爹碟蝶迭谍叠佚垤堞揲喋渫轶牒瓞褶耋蹀鲽鳎",ding:"丁盯叮钉顶鼎锭定订丢仃啶玎腚碇町铤疔耵酊",dong:"东冬董懂动栋侗恫冻洞垌咚岽峒夂氡胨胴硐鸫",dou:"兜抖斗陡豆逗痘蔸钭窦窬蚪篼酡",du:"都督毒犊独读堵睹赌杜镀肚度渡妒芏嘟渎椟橐牍蠹笃髑黩",duan:"端短锻段断缎彖椴煅簖",dui:"堆兑队对怼憝碓",dun:"墩吨蹲敦顿囤钝盾遁炖砘礅盹镦趸",duo:"掇哆多夺垛躲朵跺舵剁惰堕咄哚缍柁铎裰踱",e:"蛾峨鹅俄额讹娥恶厄扼遏鄂饿噩谔垩垭苊莪萼呃愕屙婀轭曷腭硪锇锷鹗颚鳄",en:"恩蒽摁唔嗯",er:"而儿耳尔饵洱二贰迩珥铒鸸鲕",fa:"发罚筏伐乏阀法珐垡砝",fan:"藩帆番翻樊矾钒繁凡烦反返范贩犯饭泛蘩幡犭梵攵燔畈蹯",fang:"坊芳方肪房防妨仿访纺放匚邡彷钫舫鲂",fei:"菲非啡飞肥匪诽吠肺废沸费芾狒悱淝妃绋绯榧腓斐扉祓砩镄痱蜚篚翡霏鲱",fen:"芬酚吩氛分纷坟焚汾粉奋份忿愤粪偾瀵棼愍鲼鼢",feng:"丰封枫蜂峰锋风疯烽逢冯缝讽奉凤俸酆葑沣砜",fu:"佛否夫敷肤孵扶拂辐幅氟符伏俘服浮涪福袱弗甫抚辅俯釜斧脯腑府腐赴副覆赋复傅付阜父腹负富讣附妇缚咐匐凫郛芙苻茯莩菔呋幞滏艴孚驸绂桴赙黻黼罘稃馥虍蚨蜉蝠蝮麸趺跗鳆",ga:"噶嘎蛤尬呷尕尜旮钆",gai:"该改概钙盖溉丐陔垓戤赅胲",gan:"干甘杆柑竿肝赶感秆敢赣坩苷尴擀泔淦澉绀橄旰矸疳酐",gang:"冈刚钢缸肛纲岗港戆罡颃筻",gong:"杠工攻功恭龚供躬公宫弓巩汞拱贡共蕻廾咣珙肱蚣蛩觥",gao:"篙皋高膏羔糕搞镐稿告睾诰郜蒿藁缟槔槁杲锆",ge:"哥歌搁戈鸽胳疙割革葛格阁隔铬个各鬲仡哿塥嗝纥搿膈硌铪镉袼颌虼舸骼髂",gei:"给",gen:"根跟亘茛哏艮",geng:"耕更庚羹埂耿梗哽赓鲠",gou:"钩勾沟苟狗垢构购够佝诟岣遘媾缑觏彀鸲笱篝鞲",gu:"辜菇咕箍估沽孤姑鼓古蛊骨谷股故顾固雇嘏诂菰哌崮汩梏轱牯牿胍臌毂瞽罟钴锢瓠鸪鹄痼蛄酤觚鲴骰鹘",gua:"刮瓜剐寡挂褂卦诖呱栝鸹",guai:"乖拐怪哙",guan:"棺关官冠观管馆罐惯灌贯倌莞掼涫盥鹳鳏",guang:"光广逛犷桄胱疒",gui:"瑰规圭硅归龟闺轨鬼诡癸桂柜跪贵刽匦刿庋宄妫桧炅晷皈簋鲑鳜",gun:"辊滚棍丨衮绲磙鲧",guo:"锅郭国果裹过馘蠃埚掴呙囗帼崞猓椁虢锞聒蜮蜾蝈",ha:"哈",hai:"骸孩海氦亥害骇咴嗨颏醢",han:"酣憨邯韩含涵寒函喊罕翰撼捍旱憾悍焊汗汉邗菡撖阚瀚晗焓颔蚶鼾",hen:"夯痕很狠恨",hang:"杭航沆绗珩桁",hao:"壕嚎豪毫郝好耗号浩薅嗥嚆濠灏昊皓颢蚝",he:"呵喝荷菏核禾和何合盒貉阂河涸赫褐鹤贺诃劾壑藿嗑嗬阖盍蚵翮",hei:"嘿黑",heng:"哼亨横衡恒訇蘅",hong:"轰哄烘虹鸿洪宏弘红黉讧荭薨闳泓",hou:"喉侯猴吼厚候后堠後逅瘊篌糇鲎骺",hu:"呼乎忽瑚壶葫胡蝴狐糊湖弧虎唬护互沪户冱唿囫岵猢怙惚浒滹琥槲轷觳烀煳戽扈祜鹕鹱笏醐斛",hua:"花哗华猾滑画划化话劐浍骅桦铧稞",huai:"槐徊怀淮坏还踝",huan:"欢环桓缓换患唤痪豢焕涣宦幻郇奂垸擐圜洹浣漶寰逭缳锾鲩鬟",huang:"荒慌黄磺蝗簧皇凰惶煌晃幌恍谎隍徨湟潢遑璜肓癀蟥篁鳇",hui:"灰挥辉徽恢蛔回毁悔慧卉惠晦贿秽会烩汇讳诲绘诙茴荟蕙哕喙隳洄彗缋珲晖恚虺蟪麾",hun:"荤昏婚魂浑混诨馄阍溷缗",huo:"豁活伙火获或惑霍货祸攉嚯夥钬锪镬耠蠖",ji:"击圾基机畸稽积箕肌饥迹激讥鸡姬绩缉吉极棘辑籍集及急疾汲即嫉级挤几脊己蓟技冀季伎祭剂悸济寄寂计记既忌际妓继纪居丌乩剞佶佴脔墼芨芰萁蒺蕺掎叽咭哜唧岌嵴洎彐屐骥畿玑楫殛戟戢赍觊犄齑矶羁嵇稷瘠瘵虮笈笄暨跻跽霁鲚鲫髻麂",jia:"嘉枷夹佳家加荚颊贾甲钾假稼价架驾嫁伽郏拮岬浃迦珈戛胛恝铗镓痂蛱笳袈跏",jian:"歼监坚尖笺间煎兼肩艰奸缄茧检柬碱硷拣捡简俭剪减荐槛鉴践贱见键箭件健舰剑饯渐溅涧建僭谏谫菅蒹搛囝湔蹇謇缣枧柙楗戋戬牮犍毽腱睑锏鹣裥笕箴翦趼踺鲣鞯",jiang:"僵姜将浆江疆蒋桨奖讲匠酱降茳洚绛缰犟礓耩糨豇",jiao:"蕉椒礁焦胶交郊浇骄娇嚼搅铰矫侥脚狡角饺缴绞剿教酵轿较叫佼僬茭挢噍峤徼姣纟敫皎鹪蛟醮跤鲛",jie:"窖揭接皆秸街阶截劫节桔杰捷睫竭洁结解姐戒藉芥界借介疥诫届偈讦诘喈嗟獬婕孑桀獒碣锴疖袷颉蚧羯鲒骱髫",jin:"巾筋斤金今津襟紧锦仅谨进靳晋禁近烬浸尽卺荩堇噤馑廑妗缙瑾槿赆觐钅锓衿矜",jing:"劲荆兢茎睛晶鲸京惊精粳经井警景颈静境敬镜径痉靖竟竞净刭儆阱菁獍憬泾迳弪婧肼胫腈旌",jiong:"炯窘冂迥扃",jiu:"揪究纠玖韭久灸九酒厩救旧臼舅咎就疚僦啾阄柩桕鹫赳鬏",ju:"鞠拘狙疽驹菊局咀矩举沮聚拒据巨具距踞锯俱句惧炬剧倨讵苣苴莒掬遽屦琚枸椐榘榉橘犋飓钜锔窭裾趄醵踽龃雎鞫",juan:"捐鹃娟倦眷卷绢鄄狷涓桊蠲锩镌隽",jue:"撅攫抉掘倔爵觉决诀绝厥劂谲矍蕨噘崛獗孓珏桷橛爝镢蹶觖",jun:"均菌钧军君峻俊竣浚郡骏捃狻皲筠麇",ka:"喀咖卡佧咔胩",ke:"咯坷苛柯棵磕颗科壳咳可渴克刻客课岢恪溘骒缂珂轲氪瞌钶疴窠蝌髁",kai:"开揩楷凯慨剀垲蒈忾恺铠锎",kan:"刊堪勘坎砍看侃凵莰莶戡龛瞰",kang:"康慷糠扛抗亢炕坑伉闶钪",kao:"考拷烤靠尻栲犒铐",ken:"肯啃垦恳垠裉颀",keng:"吭忐铿",kong:"空恐孔控倥崆箜",kou:"抠口扣寇芤蔻叩眍筘",ku:"枯哭窟苦酷库裤刳堀喾绔骷",kua:"夸垮挎跨胯侉",kuai:"块筷侩快蒯郐蒉狯脍",kuan:"宽款髋",kuang:"匡筐狂框矿眶旷况诓诳邝圹夼哐纩贶",kui:"亏盔岿窥葵奎魁傀馈愧溃馗匮夔隗揆喹喟悝愦阕逵暌睽聩蝰篑臾跬",kun:"坤昆捆困悃阃琨锟醌鲲髡",kuo:"括扩廓阔蛞",la:"垃拉喇蜡腊辣啦剌摺邋旯砬瘌",lai:"莱来赖崃徕涞濑赉睐铼癞籁",lan:"蓝婪栏拦篮阑兰澜谰揽览懒缆烂滥啉岚懔漤榄斓罱镧褴",lang:"琅榔狼廊郎朗浪莨蒗啷阆锒稂螂",lao:"捞劳牢老佬姥酪烙涝唠崂栳铑铹痨醪",le:"勒乐肋仂叻嘞泐鳓",lei:"雷镭蕾磊累儡垒擂类泪羸诔荽咧漯嫘缧檑耒酹",ling:"棱冷拎玲菱零龄铃伶羚凌灵陵岭领另令酃塄苓呤囹泠绫柃棂瓴聆蛉翎鲮",leng:"楞愣",li:"厘梨犁黎篱狸离漓理李里鲤礼莉荔吏栗丽厉励砾历利傈例俐痢立粒沥隶力璃哩俪俚郦坜苈莅蓠藜捩呖唳喱猁溧澧逦娌嫠骊缡珞枥栎轹戾砺詈罹锂鹂疠疬蛎蜊蠡笠篥粝醴跞雳鲡鳢黧",lian:"俩联莲连镰廉怜涟帘敛脸链恋炼练挛蔹奁潋濂娈琏楝殓臁膦裢蠊鲢",liang:"粮凉梁粱良两辆量晾亮谅墚椋踉靓魉",liao:"撩聊僚疗燎寥辽潦了撂镣廖料蓼尥嘹獠寮缭钌鹩耢",lie:"列裂烈劣猎冽埒洌趔躐鬣",lin:"琳林磷霖临邻鳞淋凛赁吝蔺嶙廪遴檩辚瞵粼躏麟",liu:"溜琉榴硫馏留刘瘤流柳六抡偻蒌泖浏遛骝绺旒熘锍镏鹨鎏",long:"龙聋咙笼窿隆垄拢陇弄垅茏泷珑栊胧砻癃",lou:"楼娄搂篓漏陋喽嵝镂瘘耧蝼髅",lu:"芦卢颅庐炉掳卤虏鲁麓碌露路赂鹿潞禄录陆戮垆摅撸噜泸渌漉璐栌橹轳辂辘氇胪镥鸬鹭簏舻鲈",lv:"驴吕铝侣旅履屡缕虑氯律率滤绿捋闾榈膂稆褛",luan:"峦孪滦卵乱栾鸾銮",lue:"掠略锊",lun:"轮伦仑沦纶论囵",luo:"萝螺罗逻锣箩骡裸落洛骆络倮荦摞猡泺椤脶镙瘰雒",ma:"妈麻玛码蚂马骂嘛吗唛犸嬷杩麽",mai:"埋买麦卖迈脉劢荬咪霾",man:"瞒馒蛮满蔓曼慢漫谩墁幔缦熳镘颟螨鳗鞔",mang:"芒茫盲忙莽邙漭朦硭蟒",meng:"氓萌蒙檬盟锰猛梦孟勐甍瞢懵礞虻蜢蠓艋艨黾",miao:"猫苗描瞄藐秒渺庙妙喵邈缈缪杪淼眇鹋蜱",mao:"茅锚毛矛铆卯茂冒帽貌贸侔袤勖茆峁瑁昴牦耄旄懋瞀蛑蝥蟊髦",me:"么",mei:"玫枚梅酶霉煤没眉媒镁每美昧寐妹媚坶莓嵋猸浼湄楣镅鹛袂魅",men:"门闷们扪玟焖懑钔",mi:"眯醚靡糜迷谜弥米秘觅泌蜜密幂芈冖谧蘼嘧猕獯汨宓弭脒敉糸縻麋",mian:"棉眠绵冕免勉娩缅面沔湎腼眄",mie:"蔑灭咩蠛篾",min:"民抿皿敏悯闽苠岷闵泯珉",ming:"明螟鸣铭名命冥茗溟暝瞑酩",miu:"谬",mo:"摸摹蘑模膜磨摩魔抹末莫墨默沫漠寞陌谟茉蓦馍嫫镆秣瘼耱蟆貊貘",mou:"谋牟某厶哞婺眸鍪",mu:"拇牡亩姆母墓暮幕募慕木目睦牧穆仫苜呒沐毪钼",na:"拿哪呐钠那娜纳内捺肭镎衲箬",nai:"氖乃奶耐奈鼐艿萘柰",nan:"南男难囊喃囡楠腩蝻赧",nao:"挠脑恼闹孬垴猱瑙硇铙蛲",ne:"淖呢讷",nei:"馁",nen:"嫩能枘恁",ni:"妮霓倪泥尼拟你匿腻逆溺伲坭猊怩滠昵旎祢慝睨铌鲵",nian:"蔫拈年碾撵捻念廿辇黏鲇鲶",niang:"娘酿",niao:"鸟尿茑嬲脲袅",nie:"捏聂孽啮镊镍涅乜陧蘖嗫肀颞臬蹑",nin:"您柠",ning:"狞凝宁拧泞佞蓥咛甯聍",niu:"牛扭钮纽狃忸妞蚴",nong:"脓浓农侬",nu:"奴努怒呶帑弩胬孥驽",nv:"女恧钕衄",nuan:"暖",nuenue:"虐",nue:"疟谑",nuo:"挪懦糯诺傩搦喏锘",ou:"哦欧鸥殴藕呕偶沤怄瓯耦",pa:"啪趴爬帕怕琶葩筢",pai:"拍排牌徘湃派俳蒎",pan:"攀潘盘磐盼畔判叛爿泮袢襻蟠蹒",pang:"乓庞旁耪胖滂逄",pao:"抛咆刨炮袍跑泡匏狍庖脬疱",pei:"呸胚培裴赔陪配佩沛掊辔帔淠旆锫醅霈",pen:"喷盆湓",peng:"砰抨烹澎彭蓬棚硼篷膨朋鹏捧碰坯堋嘭怦蟛",pi:"砒霹批披劈琵毗啤脾疲皮匹痞僻屁譬丕陴邳郫圮鼙擗噼庀媲纰枇甓睥罴铍痦癖疋蚍貔",pian:"篇偏片骗谝骈犏胼褊翩蹁",piao:"飘漂瓢票剽嘌嫖缥殍瞟螵",pie:"撇瞥丿苤氕",pin:"拼频贫品聘拚姘嫔榀牝颦",ping:"乒坪苹萍平凭瓶评屏俜娉枰鲆",po:"坡泼颇婆破魄迫粕叵鄱溥珀钋钷皤笸",pou:"剖裒踣",pu:"扑铺仆莆葡菩蒲埔朴圃普浦谱曝瀑匍噗濮璞氆镤镨蹼",qi:"期欺栖戚妻七凄漆柒沏其棋奇歧畦崎脐齐旗祈祁骑起岂乞企启契砌器气迄弃汽泣讫亟亓圻芑萋葺嘁屺岐汔淇骐绮琪琦杞桤槭欹祺憩碛蛴蜞綦綮趿蹊鳍麒",qia:"掐恰洽葜",qian:"牵扦钎铅千迁签仟谦乾黔钱钳前潜遣浅谴堑嵌欠歉佥阡芊芡荨掮岍悭慊骞搴褰缱椠肷愆钤虔箝",qiang:"枪呛腔羌墙蔷强抢嫱樯戗炝锖锵镪襁蜣羟跫跄",qiao:"橇锹敲悄桥瞧乔侨巧鞘撬翘峭俏窍劁诮谯荞愀憔缲樵毳硗跷鞒",qie:"切茄且怯窃郄唼惬妾挈锲箧",qin:"钦侵亲秦琴勤芹擒禽寝沁芩蓁蕲揿吣嗪噙溱檎螓衾",qing:"青轻氢倾卿清擎晴氰情顷请庆倩苘圊檠磬蜻罄箐謦鲭黥",qiong:"琼穷邛茕穹筇銎",qiu:"秋丘邱球求囚酋泅俅氽巯艽犰湫逑遒楸赇鸠虬蚯蝤裘糗鳅鼽",qu:"趋区蛆曲躯屈驱渠取娶龋趣去诎劬蕖蘧岖衢阒璩觑氍祛磲癯蛐蠼麴瞿黢",quan:"圈颧权醛泉全痊拳犬券劝诠荃獾悛绻辁畎铨蜷筌鬈",que:"缺炔瘸却鹊榷确雀阙悫",qun:"裙群逡",ran:"然燃冉染苒髯",rang:"瓤壤攘嚷让禳穰",rao:"饶扰绕荛娆桡",ruo:"惹若弱",re:"热偌",ren:"壬仁人忍韧任认刃妊纫仞荏葚饪轫稔衽",reng:"扔仍",ri:"日",rong:"戎茸蓉荣融熔溶容绒冗嵘狨缛榕蝾",rou:"揉柔肉糅蹂鞣",ru:"茹蠕儒孺如辱乳汝入褥蓐薷嚅洳溽濡铷襦颥",ruan:"软阮朊",rui:"蕊瑞锐芮蕤睿蚋",run:"闰润",sa:"撒洒萨卅仨挲飒",sai:"腮鳃塞赛噻",san:"三叁伞散彡馓氵毵糁霰",sang:"桑嗓丧搡磉颡",sao:"搔骚扫嫂埽臊瘙鳋",se:"瑟色涩啬铩铯穑",sen:"森",seng:"僧",sha:"莎砂杀刹沙纱傻啥煞脎歃痧裟霎鲨",shai:"筛晒酾",shan:"珊苫杉山删煽衫闪陕擅赡膳善汕扇缮剡讪鄯埏芟潸姗骟膻钐疝蟮舢跚鳝",shang:"墒伤商赏晌上尚裳垧绱殇熵觞",shao:"梢捎稍烧芍勺韶少哨邵绍劭苕潲蛸笤筲艄",she:"奢赊蛇舌舍赦摄射慑涉社设厍佘猞畲麝",shen:"砷申呻伸身深娠绅神沈审婶甚肾慎渗诜谂吲哂渖椹矧蜃",sheng:"声生甥牲升绳省盛剩胜圣丞渑媵眚笙",shi:"师失狮施湿诗尸虱十石拾时什食蚀实识史矢使屎驶始式示士世柿事拭誓逝势是嗜噬适仕侍释饰氏市恃室视试谥埘莳蓍弑唑饣轼耆贳炻礻铈铊螫舐筮豕鲥鲺",shou:"收手首守寿授售受瘦兽扌狩绶艏",shu:"蔬枢梳殊抒输叔舒淑疏书赎孰熟薯暑曙署蜀黍鼠属术述树束戍竖墅庶数漱恕倏塾菽忄沭涑澍姝纾毹腧殳镯秫鹬",shua:"刷耍唰涮",shuai:"摔衰甩帅蟀",shuan:"栓拴闩",shuang:"霜双爽孀",shui:"谁水睡税",shun:"吮瞬顺舜恂",shuo:"说硕朔烁蒴搠嗍濯妁槊铄",si:"斯撕嘶思私司丝死肆寺嗣四伺似饲巳厮俟兕菥咝汜泗澌姒驷缌祀祠锶鸶耜蛳笥",song:"松耸怂颂送宋讼诵凇菘崧嵩忪悚淞竦",sou:"搜艘擞嗽叟嗖嗾馊溲飕瞍锼螋",su:"苏酥俗素速粟僳塑溯宿诉肃夙谡蔌嗉愫簌觫稣",suan:"酸蒜算",sui:"虽隋随绥髓碎岁穗遂隧祟蓑冫谇濉邃燧眭睢",sun:"孙损笋荪狲飧榫跣隼",suo:"梭唆缩琐索锁所唢嗦娑桫睃羧",ta:"塌他它她塔獭挞蹋踏闼溻遢榻沓",tai:"胎苔抬台泰酞太态汰邰薹肽炱钛跆鲐",tan:"坍摊贪瘫滩坛檀痰潭谭谈坦毯袒碳探叹炭郯蕈昙钽锬覃",tang:"汤塘搪堂棠膛唐糖傥饧溏瑭铴镗耥螗螳羰醣",thang:"倘躺淌",theng:"趟烫",tao:"掏涛滔绦萄桃逃淘陶讨套挑鼗啕韬饕",te:"特",teng:"藤腾疼誊滕",ti:"梯剔踢锑提题蹄啼体替嚏惕涕剃屉荑悌逖绨缇鹈裼醍",tian:"天添填田甜恬舔腆掭忝阗殄畋钿蚺",tiao:"条迢眺跳佻祧铫窕龆鲦",tie:"贴铁帖萜餮",ting:"厅听烃汀廷停亭庭挺艇莛葶婷梃蜓霆",tong:"通桐酮瞳同铜彤童桶捅筒统痛佟僮仝茼嗵恸潼砼",tou:"偷投头透亠",tu:"凸秃突图徒途涂屠土吐兔堍荼菟钍酴",tuan:"湍团疃",tui:"推颓腿蜕褪退忒煺",tun:"吞屯臀饨暾豚窀",tuo:"拖托脱鸵陀驮驼椭妥拓唾乇佗坨庹沱柝砣箨舄跎鼍",wa:"挖哇蛙洼娃瓦袜佤娲腽",wai:"歪外",wan:"豌弯湾玩顽丸烷完碗挽晚皖惋宛婉万腕剜芄苋菀纨绾琬脘畹蜿箢",wang:"汪王亡枉网往旺望忘妄罔尢惘辋魍",wei:"威巍微危韦违桅围唯惟为潍维苇萎委伟伪尾纬未蔚味畏胃喂魏位渭谓尉慰卫倭偎诿隈葳薇帏帷崴嵬猥猬闱沩洧涠逶娓玮韪軎炜煨熨痿艉鲔",wen:"瘟温蚊文闻纹吻稳紊问刎愠阌汶璺韫殁雯",weng:"嗡翁瓮蓊蕹",wo:"挝蜗涡窝我斡卧握沃莴幄渥杌肟龌",wu:"巫呜钨乌污诬屋无芜梧吾吴毋武五捂午舞伍侮坞戊雾晤物勿务悟误兀仵阢邬圬芴庑怃忤浯寤迕妩骛牾焐鹉鹜蜈鋈鼯",xi:"昔熙析西硒矽晰嘻吸锡牺稀息希悉膝夕惜熄烯溪汐犀檄袭席习媳喜铣洗系隙戏细僖兮隰郗茜葸蓰奚唏徙饩阋浠淅屣嬉玺樨曦觋欷熹禊禧钸皙穸蜥蟋舾羲粞翕醯鼷",xia:"瞎虾匣霞辖暇峡侠狭下厦夏吓掀葭嗄狎遐瑕硖瘕罅黠",xian:"锨先仙鲜纤咸贤衔舷闲涎弦嫌显险现献县腺馅羡宪陷限线冼藓岘猃暹娴氙祆鹇痫蚬筅籼酰跹",xiang:"相厢镶香箱襄湘乡翔祥详想响享项巷橡像向象芗葙饷庠骧缃蟓鲞飨",xiao:"萧硝霄削哮嚣销消宵淆晓小孝校肖啸笑效哓咻崤潇逍骁绡枭枵筱箫魈",xie:"楔些歇蝎鞋协挟携邪斜胁谐写械卸蟹懈泄泻谢屑偕亵勰燮薤撷廨瀣邂绁缬榭榍歙躞",xin:"薪芯锌欣辛新忻心信衅囟馨莘歆铽鑫",xing:"星腥猩惺兴刑型形邢行醒幸杏性姓陉荇荥擤悻硎",xiong:"兄凶胸匈汹雄熊芎",xiu:"休修羞朽嗅锈秀袖绣莠岫馐庥鸺貅髹",xu:"墟戌需虚嘘须徐许蓄酗叙旭序畜恤絮婿绪续讴诩圩蓿怵洫溆顼栩煦砉盱胥糈醑",xuan:"轩喧宣悬旋玄选癣眩绚儇谖萱揎馔泫洵渲漩璇楦暄炫煊碹铉镟痃",xue:"靴薛学穴雪血噱泶鳕",xun:"勋熏循旬询寻驯巡殉汛训讯逊迅巽埙荀薰峋徇浔曛窨醺鲟",ya:"压押鸦鸭呀丫芽牙蚜崖衙涯雅哑亚讶伢揠吖岈迓娅琊桠氩砑睚痖",yan:"焉咽阉烟淹盐严研蜒岩延言颜阎炎沿奄掩眼衍演艳堰燕厌砚雁唁彦焰宴谚验厣靥赝俨偃兖讠谳郾鄢芫菸崦恹闫阏洇湮滟妍嫣琰晏胭腌焱罨筵酽魇餍鼹",yang:"殃央鸯秧杨扬佯疡羊洋阳氧仰痒养样漾徉怏泱炀烊恙蛘鞅",yao:"邀腰妖瑶摇尧遥窑谣姚咬舀药要耀夭爻吆崾徭瀹幺珧杳曜肴鹞窈繇鳐",ye:"椰噎耶爷野冶也页掖业叶曳腋夜液谒邺揶馀晔烨铘",yi:"一壹医揖铱依伊衣颐夷遗移仪胰疑沂宜姨彝椅蚁倚已乙矣以艺抑易邑屹亿役臆逸肄疫亦裔意毅忆义益溢诣议谊译异翼翌绎刈劓佾诒圪圯埸懿苡薏弈奕挹弋呓咦咿噫峄嶷猗饴怿怡悒漪迤驿缢殪贻旖熠钇镒镱痍瘗癔翊衤蜴舣羿翳酏黟",yin:"茵荫因殷音阴姻吟银淫寅饮尹引隐印胤鄞堙茚喑狺夤氤铟瘾蚓霪龈",ying:"英樱婴鹰应缨莹萤营荧蝇迎赢盈影颖硬映嬴郢茔莺萦撄嘤膺滢潆瀛瑛璎楹鹦瘿颍罂",yo:"哟唷",yong:"拥佣臃痈庸雍踊蛹咏泳涌永恿勇用俑壅墉慵邕镛甬鳙饔",you:"幽优悠忧尤由邮铀犹油游酉有友右佑釉诱又幼卣攸侑莸呦囿宥柚猷牖铕疣蝣鱿黝鼬",yu:"迂淤于盂榆虞愚舆余俞逾鱼愉渝渔隅予娱雨与屿禹宇语羽玉域芋郁吁遇喻峪御愈欲狱育誉浴寓裕预豫驭禺毓伛俣谀谕萸蓣揄喁圄圉嵛狳饫庾阈妪妤纡瑜昱觎腴欤於煜燠聿钰鹆瘐瘀窳蝓竽舁雩龉",yuan:"鸳渊冤元垣袁原援辕园员圆猿源缘远苑愿怨院塬沅媛瑗橼爰眢鸢螈鼋",yue:"曰约越跃钥岳粤月悦阅龠樾刖钺",yun:"耘云郧匀陨允运蕴酝晕韵孕郓芸狁恽纭殒昀氲",za:"匝砸杂拶咂",zai:"栽哉灾宰载再在咱崽甾",zan:"攒暂赞瓒昝簪糌趱錾",zang:"赃脏葬奘戕臧",zao:"遭糟凿藻枣早澡蚤躁噪造皂灶燥唣缫",ze:"责择则泽仄赜啧迮昃笮箦舴",zei:"贼",zen:"怎谮",zeng:"增憎曾赠缯甑罾锃",zha:"扎喳渣札轧铡闸眨栅榨咋乍炸诈揸吒咤哳怍砟痄蚱齄",zhai:"摘斋宅窄债寨砦",zhan:"瞻毡詹粘沾盏斩辗崭展蘸栈占战站湛绽谵搌旃",zhang:"樟章彰漳张掌涨杖丈帐账仗胀瘴障仉鄣幛嶂獐嫜璋蟑",zhao:"招昭找沼赵照罩兆肇召爪诏棹钊笊",zhe:"遮折哲蛰辙者锗蔗这浙谪陬柘辄磔鹧褚蜇赭",zhen:"珍斟真甄砧臻贞针侦枕疹诊震振镇阵缜桢榛轸赈胗朕祯畛鸩",zheng:"蒸挣睁征狰争怔整拯正政帧症郑证诤峥钲铮筝",zhi:"芝枝支吱蜘知肢脂汁之织职直植殖执值侄址指止趾只旨纸志挚掷至致置帜峙制智秩稚质炙痔滞治窒卮陟郅埴芷摭帙忮彘咫骘栉枳栀桎轵轾攴贽膣祉祗黹雉鸷痣蛭絷酯跖踬踯豸觯",zhong:"中盅忠钟衷终种肿重仲众冢锺螽舂舯踵",zhou:"舟周州洲诌粥轴肘帚咒皱宙昼骤啄着倜诹荮鬻纣胄碡籀舳酎鲷",zhu:"珠株蛛朱猪诸诛逐竹烛煮拄瞩嘱主著柱助蛀贮铸筑住注祝驻伫侏邾苎茱洙渚潴驺杼槠橥炷铢疰瘃蚰竺箸翥躅麈",zhua:"抓",zhuai:"拽",zhuan:"专砖转撰赚篆抟啭颛",zhuang:"桩庄装妆撞壮状丬",zhui:"椎锥追赘坠缀萑骓缒",zhun:"谆准",zhuo:"捉拙卓桌琢茁酌灼浊倬诼廴蕞擢啜浞涿杓焯禚斫",zi:"兹咨资姿滋淄孜紫仔籽滓子自渍字谘嵫姊孳缁梓辎赀恣眦锱秭耔笫粢觜訾鲻髭",zong:"鬃棕踪宗综总纵腙粽",zou:"邹走奏揍鄹鲰",zu:"租足卒族祖诅阻组俎菹啐徂驵蹴",zuan:"钻纂攥缵",zui:"嘴醉最罪",zun:"尊遵撙樽鳟",zuo:"昨左佐柞做作坐座阝阼胙祚酢",cou:"薮楱辏腠",nang:"攮哝囔馕曩",o:"喔",dia:"嗲",chuai:"嘬膪踹",cen:"岑涔",diu:"铥",nou:"耨",fou:"缶",bia:"髟"},a=e.length,n="",o=new RegExp("[a-zA-Z0-9- ]"),r=0;r<a;r++){var l=e.substr(r,1),s="";for(var d in i)if(-1!=i[d].indexOf(l)){s=d;break}if(o.test(l)||0==s.length)n+=l;else if(0<s.length){switch(t){case"PY":s=s.substr(0,1).toUpperCase();break;case"py":s=s.substr(0,1);break;case"PINYIN":s=s.toUpperCase();break;case"pinyin":s=s;break;default:s=s.substr(0,1).toUpperCase()+s.substr(1,s.length)}n+=s}}for(n=n.replace(/ /g,"-");0<n.indexOf("--");)n=n.replace("--","-");return n}}),Ext.define("JE.util.RbacUtil",{countUserByDeptCode:function(e,t,i){var a={deptCodes:e,cascade:!0};Ext.isEmpty(t)||(a.whereSql=t),0==i&&(a.cascade=i);var n=JE.ajax({url:JE.getUrlMaps("je.core.rbac.rbac","countUserByDeptCode"),params:a});return n.success?1*n.obj:-1},countUserByDeptId:function(e,t,i){var a={deptIds:e,cascade:!0};Ext.isEmpty(t)||(a.whereSql=t),0==i&&(a.cascade=i);var n=JE.ajax({url:JE.getUrlMaps("je.core.rbac.rbac","countUserByDeptId"),params:a});return n.success?1*n.obj:-1},queryUserByDeptCode:function(e,t,i,a){var n={deptCodes:e,cascade:!0};return Ext.isEmpty(t)||(n.whereSql=t),0==i&&(n.cascade=i),Ext.isEmpty(a)||(n.queryFields=a),JE.ajax({url:JE.getUrlMaps("je.core.rbac.rbac","queryUserByDeptCode"),params:n})},queryUserByDeptId:function(e,t,i,a){var n={deptIds:e,cascade:!0};return Ext.isEmpty(t)||(n.whereSql=t),0==i&&(n.cascade=i),Ext.isEmpty(a)||(n.queryFields=a),JE.ajax({url:JE.getUrlMaps("je.core.rbac.rbac","queryUserByDeptId"),params:n})},countUserByRoleCode:function(e,t,i){var a={roleCodes:e,cascade:!0};Ext.isEmpty(t)||(a.whereSql=t),0==i&&(a.cascade=i);var n=JE.ajax({url:JE.getUrlMaps("je.core.rbac.rbac","countUserByRoleCode"),params:a});return n.success?1*n.obj:-1},countUserByRoleId:function(e,t,i){var a={roleIds:e,cascade:!0};Ext.isEmpty(t)||(a.whereSql=t),0==i&&(a.cascade=i);var n=JE.ajax({url:JE.getUrlMaps("je.core.rbac.rbac","countUserByRoleId"),params:a});return n.success?1*n.obj:-1},queryUserByRoleCode:function(e,t,i,a){var n={roleCodes:e,cascade:!0};return Ext.isEmpty(t)||(n.whereSql=t),0==i&&(n.cascade=i),Ext.isEmpty(a)||(n.queryFields=a),JE.ajax({url:JE.getUrlMaps("je.core.rbac.rbac","queryUserByRoleCode"),params:n})},queryUserByRoleId:function(e,t,i,a){var n={roleIds:e,cascade:!0};return Ext.isEmpty(t)||(n.whereSql=t),0==i&&(n.cascade=i),Ext.isEmpty(a)||(n.queryFields=a),JE.ajax({url:JE.getUrlMaps("je.core.rbac.rbac","queryUserByRoleId"),params:n})},countUserBySentryCode:function(e,t,i){var a={sentryCodes:e,cascade:!0};Ext.isEmpty(t)||(a.whereSql=t),0==i&&(a.cascade=i);var n=JE.ajax({url:JE.getUrlMaps("je.core.rbac.rbac","countUserBySentryCode"),params:a});return n.success?1*n.obj:-1},countUserBySentryId:function(e,t,i){var a={sentryIds:e,cascade:!0};Ext.isEmpty(t)||(a.whereSql=t),0==i&&(a.cascade=i);var n=JE.ajax({url:JE.getUrlMaps("je.core.rbac.rbac","countUserBySentryId"),params:a});return n.success?1*n.obj:-1},queryUserBySentryCode:function(e,t,i,a){var n={sentryCodes:e,cascade:!0};return Ext.isEmpty(t)||(n.whereSql=t),0==i&&(n.cascade=i),Ext.isEmpty(a)||(n.queryFields=a),JE.ajax({url:JE.getUrlMaps("je.core.rbac.rbac","queryUserBySentryCode"),params:n})},queryUserBySentryId:function(e,t,i,a){var n={sentryIds:e,cascade:!0};return Ext.isEmpty(t)||(n.whereSql=t),0==i&&(n.cascade=i),Ext.isEmpty(a)||(n.queryFields=a),JE.ajax({url:JE.getUrlMaps("je.core.rbac.rbac","queryUserBySentryId"),params:n})},countUser:function(e){var t={};Ext.isEmpty(e)||(t.whereSql=e);var i=JE.ajax({url:JE.getUrlMaps("je.core.rbac.rbac","countUser"),params:t});return i.success?1*i.obj:-1},queryUser:function(e,t){var i={};return Ext.isEmpty(e)||(i.whereSql=e),Ext.isEmpty(t)||(i.queryFields=t),JE.ajax({url:JE.getUrlMaps("je.core.rbac.rbac","queryUser"),params:i})},countDeptByCode:function(e,t,i){var a={deptCodes:e,cascade:!0};Ext.isEmpty(t)||(a.whereSql=t),0==i&&(a.cascade=i);var n=JE.ajax({url:JE.getUrlMaps("je.core.rbac.rbac","countDeptByCode"),params:a});return n.success?1*n.obj:-1},countDeptById:function(e,t,i){var a={deptIds:e,cascade:!0};Ext.isEmpty(t)||(a.whereSql=t),0==i&&(a.cascade=i);var n=JE.ajax({url:JE.getUrlMaps("je.core.rbac.rbac","countDeptById"),params:a});return n.success?1*n.obj:-1},queryDeptByCode:function(e,t,i,a){var n={deptCodes:e,cascade:!0};return Ext.isEmpty(t)||(n.whereSql=t),0==i&&(n.cascade=i),Ext.isEmpty(a)||(n.queryFields=a),JE.ajax({url:JE.getUrlMaps("je.core.rbac.rbac","queryDeptByCode"),params:n})},queryDeptById:function(e,t,i,a){var n={deptIds:e,cascade:!0};return Ext.isEmpty(t)||(n.whereSql=t),0==i&&(n.cascade=i),Ext.isEmpty(a)||(n.queryFields=a),JE.ajax({url:JE.getUrlMaps("je.core.rbac.rbac","queryDeptById"),params:n})},countRoleByCode:function(e,t,i){var a={roleCodes:e,cascade:!0};Ext.isEmpty(t)||(a.whereSql=t),0==i&&(a.cascade=i);var n=JE.ajax({url:JE.getUrlMaps("je.core.rbac.rbac","countRoleByCode"),params:a});return n.success?1*n.obj:-1},countRoleById:function(e,t,i){var a={roleIds:e,cascade:!0};Ext.isEmpty(t)||(a.whereSql=t),0==i&&(a.cascade=i);var n=JE.ajax({url:JE.getUrlMaps("je.core.rbac.rbac","countRoleById"),params:a});return n.success?1*n.obj:-1},queryRoleByCode:function(e,t,i,a){var n={roleCodes:e,cascade:!0};return Ext.isEmpty(t)||(n.whereSql=t),0==i&&(n.cascade=i),Ext.isEmpty(a)||(n.queryFields=a),JE.ajax({url:JE.getUrlMaps("je.core.rbac.rbac","queryRoleByCode"),params:n})},queryRoleById:function(e,t,i,a){var n={roleIds:e,cascade:!0};return Ext.isEmpty(t)||(n.whereSql=t),0==i&&(n.cascade=i),Ext.isEmpty(a)||(n.queryFields=a),JE.ajax({url:JE.getUrlMaps("je.core.rbac.rbac","queryRoleById"),params:n})},countSentryByCode:function(e,t,i){var a={sentryCodes:e,cascade:!0};Ext.isEmpty(t)||(a.whereSql=t),0==i&&(a.cascade=i);var n=JE.ajax({url:JE.getUrlMaps("je.core.rbac.rbac","countSentryByCode"),params:a});return n.success?1*n.obj:-1},countSentryById:function(e,t,i){var a={sentryIds:e,cascade:!0};Ext.isEmpty(t)||(a.whereSql=t),0==i&&(a.cascade=i);var n=JE.ajax({url:JE.getUrlMaps("je.core.rbac.rbac","countSentryById"),params:a});return n.success?1*n.obj:-1},querySentryByCode:function(e,t,i,a){var n={sentryCodes:e,cascade:!0};return Ext.isEmpty(t)||(n.whereSql=t),0==i&&(n.cascade=i),Ext.isEmpty(a)||(n.queryFields=a),JE.ajax({url:JE.getUrlMaps("je.core.rbac.rbac","querySentryByCode"),params:n})},querySentryById:function(e,t,i,a){var n={sentryIds:e,cascade:!0};return Ext.isEmpty(t)||(n.whereSql=t),0==i&&(n.cascade=i),Ext.isEmpty(a)||(n.queryFields=a),JE.ajax({url:JE.getUrlMaps("je.core.rbac.rbac","querySentryById"),params:n})}}),Ext.define("JE.util.RendererUtil",{buildRendererTactics:function(e,t){var i=[],a=Ext.isObject(t.otherConfig)?t.otherConfig:Ext.decode(Ext.value(t.otherConfig,"{}"));if(-1!=["cgroup","rgroup","cbbfield"].indexOf(e.basicXtype)){var n=Ext.value(e.configInfo,"").split(",")[0];if(JE.isNotEmpty(n)){var o={type:"dic",dicCode:t.ddCode=n,enableIcon:t.enableIcon};Ext.each(Ext.value(t.dicColor,"").split(","),function(e){"BGCOLOR"==e?(o.bgCss=!0,t.enableBGColor=!0):"COLOR"==e&&(o.textCss=!0)});var r=JE.dicInfoData[n];("cbbfield"!=e.xtype||r&&"LIST"==r.DICTIONARY_DDTYPE||JE.isEmpty(e.cascadeField))&&i.push(o)}}if(-1!=["datemonthfield","datetimefield","datefield"].indexOf(e.basicXtype)){var l=Ext.value(t.dateFormat,e.format),s=e.submitFormat;i.push({type:"dateformat",format:l,submitFormat:s})}if("uxfilefield"==e.basicXtype){var d=Ext.value(e.configInfo,"").split(","),c=d[2],u=Ext.value(d[3],""),p=u.split("*")[0],f=u.split("*")[1];i.push({type:"file",fileType:c,height:f,width:p,funcCode:e.funcCode,tableName:e.tableName,pkName:e.pkName})}else"uxfilesfield"==e.basicXtype&&i.push({type:"file",fileType:"files",funcCode:e.funcCode,tableName:e.tableName,pkName:e.pkName});if("colorfield"==e.basicXtype&&i.push({type:"color"}),"ckeditor"==e.basicXtype&&i.push({type:"ckeditor"}),"cbblistfield"==e.basicXtype){n=Ext.value(e.configInfo,"").split(",")[0];i.push({type:"cbblistfield",dicCode:n})}if("multiitem"==e.basicXtype){n=Ext.value(e.configInfo,"").split(",")[0];i.push({type:"multiitem",dicCode:n})}return"barfield"==e.basicXtype&&(i.push({type:"bar",configInfo:e.configInfo}),t.align="left"),"starfield"==e.basicXtype&&i.push({type:"star"}),t.multiRows&&i.push({type:"multiRows"}),t.columnTip&&i.push({type:"tip"}),"1"!=a.keyword&&-1!=["barfield","starfield","cgroup","rgroup","cbbfield","uxfilefield","uxfilesfield","cbblistfield","graphfield"].indexOf(e.basicXtype)||i.push({type:"highlighting"}),t.merge&&(i.push({type:"merge"}),t.allowEdit=!1),t.listeners&&t.listeners.linkclick&&i.push({type:"link"}),i},summaryRenderer:function(e,t,i,a,n,o,r){var l=t.column;if(l.rightBorderColor&&(t.tdAttr=' style="border-right-color:'+l.rightBorderColor+';" '),l.summary){var s=l.summaryMsg,d=Ext.value(i.get("summary__index"),0);1==i.allRecord&&(s=Ext.value(l.summaryAllMsg,s));var c=JE.decode(Ext.value(l.summaryFormat,"[]"));if(Ext.isNumeric(e)&&JE.isNotEmpty(c[d])&&(e=Ext.util.Format.number(e,c[d].code)),Ext.isEmpty(s))return e;if(s=JE.decode(s)[d].code,summary=JE.decode(l.summary)[d].code,"zdy"==summary){var u=s;Ext.isEmpty(u)||(u=new Ext.XTemplate(u),e=JE.eval(u.apply(i.data),JE.local.lang.core.util.RendererUtil.summaryRendererZdyTplError,!1),e=Ext.value(e,""))}else e="msg"==summary?s:s+"："+e;return e}return""},renderer:function(w,S,I,T,e,_,t){var J=this,D=S.column,A=t.store;if(!D||!D.useMark&&!D.usePostil&&Ext.isEmpty(w)&&(!A.mergesInfo||!A.mergesInfo[D.dataIndex]))return"";if(Ext.isEmpty(D.tactics))return w;var N=w;if(S.tdAttr=Ext.value(S.tdAttr,""),S.style=Ext.value(S.style,""),Ext.each(D.tactics,function(o){switch(o.type){case"dic":var t=JE.getDicItems(o.dicCode,!0),e=(Ext.value(w,"")+"").split(",");if(0<e.length){var i=[],a=[],n="",r="";Ext.each(e,function(e){dicItem=t[e],dicItem&&(i.push('<div class="'+dicItem.iconCls+'"></div>'),a.push(Ext.value(dicItem.text,JE.local.lang.core.util.RendererUtil.dicNoItem)),n=dicItem.backgroundColor,r=dicItem.textColor)}),N=1!=o.enableIcon||Ext.isEmpty(dicItem.iconCls)?Ext.value(a.join(","),w):"<center>"+i.join(" ")+"</center>",o.bgCss&&(S.tdAttr+=' style="background-color:'+n+';" '),o.textCss&&(S.style+="color:"+r+";")}break;case"file":if("img"==o.fileType){var l=w.split("*")[0],s=w.split("*")[1],d=Ext.isEmpty(o.width)?"":" width = "+o.width,c=Ext.isEmpty(o.height)?"":" height = "+o.height;N="<img alt = '"+l+"' src ='"+JE.getFileUrl(s,"","","",o.tableName)+"' "+d+" "+c+" >"}else{var u=[];if("files"==o.fileType)Ext.each(JE.toObj(w),function(e){u.push(e)});else{l=w.split("*")[0],s=w.split("*")[1];u.push({name:l,path:s})}var p=[],f=o.funcCode,E=I.get(o.pkName);Ext.each(u,function(e){var t=e.path,i=e.name,a="JE.File.doAct('download',{name:'"+i+"',path:'"+t+"',funcCode:'"+f+"'},'"+o.tableName+"')",n="JE.File.doAct('preview',{name:'"+i+"',path:'"+t+"',funcCode:'"+f+"',field:'"+D.dataIndex+"',beanId:'"+E+"'},'"+o.tableName+"')";txt=i+'&nbsp;<a style="color:blue;text-decoration:none;" href="javascript:void(0)" onclick="javascript:'+a+';">'+JE.local.lang.core.util.RendererUtil.fileDownload+'</a>|<a style="color:green;text-decoration:none;" href="javascript:void(0)" onclick="javascript:'+n+';">'+JE.local.lang.core.util.RendererUtil.filePreview+"</a>",p.push(txt)}),N=p.join("</br>")}break;case"color":Ext.isEmpty(w)||(S.tdAttr+=' style="background-color:'+w+';" ');break;case"ckeditor":if(Ext.isEmpty(w)||(N=JE.getUEditorBox(Ext.htmlDecode(w))),D.allowEdit){S.style+="position:relative;";var m=JE.getIconTpl("jeicon jeicon-pencil",{style:"position:absolute;right:0px;top:0px;cursor: pointer;",onclick:"JE.editCKEditorVal('"+J.getId()+"','"+I.getId()+"','"+D.dataIndex+"');"});N+=m}break;case"cbblistfield":if(!Ext.isEmpty(w)){var g=[];a=[];try{g=Ext.decode(w)}catch(e){}Ext.each(g,function(e){var t=e.text;Ext.isEmpty(t)&&(t=JE.toDicText(o.dicCode,e.code)),a.push("<b>"+t+"</b>："+e.value)}),N=a.join("</br>")}break;case"multiitem":if(!Ext.isEmpty(w)){g=[],a=[];try{g=Ext.decode(w)}catch(e){}Ext.each(g,function(e){a.push("<b>"+e.text+'</b><font color="#a0a0a0">('+e.code+")</font>")}),N=a.join("</br>")}break;case"dateformat":try{var h=[];Ext.each(w.split(","),function(e){h.push(Ext.Date.format(Ext.Date.parse(e,o.submitFormat),o.format))}),N=h.join(",")}catch(e){N=w}break;case"multiRows":N=w.replaceAll("\n","<br/>"),S.style+="word-wrap:break-word; word-break:normal;overflow:visible;white-space:normal";break;case"tip":S.tdAttr+='data-qtip="'+Ext.htmlEncode(N)+'" data-qtip-type="grid"';break;case"link":D.hasListener("linkclick")&&(N='<span class="link-text">'+N+"</span>");break;case"bar":var x=Number(isNaN(w)?0:w),v=JEBarField.getRangeImg(o.configInfo,x);N=JEBarField.getHtmlTpl({width:x,img:v,cls:"je-field-bar-grid"});break;case"star":N='<div class="je-field-star">'+JEStarField.getStarView(w)+"</divb>";break;case"mark":N=JEMarkField.getMarkView(w);break;case"postil":x=JE.toNum(w);N='<div class="je-column-postil '+(0==x?"empty":"")+'">批注('+x+")</div>";break;case"highlighting":var y=JE.Action.getQueryKeyWord(A,D.dataIndex,w);Ext.isEmpty(y)||(N=(N+="").replace(y,"<span style='color:red'>"+y+"</span>"),w==N&&(N=N.replace(y.toUpperCase(),"<span style='color:red'>"+y.toUpperCase()+"</span>")),w==N&&(N=N.replace(y.toLowerCase(),"<span style='color:red'>"+y.toLowerCase()+"</span>")));break;case"merge":if(A.mergesInfo&&A.mergesInfo[D.dataIndex]){var b="";Ext.each(A.fieldsInfo[D.dataIndex],function(e){b+=Ext.value(I.get(e),"").toString()});var C=A.mergesInfo[D.dataIndex][b];C&&("grouping"==_.ftype?C.start==T&&C.start!=C.end?(S.tdAttr+=' style="border-bottom-width:0px;" ',N=""):C.start+1==T?S.tdAttr+=" rowspan = "+(C.end-C.start)+" ":T>C.start+1&&T<=C.end&&(S.tdAttr+=' style="display:none;" '):"groupingsummary"==_.ftype?C.start==T&&C.start!=C.end?(S.tdAttr+=' style="border-bottom-width:0px;" ',N=""):C.start+1==T?(S.tdAttr+=" rowspan = "+(C.end-C.start-1)+" ",S.tdAttr+=' style="border-bottom-width:0px;" '):T>C.start+1&&T<C.end?S.tdAttr+=' style="display:none;" ':T==C.end&&C.start!=C.end&&(N=""):C.start==T?S.tdAttr+=" rowspan = "+(C.end-C.start+1)+" ":T>C.start&&T<=C.end&&(S.tdAttr+=' style="display:none;" '))}}}),JE.isNotEmpty(S.tdAttr)){var i=S.tdAttr,a=S.tdAttr.match(/style=\".*?\"/g);if(JE.isNotEmpty(a)&&1<a.length){var n="";Ext.each(a,function(e){n+=e.substring(7,e.length-1)+";",i=i.replaceAll(e,"")}),i+=' style="'+n+'"',S.tdAttr=i}}return N},editCKEditorVal:function(e,t,i){var a=Ext.getCmp(e),n=a.store.getById(t),o=n.get(i);a.funcData.info.funcAction,a.funcData.info.tableName,JE.win({title:JE.local.lang.core.util.RendererUtil.ckEditorTitle,useButton:!0,border:0,items:{xtype:"ckeditor",value:o},fn:function(e){o=e.items.get(0).getValue(),n.set(i,o)}}).show()},buildRendererTDStyle:function(e){var t="";return JE.isNotEmpty(e.rightBorderColor)&&(t+="border-right-color:"+e.rightBorderColor+";"),JE.isNotEmpty(e.bottomBorderColor)&&(t+="border-bottom-color:"+e.bottomBorderColor+";"),JE.isNotEmpty(e.altRowBGColor)&&e.rowIndex%2!=0&&(t+="background-color: "+e.altRowBGColor+";"),JE.isNotEmpty(t)&&(t=' style="'+t+'"'),t}}),Ext.define("JE.util.ReportUtil",{constructor:function(e){e=Ext.apply({},e),this.view=e.view},fn:{sum:function(e,t){return Ext.Array.sum(this.buildData(e,t))},min:function(e,t){return Ext.Array.min(this.buildData(e,t))},max:function(e,t){return Ext.Array.max(this.buildData(e,t))},count:function(e,t){return this.buildData(e,t).length},avg:function(e,t){var i=Ext.Array.mean(this.buildData(e,t));return i=Number(Ext.util.Format.number(i,"0.00"))},params:function(e){return"'"+Ext.value(this.reportConfig.params[e],"")+"'"},dic:function(e,t){if(JE.isEmpty(e))return[];Ext.isString(t)||(t="text");var i=JE.getDicItems(e),a=(t=Ext.value(t,"text"),[]);return Ext.each(i,function(e){a.push(e[t])}),a},chart:function(){var e=arguments[0],t=arguments[1],i=arguments[2],a=arguments[arguments.length-1];if(JE.isNotEmpty(e)){Ext.isObject(t)&&(a=t,t=null),Ext.isObject(i)&&(a=i,i=null);var n="",o=[];if(4<arguments.length){for(var r={},l=3;l<arguments.length-1;l++){var s=arguments[l].split("."),d=(s[0],s[1]);if(a.objDS)r[d]=a.objDS[d];else{var c=!1;Ext.each(a.groups,function(e){if(e.fieldName==d)return r[d]=e.value,!(c=!0)}),c||(r[d]=this.buildData(arguments[l],a)[0])}}Ext.iterate(r,function(e,t){n+=" params-"+e+"='"+t+"'",o.push(e)})}return'"<div chartdiv chartCode='+e+" width="+Ext.value(t,200)+" height="+Ext.value(i,100)+" "+n+" paramsKeys = '"+o.join(",")+"'></div>\""}return""},header:function(){for(var e=[],t=0;t<arguments.length-1;t++)e.push(arguments[t]);return 1<e.length?"\"<div headerdiv headers='"+JE.encodeURI(e.join(","))+"'></div>\"":Ext.value(e[0],"")}},buildData:function(e,a){var t=[],n=Ext.value(a.groups,[]),o=(Ext.value(a.objDS,{}),"");if(Ext.isArray(e))t=e;else if(Ext.isString(e)){var i=e.split("."),r=i[0];if(o=i[1],this.dataSource[r])t=this.dataSource[r];else if(Ext.isEmpty(o)){o=r;var l=this.configInfo.tds[o];t.push(this.computeFormula(l.formula,n,l.defaultValue))}}var s=[];return Ext.each(t,function(t){var e=0;if(Ext.isObject(t)){var i=0;Ext.each(n,function(e){t[e.fieldName]==e.value&&i++}),e=i==n.length?t[o]:null}else e=t;null!=e&&(-1!=["group","count"].indexOf(a.formula)?s.push(e):s.push(JE.toNum(e)))}),s},parseTable:function(e){var C=this,t=Ext.DomQuery.select("table",e),w=new Ext.util.MixedCollection;return Ext.each(t,function(e,t){for(var i={name:"__table__"+t,rows:[],html:"",group:!1,bindingDS:e.getAttribute("data-bindingDS")},a=[],n=0,o=e.rows.length,r=0;r<o;r++){var l=[];0==n&&Ext.each(e.rows[0].cells,function(e){n+=Number(e.colSpan,"1")});for(var s=0;s<n;s++)l.push({rowIndex:r,cellIndex:s,empty:!0,hGroups:[],vGroups:[]});a.push({cells:l,html:""})}i.cellNum=n,i.rowNum=o;for(r=0;r<a.length;r++){var d=a[r],c=e.rows[r],u=0,p=!1;for(s=0;s<d.cells.length;s++){var f=d.cells[s],E=c.cells[u];if(!f.mark&&E){var m={hGroups:[],vGroups:[],rowIndex:f.rowIndex,cellIndex:f.cellIndex,colSpan:Number(E.colSpan,"1"),rowSpan:Number(E.rowSpan,"1"),code:JE.uuid(),html:E.outerHTML,obj:Ext.clone(E)},g=E.getAttribute("data-code");if(g){var h=C.configInfo.tds[g];Ext.apply(m,h)}-1==["V","DATA"].indexOf(m.to)&&!p||"1"!=m.group?m.group="0":i.group=!0,p&&i.group&&JE.isNotEmpty(m.groupSummary)&&(i.groupSummary=!0),"DATA"==m.to?p=!0:-1!=["V","H"].indexOf(m.to)&&("group("==m.formula.substring(0,6)?m.formula=m.formula.substring(6,m.formula.length-1):"dic("==m.formula.substring(0,4)&&(m.formula=m.formula.substring(4,m.formula.length-1),m.dicCode=m.formula.split(",")[1],m.dicItemCode=m.formula.split(",")[2],m.formula=m.formula.split(",")[0]),m.fieldName=m.formula);for(var x=0;x<m.rowSpan;x++)for(var v=0;v<m.colSpan;v++)if(0!=x||0!=v){var y=a[r+x].cells[s+v];y&&(y.mark=!0,y.ref=m.code,y.to=m.to)}d.cells.splice(s,1,m),s+=m.colSpan-1,u++}}jQuery(c).html("{_value_}"),a[r].html=c.outerHTML,p=!1}jQuery(e).html("{_value_}"),i.html=e.outerHTML,i.rows=a;var b=document.createTextNode("{"+i.name+"}");e.parentNode.replaceChild(b,e),w.add(i.name,i)}),w},parseConfigInfo:function(e){var n=this,u={tds:{},objs:{}},p=["code","text","formula","to","editable","field","group","groupField","groupFieldTpl","groupSummary","defaultValue"],t=Ext.DomQuery.select("input[type=button][reportBtn]",e);if(Ext.each(t,function(i){var e=i.getAttribute("data-code"),t=i.parentNode,a={};Ext.each(p,function(e){a[e]=i.getAttribute("data-"+e)}),a.defaultValue=Ext.value(a.defaultValue,0);var n=document.createElement("span");Ext.each(["fontSize","fontFamily","fontWeight","color"],function(e){var t=i.getAttribute("data-"+e);JE.isNotEmpty(t)&&(n.style[e]=t)}),a.style=n.getAttribute("style");var o=document.createTextNode("{"+e+"}");t.replaceChild(o,i);for(var r,l=5,s=t;0<l&&s;){if("TD"==s.nodeName){r=s;break}s=s.parentNode,l--}if(r){var d=r.getAttribute("data-code");if(JE.isEmpty(d))r.setAttribute("data-code",e);else{var c=Ext.value(r.getAttribute("data-codes"),[]);JE.isNotEmpty(c)&&(c=c.split(",")),c.push(e),r.setAttribute("data-codes",c.join(","))}u.tds[e]=a}else u.objs[e]=a}),n.configInfo=u,!n.reportConfig.ds){n.reportConfig.ds={};var i=JE.ajax({url:JE.getUrlMaps("je.core.load"),params:{tableCode:"JE_CORE_DATASOURCE",whereSql:"and JE_CORE_DATASOURCE_ID in('"+n.reportConfig.dsIds.replaceAll(",","','")+"')",limit:-1}}).rows;Ext.each(i,function(e){n.reportConfig.ds[e.DATASOURCE_CODE]=JE.getChartDS(e)})}var o={},r=Ext.clone(n.reportConfig.params),l=n.reportConfig.doPageAct;Ext.iterate(n.reportConfig.ds,function(e,t){if(!o[e])if(Ext.value(t.pageDS,n.reportConfig.bindDS)==e)if("loadPage"==l){var i=n.reportConfig.doPageSize,a=n.reportConfig.doPageIndex;r.limit=i,o[e]=t[l](a,r)}else r.limit=Ext.value(r.limit,t.pageSize),o[e]=t[l](r);else o[e]=t.load(r)}),n.dataSource=o},computeNewTable:function(e,n,o){var r=this,t=[],l=0,s=0,d={};return Ext.each(e.rows,function(e,i){var a=[];Ext.each(e.cells,function(e){if(!e.empty&&e.obj){var t=Ext.value(e.html,"");e.num=d,t=r.computeCell(e,i,n,o),a.push(t),0==i&&(l+=Number(e.obj.width,"0"),s+=e.colSpan)}}),t.push(e.html.replace("{_value_}",a.join("")))}),l-=4,t.push('<tr height=0 ><td colspan="'+s+'" style="border-color:transparent;padding:0px;"><div style="width:'+l+'px"></td></td></tr>'),e.html.replace("{_value_}",t.join(""))},computeCell:function(i,s,d,c){var u=this,p=i.obj.cloneNode(!0);if(p.rowSpan=i.rowSpan,p.colSpan=i.colSpan,!Ext.isEmpty(i.code)){var f=p.innerHTML,E="&nbsp;",m=Ext.value(i.hGroups,[]).concat(Ext.value(i.vGroups,[])),a=[i],e=p.getAttribute("data-codes");JE.isNotEmpty(e)&&Ext.each(e.split(","),function(e){var t=u.configInfo.tds[e];t&&(t.num=i.num,a.push(t))}),Ext.each(a,function(e){if("NUM"==e.to&&(e.num[e.code]=JE.isNotEmpty(d)?c:Ext.value(e.num[e.code],0),e.num[e.code]++,e.value=e.num[e.code]+(u.view.getPageData().fromRecord-1)),JE.isNotEmpty(e.value))E=e.value;else if(JE.isNotEmpty(e.formula)){var t=e.formula.split(".");JE.isNotEmpty(d)?E=d[t[1]]:2==t.length&&u.dataSource[t[0]]||(E=u.computeFormula(e.formula,m,e.defaultValue,d))}else"1"==e.editable&&(E="");if(u.reportConfig.renderer){var i=u.reportConfig.renderer,a={rowIndex:s,configInfo:u.configInfo,dataSource:u.dataSource,info:e,util:u,parentNode:p};E=i(E,a,d,c);var n=a.tdStyle;if(JE.isNotEmpty(n)){var o=p.getAttribute("style")||"";p.setAttribute("style",o+";"+n)}}if("1"==e.editable){var r=e.code;E='<span fieldspan name="{name}" code="'+r+'" value="'+JE.encodeURI(E)+'"></span>',Ext.each(m,function(e){r+="~"+e.value}),E=E.replace("{name}",r)}var l=u.configInfo.tds[e.code];l&&JE.isNotEmpty(l.style)&&(E="<span style='"+l.style+"'>"+E+"</span>"),f=f.replace("{"+e.code+"}",E)}),p.innerHTML=f}return p.outerHTML},parseFn:function(e,t){t=Ext.value(t,0),Ext.isString(e)&&(e=parseFormula(e).items);for(var i=e[t],a=t+1,n=[],o="";a<e.length;a++){var r=e[a];if("argument"==r.type)e[a-1]&&"argument"==e[a-1].type?n.push(""):JE.isNotEmpty(o)&&n.push(o);else{if("function"==r.type&&"stop"==r.subtype){JE.isNotEmpty(o)&&n.push(o);break}if("function"==r.type&&"start"==r.subtype)n.push(this.parseFn(e,a)),a=o.index;else{o="";for(var l=a;l<e.length;l++){var s=e[l];if("argument"==s.type||"function"==s.type&&"stop"==s.subtype){a--;break}o+=s.value,a++}}}}return{index:t+=a,fn:i.value,args:n}},computeFormula:function(e,a,t,i){for(var n=this,o=parseFormula(e),r=(a=Ext.value(a,[]),[]),l=0;l<o.items.length;l++){var s=o.items[l],d=s.value;if("function"==s.type&&"start"==s.subtype){fn=n.parseFn(o.items,l);var c={groups:a,objDS:i};fn.args.push(c),d=n.fn[fn.fn].apply(n,fn.args),"group"==fn.fn&&(d=d.items),l=fn.index}else if("operand"==s.type){var u=s.value.split("."),p=Ext.value(i,n.dataSource[u[0]]),f=u[1];if(1<u.length)d=t,p&&Ext.isObject(p)?d=Ext.value(p[f],d):Ext.each(p,function(t){var i=0;if(Ext.each(a,function(e){t[e.fieldName]==e.value&&i++}),i==a.length)return d=t[f],!1}),Ext.isArray(d)||Ext.isObject(d)?d="'"+Ext.encode(d)+"'":Ext.isNumeric(d)||(d="'"+d+"'");else if(n.configInfo.tds[s.value]){var E=n.configInfo.tds[s.value];d=n.computeFormula(E.formula,a,E.defaultValue,i)}}else"text"==s.type&&(d="'"+s.value+"'");Ext.isArray(d)&&(d="'"+d.join(",")+"'"),r.push(Ext.value(d,0))}var m="";return 0<r.length&&(m=JE.eval(r.join(" "))),Ext.value(m,t)},getFieldValue:function(e,t){var i=[];return Ext.each(t,function(e){i.push({fieldName:e.code,value:e.value})}),this.group(e,{groups:i}).items},group:function(e,t,i,a){var n=[];t=Ext.value(t,{});if(JE.isEmpty(i)){t.formula="group";var o=this.buildData(e,t),r=new Ext.util.MixedCollection;Ext.each(o,function(e){r.get(e)||r.add(e,e)}),n=r.items}else n=this.fn.dic(i,a);return{fieldName:e,items:n}},buildNewTable:function(e){for(var f=this,t=e.rowNum,E=e.cellNum,m=[],r=e.rows,i=0;i<t;i++)for(var a=0;a<E;a++){var n=(L=r[i].cells[a]).colSpan,l=L.rowSpan,s=L.code,d=L.fieldName,c=i,u=a,o=Ext.value(L.hGroups,[]).concat(Ext.value(L.vGroups,[]));if("H"!=L.to||L.hOk)if("V"!=L.to||L.vOk){if("DATA"==L.to){a=E;m=[];var p=L.formula.split(".")[0],g=f.dataSource[p],h=r[i],x=Ext.value(L.groupField,"").split(".")[1],v=L.groupFieldTpl,y="",b=0,C=L.groupSummary,w="padding:4px;border-color:"+L.obj.style.borderColor+";";Ext.each(g,function(e,t){for(var i={html:h.html,cells:[]},a=0,n=[],o=0;o<E;o++){var r=Ext.clone(h.cells[o]),l="";JE.isEmpty(r.formula)||(r.ready=!0,r.value=e[r.formula.split(".")[1]],l=r.value),n.push({value:l}),"1"==r.group&&(r.vGroups=Ext.clone(n)),i.cells.push(r),a+=r.colSpan}if(x&&v&&y!=e[x]){y=e[x];var s=document.createElement("TD");s.innerHTML="{__"+x+"__}",s.setAttribute("style",w);l=y;if(v){for(var d=0,c=t;c<g.length&&g[c][x]==l;c++)d++;l=JE.toXT(v,{name:l,count:d})}m.push({html:h.html,cells:[{groupRow:!0,code:"__"+x+"__",colSpan:a,rowSpan:1,value:l,obj:s,vGroups:[]}]}),b++}m.push(i);var u=g[t+1];if(y=e[x],x&&C&&(t==g.length-1||y!=u[x])){var p={html:h.html,cells:[]};for(o=0;o<E;o++){(r=Ext.clone(h.cells[o])).groupCell=!0,r.ready=!0,"1"==r.group?r.formula==r.groupField?r.value=e[x]:r.groupSummary&&(f.fn[r.groupSummary]?r.value=f.fn[r.groupSummary].call(f,r.formula,{formula:r.groupSummary,groups:[{fieldName:x,value:y}]}):r.value=r.groupSummary):r.groupSummary?f.fn[r.groupSummary]?r.value=f.fn[r.groupSummary].call(f,r.formula,{formula:r.groupSummary,groups:[{fieldName:x,value:y}]}):r.value=r.groupSummary:r.value="",p.cells.push(r)}m.push(p),b++}}),r.splice.apply(r,[c,l].concat(m)),t=r.length,i+=g.length-1+b}}else{S=f.group(d,{groups:o},L.dicCode,L.dicItemCode);var m=[];Ext.each(S.items,function(e,t){for(var i=c;i<c+l;i++){for(var a={html:r[i].html,cells:[]},n=0;n<E;n++){var o=Ext.clone(r[i].cells[n]);n==u?(o.ready=!0,o.vOk=!0,o.value=e):u<n&&o.vGroups.push({code:s,value:e,formula:d,ds:d.split(".")[0],fieldName:d.split(".")[1]}),a.cells.push(o)}for(n=0;n<u;n++)a.cells[n].rowSpan>a.cells[u].rowSpan&&(a.cells[n].rowSpan+=S.items.length-1,0<t&&(a.cells[n].empty=!0));m.push(a)}}),0<m.length&&r.splice.apply(r,[c,l].concat(m)),t=r.length}else{for(var S=f.group(d,{groups:o},L.dicCode,L.dicItemCode),I=0;I<t;I++){for(var T=[],_=r[I].cells[u],J=Ext.value(_.code,_.ref),D=u,A=u;0<=A;A--)if(r[I].cells[A].code==J){D=A;break}if((_=r[I].cells[D]).colSpan>n||I<c){var N=(S.items.length-1)*n;_.colSpan+=N;var O=Number(Ext.value(L.obj.getAttribute("width"),"0")),R=Number(Ext.value(_.obj.getAttribute("width"),"0"));0<O&&0<R&&_.obj.setAttribute("width",R+O*N);for(A=0;A<N;A++)T.push({rowIndex:I,cellIndex:D+A,empty:!0,hGroups:[],vGroups:[],mark:!0,ref:_.code});r[I].cells.splice.apply(r[I].cells,[D+1,0].concat(T))}else Ext.each(S.items,function(e){for(var t=u;t<u+n;t++){var i=Ext.clone(r[I].cells[t]);I==c?(i.ready=!0,i.hOk=!0,i.value=e,T.push(i)):c<I&&(i.hGroups.push({code:s,value:e,formula:d,ds:d.split(".")[0],fieldName:d.split(".")[1]}),T.push(i))}}),r[I].cells.splice.apply(r[I].cells,[u,n].concat(T))}a+=S.items.length*n-1,E=r[i].cells.length}}if(e.cellNum=E,e.rowNum=t,e.group)for(i=0;i<t;i++)for(a=0;a<E;a++){var L;if((L=r[i].cells[a])&&"1"==L.group){c=i,u=a;var P=L.value,M=(l=L.rowSpan,L.vGroups);for(I=c+1;I<t;I++){var F=r[I].cells[u];if(F&&!F.empty){var k=!0;Ext.each(F.vGroups,function(e,t){if(!M[t]||M[t].value!=e.value)return k=!1}),"1"!=F.group&&(k=!1),k&&F.value==P?(F.group="0",F.empty=!0,r[c].cells[u].rowSpan+=F.rowSpan):(l=F.rowSpan,M=F.vGroups,P=F.value,c=I)}}}}return e},doReport:function(e){var n=this;n.reportConfig=Ext.value(e,{});var t=document.createElement("DIV");t.innerHTML=Ext.value(n.reportConfig.htmlTpl,n.htmlTpl),n.parseConfigInfo(t);var i=n.parseTable(t),o=t.innerHTML;return Ext.iterate(n.configInfo.objs,function(e,t){if(JE.isNotEmpty(t.formula)){var i=n.computeFormula(t.formula,[],"");Ext.isArray(i)&&(i=i.join(",")),o=o.replace("{"+e+"}",i)}else if("1"==t.editable){var a='<span fieldspan name="'+t.code+'" code="'+t.code+'"></span>';o=o.replace("{"+e+"}",a)}else{i=(0,n.reportConfig.renderer)("",{configInfo:n.configInfo,dataSource:n.dataSource,info:t,util:n});o=o.replace("{"+e+"}",i)}}),i.each(function(e){var i=n.buildNewTable(e),a=[],t=Ext.value(n.dataSource[e.bindingDS],[{}]);Ext.each(t,function(e,t){a.push(n.computeNewTable(i,e,t))}),o=o.replace("{"+e.name+"}",a.join("</br>"))}),JE.getUEditorBox(o)},renderer:function(e,t){return e},formulaTypes:{noop:"无操作",operand:"变量",function:"方法",subexpression:"子运算试",argument:"参数","operator-prefix":"运算符-前缀","operator-infix":"运算符-中缀","operator-postfix":"运算符-后缀","white-space":"空格",unknown:"未知",start:"开始",stop:"结束",text:"文字",number:"数字",logical:"逻辑",error:"错误",range:"并列",math:"公式",concatenate:"连接",intersect:"交集",union:"并集"}}),Ext.define("JE.util.Transaction",function(){return{tasks:null,begin:function(){this.tasks=new Ext.util.HashMap},addTask:function(e,t){if(this.tasks)return this.tasks.add(e,t),this;JE.error("事务还没有begin,请先开始事务.")},end:function(){var i=new Array;if(this.tasks.each(function(e,t){if(1!=function(e,t){if("sql"!=e&&t&&Ext.isEmpty(t.tableCode))return JE.error("请在"+e+"操作传入表名(tableCode),格式为{tableCode:表名....}!"),!1;switch(e){case"insert":if(!t.values)return JE.error("请传入保存数据的字段值,格式为{tableCode:表名,values:{TEST_NAME:''}}"),!1;break;case"remove":if(!t.whereSql)return JE.error("请传入删除的whereSql.格式为{tableCode:表名,whereSql:删除条件}"),!1;break;case"removeByIds":if(!t.ids)return JE.error("请传入删除的主键值,格式为{tableCode:表名,ids:主键1,主键2}."),!1;break;case"update":if(!t.values)return JE.error("请传入修改数据的字段值,格式为{tableCode:表名,values:{主键名：主键值,字段1:值}}"),!1;break;case"updateBatch":if(!t.values||!t.whereSql)return JE.error("请传入修改数据的字段值和whereSql,格式为{tableCode:表名,values:{字段1:值},whereSql:修改条件}."),!1;break;case"sql":if(!t)return JE.error("请传入需执行的SQL"),!1;break;default:return JE.error(e+"不是合法的关键字,合法的关键字有(insert、remove、removeByIds、update、updateBatch、sql)"),!1}return!0}(e,t))return!1;i.push({taskKey:e,config:t})}),i.length<=0)return!1;var e=JE.ajax({url:JE.getUrlMaps("je.core.dbsql","doTrans"),params:{strData:Ext.encode(i)}});return i=void 0,this.tasks=null,!!e.success}}}),Ext.define("JE.util.Util",{initIM:function(){"1"==JE.systemConfig.JE_IM_ENABLE&&(window._im_option_={userId:JE.USER.userId},JE.loadScript(["/plugin/im/index.min.css","/plugin/im/index.min.js"]))},getFileThumbnail:function(e,t){if(JE.isNotEmpty(e)&&JE.isNotEmpty(t)){var i=e[t.styleConfig],a=t.width,n=t.height,o="";if(JE.isNotEmpty(i))i=Ext.JSON.decode(i),JE.toNum(i.width)<JE.toNum(a)&&(a=i.width),JE.toNum(i.height)<JE.toNum(n)&&(n=i.height),o='<img style="'+(i="width:"+a+"px;height:"+n+"px;")+'" src="'+(e[t.imgUrl]||JE.getFileUrl(e[t.imgCdnUrl],"PROJECT",t.imgType,"",t.tableCode))+'" />';else o='<i style="'+("font-size:80px; color:"+JE.getFileIcon(e[t.imgName]).color)+'" class ="'+e[t.icon]+'"></i>';return o}return""},getCurrentUser:function(){return JE.USER},setWestMenuVisible:function(e){var t=Ext.getCmp("_jewestview");t&&"appmenutiled"==t.xtype&&t.setVisible(e)},isSaasAdmin:function(){return"admin"==JE.USER.userCode||-1!=JE.USER.roleNames.indexOf("系统管理员")},initJSandCSS:function(){var e=JE.systemConfig.PROJECT_URL_HASHMAP;e&&JE.loadScript(e);var t=JE.systemConfig.JE_SYS_JS;JE.isNotEmpty(t)&&JE.eval(t);var i=JE.systemConfig.JE_SYS_CSS;JE.isNotEmpty(i)&&Ext.util.CSS.createStyleSheet(i)},getPlusInfo:function(){return JE.split(JE._plusinfo,",")},getFileIcon:function(e){var t=e.split(".").pop().toLocaleLowerCase(),i="unknownfile",a="a9aba9";return-1!=["doc","docx"].indexOf(t)?(i="word",a="0057aa"):-1!=["xls","xlsx"].indexOf(t)?(i="excel",a="00843e"):-1!=["ppt","pptx"].indexOf(t)?(i="ppt",a="f34e19"):-1!=["rar","zip","arj","gz","z"].indexOf(t)?(i="zip",a="fbaf32"):-1!=["bmp","gif","jpg","pic","png","tif","jpeg"].indexOf(t)?(i="image",a="FF7744"):"pdf"==t?(i="pdf",a="e52c0e"):"txt"==t&&(i="txt",a="2ba244"),{type:i,icon:"jeicon jeicon-"+i,color:"#"+a,html:'<svg class="jeicon" aria-hidden="true"><use xlink:href="#jeicon-'+i+'"></use></svg>'}},getUserPhoto:function(){var e=arguments[0],t=arguments[1];if(Ext.isBoolean(e)&&(t=e,e=""),e=Ext.value(e,JE.USER.userId),!JE.__USERS__){JE.__USERS__={};var i=JE.ajax({url:JE.getUrlMaps("je.core.rbac.user.loadUserInfo")});Ext.each(i,function(e){JE.__USERS__[e.USERID]=JE.__USERS__[e.USERCODE]={id:e.USERID,code:e.USERCODE,name:e.USERNAME,photo:e.PHOTO,photoUrl:e.PHOTOURL}})}var a=JE.__USERS__[e]||{},n=a.photoUrl;if(!n&&a.photo&&(n=a.photo,n=0==(n=JE.split(n,"*")[1]).indexOf("data:image/")?n:JE.getFileUrl(n)),t){if(JE.isNotEmpty(n))return'<img class="je-user-photo photo-img" src="'+n+'">';var o=a.name||"";return'<div class="je-user-photo photo-text">'+(o=2<o.length?o.substring(o.length-2):o)+"</div>"}return n},getStaticUrl:function(e,t){t=t||"image";var i=(JE.static||{})[t];return JE.buildCdnUrl(i&&i[e])},getOnlineInfo:function(e,t){var i=window.__online_info__||{},a=i[e];if(a)return-1!=["cdn_router","cdn-exclude","hash_map"].indexOf(e)&&Ext.isString(a)&&(a=i[e]=Ext.decode(a)),t?a[t]:a},buildCdnUrl:function(i){if(i.startsWith("http"))return i;i=i.startsWith("/")?i.substring(1):i;var a=JE.getOnlineInfo("cdn")||"",e=JE.getOnlineInfo("hash_map")||{};if((i=e[i]||i).startsWith("data:image/"))return i;if(i="/"+i,JE.isNotEmpty(e)&&i){var t=JE.getOnlineInfo("cdn_router")||[],n=JE.getOnlineInfo("cdn_exclude")||[];Ext.each(t,function(e){if(i.startsWith(e)){var t=!0;return Ext.each(n,function(e){if(i.startsWith(e))return t=!1}),t&&(i=a+i),!1}})}return a&&-1==i.indexOf(a)&&window.ServerUrl&&(i=window.ServerUrl+i),i},regStr:function(e,t){switch(t){case"phone":t="^([1][3-9]{1})+\\d{9}$";break;case"telphone":t="^((\\d{3,4}-)|\\d{3.4}-)?\\d{7,8}$";break;case"email":t="^\\w+([-+.]\\w+)*@\\w+([-.]\\w+)*\\.\\w+([-.]\\w+)*$";break;case"idcard":t="(^\\d{15}$)|(^\\d{17}([0-9]|X))$"}return!JE.isEmpty(e)&&!JE.isEmpty(t)&&new RegExp(t).test(e)},checkPassword:function(e){var t=0;if(e.length<6)return t;switch(JE.regStr(e,"\\d")&&t++,JE.regStr(e,"[a-z]")&&t++,JE.regStr(e,"[A-Z]")&&t++,JE.regStr(e,"[^a-zA-Z0-9]")&&t++,t){case 1:return 1;case 2:return 2;case 3:return 3;case 4:return 4}},getUrlMaps:function(e){return(JE.urlMaps||{})[e]},showMap:function(e){if(window.BMap){var t={items:{xtype:"uxmap",address:e.address,point:e.point,callback:e.fn},autoShow:!0};delete(e=Ext.apply({title:"地图",width:800,height:600},e)).fn,JE.win(Ext.apply(e,t))}else JE.alert("没有检测到百度地图插件，请检查！")},getDate4Msg:function(e){if(!e||!Ext.isDate(e))return"";var t=Ext.Date.clearTime(e),i=Ext.Date.clearTime(new Date),a=0==(a=i.getDay())?7:a,n=parseInt((i-t)/864e5),o="",r=Math.abs(n),l=new Date,s=new Date;if(l.setDate(l.getDate()-(a-0)),s.setDate(s.getDate()+(7-a)),0==r)o="今天";else if(1==r)o=0<n?"昨天":"明天";else if(t.getTime()>=l.getTime()&&t.getTime()<=s.getTime()){o="周"+["一","二","三","四","五","六","日"][(0==t.getDay()?7:t.getDay())-1]}else o=a-r<=0&&0<a-r+7?0<n?"上周":"下周":0<n?"更早":"近期";return o},decodeUnicode:function(e){return e=e.replace(/\\/g,"%"),unescape(e)},encodeUnicode:function(e){for(var t=[],i=0;i<e.length;i++)t[i]=("00"+e.charCodeAt(i).toString(16)).slice(-4);return"\\u"+t.join("\\u")},decodeHex:function(e){var t,i=e.trim(),a="0x"===i.substr(0,2).toLowerCase()?i.substr(2):i,n=a.length;if(n%2!=0)return alert("Illegal Format ASCII Code!"),"";for(var o=[],r=0;r<n;r+=2)t=parseInt(a.substr(r,2),16),o.push(String.fromCharCode(t));return o.join("")},encodeHex:function(e){if(""===e)return"";for(var t=["0x"],i=0;i<e.length;i++)t.push(e.charCodeAt(i).toString(16));return t.join("")},checkFlash:function(){var e,t=0;if(document.all)(e=new ActiveXObject("ShockwaveFlash.ShockwaveFlash"))&&(t=1,VSwf=e.GetVariable("$version"),parseInt(VSwf.split(" ")[1].split(",")[0]));else if(navigator.plugins&&0<navigator.plugins.length&&(e=navigator.plugins["Shockwave Flash"])){t=1;for(var i=e.description.split(" "),a=0;a<i.length;++a)isNaN(parseInt(i[a]))||parseInt(i[a])}return t},cutImage:function(o){JE.uploadFile({fileTypes:"jpg;png;jpeg;bmp",type:"local",params:{returnType:"all",jeFileType:"PROJECT"},callback:function(n){var e="uxjcrop",a=(n.name,n.docInfo);if(Ext.isIE&&Ext.isIE9m)JE.win({title:o.title||"图像截取",width:500,height:500,autoShow:!0,items:{xtype:e,params:{path:JE.getFileUrl("","","",a.JE_CORE_DOCUMENT_ID)||n.privateUrl,size:o.size},callback:function(e){var t={};o.params?t=Ext.apply(t,o.params):o.userPhoto&&(t={fieldCode:"PHOTO",tableCode:"JE_CORE_ENDUSER",funcCode:"JE_CORE_ENDUSER",pkValue:JE.USER.userId}),t.strData=e,t.fileName=a.DOCUMENT_DOCNAME,t.fileFormat=a.DOCUMENT_FORMAT;var i=JE.ajax({url:"/je/doc/document/doSaveDiyImg",params:t});if(i.success){if(o.callback){e=i.obj;o.callback({docInfo:e,url:e.DOCUMENT_ADDRESS,name:e.DOCUMENT_DOCNAME,size:e.DOCUMENT_DOCSIZE,privateUrl:e.DOCUMENT_PRIVATEKEY})}}else JE.alert("文件保存失败，请稍微再试!")}}});else{var t=new FileReader;t.readAsDataURL(n.files[0]),t.onload=function(){JE.win({title:o.title||"图像截取",width:500,height:500,autoShow:!0,items:{xtype:e,params:{path:this.result,size:n.files[0].size},callback:function(e){var t={};o.params?t=Ext.apply(t,o.params):o.userPhoto&&(t={fieldCode:"PHOTO",tableCode:"JE_CORE_ENDUSER",funcCode:"JE_CORE_ENDUSER",pkValue:JE.USER.userId}),t.strData=e.path,t.fileName=n.files[0].name;var i=JE.ajax({url:"/je/doc/document/doSaveDiyImg",params:t});if(i.success){if(o.callback){var a=i.obj;o.callback({docInfo:a,url:a.DOCUMENT_ADDRESS,name:a.DOCUMENT_DOCNAME,size:a.DOCUMENT_DOCSIZE,privateUrl:a.DOCUMENT_PRIVATEKEY})}}else JE.alert("文件保存失败，请稍后再试!")}}})}}}})},_BADGES:{},loadBadge:function(e,i){if("plus"==JE.getTheme()){var t={};JE.isNotEmpty(e)&&(t.funcCode=e),JE.ajax({url:JE.getUrlMaps("je.core.menu.loadBadge"),params:t,async:!0,success:function(e){var t=Ext.decode(Ext.value(e.responseText,"{}"));0!=t.success&&(Ext.iterate(t,function(e,t){if(JE.isNotEmpty(t)){t.cls=Ext.value(t.cls,"");var i=Ext.value(JE._BADGES[e],t),a=i.num=t.num;t.cls&&0==t.cls.indexOf("num-")?i.cls=t.cls.replaceAll("num-","badge-"):JE.isNotEmpty(t.cls)&&(i.cls="badge-"+t.cls),i.cls=Ext.value(i.cls,"badge-blue"),JE._BADGES[e]=i,JE.loadBadgeById(e,a);var n=i.parent||[];Ext.each(n,function(e){var t=JE._BADGES[e];if(t){var i=0;Ext.each(t.menus.split(","),function(e){var t=JE._BADGES[e];t&&(i+=JE.toNum(t.num))}),JE.loadBadgeById(t.id,i)}})}}),i&&i(t))}})}},loadBadgeById:function(i,a){var e=Ext.getCmp("_jewestview"),t=Ext.getCmp("_appcenterview"),n=JE._BADGES[i];if("plus"==JE.getTheme()&&!JE.isEmpty(i)&&!JE.isEmpty(n)){a=JE.toNum(Ext.value(a,n.num));if(e)if("appmenutiled"==e.xtype)e.loadBadge(i,a);else{var o=e.menu;e.items.each(function(e){var t=e.store.getNodeById(i);t&&t.set("nodeInfo",a)}),o&&o.items.each(function(e){var t=e.store.getNodeById(i);if(t)return t.set("nodeInfo",a),!1})}var r=Ext.getCmp("app-topmenu");if(r){var l=r.getCmp(i);if(l){var s=l.initialConfig.text;if(0<a)s+='<div class="badge '+Ext.value(n.cls,"")+'" style="'+Ext.value(n.style,"")+'">'+a+"</div>";l.setText(s)}r.menu&&r.menu.items.each(function(e){var t=e.store.getById(i);if(t)return t.set("nodeInfo",a),!1})}var d=Ext.getCmp("app-shortcutview");if(d){var c=d.store.getById(i);c&&(c.set({num:n.num,numCls:n.cls,numStyle:n.style}),c.commit())}if(t&&t.getCmp(i)){var u=t.getCmp(i),p=u.initialConfig.title;if(0<a)p+='<div class="badge '+Ext.value(n.cls,"")+' active" style="'+Ext.value(n.style,"")+'">'+a+'</div><div class="badge unactive">'+a+"</div>";u.setTitle(p),0==a&&u.tab&&u.tab.btnInnerEl&&u.tab.btnInnerEl.setStyle("padding-top","0px")}}},lockAPP:function(e){var t=Ext.getCmp("je-app-viewport").getCmp("applockview").lockField;t.inputEl.dom.setAttribute("type","text"),t.reset();var i=JE.currentUser.locked=0==e?"0":"1";Ext.getCmp("je-app-viewport").getLayout().setActiveItem(JE.toBool(i)?"applockview":"appmainview"),JE.ajax({url:JE.getUrlMaps("je.core.rbac.user","updateUserLocked"),async:!0,params:{locked:i}})},sendTransaction:function(e){(e=e||{}).titleText=Ext.value(e.title,"");var t=e.winCfg||{};delete e.title,delete e.winCfg,JE.win({title:"任务交办",width:t.width||940,height:t.height||JE.getBodyHeight()-150,border:0,autoShow:!0,items:Ext.apply({xtype:"jetpview"},e),showFn:e.showFn})},showTransaction:function(e,t,i){var a,n=e||{};if(Ext.isString(e)){if(n=JE.ajax({url:JE.getUrlMaps("je.core.getInfoById"),params:{tableCode:"JE_SYS_JOB",pkValue:e}}),JE.isEmpty(n))return void JE.alert("任务不存在！")}else e.isModel&&(a=e);JE.win({title:"任务内容",autoShow:!0,width:750,height:-1!=["send","sendchild"].indexOf(t)?550:400,items:{xtype:"jetpinfoview",initData:n,record:a,viewType:t,callback:i}})},sendSMS:function(e){var t=(e=e||{}).title||(JE.isEmpty(e.phone)?"公司成员短信发送":"手机号短信发送");delete e.title,JE.win({title:t,width:940,height:680,border:0,autoShow:!0,items:Ext.apply({xtype:"jesmsview"},e)})},sendEmail:function(e){var t=(e=e||{}).title||"邮件发送";e._title=e.title,delete e.title;var i=e.email||[];if(JE.isNotEmpty(i)){if(e.type=e.type||"SYS","USER"==e.type){var a=JE.ajax({url:JE.getUrlMaps("je.core.load"),params:{tableCode:"JE_SYS_EMAILCONFIG",whereSql:" and EMAILCONFIG_GSR_ID = '"+JE.USER.userId+"'",orderSql:" order by SY_ORDERINDEX",limit:-1}}).rows;Ext.each(a,function(e,t){i.push({text:e.EMAILCONFIG_ZHMC,code:e.EMAILCONFIG_YXDZ})})}else{var n=JE.systemConfig.JE_SYS_EMAIL_USERNAME;JE.isNotEmpty(n)&&i.push({text:n,code:n})}if(JE.isEmpty(i))return JE.alert("发件人信息为空，请检查配置！"),!1}e.emailSend=i;var o=e.callback;delete e.callback,JE.win({title:t,border:0,autoShow:!0,items:Ext.apply({xtype:"jeemailview"},e),showFn:function(e){o&&o(e)}})},doButtonLog:function(e){if("1"==JE.systemConfig.JE_SYS_BTNLOG&&JE.isNotEmpty(e.funcCode)){var t=-1==["gridInsertBtn","gridEditBtn","gridUpdateBtn","gridRemoveBtn","gridDisabledBtn","gridExportXLSBtn","formSaveBtn","formNewBtn","formCopyBtn","formBackBtn","actionUpdate","actionEdit","actionRemove","actionAdd"].indexOf(e.code)?"02":"01",i={funcName:e.funcName,funcCode:e.funcCode,funcId:e.funcId,btnId:e.button_id,btnName:e.text||e.tooltip,btnTypeName:JE.toDicText("JE_FUNC_BUTTONTYPE",e.type),btnTypeCode:e.type,btnNatureName:JE.toDicText("JE_FUNC_BUTTONNATURE",t),btnNatureCode:t};JE.ajax({url:JE.getUrlMaps("je.core.btnlog","insertBtnLog"),async:!0,params:i})}},showColor:function(i){JE.loadScript(["/static/ux/spectrum/spectrum.css","/static/ux/spectrum/spectrum.js"]);var e=jQuery(i.dom).spectrum({palette:Ext.value(i.colors,[["#000000","#434343","#666666","#999999","#b7b7b7","#cccccc","#d9d9d9","#efefef","#f1f1f1","#ffffff"],["#980000","#ff0000","#ff9900","#ffff00","#00ff00","#00ffff","#4a86e8","#0000ff","#9900ff","#ff00ff"],["#e6b8af","#f4cccc","#fce5cd","#fff2cc","#d9ead3","#d9ead3","#c9daf8","#cfe2f3","#d9d2e9","#ead1dc"],["#dd7e6b","#ea9999","#f9cb9c","#ffe599","#b6d7a8","#a2c4c9","#a4c2f4","#9fc5e8","#b4a7d6","#d5a6bd"],["#cc4125","#e06666","#f6b26b","#ffd966","#93c47d","#76a5af","#6d9eeb","#6fa8dc","#8e7cc3","#c27ba0"],["#a61c00","#cc0000","#e69138","#f1c232","#6aa84f","#45818e","#3c78d8","#3d85c6","#674ea7","#a64d79"],["#85200c","#990000","#b45f06","#bf9000","#38761d","#134f5c","#1155cc","#0b5394","#351c75","#741b47"],["#5b0f00","#660000","#783f04","#7f6000","#274e13","#0c343d","#1c4587","#073763","#20124d","#4c1130"]]),allowEmpty:!0,chooseText:"确定",cancelText:"取消",showInitial:!0,showPalette:!0,showSelectionPalette:!0,maxPaletteSize:10,preferredFormat:"hex",showInput:!0,change:function(e){var t=Ext.isEmpty(e)?"":e.toHexString();i.callback&&i.callback(t)}});return 0!=i.autoShow&&Ext.defer(function(){e.spectrum("show"),e.spectrum("set",i.value)},100),e},bytesToSize:function(e){if(0===e)return"0 B";var t=Math.floor(Math.log(e)/Math.log(1024));return(e/Math.pow(1024,t)).toPrecision(3)+" "+["B","KB","MB","GB","TB","PB","EB","ZB","YB"][t]},getIconCls:function(e,t,i,a){if(!JE.isEmpty(e)){t=Ext.value(t,"iconCls"),i=Ext.value(i,"fontIconCls");var n=Ext.value(e[t],a);return"plus"==JE.getTheme()&&(n=Ext.value(e[i],n)),n}},changeTheme:function(e,t,i){if(i&&"leftMenu"==i){var a=["black","white","black-gradual","white-gradual"];Ext.each(a,function(e){Ext.getBody().removeCls("je-menu-"+e)}),-1==a.indexOf(e)&&(e="black"),window._JE_SYS_THEME_LEFTMENU=e,Ext.getBody().addCls("je-menu-"+e)}else{a=["black","blue","red","green","purple","gradual-one","gradual-two","gradual-three","gradual-four","gradual-five"];Ext.each(a,function(e){Ext.getBody().removeCls("je-theme-"+e)}),-1==a.indexOf(e)&&(e="blue"),Ext.getBody().addCls("je-theme-"+e)}if(t){a=Ext.value(JE.currentUser.theme,"blue,black,blue").split(",");i&&"leftMenu"==i?a[1]=e:a[0]=e,JE.ajax({url:JE.getUrlMaps("je.core.rbac.user","doUpdateInfo"),async:!0,params:{tableCode:"JE_CORE_ENDUSER",USERID:JE.currentUser.userId,THEME:a.join(",")}})}},getTheme:function(){return"plus"},split:function(e,t){return JE.isEmpty(e)?[]:e.split(t)},getLodop:function(e){return JE.loadScript("/static/ux/Lodop6/LodopFuncs.js"),getLodop(e)},loadScript:function(e,t,i){var a=this;a.loadedScripts=a.loadedScripts||{};var n=Ext.isArray(e)?e:[e],o=[],r=[];Ext.each(n,function(e){a.loadedScripts[e]||(-1!=e.indexOf(".js")?o.push(e):r.push(e),a.loadedScripts[e]=e)});i=i,t=t;Ext.isBoolean(t)&&(i=t,t=Ext.emptyFn),0<r.length&&Ext.require(r,t),0<o.length&&(i?Ext.require(o,t):Ext.syncRequire(o,t)),JE.isEmpty(r)&&JE.isEmpty(o)&&t&&t()},getLocalLang:function(e,t){if(!JE.local)return{};var i=JE.eval("JE.local.lang."+e);return t&&Ext.applyIf(i,JE.local.lang.common),Ext.value(i,{})},zipImage:function(l){if("undefined"!=typeof FileReader){var e="__je_single_file_image",t=Ext.get(e);t&&t.remove(),(t=Ext.getBody().insertHtml("afterBegin","<input type='file' style='position: absolute;height:0px;left:-500px;top:-500px;'  accept='image/*' id='"+e+"'>",!0)).on("change",function(e,t){var a=Ext.value(l.quality,.5),n=Ext.value(l.maxSize,0),o=t.files[0],r=o.type;if(/image\/\w+/.test(r)){var i=new FileReader;i.readAsDataURL(o),i.onload=function(e){var t=e.target.result,i=new Image;i.src=t,i.onload=function(){var e=document.createElement("canvas"),t=1;0<n&&(this.width>n||this.height>n)&&(t=this.width>this.height?n/this.width:n/this.height),e.width=this.width*t,e.height=this.height*t,e.getContext("2d").drawImage(this,0,0,e.width,e.height);var i=e.toDataURL(r,a);l.callback&&l.callback({url:i,name:o.name,size:o.size})}}}else JE.alert("请选择图片格式文件!")}),t.dom.click()}else JE.alert("您的浏览器不支持图片压缩，请选择主流浏览器！")},uploadFile:function(t){if(!JE.isEmpty(t)){Ext.isFunction(t)&&(t={callback:t});var n=Ext.apply({uploadUrl:JE.getUrlMaps("je.core.uploadFile"),uploadFieldName:"formUploadFiles",uploadFilePath:"",fileCount:0,fileTypes:"*"},t);n.uploadUrl=JE.replaceOldUrl(n.uploadUrl);var i=[];Ext.each(Ext.value(n.fileTypes,"*").split(";"),function(e){i.push("*."+e)}),n.fileTypes=i.join(";");var o=Ext.apply({filePath:n.uploadFilePath,uploadableFields:n.uploadFieldName,jeFileType:n.jeFileType||"PROJECT"},Ext.value(n.params,{}));if(o.jeFileType=o.jeFileType||"PROJECT",t.multiSelect){n.fileCount=n.multiSelect?n.fileCount:1;var e=JE.win({title:JE.local.lang.core.util.Util.uploadFileTitle,width:Ext.value(n.width,500),height:Ext.value(n.height,200),items:{xtype:"uploadpanel",file_types:n.fileTypes,file_upload_limit:t.fileSize?t.fileSize:n.fileCount,upload_url:n.uploadUrl+"?login=TRUE",file_post_name:n.uploadFieldName,post_params:o,failure:function(e,t,i){JE.error(t+"\n"+i)},success:function(e,t,i){var a=Ext.decode(Ext.value(t,"{}"),!0);a&&1==a.success?n.callback&&("all"==o.returnType?n.callback({url:a.obj.DOCUMENT_ADDRESS,docInfo:a.obj,name:e.name,size:e.size},a):n.callback({url:a.obj,name:e.name,size:e.size},a)):JE.error(t,t)}}});JE.isNotEmpty(n.x)||JE.isNotEmpty(n.y)?e.showAt([n.x,n.y]):e.show()}else{var a="__je_single_upload_form",r=Ext.get(a);r&&r.remove();var l=JE.format("<form id='{0}' style='position:relative;height:0px;left:-500px;top:-500px;'><input type='file' name='{1}'></form>",a,n.uploadFieldName),s=(r=Ext.getBody().insertHtml("afterBegin",l,!0)).first();s.on("change",function(e,i){var a=i.value.substring(i.value.lastIndexOf("\\")+1,i.value.length);if(JE.isNotEmpty(a)&&"*.*"!=n.fileTypes&&-1==n.fileTypes.split(";").indexOf("*"+a.substring(a.lastIndexOf(".")).toLowerCase()))return alert(JE.format(JE.local.lang.core.util.Util.uploadFileFileTypeAlert,n.fileTypes)),!1;Ext.isIE9m||!t.type||"local"!==t.type?(Ext.getBody().mask("文件上传中..."),Ext.isIE&&Ext.isIE9m&&(o.authorization=Ext.util.Cookies.get("authorization")),Ext.Ajax.request({form:r,url:n.uploadUrl,isUpload:!0,params:o,success:function(e){Ext.getBody().unmask();var t=Ext.decode(e.responseText,!0);t&&t.success?n.callback&&("all"==o.returnType?n.callback({url:t.obj.DOCUMENT_ADDRESS,privateUrl:t.obj.DOCUMENT_PRIVATEKEY,docInfo:t.obj,name:a,size:i.size},t):n.callback({url:t.obj,name:a,size:i.size},t)):JE.error(t&&t.obj,t)}})):n.callback(i)}),s.dom.click()}}},getFileUrl:function(e,t,i,a,n){if(!e&&!a)return e;var o=!1;"PUBLIC"==(t=t||"PROJECT")&&(o=!0,t="PROJECT");var r=[];JE.isNotEmpty(t)&&r.push("jeFileType="+t),JE.isNotEmpty(i)&&r.push("type="+i),JE.isNotEmpty(a)&&r.push("pkValue="+a),JE.isNotEmpty(n)&&r.push("beanTableCode="+n),JE.isNotEmpty(e)&&r.push("path="+e);var l=Ext.util.Cookies.get("authorization");JE.isNotEmpty(l)&&!o&&r.push("authorization="+l);var s=JE.getUrlMaps("je.core.doc.document","doLoadFile"),d=s;return 0<r.length&&(d=s+"?"+r.join("&")),d},printHtml:function(e,t,i){var a=this,n="printArea_";a.printAreaCount=Ext.value(a.printAreaCount,0);var o=Ext.get(n+a.printAreaCount);o&&o.destroy(),a.printAreaCount++;var r=n+a.printAreaCount;iframe=document.createElement("iframe"),iframe.setAttribute("id",r),iframe.setAttribute("style","position:absolute;width:0px;height:0px;left:-500px;top:-500px;"),document.body.appendChild(iframe);var l=iframe.contentDocument||iframe.contentWindow.document;l.open(),l.write(Ext.value(e,"")),l.close();var s=iframe.contentWindow||iframe.contentDocument;s.close(),s.focus(),t?(Ext.getBody().mask(Ext.value(t,JE.local.lang.core.util.Util.printHtmlMask)),Ext.defer(function(){Ext.getBody().unmask(),s.print()},Ext.value(i,1e3))):setTimeout(function(){s.print()},500)},sendMsgTo:function(e,t){},ajax:function(i){var t={};Ext.isString(i)&&(i={url:i});var e={method:"POST",async:!1,success:function(e){t=JE.getAjaxData(e,i.text)},failure:function(e){JE.error(e.responseText,i.url,JE.format(JE.getLocalLang("core.util.Util.ajaxError"),Ext.encode(i.params)))}};if(i.async&&(e={method:"POST"},i.mask)){var a=Ext.value(i.maskCmp,Ext.WindowManager.getActive()),n=a&&"window"==a.xtype?a.getEl():Ext.getBody();n.mask(Ext.value(i.maskMsg,"正在请求，请稍等..."),"je-ajax-mask");var o=!1;Ext.each(["success","failure","callback"],function(e){if(i[e]){o=!0;var t=i[e];i[e]=function(){Ext.callback(t,this,arguments),n.unmask()}}}),o||(i.callback=function(){n.unmask()})}return JE.isEmpty(i.timeout)&&JE.isNotEmpty(JE.systemConfig.JE_CORE_AJAXTIMEOUT)&&(i.timeout=1e3*JE.toNum(JE.systemConfig.JE_CORE_AJAXTIMEOUT)),JE.isNotEmpty(i.url)&&0==i.url.indexOf("/")&&(i.url=i.url.substring(1)),i.url=JE.getUrlMaps(i.url)||i.url,0==i.urlMaps||new RegExp("[.](js|css|json|html)","g").test(i.url)||(i.url=JE.replaceOldUrl(i.url)),e=Ext.apply(e,i),Ext.Ajax.request(e),t},getAjaxData:function(e,t){var i;return JE.isEmpty(e)?i:i=t?Ext.value(e.responseText,""):Ext.decode(Ext.value(e.responseText,"{}"))},saasAjax:function(i){var e="http://jesaas.com/"+i.url,t=i.params||{};t.phone="1",Ext.data.JsonP.request({url:e,params:t,callback:function(e,t){e&&i.callback&&i.callback(t)}})},submit:function(e,i){if(e.getForm().isValid()){var a=i.msgFn,n=i.error;delete i.error;var t={submitEmptyText:!1,failure:function(e,t){if(!n||0!=n(e,t))switch(t.failureType){case Ext.form.action.Action.CLIENT_INVALID:JE.alert(JE.local.lang.core.util.Util.submitClientInvalid,"warn");break;case Ext.form.action.Action.CONNECT_FAILURE:JE.error(JE.local.lang.core.util.Util.submitConnectFailure,i.url,"");break;case Ext.form.action.Action.SERVER_INVALID:a?a(t.result,JE.local.lang.core.util.Util.submitServerInvalid):JE.error(t.result.obj||t.result.message,t.result,"")}}};delete i.msgFn,JE.isEmpty(i.timeout)&&JE.isNotEmpty(JE.systemConfig.JE_CORE_AJAXTIMEOUT)&&(i.timeout=1e3*JE.toNum(JE.systemConfig.JE_CORE_AJAXTIMEOUT)),t=Ext.apply(t,i),e.getForm().submit(t)}},toFixed:function(e){if(20<e||e<0)throw new RangeError(JE.local.lang.core.util.Util.toFixedError);var t=this;if(isNaN(t)||t>=Math.pow(10,21))return t.toString();if(void 0===e||0==e)return Math.round(t).toString();var i=t.toString(),a=i.split(".");if(a.length<2){i+=".";for(var n=0;n<e;n++)i+="0";return i}var o=a[0],r=a[1];if(r.length==e)return i;if(r.length<e){i+=".";for(n=0;n<e-r.length;n++)i+="0";return i}i=o+"."+r.substr(0,e);var l=r.substr(e,e+1);if(5<=parseInt(l)){var s=Math.pow(10,e);i=(i=(parseFloat(i)*s+1)/s).toFixed(e)}return i},toRMBNumber:function(e){var t,i,a,n="",o="零壹贰叁肆伍陆柒捌玖",r="万仟佰拾亿仟佰拾万仟佰拾元角分",l=(e=new String(Math.round(100*e))).length,s=0;if(15<l)return alert("超出计算范围"),"";if(0==e)return n="零元整";r=r.substr(r.length-l,l);for(var d=0;d<l;d++)a=parseInt(e.substr(d,1),10),d!=l-3&&d!=l-7&&d!=l-11&&d!=l-15?0==a?(i=t="",s+=1):s=(i=(t=0!=a&&0!=s?"零"+o.substr(a,1):o.substr(a,1),r.substr(d,1)),0):(0!=a&&0!=s?(t="零"+o.substr(a,1),i=r.substr(d,1),s=0):0!=a&&0==s?(t=o.substr(a,1),i=r.substr(d,1),s=0):(i=0==a&&3<=s?t="":(t="",r.substr(d,1)),s+=1),d!=l-11&&d!=l-3||(i=r.substr(d,1))),n=n+t+i;return 0==a&&(n+="整"),n},message_tpl:'<div class="item"><div class="title">{title}<span class="close">x</span></div><div class="content">{content}</div></div>',msg:function(e,t){e=Ext.value(e,""),t=Ext.value(t,JE.local.lang.core.util.Util.msgTitle);JE.message_msg||(JE.message_msg=Ext.DomHelper.insertFirst(document.body,{cls:"je-message je-message-msg"},!0));var i=JE.toXT(JE.message_tpl,{title:t,content:e}),a=Ext.DomHelper.append(JE.message_msg,i,!0);a.hide(),a.slideIn("t").ghost("t",{delay:1e3,remove:!0})},notice:function(e,t,i,a){e=Ext.value(e,""),t=Ext.value(t,JE.local.lang.core.util.Util.msgTitle),a=Ext.value(a,!0);"0"!=JE.USER.sound&&a&&"0"!=JE.systemConfig.JE_SYS_PLAYAUDIO&&setTimeout(function(){JE.playAudio("/static/ux/media/notice.mp3")}),JE.message_notice||(JE.message_notice=Ext.DomHelper.insertFirst(document.body,{cls:"je-message je-message-notice"},!0));var n=JE.toXT(JE.message_tpl,{title:t,content:e}),o=Ext.DomHelper.append(JE.message_notice,n,!0);o.down(".title .close").on("click",function(){o.remove()}),o.hide(),o.slideIn("b"),0!=i&&o.ghost("b",{delay:Ext.value(i,5e3),remove:!0})},playAudio:function(e,t){if(!JE.isEmpty(e)){e=JE.buildCdnUrl(e);var i=t?"__JE_COMMON_AUDIO_VOICE":"__JE_COMMON_AUDIO",a=document.getElementById(i);if(a){if(!Ext.isIE9m&&0<a.currentTime&&!a.ended)return;document.body.removeChild(a)}return(a=document.createElement(Ext.isIE9m?"embed":"audio")).setAttribute("id",i),a.setAttribute("hidden",!0),a.setAttribute("src",e),Ext.isIE9m?a.setAttribute("autostart",!0):a.setAttribute("autoplay","autoplay"),document.body.appendChild(a),t?a:void 0}},loadI18NScript:function(){window._JE_LOCAL_LANG=Ext.util.Cookies.get("je-local-lang")||"zh_CN","en"==window._JE_LOCAL_LANG?JE.loadScript("/static/js/i18n/je-lang-en.js"):JE.loadScript(["/static/js/i18n/je-lang-zh_CN.js","/static/js/i18n/e-lang-zh_CN.js"])},loadAlertScript:function(){JE.loadScript(["/static/ux/jqueryConfirm/dist/jquery-confirm.min.css","/static/ux/jqueryConfirm/dist/jquery-confirm.min.js","/static/ux/popover/css/popover.css","/static/ux/popover/js/popover.min.js"],!0)},loadChartScript:function(e){e?JE.loadScript(["/static/ux/chart/EChart/4.0/echarts.min.js","/static/ux/chart/EChart/theme/shine.js","/static/ux/chart/EChart/theme/dark.js","/static/ux/chart/EChart/theme/infographic.js","/static/ux/chart/EChart/theme/macarons.js","/static/ux/chart/EChart/theme/vintage.js"]):JE.loadScript(["/static/ux/chart/FusionCharts/FusionCharts.js"])},loadVueScript:function(){},windowTitleNotice:function(e){JE.browser.isFocus||(JE.browser.noticeTitleFn&&JE.browser.noticeTitleFn.clear(),JE.browser.noticeTitle=Ext.value(e,"你有新消息"),JE.browser.noticeTitleFn=JE.defer(function(){if(-1==document.title.indexOf(JE.browser.noticeTitle))document.title="【"+JE.browser.noticeTitle+"】";else{for(var e="",t=0;t<JE.browser.noticeTitle.length;t++)e+="　";document.title="【"+e+"】"}},500))},desktopNotice:function(a,n,o,r,l){JE.windowTitleNotice(n),!JE.browser.isFocus&&window.Notification&&Notification.requestPermission(function(e){if("granted"==e){var t={body:Ext.value(a,"您有一条新消息！"),icon:Ext.value(r,"/JE/data/config/resource/logo.png"),renotify:JE.isNotEmpty(l),tag:l},i=new Notification(Ext.value(n,"消息提醒"),t);i.onclick=function(){window.focus(),o&&o(i)}}})},alert:function(e,t){JE.dialog(e,null,t,{alert:!0,icon:"fa fa-info-circle"})},confirm:function(e,t,i,a,n){JE.dialog(e,t,i,{confirm:!0,icon:"fa fa-question-circle",okText:a,cancelText:n})},prompt:function(e,t,i,a,n){e=Ext.value(e,""),a=Ext.value(a,"");e=['<div class="form-group">',"<label>"+e+"</label>",n?'<textarea class="value form-control" required ></textarea>':'<input type="text" placeholder="" class="value form-control" value="'+a+'"/>',"</div>"].join(""),JE.dialog(e,t,i,{prompt:!0,value:a})},dialog:function(e,i,t,a){e=Ext.value(e,""),i=Ext.value(i,Ext.emptyFn);var n=Ext.value(a,{});Ext.isObject(t)?n=Ext.applyIf(t,n):n.title=Ext.value(t,"");var o=Ext.value(n.buttons,{});if(Ext.iterate(o,function(e,t){Ext.isString(t)&&(o[e]={text:t})}),n.alert||n.confirm||n.prompt||n.okcancelButton){n.okcancelButton=!0;var r=Ext.value(n.okText,JE.local.lang.common.okButtonText),l=Ext.value(n.cancelText,JE.local.lang.common.cancelButtonText);o={ok:{btnClass:"btn-blue",text:r,keys:["enter"]},cancel:{text:l,keys:["esc"]}},n.alert&&delete o.cancel}var s={title:Ext.value(n.title,JE.local.lang.core.util.Util.msgTitle),content:e,buttons:o,type:Ext.value(n.type,"blue"),icon:n.icon,boxWidth:"30%",useBootstrap:!1,onAction:function(e){var t="";return n.prompt&&(t=this.$content.find(".value").val()),i(e,t)}};if("plus"!=JE.getTheme()&&(s.theme="light,jedefault",s.boxWidth="20%",n.okcancelButton&&(s.buttons.ok.btnClass="btn-green")),window.jconfirm){var d=window.jconfirm(s);d.onOpenBefore=function(){var e=d.$body,t=e.outerWidth(),i=30;Ext.iterate(d.buttons,function(e,t){i+=t.el.outerWidth()+JE.toNum(t.el.css("marginRight").replace("px",""))}),t<i&&e.width(i)}}},popOver:function(e,t,i,a,n){e=e;t=Ext.valueFrom(t,""),i=Ext.valueFrom(i,JE.local.lang.core.util.Util.noticeTitle),a=Ext.valueFrom(a,"right"),n=Ext.valueFrom(n,"body");var o=$(e).attr("id");Ext.isEmpty(o)&&(o=parseInt(1e5*Math.random()),$(e).attr("id",o));if($(e).attr("aria-describedby"))$(e).popover("destroy");else{$("[aria-describedby]").popover("destroy");$(e).popover({container:"body",trigger:"click",placement:a,title:i+'<span onclick="$(\'[aria-describedby]\').popover(\'destroy\');" class="JE_COMM_DELLETEHS16 pull-right" alt="关闭"></span>',html:!0,content:'<div style="word-break:break-all;">'+t+"</div>"});$(e).popover("toggle")}},formWin:function(e){var t=e.title,i=Ext.value(e.items,[]),a=e.iconCls,n=Ext.value(e.layout,"column"),o=(Ext.value(e.frame,!1),e.fn),r=Ext.value(e.width,400),l=Ext.value(e.height,300),s=r,d=Ext.value(e.height,150),c=Ext.value(e.defaults,{});if(autoScroll=Ext.value(e.autoScroll,!0),"fit"==n&&(autoScroll=!1),0<e.plusHeight)l=e.plusHeight;else if("plus"==JE.getTheme()){r+=100;var u=0;Ext.each(i,function(e){"hidden"==e.xtype||e.hidden||u++}),l+=60+12*u}JE.win({iconCls:a,title:t,minWidth:s,minHeight:d,width:r,height:l,maximizable:1==e.maximizable,showFn:e.showFn,items:[Ext.apply({xtype:"form",layout:n,itemId:"form",border:0,autoScroll:autoScroll,bodyPadding:"5",defaults:Ext.apply({labelAlign:"right",xtype:"textfield",labelWidth:80,columnWidth:1,margin:"1"},c),items:i},Ext.value(e.formConfig,{}))],useButton:Ext.value(e.useButton,!0),buttons:e.buttons,okButtonText:e.okButtonText,cancelButtonText:e.cancelButtonText,fn:function(e){var t=e.down("form");if(!t.isValid())return!1;var i=t.getForm().getValues();return o?o(i,e):void 0}}).show()},log:function(){var e=Array.prototype.slice.apply(arguments);e.unshift("log"),JE.windowConsole.apply(JE,e)},infoLog:function(){var e=Array.prototype.slice.apply(arguments);e.unshift("info"),JE.windowConsole.apply(JE,e)},warnLog:function(){var e=Array.prototype.slice.apply(arguments);e.unshift("warn"),JE.windowConsole.apply(JE,e)},errorLog:function(){var e=Array.prototype.slice.apply(arguments);e.unshift("error"),JE.windowConsole.apply(JE,e)},windowConsole:function(){try{window.console||(window.console={},window.console.log=window.console.info=window.console.warn=window.console.error=function(){});var e=Array.prototype.slice.apply(arguments),t=e[0];e=1<e.length?e.slice(1,e.length):[],window.console[t||"log"].apply(window.console,e)}catch(e){}},hasOnlineClass:function(e){var t=!0;return 0!=e.indexOf("PRO.")&&Ext.get("JE-all-min-JS")&&Ext.isEmpty(Ext.ClassManager.get(e))&&(t=!1),t},initCtr:function(e,t){Ext.isEmpty(e)||JE.getApplication().getController(e)},win:function(i){if(i.useButton){if(Ext.applyIf(i,{buttonAlign:"center"}),i.buttons=[{text:Ext.value(i.okButtonText,JE.local.lang.common.okButtonText),cls:"btn JEPLUS_B_L10",iconCls:"jeicon jeicon-check",fontIconCls:"fa fa-check",itemId:"okButton",handler:function(e){var t=e.up("window");i.fn?0!=i.fn(t)&&t.close():t.close()}},{text:Ext.value(i.cancelButtonText,JE.local.lang.common.cancelButtonText),cls:"btn",fontIconCls:"fa fa-close",iconCls:"jeicon jeicon-error",itemId:"cancelButton",handler:function(e){e.up("window").close()}}],Ext.isArray(i.useButton)){var a=[];Ext.each(i.useButton,function(t){Ext.isObject(t)?a.push(t):Ext.each(i.buttons,function(e){if(t==e.itemId)return a.push(e),!1})}),i.buttons=a}Ext.each(i.buttons,function(e){e.iconCls=JE.getIconCls(e)})}var e=i.autoShow;delete i.autoShow;var t=Ext.create("Ext.window.Window",Ext.apply({modal:!0,maximizable:!0,width:JE.getBodyWidth()-100,height:JE.getBodyHeight()-100,layout:"fit"},i));return i.showFn&&t.on("show",function(e){i.showFn(e)}),e&&t.show(),t},getBodyWidth:function(){return Ext.getBody().getBox().width},getBodyHeight:function(){return Ext.getBody().getBox().height},systemError:function(e){var t;try{t=Ext.isString(e)?Ext.decode(e):e}catch(e){}if(t&&!t.success&&t.errorCode&&"0"==JE.systemConfig.JE_SYS_ERRORTYPE){if("1101"==t.errorCode)return;return JE.win(Ext.apply({title:t.code+"("+t.errorCode+")",height:500,width:700,html:t.message,autoShow:!0},t.exceptionId?{useButton:!0,okButtonText:"查看异常",cancelButtonText:"关闭",fn:function(){JE.showFuncForm("JE_CORE_EXCEPTION",t.exceptionId,!0)}}:{})),!0}},error:function(e,t,i){if(0!=(e=(e||"")+"").indexOf("Uncaught NetworkError: Failed to execute 'send' on 'XMLHttpRequest'")){if(-1==e.indexOf(" JSON ")){JE.log(e,t,i);var a=JE.systemConfig.JE_SYS_ERRORPHONE||"400-0999-235";e=Ext.value(e,"系统功能正在更新中，请稍后！<br/>联系电话："+a),e='<i class="jeicon jeicon-error-circle close" style="position: absolute;right: 10px;top: 10px;font-size: 20px;color: #ddd;cursor: pointer;"></i><div style="text-align:center;"><img style="width:250px;" src="'+JE.getStaticUrl("JE.common.error")+'"></div><div style="padding: 10px;text-align: center;font-size: 14px;font-family: 微软雅黑;font-weight: bold;color: #757575;">'+e+"</div>",JE.win({title:"",bodyPadding:20,width:400,height:280,html:e,header:!1,resizable:!1,maximizable:!1,minimizable:!1,autoShow:!0,showFn:function(t){t.getEl().on("click",function(e){e.getTarget("i.close",1)&&t.close()})}})}}else JE.logout()},getFuncData:function(e,t){var i=t;return Ext.isBoolean(i)&&(i={refresh:i}),Ext.create("JE.core.util.FuncUtil").getFuncData(e,i)},getFunc:function(e,t){var i;try{i=Ext.create("JE.core.util.func.Func",{funcCode:e,idSuffix:t})}catch(e){}return i},getFuncView:function(e,t,i){var a;if(Ext.isEmpty(t))return a;var n=e+"_je"+t+"view";i=Ext.value(i,"");return Ext.isEmpty(i)&&(i="_window",(a=Ext.getCmp(n+i))||(i="")),a=Ext.getCmp(n+i)},getFuncPermSql:function(e){var t=JE.CoreUtil.getUSPremData("FUNCPERM",e),i={info:{},permInfo:{}};return Ext.create("JE.core.util.PermUtil").buildDataPerm(i,t),JE.toXT(i.info.permSql)},showDicFunc:function(n,o){o=Ext.value(o,{});var e=JE.ajax({url:JE.getUrlMaps("je.core.dd.dd","initLoad"),params:{tableCode:"JE_CORE_DICTIONARY",limit:1,whereSql:" AND DICTIONARY_DDCODE='"+n+"'"}}).rows[0];if(e){if(-1==["TREE","LIST"].indexOf(e.DICTIONARY_DDTYPE))return void JE.alert("只支持列表和树形字典编辑！");var r="JE_CORE_DICTIONARYITEM"+("1"==e.DICTIONARY_ZWFFLAG?"_ZWF":""),t=!(o.winConfig={title:e.DICTIONARY_DDNAME,useButton:!0,okButtonText:o.field?"更新组件":"更新缓存",fn:function(e){var t=JE.getFuncView(r,"grid");if(t){var i=t.getStore().getUpdatedRecords().concat(t.getStore().getNewRecords());if(JE.isNotEmpty(i)){var a=t.getButton("gridUpdateBtn");a&&a.fireEvent("click",a)}}JE.ajax({url:JE.getUrlMaps("je.core.dd.dd","clearCache"),params:{ddCode:n}}),delete JE.dicListData[n],o.field?(o.field.refreshItems&&o.field.refreshItems(),JE.msg("更新完成！")):JE.msg("更新完成，请刷新功能！")}});"1"==JE.systemConfig.SY_JECORE&&"1"==e.SY_JECORE&&(t=!0);var i=JE.getFuncData(r);JE.showFunc(r,Ext.applyIf({whereSql:Ext.value(i.info.whereSql,"")+" and DICTIONARYITEM_DICTIONARY_ID = '"+e.JE_CORE_DICTIONARY_ID+"'",values:{DICTIONARYITEM_DICTIONARY_ID:e.JE_CORE_DICTIONARY_ID,DICTIONARY_DDTYPE:e.DICTIONARY_DDTYPE},readOnly:t},o)),t&&JE.msg("系统字典不支持编辑！")}else JE.alert("字典【"+n+"】不存在!")},showFuncForm:function(e,t,i,a,n,o){JE.showFunc(e,{id:t,readOnly:i,type:"form",callback:a,width:n,height:o})},showFunc:function(e,s){s=Ext.value(s,{});var d=JE.getFuncData(e,{funcPerm:s.funcPerm}),t=Ext.value(s.values,{}),o=s.type;d.info=Ext.apply(d.info,Ext.value(s.info,{})),d.info.orderSql=Ext.value(s.orderSql,d.info.orderSql),d.info.whereSql+=" "+Ext.value(s.whereSql,""),d.info.treeParentSql=Ext.value(s.whereSql,"");var i=Ext.value(s.idSuffix,"_window"),c={};if("form"==o){if(JE.isNotEmpty(s.id)){t=JE.ajax({url:JE.getUrlMaps("je.core.getInfoById"),params:{tableCode:Ext.value(d.info.viewTableName,d.info.tableName),pkValue:s.id}})}else{var a=Ext.apply(d.getDefVals(t),t);s.useTreeDefVals&&Ext.apply(a,JE.Action.doTreeBeforeSave(d.info)),t=a}if(d.info.idSuffix=i,c.items={xtype:s.useForm?"jeformview":"jeeditview",funcData:d,useChild:Ext.value(s.useChild,!1),mainData:t},s.useForm&&(c.items.xtype="jeformview",c.items.id=d.info.funcCode+"_jeformview"+i),!Ext.isEmpty(d.info.winFormWH)){var n=d.info.winFormWH.split(",");Ext.isEmpty(n[0])||(s.width=Ext.value(s.width,Number(n[0]))),Ext.isEmpty(n[1])||(s.height=Ext.value(s.height,Number(n[1])),JE.toNum(s.height)>JE.toNum(JE.getBodyHeight())&&(s.height=JE.getBodyHeight()-110))}!s.field&&"0"==JE.systemConfig.JE_SYS_FORMWINCLOSEBTN||(c.useButton=[{text:s.cancelButtonText||"关闭",cls:"btn JEPLUS_B_L10",itemId:"close",handler:function(e){e.up("window").close()}}],c.buttonAlign="center")}else{if(JE.isNotEmpty(s.columns)){var r=[{xtype:"rownumberer",width:40,align:"center",text:"No."}];Ext.each(s.columns,function(a){Ext.each(d.grid.columns,function(e){if(e.dataIndex==a.dataIndex){var t=a.field;delete a.field;var i=Ext.apply(e,a);return t&&Ext.each(["field","searchField","editField"],function(e){i[e]&&Ext.apply(i[e],t)}),r.push(i),!1}})}),d.grid.columns=r}c.items={xtype:"jemainview",bodyPadding:1,idSuffix:i,funcData:d,border:0,mainData:t}}return c=Ext.apply(c,{title:Ext.value(s.title,d.info.funcName),width:Ext.value(s.width,JE.getBodyWidth()-100),height:Ext.value(s.height,JE.getBodyHeight()-100),border:0}),JE.isNotEmpty(s.winConfig)&&Ext.apply(c,s.winConfig),(c=JE.win(c)).show(null,function(){var r=c.items.get(0),l=r.mainData;if("form"==o){r=s.useForm?r:r.getCmp("jeformview"),s.hideTbar&&r.getDockedComponent("buttonBar").hide();var e=Ext.create(d.info.modelName,l);r.loadRecord(e),JE.CoreUtil.setChildInfo({funcData:r.funcData,data:e.data}),r.fireEvent("selfactivate",r),JE.Action.doReadFuncEdit(r,e);var t=r.getDockedComponent("buttonBar").down("button[ref=formBackBtn]");if(t&&(t.hide(),t.noReadOnly=!0),s.readOnly)if(r.useWF){var i=r.getDockedComponent("buttonBar").query("[wfButton]");Ext.each(i,function(e){e.hide()})}else r.setReadOnly(!0);else r.useWF||r.formSaveBtnPrem()||r.setReadOnly(!0);if(s.callback&&s.callback(r),setTimeout(function(){r.doLayout()},200),c.on("close",function(){var e=Ext.getCmp(d.info.funcCode+"_jegridview");if(e){var t=r.form.getValues(),i=t[d.info.pkName];if(JE.isNotEmpty(i)){var a=e.store.getById(i);if(a){a.set(t),a.commit();var n=Ext.getCmp(d.info.funcCode+"_jeformview"),o=Ext.getCmp(d.info.funcCode+"_jecenterview");n&&"jeeditview"==o.getLayout().getActiveItem().xtype&&i==n.form.findField(d.info.pkName).getValue()&&Ext.isEmpty(l.__doTaskForm)&&e.fireEvent("itemdblclick",e.view,a)}}}}),JE.isNotEmpty(s.field)&&"0"!=JE.systemConfig.JE_SYS_FORMWINCLOSEBTN){var a=c.getDockedItems('toolbar[ui="footer"]')[0];a.getCmp("close").getEl().removeCls("JEPLUS_B_L10"),a.insert(0,{text:"保存并使用本条数据",cls:"btn JEPLUS_B_L10",iconCls:JE.getIconCls({iconCls:"jeicon jeicon-check",fontIconCls:"fa fa-check"}),handler:function(){var e=r.getValue(d.info.pkName);if(JE.isNotEmpty(e)){var i=s.field,a=r.getValue(),n={};Ext.each(i.configData.valueNames,function(e,t){n[i.configData.fieldNames[t]]=a[e]}),i.formObj.setValues(n),c.close()}else{if(!r.getForm().isValid())return;var t=r.getButton("formSaveBtn");t&&(r.on({endsubmit:{fn:function(e,t,i,a){var n=s.field,o=a,r={};Ext.each(n.configData.valueNames,function(e,t){r[n.configData.fieldNames[t]]=o[e]}),n.formObj.setValues(r),c.close()},single:!0}}),t.fireHandler())}}})}}else var n=setInterval(function(){var e=Ext.getCmp(d.info.funcCode+"_jegridview"+d.info.idSuffix);if(e){if(clearInterval(n),e.mainData=l,"grid"==o){var t=e.getDockedComponent("buttonBar").down("button[ref=gridEditBtn]");t&&t.hide()}s.readOnly&&r.setReadOnly(!0),JE.isNotEmpty(s.queryParams)&&Ext.apply(e.store.proxy.extraParams,s.queryParams),s.hideTbar&&e.getDockedComponent("buttonBar").hide(),s.callback&&s.callback(r)}},50)}),c},printFunc:function(e,t){t=Ext.value(t,{});JE.isEmpty(e)?JE.alert("请选择功能编码！"):Ext.create("JE.core.util.PrintUtil").printFunc(e,t)},showIddt:function(e,t,i,a){JE.initCtr(t);var n={xtype:i};a&&(n=Ext.applyIf(n,a)),JE.win({title:e,items:n}).show()},showChart:function(e,t){if(JE.isEmpty(e))JE.alert(JE.format(JE.local.lang.core.util.Util.showChartAlert,""));else{var i=JE.ajax({url:JE.getUrlMaps("je.core.load"),params:{tableCode:"JE_CORE_CHARTS",whereSql:"and CHARTS_CODE = '"+e+"'",limit:1}}).rows[0];if(JE.isEmpty(i))JE.alert(JE.format(JE.local.lang.core.util.Util.showChartAlert,e));else{var a=(t=Ext.value(t,{})).hideSearchBar,n=Ext.value(t.params,{}),o={xtype:"jechartview",chartBean:i,chartCode:e,hideSearchBar:a,chartAttrs:Ext.value(t.chartAttrs,{}),chartParams:n,listeners:t.listeners};delete t.listeners,JE.win(Ext.apply(t,{title:Ext.value(t.title,JE.local.lang.core.util.Util.showChartTitle),border:0,items:o})).show()}}},showReport:function(e,t){if(JE.isEmpty(e))JE.alert(JE.format(JE.local.lang.core.util.Util.showReportAlert,""));else{var i=JE.ajax({url:JE.getUrlMaps("je.core.load"),params:{tableCode:"JE_CORE_REPORT",whereSql:"and REPORT_CODE = '"+e+"'",limit:1}}).rows[0];if(JE.isEmpty(i))JE.alert(JE.format(JE.local.lang.core.util.Util.showReportAlert,e));else{var a={xtype:"jereportview",reportBean:i,reportCode:e,hideSearchBar:(t=Ext.value(t,{})).hideSearchBar,reportParams:Ext.value(t.params,{}),editable:1==t.editable,values:Ext.value(t.values,{}),listeners:t.listeners};delete t.listeners,JE.win(Ext.apply(t,{title:Ext.value(t.title,JE.local.lang.core.util.Util.showReportTitle),border:0,items:a})).show()}}},getActionUrls:function(e){return{load:(e=Ext.value(e,"/je"))+JE.getUrlMaps("method.load"),save:e+JE.getUrlMaps("method.doSave"),update:e+JE.getUrlMaps("method.doUpdate"),copy:e+JE.getUrlMaps("method.doCopy"),remove:e+JE.getUrlMaps("method.doRemove"),disable:e+JE.getUrlMaps("method.doDisable"),updateList:e+JE.getUrlMaps("method.doUpdateList"),insertUpdateList:e+JE.getUrlMaps("method.doInsertUpdateList")}},toStr:function(e){return Ext.isEmpty(e)?"":Ext.isObject(e)||Ext.isArray(e)?JE.encode(e):e+""},getObjAttr:function(e,t){if(!JE.isEmpty(e))return Ext.isString(e)&&(e=JE.decode(e)),e[t]},toObj:function(e){return Ext.isEmpty(e)?null:JE.decode(e,!0)},toBool:function(e){return"1"==e},toNum:function(t){var e=0;try{Ext.isNumeric(t)&&(e=Number(t,0))}catch(e){JE.error(e.message,t+JE.local.lang.core.util.Util.toNumError,"")}return e},toNumStr:function(e,t){e=JE.toNum(e)+"";for(var i=0;i<t-e.length;i++)e="0"+e;return e},toDefVal:function(e,t){if(!Ext.isString(e))return e;var i;switch(e=Ext.value(e,"").trim()){case"@USER_ID@":i=JE.currentUser.userId;break;case"@USER_CODE@":i=JE.currentUser.userCode;break;case"@USER_NAME@":i=JE.currentUser.username;break;case"@USER_JTGSMC@":i=JE.currentUser.jtgsMc;break;case"@USER_JTGSID@":i=JE.currentUser.jtgsId;break;case"@USER_ZHID@":i=JE.currentUser.zhId;break;case"@USER_ZHMC@":i=JE.currentUser.zhMc;break;case"@DEPT_ID@":i=JE.currentUser.deptId;break;case"@DEPT_CODE@":i=JE.currentUser.deptCode;break;case"@DEPT_NAME@":i=JE.currentUser.deptName;break;case"@DEPT_PATH@":i=JE.currentUser.dept.path;break;case"@IS_MANAGER@":i=JE.currentUser.isManager;break;case"@NOW_DATE@":i=Ext.Date.format(new Date,"Y-m-d");break;case"@NOW_MONTH@":i=(new Date).getMonth()+1;break;case"@NOW_YEAR@":i=(new Date).getFullYear();break;case"@NOW_TIME@":i=Ext.Date.format(new Date,"Y-m-d H:i:s");break;case"@USER_MONITORDEPT@":i="'"+Ext.value(JE.currentUser.monitorDeptCode,"").replaceAll(",","','")+"'";break;case"@USER_DEPTFZR@":i="'"+Ext.value(JE.currentUser.dept.chargeUser,"").replaceAll(",","','")+"'";break;case"@COMPANY_QUERYIDS@":i="'"+Ext.value(JE.currentUser.dept.jtjggsId,"").replaceAll(",","','")+"'";break;default:var a=e.match(/\@.*?\@/g);if(!Ext.isEmpty(a)){var n=a[0].replaceAll("@",""),o=n.split("."),r=o[0];if(1<o.length){if("USER"==r&&(i=JE.currentUser),JE.isNotEmpty(i)&&Ext.isObject(i))for(var l=1;l<o.length;l++)i=i[o[l]]}else i=Ext.value(JE.systemConfig[n])}}return Ext.isEmpty(t)||null!=i||(i=t[e]),i=null==i?e:i},toXT:function(i,e,t){if(Ext.isEmpty(i))return"";var a=Ext.clone(Ext.value(e,{}));if(JE.isNotEmpty(t)){i=i.replaceAll("parent.","parent__");var n={};Ext.iterate(t,function(e,t){n["parent__"+e]=t}),Ext.apply(a,n)}var o=i.match(/\{@.*?\@}/g);Ext.each(o,function(e){var t=e.replaceAll("[.]","_").replaceAll("@","_");i=i.replaceAll(e,t),t=t.replace("{","").replace("}",""),e=e.replace("{","").replace("}",""),a[t]=JE.toDefVal(e)});var r=(i=new Ext.XTemplate(i)).apply(a);o=r.match(/\{.*?\}/g);return Ext.each(o,function(e){var t=e.replace("{","").replace("}","");a.hasOwnProperty(t)&&(r=r.replaceAll(e,a[t]))}),r},toDicText:function(e,t){if("LIST"!=Ext.value(JE.dicInfoData[e],{DICTIONARY_DDTYPE:"LIST"}).DICTIONARY_DDTYPE)return t;var i=JE.getDicItems(e,!0),a="";if(JE.isNotEmpty(t)){var n=[];Ext.each(t.split(","),function(e){var t=Ext.value(i[e],{text:""});n.push(t.text)}),a=n.join(",")}return a},getChartDS:function(e){return Ext.create("JE.core.util.chart.ChartDS",e)},getDataSource:function(e){return JE.getChartDS(e)},doMask:function(e,t,i,a){var n;e&&((n=Ext.isElement(e.dom)?e:e.getEl())?(t=Ext.value(t,JE.local.lang.core.util.Util.doMaskMsg),n.mask(t,a),Ext.defer(function(){i&&i(),n.unmask()},100)):i&&i())},doWait:function(e){},timeLog:function(e,t){if(Ext.isDate(e)){var i=((new Date).getTime()-e.getTime())/1e3;t=Ext.value(t,JE.local.lang.core.util.Util.timeLogMsg),JE.infoLog(t,":",i,JE.local.lang.core.util.Util.timeLogUnit)}},scrollBy:function(e,t,i){e&&t&&((e.el||e).scrollByEl(t,!0),i&&t&&(Ext.isBoolean(i)?t.highlight():t.highlight(i.color,i.cfg)))},buildFuncTree:function(){JE.getUrlMaps("je.core.dd.tree","loadTreeData"),tableName,whereSql},getDicItems:function(e,t,i){var a=JE.dicListData[e],n=Ext.value(JE.dicInfoData[e],{DICTIONARY_DDTYPE:"LIST"});if(JE.isNotEmpty(e)&&(Ext.isEmpty(a)||!Ext.isEmpty(i))){var o=n.DICTIONARY_DDTYPE,r=!1;if(Ext.isBoolean(i)&&(r=i,i=""),"LIST"==o)0==(a=JE.ajax({url:JE.getUrlMaps("je.core.dd.dd.getDicItemByCode"),params:{tableCode:"JE_CORE_DICTIONARY",DICTIONARY_DDCODE:e,whereSql:Ext.value(i,""),DICTIONARY_ZWFFLAG:Ext.value(n.DICTIONARY_ZWFFLAG,"0")}})).success&&(a=[]),!r&&Ext.isEmpty(i)&&JE.isNotEmpty(a)&&(JE.dicListData[e]=a);else{a=[];var l=JE.getDicItems4Tree(e,{whereSql:i});Ext.each(l,function(e){a.push({id:e.id,code:e.code,text:e.text,iconCls:e.iconCls,icon:e.icon,iconClsImage:"",textColor:"",backgroundColor:""})})}}if(1!=t)return a=Ext.value(a,[]);var s={};return Ext.isEmpty(a)||Ext.each(a,function(e){s[e.code]=e}),s},getDicItems4Tree:function(e,t){var i=(t=t||{}).whereSql||"",a=t.excludes||"checked",n=JE.dicInfoData[e],o=[];return n&&(o=JE.ajax({url:JE.getUrlMaps("je.core.dd.tree","loadTree"),params:{node:"ROOT",onlyItem:!0,excludes:a,strData:Ext.encode([{ddCode:e,whereSql:i,ddName:"",async:!1,orderSql:"",parentSql:"",rootId:"",nodeInfo:"",params:{},moreRoot:!1,zwfFlag:Ext.value(n.DICTIONARY_ZWFFLAG,"0")}])}})),o},selectWin:function(e){var t=Ext.create("JE.core.view.SSWinView",e);return t.show(),t},showWFView:function(e){JE.Action.doWfSingleView(e)},showFuncCfg:function(i,e,a,n){e=Ext.value(e,"main");n=Ext.value(n,{});var t={title:JE.local.lang.core.util.Util.showFuncCfgTitle,autoShow:!0,bodyPadding:1,items:[{xtype:"funccfg."+e,border:0}]};"fieldform"==e||"columnform"==e||"simplefunc"==e?(t.width=310,t.minWidth=310,t.height=JE.getBodyHeight(),t.x=JE.getBodyWidth()-t.width,t.modal=!1,"columnform"==e?t.x=t.x-t.width:"simplefunc"==e&&(t.modal=!0)):"powerview"==e&&(t.width=950,t.height=700,t.autoShow=!0,t.height=Ext.getBody().getHeight()-245),"powerview"==e&&(t.width=1e3,t.height=JE.getBodyHeight()-150,t.items[0].powerTypes=n.type,t.items[0].funcInfo=n.funcInfo,t.items[0].selfContr=n.selfContr,t.items[0].cmp=n.cmp),-1!=["main","fieldform"].indexOf(e)&&("fieldform"==e&&n.onlyField?(t.modal=!0,t.items[0].hideEditColBtn=!0):(t.modal=!1,Ext.getBody().mask(),t.listeners={close:function(e){var t=Ext.getCmp("funccfg.columnform");t&&t.ownerCt.close(),Ext.getBody().unmask()}})),t.showFn=function(e){var t=e.items.get(0);t.otherCfg=n,t.loadFunc(i,a)},JE.win(t)},random:function(e,t){return t=Ext.value(t,0),parseInt(Math.random()*(e-t+1)+t)},uuid:function(e){return"xxxxxxxxxxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})},eval:function(str,errorMsg,showError){if(Ext.isEmpty(str))return str;var obj;try{obj=Ext.isIE8?eval("(0,"+str+")"):eval("("+str+")")}catch(e){console.trace&&console.trace("eval出错了"),Ext.isEmpty(errorMsg)||(e=errorMsg+"</br>"+e),0!=showError&&JE.error(e)}return obj},getIconTpl:function(e,t){var i='<input type="button" class="{iconCls} je-button-icon"  {style} {onclick} />';Ext.isEmpty(e)||(i=i.replace("{iconCls}",e));t=Ext.applyIf(Ext.value(t,{}),{style:"",onclick:""});return Ext.iterate(t,function(e,t){JE.isNotEmpty(t)&&(t=e+'="'+t+'" '),i=i.replace("{"+e+"}",t)}),i},getUEditorBox:function(e,t){return'<div class="'+(t?"ueditor-box":"ueditor-box ueditor-box-html")+'">'+(e=Ext.value(e,""))+"</div>"},toBigButton:function(e,t){return"plus"==JE.getTheme()||0==t||Ext.isEmpty(e.bigIconCls)||"ACTION"==e.type||(e.tooltip=Ext.value(e.text,e.tooltip),e.iconCls=e.bigIconCls,e.scale="large",delete e.text),e},copy:function(e){window.clipboardData.setData("Text",e),JE.alert(JE.local.lang.core.util.Util.copyAlert)},previewImage:function(e,t,i){var a=".jpg,.bmp,.gif,.png",n=e.value.substring(e.value.lastIndexOf(".")+1).toLowerCase(),o=window.navigator.userAgent.toUpperCase();if(imgTpl='<img  src="{src}" style="'+(i=i&&""!=i?i:"")+'" />',-1<a.indexOf(n))if(e.files)if(window.FileReader){var r=new FileReader;r.onload=function(e){t.innerHTML=imgTpl.replace("{src}",e.target.result)},r.readAsDataURL(e.files[0])}else-1<o.indexOf("SAFARI")&&alert(JE.local.lang.core.util.Util.previewImageAlert);else if(-1<o.indexOf("MSIE"))-1<o.indexOf("MSIE 6")?url=e.value:(e.select(),-1<o.indexOf("MSIE 9")&&e.blur(),t.innerHTML='<div style="'+i+"filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod='scale',src="+document.selection.createRange().text+')"></div>');else if(-1<o.indexOf("FIREFOX")){var l=parseFloat(o.toLowerCase().match(/firefox\/([\d.]+)/)[1]);t.innerHTML=l<7?imgTpl.replace("{src}",e.files[0].getAsDataURL()):imgTpl.replace("{src}",window.URL.createObjectURL(e.files[0]))}else t.innerHTML=imgTpl.replace("{src}",e.value);else alert(JE.format(JE.local.lang.core.util.Util.previewImageAlert2,a)),e.value="",-1<o.indexOf("MSIE")&&(e.select(),document.selection.clear()),e.outerHTML=e.outerHTML},preFillUp:function(e,t,i){for(var a="",n=0;n<t-(e+"").length;n++)a+=i;return a+e},isNaN:function(e,t){return isNaN(e)?t=t||"":e},isEmpty:function(e){return Ext.isObject(e)?Ext.Object.isEmpty(e):Ext.isEmpty(e)},isNotEmpty:function(e){return!JE.isEmpty(e)},getXTypeByClassName:function(e){Ext.isEmpty(Ext.ClassManager.get(e))&&Ext.syncRequire(e);var t=Ext.ClassManager.getAliasesByName(e)[0];return t=Ext.value(t,"").replace("widget.","")},encode:function(e){if(null==e)return"null";if(Ext.isDate(e))return Ext.Date.format(e,"Y-m-d H:i:s");if(Ext.isArray(e)){var t=["[",""],i=e.length;for(a=0;a<i;a+=1)t.push(JE.encode(e[a]),",");return t[t.length-1]="]",t.join("")}if(Ext.isObject(e)){var a,n;t=["{",""];for(a in e)if(n=e[a],e.hasOwnProperty(a)){if(void 0===n)continue;t.push(JE.encode(a),":",JE.encode(n),",")}return t[t.length-1]="}",t.join("")}return"function"==typeof e?Ext.encode(e.toString()):Ext.encode(e)},decode:function(e,t){return Ext.decode(e,t)},encodeURI:function(e){return encodeURIComponent(e)},decodeURI:function(e){return decodeURIComponent(e)},format:function(e,t){if(JE.isEmpty(e))return"";if(Ext.isDate(e))return Ext.util.Format.date(e,t);if(Ext.isString(e))return Ext.util.Format.format.apply(Ext.util.Format,arguments);if(JE.isNotEmpty(t)&&"number"==typeof e&&isFinite(e)){var i="";return e<0&&(e=-e,i="-"),i+Ext.util.Format.number(e,t)}return""},insertAtCursor:function(e,t){if(document.selection)document.selection.createRange().text=t;else if("number"==typeof e.selectionStart&&"number"==typeof e.selectionEnd){var i=e.selectionStart,a=e.selectionEnd,n=i,o=e.value;e.value=o.substring(0,i)+t+o.substring(a,o.length),n+=t.length,e.selectionStart=e.selectionEnd=n}else e.value+=t},moveCursorEnd:function(e){e.focus();var t=e.value.length;if(document.selection){var i=e.createTextRange();i.moveStart("character",t),i.collapse(),i.select()}else"number"==typeof e.selectionStart&&"number"==typeof e.selectionEnd&&(e.selectionStart=e.selectionEnd=t)},numberToLetter:function(e){var t={0:"A",1:"A",2:"B",3:"C",4:"D",5:"E",6:"F",7:"G",8:"H",9:"I",10:"J",11:"K",12:"L",13:"M",14:"N",15:"O",16:"P",17:"Q",18:"R",19:"S",20:"T",21:"U",22:"V",23:"W",24:"X",25:"Y",26:"Z"}[e];return t||JE.local.lang.core.util.Util.numberToLetterEmptyText},openWindow:function(e,t,i){var a=JE.uuid().replaceAll("-","_"),n={width:screen.availWidth,height:screen.availHeight,top:0,left:0,toolbar:"no",menubar:"no",scrollbars:"yes",resizable:"yes",location:"no",status:"no"},o=[];Ext.apply(n,Ext.value(i,{})),i&&Ext.isEmpty(i.top)&&Ext.isEmpty(i.left)&&(n.top=(screen.availHeight-n.height)/2,n.left=(screen.availWidth-n.width)/2),Ext.iterate(n,function(e,t){o.push(e+"="+t)}),o.join(",");function r(e,t){var i=document.getElementsByClassName("pagebody");"X"!=t&&""!=t||(l+="+"==e?.01:-.01),"Y"!=t&&""!=t||(s+="+"==e?.01:-.01);for(var a=0;a<i.length;a++){i[a].style["-webkit-transform"]="scale("+l+","+s+")"}}var l=1,s=1;if(JE.isEmpty(t)){var d=new Image;d.src=e;var c=window.open("","_blank");c.document.write(d.outerHTML),c.document.title="导出图片",c.document.close()}else{var u=document.createElement("form");u.method="post",u.action=e,u.target=a,Ext.iterate(t,function(e,t){var i=document.createElement("input");i.type="hidden",i.name=e,i.value=Ext.value(t,""),u.appendChild(i)}),document.body.appendChild(u);var p=JE.decodeURI(t.htmlTpl),f=JE.win({xtype:"panel",layout:"fit",cls:"je-print-view",style:"text-align:-webkit-center;",html:p,autoScroll:!0,autoShow:!0,dockedItems:[{height:40,xtype:"toolbar",dock:"top",style:"border-width:0px;",cls:"je-link-toolbar",defaults:{padding:0,xtype:"button",style:"color:#444;",cls:"btn JEPLUS_B_C07"},items:[{text:"等比例+",handler:function(){r("+","")}},{text:"等比例-",handler:function(){r("-","")}},{text:"横向+",handler:function(){r("+","X")}},{text:"横向-",handler:function(){r("-","X")}},{text:"纵向+",handler:function(){r("+","Y")}},{text:"纵向-",handler:function(){r("-","Y")}}]}],useButton:[{text:"打印",cls:"btn JEPLUS_B_L10",handler:function(){for(var e=document.getElementsByClassName("NoBorder"),t=0;t<e.length;t++){var i=e[t];i.style["border-bottom"]="0px",i.style["border-top"]="0px"}p=document.getElementsByClassName("pagediv-border")[0].innerHTML,p+="<style>html,body{height:100%;margin:0px;padding:0px;}.div-box{font-family: tahoma, arial, verdana, sans-serif;font-size:12px;height:100%;}.pagebody{-moz-transform-origin: 0 0;-webkit-transform-origin:0 0;-o-transform-origin:0 0;}.div-box *{box-sizing: border-box;-moz-box-sizing: border-box;-ms-box-sizing: border-box;-webkit-box-sizing: border-box;}.table-grid-cell-inner{text-overflow: ellipsis;padding: 3px 6px 4px 6px;border:1px solid #000;table-layout:fixed;word-break:break-all;}.childFunc table tr.firstRow td { border-top: 0px !important; } .childFunc table tr.lastRow td { border-bottom: 0px !important; } .childFunc table tr td.firstCol { border-left: 0px !important; } .childFunc table tr td.lastCol { border-right: 0px !important; }.pagediv-border{border:1px solid #cccccc;}</style>";var a,n,o=document.createElement("iframe"),r=document.body.appendChild(o);o.id="myIframe",o.style="width: auto;",a=r.contentWindow||r.contentDocument,(n=r.contentDocument||r.contentWindow.document).open(),n.write(p),n.close(),a.print(),f.close()}},"cancelButton"]})}},openCalc:function(){JE._Calculator||(JE._Calculator=Ext.create("Ext.Component",{xtype:"box",height:600,width:390,cls:"je-calculator-box",shadow:!1,floating:!0,draggable:!0,html:'<iframe scrolling="auto" frameborder="0" width="100%" height="100%" src="/static/ux/sience-calc/calc.html" ></iframe><div class="title" style="">计算器 <i class="fa fa-close"></i><div>',listeners:{hide:function(e){e.getEl().down("iframe").dom.src="/static/ux/sience-calc/calc.html"},afterrender:function(e){e.getEl().down(".fa-close").on("click",function(){e.hide()})}}})),JE._Calculator.show()},openCalendar:function(o){JE.formWin({title:"日历任务",width:675,height:370,modal:!0,useButton:!0,autoShow:!0,frame:!1,defaults:{xtype:"textfield",columnWidth:.5,msgTarget:"side",labelWidth:65,margin:"5 0 0 0 ",labelAlign:"center"},formConfig:{border:0,frame:!1,bodyStyle:"background:transparent;padding:5px 10px 10px;"},items:[{xtype:"hidden",name:"JE_SYS_CALENDAR_ID"},{fieldLabel:"标题",name:"CALENDAR_TITLE",allowBlank:!1,columnWidth:.7,emptyText:"请输入标题..."},{fieldLabel:"创建人",name:"SY_CREATEUSERNAME",readOnly:!0,value:JE.currentUser.username,columnWidth:.3},{xtype:"hidden",name:"SY_CREATEUSER",value:JE.currentUser.userCode},{fieldLabel:"开始",xtype:"datetimefield",format:"Y-m-d H:i",submitFormat:"Y-m-d H:i:s",name:"CALENDAR_STARTTIME",allowBlank:!1,columnWidth:.4,listeners:{change:function(e,t,i){var a=e.up("form").form.findField("CALENDAR_ENDTIME").getValue();if(!Ext.isEmpty(t)&&!Ext.isEmpty(a)){var n=JE.DATE.parseDateTime(t),o=JE.DATE.parseDateTime(a);n.getTime()>=o.getTime()&&(JE.msg(JE.getLocalLang("sys.calendar.msg.timeAlert")),e.setValue(i))}},expand:function(e,t){var i=e.picker,a=e.up("form").form.findField("CALENDAR_YESORNO_CODE").getValue();i.hour.setReadOnly("1"==a),i.minute.setReadOnly("1"==a),i.minute.step=30,i.minute.setMaxValue(30),i.second.readOnly||i.second.setReadOnly(!0)}}},{fieldLabel:"结束",xtype:"datetimefield",format:"Y-m-d H:i",allowBlank:!1,submitFormat:"Y-m-d H:i:s",name:"CALENDAR_ENDTIME",columnWidth:.4,listeners:{change:function(e,t,i){var a=e.up("form").form.findField("CALENDAR_STARTTIME").getValue();if(!Ext.isEmpty(t)&&!Ext.isEmpty(a)){var n=JE.DATE.parseDateTime(t);JE.DATE.parseDateTime(a).getTime()>=n.getTime()&&(JE.msg(JE.getLocalLang("sys.calendar.msg.timeAlert")),e.setValue(i))}},expand:function(e,t){var i=e.picker,a=e.up("form").form.findField("CALENDAR_YESORNO_CODE").getValue();i.hour.setReadOnly("1"==a),i.minute.setReadOnly("1"==a),(i.minute.step=30)!=i.minute.maxValue&&i.minute.setMaxValue(30),i.second.readOnly||i.second.setReadOnly(!0)}}},{fieldLabel:"全天",xtype:"yesnofield",name:"CALENDAR_YESORNO_CODE",columnWidth:.2,labelWidth:40,configInfo:"YESORNO,CALENDAR_YESORNO_CODE~CALENDAR_YESORNO_NAME,code~text",listeners:{change:function(e,t,i){var a=e.up("form").form,n=a.findField("CALENDAR_STARTTIME"),o=a.findField("CALENDAR_ENDTIME");"1"==t?(n.format="Y-m-d",o.format="Y-m-d"):(n.format="Y-m-d H:i",o.format="Y-m-d H:i"),n.setValue(n.getValue()),o.setValue(o.getValue())}}},{fieldLabel:"类型",xtype:"cbbfield",name:"CALENDAR_CALENDARTYPE_CODE",configInfo:"JE_SYS_CALENDARTYPE,CALENDAR_CALENDARTYPE_CODE~CALENDAR_CALENDARTYPE_NAME,code~text",value:"1"},{xtype:"hidden",name:"CALENDAR_CALENDARTYPE_NAME",value:"日常记录"},{fieldLabel:"提醒",xtype:"cbbfield",name:"CALENDAR_REMINDER_CODE",configInfo:"JE_SYS_REMINDER,CALENDAR_REMINDER_CODE~CALENDAR_REMINDER_NAME,code~text",value:"-1"},{xtype:"hidden",name:"CALENDAR_REMINDER_NAME",value:"从不"},{fieldLabel:"所属组",xtype:"cbbfield",name:"CALENDAR_GROUPID",dataArray:[],displayField:"text",valueField:"id",configData:{fieldNames:["CALENDAR_GROUPID","CALENDAR_GROUPNAME","CALENDAR_GROUPCOLOR"],valueNames:["id","text","code"]},columnWidth:.4},{xtype:"hidden",name:"CALENDAR_GROUPNAME"},{xtype:"hidden",name:"CALENDAR_GROUPCOLOR"},{fieldLabel:"消息提醒",xtype:"cgroup",labelWidth:80,name:"CALENDAR_MESSAGETYPE_CODE",configInfo:"JE_WF_MESSAGETYPE,CALENDAR_MESSAGETYPE_CODE~CALENDAR_MESSAGETYPE_NAME,code~text",columnWidth:.6},{xtype:"hidden",name:"CALENDAR_MESSAGETYPE_NAME"},{fieldLabel:"备注",xtype:"htmleditor",name:"CALENDAR_NOTES",columnWidth:1}],showFn:function(e){var t=e.down("form"),i=JE.ajax({url:JE.getUrlMaps("je.core.calendar","getGroupTree")});if(t.form.findField("CALENDAR_GROUPID").getStore().loadData(i.children),o)if("update"==o.type){var a=o.pkValue,n=JE.ajax({url:JE.getUrlMaps("je.core.getInfoById"),params:{tableCode:"",pkValue:a}});t.form.setValues(n)}else o.values&&t.form.setValues(o.values)},fn:function(e,t){t.down("form");var i=e.JE_SYS_CALENDAR_ID;e.tableCode="JE_SYS_CALENDAR";var a=JE.ajax({url:JE.getUrlMaps("je.core.calendar",Ext.isEmpty(i)?"doSave":"doUpdate"),params:e});if(!a.success)return JE.alert("操作失败!"),!1;o.callback&&o.callback(a.obj),Ext.isEmpty(i)?JE.msg(JE.getLocalLang("common.saveSuccessAlert")):JE.msg(JE.getLocalLang("common.updateSuccessAlert"))}})},DES:function(e){if("1"!=JE.systemConfig.JE_SYS_ENCRYPT)return e;var t="PCAT1",i="PCAT2",a="PCAT3";if(JE.isNotEmpty(JE.systemConfig.JE_SYS_ENCRYPT_KEY1)&&(t=JE.systemConfig.JE_SYS_ENCRYPT_KEY1),JE.isNotEmpty(JE.systemConfig.JE_SYS_ENCRYPT_KEY2)&&(i=JE.systemConfig.JE_SYS_ENCRYPT_KEY2),JE.isNotEmpty(JE.systemConfig.JE_SYS_ENCRYPT_KEY3)&&(a=JE.systemConfig.JE_SYS_ENCRYPT_KEY3),Ext.isObject(e)||Ext.isElement(e)){var n=e,o=[],r=["whereSql","orderSql","tableCode"];return JE.isNotEmpty(JE.systemConfig.JE_SYS_ENCRYPT_FIELD)&&(r=JE.split(JE.systemConfig.JE_SYS_ENCRYPT_FIELD,",")),Ext.each(r,function(e){for(var t;!t||-1!=o.indexOf(t);)index=JE.random(23),t="abcdefghigklmnopqrstuvwxyz".substring(index,index+1);if(o.push(t),Ext.isElement(n)&&"FORM"==n.nodeName){var i=n;if(i[e]){var a=document.createElement("input");Ext.fly(a).set({type:"hidden",value:JE.DES(i[e].value),name:t}),i[e].setAttribute("disable","disable"),i.appendChild(a)}}else n.hasOwnProperty(e)&&(n[t]=JE.DES(n[e]),delete n[e])}),{code:"params-keys",value:o.join(",")}}return DES.strEncode(e,t,i,a)},defer:function(e,t,i){if(!Ext.isEmpty(e)){if(i)if(0==e.call())return;var a=setInterval(function(){0==e.call()&&clearInterval(a)},Ext.value(t,1e3));return{clear:function(){clearInterval(a)},fn:a}}},logout:function(e){1!=e&&JE.ajax({url:"/j_spring_security_logout",async:!0}),JE.WebSocket.close(),Ext.util.Cookies.clear("authorization"),window.location.href="/login.html"}}),Ext.define("JE.util.VTypes",{vtypes:{unique:{fn:function(e,t,i,a){var n=t.funcCode,o=JE.getFuncData(n).info.tableName,r=t.up("jeformview");if(!r)return!0;if(r.funcData.info.funcCode==n){if(!r.getRecord())return!0;var l=r.getRecord().get(t.name),s=r.funcData.info.pkName;r.getForm().findField(s).getValue();if(Ext.isEmpty(e)||e==l||e==t.originalValue)return!0}else if(Ext.isEmpty(e)||e==t.ownerCt.startValue)return!0;var d={tableCode:o,FIELDCODE:t.name};return d[t.name]=e,JE.ajax({url:JE.getUrlMaps("je.core.checkFieldUniquen"),params:d}).success},text:"该数据已存在，请重新输入",mask:""},repetition:{fn:function(e,t){if(t.repetition){var i=Ext.getCmp(t.repetition.targetCmpId);return!Ext.isEmpty(i)&&e==i.getValue()}},text:"两个指定组件的组件值不一样",mask:""},daterange:{fn:function(e,t){var i=t.parseDate(e);if(!i)return!1;if(!t.startDateField||this.dateRangeMax&&i.getTime()==this.dateRangeMax.getTime()){if(t.endDateField&&(!this.dateRangeMin||i.getTime()!=this.dateRangeMin.getTime())){var a=t.up("form").down("#"+t.endDateField);a.setMinValue(i),a.validate(),this.dateRangeMin=i}}else{var n=t.up("form").down("#"+t.startDateField);n.setMaxValue(i),n.validate(),this.dateRangeMax=i}return!0},text:"开始时间必须小于结束时间"}},init:function(){var a=this;a.localLang=JE.getLocalLang("core.util.VTypes"),Ext.iterate(a.vtypes,function(e,t){var i={};i[e]=t.fn,Ext.isEmpty(t.text)||(i[e+"Text"]=a.localLang[e+"Text"]),Ext.isEmpty(t.mask)||(i[e+"Mask"]=t.mask),Ext.apply(Ext.form.field.VTypes,i)})}}),Ext.define("JE.util.WebSocket",{debug:!1,SendCommand:{UNKNOWN:0,HEARTBEAT:1,HANDSHAKE:2,LOGIN:3,LOGOUT:4,KICK:5,CHAT:6,CANCEL:7,PUSH:8,OK:10,ERROR:11},ReceiveCommand:{HANDSHAKE:0,IMMSG:1,IM:2,IMGROUPMSG:3,JEPLUS:4,UNREAD:5},connectInterval:5,connectTimes:5,init:function(){JE.WebSocket.connect()},socketio:!0,connect:function(e){var t=JE.WebSocket;t._socket_url=e||JE.systemConfig.JE_CORE_WEBSOCKETURL||"http://219.142.64.198:7001",t.connet4socketio(),t.debug&&console.debug("try connect server, url="+t._socket_url)},connet4websocket:function(){var e=JE.WebSocket,t=e._socket=new WebSocket(e._socket_url);t.onmessage=e._onReceive,t.onopen=e._onOpen,t.onclose=e._onClose,t.onerror=e._onError},connet4socketio:function(){var e=JE.WebSocket;JE.loadScript("/static/ux/socket-io/socket.io.js");var t=e._socket=io.connect(e._socket_url,{transports:[window.WebSocket?"websocket":"polling"]});t.on("connect",e._onOpen),t.on("error",e._onError),t.on("disconnect",e._onDisconnect),t.on("_handshakeEvent",e._onReceive),t.on("message",e._onReceive)},close:function(e){var t=JE.WebSocket,i=t.getSocket();i&&i.close(),t.debug&&e&&console.info("try close web socket client, reason="+e)},getSocket:function(){return JE.WebSocket._socket},getUnReadMsg:function(){return JE.WebSocket._unread_msg||[]},_onReceive:function(e){var t=JE.WebSocket;t.debug&&console.log(">>> receive packet=",e),t._receive(JSON.parse(e||"{}"))},_onOpen:function(){var e=JE.WebSocket;e.debug&&console.log("Web Socket opened!"),e._handshake()},_onClose:function(){var e=JE.WebSocket;delete e._socket,e.debug&&console.log("Web Socket closed!")},_onError:function(e){var t=JE.WebSocket;t.close(),t.debug&&console.error("Web Socket receive, error",e)},_onDisconnect:function(){JE.WebSocket;console.log("Web Socket disconnect! Begin reconnect ...")},_receive:function(e){var t=JE.WebSocket,i=t.ReceiveCommand,a=JE.toNum(e.type),n=e.data;switch(t.debug&&console.log(e),a){case i.HANDSHAKE:(n=JSON.parse(n)).success||console.log("<<< handshake error:",n.msg);break;case i.JEPLUS:try{var o=JSON.parse(n),r=JE.eval(o.callFunction);r&&r.call(r,n)}catch(e){JE.eval(n)}break;case i.UNREAD:t._unread_msg=n=JSON.parse(n);for(var l={},s=0;s<n.length;s++){var d=n[s];if(d.type==i.JEPLUS)try{(o=JSON.parse(d.data)).batchCallFunction?(l[o.batchCallFunction]=l[o.batchCallFunction]||[],l[o.batchCallFunction].push(o)):t._receive(d)}catch(e){t._receive(d)}}JE.isNotEmpty(l)&&Ext.iterate(l,function(e,t){(e=JE.eval(e))&&e.call(e,Ext.encode({totalCount:t.length,rows:t}))});break;case i.IMMSG:case i.IM:case i.IMGROUPMSG:window._je_im_onmessage_&&window._je_im_onmessage_(e)}},send:function(e,t){var i=this,a=i.getSocket();if(a)if(i.socketio)a.emit(e,t);else{var n={cmd:0,type:0,sessionId:"",flags:0,body:t};switch(e){case"message":n.cmd=i.SendCommand.CHAT;break;case"_handshakeEvent":n.cmd=i.SendCommand.HANDSHAKE;break;case"heartbeat":n.cmd=i.SendCommand.HEARTBEAT}a.send(JSON.stringify(n))}else console.error("The socket is null")},_handshake:function(){JE.WebSocket.send("_handshakeEvent",{userId:JE.USER.userId,deviceId:"web",osName:"web",osVersion:"1.0",clientVersion:"1.0"})}}),Ext.define("JE.core.util.chart.ChartDS",{pageSize:30,currentPage:1,totalCount:0,constructor:function(e){var t=this,i={};if(JE.isEmpty(e))JE.alert("数据源编码不能为空！");else{if(Ext.isString(e)){if(!(i=JE.ajax({url:JE.getUrlMaps("je.core.load"),params:{tableCode:"JE_CORE_DATASOURCE",whereSql:"and DATASOURCE_CODE ='"+e+"'",limit:1}}).rows[0]))return void JE.alert(e+"数据源不存在！")}else if(Ext.isObject(e)){if(JE.isEmpty(e.JE_CORE_DATASOURCE_ID))return void JE.alert("数据源的编码应为字符串，请检查！");i=e}t.bean=i,t.config=Ext.decode(i.DATASOURCE_CONFIG),t.data=i.DATASOURCE_DATA,t.type=i.DATASOURCE_TYPE,t.code=i.DATASOURCE_CODE,t.text=i.DATASOURCE_TEXT}},load:function(t){var e=this,i=e.config,a=[];if(t=Ext.value(t,{}),e.limit=t.limit,"sql"==e.type||"table"==e.type){var n=e.data;if(Ext.each(i.params,function(e){t[e]=Ext.value(t[e],"")}),"table"==e.type){var o=[n];JE.isNotEmpty(i.whereSqlFn)?o.push(JE.eval(i.whereSqlFn)(t)||""):JE.isNotEmpty(i.whereSql)&&o.push(i.whereSql),JE.isNotEmpty(i.groupSql)&&o.push(i.groupSql),JE.isNotEmpty(i.orderSql)&&o.push(i.orderSql),n=o.join(" ")}n=n.replaceAll("\n","").replaceAll("\t",""),n=JE.toXT(n,t),t.sql=n,t.limit=e.loadAll||Ext.isEmpty(t.limit)?-1:t.limit,0<i.topNum&&(t.limit=-1,t.beforeLimit=i.topNum),0==(r=JE.ajax({url:JE.getUrlMaps("je.core.dbsql.select"),params:t})).success?JE.error("数据源:"+e.text+"("+e.code+")查询出错</br>错误原因："+r.obj+"</br>错误sql：</br>"+n):a=r.rows,e.totalCount=r.totalCount}else if("idit"==e.type)a=Ext.decode(e.data);else if("action"==e.type){Ext.each(i.params,function(e){t[e]=Ext.value(t[e],"")}),t.__params=Ext.encode(i.params),t.__className=i.className,t.__methedName=i.methedName,0==(r=JE.ajax({url:JE.getUrlMaps("je.core.phone.app","loadDS"),params:t})).success?JE.error("数据源:"+e.text+"("+e.code+")查询出错</br>错误原因："+r.obj):a=r.obj}else if("procedure"==e.type){Ext.each(i.params,function(e){t[e]=Ext.value(t[e],"")}),t.__params=Ext.encode(i.params),t.__dbQueryParams=Ext.encode(i.dbQueryParams),t.__procedureName=i.procedureName,t.__dbName=i.dbName,0==(r=JE.ajax({url:JE.getUrlMaps("je.core.web.app","loadProcedureDS"),params:t})).success?JE.error("数据源:"+e.text+"("+e.code+")查询出错</br>错误原因："+r.obj):a=r.rows}else if("js"==e.type){var r,l=JE.eval(e.data);if(JE.isNotEmpty(l))a=(r=Ext.value(l(t),{})).data,e.config.fields=r.fields}return a=a||[],e.rawData=a},loadPage:function(e,t){e<1&&(e=1),this.currentPage=e;t=Ext.value(t,{});var i=Ext.value(t.limit,this.pageSize);return this.loadAll=Ext.isEmpty(t.limit),t=Ext.apply({page:e,start:(e-1)*i,limit:i},t),this.load(t)},nextPage:function(e){return this.loadPage(this.currentPage+1,e)},previousPage:function(e){return this.loadPage(this.currentPage-1,e)},moveFirst:function(e){return this.loadPage(1,e)},moveLast:function(e){var t=this.getPageData().pageCount;return this.loadPage(t,e)},doRefresh:function(e){var t=this.currentPage;return this.loadPage(t,e)},getCount:function(){return JE.isEmpty(this.rawData)?0:Ext.isArray(this.rawData)?this.rawData.length:1},getTotalCount:function(){return this.totalCount||0},getPageData:function(){var e=this,t=e.getTotalCount(),i=Ext.value(e.limit,e.pageSize),a={total:t,currentPage:e.currentPage,limit:e.limit,pageCount:Math.ceil(t/i),fromRecord:(e.currentPage-1)*i+1,toRecord:Math.min(e.currentPage*i,t)};return a.pageCount=isNaN(a.pageCount)?1:a.pageCount,a}}),Ext.define("JE.core.util.ChildUtil",{getChild:function(e,t){var i,a=e.info;a.idSuffix,a.chShowType;return Ext.isEmpty(e.child)||("formview"==t?i=this.parseChild(e,"form","1","2"):"dataview"==t?i=this.parseChild(e,"data","3","4"):"editview"==t&&(i=this.parseChild(e,"edit","0"),i=Ext.isEmpty(i.items)?void 0:i.items[0].items)),i},parseChildObj:function(e){var t;if(-1!=["idit","chart","report","file","industry","gantt","portal","history"].indexOf(e.type)){if("file"!=e.type&&JE.initCtr(e.ctr),t={xtype:"panel",layout:"fit",border:0,margin:"1 0 0 0"},"idit"==e.type)t.items={xtype:JE.getXTypeByClassName(e.view)};else if("chart"==e.type)t.items={xtype:"jechartview",chartCode:e.view};else if("report"==e.type)t.items={xtype:"jereportview",reportCode:e.view};else if("industry"==e.type)t.items={xtype:"jeindustryview",industryCode:e.view};else if("file"==e.type)JE.initCtr("JE.sys.file.controller.FileController"),t.items={xtype:JE.getXTypeByClassName("JE.sys.file.view.MainView"),ddCode:e.view,uploadPath:e.ctr};else if("gantt"==e.type)t.items={xtype:"jeganttview"};else if("portal"==e.type){var i={xtype:"jeportalview",beanId:e.view};t.items=i}else if("history"==e.type){i={xtype:"jetool.historyview"};t.items=i}JE.isNotEmpty(e.funcIconCls)&&(t.iconCls=e.funcIconCls)}else{t={xtype:"jemainview",funcData:{info:{funcCode:e.code,funcName:e.name,funcIconCls:e.funcIconCls,childFunc:!0,idSuffix:Ext.value(e.idSuffix,"")}}},"tree"==e.type&&"treegrid"==e.ctr&&(t.showView=e.ctr)}return Ext.apply(t,{fields:e.fields,parentType:e.parentType,childFunc:!0,bodyPadding:1,title:e.name,orderIndex:e.orderIndex,idSuffix:Ext.value(e.idSuffix,""),id:e.viewId}),t},parseChild:function(e,n,o,t){var r,l,s=this,i=e.info,a=e.childObj,d=i.idSuffix,c=a[t],u=a[o],p=i.chHeight&&0<i.chHeight?i.chHeight:JE.getBodyHeight()/2+100,f={xtype:"panel",id:i.funcCode+"_childs_"+n+d,layout:{type:"vbox",align:"stretch",pack:"start"},border:0,height:0,items:[]};if(Ext.isEmpty(e.info.formBgColor)||(f.bodyStyle="background-color:"+e.info.formBgColor+";"),!Ext.isEmpty(u)){l={xtype:"tabpanel",id:i.funcCode+"_childs_"+n+"_H"+d,height:0,orderIndex:u[0].orderIndex,cls:"je-mainview-bg",bodyStyle:"border-width:0px;",items:[]},1==u.length&&(l.tabBar={hidden:!0});var E=p;Ext.each(u,function(e,t){e.parentType=n,e.idSuffix=d;var i=s.parseChildObj(e);if(i.id+=d,0==t&&"0"!=o&&i.funcData){var a=Ext.clone(i.funcData.info);i.funcData=JE.getFuncData(e.code),Ext.apply(i.funcData.info,a)}i.bodyPadding="1 0",l.items.push(i),e.height>E&&(E=e.height)}),l.height=E,1==l.items.length&&(l.border=0),f.items.push(l),f.height+=l.height,l.items.sort(function(e,t){return Ext.value(e.orderIndex,0)-Ext.value(t.orderIndex,0)})}if(!Ext.isEmpty(c)){r={xtype:"panel",id:i.funcCode+"_childs_"+n+"_V"+d,defaults:{flex:1},height:0,bodyStyle:"border-width:0px;",layout:{type:"vbox",align:"stretch",pack:"start"},orderIndex:c[0].orderIndex,items:[]};E=0;Ext.each(c,function(e,t){e.parentType=n,e.idSuffix=d;var i=s.parseChildObj(e);if(i.id+=d,i.bodyPadding="0",e.showTitle?(i.header={cls:"je-childfunc-header"},i.border=1,i.bodyStyle="border-width:0px !important;",i.tools=[{type:"toggle",callback:function(e,t,i){t.setType("toggle"==t.type?"collapsed":"toggle"),e["toggle"==t.type?"expand":"collapse"]()}}]):delete i.title,i.funcData){var a=Ext.clone(i.funcData.info);i.funcData=JE.getFuncData(e.code),Ext.apply(i.funcData.info,a)}r.items.push(i),0<e.height?(E+=e.height,i.height=e.height,i.flex=0):E+=p}),r.height=E,1==r.items.length&&(r.border=0),f.items.push(r),f.height+=r.height,r.items.sort(function(e,t){return Ext.value(e.orderIndex,0)-Ext.value(t.orderIndex,0)})}return 1==f.items.length&&(f.items[0].flex=1,delete f.items[0].height),f},getChildInfo:function(i){var a=[];return Ext.each(i.child,function(e){var t=Ext.getCmp(e.viewId+i.info.idSuffix);t&&a.push(t)}),a},setChildInfo:function(o){var r=this,e=o.funcData,l=Ext.clone(e.info),t=r.getChildInfo(e),s=(l.pkName,Ext.value(o.data,{}));Ext.each(t,function(e){var t=o.readOnly;if(e.hasOwnProperty("enableWFEdit")&&(t=!e.enableWFEdit),"jemainview"==e.xtype)r.setChildObj(e,{mainInfo:l,mainRecordData:s,datas:o.datas,readOnly:t}),Ext.isEmpty(e.funcData.child)||e.funcData.info.oneToForm||r.setChildInfo({funcData:e.funcData,readOnly:t});else{var i=e.items.get(0);if(i){var a=r.buildChildSql(l,e.fields,s).mainData;if(i.mainRecordData=s,i.mainData=a,i.mainInfo=l,i.load){if(a.mainID=s[l.pkName],a.mainFuncCode=l.funcCode,l.otherConfig){var n=JE.getObjAttr(l.otherConfig,"historyFuncCode");JE.isNotEmpty(n)&&(a.mainFuncCode=n)}i.rendered?i.load(a):i.on({afterrender:{fn:function(e){i.load(a)},single:!0}})}}}r.setFuncReadOnly({mainView:e,readOnly:t})});var i=Ext.getCmp(l.funcCode+"_childs_form_H"+Ext.value(l.idSuffix,""));i&&i.items.each(function(e,t){if(!e.tab.isHidden())return i.setActiveTab(t),!1})},setChildObj:function(e,t){var i=e.funcData,a=i.info.idSuffix,n=t.mainRecordData,o=t.mainInfo,r=(t.readOnly,i.info.funcCode),l={},s=[],d=Ext.getCmp(r+"_jegridview"+a),c=Ext.getCmp(r+"_jetreegridview"+a),u=Ext.getCmp(r+"_jeformview"+a),p=Ext.getCmp(r+"_jemainview"+a);if(p){var f=this.buildChildSql(o,e.fields,n,t.datas);l=f.mainData,s=f.whereFields;var E="";d?(E=d.store.sqls.parent,JE.DB.setWhereSql(d.store,s,"parent"),d.mainWhereFields=e.fields,c&&(c.parentSql=d.store.sqls.parent)):u?(E=u.mainWhereSql,u.mainWhereSql=JE.DB.buildWhereSql(s)):c&&(E=c.parentSql,c.parentSql=JE.DB.buildWhereSql(s)),Ext.each([p,d,u,c],function(e){e&&(e.mainData=l,e.mainInfo=o,e.mainRecordData=n)}),p.oldParentSql=Ext.value(E,""),o&&1==o.childRefresh&&-1!=["jeeditview","tabpanel"].indexOf(p.ownerCt.xtype)&&p.ownerCt.getActiveTab()!=p?p.needRefreshFunc=!0:p.refreshFunc()}e.mainConfig=t},buildChildSql:function(n,e,o,r){var l={},s=[],d={};return JE.isNotEmpty(o)?Ext.each(e,function(t){if(1==t.whereSql&&"no"!=t.whereType){var e={};if("idit"==t.whereType){var i=JE.DB.formatSql(t.sql,o);e={type:t.whereType,sql:i}}else{e={code:t.chCode,type:t.whereType,value:o[t.code]};if(!Ext.isEmpty(r)&&t.code==n.pkName){e={code:t.chCode,type:"in"};var a=[];Ext.each(r,function(e){a.push(e.get(t.code))}),e.value=a.join(",")}}if(t.code==n.pkName&&Ext.isEmpty(e.value))return!(s=[{code:"1",type:"!=",value:1}]);s.push(e)}1==t.value&&(l[t.chCode]=o[t.code]),t.cascadeUpdate&&t.code!=n.pkName&&(d[t.chCode]=o[t.code])}):s.push({code:"1",type:"!=",value:1}),{mainData:l,whereFields:s,updateFields:d}},setFuncReadOnly:function(e){var t=e.readOnly,i=e.mainView;if(null!=t&&i)if("jemainview"==i.xtype)i.setReadOnly(t);else{var a=i.items.get(0);a.setReadOnly?a.setReadOnly(t):a.setDisabled(t)}}}),Ext.define("JE.core.util.FieldUtil",{hasRole:function(t,e,i){if(e)return!0;if(JE.isEmpty(t))return!1;var a=!1;t=Ext.isString(t)?t.split(","):t;var n="1"==JE.systemConfig.JE_SYSMODE,o="roleId";if(n&&!JE.currentUser.saas&&(o="baseRoleId"),Ext.each(JE.currentUser.roles,function(e){if(-1!=t.indexOf(e[o]))return!(a=!0)}),a&&n&&!JE.currentUser.saas)if(JE.currentUser.saasAdmin){var r=JE.dicInfoData[i];"1"!=(r?Ext.value(r.DICTIONARY_ZWFFLAG,"0"):"0")&&(a=!1)}else a=!1;return a},setConfigInfo:function(n){var o=this;if(o.configData&&!Ext.isEmpty(o.configData.fieldNames)){n=Ext.value(n,{});JE.isEmpty(n);var e=o.configData.fieldNames,r=o.configData.valueNames;if(!Ext.isEmpty(e)){var l=o.getParentInfo(n.parentData);Ext.each(e,function(e,t){var i=r[t],a=[];Ext.each(n.datas,function(e){Ext.isEmpty(e)||a.push(e[i])}),l.values=a,l.fieldName=e,!n.self&&o.name==e||o.setFieldValues(l)})}}},getParentInfo:function(e){var t,i=this,a={},n="";if(i.ownerCt&&"editor"==i.ownerCt.xtype){if(t=i.ownerCt.grid,n="grid",1==e){var o=t.getSelectionModel().getSelection()[0];o&&(a=Ext.clone(o.data))}}else if(i.ownerCt&&"uxcolumn"==i.ownerCt.xtype){if(t=i.ownerCt.getOwnerHeaderCt(),n="column",1==e){var r=t.query("[isFormField]");Ext.each(r,function(e){a[e.name]=e.getValue()})}}else n="form",(t=i.formObj||i.up("form"))&&t.body&&t.getForm().findField(i.name)?1==e&&(a=t.getForm().getValues()):(t=i,n="self");var l={};if(JE.isNotEmpty(i.funcCode)){var s=JE.getFunc(i.funcCode,"_window");(s=s||JE.getFunc(i.funcCode))?l=s.getParentData():"grid"==n&&t.childFunc&&(l=t.ownerCt.formObj.form.getValues()),Ext.iterate(l,function(e,t){a["parent."+e]=t,a["parent_"+e]=t})}return{parent:t,data:a,parentType:n,parentMainData:l}},setFieldValues:function(e){var t=e.parent,i=e.fieldName,a=Ext.value(e.values,[]),n=e.parentType;if(t)switch(n){case"grid":var o=t.getSelectionModel().getSelection()[0];o&&o.set(i,a.join(","));break;case"form":(r=t.getForm().findField(i))&&r.setValue(a.join(","));break;case"column":var r;(r=t.down("[isFormField][name="+i+"]"))&&r.setValue(a.join(","));break;case"self":i==t.name&&t.setValue(a.join(","))}},getFieldValues:function(e){var t=e.parent,i=e.fieldName,a=e.parentType;if(t)switch(a){case"grid":var n=t.getSelectionModel().getSelection()[0];if(n)return n.get(i);break;case"form":if(o=t.getForm().findField(i))return o.getValue();break;case"column":var o;if(o=t.down("[isFormField][name="+i+"]"))return o.getValue();break;case"self":if(i==t.name)return t.getValue()}}}),Ext.define("JE.core.util.func.Form",{setReadOnly:function(i){var e=this,a=e.funcData;if(e.readOnly!=i){e.readOnly=i;var n=e.getDockedComponent("buttonBar");if(n){var t=a.form.buttons;Ext.each(t,function(e){var t=n.down("button[ref="+e.ref+"]");t&&1!=t.noReadOnly&&!t.initialConfig.hidden&&-1==["formBackBtn","__formPrintBtn"].indexOf(t.ref)&&t.setVisible(!i)})}if(e.setItemsReadOnly(i),e.useFiles&&e.formFilesSet&&e.formFilesSet.setReadOnly(i),0!=e.useChild)for(var o=0;o<3;o++){var r=a.childObj[o+""];Ext.each(r,function(e){var t=Ext.getCmp(e.viewId+Ext.value(a.info.idSuffix,""));t&&(t.rendered?t.setReadOnly&&t.setReadOnly(i):(t.readOnly=i,t.mainConfig&&(t.mainConfig.readOnly=i)))})}if(!i){var l=e,s=l.getValues();Ext.iterate(a.fieldExp,function(e,t){var i=l.form.findField(e);JE.Action.doFieldExp(l,i,s,!0)})}}},setItemsReadOnly:function(t){var e=this.funcData;this.getForm().setItemsReadOnly(t);var i=[];if(!Ext.isEmpty(e.form.childFuncFields)){var a=this.query("childfuncfield[formCode="+e.info.funcCode+"_form]");i=i.concat(a)}Ext.each(i,function(e){e.initialConfig.readOnly&&e.initialConfig.readOnly==e.readOnly||e.initialConfig.hidden||e.setReadOnly(t)})},setValues:function(e,a,t){var n=this;Ext.iterate(e,function(e,t){var i=n.form.findField(e);i&&(i.setValue(t),a&&i.resetOriginalValue())})},addHistory:function(e){var i=[],t=this.funcData.info,a=this.getValue(t.pkName);if(this.getForm().getChanges().each(function(e){var t=e.initialConfig;1==t.history&&-1==["ckeditor"].indexOf(t.xtype)&&i.push({text:e.text,oldVal:e.oldVal,newVal:e.newVal})}),0<i.length){var n=t.funcCode;if(t.otherConfig){var o=JE.getObjAttr(t.otherConfig,"historyFuncCode");JE.isNotEmpty(o)&&(n=o)}JE.ajax({url:JE.getUrlMaps("je.core.save"),params:{PAGENICKED_NICKED:Ext.encode(i),PAGENICKED_FUNCCODE:n,PAGENICKED_BUSINESSID:a,tableCode:"JE_CORE_PAGENICKED"}}).success&&e&&e()}},getValue:function(e){if(Ext.isEmpty(e))return this.form.getValues();var t=this.getFields(e);return t?t.getValue():void 0},getFields:function(e){var t="[formCode="+this.funcData.info.funcCode+"_form]";if(Ext.isEmpty(e)){var i=new Ext.util.MixedCollection;return i.add(this.query(t)),i}return this.down(t+"[name="+e+"]")},fieldReadOnly:function(t,e){var i=this,a=[e];Ext.isArray(e)&&(a=e),Ext.each(a,function(e){i.getFields(e).setReadOnly(t)})},fieldVisible:function(t,e){var i=this,a=[e];Ext.isArray(e)&&(a=e),Ext.each(a,function(e){i.getFields(e).setVisible(t)})},fieldHide:function(e){this.fieldVisible(!1,e)},fieldShow:function(e){this.fieldVisible(!0,e)},getButton:function(e){var t,i=this.getDockedComponent("buttonBar");return i&&(t=i.down("[ref="+e+"]"))&&!t.fireHandler&&(t.fireHandler=function(){this.fireEvent("click",this)}),t},clickButton:function(e){var t=this.getButton(e);t&&t.fireHandler()},getChanges:function(e){return this.form.getChanges(e)},reload:function(){var e=this.funcData.info,t=this.getValue(e.pkName),i=JE.ajax({url:Ext.value(e.funcAction,JE.getUrlMaps("je.core.getInfoById")),params:{tableCode:e.viewTableName,pkValue:t}});if(i){var a=Ext.create(e.modelName,i);this.loadRecord(a)}},commitChanges:function(e){var t=this.getFields(e);JE.isNotEmpty(e)?t.commitChange&&t.commitChange():t.each(function(e){e.commitChange&&e.commitChange()})}}),Ext.define("JE.core.util.func.Func",{constructor:function(e){var t=this,i={};Ext.isString(e)?i.funcCode=e:i=e;var a=Ext.value(i.idSuffix,""),n=i.funcCode,o=["_jemainview","_jeformview","_mainview","_jeindustryview","_jeportalview","_jereportview","_jechartview","_jefileview","_jeganttview","_jehistoryview"],r=JE.isEmpty(a)?"_window":a;if(Ext.each(o,function(e){if(t.mainview=Ext.getCmp(n+e+r),t.mainview)return a=r,!1}),t.mainview||Ext.each(o,function(e){if(t.mainview=Ext.getCmp(n+e+a),t.mainview)return!1}),!t.mainview)throw"功能"+n+"不存在！";t.mainview.funcData?(t.info=t.mainview.funcData.info,t.funcData=t.mainview.funcData,t.mainRecordData=t.mainview.mainRecordData,t.mainInfo=t.mainview.mainInfo,t.mainview=Ext.getCmp(t.info.funcCode+"_jemainview"+a),t.gridview=Ext.getCmp(t.info.funcCode+"_jegridview"+a),t.formview=Ext.getCmp(t.info.funcCode+"_jeformview"+a),t.formview_add_list=Ext.getCmp(t.info.funcCode+"_jeformlistview"+a),t.treeview=Ext.getCmp(t.info.funcCode+"_jetreeview"+a),t.dataview=Ext.getCmp(t.info.funcCode+"_jedataview"+a),t.queryview=Ext.getCmp(t.info.funcCode+"_jedataview_queryform"+a),t.formview_add_list&&!t.formview_add_list.isHidden()&&(t.formview=t.formview_add_list),t.child=new Ext.util.MixedCollection,Ext.each(t.funcData.child,function(e){t.child.add(e.code,JE.getFunc(e.code))}),t.jefunc=!0):t.info={funcName:t.mainview.title,funcCode:n}},getParentData:function(){return Ext.value(this.mainRecordData,{})},getParentInfo:function(){return Ext.value(this.mainInfo,{})},getParent:function(){var e=this.getParentInfo();if(!Ext.isEmpty(e.funcCode))return this.parent||(this.parent=JE.getFunc(e.funcCode)),this.parent},getFormData:function(e){return this.formview.getValue(e)},setReadOnly:function(e){if(this.jefunc)(this.mainview||this.formview).setReadOnly(e);else{var t=this.mainview.items.get(0);t&&(t.setReadOnly?t.setReadOnly(e):t.setDisabled(e))}},getChild:function(e){return this.child.get(e)},getChildAt:function(e){return this.child.getAt(e)},gridLoad:function(){this.gridview&&this.gridview.reload()},getExtendPanels:function(e){if(this.dataview){var t={};return this.dataview.down("panel[itemId=jedataview_center]").items.each(function(e){e.extendPanel&&(t[e.region]=e)}),e?t[e]:t}}}),Ext.define("JE.core.util.func.Grid",{refershRowNumber:function(){var n=1;this.body.select("td.x-grid-cell-row-numberer div.x-grid-cell-inner-row-numberer").each(function(e,t,i){var a=e.dom;0==i?n=JE.toNum(a.innerHTML):n++,a.innerHTML=n})},refreshLocation:function(e){if(this.hasListener("refreshlocation")){var t=this.up("jemainview");t&&JE.refreshLocation(t,e,this)}},setReadOnly:function(a){var n=this;if("query"!=n.type&&n.readOnly!=a){n.readOnly=a;var i=n.funcData,e=n.getDockedComponent("buttonBar"),t=n.getDockedComponent("buttonMultiBar");Ext.each([e,t],function(i){i&&(n.updateButton=!1,Ext.each(n.funcData.grid.buttons,function(e){var t=i.down("button[ref="+e.ref+"]");t&&1!=t.noReadOnly&&!t.initialConfig.hidden&&-1==["gridEditBtn","gridExportXLSBtn","__gridPrintBtn"].indexOf(t.ref)&&t.setVisible(!a),t&&"gridUpdateBtn"==t.ref&&(n.updateButton=!t.isHidden())}))});var o=Ext.value(n.normalGrid,n).getPlugin("cellEdit");if(o){var r=a;n.updateButton&&(r=!1),r?o.disable():o.enable()}var l=Ext.value(n.normalGrid,n).view.getPlugin("ddOrder");if(l&&l.dragZone[a?"lock":"unlock"](),"LIST"==i.info.insertType){var s=n.columns.concat([n.columnManager.headerCt.items.get(0)]);Ext.each(s,function(e){e&&e.setReadOnly&&!e.hiddenColumn&&e.setReadOnly(a)})}for(var d=3;d<5;d++){var c=i.childObj[d+""];Ext.each(c,function(e){var t=Ext.getCmp(e.viewId+Ext.value(i.info.idSuffix,""));t&&(t.rendered?t.setReadOnly&&t.setReadOnly(a):(t.readOnly=a,t.mainConfig&&(cObj.mainConfig.readOnly=a)))})}}},getButton:function(e,t){var i,a=this.getDockedComponent("buttonBar");if(a&&(i=a.down("[ref="+e+"]"))&&!i.fireHandler&&(i.fireHandler=function(){this.fireEvent("click",this)}),!i){var n=this.getDockedComponent("buttonMultiBar");n&&(i=n.down("button[ref="+e+"]"))}return i},clickButton:function(e){var t=this.getButton(e);t&&t.fireHandler()},getSelection:function(t){var e=this.getSelectionModel().getSelection();if(Ext.isEmpty(t))return e;var i=[];return Ext.each(e,function(e){i.push(e.get(t))}),i},getSelectIds:function(){return this.getSelection(this.funcData.info.pkName)},getSelectFieldValues:function(e){return this.getSelection(e)},getSelected:function(){return this.getSelection()[0]},createModel:function(e){return e=Ext.value(e,{}),this.store.createModel(e)},insertRecord:function(e,t){return this.store.insert(e,t)},addRecord:function(e){return this.store.add(e)},getColumn:function(e){if(this.columnManager)return this.columnManager.getHeaderById(e)},reload:function(){this.store.reload()},loadPage:function(e){this.store.loadPage(e)},load:function(e){this.store.load(Ext.value(e,{}))},loadData:function(e){this.store.loadData(e)},getStoreParams:function(){return this.store.proxy.extraParams},getNewRecords:function(){return this.store.getNewRecords()},getUpdatedRecords:function(){return this.store.getUpdatedRecords()},getRemovedRecords:function(){return this.store.getRemovedRecords()},initCommonConfig:function(e){var t=this;t.localLang=JE.getLocalLang("core.jegridview"),t.plugins=Ext.value(t.plugins,[]),t.features=Ext.value(t.features,[]),t.dockedItems=[],t.store=Ext.create("JE.core.store.GridStore",{autoLoad:1!=e.info.childFunc,gridObj:t,buffered:e.info.gridBuffered,leadingBufferZone:e.info.pageSize}),t.tbar=t.buildButtonBar(e),t.bbar={xtype:"uxpagingtoolbar",itemId:"pagingtoolbar",useTheme:!0,store:t.store,displayInfoAlign:Ext.value(e.info.pageInfoAlign,"right"),style:"border-color:#eaeaea",hidden:"hidden"==Ext.value(e.info.pageInfoAlign,"right")},t.bodyStyle=Ext.value(t.bodyStyle,"")+"border-left-color:#eaeaea;border-right-color:#eaeaea;border-bottom-color:#eaeaea;",t.multiSelect=Ext.value(t.multiSelect,e.info.multiSelect),Ext.isEmpty(e.info.gridTip)?t.emptyText=JE.CoreUtil.getEmptyDataTpl():t.emptyText="<div class=x-view-emtpytext >"+e.info.gridTip+"</div>"},buildButtonBar:function(e){var t={};return e.info.simpleBar?this.buildSimpleBtnBar(e):("query"==this.type?(t={itemId:"buttonBar",items:this.buildButtons(e)}).hidden=0==t.items.length:t={itemId:"buttonBar",items:this.buildButtons(e),hidden:e.info.hideGridTBar},Ext.apply(t,{cls:"je-grid-btnbar je-button-bar",height:50}),t)},buildSimpleBtnBar:function(e){return"query"==this.type?(tbar={itemId:"buttonBar",items:this.buildNewButtons(e)},tbar.hidden=0==tbar.items.length):tbar={itemId:"buttonBar",items:this.buildNewButtons(e),hidden:e.info.hideGridTBar},Ext.apply(tbar,{cls:"je-grid-btnbar je-button-bar je-grid-btnbar-simple",height:50,padding:"0 4",defaults:{margin:"0 4"}}),tbar},buildNewButtons:function(e){var t=this,i=(e.info,t.buildNewSearchs(e));if("query"==t.type)return i;var a=[],n=[],o=[],r=["gridInsertBtn"],l=["gridRemoveBtn","gridEditBtn"];Ext.each(e.grid.buttons,function(e){if(JE.isNotEmpty(e.barPosition)){if(-1!=e.barPosition.indexOf("BAR"))a.push(e);else if(-1!=e.barPosition.indexOf("MORE")){var t=Ext.clone(e);delete t.xtype,n.push(t)}-1!=e.barPosition.indexOf("MULTI")&&o.push(e)}else-1!=r.indexOf(e.code)?a.push(e):-1!=l.indexOf(e.code)?o.push(e):(delete e.xtype,e.itemId=e.ref,n.push(e))}),i=i.concat(a),e.info.wf;var s=t.getPrintInfo();if(JE.isNotEmpty(s.type)){var d=t.getFuncPrintBtn();d.text="打印",n.push(d),o.push(d)}return Ext.each(e.common.buttons,function(e){var t=Ext.clone(e);t.text=Ext.value(t.tooltip,t.text),delete t.xtype,n.push(t)}),JE.isNotEmpty(n)&&i.push({xtype:"button",text:"更多",cls:"JEPLUS_B_C07",itemId:"_moreButtons",menuAlign:"tr-br",menu:{cls:"je-menu-item34h je-menu-arrow je-menu-arrow-tr",plain:!0,shadow:!1,items:n}}),t.configButtons&&i.push(t.configButtons),JE.isNotEmpty(o)&&(Ext.each(o,function(e){e.cls=e.cls||"JEPLUS_B_C07"}),(o=[{xtype:"box",style:"padding-left:10px;color:#444;",tpl:'已选择<span style="color:#3e84e9;margin:0 5px;">{num}</span>条 <i class="close jeicon jeicon-error" style="margin-left:0 5px;padding: 5px;cursor: pointer;font-size:12px;color: #858585;"></i>',data:{num:0},itemId:"selectNum",listeners:{afterrender:function(e){e.getEl().on("click",function(e){e.getTarget(".close")&&t.getSelectionModel().deselectAll()})}}},{xtype:"tbseparator",margin:"0 15",height:25}].concat(o)).push("->",{xtype:"box",style:"padding:10px 15px;cursor: pointer;",html:'<i class="fa fa-remove"></i>',listeners:{afterrender:function(e){e.getEl().on("click",function(){t.getSelectionModel().deselectAll()})}}}),t.dockedItems.push({xtype:"toolbar",itemId:"buttonMultiBar",items:o,hidden:!0,cls:"je-grid-btnbar je-button-bar je-grid-btnbar-simple",height:50,defaults:{margin:"0 4"}})),i},buildNewSearchs:function(e){var o=this,t=e.info,i=[],a=Ext.value(e.info.gridHides,"");if(-1==a.indexOf("cxcl")){var n=Ext.create("Ext.menu.Menu",{plain:!0,shadow:!1,minWidth:150,margin:0,padding:0,cls:"je-menu-item34h je-menu-arrow je-menu-arrow-t",items:[{xtype:"boundlist",border:0,itemId:"view",store:JE.getStore({tableName:"JE_CORE_QUERYSTRATEGY",id:"JE_CORE_QUERYSTRATEGY_ID",async:!1,params:{limit:-1,whereSql:" and QUERYSTRATEGY_FUNCCODE = '"+t.funcCode+"' and (QUERYSTRATEGY_USERID = '"+JE.USER.userId+"' or QUERYSTRATEGY_USERID ='' or QUERYSTRATEGY_USERID is null)",orderSql:" order by QUERYSTRATEGY_USERID,SY_ORDERINDEX"}}),tpl:['<ul class="'+Ext.plainListCls+'"><tpl for=".">','<li role="option" unselectable="on" class="x-boundlist-item" style="padding:0px 10px;">{QUERYSTRATEGY_NAME}</li>',"</tpl></ul>"],maxHeight:350,autoScroll:!0,listeners:{itemclick:function(e,t){n.hide(),setTimeout(function(){n.doSearch(t.data)},10)}}},"-",{text:"新建查询策略",iconCls:"fa fa-plus",handler:function(e){JE.win({title:"新建查询策略",width:600,height:360,autoShow:!0,items:{xtype:"jetool.searchview",type:"cxcl",grid:o,menuView:e.ownerCt.getCmp("view")}})}},{text:"管理",iconCls:"fa fa-gear",handler:function(e){JE.win({title:"查询策略管理",items:{xtype:"jetool.cxclview",grid:o,menuView:e.ownerCt.getCmp("view")},width:800,height:600,autoShow:!0})}}],doSearch:function(e){var t=n.ownerButton;if(e.JE_CORE_QUERYSTRATEGY_ID!=t.searchInfo.id){t.searchInfo={text:e.QUERYSTRATEGY_NAME,id:e.JE_CORE_QUERYSTRATEGY_ID},t.setText(t.searchInfo.text);var i=[];"ALL"!=e.JE_CORE_QUERYSTRATEGY_ID&&i.push(e),JE.Action.doCxclQuery(o,i)}}});n.on("show",function(){var e=n.getCmp("view"),t=e.getSelectionModel();JE.isEmpty(t.getSelection())&&e.store.each(function(e){"1"!=e.get("QUERYSTRATEGY_DEF")||t.select(e)})}),n.getCmp("view").store.on("load",function(e){var a=JE.CoreUtil.getUserInfo("CXCL",o.funcData,e.data.items);if(a){var n=[];Ext.each(a.config.show,function(i){e.each(function(e){var t=e.data;i==t.JE_CORE_QUERYSTRATEGY_ID&&(t.QUERYSTRATEGY_DEF=a.config.def==t.JE_CORE_QUERYSTRATEGY_ID?"1":"0",n.push(t))})}),e.removeAll(),e.add(n)}e.insert(0,{QUERYSTRATEGY_NAME:"全部",JE_CORE_QUERYSTRATEGY_ID:"ALL"})[0]}),n.getCmp("view").store.load();var r=n.getCmp("view").store.getAt(0);n.getCmp("view").store.each(function(e){if("1"==e.get("QUERYSTRATEGY_DEF"))return"ALL"!=(r=e).get("JE_CORE_QUERYSTRATEGY_ID")&&JE.Action.doCxclQuery(o,[r.data],!1),!1}),i.push({xtype:"box",html:o.localLang.cxclButtonText+"：",margin:"0 0 0 20"},{xtype:"button",itemId:"cxclBtn",cls:"JEPLUS_B_C08",text:r.data.QUERYSTRATEGY_NAME,searchInfo:{text:r.data.QUERYSTRATEGY_NAME,id:r.data.JE_CORE_QUERYSTRATEGY_ID},menuAlign:"t-b",menu:n},{xtype:"tbseparator",margin:"0 15",height:25})}return-1==a.indexOf("groupQuery")&&i.push({itemId:"queryBtn",iconCls:"fa fa-filter",text:o.localLang.advancedQuery,cls:"JEPLUS_B_C08",handler:function(e){var t,i=e.ownerCt.getCmp("cxclBtn");i&&(t=i.menu.getCmp("view")),o.showMoreSearch(t)}}),-1==a.indexOf("keywordQuery")?i.push(o.getGridKeyword(),"->"):i.push("->"),e.info.mark&&i.push({xtype:"markfield",width:150,itemId:"markfield",listeners:{change:function(e,t){e.loadGrid(o,t)}}}),i},initColumnSearch:function(){var e=[this];this.lockable&&(e=[this.lockedGrid,this.normalGrid]),Ext.each(e,function(e){e.addDocked({xtype:"uxcolumneditor",grid:e,dock:"top",weight:100,hidden:!0,type:"search",itemId:"columnsearch"})})},initColumnEditCfg:function(){var n=this,e=n.headerCt,t=Ext.JSON.decode(n.funcData.info.otherConfig),i=0,a='<div class="search"><i class="fa fa-search"></i></div>',o=0,r='<div class="config"><i class="fa fa-cog"></i></div>';JE.isNotEmpty(t)&&(JE.isNotEmpty(t.gridQueryBtnHide)&&(i=t.gridQueryBtnHide),JE.isNotEmpty(t.columnCtrBtnHide)&&(o=t.columnCtrBtnHide)),"1"==i&&(a=""),"1"==o&&(r=""),n.lockable&&n.lockedGrid&&n.normalGrid&&(e=n.normalGrid.headerCt);var l=document.createElement("div");l.setAttribute("id",n.id+"-columncfg"),l.setAttribute("class","je-grid-columnconfig"),l.innerHTML=a+r,n.columnCfgEl=e.getEl().appendChild(l),n.columnCfgEl.on("click",function(e){var t=e.getTarget(".search",2,!0),i=e.getTarget(".config",2,!0);if(t){if(-1!=Ext.value(n.funcData.info.gridHides,"").indexOf("columnQuery"))return void JE.msg("本功能不支持列头查询！");t[t.hasCls("active")?"removeCls":"addCls"]("active");var a=[n];n.lockable&&(a=[n.lockedGrid,n.normalGrid]),Ext.each(a,function(e){var t=e.getDockedCmp("columnsearch");t?t.setVisible(t.isHidden()):t=e.addDocked({xtype:"uxcolumneditor",grid:e,dock:"top",weight:100,type:"search",itemId:"columnsearch"})[0],t.isHidden()&&t.resetSearch()})}else if(i){if("query"==n.type)return void JE.alert("查询选择不支持！");JE.win({title:"编辑列",items:{xtype:"jetool.iditcolumnview",grid:n},width:600,height:Ext.getBody().getHeight()-220,autoShow:!0})}});var s=new Ext.util.DelayedTask(function(){n.columnCfgEl.show()});e.getEl().on("scroll",function(e,t,i){var a=t.scrollLeft;n.columnCfgEl.hide(),n.columnCfgEl.dom.style.right=-a+"px",s.delay(500)})},initSearchField:function(){var e=this;e.qqfield=e.down("qqfield"),!e.qqfield&&e.searchMenu&&(e.qqfield=e.searchMenu.down("qqfield"))},getPrintInfo:function(){var e=this.funcData,t={type:""};return t.func={code:e.info.funcCode,fields:this.mainWhereFields,grid:this},t.parentData=this.mainRecordData,e.info.lodopPrint&&e.info.lodopConfig&&-1!=e.info.lodopPrint.indexOf("GRID")?t.type="lodopPrint":e.info.gridEnablePrint&&(t.type="list",e.info.gridPrintInfo.print&&(t.lodop="PRINT")),t},buildButtons:function(e){var t=this,i=t.buildSearchs(e);if("query"==t.type)return i;if(i=e.grid.buttons.concat(["->"]).concat(i),e.info.wf){var a={bigIconCls:"JE_WF_PLSP_32",iconCls:"jeicon jeicon-batch-approval",text:t.localLang.batchWFButtonText,handler:function(){var e=t.getDockedComponent("wfBatchBar");e.isHidden()?e.show():e.hide()}};"plus"==JE.getTheme()&&(a.iconCls="fa fa-list-ul",a.tooltip=a.text,delete a.text),JE.toBigButton(a,e.info.bigButton),i.push(a),t.dockedItems.push(t.getWfBatchBar())}var n=t.getPrintInfo();return JE.isNotEmpty(n.type)&&i.push(t.getFuncPrintBtn()),i=i.concat(e.common.buttons),t.configButtons&&i.push(t.configButtons),i},buildSearchs:function(e){var i=this,t=[];e.info.mark&&t.push({xtype:"markfield",width:150,itemId:"markfield",listeners:{change:function(e,t){e.loadGrid(i,t)}}});var a=Ext.value(e.info.gridHides,""),n=i.getGridQueryTool();if(n.hideTrigger3=-1!=a.indexOf("groupQuery"),"plus"==JE.getTheme()){i.searchMenu=Ext.create("Ext.menu.Menu",{plain:!0,cls:"je-grid-searchmenu",width:n.width,bodyStyle:e.info.simpleSearch?"":"border-top-width:0px;",items:[{iconCls:"fa fa-window-maximize",text:"高级查询（全部）",handler:function(e){i.showMoreSearch(),i.searchMenu.hide()}}]});var o=n;e.info.simpleSearch&&(o={iconCls:"fa fa-search",menuAlign:"tr-br",menu:i.searchMenu},n.hideTrigger4=!0,i.searchMenu.insert(0,n)),t.push(o)}else Ext.apply(n,{hideTrigger4:!0,hideLabel:!1}),t.push(n);if(-1!=a.indexOf("keywordQuery")&&t.pop(),-1==a.indexOf("cxcl")){var r=i.buildCXCLInfo(i,e.info);JE.isNotEmpty(r)&&(r.bar&&(r.bar.hidden=0==r.bar.store.getCount(),i.dockedItems.push(r.bar)),r.btn&&t.push(r.btn))}return t},showMoreSearch:function(e){var t=this;if(!t.groupSearchWin){var i=Ext.value(t.funcData.info.gridHides,"");t.groupSearchWin=JE.win({title:t.localLang.advancedQuery,width:600,height:-1==i.indexOf("cxcl")?300:250,closeAction:"hide",items:{xtype:"jetool.searchview",type:"search",grid:t,menuView:e,enableCXCL:-1==i.indexOf("cxcl")}})}t.groupSearchWin.show()},getAllSummary:function(){var n={tableCode:this.store.proxy.extraParams.tableCode,whereSql:this.store.proxy.extraParams.whereSql,types:[],fields:[]},o=[],r={};if(Ext.iterate(this.funcData.basicColumns,function(i,a){a.summary&&(r[i]=0,Ext.each(Ext.decode(a.summary),function(e,t){o[t]=o[t]||Ext.clone(n),o[t].types.push(e.code),o[t].fields.push(a.dataIndex),r[i]++}))}),o.length){var l={};return Ext.each(o,function(a){var n=JE.getAllSummary(Ext.clone(a));Ext.each(a.fields,function(e,t){var i=a.types[t];1<r[e]?(l[e]=l[e]||{},l[e][i]=n[e]):l[e]=n[e]})}),l}return{}}}),Ext.define("JE.core.util.func.Tree",{nodeLoad:function(t){var e=this;if(e.loadInfo){var i=e.disableCheck,a=t.get("id").split("_")[0],n=Ext.clone(e.loadInfo.params),o=e.loadInfo.url,r=Ext.decode(n.strData),l=JE.getObjAttr(t.get("description"),"async");Ext.each(r,function(e){if(e.wfUser||l||JE.isEmpty(e.nodeInfo)||e.nodeInfo==t.get("nodeInfo"))return e.rootId=a,e.isRoot="0",!(r=[e])}),n.strData=Ext.encode(r);var s=JE.ajax({url:o,params:n});if(e.searchBar)e.getDockedCmp("queryBar").getCmp("searchfield").addNodeData(s,r[0].ddName);return"1"==i&&Ext.each(s,function(e){"1"==e.disabled&&delete e.checked}),s}},load:function(e){var t=this,i={},a=!1;e=Ext.value(e,{});if(0!=t.fireEvent("beforeload",t,e)){var n=Ext.clone(Ext.value(t.params,{}));if(t.rootData)i=Ext.clone(t.rootData),a=!0;else{Ext.apply(n,Ext.value(e.params,{}));var o=t.getRootNode().get("id"),r=Ext.value(Ext.value(e.formatData,t.formatData),{});Ext.applyIf(n,{node:o,onlyItem:t.onlyItem,excludes:1!=t.multiSelect?"checked":"",strData:t.getConfigInfo(r)}),n.parentSql=Ext.value(n.parentSql,Ext.value(t.parentSql,"")),n.whereSql=Ext.value(n.whereSql,"")+" "+Ext.value(t.whereSql,"")+" "+n.parentSql;var l=Ext.value(t.url,JE.getUrlMaps("je.core.dd.tree","loadTree"));i=JE.ajax({url:l,params:n}),t.loadInfo={url:l,params:n},t.funcData&&"tree"==t.funcData.info.funcType&&(a=!0,Ext.applyIf(i,{id:"ROOT",expanded:!0,children:[]}))}t.loadData(i,a)}},buildNodeHash:function(e,i){var a=this,n=Ext.applyIf({children:[]},e),o=a.disableCheck;Ext.each(e.children,function(e){var t=Ext.applyIf({children:[]},e);"1"==o&&"1"==t.disabled&&delete t.checked,n.children.push(t),a.buildNodeHash(e,i),t.parent=i[t.id].parent=n.id}),i[n.id]=n},loadData:function(e,t,a){var n=this,i=n.getRootNode();if(1!=t){var o=Ext.clone(i.data);o.children=e||[],e=o}n.nodeHash={},n.buildNodeHash(e,n.nodeHash),n.async&&(e=n.nodeHash[e.id]),Ext.each(e.children,function(e){e.cls="je-tree-search-root","query"!=n.ref||n.onlyItem||(e.iconCls=JE.getIconCls({icon:e.iconCls,font:"fe icon-book-alt"},"icon","font"))}),i=n.setRootNode(e),n.async&&i.eachChild(function(e){n.isAsyncNode(e)&&e.set("loaded",!1)}),1!=n.async&&0!=n.expandRootChild&&i.expandChildren();var r=[];if(t||n.onlyItem||!n.defValueFields){var l=Ext.value(a,n.expandDepth);0<l&&r.push({node:i,depth:l})}else i.eachChild(function(e){var t=Ext.value(n.defValueFields[e.raw.nodeInfo],{}),i=Ext.value(a,t.expandDepth);0<i&&r.push({node:e,depth:i+1})});Ext.each(r,function(e){n.expandNodeDepth(e.node,e.depth)}),n.fireEvent("load",n.store)},isAsyncNode:function(t){var i=!1,a=JE.getObjAttr(t.get("description"),"async");return Ext.each(this.configInfo,function(e){if(e.async&&(e.wfUser||a||JE.isEmpty(e.nodeInfo)||e.nodeInfo==t.get("nodeInfo")))return!(i=!0)}),i},expandNodeDepth:function(e,t){var i=this;e.data.depth<=t&&(e.isExpanded()||e.expand(),e.eachChild(function(e){i.expandNodeDepth(e,t)}))},getSelection:function(e){var t=this.getSelectionModel().getSelection();if(1==e&&!Ext.isEmpty(t)&&this.funcData&&"tree"!=this.funcData.info.funcType){var i=[];Ext.each(t,function(e){"ROOT"!=e.get("parentId")&&i.push(e)}),t=i}return t},getSelected:function(e){return this.getSelection(e)[0]},selectNode:function(e,t){Ext.isString(e)&&(e=this.getStore().getNodeById(e)),e&&(this.expandPath(e.getPath()),this.getSelectionModel().select(e,null,0==t))},setReadOnly:function(e){var t=this.view.getPlugin("ddOrder");t&&t.dragZone[e?"lock":"unlock"]()},getNodeHashPath:function(e,t,i){i=i||"/";for(var a=[e[t=t||this.getRootNode().idProperty]],n=this.nodeHash[e.parent];n;)a.unshift(n[t]),n=this.nodeHash[n.parent];return i+a.join(i)},getActionMenu:function(t){var r=this;if(!r.actionMenu){var e=r.funcData.info.idSuffix,i=JE.getFuncView(r.funcData.info.funcCode,"grid",e),a=i.getButton("gridInsertBtn"),n=i.getButton("gridEditBtn"),o=i.getButton("gridRemoveBtn");r.actionMenu=Ext.create("Ext.menu.Menu",{width:120,items:[{text:"添加",iconCls:"fa fa-plus",itemId:"add",gridBtn:a,hidden:JE.isEmpty(a),handler:function(e){e.gridBtn.fireHandler()}},{text:"编辑",iconCls:"fa fa-edit",itemId:"edit",gridBtn:n,hidden:JE.isEmpty(n),handler:function(e){var t=i.store.getById(r.actionMenu.activeNode.get("id"));t&&i.getSelectionModel().select(t),e.gridBtn.fireHandler()}},{text:"删除",itemId:"remove",iconCls:"fa fa-remove",gridBtn:o,hidden:JE.isEmpty(o),handler:function(e){var t=i.store.getById(r.actionMenu.activeNode.get("id"));t&&i.getSelectionModel().select(t),e.gridBtn.fireHandler()}},"-",{iconCls:"fa fa-indent",text:"移动到...",itemId:"move",handler:function(e){JE.win({title:"移动到选中节点...",items:{xtype:"treepanel",useArrows:!0,animate:!1,rootVisible:!1,store:r.getStore()},autoShow:!0,width:400,height:600,buttonAlign:"center",buttons:[{text:"前面",cls:"JEPLUS_B_C01",handler:function(e){r.actionMenu.doMoveTo(e.up("window"),"before")}},{text:"后面",cls:"JEPLUS_B_C01",handler:function(e){r.actionMenu.doMoveTo(e.up("window"),"after")}},{text:"内部",cls:"JEPLUS_B_L10",handler:function(e){r.actionMenu.doMoveTo(e.up("window"),"append")}}]})}}],doMoveTo:function(a,e){var n=r,t=a.getCmp(0),i=n.actionMenu.activeNode,o=t.getSelectionModel().getSelection()[0];o=o&&n.store.getNodeById(o.get("id")),n.doMoveNode(i,o,e,function(e,t,i){a.close(),n.doMoveNodeAfter(e,t,i)})}})}return r.actionMenu.activeNode=t,Ext.each(["edit","remove","move"],function(e){r.actionMenu.getCmp(e).setDisabled(JE.isEmpty(t))}),r.actionMenu},doMoveNode:function(e,t,i,a){if(t)if(e.get("id")==t.get("id"))JE.alert("不可移动到自身节点！");else{var n={};if("append"==i){if(t.isLeaf())return void JE.alert("子节点不可以加入！");n.append=!0,this.getSelectionModel().deselect(e,!0),e=t.appendChild(e)}else n.order=!0,e.parentNode!=t.parentNode&&(n.append=!0),this.getSelectionModel().deselect(e,!0),e=t.parentNode.insertChild(t.get("index")+("before"==i?0:1),e);this.getSelectionModel().select(e,!1,!0),a&&a(e,t,n)}else JE.alert("请选择目标节点！")},doMoveNodeAfter:function(i,t,e){var a=this.funcData.info,n=a.pkName,o=a.tableName,r=a.funcAction,l=e.append,s=e.order,d={success:!0};if(l){var c=s?t.parentNode:t,u={tableCode:o,SY_PARENT:c.getId(),SY_PATH:c.getPath(),SY_LAYER:c.getDepth()+1};if(u[n]=i.getId(),(d=JE.ajax({url:Ext.value(r,JE.getUrlMaps("je.core"))+JE.getUrlMaps("method.treeMove"),params:u})).success&&d.obj&&i.hasChildNodes()){var p=i.get("treeOrderIndex"),f=Ext.value(d.obj.SY_TREEORDERINDEX,d.obj.TREEORDERINDEX);i.cascadeBy(function(e){if(i!=e){var t=e.get("treeOrderIndex");e.set("treeOrderIndex",f+t.substring(p.length))}})}d.success&&d.obj&&i.set("treeOrderIndex",Ext.value(d.obj.SY_TREEORDERINDEX,d.obj.TREEORDERINDEX)),d.success||JE.alert(d.obj)}if(s&&d.success){var E=[];t.parentNode.eachChild(function(i){var a={},e=i.get("index")+1;a[n]=i.get("id"),a.SY_ORDERINDEX=e,a.SY_TREEORDERINDEX=t.parentNode.get("treeOrderIndex")+JE.preFillUp(e,6,"0"),i.hasChildNodes()&&i.cascadeBy(function(e){if(i!=e){var t={};t[n]=e.get("id"),t.SY_TREEORDERINDEX=a.SY_TREEORDERINDEX+e.get("treeOrderIndex").substring(i.get("treeOrderIndex").length),e.set("treeOrderIndex",t.SY_TREEORDERINDEX),E.push(t)}}),i.set("orderIndex",a.SY_ORDERINDEX),i.set("treeOrderIndex",a.SY_TREEORDERINDEX),a.SY_ORDERINDEX=e,a.SY_TREEORDERINDEX=t.parentNode.get("treeOrderIndex")+JE.preFillUp(e,6,"0"),E.push(a)}),d=JE.ajax({url:Ext.value(r,JE.getUrlMaps("je.core"))+JE.getUrlMaps("method.doUpdateList"),params:{strData:Ext.encode(E),tableCode:o}})}d.success?(this.getSelectionModel().deselectAll(),this.fireEvent("selectionchange",this.getSelectionModel(),[]),JE.msg(JE.getLocalLang("core.jetreeview.dragOkAlert"))):JE.alert(d.obj)}}),Ext.define("JE.core.util.FuncUtil",{tempFunc:{info:{},modelFields:[],basicFields:{},basicColumns:{},dicInfo:{},badgeFields:{},permInfo:{},configFields:{},grid:{buttons:[],actions:[],columns:[],formColumns:[],groupQuery:[],treeQuery:[],quickQuery:[],uploadField:[],batchFilesField:[],textcodeFields:[],queryColumns:[],iditColumns:[]},form:{locate:{child:[],childIndex:-1,field:[]},locateButtons:[],buttons:[],fields:[],historyFields:[],childFuncFields:[],uploadField:[],batchFilesField:[],textcodeFields:[],ckeditorFields:[]},select:{columns:[],groupQuery:[],quickQuery:[],treeQuery:[]},common:{},wf:{commonButtons:[],formButtons:[],gridButtons:[],infos:{}},child:[],childObj:{},childFields:{},defaultValues:{},dataFlow:{},qss:[],visibleExp:{child:{},formButton:{},field:{}},readOnlyExp:{field:{}},allowBlankExp:{field:{}},bindingExp:{field:{}},fieldExp:{}},getFuncData:function(e,t){var i,a=t||{},n=a.refresh,o=a.staticFunc,r=0==a.funcPerm?JE.nopermCacheFunc:JE.cacheFunc;if(1!=n&&(i=r[e],JE.isEmpty(i)&&(i=JE.CoreUtil.getUSPremData("FUNC",e))),JE.isEmpty(i)){var l=new Date,s=(i=JE.CoreUtil.staticFuncData(e,!1,n,o)).info.funcName+"("+i.info.funcCode+")";JE.timeLog(l,"获得功能 "+s+" 数据耗时")}return r[i.info.funcCode]||(this.buildNewFuncData(i,a),r[e]=r[i.info.funcId]=i),Ext.clone(i)},buildNewFuncData:function(a,e){var i=this,t=e.refresh;if(i.buildWf(a),a.info.viewTableName=Ext.value(a.info.viewTableName,a.info.tableName),a.info.whereSql=JE.toXT(a.info.whereSql||""),Ext.iterate(a,function(e,t){JE.isEmpty(t)&&(a[e]=i.tempFunc[e])}),i.buildDicData(a),i.parseJSListeners(a),"FUNC"==a.info.modelType&&0!=e.funcPerm&&JE.CoreUtil.funcDataPerm(a,t),a.info.modelName=JE.getModel({id:a.info.pkName,modelName:a.info.entityName,tableName:a.info.viewTableName,fields:a.modelFields},t),-1!=["procedure","iditprocedure","sql"].indexOf(a.info.funcType)){var n=Ext.isArray(a.info.dbQueryParams)?a.info.dbQueryParams:Ext.decode(Ext.value(a.info.dbQueryParams,"[]"));a.info.dbQueryParams=n}a.info.ckeditorFields=a.form.ckeditorFields,a.info.uploadField=a.form.uploadField,a.info.batchFilesField=a.form.batchFilesField,a.grid.textcodeFields=a.form.textcodeFields;var o=JE.getLocalLang("core.jeformview.groupQuery.button");a.form.queryButtons=[{xtype:"button",text:o.queryText,ref:"groupQuery",iconCls:"jeicon jeicon-search",fontIconCls:"fa fa-search",cls:"btn JEPLUS_B_L10"},{xtype:"button",text:o.resetText,ref:"groupReset",iconCls:"jeicon jeicon-turn-left",fontIconCls:"fa fa-mail-reply",cls:"btn JEPLUS_B_C07"},{xtype:"button",text:o.saveText,ref:"groupSave",iconCls:"jeicon jeicon-form-query",fontIconCls:"fa fa-th-large",cls:"btn JEPLUS_B_C01"}],Ext.each(a.form.queryButtons,function(e){e.iconCls=JE.getIconCls(e)}),a.getDefVals=function(n){var o={},r=(n=Ext.value(n,{}),this);return Ext.iterate(r.defaultValues,function(e,t){var i=JE.toDefVal(t.value);if(JE.isNotEmpty(t.valueFn)){var a=JE.eval(t.valueFn)(n,r);JE.isNotEmpty(a)&&(i=a)}o[e]=i}),o};var r=a.info.extendJS;Ext.isEmpty(r)||(-1!=r.lastIndexOf("Controller")?JE.getApplication().getController(r):Ext.require(r)),1==a.info.allowLocked&&Ext.each([a.grid.columns,a.select.columns],function(e){var i=-1;if(Ext.each(e,function(e,t){if(e.dataIndex==a.info.lockedColumn)return i=t,!1}),-1!=i)for(var t=0;t<=i;t++)e[t].locked=!0}),i.buildCommons(a)},buildGroupQuery:function(e,l){var s=this,d=[];Ext.each(e.groupQuerys,function(e){var t=l.basicFields[e.GROUPQUERY_BM];if(t){var i=s.field(t,"group",l);i.margin="0 0 0 2",i.fieldLabel=e.GROUPQUERY_MC,i.width=JE.toNum(e.GROUPQUERY_KD),i.hideLabel=JE.toBool(e.GROUPQUERY_BQYC),i.firstrow=JE.toBool(e.GROUPQUERY_CYCX),e.GROUPQUERY_CXLX="no"==e.GROUPQUERY_CXLX?"":e.GROUPQUERY_CXLX,e.GROUPQUERY_PXLX="no"==e.GROUPQUERY_PXLX?"":e.GROUPQUERY_PXLX;var a={queryLabelWidth:JE.toNum(e.GROUPQUERY_BQKD),queryType:e.GROUPQUERY_CXLX,querySortDisabled:"1",queryTypeHidden:"1",orderType:e.GROUPQUERY_PXLX};if(l.basicColumns[e.GROUPQUERY_BM]){var n=l.basicColumns[e.GROUPQUERY_BM],o=Ext.decode(Ext.value(n.otherConfig,"{}"));for(var r in o)a.hasOwnProperty(r)||(a[r]=o[r])}i.columnOtherConfig=Ext.encode(a),d.push(i)}}),l.groupQuery=d},loadFuncData:function(e,t){return JE.ajax({url:JE.getUrlMaps("je.core.develop.funcInfo","getFuncByCode"),params:{refresh:Ext.value(t,!1),tableCode:"JE_CORE_FUNCINFO",FUNCINFO_FUNCCODE:e}})},buildFuncData:function(e,t){var i=this,a=Ext.clone(i.tempFunc),n=e;return Ext.isString(e)&&(n=i.loadFuncData(e,t)),a.modelFields=Ext.clone(n.modelFields),a.qss=Ext.clone(n.queryStrategys),i.buildInfo(n,a),i.buildFields(n,a),i.buildColumns(n,a),i.buildChilds(n,a),i.buildButtons(n,a),i.buildExp(n,a),i.buildDataFlow(n,a),i.buildGroupQuery(n,a),JE.log(Ext.clone(a)),a},buildDataFlow:function(e,t){var i=this,a={};Ext.each(e.dataflows,function(e){var t=i.format("dataflow",e);JE.isNotEmpty(t.type)&&JE.isNotEmpty(t.buttons)&&("idit"==t.type&&JE.isNotEmpty(t.callbackFn)||"idit"!=t.type&&JE.isNotEmpty(t.sql))&&Ext.each(t.buttons.split(","),function(e){a[e]=a[e]||{},a[e][t.type]=a[e][t.type]||[],a[e][t.type].push(Ext.clone(t))})}),t.dataFlow=a},clearEmpty:function(i){var a=this;Ext.iterate(i,function(e,t){Ext.isObject(t)?a.clearEmpty(t):Ext.isArray(t)?Ext.each(t,function(e){a.clearEmpty(e)}):-1!=e.toLowerCase().indexOf("sql")||-1!=["configInfo"].indexOf(e)?i[e]=Ext.value(i[e],""):Ext.isEmpty(t)&&delete i[e]})},staticData:function(e){var t=e.info.funcCode;JE.CoreUtil.staticFuncData(t)},buildDicData:function(l){if(!JE.isEmpty(l.dicInfo)){var a=[],n=[];if(Ext.iterate(l.dicInfo,function(e,t){var i=JE.dicInfoData[t];i&&Ext.isEmpty(JE.dicListData[t])&&(-1==a.indexOf(t)&&"1"!=i.DICTIONARY_ZWFFLAG?a.push(t):-1==n.indexOf(t)&&"1"==i.DICTIONARY_ZWFFLAG&&n.push(t))}),JE.isNotEmpty(a)){var e=JE.ajax({url:JE.getUrlMaps("je.core.dd.dd","getDicItemByCodes"),params:{tableCode:"JE_CORE_DICTIONARY",ddListCodes:a.join(","),zwhDDCodes:n.join(",")}});Ext.iterate(e,function(e,t){JE.dicListData[e]=t})}Ext.iterate(l.dicInfo,function(e,t){var n=l.basicFields[e],i=Ext.value(n.configInfo,"").split(","),a=(t=i[0],Ext.value(i[1],"").split("~")),o=Ext.value(i[2],"").split("~");if(1<a.length&&"cbblistfield"!=n.xtype){var r=JE.getDicItems(t,!0)[n.value];Ext.each(a,function(e,t){if(e!=n.name&&r){var i=l.basicFields[e],a=i?i.valueFn:"";l.defaultValues[e]={value:r[o[t]],valueFn:a}}})}})}},buildConfigField:function(e,t){if(-1!=["cbbfield","cgroup","rgroup","gridssareafield","gridssfield","treessareafield","treessfield","queryuserfield","searchfield"].indexOf(t.xtype)){var i=t.configInfo.split(","),a=Ext.isObject(t.otherConfig)?t.otherConfig:Ext.decode(Ext.value(t.otherConfig,"{}")),n={name:t.name,otherConfig:a,code:Ext.value(i[0],""),fields:{},multiSelect:!1},o=JE.isEmpty(i[1])?[]:i[1].split("~"),r=JE.isEmpty(i[2])?[]:i[2].split("~");Ext.each(o,function(e,t){n.fields[r[t]]=e});var l="cgroup"==t.xtype?"M":Ext.value(i[3],"");n.multiSelect="M"==l||"M_"==l,e.configFields[n.name]=n}else-1!=["ckeditor","ueditorfield","uxfilefield","uxfilesfield"].indexOf(t.xtype)&&(t.jeFileType=JE.getObjAttr(e.info.otherConfig,"jeFileType")||"PROJECT")},buildInfo:function(e,t){t.info=this.format("info",e.info),t.info.funcAction=JE.replaceOldUrl(t.info.funcAction),t.info.formCols=Ext.value(t.info.formCols,3),t.info.merges=[],Ext.isEmpty(t.info.funcDicConfig)||Ext.applyIf(t.info.funcDicConfig,{parent:"SY_PARENT",path:"SY_PATH",nodeType:"SY_NODETYPE",layer:"SY_LAYER"}),"tree"==t.info.funcType&&(t.info.treeFuncSql=" and "+t.info.funcDicConfig.parent+("ORACLE"==JE.systemConfig.JE_SYS_DB?" IS NOT NULL":" !='' ")),t.info.gridPrintInfo=Ext.decode(Ext.value(t.info.gridPrintInfo,"{}")),t.info.gridEnablePrint=Ext.value(t.info.gridPrintInfo.enablePrint,!1),t.info.idSuffix=""},buildExp:function(e,t){t.fieldExp=JE.Action.buildFieldExp(t),t.gridFieldExp=JE.Action.buildFieldExp(t,"gridField"),t.gridExp=JE.Action.buildFieldExp(t,"grid"),Ext.each(["bindingExp","visibleExp","readOnlyExp","allowBlankExp"],function(e){delete t[e]})},buildColumns:function(e,x){var v=this,y=[];Ext.each(e.columns,function(e,t){var i=v.format("column",e);i.enableEdit="LIST"==x.info.insertType,i.menuDisabled=x.info.simpleBar;var a=x.basicFields[i.dataIndex],n=-1==["morecolumn","actioncolumn","rownumberer","markcolumn","postilcolumn"].indexOf(i.xtype),o=Ext.value(i.queryType,""),r=Ext.value(i.quickQueryType,"");if(!a&&n&&JE.error("功能："+x.info.funcCode+"的表单字段:"+i.dataIndex+"不存在，请检查功能配置!!!","FuncUtil.js   buildColumns","160"),n){if("tree"==o||"tree"==r){var l={configInfo:a.configInfo,otherConfig:a.otherConfig,xtype:a.xtype,title:i.text,field:a.name,whereSql:a.whereSql};if(Ext.isEmpty(l.configInfo)){var s=l.field.substring(0,l.field.length-4)+"CODE";(c=x.basicFields[s])&&Ext.apply(l,{configInfo:c.configInfo,field:c.name,whereSql:c.whereSql})}JE.isEmpty(a.cascadeField)&&("tree"==o&&x.grid.treeQuery.push(l),"tree"==r&&x.select.treeQuery.push(l))}else if("column"==o||"column"==r){var d={configInfo:a.configInfo,otherConfig:a.otherConfig,field:a.name,whereSql:a.whereSql};if(Ext.isEmpty(d.configInfo)){var c;s=d.field.substring(0,d.field.length-4)+"CODE";(c=x.basicFields[s])&&(d={configInfo:c.configInfo,otherConfig:c.otherConfig,field:c.name,whereSql:c.whereSql})}d.fn="JE.Action.doColumnQueryGrid",i.queryConfig=d}else if(-1!=o.indexOf("group")||-1!=r.indexOf("group")){var u,p=v.field(a,"group",x);if(p.fieldLabel=i.text,p.title=p.fieldLabel,p.field=p.name,p.queryIndex=i.queryIndex,p.columnOtherConfig=i.otherConfig,-1!=o.indexOf("group"))(u=Ext.clone(p)).colSpan=JE.toNum(Ext.value(o.replace("group",""),"1")),x.grid.groupQuery.push(u);if(-1!=r.indexOf("group"))(u=Ext.clone(p)).colSpan=JE.toNum(Ext.value(r.replace("group",""),"1")),x.select.groupQuery.push(u)}}else;if(n&&!i.hidden&&-1==["uxfilefield","uxfilesfield","cbblistfield","childfuncfield","graphfield","displayfield","child","fieldset"].indexOf(a.basicXtype)){s=i.dataIndex;if(-1!=["cbbfield","rgroup","cgroup"].indexOf(a.basicXtype)&&"CODE"==s.substring(s.length-4)){var f=s.substring(0,s.length-4)+"NAME";x.basicFields[f]&&(s=f)}var E=Ext.value(i.columnQueryType,"no"),m={name:s,text:i.text,type:E,xtype:a.xtype,columnOtherConfig:i.otherConfig};x.grid.quickQuery.push(m),1==i.quickQuery&&x.select.quickQuery.push(m)}if(1==(i=v.column(i,x)).quickQuery&&"actioncolumn"!=i.xtype){var g=Ext.clone(i);g.allowEdit=!1,g.enableEdit=!1,g.hidden=!1,g.merge=!1,"uxcolumn"==g.xtype?delete g.xtype:"uxcheckcolumn"==g.xtype&&(delete g.xtype,g.tactics=[{type:"dic",dicCode:"YESORNO"}],g.renderer="JE.renderer"),"column"!=g.quickQueryType&&delete g.queryConfig,g.listeners=g.listeners||[],delete g.listeners.linkclick,x.select.columns.push(g)}if("column"!=o&&delete i.queryConfig,"actioncolumn"==i.xtype&&(i.items=x.grid.actions,i.menuText=i.text,i.funcColumn=!0,i.tdCls+=" je-grid-actioncolumn",i.getItemStyle=i.listeners&&i.listeners.getItemStyle&&JE.eval(i.listeners.getItemStyle),x.grid.floatAction=JE.toBool(JE.getObjAttr(i.otherConfig,"float"))),i.formColumn){var h=Ext.clone(i);Ext.each(["basicField","editField","field","searchField","summaryRenderer","lockable"],function(e){delete h[e]}),x.grid.formColumns.push(h)}y.push(i),i.iditColumn&&x.grid.iditColumns.push(i)}),x.select.columns=v.dgColumns(x.select.columns).columns;var t=v.dgColumns(y);x.grid.columns=t.columns,x.grid.columnTpls=t.trTpls,Ext.each(x.grid.columnTpls[0].children,function(e){1==e.colspan&&(e.rowspan=x.grid.columnTpls.length)}),x.grid.relColumns=t.relCls,x.basicColumns=t.basicColumns,x.grid.uploadField=t.uploadField,x.grid.batchFilesField=t.batchFilesField,Ext.Array.sort(x.grid.groupQuery,function(e,t){return Ext.value(e.queryIndex,0)-Ext.value(t.queryIndex,0)}),Ext.Array.sort(x.select.groupQuery,function(e,t){return Ext.value(e.queryIndex,0)-Ext.value(t.queryIndex,0)})},buildFields:function(l,s){var d=this,c=s.info,u=c.formCols,p=0<c.fieldWidth?c.fieldWidth:0,f=[],E=Ext.value(c.fieldLazy,!1);d.removeDisabledField(l.fields);d.fieldsets={},Ext.each(l.fields,function(e){var t=JE.decode(Ext.value(e.RESOURCEFIELD_OTHERCONFIG,"{}"));if("1"==t.useBadge){var i="M"==e.RESOURCEFIELD_CONFIGINFO.split(",")[3]?"1":"0";s.badgeFields[e.RESOURCEFIELD_CODE]={badgeFields:t.badgeFields,sm:i}}if("fieldset"==e.RESOURCEFIELD_XTYPE){var a=JE.split(e.RESOURCEFIELD_CONFIGINFO,",");d.fieldsets[e.RESOURCEFIELD_CODE]={labelWidth:JE.toNum(t.labelWidth),groupCols:JE.toNum(Ext.value(a[0],c.formCols)),groupLayout:a[1]}}});var m=c.funcCode+"_form",g=JE.decode(Ext.value(c.otherConfig,"{}"));Ext.each(l.fields,function(e){var t=d.format("field",e);if(d.buildConfigField(s,t),!t.removed){var i=JE.decode(Ext.value(t.otherConfig,"{}"));if(t.hideLabel||delete t.hideLabel,Ext.isEmpty(t.value)&&Ext.isEmpty(t.valueFn)||(s.defaultValues[t.name]={value:t.value,valueFn:t.valueFn}),"uxfilefield"==t.basicXtype)s.form.uploadField.push(t.name);else if("uxfilesfield"==t.basicXtype)s.form.batchFilesField.push(t.name);else if("textcode"==t.basicXtype){var a={code:t.name,configInfo:Ext.decode(Ext.value(t.configInfo,"[]")),funcId:c.funcId,funcCode:c.funcCode,funcName:c.funcName,tableCode:c.tableName};s.form.textcodeFields.push(a)}else"childfuncfield"==t.basicXtype?s.form.childFuncFields.push(t.name):"ckeditor"==t.basicXtype&&s.form.ckeditorFields.push(t.name);1==t.history&&s.form.historyFields.push(t.name),"child"!=t.xtype||Ext.isEmpty(l.children)?t.locate&&!t.hidden&&s.form.locate.field.push({type:"field",xtype:t.xtype,name:t.fieldLabel,code:t.name,formCode:m}):(s.form.locate.childIndex=s.form.locate.field.length,s.form.locate.field.push("child"));Ext.each(["bindingExp","visibleExp","readOnlyExp","allowBlankExp"],function(e){Ext.isEmpty(t[e])&&Ext.isEmpty(t[e+"Fn"])||(s[e].field[t.name]=t)});var n=JE.toNum(i.labelWidth);0<n?t.labelWidth=n:d.fieldsets[t.groupName]&&0<d.fieldsets[t.groupName].labelWidth?t.labelWidth=d.fieldsets[t.groupName].labelWidth:0<c.labelWidth&&(t.labelWidth=c.labelWidth),"1"==i.hideLabelText&&(t.hideLabelText=!0)}if(t.formCode=m,t.funcId=c.funcId,t.funcCode=c.funcCode,t.tableName=c.tableName,t.pkName=c.pkName,t.fieldWidth=p,t.labelAlign=Ext.value(t.labelAlign,"right"),t.labelColor=Ext.value(t.labelColor,g.formLabelColor),t.columnWidth=t.cols/u,t.fieldBodyStyle="",t.margin="3",t.useDirty=!0,t=d.field(t,"",s),c.formTableStyle&&"plus"==JE.getTheme()){var o=" je-field-tablestyle";t.cls=Ext.value(t.cls,"")+o,"fieldcontainer"==t.xtype&&(t.items.cls=Ext.value(t.items.cls,"")+o)}var r=Ext.clone("fieldcontainer"==t.xtype?t.items:t);s.basicFields[r.name]=r,E&&r.fieldLazy&&-1==["child","fieldset"].indexOf(r.xtype)&&((t=r).xtype="uxhiddenfield",t.hidden=!0,t.rowField=""),t.removed||f.push(t)}),s.form.fields=d.dgFields(f,"",u)},removeDisabledField:function(e,t,i){for(var a=[],n=(t=Ext.value(t,""),0);n<e.length;n++){var o=e[n],r=o.RESOURCEFIELD_CODE,l=o.RESOURCEFIELD_XTYPE,s=o.RESOURCEFIELD_GROUPNAME,d=i||JE.toBool(o.RESOURCEFIELD_REMOVED);t==s&&("fieldset"==l&&(a=a.concat(this.removeDisabledField(e,r,d))),d&&(o.RESOURCEFIELD_REMOVED="1",a.push(r)))}return a},dgFields:function(i,a,n){var o=this,t=[],r=new Ext.util.MixedCollection;return Ext.each(i,function(e){if(Ext.value(a,"")==Ext.value(e.groupName,"")){if(-1!=["child"].indexOf(e.xtype)&&delete e.rowField,"fieldset"==e.xtype)e.items=o.dgFields(i,e.name,e.groupCols),"1"==Ext.decode(Ext.value(e.otherConfig,"{}")).fieldArea?(e.defaults={hideLabel:!0},e.xtype="fieldcontainer",e.fieldLabel=e.title,e.border=e.padding=e.margin=0,e.margin=3,Ext.each(e.items,function(e,t){e.margin=0==t?0:"0 0 0 3"})):(e.minHeight=27,delete e.useDirty,1==e.readOnly&&(delete e.title,delete e.collapsible,e.border=e.padding=e.margin=0,e.cls=Ext.value(e.cls,"")+" je-fieldcls-fieldset-empty"));if(0<n&&(e.columnWidth=e.cols/n),JE.isEmpty(e.rowField))r.add(e.name,e);else{var t=r.get(e.rowField);JE.isEmpty(t)?t=r.add(e.rowField,[]):Ext.isObject(t)&&(t=r.replace(e.rowField,[t])),t.push(e)}}}),r.each(function(e){Ext.isArray(e)||0<e.width?(Ext.each(Ext.isArray(e)?e:[e],function(e){delete e.columnWidth}),t.push({xtype:"container",columnWidth:1,layout:"column",items:e})):t.push(e)}),t},dgColumns:function(o,r,l){var s=this;l=Ext.value(l,0);var d=[],c={},u=[],p=[],f=[],E=[],e={tag:"tr",deep:l,children:[]};return p.push(e),Ext.each(o,function(e){if(Ext.value(r,"")==Ext.value(e.moreColumnName,"")){var t=1;if("morecolumn"==e.xtype){e={dataIndex:e.dataIndex,text:e.text,titleStyle:e.titleStyle,lockable:!1,hidden:e.hidden,cls:e.cls,menuDisabled:!0};var i=s.dgColumns(o,e.dataIndex,l+1);e.columns=i.columns,t=e.columns.length,Ext.each(i.trTpls,function(e){p[e.deep]?p[e.deep].children=p[e.deep].children.concat(e.children):p.push(e)}),f=f.concat(i.relCls),c=Ext.apply(c,i.basicColumns)}if(!e.hidden&&(d.push(e),"actioncolumn"!=e.xtype)){var a={tag:"td",colspan:t,rowspan:1,html:e.text,align:"center",valign:"middle",style:"border:1px solid #000;font-weight:bold;",height:30};0<e.width&&(a.width=e.width),p[0].children.push(a)}if(-1==["morecolumn","actioncolumn","rownumberer","markcolumn","postilcolumn"].indexOf(e.xtype)){var n=Ext.clone(e);delete n.basicField,c[e.dataIndex]=n,1==e.fileField&&u.push(e.dataIndex),1==e.batchFilesField&&E.push(e.dataIndex),Ext.isEmpty(e.xtype)||e.hidden||f.push(e.dataIndex)}}}),{columns:d,basicColumns:c,editColumns:[],uploadField:u,trTpls:p,relCls:f,batchFilesField:E}},buildButtons:function(e,a){var n=this;if(Ext.each(e.buttons,function(e){var t=n.format("button",e);if((t=n.button(t,a)).itemId=t.code,1!=t.removed)switch(t.type){case"GRID":a.grid.buttons.push(t);break;case"FORM":a.form.buttons.push(t),Ext.isEmpty(t.visibleExp)||(a.visibleExp.formButton[t.code]=t);break;case"ACTION":var i={iconCls:t.iconCls,iconStyle:t.iconStyle,tooltip:t.text,button_id:t.button_id,listeners:t.listeners,code:t.code,type:t.type,funcId:t.funcId,funcName:t.funcName,funcCode:t.funcCode};a.grid.actions.push(i)}"gridDisableBtn"==t.ref&&(a.info.doDisable=!0)}),!a.info.simpleBar){var o={form:[],grid:[]};Ext.each(["form","grid"],function(e){var i=a[e].buttons;Ext.each(i,function(t){JE.isEmpty(t.parentBtn)?o[e].push(t):Ext.each(i,function(e){e.ref==t.parentBtn&&(e.xtype="splitbutton",e.menu=e.menu||{items:[]},delete t.xtype,e.menu.items.push(t))})}),a[e].buttons=o[e]})}var t=a.form.locate.field;JE.isNotEmpty(t)&&(-1!=a.form.locate.childIndex&&Array.prototype.splice.apply(t,[a.form.locate.childIndex,1].concat(a.form.locate.child)),Ext.each(t,function(e){a.form.locateButtons.push({text:'<span style="text-decoration:underline;color:blue;" >'+e.name+"</span>",info:e,locateBtn:!0})})),delete a.form.locate},buildChilds:function(e,s){var n=this,o=s.info.chShowType,d={},c={};Ext.each(e.children,function(e){var t=n.format("child",e);if("childfuncfield"==t.type)c[t.code]=t;else if(!Ext.isEmpty(t.code)&&1==t.enabled){var i="_je"+t.type+"view";-1!=["func","tree"].indexOf(t.type)?i="_jemainview":"idit"==t.type&&(i="_mainview"),t.viewId=t.code+i;var a=t.showType=Ext.value(t.showType,o);d[a]||(d[a]=[]),d[a].push(t),"5"!=a&&(s.child.push(t),t.locate&&s.form.locate.child.push({type:"child",name:t.name,code:t.viewId}),Ext.isEmpty(t.visibleExp)||(s.visibleExp.child[t.viewId]=t))}}),s.childFields=c,Ext.iterate(s.basicFields,function(e,t){if("childfuncfield"==t.xtype){var i=t.configInfo.split(","),a=i[0],n=i[1],o=s.info.pkName,r={code:a,fields:[{chCode:n,code:o,value:!0,whereSql:!0,whereType:"="}]},l=c[r.code];l&&Ext.each(l.fields,function(e){e.chCode!=n&&r.fields.push(e)}),d.fields=d.fields||{},d.fields[t.name]=r}}),s.childObj=d},buildWf:function(n){if(n.info.wf){var e=JE.ajax({url:"/je/staticize/staticize/loadStaticize",params:{funcCode:n.info.funcCode,type:"FUNCWF"}}),o={hidden:!0,wfButton:!0},r=JE.getLocalLang("core.jewfview.button");n.wf.versions={},Ext.each(e,function(e){var t=e.processDefinitionId;n.wf.infos[t]=e;var i=n.wf.versions[e.processKey]||{newest:"",keys:[],version:0};i.keys.push(t);var a=JE.toNum(t.replace(e.processKey).substring(1));(0==i.version||a>e.version)&&(i.newest=t,i.version=a),n.wf.versions[e.processKey]=i,e.sponsorAble?n.wf.formButtons.push(Ext.apply({text:Ext.isEmpty(e.buttonInfos.wfSponsorBtn.zdyText)?r.sponsor+"->"+e.processName:e.buttonInfos.wfSponsorBtn.zdyText,ref:"wfSponsorBtn",iconCls:"jeicon jeicon-startup-process",pdid:e.processDefinitionId,anyoneStartAble:e.anyoneStartAble,startRoles:e.startRoles,enableFormBind:!0,xtype:"button"},o)):n.wf.formButtons.push(Ext.apply({text:Ext.isEmpty(e.buttonInfos.wfStartBtn.zdyText)?r.start+"->"+e.processName:e.buttonInfos.wfStartBtn.zdyText,ref:"wfStartBtn",iconCls:"jeicon jeicon-startup-process",pdid:e.processDefinitionId,anyoneStartAble:e.anyoneStartAble,startRoles:e.startRoles,enableFormBind:!0,xtype:"button"},o))}),delete n.workflowInfo,n.wf.commonButtons.push({text:"",ref:"wfCurrentTask",xtype:"label",hidden:!0,wfButton:!0});var t=JE.getDicItems("JE_WF_BTNS");Ext.each(t,function(e){"wfChangeFormBtn"==e.code?n.wf.commonButtons.push(Ext.apply({text:e.text,ref:e.code,enableFormBind:"wfSubmitBtn"==e.code,iconCls:e.iconCls,xtype:-1!=["wfEndLabel","wfHandUpLabel","wfSuspendLabel"].indexOf(e.code)?"label":"button"},o)):"wfStartBtn"!=e.code&&"wfSponsorBtn"!=e.code&&n.wf.formButtons.push(Ext.apply({text:e.text,ref:e.code,enableFormBind:"wfSubmitBtn"==e.code,iconCls:e.iconCls,xtype:-1!=["wfEndLabel","wfHandUpLabel","wfSuspendLabel"].indexOf(e.code)?"label":"button"},o))}),n.wf.commonButtons.push({text:JE.getLocalLang("core.jemainview.common.lczzButton"),ref:"wfLczzBtn",xtype:"button",iconCls:"jeicon jeicon-sitemap-three"});var i={wfSponsorBtn:"fa fa-play",wfStartBtn:"fa fa-play",wfCancelBtn:"fe icon-logout-1",wfBackBtn:"fa fa-hand-lizard-o",wfTransmitBtn:"fa fa-mail-forward",wfAllotBtn:"fa fa-mail-forward",wfBackDiyUserBtn:"fa fa-mail-forward",wfNextDiyUserBtn:"fa fa-hand-o-right",wfSubmitBtn:"fa fa-hand-o-right",wfReturnSubmitBtn:"fa fa-hand-o-right",wfEntrustBtn:"fa fa-arrow-circle-o-right",wfCallEntrustBtn:"fa fa-arrow-circle-o-left",wfReturnBtn:"fe icon-left-hand-1",wfRejectBtn:"fa fa-arrow-left",wfTakeBtn:"fa fa-check",wfSuspendLabel:"fa fa-circle-o-notch",wfEndLabel:"fe icon-circle",wfHandUpLabel:"fe icon-pause-circled",wfPassBtn:"fa fa-hand-peace-o",wfNoPassBtn:"fa fa-hand-paper-o",wfWaiverPassBtn:"fa fa-hand-grab-o",wfChangePassBtn:"fa fa-pencil-square-o",wfRoundBtn:"fe icon-spread",wfTakeRoundBtn:"fa fa-pencil",wfPromptBtn:"fa fa-volume-up",wfSuspendBtn:"fa fa-circle-o-notch",wfChagenTaskBtn:"fa fa-exchange",wfChangeFormBtn:"fe icon-clock-5",wfLczzBtn:"fe icon-sitemap"};Ext.iterate(n.wf,function(e,t){"infos"!=e&&Ext.each(t,function(e){"button"==e.xtype&&(e.bigIconCls=e.iconCls+"_32",e=JE.toBigButton(e,n.info.bigButton),"plus"==JE.getTheme()&&(e.iconCls=Ext.value(i[e.ref],e.iconCls),"wfLczzBtn"==e.ref&&(e.tooltip=Ext.value(e.text,e.tooltip),delete e.text)))})})}},buildCommons:function(t){var i=this,e=[];if(t.info.helpBtn||JE.isNotEmpty(JE.systemConfig.JE_FUNC_COMMONHELP_TPL)){var a={xtype:"button",tooltip:JE.getLocalLang("core.jemainview.common.helpButton.text"),iconCls:"jeicon jeicon-lightbulb",bigIconCls:"jeicon jeicon-lightbulb",fontIconCls:"fa fa-question-circle",ref:"JE_FuncHelp",JE_FuncHelp:!0,JE_CommonHelp:JE.isNotEmpty(JE.systemConfig.JE_FUNC_COMMONHELP_TPL)};a.iconCls=JE.getIconCls(a,"iconCls","fontIconCls"),e.push(a)}Ext.each(e,function(e){i.button(e,t)}),t.common.buttons=e},column:function(t,e){var i=e.info,a=e.basicFields[t.dataIndex];t.titleStyle="width:100%;height:16px;",JE.isNotEmpty(t.titleColor)&&(t.titleStyle+="color:"+t.titleColor),t.tdCls="je-grid-td-"+Ext.value(t.vAlign,"middle"),"rownumberer"==t.xtype&&(t.tdCls=Ext.baseCSSPrefix+"grid-cell-row-numberer "+Ext.baseCSSPrefix+"grid-cell-special je-grid-td-middle",delete t.renderer),t.dataIndex==t.moreColumnName&&(t.moreColumnName="");var n=-1!=Ext.value(e.info.gridHideLines,"").indexOf("right");if(JE.isNotEmpty(t.otherConfig)){var o=Ext.isObject(t.otherConfig)?t.otherConfig:Ext.decode(t.otherConfig);0<JE.toNum(o.flex)&&(t.minWidth=t.width,t.flex=1,delete t.width);var r=n?"left":"";r=Ext.value(o.headerAlign,r),JE.isNotEmpty(r)&&(t.henderInnerStyle="text-align:"+r)}else n&&(t.henderInnerStyle="text-align:left;");if(-1!=["morecolumn","actioncolumn","rownumberer","markcolumn","postilcolumn"].indexOf(t.xtype))return-1!=["morecolumn","actioncolumn","markcolumn","postilcolumn"].indexOf(t.xtype)&&(t.cls="je-grid-"+t.xtype),"markcolumn"==t.xtype?(t.xtype="uxcolumn",t.useMark=!0,t.renderer="JE.renderer",t.tactics=[{type:"mark"}],t.enableEdit=!1):"postilcolumn"==t.xtype&&(t.xtype="uxcolumn",t.usePostil=i.postil=!0,t.renderer="JE.renderer",t.tactics=[{type:"postil"}],t.enableEdit=!1),t;if(t.sortable&&(t.cls=t.cls||"",t.cls+=" je-grid-column-sortable"),Ext.isEmpty(t.renderer)){t.renderer="JE.renderer";var l=JE.buildRendererTactics(a,t);1!=t.hidden&&t.merge&&i.merges.push(t.dataIndex),t.tactics=l}else t.selfRenderer=!0;if(1!=t.locked&&delete t.locked,1==t.locked&&(i.allowLocked=!0,i.lockedColumn=t.dataIndex),!Ext.isEmpty(t.summary)){t.summaryType="JE.summaryType",i.summary=!0,JE.isNotEmpty(t.summaryAllMsg)&&(i.summaryAll=!0);var s={},d=0;Ext.each(["summaryMsg","summaryAllMsg","summaryFormat","summary"],function(e){s[e]=JE.decode(Ext.value(t[e],"[]")),s[e].length>d&&(d=s[e].length)});var c=s.summary.length;if(c<d){for(var u=0;u<d-c;u++)s.summary.push(Ext.clone(s.summary[c-1+u]));t.summary=JE.encode(s.summary)}}if(t.summaryRenderer="JE.summaryRenderer",a&&(t.helpTpl=a.helpTpl,t.searchField=this.field(a,"column",e),t.searchField.columnField=!0),1==t.allowEdit){i.allowEdit=!0,t.field=Ext.clone(t.searchField),t.editField=Ext.clone(t.field),t.cls+=" je-grid-editcolumn",t.hideTitleCls&&(t.cls+=" hidetip");var p=Ext.value(t.field.configInfo,"").split(",")[0];-1!=["cgroup","rgroup","cbbfield"].indexOf(a.basicXtype)&&"YESORNO"==p||"yesnofield"==a.basicXtype?t.xtype="uxcheckcolumn":-1!=["cgroup","rgroup"].indexOf(a.basicXtype)&&(t.field.xtype=t.editField.xtype="cbbfield"),"uxcheckcolumn"==t.xtype?(t.value=t.field.value,delete t.field,delete t.editField):"uxfilefield"==a.basicXtype?(delete t.field,delete t.editField.configInfo,t.fileField=!0):"uxfilesfield"==a.basicXtype?(delete t.field,delete t.editField,t.batchFilesField=!0):"ckeditor"==a.basicXtype&&(delete t.field,t.ckeditorField=!0)}return"uxcheckcolumn"==t.xtype&&(delete t.tactics,delete t.renderer),JE.isNotEmpty(i.gridHides)&&-1!=i.gridHides.indexOf("columnQuery")&&delete t.searchField,t.basicField=a,t},field:function(e,t,i){e=Ext.clone(e),info=i.info,(e=Ext.apply(e,{xtype:Ext.value(e.basicXtype,"textfield"),width:e.width<=0?e.fieldWidth:e.width,height:0<e.height?e.height:void 0,afterSubTpl:""})).initWidth=e.width,e.configInfo=Ext.value(e.configInfo,"");Ext.decode(Ext.value(e.otherConfig,"{}"));if("child"!=e.xtype&&e.name!=e.groupName||(e.groupName=""),"textcode"==e.xtype)e.xtype="textfield",e.value=JE.getLocalLang("core.ux.textcode"),e.readOnly=!0;else if("password"==e.xtype)e.inputType="password",e.xtype="textfield";else if("fieldset"==e.xtype)e.title=e.fieldLabel,e.collapsible=!0,e.layout="column",e.groupCols=this.fieldsets[e.name].groupCols,e.groupLayout=this.fieldsets[e.name].groupLayout,delete e.width;else if("datefield"==e.xtype)e.xtype="datetimefield",e.dateType="date",e.multiSelect="M"==e.configInfo.split(",")[1],e.submitFormat="Y-m-d",e.format=Ext.value(e.configInfo.split(",")[0],e.submitFormat);else if("datemonthfield"==e.xtype)e.xtype="datetimefield",e.dateType="month",e.submitFormat="Y-m",e.format=Ext.value(e.configInfo,e.submitFormat);else if("datetimefield"==e.xtype)e.dateType="datetime",e.submitFormat="Y-m-d H:i:s",e.format=Ext.value(e.configInfo,e.submitFormat);else if("rangedatefield"==e.xtype){var a=Ext.value(e.configInfo,"").split(",");JE.isNotEmpty(a[0])&&(e.format=a[0]),JE.isNotEmpty(a[1])&&(e.separator=a[1])}else if("numberfield"==e.xtype){if(e.editable=!0,JE.isNotEmpty(e.configInfo)&&Ext.isNumeric(e.configInfo)){var n=Number(e.configInfo);0<=n&&(e.decimalPrecision=n)}}else if(-1!=["gridssareafield","gridssfield","treessareafield","treessfield","queryuserfield"].indexOf(e.xtype))e.editable=e.editable;else if(-1!=["cbbfield","cgroup","rgroup","cbblistfield"].indexOf(e.xtype)){var o=e.configInfo.split(",")[0];e.funcCode=info.funcCode,JE.isNotEmpty(o)&&("cbbfield"==e.xtype&&!JE.isEmpty(e.cascadeField)||(i.dicInfo[e.name]=o))}else"ckeditor"==e.xtype?(e.funAction=info.funcAction,e.simpleToolbar=!0):"searchfield"==e.xtype&&"query"==t?e.forceSelection=!1:"displayfield"==e.xtype?e.xtype="uxdisplayfield":"textarea"==e.xtype||"childfuncfield"==e.xtype&&JE.isEmpty(e.configInfo)&&JE.alert("请配置子功能集合字段【"+e.name+"】未配置功能信息!");if("group"==t){switch(delete e.afterSubTpl,delete e.width,delete e.height,delete e.allowBlank,delete e.vtype,delete e.hidden,delete e.value,delete e.readOnly,delete e.regex,delete e.regexText,delete e.funcId,delete e.fieldColor,delete e.labelColor,delete e.labelWidth,delete e.hideLabelText,e.formCode=info.funcCode+"_form",e.columnWidth=.3,e.enableKeyEvents=!0,e.labelAlign="right",e.basicXtype){case"multiitem":case"ckeditor":case"textarea":e.xtype="textfield";break;case"treessareafield":e.xtype="treessfield";break;case"gridssareafield":e.xtype="gridssfield";break;case"vueuserareafield":e.xtype="vueuserfield";break;case"textcode":e.value="";break;case"cgroup":case"rgroup":e.xtype="cbbfield"}-1!=["treessfield","gridssfield","queryuserfield"].indexOf(e.xtype)&&Ext.apply(e,{editable:!0,multiSelect:!0})}else"column"==t?(e.hideLabel=!0,delete e.hidden,delete e.inputAttrTpl,delete e.funcId,delete e.fieldCls,delete e.fieldColor,delete e.labelColor,delete e.hideLabelText):0<e.width&&"child"!=e.xtype&&(JE.isEmpty(e.groupName)&&1==info.formCols||this.fieldsets[e.groupName]&&1==this.fieldsets[e.groupName].groupCols||this.fieldsets[e.groupName]&&"auto"==this.fieldsets[e.groupName].groupLayout?(delete e.colspan,delete e.columnWidth,delete e.cols):0<(e={xtype:"fieldcontainer",hidden:e.hidden,helpTpl:e.helpTpl,margin:e.margin,allowBlank:e.allowBlank,layout:"hbox",cls:"je-fieldcontainer-"+e.xtype,funcId:e.funcId,fieldName:e.name,field_id:e.field_id,cols:e.cols,colspan:e.colspan,columnWidth:e.columnWidth,groupName:e.groupName,labelColor:e.labelColor,hideLabel:e.hideLabel,hideLabelText:e.hideLabelText,defaults:{hideLabel:!0,useFieldContainer:!0},fieldLabel:e.fieldLabel,labelWidth:e.labelWidth,labelAlign:e.labelAlign,items:e}).labelWidth||(delete e.labelWidth,delete e.items.margin));return JE.isNotEmpty(t)&&(delete e.unitTpl,delete e.unitListTpl,delete e.helpTpl,delete e.maxLength),e},button:function(e,t){return 1==t.info.bigButton&&JE.toBigButton(e),e.funcName=t.info.funcName,e.funcCode=t.info.funcCode,e.funcId=t.info.funcId,e},formatFieldStyle:function(e){"x-form-field-notop"==e.fieldCls&&(e.fieldStyle=Ext.value(e.fieldStyle,""),-1!=["uxfilefield","datetimefield","searchfield","cbbfield","colorfield","treessfield","gridssfield","queryuserfield"].indexOf(e.xtype)&&(e.fieldStyle+="border-right:1px solid #D2D5E4;"),e.readOnly&&(e.fieldCls+=" x-form-field-bottom"))},format:function(e,t){var i={};switch(e){case"info":(i={funcId:t.JE_CORE_FUNCINFO_ID,funcCode:t.FUNCINFO_FUNCCODE,funcName:t.FUNCINFO_FUNCNAME,funcAction:t.FUNCINFO_FUNCACTION,funcType:t.FUNCINFO_FUNCTYPE,modelType:t.FUNCINFO_NODEINFOTYPE,funcIconCls:t.FUNCINFO_ICONCLS,insertType:t.FUNCINFO_INSERTTYPE,listForm:JE.toBool(t.FUNCINFO_LISTFORM),pkName:t.FUNCINFO_PKNAME,tableName:t.FUNCINFO_TABLENAME,crudTableName:t.FUNCINFO_CRUDTABLENAME,extendEntityName:t.FUNCINFO_EXPANDENTITYNAME,extendJS:t.FUNCINFO_EXPANDJS,wf:JE.toBool(t.FUNCINFO_USEWF),sh:JE.toBool(t.FUNCINFO_ENABLEDSH),saas:JE.toBool(t.FUNCINFO_USESAAS),readOnlyWF:JE.toBool(t.FUNCINFO_READONLYWF),useWFLog:JE.toBool(t.FUNCINFO_USEWFLOG),batchWf:JE.toBool(t.FUNCINFO_BATCHWF),mark:JE.toBool(t.FUNCINFO_USEMARK),funcEdit:JE.toBool(t.FUNCINFO_USEEDIT),chart:JE.toBool(t.FUNCINFO_CHARTSOPEN),file:JE.toBool(t.FUNCINFO_USEFILES),history:JE.toBool(t.FUNCINFO_USEDATALOG),staticed:JE.toBool(t.FUNCINFO_ISSTATIC),oneToForm:JE.toBool(t.FUNCINFO_OCFORM),oneInForm:JE.toBool(t.FUNCINFO_ONETOFORM),formWinEdit:JE.toBool(t.FUNCINFO_OPENFORM),chUpdate:JE.toBool(t.FUNCINFO_UPDATECHILD),funcDicConfig:JE.toObj(t.FUNCINFO_FUNCDICCONFIG),chShowType:Ext.value(t.FUNCINFO_CHILDSHOWTYPE,"1"),dataSource:t.FUNCINFO_DATASOURCE,filePath:t.FUNCINFO_ATTACHMENTPATH,reportFile:t.FUNCINFO_REPORTFILE,returnInfo:t.FUNCINFO_RETURNINFO,chHeight:t.FUNCINFO_CHILDHEIGHT,multiSelect:JE.toBool(t.FUNCINFO_MULTISELECT),cxclSelModel:JE.toBool(t.FUNCINFO_CXCLSELMODEL),whereSql:t.FUNCINFO_WHERESQL,orderSql:t.FUNCINFO_ORDERSQL,extendPanels:t.FUNCINFO_EXPANDPANELS,groupField:t.FUNCINFO_GROUPFIELD,groupFieldTpl:t.FUNCINFO_GROUPFIELDTPL,pageSize:t.FUNCINFO_PAGESIZE,qxcxWidth:t.FUNCINFO_QUERYWIDTH,qxcxMulti:JE.toBool(t.FUNCINFO_MULTIQUERY),bigButton:JE.toBool(t.FUNCINFO_BIGBUTTON),gridJS:t.FUNCINFO_GRIDJSLISTENER,gridTip:t.FUNCINFO_GRIDTIP,gridChildSS:JE.toBool(t.FUNCINFO_GRIDCHILDSS),treeTip:t.FUNCINFO_TREETIP,gridRowTip:t.FUNCINFO_GRIDROWTIP,gridRowTipShow:JE.toBool(t.FUNCINFO_GRIDROWTIPSHOW),gridChildFilter:JE.toBool(t.FUNCINFO_CHILDFILTER),gridDDOrder:JE.toBool(t.FUNCINFO_DDORDER),gridPrintInfo:t.FUNCINFO_GRIDPRINTINFO,winFormWH:t.FUNCINFO_WINFORMWH,formTableStyle:JE.toBool(t.FUNCINFO_TABLESTYLE),fieldBorderColor:t.FUNCINFO_FIELDBORDERCOLOR,labelBGColor:t.FUNCINFO_LABELBGCOLOR,childRefresh:JE.toBool(t.FUNCINFO_CHILDREFRESH),treeRefresh:JE.toBool(t.FUNCINFO_TREEREFRESH),funcFormTitle:t.FUNCINFO_FORMTITLE4FUNC,formTitle:t.FUNCINFO_FORMTITLE,formTitleType:t.FUNCINFO_FORMTITLETYPE,formBgColor:t.FUNCINFO_FORMBGCOLOR,formCols:t.FUNCINFO_FORMCOLS,formPaging:JE.toBool(t.FUNCINFO_FORMPAGING),formPagingTpl:t.FUNCINFO_FORMPAGINGCONFIG,formMinWidth:JE.toNum(t.FUNCINFO_FORMMINWIDTH),formLazy:JE.toBool(t.FUNCINFO_FORMLAZY),fieldLazy:JE.toBool(t.FUNCINFO_FIELDLAZY),fieldWidth:t.FUNCINFO_FORMDEFWIDTH,labelWidth:t.FUNCINFO_FORMLABELWIDTH,formJS:t.FUNCINFO_FORMJSLISTENER,useTableForm:JE.toBool(t.FUNCINFO_TABLEFORM),tableFormTpl:t.FUNCINFO_TABLEFORMTPL,tableFormWidth:JE.toNum(t.FUNCINFO_TABLEFORMWIDTH),tableFormWidth2:JE.toNum(t.FUNCINFO_TABLEFORMWIDTH2),tableFormHeight:JE.toNum(t.FUNCINFO_TABLEFORMHEIGHT),tableFormPrint:JE.toBool(t.FUNCINFO_TABLEFORMPRINT),enableFormPrint:JE.toBool(t.FUNCINFO_ENABLEFORMPRINT),hideGridTBar:JE.toBool(t.FUNCINFO_HIDEGRIDTBAR),hideFormTBar:JE.toBool(t.FUNCINFO_HIDEFORMTBAR),helpBtn:JE.toBool(t.FUNCINFO_HELPBTN),helpSource:t.FUNCINFO_HELPSOURCE,JECore:JE.toBool(t.SY_JECORE),columnLazy:JE.toBool(t.FUNCINFO_COLUMNLAZY),groupFormOpen:JE.toBool(t.FUNCINFO_GROUPFORMOPEN),lodopPrint:t.FUNCINFO_LODOPPRINT,lodopConfig:t.FUNCINFO_LODOPCONFIG,gridBuffered:JE.toBool(t.FUNCINFO_GRIDBUFFERED),gridTimeout:JE.toNum(t.FUNCINFO_GRIDTIMEOUT),gridHides:t.FUNCINFO_GRIDHIDES,gridHideLines:t.FUNCINFO_GRIDHIDELINES,sfDb:t.FUNCINFO_SFXDB,useTreeGrid:JE.toBool(t.FUNCINFO_USETREEGRID),simpleSearch:JE.toBool(t.FUNCINFO_SIMPLESEARCH),tableView:JE.toBool(t.FUNCINFO_TABLEVIEW),tableViewCols:JE.toNum(Ext.value(t.FUNCINFO_TABLEVIEW_COLS,"1")),tableViewTplFn:t.FUNCINFO_TABLEVIEW_TPL,simpleBar:JE.toBool(t.FUNCINFO_SIMPLEBAR),pageInfoAlign:t.FUNCINFO_PAGEINFOALIGN,dbName:t.FUNCINFO_DBNAME,dbProcedure:t.FUNCINFO_PROCEDURE,dbSql:t.FUNCINFO_SQL,dbQueryParams:t.FUNCINFO_QUERYPARAM,formWidth:t.FUNCINFO_FORMWIDTH,formNavigatePos:t.FUNCINFO_FORMNAVIGATE,disableQuerySql:t.FUNCINFO_DISABLEQUERYSQL,otherConfig:t.FUNCINFO_OTHERCONFIG,viewConfigInfo:t.FUNCINFO_VIEWCONFIGINFO}).permInfo={useCjglNames:t.FUNCINFO_USECJGLNAMES,useCjgls:t.FUNCINFO_USECJGLIDS,seeUsers:t.FUNCINFO_SEEUSERIDS,seeUserNames:t.FUNCINFO_SEEUSERNAMES,seeDepts:t.FUNCINFO_SEEDEPTIDS,seeDeptNames:t.FUNCINFO_SEEDEPTNAMES,seeRoles:t.FUNCINFO_SEEROLEIDS,seeRoleNames:t.FUNCINFO_SEEROLENAMES,seeSentrys:t.FUNCINFO_SEESENTRYIDS,seePermSql:t.FUNCINFO_PERMSQL,seeSentryNames:t.FUNCINFO_SEESENTRYNAMES,otherPerm:t.FUNCINFO_PERMCONFIG},i.viewTableName=i.tableName,"view"==i.funcType&&(i.tableName=Ext.value(i.crudTableName,i.tableName));var a=Ext.value(i.whereSql,"");if(i.saas&&"1"==JE.systemConfig.JE_SYSMODE&&(a+=" AND SY_ZHID='{@USER_ZHID@}'"),i.whereSql=a,JE.isNotEmpty(i.chHeight)&&!Ext.isNumeric(i.chHeight)){var n=Ext.decode(i.chHeight,!0);if(n){var o,r=window.screen.width+"x"+window.screen.height,l=0;Ext.each(n,function(e){if(e.code==r)return o=e.value,!1;"default"==e.code&&(l=e.value)}),i.chHeight=o||l}}else i.chHeight=JE.toNum(i.chHeight);i.simpleBar=!JE.isNotEmpty(t.FUNCINFO_SIMPLEBAR)||JE.toBool(t.FUNCINFO_SIMPLEBAR),i.pageInfoAlign=JE.isNotEmpty(i.pageInfoAlign)?i.pageInfoAlign:"left";break;case"field":(i={maxLength:JE.toNum(t.RESOURCEFIELD_MAXLENGTH),helpTpl:t.RESOURCEFIELD_HELP,unitTpl:t.RESOURCEFIELD_UNITTPL,unitListTpl:t.RESOURCEFIELD_UNITLISTTPL,allowBlank:JE.toBool(t.RESOURCEFIELD_ALLOWBLANK),name:t.RESOURCEFIELD_CODE,cols:t.RESOURCEFIELD_COLSPAN,colspan:t.RESOURCEFIELD_COLSPAN,rowField:t.RESOURCEFIELD_ROWFIELD,configInfo:JE.toStr(t.RESOURCEFIELD_CONFIGINFO),editable:JE.toBool(t.RESOURCEFIELD_EDITABLE),emptyText:t.RESOURCEFIELD_EMPTYTEXT,fieldCls:JE.toStr(t.RESOURCEFIELD_FIELDCLS),hideLabel:JE.toBool(t.RESOURCEFIELD_HIDELABEL),orderIndex:t.SY_ORDERINDEX,groupName:t.RESOURCEFIELD_GROUPNAME,locate:JE.toBool(t.RESOURCEFIELD_LOCATE),hidden:JE.toBool(t.RESOURCEFIELD_HIDDEN),fieldLazy:!JE.toBool(t.RESOURCEFIELD_FIELDLAZY),bindingExp:t.RESOURCEFIELD_BINDING,visibleExp:t.RESOURCEFIELD_INTERPRETER,readOnlyExp:t.RESOURCEFIELD_READONLYEXP,allowBlankExp:t.RESOURCEFIELD_ALLOWBLANKEXP,enableExp:t.RESOURCEFIELD_ENABLEEXP,bindingExpFn:t.RESOURCEFIELD_BINDINGFN,visibleExpFn:t.RESOURCEFIELD_INTERPRETERFN,readOnlyExpFn:t.RESOURCEFIELD_READONLYEXPFN,allowBlankExpFn:t.RESOURCEFIELD_ALLOWBLANKEXPFN,enableExpFn:t.RESOURCEFIELD_ENABLEEXPFN,enableTip:t.RESOURCEFIELD_ENABLETIP,jsListener:t.RESOURCEFIELD_JSLISTENER,fieldLabel:t.RESOURCEFIELD_NAME,labelAlign:Ext.value(t.RESOURCEFIELD_LABELALIGN,"right"),otherConfig:JE.toStr(t.RESOURCEFIELD_OTHERCONFIG),readOnly:JE.toBool(t.RESOURCEFIELD_READONLY),regex:t.RESOURCEFIELD_REGEX,regexText:t.RESOURCEFIELD_REGEXTEXT,selectOnFocus:JE.toBool(t.RESOURCEFIELD_SELECTONFOCUS),whereSql:t.RESOURCEFIELD_WHERESQL,basicSql:t.RESOURCEFIELD_WHERESQL,value:JE.toStr(t.RESOURCEFIELD_VALUE),valueFn:t.RESOURCEFIELD_VALUEFN,vtype:t.RESOURCEFIELD_VTYPE,vtypeFn:t.RESOURCEFIELD_VTYPEFN,width:JE.toNum(t.RESOURCEFIELD_WIDTH),height:JE.toNum(t.RESOURCEFIELD_HEIGHT),bgColor:t.RESOURCEFIELD_BGCOLOR,xtype:t.RESOURCEFIELD_XTYPE,basicXtype:t.RESOURCEFIELD_XTYPE,history:t.RESOURCEFIELD_HISTORY,field_id:t.JE_CORE_RESOURCEFIELD_ID,fieldColor:t.RESOURCEFIELD_FIELDCOLOR,labelColor:t.RESOURCEFIELD_LABELCOLOR,removed:JE.toBool(t.RESOURCEFIELD_REMOVED)}).maxLength<=0&&delete i.maxLength,"method"==i.vtype?JE.isEmpty(i.vtypeFn)&&(delete i.vtype,delete i.vtypeFn):delete i.vtypeFn,JE.isNotEmpty(i.vtype)&&(i.validateBlank=!0);var s=Ext.decode(Ext.value(i.otherConfig,"{}"));if("fieldset"==i.xtype){Ext.each(["basicColor","borderColor","borderTopColor","titleColor","titleBgColor"],function(e){JE.isNotEmpty(s[e])&&(i[e]=s[e])})}else"cbbfield"==i.xtype&&JE.isNotEmpty(s.cascadeField)&&(i.cascadeField=s.cascadeField);break;case"column":i={itemId:t.RESOURCECOLUMN_CODE,dataIndex:t.RESOURCECOLUMN_CODE,xtype:t.RESOURCECOLUMN_XTYPE,align:t.RESOURCECOLUMN_ALIGN,vAlign:t.RESOURCECOLUMN_VALIGN,text:t.RESOURCECOLUMN_NAME,orderIndex:t.SY_ORDERINDEX,checkedCls:t.RESOURCECOLUMN_CHECKEDCLS,uncheckedCls:t.RESOURCECOLUMN_UNCHECKEDCLS,hidden:JE.toBool(t.RESOURCECOLUMN_HIDDEN),locked:JE.toBool(t.RESOURCECOLUMN_LOCKED),sortable:JE.toBool(t.RESOURCECOLUMN_ORDER),enableGroup:JE.toBool(t.RESOURCECOLUMN_GROUP),merge:JE.toBool(t.RESOURCECOLUMN_MERGE),allowEdit:JE.toBool(t.RESOURCECOLUMN_ALLOWEDIT),columnTip:JE.toBool(t.RESOURCECOLUMN_COLUMNTIP),dateFormat:t.RESOURCECOLUMN_DATEFORMAT,enableIcon:JE.toBool(t.RESOURCECOLUMN_ENABLEICON),moreColumnName:t.RESOURCECOLUMN_MORECOLUMNNAME,multiRows:JE.toBool(t.RESOURCECOLUMN_MULTIROWS),queryIndex:t.RESOURCECOLUMN_QUERYINDEX,queryType:t.RESOURCECOLUMN_QUERYTYPE,quickQuery:t.RESOURCECOLUMN_QUICKQUERY,quickQueryType:t.RESOURCECOLUMN_QUICKQUERYTYPE,columnQueryType:Ext.value(t.RESOURCECOLUMN_COLUMNQUERYTYPE,"no"),summaryMsg:t.RESOURCECOLUMN_STATISTICSMSG,summaryAllMsg:t.RESOURCECOLUMN_STATISTALLMSG,summaryFormat:t.RESOURCECOLUMN_SUMMARYFORMAT,summary:t.RESOURCECOLUMN_STATISTICSTYPE,width:JE.toNum(t.RESOURCECOLUMN_WIDTH),rightBorderColor:t.RESOURCECOLUMN_RBORDERCOLOR,jsListener:t.RESOURCECOLUMN_JSLISTENER,dicColor:t.RESOURCECOLUMN_COLOR2,hideTitleCls:JE.toBool(t.RESOURCECOLUMN_HIDETITLECLS),enableUpdate:JE.toBool(t.RESOURCECOLUMN_ENABLEUPDATE),lazyLoad:JE.toBool(t.RESOURCECOLUMN_LAZYLOAD),titleColor:t.RESOURCECOLUMN_TITLECOLOR,otherConfig:t.RESOURCECOLUMN_OTHERCONFIG,iditColumn:JE.toBool(t.RESOURCECOLUMN_IDIT),formColumn:JE.toBool(t.RESOURCECOLUMN_FORMCOLUMN),jecolumn:!0},Ext.each(["summaryMsg","summaryAllMsg","summaryFormat","summary"],function(e){var t=i[e];JE.isNotEmpty(t)&&(i[e]=null==JE.decode(t,!0)?'[{code:"'+t+'",text:"'+t+'"}]':t)});break;case"button":i={xtype:"button",bigIconCls:t.RESOURCEBUTTON_BIGICONCLS,ref:t.RESOURCEBUTTON_CODE,code:t.RESOURCEBUTTON_CODE,configInfo:t.RESOURCEBUTTON_CONFIGINFO,orderIndex:t.SY_ORDERINDEX,removed:JE.toBool(t.RESOURCEBUTTON_DISABLED),type:t.RESOURCEBUTTON_TYPE,form:JE.toBool(t.RESOURCEBUTTON_ISFORM),noReadOnly:JE.toBool(t.RESOURCEBUTTON_NOREADONLY),hidden:JE.toBool(t.RESOURCEBUTTON_HIDDEN),iconCls:t.RESOURCEBUTTON_ICONCLS,visibleExp:t.RESOURCEBUTTON_INTERPRETER,jsListener:t.RESOURCEBUTTON_JSLISTENER,text:t.RESOURCEBUTTON_NAME,msg:t.RESOURCEBUTTON_MSG,enableFormBind:JE.toBool(t.RESOURCEBUTTON_FORMBIND),button_id:t.JE_CORE_RESOURCEBUTTON_ID,wfEndedEnable:JE.toBool(t.RESOURCEBUTTON_WFENDEDENABLE),cls:t.RESOURCEBUTTON_CLS,fontIconCls:t.RESOURCEBUTTON_FONTICONCLS,fontIconColor:t.RESOURCEBUTTON_FONTICONCOLOR,parentBtn:t.RESOURCEBUTTON_YFAN,barPosition:t.RESOURCEBUTTON_POSITION},"plus"==JE.getTheme()?(i.iconCls=Ext.value(i.fontIconCls,""),JE.isNotEmpty(i.fontIconColor)&&(i.iconStyle="color:"+i.fontIconColor+";"),i.cls=Ext.value(i.cls,"btn-default")):delete i.cls;break;case"child":(i={id:t.JE_CORE_FUNCRELATION_ID,code:t.FUNCRELATION_CODE,name:t.FUNCRELATION_NAME,funcId:t.FUNCRELATION_FUNCID,funcIconCls:t.FUNCRELATION_FUNCICONCLS,ctr:t.FUNCRELATION_ENTITYNAME,view:t.FUNCRELATION_TABLENAME,enabled:JE.toBool(t.FUNCRELATION_ENABLED),orderIndex:t.SY_ORDERINDEX,showType:t.FUNCRELATION_SHOWTYPE,type:t.SY_STATUS,relyonType:t.FUNCRELATION_RELYONTYPE,locate:JE.toBool(t.FUNCRELATION_LOCATE),height:JE.toNum(t.FUNCRELATION_HEIGHT),visibleExp:t.FUNCRELATION_INTERPRETER,showTitle:JE.toBool(t.FUNCRELATION_SHOWTITLE),fields:[]}).showType=i.showType,Ext.each(t.relatedFields,function(e){"idit"==(e={code:e.ASSOCIATIONFIELD_PRIFIELDCODE,name:e.ASSOCIATIONFIELD_PRIFIELDNAME,chCode:e.ASSOCIATIONFIELD_CHIFIELDCODE,chName:e.ASSOCIATIONFIELD_CHIFIELDNAME,value:JE.toBool(e.ASSOCIATIONFIELD_TRANSMIT),whereSql:JE.toBool(e.ASSOCIATIONFIELD_WHERECON),whereType:e.ASSOCIATIONFIELD_ASSOCIATION,sql:e.ASSOCIATIONFIELD_SQL,cascadeUpdate:JE.toBool(e.ASSOCIATIONFIELD_CASCADEUPDATE),cascadeDelete:JE.toBool(e.ASSOCIATIONFIELD_DELCHILD)}).whereType&&(e={whereType:e.whereType,whereSql:!0,sql:e.sql}),i.fields.push(e)});break;case"dataflow":i={enableFn:t.DATAFLOW_QYTJ,buttons:t.DATAFLOW_DZ,act:t.DATAFLOW_CZ,type:t.DATAFLOW_CZFS,sql:t.DATAFLOW_SQL,callbackFn:t.DATAFLOW_HD}}return JE.CoreUtil.lang_funcData(this,e,i,t),this.buildJSListeners(i,e),this.clearEmpty(i),i},buildJSListeners:function(a,n){var e=[];"info"==n?(e.push({code:"formListeners",value:a.formJS}),e.push({code:"gridListeners",value:a.gridJS})):"child"!=n&&e.push({code:"listeners",value:a.jsListener}),Ext.each(e,function(e){var t=Ext.decode(Ext.value(e.value,"[]")),i={};Ext.each(t,function(e){Ext.isEmpty(e.newfunc)||1!=e.fire||(i[e.code]=e.newfunc)}),"column"!=n||Ext.isEmpty(i.renderer)||(a.renderer=i.renderer,delete i.renderer),Ext.Object.isEmpty(i)||(a[e.code]=i)})},parseJSListeners:function(o){var r=this;Ext.isObject(o)?Ext.iterate(o,function(e,i){if(JE.isNotEmpty(i))if(-1!=["listeners","formListeners","gridListeners"].indexOf(e))Ext.iterate(i,function(e,t){i[e]=JE.eval(t)});else if(-1!=["renderer","summaryRenderer","summaryType"].indexOf(e))o[e]=JE.eval(i);else if("vtypeFn"==e){var a=o.vtype=o.funcCode+"--"+o.name,t=Ext.value(r.vtypes,[]);if(-1==t.indexOf(a)){t.push(a);var n=JE.eval(i);Ext.each(["fn","text","mask"],function(e){var t=n[e],i=a+("fn"==e?"":e.replace(/(\w)/,function(e){return e.toUpperCase()}));delete Ext.form.field.VTypes[i],Ext.isEmpty(t)||(Ext.form.field.VTypes[i]=t)}),r.vtypes=t}}else r.parseJSListeners(i)}):Ext.isArray(o)&&Ext.each(o,function(e){r.parseJSListeners(e)})}}),Ext.define("JE.core.util.LocalLangUtil",{lang_portal_title:function(e){return"en"==_JE_LOCAL_LANG?e.PROTAL_BT_EN:e.PROTAL_BT},lang_portal_config:function(e,t){var i="en"==_JE_LOCAL_LANG?"_en":"";switch(e){case"title":return t["title"+i];case"button":return t["name"+i];case"column":t.name=t["name"+i],t.width=t["width"+i]}},lang_funcData:function(e,t,i,a){var n="";switch("en"==Ext.value(e.localLang,window._JE_LOCAL_LANG)&&(n="_EN"),t){case"info":i.funcName=a["FUNCINFO_FUNCNAME"+n],i.gridTip=a["FUNCINFO_GRIDTIP"+n],i.treeTip=a["FUNCINFO_TREETIP"+n],i.labelWidth=Ext.value(a["FUNCINFO_FORMLABELWIDTH"+n],a.FUNCINFO_FORMLABELWIDTH);break;case"field":i.fieldLabel=a["RESOURCEFIELD_NAME"+n];break;case"column":i.text=a["RESOURCECOLUMN_NAME"+n],i.width=JE.toNum(Ext.value(a["RESOURCECOLUMN_WIDTH"+n],a.RESOURCECOLUMN_WIDTH));break;case"button":i.text=a["RESOURCEBUTTON_NAME"+n];break;case"child":i.name=a["FUNCRELATION_NAME"+n]}},lang_static_funcData:function(e,t){var i=Ext.create("JE.core.util.FuncUtil"),a={};a=Ext.isString(e)?i.loadFuncData(e,!0):Ext.clone(e),i.localLang="zh_cn";var n=i.buildFuncData(a,!0),o="";return i.localLang="en",o=i.buildFuncData(a,!0),0!=t&&JE.ajax({url:JE.getUrlMaps("je.core.staticize","doFuncInfo"),async:!0,params:{tableCode:"JE_CORE_FUNCINFO",JE_CORE_FUNCINFO_ID:n.info.funcId,FUNCINFO_FUNCCODE:n.info.funcCode,FUNCINFO_FUNCNAME:n.info.funcName,strData:JE.encode(n),strData_en:JE.isNotEmpty(o)?JE.encode(o):""}}),"en"==window._JE_LOCAL_LANG?o:n},lang_static_fileUrl:function(e,t){if(-1==["MENU","FUNC"].indexOf(e))return t;var i="";return"en"==_JE_LOCAL_LANG&&(i="_en"),t.replaceAll(".json",i+".json")},lang_queryStrategy_tpl:function(){return'{[_JE_LOCAL_LANG=="en"?values.QUERYSTRATEGY_NAME_EN:values.QUERYSTRATEGY_NAME]}'}}),Ext.define("JE.core.util.MenuUtil",{locationFuncById:function(e){JE.openFuncById(e,!1)},openFuncById:function(e,a){var t=JE._MENUS[e];if(!t)return!1;var n=!1,i=t.nodePath.replace("/ROOT/","").split("/")[0],o=Ext.getCmp("app-topmenu");if(o){var r=o.getCmp(e);if(r)return r.toggle(!0),0!=a&&r.handler(r),!0;if(o.menu)return 0!=a&&(o.openFunc(e),!0);(r=o.getCmp(i))&&(r.toggle(!0),0!=a&&r.handler(r))}var l=Ext.getCmp("_jewestview");return l&&("appmenutiled"==l.xtype?l.openFunc(e):l.items.each(function(t){var i=t.store.getNodeById(e);if(i)return t.selectPath(i.getPath()),setTimeout(function(){var e=Ext.get(t.view.getNode(i));JE.scrollBy(t.view,e)},100),0!=a&&setTimeout(function(){t.fireEvent("itemclick",t.view,i)},300),!(n=!0)})),n},openFuncByCode:function(a,n){n=Ext.value(n,{});if(!(t=n.menuBean)){var t,e=JE.ajax({url:JE.getUrlMaps("je.core.rbac.rbac.load"),params:{limit:-1,tableCode:"JE_CORE_MENU",whereSql:" and MENU_NODEINFOTYPE in('IDDT','MT','DIC','CHART','REPORT','PORTAL','INDUSTRY') AND MENU_NODEINFO LIKE '"+a+"%'"}}).rows;Ext.each(e,function(e){if(e.MENU_NODEINFO.split(",")[0]==a)return t=e,!1}),JE._MENUS[t.JE_CORE_MENU_ID]={type:t.MENU_NODEINFOTYPE,info:t.MENU_NODEINFO,id:t.JE_CORE_MENU_ID,title:t.MENU_MENUNAME,text:t.MENU_MENUNAME,iconCls:t.MENU_FONTICONCLS,nodePath:t.SY_PATH,parent:t.SY_PARENT,nodeInfo:t.MENU_NODEINFO,nodeInfoType:t.MENU_NODEINFOTYPE,showView:o,fontIconColor:t.MENU_FONTICONCOLOR,bean:t}}if(t){var i=Ext.getCmp("_jewestview"),o=Ext.value(n.showView,t.MENU_FUNCTYPE),r=!0;if(i&&(r=0==JE.openFuncById(t.JE_CORE_MENU_ID)),r&&JE.openFunc({type:t.MENU_NODEINFOTYPE,info:t.MENU_NODEINFO,id:t.JE_CORE_MENU_ID,title:t.MENU_MENUNAME,iconCls:t.MENU_FONTICONCLS,showView:o,fontIconColor:t.MENU_FONTICONCOLOR}),"MT"==t.MENU_NODEINFOTYPE&&"form"==o&&JE.isNotEmpty(n.modelID))var l=setInterval(function(){var e=Ext.getCmp(a+"_jeformview");if(e&&e.rendered){clearInterval(l);var t=e.funcData.info,i=JE.ajax({url:JE.getUrlMaps("je.core.getInfoById"),params:{tableCode:e.funcData.info.tableName,pkValue:n.modelID}});0!=i.success&&JE.Action.doEdit(null,Ext.create(t.modelName,i),t)}},100);if("MT"==t.MENU_NODEINFOTYPE&&"grid"==o&&JE.isNotEmpty(n.whereSql))l=setInterval(function(){var e=Ext.getCmp(a+"_jegridview");e&&(clearInterval(l),e.getStore().proxy.extraParams.expandSql=n.whereSql,e.getStore().loadPage(1))},100)}else{Ext.getCmp("_appcenterview").add({xtype:"panel",html:JE.format(JE.getLocalLang("core.jemainview.alert.noFunc"),a)})}},_menu_history:[],openFunc:function(e){var t=this,i=e.type,a=e.info,n=e.id,o=e.title,r=e.iconCls,l=e.tree;e.config;if(!t.opening){t.opening=!0;var s=JE.getLocalLang("core.jemainview.alert"),d="";if("MENU"!=i&&JE.isEmpty(a))return JE.alert("菜单配置信息为空，无法打开功能！"),void delete t.opening;if("MENU"!=i){if("URL"==i)return JE.openWindow(a),void delete t.opening;if("IDDT"==i)d=(O=a.split(","))[0]+"_mainview";else if("MT"==i){d=(_=(O=a.split(","))[0])+"_jemainview";(D=JE.getFuncData(_))&&(d=_+(JE.isEmpty(D.childObj[5])?"_jemainview":"_jetabmainview"))}else if("DIC"==i){var c=(O=a.split(","))[0];d="JE_CORE_DICTIONARYITEM"+("1"==Ext.value(JE.dicInfoData[c],{}).DICTIONARY_ZWFFLAG?"_ZWF":"")+"_jemainview_"+c}else if("CHART"==i){d=(O=a.split(","))[0]+"_jechartview"}else if("REPORT"==i){d=(O=a.split(","))[0]+"_jereportview"}else if("PORTAL"==i){d=(O=a.split(","))[0]+"_jeportalview"}else if("INDUSTRY"==i){d=(O=a.split(","))[0]+"_jeindustryview"}var u=Ext.getCmp("_appcenterview"),p=u.getComponent(n);!p&&JE.isNotEmpty(d)&&(p=Ext.getCmp(d));var f=!p;if(f){var E=Number(Ext.value(JE.systemConfig.JE_SYS_MAINCOUNT,"0")),m=0;if(u.items.each(function(e){!e.tab.isHidden()&&n!=e.itemId&&e.closable&&m++}),0<E&&E<=m)return JE.dialog(JE.format(s.funcCount.msg,E),function(e){"closeAll"==e?t.doCloseTab(u,!1):"closeOther"==e&&(t.doCloseTab(u,!1),JE.isNotEmpty(n)&&JE.openFuncById(n))},{buttons:{closeOther:s.funcCount.closeOther,closeAll:s.funcCount.closeAll,cancel:s.funcCount.cancel}}),void delete t.opening}var g='<div class="image"></div><div class="text"><span class="func">'+o+"</span> 加载中...</div>",h=new Date,x={xtype:"panel"};if(f){if("IFRAME"==i){var v=a.split(",")[0],y=Ext.value(a.split(",")[1],"");x.html='<iframe scrolling="auto" frameborder="0" width="100%" height="100%" src='+v+" name="+y+"></iframe>",x.listeners={afterrender:function(e){var t=e.getEl().down("iframe").dom;t.contentWindow.onfocus=function(){JE.browser.focus(!0)},t.contentWindow.onblur=function(){JE.browser.blur(!0)}}}}else if("IDDT"==i){var b=(O=a.split(","))[1],C=JE.getXTypeByClassName(b);x=Ext.isEmpty(C)?{xtype:"panel",html:"功能不存在"}:{xtype:C}}else if("INDUSTRY"==i){x={xtype:"jeindustryview",industryCode:(O=a.split(","))[1]}}else if("CHART"==i){var w=(O=a.split(","))[1],S="true"==O[2]||void 0,I=Ext.decode(Ext.value(O[3],"{}"));x={xtype:"jechartview",chartCode:w,hideSearchBar:S,chartAttrs:Ext.decode(Ext.value(O[4],"{}")),chartParams:I}}else if("REPORT"==i){var T=(O=a.split(","))[1];S="true"==O[2]||void 0;reportParams=Ext.decode(Ext.value(O[3],"{}")),editable="true"==Ext.value(O[4],"true"),values=JE.toObj(O[5]),x={xtype:"jereportview",reportCode:T,hideSearchBar:S,reportParams:reportParams,editable:editable,values:values}}else if("MT"==i){var _=(O=a.split(","))[0],J=e.showView;if("JE_CORE_FONTICON"==_)x={xtype:"jeiconview",funcCode:_};else{var D=JE.getFuncData(_);x={xtype:JE.isEmpty(D.childObj[5])?"jemainview":"jetabmainview",funcData:D,showView:J}}}else if("DIC"==i){var A=(O=a.split(","))[0],N=Ext.value(JE.dicInfoData[A],{});if(N=N||JE.ajax({url:JE.getUrlMaps("je.core.load"),params:{tableCode:"JE_CORE_DICTIONARY",whereSql:" and DICTIONARY_DDCODE = '"+A+"'"}}).rows[0])(D=JE.getFuncData("JE_CORE_DICTIONARYITEM"+("1"==N.DICTIONARY_ZWFFLAG?"_ZWF":""))).info.whereSql=Ext.value(D.info.whereSql,"")+" and DICTIONARYITEM_DICTIONARY_ID = '"+N.JE_CORE_DICTIONARY_ID+"'",D.info.treeParentSql=D.info.whereSql,x={xtype:"jemainview",funcData:D,idSuffix:"_"+A,mainData:{DICTIONARYITEM_DICTIONARY_ID:N.JE_CORE_DICTIONARY_ID,DICTIONARY_DDTYPE:N.DICTIONARY_DDTYPE},dicItemFunc:!0};else x.html=JE.format(s.DIC,A)}else if("COMBINE"==i);else if("PORTAL"==i)if(x.layout="fit",Ext.isEmpty(a))x.html=s.PORTAL.noId;else{var O=a.split(","),R=Ext.value(O[1],O[0]);x.xtype="jeportalview",x.beanId=R}p=Ext.apply(x,{iconCls:r,title:o,itemId:n,modelId:n,closable:!0,tabConfig:{treeObj:l,modelId:e.modelId}}),"plus"==JE.getTheme()&&JE.isNotEmpty(e.fontIconColor)&&(p.tabConfig.iconStyle="color:"+e.fontIconColor),"PORTAL"==i&&delete p.bodyPadding,JE.isNotEmpty(d)&&(p.id=d)}else{"crumbs"!=JE.systemConfig.JE_SYS_MENULOCATION&&(p.funcData?p.refreshFunc():p.load&&(p.reset&&p.reset(),p.load()))}var L=-1,P={menuId:n,text:o,iconCls:r||"fa fa-circle-o"};Ext.each(t._menu_history,function(e,t){if(e.menuId==P.menuId)return L=t,!1}),-1<L&&t._menu_history.splice(L,1),t._menu_history.unshift(P),f&&(-1==["DIC","MT"].indexOf(i)?JE.doMask(u,g,function(){if("IDDT"==i){var e=a.split(",");Ext.each(e,function(e,t){1<t&&JE.initCtr(e)})}(p=u.add(p)).tab.show(),u.setActiveTab(p),p.isShow=!0,JE.timeLog(h,"打开 "+p.title+(p.funcData?"("+p.funcData.info.funcCode+")":"")+" 功能耗时"),delete t.opening,JE.loadBadgeById(n),t.addLocationBar(p)},"je-func-mask"):(p=u.add(p),f=!1)),f||(p.tab.show(),u.setActiveTab(p),p.isShow=!0,JE.timeLog(h,"打开 "+p.title+(p.funcData?"("+p.funcData.info.funcCode+")":"")+" 功能耗时"),delete t.opening,JE.loadBadgeById(n),t.addLocationBar(p))}else delete t.opening}},addLocationBar:function(e){var a=this,t=JE._MENUS[e.itemId];if("crumbs"==JE.systemConfig.JE_SYS_MENULOCATION&&t){var i=Ext.getCmp("_appcenterview").locationTabbar;if(i){var n=_JE_LOCAL_LANG,o=e.title;"en"==n&&JE.isNotEmpty(t.bean.MENU_MENUSUBNAME)&&(o=t.bean.MENU_MENUSUBNAME),i.getCmp("view").addMenu({id:e.itemId,text:o,iconCls:JE.isEmpty(e.iconCls)?"fa fa-circle-o":e.iconCls,iconStyle:e.tabConfig.iconStyle,closable:1!=t.bean.MENU_HIDELOCATION})}if(!e.getDockedCmp("locationBar")){var r=[];if(!t||1==t.bean.MENU_HIDELOCATION)return;for(;t&&(r.push(t.text),"ROOT"!=t.parent&&2!=r.length);)t=JE._MENUS[t.parent];r.reverse(),e.insertDocked(0,{xtype:"toolbar",height:40,itemId:"locationBar",menus:r,cls:"je-location-bar",padding:"5 0 0 0",items:[{xtype:"box",cls:"location",html:r.join('<span class="split-str">/</span>'),itemId:"location"},{xtype:"box",itemId:"history",cls:"history-icon",html:'<i class="fa fa-caret-down" style="color: #515151;cursor: pointer;"></i>',showHistory:function(){var t=this,e=JE.getLocalLang("core.menuHeadSet.func");!t.menu&&2<=a._menu_history.length&&(t.menu=Ext.create("Ext.menu.Menu",{shadow:!1,autoScroll:!0,maxHeight:410,dockedItems:[{xtype:"toolbar",dock:"top",border:0,items:[{xtype:"box",html:'访问历史<i title="'+e.switchingMode+'" class="jeicon jeicon-mode-switch" style="float:right;cursor: pointer;font-size: 14px;"></i>',style:{padding:"4px 8px",bodyStyle:"width:100%",border:0,color:"#888",width:"100%"},listeners:{afterrender:function(e){e.getEl().on("click",function(e){e.getTarget(".jeicon")&&(Ext.getCmp("_appcenterview").changeLocationBar(),t.menu.hide())})}}}]}],width:150,cls:"je-menu-item34h je-menu-arrow je-menu-arrow-t je-menu-arrow-top",plain:!0,defaults:{handler:function(e){JE.openFuncById(e.menuId)}}})),t.menu.removeAll(!0),2<=a._menu_history.length&&t.menu.showBy(t,"t-b");var i=[].concat(Ext.clone(a._menu_history).splice(1,a._menu_history.length));setTimeout(function(){t.menu.add(i)})},listeners:{afterrender:function(e){e.getEl().on("click",function(){e.showHistory()})}}},"->",{xtype:"box",itemId:"funcTpl",margin:"0 10 0 0"}]},"top")}}},refreshLocation:function(t,i,a){i=i||{};if(t&&t.getCmp("locationBar")){var e=t.getCmp("locationBar").getCmp("funcTpl"),n="";t.hasListener("refreshlocation")?Ext.each(t.events.refreshlocation.listeners,function(e){n+=e.fireFn.apply(t,[t,i])}):a&&(a.hasListener("gridsummary")?Ext.each(a.events.gridsummary.listeners,function(e){n+=e.fireFn.apply(a,[a,i])}):a.hasListener("refreshlocation")&&Ext.each(a.events.refreshlocation.listeners,function(e){n+=e.fireFn.apply(a,[a,i])})),e.update(n)}},_MENUS:{},_MENUS4CODE:{},_MENUS4SHORT:[],getMenuType:function(){var e=Ext.value(JE.systemConfig.JE_SYS_MENUTYPE,""),t=JE.getTheme();return("plus"==t||"saas"==t&&"TOPBUTTON"==e)&&(e=""),e},buildMenu:function(){var e=JE.CoreUtil.getUSPremData("MENU"),i=JE.getTheme(),a=Ext.util.Cookies.get("je-local-lang")||"zh_CN",n=0,o=function(e){if("plus"==i&&(e.iconCls=JE.getIconCls(e.bean,"MENU_ICONCLS","MENU_FONTICONCLS")),delete e.checked,e.text="en"==a?Ext.value(e.bean.MENU_MENUSUBNAME,e.text):e.text,"1"==(JE._MENUS[e.id]=e).bean.MENU_QUICKSTART&&JE._MENUS4SHORT.push({KJMENU_YHUD:JE.USER.userId,KJMENU_CDID:e.id,SY_ORDERINDEX:++n}),-1==["IFRAME","MENU","URL"].indexOf(e.nodeInfoType)){var t=JE.split(e.nodeInfo,",")[0];t&&(JE._MENUS4CODE[t]=e)}Ext.each(e.children,function(e){o(e)})};o(e);var r=JE.getMenuType();if("plus"==i||-1!=r.indexOf("TOPMENU"))return{menuType:r,menuData:e};var l={xtype:"treepanel",useArrows:!0,animate:!1,rootVisible:!1,root:{text:"ROOT",id:"ROOT",expanded:!0,children:[]},listeners:{itemclick:function(e,t,i,a,n,o){var r={type:t.raw.nodeInfoType,info:t.raw.nodeInfo,id:t.raw.id,title:t.raw.text,iconCls:t.raw.iconCls,showView:t.raw.hrefTarget,tree:e.panel,cpids:t.raw.bean.CPID};JE.openFunc(r)},afterrender:function(e){e.nodeInfo?"openChild"==e.nodeInfo&&e.getRootNode().expand(!0):e.getRootNode().eachChild(function(e){"openChild"==e.raw.nodeInfo&&e.expand(!0)})}}},t=Number(Ext.value(JE.systemConfig.JE_SYS_MODELNUM,"0")),s=[];if(-1==["TOPBUTTON","TOPBUTTON16"].indexOf(r)&&0<t&&e.children&&e.children.length>t)l.root.children=e.children,l.menuType="tree";else{var d=[];Ext.each(e.children,function(e){var t=Ext.clone(l);if(Ext.apply(t,{title:e.text,itemId:e.id,nodeInfo:e.nodeInfo,iconCls:e.iconCls,menuType:e.nodeInfoType,titleText:e.text,smallIconCls:e.iconCls,bigIconCls:e.bean.MENU_BIGICONCLS}),"1"==e.bean.MENU_BIGBUTTON&&(t.hideHeaders=!0,t.viewConfig={overItemCls:"je-menu-treebtn-over",selectedItemCls:"je-menu-treebtn-selected",focusedItemCls:"je-menu-treebtn-focused",beforeFocusedItemCls:"je-menu-treebtn-before-focused",tableFocusedFirstCls:"je-menu-treebtn-focused-first"},t.columns=[{flex:1,dataIndex:"text",renderer:function(e,t,i){var a=i.raw,n=a.bean.MENU_BIGICONCLS+"--menu",o=Ext.value(a.bean.MENU_MENUSUBNAME,""),r=Ext.isEmpty(o)?"margin-top:6px;":"",l=a.bean.MENU_MENUNAME;return t.style="cursor: pointer;",'<div class="je-menu-treebtn-icon" style="float:left;">'+JE.getIconTpl(n,{style:"width:32px;height:32px;background-color: transparent;"})+'</div><div style="float:left;padding:7px 0 0 7px;"><div style="font-size: 13px;margin-bottom: 2px;'+r+'">'+l+'</div><div style="color: #A2A2A2;">'+o+"</div></div>"}}]),Ext.apply(t.root,{id:e.id,children:e.children}),-1!=["TOPBUTTON","TOPBUTTON16"].indexOf(r)){t.border=0,delete t.title,delete t.iconCls;var i="MENU"==t.menuType||JE.isNotEmpty(t.root.children);i&&d.push(t);var a={text:e.text,iconCls:e.iconCls,smallIconCls:e.iconCls,menuType:e.nodeInfoType,nodeInfo:e.nodeInfo,showView:e.hrefTarget,itemId:e.id+"-btn",modelId:e.id,showMenu:i,cls:"JE-menu-button",focusCls:"menufocus",overCls:"menuover",handler:function(e){if(this.showMenu){var t=Ext.getCmp("_jewestview");"appmenuview"==t.xtype?t.loadModelMenu(this.modelId):(t.items.get(0).getLayout().setActiveItem(this.modelId),t.setTitle(this.text),t.setIconCls(this.smallIconCls))}0!=e&&"MENU"!=this.menuType&&JE.openFunc({type:this.menuType,info:this.nodeInfo,id:this.modelId,title:this.text,iconCls:this.smallIconCls,showView:this.showView})}};"TOPBUTTON"==r&&Ext.apply(a,{iconCls:e.bean.MENU_BIGICONCLS+"--menu",scale:"large",iconAlign:"top"}),s.push(a)}else Ext.isEmpty(t.root.children)&&"MENU"!=t.menuType&&(t.root.id+="_ROOT",t.root.children=[e]),d.push(t)}),l=-1!=["TOPBUTTON","TOPBUTTON16"].indexOf(r)?{menuType:"card",layout:"card",defaults:{bodyStyle:"border-top-width:0px;"},items:d}:{menuType:"accordion",layout:"accordion",layoutConfig:{titleCollapse:!1,animate:!0,activeOnTop:!0},items:d}}return l.type=l.menuType,l.menuType=r,l.topButtons=s,l.menuData=e,l.region="center",l},doCloseTab:function(t,i){t.items.each(function(e){e.closable&&(i&&e==t.getActiveTab()||e.tab.onCloseClick())})}}),Ext.define("JE.core.util.PermUtil",{gridUpdateBtnPrem:function(){return this.funcButtonsPerm("grid",["gridUpdateBtn"])},gridEditBtnPrem:function(){return this.funcButtonsPerm("grid",["gridEditBtn"])},formSaveBtnPrem:function(){return this.funcButtonsPerm("form",["formSaveBtn","formNewBtn","formCopyBtn"])},funcButtonsPerm:function(e,t){var i=this.funcData[e].buttons,a=!1;return Ext.each(i,function(e){e&&-1!=t.indexOf(e.ref)&&(a=!0)}),a},coreFuncPrem:function(e){var t=!1;return e&&(t="1"==JE.systemConfig.SY_JECORE&&e.info.JECore),t},getUSPremData:function(e,t,i){var a;if("FUNC"==e){if(a=JE.staticCacheFunc[t],JE.isEmpty(a)&&(a=JE.staticCacheFunc[t]=JE.ajax({url:JE.getUrlMaps("je.core.staticize.loadStaticize"),params:{type:e,funcCode:t}})),JE.isNotEmpty(a))return Ext.clone(a)}else{var n="0";i&&(n="1");var o=JE.staticCacheFunc[t],r=o?o.info.funcId:"";a=JE.ajax({url:JE.getUrlMaps("je.core.staticize.loadStaticize"),params:{type:e,funcCode:t,funcId:r,refresh:n}})}return a},funcDataPerm:function(d,e){var c=JE.CoreUtil.getUSPremData("FUNCPERM",d.info.funcCode,e);if(this.buildDataPerm(d,c),c&&JE.isNotEmpty(c.querySql)&&(c.sqlOverwrite?d.info.whereSql=c.querySql:d.info.whereSql+=" "+c.querySql,Ext.isEmpty(d.info.whereSql)||(d.info.whereSql=JE.DB.formatSql(d.info.whereSql))),JE.isNotEmpty(d.info.permSql)&&(d.info.whereSql+=" "+d.info.permSql),d.info.whereSql=JE.DB.formatSql(d.info.whereSql),!JE.isEmpty(c)){var l=[],s=[];Ext.iterate(d.dicInfo,function(e,t){var i=c.dicInfos[t];if(i&&i.sqlQuery&&!i.allItem&&JE.isNotEmpty(i.itemIds)&&-1==s.indexOf(t)){s.push(t);var a=i.itemIds,n=[],o=JE.getDicItems(t);Ext.each(o,function(e){-1!=a.indexOf(e.id)&&n.push(e.code)});var r=" and "+e+" in ('"+n.join("','")+"') ";l.push(r)}}),0<l.length&&(d.info.whereSql+=" "+l.join(" "));var u=[],p=c.fieldIds,f=c.fieldReadOnlyIds,E={},m=function(e){Ext.each(e,function(e){var t=e;"fieldcontainer"==e.xtype&&(t=e.items);var i,a=t.field_id,n=t.name;if(JE.isNotEmpty(p)&&(c.versa?-1!=p.indexOf(a)&&(i=!0):-1==p.indexOf(a)&&(i=!0),JE.isNotEmpty(i)&&(t.dataPerms=t.dataPerms||[],t.dataPerms.push("hidden"),t.hidden=i,e.hidden=i,d.basicFields[n].hidden=i,u.push(n))),JE.isNotEmpty(f)&&-1!=f.indexOf(a)&&(t.dataPerms=t.dataPerms||[],t.dataPerms.push("readonly"),t.readOnly=!0,e.readOnly=!0,d.basicFields[n].readOnly=!0),-1!=["cgroup","rgroup","cbbfield","treessfield","treessareafield"].indexOf(t.xtype)){var o,r,l=d.dicInfo[n],s=c.dicInfos[l];s&&(0!=s.allItem||Ext.isEmpty(s.itemIds)||(o=s.itemIds.join(",")),Ext.isEmpty(s.querySql)||(r=s.sqlOverwrite?s.querySql:t.whereSql+s.querySql),JE.isNotEmpty(o)&&(t.dicItemIds=o,E[n]=Ext.value(E[n],{}),E[n].dicItemIds=o),JE.isNotEmpty(r)&&(t.whereSql=r,E[n]=Ext.value(E[n],{}),E[n].whereSql=r))}"fieldset"==e.xtype&&m(e.items)})},a=function(e){var i=[];return Ext.each(e,function(e){if(-1==u.indexOf(e.dataIndex)){var t=E[e.dataIndex];t&&e.field&&(JE.isNotEmpty(t.whereSql)&&(e.field.whereSql=t.whereSql,e.editField.whereSql=t.whereSql,d.basicColumns[e.dataIndex].whereSql=t.whereSql),JE.isNotEmpty(t.dicItemIds)&&(e.field.dicItemIds=t.dicItemIds,e.editField.dicItemIds=t.dicItemIds,d.basicColumns[e.dataIndex].dicItemIds=t.dicItemIds)),JE.isNotEmpty(f)&&e.field&&-1!=f.indexOf(e.field.field_id)&&(e.field.readOnly=!0,e.editField.readOnly=!0),e.columns=a(e.columns),JE.isEmpty(e.columns)&&delete e.columns,i.push(e)}}),i};if(JE.isNotEmpty(c.dicInfos)||!c.all||JE.isNotEmpty(f)){m(d.form.fields);var t={groupQuery:[],treeQuery:[],quickQuery:[]};Ext.iterate(t,function(a,n){Ext.each(d.grid[a],function(e){var t=e["treeQuery"==a?"field":"name"];if(-1==u.indexOf(t)){var i=E[t];i&&(JE.isNotEmpty(i.dicItemIds)&&(e.whereSql+=" and JE_CORE_DICTIONARYITEM_ID in ('"+i.dicItemIds.replaceAll(",","','")+"') "),JE.isNotEmpty(i.whereSql)&&(e.whereSql+=i.whereSql)),n.push(e)}})}),Ext.apply(d.grid,t),d.grid.columns=a(d.grid.columns)}var i=c.childrenIds,n=[];d.child=Ext.value(d.child,[]),d.childObj=Ext.value(d.childObj,{});var o=[],r={},g=d.child.concat(Ext.value(d.childObj[5],[])),h=d.childObj.fields;Ext.each(g,function(e){if(-1!=i.indexOf(e.id)){var t=e.showType;r[t]||(r[t]=[]),r[t].push(e),"5"!=t&&(o.push(e),n.push(e.viewId))}}),r.fields=h,d.child=o,d.childObj=r;var x=c.buttonIds;Ext.iterate({"form.buttons":[],"grid.buttons":[],"grid.actions":[]},function(e,t){var i=d[e.split(".")[0]][e.split(".")[1]];Ext.each(i,function(e){-1!=x.indexOf(e.button_id)&&t.push(e)}),d[e.split(".")[0]][e.split(".")[1]]=t});var v=function(e){Ext.each(e,function(e){if("actioncolumn"==e.xtype)return e.items=d.grid.actions,!1;v(e.columns)})};if(v(d.grid.columns),0<u.length||0<n.length){var y=[];Ext.each(d.form.locateButtons,function(e){-1==("child"==e.type?n:u).indexOf(e.code)&&y.push(e)}),d.form.locateButtons=y}}},buildDataPerm:function(e,t){var n={useCjgls:t.useCjgIds,seeUsers:t.seeUserIds,seeDepts:t.seeDeptIds,seeRoles:t.seeRoleIds,seeSentrys:t.seeSentryIds,seePermSql:t.permSql,otherPerm:t.permConfig,userField:t.userField,deptField:t.deptField,permJs:t.permJs},o="SY_CREATEUSERID",r="SY_CREATEORGID",l=(n=Ext.value(n,{}),[]);if(JE.isNotEmpty(n.userField)&&(o=n.userField),JE.isNotEmpty(n.deptField)&&(r=n.deptField),n.otherPerm=Ext.value(n.otherPerm,[]),e.permInfo.permSql="",e.permInfo.selfUpdate=-1!=n.otherPerm.indexOf("SELF_UPDATE"),e.permInfo.selfDelete=-1!=n.otherPerm.indexOf("SELF_DELETE",""),e.permInfo.userField=n.userField,e.permInfo.deptField=n.deptField,JE.isNotEmpty(n.seePermSql)&&l.push(" (1=1 "+n.seePermSql+" ) "),JE.isNotEmpty(n.permJs)&&JE.isNotEmpty(JE.eval(n.permJs)())){var i=JE.eval(n.permJs);JE.isNotEmpty(i)&&l.push(" (1=1 "+i()+" ) ")}if(JE.isNotEmpty(n.useCjgls)&&!0,JE.isNotEmpty(n.seeUsers)&&-1!=n.seeUsers.indexOf(JE.currentUser.userId))l.push(" 1=1 ");else if(JE.isNotEmpty(n.seeDepts)&&-1!=n.seeDepts.indexOf(JE.currentUser.deptId))l.push(" 1=1 ");else{if(JE.isNotEmpty(n.seeRoles)){var a=!1;if(Ext.each(JE.currentUser.roles,function(t){if(Ext.each(n.seeRoles,function(e){if(!JE.isEmpty(e))return JE.isNotEmpty(t.baseRoleId)&&t.baseRoleId==e||t.roleId==e?!(a=!0):void 0}),a)return!1}),a)return void l.push(" 1=1 ")}if(JE.isNotEmpty(n.seeSentrys)){a=!1;if(Ext.each(JE.currentUser.sentrys,function(t){if(Ext.each(n.seeSentrys,function(e){if(!JE.isEmpty(e))return t.sentryId==e?!(a=!0):void 0}),a)return!1}),a)return void l.push(" 1=1 ")}JE.isNotEmpty(n.otherPerm)&&Ext.each(n.otherPerm,function(e){var t="";switch(e){case"SELF_CREATE":t=" "+o+" = '{@USER_ID@}'";break;case"LEAD_DEPT":var i=JE.currentUser.branchInfo.zgUserIds;JE.isNotEmpty(i)&&(t=" "+o+" IN ('"+i.join("','")+"') ");break;case"SELF_ZSDEPT":i=JE.currentUser.branchInfo.zsUserIds;JE.isNotEmpty(i)&&(t=" "+o+" IN ('"+i.join("','")+"') ");break;case"SELF_FZRDEPT":i=JE.currentUser.branchInfo.fzrUserIds;JE.isNotEmpty(i)&&(t=" "+o+" IN ('"+i.join("','")+"') ");break;case"MONITOR_DEPT":i=JE.currentUser.branchInfo.jgUserIds;JE.isNotEmpty(i)&&(t=" "+o+" IN ('"+i.join("','")+"') ");break;case"SELF_DEPT":t=" "+r+" ='{@DEPT_ID@}' ";break;case"WF_PREAPPROV":t=" SY_PREAPPROVUSERS like '%{@USER_ID@}%'";break;case"WF_APPROVED":t=" SY_APPROVEDUSERS like '%{@USER_ID@}%'";break;case"SELF_COMPANY":l.push(" SY_JTGSID = '{@USER_JTGSID@}'");break;case"MONITOR_COMPANY":var a=JE.ajax({url:JE.getUrlMaps("je.core.develop.funcPerm","getFuncYwcjPerm"),params:{ywcjId:n.useCjgls,type:"JTGS"}}).obj;JE.isNotEmpty(a)&&l.push(a);break;case"MONITOR_COMPANY_DEPT":a=JE.ajax({url:JE.getUrlMaps("je.core.develop.funcPerm","getFuncYwcjPerm"),params:{ywcjId:n.useCjgls,type:"DEPT"}}).obj;JE.isNotEmpty(a)&&l.push(a)}Ext.isEmpty(t)||l.push(t)}),Ext.isEmpty(l)&&Ext.isEmpty([])||(Ext.isEmpty(l)||(e.permInfo.permSql+=" and ("+l.join(" or ")+")"),e.info.permSql=e.permInfo.permSql)}},staticFuncData:function(e,i,a,n){var t=e;delete JE.cacheFunc[t],delete JE.staticCacheFunc[t];var o=JE.CoreUtil.lang_static_funcData(e,n);JE.staticCacheFunc[t]=o;var r=!1;return Ext.each(o.grid.buttons,function(e){e&&"gridEditBtn"==e.ref&&(r=!0)}),r&&Ext.each(o.form.childFuncFields,function(e){var t,i=o.basicFields[e].configInfo.split(",")[0];JE.isNotEmpty(i)&&(a||(t=JE.CoreUtil.getUSPremData("FUNC",i)),JE.isEmpty(t)&&JE.CoreUtil.staticFuncData(i,!1,a,n))}),i&&Ext.each(o.child,function(e){var t;-1!=["func","tree"].indexOf(e.type)&&JE.isNotEmpty(e.code)&&(a||(t=JE.CoreUtil.getUSPremData("FUNC",e.code)),JE.isEmpty(t)&&JE.CoreUtil.staticFuncData(e.code,i,a,n))}),o},initUSInfo:function(){JE.userStaticData={MENU:"",FUNC:{},PERM:{}}}}),Ext.define("JE.core.util.PortalUtil",{buildPortal:function(e){var t=e.PROTAL_DATA,i=(t=Ext.isObject(t)?t:Ext.decode(t),e.PROTAL_ZXFW);JE.loadModelFields(t.tables);var a=this.buildPortalData(t);return a.ref="__portalview",delete a.margin,delete a.bodyPadding,0<(i=Number(Ext.value(i,"0")))?(a.layout="anchor",a.autoScroll=!0,a.items[0].minWidth=i):a.items[0].autoScroll=!0,Ext.each(a.items[0].items,function(e){e.portalBK||"5"!=e.margin||delete e.margin}),"plus"==JE.getTheme()&&JE.isNotEmpty(e.PROTAL_BGCOLOR)&&(a.bodyStyle="background-color:"+e.PROTAL_BGCOLOR),a},buildPortalData:function(a){var n=this,o={},r=n.formatStyleData(a.styleData);if("kj"==a.type){o={xtype:"panel",border:0,items:[],cls:"je-portal-panel-kj",layout:{type:"hbox",align:"stretch"}};var l=r.layoutWidth;Ext.each(a.items,function(e,t){var i={xtype:"panel",layout:"column",cls:"je-portal-panel-kj",border:0,defaults:{columnWidth:1},flex:e.flex,items:[]};0<l.length&&0<Number(l[t])&&(delete i.flex,i.width=Number(l[t])),"TAB"==r.layout[t]&&(i.xtype="tabpanel",delete i.layout,delete i.defaults,delete i.border),Ext.each(e.items,function(e){var t=n.buildPortalData(e);i.items.push(t)}),t==a.items.length-1&&delete i.bodyStyle,o.items.push(i)}),0<r.height&&(o.height=r.height)}else{a.configData;(o=n.buildFuncBK(a)).height=0<r.height?r.height:200}return o.margin=r.margin,o.bodyPadding=r.padding,a.tabLayout?(Ext.isEmpty(r.titleText)||(o.title=r.titleText),Ext.isEmpty(r.iconCls)||(o.iconCls=r.iconCls),o.border=0,delete o.margin):(o.bodyStyle=Ext.value(o.bodyStyle,""),JE.isNotEmpty(r.borderColor)&&(o.border=1,o.bodyStyle+="border-color:"+r.borderColor+";"),JE.isNotEmpty(r.bodyBgColor)&&(o.bodyStyle+="background-color:"+r.bodyBgColor+";"),"bk"==a.type&&(o.cls="je-portal-panel","plus"==JE.getTheme()&&JE.isNotEmpty(r.topBorderColor)&&(o.style="border-top-color:"+r.topBorderColor+";"),"ICON"==o.type&&(o.style="border-width:0px;",o.border=0,o.title="")),Ext.isEmpty(r.title)?delete o.dockedItems:(o.border=1,o.dockedItems=Ext.value(o.dockedItems,{xtype:"toolbar",items:[]}),o.dockedItems.cls="je-portal-title",o.dockedItems.style=Ext.value(o.dockedItems.style,""),JE.isNotEmpty(r.bgColor)&&(o.dockedItems.style+="background-color:"+r.bgColor+";"),JE.isNotEmpty(r.borderColor)&&(o.dockedItems.style+="border-color:"+r.borderColor+";"),o.dockedItems.items.unshift({xtype:"box",cls:"je-portal-title-text",style:JE.isEmpty(r.color)?"":"color:"+r.color,html:r.icon+r.titleText}),n.buildBKButtons(o,a))),o},buildBKButtons:function(n,e){n.dockedItems.items.push("->");var t=Ext.value(e.extendData,{}),o=e.styleData,r=e.configData,i=Ext.decode(Ext.value(t.buttons,"[]"));Ext.each(i,function(e){if("1"!=e.disabled){var t={listeners:{}};"更多"==e.defEvent?n.funcCode?t.listeners.click=function(){JE.showFunc(n.funcCode,{readOnly:"1"!=r.editableFunc})}:n.portalItems&&(e.iconCls=Ext.value(e.iconCls,"jeicon jeicon-pop-up"),e.fontIconCls=Ext.value(e.fontIconCls,"fa fa-window-restore"),t.listeners.click=function(){JE.win({title:o.titleText,iconCls:o.iconCls,items:n.portalItems}).show()}):"刷新"==e.defEvent&&"DATA"==r.type&&(e.iconCls=Ext.value(e.iconCls,"jeicon jeicon-refresh"),e.fontIconCls=Ext.value(e.fontIconCls,"fa fa-refresh"),t.listeners.click=function(e){e.up("panel[portalBK]").down("grid").store.load()});var i=JE.CoreUtil.lang_portal_config("button",e);e.iconCls=JE.getIconCls(e),Ext.isEmpty(e.iconCls)?(t.text=i,t.textStyle="text-decoration:underline;",JE.isNotEmpty(e.color)&&(t.textStyle+="color:"+e.color+";")):(t.iconCls=JE.getIconCls(e),JE.isNotEmpty(e.fontIconCls)&&(t.iconCls+=" fonticon"),t.tooltip=i,JE.isNotEmpty(e.color)&&(t.iconStyle="color:"+e.color+";"));var a=Ext.decode(Ext.value(e.events,"[]"));Ext.each(a,function(e){"1"==e.fire&&(t.listeners[e.code]=JE.eval(e.newfunc))}),n.dockedItems.items.push(t)}})},buildFuncBK:function(e){var t=this,i=Ext.clone(e.configData),a=e.styleData,n=Ext.value(e.extendData,{}),o={xtype:"panel",layout:"fit",border:"1"==a.border?0:1,ref:a.code,portalBK:!0,cls:"je-portal-panel-kj",getPortalBK:function(e){var t=this.up("panel[ref=__portalview]");if(t){var i=t.down("panel[portalBK][ref="+e+"]");if(i&&0<i.items.getCount()){var a=i.items.get(0);return"DATA"==i.type&&(a=a.getCmp("grid")),a}}}};switch(JE.isNotEmpty(n.listeners)&&(o.listeners=JE.eval(n.listeners)),i.type){case"DATA":if(Ext.isEmpty(i.funcCode))o.html="没有功能信息，请重新选择",delete o.cls;else{var r=t.buildDataView(i);o.items=r,o.funcCode=i.funcCode,o.hideMore="1"==i.hideMore}break;case"APP":o.items=t.buildAppView(i);break;case"HTML":o.items=t.buildHtmlView(i);break;case"LINK":o.items=t.buildLinkView(i);break;case"WEATHER":o.items=t.buildWeatherView(i);break;case"NEWS":o.items=t.buildNewsView(i),o.funcCode="JE_CORE_IMGNEW";break;case"CLOCK":o.items=t.buildClockView(i);break;case"CALENDAR":o.items=t.buildCalendarView(i);break;case"CHART":o.items=t.buildChartView(i);break;case"REPORT":o.items=t.buildReportView(i);break;case"DAOHANG":o.items=t.buildDaoHangView(i);break;case"CODE":o.items=t.buildCodeView(i);break;case"ICON":var l=Ext.decode(Ext.value(n.buttons,"[]"));o.items=t.buildIconView(i,l);break;default:o.html=i.type,delete o.cls}if(o.type=i.type,o.items){o.portalItems=o.items,delete o.items,o.listeners=Ext.value(o.listeners,{});var s=o.listeners.afterrender;o.listeners.afterrender=function(e){Ext.defer(function(){e.add(e.portalItems),s&&s(e)},100)}}return o},buildIconView:function(e,t){var a=Ext.clone(e),i={xtype:"box"},n={iconCls:Ext.value(a.iconCls,"fa fa-image"),style:"",iconStyle:""};if(0<a.innerPadding&&(n.style+="padding:"+a.innerPadding+"px;"),JE.isNotEmpty(a.bgColor)&&(n.style+="background-color:"+a.bgColor+";"),JE.isNotEmpty(a.iconAlign)&&(n.iconStyle+="text-align:"+a.iconAlign+";"),JE.isNotEmpty(a.iconVAlign)&&(n.iconStyle+="vertical-align:"+a.iconVAlign+";"),JE.isNotEmpty(a.iconColor)&&(n.iconStyle+="color:"+a.iconColor+";"),JE.isNotEmpty(a.iconSize)&&(n.iconStyle+="font-size:"+a.iconSize+"px;"),JE.isNotEmpty(a.tplFn)){a.tplFn=JE.eval(a.tplFn);var o=[];JE.isNotEmpty(a.dsCode)&&(a.ds=JE.getChartDS(a.dsCode),o=a.ds.load()),n.html=a.tplFn(o)}var r=[];return a.buttons={},Ext.each(t,function(e){if("1"!=e.disabled){var t={iconCls:Ext.value(e.fontIconCls,e.iconCls),code:e.name};if("刷新"==e.defEvent)t.iconCls=Ext.value(t.iconCls,"fa fa-refresh"),t.fn=function(e){var t=e.configInfo.tplFn;if(JE.isNotEmpty(t)&&Ext.isFunction(t)){var i=[];e.configInfo.ds&&(i=e.configInfo.ds.load());var a=t(i);e.getEl().down(".inner-box").update(a),JE.msg("刷新完成！")}};else{var i=Ext.decode(Ext.value(e.events,"[]"));Ext.each(i,function(e){"1"==e.fire&&"click"==e.code&&(t.fn=JE.eval(e.newfunc))})}r.push(t),a.buttons[t.code]=t.fn}}),n.buttons=r,JE.isNotEmpty(r)&&(i.listeners={afterrender:function(n){n.getEl().on("click",function(e){var t=e.getTarget(".button",1,!0);if(t){var i=t.getAttribute("data-code"),a=n.configInfo.buttons[i];a&&a(n)}})}}),i.configInfo=a,i.tpl=['<div class="je-portal-iconview" style="{style}">','<div class="inner-box">{html}</div>','<div class="icon">','<i class="{iconCls}" style="{iconStyle}"></i>',"</div>",'<div class="buttons">','<tpl for="buttons">','<i class="{iconCls} button" data-code="{code}"></i>',"</tpl>","</div>","</div>"],i.data=n,i},buildCodeView:function(e){var t={xtype:"panel",border:0,html:"无内容"};if(!Ext.isEmpty(e.code)){var i=JE.eval(e.code);i&&(t=i())}return t},buildDaoHangView:function(e){var t={xtype:"panel",layout:"fit",border:0},i=JE.ajax({url:JE.getUrlMaps("je.core.getInfoById"),params:{tableCode:"JE_CORE_PROTAL",pkValue:e.id}});return i&&!Ext.isEmpty(i.PROTAL_DATA)&&(t=Ext.apply(t,{xtype:"portal.menuview",layout:"fit",border:0,infoData:i.PROTAL_DATA})),t},buildChartView:function(e){var t=Ext.decode(Ext.value(e.attrs,"[]")),i={};Ext.each(t,function(e){i[e.code]=e.value});var a=Ext.decode(Ext.value(e.params,"[]")),n={};Ext.each(a,function(e){n[e.code]=e.value});var o="1"==e.hideSearchBar||void 0,r={xtype:"jechartview",boxBorder:"1"==e.hideBorder?0:1,searchBorder:"1"==e.hideBorder?0:1,chartCode:e.code,hideSearchBar:o,chartAttrs:i,chartParams:n};return Ext.isEmpty(e.code)&&(r.xtype="panel",r.html="统计图没有配置图表编码，无法显示！"),r},buildReportView:function(e){var t=Ext.decode(Ext.value(e.params,"[]")),i={};Ext.each(t,function(e){i[e.code]=e.value});var a="1"==e.hideSearchBar||void 0,n={xtype:"jereportview",boxBorder:"1"==e.hideBorder?0:1,reportCode:e.code,hideSearchBar:a,reportParams:i};return Ext.isEmpty(e.code)&&(n.xtype="panel",n.html="报表没有配置报表编码，无法显示！"),n},buildCalendarView:function(e){return{xtype:"1"==e.useNew?"uxcalendarmini":"uxcalendar",useDayinfo:"1"==e.useDayinfo,minCalendar:"1"==e.minCalendar}},buildClockView:function(e){JE.isEmpty(e.theam)&&(e.theam="时钟9.swf");var t='<embed wmode="transparent" src="'+JE.getStaticUrl("JE.core.util.PortalUtil."+e.theam.replace(".swf",""),"swf")+'" width="100%" height="100%"></embed>';return Ext.isEmpty(e.theam)&&(t="无时钟"),{xtype:"box",style:"background-color:#fff;",html:t}},buildNewsView:function(e){var t="";"1"==JE.systemConfig.JE_SYSMODE&&(t=" AND SY_JTGSID='"+JE.currentUser.jtgsId+"'",JE.currentUser.saas&&(t=""));var i=JE.ajax({url:JE.getUrlMaps("je.core.load"),params:{tableCode:"JE_CORE_IMGNEW",orderSql:"order by SY_ORDERINDEX",whereSql:" and IMGNEW_YESORNO_CODE = '1' AND IMGNEW_NEWSTYPE_CODE='PC' "+t,limit:-1}}),a=[],n="cube,cubeRandom,block,cubeStop,cubeHide,cubeSize,horizontal,showBars,showBarsRandom,tube,fade,fadeFour,paralell,blind,blindHeight,blindWidth,directionTop,directionBottom,directionRight,directionLeft,cubeStopRandom,cubeSpread,cubeJelly,glassCube,glassBlock,circles,circlesInside,circlesRotate,cubeShow,upBars,downBars,hideBars,swapBars,swapBarsBack,swapBlocks,cut,random,randomSmart".split(",");return Ext.each(i.rows,function(e){a.push({src:e.IMGNEW_TP.split("*")[1],label:e.IMGNEW_MS,cls:n[JE.random(n.length)-1]})}),{xtype:"box",style:"background-color:#fff;width:100%;",data:a,tpl:['<div class="box_skitter box_skitter_large" style="margin:0; padding: 0; list-style: none;width:100%;">',"<ul>",'<tpl for=".">','<li><a href="{src}" target="_black"><img src="{src}" class="{cls}" /></a><div class="label_text"><p>{label}</p></div></li>',"</tpl>","</ul>","</div>"],listeners:{beforerender:function(){JE.loadScript(["/static/ux/SkitterSlideshow/js/jquery.easing.1.3.js","/static/ux/SkitterSlideshow/js/jquery.skitter.js"])},afterrender:function(i){0<a.length?JE.loadScript("/static/ux/SkitterSlideshow/css/skitter.styles.css",function(){var e=i.el.down(".box_skitter_large",!0),t=i.ownerCt.getHeight()-2;i.ownerCt.getWidth();jQuery(e).css("height",t).skitter({theme:"clean",dots:!0,preview:!0,label:!1,hideTools:!0,numbers_align:"center"})}):i.update("<p>图片新闻数据为空，无法显示，请及时维护数据。</p>")}}}},buildWeatherView:function(e){var t=e;delete t.type;var i="http://tianqi.2345.com/plugin/widget/index.htm?s=2&z=1&t=1&v=0&d=3&bd=0&k=&f=&ltf=009944&htf=cc0000&q=1&e=1&a=1&c=54511&w=565&h=98&align=center",a='<iframe allowtransparency="true" frameborder="0" width="100%" height="100%" scrolling="auto" src="{src}"></iframe>';Ext.apply(t,{q:1,e:1,a:1});var n="";return Ext.iterate(t,function(e,t){n+="&"+e+"="+t}),i+=n="?"+n.substring(1),{xtype:"box",style:"background-color:#fff;",html:a=a.replace("{src}",i)}},buildAppView:function(e){return Ext.isEmpty(e.ctr)||Ext.each(e.ctr.split(","),function(e){JE.initCtr(e)}),{xtype:JE.getXTypeByClassName(e.mainview),border:0}},buildHtmlView:function(e){var t={};if(!Ext.isEmpty(e.action)){var i=Ext.decode(Ext.value(e.params,"{}"));Ext.iterate(i,function(e,t){i[e]=JE.toDefVal(t)}),t=JE.ajax({url:e.action,params:i})}return{xtype:"box",autoScroll:!0,tpl:e.htmlTpl,style:"background-color:#fff;",data:t}},buildLinkView:function(e){var i="";return Ext.isEmpty(e.params)||(Ext.iterate(Ext.decode(e.params),function(e,t){i+="&"+e+"="+JE.toDefVal(t)}),i="?"+i.substring(1)),{xtype:"box",style:"background-color:#fff;",html:'<iframe scrolling="auto" frameborder="0" width="100%" height="100%" src='+(e.iframe+i)+" name="+e.name+"></iframe>"}},buildDataView:function(l){var e={tableName:l.tableName,autoLoad:!0,id:l.pkName,pageSize:Number(Ext.value(l.pageSize,"0")),sqls:{basic:JE.toXT(l.whereSql),order:Ext.value(l.orderSql,"")}};e.params={whereSql:e.sqls.basic,orderSql:e.sqls.order},JE.isNotEmpty(l.dataUrl)&&(l.dataUrl=JE.replaceOldUrl(l.dataUrl),e.url=l.dataUrl),"1"!=l.usePage&&(e.params.limit=0<e.pageSize?e.pageSize:-1);var s={xtype:"grid",border:0,columnLines:!0,autoScroll:!0,cls:"je-field-grid",hideHeaders:"1"==l.hideHeader,columns:{defaults:{sortable:!1,align:"center",menuDisabled:!0},items:[]},store:JE.getStore(e)};"1"!=l.stripeRows&&(s.viewConfig={stripeRows:!1,selectedItemCls:"",beforeSelectedItemCls:"",selectedCellCls:"",focusedItemCls:"",beforeFocusedItemCls:"",tableFocusedFirstCls:"",tableSelectedFirstCls:"",tableOverFirstCls:"",overItemCls:"",beforeOverItemCls:""}),s.viewConfig=s.viewConfig||{},s.viewConfig.loadMask=!1,s.hideHeaders&&(s.bodyStyle="border-top-width:0px;"),"1"==l.usePage&&(s.bbar={xtype:"uxpagingtoolbar",store:s.store,displayInfo:!1,style:"background-color:#fff;",pageNum:!0}),"1"==l.useRowNum&&s.columns.items.push({xtype:"rownumberer",text:"No.",width:30,align:"center",tdCls:Ext.baseCSSPrefix+"grid-cell-row-numberer "+Ext.baseCSSPrefix+"grid-cell-special je-grid-td-middle"});var t=Ext.isArray(l.fields)?l.fields:Ext.decode(l.fields),d=[],c=[];if(Ext.each(t,function(e){if(JE.CoreUtil.lang_portal_config("column",e),c.push(e.code),"1"!=e.hidden){var t=Ext.value(e.modelData,{}),i={basicXtype:t.RESOURCEFIELD_XTYPE,configInfo:t.RESOURCEFIELD_CONFIGINFO},a={dataIndex:e.code,text:e.name,align:Ext.value(t.RESOURCECOLUMN_ALIGN,"center"),columnTip:JE.toBool(t.RESOURCECOLUMN_COLUMNTIP),dateFormat:t.RESOURCECOLUMN_DATEFORMAT,enableIcon:JE.toBool(t.RESOURCECOLUMN_ENABLEICON),multiRows:JE.toBool(t.RESOURCECOLUMN_MULTIROWS),link:JE.toBool(t.RESOURCECOLUMN_HYPERLINK),linkAction:t.RESOURCECOLUMN_LINKMETHOD,dicColor:t.RESOURCECOLUMN_COLOR2,merge:JE.toBool(t.RESOURCECOLUMN_MERGE),tdCls:"je-grid-td-middle",titleStyle:"width:100%;height:16px;",rightBorderColor:l.rightBorderColor,bottomBorderColor:l.bottomBorderColor};if(a.merge&&d.push(a.dataIndex),Ext.isEmpty(e.width)||0==Number(e.width)?a.flex=1:a.width=Number(e.width),Ext.isEmpty(a.renderer)){a.renderer=JE.renderer;var n=JE.buildRendererTactics(i,a);a.tactics=n}else a.renderer=JE.eval(a.renderer);if(!Ext.isEmpty(e.events)){var o={},r=Ext.isArray(e.events)?e.events:Ext.decode(e.events);Ext.each(r,function(e){Ext.isEmpty(e.newfunc)||1!=e.fire||(o[e.code]=JE.eval(e.newfunc,"portal数据表格列("+a.text+")自定义js事件出错！"))}),Ext.isEmpty(o.renderer)||(a.renderer=o.renderer,delete o.renderer),Ext.Object.isEmpty(o)||(a.listeners=o)}s.columns.items.push(a)}}),-1==c.indexOf(l.pkName)&&JE.isNotEmpty(l.pkName)&&c.push(l.pkName),s.store.proxy.extraParams.queryColumns=c.join(","),"form"==l.dblclick)s.listeners={itemdblclick:function(e,t){e.panel;var i=JE.ajax({url:JE.getUrlMaps("je.core.getInfoById"),params:{tableCode:l.tableName,pkValue:t.get(l.pkName)}});JE.showFunc(l.funcCode,{type:"form",values:i,readOnly:"1"!=l.editableFunc})}};else if("idit"==l.dblclick){s.listeners={};var i=Ext.decode(l.listeners);Ext.each(i,function(e){if(!Ext.isEmpty(e.newfunc)&&1==e.fire)return s.listeners[e.code]=JE.eval(e.newfunc,"portal数据表格自定义js事件出错！"),!1})}0<d.length&&(s.store.merges=d,s.store.on("loadrecords",function(e,t){var i=JE.CoreUtil.buildMergesInfo(e.merges,t);Ext.apply(e,i)})),s.load=function(e){(e=Ext.value(e,{})).whereSql=s.store.sqls.basic+" "+Ext.value(e.whereSql,""),e.orderSql=Ext.value(e.orderSql,s.store.sqls.order),Ext.apply(s.store.proxy.extraParams,e),s.store.loadPage(1)},s.region="center",s.itemId="grid";var a={xtype:"panel",border:0,layout:"border",items:[s]};if(JE.isNotEmpty(l.treeQuery)){var n={xtype:"jetreeview",region:"west",border:0,frame:!1,type:"func",itemId:"tree",split:!0,width:Number(Ext.value(l.treeQueryWidth,150)),enableMSModel:!0,searchBar:!1,onlyItem:!0,queryItems:[{name:l.treeQuery,configInfo:l.treeQueryCfg}],listeners:{selectionchange:function(e,t,i){var a=e.view.panel,n=a.ownerCt.getCmp("grid");JE.Action.doTreeQueryGrid(a,n)}}};a.items.push(n)}return a},formatStyleData:function(e){var t=Ext.value(e.titleColor,""),i=Ext.value(e.titleBgColor,"");e.titleText=titleText=JE.CoreUtil.lang_portal_config("title",e);var a=Ext.isEmpty(titleText)?"":'<span style="font-weight:bold;color:'+t+';" >'+titleText+"</span>";e.iconCls=JE.getIconCls(e);var n=Ext.isEmpty(e.iconCls)?"":'<i class="je-icon '+e.iconCls+'" style="margin-right:5px;"></i>',o=Ext.value(e.margin,"5"),r=Ext.value(e.padding,"0");if(JE.isNotEmpty(e.height)&&!Ext.isNumeric(e.height)){var l=Ext.decode(e.height,!0);if(l){var s,d=window.screen.width+"x"+window.screen.height,c=0;Ext.each(l,function(e){if(e.code==d)return s=e.value,!1;"default"==e.code&&(c=e.value)}),e.height=s||c}}var u=Number(Ext.value(e.height,"0")),p=Ext.isEmpty(e.layoutWidth)?[]:e.layoutWidth.split(" "),f=Ext.isEmpty(e.layout)?[]:e.layout.split(":");return{titleText:titleText,iconCls:e.iconCls,title:a,color:t,bgColor:i,icon:n,margin:o,padding:r,height:u,layoutWidth:p,layout:f,topBorderColor:e.topBorderColor,borderColor:e.borderColor,bodyBgColor:e.bodyBgColor}}}),Ext.define("JE.core.util.PrintUtil",{printFunc:function(e,t){var i=JE.getLocalLang("core.util.PrintUtil"),a=t.type,n=t.lodop,o=t.print=Ext.value(t.print,"1"),r=Ext.value(t.title,"");if(JE.isEmpty(a)&&(a=JE.isNotEmpty(t.id)||JE.isNotEmpty(t.data)?"form":"list"),t.funcCode=e,"list"==a)JE.isNotEmpty(n)?htmlTpl=this.buildListFunc4Lodop(t):(htmlTpl=this.buildListFunc(t),htmlTpl=JE.encodeURI(htmlTpl),JE.openWindow("/static/ux/page/print.jsp",{htmlTpl:htmlTpl,print:o,title:r},t.winCfg));else if("form"==a){if(JE.isEmpty(t.id)&&JE.isEmpty(t.data))return void JE.alert(JE.local.lang.core.util.Util.printFuncAlert);if(htmlTpl=this.buildFormFunc(t),JE.isNotEmpty(n)){if(htmlTpl='<div class="div-box">'+htmlTpl+"</div>",LODOP=this.getLODOP(),LODOP.PRINT_INIT(i.lodopInit),LODOP.ADD_PRINT_HTM(0,0,"100%","100%",this.buildStyles().join(" ")+htmlTpl),LODOP[n]){var l=LODOP[n]();0<l&&JE.msg(JE.format(i.lodopFormEndMsg,l))}}else htmlTpl=JE.encodeURI(htmlTpl),JE.openWindow("/static/ux/page/print.jsp",{htmlTpl:htmlTpl,print:o,title:r},t.winCfg)}},printPage:function(func,printType,modelData,lodop){var me=this,localLang=JE.getLocalLang("core.util.PrintUtil"),htmlTpl=localLang.htmlTpl;if("report"==printType)htmlTpl=me.bulidReport(func),htmlTpl=JE.encodeURI(htmlTpl),JE.openWindow("/static/ux/page/print.jsp",{htmlTpl:htmlTpl});else if("list"==printType){var grid=func.grid,totalCount=0<grid.store.getCount()?Ext.value(grid.store.totalCount,0):0,recs=grid.getSelectionModel().getSelection(),msg=2500<totalCount?JE.format('</br><font color="red">{0}</font>',localLang.bigDataAlert):"";JE.dialog(localLang.printDialogMsg+msg,function(e){if("sels"==e){if(Ext.isEmpty(recs))return void JE.alert(localLang.noSelectAlert);var t=[],i=grid.funcData.info.pkName;Ext.each(recs,function(e){t.push(e.get(i))}),func.coverWhereSql=" and "+i+" in ('"+t.join("','")+"')"}else if("all"==e){var a=grid.getStoreParams();func.coverWhereSql=a.whereSql,func.coverOrderSql=a.orderSql,func.useOrderSql=Ext.value(a.useOrderSql,"")}else if("cancel"==e)return;var n={type:printType,lodop:lodop,whereSql:func.whereSql,coverWhereSql:func.coverWhereSql,coverOrderSql:func.coverOrderSql,useOrderSql:func.userOrderSql};grid.fireEvent("print",grid,n),me.printFunc(func.code,n)},localLang.printDialogTitle,{buttons:{all:JE.format(localLang.allDataText,totalCount),sels:JE.format(localLang.selectDataText,recs.length),cancel:{text:"取消"}}})}else if("form"==printType){var form=func.form,config={type:printType,lodop:lodop,data:modelData};form.fireEvent("print",form,config),form.useWF?JE.confirm(localLang.printWFLog,function(e){config.printWFLog="ok"==e,"ok"==e&&me.printFunc(func.code,config)}):me.printFunc(func.code,config)}else if("lodopPrint"==printType){var data=[];if(func.grid){var recs=func.grid.getSelectionModel().getSelection();Ext.each(recs,function(e){data.push(e.data)}),func.grid.fireEvent("print",func.grid,{data:data})}else func.form?(data.push(func.form.form.getValues()),func.form.fireEvent("print",func.form,{data:data})):func.datas&&(data=func.datas);if(JE.isEmpty(data))return void JE.alert(localLang.lodopNoData);if(LODOP=me.getLODOP(),JE.isEmpty(LODOP.VERSION))return;var print=LODOP.PRINT_INIT(localLang.lodopInit);print||LODOP.SELECT_PRINTER();var info=JE.getFuncData(func.code).info,tpl=JE.decodeURI(info.lodopConfig),init=[],page=[],initPro=["PRINT_INITA","SET_PRINT_PAGESIZE","SET_SHOW_MODE"];Ext.each(tpl.split(";"),function(t){var i=!1;Ext.each(initPro,function(e){if(-1!=t.indexOf(e))return!(i=!0)}),i?init.push(t):page.push(t)}),eval(init.join(";"));var pageStr=page.join(";"),mainData=modelData;Ext.each(data,function(d){LODOP.NewPage(),eval(JE.toXT(pageStr,d,mainData))}),-1!=info.lodopPrint.indexOf("PRINT")?(JE.msg(localLang.lodopStartMsg),LODOP.PRINT()):LODOP.PREVIEW()}},printArea:function(e){var t=['<style media="print" >.Noprint{display:none;}.PageNext{page-break-after:   always;}.NoBorder{border:none !important;}html,body{padding:0px !important;margin:0px !important;}</style>',"<style>","html,body{height:100%;margin:0px;padding:0px;}",".div-box{height:100%;}",".div-box *{font-family: tahoma, arial, verdana, sans-serif !important;font-size:12px !important;box-sizing: border-box;-moz-box-sizing: border-box;-ms-box-sizing: border-box;-webkit-box-sizing: border-box;}",".table-grid-cell-inner{text-overflow: ellipsis !important;padding: 3px 6px 4px 6px !important;border:1px solid #000 !important;}",".childFunc table tr.firstRow td {border-top: 0px !important;}",".childFunc table tr.lastRow td {border-bottom: 0px !important;}",".childFunc table tr td.firstCol {border-left: 0px !important;} ",".childFunc table tr td.lastCol {border-right: 0px !important;} ","</style>",'<link  rel="stylesheet" href="'+JE.buildCdnUrl("/static/css/je-ueditor.css")+'" />'].join(" ")+'<div class="div-box">'+e+"</div>";JE.printHtml(t)},blildPageTpl:function(){var e=['<tpl for="pages">',"{%","var formatData = {pageNum:xindex,totalNum:xcount,values:values,parent:parent};","%}",'<div style="width:{pageWidth};" class="Noprint"><h3 align="center">'+JE.getLocalLang("core.util.PrintUtil").pageTpl+"</h3></div>",'<div class="pagediv-border NoBorder" style="height:{pageHeight};width:{pageWidth};position: relative;">','<tpl if="headerTpl">','<div class="NoBorder pagebody" style="font-weight: bold;border-bottom: 1px solid #cccccc;width:100%;text-align:{headerAlign};padding:20px 20px 10px 20px;">{[this.formatData(formatData,values.headerTpl)]}</div>',"</tpl>",'<div style="width:100%;padding:0px 20px;" class="pagebody">{bodyTpl}</div>','<tpl if="fotterTpl">','<div class="NoBorder pagebody" style="font-weight: bold;border-top: 1px solid #cccccc;width:100%;position: absolute;bottom: 0px;padding:10px 20px 20px 20px;text-align:{fotterAlign};">{[this.formatData(formatData,values.fotterTpl)]}</div>',"</tpl>","</div>",'<tpl if="xindex &lt; xcount">','<div class="PageNext"></div>',"</tpl>","</tpl>",{formatData:function(e,t){return t=(t=Ext.value(t,"")).replaceAll("{pageNum}",e.pageNum).replaceAll("{totalNum}",e.totalNum)}}];return new Ext.XTemplate(e)},blildChildPageTpl:function(){return new Ext.XTemplate(['<tpl for="pages">',"{%","var formatData = {pageNum:xindex,totalNum:xcount,values:values,parent:parent};","%}","<div>",'<tpl if="headerTpl">','<div style="font-weight: bold;border-bottom: 1px solid #000;width:100%;text-align:{headerAlign};padding:10px 0px;">{[this.formatData(formatData,values.headerTpl)]}</div>',"</tpl>",'<div class="childFunc" style="width:100%;">{bodyTpl}</div>','<tpl if="fotterTpl">','<div style="font-weight: bold;border-top: 1px solid #000;width:100%;padding:10px 0px;text-align:{fotterAlign};">{[this.formatData(formatData,values.fotterTpl)]}</div>',"</tpl>","</div>","</tpl>",{formatData:function(e,t){return t=t.replaceAll("{pageNum}",e.pageNum).replaceAll("{totalNum}",e.totalNum)}}])},bulidReport:function(t){var e=t.pages,i=[];return t.pageWidth="210"==t.pageWidth?"200":t.pageWidth,t.pageHeight="210"==t.pageHeight?"200":t.pageHeight,Ext.each(e,function(e){i.push({bodyTpl:e.bodyTpl,pageWidth:t.pageWidth+"mm",pageHeight:t.pageHeight+"mm"})}),this.blildPageTpl().apply({pages:i})},buildListFunc:function(e){var t={},i=[],a=e.funcCode,n=e.childFunc,o=JE.getFuncData(a);if(!o.info.gridEnablePrint)return JE.getLocalLang("core.util.PrintUtil").noPrintInfo;var r=o.info.gridPrintInfo,l=this.buildListTpl(e),s=Ext.clone(l);s.splice(1,1,r.columnsTpl),s=new Ext.XTemplate(s),l=new Ext.XTemplate(l);for(var d=r.pageSize,c=1,u=0;u<c;u++){n&&(d=-(c=1));var p=this.buildListData(e,d,u+1);if(0==u){var f=p.totalCount%d;c=(p.totalCount-f)/d+(0<f?1:0)}t[a]=p;var E="";E=!r.autoHeader&&0<u?l.apply(t):s.apply(t),i.push({bodyTpl:E,headerTpl:r.header,headerAlign:r.headerAlign,fotterTpl:r.fotter,fotterAlign:r.fotterAlign,pageWidth:r.pageWidth+"mm",pageHeight:r.pageHeight+"mm",pageSize:p.rows.length})}return(n?this.blildChildPageTpl():this.blildPageTpl()).apply({pages:i})},buildListField:function(e,t){var i=this.buildChildCfg(e,t),a=JE.getFuncData(i.funcCode),n=function(e){var t=[];return Ext.each(e,function(e){JE.isEmpty(e.columns)&&!e.hidden?t.push(e):t=t.concat(n(e.columns))}),t},o=n(a.grid.columns),r=0,l=[],s=[];Ext.each(o,function(e){var t='<th class="table-grid-cell-inner " style="border-top: 1px solid #000000;"  align='+Ext.value(e.align,"left")+" valign="+Ext.value(e.valign,"middle")+' width="'+e.width+'">'+e.text+"</th>",i='<td class="table-grid-cell-inner "  align='+Ext.value(e.align,"left")+" valign="+Ext.value(e.valign,"middle")+">{"+("rownumberer"==e.xtype?"rownumberer":e.dataIndex)+"}</td>";l.push(t),s.push(i),r+=e.width});var d='<tr style="line-height:22px;">'+l.join("")+"</tr>",c='<tr style="line-height:22px;">'+s.join("")+"</tr>",u=[d],p=this.buildListData(i);Ext.each(p.rows,function(e,t){e.rownumberer=t+1,u.push(JE.toXT(c,e))});var f=['<table align="center" width="'+r+'" style="border-collapse: collapse;table-layout: fixed;" cellspacing=0 cellpadding=0>',u.join(""),"</table>"];return JE.isEmpty(p.rows)?"":f.join("")},buildListData:function(e,t,i){var o=this,a=e.funcCode,n=e.whereSql,r=e.coverWhereSql,l=e.coverOrderSql,s=e.useOrderSql,d=JE.getFuncData(a),c=[];if(!Ext.isEmpty(d.info.groupField)){var u=Ext.value(d.info.groupField.split("~")[0],""),p=Ext.value(d.info.groupField.split("~")[1],"ASC").toLocaleUpperCase();c.push({property:u,direction:p})}t=Ext.value(t,-1);var f=((i=Ext.value(i,1))-1)*t,E={tableCode:d.info.tableName,whereSql:d.info.whereSql,orderSql:d.info.orderSql,limit:t,page:i,start:f,sort:Ext.encode(c)};E.whereSql+=Ext.value(n,""),JE.isNotEmpty(r)&&(E.whereSql=r),JE.isNotEmpty(l)&&(E.orderSql=l),JE.isNotEmpty(s)&&(E.useOrderSql=s);var m=JE.ajax({url:JE.getUrlMaps("je.core.load"),params:E}),g=d.info.merges,h={},x={},v={};if(Ext.each(m.rows,function(r,l){var a=Ext.create(d.info.modelName,r);if(Ext.iterate(r,function(e,t){var i=d.basicColumns[e];if(i&&i.selfRenderer)try{r[e]=i.renderer(r[e],{},a)}catch(e){}else r[e]=o.formatPrintData(e,t,d)}),c[0]&&r[c[0].property]){var e=c[0].property,t=r[e];if(v[e]=Ext.value(v[e],{}),0==l)v[e][t]={start:l,end:l,name:t,rows:[t],headerTpl:d.info.groupFieldTpl};else{var i=Ext.value(m.rows[l-1][e],"").toString(),n=v[e][t];n=n||(v[e][t]={start:l,end:l,name:t,rows:[t],headerTpl:d.info.groupFieldTpl}),t==i&&(n.end++,n.rows.push(t))}}Ext.isEmpty(g)||Ext.each(g,function(e){t=(t=h[e])||(h[e]={});for(var t,i="",a="",n=[],o=0;o<=g.indexOf(e);o++)i+=Ext.value(r[g[o]],"").toString(),n.push(g[o]),0<l&&(a+=Ext.value(m.rows[l-1][g[o]],"").toString());(x[e]=n,0==l)?h[e][i]={start:l,end:l}:(t=(t=h[e][i])||(h[e][i]={start:l,end:l}),i==a&&t.end++)})}),Ext.isEmpty(g)||(m.merges=h),Ext.isEmpty(d.info.groupField)||(m.groups=v),d.info.summary){var y={},b=[],C=[],w={},S=[],I=[];Ext.each(d.grid.relColumns,function(e){var t=d.basicColumns[e];if(JE.isNotEmpty(t.summary)){var i=t.dataIndex;b.push(i),S.push(t);var a=JE.decode(t.summary),n=Ext.value(JE.decode(t.summaryFormat,!0),[]);Ext.each(a,function(e,t){C[t]=Ext.value(C[t],[]),C[t].push(e.code),I[t]=Ext.value(I[t],[]),I[t].push(n[t])})}});function T(e,t,i){e=Ext.value(e,"");e=isNaN(e)?0:e;var a=Ext.value(JE.decode(Ext.value(t,"[]"))[i],{code:"0"});return Ext.isNumeric(e)&&(e=Ext.util.Format.number(e,a.code)),e}Ext.isEmpty(d.info.groupField)||Ext.iterate(v,function(e,t){Ext.iterate(t,function(e,r){r.summaryData=[],Ext.each(S,function(i,a){for(var n=[],o=i.dataIndex,e=r.start;e<=r.end;e++)n.push(Number(m.rows[e][o]));Ext.each(C,function(e,t){r.summaryData[t]=Ext.value(r.summaryData[t],{}),r.summaryData[t][o]=T(JE.getPageSummary(n,e[a]),i.summaryFormat,t)})})})}),w=[],Ext.each(S,function(i,a){var n=[],o=i.dataIndex;Ext.each(m.rows,function(e){n.push(Number(e[o]))}),Ext.each(C,function(e,t){w[t]=Ext.value(w[t],{}),w[t][o]=T(JE.getPageSummary(n,e[a]),i.summaryFormat,t)})}),m.pageSummary=w,y=[],Ext.each(C,function(e,i){var a=JE.getAllSummary({tableCode:d.info.tableName,whereSql:n,types:e,fields:b});Ext.each(S,function(e,t){a[e.dataIndex]=T(a[e.dataIndex],e.summaryFormat,i)}),y.push(a)}),m.summary=y}return m},buildListTpl:function(e){var t=e.funcCode,i=e.childFunc,s=JE.getFuncData(t),l=s.info.gridPrintInfo,d='<tr style="line-height:'+(Ext.value(l.rowHeight,30)-8)+'px" >',c='<tr class="lastRow" style="line-height:22px" >',a="",n="",o="",r="",u="1"!=l.noFontBold?' style="font-weight: bold;" ':"";if(!Ext.isEmpty(s.info.groupField)){var p=Ext.value(s.info.groupField.split("~")[0],"");r="parent."+s.info.funcCode+".groups."+p+"[values."+p+"]",o='<tr style="line-height:22px" ><td class="table-grid-cell-inner firstCol lastCol" colspan='+l.tdDataIndex.length+u+">{[this.groupHeaderTpl("+r+")]}</td></tr>"}Ext.each(l.tdDataIndex,function(e,t){var i=e,a=s.basicColumns[i];a||i.replace("rownumberer","")==i||(a={dataIndex:i,xtype:"rownumberer",align:"center",valign:"middle"});var n="";0==t?n="firstCol":t==l.tdDataIndex.length-1&&(n="lastCol");var o='<td class="table-grid-cell-inner '+n+'"  align='+Ext.value(a.align,"left")+" valign="+Ext.value(a.valign,"middle");if(c+=o+u+">",c+='{[this.summaryTpl("'+i+'",xindex-1,{summaryArguments})]}',c+="</td>",!Ext.isEmpty(s.info.merges)&&-1!=s.info.merges.indexOf(i)){var r="parent."+s.info.funcCode+".merges."+i+"[values."+i+"]";o+='<tpl if="'+r+" && "+r+".end != "+r+'.start"><tpl if="'+r+'.start == xindex-1"> rowspan={['+r+".end-"+r+'.start+1]}<tpl else> style="display:none;"</tpl></tpl>'}o+=">","rownumberer"==a.xtype?o+="{#}":o+="{"+i+"}",d+=o+="</td>"}),c+="</tr>",d+="</tr>",s.info.summary&&(a='<tpl for="'+s.info.funcCode+'.pageSummary">'+c.replaceAll("{summaryArguments}","values")+"</tpl>",n='<tpl for="'+r+'.summaryData">'+c.replaceAll("{summaryArguments}","values")+"</tpl>",c='<tpl for="'+s.info.funcCode+'.summary">'+c.replaceAll("{summaryArguments}","values,true")+"</tpl>"),s.info.summary&&s.info.summaryAll||(c="");var f=['<tpl for="'+s.info.funcCode+'.rows">',"",d,"","</tpl>"];Ext.isEmpty(r)||(a="",f.splice(1,1,'<tpl if="'+r+'.start == xindex-1">'+o+"</tpl>"),f.splice(3,1,'<tpl if="'+r+'.end == xindex-1">'+n+"</tpl>"));var E=l.tableWidth;i&&(E="100%");var m="";return 0<l.fontSize&&(m="font-size:"+l.fontSize+"px;"),['<table align="center" width="'+E+'" style="'+m+'border-collapse: collapse;table-layout: fixed;" cellspacing=0 cellpadding=0>',"",'<tpl if="'+s.info.funcCode+'.rows.length == 0">','<tr class="lastRow" style="line-height:22px" ><td class="table-grid-cell-inner firstCol lastCol" align=center colspan='+l.tdDataIndex.length+u+">"+JE.getLocalLang("core.util.PrintUtil").noDataTpl+"</td></tr>","<tpl else>",f.join(""),a,'<tpl if="'+s.info.funcCode+".totalCount &gt; "+s.info.funcCode+'.rows.length">',c,"</tpl>",'<tr class="lastRow"></tr>',"</tpl>","</table>",{groupHeaderTpl:function(e){return new Ext.XTemplate(e.headerTpl).apply(e)},summaryTpl:function(e,t,i,a){var n="",o="",r=s.basicColumns[e];if(r&&!Ext.isEmpty(r.summary)){if(o=r.summaryMsg,n=i[e],a&&(o=Ext.value(r.summaryAllMsg,o)),Ext.isEmpty(o))return n;if(o=JE.decode(o)[t].code,summary=JE.decode(r.summary)[t].code,"msg"==summary)n=o;else if("zdy"==summary){var l=new Ext.XTemplate(o);n=JE.eval(l.apply(i))}else n=o+"："+n}return n}}]},buildChildCfg:function(e,i){var t={childFunc:!0,funcCode:e.code},a="";return Ext.each(e.fields,function(e){if(1==e.whereSql&&"no"!=e.whereType){var t={code:e.chCode,type:e.whereType,value:i[e.code]};a+=" and "+JE.DB.buildWhereSql(t)}}),t.whereSql=a,t},buildWFLogTpl:function(e){var t=JE.getFuncData(e.funcCode),i=JE.Action.buildWFLogTpl(!0).join(""),a=e.id,n=e.data,o=e.htmlTpl;if(JE.isEmpty(n)&&JE.isNotEmpty(a)&&(n=JE.ajax({url:"/je/dynaAction!getInfoById.action",params:{tableCode:t.info.tableName,pkValue:a}})),a=n[t.info.pkName],Ext.isEmpty(a)||JE.isEmpty(n.SY_AUDFLAG)||"NOSTATUS"==n.SY_AUDFLAG)o.replaceAll("{__WF_LOG__}","");else{var r=JE.ajax({url:"/jbpm/processInfoAction!loadProcessHistory.action",params:{tableCode:t.info.tableName,pkValue:a}});Ext.each(r,function(e){Ext.isEmpty(e.endTime)||(e.endTime=JE.DATE.formatDate(JE.DATE.parseDateTime(e.endTime),"n月j日 G时"))});var l=JE.toXT(i,r);o=o.replaceAll("{__WF_LOG__}",l)}return o},buildFormFunc:function(e){var n=this,t=e.funcCode,i=e.id,o=e.data,a=e.pageWidth,r=e.pageHeight,l=Ext.value(e.print,"1"),s=JE.getFuncData(t);JE.isEmpty(o)&&JE.isNotEmpty(i)&&(o=JE.ajax({url:JE.getUrlMaps("je.core.getInfoById"),params:{tableCode:s.info.tableName,pkValue:i}})),Ext.iterate(o,function(e,t){o[e]=n.formatPrintData(e,t,s,"field")});var d=210,c=297,u=Ext.value(s.info.tableFormWidth,d)+"mm",p=Ext.value(s.info.tableFormHeight,c)+"mm";0<a&&(u=a+"px"),0<r&&(p=r+"px");var f=n.buildTableTag(s),E=[],m=JE.getLocalLang("core.util.PrintUtil").noPrintInfo;if(Ext.each(["1","2","fields"],function(e){"fields"==e?Ext.iterate(s.childObj[e],function(e,t){var i="{"+e+"}";if(-1!=f.indexOf(i)){var a=n.buildListField(t,o);f=f.replaceAll(i,a)}}):Ext.each(s.childObj[e],function(e){if(-1==["idit","chart","report","file"].indexOf(e.type)&&e.enabled){var t=n.buildChildCfg(e,o),i="";i=JE.getFuncData(t.funcCode).info.gridEnablePrint?n.buildListFunc(t):m,E.push("<div style='padding: 4px;font-weight: bold;line-height: 22px;border-bottom: 1px solid #000;'>"+e.name+"</div>"),E.push(i)}})}),2==E.length)E.shift();else for(var g=0;g<E.length;g+=2){var h=E[g+1];h==m&&(h=g+2==E.length?"<div style='padding:4px;'>"+h+"</div>":"<div style='padding:4px;border-bottom: 1px solid #000;'>"+h+"</div>"),E[g+1]=h}var x=f.replace("{__child}",E.join(""));return e.printWFLog&&(e.htmlTpl=x,x=n.buildWFLogTpl(e)),x=JE.toXT(x,o),x='<div class="pagediv-border NoBorder" style="'+("1"==l?"height:"+p+";width:"+u+";":"")+'position: relative;padding:20px;">'+JE.getUEditorBox(x)+"</div>"},buildTableTag:function(e){if(!Ext.isEmpty(e.info.tableFormTag))return e.info.tableFormTag;var t=document.createElement("div");t.innerHTML=e.info.tableFormTpl;var i=Ext.get(t).query("input[type=button]");return text=t.innerHTML,Ext.each(i,function(e){var t=e.getAttribute("data-fontsize"),i=e.getAttribute("data-fontfamily"),a=e.getAttribute("data-fontcolor"),n=e.parentNode,o=document.createElement("span");o.innerHTML="{"+e.getAttribute("name")+"}",JE.isNotEmpty(t)&&(o.style.fontSize=t+"px"),JE.isNotEmpty(i)&&(o.style.fontFamily=i),JE.isNotEmpty(a)&&(o.style.color=a),n.replaceChild(o,e)}),e.info.tableFormTag=t.innerHTML,e.info.tableFormTag},formatPrintData:function(e,t,i,a){var n=i.basicFields[e];if(!n||Ext.isEmpty(t))return t;var o=t;if(-1!=["cbbfield","rgroup","cgroup"].indexOf(n.xtype)){var r=n.configInfo.split(",")[0];o=JE.toDicText(r,o),o=Ext.value(o,t)}else if(-1==["datetimefield","datemonthfield","datefield"].indexOf(n.xtype)||Ext.isEmpty(o))if("barfield"==n.xtype)o+="%";else if("ckeditor"==n.xtype)o=Ext.htmlDecode(o);else if("uxfilefield"==n.xtype){var l=Ext.value(n.configInfo,"").split(",");if("img"==l[2]){var s=Ext.value(l[4],l[3]),d="";if(JE.isNotEmpty(s))d="width:"+s.split("*")[0]+"px;height:"+s.split("*")[1]+"px;";o="<img src='"+o.split("*")[1]+"' style='"+d+"'>"}else o=o.split("*")[0]}else if("uxfilesfield"==n.xtype){var c=Ext.isString(o)?Ext.decode(o):o,u=[];Ext.each(c,function(e){u.push(e.name)}),o=u.join(",")}else if("cbblistfield"==n.xtype){var p=[],f=[];try{p=Ext.decode(o)}catch(e){}Ext.each(p,function(e){var t=Ext.value(e.text,e.code);f.push("<b>"+t+"</b>："+e.value)}),o=f.join("<br/>")}else o=t.toString().replaceAll("\n","<br/>");else o=Ext.Date.format(Ext.Date.parse(o,n.submitFormat),n.format);return o=Ext.value(o,"&nbsp;"),"field"==a&&n.unitTpl&&(o+="&nbsp;&nbsp;"+n.unitTpl),o},getLODOP:function(){return this.LODOP||(this.LODOP=JE.getLodop()),this.LODOP},buildStyles:function(){return this.styles||(this.styles=["<style>","html,body{height:100%;margin:0px;padding:0px;background-color:#fff;}",".div-box{height:100%;}",".div-box *{font-family: tahoma, arial, verdana, sans-serif !important;font-size:12px !important;box-sizing: border-box;-moz-box-sizing: border-box;-ms-box-sizing: border-box;-webkit-box-sizing: border-box;}",".table-grid-cell-inner{padding: 3px 6px 4px 6px !important;border:1px solid #000 !important;table-layout:fixed;word-break:break-all;}",".childFunc table tr.firstRow td {border-top: 0px !important;}",".childFunc table tr.lastRow td {border-bottom: 0px !important;}",".childFunc table tr td.firstCol {border-left: 0px !important;} ",".childFunc table tr td.lastCol {border-right: 0px !important;} ",JE.ajax({url:"/static/css/je-ueditor.css",text:!0}),"</style>"]),this.styles},blildLodopPageTpl:function(){var e=this.buildStyles(),t=['<div class="div-box">','<tpl if="headerTpl">','<div class="NoBorder" style="padding:10px 0px;font-weight: bold;width:100%;text-align:{headerAlign};">{[this.formatData(values,values.headerTpl)]}</div>',"</tpl>",'<div style="width:100%;">{bodyTpl}</div>','<tpl if="fotterTpl">','<div class="NoBorder" style="padding:10px 0px;font-weight: bold;width:100%;position: absolute;bottom: 0px;text-align:{fotterAlign};">{[this.formatData(values,values.fotterTpl)]}</div>',"</tpl>","</div>",{formatData:function(e,t){return t=(t=Ext.value(t,"")).replaceAll("{pageNum}",e.pageNum).replaceAll("{totalNum}",e.totalNum)}}];return new Ext.XTemplate(e.concat(t))},buildListFunc4Lodop:function(e){var t={},i=e.funcCode,a=e.lodop,n=JE.getFuncData(i);if(!n.info.gridEnablePrint)return JE.getLocalLang("core.util.PrintUtil").noPrintInfo;var o=n.info.gridPrintInfo,r=this.buildListTpl(e),l=Ext.clone(r);l.splice(1,1,o.columnsTpl),l=new Ext.XTemplate(l),r=new Ext.XTemplate(r);var s=o.pageSize,d=1,c=(o.pageWidth,o.pageHeight,this.blildLodopPageTpl());LODOP=this.getLODOP(),LODOP.PRINT_INIT(JE.getLocalLang("core.util.PrintUtil").lodopInit);for(var u=0;u<d;u++){var p=this.buildListData(e,s,u+1);if(0==u){var f=p.totalCount%s;d=(p.totalCount-f)/s+(0<f?1:0)}t[i]=p;var E={bodyTpl:!o.autoHeader&&0<u?r.apply(t):l.apply(t),headerTpl:o.header,headerAlign:o.headerAlign,fotterTpl:o.fotter,fotterAlign:o.fotterAlign,pageWidth:10*o.pageWidth,pageHeight:10*o.pageHeight,pageSize:p.rows.length,pageNum:u+1,totalNum:d},m=c.apply(E);LODOP.NewPage(),LODOP.ADD_PRINT_HTM(0,0,"100%","100%",m)}LODOP[a]&&0<LODOP[a]()&&JE.msg(JE.getLocalLang("core.util.PrintUtil").lodopGridEndMsg)}}),Ext.define("JE.core.util.SqlUtil",{disableSql:function(e,t,i){if(JE.isNotEmpty(i)){var a=e.proxy.extraParams;if("order"==i)a.orderSql=e.sqls.order||"";else{var n=e.sqls[i]||"",o=(a.whereSql||"").replace(n,"");a.whereSql=o}var r=Ext.decode(Ext.value(a.queryFields,"{}"));r[i]=t,a.queryFields=Ext.encode(r)}},buildWhereSql:function(e,t){var i=this,a="";t=Ext.value(t,"and");if(Ext.isEmpty(e))return a;if(Ext.isArray(e)){var n=[];Ext.each(e,function(e,t){n.push(i.buildWhereSql(e))}),Ext.isEmpty(n)||(a=" and ("+n.join(" "+t+" ")+")")}else{var o=Ext.value(e.value,""),r=Ext.value(e.type,"=").toUpperCase().trim();if("IDIT"==r)return" 1=1 "+Ext.value(e.sql,"");switch(r){case"IN":case"NOT IN":if("string"==typeof o&&(o=o.split(",")),1e3<=o.length){var l=parseInt(o.length/999);l+=0<o.length%999?1:0;n=[];for(var s=0;s<l;s++){var d=[];d=o.length<1e3?o:o.splice(0,999),n.push(e.code+" "+r+" ('"+d.join("','")+"')")}return a="("+n.join(" or ")+")"}o="('"+o.join("','")+"') ";break;case"LIKE":o=e.before?"'%"+o+"'":e.after?"'"+o+"%'":"'%"+o+"%'";break;case"LIKE%":o="'"+o+"%'",r="LIKE";break;case"%LIKE":o="'%"+o+"'",r="LIKE";break;case"BETWEEN":o="'"+o[0]+"' and '"+o[1]+"'";break;case"IS":case"IS NOT":o=null==o?"NULL":o;break;default:o=Ext.isNumber(o)?o:"'"+o+"'"}a=" "+e.code+" "+r+" "+o}return a},setWhereSql:function(t,e,i,a,n){var o="";a=Ext.value(a,"and"),Ext.isString(e)?o=Ext.value(e,""):JE.isNotEmpty(e)&&(o=this.buildWhereSql(e,a)),o=this.formatSql(o),t.sqls=Ext.value(t.sqls,{}),t.queryFields=Ext.value(t.queryFields,{});JE.isNotEmpty(i)&&(t.sqls[i]=o,JE.isNotEmpty(e)&&Ext.isArray(e)||JE.isNotEmpty(n)&&Ext.isArray(n)?t.queryFields[i]=e||n:delete t.queryFields[i]);var r=[];return Ext.each(["basic","parent","group","tree","column","quick","cxcl","treeFunc","mark","chart"],function(e){t.sqls[e]&&r.push(t.sqls[e])}),t.proxy.extraParams.whereSql=r.join(" "),t.disableBasicSql&&(t.proxy.extraParams.whereSql=t.proxy.extraParams.whereSql.replace(t.sqls.basic,"")),o},formatSql:function(e,t,i){return Ext.isEmpty(e)?"":(e=e.replaceAll("parent.","parent_"),JE.toXT(e,t))},setOrderSql:function(e,t){var r=Ext.value(e.sqls.order,"").toUpperCase();if(!Ext.isEmpty(t)){var l=[];Ext.each(t,function(e){var t=e.code.toUpperCase(),i=e.type.toUpperCase(),a=!0,n=t+" "+i;if(JE.isNotEmpty(r)){var o=[t+" "+i,t+" "+("ASC"==i?"DESC":"ASC"),t];Ext.each(o,function(e){if(-1!=r.indexOf(e))return r=r.replace(e,n),a=!1})}a&&l.push(n)}),JE.isEmpty(r)?r=" ORDER BY "+l.join(","):JE.isNotEmpty(l)&&(r+=","+l.join(","))}e.proxy.extraParams.orderSql=r}}),Ext.define("JE.core.util.Util",{getEmptyDataTpl:function(){return'<img src="'+JE.getStaticUrl("JE.core.util.func.Grid.nodata")+'" style="position: absolute;top: 50%;left: 50%;margin-top: -125px;margin-left: -108px;width: 160px"/>'},getUserInfo:function(e,t,i){var a=" and USERINFO_USERID='"+JE.USER.userId+"' AND USERINFO_TYPE='"+e+"'";JE.isNotEmpty(t)&&(a+=" and USERINFO_FUNCCODE='"+t.info.funcCode+"'");var n=JE.ajax({url:JE.getUrlMaps("je.core.load"),params:{limit:1,tableCode:"JE_CORE_USERINFO",whereSql:a}});if(0!=n.success){var o=n.rows[0];if(o){var r={bean:o,config:Ext.decode(o.USERINFO_CONFIG)};if("COLUMN"==e){var l=r.config.show.concat(r.config.hide),s=[];Ext.each(t.grid.columns,function(e){-1!=l.indexOf(e.dataIndex)||e.locked||s.push(e.dataIndex)}),r.config.show=r.config.show.concat(s)}else if("CXCL"==e){var d=r.config.show.concat(r.config.hide);s=[];Ext.each(i,function(e){var t=e.isModel?e.get("JE_CORE_QUERYSTRATEGY_ID"):e.JE_CORE_QUERYSTRATEGY_ID;-1==d.indexOf(t)&&s.push(t)}),r.config.show=r.config.show.concat(s)}return r}}},removeUserInfo:function(e,t){var i="and USERINFO_USERID='"+JE.USER.userId+"' AND USERINFO_TYPE='"+e+"'";JE.isNotEmpty(t)&&(i+=" and USERINFO_FUNCCODE='"+t.info.funcCode+"'");var a=JE.ajax({url:JE.getUrlMaps("je.core.load"),params:{limit:1,tableCode:"JE_CORE_USERINFO",whereSql:i}});if(JE.isNotEmpty(a.rows)){var n=[];Ext.each(a.rows,function(e){n.push(e.JE_CORE_USERINFO_ID)}),JE.ajax({url:JE.getUrlMaps("je.core.remove"),params:{tableCode:"JE_CORE_USERINFO",ids:n.join(",")}})}},getSearchType:function(e){var t=["=","like","like%","in"],i="",a=!1;return-1!=["datetimefield","datefield","datemonthfield","numberfield"].indexOf(e)?(i="between",t.push("between",">",">=","<","<="),"numberfield"==e&&t.push("!=")):-1!=["textfield","searchfield","gridssfield","treessfield","queryuserfield","pinyinfield"].indexOf(e)?i="like":t=-1!=["cgroup","rgroup","cbbfield"].indexOf(e)?(a=!0,[i="in"]):(a=!0,[i="="]),{types:t,value:i,hidden:a}},refreshCache:function(e){var t="clearAll";"sysvar"==e&&(t="clearSysVar"),"func"==e?t="clearFunc":"dic"==e?t="clearDic":"menu"==e&&(t="clearMenu"),JE.ajax({url:JE.getUrlMaps("je.core.cache",t)}),window.location.reload()},buildMergesInfo:function(s,d){var c={},u={};return Ext.isEmpty(s)||Ext.each(d,function(r,l){Ext.each(s,function(e){t=(t=c[e])||(c[e]={});for(var t,i="",a="",n=[],o=0;o<=s.indexOf(e);o++)i+=Ext.value(r.get(s[o]),"").toString(),n.push(s[o]),0<l&&(a+=Ext.value(d[l-1].get(s[o]),"").toString());(u[e]=n,0==l)?c[e][i]={start:l,end:l}:(t=(t=c[e][i])||(c[e][i]={start:l,end:l}),i==a&&t.end++)})}),{mergesInfo:c,fieldsInfo:u}},isFireListener:function(e){var t=Ext.decode(Ext.value(e,"[]")),i=!1;return Ext.each(t,function(e){if("1"==e.fire)return!(i=!0)}),i},doDataFlow:function(e,t,i,a,n){if(t&&t.dataFlow&&t.dataFlow[e]){var o=t.dataFlow[e];for(var r in o)for(var l=0;l<o[r].length;l++){var s=o[r][l];if(JE.isNotEmpty(s.enableFn))if(0==JE.eval(s.enableFn)(i,a,e))continue;if("idit"!=r){var d=[];if("one"==r){var c=JE.toXT(s.sql,{},n);d.push(c)}else"more"==r&&Ext.each(i,function(e){var t=JE.toXT(s.sql,e,n);d.push(t)});var u=s.act,p=JE.encode(d);JE.ajax({url:JE.getUrlMaps("je.core.executeBatchSql"),params:{act:u,sqls:p}})}JE.isNotEmpty(s.callbackFn)&&JE.eval(s.callbackFn)(i,a,e)}}},showPostil:function(i){var a,n,o=i.funcCode,s=i.pkValue,d=JE.getFuncData(o).info,c=(i.userId,i.userName,JE.getObjAttr(d.otherConfig,"titleConfig")),u={};i.button?((n=i.button).formObj.getValue("SY_CREATEUSERID"),n.formObj.getValue("SY_CREATEUSERNAME"),u=n.formObj.getValue(),a=n.formObj.getRecord()):i.record&&((a=i.record).get("SY_CREATEUSERID"),a.get("SY_CREATEUSERNAME"),u=a.data);function e(e){var t=e.getCount();n&&(n.setText("批注("+t+")"),n.formObj.setValues({SY__POSTIL:t},!0)),a&&(a.fields.get("SY__POSTIL").persist=!1,a.set("SY__POSTIL",t)),{tableCode:d.tableName,SY__POSTIL:t}[d.pkName]=s,i.callback&&i.callback(t)}var t={xtype:"form",layout:"fit",margin:"10 10 0 10",bodyStyle:"background-color:transparent",border:0,items:[{xtype:"textarea",name:"POSTIL_PZ",itemId:"pz",allowBlank:!1},{xtype:"hidden",name:"POSTIL_HFR"},{xtype:"hidden",name:"POSTIL_HFRID"},{xtype:"hidden",name:"SY_PARENT"},{xtype:"hidden",name:"users"},{xtype:"hidden",name:"userids",itemId:"userids"}],region:"north",height:100,buttonAlign:"left",buttons:[{xtype:"box",style:"cursor: pointer;padding-right:5px;color: #408eba;",html:'<i class="fa fa-at"></i>',listeners:{afterrender:function(o){o.getEl().on("click",function(){var n=o.ownerCt.ownerCt,e=n.getCmp("userids").getValue();JE.vue.selectUser({title:"人员",height:650<JE.getBodyHeight()?650:JE.getBodyHeight()-150,iconCls:"fa fa-at",configInfo:"JE_CORE_DEPTUSER_NODISABLE,,,M",type:"tree",value:e,valueType:"id",callback:function(e){var t=[],i=[];Ext.each(e,function(e){t.push(e.text),i.push(e.id)}),n.form.setValues({users:t.join(","),userids:i.join(",")});var a=o.next();a.getEl().dom.title=t.join(","),a.update(t.join(","))}})})}}},{xtype:"box",itemId:"userBox",maxWidth:350,style:"overflow: hidden;text-overflow: ellipsis;white-space: nowrap;"},{text:"发布",handler:function(e){var t=e.ownerCt.ownerCt;if(!t.isValid())return!1;var i=t.form.getValues(),a=JE.split(i.users,","),n=JE.split(i.userids,",");(JE.isEmpty(n)||JE.isNotEmpty(i.POSTIL_HFRID)&&-1==n.indexOf(i.POSTIL_HFRID))&&(n.push(i.POSTIL_HFRID),a.push(i.POSTIL_HFR));var o=t.next("dataview").store,r=JE.ajax({url:"/je/postil/postil/savePostil",params:{POSTIL_HFRID:n.join(","),POSTIL_HFR:a.join(","),POSTIL_PZ:i.POSTIL_PZ,POSTIL_FUNCID:d.funcId,POSTIL_FUNCCODE:d.funcCode,POSTIL_FUNCNAME:d.funcName,POSTIL_FUNCNAME:d.funcName,SY_PARENT:i.SY_PARENT,POSTIL_FUNCNR:JE.toXT(c,{bean:u}),POSTIL_FUNCCLS:d.funcIconCls,POSTIL_TABLECODE:d.tableName,POSTIL_MODELID:s,tableCode:"JE_CORE_POSTIL"}});Ext.each(r,function(e){o.insert(0,e)});var l=e.next("button");l.handler(l)}},{text:"取消",handler:function(e){var t=e.ownerCt.ownerCt;t.form.reset();var i=t.ownerCt.basicTitle="发布新批注";t.ownerCt.setTitle(i)}}]},r=" AND POSTIL_FUNCID='"+d.funcId+"' AND POSTIL_MODELID='"+s+"'",l={xtype:"dataview",region:"center",margin:"10",autoScroll:!0,cls:"je-postil-view",store:JE.getStore({tableName:"JE_CORE_POSTIL",pageSize:-1,autoLoad:!0,params:{whereSql:r,orderSql:"ORDER BY SY_CREATETIME DESC"}}),itemSelector:"div.item",tpl:['<tpl for=".">','<div class="item">',"<div>",'<i class="fa fa-commenting"></i> {SY_CREATEUSERNAME} 于 <span class="time">{[values.SY_CREATETIME.substring(0,16)]}</span> ','<tpl if="JE.isEmpty(POSTIL_HFRID)">',"批注","<tpl else>","回复 {POSTIL_HFR}","</tpl>"," :","</div>",'<div class="pz">{POSTIL_PZ}</div>','<div class="buttons">','<div class="button add">回复</div>','<tpl if="JE.currentUser.userId==SY_CREATEUSERID">','<div class="button remove">删除</div>',"</tpl>","</div>","</div>","</tpl>"],listeners:{itemclick:function(t,i,e,a,n){var o=n.getTarget(".button",1,!0);if(o)if(o.hasCls("add")){var r=t.prev("form");r.form.reset(),r.form.setValues({POSTIL_HFR:i.get("SY_CREATEUSERNAME"),POSTIL_HFRID:i.get("SY_CREATEUSERID"),SY_PARENT:i.get("JE_CORE_POSTIL_ID")});var l=r.ownerCt.basicTitle="回复 "+i.get("SY_CREATEUSERNAME")+" 的批注";r.ownerCt.setTitle(l),r.getCmp("pz").focus(!0,!0)}else JE.confirm("确定删除吗？",function(e){"ok"==e&&(JE.ajax({url:JE.getUrlMaps("je.core.remove"),params:{tableCode:"JE_CORE_POSTIL",ids:i.get("JE_CORE_POSTIL_ID")}}),t.store.remove(i))})}}};l.store.on({add:e,remove:e});var p=[{text:"关闭",cls:"btn",handler:function(e){e.up("window").close()}}];i.openForm?(p.push({text:"查看详情",cls:"btn JEPLUS_B_L10",handler:function(e){e.up("window").close();var t=JE.getFuncData(o),i=JE.ajax({url:JE.getUrlMaps("je.core.getInfoById"),params:{tableCode:Ext.value(t.info.viewTableName,t.info.tableName),pkValue:s}});i.SY__POSTIL=l.store.getCount(),JE.showFunc(o,{type:"form",values:i})}}),p.reverse()):p[0].cls+=" JEPLUS_B_L10",JE.win({title:"发布新批注",basicTitle:"发布新批注",width:600,height:650<JE.getBodyHeight()?650:JE.getBodyHeight()-150,layout:"border",border:0,autoShow:!0,bodyStyle:"background-color:#ffffff;",buttonAlign:"center",buttons:p,items:[t,l]})},updateUserPhoto:function(n){JE.cutImage({title:"更换头像",userPhoto:!0,callback:function(e){JE.USER.photo=e.name+"*"+e.url,JE.currentUser.photo=e.name+"*"+e.url,JE.__USERS__&&(JE.__USERS__[JE.USER.userId].photo=JE.__USERS__[JE.USER.userCode].photo=JE.USER.photo,JE.__USERS__[JE.USER.userId].photoUrl=JE.__USERS__[JE.USER.userCode].photoUrl=e.privateUrl),JE.ajax({url:JE.getUrlMaps("je.core.rbac.user","doUpdateInfo"),async:!0,params:{tableCode:"JE_CORE_ENDUSER",USERID:JE.currentUser.userId,PHOTO:JE.USER.photo}});var t=JE.getUserPhoto(!0),i=Ext.get("app-header");i&&i.userInfoMenu&&i.userInfoMenu.getEl().down(".photoinfo").update(t);var a=Ext.get("__je_userinfo__");a&&a.update(t),window._crm_home_changeUserPhoto&&window._crm_home_changeUserPhoto(t),n&&n(t)}})},doNotice:function(e,t,i){if("read"==e){var a=1*Ext.value(t.NOTICE_YDL,"0");(o=JE.ajax({url:"/je/doUpdate",params:{tableCode:"JE_SYS_NOTICE",NOTICE_YDL:1+a,JE_SYS_NOTICE_ID:t.JE_SYS_NOTICE_ID}})).success&&(t=o.obj)}else if("praise"==e){var n=Ext.value(t.NOTICE_DZUSERIDS,"").split(",");if(-1==n.indexOf(JE.currentUser.userId)){var o,r=1*Ext.value(t.NOTICE_DZL,"0");n.push(JE.currentUser.userId),(o=JE.ajax({url:"/je/doUpdate",params:{tableCode:"JE_SYS_NOTICE",NOTICE_DZUSERIDS:n.join(","),NOTICE_DZL:1+r,JE_SYS_NOTICE_ID:t.JE_SYS_NOTICE_ID}})).success&&(t=o.obj)}}i&&i(t)}}),Ext.define("JE.core.util.ViewUtil",{getFuncPrintBtn:function(){var t=this,e={ref:"__gridLodopPrintBtn",bigIconCls:"SY_CORE_PRINT32",iconCls:"jeicon jeicon-print",handler:function(){var e=t.getPrintInfo();t.printPage(e.func,e.type,e.parentData,e.lodop)}};return JE.toBigButton(e,t.funcData.info.bigButton),"plus"==JE.getTheme()&&Ext.apply(e,{iconCls:"fa fa-print"}),e},getPageitems:function(a){var e=JE.getLocalLang("core.jegridview.pageItems");return["-",e.pageText,{xtype:"cbbfield",name:"pageSize",isFormField:!1,submitValue:!1,value:a.pageSize,editable:!0,width:50,margins:"-1 2 3 2",dataArray:[10,20,30,40,50,60,70,80,90,100],listeners:{change:function(e,t,i){e.queryTask||(e.queryTask=new Ext.util.DelayedTask(function(){0!=JE.toNum(this.getValue())&&(a.pageSize=this.getValue(),a.loadPage(1))},e)),e.queryTask.delay(400)}}},e.pageUnit,"->"]},getTreeTools:function(){return[{type:"collapse",callback:function(e,t,i){var a=t.type;"treepanel"==e.xtype||"jetreeview"==e.xtype?e[a+"All"]():e.items.each(function(e){"treepanel"!=e.xtype&&"jetreeview"!=e.xtype||e[a+"All"]()}),t.setType("expand"==a?"collapse":"expand")}},{type:"refresh",callback:function(e,t,i){"treepanel"==e.xtype||"jetreeview"==e.xtype?(e.getSelectionModel().deselectAll(),"jetreeview"!=e.xtype||!e.funcData||"tree"!=e.funcData.info.funcType&&1!=JE.getObjAttr(e.funcData.info.otherConfig,"treerefresh")||(e.load(),JE.msg("数据同步成功！"))):e.items.each(function(e){"treepanel"!=e.xtype&&"jetreeview"!=e.xtype||(e.getSelectionModel().deselectAll(),"jetreeview"!=e.xtype||!e.funcData||"tree"!=e.funcData.info.funcType&&1!=JE.getObjAttr(e.funcData.info.otherConfig,"treerefresh")||(e.load(),JE.msg("数据同步成功！")))})}}]},getTreeTbar:function(f){var e={},t=[],E=f.async,i="";f.searchTpl?i=f.searchTpl:0==f.onlyItem?i="{text}<tpl if='parentText'><div class='item-remark'>{parentText}</div></tpl>":f.codeSearch&&(i="{text}<div class='item-remark'>{code}</div>"),JE.isNotEmpty(i)&&(e=Ext.isString(i)?{getInnerTpl:function(e){return i}}:(i.isTemplate||((i=new Ext.XTemplate(i)).treeObj=f),{tpl:i}));var a=new Ext.data.Store({fields:["id","text","code","pinyin","parentText","path","nodeInfo","nodeInfoType","leaf"]}),n=new Ext.util.Filter({filterFn:function(e){var t=Ext.value(this.value,"").toLocaleLowerCase(),i=Ext.value(e.get("text"),""),a=Ext.value(e.get("code"),""),n=Ext.value(e.get("pinyin"),""),o=-1!=i.toLocaleLowerCase().indexOf(t)||-1!=n.indexOf(t);return f.codeSearch&&(o=o||-1!=a.toLocaleLowerCase().indexOf(t)),o}}),o={xtype:"cbbfield",cls:"je-tree-search",store:a,hideTrigger2:!0,editable:!0,valueField:"id",inputAttrTpl:"style='border-width:0;'",ref:"queryTreeCBB",itemId:"searchfield",emptyText:JE.getLocalLang("core.jetreeview.queryCbb").emptyText,listConfig:e,isFormField:!1,minChars:1,reset:function(){this.setValue(""),this.doQuery()},addNodeData:function(e,t){var i=this;Ext.isArray(e)?Ext.each(e,function(e){i.addNodeData(e,t)}):i.store.getById(e.id)||i.store.add({text:e.text,id:e.id,code:e.code,nodeInfo:e.nodeInfo,path:e.nodePath,parentText:t,pinyin:JE.toPinYin(e.text,"pinyin"),nodeInfoType:e.nodeInfoType,leaf:e.leaf})},doQuery:function(i,e,t){var a=this;return JE.isEmpty(i)?(this.collapse(),!1):(f.async&&Ext.each(f.configInfo,function(e){if(e.async){var t=JE.ajax({url:f.findAsyncNodesUrl||JE.getUrlMaps("je.core.dd.tree.findAsyncNodes"),params:{type:"liketext",value:i,strData:Ext.encode([e])}});e.wfUser&&Ext.each(t,function(e){e.id=e.id.split("_")[0],e.nodeInfo=""}),a.addNodeData(t,e.ddName)}}),this.superclass.doQuery.call(this,i,e,t))},listeners:{select:function(e,t){var i=t[0],a=i.get("id"),n=f.nodeHash[a];if(n)if(f.getNodeHashPath){var o=f.getNodeHashPath(n);f.expandPath(o),n=f.getStore().getNodeById(a)}else n=f.getStore().getNodeById(a),f.expandPath(n.getPath());else if(f.async){o=i.get("path");var r=i.get("nodeInfo");if(JE.isNotEmpty(r)){var l=[];Ext.each(o.split("/"),function(e){JE.isNotEmpty(e)&&(e+="_"+r),l.push(e)}),f.loadInfo.params.onlyItem?l[1]="ROOT":l.splice(1,0,"ROOT"),o=l.join("/")}f.expandPath(o),n=f.getStore().getNodeById(a)}if(n){var s=[n];f.multiSelect&&(s=s.concat(f.getSelectionModel().getSelection())),f.getSelectionModel().select(s);var d=Ext.get(f.view.getNode(n));JE.scrollBy(f.view,d)}}},refreshStore:function(e){this.store.removeAll();var t=f.nodeHash||{},i="",a=[],n={};for(var o in t.ROOT&&Ext.each(t.ROOT.children,function(e){n[e.nodeInfo]=e}),t){var r=t[o],l=r.text,s=r.code,d="";E||(d=JE.toPinYin(l,"pinyin"));var c=Ext.value(r.id,"");if(f.searchTpl){var u=t[r.parent];u&&(i=u.text)}else{var p=n[r.nodeInfo];p&&(i=p.text)}"ROOT"!=c.toUpperCase()&&a.push({text:l,id:c,code:s,parentText:i,pinyin:d,path:r.nodePath,nodeInfo:r.nodeInfo,nodeInfoType:r.nodeInfoType,leaf:r.leaf})}this.store.add(a)}};E&&(o.queryDelay=500),a.addFilter(n,!1),o.queryFilter=n,Ext.isEmpty(f.title)||1!=f.showTitle||(t.push({xtype:"displayfield",value:'<div style="color: #04408c;text-align:center;font-weight: bold;">'+f.title+"</div>"}),delete f.title),t.push(o);var r={dock:"top",xtype:"panel",layout:"column",defaults:{columnWidth:1},bodyStyle:"background:none;",cls:"je-tree-searchbar",itemId:"queryBar",border:f.border,items:t};return f.on("load",function(e){var t=f.down("cbbfield[ref=queryTreeCBB]");if(t){if(!f.buildNodeHash){f.nodeHash={};var i=f.getStore().tree.nodeHash;for(var a in i)f.nodeHash[a]=i[a].data}t.refreshStore(e)}}),r},getTreeBbar:function(n,o){o=Ext.value(o,{idSuffix:""});var e=[{boxLabel:JE.getLocalLang("core.jetreeview.bbar").selModelLabel,name:"selectModel",listeners:{change:function(e,i,t){setTimeout(function(){n.getSelectionModel().deselectAll(),Ext.iterate(n.store.tree.nodeHash,function(e,t){t.set("checked",!i&&null),t.commit()}),n.multiSelect=!!i,n.getSelectionModel().setSelectionMode(i?"SIMPLE":"SINGLE")},100)}}}];"tree"==o.funcType&&0!=n.searchModel&&e.push({boxLabel:JE.getLocalLang("core.jetreeview.bbar").searchModelLabel,name:"searchModel",listeners:{change:function(e,t,i){n.searchModel=t;var a=e.previousSibling();a.setValue(!1),a.setDisabled(t),t||Ext.getCmp(o.funcCode+"_jecenterview"+o.idSuffix).getLayout().setActiveItem("jedataview")}}});e.length,e.length;return{dock:"bottom",xtype:"panel",border:0,height:40,layout:"column",bodyStyle:"background:none;",cls:"x-view-hinttext je-tree-searchtree-model",defaults:{xtype:"yesnofield",inputType:"switch",value:"0",fieldBodyStyle:"text-align:center",columnWidth:1/e.length},items:e}},getWfBatchBar:function(){var g=this,h=g.funcData,x=h.info.pkName,u=h.wf.infos,e=new Array,t=new Array,i={};for(var a in u){e.push({text:u[a].processName,code:a});var n=u[a].taskNodeInfos;if(t.length<=0)for(var o in i=u[a].taskNodeInfos,n)t.push({text:n[o].label,code:n[o].name})}var v=JE.getLocalLang("core.jewfview.batchBar");return{itemId:"wfBatchBar",xtype:"form",hidden:!0,layout:{type:"hbox",align:"stretch"},bodyPadding:"5",height:100,margin:"0 0 2 0",defaults:{labelAlign:"right",labelWidth:80},bodyStyle:"border-bottom-width:1px!important;",bodyCls:"x-toolbar-default",dockedItems:[{xtype:"toolbar",dock:"right",items:[{xtype:"button",iconCls:"jeicon jeicon-arrow-right",handler:function(e){var t=e.ownerCt.ownerCt.down("multiselect[name=PROCESS]"),i=e.ownerCt.ownerCt.down("multiselect[name=PROCESS_TASK]"),a=e.ownerCt.ownerCt.down("multiselect[name=PROCESS_OPER]"),n=t.wfInfos,o=t.getSubmitValue();if(Ext.isEmpty(o))JE.alert(v.alert.emptyWf);else{var r=a.getSubmitValue();if(Ext.isEmpty(r))JE.alert(v.alert.emptyOper);else{var l=i.getSubmitValue();if("sponsor"!=r&&Ext.isEmpty(l))JE.alert(v.alert.emptyTask);else{var s=g.getSelectionModel().getSelection();if(s.length<=0)JE.alert(v.alert.emptyRecord);else{var d=s[0],c=new Array,u=new Array;Ext.each(s,function(e){c.push(e.get(x)),Ext.isEmpty(e.get("SY_PIID"))||u.push(e.get("SY_PIID"))});var p=n[o];if("sponsor"==r){l=p.firstTaskNode;var f=p.taskNodeInfos[l];if("decision"==f.type){var E=!0;if(Ext.each(f.transitions,function(e){"1==1"!=e.info&&(E=!1)}),!E)return void JE.alert(v.alert.decisionNode)}}var m={audFlag:d.get("SY_AUDFLAG"),btns:[],currentTasks:[],info:p,pdid:o,piid:u.join(","),tableCode:h.info.tableName,pkValue:"",ids:c.join(","),taskId:"",taskName:l,wfBatch:!0,callback:function(){g.getStore().loadPage(1)}};"round"==r?JE.Action.doWFRound({wfInfo:m}):JE.Action.doWFSubmitWin({wfInfo:m},r)}}}}}},{xtype:"button",iconCls:"jeicon jeicon-error",handler:function(e){var t=e.up("form[itemId=wfBatchBar]"),i=e.ownerCt.ownerCt.down("multiselect[name=PROCESS]"),a=e.ownerCt.ownerCt.down("multiselect[name=PROCESS_OPER]"),n=e.ownerCt.ownerCt.down("multiselect[name=PROCESS_TASK]");i.clearValue(),n.clearValue(),a.clearValue(),t.form.reset(),i.fireEvent("change",i,i.getSubmitValue()),e.ownerCt.ownerCt.hide();var o=g.getStore();JE.DB.setWhereSql(o),o.loadPage(1)}}]}],items:[{xtype:"multiselect",flex:1,fieldLabel:v.wfLabel,wfInfos:u,valueField:"code",name:"PROCESS",value:0<e.length?e[0].code:null,store:Ext.create("Ext.data.Store",{fields:["text","code"],data:e}),listeners:{change:function(e,t,i,a){var n=e.up("form[itemId=wfBatchBar]"),o=n.down("multiselect[name=PROCESS_TASK]"),r=n.down("multiselect[name=PROCESS_OPER]");if(Ext.isEmpty(t))o.taskInfos={},o.setDisabled(!0),r.setDisabled(!0),o.getStore().loadData([]);else{o.setDisabled(!1),r.setDisabled(!1),r.clearValue();var l=u[t].taskNodeInfos,s=new Array;for(var d in l){var c=l[d];s.push({text:c.label,code:c.name})}o.taskInfos=l,o.getStore().loadData(s)}}}},{xtype:"multiselect",flex:1,fieldLabel:v.taskLabel,name:"PROCESS_TASK",disabled:e.length<=0,valueField:"code",store:Ext.create("Ext.data.Store",{fields:["text","code"],data:0<e.length?t:[]}),taskInfos:i,listeners:{change:function(e,t,i,a){var n=e.up("form[itemId=wfBatchBar]");g.doWfBatchLoad(n,x)},afterrender:function(e){e.labelEl&&e.labelEl.parent().appendChild({tag:"div",style:"cursor: pointer;color:blue;margin:2px;text-align:right;",html:v.taskImageLabel}).on("click",function(){JE.Action.showProcess(g.id)})}}},{xtype:"multiselect",flex:1,disabled:e.length<=0,fieldLabel:v.operLabel,name:"PROCESS_OPER",valueField:"code",store:Ext.create("Ext.data.Store",{fields:["text","code"],data:[{code:"sponsor",text:v.operData.sponsor},{code:"submit",text:v.operData.submit},{code:"return",text:v.operData.return},{code:"back",text:v.operData.back},{code:"transmit",text:v.operData.transmit},{code:"entrust",text:v.operData.entrust},{code:"round",text:v.operData.round}]}),listeners:{change:function(e,t,i,a){var n=e.up("form[itemId=wfBatchBar]");g.doWfBatchLoad(n,x)}}}]}},doWfBatchLoad:function(e,t){var i=e.down("multiselect[name=PROCESS]"),a=e.down("multiselect[name=PROCESS_TASK]"),n=e.down("multiselect[name=PROCESS_OPER]"),o=a.taskInfos,r=i.wfInfos,l=i.getSubmitValue(),s=a.getSubmitValue(),d=n.getSubmitValue(),c=r[l],u=o[s];if("sponsor"==d?a.setDisabled(!0):a.setDisabled(!1),!Ext.isEmpty(l)&&!("sponsor"!=d&&Ext.isEmpty(s)||Ext.isEmpty(d))){var p="";if("sponsor"==d)p=" AND (SY_AUDFLAG='NOSTATUS' OR SY_AUDFLAG='' OR SY_AUDFLAG IS NULL )";else if("submit"==d)if("decision"==u.type){var f=!0;Ext.each(u.transitions,function(e){"1==1"!=e.info&&(f=!1)}),p=f?" AND SY_AUDFLAG!='HANDUP' AND "+t+" IN (SELECT KEY_ FROM JBPM4_EXECUTION WHERE PROCDEFID_='"+l+"' AND ID_ IN (SELECT EXECUTION_ID_ FROM JBPM4_TASK WHERE NAME_='"+s+"' AND EXECUTION_ID_ IS NOT NULL AND ASSIGNEE_='"+JE.currentUser.userId+"'))":" AND 1!=1"}else p=" AND SY_AUDFLAG!='HANDUP' AND "+t+" IN (SELECT KEY_ FROM JBPM4_EXECUTION WHERE PROCDEFID_='"+l+"' AND ID_ IN (SELECT EXECUTION_ID_ FROM JBPM4_TASK WHERE NAME_='"+s+"' AND EXECUTION_ID_ IS NOT NULL AND ASSIGNEE_='"+JE.currentUser.userId+"'))";else if("return"==d){var E=c.rollbackAble;u.name==c.firstTaskNode&&(E=!1),"join"==u.type&&(E=!1),1==(g=u.beforeTaskNames.split(",")).length&&null!=o[g[0]]?-1!=["countersign","fork"].indexOf(o[g[0]].type)&&(E=!1):E=!1,p=E?" AND SY_AUDFLAG!='HANDUP' AND "+t+" IN (SELECT KEY_ FROM JBPM4_EXECUTION WHERE PROCDEFID_='"+l+"' AND ID_ IN (SELECT EXECUTION_ID_ FROM JBPM4_TASK WHERE NAME_='"+s+"' AND EXECUTION_ID_ IS NOT NULL AND ASSIGNEE_='"+JE.currentUser.userId+"'))":" AND 1!=1"}else if("back"==d){var m=(c=r[l]).withdrawAble;"join"==u.type&&(m=!1),u.name==c.firstTaskNode&&(m=!1),1==(g=u.beforeTaskNames.split(",")).length&&null!=o[g[0]]?-1!=["countersign","fork"].indexOf(o[g[0]].type)&&(m=!1):m=!1,p=m?" AND SY_AUDFLAG!='HANDUP' AND "+t+" IN (SELECT KEY_ FROM JBPM4_EXECUTION WHERE PROCDEFID_='"+l+"' AND ID_ IN (SELECT EXECUTION_ID_ FROM JBPM4_TASK WHERE NAME_='"+s+"' AND EXECUTION_ID_ IS NOT NULL AND DBID_ IN (SELECT TASK_ FROM JBPM4_PARTICIPATION WHERE USERID_='"+JE.currentUser.userId+"' AND TYPE_='replaced-assignee')))":" AND 1!=1"}else if("transmit"==d){c=r[l],m=!0;u.name==c.firstTaskNode&&(m=!1);var g=u.beforeTaskNames.split(",");"join"!=u.type&&"countersign"!=u.type||(m=!1),1==g.length&&null!=o[g[0]]?-1!=["countersign","fork"].indexOf(o[g[0]].type)&&(m=!1):m=!1,p=m?" AND SY_AUDFLAG!='HANDUP' AND "+t+" IN (SELECT KEY_ FROM JBPM4_EXECUTION WHERE PROCDEFID_='"+l+"' AND ID_ IN (SELECT EXECUTION_ID_ FROM JBPM4_TASK WHERE NAME_='"+s+"' AND EXECUTION_ID_ IS NOT NULL AND DBID_ IN (SELECT TASK_ FROM JBPM4_PARTICIPATION WHERE USERID_='"+JE.currentUser.userId+"' AND TYPE_='replaced-assignee')))":" AND 1!=1"}else if("entrust"==d){p=u.entrustAble?" AND SY_AUDFLAG!='HANDUP' AND "+t+" IN (SELECT KEY_ FROM JBPM4_EXECUTION WHERE PROCDEFID_='"+l+"' AND ID_ IN (SELECT EXECUTION_ID_ FROM JBPM4_TASK WHERE NAME_='"+s+"' AND EXECUTION_ID_ IS NOT NULL AND ASSIGNEE_='"+JE.currentUser.userId+"' AND DBID_ NOT IN (SELECT TASK_ FROM JBPM4_PARTICIPATION WHERE TYPE_='owner')))":" AND 1!=1"}else if("round"==d){var h=!1;0<u.roundInfos.length&&(h=!0),p=h?" AND SY_AUDFLAG!='HANDUP' AND "+t+" IN (SELECT KEY_ FROM JBPM4_EXECUTION WHERE PROCDEFID_='"+l+"' AND ID_ IN (SELECT EXECUTION_ID_ FROM JBPM4_TASK WHERE NAME_='"+s+"' AND EXECUTION_ID_ IS NOT NULL AND ASSIGNEE_='"+JE.currentUser.userId+"'))":" AND 1!=1"}var x=this.getStore();JE.DB.setWhereSql(x);var v=x.getProxy().extraParams;v.whereSql=v.whereSql+" "+p,x.loadPage(1)}},getExtendPanels:function(e,r){var t=Ext.decode(Ext.value(e,"[]")),l=[];return r.center&&Ext.each(t,function(e){if("center"==e.region)return t=Ext.isString(e.centerPanels)?Ext.decode(Ext.value(e.centerPanels,"[]")):Ext.value(e.centerPanels,[]),!1}),Ext.each(t,function(e){if((r.center||JE.isNotEmpty(e.region)&&(Ext.isEmpty(r[e.region])||r[e.region]))&&JE.isNotEmpty(e.configInfo)){var t={region:e.region,extendPanel:!0,itemId:e.itemId,split:!0,menuText:e.title,beActive:e.beActive};if(e.height?t.height=Number(e.height):e.width&&(t.width=Number(e.width)),"idit"==e.type)t=Ext.create(e.configInfo,t),l.push(t);else if("chart"==e.type){var i=(n=e.configInfo.split(","))[0],a="true"==n[1]||void 0;chartAttrs=Ext.decode(Ext.value(n[2],"{}")),chartParams=Ext.decode(Ext.value(n[3],"{}")),t=Ext.apply(t,{xtype:"jechartview",chartCode:i,hideSearchBar:a,chartAttrs:chartAttrs,chartParams:chartParams}),l.push(t)}else if("report"==e.type){var n,o=(n=e.configInfo.split(","))[0];a="true"==n[1]||void 0;reportParams=Ext.decode(Ext.value(n[2],"{}")),t=Ext.apply(t,{xtype:"jereportview",reportCode:o,hideSearchBar:a,reportParams:reportParams}),l.push(t)}else-1!=["portal","home"].indexOf(e.type)&&(t.xtype="jeportalview",t.beanId=e.configInfo,l.push(t))}}),l},getListFormTools:function(n){return[{type:"toggle",callback:function(e,t,i){var a=Ext.getCmp(n.funcCode+"_jegridview"+n.idSuffix);e.setHeight(e.getHeight()+a.lastBox.height-100),t.nextSibling().show(),t.hide()}},{type:"collapsed",hidden:!0,callback:function(e,t,i){Ext.getCmp(n.funcCode+"_jegridview"+n.idSuffix);e.setHeight(300),t.previousSibling().show(),t.hide()}},{type:"close",callback:function(e,t,i){var a=Ext.getCmp(n.funcCode+"_jedataview"+n.idSuffix).getDockedItems('box[dock="bottom"]')[0];e.hide(),a.show()}}]},getFormGQ:function(e,t){var i=JE.getLocalLang("core.jeformview.groupQuery"),s=Ext.decode(Ext.value(e.columnOtherConfig,"{}"));JE.isNotEmpty(s.queryXtype)&&(e.xtype=s.queryXtype);var a=e.fieldLabel,n=t.funcCode+"_form",o={name:e.name+"__querytype",ownerName:e.name,formCode:n,xtype:"cbbfield",listConfig:{minWidth:55},width:55,itemId:"queryType",cls:"je-grid-groupquery-type",configInfo:"JE_CORE_COLUMNQUERYTYPE",dicItemCodes:["=","like","like%","in","between"],hideTrigger:!0,listeners:{change:function(e,t,i){var a=e.nextSibling(),n=a.nextSibling();n.setVisible("between"==t),n.setAllowBlank("between"!=t),"rangedatefield"==n.xtype?a.setVisible("between"!=t):a.columnWidth="between"==t?.5:1,e.ownerCt.doLayout()}}},r=JE.CoreUtil.getSearchType(e.xtype);-1==["cgroup","rgroup"].indexOf(e.xtype)&&(o.fieldStyle="border-right-width:0px;"),o.value=o.originalValue=r.value,o.hidden=r.hidden,o.disItemCodes=r.types,e.listeners={keyup:function(e,t){if(13==t.getKey()){var i=e.ownerCt.ownerCt.down("button[ref=groupQuery]");i.fireEvent("click",i)}else if(-1!=["gridssfield","treessfield","queryuserfield"].indexOf(e.xtype)){if(e.selRecId="",JE.isNotEmpty(s.queryType))e.ownerCt.getComponent("queryType").setValue("like")}},change:function(e){var t=e.ownerCt.ownerCt.down("button[ref=groupQuery]");t.fireEvent("click",t)}},e.columnField=!0,delete e.margin,delete e.padding;var l=Ext.clone(e);l.name+="__hidden",l.hidden=!0,l.allowBlank=!0,l.margin="0 0 0 1",l.columnWidth=1,-(e.columnWidth=1)!=["datetimefield","datefield","datemonthfield","numberfield"].indexOf(e.xtype)?(l.hidden=!1,"numberfield"!=e.xtype?(l.xtype="rangedatefield",l.margin="0",e.hidden=!0):(l.columnWidth=.5,e.columnWidth=.5),delete o.listConfig):-1!=["textfield","searchfield","gridssfield","treessfield","queryuserfield","pinyinfield"].indexOf(e.xtype)&&-1!=["gridssfield","treessfield","queryuserfield"].indexOf(e.xtype)&&(e.listeners.beforequery=function(e){var t=e.ownerCt.getComponent("queryType").getValue(),i=e.configInfo.split(",");i.length<4&&(i=[i[0],Ext.value(i[1],""),Ext.value(i[2],""),"S"]),i[3]="in"==t?"M":"S",e.configInfo=i.join(",")},e.listeners.query=function(e,t,i,a){"treessfield"==e.xtype&&(a={pkName:"code"});var n=e.selRecIdField,o=[];if(Ext.isEmpty(n)){var r=e.configInfo.split(",");fieldNames=Ext.value(r[1],""),colNames=Ext.value(r[2],""),Ext.each(colNames,function(e,t){if(a.pkName==e)return n=fieldNames[t],!1})}if(Ext.each(t,function(e){o.push(e.get(n))}),e.selRecId=o.join(","),e.selRecIdField=n,JE.isNotEmpty(s.queryType)){var l=e.ownerCt.getComponent("queryType");l.store.findRecord("code","in")&&l.setValue("in")}});var d={xtype:"button",cls:"btn btn-form",tooltip:i.orderTip,ref:"groupOrderBtn",iconCls:"fa fa-sort",fieldName:e.name},c={xtype:"hidden",name:e.name+"__order"},u=Ext.value(e.colSpan,1)/3,p={xtype:"fieldcontainer",fieldLabel:a,labelWidth:e.labelWidth,hideLabel:e.hideLabel,columnWidth:u,layout:"column",margin:"0 0 2 0",defaults:{hideLabel:!0,xtype:"textfield",formCode:n},items:[o,e,l,d,c]};0<e.width&&(p.width=e.width,delete e.width,delete l.width),Ext.each([e,l],function(e){delete e.hideLabel}),JE.isNotEmpty(s.queryLabel)&&(p.fieldLabel=e.fieldLabel=l.fieldLabel=s.queryLabel),0<s.queryLabelWidth&&(p.labelWidth=JE.toNum(s.queryLabelWidth)),JE.isNotEmpty(s.queryType)&&(o.value=s.queryType,"rangedatefield"==l.xtype&&(l.hidden="between"!=o.value,e.hidden="between"==o.value)),JE.isNotEmpty(s.queryTypes)&&(o.dicItemCodes=s.queryTypes);var f=s.queryTypeHidden||JE.systemConfig.JE_SYS_QUERYTYPEHIDDEN;"1"==f&&(o.hidden=JE.toBool(f)),JE.isNotEmpty(s.orderType)&&(c.value=s.orderType);var E=s.querySortDisabled||JE.systemConfig.JE_SYS_QUERYSORTDISABLED;return"1"==E&&(d.hidden=JE.toBool(E)),p},getUxBarView:function(config){var recdata=config.data,confs=config.configInfo.split(","),valdata={color:"orange",value:0};if(1<confs[0].split(".").length){var fn=eval(confs[0]);valdata=fn.call(fn,recdata)}else{var ddcode=confs[0],dicData=rendererUtil.getDicData({ddCode:ddcode}),code=recdata[confs[1]];Ext.each(dicData,function(e,t){if(e.code==code){var i=dicData.length-1;return valdata.value=t/i*100,valdata.text=e.name,t==i&&(valdata.color="green"),!1}})}var tpl=new Ext.XTemplate("<span>",'<img title="{value}%" src="{boxImage}" width ="{width}" height="{height}"  style=" background-image: url({barImage}); padding: 0px; margin: 0px; background-position: {position}px 50%;">',"<span>  {text}</span>","</span>"),color={red:"/core/ux/base/form/barfield/images/progressbg_red.gif",orange:"/core/ux/base/form/barfield/images/progressbg_orange.gif",green:"/core/ux/base/form/barfield/images/progressbg_green.gif"},data={width:120,height:12,boxImage:"/core/ux/base/form/barfield/images/progressbar.gif",barImage:Ext.value(color[valdata.color],color.green),max:100,value:Ext.value(valdata.value,0)};return data.text=Ext.value(valdata.text,data.value+"%"),data.position=-1*data.width+100*data.value/data.max*data.width/100,tpl.apply(data)},getGridKeyword:function(){this.funcData;return{xtype:"qqfield",width:220,itemId:"queryGridField",emptyText:"Search...",cls:"je-simplebar-keyword",labelSeparator:"",groupSearch:!0,gridObj:this,listeners:{afterrender:function(e){var t=JE.getLocalLang("core.menuHeadSet.func");e.getEl().down(".x-form-search-trigger").update(t.query),e.getEl().down(".x-form-field").insertHtml("beforeBegin",'<i class="search fa fa-search"></i>')}}}},getChangeDataView:function(e,a){return{xtype:"dataview",itemSelector:"",selectedItemCls:"select",overItemCls:"over",cls:"je-mainview-dataview",itemSelector:"div.item",store:Ext.create("Ext.data.Store",{fields:["text","code"],data:e}),itemId:"changeDataView",selModel:{deselectOnContainerClick:!1},mainview:a,tpl:['<div class="label">视图：</div>','<div class="items">','<tpl for=".">','<div class="item">{text}</div>',"</tpl>","</div>"],listeners:{refresh:function(e){var t=a.getLayout().getActiveItem().itemId,i=e.store.findRecord("code",t);e.getSelectionModel().select(i,!1,!0)},selectionchange:function(e,t){a.changeDataView(t[0].get("code"))}}}},getGridQueryTool:function(){var e=this.funcData["query"==this.type?"select":"grid"].groupQuery;return{xtype:"qqfield",labelStyle:"cursor: pointer;font-family: arial;",fieldLabel:JE.getLocalLang("core.jeformview.groupQuery.cbbLabel"),hideLabel:!0,labelWidth:30,width:200,labelAlign:"right",itemId:"queryGridField",cls:"je-grid-quicksearch",emptyText:"Search...",labelSeparator:"",groupSearch:!0,gridObj:this,queryItems:[],trigger3Cls:Ext.baseCSSPrefix+"form-more-trigger",hideTrigger3:JE.isEmpty(e),onTrigger3Click:function(){var e=this.up("jedataview").down("jeformview[region=north]");e&&(e.useCollapse?e[e.collapsed?"expand":"collapse"]():e.setVisible(e.isHidden()))},trigger4Cls:"x-form-arrow-trigger",onTrigger4Click:function(){this.gridObj.searchMenu.showBy(this,"tr-br")},listeners:{afterrender:function(e){e.labelEl&&e.labelEl.on("click",function(){e.gridObj.showMoreSearch()})}}}},buildCXCLInfo:function(n,e){var t=JE.getStore({tableName:"JE_CORE_QUERYSTRATEGY",async:!1,params:{limit:-1,whereSql:" and QUERYSTRATEGY_FUNCCODE = '"+e.funcCode+"' and (QUERYSTRATEGY_USERID = '"+JE.USER.userId+"' or QUERYSTRATEGY_USERID ='' or QUERYSTRATEGY_USERID is null)",orderSql:" order by QUERYSTRATEGY_USERID,SY_ORDERINDEX"}});t.load();var i={store:t,remove:function(t,i){JE.confirm(n.localLang.cxclBar.removeAlert,function(e){if("ok"==e){JE.ajax({url:JE.getUrlMaps("je.core.remove"),params:{ids:t,tableCode:"JE_CORE_QUERYSTRATEGY"}});i()}})},search:function(e,t){var i=[];Ext.each(e,function(e){i.push(e.data)}),JE.Action.doCxclQuery(n,i,!1),t||n.store.loadPage(1,{callback:function(){var t="("+n.store.totalCount+")",i=n.getDockedCmp("queryCL"),a=i.getSelectionModel();i.store.each(function(e){Ext.get(i.getNode(e)).down(".queryitem-count").update(a.isSelected(e)?t:"")})}})}},a=[];t.each(function(e){"1"==e.get("QUERYSTRATEGY_DEF")&&a.push(e)}),0<(i.defRecs=a).length&&i.search(a,!0);var o=this.buildCXCLInfo_default(n,e,i);return"plus"==JE.getTheme()&&(this.buildCXCLInfo_plus(n,e,i),delete o.btn),o},buildCXCLInfo_default:function(t,e,r){var i={bigIconCls:"JE_CORE_CXCL_32",iconCls:"jeicon jeicon-form-query",text:t.localLang.cxclButtonText,hidden:0==r.store.getCount(),handler:function(){var e=t.getDockedCmp("queryCL");e.isHidden()?e.show():e.hide()}};JE.toBigButton(i,e.bigButton);var a=t.localLang.cxclBar;return{bar:{xtype:"dataview",simpleSelect:!e.cxclSelModel,store:r.store,defaultCxcl:r.defRecs,itemId:"queryCL",height:32,dock:"top",cls:"je-grid-cxclview x-panel-body-default",itemSelector:"div.queryitem",tpl:['<i class="fa fa-bars cxclview-deselect" data-qtip="'+a.deselectTip+'" ></i>','<i class="fa fa-close cxclview-close" ></i>','<div class="queryitems">','<tpl for=".">','<div class="queryitem">',JE.CoreUtil.lang_queryStrategy_tpl(),'<span class="queryitem-count"></span>','<tpl if="QUERYSTRATEGY_USERID">','<i value="{JE_CORE_QUERYSTRATEGY_ID}" class="fa fa-close queryitem-remove" data-qtip = "'+t.localLang.cxclBar.removeTip+'"></i>',"</tpl>","</div>","</tpl>","</div>"],refreshItems:function(){this.store.load()},listeners:{afterrender:function(e){JE.isNotEmpty(r.defRecs)&&e.getSelectionModel().select(r.defRecs,!1,!0)},containerclick:function(e,t){var i=Ext.get(t.target);i.hasCls("cxclview-close")?(e.getSelectionModel().deselectAll(),e.hide()):i.hasCls("cxclview-deselect")&&e.getSelectionModel().deselectAll()},itemclick:function(e,t,i,a,n){var o=Ext.get(n.target);if(o.hasCls("queryitem-remove"))return r.remove(o.getAttribute("value"),function(){e.store.load()}),!1},selectionchange:function(e,t){r.search(t)}}},btn:i}},buildCXCLInfo_plus:function(i,e,t){var a={iconCls:"fa fa-bars",text:"查询策略",handler:function(e){var t=i.getDockedCmp("queryCL");t.isHidden()?t.show():t.hide(),i.searchMenu.hide()}};i.searchMenu.add(a)},setTreeDDPlugin:function(e){e.viewConfig=Ext.value(e.viewConfig,{}),e.viewConfig.plugins=Ext.value(e.viewConfig.plugins,[]),e.viewConfig.listeners=Ext.value(e.viewConfig.listeners,{}),e.viewConfig.plugins.push({ptype:"treeviewdragdrop",allowParentInserts:!0,pluginId:"ddOrder",sortOnDrop:!1}),e.viewConfig.listeners=Ext.apply(e.viewConfig.listeners,{beforedrop:function(e,t,i,a,n){t.append=!1,t.order=!1,"append"==a?t.records[0].parentNode.getId()==i.getId()?n.cancelDrop():t.append=!0:(t.records[0].parentNode.getId()==i.parentNode.getId()||(t.append=!0),t.order=!0)},drop:function(e,t,i,a,n){var o=this.panel,r=t.records[0],l={append:t.append,order:t.order};o.doMoveNodeAfter(r,i,l)}})},setGridRowPlugin:function(e){var r=this,l=r.funcData.info.gridRowTip;r.funcData.info.gridRowTipShow?(r.features.push({ftype:"rowbody",getAdditionalData:function(e,t,i,a){return{rowBody:'<div class=x-grid-rowbody-div style="padding:4px 0 4px 4px;">'+(Ext.isArray(l)?JE.toXT(l,i.data):JE.eval(l)(i))+"</div>",rowBodyCls:"my-body-class"}}}),r.features.push({ftype:"rowwrap"})):(r.plugins.push({ptype:"rowexpander",pluginId:"rx",rowBodyTpl:['<div class=x-grid-rowbody-div style="padding:4px 0 4px 4px;">',"</div>"]}),r.constructPlugins(),e.listeners=Ext.value(e.listeners,{}),e.listeners.expandbody=function(e,t,i,a){var n=new Ext.dom.Element(i).down(".x-grid-rowbody-div");n.update("");var o="";Ext.isEmpty(l)||(o=Ext.isArray(l)?JE.toXT(l,t.data):JE.eval(l)(t)),o=Ext.value(o,r.localLang.rowexpanderEmptyText),n.update(o)})},getFormTitleBar:function(e){var t={xtype:"box",data:{},margin:"0 0 10 0",padding:"0 10 10 10",itemId:"formTitleBox",style:"background-color:#FFFFFF;",columnWidth:1,tpl:this.funcData.info.formTitle,listeners:{afterrender:function(e){var t=e.el.child("[name=__body]").getStyle("backgroundColor");Ext.isEmpty(t)||e.el.setStyle("backgroundColor",t)}}};return"jd"==this.funcData.info.formTitleType&&(Ext.apply(t,{padding:"0"}),t.style+="border-bottom:2px dimgray solid;"),t},getFormWFLog:function(){var n=this,o=n.funcData.info;return{xtype:"fieldset",padding:0,border:0,itemId:"__wflog",columnWidth:1,margin:3,style:"padding-top:0px !important;border-radius: 0px;",data:[],tpl:JE.Action.buildWFLogTpl(),loadWfLog:function(e,t){var i=Ext.value(e,n.getForm().getValues()),a=i[o.pkName];Ext.isEmpty(a)||JE.isEmpty(i.SY_AUDFLAG)||"NOSTATUS"==i.SY_AUDFLAG?this.update([]):(Ext.isEmpty(t)&&(t=JE.ajax({url:JE.getUrlMaps("je.core.wf.processInfo","loadProcessHistory"),params:{tableCode:o.tableName,pkValue:a}})),this.update(t))}}},getFormHistory:function(){var o=this,r=o.funcData.info;return{xtype:"fieldset",border:0,itemId:"__history",padding:"0",style:"padding-top:0px !important;border-radius: 0px;",columnWidth:1,data:[],tpl:['<table class="je-form-history">',"<tr>","<th width=100 >"+o.localLang.historySet.modifyUser+"</td>","<th width=150 >"+o.localLang.historySet.modifyTime+"</td>","<th>"+o.localLang.historySet.modifyContent+"</td>","</tr>",'<tpl for=".">',"<tr>","<td>{SY_CREATEUSERNAME}</td>","<td>{SY_CREATETIME}</td>",'<td align="left">','<tpl for="Ext.decode(PAGENICKED_NICKED)">','<span class="keyword">{text}</span> '+o.localLang.historySet.by+' <span class="keyword">{[Ext.value(values.oldVal,"“”")]}</span> '+o.localLang.historySet.instead+' <span class="keyword">{[Ext.value(values.newVal,"“”")]}</span></br>',"</tpl>","</td>","</tr>","</tpl>","</table>"],loadHistory:function(e,t){var i=Ext.value(e,o.getForm().getValues())[r.pkName];if(Ext.isEmpty(i))this.update([]);else{var a=r.funcCode;if(r.otherConfig){var n=JE.getObjAttr(r.otherConfig,"historyFuncCode");JE.isNotEmpty(n)&&(a=n)}Ext.isEmpty(t)&&(t=JE.ajax({url:JE.getUrlMaps("je.core.load"),params:{tableCode:"JE_CORE_PAGENICKED",limit:-1,whereSql:" and PAGENICKED_FUNCCODE = '"+a+"' and PAGENICKED_BUSINESSID = '"+i+"'",orderSql:" order by SY_CREATETIME desc"}}).rows),this.update(t)}}}},eachAllChild:function(e,t){var i=this;e.eachChild(function(e){t(e),e.hasChildNodes()&&i.eachAllChild(e,t)})}}),Ext.define("JE.core.action.ChildAction",{doChildSave:function(e,t){t=Ext.value(t,"form");var i=e.funcCode,a=Ext.value(e.idSuffix,""),n=i+"_childs_"+t+a;if(Ext.getCmp(n)){var o=[],r=Ext.getCmp(i+"_childs_"+t+"_H"+a);r&&o.push(r.getActiveTab());var l=Ext.getCmp(i+"_childs_"+t+"_V"+a);l&&(o=o.concat(l.items.items)),Ext.each(o,function(e){if("jemainview"==e.xtype&&"treegrid"!=e.showView){var t=e.funcData,i=Ext.getCmp(t.info.funcCode+"_jegridview"+t.info.idSuffix);if(i)if(0<i.store.getUpdatedRecords().concat(i.store.getNewRecords()).length&&i.gridUpdateBtnPrem()){var a=i.getDockedComponent("buttonBar").down("button[ref=gridUpdateBtn]");a&&a.fireHandler()}}})}},doChildParentSave:function(e,t,i){var a=t.funcCode,n=Ext.value(t.idSuffix,""),o=!0;if(Ext.getCmp(a+"_jemainview"+n).childFunc&&e){if(!e.getForm().isValid())return JE.msg("请先保存主功能"),!1;JE.isNotEmpty(e.funcData.form.uploadField)&&(o=!1,e.on({endsubmit:{fn:function(){i()},single:!0}}));var r=e.getDockedComponent("buttonBar").down("button[ref=formSaveBtn]");r&&r.fireEvent("click",r)}return o},doChildAdd:function(e,t,i){var a=!0;i=Ext.value(i,Ext.emptyFn);if(e&&1==t.childFunc)if(Ext.isEmpty(e.mainInfo))JE.alert("请选择一条主功能数据，再进行添加..."),a=!1;else if("data"==t.parentType){var n=Ext.getCmp(e.mainInfo.funcCode+"_jegridview"+t.idSuffix);if(n)1!=n.getSelectionModel().getSelection().length&&(JE.alert("请选择一条主功能数据，再进行添加..."),a=!1)}else{var o=Ext.getCmp(e.mainInfo.funcCode+"_jeformview"+t.idSuffix);if(o){var r=o.form.findField(e.mainInfo.pkName);r&&Ext.isEmpty(r.getValue())&&(a=this.doChildParentSave(o,t,i))}}return a&&i(),a},doChildVisible:function(e,t,i){e&&(-1!=["tabpanel","jeeditview"].indexOf(e.ownerCt.xtype)?(i="jeeditview"==e.ownerCt.xtype?i:"first",e.ownerCt.setItemVisible(e,t,i)):e.setVisible(t))}}),Ext.define("JE.core.action.FormAction",{doReadFuncEdit:function(e,t){var i=e.funcData.info,a=e.getValue(i.pkName);i.funcEdit&&JE.isNotEmpty(a)&&(t&&"0"==t.get("SY_FUNCEDIT")||JE.ajax({url:"/je/readFuncEdit",params:{tableCode:i.tableName,funcCode:i.funcCode,pkValue:a}}).success&&t.set("SY_FUNCEDIT","0"))},checkFieldValid:function(a,e,t){var i=[];a.getFields().each(function(e){e.isValid&&!e.isValid()&&i.push({id:e.id,text:e.fieldLabel,code:e.name,errors:e.getErrors()})});var n=JE.isEmpty(i),o="grid"==t?"r":"l";return a.errorMenu||(a.errorMenu=Ext.create("grid"==t?"Ext.menu.Menu":"Ext.panel.Panel",{plain:!0,floating:!0,shadow:!1,minWidth:260,width:260,closeAction:"hide",cls:"je-menu-arrow je-menu-arrow-t"+o,padding:0,layout:"column",defaults:{columnWidth:1},items:[{xtype:"box",html:'<div style="padding: 10px;font-size: 14px;text-align: center;color: #7b7b7b;"><i class="jeicon jeicon-lightbulb" style="margin-right:5px;"></i>操作前满足以下条件</div>'},{xtype:"box",itemId:"errorBox",maxHeight:400,autoScroll:!0,padding:"5 10 10 10",tpl:['<tpl for=".">','<div class="field" style="line-height:2;font-weight: bold;color: #444;cursor: pointer;font-size:14px;" data-id="{id}" data-code="{code}">{text}</div>','<tpl for="errors">','<div class="field-error" data-code="{parent.code}" style="line-height:2;cursor: pointer;color:#D24D57;padding-left:5px;"><div style="padding: 4px;background: #D24D57;display: inline-block;border-radius: 100%;margin-right: 10px;"></div>{.}</div>',"</tpl>","</tpl>"],data:[],listeners:{afterrender:function(e){"grid"!=t&&e.getEl().on("click",function(e){var t=e.getTarget(".field",1,!0),i=e.getTarget(".field-error",2,!0);(t||i)&&JE.Action.doLocation(a,(t||i).getAttribute("data-code"))})}}},{xtype:"box",html:'<div class="close" style="cursor: pointer;text-align: center;line-height: 40px;border-top: 1px solid #e8e8e8;color: #7b7b7b;font-size: 14px;">关闭提示</div>',listeners:{afterrender:function(e){e.getEl().on("click",function(e){a.errorMenu.hide()})}}}]})),a.errorMenu.getCmp("errorBox").update(i),e&&!n&&(window.__active_form_errormenu&&a.errorMenu.id!=window.__active_form_errormenu&&Ext.getCmp(window.__active_form_errormenu).hide(),a.errorMenu.showBy(e,"t"+o+"-b"+o,[10,10]),window.__active_form_errormenu=a.errorMenu.id),n},doLocation:function(e,t){var i=e.getCmp("editBox");if(i){var a,n=i.getCmp("centerBox").getEl();Ext.isString(t)&&(t={type:"field",code:t}),(a="child"==t.type?Ext.getCmp(t.code):e.getFields(t.code))&&JE.scrollBy(n,a.getEl(),!0)}},doCopy:function(e){var t=e.funcData,i=t.info,a=e.getValue();Ext.iterate(a,function(e,t){e!=i.pkName&&0!=e.indexOf("SY_")||(a[e]="")});var n=t.getDefVals(e.mainData);Ext.apply(n,Ext.value(e.mainData,{}));var o=JE.getFuncView(i.funcCode,"grid",i.idSuffix);o&&(n=this.doDefaultValues(Ext.value(o.mainData,{}),i)),Ext.apply(a,n);var r=Ext.create(i.modelName,a);e.loadRecord(r),0!=e.useChild&&JE.CoreUtil.setChildInfo({funcData:t,data:a,readOnly:e.readOnly})},doCopyOrNew:function(t,e,i,a){var n=t.funcData,o=e.tableName,r=t.getForm().findField(e.pkName);t.localLang||(t.localLang=JE.getLocalLang("core.jeformview"));var l="",s={},d=JE.getFuncView(e.funcCode,"grid",e.idSuffix),c=!1;if("new"==i){l=t.localLang.alert.saveNew;var u=n.getDefVals(t.mainData);Ext.apply(u,Ext.value(t.mainData,{})),d&&(u=this.doDefaultValues(Ext.value(d.mainData,{}),e));var p=Ext.create(e.modelName,u);s=p.data}else if("copy"==i){if(l=t.localLang.alert.saveCopy,JE.isEmpty(r.getValue()))return void JE.alert("请先保存数据才能复制!");var f=JE.ajax({url:Ext.value(e.funcAction,JE.getUrlMaps("je.core.copy")),params:{tableCode:o,funcCode:e.funcCode,codeGenFieldInfo:Ext.encode(n.form.textcodeFields),pkValue:r.getValue()}});f.success?(s=f.obj,JE.Action.doTreeSave(s,e,!0)):(l=t.localLang.alert.saveCopyError,JE.error(f.obj,f)),c=!0}a&&JE.isNotEmpty(a.msg)&&"null"!=a.msg.toLowerCase()&&(l=a.msg),a.msgFn?a.msgFn(action.result,l):JE.msg(l),t.wfInfo&&t.wfInfo.currentTasks&&1<t.wfInfo.currentTasks.length&&(s.__doTask=t.wfInfo.doTaskName),JE.isNotEmpty(n.form.uploadField)&&JE.isNotEmpty(n.form.ckeditorFields)&&Ext.each(n.form.ckeditorFields,function(e){s[e]=t.getValue(e)}),t.setValues(s,c),0!=t.useChild&&JE.CoreUtil.setChildInfo({funcData:n,data:s,readOnly:t.readOnly})},doButtonStatus:function(e,t){if(e)if("doing"==t)e.setIconCls("fa fa-spinner fa-spin"),e.setDisabled(!0);else if("done"==t)setTimeout(function(){e&&e.getEl()&&(e.setIconCls(e.initialConfig.iconCls),e.setDisabled(!1))});else if("isDoing"==t)return e.isDisabled()},doUpdate:function(m,g,h,x){var v=this,y=m.funcData,b=g.tableName,e=m.getForm().findField(g.pkName),C=Ext.isEmpty(e.getValue())?"doSave":"doUpdate";if(m.isValid())if("0"!=JE.systemConfig.JE_SYS_SAVETYPE||-1==["new","copy"].indexOf(h))if(JE.Action.doButtonStatus(x,"doing"),"doUpdate"==C&&JE.Action.doChildSave(g,"form"),m.localLang||(m.localLang=JE.getLocalLang("core.jeformview")),0!=m.fireEvent("beforesubmit",m,C,h)){var t={};x.expandParams&&(t=x.expandParams);var i=JE.getObjAttr(g.otherConfig,"jeFileType")||"PROJECT",a=JE.toNum(JE.getObjAttr(g.otherConfig,"formTimeout")||"10");JE.submit(m,{async:!0,url:Ext.value(g.funcAction,JE.getUrlMaps("je.core"))+JE.getUrlMaps("method."+C),msgFn:x.msgFn,timeout:a,params:Ext.apply({funcCode:g.funcCode,funcEdit:!0,jeFileType:i,codeGenFieldInfo:Ext.encode(y.form.textcodeFields),tableCode:b,funcType:g.funcType,viewTableCode:"view"==g.funcType?g.viewTableName:"",viewConfigInfo:"view"==g.funcType?g.viewConfigInfo:"",ckeditorFields:Ext.isEmpty(y.form.uploadField)?"":Ext.value(y.form.ckeditorFields,[]).join(","),uploadableFields:Ext.value(y.form.uploadField,[]).join(","),batchFilesFields:Ext.value(y.form.batchFilesField,[]).join(","),filePath:g.filePath},t),error:function(e,t){JE.Action.doButtonStatus(x,"done")},success:function(e,t){var o=t.result.obj,i="",a=Ext.clone(o);if("doSave"==C?(i=m.localLang.alert.add,JE.Action.doTreeSave(o,g)):(i=m.localLang.alert.update,JE.Action.doTreeUpdate([o],g),Ext.isEmpty(y.form.historyFields)||m.addHistory(function(){m.formHistorySet&&m.formHistorySet.loadHistory()})),!Ext.isEmpty(y.form.childFuncFields)){var n=m.query("childfuncfield[formCode="+g.funcCode+"_form]");Ext.each(n,function(e){e.doSave(o)})}m.fireEvent("aftersubmit",m,C,h,o);var r,l=[Ext.clone(o)];if("doUpdate"==C){var s=Ext.clone(l[0]);m.getChanges(!0).each(function(e){s[e.name]=e._oldVal||e.oldVal}),r=[s]}var d=JE.getFuncView(g.funcCode,"grid",g.idSuffix);if("new"==h){i=m.localLang.alert.saveNew;var c=y.getDefVals(m.mainData);Ext.apply(c,Ext.value(m.mainData,{})),d&&(c=v.doDefaultValues(Ext.value(d.mainData,{}),g));var u=Ext.create(g.modelName,c);o=u.data}else if("copy"==h){i=m.localLang.alert.saveCopy,C="doSave";var p=JE.ajax({url:Ext.value(g.funcAction,JE.getUrlMaps("je.core"))+JE.getUrlMaps("method.copy"),params:{tableCode:b,funcCode:g.funcCode,codeGenFieldInfo:Ext.encode(y.form.textcodeFields),pkValue:o[g.pkName]}});p.success?(o=p.obj,JE.Action.doTreeSave(o,g,!0)):(i=m.localLang.alert.saveCopyError,JE.error(p.obj,p))}if(m.doAct=C,x&&JE.isNotEmpty(x.msg)&&"null"!=x.msg.toLowerCase()&&(i=x.msg),x.msgFn?x.msgFn(t.result,i):JE.msg(i),x.expandParams&&delete x.expandParams,m.wfInfo&&m.wfInfo.currentTasks&&1<m.wfInfo.currentTasks.length&&(o.__doTask=m.wfInfo.doTaskName),JE.isNotEmpty(y.form.uploadField)&&JE.isNotEmpty(y.form.ckeditorFields)&&Ext.each(y.form.ckeditorFields,function(e){o[e]=m.getValue(e)}),e.setValues(o,!1),d){var f,E=[];if("doSave"==C)if(JE.isEmpty(g.merges))E=d.store.insert(0,a),d.refershRowNumber();else d.store.load(),(f=d.store.getById(o[g.pkName]))&&(E=[f],f.set(a),f.commit());else(f=d.store.getById(o[g.pkName]))&&(E=[f],f.set(o),f.commit());"new"==h?d.getSelectionModel().deselectAll():!g.simpleBar&&JE.isNotEmpty(E)&&d.getSelectionModel().select(E)}0!=m.useChild&&(g.oneToForm&&Ext.each(y.child,function(e){var t=JE.getFuncView(e.code,"grid");if(t){var i=JE.CoreUtil.buildChildSql(y.info,e.fields,o);if(JE.isNotEmpty(i.updateFields)){t.funcData.info;var a=Ext.value(t.store.sqls,{}),n=JE.DB.buildWhereSql(i.whereFields)+" "+Ext.value(a.basic,"")+" "+Ext.value(a.treeFunc,"");JE.ajax({url:JE.getUrlMaps("je.core.listUpdate"),params:Ext.apply({tableCode:b,whereSql:n},i.updateFields)})}}}),JE.CoreUtil.setChildInfo({funcData:y,data:o,readOnly:m.readOnly})),m.fireEvent("endsubmit",m,C,h,o),JE.CoreUtil.doDataFlow("formSaveBtn",y,l,r,m.mainData),JE.Action.doButtonStatus(x,"done")}})}else JE.Action.doButtonStatus(x,"done");else v.doCopyOrNew(m,g,h,x)},doSh:function(i,e,t,a){var n={SY_ACKTIME:JE.DATE.formatDateTime(new Date),SY_ACKUSERNAME:JE.currentUser.username,SY_ACKUSERID:JE.currentUser.userId,SY_ACKFLAG:"1"};a.msg="审核已提交!";var o="你是否要提交审核?";if(a.submitMsg&&(o=a.submitMsg),a.submitEndMsg&&(a.msg=a.submitEndMsg),"cacel"==t){a.msg="已撤销审核!",a.cacelEndMsg&&(a.msg=a.cacelEndMsg);var r=i.form.findField("SY_ACKUSERID").getValue();if(JE.isNotEmpty(r)&&JE.currentUser.userId!=r)return void JE.alert("您不是审核人,只有审核人才可以撤销审核!");o="你是否要撤销审核?",a.cacelMsg&&(o=a.cacelMsg),n={SY_ACKTIME:"",SY_ACKUSERNAME:"",SY_ACKUSERID:"",SY_ACKFLAG:"0"}}JE.confirm(o,function(e,t){"ok"==e&&(i.setValues(n),JE.Action.doUpdate(i,i.funcData.info,"save",a))})},doBack:function(i,e){i.errorMenu&&i.errorMenu.hide();var a=Ext.getCmp(e.funcCode+"_jecenterview"+e.idSuffix),n=Ext.getCmp(e.funcCode+"_jedataview"+e.idSuffix);if(i.formGrid&&i.formGrid.setGridVisible(!1),a&&n){var t=0;e.viewTableName==e.tableName&&(t=i.getChanges().getCount());var o=i.getButton("formSaveBtn");0<t&&o&&!o.isHidden()?JE.dialog("数据有改动，未保存，确定返回吗？",function(e){if("back"==e)a.getLayout().setActiveItem(n);else if("save"==e){i.on({endsubmit:{fn:function(){a.getLayout().setActiveItem(n)},scope:i,single:!0}});var t=i.getButton("formSaveBtn");t&&t.fireHandler()}},{buttons:{back:{text:"确定返回",btnClass:"btn-blue"},save:"保存返回",cancel:"取消"},icon:"fa fa-question-circle"}):a.getLayout().setActiveItem(n)}},doBuildEdit:function(e){var t=Ext.getCmp(e.funcCode+"_jecenterview"+e.idSuffix);if(t&&!t.buildItems){var i=new Date;t.buildItem(),JE.timeLog(i,"首次创建 "+e.funcName+"("+e.funcCode+") 的表单耗时")}},doListForm:function(e,t){var i=JE.getFuncView(t.funcCode,"formlist",t.idSuffix);if(i){var a=Ext.getCmp(t.funcCode+"_jedataview"+t.idSuffix).getDockedItems('box[dock="bottom"]')[0];Ext.isEmpty(e)?(i.hide(),a.show()):(Ext.isEmpty(e.get(t.pkName))&&(i.show(),a.hide()),i.isHidden()||(i.form.reset(),i.loadRecord(e)))}},doFormUpAdd:function(e,t){e.getSelectionModel().deselectAll();var i=Ext.create(e.store.model.$className,this.doDefaultValues(e.mainData,t));this.doListForm(i,t)},doFormWinAdd:function(e,t,i){var a=this;i||e.getSelectionModel().deselectAll();i=i||a.doDefaultValues(e.mainData,t);JE.showFunc(t.funcCode,{type:"form",useForm:!0,values:i,useTreeDefVals:!0,title:JE.getLocalLang("core.jeformview").doFormWinAddTitle,idSuffix:t.idSuffix,winConfig:{cancelButtonText:"关闭"},callback:function(e){e.funcData.info.idSuffix=t.idSuffix}})},buildFieldExp:function(e,t){var r=/\{.*?\}/g,l=e.basicFields,s={},i={bindingExp:e.bindingExp,visibleExp:e.visibleExp,readOnlyExp:e.readOnlyExp,allowBlankExp:e.allowBlankExp};return-1!=["grid","gridField"].indexOf(t)&&(i={bindingExp:e.bindingExp}),"grid"==t?Ext.iterate(e.bindingExp.field,function(e,t){s[e]={exp:t.bindingExp,fn:t.bindingExpFn}}):Ext.iterate(i,function(o,e){Ext.iterate(e,function(n,e){Ext.iterate(e,function(t,i){var a=[],e=[];Ext.isEmpty(i[o+"Fn"])?e=i[o].match(r):JE.isNotEmpty(i[o])&&(e=i[o].split(",")),Ext.each(e,function(e){e=e.replace("{","").replace("}",""),l[e]&&a.push(e)}),0==a.length&&a.push(t),Ext.each(a,function(e){s[e]=Ext.value(s[e],{}),s[e][o]=Ext.value(s[e][o],{}),s[e][o][n]=Ext.value(s[e][o][n],{}),s[e][o][n][t]={exp:i[o],fn:i[o+"Fn"],names:a,fire:e!=t}})})})}),s},bindingFieldExp:function(a,e){var t=a.funcData,n=[],i="jegridview"==a.xtype?t.gridFieldExp:t.fieldExp;e?n.push(e):Ext.iterate(i,function(e,t){var i=a.getFields(e);JE.isNotEmpty(i)&&n.push(i)}),Ext.each(n,function(e){e.on("change",function(){JE.Action.doFieldExp(a,e)})})},bindingColumnExp:function(a){this.bindingFieldExp(a);var d="bindingExp";Ext.iterate(a.funcData.gridFieldExp,function(e,t){if(t[d]&&t[d].field){var i=a.getColumn(e);i&&(i.bindingExpInfo=t[d].field,i.on("edit",function(e,t){var r=t.record,l=r.data,s=t.grid;Ext.iterate(e.bindingExpInfo,function(e,t){var i=t.exp,a=t.fn;if(t.fire){var n=!0,o=Ext.value(s.mainData,{});if(Ext.isEmpty(a))i=JE.toXT(i,l,o),n=Ext.value(JE.eval(i,JE.format(s.localLang.alert.expError,d,i),!1),!1);else n=!!(a=JE.eval(a,JE.format(s.localLang.alert.expFnError,d,a),!1))&&Ext.value(a(l,o,s),!0);!1!==n&&r.set(e,n)}})}))}})},doFieldExp:function(u,e,t,p){if(!JE.isEmpty(e)){var f,E,m=t,i={},g=Ext.value(u.funcData.info.idSuffix,"");i="jegridview"==u.xtype?(f=u,m=Ext.value(m,f.getValues()),f.funcData.gridFieldExp[e.name]):(E=u,m=Ext.value(m,E.form.getValues()),E.funcData.fieldExp[e.name]),m.hasOwnProperty(e.name)||(m[e.name]=e.getValue()),Ext.iterate(i,function(c,e){Ext.iterate(e,function(d,e){Ext.iterate(e,function(e,t){var i,a=t.exp,n=t.fn,o=t.fire;if(p||o){switch(d){case"field":i=f?f.getFields(e):(i=E.form.findField(e))||E.down("[name="+e+"][formCode="+E.funcData.info.funcCode+"_form]");break;case"formButton":i=E.getButton(e);break;case"child":i=Ext.getCmp(e+g)}if(i){var r=!0,l="",s=Ext.value(u.mainData,{});if(Ext.isEmpty(n))a=JE.toXT(a,m,s),l=JE.eval(a,JE.format(u.localLang.alert.expError,c,a),!1),r=Ext.value(l,!1);else r=!!(n=JE.eval(n,JE.format(u.localLang.alert.expFnError,c,n),!1))&&(l=n(m,s,u,p),Ext.value(l,!0));switch(c){case"visibleExp":"child"==d?JE.Action.doChildVisible(i,r,u):(i.ownerCt&&"fieldcontainer"==i.ownerCt.xtype&&i.ownerCt.setVisible(r),i.setVisible(r));break;case"readOnlyExp":i.setReadOnly(r);break;case"allowBlankExp":i.ownerCt&&"fieldcontainer"==i.ownerCt.xtype&&i.ownerCt.setAllowBlank(r),i.setAllowBlank(r);break;case"bindingExp":i.setValue(l),p&&i.resetOriginalValue&&i.resetOriginalValue()}}}})})})}}}),Ext.define("JE.core.action.GridAction",{doAdd:function(e,t,i){var a=this;e.getSelectionModel().deselectAll(),JE.Action.doChildAdd(e,t,function(){switch(t.insertType){case"LIST":a.doSave(e,t,i);break;case"FORM":a.doEdit(e,null,t);break;case"FORMWIN":a.doFormWinAdd(e,t);break;case"FORMUP":a.doFormUpAdd(e,t)}})},doSave:function(n,o,r){var l=this,s=n.funcData,d=n.store,c=d.model.$className;if(n.localLang||(n.localLang=JE.getLocalLang("core.jegridview")),0<d.getUpdatedRecords().length)JE.alert(n.localLang.alert.noSaveAdd);else{var e=l.doDefaultValues(n.mainData,o),u=n.localLang.alert.add;if(r&&JE.isNotEmpty(r.msg)&&(u=r.msg),Ext.isEmpty(s)){var t=JE.ajax({url:Ext.value(o.url,d.actUrls.save),params:Ext.apply({tableCode:o.tableName,funcCode:o.funcCode},e)});if(t.success){var i=Ext.create(c,t.obj);d.insert(0,i),n.refershRowNumber&&n.refershRowNumber(),JE.Action.doTreeSave(t.obj,o),JE.msg(u),r&&r.callback&&r.callback(t.obj)}else JE.alert(t.obj)}else{if("view"==o.funcType&&((e=Ext.value(e,{})).funcType=o.funcType,e.viewTableCode=o.viewTableName,e.viewConfigInfo=o.viewConfigInfo),!n.isValid())return void JE.Action.checkFieldValid(n,r,"grid");n.doSubmit({url:Ext.value(o.url,d.actUrls.save),params:Ext.apply({tableCode:o.tableName,uploadableFields:Ext.value(s.grid.uploadField,[]).join(","),batchFilesFields:Ext.value(o.batchFilesField,[]).join(","),filePath:o.filePath,codeGenFieldInfo:Ext.encode(s.grid.textcodeFields),funcCode:o.funcCode},e),success:function(e){var t=Ext.decode(Ext.value(e.responseText,"{}"));if(t.success){var i=l.doDefaultValues(n.mainData,o,{noTree:"tree"==o.funcType});if(n.reset(),n.setValues(i),JE.isNotEmpty(o.merges))d.load();else{var a=Ext.create(c,t.obj);d.insert(0,a)}JE.Action.doTreeSave(t.obj,o),JE.msg(u),r&&r.callback&&r.callback(t.obj),JE.CoreUtil.doDataFlow("gridInsertBtn",s,[t.obj],void 0,n.mainData)}else JE.alert(t.obj)}})}}},doUpdateList:function(e,n,t,i){var a=e.getPlugin("cellEdit");e.localLang||(e.localLang=JE.getLocalLang("core.jegridview")),a&&a.completeEdit(),JE.Action.doChildSave(n,"data");var o=e.getStore(),r=n.pkName,l=n.tableName,s=Ext.value(t,o.getUpdatedRecords().concat(o.getNewRecords()));if(Ext.isEmpty(s))JE.msg(e.localLang.alert.editNoEdit);else{var d=[],c=[];Ext.Array.each(s,function(t){var i=t.getChanges();if(!Ext.Object.isEmpty(i)){i[r]=t.data[r],Ext.isEmpty(n.updateFields)||Ext.each(n.updateFields,function(e){i[e]=Ext.value(t.data[e],"")}),d.push(i);var e=Ext.clone(t.data);for(var a in t.modified)e[a]=t.modified[a];c.push(e)}});var u={};"view"==n.funcType&&(u.viewTableCode=n.viewTableName,u.funcType=n.funcType,u.viewConfigInfo=n.viewConfigInfo);var p=JE.ajax({url:Ext.value(n.url,o.actUrls.updateList),params:Ext.apply({strData:Ext.encode(d),tableCode:l,funcCode:n.funcCode},u)}),f=p.obj;if(i&&JE.isNotEmpty(i.msg)&&(f=i.msg),1==p.success){JE.msg(f);var E=[];Ext.each(s,function(e){e.commit(),E.push(e.data)}),JE.Action.doTreeUpdate(E,n),JE.Action.doListForm(null,n),JE.CoreUtil.doDataFlow("gridUpdateBtn",e.funcData,E,c,e.mainData)}else JE.alert(f)}},doRemove:function(r,l,e,s,d){var c=r.getStore(),t=l.pkName,u=l.tableName,i=Ext.value(e,r.getSelectionModel().getSelection());r.localLang||(r.localLang=JE.getLocalLang("core.jegridview"));var p=[],a=!1,n=!0,f=[];if(Ext.Array.each(i,function(e){p.push(e.get(t)),f.push(e.data),r.funcData&&r.funcData.permInfo.selfDelete&&e.get("SY_CREATEUSER")!=JE.currentUser.userCode&&(a=!0),1!=l.wf||Ext.isEmpty(e.get("SY_AUDFLAG"))||-1!=["NOSTATUS","SUSPEND",""].indexOf(e.get("SY_AUDFLAG"))||(n=!1)}),0!=p.length)if(a)JE.alert(r.localLang.alert.removeSelf);else if(n){var o=r.localLang.alert[s?"disableConfirm":"removeConfirm"];o=JE.toXT(o,{num:p.length}),JE.confirm(o,function(e){if("ok"==e){var t=Ext.value(l.url,s?c.actUrls.disable:c.actUrls.remove),i={};"view"==l.funcType&&(i.viewTableCode=l.viewTableName,i.funcType=l.funcType,i.viewConfigInfo=l.viewConfigInfo);var a=JE.ajax({url:t,params:Ext.apply({ids:p.join(","),tableCode:u,funcCode:l.funcCode,funcId:l.funcId,mark:l.mark,postil:l.postil,funcEdit:l.funcEdit,doTree:"tree"==l.funcType,uploadableFields:Ext.value(Ext.value(l.uploadField,l.ckeditorFields),[]).join(","),batchFilesFields:Ext.value(l.batchFilesField,[]).join(",")},i)}),n=a.obj;if(d&&JE.isNotEmpty(d.msg)&&(n=d.msg),1==a.success){JE.msg(n);var o=c.currentPage;c.getCount()==p.length&&1<o&&o--,c.loadPage(o,{callback:function(){}}),JE.Action.doTreeRemove(p,l),JE.Action.doListForm(null,l),d&&d.fireEvent("afterclick",d),JE.CoreUtil.doDataFlow("gridRemoveBtn",r.funcData,f,void 0,r.mainData)}else JE.alert(n)}})}else JE.alert(r.localLang.alert.removeStartWf);else JE.alert(r.localLang.alert.removeNoSelect)},doFormWinEdit:function(e,t,i){JE.showFunc(i.funcCode,{type:"form",useForm:!0,values:t.data,useTreeDefVals:!0,title:JE.getLocalLang("core.jeformview").doFormWinAddTitle,idSuffix:i.idSuffix,winConfig:{cancelButtonText:"关闭"},callback:function(e){e.funcData.info.idSuffix=i.idSuffix}})},doEdit:function(a,n,o){var r=this,l=o.idSuffix,s=Ext.getCmp(o.funcCode+"_jemainview"+l),d=(new Date,o.funcName+"("+o.funcCode+")"),e={};e=a&&!a.localLang?(a.localLang=JE.getLocalLang("core.jegridview"),a.localLang):JE.getLocalLang("core.jegridview"),JE.doMask(s,e.doEditMask,function(){if(JE.infoLog("----------"+d+" 表单装载开始----------"),null==n){if(!JE.Action.doChildAdd(a,o))return;n=Ext.create(o.modelName,r.doDefaultValues(s.mainData,o))}JE.Action.doBuildEdit(o);var e=Ext.getCmp(o.funcCode+"_jecenterview"+l),t=Ext.getCmp(o.funcCode+"_jeeditview"+l),i=Ext.getCmp(o.funcCode+"_jeformview"+l);e.getLayout().setActiveItem(t),t.setActiveTab(i),JE.Action.doEditForm(i,n)})},doEditForm:function(e,t,i){var a=e.funcData.info,n=a.funcName+"("+a.funcCode+")",o=Ext.getCmp(a.funcCode+"_jemainview"+a.idSuffix),r=t.data.SY__POSTIL;if(t&&a.columnLazy){var l=JE.ajax({url:Ext.value(a.funcAction,JE.getUrlMaps("je.core"))+JE.getUrlMaps("method.getInfoById"),params:{tableCode:a.viewTableName,pkValue:t.get(a.pkName)}});if(l){var s=t.getChanges();Ext.each(["SY__MARK","SY_FUNCEDIT"],function(e){delete l[e]}),Ext.apply(t.data,l),t.commit(!0),JE.isNotEmpty(s)&&t.set(s)}}if(r&&(t.data.SY__POSTIL=r),e.form.reset(!0),e.loadRecord(t),e.body){var d=e.getCmp("editBox");d&&d.getCmp("centerBox").getEl().scrollTo("top",0),e.leftNavbar&&e.leftNavbar.selectItem(0)}e.isValid(),e.formGrid&&e.formGrid.loadInfo(t,i);var c=new Date;JE.CoreUtil.setChildInfo({funcData:e.funcData,data:t.getData(),readOnly:o&&o.readOnly||e.readOnly}),JE.timeLog(c,n+" 表单子功能数据加载耗时"),e.fireEvent("selfactivate",e),JE.Action.doReadFuncEdit(e,t)},doExpExcel:function(l,s){l.localLang||(l.localLang=JE.getLocalLang("core.jegridview"));var d=l.localLang.expExcel;JE.formWin({title:d.title,width:450,height:170,border:0,frame:!0,autoShow:!0,formConfig:{bodyPadding:"10 10 0 10"},formDefaults:{},items:[{xtype:"textfield",name:"title",allowBlank:!1,fieldLabel:d.titleLabel},{xtype:"textfield",name:"fileName",allowBlank:!1,fieldLabel:d.fileNameLabel},{xtype:"rgroup",name:"expType",fieldLabel:d.expTypeLabel,value:"NOWPAGE",dataArray:[{id:"NOWPAGE",text:d.expTypeData.NOWPAGE,code:"NOWPAGE"},{id:"SELECTION",text:d.expTypeData.SELECTION,code:"SELECTION"},{id:"ALL",text:d.expTypeData.ALL,code:"ALL"}]},{xtype:"rgroup",name:"styleType",fieldLabel:d.styleTypeLabel,value:"GRID",dataArray:[{id:"GRID",text:d.styleTypeData.GRID,code:"GRID"},{id:"REPORT",text:d.styleTypeData.REPORT,code:"REPORT"}]},{xtype:"hidden",name:"docFolderId",fieldLabel:d.docFolderIdLabel}],fn:function(e,t){var i=l.getStore(),a=i.proxy.extraParams,n={title:e.title,fileName:e.fileName,tableCode:s.tableName,funcId:s.funcId,orderSql:a.orderSql,docFolderId:e.docFolderId};if("view"==s.funcType&&JE.isNotEmpty(s.viewTableName)&&(n.tableCode=s.viewTableName),"ALL"==e.expType)n.whereSql=a.whereSql;else if("NOWPAGE"==e.expType){var o=new Array;i.each(function(e){o.push(e.get(s.pkName))}),n.whereSql=" AND "+s.pkName+" IN ('"+o.join("','")+"')"}else if("SELECTION"==e.expType){o=new Array;Ext.each(l.getSelectionModel().getSelection(),function(e){o.push(e.get(s.pkName))}),n.whereSql=" AND "+s.pkName+" IN ('"+o.join("','")+"')"}if(n.styleType=e.styleType,"REPORT"==e.styleType&&!s.gridPrintInfo.relColumns)return JE.alert(d.styleTypeAlert),!1;var r=JE.ajax({url:JE.getUrlMaps("je.core.develop.excel","exp"),params:n});r.success?window.open(JE.getFileUrl(r.obj)):JE.alert(r.obj)},showFn:function(e){var t=e.down("form"),i={title:s.funcName,fileName:s.funcName+"_"+JE.DATE.formatDate(new Date)+".xls"};t.form.setValues(i)}})},doDrop:function(e,t,i){i=Ext.value(i,1),e.store.each(function(e,t){e.get("SY_ORDERINDEX")!=i&&e.set("SY_ORDERINDEX",i),i++})},doReturnInfo:function(e){var t=e.grid;t.funcData.info.returnInfoObj&&this.returnInfo({mainData:t.mainData,funcData:t.funcData})},doDefaultValues:function(e,t,i){var a={};i=Ext.value(i,{});t&&t.funcId&&(a=JE.getFuncData(t.funcCode).getDefVals(e),1!=i.noTree&&Ext.apply(a,JE.Action.doTreeBeforeSave(t)));return Ext.apply(a,Ext.value(e,{})),a},doTreeQueryGrid:function(e,t){if(e&&t){var i=e.getSelectionModel(),a=[],l="SIMPLE"==i.selectionMode,s=t.funcData?t.funcData.info:{};a=l?e.getChecked():i.getSelection();var d={};Ext.each(a,function(a){var t={},e=a.get("nodeInfo"),i="code",n="in",o=["id","code","text","nodePath","bean"];Ext.each(o,function(e){t[e]=a.get(e)});var r=[];"tree"==s.funcType?(e=s.funcDicConfig.path,i="nodePath",n="like",t.nodePath=a.getPath().replace("/ROOT",""),t.id=t.id.split("_")[0],r.push(t)):"ROOT"!=a.get("nodeType")&&(l||a.cascadeBy(function(t){if(t.expand(),t.getId()!=a.getId()){var i={};Ext.each(o,function(e){i[e]=t.get(e)}),i.id=i.id.split("_")[0],r.push(i)}}),r.push(t)),d[e]=d[e]||{nodeField:i,type:n,list:[]},d[e].list=d[e].list.concat(r)}),JE.Action.doQuickQuery(t,d,"tree")}},doColumnQueryGrid:function(e){if(e){var a={},t=e.headerCt.query("uxcolumn[queryConfig]");Ext.each(t,function(e){var t=[],i=e.queryConfig.field||e.dataIndex;e.queryMenu.items.each(function(e){e.checked&&JE.isNotEmpty(e.data)&&t.push(Ext.clone(e.data))}),a[i]={nodeField:"code",type:"in",configInfo:e.queryConfig.configInfo,list:t}}),JE.Action.doQuickQuery(e,a,"column")}},doQuickQuery:function(f,e,E){var m=f.funcData?f.funcData.info:{},g=[],h={},x=[];Ext.iterate(e,function(e,t){var a=e,n=t.nodeField,i=t.type;if(f.funcData&&f.funcData.configFields[a]){var o=f.funcData.configFields[a].otherConfig;a=Ext.value(o.queryField,a),n=Ext.value(o.nodeField,n),Ext.value(o.formatValue,"")}else if(t.configInfo){var r=t.configInfo.split(","),l=JE.split(r[1],"~"),s=JE.split(r[2],"~");Ext.each(l,function(e,t){var i=s[t];if(n==i&&a!=e)return a=e,!1})}if("tree"==m.funcType&&"column"!=E||(i=f.funcData&&f.funcData.configFields[a]&&f.funcData.configFields[a].multiSelect?"like":"in"),JE.isNotEmpty(t.list)){var d=[];if(Ext.each(t.list,function(e){var t=Ext.clone(e);if(t.bean)for(var i in t.bean)t["bean."+i]=t.bean[i];d.push(t[n])}),x.push({code:a,type:i,value:d}),"in"==i){var c=d,u=h[a]=JE.DB.buildWhereSql({code:a,type:i,value:c});g.push(u)}else{var p=[];Ext.each(d,function(e){p.push(JE.DB.buildWhereSql({code:a,type:i,value:e}))});u=h[a]="("+p.join(" OR ")+")";g.push(u)}}});var t=0<g.length?" AND "+g.join(" AND "):"";JE.DB.setWhereSql(f.store,t,E,"AND",x),JE.Action.disableQuerySql(f,x,E),"tree"==E&&(f.treeSqls=h),f.store.loadPage(1)},doGroupQuery:function(e,t,i){var s=[],d=[];if("column"==i){var a=[e];e.lockable&&(a=[e.lockedGrid,e.normalGrid]),Ext.each(a,function(e){var t=e.getDockedCmp("columnsearch").query("container[name=fieldBox]");Ext.each(t,function(e){if(!e.noSearch&&0<e.items.getCount()){var t=e.getCmp("field"),i=e.getCmp("field_between"),a=e.getCmp("searchType"),n=e.searchValue||a.value,o=t.name,r=t.getValue();if(Ext.isBoolean(r))r=r?"1":"";else if("between"==n)if("numberfield"==t.xtype){var l=Ext.value(i.getValue(),"");r=JE.isNotEmpty(r)||JE.isNotEmpty(l)?[r,l]:[]}else r=i.getRangeValue();JE.isNotEmpty(r)&&s.push({code:o,type:n,value:r})}})})}else"window"==i?s=t:t.items.each(function(e){if(!e.hidden&&"buttonBar"!=e.itemId){var t=e.items.get(1).name,i=e.items.get(1).getValue(),a=e.items.get(2),n=Ext.value(a.getValue(),""),o=e.items.get(0).getValue(),r=e.items.get(4).getValue(),l={code:t,type:o};"between"==o?"rangedatefield"==a.xtype?l.value=a.getRangeValue():Ext.isEmpty(i)&&Ext.isEmpty(n)||(l.value=[i,n]):l.value=i,Ext.isEmpty(l.value)||s.push(l),Ext.isEmpty(r)||d.push({code:t,type:r})}});JE.Action.antiSqlValid(s)&&(JE.DB.setOrderSql(e.store,d),JE.DB.setWhereSql(e.store,JE.Action.buildSqlFields(e,s),"group"),JE.DB.setWhereSql(e.store,[],"quick"),JE.Action.resetGroupQuery(e,i),JE.Action.doDBQuery(e,s,"group"),JE.Action.disableQuerySql(e,s,"group"),JE.Action.disableQuerySql(e,[],"quick"),JE.Action.disableQuerySql(e,d,"order"),e.store.loadPage(1))},setGroupMark:function(e,t){var i=e.getDockedCmp("buttonBar");if(i){var a=i.getCmp("queryBtn");a&&a.btnIconEl.setStyle("color",t?"#ff3c3a":"")}},resetGroupQuery:function(e,t){if("window"!=t&&e.groupSearchWin&&e.groupSearchWin.getCmp(0).resetQuery(),"column"!=t){var i=[e];e.lockable&&(i=[e.lockedGrid,e.normalGrid]),Ext.each(i,function(e){var t=e.getDockedCmp("columnsearch");t&&(t.resetSearch(!1),t.hide())})}if("form"!=t){var a=e.up("jedataview").getCmp("groupQueryForm");a&&a.resetQuery()}if("keyword"!=t){var n=e.getDockedCmp("buttonBar");n&&n.getCmp("queryGridField")&&n.getCmp("queryGridField").reset()}},doKeywordQuery:function(e,a){a=Ext.value(a,"").trim();var t=e.funcData["query"==e.type?"select":"grid"].quickQuery,i=[];if(Ext.each(t,function(e){"no"!=e.type&&i.push(e)}),JE.isEmpty(i))JE.msg(JE.getLocalLang("core.ux.qqfield.noQueryFieldsMsg"));else{var n=[];JE.isNotEmpty(a)&&Ext.each(i,function(e){var t={code:e.name,type:e.type,value:a,keyword:"1"};if(e.columnOtherConfig){var i=Ext.JSON.decode(e.columnOtherConfig);i.keyword&&(t.keyword=i.keyword)}"numberfield"==e.xtype?JE.isNotEmpty(a)&&Ext.isNumeric(a)&&n.push(t):n.push(t)}),JE.Action.antiSqlValid(n)&&(JE.DB.setOrderSql(e.store,[]),JE.DB.setWhereSql(e.store,JE.Action.buildSqlFields(e,n),"quick","or"),JE.DB.setWhereSql(e.store,[],"group"),JE.Action.resetGroupQuery(e,"keyword"),JE.Action.doDBQuery(e,n,"quick"),JE.Action.disableQuerySql(e,n,"quick"),JE.Action.disableQuerySql(e,[],"group"),JE.Action.disableQuerySql(e,[],"order"),e.store.loadPage(1))}},antiSqlValid:function(e){var i=/’|'|"|=|;|>|<|%/i,a=!0;return Ext.each(e,function(e){var t=Ext.isArray(e.value)?e.value:[e.value];return Ext.each(t,function(e){if(i.test(e))return a=!1}),a}),a||JE.alert("请您不要在查询时输入特殊字符！"),a},buildSqlFields:function(i,e){var a=[];return Ext.each(e,function(e){var t=i.funcData.basicColumns[e.code];t&&"1"==JE.getObjAttr(t.otherConfig,"noWhereSql")||a.push(e)}),a},getQueryKeyWord:function(e,i,a){var t=e.queryFields||{},n="";return Ext.iterate(t,function(e,t){if(Ext.each(t,function(e){if(e.code==i){if("0"==e.keyword)return;return n=Ext.isArray(e.value)?a:e.value,!1}}),JE.isNotEmpty(n))return!1}),n},doDBQuery:function(e,i){if(-1!=["procedure","iditprocedure","sql"].indexOf(e.funcData.info.funcType)){var a={};Ext.each(e.funcData.info.dbQueryParams,function(t){Ext.each(i,function(e){if(t.name==e.code)return a[t.name]=e,!1})}),e.store.proxy.extraParams.dbQueryObj=Ext.encode(a),"iditprocedure"==e.funcData.info.funcType&&e.buildDColumns&&e.buildDColumns(e.store.proxy.extraParams)}},disableQuerySql:function(e,t,i){var a=e.funcData.info.disableQuerySql||"";-1==a.indexOf("ALL")&&-1==a.indexOf(i)||JE.DB.disableSql(e.store,t,i)},doCxclQuery:function(i,e,t){var a="",n=!1;Ext.each(e,function(e){var t=e.QUERYSTRATEGY_FN;JE.isNotEmpty(t)&&(t=JE.eval(t,i.localLang.cxclBar.errorFnAlert))&&(a=t()),JE.isEmpty(a)&&(a=e.QUERYSTRATEGY_SQL,a=Ext.value(Ext.decode(a,!0),a)),"1"==e.QUERYSTRATEGY_FGGNSQL&&(n=!0)}),i.store.disableBasicSql=n,JE.DB.setWhereSql(i.store,a,"cxcl"),0!=t&&i.store.loadPage(1)},buildColumnField:function(e,t){var i={width:"100%",margin:0};switch(delete(i=Ext.applyIf(i,Ext.value(e,{}))).columnWidth,delete i.height,i.xtype){case"multiitem":case"ckeditor":case"textarea":i.xtype="textfield";break;case"treessareafield":i.xtype="treessfield";break;case"gridssareafield":i.xtype="gridssfield";case"vueuserareafield":i.xtype="vueuserfield";break;case"rgroup":i.xtype="cbbfield";break;case"cgroup":i.xtype="cbbfield",i.multiSelect=!0}return i.emptyField?Ext.each(["width","height","margin","allowBlank","readOnly","value","columnWidth"],function(e){delete i[e]}):"uxcheckcolumn"==t.xtype&&Ext.apply(i,{xtype:"yesnofield",name:t.dataIndex,style:"background-color:#fff",fieldTdAttr:"align=center"}),i.cls=Ext.value(i.cls,"")+" je-grid-column-field",i}}),Ext.define("JE.core.action.TreeAction",{doTreeBeforeSave:function(e){var t=JE.getFuncView(e.funcCode,"tree",e.idSuffix),r={success:!0,obj:{}};if(t)if("tree"==e.funcType){var i=e.funcDicConfig,a=t.getSelectionModel().getSelection()[0];a=a||t.getRootNode(),r.obj[i.parentCode]=a.get("code"),r.obj[i.parentText]=a.get("text"),r.obj[i.parent]=a.get("id"),r.obj[i.layer]=a.getDepth()+1,r.obj[i.nodeType]="LEAF",r.obj[i.path]=a.getPath(),r.obj[i.treeOrderIndex]=a.get("treeOrderIndex")}else{var n=1==t.multiSelect?t.getChecked():t.getSelectionModel().getSelection();Ext.each(n,function(a){var n=a.get("nodeInfo"),o=["id","parentId","parent"],e=t.defValueFields[n];Ext.iterate(e,function(e,t){var i=a.get(e);Ext.isString(t)&&JE.isNotEmpty(i)&&(-1!=o.indexOf(e)&&(i=i.replaceAll("_"+n,"")),r.obj[t]=i)})})}return r.obj},doTreeSave:function(e,t,i){if("tree"==t.funcType){var a=JE.getFuncView(t.funcCode,"tree",t.idSuffix);if(a){var n=t.funcDicConfig,o=a.getSelectionModel().getSelection()[0];i&&(o=a.getStore().getNodeById(e[n.parent])),o=Ext.value(o,a.getRootNode());var r="LEAF"==e[n.nodeType],l={id:e[n.id],text:e[n.text],code:e[n.code],iconCls:e[n.iconCls],treeOrderIndex:e[n.treeOrderIndex],nodeInfo:n.code,expandable:!0,leaf:r,bean:e,children:[]};o.isLeaf()&&(o.set("leaf",!1),o.commit()),l=o.appendChild(l),a.expandPath(l.getPath()),i&&a.getSelectionModel().select(l)}}},doTreeUpdate:function(e,t){if("tree"==t.funcType){var a=JE.getFuncView(t.funcCode,"tree",t.idSuffix);if(a){var n=t.funcDicConfig;Ext.each(e,function(e){var t=a.getStore().getNodeById(e[n.id]);if(t){var i="LEAF"==e[n.nodeType];t.set("text",e[n.text]),t.set("code",e[n.code]),t.set("orderIndex",e[n.orderIndex]),t.set("iconCls",e[n.iconCls]),t.set("leaf",i),t.commit()}})}}},doTreeRemove:function(e,n){if("tree"==n.funcType){var o=JE.getFuncView(n.funcCode,"tree",n.idSuffix);if(o){n.funcDicConfig;Ext.each(e,function(e){var t=o.getStore().getNodeById(e);if(t){var i=t.parentNode;if(t.remove(),i&&!i.hasChildNodes()&&!i.isRoot()){i.set("leaf",!0),i.commit();var a={SY_NODETYPE:"LEAF",tableCode:n.tableName};a[n.pkName]=i.get("id"),JE.ajax({url:JE.getActionUrls(n.funcAction).update,params:a})}}})}}},doTreeLoad:function(e,t){var i=JE.getFuncView(t.funcCode,"treegrid",t.idSuffix);"tree"==t.funcType&&i&&(i.parentSql=e.parentSql,e.clearNodes?i.loadData():i.load());var a=JE.getFuncView(t.funcCode,"tree",t.idSuffix);a&&("tree"!=t.funcType&&!a.loadDic||!e.clearNodes?"tree"==t.funcType?(a.parentSql=e.parentSql,a.load({url:Ext.value(t.funcAction,JE.getUrlMaps("je.core.getTree")),params:{moreRoot:"TRUE"==t.funcDicConfig.moreRoot,tableCode:t.tableName,excludes:1!=a.multiSelect?"checked":"",parentSql:e.parentSql}})):a.loadDic&&(a.parentData=e.parentData,a.load()):a.loadData())}}),Ext.define("JE.core.action.WFAction",{doWFStart:function(e){e.funcData.info;var t=e.wfInfo,i=JE.ajax({url:JE.getUrlMaps("je.core.wf.taskInfo","startProcess"),params:{pdid:t.pdid,beanId:t.pkValue}});i.success?(JE.Action.doWFFormEdit(e,i.obj.bean,i.obj),JE.msg(JE.local.lang.core.jewfview.alert.doWFStart)):JE.alert(i.obj)},doWFSponsor:function(e){var t=e.formObj,i=t.wfInfo,a={targerTaskName:e.targerTaskName,targerTransition:e.targerTransition};if(1==e.easyApprove)a=Ext.clone(e);else{var n=e.getComponent("msgView"),o=e.getUsers();if(Ext.isEmpty(o))return;a.submitComments=n.getValues().msg,a.commentDetails=n.getValues().commentDetails,a.targerTaskName=e.targerTaskName,a.targerTransition=e.targerTransition,Ext.apply(a,o)}var r=JE.ajax({url:JE.getUrlMaps("je.core.wf.taskInfo","sponsorProcess"),params:Ext.apply({taskId:i.taskId,submitType:"to_submit",pdid:i.pdid,beanId:i.pkValue},a)});r.success?(JE.msg(JE.local.lang.core.jewfview.alert.doWFSponsor),JE.Action.doWFFormEdit(t,r.obj.bean,r.obj),e.ownerCt&&e.ownerCt.close()):JE.alert(r.obj)},doWFReturnSubmit:function(e){var t=e.formObj,i=t.wfInfo,a={targerTaskName:e.targerTaskName,targerTransition:e.targerTransition};if(1==e.easyApprove)a=Ext.clone(e);else{var n=e.getComponent("msgView");a.submitComments=n.getValues().msg,a.commentDetails=n.getValues().commentDetails,a.targerTaskName=e.targerTaskName,a.targerTransition=e.targerTransition,e.returnSubmitInfo&&(a.targerTaskName=e.returnSubmitInfo.returnTaskName,a.assigeeId=e.returnSubmitInfo.returnAssgineId)}var o=JE.ajax({url:JE.getUrlMaps("je.core.wf.taskInfo","completeTask"),params:Ext.apply({taskId:i.taskId,submitType:"to_returnsubmit",pdid:i.pdid,beanId:i.pkValue},a)});o.success?(JE.msg(JE.local.lang.core.jewfview.alert.doWFBack),JE.Action.doWFFormEdit(t,o.obj.bean,o.obj),e.ownerCt&&e.ownerCt.close()):JE.alert(o.obj)},doWFBack:function(e){var t=e.formObj,i=t.wfInfo,a={targerTaskName:e.targerTaskName,targerTransition:e.targerTransition};if(1==e.easyApprove)a=Ext.clone(e);else{var n=e.getComponent("msgView");a.submitComments=n.getValues().msg,a.commentDetails=n.getValues().commentDetails,a.targerTaskName=e.targerTaskName,a.targerTransition=e.targerTransition}var o=JE.ajax({url:JE.getUrlMaps("je.core.wf.taskInfo","completeTask"),params:Ext.apply({taskId:i.taskId,submitType:"to_withdraw",pdid:i.pdid,beanId:i.pkValue},a)});o.success?(JE.msg(JE.local.lang.core.jewfview.alert.doWFBack),JE.Action.doWFFormEdit(t,o.obj.bean,o.obj),e.ownerCt&&e.ownerCt.close()):JE.alert(o.obj)},doWFReturnBack:function(e){var t=e.formObj,i=t.wfInfo,a={targerTaskName:e.targerTaskName,targerTransition:e.targerTransition};if(1==e.easyApprove)a=Ext.clone(e);else{var n=e.getComponent("msgView");a.submitComments=n.getValues().msg,a.commentDetails=n.getValues().commentDetails,a.targerTaskName=e.targerTaskName,a.targerTransition=e.targerTransition}var o=JE.ajax({url:JE.getUrlMaps("je.core.wf.taskInfo","completeTask"),params:Ext.apply({taskId:i.taskId,submitType:"to_returnback",pdid:i.pdid,beanId:i.pkValue},a)});o.success?(JE.msg(JE.local.lang.core.jewfview.alert.doWFReturnBack),JE.Action.doWFFormEdit(t,o.obj.bean,o.obj),e.ownerCt&&e.ownerCt.close()):JE.alert(o.obj)},doWFReject:function(e){var t=e.formObj,i=t.wfInfo,a={targerTaskName:e.targerTaskName,targerTransition:e.targerTransition};if(1==e.easyApprove)a=Ext.clone(e);else{var n=e.getRejectUsers();if(Ext.isEmpty(n))return;var o=e.getComponent("msgView");a.submitComments=o.getValues().msg,a.commentDetails=o.getValues().commentDetails,a.targerTaskName=e.targerTaskName,a.targerTransition=e.targerTransition}var r=JE.ajax({url:JE.getUrlMaps("je.core.wf.taskInfo","completeTask"),params:Ext.apply({taskId:i.taskId,submitType:"to_reject",pdid:i.pdid,beanId:i.pkValue},a)});r.success?(JE.msg(JE.local.lang.core.jewfview.alert.doWFReturnBack),JE.Action.doWFFormEdit(t,r.obj.bean,r.obj),e.ownerCt&&e.ownerCt.close()):JE.alert(r.obj)},doWFSubmit:function(e){var t=e.formObj,i=t.wfInfo,a={targerTaskName:e.targerTaskName,targerTransition:e.targerTransition};if(1==e.easyApprove)a=Ext.clone(e);else{var n=e.getComponent("msgView"),o=e.getUsers();if(Ext.isEmpty(o))return;a.submitComments=n.getValues().msg,a.commentDetails=n.getValues().commentDetails,a.targerTaskName=e.targerTaskName,a.targerTransition=e.targerTransition,Ext.apply(a,o)}var r="to_submit";i.taskName==e.targerTaskName&&(r="to_circular");var l=JE.ajax({url:JE.getUrlMaps("je.core.wf.taskInfo","completeTask"),params:Ext.apply({taskId:i.taskId,submitType:r,pdid:i.pdid,beanId:i.pkValue},a)});l.success?(JE.msg(JE.local.lang.core.jewfview.alert.doWFSubmit),JE.Action.doWFFormEdit(t,l.obj.bean,l.obj),e.ownerCt&&e.ownerCt.close()):JE.alert(l.obj)},doWFAllot:function(e){var t=e.formObj,i=t.wfInfo,a={targerTaskName:e.targerTaskName,targerTransition:e.targerTransition};if(1==e.easyApprove)a=Ext.clone(e);else{var n=e.getComponent("msgView"),o=e.getUsers();if(Ext.isEmpty(o))return;a.submitComments=n.getValues().msg,a.commentDetails=n.getValues().commentDetails,a.targerTaskName=e.targerTaskName,a.targerTransition=e.targerTransition,Ext.apply(a,o)}var r=JE.ajax({url:"/jbpm/taskInfoAction!completeTask.action",params:Ext.apply({taskId:i.taskId,submitType:"to_allot",pdid:i.pdid,beanId:i.pkValue},a)});r.success?(JE.msg(JE.local.lang.core.jewfview.alert.doWFSubmit),JE.Action.doWFFormEdit(t,r.obj.bean,r.obj),e.ownerCt&&e.ownerCt.close()):JE.alert(r.obj)},doWFJump:function(e){var t=e.formObj,i=t.wfInfo,a={targerTaskName:e.targerTaskName,targerTransition:e.targerTransition};if(1==e.easyApprove)a=Ext.clone(e);else{var n=e.getComponent("msgView"),o=e.getUsers();if(Ext.isEmpty(o))return;a.submitComments=n.getValues().msg,a.commentDetails=n.getValues().commentDetails,a.targerTaskName=e.targerTaskName,a.targerTransition=e.targerTransition,Ext.apply(a,o)}var r=JE.ajax({url:"/jbpm/taskInfoAction!completeTask.action",params:Ext.apply({taskId:i.taskId,submitType:"to_jump",pdid:i.pdid,beanId:i.pkValue},a)});r.success?(JE.msg(JE.local.lang.core.jewfview.alert.doWFSubmit),JE.Action.doWFFormEdit(t,r.obj.bean,r.obj),e.ownerCt&&e.ownerCt.close()):JE.alert(r.obj)},doWFReturn:function(e){var t=e.formObj,i=t.wfInfo,a={targerTaskName:e.targerTaskName,targerTransition:e.targerTransition};if(1==e.easyApprove)a=Ext.clone(e);else{var n=e.getComponent("msgView");a.submitComments=n.getValues().msg,a.commentDetails=n.getValues().commentDetails}var o=JE.ajax({url:JE.getUrlMaps("je.core.wf.taskInfo","completeTask"),params:Ext.apply({taskId:i.taskId,submitType:"to_rollback",pdid:i.pdid,beanId:i.pkValue},a)});o.success?(JE.msg(JE.local.lang.core.jewfview.alert.doWFReturn),JE.Action.doWFFormEdit(t,o.obj.bean,o.obj),e.ownerCt&&e.ownerCt.close()):JE.alert(o.obj)},doWFEnd:function(e){var t=e.formObj,i=t.wfInfo,a=e.endInfo,n=e.getComponent("msgView");e.getUsers();submitInfo={targerTaskName:a.targerTaskName,targerTransition:a.targerTransition,beanId:i.pkValue,pdid:i.pdid,taskId:i.taskId};var o=JE.getUrlMaps("je.core.wf.taskInfo","completeTask");e.wfBatch?(submitInfo.piid=i.piid,submitInfo.currentTaskName=i.taskName,submitInfo.tableCode=i.tableCode,submitInfo.ids=i.ids,submitInfo.submitType="to_"+e.type,o=JE.getUrlMaps("je.core.wf.taskInfo","completeBatchTask")):("sponsor"==e.type&&(o=JE.getUrlMaps("je.core.wf.taskInfo","sponsorProcess")),submitInfo.submitType="to_submit"),submitInfo.submitComments=n.getValues().msg,submitInfo.commentDetails=n.getValues().commentDetails;var r=JE.ajax({url:o,params:submitInfo});if(r.success){if(JE.msg(JE.local.lang.core.jewfview.alert.doWFEnd),e.wfBatch){var l=e.callback;l&&l()}else JE.Action.doWFFormEdit(t,r.obj.bean,r.obj);e.ownerCt.close()}else JE.alert(r.obj)},doWFTake:function(e){var t=e.wfInfo,i=JE.ajax({url:JE.getUrlMaps("je.core.wf.taskInfo","taskTask"),params:{taskId:t.taskId,pdid:t.pdid,beanId:t.pkValue}});i.success?(JE.msg(JE.local.lang.core.jewfview.alert.doWFTake),JE.Action.doWFFormEdit(e,i.obj.bean,i.obj)):JE.alert(i.obj)},doWFRound:function(l){var s=l.wfInfo,e=JE.ajax({url:JE.getUrlMaps("je.core.wf.taskInfo","loadRoundUser"),params:{targerTaskName:s.taskName,pdid:s.pdid,pkValue:s.pkValue}});JE.selectWin({title:JE.local.lang.core.jewfview.wfAction.doWFRoundTitle,type:"tree",rootData:{children:e,id:"ROOT"},multiSelect:!0,callback:function(e){if(0==e.length)return JE.alert(JE.local.lang.core.jewfview.alert.doWFRoundUser),!1;var i=[],a=[],n=[],o={};Ext.each(e,function(e){var t=Ext.value(e.get("nodeInfo"),e.get("id"));o[t]||(i.push(e.get("text")),a.push(e.get("code")),n.push(t),o[t]=t)});var t=JE.ajax({url:s.wfBatch?JE.getUrlMaps("je.core.wf.taskInfo","completeBatchTask"):JE.getUrlMaps("je.core.wf.taskInfo","completeTask"),params:{taskId:s.taskId,submitType:"to_round",assigeeCode:a.join(","),assigeeName:i.join(","),assigeeId:n.join(","),pdid:s.pdid,beanId:s.pkValue,ids:s.ids,piid:s.piid,tableCode:s.tableCode}});if(t.success)if(JE.msg(JE.local.lang.core.jewfview.alert.doWFRound),s.wfBatch){var r=s.callback;r&&r()}else JE.Action.doWFFormEdit(l,t.obj.bean,t.obj);else JE.alert(t.obj)}})},doWFTakeRound:function(e){var t=e.formObj,i=t.wfInfo,a=e.getComponent("msgView"),n=JE.ajax({url:JE.getUrlMaps("je.core.wf.taskInfo","completeTask"),params:{taskId:i.taskId,submitType:"to_takeround",submitComments:a.getValues().msg,commentDetails:a.getValues().commentDetails,pdid:i.pdid,beanId:i.pkValue}});n.success?(JE.msg(JE.local.lang.core.jewfview.alert.doWFTakeRound),JE.Action.doWFFormEdit(t,n.obj.bean,n.obj),e.ownerCt.close()):JE.alert(n.obj)},doWFPass:function(e){var t=e.formObj,i=t.wfInfo,a=e.getComponent("msgView"),n=JE.ajax({url:JE.getUrlMaps("je.core.wf.taskInfo","completeTask"),params:{taskId:i.taskId,submitType:"to_pass",submitComments:a.getValues().msg,commentDetails:a.getValues().commentDetails,pdid:i.pdid,beanId:i.pkValue}});n.success?(JE.msg(JE.local.lang.core.jewfview.alert.doWFPass),JE.Action.doWFFormEdit(t,n.obj.bean,n.obj),e.ownerCt.close()):JE.alert(n.obj)},doWFNoPass:function(e){var t=e.formObj,i=t.wfInfo,a=e.getComponent("msgView"),n=JE.ajax({url:JE.getUrlMaps("je.core.wf.taskInfo","completeTask"),params:{taskId:i.taskId,submitType:"to_nopass",submitComments:a.getValues().msg,commentDetails:a.getValues().commentDetails,pdid:i.pdid,beanId:i.pkValue}});n.success?(JE.msg(JE.local.lang.core.jewfview.alert.doWFNoPass),JE.Action.doWFFormEdit(t,n.obj.bean,n.obj),e.ownerCt.close()):JE.alert(n.obj)},doWFWaiverPass:function(e){var t=e.formObj,i=t.wfInfo,a=e.getComponent("msgView"),n=JE.ajax({url:JE.getUrlMaps("je.core.wf.taskInfo","completeTask"),params:{taskId:i.taskId,submitType:"to_waiverpass",submitComments:a.getValues().msg,commentDetails:a.getValues().commentDetails,pdid:i.pdid,beanId:i.pkValue}});n.success?(JE.msg(JE.local.lang.core.jewfview.alert.doWFWaiverPass),JE.Action.doWFFormEdit(t,n.obj.bean,n.obj),e.ownerCt.close()):JE.alert(n.obj)},doWFTransmit:function(e){var t=e.formObj,i=t.wfInfo,a=e.getComponent("msgView"),n=e.getUsers();if(submitInfo={},!Ext.isEmpty(n)){submitInfo.submitComments=a.getValues().msg,submitInfo.commentDetails=a.getValues().commentDetails,Ext.apply(submitInfo,n);var o=JE.ajax({url:JE.getUrlMaps("je.core.wf.taskInfo","completeTask"),params:Ext.apply({taskId:i.taskId,submitType:"to_transmit",pdid:i.pdid,beanId:i.pkValue},submitInfo)});o.success?(JE.msg(JE.local.lang.core.jewfview.alert.doWFTransmit),JE.Action.doWFFormEdit(t,o.obj.bean,o.obj),e.ownerCt.close()):JE.alert(o.obj)}},doWFEntrust:function(e){var t=e.formObj,i=t.wfInfo,a=e.getComponent("msgView"),n=e.getUsers();if(submitInfo={},!Ext.isEmpty(n)){submitInfo.submitComments=a.getValues().msg,submitInfo.commentDetails=a.getValues().commentDetails,Ext.apply(submitInfo,n);var o=JE.ajax({url:JE.getUrlMaps("je.core.wf.taskInfo","completeTask"),params:Ext.apply({taskId:i.taskId,submitType:"to_entrust",pdid:i.pdid,beanId:i.pkValue},submitInfo)});o.success?(JE.msg(JE.local.lang.core.jewfview.alert.doWFEntrust),JE.Action.doWFFormEdit(t,o.obj.bean,o.obj),e.ownerCt.close()):JE.alert(o.obj)}},doWFCallEntrust:function(e){var t=e.formObj,i=t.wfInfo,a=e.getComponent("msgView"),n=JE.ajax({url:JE.getUrlMaps("je.core.wf.taskInfo","completeTask"),params:{taskId:i.taskId,submitType:"to_callentrust",submitComments:a.getValues().msg,commentDetails:a.getValues().commentDetails,pdid:i.pdid,beanId:i.pkValue}});n.success?(JE.msg(JE.local.lang.core.jewfview.alert.doWFCallEntrust),JE.Action.doWFFormEdit(t,n.obj.bean,n.obj),e.ownerCt.close()):JE.alert(n.obj)},doWFCancel:function(e){var t=e.wfInfo,i=null;i="jewfimageview"==e.xtype?e.formObj:e;var a=JE.ajax({url:JE.getUrlMaps("je.core.wf.taskInfo","callProcess"),params:{pdid:t.pdid,beanId:t.pkValue,piid:t.piid,submitComments:JE.local.lang.core.jewfview.wfAction.doWFCancelComments}});a.success?(a.obj.pdid=t.pdid,JE.Action.doWFFormEdit(e,a.obj.bean,a.obj),t.info&&Ext.each(t.info.changeFields,function(e){var t=i.getFields(e);t&&t.setValue(a.obj.bean[e])}),JE.msg(JE.local.lang.core.jewfview.alert.doWFCancel)):JE.alert(a.obj)},doWFUserDiy:function(e){var t=e.wfInfo,i=null;i="jewfimageview"==e.xtype?e.formObj:e;var a=JE.ajax({url:"/jbpm/taskInfoAction!completeTask.action",params:{pdid:t.pdid,beanId:t.pkValue,piid:t.piid,taskId:t.taskId,targerTaskName:t.doUserDiyBackName,submitType:"to_backuserdiy",submitComments:""}});a.success?(a.obj.pdid=t.pdid,JE.Action.doWFFormEdit(e,a.obj.bean,a.obj),t.info&&Ext.each(t.info.changeFields,function(e){var t=i.getFields(e);t&&t.setValue(a.obj.bean[e])}),JE.msg(JE.local.lang.core.jewfview.alert.doWFBackUserDiy)):JE.alert(a.obj)},doWFSuspend:function(e){var t=e.formObj,i=t.wfInfo,a=e.getComponent("msgView"),n=JE.ajax({url:JE.getUrlMaps("je.core.wf.taskInfo","endProcess"),params:{beanId:i.pkValue,piid:i.piid,pdid:i.pdid,submitComments:a.getValues().msg,commentDetails:a.getValues().commentDetails}});n.success?(JE.msg(JE.local.lang.core.jewfview.alert.doWFSuspend),JE.Action.doWFFormEdit(t,n.obj.bean,n.obj),e.ownerCt.close()):JE.alert(n.obj)},doWFBatch:function(e){var t=e.formObj.wfInfo,i=e.getComponent("msgView"),a={};if(a.submitComments=i.getValues().msg,a.commentDetails=i.getValues().commentDetails,a.pdid=t.pdid,a.piid=t.piid,a.currentTaskName=t.taskName,a.tableCode=t.tableCode,a.ids=t.ids,-1!=["submit","sponsor","entrust","transmit","takeround"].indexOf(e.type)){var n=e.getUsers();if(a.submitType="to_"+e.type,a.targerTaskName=e.targerTaskName,a.targerTransition=e.targerTransition,Ext.isEmpty(n))return;Ext.apply(a,n)}else"return"==e.type?a.submitType="to_rollback":"back"==e.type&&(a.submitType="to_withdraw");var o=JE.ajax({url:JE.getUrlMaps("je.core.wf.taskInfo","completeBatchTask"),params:a});if(o.success){JE.msg(o.obj);var r=e.callback;r&&r(),e.ownerCt.close()}else JE.alert(o.obj)},doTask:function(e,a,t){var n=e.bean,i=t.ref;if(a.info){var o=a.info.buttonInfos[t.ref];o&&JE.isNotEmpty(o.comment)&&o.comment,(r=a.info.taskNodeInfos[a.taskName])&&JE.isNotEmpty(r.taskComments[t.ref])&&r.taskComments[t.ref]}if("wfSubmitBtn"==i){var r;if((r=a.info.taskNodeInfos[a.taskName]).type,"decision"==r.type){var l=new Array,s=new Array;Ext.each(r.transitions,function(t,e){var i;i=JE.toXT(t.info,n),Ext.value(JE.eval(i,localLang.alert.expError+i),!1)&&(s.push(t),l.push(t.name),targerTaskNames.push(t.to),Ext.each(a.info.endTaskNodes,function(e){e.name==t.to&&(haveEnd=!0,endInfo.targerTransition=t.name,endInfo.targerTaskName=t.to)}))}),1==l.length&&(targerTransition=l[0],haveEnd=!1)}else"circular"==r.type&&(targerTaskNames.push(r.name),Ext.each(r.transitions,function(t,e){Ext.each(a.info.endTaskNodes,function(e){e.name==t.to&&(haveEnd=!0,endInfo.targerTransition=t.name,endInfo.targerTaskName=t.to)})}),1==l.length&&(targerTransition=l[0],haveEnd=!1)),Ext.each(r.transitions,function(e){targerTaskNames.push(e.to)});var d=new Array,c=!1;Ext.each(targerTaskNames,function(e){var t=a.info.taskNodeInfos[e];t&&-1==excludesType.indexOf(t.type)?d.push(e):t&&-1!=excludesType.indexOf(t.type)&&(c=!0)}),0<d.length?JE.ajax({url:JE.getUrlMaps("je.core.wf.taskInfo","loadTaskAssgine"),params:{targerTaskName:d.join(","),taskId:a.taskName,pdid:a.pdid,piid:a.piid,beanId:a.pkValue}}):c||(msg=localLang.title.end)}},doWFResetWFForm:function(e,t){var i=e.getDockedCmp("workflowBar");if(i)if(t){if(t==e.activeWFBtn)return i.doWFSubmitAction(function(){i.hide()}),!1;e.activeWFBtn=t,i.resetWFData(),i.hide(),-1!=["wfLczzBtn"].indexOf(t.ref)&&delete e.activeWFBtn}else delete e.activeWFBtn,i.resetWFData(),i.hide()},getWFSubmitData:function(o,e,t){var r=o.wfInfo,l=JE.getLocalLang("core.jewfview.wfAction.doWFSubmitWin"),i=l.title.cancel,a=null,s=!1,d={},n=!1,c=!1,u=!1,p="JE_WF_"+e.toUpperCase(),f=[],E=["join"],m=[],g="",h={},x="task",v="";if(r.info&&t){var y=r.info.buttonInfos[t.ref];y&&JE.isNotEmpty(y.comment)&&(v=y.comment),(F=r.info.taskNodeInfos[r.taskName])&&JE.isNotEmpty(F.taskComments[t.ref])&&(v=F.taskComments[t.ref])}var b="";t&&t.btnInfos&&t.btnInfos.taskName&&(b=t.btnInfos.taskName);var C=!1,w={};if("submit"==e||"sponsor"==e||"nextdiyuser"==e||"allot"==e){i=l.title.submit,"sponsor"==e&&(i=l.title.sponsor,p="jeicon jeicon-startup-process");var S=r.taskName;"nextdiyuser"==e&&(S=r.doUserDiyBackName),x=(F=r.info.taskNodeInfos[S]).type;var I=!0,T=!1;if("allot"==e)for(var _ in r.info.taskNodeInfos)_!=S&&m.push(_);else if("decision"==F.type){var J=new Array,D=new Array;if(Ext.each(F.transitions,function(t,e){var i,a=!0,n=o;"jewfimageview"==o.xtype&&(n=o.formObj),i=JE.toXT(t.info,r.wfBatch?{}:n.form.getValues()),a=Ext.value(JE.eval(i,l.alert.expError+i),!1),JE.isNotEmpty(b)&&t.to!=b&&(a=!1),a&&(D.push(t),J.push(t.name),m.push(t.to),Ext.each(r.info.endTaskNodes,function(e){e.name==t.to&&(s=!0,d.targerTransition=t.name,d.targerTaskName=t.to)}))}),1==J.length&&(g=J[0],s=!1),m.length<=0)return JE.alert(l.alert.noTranMsg),!1}else if("batchtask"==F.type&&r.isBatchNext)I=!(m=[F.name]);else{if("circular"==F.type){J=new Array;JE.isNotEmpty(b)?F.name!=b&&m.push(F.name):m.push(F.name),Ext.each(F.transitions,function(t,e){JE.isNotEmpty(b)&&t.to!=b||Ext.each(r.info.endTaskNodes,function(e){e.name==t.to&&(s=!0,d.targerTransition=t.name,d.targerTaskName=t.to)})}),1==J.length&&(g=J[0],s=!1)}Ext.each(F.transitions,function(e){JE.isNotEmpty(b)?e.to==b&&m.push(e.to):m.push(e.to)})}var A=new Array,N=!1;if("allot"!=e?Ext.each(m,function(e){var t=r.info.taskNodeInfos[e];if(t&&-1==E.indexOf(t.type)?A.push(e):t&&-1!=E.indexOf(t.type)&&(N=!0),t&&"fork"==t.type){var a=o;"jewfimageview"==o.xtype&&(a=o.formObj);var n=new Array;Ext.each(t.transitions,function(e,t){var i=JE.toXT(e.info,r.wfBatch?{}:a.form.getValues());Ext.value(JE.eval(i,l.alert.expError+i),!1)&&n.push(e.to)}),h[t.name]=n.join(",")}}):Ext.each(m,function(e){A.push(e)}),0<A.length&&I?f=JE.ajax({url:JE.getUrlMaps("je.core.wf.taskInfo","loadTaskAssgine"),params:{targerTaskName:A.join(","),forkTargerTaskInfo:JE.toStr(h),taskId:S,pdid:r.pdid,piid:r.piid,beanId:r.pkValue,allot:"allot"==e?"1":"0"}}):N||(i=l.title.end,T=!0),!(1!=r.info.easyApprove&&(1!=r.info.easySponsor||"sponsor"!=e)||0!=F.noEasy||1!=f.length&&(0<A.length&&I||N))){w={taskId:r.taskId,submitType:"to_submit",pdid:r.pdid,beanId:r.pkValue,targerTaskName:m.join(","),targerTransition:g,submitComments:Ext.value(v,Ext.value(JE.systemConfig.APPROVECOMMENT,"未填写任何审批意见")),commentDetails:"",countersignInfos:"",forkInfos:"",assigeeName:"",assigeeCode:"",assigeeId:""};var O=new Array,R=new Array,L=new Array,P=function(e,t,i,a){var n=Ext.value(e.children,[]);Ext.each(n,function(e){"ENDUSER"==e.nodeInfoType&&(t.push(e.text),i.push(e.code),a.push(e.nodeInfo)),P(e,t,i,a)})};0<f.length&&P(f[0],O,R,L),1==L.length?(w.assigeeName=O[0],w.assigeeCode=R[0],w.assigeeId=L[0],C=!0):0<f.length&&"diy"==f[0].icon?(w.assigeeName=O.join(","),w.assigeeCode=R.join(","),w.assigeeId=L.join(","),C=!0):T&&(C=!0)}}else if("back"==e)i=l.title.back,1==r.info.easyApprove&&0==F.noEasy&&(w={taskId:r.taskId,submitType:"to_withdraw",submitComments:Ext.value(v,Ext.value(JE.systemConfig.APPROVECOMMENT,"未填写任何审批意见")),commentDetails:"",pdid:r.pdid,beanId:r.pkValue},C=!0);else if("reject"==e){i=l.title.reject;var M=Ext.value(F.rejectNodes,"").split(",");Ext.each(M,function(e){JE.isNotEmpty(b)?e==b&&m.push(e):m.push(e)}),1<m.length&&(f=JE.ajax({url:JE.getUrlMaps("je.core.wf.taskInfo","loadTaskRejectAssgine"),params:{targerTaskName:m.join(","),pdid:r.pdid,piid:r.piid,beanId:r.pkValue}})),1==r.info.easyApprove&&0==F.noEasy&&1==m.length&&(w={taskId:r.taskId,submitType:"to_reject",submitComments:Ext.value(v,Ext.value(JE.systemConfig.APPROVECOMMENT,"未填写任何审批意见")),commentDetails:"",pdid:r.pdid,beanId:r.pkValue},C=!0)}else if("returnsubmit"==e)i=l.title.reject,p="jeicon jeicon-pass",1==r.info.easyApprove&&0==F.noEasy&&(w={taskId:r.taskId,submitType:"to_returnsubmit",submitComments:Ext.value(v,Ext.value(JE.systemConfig.APPROVECOMMENT,"未填写任何审批意见")),commentDetails:"",pdid:r.pdid,beanId:r.pkValue},r.doReturnSubmitInfo&&(w.targerTaskName=r.doReturnSubmitInfo.returnTaskName,w.assigeeId=r.doReturnSubmitInfo.returnAssgineId),C=!0);else if("return"==e){i=l.title.cancel,(F=r.info.taskNodeInfos[r.taskName]).returnBackAble&&(u=!0,a=l.title.cancelMsg),1==r.info.easyApprove&&0==F.noEasy&&(w={returnback:u,taskId:r.taskId,submitType:"to_rollback",submitComments:Ext.value(v,Ext.value(JE.systemConfig.APPROVECOMMENT,"未填写任何审批意见")),commentDetails:"",pdid:r.pdid,beanId:r.pkValue},C=!0)}else if("takeround"==e)i=l.title.takeround,r.doRoundNodeUser&&0<r.doRoundNodeUser.length&&Ext.each(r.doRoundNodeUser[0].children[0].children,function(e){delete e.checked}),f=r.doRoundNodeUser;else if("pass"==e)i=l.title.pass;else if("nopass"==e)i=l.title.nopass;else if("waiverpass"==e)i=l.title.waiverpass;else if("changepass"==e){var F=r.info.taskNodeInfos[r.taskName];i=l.title.changepass,p="jeicon jeicon-pass",n=!0,"ONE_ASSGINE"==F.countersignType&&F.countersignAssgineId==JE.currentUser.userId&&(c=!0)}else if("callentrust"==e)i=l.title.callentrust;else if("entrust"==e){i=l.title.entrust;var k=JE.ajax({url:JE.getUrlMaps("je.core.dd.tree","loadTree"),params:{onlyItem:!0,excludes:"checked",node:"ROOT",strData:'[{"ddCode":"JE_CORE_DEPTUSER","ddName":"","async":false,"whereSql":" and 1=1  AND STATUS=\'1\' AND ID!=\''+JE.currentUser.userId+'\'","orderSql":"","parentSql":"","rootId":"","nodeInfo":"","moreRoot":false}]'}});f=[{text:r.taskName,id:r.taskName,code:r.taskName,children:[{text:r.taskName,id:r.taskName,code:r.taskName,children:k}]}]}else if("transmit"==e){if(i=l.title.transmit,"countersign"==(F=r.info.taskNodeInfos[r.taskName]).type)return void JE.alert(l.alert.countersign);f=JE.ajax({url:JE.getUrlMaps("je.core.wf.taskInfo","loadTaskAssgine"),params:{targerTaskName:F.name,pdid:r.pdid,piid:r.piid,taskId:r.taskName,beanId:r.pkValue}})}else"suspend"==e&&(i=l.title.suspend);t&&"changepass"!=e&&(i=Ext.value(Ext.value(t.tooltip,t.text),i));var U={formObj:o,taskType:x,callback:r.callback,type:e,treeData:f,targerTaskName:m.join(","),targerTransition:g,targerTranInfos:D,buttonText:Ext.value(a,i),buttonIconCls:p,haveEnd:s,returnSubmitInfo:r.doReturnSubmitInfo,endInfo:d,changePass:n,returnback:u,passMainUser:c,wfBatch:r.wfBatch,comment:v,easyApprove:C,easyParams:w,wfInfo:r};if("submit"==e&&(Ext.each(f,function(e){"to_userdiy"==e.href?(U.type="userdiy",U.buttonText=l.title.diyuserBtn,U.targerTaskName=l.title.diyuserNode,U.treeData=[]):"to_jump"==e.href&&(U.type="jump",U.targerTaskName=e.text)}),-1!=["window","form"].indexOf(JE.systemConfig.JE_CORE_WFTYPE)&&U.haveEnd)){d=U.endInfo;f.push({async:!1,bean:{},children:[{async:!1,bean:{},children:[{async:!1,bean:{},children:[],code:d.targerTaskName+"_USERTYPE_USER",description:"",disabled:"0",enField:"",expandable:!0,expanded:!1,fieldCodes:"",href:"",hrefTarget:"",icon:"",iconCls:"",id:d.targerTaskName+"_USERTYPE_USER",layer:"",leaf:!1,nodeInfo:"ENDUSER",nodeInfoType:"ENDUSER",nodePath:"",nodeType:"ENDUSER",orderIndex:"",parent:d.targerTaskName+"_USERTYPE",parentPath:"",text:d.targerTaskName,treeOrderIndex:""}],code:d.targerTaskName+"_USERTYPE",description:"",disabled:"1",enField:"",expandable:!0,expanded:!1,fieldCodes:"",href:"",hrefTarget:"",icon:"",iconCls:"",id:d.targerTaskName+"_USERTYPE",layer:"",leaf:!1,nodeInfo:"USERTYPE",nodeInfoType:"USERTYPE",nodePath:"",nodeType:"USERTYPE",orderIndex:"",parent:d.targerTaskName,parentPath:"",text:d.targerTaskName+"_USERTYPE",treeOrderIndex:""}],code:d.targerTaskName,description:"",disabled:"1",enField:"",expandable:!0,expanded:!1,fieldCodes:"1",href:"",hrefTarget:"",icon:"",iconCls:"",id:d.targerTaskName,layer:"",leaf:!1,nodeInfo:"end",nodeInfoType:"end",nodePath:"",nodeType:"end",orderIndex:"",parent:"STATUS",parentPath:"",text:d.targerTaskName,treeOrderIndex:""})}return U},doWFSubmitWin:function(t,e,i){var a=this.getWFSubmitData(t,e,i);if(a){var n=t.wfInfo,o=JE.getLocalLang("core.jewfview.wfAction.doWFSubmitWin");if("sponsor"==e&&t&&t.form){var r=t.getDockedCmp("workflowTaskBar");r&&r.loadTask(n,n.pdid)}var l=a.easyApprove,s=a.easyParams;if(1==l){if(s.formObj=t,s.easyApprove=!0,"sponsor"==e)return void JE.Action.doWFSponsor(s);if("submit"==e)return void JE.Action.doWFSubmit(s);if("returnsubmit"==e)return void JE.Action.doWFReturnSubmit(s);if("jump"==e)return void JE.Action.doWFJump(s);if("back"==e)return void JE.Action.doWFBack(s);if("return"==e)return void JE.Action.doWFReturn(s);if("reject"==e)return void JE.Action.doWFReject(s)}var d=null;if(t&&t.form&&(d=t.getDockedCmp("workflowBar")),d)d.initWFData(t,a),d.show();else{if("window"==JE.systemConfig.JE_CORE_WFTYPE)return void JE.win({title:a.buttonText,items:{xtype:"jewfwinview",wfData:a,btnType:e},autoShow:!0,width:600,height:600,showFn:function(e){e.getCmp(0).initWFData(t,a)}});var c=[];"sponsor"!=e&&1!=n.wfBatch&&(c=JE.ajax({url:JE.getUrlMaps("je.core.wf.processInfo","loadProcessHistory"),params:{tableCode:n.tableCode,pkValue:n.pkValue}})),JE.win({title:JE.format(o.titleTpl,a.buttonText),height:JE.getBodyHeight()-100,width:JE.getBodyWidth()-100,items:Ext.apply({xtype:"jewfsendmsgview",wfLogData:c},a),border:0}).show()}}},doWFImageWin:function(e){var t=Ext.getCmp("jewfimageview_win");t||(t=JE.win({title:JE.local.lang.core.jewfview.wfAction.doWFImageWinTitle,id:"jewfimageview_win",height:JE.getBodyHeight()-100,width:JE.getBodyWidth()-100,items:{xtype:"jewfimageview",formObj:e,wfInfo:e.wfInfo,funcData:e.funcData},border:0})).show(null,function(){var e=t.items.get(0);JE.Action.doWFImageEdit(e)})},doWfSingleView:function(e){var t=Ext.value(e.tableName,e.funcCode),i=e.modelId,a=JE.ajax({url:JE.getUrlMaps("je.core.wf.processInfo","loadProcessHistory"),params:{tableCode:t,pkValue:i}}),n=JE.ajax({url:JE.getUrlMaps("je.core.wf.taskInfo","loadWfInfo"),params:{tableCode:t,pkValue:i,emptyPDID:!0,doTaskName:""}}).obj,o=JE.ajax({url:JE.getUrlMaps("je.core.mxGraph","expImg"),params:{tableCode:t,pkValue:i,pdid:n.pdid,type:"base64",transparent:"1"},text:!0}),r="图片不存在，请联系管理员重新保存流程数据并发布！";JE.isNotEmpty(o)&&(r="<img src='"+o+"'>");var l=Ext.create("JE.core.view.wf.WFImageView",{listeners:{afterrender:function(e){e.getComponent("wflogGrid").update(a),e.getComponent("imageBox").getGraphEl().update(r)}}});"func"==e.type?Ext.getCmp("_appcenterview").add(l):JE.win({title:JE.local.lang.core.jewfview.wfAction.doWFImageWinTitle,items:l,border:0,autoShow:!0})},doWFPromptWin:function(e){var t=e.wfInfo,i=JE.ajax({url:JE.getUrlMaps("je.core.wf.processInfo","loadProcessHistory"),params:{tableCode:t.tableCode,pkValue:t.pkValue}});win=JE.win({title:JE.local.lang.core.jewfview.wfAction.doWFPromptWinTitle,id:"jewfpromptview_win",height:550,width:850,items:{xtype:"jewfpromptview",formObj:e,wfInfo:t,wfLogData:i,funcData:e.funcData},border:0}),win.show(null,function(){0<i.length&&Ext.each(i,function(e){Ext.isEmpty(e.endTime)&&e.nodeName==t.doTaskName&&(Ext.isEmpty(e.assigneeCode)||win.down("form").form.setValues({userNames:e.assignee.replaceAll("<br/>",","),userIds:e.assigneeCode}))})})},doWFImageEdit:function(e){var i,a=e.formObj,n=a.wfInfo;(e.wfInfo=n).info&&Ext.iterate(n.info.taskNodeInfos,function(e,t){if(e==n.taskName)return i=t,!1}),e.getDockedComponent("buttonBar").items.each(function(e){var t;"wfSubmitBtn"==e.ref&&e.setDisabled(!a.isValid()),e.hide(),JE.Action.removeWFBtnGroups(e),-1!=n.btns.indexOf(e.ref)&&(e.show(),JE.Action.buildWFBtnGroups(e,i),(t=n.info.buttonInfos[e.ref])&&e.setText(Ext.value(t.zdyText,t.text)),i&&JE.isNotEmpty(i.buttonInfos)&&(t=i.buttonInfos[e.ref])&&!Ext.isEmpty(t.zdyText)&&e.setText(t.zdyText))});var t=e.getComponent("wflogGrid"),o=[];Ext.isEmpty(n.piid)||(o=JE.ajax({url:JE.getUrlMaps("je.core.wf.processInfo","loadProcessHistory"),params:{tableCode:n.tableCode,pkValue:n.pkValue}})),t.update(o),e.getComponent("imageBox").editor.loadData({xmlCode:JE.Action.loadWFXmlContent(n.pdid),tasks:n.currentTasks,doTask:n.doTaskName,wfLogData:o})},doWFFormItemEdit:function(i){var a=i.funcData,e=new Date,n=function(e){if(JE.isNotEmpty(e)&&i.getFields){var t=i.getFields(e);t&&(JE.isEmpty(t.visibleExp)&&JE.isEmpty(t.visibleExpFn)&&t.setVisible(!t.initialConfig.hidden),n(t.groupName))}};i.getFields().each(function(i){var e={visible:{val:!i.initialConfig.hidden,fn:"setVisible"},allowBlank:{val:i.initialConfig.allowBlank,fn:"setAllowBlank"},readOnly:{val:i.initialConfig.readOnly,fn:"setReadOnly"}};Ext.iterate(e,function(e,t){JE.isEmpty(i[e+"Exp"])&&JE.isEmpty(i[e+"ExpFn"])&&(i[t.fn]&&i[t.fn](t.val),n(i.groupName))})});var o=i.getDockedComponent("buttonBar");Ext.each(a.form.buttons,function(e){if(JE.isEmpty(e.visibleExp)){var t=o.down("button[ref="+e.ref+"]");t&&1!=t.noReadOnly&&t.setVisible(!t.initialConfig.hidden)}});for(var t=0;t<3;t++){var r=a.childObj[t+""];Ext.each(r,function(e){var t=Ext.getCmp(e.viewId+Ext.value(a.info.idSuffix,""));t&&(delete t.enableWFEdit,JE.isEmpty(e.visibleExp)&&JE.Action.doChildVisible(t,!0,i))})}JE.timeLog(e,"==工作流恢复表单元素初始状态，耗时")},doWFFormEdit:function(d,c,e){if(1==d.useWF){var t,u=JE.getLocalLang("core.jewfview.wfAction.doWFFormEdit"),p=e||{};"jewfimageview"==d.xtype&&(d=(t=d).formObj),JE.Action.doWFFormItemEdit(d);var f,E=d.funcData,i=c[E.info.pkName],a=!1,m=[];if(JE.isEmpty(p)&&!Ext.isEmpty(i)&&"WAIT"==c.SY_AUDFLAG){var n=Ext.value(c.__doTask,"");(o=JE.ajax({url:JE.getUrlMaps("je.core.wf.taskInfo","loadWfInfo"),params:{tableCode:E.info.tableName,pkValue:i,doTaskName:n,emptyPDID:Ext.isEmpty(E.wf.infos[c.SY_PDID])}})).success&&(p=o.obj,Ext.isEmpty(E.wf.infos[c.SY_PDID])&&(E.wf.infos[c.SY_PDID]=p.info))}if(JE.isEmpty(p)&&JE.isNotEmpty(c.SY_PIID)&&!Ext.isEmpty(i)&&-1!=["HANDUPED","SUSPEND","ENDED"].indexOf(c.SY_AUDFLAG)){var o,r=E.wf.infos[c.SY_PDID];if(Ext.isEmpty(r)||r&&r.moreForm)(o=JE.ajax({url:JE.getUrlMaps("je.core.wf.taskInfo","loadEndInfo"),params:{pdid:c.SY_PDID,piid:c.SY_PIID,emptyPDID:Ext.isEmpty(r)}})).success&&(p=o.obj,Ext.isEmpty(E.wf.infos[c.SY_PDID])&&(E.wf.infos[c.SY_PDID]=p.info))}if("ENDED"==c.SY_AUDFLAG&&JE.isNotEmpty(c.SY_PDID)&&Ext.isEmpty(E.wf.infos[c.SY_PDID]))(o=JE.ajax({url:JE.getUrlMaps("je.core.wf.processInfo","getProcessInfo"),params:{tableCode:E.info.tableName,SY_PDID:c.SY_PDID}})).success&&(E.wf.infos[c.SY_PDID]=o.obj);p=Ext.value(p,{}),Ext.isEmpty(c.SY_PDID)&&!Ext.isEmpty(p.pdid)||(p.pdid=c.SY_PDID),p.piid=c.SY_PIID,p.pkValue=i,p.tableCode=E.info.tableName,p.info=E.wf.infos[p.pdid],p.btns=Ext.value(p.btns,[]),E.info.readOnlyWF&&p?p.btns=[]:p&&p.info&&JE.isNotEmpty(p.info.funcCode)&&p.info.funcCode!=E.info.funcCode&&E.info.readOnlyWF&&(p.btns=[]),p.audFlag=Ext.value(Ext.value(p.audFlag,c.SY_AUDFLAG),"NOSTATUS"),Ext.isEmpty(c.__doTaskForm)||(p.doTaskForm=c.__doTaskForm),p.info&&Ext.iterate(p.info.taskNodeInfos,function(e,t){if(e==p.taskName)return f=t,!1});var l=p.audFlag,s=!1;if(p&&p.btns){Ext.each(["wfSubmitBtn","wfReturnSubmitBtn"],function(e){-1!=p.btns.indexOf(e)&&(s=!0)})}switch(p.info&&1!=p.info.enabled&&(l="NOSTATUS"),l){case"WAIT":a=!0,f&&f.formEditAble&&s&&(a=!1),m=Ext.clone(p.btns);break;case"HANDUPED":a=!0,(m=Ext.clone(p.btns)).push("wfHandUpLabel");break;case"SUSPEND":a=!0,(m=Ext.clone(p.btns)).push("wfSuspendLabel");break;case"ENDED":if(a=!0,(m=Ext.clone(p.btns)).push("wfEndLabel"),p.btns=["wfEndLabel"],p.info&&1<p.info.endTaskNodes.length){var g=JE.ajax({url:JE.getUrlMaps("je.core.wf.taskInfo","getProcessEndTask"),params:{piid:p.piid}});g.success&&Ext.each(p.info.endTaskNodes,function(e){e.name==g.obj.endTaskNode&&(f=e)})}else p.info&&(f=p.info.endTaskNodes[0]);break;case"NOSTATUS":if(m.push("wfStartBtn"),m.push("wfSponsorBtn"),d.formSaveBtnPrem()){if(!Ext.isEmpty(c[E.info.pkName])&&E.permInfo.selfUpdate){var h="SY_CREATEUSERID";JE.isNotEmpty(E.permInfo.userField)&&(h=E.permInfo.userField),a=c[h]!=JE.currentUser.userId}}else a=!0}d.wfInfo=p,d.readOnly=!a,d.setReadOnly(a),"NOSTATUS"==l&&Ext.iterate(E.fieldExp,function(e,t){var i=d.form.findField(e);JE.Action.doFieldExp(d,i,c,!0)});var x={showFields:{type:"field",data:[],act:"show"},hideFields:{type:"field",data:[],act:"hide"},editFields:{type:"field",data:[],act:"setReadOnly",params:!1},readOnlyFields:{type:"field",data:[],act:"setReadOnly",params:!0},notNullFields:{type:"field",data:[],act:"setAllowBlank",params:!1},showChildren:{type:"child",data:[],act:"show"},hideChildren:{type:"child",data:[],act:"hide"},editChildren:{type:"child",data:[],act:"setReadOnly",params:!1},enabledButtons:{type:"button",data:[],act:"show"}};p.info&&p.info.moreForm&&!Ext.isEmpty(p.doTaskForm)&&p.doTaskForm!=f.name&&(f=p.info.taskNodeInfos[p.doTaskForm]),f&&Ext.iterate(x,function(e,t){Ext.isEmpty(f[e])||(t.data=f[e].split(","),"editFields"==e&&0==p.doTaskEdit&&(t.params=!0))}),0<x.editFields.data.length&&x.enabledButtons.data.push("formSaveBtn");var v=d.getDockedComponent("buttonBar");Ext.iterate(x,function(e,i){Ext.each(i.data,function(e){switch(i.type){case"field":(e=d.getFields(e))&&JE.isNotEmpty(e.dataPerms)&&("setReadOnly"==i.act&&-1!=e.dataPerms.indexOf("readonly")||-1!=["hide","show"].indexOf(i.act)&&-1!=e.dataPerms.indexOf("hidden"))&&(e=void 0);break;case"button":e=v.down("button[ref="+e+"]");break;case"child":e=Ext.value(Ext.getCmp(e+"_jemainview"+E.info.idSuffix),Ext.getCmp(e+"_mainview"+E.info.idSuffix))}if(e){var t="";"button"==i.type||"field"==i.type&&("setReadOnly"==i.act&&0==i.params||"setAllowBlank"==i.act)?(f&&"end"==f.type||p.doTaskEdit&&Ext.isEmpty(c.__doTaskForm))&&(t="item"):t="child"==i.type&&-1!=["show","hide"].indexOf(i.act)?"child":"item",JE.isNotEmpty(t)&&("child"==t?JE.Action.doChildVisible(e,"show"==i.act,d):"field"==i.type&&"fieldset"==e.xtype&&-1!=["setReadOnly","setAllowBlank"].indexOf(i.act)?"setReadOnly"==i.act&&e.items.each(function(e){e.setReadOnly&&e.setReadOnly(i.params)}):(e[i.act](i.params),"child"==i.type&&"setReadOnly"==i.act&&(e.enableWFEdit=!i.params)))}})});var y=v.query("[wfButton]"),b=[],C=[];if(Ext.each(y,function(e){if(-1!=m.indexOf(e.ref)&&-1!=["wfSponsorBtn","wfStartBtn"].indexOf(e.ref)){var t=E.wf.infos[e.pdid];if(t&&!t.sysProcess){var i=t.sysProcessKey;JE.currentUser.zhId!=t.saasZhId?b.push(t.processKey):b.push(i)}}}),Ext.each(y,function(t){if(t.hide(),JE.Action.removeWFBtnGroups(t),-1!=m.indexOf(t.ref)){var e,i=t.getEl();if(i&&!i.hasCls("JEPLUS_B_WF01")&&i.addCls("JEPLUS_B_WF01"),-1!=["wfSponsorBtn","wfStartBtn"].indexOf(t.ref)){var a=!0,n=E.wf.infos[t.pdid];if(n){if(-1!=b.indexOf(n.processKey))return;if(JE.isNotEmpty(n.startExp)){var o=n.startExp;o=JE.toXT(o,c),a=Ext.value(JE.eval(o),!1)}if(JE.isNotEmpty(n.startExpFn)){var r=JE.decodeURI(n.startExpFn);a=!!(r=JE.eval(r,u.alert.expError+r,!1))&&(a&&Ext.value(r(c,Ext.value(d.mainData,{}),d),!0))}}if(!Ext.isEmpty(t.startRoles)){var l="roleId";"1"==JE.systemConfig.JE_SYSMODE&&(JE.currentUser.saas||(l=n&&n.sysProcess?"baseRoleId":"roleId"));var s=[];Ext.each(JE.currentUser.roles,function(e){s.push(e[l])}),Ext.each(t.startRoles.split(","),function(e){-1!=s.indexOf(e)&&(C.push(t.pdid),t.show())}),a=!1}if(!a)return;t.anyoneStartAble||c.SY_CREATEUSER!=JE.currentUser.userCode?t.anyoneStartAble&&(C.push(t.pdid),t.show()):(C.push(t.pdid),t.show())}else Ext.isEmpty(c.__doTaskForm)?(t.show(),JE.Action.buildWFBtnGroups(t,f)):-1!=["wfEndLabel","wfHandUpLabel","wfSuspendLabel"].indexOf(t.ref)&&t.show(),"wfCurrentTask"==t.ref&&t.setText(JE.format(u.wfCurrentTaskText,p.doTaskName));if(p.info&&"wfCurrentTask"!=t.ref&&1==p.info.enabled)if((e=p.info.buttonInfos[t.ref])&&(["wfSponsorBtn","wfStartBtn"].indexOf(t.ref),JE.isNotEmpty(e.zdyText)&&t.setText(Ext.value(e.zdyText,e.text))),f&&JE.isNotEmpty(f.buttonInfos))(e=f.buttonInfos[t.ref])&&!Ext.isEmpty(e.zdyText)&&t.setText(e.zdyText)}}),!Ext.isEmpty(p.pkValue)&&p.info&&1==p.info.enabled){var w=Ext.getCmp(E.info.funcCode+"_jegridview"+E.info.idSuffix);if(w){var S=w.store.findRecord(E.info.pkName,c[E.info.pkName]);S&&(S.data=c,S.commit())}p.info&&Ext.each(p.info.changeFields,function(e){var t=d.getFields(e);t&&(t.setValue(c[e]),t.resetOriginalValue())})}t&&JE.Action.doWFImageEdit(t);var I=d.formWFLog;if(I&&I.loadWfLog(c),JE.isNotEmpty(e)){var T=JE.Action.getWFButtonEvent(p,d.__activeWFButton,"afterclick");T&&T(d,p,d.__activeWFButton)}var _=1==C.length?C[0]:void 0;if(d.getDockedCmp("workflowTaskBar").loadTask(p,_),JE.isNotEmpty(e)&&"1"==JE.systemConfig.JE_DIANJIAN){var J=d.up("window");J&&-1!=["wfNextDiyUserBtn","wfBackDiyUserBtn","wfTransmitBtn","wfNextDiyUserBtn","wfSubmitBtn","wfReturnSubmitBtn","wfEntrustBtn","wfReturnBtn","wfRejectBtn","wfNoPassBtn","wfPassBtn","wfWaiverPassBtn"].indexOf(d.__activeWFButton)&&J.close()}delete d.__activeWFButton}},removeWFBtnGroups:function(e){var t=e.ownerCt,i=e.ref+"_groups",a=t.getCmp(i);a&&t.remove(a)},buildWFBtnGroups:function(i,e){if(e){e.taskBtnInfos=e.taskBtnInfos||{};var t=e.taskBtnInfos[i.ref];if(!JE.isEmpty(t)){i.hide();var a=i.ownerCt,n=i.ref+"_groups",o=a.getCmp(n);if(o)o.removeAll();else{var r=0;a.items.each(function(e,t){if(e.ref==i.ref)return r=t,!1}),o=a.insert(r,{xtype:"toolbar",style:"border:0;padding:0;background-color: transparent;",margin:0,itemId:n})}var l=Ext.clone(i.initialConfig);delete l.wfButton,Ext.each(t,function(e){var t=Ext.clone(l);Ext.apply(t,{child:!0,hidden:!1,btnInfos:e,text:e.btnName}),o.add(t)})}}},getWFButtonEvent:function(e,t,i){if(e&&e.info){var a=e.info.buttonInfos[t];if(a)return JE.getObjAttr(a.events,i)}},showRoundComments:function(e){e=Ext.value(e,[]);var t=JE.Action.getRoundCommentsTpl(e);JE.win({title:JE.local.lang.core.jewfview.wfAction.showRoundCommentsTitle,bodyStyle:"background-color:#ffffff;",height:.5*JE.getBodyHeight(),width:.5*JE.getBodyWidth(),autoShow:!0,autoScroll:!0,frame:!1,autoScroll:!0,html:t})},showProcess:function(e){var t=Ext.getCmp(e).down("form[itemId=wfBatchBar]"),i=t.down("multiselect[name=PROCESS]"),a=t.down("multiselect[name=PROCESS_TASK]"),n=i.getSubmitValue(),o=i.wfInfos[n];JE.win({title:JE.local.lang.core.jewfview.wfAction.showProcessTitle,width:JE.getBodyWidth()-400,height:JE.getBodyHeight()-400,useButton:!0,items:{xtype:"graphfield",width:"100%",margin:"0 0 4 0",region:"center",enableSelect:!0,value:"",listeners:{afterrender:function(e){e.setValue(JE.Action.loadWFXmlContent(o.pdid))}}},fn:function(e){var t=e.down("graphfield").selectCell;if(t){var i=t.getAttribute("name");a.setValue(i)}}}).show()},showWFImage:function(e){var t=e.pdid,i=e.xmlContext,a=e.title||JE.local.lang.core.jewfview.wfAction.showImageTitle;t&&(i=JE.Action.loadWFXmlContent(t)),JE.win({title:a,width:JE.getBodyWidth()-400,height:JE.getBodyHeight()-100,border:0,items:{xtype:"graphfield",border:0,listeners:{afterrender:function(e){e.setValue(i)}}}}).show()},buildWFLogTpl:function(e){var t=JE.getLocalLang("core.jewfview.wfLog");return['<table class="je-form-history">','{% var statusStyle="",timeStyle="";',"if(JE.isNotEmpty(values)){","var item = values[0];","statusStyle=item.statusStyle,timeStyle=item.timeStyle;","}","%}","<tr>","<th width=80>"+t.nodeName+"</th>","<th width=80>"+t.user+"</th>","<th width=120>"+t.oper+"</th>","<th>"+t.opinion+"</th>","<th width=150>"+t.file+"</th>",'<th width=50 style="{[statusStyle]}">'+t.status+"</th>","<th width=80>"+t.receiptTime+"</th>","<th width=80>"+t.appTime+"</th>",'<th width=60 style="{[timeStyle]}">'+t.takesTime+"</th>","</tr>",'<tpl for=".">','<tpl if="transCode">',"<tr><tpl else>",'<tr style="color:rgb(152, 152, 152);"></tpl>',"<tpl if=\"typeDesc != ''\">",'<tpl if="taskRowspan != -1">','<td style="padding:0px;" rowspan={taskRowspan}>{nodeName}',"<tpl if=\"JE.isNotEmpty(roundComments) && roundComments != '[]'\">",e?"":"<tpl if=\"nodeType != 'batchtask'\"><br/><a href=\"javascript:void(0)\" onclick='JE.Action.showRoundComments({roundComments})' >"+t.circulateInfo+"</a></tpl>","</tpl>","</td>","</tpl>",'<td style="padding:0px;" ><tpl if="diyAssignee != \'\'">',"{diyAssignee}","<tpl else>","{assignee}","</tpl>","</td>",'<td style="padding:0px;" >{[JE.Action.getTranNameTpl(values)]}</td>','<td style="padding:0px;" colspan="<tpl if="[\'batchtask\',\'countersign\'].indexOf(nodeType) != -1">2<tpl else>1</tpl>" ><tpl if="commentDetailId != \'\'">','{comments}<div style="text-align:right;padding:2px;float:right;font-weight:bold;"><a title="详细信息" href="javascript:void(0)" onclick="JE.Action.showCommentDetail(\'{commentDetailId}\')">...</a></div>',"<tpl elseif=\"nodeType == 'batchtask'\">","{[JE.Action.getBatchtaskTpl(values)]}","<tpl elseif=\"nodeType == 'countersign'\">","{[JE.Action.getCountersignTpl(values)]}","<tpl else>{comments}","</tpl></td>","<tpl if=\"['batchtask','countersign'].indexOf(nodeType) == -1\">",'<td style="padding:0px;" >{[JE.Action.getWFFilesTpl(values)]}</td>',"</tpl>",'<td style="padding:0px;{statusStyle}" >{[JE.Action.getStatusNameTpl(values)]}</td>','<td style="padding:0px;background:rgb(252, 255, 187);" >{startTime}</td>','<td style="padding:0px;background:rgb(252, 255, 187);" >{endTime}</td>','<td style="padding:0px;background:rgb(252, 255, 187);{timeStyle}" >{durationDesc}</td>',"<tpl else>",'<td style="text-align: left;padding-left:85px;height:24px;background: rgb(252, 255, 187)" colspan=9 >------{nodeName}------</td>',"</tpl>","</tr>","</tpl>","</table>"]},getStatusNameTpl:function(e){var t=JE.getLocalLang("core.jewfview.wfLog"),i=e.status;return t[i]?t[i]:t.ZC},getTranNameTpl:function(e){var t=JE.getLocalLang("core.jewfview.wfLog"),i=e.transCode;return JE.isEmpty(i)&&(i="empty"),t[i]?t[i]:e.transName},getFlowUserInfo:function(e,t){var i=e.bean,a=e.displayConfigInfo,n=JE.getLocalLang("core.jewfview.wfFlowInfo");if(t)if("APPROVED"==t||"OWNER"==t)for(var o in n)-1!=n[o].indexOf("我")&&(n[o]=n[o].split("我")[0]);else n={to_submit:"送交给我",to_jump:"送交给我",to_allot:"调拨给我",to_returnsubmit:"送交给我",to_rollback:"退回给我",to_withdraw:"取回",to_entrust:"委托给我",to_returnback:"退回给我",to_callentrust:"撤销委托",to_transmit:"转办给我",to_taketask:"领取任务",to_end:"流程结束",to_round:"传阅给我",to_takeround:"审阅",to_circular:"办理",to_reject:"驳回",no:"未处理",yes:"已处理",to_pass:"通过",to_nopass:"不通过",to_waiverpass:"弃权",to_userdiy:"转交",to_backuserdiy:"转交"};if(!JE.isNotEmpty(i.SY_LASTFLOWINFO))return JE.isNotEmpty(i.SY_LASTFLOWUSER)?i.SY_LASTFLOWUSER:"";var r=JE.toObj(i.SY_LASTFLOWINFO);r=JE.isNotEmpty(r)?r:"{}";var l="";if(t&&r&&(l="APPROVED"==t||"OWNER"==t?Ext.value(n[r.tranCode]+i.SY_PREAPPROVUSERNAMES,"未知动作"):r.tranCode?Ext.value(n[r.tranCode],"未知动作"):"送交给我"),JE.isNotEmpty(l)){var s=JE.isNotEmpty(r.userName)?r.userName:i.SY_LASTFLOWUSER;return JE.isNotEmpty(a)?s+"『已审批』":s+"『"+l+"』"}if(!r)return i.SY_LASTFLOWUSER;r.userName},getFlowCommentInfo:function(e){var t=e.bean;if(JE.isNotEmpty(t.SY_LASTFLOWINFO)){var i=JE.toObj(t.SY_LASTFLOWINFO);i&&(t.SY_LASTFLOWCOMMENT=i.comment)}var a="需处理任务:"+e.taskName;JE.isNotEmpty(t.SY_LASTFLOWCOMMENT)&&(a="意见:"+t.SY_LASTFLOWCOMMENT);var n=e.displayConfigInfo;return Ext.isEmpty(n)||(a=JE.toXT(n,e)),a},getWFFilesTpl:function(e){var t=Ext.decode(Ext.value(e.fileVals,"[]")),i=[];return JE.isNotEmpty(t)&&(i=['<div style="padding:2px;text-align:left;">'],Ext.each(t,function(e){if(JE.isNotEmpty(e.path)){var t=JE.getFileUrl(e.path,"","","",e.beanTableCode);t+="&fileName="+e.name,i.push('<a href="'+t+'" target="_black" data-id="'+e.id+'">'+e.name+"</a> ")}}),i.push("</div>")),i.join("")},getRoundCommentsTpl:function(e){var o=JE.getLocalLang("core.jewfview.wfLog"),r=['<table class="je-form-history" style="border-width:0px;margin:0px;">'];return e&&0<e.length&&JE.isEmpty(e[0].user)?((r=[]).push('<table width=100% border=1 style="text-align:center;border-collapse:collapse;border-spacing:0;">'),r.push('<tr style="background:#cccccc;font-weight:bold;">'),r.push("<td width=80>"+o.roundAssgine+"</td>"),r.push("<td width=80>"+o.roundStatus+"</td>"),r.push("<td>"+o.roundComments+"</td>"),r.push("<td width=80>"+o.roundTime+"</td>"),r.join("")+e.join("</tr>")+"</tr></table>"):(r.push("<tr>","<th width=80>"+o.user+"</th>","<th width=120>"+o.oper+"</th>","<th>"+o.opinion+"</th>","<th width=60>"+o.appTime+"</th>","<th width=150>"+o.file+"</th>","</tr>"),Ext.each(e,function(e,t){var i="font-size:12px;height:auto;padding:2px;",a=Ext.value(e.files,[]),n=[];JE.isNotEmpty(a)&&(n=['<div style="padding:2px;text-align:left;">'],Ext.each(a,function(e){n.push('<a href="'+e.path+'" target="_black" data-id="'+e.id+'">'+e.name+"</a> ")}),n.push("</div>")),r.push("<tr>"),r.push('<td width="100" style="'+i+'">'+e.user+"</td>"),r.push('<td width="100" style="'+i+'">'+o[e.doType]+"</td>"),r.push('<td style="'+i+'">'+e.msg+"</td>"),r.push('<td width="130" style="'+i+'">'+Ext.value(e.time,"")+"</td>"),r.push('<td width="150" style="'+i+'">'+n.join("")+"</td>"),r.push("</tr>")}),r.push("</table>"),r.join(""))},getCountersignTpl:function(e){if(JE.isNotEmpty(e.comments)&&-1!=e.comments.indexOf("<table"))return e.comments;var r=Ext.decode(Ext.value(e.comments,"[]"));if(JE.isEmpty(r))return"";var l=JE.getLocalLang("core.jewfview.wfLog"),s=['<table class="je-table" style="border-width:0px;margin:0px;">'];return Ext.each(r,function(e,t){var i="font-size:12px;height:auto;padding:2px;";if(0==t?i+="border-top-width:0px;":t==r.length-1&&(i+="border-bottom-width:0px;"),0==t){var a="";a="PROPORTION_YES"==e.countersignType?JE.toXT(l.countersignBefore+'<span style="color:red;">'+l[e.countersignType]+"</span>，"+l.countersignNow+'<span style="color:red;">{countersignProportion}%</span>，'+l.countersignAfter+'：<span style="color:red;">{nowProportion}%</span>',e):JE.toXT(l.countersignBefore+'<span style="color:red;">'+l[e.countersignType]+"</span>，"+l.countersignUserNow+'<span style="color:red;">{countersignAssgineName}</span>，'+l.countersignUserAfter+'：<span style="color:red;">'+l[e.nowAssgineType]+"</span>",e),s.push("<tr>",'<td colspan="5" align="center" style="font-weight: bold;border-left-width:0px;border-right-width:0px;'+i+'">'+a+"</td>","</tr>")}else{var n=Ext.value(e.files,[]),o=[];JE.isNotEmpty(n)&&(o=['<div style="padding:2px;text-align:left;">'],Ext.each(n,function(e){o.push('<a href="'+e.path+'" target="_black" data-id="'+e.id+'">'+e.name+"</a> ")}),o.push("</div>")),s.push("<tr>"),s.push('<td width="100" style="border-left-width:0px;'+i+'">'+e.user+"</td>"),s.push('<td width="100" style="'+i+'">'+l[e.doType]+"</td>"),s.push('<td style="'+i+'">'+e.msg+"</td>"),s.push('<td width="130" style="border-right-width:0px;'+i+'">'+Ext.value(e.time,"")+"</td>"),s.push('<td width="150" style="border-right-width:0px;'+i+'">'+o.join("")+"</td>"),s.push("</tr>")}}),s.push("</table>"),s.join("")},getBatchtaskTpl:function(e){var r=Ext.decode(Ext.value(e.comments,"[]"));if(JE.isEmpty(r))return"";var l=JE.getLocalLang("core.jewfview.wfLog"),s=['<table class="je-table" style="border-width:0px;margin:0px;">'],d=e.roundComments||"[]";return Ext.each(r,function(e,t){var i="font-size:12px;height:auto;padding:2px;";0==t?i+="border-top-width:0px;":t==r.length-1&&(i+="border-bottom-width:0px;");var a=Ext.value(e.files,[]),n=[];JE.isNotEmpty(a)&&(n=['<div style="padding:2px;text-align:left;">'],Ext.each(a,function(e){n.push('<a href="'+e.path+'" target="_black" data-id="'+e.id+'">'+e.name+"</a> ")}),n.push("</div>")),s.push("<tr>");var o=e.assgine;JE.isNotEmpty(d)&&"[]"!=d&&(o+='<br/><a href="javascript:void(0)" onclick=\'JE.Action.showRoundComments('+d+")' >"+l.circulateInfo+"</a>"),s.push('<td width="100" style="border-left-width:0px;'+i+'">'+o+"</td>"),s.push('<td width="100" style="'+i+'">'+l[e.doType]+"</td>"),s.push('<td style="'+i+'">'+e.msg+"</td>"),s.push('<td width="130" style="border-right-width:0px;'+i+'">'+Ext.value(e.time,"")+"</td>"),s.push('<td width="150" style="border-right-width:0px;'+i+'">'+n.join("")+"</td>"),s.push("</tr>")}),s.push("</table>"),s.join("")},showLogTpl:function(e,t,i){var a=JE.ajax({url:"/jbpm/processInfoAction!loadProcessHistory.action",params:{tableCode:t,pkValue:i}});0<a.length&&Ext.each(a,function(e){Ext.isEmpty(e.endTime)||(e.endTime=JE.DATE.formatDate(JE.DATE.parseDateTime(e.endTime),"n月j日 G时"))});JE.getLocalLang("core.jewfview.wfLog");var n=new Ext.XTemplate(this.buildWFLogTpl(!0)).apply(a);JE.popOver(e,n,JE.local.lang.core.jewfview.wfAction.showLogTplTitle,"left")},doPromptUser:function(e,t,i){var a=Ext.getCmp(e).getStore();a.findRecord("USERID",i)||a.add({USERID:i,USERNAME:t})},setFieldsConfig:function(e,t){var o=Ext.getCmp(e).getSelectionModel().getSelection()[0];if(o){var i=o.get("fieldsConfig"),a=[];if(!Ext.isEmpty(i)){var n=i.split(",")[0].split("~"),r=i.split(",")[1].split("~");Ext.each(r,function(e,t){a.push({field:e,value:n[t]})})}var l=JE.getLocalLang("core.jewfview.wfAction.setFieldsConfig");JE.formWin({title:l.title,width:360,height:400,border:0,layout:"fit",frame:!1,items:[{xtype:"jsonarrayfield",labelAlign:"top",actionColumn:!0,value:a,border:0,name:"fieldsConfig",columnAlign:"left",height:void 0,columns:[{dataIndex:"field",flex:1,text:l.fieldColumn,field:{xtype:"gridssfield",configInfo:"JE_CORE_TABLECOLUMN,field,TABLECOLUMN_CODE,S",whereSql:" AND TABLECOLUMN_TABLECODE='"+t+"'",editable:!0}},{dataIndex:"value",editable:!0,flex:1,text:l.valueColumn,field:{xtype:"cbbfield",configInfo:"JE_WF_DEFAULTVALUE",editable:!0,displayField:"code"}}]}],fn:function(e,t){var i=[],a=[],n=JE.toObj(e.fieldsConfig);Ext.each(n,function(e){if(!Ext.isEmpty(e.field)){var t=e.value;Ext.isEmpty(e.value)&&(t="''"),i.push(e.field),a.push(t)}}),0<i.length?o.set("fieldsConfig",a.join("~")+","+i.join("~")):o.set("fieldsConfig","")}})}else JE.alert(JE.local.lang.core.jewfview.wfAction.setFieldsConfig.alert)},doChangeTask:function(o){var t=[],e=JE.ajax({url:JE.getUrlMaps("je.core.wf.taskInfo","loadForkTaskInfo"),params:{tableCode:o.wfInfo.tableCode,pkValue:o.wfInfo.pkValue}}),a={};e.success&&(a=e.obj);var r=JE.getLocalLang("core.jewfview.wfAction.doChangeTask");Ext.each(o.wfInfo.currentTasks,function(e){if(0<a[e].length){var i=new Array;Ext.each(a[e],function(e){var t=o.down("button[ref="+e+"]");t&&i.push(t.getText())}),t.push({id:e,text:e+'<span style="color:#C0C0C0;">('+i.join(",")+")</span>",code:i.join(","),iconCls:"jeicon jeicon-button",leaf:!0,parent:"ROOT",children:[]})}}),t.length<=0?JE.alert(r.alert.noTask):JE.win({width:350,height:400,border:0,frame:!1,autoShow:!0,useButton:!0,title:r.title,layout:"fit",items:[{xtype:"jetreeview",border:0,type:"func",searchBar:!1,rootData:{id:"ROOT",text:"ROOT",code:"ROOT",children:t}}],fn:function(e){var t=e.down("jetreeview").getSelectionModel().getSelection()[0];if(!t)return JE.alert(r.alert.noSelect),!1;var i=null,a=(i="jewfimageview"==o.xtype?o.formObj:o).form.getValues();if(a.__doTask=t.get("id"),JE.Action.doWFFormEdit(i,a),"jewfimageview"==o.xtype){var n=o.up("window").items.get(0);JE.Action.doWFImageEdit(n)}JE.msg(r.alert.changeOk+t.get("id"))},listeners:{show:function(e){var t=e.down("jetreeview"),i=t.getStore().getNodeById(o.wfInfo.doTaskName);t.getSelectionModel().select(i)}}})},doChangeForm:function(n){var i=[],o=JE.getLocalLang("core.jewfview.wfAction.doChangeForm");Ext.each(n.wfInfo.currentTaskForms,function(e){var t=e;n.wfInfo.doTaskForm==e&&(t=e+"<span style='color:#C0C0C0;'>("+o.taskNameSuffix+")</span>"),i.push({id:e,text:t,code:e,iconCls:"jeicon jeicon-button",leaf:!0,parent:"ROOT",children:[]})}),JE.win({width:300,height:350,border:0,frame:!1,autoShow:!0,useButton:!0,title:o.title,layout:"fit",items:[{xtype:"jetreeview",border:0,type:"func",searchBar:!1,rootData:{id:"ROOT",text:"ROOT",code:"ROOT",children:i}}],fn:function(e){var t=e.down("jetreeview").getSelectionModel().getSelection()[0];if(!t)return JE.alert(o.noSelectTaskAlert),!1;var i=null,a=(i="jewfimageview"==n.xtype?n.formObj:n).form.getValues();a.__doTaskForm=t.get("id"),JE.showFunc(i.funcData.info.funcCode,{idSuffix:"_wfTaskFormWin",useChild:!0,values:a,readOnly:!0,type:"form",callback:function(e){}})},listeners:{show:function(e){var t=e.down("jetreeview"),i=t.getStore().getNodeById(n.wfInfo.doTaskForm);t.getSelectionModel().select(i)}}})},setMessageConfig:function(e){var t=Ext.getCmp(e),i=JE.getLocalLang("core.jewfview.wfAction.setMessageConfig"),a=t.form.findField("PROCESSINFO_MESSAGEJSON");JE.formWin({title:i.title,width:700,height:500,border:0,frame:!1,autoShow:!0,formConfig:{bodyPadding:"10 10 0 10"},formDefaults:{},items:[{xtype:"textarea",name:"TITLE",fieldLabel:"标题",value:"流程[{@PROCESS_NAME@}]提醒"},{xtype:"textarea",name:"DWR",fieldLabel:i.DWRLabel,value:i.DWR},{xtype:"textarea",name:"RTX",hidden:!0,fieldLabel:i.RTXLabel,value:i.RTX},{xtype:"textarea",name:"EMAIL",fieldLabel:i.EMAILLabel,value:i.EMAIL},{xtype:"textarea",name:"NOTE",fieldLabel:i.NOTELabel,value:i.NOTE},{xtype:"textarea",name:"EXPRESS",fieldLabel:i.EXPRESSLabel,value:i.EXPRESS},{xtype:"textarea",name:"WX",fieldLabel:i.WXLabel,value:i.WXHTML}],formConfig:{dockedItems:[{xtype:"box",dock:"bottom",padding:"5",margin:"5",minHeight:30,html:i.html,cls:"x-view-emtpytext"}]},fn:function(e,t){a.setValue(Ext.encode(e))},showFn:function(e){var t=e.down("form"),i=a.getValue();Ext.isEmpty(i)||t.form.setValues(Ext.decode(i))}})},doCountersignUser:function(e){var f=JE.getLocalLang("core.jewfview.wfAction.doCountersignUser",!0),E=Ext.get(e).up("table[name=countersign]"),n=this.getCountersignInfo(E);JE.formWin({title:f.title,width:500,height:300,border:0,frame:!1,autoShow:!0,formConfig:{bodyPadding:"10 10 0 10"},formDefaults:{},items:[{xtype:"cbbfield",name:"countersignType",configInfo:"JE_WF_COUNTERSIGNTYPE",fieldLabel:f.typeLabel,readOnly:!0},{fieldLabel:f.proportionLabel,xtype:"cbbfield",name:"countersignProportion",configInfo:"JE_PERCENTAGE"},{fieldLabel:f.assgineNameLabel,xtype:"queryuserfield",name:"countersignAssgineName",configInfo:"JE_CORE_QUERYUSER,countersignAssgineName~countersignAssgine,USERNAME~USERID,S",whereSql:" AND USERID IN ('"+n.allUserIds.join("','")+"')"},{fieldLabel:f.userNamesLabel,xtype:"queryuserareafield",name:"userNames",height:140,configInfo:"JE_CORE_QUERYUSER,userNames~userIds,USERNAME~USERID,M",whereSql:" AND USERID IN ('"+n.allUserIds.join("','")+"')",listeners:{afterrender:function(r){r.maxviewEl=r.labelEl.parent().appendChild({tag:"div",style:"cursor: pointer;color:red;margin:10px;text-align:right;",html:f.maxviewElHtml}),r.maxviewEl.on("click",function(){var e=r.up("form"),t=e.form.getValues();if(JE.isEmpty(t.userIds))JE.alert(f.alert.noUser);else{var i=t.userIds.split(","),a=t.userNames.split(","),n=[];Ext.each(i,function(e,t){n.push({index:t+1,name:a[t],id:e})});var o=Ext.create("Ext.data.Store",{fields:["name","id","index"],data:n});JE.win({title:f.title,width:200,height:300,border:0,basicForm:e,frame:!0,autoShow:!0,items:[{xtype:"grid",border:0,autoScroll:!0,columnLines:!0,columns:{defaults:{menuDisabled:!0,align:"center",sortable:!1},items:[{dataIndex:"index",text:"No.",width:30},{dataIndex:"name",text:f.nameColumn,flex:1},{dataIndex:"id",text:f.idColumn,hidden:!0,flex:1}]},viewConfig:{enableTextSelection:!0,listeners:{drop:function(e,t,i,a){var n=1;o.each(function(e,t){e.get("index")!=n&&e.set("index",n),n++})}},plugins:{ptype:"gridviewdragdrop",dragText:f.dragText,pluginId:"ddOrder"}},store:o}],useButton:!0,fn:function(e){var t=new Array,i=new Array;o.each(function(e){t.push(e.get("id")),i.push(e.get("name"))}),e.basicForm.form.setValues({userIds:t.join(","),userNames:i.join(",")})}})}})}}},{xtype:"hidden",fieldLabel:"会签人员ID",name:"userIds"},{xtype:"hidden",fieldLabel:"负责人ID",name:"countersignAssgine"}],fn:function(n,e){var t=E.query("tr");if(Ext.isEmpty(n.userIds))return JE.alert(f.alert.noUser),!1;var i=n.userIds.split(",");if("ONE_ASSGINE"==n.countersignType){if(Ext.isEmpty(n.countersignAssgine))return JE.alert(f.alert.noAssgine),!1;if(-1==i.indexOf(n.countersignAssgine))return JE.alert(f.alert.assgineInUsers),!1}var a=n.userIds.split(","),o=n.userNames.split(","),r=null;Ext.each(t,function(e){var t=Ext.get(e),i=t.getAttribute("name");if("user"==i){var a=t.down("td");t.remove()}else if("countersignAssgine"==i){(a=t.down("td")).set({userId:n.countersignAssgine}),a.set({userName:n.countersignAssgineName}),a.setHTML(JE.format(f.tdDomHtml,n.countersignAssgineName))}else"countersignUser"==i&&(r=t)});for(var l=a.length-1;0<=l;l--)r.insertHtml("afterend",'<tr style="display:block;" name="user"><td style="text-align:left;" select="1" userId="'+a[l]+'" userName="'+o[l]+'">'+o[l]+"</td></tr>");var s=Ext.getCmp(E.dom.parentNode.id);if(s){var d=s.tabObj,c=s.viewObj.down("tabpanel[name="+d.name+"]");if(c){var u=c.down("jetreeview[name="+d.name+"]");if(u){var p=u.getRootNode().getChildAt(0);p&&u.getSelectionModel().select(p)}}}},showFn:function(e){var t=e.down("form");n.userNames=n.userNames.join(","),n.userIds=n.userIds.join(",");var i=t.form.findField("countersignAssgineName"),a=t.form.findField("countersignProportion");i.setVisible("ONE_ASSGINE"==n.countersignType),a.setVisible("ONE_ASSGINE"!=n.countersignType),t.form.setValues(n)}})},doTaskUser:function(e){var t=Ext.get(e),s=t.up("table[name=taskInfo]"),d=t.up("table[name=forkInfo]"),i=s.down("tr[name=taskAssgine]").down("td[name=userInfo]"),a=s.down("tr[name=processInfo]").down("td").getAttribute("processInfo"),n=JE.toObj(a),r=i.getAttribute("userIds"),o={targerTaskName:n.taskName,taskId:n.executeTaskName,pdid:n.pdid,piid:n.piid,beanId:n.pkValue},l=JE.ajax({url:JE.getUrlMaps("je.core.wf.taskInfo","loadTaskAssgine"),params:o}),c=t.getY();c+300>JE.getBodyHeight()&&(c=JE.getBodyHeight()-310),JE.win({title:JE.local.lang.core.jewfview.wfAction.doTaskUserTitle,x:t.getX()+55,y:c,width:218,height:300,border:0,frame:!1,autoShow:!0,useButton:!0,items:{xtype:"jewftaskuserview",treeData:l},fn:function(e){var t=e.down("jewftaskuserview").getUsers();if(null==t)return!1;var i=s.down("tr[name=taskAssgine]").down("td[name=userInfo]");i.set({userIds:t.assigeeId,userNames:t.assigeeName}),i.setHTML(t.assigeeName);var a=Ext.getCmp(d.dom.parentNode.id);if(a){var n=a.tabObj,o=a.viewObj.down("tabpanel[name="+n.name+"]");if(o){var r=o.down("jetreeview[name="+n.name+"]");if(r){var l=r.getRootNode().getChildAt(0);l&&r.getSelectionModel().select(l)}}}},listeners:{show:function(e){var t=e.down("jewftaskuserview").getComponent("spListView");if(!Ext.isEmpty(r)){var n=r.split(","),o=new Array;t.items.each(function(e){e.items.each(function(e){var t=e.getSelectionModel(),i=e.getRootNode(),a=[];i.cascadeBy(function(e){-1!=n.indexOf(e.get("nodeInfo"))&&-1==o.indexOf(e.get("nodeInfo"))&&(1==n?t.select(e):a.push(e),o.push(e.get("nodeInfo")))}),0<a.length&&t.select(a)})})}}}})},getCountersignInfo:function(e){var t=e.query("tr"),n={userNames:[],userIds:[],allUserIds:[],countersignAll:"1"};return Ext.each(t,function(e){var t=Ext.get(e),i=t.getAttribute("name");if("user"==i){var a=t.down("td");n.allUserIds.push(a.getAttribute("userId")),"1"==a.getAttribute("select")&&(n.userNames.push(a.getAttribute("userName")),n.userIds.push(a.getAttribute("userId")))}else if("countersignType"==i){a=t.down("td");n.countersignType=a.getAttribute("countersignType")}else if("countersignAssgine"==i){a=t.down("td");n.countersignAssgine=a.getAttribute("userId"),n.countersignAssgineName=a.getAttribute("userName")}else if("countersignProportion"==i){a=t.down("td");n.countersignProportion=a.getAttribute("countersignProportion")}}),n},getForkInfo:function(e){var s=[],t=e.query("table[name=taskInfo]");return Ext.each(t,function(e){var t=Ext.get(e),i={};i.taskName=t.getAttribute("taskName"),i.taskType=t.getAttribute("taskType");var a=t.down("tr[name=taskConfig]").down("input[name=doTask]");i.doTask=1==a.getAttribute("checked")?"1":"0";var n=t.down("tr[name=taskAssgine]");if("countersign"==i.taskType){var o=n.down("table[name=countersign]"),r=JE.Action.getCountersignInfo(o);r.userIds=r.userIds.join(","),r.userNames=r.userNames.join(","),delete r.allUserIds,i.countersignInfo=r}else{var l=n.down("td[name=userInfo]");i.assgineeInfo={userNames:l.getAttribute("userNames"),userIds:l.getAttribute("userIds")}}s.push(i)}),s},showCommentDetail:function(e){var t=JE.ajax({url:JE.getUrlMaps("je.core.load"),params:{tableCode:"JE_CORE_COMMENTDETAIL",whereSql:" AND JE_CORE_COMMENTDETAIL_ID='"+e+"'",orderSql:"",queryFields:"JE_CORE_COMMENTDETAIL_ID,COMMENTDETAIL_NR",limit:-1}}),i=t&&t.rows&&1==t.rows.length?t.rows[0]:JE.error("数据获取失败！");JE.win({title:"详细信息",autoShow:!0,bodyStyle:"background-color:#ffffff;padding:4px;",autoScroll:!0,html:Ext.htmlDecode(i.COMMENTDETAIL_NR),maximized:!1})},loadWFXmlContent:function(e){return JE.ajax({url:JE.getUrlMaps("je.core.wf.taskInfo.loadWfXmlInfo"),params:{pdid:e},text:!0})||""}}),Ext.define("JE.core.store.GridStore",{extend:"Ext.data.Store",remoteSort:!0,constructor:function(e){var s=this,d=e.gridObj,c=d.funcData,t=Ext.value(c.info.funcAction,JE.getUrlMaps("je.core"));t=JE.replaceOldUrl(t),s.model=c.info.modelName;var i=Ext.value("query"==d.type?c.info.quickSql:c.info.whereSql,"");1==c.info.doDisable&&(t==JE.getUrlMaps("je.core")?i+=" and SY_STATUS != '0' ":i+=" and status != '0'");var a=Ext.value(c.info.treeFuncSql,""),n=Ext.value(c.info.orderSql,""),o={funcCode:c.info.funcCode,funcId:c.info.funcId,columnLazy:c.info.columnLazy,mark:c.info.mark,postil:c.info.postil,funcEdit:c.info.funcEdit,tableCode:c.info.viewTableName,whereSql:i+a,orderSql:n};-1!=["procedure","iditprocedure","sql"].indexOf(c.info.funcType)&&Ext.apply(o,{queryType:c.info.funcType,datasourceName:c.info.dbName,procedureName:c.info.dbProcedure,queryParamsStr:Ext.encode(c.info.dbQueryParams),dbSql:c.info.dbSql}),-1==c.info.pageSize&&(o.limit=-1),s.sqls={basic:i,order:n,treeFunc:a},Ext.isEmpty(c.info.groupField)||(s.groupField=Ext.value(c.info.groupField.split("~")[0],""),s.groupDir=Ext.value(c.info.groupField.split("~")[1],"ASC").toLocaleUpperCase(),o.useOrderSql="1");var r=0<c.info.gridTimeout?c.info.gridTimeout:30;s.proxy=new Ext.data.proxy.Ajax({url:t+JE.getUrlMaps("method.load"),extraParams:o,timeout:1e3*r,method:"POST",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},reader:{type:"json",root:"rows",totalProperty:"totalCount"},extractResponseData:function(e){return e}}),s.pageSize=Ext.value(c.info.pageSize,30),s.actUrls=JE.getActionUrls(t),s.callParent(arguments),s.on({beforeload:function(t){setTimeout(function(){var e=t.gridObj.body;e&&(e.mask(JE.local.lang.core.util.Util.doMaskMsg),t.masking=!0)},1)},load:function(t,e,i,a){if(0==i){var n=t.proxy.reader.jsonData;n&&0==n.success&&JE.alert(Ext.value(n.obj,"数据查询出错了，请联系管理员！"),"错误")}if(JE.defer(function(){if(t.masking){var e=t.gridObj.body;if(e)return e.unmask(),t.masking=!1}},10),d.hasListener("gridsummary")){var o=d.up("jemainview");o&&JE.refreshLocation(o,d.getAllSummary(),d)}var r=c.info.funcCode,l=c.info.idSuffix;JE.isEmpty(l)&&Ext.iterate(JE._BADGES,function(e,t){if(t.load&&t.funcCode==r)return JE.loadBadge(r),!1}),s.loadBadge()}})},loadBadge:function(){var s=this.gridObj,e=s.funcData,t=e.info.funcCode,i=e.info.idSuffix,d=e.badgeFields;if(JE.isNotEmpty(d)){var a=JE.getFuncView(t,"tree",i);if(a&&"tree"!=e.info.funcType){var n=e.info.tableName,o=this.proxy.extraParams.whereSql.replace(this.sqls.tree,""),r=a.getRootNode();strData=[],r.eachChild(function(e){var t=e.get("nodeInfo"),i=d[t],a=[];if(i){e.eachChild(function(e){a.push(e.get("code"))});var n=JE.split(i.badgeFields,","),o=[],r=s.treeSqls||{};Ext.each(n,function(e){var t=r[e];JE.isNotEmpty(t)?o.push(" AND "+r[e]):o.push(r[e])});var l=o.join(" ");strData.push({field:t,codes:a,sm:i.sm,sql:l})}}),JE.isNotEmpty(strData)&&JE.ajax({url:JE.getUrlMaps("je.core.loadBadge"),params:{tableCode:n,strData:JE.encode(strData),whereSql:o},async:!0,success:function(e){var i=Ext.decode(Ext.value(e.responseText,"{}"));r.eachChild(function(e){var t=e.get("nodeInfo"),a=i[t];a&&e.eachChild(function(e){var t=JE.toNum(a[e.get("code")]),i=e.raw.text+(0<t?'<div class="badge">'+t+"</div>":"");e.set("text",i),e.commit(!1,["text"])})})}})}}}}),Ext.define("JE.core.store.TreeStore",{extend:"Ext.data.TreeStore",constructor:function(e){this.model=JE.getTreeModel(),this.root={id:"ROOT",expanded:!0,children:[]},this.callParent(arguments)}}),Ext.define("JE.core.ux.calendar.Util",{buildDateSelection:function(){var i=this;return{currYear:-1,currMonth:-1,minYear:1901,maxYear:2100,beginYear:0,endYear:0,tmpYear:-1,tmpMonth:-1,init:function(e,t){void 0!==e&&void 0!==t||(e=this.currYear,t=this.currMonth),this.setYear(e),this.setMonth(t)},today:function(){var e=new Date,t=e.getFullYear(),i=e.getMonth();this.currYear==t&&this.currMonth==i||(this.tmpYear==t&&this.tmpMonth==i?this.rollback():(this.init(t,i),this.commit()))},go:function(){this.currYear==this.tmpYear&&this.currMonth==this.tmpMonth?this.rollback():this.commit()},goToday:function(){this.today()},goPrevMonth:function(){this.prevMonth(),this.commit()},goNextMonth:function(){this.nextMonth(),this.commit()},goPrevYear:function(){this.prevYear(),this.commit()},goNextYear:function(){this.nextYear(),this.commit()},changeView:function(){var e=this.currYear,t=this.currMonth;i.clear(),i.drawCld(e,t)},commit:function(){-1==this.tmpYear&&-1==this.tmpMonth||(this.currYear==this.tmpYear&&this.currMonth==this.tmpMonth||this.changeView(),this.tmpYear=-1,this.tmpMonth=-1)},rollback:function(){-1!=this.tmpYear&&this.setYear(this.tmpYear),-1!=this.tmpMonth&&this.setMonth(this.tmpMonth),this.tmpYear=-1,this.tmpMonth=-1},prevMonth:function(){var e=this.currMonth-1;if(-1==e){var t=this.currYear-1;t>=this.minYear?(e=11,this.setYear(t)):e=0}this.setMonth(e)},nextMonth:function(){var e=this.currMonth+1;if(12==e){var t=this.currYear+1;t<=this.maxYear?(e=0,this.setYear(t)):e=11}this.setMonth(e)},prevYear:function(){var e=this.currYear-1;e>=this.minYear&&this.setYear(e)},nextYear:function(){var e=this.currYear+1;e<=this.maxYear&&this.setYear(e)},setYear:function(e){-1==this.tmpYear&&-1!=this.currYear&&(this.tmpYear=this.currYear),this.currYear=e},setMonth:function(e){-1==this.tmpMonth&&-1!=this.currMonth&&(this.tmpMonth=this.currMonth),this.currMonth=e},prevYearPage:function(){this.endYear=this.beginYear-1,this.showYearContent(null,this.endYear)},nextYearPage:function(){this.beginYear=this.endYear+1,this.showYearContent(this.beginYear,null)},selectYear:function(){var e=$('select[@name="SY"] option[@selected]').text();this.setYear(e),this.commit()},selectMonth:function(){var e=$('select[@name="SM"] option[@selected]').text();this.setMonth(e-1),this.commit()}}},lYearDays:function(e){var t,i=348;for(t=32768;8<t;t>>=1)i+=CalendarDefaults.lunarInfo[e-1900]&t?1:0;return i+this.leapDays(e)},leapDays:function(e){return this.leapMonth(e)?15==(15&CalendarDefaults.lunarInfo[e-1899])?30:29:0},leapMonth:function(e){var t=15&CalendarDefaults.lunarInfo[e-1900];return 15==t?0:t},monthDays:function(e,t){return CalendarDefaults.lunarInfo[e-1900]&65536>>t?30:29},Lunar:function(e){var t,i,a={},n=0,o=(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate())-Date.UTC(1900,0,31))/864e5;for(t=1900;t<2100&&0<o;t++)o-=n=this.lYearDays(t);for(o<0&&(o+=n,t--),a.year=t,i=this.leapMonth(t),a.isLeap=!1,t=1;t<13&&0<o;t++)n=0<i&&t==i+1&&0==a.isLeap?(--t,a.isLeap=!0,this.leapDays(a.year)):this.monthDays(a.year,t),1==a.isLeap&&t==i+1&&(a.isLeap=!1),o-=n;return 0==o&&0<i&&t==i+1&&(a.isLeap?a.isLeap=!1:(a.isLeap=!0,--t)),o<0&&(o+=n,--t),a.month=t,a.day=o+1,a},solarDays:function(e,t){return 1==t?e%4==0&&e%100!=0||e%400==0?29:28:CalendarDefaults.solarMonth[t]},cyclical:function(e){return CalendarDefaults.Gan[e%10]+CalendarDefaults.Zhi[e%12]},calElement:function(e,t,i,a,n,o,r,l,s,d,c){var u={isToday:!1};return u.sYear=e,u.sMonth=t,u.sDay=i,u.week=CalendarDefaults.weakStr[a],u.weekNum=a,u.sDate=e+"-"+(9<t?t:"0"+t)+"-"+(9<i?i:"0"+i),u.lYear=n,u.lMonth=o,u.lDay=r,u.isLeap=l,u.lDate=n+"-"+(9<o?o:"0"+o)+"-"+(9<r?r:"0"+r),u.cYear=s,u.cMonth=d,u.cDay=c,u.color="",u.legalFestival="",u.lunarFestival="",u.solarFestival="",u.solarTerms="",u},sTerm:function(e,t){return new Date(31556925974.7*(e-1900)+6e4*CalendarDefaults.sTermInfo[t]+Date.UTC(1900,0,6,2,5)).getUTCDate()},cyclical6:function(e,t){return CalendarDefaults["jcName"+e][t]},CalConv2:function(e,t,i,a,n,o,r,l,s){var d=n+""+i;return 0==e&&6==i||6==e&&0==i||1==e&&7==i||7==e&&1==i||2==e&&8==i||8==e&&2==i||3==e&&9==i||9==e&&3==i||4==e&&10==i||10==e&&4==i||5==e&&11==i||11==e&&5==i?"<FONT color=#0000A0>日值岁破 大事不宜</font>":0==t&&6==i||6==t&&0==i||1==t&&7==i||7==t&&1==i||2==t&&8==i||8==t&&2==i||3==t&&9==i||9==t&&3==i||4==t&&10==i||10==t&&4==i||5==t&&11==i||11==t&&5==i?"<FONT color=#0000A0>日值月破 大事不宜</font>":0==a&&"911"==d||1==a&&"55"==d||2==a&&"111"==d||3==a&&"75"==d||4==a&&"311"==d||5==a&&"95"==d||6==a&&"511"==d||7==a&&"15"==d||8==a&&"711"==d||9==a&&"35"==d?"<FONT color=#0000A0>日值上朔 大事不宜</font>":1==o&&13==r||2==o&&11==r||3==o&&9==r||4==o&&7==r||5==o&&5==r||6==o&&3==r||7==o&&1==r||7==o&&29==r||8==o&&27==r||9==o&&25==r||10==o&&23==r||11==o&&21==r||12==o&&19==r?"<FONT color=#0000A0>日值杨公十三忌 大事不宜</font>":0},calendar:function(e,t){var i,a,n,o,r,l,s,d,c,u,p,f,E,m=this,g={},h=1,x=0,v=new Array(3),y=0,b=0;i=new Date(e,t,1,0,0,0,0),g.length=m.solarDays(e,t),g.firstWeek=i.getDay(),p=t<2?m.cyclical(e-1900+36-1):m.cyclical(e-1900+36);var C=m.sTerm(e,2),w=m.sTerm(e,2*t);f=m.cyclical(12*(e-1900)+t+12),d=12*(e-1900)+t+12;for(var S=Date.UTC(e,t,1,0,0,0,0)/864e5+25567+10,I=0;I<g.length;I++){x<h&&(i=new Date(e,t,I+1),n=(a=m.Lunar(i)).year,o=a.month,h=a.day,x=(r=a.isLeap)?m.leapDays(n):m.monthDays(n,o),0==y&&(b=o),v[y++]=I-h+1),1==t&&I+1==C&&(p=m.cyclical(e-1900+36),c=e-1900+36),I+1==w&&(f=m.cyclical(12*(e-1900)+t+13),d=12*(e-1900)+t+13),E=m.cyclical(S+I),u=S+I;var T=(I+g.firstWeek)%7;g[I]=m.calElement(e,t+1,I+1,T,n,o,h++,r,p,f,E),g[I].sgz5=m.CalConv2(c%12,d%12,u%12,c%10,u%10,o,h-1,t+1,void 0),g[I].sgz3=m.cyclical6(d%12,u%12)}l=m.sTerm(e,2*t)-1,s=m.sTerm(e,2*t+1)-1,g[l].solarTerms=CalendarDefaults.solarTerm[2*t],g[s].solarTerms=CalendarDefaults.solarTerm[2*t+1],3==t&&(g[l].color="red");for(I=0;I<CalendarDefaults.sFtv.length;I++)CalendarDefaults.sFtv[I].match(/^(\d{2})(\d{2})([\s\*])(.+)$/)&&Number(RegExp.$1)==t+1&&(g[Number(RegExp.$2)-1].solarFestival+=RegExp.$4+"  ","*"==RegExp.$3&&(g[Number(RegExp.$2)-1].color="red"));for(I=0;I<CalendarDefaults.lFtv.length;I++)CalendarDefaults.lFtv[I].match(/^(\d{2})(.{2})([\s\*])(.+)$/)&&(-11==(l=Number(RegExp.$1)-b)&&(l=1),0<=l&&l<y&&0<=(s=v[l]+Number(RegExp.$2)-1)&&s<g.length&&(g[s].lunarFestival+=RegExp.$4+"  ","*"==RegExp.$3&&(g[s].color="red")));if(CalendarDefaults.gFtv){var _=CalendarDefaults.gFtv[e];for(var J in _){var D=_[J];for(I=0;I<D.length;I++)D[I].match(/^(\d{2})(\d{2})([\s\*])(.+)$/)&&Number(RegExp.$1)==t+1&&(g[Number(RegExp.$2)-1].legalFestival=RegExp.$4)}}if(2==t||3==t){var A=m.easter(e);t==A.m&&(g[A.d-1].solarFestival=g[A.d-1].solarFestival+" 复活节(Easter Sunday)")}(g.firstWeek+12)%7==5&&(g[12].solarFestival+="黑色星期五");var N=new Date,O=N.getFullYear(),R=N.getMonth(),L=N.getDate();return e==O&&t==R&&(g[L-1].isToday=!0),g},easter:function(e){var t={},i=this.sTerm(e,5),a=new Date(Date.UTC(e,2,i,0,0,0,0)),n=this.Lunar(a);if(n.day<15)var o=15-n.day;else o=(n.isLeap?leapDays(e):this.monthDays(e,n.month))-n.day+15;var r=new Date(a.getTime()+864e5*o),l=new Date(r.getTime()+864e5*(7-r.getUTCDay()));return t.m=l.getUTCMonth(),t.d=l.getUTCDate(),t},cDay:function(e){var t;switch(e){case 10:t="初十";break;case 20:t="二十";break;case 30:t="三十";break;default:t=CalendarDefaults.nStr2[Math.floor(e/10)],t+=CalendarDefaults.nStr1[e%10]}return t},FormatLunarMonth:function(e){var t=new String("正二三四五六七八九十");return(e<=10?t.substr(e-1,1):11==e?"十一":"十二")+"月"},FormatLunarDay:function(e){var t=new String("初十廿三"),i=new String("一二三四五六七八九十");return 20!=e&&30!=e?t.substr((e-1)/10,1)+i.substr((e-1)%10,1):20!=e?t.substr(e/10,1)+"十":"二十"}});var CalendarDefaults={lunarInfo:new Array(19416,19168,42352,21717,53856,55632,21844,22191,39632,21970,19168,42422,42192,53840,53845,46415,54944,44450,38320,18807,18815,42160,46261,27216,27968,43860,11119,38256,21234,18800,25958,54432,59984,27285,23263,11104,34531,37615,51415,51551,54432,55462,46431,22176,42420,9695,37584,53938,43344,46423,27808,46416,21333,19887,42416,17779,21183,43432,59728,27296,44710,43856,19296,43748,42352,21088,62051,55632,23383,22176,38608,19925,19152,42192,54484,53840,54616,46400,46752,38310,38335,18864,43380,42160,45690,27216,27968,44870,43872,38256,19189,18800,25776,29859,59984,27480,23232,43872,38613,37600,51552,55636,54432,55888,30034,22176,43959,9680,37584,51893,43344,46240,47780,44368,21977,19360,42416,20854,21183,43312,31060,27296,44368,23378,19296,42726,42208,53856,60005,54576,23200,30371,38608,19195,19152,42192,53430,53855,54560,56645,46496,22224,21938,18864,42359,42160,43600,45653,27951,44448,19299,37759,18936,18800,25776,26790,59999,27424,42692,43759,37600,53987,51552,54615,54432,55888,23893,22176,42704,21972,21200,43448,43344,46240,46758,44368,21920,43940,42416,21168,45683,26928,29495,27296,44368,19285,19311,42352,21732,53856,59752,54560,55968,27302,22239,19168,43476,42192,53584,62034,54560),solarMonth:new Array(31,28,31,30,31,30,31,31,30,31,30,31),Gan:new Array("甲","乙","丙","丁","戊","己","庚","辛","壬","癸"),Zhi:new Array("子","丑","寅","卯","辰","巳","午","未","申","酉","戌","亥"),Animals:new Array("鼠","牛","虎","兔","龙","蛇","马","羊","猴","鸡","狗","猪"),solarTerm:new Array("小寒","大寒","立春","雨水","惊蛰","春分","清明","谷雨","立夏","小满","芒种","夏至","小暑","大暑","立秋","处暑","白露","秋分","寒露","霜降","立冬","小雪","大雪","冬至"),sTermInfo:new Array(0,21208,42467,63836,85337,107014,128867,150921,173149,195551,218072,240693,263343,285989,308563,331033,353350,375494,397447,419210,440795,462224,483532,504758),weakStr:new Array("日","一","二","三","四","五","六"),nStr1:new Array("日","一","二","三","四","五","六","七","八","九","十"),nStr2:new Array("初","十","廿","卅"," "),jcName0:new Array("建","除","满","平","定","执","破","危","成","收","开","闭"),jcName1:new Array("闭","建","除","满","平","定","执","破","危","成","收","开"),jcName2:new Array("开","闭","建","除","满","平","定","执","破","危","成","收"),jcName3:new Array("收","开","闭","建","除","满","平","定","执","破","危","成"),jcName4:new Array("成","收","开","闭","建","除","满","平","定","执","破","危"),jcName5:new Array("危","成","收","开","闭","建","除","满","平","定","执","破"),jcName6:new Array("破","危","成","收","开","闭","建","除","满","平","定","执"),jcName7:new Array("执","破","危","成","收","开","闭","建","除","满","平","定"),jcName8:new Array("定","执","破","危","成","收","开","闭","建","除","满","平"),jcName9:new Array("平","定","执","破","危","成","收","开","闭","建","除","满"),jcName10:new Array("满","平","定","执","破","危","成","收","开","闭","建","除"),jcName11:new Array("除","满","平","定","执","破","危","成","收","开","闭","建"),jcr:function(e){var t;return"建"==e&&(t="出行.上任.会友.上书.见工<br>动土.开仓.嫁娶.纳采"),"除"==e&&(t="除服.疗病.出行.拆卸.入宅<br>求官.上任.开张.搬家.探病"),"满"==e&&(t="祈福.祭祀.结亲.开市.交易<br>服药.求医.栽种.动土.迁移"),"平"==e&&(t="祭祀.修填.涂泥.余事勿取<br>移徙.入宅.嫁娶.开市.安葬"),"定"==e&&(t="易.立券.会友.签约.纳畜<br>种植.置业.卖田.掘井.造船"),"执"==e&&(t="祈福.祭祀.求子.结婚.立约<br>开市.交易.搬家.远行"),"破"==e&&(t="求医.赴考.祭祀.余事勿取<br>动土.出行.移徙.开市.修造"),"危"==e&&(t="经营.交易.求官.纳畜.动土<br>登高.行船.安床.入宅.博彩"),"成"==e&&(t="祈福.入学.开市.求医.成服<br>词讼.安门.移徙"),"收"==e&&(t="祭祀.求财.签约.嫁娶.订盟<br>开市.安床.安葬.入宅.破土"),"开"==e&&(t="疗病.结婚.交易.入仓.求职<br>安葬.动土.针灸"),"闭"==e&&(t="祭祀.交易.收财.安葬<br>宴会.安床.出行.嫁娶.移徙"),t&&(jcryxs=t.split("<br>"),t='<span style="color:#080">宜</span>'+jcryxs[0]+'<br><span style="color:#ff5040">忌</span>'+jcryxs[1]),t},sFtv:new Array("0101  元旦","0214  情人节","0308  妇女节","0401  愚人节","0501  劳动节","0504  青年节","0601  儿童节","0801  建军节","0910  教师节","1001  国庆节","1031  万圣节","1224  平安夜"),lFtv:new Array("0101  春节","0115  元宵","0202  龙抬头","0505  端午","0707  七夕","0815  中秋","0909  重阳","1208  腊八","1223  小年","0100  除夕"),wFtv:new Array("0520  母亲节","0630  父亲节","1144  感恩节")};Ext.define("JE.core.ux.column.Util",{enableUpdate:!1,readOnly:!1,setReadOnly:function(t){var i=this;i.readOnly=t,i.items.each(function(e){e.setReadOnly&&e.setReadOnly(t),e.setVisible(!t),i.titleEl&&(i.cls&&"x-column-header-checkbox"==i.cls.trim()?i.titleEl.setStyle("height",t?"100%":"50%"):i.titleEl.setStyle("height",t?"100%":""))})},afterRender:function(){this.callParent(arguments),this.readOnly&&this.setReadOnly(!0)},updateColumnData:function(){var l=this,t=[],e=Ext.value(l.tableName,""),s=Ext.value(l.pkName,""),d=l.getOwnerHeaderCt().grid,i=Ext.value(d.store.proxy.extraParams.whereSql,""),a={xtype:"textfield",name:l.dataIndex,columnWidth:1};if(l.basicField&&((a=Ext.clone(l.basicField)).columnWidth=1,a.columnField=!0,delete a.fieldLabel,delete a.width,delete a.readOnly,delete a.height,delete a.value,delete a.hidden,e=a.tableName,s=a.pkName),t.push({xtype:"checkbox",boxLabel:l.localLang.updateselsLabel,name:"updatesels",columnWidth:1,fieldTdAttr:"align=center",inputValue:"1",checked:!0}),t.push(a),t.push({xtype:"hidden",name:"tableCode",value:e}),t.push({xtype:"hidden",name:"whereSql",value:i}),-1!=["treessfield","treessareafield","gridssfield","gridssareafield","queryuserfield","queryuserareafield","cgroup","rgroup","cbbfield"].indexOf(a.xtype)){var n=Ext.value(a.configInfo,"").split(","),o=Ext.value(n[1],"").split("~");Ext.value(n[2],"").split("~");Ext.each(o,function(e){e!=a.name&&t.push({xtype:"hidden",name:e})})}JE.formWin({title:JE.format("【<font color=red>{0}</font>】{1}",l.text,l.localLang.batchUpdateTitle),width:300,height:150,items:t,fn:function(e){var t=e.updatesels;if(delete e.updatesels,"1"==t){var i=d.getSelectionModel().getSelection();if(Ext.isEmpty(i))return JE.alert(l.localLang.batchUpdateNoSelect),!1;var a=[];Ext.each(i,function(e){a.push(e.get(s))});var n=JE.DB.buildWhereSql({code:s,type:"in",value:a});e.whereSql=Ext.value(e.whereSql,"")+" and "+n}var o=JE.getUrlMaps("je.core");d.funcData&&(o=Ext.value(d.funcData.info.funcAction,o));var r=JE.ajax({url:o+"!listUpdate.action",params:e});r.success?(JE.msg(l.localLang.successMsg),d.getStore().load()):JE.error(r.obj,r)}})},buildEditer:function(){var e,a=this;if(a.items=a.items||[],1==a.enableEdit&&Ext.isEmpty(a.columns))return"uxcheckcolumn"==a.xtype||a.allowEdit&&a.editField?(e=JE.Action.buildColumnField(a.editField||{value:a.basicField.value},a),"uxcheckcolumn"==a.xtype&&(e.height=31)):((e=JE.Action.buildColumnField({xtype:"uxdisplayfield",fieldBodyCls:"displayfield-body"},a)).name=a.dataIndex,a.cls+=" je-grid-editcolumn-display"),e.enableKeyEvents=!0,e.listeners={keypress:function(e,t,i){13==t.getKey()&&a.doColumnInsert(e)},afterrender:function(e){e.getEl().on("click",function(){e.focus()})}},a.items.push(e),a.useField=!0,a.initialConfig.layout={type:"vbox",align:"left"},e;JE.isNotEmpty(a.helpTpl)&&(a.text='<i class="je-field-helptpl jeicon jeicon-question-circle"></i>'+a.text,a.on({click:{element:"titleEl",fn:function(e){e.getTarget(".je-field-helptpl",1)&&(a.hasListener("columnhelp")?a.fireEvent("columnhelp",a):JE.win({title:a.initialConfig.text,width:660,height:400,buttonAlign:"center",autoScroll:!0,bodyStyle:"line-height:1.5;",html:a.helpTpl.replaceAll("\n","<br/>"),bodyPadding:"10",buttons:[{text:"关闭",cls:"btn JEPLUS_B_L10",width:100,handler:function(e){e.up("window").close()}}],autoShow:!0}),a.sortable&&(a.sortable=!1,setTimeout(function(){a.sortable=!0},300)))}}}))},doColumnInsert:function(e){var t=e.up("jegridview");if(t){var i=t.getDockedComponent("buttonBar");if(i){var a=i.down("button[ref=gridInsertBtn]");a&&(a.fireHandler(),Ext.each(t.headerCt.columnManager.columns,function(e){if(e.editField)return e.items.get(0).focus(),!1}))}}}}),Ext.define("JE.core.ux.form.datetime.DatePicker",{extend:"Ext.picker.Date",alias:"widget.jedatepicker",multiSelect:!1,renderTpl:['<div id="{id}-innerEl">','<div role="presentation" class="{baseCls}-header">','<a id="{id}-prevEl" class="{baseCls}-prev {baseCls}-arrow" href="#" role="button" title="{prevText}" hidefocus="on" ></a>','<div class="{baseCls}-month" id="{id}-middleBtnEl">{%this.renderMonthBtn(values, out)%}</div>','<a id="{id}-nextEl" class="{baseCls}-next {baseCls}-arrow" href="#" role="button" title="{nextText}" hidefocus="on" ></a>',"</div>",'<table id="{id}-eventEl" class="{baseCls}-inner" cellspacing="0" role="presentation">','<thead role="presentation"><tr role="presentation">','<tpl for="dayNames">','<th role="columnheader" title="{.}"><span>{.:this.firstInitial}</span></th>',"</tpl>","</tr></thead>",'<tbody role="presentation"><tr role="presentation">','<tpl for="days">',"{#:this.isEndOfWeek}",'<td role="gridcell" id="{[Ext.id()]}">','<a role="presentation" href="#" hidefocus="on" class="{parent.baseCls}-date" tabIndex="1">','<em role="presentation"><span role="presentation"></span></em>',"</a>","</td>","</tpl>","</tr></tbody>","</table>",'<tpl if="showTimes">','<div id="{id}-timeEl" role="presentation" class="{baseCls}-timebar">{%this.renderHour(values, out)%}{%this.renderMinute(values, out)%}{%this.renderSecond(values, out)%}</div>',"</tpl>",'<tpl if="showToday">','<div id="{id}-footerEl" role="presentation"   class="{baseCls}-footer">',"{%this.renderOkBtn(values, out)%}{%this.renderTodayBtn(values, out)%}","</div>","</tpl>","</div>",{firstInitial:function(e){return e.substr(0,1)},isEndOfWeek:function(e){return--e%7==0&&0!==e?'</tr><tr role="row">':""},longDay:function(e){return Ext.Date.format(e,this.longDayFormat)},renderTodayBtn:function(e,t){Ext.DomHelper.generateMarkup(e.$comp.todayBtn.getRenderTree(),t)},renderOkBtn:function(e,t){Ext.DomHelper.generateMarkup(e.$comp.okBtn.getRenderTree(),t)},renderMonthBtn:function(e,t){Ext.DomHelper.generateMarkup(e.$comp.monthBtn.getRenderTree(),t)},renderHour:function(e,t){Ext.DomHelper.generateMarkup(e.$comp.hour.getRenderTree(),t)},renderMinute:function(e,t){t.push('<div class="time-split">:</div>'),Ext.DomHelper.generateMarkup(e.$comp.minute.getRenderTree(),t)},renderSecond:function(e,t){t.push('<div class="time-split">:</div>'),Ext.DomHelper.generateMarkup(e.$comp.second.getRenderTree(),t)}}],initComponent:function(){this.selectDates=new Ext.util.MixedCollection,this.callParent(arguments)},beforeRender:function(){var e=this;e.okBtn=new Ext.button.Button({ownerCt:e,ownerLayout:e.getComponentLayout(),text:Ext.Msg.buttonText.ok,handler:e.selectDay,cls:"btn btn-small JEPLUS_B_L10",scope:e}),e.showTimes&&(e.renderData.showTimes=!0,e.multiSelect=!1,e.hour=Ext.create("Ext.form.field.Number",{scope:e,ownerCt:e,editable:!0,ownerLayout:e.getComponentLayout(),minValue:0,maxValue:23,width:35,cls:"je-field-basiccls",enableKeyEvents:!0,listeners:{keyup:function(e,t){23<e.getValue()&&(t.stopEvent(),e.setValue(23))}}}),e.minute=Ext.create("Ext.form.field.Number",{scope:e,ownerCt:e,cls:"je-field-basiccls",ownerLayout:e.getComponentLayout(),minValue:0,maxValue:59,editable:!0,width:35,enableKeyEvents:!0,disabled:-1==e.format.indexOf("i"),listeners:{keyup:function(e,t){59<e.getValue()&&(t.stopEvent(),e.setValue(59))}}}),e.second=Ext.create("Ext.form.field.Number",{scope:e,ownerCt:e,editable:!0,cls:"je-field-basiccls",ownerLayout:e.getComponentLayout(),minValue:0,maxValue:59,width:35,disabled:-1==e.format.indexOf("s"),enableKeyEvents:!0,listeners:{keyup:function(e,t){59<e.getValue()&&(t.stopEvent(),e.setValue(59))}}})),e.callParent(),e.todayBtn&&(e.todayBtn.cls="btn btn-small JEPLUS_B_C01")},selectDay:function(){var e=this.okBtn;if(e&&!e.disabled){var t=this.multiSelect?this.selectDates.items:this.value;t=this.showTimes?this.getValue():t,this.pickerField.onSelect(this,t,!0)}},reset:function(){this.selectDates.removeAll(),this.cells.removeCls(this.selectedCls)},handleDateClick:function(e,t){var i=this,a=i.handler;e.stopEvent(),i.disabled||!t.dateValue||Ext.fly(t.parentNode).hasCls(i.disabledCellCls)||(i.doCancelFocus=!1===i.focusOnSelect,i.setValue(new Date(t.dateValue),!0),delete i.doCancelFocus,i.fireEvent("select",i,i.value),a&&a.call(i.scope||i,i,i.value),i.onSelect())},selectToday:function(){var e=this,t=e.todayBtn,i=e.handler;return t&&!t.disabled&&(e.cells.removeCls(e.selectedCls),e.reset(),e.setValue(Ext.Date.clearTime(new Date),!0),e.fireEvent("select",e,e.value),i&&i.call(e.scope||e,e,e.value),e.onSelect()),e},selectedUpdate:function(e){var t,i,a=e.getTime(),n=this.cells,o=this.selectedCls,r=n.elements,l=r.length;for(n.removeCls(o),t=0;t<l;t++)if(i=Ext.fly(r[t]),this.multiSelect)this.selectDates.get(i.dom.firstChild.dateValue)&&i.addCls(o);else if(i.dom.firstChild.dateValue==a){this.fireEvent("highlightitem",this,i),i.addCls(o),this.isVisible()&&!this.doCancelFocus&&Ext.fly(i.dom.firstChild).focus(50);break}},fullUpdate:function(e){var t,n,i,a,o,r,l,s,d,c=this,u=c.cells.elements,p=c.textNodes,f=c.disabledCellCls,E=Ext.Date,m=0,g=0,h=c.isVisible(),x=+E.clearTime(e,!0),v=+E.clearTime(new Date),y=c.minDate?E.clearTime(c.minDate,!0):Number.NEGATIVE_INFINITY,b=c.maxDate?E.clearTime(c.maxDate,!0):Number.POSITIVE_INFINITY,C=c.disabledDatesRE,w=c.disabledDatesText,S=!!c.disabledDays&&c.disabledDays.join(""),I=c.disabledDaysText,T=c.format,_=E.getDaysInMonth(e),J=E.getFirstDateOfMonth(e).getDay()-c.startDay,D=E.add(e,E.MONTH,-1),A=c.longDayFormat;for(J<0&&(J+=7),_+=J,t=E.getDaysInMonth(D)-J,n=new Date(D.getFullYear(),D.getMonth(),t,c.initHour),c.showToday&&(i=(a=E.clearTime(new Date))<y||b<a||C&&T&&C.test(E.dateFormat(a,T))||S&&-1!=S.indexOf(a.getDay()),c.disabled||(c.todayBtn.setDisabled(i),c.todayKeyListener.setDisabled(i))),o=function(i,a){d=+E.clearTime(n,!0),i.title=E.format(n,A),(i.firstChild.dateValue=d)==v&&(a+=" "+c.todayCls,i.title=c.todayText,c.todayElSpan=Ext.DomHelper.append(i.firstChild,{tag:"span",cls:Ext.baseCSSPrefix+"hide-clip",html:c.todayText},!0)),c.multiSelect?c.selectDates.eachKey(function(e,t){d==e&&(a+=" "+c.selectedCls,c.fireEvent("highlightitem",c,i),h&&c.floating&&Ext.fly(i.firstChild).focus(50))}):d==x&&(a+=" "+c.selectedCls,c.fireEvent("highlightitem",c,i),h&&c.floating&&Ext.fly(i.firstChild).focus(50)),d<y?(a+=" "+f,i.title=c.minText):b<d?(a+=" "+f,i.title=c.maxText):S&&-1!==S.indexOf(n.getDay())?(i.title=I,a+=" "+f):C&&T&&(s=E.dateFormat(n,T),C.test(s)&&(i.title=w.replace("%0",s),a+=" "+f)),i.className=a+" "+c.cellCls};m<c.numDays;++m)l=m<J?(r=++t,c.prevCls):_<=m?(r=++g,c.nextCls):(r=m-J+1,c.activeCls),p[m].innerHTML=r,n.setDate(n.getDate()+1),o(u[m],l);c.monthBtn.setText(Ext.Date.format(e,c.monthYearFormat))},finishRenderChildren:function(){this.callParent(),this.showTimes&&(this.hour.finishRender(),this.minute.finishRender(),this.second.finishRender()),this.showToday&&this.okBtn.finishRender()},createMonthPicker:function(){var e=this,t=e.monthPicker;return t||(e.monthPicker=t=Ext.create("JE.core.ux.form.datetime.MonthPicker",{renderTo:e.el,floating:!0,shadow:!1,small:!1===e.showToday,listeners:{scope:e,cancelclick:e.onCancelClick,okclick:e.onOkClick,yeardblclick:e.onOkClick,monthdblclick:e.onOkClick}}),e.disableAnim||t.el.setStyle("display","none"),e.on("beforehide",Ext.Function.bind(e.hideMonthPicker,e,[!1]))),t},getValue:function(){var e=this.value;return this.showTimes&&(e.setHours(this.hour.getValue()),e.setMinutes(this.minute.getValue()),e.setSeconds(this.second.getValue())),e},setValue:function(e,t){var i=this,a=Ext.isArray(e)?e:[e];return i.value=a[0]||new Date,i.multiSelect&&t?Ext.each(a,function(e){var t=e.getTime();i.selectDates.get(t)?i.selectDates.removeAtKey(t):i.selectDates.add(t,e)}):i.showTimes&&!t&&(i.hour.setValue(i.value.getHours()),i.minute.setValue(i.minute.disabled?0:i.value.getMinutes()),i.second.setValue(i.second.disabled?0:i.value.getSeconds())),i.value=Ext.Date.clearTime(i.value,!0),i.update(i.value)}}),Ext.define("JE.core.ux.form.datetime.DateTimePicker",{extend:"JE.core.ux.form.datetime.DatePicker",alias:"widget.datetimepicker",alternateClassName:"Ext.DateTimePicker",showTimes:!0}),Ext.define("JE.core.ux.form.datetime.MonthPicker",{extend:"Ext.picker.Month",alias:"widget.jemonthpicker",renderTpl:['<div id="{id}-bodyEl" class="{baseCls}-body">','<div id="{id}-yearEl" class="{baseCls}-years">','<div class="{baseCls}-yearnav">','<div class="{baseCls}-yearnav-button-ct">','<a id="{id}-prevEl" class="{baseCls}-yearnav-button {baseCls}-yearnav-prev" href="#" hidefocus="on" ></a>',"</div>",'<div class="{baseCls}-yearnav-button-ct">','<a id="{id}-nextEl" class="{baseCls}-yearnav-button {baseCls}-yearnav-next" href="#" hidefocus="on" ></a>',"</div>","</div>",'<tpl for="years">','<div class="{parent.baseCls}-item {parent.baseCls}-year">','<a hidefocus="on" class="{parent.baseCls}-item-inner" href="#">{.}</a>',"</div>","</tpl>","</div>",'<div id="{id}-monthEl" class="{baseCls}-months">','<tpl for="months">','<div class="{parent.baseCls}-item {parent.baseCls}-month">','<a style="{parent.monthStyle}" hidefocus="on" class="{parent.baseCls}-item-inner" href="#">{.}</a>',"</div>","</tpl>","</div>",'<div class="'+Ext.baseCSSPrefix+'clear"></div>',"</div>",'<tpl if="showButtons">','<div id="{id}-buttonsEl" class="{baseCls}-buttons">{%',"var me=values.$comp, okBtn=me.okBtn, cancelBtn=me.cancelBtn;","okBtn.ownerLayout = cancelBtn.ownerLayout = me.componentLayout;","okBtn.ownerCt = cancelBtn.ownerCt = me;","Ext.DomHelper.generateMarkup(okBtn.getRenderTree(), out);","Ext.DomHelper.generateMarkup(cancelBtn.getRenderTree(), out);","%}</div>","</tpl>"],initComponent:function(){this.callParent(arguments),this.showButtons&&(this.okBtn.cls="btn btn-small JEPLUS_B_L10",this.cancelBtn.cls="btn btn-small")}}),Ext.define("JE.core.ux.form.UXTrigger",{extend:"Ext.form.field.Trigger",editable:!0,alias:["widget.uxtrigger"],trigger1Cls:Ext.baseCSSPrefix+"form-clear-trigger",trigger2Cls:Ext.baseCSSPrefix+"form-search-trigger",handler:Ext.emptyFn,textarea:!1,initComponent:function(){var i=this;i.addEvents("click","reset"),i.trigger2Cls=Ext.value(i.iconCls,i.trigger2Cls),i.textarea&&(i.fieldSubTpl=['<textarea id="{id}" {inputAttrTpl}','<tpl if="name"> name="{name}"</tpl>','<tpl if="rows"> rows="{rows}" </tpl>','<tpl if="cols"> cols="{cols}" </tpl>','<tpl if="placeholder"> placeholder="{placeholder}"</tpl>','<tpl if="size"> size="{size}"</tpl>','<tpl if="maxLength !== undefined"> maxlength="{maxLength}"</tpl>','<tpl if="readOnly"> readonly="readonly"</tpl>','<tpl if="disabled"> disabled="disabled"</tpl>','<tpl if="tabIdx"> tabIndex="{tabIdx}"</tpl>',' class="{fieldCls} {typeCls} {textCls}" ','<tpl if="fieldStyle"> style="{fieldStyle}"</tpl>',' autocomplete="off">\n','<tpl if="value">{[Ext.util.Format.htmlEncode(values.value)]}</tpl>',"</textarea>",{disableFormats:!0}]),i.callParent(arguments),i.on("specialkey",function(e,t){t.getKey()==t.ENTER&&i.onTrigger2Click()},i)},afterRender:function(){this.callParent()},onTrigger1Click:function(){this.reset(),this.fireEvent("reset",this)},onTrigger2Click:function(){this.fireEvent("click",this),this.handler(this)}}),Ext.define("JE.core.ux.form.SearchSelectField",{extend:"Ext.form.field.Trigger",editable:!1,enableClick:!0,mixins:["JE.core.util.FieldUtil"],alias:["widget.ssfield","widget.gridssfield","widget.treessfield","widget.gridssareafield","widget.treessareafield"],trigger1Cls:Ext.baseCSSPrefix+"form-clear-trigger",trigger2Cls:"x-form-list-trigger",initComponent:function(){var a=this;a.localLang=JE.getLocalLang("core.ux.ssfield"),a.baseWhereSql=a.whereSql=Ext.value(a.whereSql,""),a.addEvents("beforequery","query","reset","okbuttonclick","sswinrender","formatconfig"),"treessfield"!=a.xtype&&"treessareafield"!=a.xtype||(a.trigger2Cls="x-form-tree-trigger"),!a.useArea&&-1==a.xtype.indexOf("areafield")||(a.fieldSubTpl=['<textarea id="{id}" {inputAttrTpl}','<tpl if="name"> name="{name}"</tpl>','<tpl if="rows"> rows="{rows}" </tpl>','<tpl if="cols"> cols="{cols}" </tpl>','<tpl if="placeholder"> placeholder="{placeholder}"</tpl>','<tpl if="size"> size="{size}"</tpl>','<tpl if="maxLength !== undefined"> maxlength="{maxLength}"</tpl>','<tpl if="readOnly"> readonly="readonly"</tpl>','<tpl if="disabled"> disabled="disabled"</tpl>','<tpl if="tabIdx"> tabIndex="{tabIdx}"</tpl>',' class="{fieldCls} {typeCls} {textCls}" ','<tpl if="fieldStyle"> style="{fieldStyle}"</tpl>',' autocomplete="off">\n','<tpl if="value">{[Ext.util.Format.htmlEncode(values.value)]}</tpl>',"</textarea>",{disableFormats:!0}]);var e=Ext.value(a.configInfo,"").split(",");a.configData={code:e[0],fieldNames:Ext.value(e[1],"").split("~"),valueNames:Ext.value(e[2],"").split("~")},a.valueTypes={},Ext.each(a.configData.fieldNames,function(e,t){var i=a.configData.valueNames[t];e==a.name&&(a.valueType=i),-1!=["id","code"].indexOf(i)&&(a.valueTypes[i]=e)}),a.otherConfig=Ext.value(a.otherConfig,{}),Ext.isString(a.otherConfig)&&(a.otherConfig=JE.decode(a.otherConfig)),1==a.xtype.indexOf("gridss")&&1==a.otherConfig.showForm&&(a.enableClick=!1);var t=a.otherConfig.width,i=a.otherConfig.height;JE.isNotEmpty(t)&&(t.includes("%")?a.winWidth=t:a.winWidth=JE.toNum(t)),JE.isNotEmpty(i)&&(i.includes("%")?a.winHeight=i:a.winHeight=JE.toNum(i));var n=[];if(a.addUnitTplIds=[],0!=a.xtype.indexOf("gridss")||"1"!=a.otherConfig.enableAdd||a.columnField){if(0==a.xtype.indexOf("treess")&&"1"==a.otherConfig.editDic&&!a.columnField){if(a.hasRole(a.otherConfig.editDicPerm,JE.toBool(a.otherConfig.editDicCommon),e[0])){s="function(field){JE.showDicFunc(field.configData.code,{field:field});}",t=0;var o=a.otherConfig.editDicText||"编辑选项",r="blue";if(JE.isNotEmpty(a.otherConfig.editDicIcon)){o='<i class="'+a.otherConfig.editDicIcon+' unittpl-icon" title="'+o+'"></i>',t=20,r=JE.isNotEmpty(a.otherConfig.editDicIconColor)?a.otherConfig.editDicIconColor:"#1e89da";d=JE.uuid();var l="#"+(a.id+"_"+d)+":hover{color:"+(JE.isNotEmpty(a.otherConfig.editDicIconHoverColor)?a.otherConfig.editDicIconHoverColor:"#1e89da")+" !important}";Ext.util.CSS.createStyleSheet(l)}n.push({id:d,text:o,width:t,handler:s,color:r,bold:"1"})}}}else if(a.hasRole(a.otherConfig.addPerm,JE.toBool(a.otherConfig.addCommon),e[0])){var s='function(field){JE.showFunc(field.configData.code,{type:"form",field:field});}',d=JE.uuid();n.push({id:d,text:a.otherConfig.addText,handler:s,color:"blue",bold:"1",readOnly:!0}),a.addUnitTplIds.push(a.id+"_"+d)}a.unitListTpl=JE.decode(Ext.value(a.unitListTpl,"[]")),JE.isNotEmpty(a.unitListTpl)?a.unitListTpl=a.unitListTpl.concat(n):JE.isNotEmpty(a.unitTpl)?a.unitListTpl=[{id:JE.uuid(),text:a.unitTpl}].concat(n):a.unitListTpl=n,a.callParent(arguments),a.on("specialkey",function(e,t){t.getKey()!=t.ENTER||a.editable||a.onTrigger2Click()},a)},afterRender:function(){var o=this;o.callParent(),"gridssareafield"!=o.xtype&&"treessareafield"!=o.xtype&&"queryuserareafield"!=o.xtype||(o.inputEl.dom.style.height=Ext.value(o.height,120)+"px"),"x-form-tree-trigger"!=o.trigger2Cls&&o.otherConfig.showForm&&o.inputEl&&(o.inputEl.setStyle({textDecoration:"underline",color:"blue",cursor:"pointer"}),o.inputEl.dom.title="双击进入",o.inputEl.on("dblclick",function(e){var i,a=JE.getFuncData(o.configData.code);if(Ext.each(o.configData.valueNames,function(e,t){if(e==a.info.pkName)return i=o.configData.fieldNames[t],!1}),i){var t=o.getParentInfo(!0),n=o.getFieldValues({parent:t.parent,parentType:t.parentType,fieldName:i});JE.isNotEmpty(n)&&JE.showFunc(a.info.funcCode,{readOnly:!0,type:"form",id:n,useChild:!0})}}))},onTrigger1Click:function(){this.reset(),this.setConfigInfo(),this.fireEvent("reset",this)},onTrigger2Click:function(){var i=this,a=i.getValue();if(0!=i.fireEvent("beforequery",i)){var e=Ext.isEmpty(i.dicItemIds)?" and 1=1 ":" and itemId in ('"+i.dicItemIds.replaceAll(",","','")+"') ";e+=Ext.value(i.whereSql,"");var t=i.getParentInfo(!0),n=t.parent,o=t.data,r=t.parentType;e=JE.DB.formatSql(e,o,i.funcCode);var l,s=Ext.clone(i.otherConfig);if(s.parentFuncSql&&(s.parentFuncSql=JE.DB.formatSql(s.parentFuncSql,o,i.funcCode)),-1!=["queryuserfield","queryuserareafield"].indexOf(i.xtype)){var d=s.QUERYPERM,c="";if(!JE.isEmpty(d)){var u=d.split(",");-1!=u.indexOf("COMPANY")&&(c=" AND JTGSID='"+JE.currentUser.dept.jtgsId+"'"),-1!=u.indexOf("COMPANYJG")&&(c=" AND JTGSID IN (SELECT JE_CORE_JDGSINFO_ID FROM JE_CORE_JDGSINFO WHERE JDGSINFO_JGGS_ID LIKE '%"+JE.currentUser.dept.jtgsId+"%')"),-1!=u.indexOf("COMPANY")&&-1!=u.indexOf("COMPANYJG")&&(c=" AND (JTGSID='"+JE.currentUser.dept.jtgsId+"' OR JTGSID IN (SELECT JE_CORE_JDGSINFO_ID FROM JE_CORE_JDGSINFO WHERE JDGSINFO_JGGS_ID LIKE '%"+JE.currentUser.dept.jtgsId+"%'))")}JE.isNotEmpty(c)&&(e+=c)}JE.isNotEmpty(i.enableExpFn)&&(l=JE.eval(i.enableExpFn,JE.format(i.localLang.enableExpFnError,i.name)));var p="x-form-tree-trigger"==i.trigger2Cls?"tree":"grid",f=i.valueType;"tree"==p&&Ext.each(["id","code"],function(e){var t=i.valueTypes[e];if(t)return f=e,a=i.getFieldValues({parent:n,parentType:r,fieldName:t}),!1});var E={width:i.winWidth,height:i.winHeight,resultColumn:Ext.value(i.resultColumn,i.valueType),value:a,valueType:f,parent:n,parentType:r,title:i.fieldLabel,configInfo:i.configInfo,otherConfig:s,expandRootChild:i.expandRootChild,whereSql:e,formatData:o,parentData:t.parentMainData,type:p,rootData:i.rootData,treeUrl:i.treeUrl,codeSearch:Ext.value(i.codeSearch,!0),enableExp:i.enableExp,enableExpFn:l,enableTip:i.enableTip,okButtonClick:function(e,t){return i.fireEvent("okbuttonclick",i,e,t)},callback:function(e,t){return i.fireEvent("query",i,e,t)},sswinRender:function(e){i.fireEvent("sswinrender",i,e)}};i.fireEvent("formatconfig",i,E),i.showWin(E)}},showWin:function(e){JE.selectWin(e)},setReadOnly:function(){var t=this;t.callParent(arguments),JE.isNotEmpty(t.addUnitTplIds)&&t.addUnitTplIds.forEach(function(e){Ext.get(e).parent().parent().el.dom.hidden=t.readOnly})}}),Ext.define("JE.core.ux.mxgraph.util.KeyHandler",{initExtKey:function(){var i=this,e=[{key:Ext.EventObject.DELETE,fn:function(){i.editor.doAction("delete")}},{key:Ext.EventObject.LEFT,fn:function(){i.editor.doAction("left")}},{key:Ext.EventObject.RIGHT,fn:function(){i.editor.doAction("right")}},{key:Ext.EventObject.UP,fn:function(){i.editor.doAction("up")}},{key:Ext.EventObject.DOWN,fn:function(){i.editor.doAction("down")}},{key:Ext.EventObject.A,fn:function(e,t){t.stopEvent(),i.editor.doAction("selectAll")},ctrl:!0},{key:Ext.EventObject.Z,fn:function(){i.editor.doAction("undo")},ctrl:!0},{key:Ext.EventObject.Y,fn:function(){i.editor.doAction("redo")},ctrl:!0},{key:Ext.EventObject.X,fn:function(){i.editor.doAction("cut")},ctrl:!0},{key:Ext.EventObject.C,fn:function(){i.editor.doAction("copy")},ctrl:!0},{key:Ext.EventObject.V,fn:function(){i.editor.doAction("paste")},ctrl:!0}];new Ext.util.KeyMap({target:i.ownerCt.getCmp("graphBox").getEl(),binding:e})}}),Ext.define("JE.core.ux.mxgraph.util.Style",{initStyle:function(){mxConstants.SHADOWCOLOR="#d0d0d0",mxConstants.HANDLE_FILLCOLOR="#99ccff",mxConstants.HANDLE_STROKECOLOR="#0088cf",mxConstants.VERTEX_SELECTION_COLOR="#00a8ff",mxConstants.OUTLINE_COLOR="#00a8ff",mxConstants.OUTLINE_HANDLE_FILLCOLOR="#99ccff",mxConstants.OUTLINE_HANDLE_STROKECOLOR="#00a8ff",mxConstants.CONNECT_HANDLE_FILLCOLOR="#cee7ff",mxConstants.EDGE_SELECTION_COLOR="#00a8ff",mxConstants.LABEL_HANDLE_FILLCOLOR="#cee7ff",mxConstants.GUIDE_COLOR="#0088cf";this.loadStylesheet()},loadStylesheet:function(){var e=mxUtils.load(this.getMXGraphPath()+"/css/default.xml").getDocumentElement();new mxCodec(e.ownerDocument).decode(e,this.editor.graph.getStylesheet())},initStencilRegistry:function(){mxStencilRegistry.loadStencilSet(this.getStencilPath()+"/general.xml")}}),Ext.define("JE.core.ux.mxgraph.util.Util",{getMXGraphPath:function(){return window.mxBasePath},getStencilPath:function(){return window.STENCIL_PATH},findNode:function(e,t,i){var a,n=(i=Ext.value(i,this.editor)).graph.getModel(),o=new mxCodec(mxUtils.createXmlDocument()).encode(n),r=mxUtils.findNode(o,e,t);return r&&(a=n.getCell(r.getAttribute("id"))),a},formatValue:function(e,t){if(!mxUtils.isNode(e)){e=Ext.value(e,"");var i=mxUtils.createXmlDocument().createElement(t);i.setAttribute("label",e),e=i}return e},buildImageInfo:function(){var r=this.editor.graph,e=mxUtils.createXmlDocument(),t=e.createElement("output");e.appendChild(t);var i=new mxXmlCanvas2D(t);(new mxImageExport).drawState(r.getView().getState(r.model.root),i);var a=r.getGraphBounds(),n=Math.round(a.x+a.width+4),o=Math.round(a.y+a.height+4);n=800<=n?n:800,o=500<=o?o:500,t.setAttribute("width",n),t.setAttribute("height",o);var l=t.querySelectorAll("text");Ext.each(l,function(e){var t=JE.toNum(e.getAttribute("x")),i=JE.toNum(e.getAttribute("y")),a=JE.toNum(e.getAttribute("w")),n=JE.toNum(e.getAttribute("h")),o=e.getAttribute("valign"),r=e.getAttribute("rotation");t-=a/2,i-=n/2,0!=r&&e.insertAdjacentHTML("beforeBegin",'<rotate theta="'+r+'" flipH="0" flipV="0" cx="'+(t+a/2)+'" cy="'+(i+n/2)+'"/>');"top"==o?i+=5:"bottom"==o&&(i-=5),e.setAttribute("x",t),e.setAttribute("y",i)});var s={},d=this.getAllCells(!0,!1);return Ext.each(d,function(n){var e=n.getAttribute("name"),t={x:n.geometry.x-2,y:n.geometry.y-2,w:n.geometry.width+4,h:n.geometry.height+4};n.edges;"1"!=n.parent.id&&(t.x+=n.parent.geometry.x,t.y+=n.parent.geometry.y);var o={name:e,box:t,type:n.getAttribute("type"),source:{},target:{}};"start"==o.type&&(e=o.name=o.type),Ext.each(n.edges,function(e){var t="";if(e.source==n&&e.target?t="target":e.target==n&&e.source&&(t="source"),JE.isNotEmpty(t)){var i=r.view.getState(e),a=[];Ext.each(i.absolutePoints,function(e){var t={x:e.x,y:e.y};a.push(t)}),o[t][e[t].getAttribute("name")]=a}}),s[e]=o}),{xml:mxUtils.getXml(t),nodeInfos:s,width:n,height:o}},doImageExport:function(){var e=this.buildImageInfo(),t=encodeURIComponent(e.xml);return JE.ajax({url:JE.getUrlMaps("je.core.mxGraph","expImg"),params:{xml:t,type:"base64"},text:!0})},preview:function(e){var t=this.editor.graph,i=1;var a=t.pageFormat||mxConstants.PAGE_FORMAT_A4_PORTRAIT,n=1/t.pageScale;if(i){isNaN(1)||(n=mxUtils.getScaleForPageCount(1,t,a))}t.getGraphBounds();var o=0,r=0;if((a=mxRectangle.fromRectangle(a)).width=Math.ceil(.75*a.width),a.height=Math.ceil(.75*a.height),n*=.75,n=.75,!i&&t.pageVisible){var l=t.getPageLayout();o-=l.x*a.width,r-=l.y*a.height}else i=!0;var s=PrintDialog.createPrintPreview(t,n,a,0,o,r,i);s.open(),e&&PrintDialog.printPreview(s)},createNodeCell:function(e){var t=mxUtils.createXmlDocument().createElement(e.node);t.setAttribute("label",e.label||""),t.setAttribute("name",e.name||""),t.setAttribute("type",e.node||"");var i=new mxCell(t);return e.edge&&i.setEdge(!0),i.setStyle(e.style||""),i}}),Ext.define("JE.core.ux.calendar.Calendar",{extend:"Ext.panel.Panel",alias:"widget.uxcalendar",mixins:["JE.core.ux.calendar.Util"],bodyStyle:"border:0px;",minCalendar:!1,useDayinfo:!1,gFtv:{2014:{"元旦":["0101  休"],"春节":["0126  班","0131  休","0201  休","0202  休","0203  休","0204  休","0205  休","0206  休","0208  班"],"清明节":["0405  休","0406  休","0407  休"],"劳动节":["0501  休","0502  休","0503  休","0504  班"],"端午节":["0531  休","0601  休","0602  休"],"中秋节":["0906  休","0907  休","0908  休"],"国庆节":["0928  班","1001  休","1002  休","1003  休","1004  休","1005  休","1006  休","1007  休","1011  班"]},2015:{"元旦":["0101  休","0102  休","0103  休","0104  班"],"春节":["0215  班","0218  休","0219  休","0220  休","0221  休","0222  休","0223  休","0224  休","0228  班"],"清明节":["0405  休","0406  休"],"劳动节":["0501  休","0502  休","0503  休"],"端午节":["0620  休","0621  休","0622  休"],"中秋节":["0927  休"],"国庆节":["1001  休","1002  休","1003  休","1004  休","1005  休","1006  休","1007  休","1010  班"]}},local_lang:{en:{prevYear:"Previous Year",nextYear:"Next Year",prevMonth:"Previous Month",nextMonth:"Next Month",today:"Today",more:"More",year:"Year",month:"Month"},zh_CN:{prevYear:"上一年",nextYear:"下一年",prevMonth:"上一月",nextMonth:"下一月",today:"今天",more:"更多",year:"年",month:"月"}},initComponent:function(){var e=this;JE.isNotEmpty(JE.CALENDAR_HOLIDAYS)&&(e.gFtv=Ext.apply(e.gFtv,JE.CALENDAR_HOLIDAYS)),e.addEvents("itemclick"),e.tpl=e.getDataTpl();var t="en"==Ext.util.Cookies.get("je-local-lang")?e.local_lang.en:e.local_lang.zh_CN;e.dockedItems={xtype:"toolbar",border:0,layout:{type:"hbox",align:"stretch"},items:[{xtype:"button",tooltip:t.prevYear,width:16,text:'<span style="color:blue;font-weight:bold;margin:0 0 0 -5px;">《</span>',handler:function(){e.dateSelection.goPrevYear()}},{xtype:"button",tooltip:t.prevMonth,width:16,text:'<span style="color:blue;font-weight:bold;margin:0 0 0 -5px;">〈</span>',handler:function(){e.dateSelection.goPrevMonth()}},{xtype:"button",text:'<span style="color:blue;text-decoration:underline;">'+t.today+"</span>",handler:function(){e.dateSelection.goToday()}},{xtype:"box",style:"text-align:center;vertical-align:middle;",name:"dateInfoLabel",data:[],tpl:['<select name="selectYear">',"{%for(var i=1900;i<=2100;i++){%}",'<option value="{[i]}">{[i]}</option>',"{%}%}","</select>",t.year,'<select name="selectMonth">',"{%for(var i=1;i<=12;i++){%}",'<option value="{[i]}">{[i]}</option>',"{%}%}","</select>",t.month],flex:1},{xtype:"button",text:'<span style="color:blue;text-decoration:underline;">'+t.more+"</span>",handler:function(){JE.openFuncById("949bae1c-bbdc-4782-928f-52a8a5763cb6","5a675576-c061-4282-91d7-6b5c1158f238")}},{xtype:"button",tooltip:t.nextMonth,width:16,text:'<span style="color:blue;font-weight:bold;margin:0 0 0 -5px;">〉</span>',handler:function(){e.dateSelection.goNextMonth()}},{xtype:"button",tooltip:t.nextYear,width:16,text:'<span style="color:blue;font-weight:bold;margin:0 0 0 -5px;">》</span>',handler:function(){e.dateSelection.goNextYear()}}]},CalendarDefaults.gFtv=e.gFtv,e.dateSelection=e.buildDateSelection(),e.callParent(arguments)},afterRender:function(){var o=this;o.callParent(arguments),o.allDaysTD=o.body.select("td[type=GD]"),o.allDaysTD.on("mouseenter",function(e,t){"op-calendar-noday"!=e.getTarget("td[type=GD]",3,!0).getAttribute("class")&&o.mOvr(t)}),o.allDaysTD.on("mouseleave",function(e,t){"op-calendar-noday"!=e.getTarget("td[type=GD]",3,!0).getAttribute("class")&&o.mOut(t)}),o.allDaysTD.on("click",function(e,t){var i=e.getTarget("td[type=GD]",3,!0);if("op-calendar-noday"!=i.getAttribute("class")){var a=i.child("[type=SD]",!0),n=Number(a.innerHTML)-1;o.fireEvent("itemclick",o,cld[n],cld)}});var e=o.down("box[name=dateInfoLabel]");o.selectYear=e.el.child("select[name=selectYear]"),o.selectMonth=e.el.child("select[name=selectMonth]"),o.selectYear.dom.onchange=function(e,t){o.dateSelection.setYear(Number(this.value)),o.dateSelection.commit()},o.selectMonth.dom.onchange=function(e,t){o.dateSelection.setMonth(Number(this.value)-1),o.dateSelection.commit()};var t=new Date;o.dateSelection.init(t.getFullYear(),t.getMonth()),o.drawCld(t.getFullYear(),t.getMonth()),o.useDayinfo&&(Ext.get("details")||Ext.getBody().insertHtml("beforeEnd",'<div id="details" class="op-calendar-new"></div>'))},getDataTpl:function(){this.data={weakStrs:["一","二","三","四","五","六","日"],minCalendar:this.minCalendar,tdWidth:80,tdHeight:44};return['<TABLE class="op-calendar-table" width="100%" height="100%">','<TR style="height:30px;font-size:16px;font-family:黑体;text-align:center">','<tpl for="weakStrs">','<TD width="{[parent.tdWidth]}">{[values.fontcolor((xindex==6 || xindex==7)?"red":"")]}</TD>',"</tpl>","</TR>","{% for(var i=0; i<6; i++){ %}","<tr align=center >","{% for(var j=0; j<7; j++){%}",'<td  name="{[i*7+j]}" type="GD" style="cursor:default;position:relative;" >','<div type="HD" class="op-calendar-td-HD" style="display:none;"></div>','<div type="SD" class="op-calendar-td-SD" style="{[(j==5 || j==6)?"color:red;":""]}"></div>','<div type="LD" class="op-calendar-td-LD" style="display:{[values.minCalendar?"none":""]};" ></div>',"</td>","{%}%}","{%}%}","</TABLE>"]},drawCld:function(e,t){var n,o,r=this;cld=r.calendar(e,t),r.selectYear.dom.value=e,r.selectMonth.dom.value=parseInt(t)+1,Ext.each(r.allDaysTD.elements,function(e,t){var i=Ext.get(e);sObj=i.child("[type=SD]",!0),lObj=i.child("[type=LD]",!0),hObj=i.child("[type=HD]",!0);var a=0==cld.firstWeek?7:cld.firstWeek;-1<(n=t-a+1)&&n<cld.length?(sObj.innerHTML=1+n,i.setStyle("cursor","pointer"),cld[n].isToday&&i.addCls("op-calendar-jinri"),cld[n].color&&""!=cld[n].color&&(sObj.style.color=cld[n].color),1==cld[n].lDay?lObj.innerHTML="<b>"+(cld[n].isLeap?"闰":"")+cld[n].lMonth+"月"+(29==r.monthDays(cld[n].lYear,cld[n].lMonth)?"小":"大")+"</b>":lObj.innerHTML=r.cDay(cld[n].lDay),0<(o=cld[n].lunarFestival).length?(8<o.length&&(o=o.substr(0,5)+"..."),o=o.fontcolor("red")):0<(o=cld[n].solarFestival).length?(8<o.length&&(o=o.substr(0,5)+"..."),o="黑色星期五"==o?o.fontcolor("black"):o.fontcolor("#0066FF")):0<(o=cld[n].solarTerms).length&&(o=o.fontcolor("limegreen")),"清明"==cld[n].solarTerms&&(o="清明节".fontcolor("red")),"芒种"==cld[n].solarTerms&&(o="芒种".fontcolor("red")),"夏至"==cld[n].solarTerms&&(o="夏至".fontcolor("red")),"冬至"==cld[n].solarTerms&&(o="冬至".fontcolor("red")),0<o.length&&(lObj.innerHTML=o),cld[n].legalFestival&&(hObj.innerHTML=cld[n].legalFestival,hObj.style.backgroundColor="休"==cld[n].legalFestival.trim()?"green":"red",hObj.style.display="")):(i.setStyle("cursor","default"),i.addCls("op-calendar-noday"))})},clear:function(){Ext.each(this.allDaysTD.elements,function(e,t){var i=Ext.get(e);sObj=i.child("[type=SD]",!0),lObj=i.child("[type=LD]",!0),hObj=i.child("[type=HD]",!0),hObj.style.display="none",sObj.innerHTML="",lObj.innerHTML="",i.removeCls("op-calendar-noday"),i.removeCls("op-calendar-jinri")})},mOvr:function(e){var t,i=Ext.get(e);if(Ext.isEmpty(i.getAttribute("class"))&&(e.style.backgroundColor="#fbfbad"),this.useDayinfo){var a=i.child("[type=SD]"),n=(i.child("[type=HD]",!0),a.getHTML()-1);if(""!=a.getHTML()){t=0!=cld[n].sgz5?cld[n].sgz5:CalendarDefaults.jcr(cld[n].sgz3);var o=['<div class="op-calendar-new-title">{info}</div>','<div class="op-calendar-new-info">','<div class = "op-calendar-new-left-day">'+cld[n].sDay+"</div>",'<div style="float:left;font-size:12px;margin:5px 0 0 0;">','<div style="font-weight:bold;height:28px;font-size:14px">'+cld[n].sYear+"年"+cld[n].sMonth+"月"+cld[n].sDay+"日&nbsp星期"+cld[n].week+"</div>","<div>","【"+CalendarDefaults.Animals[(cld[n].sYear-4)%12]+"年】&nbsp"+(cld[n].isLeap?"闰":" ")+this.FormatLunarMonth(cld[n].lMonth)+this.FormatLunarDay(cld[n].lDay),"</div>","</div>","</div>",'<div class="op-calendar-new-bottom">'+t+"</div>"],r="";""==cld[n].solarTerms&&""==cld[n].solarFestival&&""==cld[n].lunarFestival||(r=cld[n].solarTerms+" "+cld[n].solarFestival+" "+cld[n].lunarFestival),o[0]=o[0].replace("{info}",r);var l=i.getX(),s=i.getY()+i.getHeight()+5,d=l+i.getWidth()-150,c=Ext.get("details");c.setStyle({top:s+"px",left:d+"px",display:""}),c.update(o.join(""))}}},mOut:function(e){e.style.backgroundColor="",this.useDayinfo&&Ext.get("details").setStyle({display:"none"})}}),Ext.define("JE.core.ux.calendar.CalendarMini",{extend:"Ext.panel.Panel",alias:"widget.uxcalendarmini",mixins:["JE.core.ux.calendar.Util"],cls:"je-calendar-mini",border:0,minCalendar:!1,useDayinfo:!1,initComponent:function(){this.addEvents("itemclick"),this.tpl=this.getDataTpl(),this.dateSelection=this.buildDateSelection(),this.callParent(arguments)},afterRender:function(){var a=this;a.callParent(arguments),a.body.on("click",function(e){if(e.getTarget(".month",1))a.createMonthPicker().showBy(e.getTarget(".month",1,!0),"tc-bc");else if(a.monthPicker&&a.monthPicker.hide(),e.getTarget(".prev-month",1))a.dateSelection.goPrevMonth();else if(e.getTarget(".next-month",1))a.dateSelection.goNextMonth();else if(e.getTarget(".month",1))a.createMonthPicker().showBy(e.getTarget(".month",1,!0),"tc-bc");else if(e.getTarget(".calendar",2))JE.openFuncByCode("JE_OA_CALENDAR");else if(e.getTarget(".today",1))a.activeDay=(new Date).getDate(),a.dateSelection.goToday();else if(e.getTarget(".day",1)){var t=e.getTarget(".day",1,!0).parent(),i=a.body.down("li.active");i&&i.removeCls("active"),t.addCls("active"),a.activeDay=t.getAttribute("data-day"),t.hasCls("next-month-day")?a.dateSelection.goNextMonth():t.hasCls("prev-month-day")&&a.dateSelection.goPrevMonth(),t.hasCls("task")&&a.showTaskMenu(t.getAttribute("data-date"))}});var e=new Date;a.dateSelection.init(e.getFullYear(),e.getMonth()),a.dateSelection.changeView()},showTaskMenu:function(e){var t=this.tasks[e];this.taskMenu||(this.taskMenu=Ext.create("Ext.menu.Menu",{shadow:!1,plain:!0,margin:0,padding:0,cls:"je-menu-item34h",items:{xtype:"boundlist",border:0,itemId:"view",store:Ext.create("Ext.data.Store",{fields:["id","time","title","type"]}),tpl:['<ul class="'+Ext.plainListCls+'"><tpl for=".">','<li role="option" unselectable="on" class="x-boundlist-item" style="padding:0px 10px;"><span style="color:#3487e2;margin-right:10px;">{time}</span>{title}</li>',"</tpl></ul>"],maxHeight:200,autoScroll:!0,listeners:{render:function(e){e.selectedItemCls=" "},itemclick:function(e,t){}}}}));var i=[];if(Ext.each(t,function(e){var t={id:e.JE_SYS_CALENDAR_ID,title:e.CALENDAR_TITLE};"1"==e.CALENDAR_YESORNO_CODE?t.time="全天":t.time=e.CALENDAR_STARTTIME.substring(11,16)+"~"+e.CALENDAR_ENDTIME.substring(11,16),i.push(t)}),this.taskMenu.isHidden()){var a=this.body.down(".je-calendar-mini-body");this.taskMenu.setWidth(a.getWidth()+2),this.taskMenu.showBy(a,"tc-bc",[0,10])}this.taskMenu.getCmp(0).store.loadData(i)},createMonthPicker:function(){var e=this;e.monthPicker||(e.monthPicker=Ext.create("JE.core.ux.form.datetime.MonthPicker",{renderTo:document.body,floating:!0,shadow:!0,height:"plus"==JE.getTheme()?220:200,listeners:{scope:e,cancelclick:e.onCancelClick,okclick:e.onOkClick,yeardblclick:e.onOkClick,monthdblclick:e.onOkClick}}));var t=new Date(e.dateSelection.currYear,e.dateSelection.currMonth,1);return e.monthPicker.setValue(t),e.monthPicker},onOkClick:function(e,t){var i=t[0],a=t[1];this.dateSelection.init(a,i),this.dateSelection.commit(),this.onCancelClick()},onCancelClick:function(){this.monthPicker.hide()},getDataTpl:function(){var i=this;return['<div class="je-calendar-min-title">','<div class="calendar">日程 <i class="fa fa-window-restore" style="font-size:12px;"></i></div>','<div class="prev-month fa fa-chevron-left"></div>','<div class="month">{month}</div>','<div class="next-month fa fa-chevron-right"></div>','<div class="today" title="跳转到今天">今</div>','<div class="task-create" title="创建"><i class=" fa fa-plus"></i></div>',"</div>",'<div class="je-calendar-mini-header">',"<ul>","{%for(var i=0;i<7;i++){%}","<li>{[CalendarDefaults.weakStr[i]]}</li>","{%}%}","</ul>","</div>",'<div class="je-calendar-mini-body">','<tpl for="weeks">','<ul><tpl for="."><li class="{[this.getCls(values)]}"  data-date="{sDate}" data-day="{sDay}"><span class="day">{sDay}</span></li></tpl></ul>',"</tpl>","</div>",{getCls:function(e){var t=[];return e.isToday&&t.push("today"),e.prevMonth?t.push("prev-month-day"):e.nextMonth&&t.push("next-month-day"),JE.isNotEmpty(i.tasks[e.sDate])&&t.push("task"),e.sDay!=i.activeDay||e.prevMonth||e.nextMonth||t.push("active"),t.join(" ")}}]},titleFormat:"Y月m月",getCalendarData:function(e,t){var i=this.calendar(e,t),a=i.length,n=new Date(e,t,1,0,0,0,0),o=0,r=a-1;if(0<i[0].weekNum)for(var l=0==t?e-1:e,s=0==t?11:t-1,d=this.calendar(l,s),c=0;c<i[0].weekNum;c++)i[o=-c-1]=d[d.length+o],i[o].prevMonth=!0;if(i[a-1].weekNum<6)for(l=11==t?e+1:e,s=11==t?0:t+1,d=this.calendar(l,s),c=0;c<6-i[a-1].weekNum;c++)i[r=a+c]=d[c],i[r].nextMonth=!0;var u=(r+1)/7,p=[];for(c=0;c<u;c++){for(var f=[],E=0;E<7;E++){var m=i[7*c+E+o];m.isToday&&JE.isEmpty(this.activeDay)&&(this.activeDay=m.sDay),f.push(m)}p.push(f)}o=i[o].sDate+" 00:00:00",r=i[r].sDate+" 59:59:59";var g=JE.ajax({url:JE.getUrlMaps("je.core.calendar","load"),params:{limit:-1,tableCode:"JE_SYS_CALENDAR",permSql:" AND (SY_CREATEUSER='"+JE.currentUser.userCode+"' OR CALENDAR_GROUPID IN (SELECT GROUPUSER_GROUP_ID FROM JE_SYS_GROUPUSER WHERE GROUPUSER_USERID='"+JE.currentUser.userId+"') OR CALENDAR_GROUPID IN (SELECT JE_SYS_CALENDARGROUP_ID FROM JE_SYS_CALENDARGROUP WHERE SY_CREATEUSER='"+JE.currentUser.userCode+"'))",whereSql:" AND CALENDAR_STARTTIME>='"+o+"' AND CALENDAR_ENDTIME<='"+r+"'"}}).rows,h={};return Ext.each(g,function(e){var t=Ext.Date.clearTime(Ext.Date.parse(e.CALENDAR_STARTTIME,"Y-m-d H:i:s")),i=Ext.Date.clearTime(Ext.Date.parse(e.CALENDAR_ENDTIME,"Y-m-d H:i:s")),a=Ext.Date.format(t,"Y-m-d");for(h[a]=h[a]||[],h[a].push(e);t.getTime()!=i.getTime();){t.setDate(t.getDate()+1);a=Ext.Date.format(t,"Y-m-d");h[a]=h[a]||[],h[a].push(e)}}),this.tasks=h,{month:Ext.Date.format(n,this.titleFormat),weeks:p}},clear:function(){},drawCld:function(e,t){var i=this,a=i.getCalendarData(e,t);i.update(a)},mOvr:function(e){var t,i=Ext.get(e);if(Ext.isEmpty(i.getAttribute("class"))&&(e.style.backgroundColor="#fbfbad"),this.useDayinfo){var a=i.child("[type=SD]"),n=(i.child("[type=HD]",!0),a.getHTML()-1);if(""!=a.getHTML()){t=0!=cld[n].sgz5?cld[n].sgz5:CalendarDefaults.jcr(cld[n].sgz3);var o=['<div class="op-calendar-new-title">{info}</div>','<div class="op-calendar-new-info">','<div class = "op-calendar-new-left-day">'+cld[n].sDay+"</div>",'<div style="float:left;font-size:12px;margin:5px 0 0 0;">','<div style="font-weight:bold;height:28px;font-size:14px">'+cld[n].sYear+"年"+cld[n].sMonth+"月"+cld[n].sDay+"日&nbsp星期"+cld[n].week+"</div>","<div>","【"+CalendarDefaults.Animals[(cld[n].sYear-4)%12]+"年】&nbsp"+(cld[n].isLeap?"闰":" ")+this.FormatLunarMonth(cld[n].lMonth)+this.FormatLunarDay(cld[n].lDay),"</div>","</div>","</div>",'<div class="op-calendar-new-bottom">'+t+"</div>"],r="";""==cld[n].solarTerms&&""==cld[n].solarFestival&&""==cld[n].lunarFestival||(r=cld[n].solarTerms+" "+cld[n].solarFestival+" "+cld[n].lunarFestival),o[0]=o[0].replace("{info}",r);var l=i.getX(),s=i.getY()+i.getHeight()+5,d=l+i.getWidth()-150,c=Ext.get("details");c.setStyle({top:s+"px",left:d+"px",display:""}),c.update(o.join(""))}}},mOut:function(e){e.style.backgroundColor="",this.useDayinfo&&Ext.get("details").setStyle({display:"none"})}}),Ext.define("JE.core.ux.column.CheckColumn",{extend:"Ext.grid.column.CheckColumn",alias:"widget.uxcheckcolumn",mixins:["JE.core.ux.column.Util"],lockable:!1,allowEdit:!0,initComponent:function(){var e=this;e.localLang=JE.getLocalLang("core.ux.uxcolumn"),e.buildEditer(),Ext.isEmpty(e.checkedCls)&&Ext.isEmpty(e.uncheckedCls)&&(e.checkedCls=Ext.baseCSSPrefix+"grid-checkcolumn-checked",e.uncheckedCls=Ext.baseCSSPrefix+"grid-checkcolumn",e.useDefCls=!0,"plus"==JE.getTheme()&&(e.checkedCls="fa fa-check-square-o",e.uncheckedCls="fa fa-square-o",e.useDefCls=!1)),e.dicData||(e.dicData=JE.getDicItems(Ext.value(e.ddCode,"YESORNO"),!0)),e.callParent()},onTitleElClick:function(e,t){e.getTarget("."+Ext.baseCSSPrefix+"column-header-inner",3,!0)&&this.callParent(arguments)},processEvent:function(e,t,i,a,n,o,r,l){var s=this,d="keydown"===e&&o.getKey(),c="mousedown"==e;if(t.panel.readOnly||!s.allowEdit)return!1;if(s.disabled||!c&&d!=o.ENTER&&d!=o.SPACE)return s.callParent(arguments);var u=s.dataIndex,p="1"==r.get(u)?"0":"1";return!1!==s.fireEvent("beforecheckchange",s,a,p)?(r.set(u,p),s.fireEvent("checkchange",s,a,p),c&&o.stopEvent(),s.stopSelection||t.selModel.selectByPosition({row:a,column:n}),!1):!s.stopSelection},renderer:function(e,t,i,a,n,o,r){Ext.baseCSSPrefix;var l=this.uncheckedCls;if(this.selfReaderer&&this.selfReaderer(e,t,i,a,n,o,r),this.disabled&&(t.tdCls+=" "+this.disabledCls),"1"==e&&(this.useDefCls?l+=" "+this.checkedCls:l=this.checkedCls,l+=" je-checkcolumn-checkbox-checked"),Ext.isEmpty(this.enableBGColor))return'<div class="je-checkcolumn-checkbox '+l+'"></div>';e=Ext.value(e,"0");var s=this.dicData[e];return t.tdAttr+=' style="background-color:'+(s.backgroundColor||"")+';" ','<div class="je-checkcolumn-checkbox '+l+'" style =" color:'+(s.textColor||"")+' "></div>'},afterRender:function(){this.callParent(arguments),this.keyNav&&this.keyNav.disable()}}),Ext.define("JE.core.ux.column.ColumnEditor",{extend:"Ext.form.Panel",alias:"widget.uxcolumneditor",requires:["Ext.tip.ToolTip","Ext.util.HashMap","Ext.util.KeyNav"],errorsText:"Errors",dirtyText:"You need to commit or cancel your changes",lastScrollLeft:0,lastScrollTop:0,border:!1,border:0,type:"search",initComponent:function(){var e=this,t=e.grid,i=Ext.container.Container;e.cls="je-grid-columneditor",e.layout={type:"hbox",align:"middle"},e.lockable=t.lockable,e.lockable?e.items=[e.lockedColumnContainer=new i({id:t.id+"-locked-editor-cells",layout:{type:"hbox",align:"middle"}}),e.normalColumnContainer=new i({flex:1,id:t.id+"-normal-editor-cells",layout:{type:"hbox",align:"middle"}})]:e.lockedColumnContainer=e.normalColumnContainer=e,e.callParent(arguments),e.mon(e.hierarchyEventSource,{scope:e,show:e.repositionIfVisible}),e.getForm().trackResetOnLoad=!0},afterRender:function(){var n=this,e=n.grid,t=e.lockable?e.normalGrid.view:e.view;n.callParent(arguments),n.fields=n.buildColumnFields(),n.fields&&(n.insertColumnEditor(n.fields),n.addFieldsForColumn(n.fields,!0),delete n.fields),n.scrollingView=t,n.mon(n.el,{click:Ext.emptyFn,stopPropagation:!0}),n.mon(e,{resize:n.onGridResize,scope:n}),n.mon(t,{afterrender:function(){n.scrollingViewEl=t.el,t.mon(n.scrollingViewEl,"scroll",n.onViewScroll,n)},refresh:function(e){n.scrollingViewEl||(n.scrollingViewEl=e.el,e.mon(n.scrollingViewEl,"scroll",n.onViewScroll,n));var t=n.scrollingViewEl.dom.offsetWidth-n.scrollingViewEl.dom.clientWidth;n.normalColumnContainer.getEl().setStyle("paddingRight",t+"px")}}),t.el&&(n.scrollingViewEl=t.el,t.mon(n.scrollingViewEl,"scroll",n.onViewScroll,n)),n.fieldScroller=n.normalColumnContainer.layout.innerCt,n.fieldScroller.dom.style.overflow="hidden",n.fieldScroller.on({scroll:n.onFieldContainerScroll,scope:n}),n.mon(e,{scope:n,columnresize:function(e,t,i){n.onColumnResize(t,i)},columnhide:function(e,t){n.onColumnHide(t)},columnshow:function(e,t){n.onColumnShow(t)},columnmove:function(e,t,i,a){n.onColumnMove(t,i,a)}}),n.preventReposition=!0,Ext.Array.each(n.query("[isFormField]"),function(e){e.column.isVisible()&&n.onColumnShow(e.column)},n),delete n.preventReposition},buildColumnFields:function(){var t=[],e=[];return e=this.grid.lockable?[this.grid.lockedGrid,this.grid.normalGrid]:[this.grid],Ext.each(e,function(e){e.headerCt.items.each(function(e){e.isGroupHeader?t=t.concat(e.getGridColumns()):e.hiddenColumn||t.push(e)})}),t},onGridResize:function(){var e=this.getClientWidth(),t=this.grid,i=t.body;this.setLocalX(i.getOffsetsTo(t)[0]+i.getBorderWidth("l")-t.el.getBorderWidth("l")),this.setWidth(e)},onFieldRender:function(e){var t=e.column;if(t.isVisible())this.syncFieldWidth(t);else if(!t.rendered){var i=this.grid.view;this.lockable&&(i=t.locked?this.grid.lockedGrid.view:this.grid.normalGrid.view),i.headerCt.on({afterlayout:Ext.Function.bind(this.syncFieldWidth,this,[t]),single:!0})}},syncFieldWidth:function(e){var t,i=this.getColumnField(e);t=e.getWidth(),i.setWidth(t),"uxdisplayfield"===i.xtype&&(i.inputWidth=t)},onFieldChange:function(){var e=this.getForm().isValid();this.errorSummary&&this.isVisible()&&this[e?"hideToolTip":"showToolTip"](),this.isValid=e},onViewScroll:function(){this.grid.view.el;var e=this.scrollingViewEl,t=e.dom.scrollTop,i=e.getScrollLeft(),a=i!==this.lastScrollLeft;this.lastScrollTop;this.lastScrollTop=t,this.lastScrollLeft=i,this.rendered&&a&&this.syncFieldsHorizontalScroll()},syncFieldsHorizontalScroll:function(){this.fieldScroller.setScrollLeft(this.lastScrollLeft)},onFieldContainerScroll:function(){this.scrollingViewEl.setScrollLeft(this.fieldScroller.getScrollLeft())},onColumnResize:function(e,t){var i=this.getColumnField(e);this.rendered&&i&&(this.onGridResize(),this.onViewScroll(),e.isGroupHeader||(this.syncFieldWidth(e),this.repositionIfVisible()))},onColumnHide:function(e){var t=this.getColumnField(e);!e.isGroupHeader&&t&&(t.hide(),this.repositionIfVisible())},onColumnShow:function(e){var t=this.getColumnField(e);this.rendered&&!e.isGroupHeader&&t&&(this.getColumnField(e).show(),this.syncFieldWidth(e),this.preventReposition||this.repositionIfVisible())},onColumnMove:function(e,t,i){var a,n,o,r,l=1,s=e.isLocked()?this.lockedColumnContainer:this.normalColumnContainer;if(e.isGroupHeader){for(Ext.suspendLayouts(),e=e.getGridColumns(),t<i&&(i--,l=0),this.addFieldsForColumn(e),a=0,n=e.length;a<n;a++,t+=l,i+=l)o=this.getColumnField(e[a]),-1===(r=s.items.indexOf(o))?s.insert(i,o):r!=i&&s.move(t,i);Ext.resumeLayouts(!0)}else t<i&&i--,this.addFieldsForColumn(e),o=this.getColumnField(e),-1===(r=s.items.indexOf(o))?s.insert(i,o):r!=i&&s.move(t,i)},onColumnAdd:function(e){e.isGroupHeader&&(e=e.getGridColumns()),this.addFieldsForColumn(e),this.insertColumnEditor(e),this.preventReposition=!1},columnFields:{},getColumnField:function(e){var t=e.dataIndex,i=this.down("container [name="+t+"]");return i=i?i.ownerCt:this.buildFieldBox(e)},buildFieldBox:function(e){var a=this;e.dataIndex=e.dataIndex||JE.uuid();var t={xtype:"container",layout:{type:"hbox",align:"middel"},name:"fieldBox",cls:"je-grid-column-searchbox x-grid-editor",height:38,padding:"4 2",column:e,listeners:{afterrender:function(e){a.onFieldRender(e)}},items:[]};if((s=e[a.type+"Field"])&&-1==["uxfilefield","uxfilesfield","cbblistfield"].indexOf(s.xtype)&&"SY_ORDERINDEX"!=s.name){s.emptyField=!0,(s=JE.Action.buildColumnField(s,e)).itemId="field",s.margin="0 0 1 0",s.value="",s.flex=1,"uxcheckcolumn"==a.xtype&&(s.margin="0"),-1!=["datetimefield","datefield","datemonthfield","gridssfield","treessfield","queryuserfield","cbbfield"].indexOf(s.xtype)?(s.hideTrigger=!0,s.emptyText="请选择",s.fieldStyle="cursor: pointer;",s.editable=!1,s.enableClick=!0):"numberfield"==s.xtype&&(s.hideTrigger=!0);var i=JE.CoreUtil.getSearchType(s.xtype),n={xtype:"box",itemId:"searchType",value:i.value,dicItemCodes:i.types,cls:"search-type",html:JE.toDicText("JE_CORE_COLUMNQUERYTYPE",i.value),style:"color:#c3c3c3;cursor: pointer;height:30px;padding:0 6px;border:1px solid #ddd;border-left:0px;line-height:30px;",hidden:i.hidden,doSearch:function(e){this.update(e.text),this.value=e.code;var t=this.ownerCt.getCmp("field"),i=this.ownerCt.getCmp("field_between");"numberfield"==t.xtype?i&&i.setVisible("between"==e.code):(i&&i.setVisible("between"==e.code),t.setVisible("between"!=e.code)),a.doColumnSearch()}},o=Ext.decode(Ext.value(e.otherConfig,"{}"));JE.isNotEmpty(o.queryType)&&(n.value=o.queryType),JE.isNotEmpty(o.queryTypes)&&(n.dicItemCodes=Ext.isString(o.queryTypes)?JE.split(o.queryTypes,","):o.queryTypes);var r=o.queryTypeHidden||JE.systemConfig.JE_SYS_QUERYTYPEHIDDEN;if("1"==r&&(n.hidden=JE.toBool(r)),JE.isNotEmpty(o.queryXtype)&&(s.xtype=o.queryXtype),t.items=[s,n],-1!=n.dicItemCodes.indexOf("between")&&-1!=["datetimefield","datefield","datemonthfield","numberfield"].indexOf(s.xtype)){var l=Ext.clone(s);l.name+="__hidden",l.itemId="field_between","numberfield"==s.xtype?(l.hidden="between"!=n.value,l.fieldStyle="border-left-width:0px;"):(l.xtype="rangedatefield",l.hidden="between"!=n.value,s.hidden="between"==n.value),t.items.splice(1,0,l)}Ext.each(t.items,function(e){e.listeners={},"searchType"==e.itemId?e.listeners={afterrender:function(e){e.getEl().on("click",function(){a.showSearchMenu(e)})}}:e.editable||"textfield"==e.xtype?(e.enableKeyEvents=!0,e.listeners={keypress:function(e,t,i){13==t.getKey()&&a.doColumnSearch(e)},afterrender:function(e){e.getEl().on("click",function(){e.focus()})}}):e.listeners.change=function(e,t,i){a.doColumnSearch(e)}}),(n.hidden||JE.toNum(e.width)<80)&&(t.searchValue=n.value,t.items.splice(t.items.length-1,1))}else{var s={xtype:"box",cls:"empty-box",name:e.dataIndex,itemId:"field",height:34,style:"background-color: #f9f9f9;border:1px solid #ddd;"};!e.isCheckerHd&&"rownumberer"!=e.xtype||delete s.style,t.items=[s],t.noSearch=!0,t.layout="fit"}return t},showSearchMenu:function(e){var t=this;if(!t.menu){var i=JE.getDicItems("JE_CORE_COLUMNQUERYTYPE"),a=[];Ext.each(i,function(e){a.push({text:e.text,code:e.code})}),t.menu=Ext.create("Ext.menu.Menu",{cls:"je-menu-item34h",plain:!0,items:a,listeners:{beforeshow:function(i){i.items.each(function(e){var t=Ext.getCmp(i.searchCmpId);e.setChecked(e.code==t.value),e.setVisible(-1!=t.dicItemCodes.indexOf(e.code))})}},defaults:{group:"searchitem",xtype:"menucheckitem",listeners:{click:function(e){Ext.getCmp(t.menu.searchCmpId).doSearch(e)}}}})}t.menu.searchCmpId=e.id,t.menu.showBy(e,"tr-br")},doColumnSearch:function(){var e=this.up("jegridview");e&&JE.Action.doGroupQuery(e,this,"column")},resetSearch:function(e){e=Ext.value(e,!0);var t=this.query("container[name=fieldBox]"),i=!1;Ext.each(t,function(e){!e.noSearch&&0<e.items.getCount()&&e.items.each(function(e){"searchType"==e.itemId?(e.value!=e.initialConfig.value&&(i=!0),e.value=e.initialConfig.value,e.update(e.initialConfig.html)):(Ext.value(e.getValue(),"")!=e.initialConfig.value&&(i=!0),e.lastValue=e.initialConfig.value,e.reset())})}),e&&i&&this.doColumnSearch()},insertColumnEditor:function(e){var t,i;if(Ext.isArray(e))for(i=0,t=e.length;i<t;i++)this.insertColumnEditor(e[i]);else{var a=this.getColumnField(e);a&&(e.isLocked()?this.lockedColumnContainer:this.normalColumnContainer).insert(e.getVisibleIndex(),a)}},onColumnRemove:function(e,t){t=t.isGroupHeader?t.getGridColumns():t,this.removeColumnEditor(t)},removeColumnEditor:function(e){var t,i,a;if(Ext.isArray(e))for(a=0,i=e.length;a<i;a++)this.removeColumnEditor(e[a]);else(t=this.getColumnField(e))&&t.ownerCt&&t.ownerCt.remove(t,!1)},onColumnReplace:function(e,t,i,a){this.onColumnRemove(a.ownerCt,a)},repositionIfVisible:function(e){var t=this.grid.view;(!e||e!=this&&e.el.isAncestor(t.el))&&this.isVisible()&&t.isVisible(!0)&&this.reposition()},getRefOwner:function(){return this.grid},getRefItems:function(){var e;return this.lockable?(e=this.lockedColumnContainer.getRefItems()).push.apply(e,this.normalColumnContainer.getRefItems()):e=this.callParent(),e},reposition:function(e,t){var i,a,n,o,r=this,l=r.context,s=l&&Ext.get(l.row),d=0;s&&Ext.isElement(s.dom)&&(n=r.syncButtonPosition(r.getScrollDelta()),r.grid.rowLines||(d=-parseInt(s.first().getStyle("border-bottom-width"))),i=r.calculateLocalRowTop(s),a=r.calculateEditorTop(i)+d,t||(o=function(){n&&r.scrollingViewEl.scrollBy(0,n,!0),r.focusContextCell()}),r.syncEditorClip(),e?r.animate(Ext.applyIf({to:{top:a},duration:e.duration||125,callback:o},e)):(r.setLocalY(a),o&&o()))},getScrollDelta:function(){var e=this.scrollingViewEl.dom,t=this.context,i=this.body,a=0;return t&&0<(a=Ext.fly(t.row).getOffsetsTo(e)[1]-i.getBorderPadding().beforeY)&&(a=Math.max(a+this.getHeight()+this.floatingButtons.getHeight()-e.clientHeight-i.getBorderWidth("b"),0)),a},calculateLocalRowTop:function(e){var t=this.grid;return Ext.fly(e).getOffsetsTo(t)[1]-t.el.getBorderWidth("t")+this.lastScrollTop},calculateEditorTop:function(e){return e-this.body.getBorderPadding().beforeY-this.lastScrollTop},getClientWidth:function(){var e=this.grid;return this.lockable?e.lockedGrid.getWidth()+e.normalGrid.view.el.dom.clientWidth-1:e.view.el.dom.clientWidth},getEditor:function(e){return Ext.isNumber(e)?this.query("[isFormField]")[e]:e.isHeader&&!e.isGroupHeader?e.getEditor():void 0},addFieldsForColumn:function(e,t){var i,a;if(Ext.isArray(e))for(i=0,a=e.length;i<a;i++)this.addFieldsForColumn(e[i],t);else e.hidden?this.onColumnHide(e):e.rendered&&!t&&this.onColumnShow(e)},onShow:function(){this.callParent(arguments),this.reposition(),this.syncFieldsHorizontalScroll()},onHide:function(){this.callParent(arguments),this.tooltip&&this.hideToolTip()},isDirty:function(){return this.getForm().isDirty()},getToolTip:function(){return this.tooltip||(this.tooltip=new Ext.tip.ToolTip({cls:Ext.baseCSSPrefix+"grid-row-editor-errors",title:this.errorsText,autoHide:!1,closable:!0,closeAction:"disable",anchor:"left",anchorToTarget:!1}))},hideToolTip:function(){var e=this.getToolTip();e.rendered&&e.disable(),this.hiddenTip=!1},showToolTip:function(){var e=this.getToolTip();e.showAt([0,0]),e.update(this.getErrors()),this.repositionTip(),e.enable()},repositionTip:function(){var e=this.getToolTip(),t=this.context,i=Ext.get(t.row),a=this.scrollingViewEl,n=a.dom.clientHeight,o=this.lastScrollTop,r=o+n,l=i.getHeight(),s=i.getOffsetsTo(this.context.view.body)[1];o<s+l&&s<r?(e.showAt(e.getAlignToXY(a,"tl-tr",[15,i.getOffsetsTo(a)[1]])),this.hiddenTip=!1):(e.hide(),this.hiddenTip=!0)},getErrors:function(){var e,t=[],i=this.query(">[isFormField]"),a=i.length;for(e=0;e<a;e++)t=t.concat(Ext.Array.map(i[e].getErrors(),this.createErrorListItem));return t.length||this.autoCancel||!this.isDirty()||(t[0]=this.createErrorListItem(this.dirtyText)),'<ul class="'+Ext.plainListCls+'">'+t.join("")+"</ul>"},createErrorListItem:function(e){return'<li class="'+Ext.baseCSSPrefix+'grid-row-editor-errors-item">'+e+"</li>"},beforeDestroy:function(){Ext.destroy(this.floatingButtons,this.tooltip),this.menu&&this.menu.destroy(),this.callParent()},clipBottom:function(e){this.el.setStyle("clip","rect(-1000px auto "+e+"px auto)")},clipTop:function(e){this.el.setStyle("clip","rect("+e+"px auto 1000px auto)")},clearClip:function(e){this.el.setStyle("clip",Ext.isIE8m||Ext.isIEQuirks?"rect(-1000px auto 1000px auto)":"auto")}}),Ext.define("JE.core.ux.column.UXColumn",{extend:"Ext.grid.column.Column",alias:"widget.uxcolumn",mixins:["JE.core.ux.column.Util"],lockable:!1,initComponent:function(){var r=this;if(r.localLang=JE.getLocalLang("core.ux.uxcolumn"),r.queryConfig&&Ext.isString(r.queryConfig.fn)&&(r.queryConfig.fn=JE.eval(r.queryConfig.fn)),r.useMark&&(r.text+='<div class="fa fa-circle-thin markheader" data-qtip="批量标记"></div>'),r.buildEditer(),r.queryConfig&&(r.sortable=!1,r.cls+=" je-grid-querycolumn"),r.callParent(),r.useMark)r.on("headerclick",function(e,t,i){var a=i.getTarget(".markheader");if(a){var n=r.getOwnerHeaderCt().grid,o=n.getSelectionModel().getSelection();JE.isEmpty(o)?JE.alert("请选择要标记的数据！"):JEMarkField.showMark(o,a,n)}});else if(r.queryConfig){var e=r.queryConfig.configInfo.split(",")[0];if("LIST"==JE.dicInfoData[e].DICTIONARY_DDTYPE){var t=[{text:"全部",itemId:"checkAll",checked:!0}];Ext.each(JE.getDicItems(e),function(e){t.push({text:e.text,data:e})}),t.push({xtype:"yesnofield",itemId:"switch",inputType:"switch",boxLabel:"多选",value:"0",fieldBodyStyle:"text-align:center;",cls:"je-field-basiccls",margin:"10 0 0 0",handler:Ext.emptyFn}),r.queryMenu=Ext.create("Ext.menu.Menu",{plain:!0,items:t,padding:0,defaults:{xtype:"menucheckitem",hideOnClick:!1,columnText:r.text,handler:function(t){var e=JE.toBool(t.ownerCt.getCmp("switch").getValue());e||t.ownerCt.items.each(function(e){e!=t&&"menucheckitem"==e.xtype&&e.setChecked(!1)});var i=[],a=t.columnText;if(e){var n=[];t.ownerCt.items.each(function(e){"menucheckitem"==e.xtype&&JE.isNotEmpty(e.data)&&("checkAll"==t.itemId?e.setChecked(t.checked):t.ownerCt.getCmp("checkAll").setChecked(!1),e.checked&&(i.push(Ext.clone(e.data)),n.push(e.text)))}),a+="("+(0<n.length?n.join("、"):"全部")+")"}else JE.isNotEmpty(t.data)&&i.push(Ext.clone(t.data)),a+="("+t.text+")",r.queryMenu.hide();if(r.setText(a),r.queryConfig.fn){var o=r.getOwnerHeaderCt().grid;r.queryConfig.fn(o,r,i)}}}}),r.on("headerclick",function(e,t,i){i.stopPropagation();var a=i.getTarget(".x-column-header-text",1,!0);a&&r.queryMenu.showBy(a,"tc-bc",[0,5])}),r.text+="(全部)",r.titleStyle=""}}},afterRender:function(){this.callParent(arguments),this.keyNav&&this.keyNav.disable()}}),Ext.define("JE.core.ux.DragSelector",{requires:["Ext.dd.DragTracker","Ext.util.Region"],alias:"plugin.uxdragselector",extend:"Ext.AbstractPlugin",init:function(e){(this.dataview=e).mon(e,{beforecontainerclick:this.cancelClick,scope:this,render:{fn:this.onRender,scope:this,single:!0}})},onRender:function(){this.tracker=Ext.create("Ext.dd.DragTracker",{dataview:this.dataview,el:this.dataview.el,dragSelector:this,onBeforeStart:this.onBeforeStart,onStart:this.onStart,onDrag:this.onDrag,onEnd:this.onEnd}),this.dragRegion=Ext.create("Ext.util.Region")},onBeforeStart:function(e){return!this.dragSelector.disabled},onStart:function(e){var t=this.dragSelector,i=this.dataview;this.dragging=!0,t.fillRegions(),t.getProxy().show(),i.getSelectionModel().deselectAll()},cancelClick:function(){return!this.tracker.dragging},onDrag:function(e){var t,i,a=this.dragSelector,n=a.dataview.getSelectionModel(),o=a.dragRegion,r=a.bodyRegion,l=a.getProxy(),s=a.regions,d=s.length,c=this.startXY,u=this.getXY(),p=Math.min(c[0],u[0]),f=Math.min(c[1],u[1]),E=Math.abs(c[0]-u[0]),m=Math.abs(c[1]-u[1]);for(Ext.apply(o,{top:f,left:p,right:p+E,bottom:f+m}),o.constrainTo(r),l.setRegion(o),i=0;i<d;i++)t=s[i],o.intersect(t)?n.select(i,!0):n.deselect(i)},onEnd:Ext.Function.createDelayed(function(e){this.dataview.getSelectionModel();var t=this.dragSelector;this.dragging=!1,t.getProxy().hide()},1),getProxy:function(){return this.proxy&&Ext.get(this.proxy.id)||(this.proxy=this.dataview.getEl().createChild({tag:"div",cls:"x-view-selector"})),this.proxy},fillRegions:function(){var e=this.dataview,t=this.regions=[];e.all.each(function(e){t.push(e.getRegion())}),this.bodyRegion=e.getEl().getRegion()},setDisabled:function(e){this[e?"disable":"enable"]()}}),Ext.define("JE.core.ux.form.BarField",{extend:"Ext.form.field.Number",alternateClassName:["JEBarField"],alias:["widget.barfield"],minValue:0,maxValue:100,clearButton:!1,enableDisplay:!1,initComponent:function(){this.cls=Ext.value(this.cls,"")+" je-field-bar",this.callParent(arguments)},afterRender:function(){var e=this;e.callParent();var t=JEBarField.getHtmlTpl();e.barEl=e.inputEl.insertHtml("afterEnd",t,!0),e.pbarEl=e.barEl.child(".je-field-bar-inner"),e.numEl=e.barEl.child(".je-field-bar-text"),JE.isNotEmpty(e.value)&&e.setValue(e.value)},setValue:function(e){this.callParent(arguments),this.numEl&&(e=JEBarField.getDicRange(this,e),e=Number(isNaN(e)?0:e),this.numEl.update(e+"%"),this.pbarEl.dom.style.width=e+"%",this.pbarEl.dom.style.backgroundColor=JEBarField.getRangeImg(this.configInfo,e))},statics:{ranges:{blue:"1-20",yellow:"21-40",orange:"41-60",red:"61-80",green:"81-100"},imgs:{blue:"#3780DA",yellow:"#FFFFCC",orange:"#E18542",red:"#FF0000",green:"#A4E142"},getHtmlTpl:function(e){e=Ext.value(e,{width:0,img:JEBarField.imgs.blue,cls:""});return new Ext.XTemplate('<div class="je-field-bar-div {cls}"><div class="je-field-bar-inner" style="width: {width}%; background-color:{img};"></div><div class="je-field-bar-text" >{width}%</div></div>').apply(e)},getDicRange:function(i,e){if(!i.dicRange){i.dicRange={};var t=i.configInfo.split(",")[0];if(t){var a=JE.getDicItems(t);Ext.each(a,function(e,t){i.dicRange[e.code]=Math.round((t+1)/a.length*100)})}}return e=Ext.value(i.dicRange[e],e)},getRangeImg:function(e,i){var t={};if(Ext.isEmpty(e))t=JEBarField.ranges;else for(var a=e.split(","),n=0;n<a.length;n++){var o=a[n].split("~");t[o[1]]=o[0]}var r=JEBarField.imgs.blue;return Ext.iterate(t,function(e,t){if(i>=t.split("-")[0]&&i<=t.split("-")[1])return r=null==JEBarField.imgs[e]?e:JEBarField.imgs[e],!1}),r}}}),Ext.define("JE.core.ux.form.CBBField",{extend:"Ext.form.field.ComboBox",alias:"widget.cbbfield",mixins:["JE.core.util.FieldUtil"],editable:!1,queryMode:"local",trigger1Cls:Ext.baseCSSPrefix+"form-clear-trigger",trigger2Cls:Ext.baseCSSPrefix+"form-arrow-trigger",emptyText:"请选择",displayField:"text",valueField:"code",iconLayout:"text",initComponent:function(){var a=this;a.addEvents("reset");var e=Ext.value(a.configInfo,"").split(","),t=e[0],i=Ext.value(e[1],"").split("~"),n=Ext.value(e[2],"").split("~"),o="M"==e[3];if(a.ddCode=t,a.multiSelect=o||a.multiSelect,a.multiSelect&&(a.editable=a.editable||!1,a.iconLayout="icon-text"),a.configData={code:t,fieldNames:[],valueNames:[]},Ext.each(i,function(e,t){e!=a.name&&(a.configData.fieldNames.push(e),a.configData.valueNames.push(n[t]))}),a.otherConfig=Ext.value(a.otherConfig,{}),Ext.isString(a.otherConfig)&&(a.otherConfig=JE.decode(a.otherConfig)),JE.isNotEmpty(a.cascadeField)&&(a.otherConfig.editDic="0",a.multiSelect=!1),a.dicItemCodes=a.dicItemCodes||a.otherConfig.dicItemCodes,a.iconLayout=Ext.value(e[4],a.iconLayout),a.store?(a.dicData={},a.store.each(function(e){a.dicData[e.get(a.valueField)]=e.data})):a.store=Ext.create("Ext.data.Store",{fields:["id","code","text","iconCls"],data:a.buildItems(),self:!0}),Ext.isEmpty(a.listConfig)&&(a.listConfig={getInnerTpl:function(e){var t=a.iconLayout,i="{text}";return"icon"==t?i='<div class="{iconCls} item-icon" ></div>':"icon-text"==t&&(i='<div class="{iconCls} item-icon"></div>{text}',a.multiSelect&&(i=i.replace("{iconCls}","x-form-checkbox x-form-cb"))),i}},a.multiSelect&&(a.listConfig.headerTpl='<div style="padding:8px 5px;text-align:right;border-bottom:1px solid #C5C5C5;"><span class="btn selectall" style="margin-right:10px;">全选</span><span class="btn dselect">反选</span></div>',a.listConfig.listeners={afterrender:function(n){n.getEl().on("click",function(e){var t=e.getTarget(".btn",1,!0);if(t)if(t.hasCls("selectall"))n.getSelectionModel().selectAll();else if(t.hasCls("dselect")){var i=[],a=n.getSelectionModel();n.store.each(function(e){a.isSelected(e)||i.push(e)}),a.deselectAll(),a.select(i)}})}})),a.onTrigger2Click=Ext.clone(a.onTrigger1Click),a.onTrigger1Click=function(){a.reset(),a.setConfigInfo(),JE.isNotEmpty(a.cascadeField)&&a.fireEvent("select",a,[]),a.fireEvent("reset",a)},"1"==a.otherConfig.editDic&&!a.columnField){var r=[];if(a.hasRole(a.otherConfig.editDicPerm,JE.toBool(a.otherConfig.editDicCommon),t)){var l=0,s=a.otherConfig.editDicText||"编辑选项",d="blue";if(JE.isNotEmpty(a.otherConfig.editDicIcon)){s='<i class="'+a.otherConfig.editDicIcon+' unittpl-icon" title="'+s+'"></i>',l=20,d=JE.isNotEmpty(a.otherConfig.editDicIconColor)?a.otherConfig.editDicIconColor:"#1e89da";var c=JE.uuid(),u="#"+(a.id+"_"+c)+":hover{color:"+(JE.isNotEmpty(a.otherConfig.editDicIconHoverColor)?a.otherConfig.editDicIconHoverColor:"#1e89da")+" !important}";Ext.util.CSS.createStyleSheet(u)}r.push({id:c,text:s,width:l,handler:"function(field){JE.showDicFunc(field.configData.code,{field:field});}",color:d,bold:"1"})}a.unitListTpl=JE.decode(Ext.value(a.unitListTpl,"[]")),JE.isNotEmpty(a.unitListTpl)?a.unitListTpl=a.unitListTpl.concat(r):JE.isNotEmpty(a.unitTpl)?a.unitListTpl=[{id:JE.uuid(),text:a.unitTpl}].concat(r):a.unitListTpl=r}a.callParent(arguments)},afterRender:function(){var i=this;if(i.callParent(),JE.isNotEmpty(i.cascadeField)&&(i.formObj=i.formObj||i.up("form"),i.formObj&&i.cascadeField!=i.name)){var e=i.formObj.getFields?i.formObj.getFields(i.cascadeField):i.formObj.form.findField(i.cascadeField);e&&e.on("select",function(e,t){i.clearCascadeInfo()})}},refreshItems:function(){this.store.self&&!JE.isNotEmpty(this.cascadeWhereSql)&&this.store.loadData(this.buildItems())},buildItems:function(e){var i=this,t=i.configData.code,a=[];if(JE.isNotEmpty(e))a=e;else if(i.dataArray)a=i.dataArray,Ext.each(a,function(e,t){(Ext.isString(e)||Ext.isNumber(e))&&a.splice(t,1,{code:e,text:e})});else{var n=[];if(JE.isNotEmpty(i.cascadeField))a=i.loadCascadeItems();else if(JE.isNotEmpty(i.whereSql))JE.isEmpty(i.whereSql.match(/\{.*?\}/g))?a=JE.getDicItems(t,!1,i.whereSql):i.cascadeWhereSql=i.whereSql;else if(n=JE.getDicItems(t),Ext.isEmpty(i.dicItemIds)&&Ext.isEmpty(i.dicItemCodes))a=n;else{var o=i.dicItemIds,r="id";Ext.isEmpty(i.dicItemIds)&&(o=i.dicItemCodes,r="code");var l=Ext.isArray(o)?o:o.split(",");Ext.each(n,function(e){var t=-1!=l.indexOf(e[r]);(t=0!=i.includeItems?t:!t)&&a.push(e)})}}return i.dicData={},Ext.each(a,function(e){i.dicData[e[i.valueField]]=e}),a},getText:function(e){var t=this;if(Ext.isEmpty(e))return e;var i=[];return Ext.each(e.split(","),function(e){t.dicData[e]&&i.push(t.dicData[e][t.displayField])}),i.join(",")},getValue:function(){var e=this.callParent(arguments);return Ext.isArray(e)&&(e=e.join(",")),e},setValue:function(e,t){this.multiSelect&&Ext.isString(e)&&(e=e.split(",")),this.callParent(arguments)},initCascadeInfo:function(e){var t=this,i=t.cascadeField,a=e[i];if(t.name!=i&&t.lastCascadeCode!=a){t.lastCascadeCode=a;var n=t.configData.code,o=t.otherConfig.rootId,r=JE.dicInfoData[n],l={ddCode:n,zwfFlag:r?Ext.value(r.DICTIONARY_ZWFFLAG,"0"):"0",whereSql:t.whereSql,rootId:o,parentId:"",parentCode:a},s=t.getCascadeInfo();Ext.apply(l,s);var d=JE.ajax({url:JE.getUrlMaps("je.core.dd.tree","loadLinkTree"),params:l});d.success&&(t.store.loadData(t.buildItems(d.obj)),t.setValue(t.value))}},clearCascadeInfo:function(){me=this,me.reset(),me.store.removeAll(),me.lastCascadeCode="",me.fireEvent("select",me,[])},getCascadeInfo:function(){var e=this.cascadeField,t={};if(this.ownerCt&&"editor"==this.ownerCt.xtype){var i=this.ownerCt.grid.getSelectionModel().getSelection()[0];i&&(t.parentCode=i.get(e))}else if(this.formObj){var a=this.formObj.form.findField(e);if(a){t.parentCode=a.getValue();var n=a.store.findRecord("code",t.parentCode);n&&(t.parentId=n.get("id"))}}return t},loadCascadeItems:function(){var e=this,t=[],i=e.cascadeField,a=e.configData.code,n=e.otherConfig.rootId,o=JE.dicInfoData[a],r={ddCode:a,zwfFlag:o?Ext.value(o.DICTIONARY_ZWFFLAG,"0"):"0",whereSql:e.whereSql,rootId:n,parentId:"",parentCode:""};if(e.name==i||e.rendered)if(e.name!=i){var l=e.getCascadeInfo(),s=l.parentCode;if(JE.isNotEmpty(s))if(e.lastCascadeCode==s)e.store.each(function(e){t.push(Ext.clone(e.data))});else e.lastCascadeCode=s,Ext.apply(r,l),(d=JE.ajax({url:JE.getUrlMaps("je.core.dd.tree","loadLinkTree"),params:r})).success&&(t=d.obj)}else{var d;(d=JE.ajax({url:JE.getUrlMaps("je.core.dd.tree","loadLinkTree"),params:r})).success&&(t=d.obj)}return t},doQuery:function(e,t,i){var a=this;if(a.buildQueryData)a.buildQueryData(a,e);else if(JE.isNotEmpty(a.cascadeField)&&a.name!=a.cascadeField){var n=a.getCascadeInfo().parentCode;if(JE.isNotEmpty(n)&&a.lastCascadeCode!=n){var o=a.buildItems();a.store.loadData(o)}}else if(Ext.isEmpty(a.cascadeWhereSql)){var r=JE.dicInfoData[a.ddCode];if(r&&-1!=["PROC","SQL"].indexOf(r.DICTIONARY_DDTYPE)){d=JE.getDicItems(a.ddCode,!1,!0),o=a.buildItems(d);a.store.loadData(o)}}else{var l=a.getParentInfo(!0),s=JE.DB.formatSql(a.cascadeWhereSql,l.data,a.funcCode);if(a.lastWhereSql!=s){a.lastWhereSql=s;var d=JE.getDicItems(a.ddCode,!1,s),o=a.buildItems(d);a.store.loadData(o)}}return a.picker&&JE.isNotEmpty(a.valueModels)&&a.picker.getSelectionModel().select(a.valueModels),a.callParent(arguments)},onListRefresh:function(){var a=this;Ext.isEmpty(a.cascadeWhereSql)||Ext.each(a.valueModels,function(e,t){var i=a.store.getById(e.get("id"));a.valueModels[t]=i}),a.callParent(arguments)},onListSelectionChange:function(e,t){var i=this,a=i.multiSelect,n=0<t.length;if(!i.ignoreSelection&&i.isExpanded){if(a||Ext.defer(i.collapse,1,i),(a||n)&&i.setValue(t,!1),n){var o=[];Ext.each(t,function(e){o.push(e.data)}),i.setConfigInfo({datas:o}),i.fireEvent("select",i,t)}i.inputEl.focus()}},onExpand:function(){if(this.callParent(arguments),this.selectAllEl){var e=this.getPicker(),t=e.listEl.getHeight(),i=this.selectAllEl.getHeight();e.listEl.setHeight(t-i)}}}),Ext.define("JE.core.ux.form.CBBListField",{extend:"Ext.form.FieldContainer",alias:"widget.cbblistfield",mixins:{field:"Ext.form.field.Field"},layout:"column",dirtyCls:"",allowBlank:!0,isFormField:!0,codeName:"code",valueName:"value",textName:"text",readOnlyInit:!1,enterAdd:!0,valueConfig:{},typeConfig:{},actionButton:!0,initComponent:function(){var i=this;i.blankText=JE.getLocalLang("common.fieldBlankText");var e=Ext.value(i.configInfo,"").split(",");i.dicCode=e[0],i.actionButton="hideButton"!=e[1],i.otherConfig=Ext.value(JE.toObj(i.otherConfig),{}),i.hiddenFields=Ext.value(i.items,[]),delete i.items,i.actionButton&&(i.items=i.getListItem("add")),i.callParent(arguments),i.on("change",function(e,t){i.validate()}),i.initField()},formatListItem:void 0,getListItem:function(e){var n=this,t={border:0,xtype:"container",layout:{type:"hbox",align:"stretch"},columnWidth:1,defaults:{isFormField:!1,readOnly:n.readOnly},items:[]},i={xtype:"cbbfield",hideLabel:!0,editable:n.editable,configInfo:n.dicCode,margin:"0 4 0 0"};JE.isNotEmpty(n.otherConfig.typeField)&&(i.value=n.otherConfig.typeField);var a=JE.toNum(n.otherConfig.typeFieldWidth);0<a&&(i.width=a),Ext.apply(i,n.typeConfig),i.listeners=Ext.value(i.listeners,{}),i.listeners.reset=i.listeners.select=function(e){e.nextSibling().reset()},i.readOnlyCbb=!n.actionButton,i.readOnly=i.readOnlyCbb||n.readOnly;var o={xtype:"textfield",margin:"0 4 0 0",flex:1};if(JE.isNotEmpty(n.otherConfig.valueField)&&(o.value=n.otherConfig.valueField),Ext.apply(o,n.valueConfig),n.enterAdd&&(o.enableKeyEvents=!0,o.listeners=Ext.value(o.listeners,{}),o.listeners.keypress=function(e,t,i){13==t.getKey()&&n.actionButton&&n.add(n.getListItem("remove"))}),t.items=[i,o],Ext.isEmpty(n.hiddenFields)||(t.items=t.items.concat(n.hiddenFields)),Ext.each(t.items,function(e,t){e.listeners=Ext.clone(Ext.value(e.listeners,{}));var a=Ext.value(e.listeners.change,Ext.emptyFn);e.listeners.change=function(e,t,i){a(e,t,i),n.fireEvent("change",n,n.getValue(),n.rawValue)}}),n.actionButton&&!n.readOnly){var r={xtype:"button",iconCls:"cbblistfield_"+e};"add"==e?(delete t.margin,r.handler=function(){n.add(n.getListItem("remove"))}):r.handler=function(e){n.remove(e.ownerCt),n.fireEvent("change",n,n.getValue(),n.rawValue)},"plus"==JE.getTheme()&&("add"==e?Ext.apply(r,{iconCls:"fa fa-plus",cls:"btn btn-form JEPLUS_B_C01"}):Ext.apply(r,{iconCls:"fa fa-times",cls:"btn btn-form JEPLUS_B_C02"})),t.items.push(r)}return n.formatListItem&&n.formatListItem(n,t,e),t},setValue:function(t){var n=this;t=Ext.value(t,"");try{if(t=Ext.decode(t),Ext.isEmpty(t))throw"empty"}catch(e){t=[{}]}var o=0==n.items.getCount()&&!n.actionButton,r=Ext.value(n.readOnlyInit,!1);(n.actionButton||o||r)&&n.removeAll(),Ext.each(t,function(i,e){var t;if(n.actionButton||o||r){var a="remove";0==e&&(a="add"),t=n.add(n.getListItem(a))}else t=n.items.get(e);t&&JE.isNotEmpty(i)&&t.items.each(function(e,t){0==t?e.setValue(i[n.codeName]):1==t?e.setValue(i[n.valueName]):"button"!=e.xtype&&e.setValue(i[e.name])})})},getValue:function(){var a=this,t=[];return a.items.each(function(e){var i={};e.items.each(function(e,t){0==t?(i[a.codeName]=i[a.textName]=e.getValue(),e.getText&&(i[a.textName]=e.getText(i[a.codeName]))):1==t?i[a.valueName]=e.getValue():"button"!=e.xtype&&(i[e.name]=e.getValue())}),Ext.isEmpty(i[a.codeName])||1!=a.allowBlank&&Ext.isEmpty(i[a.valueName])||t.push(i)}),Ext.encode(t)},setReadOnly:function(i){var a=this;i=Ext.value(i,!1);a.readOnly=i,a.items.each(function(e){e.items.each(function(e,t){"button"==e.xtype?a.actionButton&&e[i?"hide":"show"]():1!=e.readOnlyCbb&&e.setReadOnly(i)})})},updateLabel:function(){},getErrors:function(){var e=[],t=Ext.decode(Ext.value(this.getValue(),"[]"));return!this.allowBlank&&Ext.isEmpty(t)&&e.push(this.blankText),e},validate:function(){var e,t,i;return this.disabled?t=!0:(e=this.getErrors(),t=Ext.isEmpty(e),i=this.wasValid,t?this.unsetActiveError():this.setActiveError(e)),t!==i&&(this.wasValid=t,this.fireEvent("validitychange",this,t),this.updateLayout()),t}}),Ext.define("JE.core.ux.form.ChildFuncField",{extend:"Ext.form.FieldContainer",alias:["widget.childfuncfield"],layout:"fit",onDirtyChange:Ext.emptyFn,rowHeight:28,headerHeight:31,headerHeightCount:1,scrollHeight:18,topLabelHeight:0,initComponent:function(){var r=this;r.blankText=Ext.form.field.Text.prototype.blankText,r.cls=Ext.value(r.cls,"")+" je-field-childfunc",r.localLang=JE.getLocalLang("core.ux.childfuncfield",!0),r.addEvents("storebeforeadd","storeadd","storebeforeremove","storeremove","storebeforeremoveall","storeremoveall","recordchange"),JE.isNotEmpty(r.fieldLabel)&&!r.hideLabel&&"top"==r.labelAlign&&(r.topLabelHeight="plus"==JE.getTheme()?34:28),r.useDirty=!1;var e=r.configInfo.split(","),t=e[0],i=e[1];r.maxCount=Number(Ext.value(e[2],"0")),r.otherConfig=Ext.value(r.otherConfig,{}),Ext.isString(r.otherConfig)&&(r.otherConfig=JE.decode(r.otherConfig));var l=JE.getFuncData(t),a=l.info,n=(a.pkName,a.tableName,a.viewTableName),o=JE.getFuncData(r.funcCode),s=o.info.pkName;r.mainConfigInfo=Ext.clone(Ext.value(o.childFields[t],{})),r.mainConfigInfo.fkName=i,r.mainConfigInfo.ppkName=s;var d=[];Ext.each(l.grid.columns,function(e){var t=Ext.clone(e);t.enableEdit=!1,t.menuDisabled=!0,t.sortable=!1,t.flex=JE.toNum(r.otherConfig.flex),JE.isNotEmpty(t.columns)&&Ext.each(t.columns,function(e){e.enableEdit=!1,e.menuDisabled=!0,e.sortable=!1}),d.push(t)});var c={text:"",menuDisabled:!0,align:"center",xtype:"actioncolumn",width:60,resizable:!1,tdCls:"je-grid-td-middle",items:[{iconCls:JE.getIconCls({iconCls:"jeicon jeicon-error",fontIconCls:"fa fa-times-circle"}),tooltip:r.localLang.reomveTip,handler:r.gridRemove,iconStyle:"color:#E94B4D;",scope:r},{iconCls:JE.getIconCls({iconCls:"jeicon jeicon-trash-o",fontIconCls:"fa fa-trash-o"}),tooltip:r.localLang.removeAllTip,handler:r.gridRemoveAll,iconStyle:"color:#E94B4D;",scope:r}],listeners:{headerclick:r.gridAdd,scope:r}};if("0"!=r.otherConfig.add||"1"==r.otherConfig.adds||"0"!=r.otherConfig.remove){var u=Ext.value(Ext.value(r.actionColumnIndex,r.otherConfig.actionColumnIndex),d.length);"0"==r.otherConfig.add&&"1"!=r.otherConfig.adds?(c.text="删除",delete c.listeners):("0"!=r.otherConfig.add&&(c.text+='<div data-qtip="'+r.localLang.addTip+'" class="add-icon add '+JE.getIconCls({iconCls:"jeicon jeicon-resource-table-addition",fontIconCls:"fa fa-plus-circle"})+'"></div>'),"1"==r.otherConfig.adds&&(c.text+='<div data-qtip="批量添加" class="add-icon adds '+JE.getIconCls({iconCls:"jeicon jeicon-new-form",fontIconCls:"fa fa-list"})+'"></div>')),"0"==r.otherConfig.remove&&(c.items=[]),d.splice(u,0,c)}var p=JE.getStore({tableName:n,action:a.funcAction,params:{tableCode:n,limit:-1,orderSql:Ext.value(a.orderSql,"order by sy_orderindex"),basicSql:JE.toXT(Ext.value(a.whereSql,"")),whereSql:" AND 1!=1"}});p.on({load:{fn:r.changeHeight,scope:r},add:{fn:r.changeHeight,scope:r},remove:{fn:r.changeHeight,scope:r},update:function(e,t,i){if("edit"==i){r.fireEvent("recordchange",r,t,e);var a=l.gridExp;if(JE.isNotEmpty(a)){var n={},o=t.data;Ext.iterate(a,function(e,t){JE.isNotEmpty(t.fn)?n[e]=JE.eval(t.fn)(o):n[e]=JE.toXT(t.exp,o)}),t.set(n)}}}});var f={forceFit:!0,listeners:{drop:function(e,t,i,a){JE.Action.doDrop(r.grid)}},plugins:{ptype:"gridviewdragdrop",dragText:r.localLang.dragText,pluginId:"ddOrder"}},E=r.otherConfig.childFuncFieldWin,m="0",g="",h="";if(E){var x=E.split(",");x&&(m=x[0],g=x[1],h=x[2])}var v={cls:"je-field-grid je-grid",childFunc:!0,autoScroll:!0,columnLines:!0,multiSelect:!0,funcData:l,columns:d,plugins:{ptype:"cellediting",clicksToEdit:1,pluginId:"cellEdit",beforeEdit:function(e){return!this.disabled}},store:p,viewConfig:f,listeners:Ext.clone(Ext.value(l.info.gridListeners,{})),selModel:{selType:"checkboxmodel"},listeners:{afterrender:function(i,e){i.getEl().on("click",function(e){var t=i.ownerCt.formObj;e.getTarget(".ChildFuncField-winBtn",1,!0)&&r.winChildFuncField(g,h,t)})}}};if("1"==m&&(v.bbar={xtype:"box",padding:"5 0 0 0",html:'<font class="ChildFuncField-winBtn">弹出数据面板</font>',style:"text-align:right;"}),"0"!=r.otherConfig.remove&&l.info.multiSelect&&!r.readOnly||delete v.selModel,"1"==r.otherConfig.funcEdit&&delete v.plugins,r.grid=Ext.create("Ext.grid.Panel",v),"1"==r.otherConfig.funcEdit&&r.grid.on("itemdblclick",function(e,n){var t=n.get(r.funcData.info.pkName);JE.showFunc(r.funcData.info.funcCode,{type:"form",useForm:!0,id:t,callback:function(e){e.on("endsubmit",function(e,t,i,a){n.set(a),n.commit()})}})}),r.funcData=l,r.parentFuncData=o,r.items=[r.grid],Ext.isEmpty(r.height)||r.height<1){var y=function(e,t){t>r.headerHeightCount&&(r.headerHeightCount=t),Ext.each(e,function(e){JE.isNotEmpty(e.columns)&&y(e.columns,t+1)})};y(l.grid.columns,1),r.headerHeight=r.headerHeight*r.headerHeightCount,r.height=r.headerHeight*r.headerHeightCount+r.rowHeight+r.scrollHeight}r.callParent(arguments)},setReadOnly:function(e){e=Ext.value(e,!1);var t=this.grid.down("actioncolumn");this.readOnly=e,JE.isNotEmpty(t)&&t[e?"hide":"show"]();var i=this.grid.getPlugin("cellEdit");i&&i[e?"disable":"enable"](),this.grid[e?"addCls":"removeCls"]("je-field-grid-readonly")},afterRender:function(){var e=this;e.callParent(arguments),e.readOnly&&e.setReadOnly(e.readOnly),setTimeout(function(){e.changeHeight(e.grid.store)},100)},doLoad:function(e){var t=this,i=t.parentFuncData.info;if(!t.isHidden()&&!Ext.isEmpty(e)){var a=" and 1!=1 ";if(Ext.isEmpty(e[i.pkName])||(a=t.buildChildInfo(e).sql),t.grid.mainRecordData=e,t.grid.store.proxy.extraParams.whereSql=t.grid.store.proxy.extraParams.basicSql+a,Ext.isEmpty(e[i.pkName])){if(t.grid.store.removeAll(),!Ext.isEmpty(t.value)){var n=Ext.decode(t.value);Ext.each(n,function(e){e[t.funcData.info.pkName]=JE.uuid()}),t.grid.store.add(n)}}else t.grid.store.load()}},changeHeight:function(e){var t=this,i=t.maxCount,a=e.getCount();0!=i&&i<a?a=i:0==a&&(a=1);var n=t.rowHeight*a,o=t.headerHeight+n+t.scrollHeight+t.topLabelHeight;t.getHeight()<=o||t.initialConfig.height<=o?(t.setHeight(o),t.doLayout()):t.initialConfig.height>o&&(t.setHeight(t.initialConfig.height),t.doLayout()),t.isValid()},gridRemove:function(i,a,e){var n=this,o=n.funcData.info,r=i.getStore().getAt(a),l=r.get(o.pkName);0!=n.fireEvent("storebeforeremove",n,i,r)&&(Ext.isEmpty(l)?(i.getStore().removeAt(a),n.fireEvent("storeremove",n,i,r)):JE.confirm(n.localLang.removeConfirm,function(e){if("ok"==e){var t=JE.ajax({url:i.getStore().actUrls.remove,params:{ids:l,tableCode:o.tableName}});t.success||JE.error(t.obj,t),i.getStore().removeAt(a),n.fireEvent("storeremove",n,i,r)}}))},gridRemoveAll:function(a,e,t){var n=this,o=n.funcData.info,r=a.getSelectionModel().getSelection();0!=r.length?0!=n.fireEvent("storebeforeremoveall",n,a,r)&&JE.confirm(n.localLang.removeConfirm,function(e){if("ok"==e){var i=[];if(Ext.each(r,function(e){var t=e.get(o.pkName);Ext.isEmpty(t)||i.push(t)}),0<i.length){var t=JE.ajax({url:a.getStore().actUrls.remove,params:{ids:i.join(","),tableCode:o.tableName}});t.success||JE.error(t.obj,t)}a.getStore().remove(r),n.fireEvent("storeremoveall",n,a,r)}}):JE.alert(n.localLang.removeAlert)},gridAdd:function(e,t,i){var o=e.grid,r=this,a=Ext.get(i.getTarget());if(a.hasCls("add-icon")){var n=r.formObj.getValue(),l=r.funcData.getDefVals();l=Ext.apply(l,r.buildChildInfo(n).data);if(a.hasCls("add")){if(0!=r.fireEvent("storebeforeadd",r,o))if("1"==r.otherConfig.funcAdd){if(JE.isEmpty(n[r.mainConfigInfo.ppkName]))return void JE.alert("功能添加需要先报存主功能！");JE.showFunc(r.funcData.info.funcCode,{type:"form",useForm:!0,values:l,callback:function(e){e.on("endsubmit",function(e,t,i,a){var n=o.getStore().add(a);r.fireEvent("storeadd",r,o,n)})}})}else{var s=o.getStore().add(l);r.fireEvent("storeadd",r,o,s)}}else if(a.hasCls("adds")){var d=r.otherConfig.addsConfigInfo;if(JE.isEmpty(d))return void JE.alert("请配置批量添加信息！");var c=d.split(","),u={code:c[0],fieldNames:Ext.value(c[1],"").split("~"),valueNames:Ext.value(c[2],"").split("~")},p={title:r.fieldLabel,configInfo:d,whereSql:Ext.value(r.otherConfig.addsWhereSql,""),type:r.otherConfig.addsType||"grid",callback:function(e){var t=[];Ext.each(e,function(i){var a=Ext.clone(l);Ext.each(u.valueNames,function(e,t){a[u.fieldNames[t]]=i.get(e)}),t.push(a)});var i=o.getStore().add(t);r.fireEvent("storeadd",r,o,i)}};0!=r.fireEvent("storebeforeadd",r,o,p)&&JE.selectWin(p)}}},getNewRows:function(){return Ext.value(this.newrows,[])},doSave:function(i){var a=this,e=a.grid,t=e.getStore(),n=e.funcData.info,o=n.pkName,r=n.tableName;if(!a.isHidden()){var l=t.getNewRecords(),s=t.getUpdatedRecords(),d=[],c=a.mainConfigInfo.fkName,u=a.mainConfigInfo.ppkName;Ext.each(l,function(e){var t=e.data;t.__action__="doSave",JE.isNotEmpty(t[a.funcData.info.pkName])?t.__action__="doUpdate":t[a.funcData.info.pkName]=JE.uuid(),JE.isEmpty(t[c])&&(t[c]=i[u]),Ext.each(a.mainConfigInfo.fields,function(e){"textcode"==e.xtype&&e.value&&(t[e.chCode]=i[e.code])}),e.commit(),d.push(t)});var p=[];Ext.each(s,function(e){var t=e.getChanges();t[o]=e.data[o],t.__action__="doUpdate",p.push(t)});var f=d.concat(p),E=[];if(0<f.length){var m=JE.ajax({url:t.actUrls.insertUpdateList,params:{strData:Ext.encode(f),tableCode:r,codeGenFieldInfo:Ext.encode(e.funcData.grid.textcodeFields)}});E=m.obj,m.success?(t.remove(l),Ext.each(E,function(e){"doUpdate"!=e.__action__&&t.add(e)})):JE.error(m.obj,m),t.commitChanges()}a.newrows=E}},buildChildInfo:function(n){var o=this.mainConfigInfo,e=o.fields=Ext.value(o.fields,[]),r=[],l={},s=!1;return Ext.each(e,function(e){var t=n[e.code];if("<系统自动生成>"==t&&(t=n[e.code]="",e.xtype="textcode"),1==e.whereSql&&"no"!=e.whereType){var i={};if("idit"==e.whereType){var a=JE.DB.formatSql(e.sql,n);i={type:e.whereType,sql:a}}else i={code:e.chCode,type:e.whereType,value:t};r.push(i)}1==e.value&&(l[e.chCode]=t),e.chCode==o.fkName&&(s=!0)}),s||(e.push({chCode:o.fkName,code:o.ppkName,type:"=",whereSql:!0,value:!0}),l[o.fkName]=n[o.ppkName],r.push({code:o.fkName,type:"=",value:n[o.ppkName]})),{sql:JE.DB.buildWhereSql(r),data:l}},getErrors:function(e){var t=[],i=this.grid.store.getCount();return this.allowBlank||0!=i||t.push(this.blankText),t},isValid:function(){var e,t,i=this,a=[];return i.disabled||!i.grid?e=!0:(a=i.getErrors(),e=Ext.isEmpty(a),t=i.wasValid,e?i.unsetActiveError():i.setActiveError(a),i.el.set({"data-errorqtip":i.getActiveError()||""})),e!==t&&i.grid&&i.grid.getEl()&&i.grid.getEl()[e?"removeCls":"addCls"]("je-box-invalid"),e},winChildFuncField:function(e,t,i){var a=this,n=JE.getBodyWidth()-150,o=JE.getBodyHeight()-100;e&&(n=-1!=e.indexOf("%")?e:JE.toNum(e)),t&&(o=-1!=t.indexOf("%")?t:JE.toNum(t));var r=Ext.clone(a.grid.initialConfig);r.xtype="grid",r.listeners={afterRender:function(e){e.ownerCt.formObj=i,a.readOnly&&e.down("gridcolumn[xtype=actioncolumn]").hide()}},delete r.bbar,a.readOnly&&delete r.plugins;var l=JE.win({xtype:"panel",width:n,height:o,title:a.fieldLabel,layout:"fit",items:r,autoShow:!0,useButton:[{text:"关闭",cls:"btn",iconCls:"fa fa-close",handler:function(){l.close()}}]})}}),Ext.define("JE.core.ux.form.CKEditorField",{extend:"Ext.form.field.Display",alias:["widget.ckeditorfield","widget.ckeditor"],height:400,submitValue:!0,autoScroll:!0,readOnly:!1,setReadOnly:function(e){this.callParent(arguments),this.displayEl&&this.ckeditor.container&&(this.displayEl.setStyle({display:e?"":"none",visibility:e?"visible":"hidden"}),this.ckeditor.setReadOnly(e),this.hideTBar?this.inputEl.setStyle({display:e?"none":"",visibility:e?"hidden":"visible"}):this.ckeditor.container[e?"hide":"show"]())},initComponent:function(){this.fieldStyle="width:100%;height:100%;border:1px solid #b5b8c8;overflow:auto;background-color:#FFFFFF;",this.hideTBar="hideTBar"==this.configInfo,this.callParent(arguments),this.on("afterrender",function(e){})},afterRender:function(){var t=this;t.callParent(arguments),t.displayEl=t.inputEl.insertSibling({id:t.id+"-displayEl",tag:"div",style:t.fieldStyle}),t.displayEl.setStyle({backgroundColor:"#E8EDF3"}),t.inputEl.dom.setAttribute("contenteditable",!0),t.inputEl.parent(null,!0).style.height="100%",t.ckeditor=CKEDITOR[t.hideTBar?"inline":"replace"](t.inputEl.dom.id,{toolbar:"JEtbar",height:t.getHeight(),title:"单击编辑信息",width:"100%",baseFloatZIndex:3e4,filebrowserUploadUrl:t.funAction+"!doUpdate.action?Type=File&tableCode="+t.tableName+"&editorField="+t.name,filebrowserImageUploadUrl:t.funAction+"!doUpdate.action?Type=Image&tableCode="+t.tableName+"&editorField="+t.name,filebrowserFlashUploadUrl:t.funAction+"!doUpdate.action?Type=Flash&tableCode="+t.tableName+"&editorField="+t.name},t.value),t.ckeditor.on("blur",function(e){t.validate()}),t.ckeditor.on("instanceReady",function(e){t.setReadOnly(t.readOnly),t.updateLayout({defer:!0,isRoot:!1})}),t.labelEl&&(t.maxviewEl=t.labelEl.parent().appendChild({tag:"div",cls:"je_config_fullscreen",style:"cursor: pointer;margin:10px;float:right;",title:"窗口查看"}),t.maxviewEl.on("click",function(){var e=t.ckeditor.getData();JE.win({title:"内容查看",autoScroll:!0,bodyStyle:"padding:5px;background-color:#FFFFFF;",colseAction:"hide",html:e}).show()}))},setRawValue:function(e){e=Ext.value(e,"");try{e=Ext.htmlDecode(e)}catch(e){}this.ckeditor&&this.ckeditor.setData(e),this.displayEl&&(this.displayEl.dom.innerHTML=e),this.rawValue=e},getRawValue:function(){var e=this.rawValue;return this.ckeditor&&(e=this.ckeditor.getData(),e=Ext.htmlEncode(e)),e},reset:function(){this.beforeReset(),this.clearInvalid(),delete this.wasValid}}),Ext.define("JE.core.ux.form.ClearButton",{alias:"plugin.clearbutton",hideClearButtonWhenEmpty:!0,hideClearButtonWhenMouseOut:!0,animateClearButton:!0,clearOnEscape:!0,clearButtonCls:"ext-ux-clearbutton",textField:null,animateWithCss3:!1,constructor:function(e){Ext.apply(this,e),this.callParent(arguments)},init:function(e){(this.textField=e).rendered?this.handleAfterRender():e.on("afterrender",this.handleAfterRender,this)},handleAfterRender:function(e){if(this.textField.inputEl){var t=this.textField.inputEl.dom.nodeName.toLowerCase();this.textField.bodyEl&&-1!=["textarea","input"].indexOf(t)&&(this.isTextArea="textarea"==t,this.createClearButtonEl(),this.addListeners(),this.repositionClearButton(),this.updateClearButtonVisibility(),this.addEscListener())}},createClearButtonEl:function(){this.animateClearButton&&this.animateWithCss3;this.clearButtonEl=this.textField.inputEl.insertHtml("afterEnd",'<div class="'+this.clearButtonCls+'"></div>',!0),this.clearButtonEl.parent().setStyle("position","relative"),this.animateClearButton&&(this.animateWithCss3=this.supportsCssTransition(this.clearButtonEl)),this.animateWithCss3?this.clearButtonEl.addCls(this.clearButtonCls+"-off"):this.clearButtonEl.setStyle("visibility","hidden")},supportsCssTransition:function(e){for(var t=["transitionProperty","WebkitTransitionProperty","MozTransitionProperty","OTransitionProperty","msTransitionProperty","KhtmlTransitionProperty"],i=e.dom.style,a=0,n=t.length;a<n;++a)if("undefined"!==i[t[a]])return!0;return!1},addEscListener:function(){this.clearOnEscape&&this.textField.inputEl.on("keydown",function(e){if(e.getKey()==Ext.EventObject.ESC){if(this.textField.isExpanded)return;Ext.Function.defer(this.textField.setValue,1,this.textField,[""]),e.stopEvent()}},this)},addListeners:function(){var e=this.textField,t=e.bodyEl;t.on("mouseover",this.handleMouseOverInputField,this),t.on("mouseout",this.handleMouseOutOfInputField,this),e.on("destroy",this.handleDestroy,this),e.on("resize",this.repositionClearButton,this),e.on("focus",this.repositionClearButton,this),e.on("change",function(){this.repositionClearButton(),this.updateClearButtonVisibility()},this);var i=this.clearButtonEl;i.on("mouseover",this.handleMouseOverClearButton,this),i.on("mouseout",this.handleMouseOutOfClearButton,this),i.on("mousedown",this.handleMouseDownOnClearButton,this),i.on("mouseup",this.handleMouseUpOnClearButton,this),i.on("click",this.handleMouseClickOnClearButton,this)},handleDestroy:function(){this.clearButtonEl.destroy()},handleMouseClickOnClearButton:function(e,t,i){if(this.isLeftButton(e)){for(var a=this.textField,n=!1,o=1;o<5;o++)if("x-form-clear-trigger"==a["trigger"+o+"Cls"]){n=!0,a["onTrigger"+o+"Click"]&&a["onTrigger"+o+"Click"]();break}n||(this.textField.reset(),this.textField.focus())}},handleMouseOverInputField:function(e,t,i){this.clearButtonEl.addCls(this.clearButtonCls+"-mouse-over-input"),e.getRelatedTarget()==this.clearButtonEl.dom&&(this.clearButtonEl.removeCls(this.clearButtonCls+"-mouse-over-button"),this.clearButtonEl.removeCls(this.clearButtonCls+"-mouse-down")),this.updateClearButtonVisibility()},handleMouseOutOfInputField:function(e,t,i){this.clearButtonEl.removeCls(this.clearButtonCls+"-mouse-over-input"),e.getRelatedTarget()==this.clearButtonEl.dom&&this.clearButtonEl.addCls(this.clearButtonCls+"-mouse-over-button"),this.updateClearButtonVisibility()},handleMouseOverClearButton:function(e,t,i){e.stopEvent(),this.textField.bodyEl.contains(e.getRelatedTarget())||(this.clearButtonEl.addCls(this.clearButtonCls+"-mouse-over-button"),this.updateClearButtonVisibility())},handleMouseOutOfClearButton:function(e,t,i){e.stopEvent(),this.textField.bodyEl.contains(e.getRelatedTarget())||(this.clearButtonEl.removeCls(this.clearButtonCls+"-mouse-over-button"),this.clearButtonEl.removeCls(this.clearButtonCls+"-mouse-down"),this.updateClearButtonVisibility())},handleMouseDownOnClearButton:function(e,t,i){this.isLeftButton(e)&&this.clearButtonEl.addCls(this.clearButtonCls+"-mouse-down")},handleMouseUpOnClearButton:function(e,t,i){this.isLeftButton(e)&&this.clearButtonEl.removeCls(this.clearButtonCls+"-mouse-down")},repositionClearButton:function(){var e=this.clearButtonEl;if(e){var t=this.calculateClearButtonPosition(this.textField);e.dom.style.right=t.right+"px",e.dom.style.top=t.top+"px"}},calculateClearButtonPosition:function(e){var t=e.inputEl,i=t.getBox(!0,!0),a=t.getHeight(),n=t.parent().getHeight(),o=this.clearButtonEl.getHeight(),r=n-a;this.isTextArea?r+=o/2:r+=(a-o)/2;var l=i.x;return this.fieldHasScrollBar()&&(l+=Ext.getScrollBarWidth()),{right:l,top:r}},fieldHasScrollBar:function(){if(!this.isTextArea)return!1;var e=this.textField.inputEl,t=e.getStyle("overflow-y");return"hidden"!=t&&"visible"!=t&&("scroll"==t||!(e.dom.scrollHeight<=e.dom.clientHeight))},isButtonCurrentlyVisible:function(){if(this.animateClearButton&&this.animateWithCss3)return this.clearButtonEl.hasCls(this.clearButtonCls+"-on");var e=Ext.core.Element.data(this.clearButtonEl.dom,"isVisible");return"boolean"==typeof e?e:this.clearButtonEl.isVisible()},shouldButtonBeVisible:function(){if(this.hideClearButtonWhenEmpty&&Ext.isEmpty(this.textField.getValue()))return!1;var e=this.clearButtonEl;return!(this.hideClearButtonWhenMouseOut&&!e.hasCls(this.clearButtonCls+"-mouse-over-button")&&!e.hasCls(this.clearButtonCls+"-mouse-over-input"))},updateClearButtonVisibility:function(){if(!this.textField.readOnly&&!this.textField.disabled){var e=this.isButtonCurrentlyVisible(),t=this.shouldButtonBeVisible(),i=this.clearButtonEl;e!=t&&(this.animateClearButton&&this.animateWithCss3?(this.clearButtonEl.removeCls(this.clearButtonCls+(e?"-on":"-off")),i.addCls(this.clearButtonCls+(t?"-on":"-off"))):(i.stopAnimation(),i.setVisible(t,this.animateClearButton)),i.setStyle("background-color",this.textField.inputEl.getStyle("background-color")))}},isLeftButton:function(e){return 0===e.button}}),Ext.define("JE.core.ux.form.Color",{extend:"Ext.form.field.Trigger",alias:"widget.colorfield",trigger1Cls:Ext.baseCSSPrefix+"form-clear-trigger",trigger2Cls:Ext.baseCSSPrefix+"form-color-trigger",editable:!1,enableClick:!0,initComponent:function(){this.addEvents("reset");var e=Ext.value(this.configInfo,"");Ext.isEmpty(e)||(this.colors=e.split(",")),this.callParent(arguments)},onTrigger1Click:function(){this.reset(),this.fireEvent("reset",this)},onTrigger2Click:function(){var e=this;Ext.defer(function(){e.color.spectrum("show"),e.color.spectrum("set",e.getValue())},100)},afterRender:function(){var t=this;t.callParent(),t.color=JE.showColor({dom:t.el.dom,colors:t.colors,autoShow:!1,callback:function(e){"editor"==t.ownerCt.xtype?t.ownerCt.grid.getSelectionModel().getSelection()[0].set(t.name,e):t.setValue(e)}}),Ext.isEmpty(t.value)||t.setELColor(t.value)},setValue:function(e){this.callParent(arguments),this.setELColor(e)},reset:function(){this.callParent(),this.setELColor(this.value)},setELColor:function(e){this.inputEl&&(e=Ext.value(e,""),this.inputEl.setStyle({backgroundImage:"none",backgroundColor:e,color:e}))}}),Ext.define("JE.core.ux.form.CRGroup",{extend:"Ext.form.CheckboxGroup",isFormField:!0,submitValue:!0,mixins:["JE.core.util.FieldUtil"],alias:["widget.crgroup","widget.cgroup","widget.rgroup"],items:[],iconLayout:"text",initComponent:function(){var o=this;o.localLang=JE.getLocalLang("core.ux.crgroup",!0),o.blankText=o.localLang.fieldBlankText,"rgroup"==o.xtype&&(o.defaultType="radiofield",o.groupCls=Ext.baseCSSPrefix+"form-radio-group",o.getBoxes=function(e){return o.query("[isRadio]"+(e||""))});var e=Ext.value(o.configInfo,"").split(","),t=e[0],i=Ext.value(e[1],"").split("~"),a=Ext.value(e[2],"").split("~");o.iconLayout=Ext.value(e[4],o.iconLayout),e[5]?o.columns=Number(e[5]):"auto"==o.columns&&(o.layout={type:"checkboxgroup",autoFlex:!1}),o.configData={code:t,fieldNames:[],valueNames:[]},Ext.each(i,function(e,t){e!=o.name&&(o.configData.fieldNames.push(e),o.configData.valueNames.push(a[t]))}),o.otherConfig=Ext.value(o.otherConfig,{}),Ext.isString(o.otherConfig)&&(o.otherConfig=JE.decode(o.otherConfig)),o.dicItemCodes=o.dicItemCodes||o.otherConfig.dicItemCodes,o.items=o.buildItems(),o.listeners=Ext.clone(Ext.value(o.listeners,{}));var r=Ext.value(o.listeners.change,Ext.emptyFn);if(o.listeners.change=function(e,t,i){var a=Ext.value(t,"").split(",");if(!("rgroup"==o.xtype&&1<a.length)){var n=[];Ext.each(a,function(e){n.push(o.dicData[e])}),o.setConfigInfo({datas:n}),r(o,t,i)}},"1"==o.otherConfig.editDic&&!o.columnField){var n=[];if(o.hasRole(o.otherConfig.editDicPerm,JE.toBool(o.otherConfig.editDicCommon),t)){var l=0,s=o.otherConfig.editDicText||"编辑选项",d="blue";if(JE.isNotEmpty(o.otherConfig.editDicIcon)){s='<i class="'+o.otherConfig.editDicIcon+' unittpl-icon" title="'+s+'"></i>',l=20,d=JE.isNotEmpty(o.otherConfig.editDicIconColor)?o.otherConfig.editDicIconColor:"#1e89da";var c=JE.uuid(),u="#"+(o.id+"_"+c)+":hover{color:"+(JE.isNotEmpty(o.otherConfig.editDicIconHoverColor)?o.otherConfig.editDicIconHoverColor:"#1e89da")+" !important}";Ext.util.CSS.createStyleSheet(u)}n.push({id:c,text:s,width:l,handler:"function(field){JE.showDicFunc(field.configData.code,{field:field});}",color:d,bold:"1"})}o.unitListTpl=JE.decode(Ext.value(o.unitListTpl,"[]")),JE.isNotEmpty(o.unitListTpl)?o.unitListTpl=o.unitListTpl.concat(n):JE.isNotEmpty(o.unitTpl)?o.unitListTpl=[{id:JE.uuid(),text:o.unitTpl}].concat(n):o.unitListTpl=n}o.callParent(arguments)},afterRender:function(){var t=this;t.callParent(arguments);var e=Ext.value(t.ownerCt,{});if("cgroup"==t.xtype&&0!=t.checkAll){var i="fieldcontainer"==e.xtype?e:t;if(!i.labelEl||i.checkEl)return;var a="JE_COMM_CHECKBOX02",n="JE_COMM_CHECKBOX01";"plus"==JE.getTheme()&&(a="je-cgroup-checked",n="");var o=document.createElement("div");o.setAttribute("type","button"),o.setAttribute("class","je-button-icon "+n+" je-cgroup-checkall"),(o=i.checkEl=i.labelEl.insertFirst(o)).on("click",function(){if(!t.readOnly){var e=o.checkAll;o.checkAll=!e,o.removeCls(e?a:n),o.addCls(e?n:a),t.items.each(function(e){e.setValue(o.checkAll)})}})}},refreshItems:function(){var e=this.buildItems();this.removeAll(),this.add(e)},buildItems:function(){var i=this,e=Ext.value(i.whereSql,""),t=i.configData.code,a=[],n=[];i.dataArray?(n=i.dataArray,Ext.each(n,function(e,t){(Ext.isString(e)||Ext.isNumber(e))&&n.splice(t,1,{code:e,text:e})})):n=JE.getDicItems(t),Ext.isEmpty(e)&&!Ext.isEmpty(n)||(n=JE.getDicItems(t,!1,e)),i.dicData={};var o=[],r="id";if(!Ext.isEmpty(i.dicItemIds)||!Ext.isEmpty(i.dicItemCodes)){var l=i.dicItemIds;Ext.isEmpty(i.dicItemIds)&&(l=i.dicItemCodes,r="code");o=l.split(",")}return Ext.each(n,function(e){var t={iconCls:e.iconCls,fieldTdAttr:' align="center" ',padding:"0 3px",boxLabel:e.text,name:i.name,submitValue:!1,inputValue:e.code,readOnly:i.readOnly,readOnlyCls:"x-form-radio-readonly"};"icon"==i.iconLayout?(t.iconAlign="right",delete t.boxLabel):"icon-text"==i.iconLayout&&(t.iconAlign="top"),e.value==e.code&&(t.checked=!0),i.dicData[e.code]=e,!Ext.isEmpty(o)&&-1==o.indexOf(e[r])||a.push(t)}),a},getValue:function(){var e=this.callParent(arguments),t="";for(var i in e)t=Ext.isArray(e[i])?e[i].join(","):e[i];return t=Ext.value(t,"")},getText:function(e){var t=this;if(Ext.isEmpty(e))return e;var i=[];return Ext.each(e.split(","),function(e){i.push(t.dicData[e]?t.dicData[e].text:"")}),i.join(",")},getSubmitData:function(){var e=null;return this.disabled||!this.submitValue||this.isFileUpload()||((e={})[this.getName()]=""+this.getValue()),e},setValue:function(e){e=(Ext.value(e,"")+"").split(",");var t={};return t[this.getName()]=e,e=t,this.callParent(arguments)},reset:function(){var e=this.hasActiveError(),t=this.preventMark;this.preventMark=!0,this.mixins.field.reset.call(this),this.preventMark=t,this.unsetActiveError(),e&&this.updateLayout()}}),Ext.define("JE.core.ux.form.datetime.DateTime",{extend:"Ext.form.field.Date",alias:["widget.datetimefield","widget.datedayfield","widget.datemonthfield"],requires:["JE.core.ux.form.datetime.DatePicker","JE.core.ux.form.datetime.MonthPicker"],multiSelect:!1,trigger1Cls:Ext.baseCSSPrefix+"form-clear-trigger",trigger2Cls:Ext.baseCSSPrefix+"form-date-trigger",editable:!1,dateType:"datetime",format:void 0,initComponent:function(){JE.vue.dtPicker({params:{isShow:!0}});var t=this;if(t.localLang=JE.getLocalLang("core.ux.datetime"),t.addEvents("reset","selfexpand"),Ext.Date.dayNames=t.localLang.dayNames,"datedayfield"==t.xtype?t.dateType="date":"datemonthfield"==t.xtype&&(t.dateType="month"),Ext.isEmpty(t.submitFormat)&&("date"==t.dateType?t.submitFormat="Y-m-d":"month"==t.dateType?t.submitFormat="Y-m":t.submitFormat="Y-m-d H:i:s"),JE.isNotEmpty(t.configInfo)){var e=t.configInfo.split(",");t.format=Ext.value(e[0],""),"date"==t.dateType&&(t.multiSelect="M"==e[1])}t.format=Ext.value(t.format,t.submitFormat),t.callParent(arguments),t.onTrigger2Click=t.onTriggerClick=function(){if(t.fireEvent("expand",t),!t.readOnly){var e=t.getEl();JE.vue.dtPicker({params:{isShow:!0,type:t.dateType,displayColor:"#386bd0",color:"#386bd0",trigger:e.dom,date:t.getValue()?new Date(new Date(Date.parse(t.getValue().replace(/-/g,"/"))).getTime()):void 0,time:t.getValue()?new Date(new Date(Date.parse(t.getValue().replace(/-/g,"/"))).getTime()):void 0},callback:function(e){t.setValue(e)}})}},t.onTrigger1Click=function(){t.reset(),t.fireEvent("reset",t)}},createPicker:function(){return"date"==this.dateType?this.createDatePicker():"month"==this.dateType?this.createMonthPicker():this.createTimePicker()},createDatePicker:function(e){var t=this,i=Ext.String.format;return Ext.create("JE.core.ux.form.datetime.DatePicker",{pickerField:t,multiSelect:t.multiSelect,ownerCt:t.ownerCt,renderTo:document.body,showTimes:e,floating:!0,hidden:!0,focusOnShow:!0,minDate:t.minValue,maxDate:t.maxValue,disabledDatesRE:t.disabledDatesRE,disabledDatesText:t.disabledDatesText,disabledDays:t.disabledDays,disabledDaysText:t.disabledDaysText,format:t.format,showToday:t.showToday,startDay:t.startDay,minText:i(t.minText,t.formatDate(t.minValue)),maxText:i(t.maxText,t.formatDate(t.maxValue)),listeners:{scope:t,select:t.onSelect},keyNavConfig:{esc:function(){t.collapse()}}})},createTimePicker:function(){return this.createDatePicker(!0)},createMonthPicker:function(){return Ext.create("JE.core.ux.form.datetime.MonthPicker",{renderTo:document.body,floating:!0,shadow:!0,height:"plus"==JE.getTheme()?220:200,listeners:{scope:this,cancelclick:this.onCancelClick,okclick:this.onOkClick,yeardblclick:this.onOkClick,monthdblclick:this.onOkClick}})},onOkClick:function(e,t){var i=t[0],a=t[1],n=new Date(a,i,1);this.setValue(n),this.onCancelClick()},onCancelClick:function(){this.picker.hide(),this.isExpanded=!1},afterRender:function(){this.callParent();var e=this.up("window");e&&e.on({close:function(){JE.vue.dtPicker({params:{isShow:!1}})},hide:function(){JE.vue.dtPicker({params:{isShow:!1}})}})},onExpand:function(){var i=this,e=i.getValue(),a=[];e=Ext.isEmpty(e)?new Date:(Ext.each(e.split(","),function(e){var t=Ext.Date.parse(e,i.submitFormat)||new Date;a.push(t)}),a[0]),i.picker.reset&&i.picker.reset(),i.picker.setValue("date"==i.dateType&&i.multiSelect?a:e,i.multiSelect),i.fireEvent("selfexpand",i)},getValue:function(){var t=this,e="",i=[],a=[];return JE.isNotEmpty(t.defValue)&&!Ext.isString(t.defValue)&&(Ext.isArray(t.defValue)?a=t.defValue:a.push(t.defValue),Ext.each(a,function(e){i.push(Ext.Date.format(e,t.submitFormat))}),e=i.join(",")),e},setValue:function(e){var t=this,i=[];if(JE.isNotEmpty(e)&&(Ext.isArray(e)?i=e:Ext.isString(e)?Ext.each(e.split(","),function(e){i.push(Ext.value(Ext.Date.parse(e,t.submitFormat),new Date))}):Ext.isDate(e)&&i.push(e),!Ext.isDate(e))){var a=[];Ext.each(i,function(e){a.push(Ext.Date.format(e,t.format))}),e=a.join(",")}t.defValue=i,t.callParent(arguments),t.setCellValue()},getSubmitValue:function(){return this.getValue()},beforeBlur:function(){var e=this.defValue,t=this.focusTask;t&&t.cancel(),this.editable?this.setValue(this.inputEl.dom.value):e&&this.setValue(e)},onSelect:function(e,t,i){1!=i&&("date"!=this.dateType||this.multiSelect)||(this.setValue(t),this.collapse()),this.fireEvent("select",this,t)},rawToValue:function(e){return this.parseDate(e)||e||null},valueToRaw:function(e){var t=this.parseDate(e);return Ext.isEmpty(t)?e:this.formatDate(t)},getErrors:function(e){return"date"==this.dateType&&this.multiSelect?this.superclass.superclass.getErrors.call(this,e):this.callParent(arguments)},setCellValue:function(){if(this.ownerCt&&"editor"==this.ownerCt.xtype){var e=this.ownerCt.grid.getSelectionModel().getSelection()[0];e&&e.set(this.name,this.getValue())}}}),Ext.define("JE.core.ux.form.datetime.RangeDate",{extend:"Ext.form.field.Trigger",alias:"widget.rangedatefield",trigger1Cls:Ext.baseCSSPrefix+"form-clear-trigger",trigger2Cls:Ext.baseCSSPrefix+"form-date-trigger",editable:!1,format:"Y-m-d",submitFormat:"Y-m-d",enableClick:!0,initComponent:function(){JE.vue.dtPicker({params:{isShow:!0}});var s=this;if(s.localLang=JE.getLocalLang("core.ux.datetime"),s.addEvents("reset"),Ext.Date.dayNames=s.localLang.dayNames,s.separator=Ext.value(s.separator,s.localLang.separator),JE.isNotEmpty(s.configInfo)){var e=s.configInfo.split(",");JE.isNotEmpty(e[0])&&(s.format=e[0]),JE.isNotEmpty(e[1])&&(s.separator=e[1])}s.onTrigger2Click=function(){var e=[];if(s.otherConfig&&"timerange"===JSON.parse(s.otherConfig).dateType){var t=(new Date).getFullYear()+"-"+(new Date).getMonth()+"-"+(new Date).getDate();e.push(t+" "+s.getRangeValue()[0]),e.push(t+" "+s.getRangeValue()[1])}else e=s.getRangeValue();var i=s.getEl();JE.vue.dtPicker({params:{isShow:!0,type:s.otherConfig?JSON.parse(s.otherConfig).dateType:"daterange",value:e,trigger:i.dom},callback:function(e){var t="";if(s.otherConfig&&"timerange"===JSON.parse(s.otherConfig).dateType){var i=e[0].getHours(),a=e[1].getHours(),n=e[0].getMinutes(),o=e[1].getMinutes(),r=e[0].getSeconds(),l=e[1].getSeconds();i<10&&(i="0"+i),a<10&&(a="0"+a),n<10&&(n="0"+n),o<10&&(o="0"+o),r<10&&(r="0"+r),l<10&&(l="0"+l),t=i+":"+n+":"+r+s.separator+a+":"+o+":"+l}else t=e[0]+s.separator+e[1];s.setValue(t)}})},s.callParent(arguments)},onTrigger1Click:function(){this.reset(),this.fireEvent("reset",this)},collapseIf:function(e){this.isDestroyed||e.within(this.bodyEl,!1,!0)||e.within(this.rangePanel.el,!1,!0)||this.rangePanel.hide()},selectToday:function(e){var t=this.rangePanel.items.get(0);"end"==e&&(t=this.rangePanel.items.get(1));var i=new Date;"datetime"!=this.dateType&&(i=Ext.Date.clearTime(i)),t.setValue(i),t.fireEvent("select",t,t.value),t.handler&&t.handler.call(t,t,t.value)},onOkClick:function(e,t){var i=this,a=i.rangePanel.items.get(0).getValue(),n=Ext.value(i.rangePanel.items.get(1).getValue(),a);if(a.getTime()>n.getTime())JE.msg("开始时间不能大于结束时间！");else{var o=Ext.Date.format(a,i.format),r=Ext.Date.format(n,i.format);t=o+i.separator+r;if(i.setValue(t),i.ownerCt.editingPlugin){var l=i.ownerCt.editingPlugin.context.record;l&&l.set(i.name,t)}i.onCancelClick()}},onCancelClick:function(){this.rangePanel.hide()},afterRender:function(){this.callParent(),this.inputEl.on("click",this.onTrigger2Click);var e=this.up("window");e&&e.on({close:function(){JE.vue.dtPicker({params:{isShow:!1}})},hide:function(){JE.vue.dtPicker({params:{isShow:!1}})}})},getRangeValue:function(){var e=this.getValue(),t=[];if(!Ext.isEmpty(e)){var i=e.split(this.separator),a=i[0],n=i[1];t.push(a),t.push(n)}return t},setValue:function(){this.callParent(arguments),this.setCellValue()},setCellValue:function(){if(this.ownerCt&&"editor"==this.ownerCt.xtype){var e=this.ownerCt.grid.getSelectionModel().getSelection()[0];e&&e.set(this.name,this.getRangeValue())}}}),Ext.define("JE.core.ux.form.DisplayField",{extend:"Ext.form.field.Display",alias:["widget.uxdisplayfield"],submitValue:!1,initComponent:function(){var e=this;0<e.height&&(e.fieldStyle=Ext.value(e.fieldStyle,"")+"height:"+e.height+"px"),"x-form-display-field"!=e.fieldCls&&(e.fieldCls=Ext.value(e.fieldCls,"")+" x-form-display-field"),e.fieldBodyStyle=e.meBodyStyle+Ext.value(e.fieldBodyStyle,""),Ext.isEmpty(e.configInfo)||(e.displayTpl=new Ext.XTemplate(e.configInfo)),e.callParent(arguments)},updateTpl:function(e){if(this.displayTpl){var t=this.displayTpl.apply(e);this.setValue(t)}},setRawValue:function(e){return e=Ext.value(e,""),this.rawValue=e,this.rendered&&this.inputEl&&(this.inputEl.dom.innerHTML=this.getDisplayValue(),this.updateLayout()),e}}),Ext.define("JE.core.ux.form.File",{extend:"Ext.form.field.Trigger",alias:["widget.uxfilefield","widget.uxfileuploadfield"],editable:!1,trigger1Cls:Ext.baseCSSPrefix+"form-clear-trigger",trigger2Cls:"x-form-file-trigger",baseFile:{path:"",name:""},removeUrl:JE.getUrlMaps("je.core.doc.document","removeFormFiles"),initComponent:function(){var e=this;e.localLang=JE.getLocalLang("core.ux.uxfilefield"),e.addEvents("reset");var t=Ext.value(e.configInfo,"").split(",");e.fileType=Ext.value(t[2],"file"),e.displayField=t[0],e.displayFill=t[1],e.otherConfig=Ext.value(JE.toObj(e.otherConfig),{}),e.hideTrigger="1"==e.otherConfig.triggerIcon,e.enableClick="1"!=e.otherConfig.enableClick,e.callParent(arguments)},afterRender:function(){var n=this;n.callParent(arguments),n.inputEl.setStyle({textDecoration:"underline",color:"blue"}),n.inputEl.dom.name="",n.inputEl.on("mouseover",function(){var e=n.inputEl.dom,t="1"==e.getAttribute("powerTip");if(Ext.isEmpty(n.baseFile.path))t&&(jQuery.powerTip.destroy(e),e.setAttribute("powerTip","0"),e.removeAttribute("title"));else if(!t){var i="<span onclick=\"JE.File.doAct('download','"+n.id+"','"+n.tableName+"')\">下载</span>",a="|<span onclick=\"JE.File.doAct('preview','"+n.id+"','"+n.tableName+"')\">预览</span>";"0"==n.otherConfig.download&&(i=""),"0"==n.otherConfig.preview&&(a=""),e.setAttribute("title",i+a),e.setAttribute("powerTip","1"),jQuery(e).powerTip({placement:"sw-alt",popupClass:"powertip powertip-file",mouseOnToPopup:!0,autoShow:!0})}}),n.createFileInput()},onTrigger1Click:function(){var i=this;if(Ext.isEmpty(i.baseFile.path))return i.reset(),void i.fireEvent("reset",i);JE.confirm(i.localLang.removeConfirm,function(e){if("ok"==e){var t={};1==(t=i.removeFn?i.removeFn(i):JE.ajax({url:i.removeUrl,params:{tableCode:"JE_CORE_DOCUMENT",DOCUMENT_ADDRESS:i.baseFile.path,beanTableCode:i.tableName}})).success?JE.msg(i.localLang.removeOkMsg):JE.error(t.obj,data),i.reset(),i.fireEvent("reset",i)}})},onTrigger2Click:function(){Ext.isIE9m||this.fileInputEl.dom.click()},createFileInput:function(){var e=this;e.fileInputEl&&e.fileInputEl.remove();var t=e.triggerEl.item(1),i=t.parent().getBox();e.fileInputEl=t.insertSibling({name:e.getName(),id:e.id+"-fileInputEl",tag:"input",type:"file",style:"position: absolute;height:"+i.height+"px;width:"+i.width+"px; opacity:0;filter:alpha(opacity=0);cursor: pointer;"}),e.fileInputEl.on({scope:e,change:e.onFileChange}),Ext.isIE9m?e.fileInputEl.setVisible(!e.readOnly):e.fileInputEl.hide()},createImgInput:function(){var e=this.configInfo;if(!Ext.isEmpty(e)){this.imgEl&&this.imgEl.remove();var t,i=e.split(","),a=(i[2],Ext.value(i[1],""));t="<img src ='' "+(Ext.isEmpty(a.split("*")[0])?"":" width = '"+a.split("*")[0]+"%'")+" "+(Ext.isEmpty(a.split("*")[1])?"":" height = "+a.split("*")[1])+" >",this.imgEl=this.bodyEl.insertHtml("afterBegin",t,!0)}},onFileChange:function(){var e=this,t=e.fileInputEl.dom.value;if(JE.isNotEmpty(t)){var i=t.substring(t.lastIndexOf(".")+1,t.length);if(JE.isNotEmpty(e.otherConfig.allow)&&-1==e.otherConfig.allow.toUpperCase().split(",").indexOf(i.toUpperCase()))return JE.alert(JE.format(e.localLang.allowFileAlert,e.otherConfig.allow)),!1;if(JE.isNotEmpty(e.otherConfig.notallow)&&-1!=e.otherConfig.notallow.toUpperCase().split(",").indexOf(i.toUpperCase()))return JE.alert(JE.format(e.localLang.noAllowFileAlert,e.otherConfig.notallow)),!1}e.lastValue=null,e.superclass.setValue.call(e,e.fileInputEl.dom.value),e.doPreviewImage("local")},getValue:function(){return this.baseFile.name+"*"+this.baseFile.path},setValue:function(e){this.inputEl;var t=Ext.value(e,"").split("*");this.baseFile={name:Ext.value(t[0],""),path:Ext.value(t[1],"")},this.doPreviewImage(),this.superclass.setValue.call(this,this.baseFile.name)},setReadOnly:function(e){this.callParent(arguments),Ext.isIE9m&&this.fileInputEl&&this.fileInputEl.setVisible(!e)},reset:function(){this.rendered&&(this.createFileInput(),this.inputEl.dom.value=""),this.callParent()},restoreInput:function(){this.reset()},isFileUpload:function(){return!0},extractFileInput:function(){var e=this.fileInputEl.dom;return this.reset(),e},onDestroy:function(){Ext.destroyMembers(this,"fileInputEl"),this.callParent()},doPreviewImage:function(e){var t=this;if(!Ext.isEmpty(t.displayField)&&!Ext.isEmpty(t.formCode)){var i=t.formObj;if(i){var a=i.form.findField(t.displayField),n="";if(a){var o=Ext.value(a.bodyEl.getBox(),{}),r={padding:"0px",height:(l=0<o.height?o.height:a.height)+"px",textAlign:"center",overflow:"hidden"};if(JE.isNotEmpty(t.displayFill))if("fill"==t.displayFill)n="width:100%;height:100%;";else{var l,s=t.displayFill.split("*"),d=s[0];n="width:"+d+"px;height:"+d+"px;",n+="position: absolute;top:50%;left:50%;margin-top:-"+(l=s[1])/2+"px;margin-left:-"+d/2+"px;"}else n+="vertical-align: middle;",r.lineHeight=l-4+"px";if(a.inputEl.setStyle(r),"local"==e)JE.previewImage(t.fileInputEl.dom,a.inputEl.dom,n);else{var c='<img src="'+JE.getFileUrl(t.baseFile.path,"","","",t.tableName)+'" alt = "'+t.baseFile.name+'" style="'+n+'">';Ext.isEmpty(t.baseFile.path)&&(c=""),a.inputEl.dom.innerHTML=c}}}}}}),Ext.define("JE.core.ux.form.Files",{extend:"Ext.form.FieldContainer",alias:["widget.uxfilesfield","widget.uxfilesuploadfield"],mixins:["Ext.form.field.Field"],isFormField:!0,allowBlank:!0,layout:"fit",filesIcon:"big",filesToolbar:"show",noHeight:!1,fileTypes:"*",fileLimit:0,fileCount:0,hideFiles:!1,initComponent:function(){var i=this;if(i.addEvents("beforebuttonaction"),i.localLang=JE.getLocalLang("core.ux.uxfilesfield"),i.configInfo){var e=i.configInfo.split(",");i.fileCount=JE.toNum(Ext.value(e[1],i.fileCount)),i.fileTypes=Ext.value(e[0],i.fileTypes)}var t=[];Ext.each(Ext.value(i.fileTypes,"*").split(";"),function(e){t.push("*."+e)}),i.fileTypes=t.join(";"),i.otherConfig=Ext.value(i.otherConfig,{}),Ext.isString(i.otherConfig)&&(i.otherConfig=JE.decode(i.otherConfig)),JE.isNotEmpty(i.otherConfig.filesize)&&(i.fileSizeLimit=JE.toNum(i.otherConfig.filesize)),i.value=Ext.value(i.value,[]),!i.noHeight&&i.height<1&&(i.height=400),i.items={xtype:"panel",layout:"fit",itemId:"filespanel",cls:"je-field-uxfilesfield"+("hide"==i.filesToolbar?" hide-toolbar":""),minHeight:i.minHeight,tbar:{xtype:"toolbar",itemId:"tbarBtns",padding:"5px 0 5px 2px",hidden:"hide"==i.filesToolbar,defaults:{listeners:{beforeclick:function(e){return i.fireBeforeButtonActon(e)}}},items:[{text:i.updateBtnText||i.localLang.upload,iconCls:"fa fa-plus",iocnStyle:"color:red",editBtn:!0,itemId:"upload",scope:i,handler:i.doUploadFiles},{text:i.localLang.files,editBtn:!0,itemId:"files",iconCls:"fa fa-database",scope:i,handler:i.doSelectFiles},{text:i.localLang.companyFiles,editBtn:!0,itemId:"companyFiles",iconCls:"fa fa-database",scope:i,fileMode:"COMPANY",handler:i.doSelectFiles},{text:i.localLang.downLoadAll,itemId:"downloadAll",iconCls:"fa fa-download",scope:i,handler:function(e){i.doDownloadFiles(!1)}},{text:i.localLang.moveToDocFiles,itemId:"moveFiles",iconCls:"fa fa-share-square-o",handler:function(){var e=i.filesview.getSelectionModel().getSelection();0<e.length?i.addDocFiles(e):JE.alert(i.localLang.alert.selectFile)}},{text:i.localLang.removeAll,itemId:"removeAll",editBtn:!0,scope:i,iconCls:"fa fa-trash",handler:i.doRemoveFiles}],listeners:{afterrender:function(e,t){i.setItemsVisible(this)}}},items:i.buildFilesView()},i.reportField&&(i.layout="auto",i.items.width=i.width,i.items.height=i.height,i.items.tbar.height=26,i.items.tbar.layout="column"),i.useFormStyle&&(i.items.border=0,i.items.margin="0 1 0 0"),i.callParent(arguments),i.filesview=i.getCmp("filespanel").getCmp("filesview"),i.initField(),i.readOnly&&i.setReadOnly(!0)},fireBeforeButtonActon:function(e){var t=this.filesview.getSelectionModel().getSelection();if(JE.File.checkFilePerm){var i=[];return Ext.each(t,function(e){i.push(e.data)}),JE.File.checkFilePerm(e.itemId,t,this.funcCode)}if(this.hasListener("beforebuttonaction"))return this.fireEvent("beforebuttonaction",this,e,t)},setReadOnly:function(e){e=Ext.value(e,!1);this.readOnly=e,this.setNoEdit(e)},onEnable:function(){this.callParent(arguments),this.setNoEdit(!1)},onDisable:function(){this.callParent(arguments),this.setNoEdit(!0)},setNoEdit:function(t){var i=this;i.getCmp("filespanel").getDockedCmp("tbarBtns").items.each(function(e){e.editBtn&&e.setDisabled(t)}),i.menu.items.each(function(e){e.editBtn&&e.setDisabled(i.readOnly||i.disabled)})},doChange:function(e){var t=this.filesview.getEl();if(t){var i=this.getValue();t[(e=Ext.value(e,this.value!=i))?"addCls":"removeCls"]("x-form-dirty")}},getSubmitData:function(){var e=null;return this.disabled||(this.doChange(!1),(e={})[this.getName()]=this.getValue()),e},reset:function(){this.callParent(arguments),this.doChange(!1)},getValue:function(){var e=this.getData();return JE.toStr(e)},setValue:function(e){e=Ext.value(e,"[]"),this.value=e,this.setData(this.value)},setData:function(e){var t=this.filesview;Ext.isString(e)&&(e=JE.toObj(e)),JE.isNotEmpty(e)?t.store.loadData(e):t.store.reload()},getData:function(){var e=this.filesview,t=[];return e.store.each(function(e){t.push(e.data)}),t},buildFilesView:function(){var d=this;d.menu=Ext.create("Ext.menu.Menu",{items:[{text:d.localLang.see,iconCls:"fa fa-search",itemId:"preview",handler:function(){var e=d.filesview.getSelectionModel().getSelection();if(1<e.length)JE.alert(d.localLang.alert.selectOneFile);else{var t=e[0],i=new Array;d.filesview.store.each(function(e){i.push({id:e.get("id"),name:e.get("name"),path:e.get("path")})}),JE.File.openFileByPath(t.get("path"),t.get("name"),!0,i,null,"doc",t.get("id"),d.tableName)}}},{text:d.localLang.open,iconCls:"fa fa-map-o",itemId:"openFile",handler:function(){var e=d.filesview.getSelectionModel().getSelection(),t=d.up("jeformview"),i={};if(t&&(i=t.form.getValues()),1<e.length)JE.alert(d.localLang.alert.selectOneFile);else{var a=e[0],n=new Array;d.filesview.store.each(function(e){n.push({id:e.get("id"),name:e.get("name"),path:e.get("path")})});var o=Ext.applyIf(Ext.clone(d.otherConfig),{}),r=Ext.value(o.user_id,"");JE.isNotEmpty(r)&&(r=JE.toXT(r,i)),o.user_id=r,JE.File.openFileByPath(a.get("path"),a.get("name"),!1,n,o,"doc",a.get("id"),d.tableName)}}},{text:d.localLang.downLoad,iconCls:"fa fa-arrow-circle-down",itemId:"download",handler:function(){var e=d.filesview.getSelectionModel().getSelection();if(1<e.length)JE.alert(d.localLang.alert.selectOneFile);else{var t=e[0],i="";JE.isNotEmpty(d.tableName)&&(i="&beanTableCode="+d.tableName),window.open(JE.getUrlMaps("je.core.doc.document.download")+"?ieFlag="+(Ext.isIE?"1":"0")+"&enCode=1&fileName="+encodeURIComponent(t.get("name"))+i+"&path="+t.get("path"))}}},{text:d.localLang.downLoadZip,iconCls:"fa fa-cloud-download",itemId:"downloadZip",handler:function(e){d.doDownloadFiles(!0)}},{text:d.localLang.moveToDocFiles,iconCls:"fa fa-share-square-o",itemId:"moveFiles",handler:function(){var e=d.filesview.getSelectionModel().getSelection();0<e.length?d.addDocFiles(e):JE.alert(d.localLang.alert.selectFile)}},"-",{text:d.localLang.remove,itemId:"remove",iconCls:"fa fa-close",handler:function(){var e=d.filesview.getSelectionModel().getSelection();0<e.length?(d.filesview.store.remove(e),d.doChange()):JE.alert(d.localLang.alert.selectFile)}},{xtype:"menuseparator",tbarMenu:!0},{text:d.localLang.upload,itemId:"upload",iconCls:"fa fa-plus",scope:d,editBtn:!0,handler:d.doUploadFiles},{text:d.localLang.files,editBtn:!0,itemId:"files",iconCls:"fa fa-database",scope:d,handler:d.doSelectFiles},{text:d.localLang.companyFiles,editBtn:!0,itemId:"companyFiles",iconCls:"fa fa-database",scope:d,fileMode:"COMPANY",handler:d.doSelectFiles},{text:d.localLang.downLoadAll,iconCls:"fa fa-download",itemId:"downloadAll",scope:d,handler:function(e){d.doDownloadFiles(!1)}},{text:d.localLang.removeAll,itemId:"removeAll",iconCls:"fa fa-trash",scope:d,editBtn:!0,handler:d.doRemoveFiles},{text:d.localLang.attribute,itemId:"attribute",iconCls:"fa fa-cog",scope:d,editBtn:!0,handler:function(e){var t=d.filesview.getSelectionModel().getSelection();if(1<t.length)JE.alert(d.localLang.alert.selectOneFile);else{var i=t[0],a=JE.ajax({url:JE.getUrlMaps("je.core.getInfoById"),params:{tableCode:"JE_CORE_DOCUMENT",pkValue:i.get("id")}});0!=a.success?JE.formWin({title:"文件信息",width:600,height:230,border:0,frame:!1,autoShow:!0,useButton:!1,iconCls:a.DOCUMENT_ICONCLS,formConfig:{bodyPadding:"10 10 0 10",bodyStyle:{background:"#f1f1f1"}},defaults:{xtype:"textfield",columnWidth:.5,readOnly:!0,padding:"3 0 3 0"},items:[{name:"DOCUMENT_DOCNAME",allowBlank:!1,fieldLabel:"文件名称"},{name:"DOCUMENT_FILETYPENAME",fieldLabel:"文件类型"},{xtype:"uxfilefield",name:"DOCUMENT_ADDRESS",columnWidth:1,fieldLabel:"地址"},{name:"DOCUMENT_DOCSIZE",fieldLabel:"文件大小",unitTpl:"(字节)"},{name:"SY_CREATETIME",fieldLabel:"上传时间"},{name:"SY_CREATEUSERNAME",fieldLabel:"上传人"},{name:"SY_CREATEORGNAME",fieldLabel:"上传部门"},{xtype:"hidden",name:"DOCUMENT_PKVALUE",fieldLabel:"外键"},{xtype:"hidden",name:"JE_CORE_DOCUMENT_ID",fieldLabel:"主键"}],showFn:function(e){e.down("form").form.setValues(a)}}):JE.alert("保存后可查看!")}}}],listeners:{show:function(e,t){d.setItemsVisible(this)}}}),d.menu.items.each(function(e){"menuitem"==e.xtype&&e.on("beforeclick",function(e){return d.fireBeforeButtonActon(e)})});var e={xtype:"dataview",autoScroll:!0,itemId:"filesview",plugins:[Ext.create("JE.core.ux.DragSelector",{})],multiSelect:!0,overItemCls:"",trackOver:!0,border:0,selectedItemCls:"x-dataview-item-selected",itemSelector:"div.file",emptyText:"",store:Ext.create("Ext.data.Store",{fields:["name","path","cls","id","extend"],data:[]}),listeners:{itemdblclick:function(e,t,i,a,n,o){(i=d.menu.getCmp("preview")).isHidden()||0!=i.fireEvent("beforeclick",i)&&i.handler()},containercontextmenu:function(e,t){t.stopEvent(),d.menu.items.each(function(e){if(e.tbarMenu)return e.hide(),!1;e.hide()}),d.menu.showAt(t.getXY())},itemcontextmenu:function(e,t,i,a,n,o){n.stopEvent();var r=e.getSelectionModel(),l=r.getSelection(),s=!0;Ext.each(l,function(e){if(e==t)return s=!1}),s&&r.select(t),d.menu.items.each(function(e){e.show()}),d.menu.showAt(n.getXY())}}};return"small"==d.filesIcon?e.tpl=['<tpl for=".">','<div class="file small" title="{name}"><div class="icon {[this.setListstyle(values).icon]}" style="font-size:32px;color:{[this.setListstyle(values).color]}"></div>','<div class="text">{[this.ellipsis(values.name)]}</div>',"</div>","</tpl>"]:e.tpl=['<tpl for=".">','<div class="file" title="{name}">','<div class="icon {[this.setListstyle(values).icon]}" style="font-size:32px;color:{[this.setListstyle(values).color]}"></div>','<div class="text">{[this.ellipsis(values.name)]}</div>',"</div>","</tpl>"],e.tpl.push({setListstyle:function(e){return JE.getFileIcon(e.path)},ellipsis:function(e){return 14<e.length?e.substring(0,10)+"...":e}}),e},setItemsVisible:function(a){this.otherConfig=this.otherConfig||{},this.otherConfig.files=this.otherConfig.files||"1"==JE.systemConfig.JE_FILES_HIDEFILES?"0":"",this.otherConfig.companyFiles=this.otherConfig.companyFiles||"1"==JE.systemConfig.JE_FILES_HIDECOMPANYFILES?"0":"",this.otherConfig.moveFiles=this.otherConfig.moveFiles||"1"==JE.systemConfig.JE_FILES_HIDEMOVEFILES?"0":"",Ext.iterate(this.otherConfig,function(e,t){var i=a.getCmp(e);i&&i.setVisible("0"!=t)})},doUploadFiles:function(){var o=this,e=o.fileLimit;if(0<o.fileCount&&(e=o.fileCount-o.getData().length)<=0)JE.alert(JE.format(o.localLang.alert.fileCount,o.fileCount));else{var t=o.formObj,i="";t&&t.funcData&&(i=t.form.findField(t.funcData.info.pkName).getValue());var a={jeFileType:o.jeFileType||"PROJECT",filePath:"/filestem",beanTableCode:o.tableName,tableCode:o.tableName,funcCode:o.funcCode,pkValue:i};JE.win({title:o.localLang.uploadTitle,width:800,height:600,items:{xtype:"uploadpanel",file_types:o.fileTypes,file_size_limit:o.fileSizeLimit,file_upload_limit:e,upload_url:JE.getUrlMaps("je.core.doc.document","uploadFile")+"?login=TRUE",file_post_name:"formUploadFiles",post_params:a,failure:function(e,t,i){JE.error(t+"\n"+i)},success:function(e,t,i){var a=Ext.isString(t)?Ext.decode(Ext.value(t,"{}")):t||{};if(1==a.success){var n=a.obj;o.filesview.store.add({id:"",name:n.DOCUMENT_DOCNAME,cls:n.DOCUMENT_ICONCLS,path:n.DOCUMENT_ADDRESS,extend:n.DOCUMENT_THUMBNAILCLS}),o.doChange()}else JE.error(t.message,t)}}}).show()}},doSelectFiles:function(e){var a=this,t=Ext.value(e.fileMode,"USER");JE.win({title:a.localLang.selectFilesTitle,useButton:!0,autoShow:!0,items:{xtype:"documentation.mainview",fileMode:t,noDnd:!0,readOnly:!0},border:0,fn:function(e){var t;e.down("panel[xtype=documentation.filedataview]").items.each(function(e){e.isHidden()||(t=e)});var i=t.getSelectionModel().getSelection();0<i.length&&(Ext.each(i,function(e){"DIR"!=e.get("DOCUMENTATION_TYPE")&&a.filesview.store.add({id:"",name:e.get("DOCUMENTATION_TEXT"),cls:e.get("DOCUMENTATION_ICONCLS"),path:e.get("DOCUMENTATION_ADDRESS"),extend:e.get("DOCUMENTATION_THUMBNAILCLS")})}),a.doChange())}})},doDownloadFiles:function(e){var t=new Array;if(e?Ext.each(this.filesview.getSelectionModel().getSelection(),function(e){t.push({name:e.get("name"),path:e.get("path")})}):this.filesview.store.each(function(e){t.push({name:e.get("name"),path:e.get("path")})}),0<t.length){var i=this.jeFileType||"PROJECT",a="";JE.isNotEmpty(this.tableName)&&(a="&beanTableCode="+this.tableName),window.open(JE.getUrlMaps("je.core.doc.document.downLoadFiles")+"?strData="+encodeURIComponent(Ext.encode(t))+a+"&jeFileType="+i)}else JE.alert(this.localLang.alert.noFileDownLoad)},doRemoveFiles:function(){var t=this;JE.confirm("确认清空吗?",function(e){"ok"==e&&(t.filesview.store.removeAll(),t.doChange())})},addDocFiles:function(o){var r=this;JE.selectWin({parent:null,parentType:"self",title:r.localLang.addDocFilesTitle,configInfo:"JE_SYS_DOCUMENTATION",whereSql:" AND SY_CREATEUSER='"+JE.currentUser.userCode+"' AND DOCUMENTATION_FILEMODE='USER'",type:"tree",treeConfig:{rootVisible:!0,listeners:{afterrender:function(e){var t=e.getRootNode();t.set("text",r.localLang.docFilesRootText),t.set("iconCls","jeicon jeicon-folders"),t.commit()}}},callback:function(e,t){if(e){if(!e[0])return JE.alert(r.localLang.alert.docFilesMove),!1;var i=e[0],a=new Array;Ext.each(o,function(e){a.push({name:e.get("name"),path:e.get("path")})});var n=JE.ajax({url:JE.getUrlMaps("je.core.doc.documentation","doSaveFile"),params:{strData:JE.toStr(a),tableCode:"JE_SYS_DOCUMENTATION",DOCUMENTATION_FILEMODE:"USER",SY_PATH:i.getPath(),SY_LAYER:i.get("layer")+1,SY_PARENT:i.get("id"),SY_NODETYPE:"LEAF",DOCUMENTATION_FILEMODE:"USER"}});if(!n.success)return JE.alert(n.obj),!1;JE.msg(n.obj)}}})}}),Ext.define("JE.core.ux.form.FilesUploadSet",{extend:"Ext.form.FieldSet",collapsible:!0,collapsed:!1,layout:"column",alias:["widget.filesset"],initComponent:function(){var o=this;o.localLang=JE.getLocalLang("core.ux.filesset");var i=o.formObj,a=i.funcData.info,n=a.tableName;o.listeners={afterrender:function(){i.doLayout(),i.getFormBox().doLayout()}};var e={border:0,layout:"column",columnWidth:1,itemId:"fileaction",items:[{xtype:"label",itemId:"fileuploadLabel",text:o.localLang.title,width:60,margin:"0 0 0 10",style:"text-decoration:underline;color:blue;cursor:pointer;",listeners:{afterrender:function(e){e.getEl().on("click",function(){var e=i.form.findField(a.pkName).getValue();Ext.isEmpty(e)?JE.alert(o.localLang.saveFormAlert):JE.win({title:o.localLang.title,width:800,height:600,items:{xtype:"uploadpanel",upload_url:JE.isEmpty(a.funcAction)?JE.getUrlMaps("je.core.doc.document","doUploadFuncFile")+"?login=TRUE":a.funcAction+"/doUploadFuncFile",file_post_name:"formUploadFiles",post_params:{pkValue:e,tableCode:a.tableName,funcCode:a.funcCode,beanTableCode:a.tableName},failure:function(e,t,i){JE.error(t+"\n"+i)},success:function(e,t,i){var a=Ext.decode(Ext.value(t,"{}"));if(1==a.success){var n=o.getComponent("filelist");n.getEl().createChild(n.tpl.apply(a.obj)),o.doLayout()}else JE.error(t,t)}}}).show()})}}},{xtype:"label",text:o.localLang.downLoadAllText,width:60,style:"text-decoration:underline;color:blue;cursor:pointer;",listeners:{afterrender:function(e){e.getEl().on("click",function(){var e=i.form.findField(a.pkName).getValue();if(!Ext.isEmpty(e)){var t=JE.getUrlMaps("je.core.doc.document","downLoadZIP");window.open(t+"?DOCUMENT_TABLECODE="+a.tableName+"&pkValue="+e)}})}}}]},t={xtype:"box",columnWidth:1,itemId:"filelist",padding:"10 5 5 5",tpl:['<tpl for=".">',"<table width=200 height=50 class=table-files style='float:left;'>","<tr>","<td rowspan=2 width=50>{[this.getFile(values)]}</td>","<td>{DOCUMENT_DOCNAME}</td>","</tr>","<tr>","<td align = left>","<i class='fa fa-search' name= download style='cursor:pointer;color:#386bd0;' onclick='{[this.openClick(values)]}'></i>","&nbsp;","<i class='jeicon jeicon-download-recently' name= download style='cursor:pointer;margin:0px 5px;color:#239F75;' onclick='{[this.downClick(values)]}'></i>","&nbsp;","<i class='jeicon jeicon-error' name= remove style='cursor:pointer;color: #db4c3f;' onclick=\"{[this.removeClick(values)]}\" ></i>","</td>","</tr>","</table>","</tpl>",{getFile:function(e){return JE.getFileThumbnail(e,{width:"48",height:"48",styleConfig:"DOCUMENT_THUMBNAILCLS",imgUrl:"DOCUMENT_PRIVATEKEY",imgCdnUrl:"DOCUMENT_ADDRESS",imgName:"DOCUMENT_TEXT",icon:"DOCUMENT_ICONCLS",imgType:"docinfo",tableCode:"JE_SYS_DOCUMENTATION"})},formatFile:function(e){var t=Ext.value(e,".null"),i=(t=t.substring(t.lastIndexOf(".")+1,t.length)).toLowerCase();return-1==["doc","docx","gif","jpeg","icon","jpg","pdf","ppt","pptx","xls","xlsx","zip","txt"].indexOf(i)&&(i="null"),i},downClick:function(e){var t=JE.getUrlMaps("je.core.doc.document","download"),i="&beanTableCode="+n;return"("+('function(down){window.open("'+t+"?ieFlag="+(Ext.isIE?"1":"0")+"&enCode=1&fileName="+encodeURIComponent(e.DOCUMENT_DOCNAME)+i+"&path="+e.DOCUMENT_ADDRESS+'")}')+")(this)"},openClick:function(e){return"("+('function(down){JE.File.openFileByPath("'+e.DOCUMENT_ADDRESS+'","'+e.DOCUMENT_DOCNAME+'",true,null,"doc","'+e.JE_CORE_DOCUMENT_ID+'","'+n+'")}')+")(this)"},removeClick:function(e){return"("+("function(remove){var obj = JE.ajax({url : '/je/doc/document/removeFormFiles',params : {DOCUMENT_ADDRESS : '"+e.DOCUMENT_ADDRESS+"',tableCode:'JE_CORE_DOCUMENT',beanTableName:'"+n+"'}});if(obj.success){var table=remove.parentNode.parentNode.parentNode.parentNode;table.parentNode.removeChild(table);JE.msg('删除成功!');}else{JE.error(obj.obj,'/je/doc/document/removeFormFiles');}}")+")(this)"}}]};o.items=[e,t],o.callParent(arguments)},loadFiles:function(){var e=this.formObj,t=e.funcData.info,i=e.form.findField(t.pkName).getValue(),a=this.getComponent("filelist");if(Ext.isEmpty(i))a.update([]);else{var n=JE.ajax({url:JE.getUrlMaps("je.core.doc.document","loadFormFiles"),params:{whereSql:" and  DOCUMENT_TABLECODE = '"+t.tableName+"' AND DOCUMENT_PKVALUE = '"+i+"' and  DOCUMENT_FIELDCODE = 'formUploadFiles' AND DOCUMENT_TYPE='FUNC'",tableCode:"JE_CORE_DOCUMENT",limit:-1}});0<n.rows.length?a.update(n.rows):a.update([])}},setReadOnly:function(e){e=Ext.value(e,!1);var t=this.getComponent("fileaction").getComponent("fileuploadLabel"),i=this.getComponent("filelist");t[e?"hide":"show"](),i.getEl().select("img[name=remove]")[e?"hide":"show"]()}}),Ext.define("JE.core.ux.form.FormPagingBar",{extend:"Ext.toolbar.Toolbar",alias:"widget.formpagingbar",initComponent:function(){var e=this;e.localLang=JE.getLocalLang("core.ux.formpagingbar"),e.vertical=!0,e.dataTpl=new Ext.XTemplate(e.tplStr),e.items=[{text:e.localLang.prevText,itemId:"prev",textStyle:"color:blue;text-align:left;",handler:e.prevRec,scope:e,disabled:!0},{text:e.localLang.nextText,itemId:"next",textStyle:"color:blue;text-align:left;",handler:e.nextRec,disabled:!0,scope:e}],e.callParent(arguments),e.prevBtn=e.getCmp("prev"),e.nextBtn=e.getCmp("next")},prevRec:function(e){var t=this,i=t.infoData.currentIndex-1;i<0?t.grid.store.previousPage({callback:function(e){t.loadForm(e.length-1)}}):t.loadForm(i)},nextRec:function(e){var t=this,i=t.infoData.currentIndex+1;i==t.infoData.count?t.grid.store.nextPage({callback:function(){t.loadForm(0)}}):t.loadForm(i)},loadForm:function(e){var t=this.grid,i=t.store.getAt(e);i&&(t.getSelectionModel().select([i]),t.fireEvent("itemdblclick",t.view,i))},loadInfo:function(e){var t=this,i=t.grid.store,a=i.indexOf(e);if(-1==a)t.removeInfo();else{var n=i.proxy.reader.jsonData.totalCount,o=i.pageSize,r=o<=0?1:Math.ceil(n/o);count=i.getCount(),currentPage=i.currentPage,t.infoData={currentIndex:a,totleCount:n,pageSize:o,totlePage:r,count:count,currentPage:currentPage};var l=i.getAt(a-1),s="上一条",d=!1,c=i.getAt(a+1),u="下一条",p=!1,f=Ext.apply({},i.proxy.extraParams,{limit:o});if(0==a)if(1==currentPage)d=!0;else{f.page=currentPage-1,f.start=(f.page-1)*o;var E=JE.ajax({url:i.proxy.url,params:f});l=Ext.create(i.model,E.rows[E.rows.length-1])}if(a==count-1)if(currentPage==r)p=!0;else{f.page=currentPage+1,f.start=(f.page-1)*o;E=JE.ajax({url:i.proxy.url,params:f});c=Ext.create(i.model,E.rows[0])}t.prevBtn.setDisabled(d),t.nextBtn.setDisabled(p),JE.isNotEmpty(t.tplStr)&&(l&&(s="上一条："+(s=t.dataTpl.apply(l.data))),c&&(u="下一条："+(u=t.dataTpl.apply(c.data)))),t.prevBtn.setText(s),t.nextBtn.setText(u)}},removeInfo:function(){this.prevBtn.setText("上一条"),this.nextBtn.setText("下一条"),this.prevBtn.setDisabled(!0),this.nextBtn.setDisabled(!0)}}),Ext.define("JE.core.ux.form.GraphField",{extend:"Ext.form.FieldContainer",alias:["widget.graphfield"],mixins:["Ext.form.field.Field"],isFormField:!0,allowBlank:!0,layout:"fit",height:120,editable:!0,enableSelect:!1,initComponent:function(){var n=this;n.cls=Ext.value(n.cls,"")+" je-field-graphfield",n.localLang=JE.getLocalLang("core.ux.graphfield"),n.graphPanel=Ext.create("JE.core.ux.mxgraph.Graph",{editor:Ext.create("JE.core.ux.mxgraph.util.Editor",{readOnly:!0,initEvent:function(){if(n.enableSelect){var a=this.editor.graph;a.addListener(mxEvent.CLICK,function(e,t){var i=t.getProperty("cell");n.highlight&&(n.highlight.destroy(),delete n.selectCell),i&&!i.isEdge()&&(n.selectCell=i,n.highlight=new mxCellHighlight(a,"red",3),n.highlight.highlight(a.view.getState(i)))})}}}),outline:!1}),n.items=n.graphPanel,n.callParent(arguments),n.initField()},afterRender:function(){var a=this;a.callParent(arguments);var e=Ext.value(a.ownerCt,{});if(a.labelEl&&!a.hideLabel||"fieldcontainer"==e.xtype&&e.labelEl){var t=e.labelEl||a.labelEl;"top"!=a.labelAlign&&t.appendChild({tag:"div",style:"height:10px"}),a.maxviewEl=t.appendChild({tag:"div",cls:"fullscreen "+("plus"==JE.getTheme()?"fa fa-sitemap":"je-button-icon jeicon jeicon-shenpi2-on"),style:"cursor: pointer;margin:0px 5px;display:inline-block;color:#444;font-size:12px;","data-qtip":a.localLang.editLabel}),a.maxviewEl.on("click",function(){var t=a.graphPanel.editor.getData(),i=JE.win({title:a.localLang.editTitle,autoScroll:!0,items:{xtype:"flowchart.mainview",saveAction:function(e){a.graphPanel.editor.loadData(e),i.close()},initAction:function(e){e.editor.loadData(t)}}});i.show()}),a.setReadOnly(a.readOnly)}},setReadOnly:function(e){e=Ext.value(e,!1);this.readOnly=e,this.maxviewEl&&this.maxviewEl[e?"hide":"show"]()},getValue:function(){var e=this.graphPanel.editor.getData();return e=encodeURIComponent(e)},setValue:function(e){var t=decodeURIComponent(e);Ext.isEmpty(t)&&(t='<mxGraphModel><root><mxCell id="0"/><mxCell id="1" parent="0"/></root></mxGraphModel>'),this.graphPanel.editor.loadData(t)}}),Ext.define("JE.core.ux.form.HiddenField",{extend:"Ext.form.field.Hidden",alias:"widget.uxhiddenfield",componentLayout:"autocomponent",autoEl:{tag:"div",cellpadding:0},labelableRenderTpl:["{[values.$comp.getSubTplMarkup(values)]}"],constructor:function(i){Ext.each(["Width","Height"],function(t){Ext.each(["","min","max"],function(e){delete i[e+(Ext.isEmpty(e)?t.toLowerCase():t)]})}),this.callParent([i])}}),Ext.define("JE.core.ux.form.JsonArrayField",{extend:"Ext.form.FieldContainer",alias:["widget.jsonarrayfield"],mixins:["Ext.form.field.Field"],isFormField:!0,allowBlank:!0,layout:"fit",height:120,editable:!0,rowHeight:21,headerHeight:26,defaultEditor:void 0,defaultRecordValue:void 0,columnAlign:"center",columns:void 0,actionColumnIndex:void 0,cellEditListeners:void 0,actionColumn:!0,cls:"je-formFunc-config",initComponent:function(){var a=this;a.localLang=JE.getLocalLang("core.ux.jsonfield");var i=[],n={defaults:{sortable:!1,align:Ext.value(a.columnAlign,"center"),menuDisabled:!0},items:[]};a.columns=Ext.value(a.columns,[]),a.defaultEditor=Ext.value(a.defaultEditor,{xtype:"textfield"}),Ext.each(a.columns,function(e){var t=Ext.clone(e);Ext.isEmpty(t.dataIndex)||i.push(t.dataIndex),t.field||t.editor||Ext.isEmpty(t.dataIndex)||(t.field=a.defaultEditor),t.field&&(t.field.submitValue=!1),t.editor&&(t.editor.submitValue=!1),0!=t.editable&&-1==["uxcheckcolumn","checkcolumn"].indexOf(t.xtype)||(delete t.field,delete t.editor),n.items.push(t)}),a.actionColumn&&(actionColumnIndex=Ext.value(a.actionColumnIndex,n.items.length),n.items.splice(actionColumnIndex,0,{text:'<div class="jeicon jeicon-resource-table-addition" style="width:16px;height:16px;"></div>',resizable:!1,xtype:"actioncolumn",width:30,align:"center",items:[{iconCls:"jeicon jeicon-error",handler:function(e,t,i){a.removeFn(e,t)}}],listeners:{headerclick:function(e,t){var i=a.items.get(0);a.insertFn(i)}}})),a.fields=i;var e={cls:"je-field-grid je-grid",store:Ext.create("Ext.data.Store",{fields:i}),columnLines:!0,columns:n,listeners:{beforeedit:function(e,t){return!t.grid.readOnly||!t.grid.disabled}},viewConfig:{plugins:{ptype:"gridviewdragdrop",dragText:JE.getLocalLang("common.dragText"),pluginId:"ddOrder",ddGroup:Ext.value(a.ddGroup,"GridDD")}},plugins:[Ext.create("Ext.grid.plugin.CellEditing",{clicksToEdit:1,pluginId:"cellEdit",listeners:Ext.value(a.cellEditListeners,{})})]};0==a.editable&&delete e.plugins,Ext.isEmpty(a.columns)?a.html=a.localLang.noColumnHtml:(a.grid=Ext.create("Ext.grid.Panel",e),a.grid.store.on({add:function(){a.fireEvent("change",a,a.getValue())},remove:function(){a.fireEvent("change",a,a.getValue())},update:function(e,t,i){"edit"==i&&a.fireEvent("change",a,a.getValue())}}),a.items=[a.grid]),a.callParent(arguments),a.initField(),a.readOnly&&a.setReadOnly(!0)},setReadOnly:function(e){e=Ext.value(e,!1);this.setNoEdit(e,"readOnly")},insertFn:function(e){e.store.add(Ext.value(this.defaultRecordValue,{}))},removeFn:function(e,t){e.getStore().removeAt(t)},getValue:function(){var e=this.getData();return Ext.encode(e)},setValue:function(e){var t=this.grid,i=Ext.value(e,[]);this.value=i,t&&(Ext.isEmpty(i)||Ext.isArray(e)||(i=Ext.value(JE.toObj(i),[])),t.getStore().loadData(i))},commitValue:function(){var e=this.grid;e&&e.store.commitChanges()},getData:function(){var e=this.grid,t=[];return e&&e.getStore().each(function(e){t.push(e.data)}),t},onEnable:function(){this.callParent(arguments),this.setNoEdit(!1,"disabled")},onDisable:function(){this.callParent(arguments),this.setNoEdit(!0,"disabled")},setNoEdit:function(e,t){if(this.grid){var i=this.grid.down("actioncolumn");i&&i[e?"hide":"show"](),this.grid[t]=e}}}),Ext.define("JE.core.ux.form.JsonField",{extend:"JE.core.ux.form.JsonArrayField",alias:["widget.jsonfield"],keyWidth:.3,valueWidth:.7,initComponent:function(){this.localLang=JE.getLocalLang("core.ux.jsonfield"),this.columns=this.columns||[{text:this.localLang.keyColumn,dataIndex:"key",flex:this.keyWidth},{text:this.localLang.valueColumn,dataIndex:"value",flex:this.valueWidth}],this.callParent(arguments)},getValue:function(){var e=this.grid,i={},a=0;return e.getStore().each(function(e){var t=e.data;Ext.isEmpty(t.key)||(i[t.key]=t.value,a++,e.commit())}),i=0<a?Ext.encode(i):""},setValue:function(e){var t=this.grid,i=[];Ext.isEmpty(e)||Ext.iterate(Ext.decode(e),function(e,t){i.push({key:e,value:t})}),t.getStore().loadData(i)}}),Ext.define("JE.core.ux.form.MarkField",{extend:"Ext.form.FieldContainer",mixins:["Ext.form.field.Field"],alternateClassName:["JEMarkField"],alias:"widget.markfield",isFormField:!0,allowBlank:!0,layout:"fit",initComponent:function(){var e=this;e.cls=Ext.value(e.cls,"")+" je-field-markfield",e.dataArray=Ext.value(e.dataArray,Ext.clone(JEMarkField.dataArray)),e.dataArray.push({code:"-1",color:"#CECECE",tip:"清空",cls:"clear"}),e.items={xtype:"box",itemId:"box",cls:"markbox",tpl:['<tpl for=".">','<div data-code="{code}" class="{cls} fa fa-circle <tpl if="cls==\'clear\'">fa-circle-thin </tpl>item" data-qtip="{tip}" style="color:{color}"></div>',"</tpl>"],data:e.dataArray},e.useOK&&e.items.tpl.push('<div class="item ok">OK</div>'),e.callParent(arguments),e.viewBox=e.getCmp("box"),e.initField()},okFn:Ext.emptyFn,afterRender:function(){var a=this;a.callParent(),a.viewBox.getEl().on("click",function(e){var t=e.getTarget(".item",1,!0);if(t)if(t.hasCls("clear"))a.setValue("");else if(t.hasCls("ok"))a.okFn(a);else{t[t.hasCls("checked")?"removeCls":"addCls"]("checked");var i=[];Ext.each(a.viewBox.getEl().query(".item.checked"),function(e){i.push(e.getAttribute("data-code"))}),a.setValue(i.join(","),!1)}}),JE.isNotEmpty(a.value)&&a.setValue(a.value,!0,!1)},setValue:function(e,t,i){if(this.value=Ext.value(e,""),0!=t&&this.viewBox.getEl()){var a=JE.split(e,",");Ext.each(this.viewBox.getEl().query(".item"),function(e){var t=Ext.get(e),i=t.getAttribute("data-code");"-1"!=i&&t[-1==a.indexOf(i)?"removeCls":"addCls"]("checked")})}0!=i?this.checkChange():this.lastValue=this.value},getValue:function(){return this.value},loadGrid:function(e,t){var i=e.funcData.info,a="",n=JE.split(t,","),o=[];JE.isNotEmpty(n)&&(a=" AND "+i.pkName+" IN (SELECT MARK_MODELID FROM JE_CORE_MARK WHERE MARK_USERID='"+JE.currentUser.userId+"' AND MARK_FUNCID='"+i.funcId+"' ",Ext.each(n,function(e){o.push({code:"MARK_"+e,type:"=",value:"1"})}),a+=JE.DB.buildWhereSql(o,"OR")+")"),JE.DB.setWhereSql(e.store,a,"mark","and",o),JE.Action.disableQuerySql(e,o,"mark"),e.store.loadPage(1)},statics:{dataArray:[{code:"1",color:"#FF625C"},{code:"2",color:"#F9A646"},{code:"3",color:"#F4CE4A"},{code:"4",color:"#6DCC51"},{code:"5",color:"#4BB8F3"},{code:"6",color:"#D088E1"},{code:"7",color:"#A5A5A8"}],getMarkView:function(e){var t=[];if(JE.isEmpty(e))t.push('<div class="fa fa-circle-thin" style="color:#cecece;"></div>');else{var i=e.split(",");Ext.each(JEMarkField.dataArray,function(e){-1!=i.indexOf(e.code)&&t.push('<div class="fa fa-circle" style="color:'+e.color+';"></div>')})}return'<div class="je-field-markfield-view">'+t.join("")+"</div>"},doMark:function(e,t,i){e.fields.get("SY__MARK").persist=!1,e.set("SY__MARK",t);var a=JE.split(t,","),n={};Ext.each(["1","2","3","4","5","6","7"],function(e){n["MARK_"+e]=-1!=a.indexOf(e)?"1":"0"});var o=i.funcData.info;Ext.apply(n,{tableCode:"JE_CORE_MARK",MARK_FUNCID:o.funcId,MARK_FUNCCODE:o.funcCode,MARK_TABLECODE:o.tableName,MARK_MODELID:e.get(o.pkName),MARK_USERID:JE.currentUser.userId}),JE.ajax({url:JE.getUrlMaps("je.core.saveMark"),params:n,async:!0})},showMark:function(e,t,i){var a=this.menu;(a=a||(this.menu=new Ext.menu.Menu({width:162,shadow:!1,cls:"je-mark-menu",plain:!0,layout:"fit"}))).removeAll();var n={xtype:"markfield",itemId:"field",cls:"je-field-basiccls"};Ext.isArray(e)?(a.setWidth(182),Ext.apply(n,{useOK:!0,records:e,okFn:function(e){var t=e.getValue();Ext.each(e.records,function(e){JEMarkField.doMark(e,t,i)}),JE.msg("标记成功！"),a.hide()}})):(a.setWidth(162),Ext.apply(n,{record:e,value:e.get("SY__MARK"),listeners:{change:function(e,t){JEMarkField.doMark(e.record,t,i)}}})),a.add(n),a.showBy(t,"tl-tr",[0,-2])}}}),Ext.define("JE.core.ux.form.MultiItem",{extend:"Ext.form.FieldContainer",alias:["widget.multiitem"],mixins:["Ext.form.field.Field"],isFormField:!0,allowBlank:!0,editable:!0,layout:"fit",autoScroll:!1,msgTarget:"title",pickerAlign:"tl-bl?",matchFieldWidth:!0,queryDelay:10,minChars:1,queryCaching:!0,displayField:"text",invalidCls:Ext.baseCSSPrefix+"form-invalid",idProperty:"code",fields:void 0,displayTpl:'<b>{text}</b><font color="#a0a0a0">({code})</font>',regex:void 0,regexText:"格式错误！",menuConfig:void 0,queryMaxNum:15,initComponent:function(){var e=this;e.idProperty=Ext.value(e.idProperty,"code"),e.blankText=JE.getLocalLang("common.fieldBlankText"),e.queryFields=e.fields=Ext.value(e.fields,["code","text"]),e.selectTpl=Ext.value(e.selectTpl,e.displayTpl),e.items=e.buildItemsView(),e.callParent(arguments),e.itemsview=e.getCmp("itemsview"),e.itemsview.on({refresh:{fn:function(){e.readOnly&&e.setReadOnly(!0)},single:!0}}),e.initField()},afterRender:function(){this.callParent(arguments),this.buildMenu()},setReadOnly:function(e){var t=this;e=Ext.value(e,!1);t.readOnly=e,t.getEl()&&t.getEl()[e?"addCls":"removeCls"]("x-form-readonly"),t.itemsview&&t.itemsview.getEl()&&(t.itemsview.refresh(),t.itemsview.getEl().dom.style.cursor=t.readOnly?"auto":"text",t.itemsview.getPlugin("select").setDisabled(e),t.itemsview.getSelectionModel().setLocked(e))},enableEdit:function(){return!this.readOnly&&!this.disabled},doChange:function(e){},getSubmitData:function(){var e=null;return this.disabled||(this.doChange(!1),(e={})[this.getName()]=this.getValue()),e},reset:function(){this.callParent(arguments),this.doChange(!1)},getValue:function(){var e=this.getData();return JE.toStr(e)},setValue:function(e){e=Ext.value(e,"[]"),this.value=e,this.noInputFocus=!0,this.setData(this.value)},setData:function(e){var i=this,t=i.itemsview;if(Ext.isString(e)){var a=JE.toObj(e);null==a&&(a=[],Ext.each(e.split(","),function(e){var t={};t[i.displayField]=t[i.idProperty]=e,a.push(t)})),e=a}t.store.loadData(e)},getData:function(){var e=this.itemsview,t=[];return e.store.each(function(e){t.push(e.data)}),t},formatTextToObj:function(e){var t={};return t[this.displayField]=t[this.idProperty]=e,t},addData:function(e){if(!JE.isEmpty(e)){var a=this,t=[];if(Ext.isString(e)&&a.editable){if(0==a.textValid())return;t=[a.formatTextToObj(e)]}else if(Ext.isArray(e))t=e;else{if(!Ext.isObject(e))return;t=[e]}var i=a.itemsview.store;if(a.idProperty){var n=[];Ext.each(t,function(e){var t=i.findRecord(a.idProperty,e[a.idProperty]);t&&n.push(t)}),i.remove(n)}else{var o=[];Ext.each(t,function(t){var i={};Ext.each(a.fields,function(e){i[e]=t[e]}),o.push(i)}),t=o}i.add(t),a.textEl.dom.value="",a.onTextChange(),a.validate()}},focus:function(){this.focusTextEl()},focusTextEl:function(e){var t=this;t.textEl&&(0<e?Ext.defer(function(){t.textEl.focus()},e):t.textEl.focus())},buildItemsView:function(){var l=this;return{xtype:"dataview",cls:"je-multiitem-view",itemId:"itemsview",multiSelect:!0,autoScroll:!0,overItemCls:"je-multiitem-item-over",selectedItemCls:"je-multiitem-item-selected",itemSelector:"div.items",emptyText:"",itemCls:"je-multiitem-item",tpl:['<tpl for=".">','<div class = "items">'+(l.displayTpl||"{"+l.displayField+"}")+";</div>","</tpl>",'<div class="text"><input name="text" autocomplete="off"></div>','<div name="textwidth" style="position: absolute;left: -9999px;top: -9999px;"></div>'],plugins:[Ext.create("JE.core.ux.DragSelector",{pluginId:"select"})],store:Ext.create("Ext.data.Store",{fields:l.fields,data:[]}),listeners:{refresh:function(e){l.enableEdit()?l.buildTextElEvent(e):(l.textEl=e.getEl().down("input[name=text]"),l.textWidthEl=e.getEl().down("div[name=textwidth]"),l.textEl.hide(),l.textWidthEl.hide())},containerclick:function(e){l.enableEdit()&&l.focusTextEl()},itemkeydown:function(e,t,i,a,n){if(l.enableEdit()){var o=n.getKey();if(!n.target||"INPUT"!=n.target.nodeName){var r=e.getSelectionModel();8==o||46==o?(e.getStore().remove(r.getSelection()),r.deselectAll(),l.focusTextEl(100)):13==o&&(r.deselectAll(),l.focusTextEl(100))}}}}}},buildMenu:function(){var r=this;r.menuConfig&&(delete r.menuConfig.xtype,Ext.isArray(r.menuConfig)&&(r.menuConfig={items:r.menuConfig}),r.menu=Ext.create("Ext.menu.Menu",Ext.applyIf(r.menuConfig,{width:100,margin:"0 0 10 0"})),(r.menu.field=r).itemsview.on({itemcontextmenu:function(e,t,i,a,n,o){if((n.stopEvent(),r.menu.fieldInfo={field:r,view:e,record:t,index:a},r.menu.beforeMenuShow)&&0==r.menu.beforeMenuShow(e,t,i,a,n))return;r.menu.showAt(n.getXY())},containercontextmenu:function(e,t,i){t.stopEvent()}}))},buildTextElEvent:function(e){var i=this,t=Ext.isEmpty(i.textEl);i.textEl=e.getEl().down("input[name=text]"),i.textWidthEl=e.getEl().down("div[name=textwidth]"),i.textEl.on({focus:function(){e.getEl().addCls("x-form-focus"),i.fireEvent("focus",i)},blur:function(){e.getEl().removeCls("x-form-focus"),i.fireEvent("blur",i),i.validate()},keyup:function(e){var t=e.getKey();i.readOnly||i.disabled||(i.lastKey=t,e.isSpecialKey()&&t!=e.BACKSPACE&&t!=e.DELETE||(i.queryAll=!1,i.getQueryTask().delay(i.queryDelay)))}}),"oninput"in i.textEl.dom?i.textEl.dom.addEventListener("input",function(){i.onTextChange()},!1):i.textEl.dom.onpropertychange=function(e){e&&"value"==e.propertyName.toLowerCase()&&i.onTextChange()},i.keyNav=new Ext.util.KeyNav(i.textEl,{down:i.onDownArrow,enter:function(e){var t=e.target;0!=t.value.length&&i.addData(t.value)},del:i.onLeftUpDelBack,backspace:i.onLeftUpDelBack,left:i.onLeftUpDelBack,up:i.onLeftUpDelBack,scope:i,forceKeyDown:!0}),i.listKeyNav=new Ext.view.BoundListKeyNav(i.textEl,{boundList:i.getPicker(),forceKeyDown:!0,enter:function(e){this.selectHighlighted(e)},esc:{handler:i.onEsc,scope:i,defaultEventAction:!1}}),t||(i.noInputFocus?i.noInputFocus=!1:i.focusTextEl(2))},onTextChange:function(){this.textValid(),this.textWidthEl.dom.innerText=this.textEl.dom.value;var e=this.textWidthEl.getWidth()+12;this.textEl.setWidth(e)},onLeftUpDelBack:function(){var e=this.textEl.dom,t=this.itemsview;if(0<e.value.length)return!0;var i=t.store.getCount();0<i&&(i--,t.getSelectionModel().select(t.store.getAt(i)))},onEsc:function(e){Ext.isIE&&e.preventDefault(),this.isExpanded&&(this.collapse(),e.stopEvent())},onDownArrow:function(e){this.queryAll=!0,this.getQueryTask().delay(this.queryDelay)},onDestroy:function(){Ext.destroy(this.listKeyNav),Ext.destroy(this.keyNav),this.callParent()},buildPickerData:function(){var a=this,n=[];if(a.dataArray)n=a.dataArray,Ext.each(n,function(e,t){if(Ext.isString(e)||Ext.isNumber(e)){var i={};i[a.displayField]=i[a.idProperty]=e,n.splice(t,1,i)}});else if(a.configInfo){var e=a.configInfo.split(",")[0],t=Ext.value(a.whereSql,""),i=JE.getDicItems(e);if(Ext.isEmpty(t)&&!Ext.isEmpty(i)||(i=JE.getDicItems(e,!1,t)),Ext.isEmpty(a.dicItemIds)&&Ext.isEmpty(a.dicItemCodes))n=i;else{var o=a.dicItemIds,r="id";Ext.isEmpty(a.dicItemIds)&&(o=a.dicItemCodes,r="code");var l=o.split(",");Ext.each(i,function(e){-1!=l.indexOf(e[r])&&n.push(e)})}}a.getPicker().store.loadData(n)},createPicker:function(){var n=this,e={xtype:"boundlist",selModel:{mode:"SINGLE"},tpl:['<ul class="'+Ext.plainListCls+'"><tpl for=".">','<li role="option" unselectable="on" class="'+Ext.baseCSSPrefix+'boundlist-item">{[this.formatData(values)]}</li>',"</tpl>","</ul>",{formatData:function(e){var t=n.selectTpl||"{"+n.displayField+"}",i=n.textEl.dom.value,a={};return Ext.iterate(e,function(e,t){a[e]=t.replaceAll(i,'<font color="red">'+i+"</font>")}),JE.toXT(t,a)}}],floating:!0,hidden:!0,focusOnToFront:!1,store:Ext.create("Ext.data.Store",{fields:n.fields,data:[]}),loadingHeight:70,minWidth:70,maxHeight:300,shadow:"sides"};return n.picker=Ext.widget(e),n.picker.ownerCt=n.up("[floating]"),n.picker.registerWithOwnerCt(),n.mon(n.picker,{select:n.onItemSelect,scope:n}),n.buildPickerData(n),n.picker},onItemSelect:function(){if(this.isExpanded){var e=this.picker.getSelectionModel().getSelection();0<e.length&&this.addData(e[0].data),this.collapse(),this.focusTextEl(2)}},expand:function(){var e,t,i=this;if(i.rendered&&!i.isExpanded&&!i.isDestroyed){if(i.expanding=!0,i.bodyEl,e=i.getPicker(),t=i.collapseIf,0==e.store.getCount())return void delete i.expanding;e.show(),i.isExpanded=!0,i.alignPicker(),i.mon(Ext.getDoc(),{mousewheel:t,mousedown:t,scope:i}),Ext.EventManager.onWindowResize(i.alignPicker,i),i.fireEvent("expand",i),i.onExpand(),delete i.expanding}},onExpand:function(){this.selectOnTab,this.getPicker();this.keyNav.disable(),this.listKeyNav&&Ext.defer(this.listKeyNav.enable,1,this.listKeyNav)},alignPicker:function(){var e=this.getPicker();this.isExpanded&&(this.matchFieldWidth&&e.setWidth(this.bodyEl.getWidth()),e.isFloating()&&this.doAlign())},doAlign:function(){this.picker.alignTo(this.bodyEl,this.pickerAlign,this.pickerOffset)},collapse:function(){if(this.isExpanded&&!this.isDestroyed){var e=this,t=e.picker,i=Ext.getDoc(),a=e.collapseIf;t.hide(),e.isExpanded=!1,i.un("mousewheel",a,e),i.un("mousedown",a,e),Ext.EventManager.removeResizeListener(e.alignPicker,e),e.fireEvent("collapse",e),e.onCollapse()}},onCollapse:function(){var e=this.listKeyNav;e&&e.disable(),this.keyNav.enable(),this.getPicker().getSelectionModel().deselectAll()},collapseIf:function(e){if(!this.isDestroyed){var t=!e.within(this.bodyEl,!1,!0),i=!e.within(this.picker.el,!1,!0);t&&i&&this.collapse()}},getPicker:function(){return this.picker||(this.picker=this.createPicker())},getQueryTask:function(){return this.doQueryTask||(this.doQueryTask=new Ext.util.DelayedTask(this.doQuery,this)),this.doQueryTask},doQuery:function(e){var t=this,i=t.beforeQuery({query:e||t.textEl.dom.value,rawQuery:!0,field:t,cancel:!1});return!1===i||i.cancel?(t.collapse(),!1):(t.queryCaching&&i.query===t.lastQuery?t.expand():(t.lastQuery=i.query,t.doLocalQuery(i)),t.afterQuery(i),!0)},beforeQuery:function(e){return!1===this.fireEvent("beforequery",e)?e.cancel=!0:e.cancel||this.queryAll||e.query.length<this.minChars&&(e.cancel=!0),e},doLocalQuery:function(e){var n=this,t=(e.query,n.getPicker().store);n.queryFilter||(n.queryFilter=new Ext.util.Filter({filterFn:function(t){var i=!1,a=n.textEl.dom.value.toLocaleLowerCase();return JE.isNotEmpty(a)?(a="."==a?"[.]":a,Ext.each(n.queryFields,function(e){if(i=-1!=t.get(e).toLocaleLowerCase().indexOf(a))return!1})):n.queryAll&&void 0!==n.queryMaxNum&&(-1==n.queryMaxNum?i=!0:0<n.queryMaxNum&&(n.queryFilter.filterCount++,n.queryFilter.filterCount<=n.queryMaxNum&&(i=!0))),i}}),t.addFilter(n.queryFilter,!1)),n.queryFilter.filterCount=0,t.filter(),t.getCount()?n.expand():n.collapse()},afterQuery:function(e){this.doAutoSelect()},doAutoSelect:function(){var e,t=this.picker;t&&0<t.store.getCount()&&(e=t.getNode(0))&&t.highlightItem(e)},getErrors:function(e){var t=this,i=[],a=t.vtype,n=Ext.form.field.VTypes,o=t.regex;if(e!=t.displayField){var r=t.getData();!t.allowBlank&&Ext.isEmpty(r)&&i.push(t.blankText)}else{var l=t.textEl.dom.value;a&&(n[a](l,t)||i.push(t.vtypeText||n[a+"Text"])),o&&!o.test(l)&&i.push(t.regexText||t.invalidText)}return i},textValid:function(){var e=[],t=!0,i="";return JE.isNotEmpty(this.textEl.dom.value)&&(e=this.getErrors(this.displayField)),0<e.length&&(t=!1,i=e[0]),this.itemsview[t?"removeCls":"addCls"](this.invalidCls),this.textEl[t?"removeCls":"addCls"]("je-box-invalid"),this.textEl.dom.title=i,t},isValid:function(){var e,t,i=[];return this.disabled||!this.itemsview?e=!0:(i=this.getErrors(),e=Ext.isEmpty(i),t=this.wasValid,e?this.unsetActiveError():this.setActiveError(i)),e!==t&&this.itemsview&&this.itemsview.getEl()&&this.itemsview.getEl()[e?"removeCls":"addCls"]("je-box-invalid"),e},renderActiveError:function(){var e=this,t=e.getActiveError(),i=!!t;t!==e.lastActiveError&&(e.fireEvent("errorchange",e,t),e.lastActiveError=t),!e.rendered||e.isDestroyed||e.preventMark||(e.el[i?"addCls":"removeCls"](e.invalidCls),e.el.dom.setAttribute("title",e.activeErrors?e.activeErrors[0]:""))}}),Ext.define("JE.core.ux.form.MultiSelect",{extend:"Ext.form.FieldContainer",mixins:{bindable:"Ext.util.Bindable",field:"Ext.form.field.Field"},alternateClassName:"Ext.ux.Multiselect",alias:["widget.multiselectfield","widget.multiselect"],requires:["Ext.panel.Panel","Ext.view.BoundList","Ext.layout.container.Fit"],uses:["Ext.view.DragZone","Ext.view.DropZone"],layout:"anchor",sourceCopy:!1,onlyChildren:!1,cascadeChildren:!1,ddReorder:!1,appendOnly:!1,displayField:"text",allowBlank:!0,minSelections:0,maxSelections:Number.MAX_VALUE,blankText:"This field is required",minSelectionsText:"Minimum {0} item(s) required",maxSelectionsText:"Maximum {0} item(s) required",delimiter:",",dragText:"{0} Item{1}",ignoreSelectChange:0,multiSelect:!1,initComponent:function(){var e=this;e.cls=Ext.value(e.cls,"")+" je-field-multiselect",e.bindStore(e.store,!0),e.store.autoCreated&&(e.valueField=e.displayField="field1",e.store.expanded||(e.displayField="field2")),Ext.isDefined(e.valueField)||(e.valueField=e.displayField),e.items=e.setupItems(),e.callParent(),e.initField(),e.addEvents("drop"),e.addEvents("beforedrop")},setupItems:function(){var e=this;return e.boundList=Ext.create("Ext.view.BoundList",Ext.apply({anchor:"none 100%",deferInitialRefresh:!1,border:1,simpleSelect:e.multiSelect,allowDeselect:!0,store:e.store,displayField:e.displayField,disabled:e.disabled},e.listConfig)),e.boundList.getSelectionModel().on("selectionchange",e.onSelectChange,e),e.title?{border:!(e.boundList.border=!1),anchor:"none 100%",layout:"anchor",title:e.title,tbar:e.tbar,items:e.boundList}:e.boundList},onSelectChange:function(e,t){this.ignoreSelectChange||this.setValue(t)},getSelected:function(){return this.boundList.getSelectionModel().getSelection()},isEqual:function(e,t){var i,a=Ext.Array.from,n=0;if(e=a(e),t=a(t),(i=e.length)!==t.length)return!1;for(;n<i;n++)if(t[n]!==e[n])return!1;return!0},afterRender:function(){var e,c=this;c.callParent(),c.selectOnRender&&((e=c.getRecordsForValue(c.value)).length&&(++c.ignoreSelectChange,c.boundList.getSelectionModel().select(e),--c.ignoreSelectChange),delete c.toSelect),!c.ddReorder||c.dragGroup||c.dropGroup||(c.dragGroup=c.dropGroup="MultiselectDD-"+Ext.id()),(c.draggable||c.dragGroup)&&(c.dragZone=Ext.create("Ext.view.DragZone",{view:c.boundList,ddGroup:c.dragGroup,dragText:c.dragText})),(c.droppable||c.dropGroup)&&(c.dropZone=Ext.create("Ext.view.DropZone",{view:c.boundList,ddGroup:c.dropGroup,handleNodeDrop:function(e,t,i){var a,n=this.view,o=n.getStore(),r=e.records;if(0!=c.fireEvent("beforedrop",c,r)){1!=c.sourceCopy&&e.view.store.remove(r),a=o.indexOf(t),"after"===i&&a++;var l=c.valueField,s=[];if(1==c.onlyChildren){var d=function(e,t){var i=e.childNodes;0==i.length&&"1"!=e.get("disabled")?t.push(e):Ext.each(i,function(e){d(e,t)})};Ext.each(r,function(e){d(e,s)}),r=s,s=[]}if(1==c.cascadeChildren){d=function(e,t){var i=e.childNodes;0==i.length||Ext.each(i,function(e){c.store.findRecord("id",e.get("id"))||(e.parentNode&&e.set("parentText",e.parentNode.get("text")),t.push(e)),d(e,t)})};Ext.each(r,function(e){d(e,s)})}Ext.each(r,function(e){-1==o.find(l,e.get(l))&&(e.parentNode&&e.set("parentText",e.parentNode.get("text")),s.push(e))}),0!=(r=s).length&&(o.insert(a,r),n.getSelectionModel().select(r)),c.fireEvent("drop",c,r)}}}))},isValid:function(){var e=this.disabled;return this.forceValidation||!e?this.validateValue(this.value):e},validateValue:function(e){var t=this.getErrors(e),i=Ext.isEmpty(t);return this.preventMark||(i?this.clearInvalid():this.markInvalid(t)),i},markInvalid:function(e){var t=this.getActiveError();this.setActiveErrors(Ext.Array.from(e)),t!==this.getActiveError()&&this.updateLayout()},clearInvalid:function(){var e=this.hasActiveError();this.unsetActiveError(),e&&this.updateLayout()},getSubmitData:function(){var e,t=null;return this.disabled||!this.submitValue||this.isFileUpload()||null!==(e=this.getSubmitValue())&&((t={})[this.getName()]=e),t},getSubmitValue:function(){var e=this.delimiter,t=this.getValue();return Ext.isString(e)?t.join(e):t},getValue:function(){return this.value||[]},getRecordsForValue:function(e){var t,i,a,n=[],o=this.store.getRange(),r=this.valueField,l=0,s=o.length;for(a=e.length;l<a;++l)for(i=0;i<s;++i)(t=o[i]).get(r)==e[l]&&n.push(t);return n},setupValue:function(e){var t,i,a,n=this.delimiter,o=this.valueField,r=0;if(Ext.isDefined(e)){for(n&&Ext.isString(e)?e=e.split(n):Ext.isArray(e)||(e=[e]),i=e.length;r<i;++r)(a=e[r])&&a.isModel&&(e[r]=a.get(o));t=Ext.Array.unique(e)}else t=[];return t},setValue:function(e){var t=this,i=t.boundList.getSelectionModel(),a=t.store;a.getCount()?(e=t.setupValue(e),t.mixins.field.setValue.call(t,e),t.rendered?(++t.ignoreSelectChange,i.deselectAll(),Ext.isEmpty(e)||i.select(t.getRecordsForValue(e)),--t.ignoreSelectChange):t.selectOnRender=!0):a.on({load:Ext.Function.bind(t.setValue,t,[e]),single:!0})},clearValue:function(){this.setValue([])},onEnable:function(){var e=this.boundList;this.callParent(),e&&e.enable()},onDisable:function(){var e=this.boundList;this.callParent(),e&&e.disable()},getErrors:function(e){var t,i=Ext.String.format,a=[];return t=(e=Ext.Array.from(e||this.getValue())).length,!this.allowBlank&&t<1&&a.push(this.blankText),t<this.minSelections&&a.push(i(this.minSelectionsText,this.minSelections)),t>this.maxSelections&&a.push(i(this.maxSelectionsText,this.maxSelections)),a},onDestroy:function(){this.bindStore(null),Ext.destroy(this.dragZone,this.dropZone),this.callParent()},onBindStore:function(e){var t=this.boundList;t&&t.bindStore(e)}}),Ext.define("JE.core.ux.form.PinyinField",{extend:"Ext.form.field.Text",alias:"widget.pinyinfield",mixins:["JE.util.PinYinUtil","JE.core.util.FieldUtil"],initComponent:function(){var l=this;if(!Ext.isEmpty(l.configInfo)){var i=l.configInfo.split(",");l.on("change",function(e,o,t){var r=l.getParentInfo();Ext.each(i,function(e,t){var i=e.split("~")[0],a=e.split("~")[1],n=Ext.isEmpty(o)?o:l.toPinYin(o,a);r.values=[n],r.fieldName=i,l.setFieldValues(r)})})}l.callParent(arguments)}}),Ext.define("JE.core.ux.form.QueryUserField",{extend:"JE.core.ux.form.SearchSelectField",editable:!1,alias:["widget.queryuserfield1","widget.queryuserareafield1"],initComponent:function(){var b=this;b.callParent(arguments),b.on({okbuttonclick:function(e,t,i){var a=i.down("grid[xtype=query.selectedusergrid]");t.splice(0,t.length),a.getStore().each(function(e){t.push(e)})},sswinrender:function(e,t){var i=t.down("grid[xtype=query.selectedusergrid]"),a=Ext.value(b.configInfo,"").split(","),n=Ext.value(a[1],"").split("~"),o=Ext.value(a[2],"").split("~"),r="",l=t.formatData;if(-1!=o.indexOf("USERID"))r=" AND USERID IN ('"+Ext.value(l[n[o.indexOf("USERID")]],"").split(",").join("','")+"')";else if(-1!=o.indexOf("USERCODE")){r=" AND USERCODE IN ('"+Ext.value(l[n[o.indexOf("USERCODE")]],"").split(",").join("','")+"')"}if(!Ext.isEmpty(r)){var s=JE.ajax({url:JE.getUrlMaps("je.core.rbac.rbac.load"),params:{tableCode:"JE_CORE_ENDUSER",limit:-1,whereSql:r}});i.getStore().loadData(s.rows)}var d=b.otherConfig,c=t.down("panel[xtype=rbac.queryusertree]");if(Ext.isEmpty(d))c.hide();else{Ext.isString(d)&&(d=JE.toObj(d));var u=0;if("1"!=d.DEPT){(p=t.down("treepanel[itemId=ROOT_DEPARTMENT]"))&&p.hide(),u++}else{var p,f=(p=t.down("treepanel[itemId=ROOT_DEPARTMENT]")).getStore().getRootNode(),E="",m=d.QUERYPERM;if(!Ext.isEmpty(m)){var g=m.split(",");-1!=g.indexOf("COMPANY")&&(E=" AND JTGSID='"+JE.currentUser.dept.jtgsId+"'"),-1!=g.indexOf("COMPANYJG")&&(E=" AND JTGSID IN (SELECT JE_CORE_JDGSINFO_ID FROM JE_CORE_JDGSINFO WHERE JDGSINFO_JGGS_ID LIKE '%"+JE.currentUser.dept.jtgsId+"%')"),-1!=g.indexOf("COMPANY")&&-1!=g.indexOf("COMPANYJG")&&(E=" AND (JTGSID='"+JE.currentUser.dept.jtgsId+"' OR JTGSID IN (SELECT JE_CORE_JDGSINFO_ID FROM JE_CORE_JDGSINFO WHERE JDGSINFO_JGGS_ID LIKE '%"+JE.currentUser.dept.jtgsId+"%'))")}var h=JE.ajax({url:JE.getUrlMaps("je.core.rbac.user","loadDeptInfo"),params:{whereSql:E}});f.removeAll(),0<h.children.length&&f.appendChild(h.children)}if("1"!=d.ROLE){var x=t.down("treepanel[itemId=ROOT_ROLE]");x&&x.hide(),u++}if("1"!=d.SENTRY){var v=t.down("treepanel[itemId=ROOT_SENTRY]");v&&v.hide(),u++}if("1"!=d.WORKGROUP){var y=t.down("treepanel[itemId=ROOT_WORKGROUP]");y&&y.hide(),u++}4==u&&c.hide()}}})}}),Ext.define("JE.core.ux.form.QuickQueryField",{extend:"JE.core.ux.form.UXTrigger",alias:["widget.qqfield"],width:180,initComponent:function(){this.addEvents("beforequery","query"),this.callParent(arguments)},afterRender:function(){this.callParent(),this.gridObj||(this.gridObj=this.up("grid"))},onTrigger1Click:function(){this.callParent(arguments),this.gridObj&&(this.gridObj.funcData?JE.Action.doKeywordQuery(this.gridObj):(JE.DB.setWhereSql(this.gridObj.store,[],"quick"),this.gridObj.store.loadPage(1)))},onTrigger2Click:function(){var e=this,i=e.getValue().trim();if(0!=e.fireEvent("beforequery",e)){if(e.gridObj&&e.gridObj.funcData)JE.Action.doKeywordQuery(e.gridObj,i);else{if(e.setValue(i),JE.isEmpty(e.queryFields))return void JE.msg(e.localLang.noQueryFieldsMsg);if(JE.isNotEmpty(i)){var a=[];Ext.each(e.queryFields,function(e){if(Ext.isString(e)&&(e={name:e,type:"like"}),e.type=Ext.value(e.type,"like"),"no"!=e.type){var t={code:e.name,type:e.type,value:i};"like%"==t.type&&(t.type="like",t.after=!0),"numberfield"==e.xtype?JE.isNotEmpty(i)&&Ext.isNumeric(i)&&a.push(t):a.push(t)}}),JE.DB.buildWhereSql(a)}e.gridObj&&(JE.DB.setWhereSql(e.gridObj.store,a,"quick","or"),e.gridObj.store.loadPage(1))}e.fireEvent("query",e)}}}),Ext.define("JE.core.ux.form.SearchField",{extend:"Ext.form.field.ComboBox",alias:["widget.searchfield"],mixins:["JE.core.util.FieldUtil"],minChars:0,typeAhead:!1,trigger1Cls:Ext.baseCSSPrefix+"form-clear-trigger",queryParam:"",queryCaching:!1,forceSelection:!0,initComponent:function(){var n=this;n.cls=Ext.value(n.cls,"")+" je-field-search",n.localLang=JE.getLocalLang("core.ux.searchfield"),n.addEvents("reset","query");var e=n.configInfo.split(",");n.configData={funcCode:Ext.value(e[0],""),fieldNames:Ext.value(e[1],"").split("~"),valueNames:Ext.value(e[2],"").split("~")},Ext.each(n.configData.fieldNames,function(e,t){e==n.name&&(n.valueField=n.configData.valueNames[t],n.displayField=n.valueField)});var i=JE.getFuncData(n.configData.funcCode),t=i.info,o=t.viewTableName,a=t.pkName;n.funcData=i;try{n.otherConfig=Ext.isObject(n.otherConfig)?n.otherConfig:Ext.decode(Ext.value(n.otherConfig,"{}")),n.otherConfig.queryField=Ext.value(n.otherConfig.queryField,n.valueField)}catch(e){throw n.otherConfig={showField:"",queryField:""},e}var r=0,l="",s="",d=[];showField=n.otherConfig.showField,Ext.isEmpty(showField)?Ext.each(i.select.columns,function(e){"rownumberer"!=e.xtype&&d.push(e)}):Ext.each(showField.split(","),function(e){var t=i.basicColumns[e];t&&d.push(t)});var c=[];Ext.each(d,function(e){r+=e.width,s+='<td  class=searchfield-td-head style ="width:'+e.width+'px;">'+e.text+"</td>",l+='<td  class=searchfield-td title="{'+e.dataIndex+'}" style ="width:'+e.width+'px;">{[this.hlStr(values.'+e.dataIndex+',"'+e.dataIndex+'")]}</td>',c.push(e.dataIndex)}),n.pageSize=10;var u=t.whereSql+" "+Ext.value(t.treeFuncSql,"")+" "+n.whereSql;-1==c.indexOf(a)&&c.push(a),n.store=JE.getStore({tableName:o,pageSize:n.pageSize,params:{tableCode:o,funcCode:t.funcCode,orderSql:Ext.value(t.orderSql,""),basicSql:u,whereSql:u}});var p=new Ext.XTemplate('<table width = 99% cellspacing=0 style="table-layout:fixed;">','<tpl for=".">','<tr role="option" class="'+Ext.baseCSSPrefix+'boundlist-item">',l,"<td></td>","</tr>","</tpl>","</table>",{hlStr:function(e,t){var i=n.getValue();if(Ext.isEmpty(i)||-1==n.otherConfig.queryField.indexOf(t))i=e;else{var a=e.replaceAll(i,"<font color=red>"+i+"</font>");a==e&&(a=e.replaceAll(i.toLowerCase(),"<font color=red>"+i.toLowerCase()+"</font>"))==e&&(a=e.replaceAll(i.toUpperCase(),"<font color=red>"+i.toUpperCase()+"</font>")),i=a}return i}});n.listConfig={width:r+10,loadingText:n.localLang.loadingText,emptyText:n.localLang.emptyText,tpl:p,cls:"je-field-search-list",headerTpl:['<table width = 99% cellspacing=0 style="table-layout:fixed;">',"<tr class=searchfield-tr-head>",s,"<td></td>","</tr>","</table>"].join("")},n.callParent(),n.on("select",function(e,t){if(e.funcData&&0<t.length){var i=t[0],a=JE.ajax({url:JE.getUrlMaps("je.core.getInfoById"),params:{tableCode:o,pkValue:i.get(e.funcData.info.pkName)}});i.set(a),e.setConfigInfo({datas:[a]}),n.fireEvent("query",n,[i])}}),n.on("afterrender",function(e){n.inputEl.dom.style.backgroundColor=n.readOnly?"#E6E6E6":"white"}),n.editable&&n.on("focus",function(e){n.onTriggerClick()})},assertValue:function(){var e,t,i=this,a=i.getRawValue();i.forceSelection&&(i.multiSelect?a!==i.getDisplayValue()&&i.setValue(i.lastSelection):(e=i.findRecordByDisplay(a))?(t=i.value,i.findRecordByValue(t)||i.select(e,!0)):i.editable?i.setValue(a):i.setValue(i.lastSelection)),i.collapse()},onTrigger1Click:function(){var e=this;if(e.setConfigInfo(),e.reset(),e.isExpanded){var t=e.getParentInfo(!0);e.store.proxy.extraParams.whereSql=JE.DB.formatSql(e.store.proxy.extraParams.basicSql,t.data,e.funcCode),e.store.loadPage(1)}e.fireEvent("reset",e)},setValue:function(e){if(Ext.isString(e)){var t={};t[this.valueField]=e,e=Ext.create(this.store.model.$className,t)}this.callParent(arguments)},setReadOnly:function(e){this.callParent(arguments),this.inputEl&&(this.inputEl.dom.style.backgroundColor=e?"":"white")},doQuery:function(e,t,i){var a=Ext.value(this.otherConfig.queryField,this.valueField);if(!Ext.isEmpty(a)){var n=Ext.value(e,this.getDisplayValue()),o=this.getParentInfo(!0),r=this.store.proxy.extraParams;if(r.whereSql=JE.DB.formatSql(r.basicSql,o.data,this.funcCode),!Ext.isEmpty(n)){var l=[];Ext.each(a.split(","),function(e){l.push(" "+e+" like '%"+n+"%' ")}),r.whereSql+=" and ("+l.join("or")+")"}}this.callParent(arguments)},alignPicker:function(){var e=this.getPicker();if(this.isExpanded){if(this.matchFieldWidth){var t=this.bodyEl.getWidth(),i=this.el.getWidth();t<=e.width&&e.width<=i?t=i:e.width>i&&(t=e.width),e.setWidth(t)}e.isFloating()&&this.doAlign()}},doAlign:function(){var e,t=this,i=t.picker,a=t.inputEl;i.width>t.bodyEl.getWidth()&&(a=t.el),t.picker.alignTo(a,t.pickerAlign,t.pickerOffset),e=i.el.getY()<t.inputEl.getY(),t.bodyEl[e?"addCls":"removeCls"](t.openCls+"-above"),i[e?"addCls":"removeCls"](i.baseCls+"-above")}}),Ext.define("JE.core.ux.form.StarField",{extend:"Ext.form.field.Trigger",alternateClassName:["JEStarField"],alias:["widget.starfield"],clearButton:!1,enableDisplay:!1,initComponent:function(){this.cls=Ext.value(this.cls,"")+" je-field-star",this.callParent(arguments)},afterRender:function(){var i=this;i.callParent(),i.starEl=i.inputEl.insertHtml("afterEnd",'<div class="je-field-star-inner"><div class="inner"></div></div>',!0),i.starInnerEl=i.starEl.down(".inner"),i.starEl.on("click",function(e){var t=e.getTarget();"I"!=t.nodeName||i.readOnly||i.setValue(t.getAttribute("data-value"))}),i.setValue(i.value)},setValue:function(e){this.callParent(arguments),this.starEl&&(html=JEStarField.getStarView(e,this.valueList)+"&nbsp;",this.starInnerEl.update(html))},onTriggerWrapMouseup:function(){this.inputEl.focus()},statics:{valueList:["1","2","3","4","5"],starHalfCls:"fa fa-star-half-o",starOffCls:"fa fa-star-o",starOnCls:"fa fa-star",getStarView:function(a,e){var n=JEStarField,o=[];return a=parseInt(a),Ext.each(e||n.valueList,function(e,t){var i=(e=parseInt(e))<=a?n.starOnCls+" on":n.starOffCls;o.push('<i data-value="'+e+'" class="star '+i+'"></i>')}),o.join("")}}}),Ext.define("JE.core.ux.form.UEditorField",{extend:"Ext.form.FieldContainer",alias:["widget.ueditorfield","widget.ueditor","widget.ckeditorfield","widget.ckeditor"],mixins:["Ext.form.field.Field"],isFormField:!0,allowBlank:!0,layout:"card",height:400,readOnly:!1,editorConfig:void 0,simpleToolbar:!1,otherBorder:0,imageUrlType:"url",fullscreenToolbars:void 0,simpleToolbars:[["undo","redo","|","bold","italic","underline","forecolor","backcolor","fontfamily","fontsize","|","insertorderedlist","insertunorderedlist","|","justifyleft","justifycenter","justifyright","justifyjustify","|","attachment","simpleupload","emotion","print"]],initComponent:function(){var e=this;e.cls=Ext.value(e.cls,"")+" je-field-ueditor",e.localLang=JE.getLocalLang("core.ux.ueditorfield"),e.blankText=Ext.form.field.Text.prototype.blankText;var t=["/static/ux/editor/ueditor1_4_3/ueditor.JEconfig.js","/static/ux/editor/ueditor1_4_3/ueditor.all-min.js","/static/ux/editor/ueditor1_4_3/formdesign/leipi.form.design.js"];"en"==_JE_LOCAL_LANG?t.push("/static/ux/editor/ueditor1_4_3/lang/en/en.js"):t.push("/static/ux/editor/ueditor1_4_3/lang/zh-cn/zh-cn.js"),JE.loadScript(t),e.addEvents("editorready"),e.items=[{xtype:"box",itemId:"editorBox",autoScroll:!0},{xtype:"box",itemId:"displayBox",cls:"ueditor-readonly"}],e.useFormStyle&&(e.otherBorder=2,e.defaults={margin:"0 1 0 0"},e.items[1].border=0),JE.isNotEmpty(e.configInfo)&&(e.simpleToolbar=!0,e.simpleToolbars=[JE.split(e.configInfo,",")]),e.callParent(arguments),e.initField()},afterRender:function(){var e=this;e.callParent(arguments);var t=e.up("window");if(t)var i=setInterval(function(){(t=Ext.WindowManager.getActive())&&(clearInterval(i),e.buildRender(t.getEl().zindex+1))},50);else e.buildRender()},buildRender:function(e){var r=this,t=r.getCmp("editorBox").getId();r.buttons=Ext.value(r.buttons,{}),r.buttons._template={className:"edui-for-template",label:"模板",showIcon:!0,showText:!0,onclick:function(){r.showTemplate()}},r.buttons._files={className:"edui-for-attachment",label:"文件库",showIcon:!0,showText:!0,onclick:function(){r.showFiles()}};var i=Ext.applyIf(Ext.value(r.editorConfig,{}),{autoHeightEnabled:!1,initialFrameWidth:"100%",initialFrameHeight:r.getHeight()-80-r.otherBorder,enableAutoSave:!1,allowDivTransToP:!1,toolleipi:!0,wordCount:!1,elementPathEnabled:!1,imageUrlType:r.imageUrlType,buttons:r.buttons,labelMap:{aligntable:r.localLang.aligntableLabel,aligntd:r.localLang.aligntdLabel}});if(0<e&&(i.zIndex=e),1!=r.simpleToolbar||i.toolbars||(i.toolbars=r.simpleToolbars),r.showFullScreenBtn){var a=i.toolbars[0];JE.isNotEmpty(a)&&-1==a.indexOf("fullscreen")&&a.push("fullscreen")}r.editor=UE.getEditor(t,i),r.buildEditorCmd(),r.editor.addListener("ready",function(e){r.editor.execCommand("serverparam",r.getFileParams()),r.editor.window.onfocus=function(){JE.browser.focus()},r.editor.window.onblur=function(){JE.browser.blur()},r.editorEl=Ext.get(r.editor.container),r.editorTBarEl=r.editorEl.child(".edui-editor-toolbarbox"),r.editorBodyEl=r.editorEl.child(".edui-editor-iframeholder"),r.editorBBarEl=r.editorEl.child(".edui-editor-bottomContainer"),r.setReadOnly(r.readOnly),r.setValue(r.value),r.on("resize",function(e,t,i,a,n,o){JE.defer(function(){if(Ext.isEmpty(r.el))return!1;if(0<r.getHeight()){var e=r.editorTBarEl.dom.offsetHeight,t=(r.editorBBarEl.dom.offsetHeight,r.editorBodyEl.dom.offsetHeight,r.editor.container.offsetHeight,r.getHeight()-e-2-r.otherBorder);return"top"==r.labelAlign&&r.labelEl&&(t-=r.labelEl.parent().getBox().height),r.editor.setHeight(t),r.editor.body.style.height=t-16+"px",!1}},50)}),r.fireEvent("resize",r),r.fireEvent("editorready",r),Ext.defer(function(){UE.utils.cssRule("selfStyle","h1, h2, h3, h4, h5, h6,p{margin:0px;}body *{box-sizing: border-box;-moz-box-sizing: border-box;-ms-box-sizing: border-box;-webkit-box-sizing: border-box;}body{font-size:12px;}td,th{padding: 0px;border: 1px solid #000000}table{margin-bottom:0px;table-layout: fixed;}",r.editor.document)},100),r.renderEditFiles()}),r.editor.addListener("contentChange",function(e){r.checkChange()});var n=Ext.value(r.ownerCt,{});if(r.labelEl&&!r.hideLabel||"fieldcontainer"==n.xtype&&n.labelEl){var o=n.labelEl||r.labelEl;"top"!=r.labelAlign&&o.appendChild({tag:"div",style:"height:10px"}),r.maxviewEl=o.appendChild({tag:"div",cls:"fullscreen "+("plus"==JE.getTheme()?"fa fa-clone":"je-button-icon je_config_fullscreen"),style:"cursor: pointer;margin:0px 5px;display:inline-block;color:#444;font-size:12px;","data-qtip":r.localLang.winSeeLabel}),r.maxviewEl.on("click",function(e){Ext.get(e.getTarget()).hasCls("fullscreen")&&r.fullScreen(!1)})}},setReadOnly:function(e){e=Ext.value(e,!1);this.readOnly=e,this.getLayout().setActiveItem(e?"displayBox":"editorBox")},setDisabled:function(e){var t=this.callParent(arguments);return this.getLayout().setActiveItem(e?"displayBox":"editorBox"),t},getValue:function(){var e=this.getHtml();return Ext.isEmpty(e)||(e=Ext.htmlEncode(e)),e},setValue:function(e){this.value=e=Ext.value(e,"").toString();try{e=Ext.htmlDecode(e)}catch(e){}this.setHtml(e)},setHtml:function(e,t){var i=this;if(e=Ext.value(e,""),i.editor){function a(){"append"==t?i.editor.setContent(e,!0):"insert"==t?i.editor.execCommand("insertHtml",e):i.editor.setContent(e),e=i.editor.getContent(),i.getCmp("displayBox").update(JE.getUEditorBox(e))}i.editor.body?a():i.editor.ready(a)}},getHtml:function(){var e="";return this.editor&&this.editor.body&&(e=this.editor.getContent()),e},fillTdWidth:function(e){var t=UE.dom.domUtils.findParentByTagName(e,"table"),i=t.clientWidth,a=t.parentNode.clientWidth;UE.UETable.changeColWidth(e,a-i)},buildEditorCmd:function(){this.buildEditTable(),this.buildEditTd(),this.buildAlignTd(),this.buildFullScreen()},buildEditTd:function(){var d=this,c=d.localLang.attr;d.editor.commands.edittd={queryCommandState:function(){return UE.UETable.getTableItemsByRange(this).table?0:-1},execCommand:function(e,t){var i=this,a=UE.dom.domUtils,n=UE.UETable.getUETableBySelected(i),o=[];if(n)o=n.selectedTds;else{var r=i.selection.getStart(),l=r&&a.findParentByTagName(r,["td","th","caption"],!0);l&&o.push(l)}var s={fill:"fill"};JE.isEmpty(t)?JE.formWin({title:c.tdTitle,width:400,height:320,items:[{fieldLabel:c.backgroundColor,xtype:"colorfield",name:"backgroundColor"},{xtype:"fieldcontainer",fieldLabel:c.borderColor,layout:"hbox",defaults:{flex:1},items:[{xtype:"colorfield",name:"borderTopColor",hideTrigger1:!0,emptyText:c.borderColorTop},{xtype:"colorfield",name:"borderRightColor",hideTrigger1:!0,emptyText:c.borderColorRight},{xtype:"colorfield",name:"borderBottomColor",hideTrigger1:!0,emptyText:c.borderColorBottom},{xtype:"colorfield",name:"borderLeftColor",hideTrigger1:!0,emptyText:c.borderColorLeft}]},{fieldLabel:c.borderWidth,name:"borderWidth"},{fieldLabel:c.borderStyle,name:"borderStyle",xtype:"cbbfield",dataArray:[{code:"solid",text:c.borderStyleSolid},{code:"dashed",text:c.borderStyleDashed}]},{fieldLabel:c.padding,name:"padding"},{fieldLabel:c.margin,name:"margin"},{fieldLabel:c.width,name:"width"},{fieldLabel:c.height,name:"height"},{fieldLabel:c.fill,xtype:"yesnofield",name:"fill"},{xtype:"fieldcontainer",fieldLabel:c.font,layout:"hbox",defaults:{flex:1},items:[{xtype:"textfield",name:"fontSize",emptyText:c.fontSize},{xtype:"textfield",name:"fontFamily",emptyText:c.fontFamily},{xtype:"cbbfield",name:"fontWeight",value:"normal",hideTrigger1:!0,dataArray:[{code:"",text:c.fontWeight},{code:"bold",text:c.fontWeightBold}]},{xtype:"colorfield",name:"color",hideTrigger1:!0,emptyText:"颜色"}]}],useButton:!0,fn:function(e,t){i.execCommand("edittd",e)},showFn:function(e){var t=e.getCmp("form"),i=t.form.getValues();if(1==o.length){var a=o[0],n=a.style;Ext.iterate(i,function(e,t){s[e]?i[e]=a.getAttribute("data-"+e):-1!=["width","height"].indexOf(e)?i[e]=a[e]:i[e]=n[e]}),t.form.setValues(i)}}}):(Ext.each(o,function(i){Ext.iterate(t,function(e,t){(1==o.length||1<o.length&&JE.isNotEmpty(t))&&(s[e]?i.setAttribute("data-"+e,t):-1!=["width","height"].indexOf(e)?i.setAttribute(e,t):i.style[e]=Ext.isNumeric(t)?t+"px":t)})}),"1"==t.fill&&o[0]&&d.fillTdWidth(o[0]))}}},getFileParams:function(){var e=this,t="";return e.formObj&&JE.isNotEmpty(e.pkName)&&e.formObj.form.findField(e.pkName)&&(t=e.formObj.form.findField(e.pkName).getValue()),{pkValue:t||"",tableCode:e.tableName?e.tableName:"",beanTableCode:e.tableName?e.tableName:"",fieldCode:e.name?e.name:"",funcCode:e.funcCode?e.funcCode:"",jeFileType:e.jeFileType||"PROJECT",jeFileSource:"ueeditor"}},buildEditTable:function(){var o=this,r=o.localLang.attr,l=o.localLang.align,s={};JE.isNotEmpty(o.tableAttrs)&&Ext.each(o.tableAttrs,function(e){JE.isNotEmpty(e.name)&&(s[e.name]=e)}),o.editor.commands.edittable={queryCommandState:function(){return UE.UETable.getTableItemsByRange(this).table?0:-1},execCommand:function(e,t){var i=this,a=i.selection.getRange(),n=UE.dom.domUtils.findParentByTagName(a.startContainer,"table");n&&(t?Ext.iterate(t,function(e,t){s[e]?n.setAttribute("data-"+e,t):-1!=["background","border","align"].indexOf(e)?n.setAttribute(e,t):n.style[e]=t}):JE.formWin({title:r.tableTitle,width:450,height:350,items:[{fieldLabel:r.backgroundImage,xtype:"uxtrigger",name:"background",iconCls:"x-form-file-trigger",handler:function(t){JE.uploadFile({params:o.getFileParams(),fileTypes:"bmp;jpg;jpeg;gif;png",callback:function(e){t.setValue(e.url)}})}},{fieldLabel:r.backgroundRepeat,name:"backgroundRepeat",xtype:"rgroup",dataArray:[{code:"repeat-x",text:r.backgroundRepeatX},{code:"repeat-y",text:r.backgroundRepeatY},{code:"no-repeat",text:r.backgroundRepeatNo}]},{fieldLabel:r.borderWidth,name:"border",xtype:"numberfield",unitTpl:"px",minValue:0},{fieldLabel:r.align,name:"align",xtype:"rgroup",value:"left",dataArray:[{code:"left",text:l.left},{code:"center",text:l.center},{code:"right",text:l.right}]}].concat(Ext.value(o.tableAttrs,[])),useButton:!0,fn:function(e,t){i.execCommand("edittable",e)},showFn:function(e){var t=e.getCmp("form"),i=t.form.getValues();n&&(Ext.iterate(i,function(e,t){t=s[e]?n.getAttribute("data-"+e):-1!=["background","border","align"].indexOf(e)?n.getAttribute(e):n.style[e],i[e]=Ext.value(t,"")}),t.form.setValues(i))}}))}}},buildAlignTable:function(){var o=this.localLang.align;this.editor.commands.aligntable={queryCommandState:function(){return UE.UETable.getTableItemsByRange(this).table?0:-1},execCommand:function(e,t){var i=this,a=i.selection.getRange(),n=UE.dom.domUtils.findParentByTagName(a.startContainer,"table");n&&(t?n.setAttribute("align",Ext.value(t.align,"left")):JE.formWin({title:o.tableTitle,width:200,height:100,defaults:{columnWidth:1},items:[{name:"align",xtype:"rgroup",columns:3,dataArray:[{code:"left",text:o.left},{code:"center",text:o.center},{code:"right",text:o.right}]}],useButton:!0,fn:function(e,t){i.execCommand("aligntable",e)}}))}}},buildAlignTd:function(){var s=this.localLang.align;this.editor.commands.aligntd={queryCommandState:function(){return UE.UETable.getTableItemsByRange(this).table?0:-1},execCommand:function(e,n){var i=this,t=UE.dom.domUtils,a=UE.UETable.getUETableBySelected(i),o=[];if(a)o=a.selectedTds;else{var r=i.selection.getStart(),l=r&&t.findParentByTagName(r,["td","th","caption"],!0);l&&o.push(l)}JE.isEmpty(n)?JE.formWin({title:s.tdTitle,width:200,height:150,defaults:{columnWidth:1},items:[{name:"align",xtype:"rgroup",columns:3,dataArray:[{code:"left,top",text:s.leftTop},{code:"center,top",text:s.centerTop},{code:"right,top",text:s.rightTop},{code:"left,middle",text:s.leftMiddle},{code:"center,middle",text:s.centerMiddle},{code:"right,middle",text:s.rightMiddle},{code:"left,bottom",text:s.leftBottom},{code:"center,bottom",text:s.centerBottom},{code:"right,bottom",text:s.rightBottom}]}],useButton:!0,fn:function(e,t){i.execCommand("aligntd",e)}}):Ext.each(o,function(e){var t=Ext.value(n.align,"").split(","),i=Ext.value(t[0],"left"),a=Ext.value(t[1],"top");e.setAttribute("align",i),e.setAttribute("valign",a)})}}},fullScreen:function(e){var t=this,i={};JE.isNotEmpty(t.fullscreenToolbars)&&(i.toolbars=t.fullscreenToolbars),JE.win({title:t.localLang.winSeeTitle,useButton:!0,border:0,maximized:Ext.value(e,!1),items:{xtype:"ueditor",editorConfig:i,readOnly:Ext.value(t.readOnly,!1),value:t.getValue()},fn:function(e){t.setValue(e.items.get(0).getValue())}}).show()},buildFullScreen:function(){var i=this;i.localLang.winSeeTitle;i.editor.commands.fullscreen={queryCommandState:function(){return 0},execCommand:function(e,t){i.fullScreen(!0)}}},showTemplate:function(){var i=this,a="/static/ux/editorTpl/",e={xtype:"tabpanel",tabPosition:"left",defaults:{xtype:"panel",bodyCls:"ueditor-template",autoScroll:!0,listeners:{afterrender:function(e){var t=JE.ajax({url:a+e.file,text:!0});e.update(t),e.body.on("click",function(e){var t=e.getTarget("li.template",10,!0);t&&i.editor.execCommand("inserthtml",t.getHTML(),!0)})}}},items:JE.ajax({url:a+"config.json"})};JE.win({title:"模板",items:e,autoShow:!0,width:400,height:JE.getBodyHeight(),x:JE.getBodyWidth()-400,border:0})},showFiles:function(i,r){var l=this,s={imageTpl:'<img {attr} src="{path}" title="{name}" alt="{name}" style="width:100%;height:100%;"/>',fileTpl:'<p style="line-height: 16px;"><a {attr} style="font-size:12px; color:#0066cc;" href="{path}" title="{name}">{name}</a></p>',audioTpl:'<audio src="{path}" controls {attr} >您的浏览器不支持 audio 标签。</audio>',videoTpl:'<video src="{path}" controls {attr} >您的浏览器不支持 video 标签。</video>'},e=JE.isNotEmpty(r);JE.formWin({title:e?"编辑":"文件库",width:e?400:600,height:e?200:400,okButtonText:e?"确定":"插入文件",useButton:!0,items:[{xtype:"uxfilesfield",height:200,margin:"2 0",name:"files",hidden:e},{xtype:"cbbfield",fieldLabel:"类型",value:"file",name:"type",readOnly:e,dataArray:[{text:"附件",code:"file"},{text:"图片",code:"image"},{text:"音频",code:"audio"},{text:"视频",code:"video"}],listeners:{change:function(e,t,i){var a=[],n=[],o=e.ownerCt;"file"==t?n=["height","autoplay","download"]:"video"==t?a=["height","autoplay","download"]:"audio"==t&&(a=["autoplay","download"],n=["height"]),Ext.each(a,function(e){var t=o.form.findField(e);t.show(),t.setDisabled(!1)}),Ext.each(n,function(e){var t=o.form.findField(e);t.hide(),t.setDisabled(!0)})}}},{fieldLabel:"自动播放",hidden:!0,disabled:!0,name:"autoplay",xtype:"yesnofield"},{fieldLabel:"允许下载",hidden:!0,disabled:!0,name:"download",xtype:"yesnofield"},{fieldLabel:"高",hidden:!0,disabled:!0,xtype:"numberfield",minValue:0,name:"height",unitTpl:"px"}],showFn:function(e){var t=e.getCmp(0);JE.isNotEmpty(i)&&t.form.setValues(i)},fn:function(a,e){if(r){"1"==a.autoplay?r.setAttribute("autoplay","autoplay"):r.removeAttribute("autoplay"),0<a.height?r.setAttribute("height",a.height):r.removeAttribute("height"),r.parentNode.querySelector("div").style.display="1"==a.download?"":"none",r.setAttribute("data-values",JE.encodeURI(Ext.encode(a)))}else{var t=Ext.decode(Ext.value(a.files,"[]")),i=a.type,n=s[i+"Tpl"],o=' je-file="'+a.type+'"';-1!=["audio","video"].indexOf(a.type)&&(o+=' style="width:100%;"',"1"==a.autoplay&&(o+=' autoplay="autoplay"'),0<a.height&&(o+=' height="'+a.height+'"'),n="<div>"+n+'<div style="'+("1"==a.download?"":"display:none;")+'text-align:right;font-size:14px;"><a href="{path}" target="_blank">下载</a></div></div>'),Ext.each(t,function(e){var t=Ext.clone(a);t.files=[e],e.attr=o+' data-values="'+JE.encodeURI(Ext.encode(t))+'"';var i=JE.toXT(n,e);l.editor.execCommand("inserthtml",i,!0)})}}})},renderEditFiles:function(){var t=this,n=new baidu.editor.ui.Popup({editor:t.editor,content:"",className:"edui-bubble",_edittext:function(){var e=Ext.decode(JE.decodeURI(Ext.value(n.anchorEl.getAttribute("data-values"),"{}")));n.hide(),t.showFiles(e,n.anchorEl)},_delete:function(){var e=this.anchorEl,t="image"==e.getAttribute("je-file")?e:e.parentNode;baidu.editor.dom.domUtils.remove(t,!1),this.hide()}});n.render(),t.editor.addListener("mouseover",function(e,t){var i=(t=t||window.event).target||t.srcElement;if(i.hasAttribute("je-file")){var a=i.getAttribute("je-file");html=-1!=["audio","video"].indexOf(a)?'<span onclick=$$._edittext() class="edui-clickable">编辑</span>&nbsp;&nbsp;':"",html="<nobr>"+html+'<span onclick=$$._delete() class="edui-clickable">删除</span></nobr>',html=n.formatHtml(html),html?(n.getDom("content").innerHTML=html,n.anchorEl=i,n.showAnchor(n.anchorEl)):n.hide()}})},getErrors:function(e){var t=[],i=this.getValue();return!this.allowBlank&&Ext.isEmpty(i)&&t.push(this.blankText),t}}),Ext.define("JE.core.ux.form.UserSelector",{extend:"JE.core.ux.form.SearchSelectField",alias:["widget.vueuserfield","widget.vueuserareafield","widget.queryuserfield","widget.queryuserareafield"],initComponent:function(){var e=this.configInfo.split(",");e[2]&&(e[2]=e[2].replaceAll("USERNAME","text").replaceAll("USERCODE","code").replaceAll("USERID","id"),this.configInfo=e.join(",")),this.useArea=-1!=["queryuserareafield","vueuserareafield"].indexOf(this.xtype),this.callParent(arguments)},showWin:function(e){var t=this;e.callback=function(e){return t.setConfigInfo({datas:e,parentData:!0,self:!0}),t.fireEvent("query",t,e)},JE.vue.selectUser(e)}}),Ext.define("JE.core.ux.form.YesnoField",{extend:"Ext.form.field.Checkbox",alias:["widget.yesnofield"],inputValue:"1",uncheckedValue:"0",allowBlank:!0,readOnlyCls:Ext.baseCSSPrefix+"form-radio-readonly",initComponent:function(){this.checked=this.value==this.inputValue,"switch"==this.inputType&&(this.inputCls="je-form-switch",this.fieldSubTpl=['<div id="{cmpId}-inputEl" class="{fieldCls} {inputCls}">','<em id="{cmpId}-boxLabelEl">{boxLabel}</em>',"<i></i>","</div>"]),this.callParent(arguments)},setRawValue:function(e){return this.callParent(arguments)},getText:function(e){return e==this.inputValue?"是":"否"},afterRender:function(){this.callParent(),this.initValue()}}),Ext.define("JE.core.ux.gantt.GanttPanel",{extend:"Ext.panel.Panel",alias:"widget.jeganttview",layout:"fit",multiSelect:!1,useTaskUUID:!0,autoLoad:!1,taskModelConfig:void 0,taskStoreConfig:void 0,lockedGridConfig:void 0,schedulerConfig:void 0,initComponent:function(){var e=this;e.localLang=JE.getLocalLang("core.ux.jeganttview"),e.dateFormat="Y-m-d",e.dateSubmitFormat="Y-m-d H:i:s",e.modelFields=Ext.apply(Ext.value(e.modelFields,{}),{JE_GANTT_TASK_ID:"Id",TASK_TEXT:"Name",TASK_STARTDATE:"StartDate",TASK_ENDDATE:"EndDate",TASK_DURATION:"Duration",TASK_DURATION_UNIT:"DurationUnit",TASK_EFFORT:"Effort",TASK_EFFORT_UNIT:"EffortUnit",TASK_PERCENTDONE:"PercentDone",TASK_CLS:"Cls",TASK_FZR:"TASK_FZR",TASK_FZRID:"TASK_FZRID",TASK_CYR:"TASK_CYR",TASK_CYRID:"TASK_CYRID",TASK_REMARK:"TASK_REMARK",SY_CREATEUSERNAME:"SY_CREATEUSERNAME",SY_STATUS:"SY_STATUS"}),e.newIds=[],e.addEvents("save","import","export","load","addtask"),e.autoLoad&&(e.autoload=!0,e.autoLoad=!1),e.items=e.buildGantt(),e.tbar=e.createToolbar(),e.callParent(arguments),e.gantt=e.getCmp("gantt")},afterRender:function(){var i=this;i.callParent(arguments),i.gantt.lockedGrid.on("itemclick",function(e,t){i.gantt.getSchedulingView().scrollEventIntoView(t,!0)}),i.autoload&&i.load(i.taskData)},load:function(l){var s=this,d=(l=Ext.value(l,{}),Ext.value(l.mainID,l.modelId)),c={};s.params=l,s.modelId=d,s.newStartDate=null,s.newEndDate=null,s.clearNewIds(),JE.doMask(s,s.localLang.lodingText,function(){var e="0";if(JE.isNotEmpty(d)){var t=JE.ajax({url:JE.getUrlMaps("je.core.develop.gantt","loadGridTree"),params:{modelId:d,modelName:"",whereSql:" AND TASK_MODELID='"+d+"'",tableCode:"JE_GANTT_TASK",doTree:!0,excludes:"checked"}});e=t.rootId;var i=JE.ajax({url:JE.getUrlMaps("je.core.load"),params:{whereSql:" and LINE_MODELID = '"+d+"'",tableCode:"JE_GANTT_LINE",limit:1}}).rows[0];i=Ext.value(i,{}),lines=JE.decode(Ext.value(i.LINE_DATA,"[]")),c={tasks:s.buildTaskData(t.children),lines:lines},s.lineId=i.JE_GANTT_LINE_ID}if(s.hasListener("load")){var a=s.fireEvent("load",s,c);Ext.isObject(a)&&(c=a)}if(s.gantt.lockedGrid.setRootNode({Id:e,expanded:!0,children:Ext.value(c.tasks,[])}),s.dependencyStore.loadData(Ext.value(c.lines,[])),l.startDate&&l.endDate){var n=Ext.clone(l.startDate),o=Ext.clone(l.endDate);Ext.isString(n)&&(10==n.length&&(n+=" 00:00:00"),n=Ext.Date.clearTime(Ext.Date.parse(n,s.dateSubmitFormat))),Ext.isString(o)&&(10==o.length&&(o+=" 00:00:00"),o=Ext.Date.clearTime(Ext.Date.parse(o,s.dateSubmitFormat)));var r=s.gantt.lockedGrid.store.getTasksTimeSpan();r&&(r.start&&n.getTime()>r.start.getTime()&&(n=Ext.clone(r.start)),r.end&&o.getTime()<r.end.getTime()&&(o=Ext.clone(r.end))),s.newStartDate=n,s.newEndDate=o,s.gantt.switchViewPreset("weekAndDayLetter",n,o)}s.gantt.refreshViews()})},reload:function(){this.load(this.params)},buildGantt:function(){var e=this,t=["/static/ux/gantt/resources/css/sch-gantt-all-debug.css","/static/ux/gantt/gnt-all-min.js"];"en"!=_JE_LOCAL_LANG&&t.push("/static/ux/gantt/gnt-lang-zh_CN.js"),JE.loadScript(t,function(){"LINK"==this.nodeName&&e.gantt&&e.gantt.refreshViews()}),Gnt.plugin.TaskContextMenu.prototype.overrided||Ext.override(Gnt.plugin.TaskContextMenu,{overrided:!0,copyTask:function(e){var t=this.callParent(arguments);return t.set(t.idProperty,JE.uuid()),t.setName(this.grid.localLang.newTaskName),this.grid.ownerCt.newIds.push(t.getId()),t}});var i={xtype:"ganttpanel",itemId:"gantt",border:0,localLang:e.localLang,newIds:e.newIds,highlightWeekends:!0,showTodayLine:!0,loadMask:!0,enableProgressBarResize:!0,viewPreset:"weekAndDayLetter",leftLabelField:{dataIndex:e.modelFields.TASK_TEXT,editor:{xtype:"textfield",cls:"je-field-basiccls",clearButton:!1}},rightLabelField:{dataIndex:"TASK_REMARK",editor:{xtype:"textfield",cls:"je-field-basiccls",clearButton:!1}},lockedGridConfig:{width:538,minWidth:50,gridMinWidth:50,gridMaxWidth:840,cls:"je-grid"}},a="JE.core.ux.gantt.model.Task";return Ext.ModelManager.getModel(a)||Ext.define(a,{extend:"Gnt.model.Task",fields:[{name:"TASK_MODELID",type:"string"},{name:"TASK_FZR",type:"string"},{name:"TASK_FZRID",type:"string"},{name:"TASK_CYR",type:"string"},{name:"TASK_CYRID",type:"string"},{name:"TASK_REMARK",type:"string"},{name:"SY_CREATEUSERNAME",type:"string"},{name:"SY_CREATEUSERID",type:"string"},{name:"SY_STATUS",type:"string"}]}),JE.isNotEmpty(e.taskModelConfig)&&(a="TaskModel_"+JE.uuid(),Ext.define(a,Ext.applyIf({extend:a},e.taskModelConfig))),e.taskStore=i.taskStore=Ext.create("Gnt.data.TaskStore",Ext.apply({model:a,useTaskUUID:e.useTaskUUID,root:{Id:"0",expanded:!0,children:[]}},Ext.value(e.taskStoreConfig,{}))),e.dependencyStore=i.dependencyStore=Ext.create("Gnt.data.DependencyStore",{data:[]}),e.multiSelect&&(i.selModel=new Ext.selection.TreeModel({ignoreRightMouseSelection:!1,mode:"MULTI"})),i.plugins=[Ext.create("Gnt.plugin.TaskContextMenu",{pluginId:"taskMenu"}),Ext.create("Sch.plugin.Pan"),Ext.create("Sch.plugin.TreeCellEditing",{clicksToEdit:1})],i.tooltipTpl=Ext.value(e.tooltipTpl,new Ext.XTemplate('<h4 class="tipHeader">{Name}</h4>','<table class="taskTip">',"<tr><td>"+e.localLang.tpl.start+'</td> <td align="right">{[Ext.Date.format(values.StartDate, "y-m-d")]}</td></tr>',"<tr><td>"+e.localLang.tpl.end+'</td> <td align="right">{[Ext.Date.format(Ext.Date.add(values.EndDate, Ext.Date.MILLI, -1), "y-m-d")]}</td></tr>',"<tr><td>"+e.localLang.tpl.percentDone+'</td><td align="right">{PercentDone}%</td></tr>',"</table>").compile()),i.columns=Ext.value(e.columns,[{xtype:"wbscolumn",text:"No.",width:50,sortable:!1,menuDisabled:!0},{xtype:"uxcheckcolumn",text:e.localLang.column.bj,dataIndex:"SY_STATUS",width:38,align:"center",uncheckedCls:"je_config_unstart",checkedCls:"je_config_start"},{xtype:"treecolumn",header:e.localLang.column.task,sortable:!0,dataIndex:e.modelFields.TASK_TEXT,width:190,field:{allowBlank:!1,clearButton:!1,cls:"je-field-basiccls"},renderer:function(e,t,i){return i.data.leaf||(t.tdCls="sch-gantt-parent-cell"),t.tdAttr=" title='"+e+"'",e}},{xtype:"gridcolumn",width:80,dataIndex:"TASK_FZR",align:"center",text:e.localLang.column.fzr,field:{xtype:"queryuserfield",clearButton:!1,cls:"je-field-basiccls",configInfo:"JE_CORE_QUERYUSER,TASK_FZR~TASK_FZRID,USERNAME~USERID,S"}},{xtype:"startdatecolumn",editorFormat:e.dateFormat,width:90,align:"center",format:e.dateFormat,field:{hideTrigger1:!1,cls:"je-field-basiccls",clearButton:!1}},{xtype:"enddatecolumn",editorFormat:e.dateFormat,width:90,align:"center",format:e.dateFormat,field:{hideTrigger1:!1,cls:"je-field-basiccls",clearButton:!1}},{xtype:"durationcolumn",width:50,align:"center",field:{cls:"je-field-basiccls",clearButton:!1}},{xtype:"percentdonecolumn",format:"0%",width:50,field:{cls:"je-field-basiccls",clearButton:!1}},{xtype:"gridcolumn",width:150,dataIndex:"TASK_CYR",text:e.localLang.column.cyr,field:{xtype:"queryuserfield",cls:"je-field-basiccls",clearButton:!1,configInfo:"JE_CORE_QUERYUSER,TASK_CYR~TASK_CYRID,USERNAME~USERID,M"}}]),i},doSave:function(){var n=this,e=n.taskStore.getNewRecords().concat(n.taskStore.getUpdatedRecords()),t=n.taskStore.getRemovedRecords(),o=[],i=[];if(Ext.each(e,function(e){var i={},a=[],t=e.getId();-1==n.newIds.indexOf(t)?(a=e.getChanges(),i.__action__="doUpdate"):(a=e.data,i.__action__="doInsert"),Ext.iterate(n.modelFields,function(e,t){a[t]&&(i[e]=a[t],-1!=["StartDate","EndDate"].indexOf(t)&&(i[e]=Ext.Date.format(i[e],n.dateSubmitFormat)))}),Ext.apply(i,{JE_GANTT_TASK_ID:t,TASK_MODELID:n.modelId,SY_ORDERINDEX:e.get("index"),SY_LAYER:e.getDepth(),SY_PATH:e.parentNode.getPath().replaceAll("/",",").substring(1),SY_PARENT:e.parentNode.getId(),SY_NODETYPE:e.isLeaf()?"LEAF":"GENERAL"}),o.push(i),e.commit()}),Ext.each(t,function(e){-1==n.newIds.indexOf(e.getId())&&i.push(e.getId()),e.commit()}),n.clearNewIds(),JE.isNotEmpty(o))var a=JE.ajax({url:JE.getUrlMaps("je.core.develop.gantt","doInsertUpdateList"),params:{tableCode:"JE_GANTT_TASK",strData:Ext.encode(o)}});if(JE.isNotEmpty(i))a=JE.ajax({url:JE.getUrlMaps("je.core.remove"),params:{tableCode:"JE_GANTT_TASK",ids:i.join(",")}});if(JE.isNotEmpty(n.dependencyStore.getModifiedRecords())){var r=[];n.dependencyStore.each(function(e){r.push(e.data)}),(a=JE.ajax({url:JE.getUrlMaps("je.core",JE.isEmpty(n.lineId)?"save":"update"),params:{tableCode:"JE_GANTT_LINE",LINE_MODELID:n.modelId,LINE_DATA:Ext.encode(r),JE_GANTT_LINE_ID:Ext.value(n.lineId,"")}})).success&&(n.lineId=a.obj.JE_GANTT_LINE_ID)}JE.msg(n.localLang.saveSuccessMsg)},clearNewIds:function(){this.newIds=[]},buildTaskData:function(e){var t=[],n=this;return Ext.each(e,function(i){var a={};Ext.iterate(n.modelFields,function(e,t){a[t]=i[e]}),a.children=n.buildTaskData(i.children),a.leaf=JE.isEmpty(a.children),t.push(a)}),t},createToolbar:function(){var a=this;return{cls:"je-button-bar",defaults:{listeners:{beforeclick:function(e){if(JE.isEmpty(a.modelId))return JE.alert(a.localLang.noModelId),!1}}},items:[{text:a.localLang.tbar.add,iconCls:JE.getIconCls({iconCls:"jeicon jeicon-new-form",fontIconCls:"fa fa-plus"}),cls:"JEPLUS_B_C01",handler:function(){var e=a.gantt.getPlugin("taskMenu");e.rec=null,e.addTaskBelowAction()}},{text:a.localLang.tbar.save,iconCls:JE.getIconCls({iconCls:"jeicon jeicon-form-save",fontIconCls:"fa fa-save"}),cls:"JEPLUS_B_C03",handler:function(){a.doSave()}},{text:a.localLang.tbar.refresh,iconCls:JE.getIconCls({iconCls:"jeicon jeicon-refresh",fontIconCls:"fa fa-refresh"}),cls:"JEPLUS_B_L10",handler:function(){a.reload()}},"->",{text:a.localLang.tbar.collapse,iconCls:"fa fa-compress",iconCls1:"fa fa-compress",iconCls2:"fa fa-expand",handler:function(e){e.text==a.localLang.tbar.collapse?(a.gantt.collapseAll(),e.setText(a.localLang.tbar.expand),e.setIconCls(e.iconCls2)):(a.gantt.expandAll(),e.setText(a.localLang.tbar.collapse),e.setIconCls(e.iconCls1))}},{text:a.localLang.tbar.zoomToFit,iconCls:"fe icon-resize-full-4",iconCls1:"fe icon-resize-full-4",iconCls2:"fe icon-resize-small-3",handler:function(e){e.text==a.localLang.tbar.zoomToFit?(a.gantt.zoomToFit(),e.setText(a.localLang.tbar.recover),e.setIconCls(e.iconCls2)):(a.gantt.switchViewPreset("weekAndDayLetter",Ext.value(a.newStartDate,a.startDate),Ext.value(a.newEndDate,a.endDate)),e.setText(a.localLang.tbar.zoomToFit),e.setIconCls(e.iconCls1))}},{text:"列表",iconCls:"fa fa-arrow-right",iconCls1:"fa fa-arrow-right",iconCls2:"fa fa-arrow-left",handler:function(e){"列表"==e.text?(a.gantt.lockedGrid.setWidth(a.gantt.lockedGrid.gridMaxWidth),e.setText("视图"),e.setIconCls(e.iconCls2)):(a.gantt.lockedGrid.setWidth(a.gantt.lockedGrid.gridMinWidth),e.setText("列表"),e.setIconCls(e.iconCls1))}},{xtype:"uxtrigger",emptyText:a.localLang.tbar.queryEmtpyText,width:200,handler:function(e){var t=e.getValue(),i=[];JE.isNotEmpty(t)&&a.taskStore.getRootNode().cascadeBy(function(e){0==e.get("Name").toLowerCase().indexOf(t.toLowerCase())&&(i.push(e),a.gantt.lockedGrid.expandPath(e.getPath()),a.gantt.getSchedulingView().scrollEventIntoView(e,!0))}),a.gantt.lockedGrid.getSelectionModel().select(i),e.focus()}}]}}}),Ext.define("JE.core.ux.JCrop",{extend:"Ext.panel.Panel",alias:"widget.uxjcrop",autoScroll:!0,cls:"je-JCrop",initComponent:function(){var n=this;n.cls=Ext.value(n.cls,"")+" je-ux-jcrop";JE.loadScript(["/static/ux/jqueryCropper/cropper.min.js","/static/ux/jqueryCropper/cropper.min.css","/static/ux/jqueryCropper/jquery-cropper.min.js"]),n.data={path:n.params.path},n.tpl='<img src="{path}">',n.buttonAlign="center",n.buttons=[{text:"更换图片",handler:function(){JE.uploadFile({fileTypes:"jpg;png;jpeg;bmp",jeFileType:"PROJECT",type:"local",params:{funcCode:"JE_CORE_CUTIMG",beanTableCode:"JE_CORE_CUTIMG",jeFileType:"PROJECT",returnType:"all"},callback:function(e){if(Ext.isIE9m){var t=e.privateUrl||JE.getFileUrl(e.url,"","","","JE_CORE_CUTIMG");$(n.body.down("img").dom).cropper("replace",t,!0)}else{var i=new FileReader,a=e.files[0];i.readAsDataURL(a),i.onload=function(){$(n.body.down("img").dom).cropper("replace",this.result,!0)}}}})}},{text:"裁剪",handler:function(){var e=$(n.body.down("img").dom).cropper("getCroppedCanvas").toDataURL("image/jpeg");n.params.path=e,n.callback(n.params),n.up("window").close()}},{text:"取消",handler:function(){$(n.body.down("img").dom).cropper("destroy"),n.up("window").close()}}],n.callParent(arguments)},afterRender:function(){this.callParent(arguments),this.initUX(this.params.path)},initUX:function(e){var i=this,t=i.body.down("img");i.params={width:0,height:0,x:0,y:0,path:e},$(t.dom).cropper({aspectRatio:1,viewMode:1,crop:function(e){var t={x:e.detail.x,y:e.detail.y,width:e.detail.width,height:e.detail.height};Ext.apply(i.params,t)}})}}),Ext.define("JE.core.ux.Map",{extend:"Ext.panel.Panel",alias:"widget.uxmap",autoScroll:!0,layout:"border",initComponent:function(){var e=this;e.tbar={itemId:"bar",height:40,padding:0,defaults:{margin:0,height:40},items:[{xtype:"textfield",itemId:"keyword",emptyText:"请输入您要查询的地点",fieldStyle:"border-width:0px;padding:0 10px;font-size:14px;",flex:1},{xtype:"button",cls:"btn JEPLUS_B_C01",text:"确定",textStyle:"font-size:14px;",width:80,handler:function(){e.callback&&e.callback(e.getLocation()),e.up("window").close()}}]},e.callParent(arguments)},afterRender:function(){this.callParent(arguments),this.keyword=this.getDockedCmp("bar").getCmp("keyword"),this.window=this.up("window"),this.initMap()},initMap:function(){if(window.BMap){var e="tangram-suggestion-main";Ext.get(e)||Ext.util.CSS.createStyleSheet(".tangram-suggestion-main{z-index: 999999}",e);var a=this;a.keyword;a.Map=map=new BMap.Map(a.body.id),map.centerAndZoom("北京",12),map.enableScrollWheelZoom(!0),a.MapAC=new BMap.Autocomplete({input:a.keyword.inputEl.id,location:map}),a.MapAC.addEventListener("onconfirm",function(e){var t=e.item.value,i=t.province+t.city+t.district+t.street+t.streetNumber+t.business;a.setLocation(Ext.apply(t,{address:i})),a.MapLocal.search(i)}),a.MapLocal=new BMap.LocalSearch(map,{onSearchComplete:function(e){var t=e.getPoi(0);t&&(a.address=a.keyword.getValue(),a.initLocation(t.point))}}),a.point?a.initLocation(a.point):a.address&&a.MapLocal.search(a.address)}else JE.alert("没有检测到百度地图插件，请检查！")},initLocation:function(n,e){var o=this,t=new BMap.Geocoder;n=n,t.getLocation(n,function(e){var t=e.addressComponents,i=e.address;if(t.address=o.address||i,t.point=n,o.setLocation(t),o.MapAC.setInputValue(t.address),o.MapAC.hide(),o.Map.centerAndZoom(n,18),0!=a){o.Map.clearOverlays();var a=new BMap.Marker(n);o.Map.addOverlay(a),a.setAnimation(BMAP_ANIMATION_BOUNCE),a.enableDragging(),a.addEventListener("dragend",function(){delete o.address,o.initLocation(a.getPosition(),!1)})}})},setLocation:function(e){var t=this.mapLocation||{};this.mapLocation=Ext.apply(t,e)},getLocation:function(){var e=this.mapLocation||{};return e.address=Ext.value(e.address,this.keyword.getValue()),e}}),Ext.define("JE.core.ux.mxgraph.cells.ArrowCells",{extend:"Ext.panel.Panel",alias:"widget.mxgraph.arrowcells",initComponent:function(){this.callParent(arguments)},initCells:function(e){this.editor=Ext.value(e,this.editor),this.editor&&this.editor.loadCell({url:this.editor.getStencilPath()+"/arrows.xml",content:this.body,style:";fillColor=#ffffff;strokeColor=#000000;strokeWidth=2"})}}),Ext.define("JE.core.ux.mxgraph.cells.BasicCells",{extend:"Ext.panel.Panel",alias:"widget.mxgraph.basiccells",initComponent:function(){this.callParent(arguments)},initCells:function(e){this.editor=Ext.value(e,this.editor),this.editor&&this.editor.loadCell({url:this.editor.getStencilPath()+"/basic.xml",content:this.body,style:";fillColor=#ffffff;strokeColor=#000000;strokeWidth=2"})}}),Ext.define("JE.core.ux.mxgraph.cells.FlowchartCells",{extend:"Ext.panel.Panel",alias:"widget.mxgraph.flowchartcells",initComponent:function(){this.callParent(arguments)},initCells:function(e){this.editor=Ext.value(e,this.editor),this.editor&&this.editor.loadCell({url:this.editor.getStencilPath()+"/flowchart.xml",content:this.body,style:";fillColor=#ffffff;strokeColor=#000000;strokeWidth=2"})}}),Ext.define("JE.core.ux.mxgraph.cells.GeneralCells",{extend:"Ext.panel.Panel",alias:"widget.mxgraph.generalcells",initComponent:function(){this.callParent(arguments)},initCells:function(e){var t=this;if(t.editor=Ext.value(e,t.editor),t.editor){var i=[{style:"swimlane",width:200,height:200,value:"容器",type:"vertex"},{style:"swimlane;horizontal=0",width:200,height:200,value:"容器",type:"vertex"},{style:"text",width:40,height:26,value:"文本",type:"vertex"},{style:null,width:120,height:60,value:"",type:"vertex"},{style:"rounded=1",width:120,height:60,value:"",type:"vertex"},{style:"ellipse",width:80,height:80,value:"",type:"vertex"},{style:"ellipse;shape=doubleEllipse",width:80,height:80,value:"",type:"vertex"},{style:"triangle",width:60,height:80,value:"",type:"vertex"},{style:"rhombus",width:80,height:80,value:"",type:"vertex"},{style:"shape=hexagon",width:120,height:80,value:"",type:"vertex"},{style:"shape=actor;verticalLabelPosition=bottom;verticalAlign=top",width:40,height:60,value:"",type:"vertex"},{style:"ellipse;shape=cloud",width:120,height:80,value:"",type:"vertex"},{style:"shape=cylinder",width:60,height:80,value:"",type:"vertex"},{style:"line",width:160,height:10,value:"",type:"vertex"},{style:"line;direction=south",width:10,height:160,value:"",type:"vertex"},{style:"shape=xor",width:60,height:80,value:"",type:"vertex"},{style:"shape=or",width:60,height:80,value:"",type:"vertex"},{style:"shape=step",width:120,height:80,value:"",type:"vertex"},{style:"shape=tape",width:120,height:100,value:"",type:"vertex"},{style:"shape=cube",width:120,height:80,value:"",type:"vertex"},{style:"shape=note",width:80,height:100,value:"",type:"vertex"},{style:"shape=folder",width:120,height:120,value:"",type:"vertex"},{style:"shape=card",width:60,height:80,value:"",type:"vertex"},{style:"shape=plus",width:20,height:20,value:"",type:"vertex"}].concat([{style:"edgeStyle=none;endArrow=none;",width:100,height:100,type:"edge"},{style:"edgeStyle=none;",width:100,height:100,type:"edge"},{style:"edgeStyle=elbowEdgeStyle;elbow=horizontal",width:100,height:100,type:"edge"},{style:"edgeStyle=elbowEdgeStyle;elbow=vertical",width:100,height:100,type:"edge"},{style:"edgeStyle=entityRelationEdgeStyle",width:100,height:100,type:"edge"},{style:"edgeStyle=segmentEdgeStyle",width:100,height:100,type:"edge"},{style:"shape=link",width:100,height:100,type:"edge"},{style:"arrow",width:100,height:100,type:"edge"}]);Ext.each(i,function(e){t.body.appendChild(t.editor.createCell(e))})}}}),Ext.define("JE.core.ux.mxgraph.cells.IndustryCells",{extend:"Ext.panel.Panel",alias:"widget.mxgraph.industrycells",layout:"fit",initComponent:function(){this.callParent(arguments)},initCells:function(e){if(this.editor=Ext.value(e,this.editor),this.editor){this.editor.imageFolder;var n=JE.getStatucUrl("JE.core.ux.mxgraph.cells.IndustryCells.image"),t=JE.getStatucUrl("JE.core.ux.mxgraph.cells.IndustryCells.自定义"),i=[{node:"background",value:"背景",style:"image;image="+n,width:500,height:500},{node:"switch",value:"开关",style:"image;image="+n,width:40,height:40},{node:"scale",value:"刻度",style:"verticalLabelPosition=bottom;verticalAlign=top",width:40,height:100},{node:"light",value:"阀门",style:"shape=mxgraph.flowchart.collate",width:10,height:20},{node:"light",value:"指示灯",style:"ellipse",width:40,height:40},{node:"light",value:"指示灯",image:"指示灯2",style:"rounded=0;whiteSpace=wrap;",width:40,height:40},{node:"text",value:"文字",style:"text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;",width:40,height:20},{node:"text",value:"文本域",style:"rounded=0;whiteSpace=wrap;",width:120,height:60},{node:"custom",value:"自定义",style:"image;image="+t,width:40,height:40},{node:"path",value:"直线",style:"endArrow=none;html=1;rounded=0;",width:100,height:100,type:"edge"},{node:"path",value:"折线",style:"edgeStyle=segmentEdgeStyle;endArrow=none;html=1;rounded=0;",width:100,height:100,type:"edge"}],o=mxUtils.createXmlDocument(),r=this.editor.editorUI.sidebar,l=[];Ext.each(i,function(e){var t,i=o.createElement(Ext.value(e.node,"node"));if(i.setAttribute("name",Ext.value(e.value,"")),i.setAttribute("type",Ext.value(e.node,"")),i.setAttribute("label",Ext.value(e.label,"")),"edge"==e.type)i.setAttribute("defaultStyle",e.style+"strokeColor=#d9d9d9;strokeWidth=3;"),t=r.createEdgeTemplateEntry(e.style,e.width,e.height,i,"",!1,"");else if(JE.isNotEmpty(e.style)&&i.setAttribute("defaultStyle",e.style),i.setAttribute("defaultWidth",e.width),i.setAttribute("defaultHeight",e.height),"阀门"==e.value)t=r.createVertexTemplateEntry(e.style,20,30,i,e.value,!1,!0);else{i.setAttribute("image",n);var a=JE.getStatucUrl("JE.core.ux.mxgraph.cells.IndustryCells."+(e.image||e.value));t=r.createVertexTemplateEntry("image;image="+a,35,35,i,e.value,!1,!0)}l.push(t)}),r.addPaletteFunctions(this.body.dom,l)}}}),Ext.define("JE.core.ux.mxgraph.cells.WorkFlowCells",{extend:"Ext.panel.Panel",alias:"widget.mxgraph.workflowcells",layout:"fit",initComponent:function(){this.callParent(arguments)},initCells:function(e){var r=this;if(r.editor=Ext.value(e,r.editor),r.editor){var t="rounded=1;strokeColor=#3366FF;fillColor=#F8F8FF;strokeWidth=3;",i=[{node:"start",img:"start",value:"开始"},{node:"end",img:"end",value:"结束"},{node:"decision",img:"decision",value:"判断"},{node:"task",style:t,width:80,height:40,value:"任务"},{node:"batchtask",style:t,width:80,height:40,value:"多人审批"},{node:"fork",img:"fork",value:"分支"},{node:"join",img:"join",value:"聚合"},{node:"countersign",img:"countersign",value:"会签"},{node:"joint",img:"joint",value:"候选"},{node:"to_assignee",img:"to_assignee",value:"固定人"},{node:"process",img:"child_flow",value:"子流程"},{node:"auto",img:"auto",value:"自动"},{style:"text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;",width:40,height:26,value:"文本",label:"文本"},{node:"circular",img:"circular",value:"自由"},{style:"swimlane",width:200,height:400,value:"泳道"},{style:"swimlane;horizontal=0",width:400,height:200,value:"泳道"}];r.editor.getStencilPath();r.editor.taskStyles={};var l=mxUtils.createXmlDocument(),s=r.editor.editorUI.sidebar,d=[];Ext.each(i,function(e){var t=l.createElement(Ext.value(e.node,"node"));t.setAttribute("label",Ext.value(e.label,"")),t.setAttribute("name",e.value),t.setAttribute("type",Ext.value(e.node,""));var i=t,a=e.style||"image;image="+JE.getStaticUrl("JE.core.ux.mxgraph.cells.WorkFlowCells."+e.img);Ext.isEmpty(e.node)||(r.editor.taskStyles[e.node]=a);var n=""!=t.getAttribute("label"),o=s.createVertexTemplateEntry(a,e.width||48,e.height||48,i,e.value,n,!0);d.push(o)}),s.addPaletteFunctions(r.body.dom,d)}}}),Ext.define("JE.core.ux.mxgraph.Cells",{extend:"Ext.panel.Panel",alias:"widget.mxgraph.cells",layout:{type:"accordion",animate:!0},split:!0,collapsible:!0,hideCollapseTool:!0,titleCollapse:!0,collapseMode:"mini",width:170,initComponent:function(e){var i=this,a=[];i.defaults={border:1,autoScroll:!0,layout:"fit",bodyPadding:5,xtype:"panel",listeners:{expand:function(e){e.initCelled||(e.initCells?e.initCells(i.editor):e.fn&&i.editor.editorUI.sidebar[e.fn](e.body.dom),e.initCelled=!0)}}},Ext.each(i.cells,function(e){var t=Ext.clone(i.cellItems[e]);t.title=i[e+"Title"]||t.title,a.push(t)}),i.items=a,i.callParent(arguments)},cells:["general","basic","flowchart","arrow"],cellItems:{workflow:{title:"【工作流】",xtype:"mxgraph.workflowcells",iconCls:"jeicon jeicon-user-department"},general:{title:"【常用】",fn:"addGeneralPalette",iconCls:"jeicon jeicon-circular-o"},basic:{title:"【元素】",fn:"addBasicPalette",iconCls:"jeicon jeicon-pie-chart"},flowchart:{title:"【流程】",fn:"addFlowchartPalette",iconCls:"jeicon jeicon-sitemap-three"},arrow:{title:"【箭头】",fn:"addArrowsPalette",iconCls:"jeicon jeicon-arrow"}},afterRender:function(){this.callParent(arguments),this.getCmp(0).fireEvent("expand",this.getCmp(0))}}),Ext.define("JE.core.ux.mxgraph.Graph",{extend:"Ext.panel.Panel",alias:"widget.mxgraph.graph",autoScroll:!1,layout:"fit",outline:!0,initComponent:function(){this.items=this.items||this.buildGraphBox(),delete this.bodyStyle,this.callParent(arguments),this.on("destroy",function(e){e.editor&&e.editor.editor.graph.setEnabled(!1)})},getGraphEl:function(){return this.getCmp("graphBox").getEl()},buildGraphBox:function(){return{xtype:"box",itemId:"graphBox",autoScroll:!1,style:this.bodyStyle}},afterRender:function(){this.callParent(arguments),this.outline&&(this.outlineWin=this.add({xtype:"mxgraph.outline",editor:this.editor,constrain:!0})),this.editor&&this.editor.renderTo(this)},buildTbar:function(e){var n=this.editor;e=Ext.value(e,24);if(!n)return[];var t=[{iconCls:"jeicon jeicon-print",ref:"print",tooltip:"打印"},{iconCls:"jeicon jeicon-one-one",ref:"resetView",tooltip:"原始大小"},{iconCls:"jeicon jeicon-amplification1",ref:"zoomIn",tooltip:"放大"},{iconCls:"jeicon jeicon-reduce",ref:"zoomOut",tooltip:"缩小"},"-",{iconCls:"jeicon jeicon-upper-alignment",ref:"topAlign",tooltip:"上对齐"},{iconCls:"jeicon jeicon-right-alignment",ref:"rightAlign",tooltip:"右对齐"},{iconCls:"jeicon jeicon-lower-alignment",ref:"bottomAlign",tooltip:"下对齐"},{iconCls:"jeicon jeicon-left-alignment",ref:"leftAlign",tooltip:"左对齐"},{iconCls:"jeicon jeicon-vertical-alignment",ref:"middleAlign",tooltip:"垂直居中"},{iconCls:"jeicon jeicon-transverse-alignment",ref:"centerAlign",tooltip:"水平居中"},"-",{iconCls:"jeicon jeicon-topping",ref:"toFront",tooltip:"向前"},{iconCls:"jeicon jeicon-set-at-the-end",ref:"toBack",tooltip:"向后"},"-",{iconCls:"jeicon jeicon-thumbnail",ref:"outline",tooltip:"缩略图"}];return Ext.each(t,function(a){Ext.isString(a)||(a.enableToggle?a.toggleHandler=function(e,t){var i=n.editor.defaultEdge.getStyle();i=mxUtils.setStyle(i,a.styleAttr,t?a.toggleValue:a.unToggleValue),n.editor.defaultEdge.setStyle(i)}:JE.isNotEmpty(a.ref)&&(a.handler=function(){n.doAction(a.ref)}))}),t}}),Ext.define("JE.core.ux.mxgraph.Menu",{extend:"Ext.menu.Menu",alias:"widget.mxgraph.menu",ignoreParentClicks:!0,width:150,initComponent:function(){var e=this,t=[];t.push({text:"剪切",itemId:"cut",iconCls:"jeicon jeicon-scissors",handler:e.doItemClick}),t.push({text:"复制",itemId:"copy",iconCls:"jeicon jeicon-chart-copy",handler:e.doItemClick}),t.push({text:"粘贴",itemId:"paste",iconCls:"jeicon jeicon-paste",handler:e.doItemClick}),t.push("-"),t.push({text:"删除",itemId:"delete",iconCls:"jeicon jeicon-error",handler:e.doItemClick}),t.push("-"),t.push({text:"撤销",itemId:"undo",iconCls:"jeicon jeicon-rejected",handler:e.doItemClick}),t.push({text:"恢复",itemId:"redo",iconCls:"jeicon jeicon-refresh",handler:e.doItemClick}),t.push("-"),t.push(e.fontItems()),t.push(e.formatItems()),t.push("-"),t.push({text:"清空画布",itemId:"removeAll",iconCls:"jeicon jeicon-trash",handler:e.doItemClick}),t.push("-"),t.push({text:"选择全部",itemId:"selectAll",iconCls:"jeicon jeicon-check",handler:e.doItemClick}),e.items=t,e.callParent()},refreshItems:function(){var e=this,t=Ext.isEmpty(e.cells),i=e.editor.editor;e.getComponent("delete").setDisabled(t),e.getComponent("cut").setDisabled(t),e.getComponent("copy").setDisabled(t),e.getComponent("paste").setDisabled(Ext.isEmpty(mxClipboard.cells)),e.getComponent("undo").setDisabled(!i.undoManager.canUndo()),e.getComponent("redo").setDisabled(!i.undoManager.canRedo()),e.getComponent("font")&&e.getComponent("font").setDisabled(t),e.getComponent("format")&&e.getComponent("format").setDisabled(t)},fontItems:function(){var t=this,e={text:"字体",itemId:"font",iconCls:"text_16",menu:{ignoreParentClicks:!0,ref:"mxMenu"}},i=[],a=[];return Ext.each(["黑体","宋体","楷体","幼圆"],function(e){a.push({text:"<font face="+e+">"+e+"</font>",itemId:e,mxStyleKeys:[mxConstants.STYLE_FONTFAMILY],mxStyleValues:[e],handler:t.doItemClick})}),i.push({text:"样式",itemId:"fontFamily",iconCls:"fontfamily_16",menu:{ignoreParentClicks:!0,ref:"mxMenu",items:a}}),i.push(t.createNumber({text:"大小",itemId:"fontSize",iconCls:"fontsize_16",mxStyleKeys:[mxConstants.STYLE_FONTSIZE]})),i.push("-"),i.push({text:"<b>粗体</b>",itemId:"bold",iconCls:"blod_16",handler:t.doItemClick}),i.push({text:"<i>斜体</i>",itemId:"italic",iconCls:"italic_16",handler:t.doItemClick}),i.push({text:"<u>下划线</u>",itemId:"underline",iconCls:"underline_16",handler:t.doItemClick}),i.push({text:"位置",itemId:"position",iconCls:"position_16",menu:{ignoreParentClicks:!0,ref:"mxMenu",items:["<b class=menu-title>水平</b>",{text:"左",itemId:"left",iconCls:"position_left_16",handler:t.doItemClick,mxStyleKeys:[mxConstants.STYLE_LABEL_POSITION,mxConstants.STYLE_ALIGN],mxStyleValues:[mxConstants.ALIGN_LEFT,mxConstants.ALIGN_RIGHT]},{text:"中",itemId:"center",iconCls:"position_center_16",handler:t.doItemClick,mxStyleKeys:[mxConstants.STYLE_LABEL_POSITION,mxConstants.STYLE_ALIGN],mxStyleValues:[mxConstants.ALIGN_CENTER,mxConstants.ALIGN_CENTER]},{text:"右",itemId:"right",iconCls:"position_right_16",handler:t.doItemClick,mxStyleKeys:[mxConstants.STYLE_LABEL_POSITION,mxConstants.STYLE_ALIGN],mxStyleValues:[mxConstants.ALIGN_RIGHT,mxConstants.ALIGN_LEFT]},"<b class=menu-title>垂直</b>",{text:"上",itemId:"top",iconCls:"position_top_16",handler:t.doItemClick,mxStyleKeys:[mxConstants.STYLE_VERTICAL_LABEL_POSITION,mxConstants.STYLE_VERTICAL_ALIGN],mxStyleValues:[mxConstants.ALIGN_TOP,mxConstants.ALIGN_BOTTOM]},{text:"中",itemId:"middle",iconCls:"position_middle_16",handler:t.doItemClick,mxStyleKeys:[mxConstants.STYLE_VERTICAL_LABEL_POSITION,mxConstants.STYLE_VERTICAL_ALIGN],mxStyleValues:[mxConstants.ALIGN_MIDDLE,mxConstants.ALIGN_MIDDLE]},{text:"下",itemId:"bottom",iconCls:"position_bottom_16",handler:t.doItemClick,mxStyleKeys:[mxConstants.STYLE_VERTICAL_LABEL_POSITION,mxConstants.STYLE_VERTICAL_ALIGN],mxStyleValues:[mxConstants.ALIGN_BOTTOM,mxConstants.ALIGN_TOP]}]}}),i.push("-"),i.push(t.createColor({text:"字体颜色",itemId:"fontColor",mxStyleKeys:[mxConstants.STYLE_FONTCOLOR],iconCls:"fontcolor_16"})),i.push(t.createColor({text:"背景颜色",itemId:"backgroundColor",iconCls:"bgcolor_16",mxStyleKeys:[mxConstants.STYLE_LABEL_BACKGROUNDCOLOR]})),i.push(t.createColor({text:"边框颜色",itemId:"borderColor",iconCls:"bordercolor_16",mxStyleKeys:[mxConstants.STYLE_LABEL_BORDERCOLOR]})),e.menu.items=i,e},formatItems:function(){var e={text:"样式",itemId:"format",iconCls:"format_16",menu:{ignoreParentClicks:!0,ref:"mxMenu"}},t=[];return t.push(this.createColor({text:"填充色",itemId:"fillColor",iconCls:"fillcolor_16",mxStyleKeys:[mxConstants.STYLE_FILLCOLOR]})),t.push(this.createColor({text:"线颜色",itemId:"strokeColor",iconCls:"linecolor_16",mxStyleKeys:[mxConstants.STYLE_STROKECOLOR]})),t.push({text:"虚线",itemId:"dashed",iconCls:"dashed_16",handler:this.doItemClick}),t.push("-"),t.push({text:"圆角",itemId:"rounded",iconCls:"rounded_16",handler:this.doItemClick}),t.push(this.createNumber({text:"线宽",itemId:"lineSize",iconCls:"width_16",mxStyleKeys:[mxConstants.STYLE_STROKEWIDTH]})),t.push(this.createNumber({text:"透明度",itemId:"opacity",iconCls:"opacity_16",mxStyleKeys:[mxConstants.STYLE_OPACITY]})),e.menu.items=t,e},doItemClick:function(e){if(!Ext.isEmpty(e.itemId)){var t=e.up("menu[xtype=mxgraph.menu]");Ext.isEmpty(e.mxStyleKeys)||Ext.isEmpty(e.mxStyleValues)?t.editor.doAction(e.itemId):t.editor.doStyleAction(e.mxStyleKeys,e.mxStyleValues)}},createColor:function(e){var i=this,t=e.mxStyleKeys;return{text:e.text,itemId:e.itemId,iconCls:e.iconCls,menu:{ignoreParentClicks:!0,ref:"mxMenu",listeners:{show:function(e){var t=e.items.get(0);t&&t.value&&(t.el.down("a.color-"+t.value).removeCls(t.selectedCls),t.value=null)}},items:[{xtype:"colorpicker",mxStyleKeys:t,listeners:{select:function(e,t){i.editor.doStyleAction(e.mxStyleKeys,["#"+t])}}},"-",{xtype:"trigger",mxStyleKeys:t,emptyText:"自定义,如#FFFFFF...",trigger2Cls:"x-form-color-trigger",ref:"colorTrigger",cls:"je-field-basiccls",onTrigger2Click:function(){i.editor.doStyleAction(this.mxStyleKeys,[this.getValue()])}}]}}},createNumber:function(e){var a=this;return{xtype:"numberfield",itemId:e.itemId,cls:"je-field-basiccls",mxStyleKeys:e.mxStyleKeys,fieldLabel:'<input type="button" class="'+e.iconCls+' x-form-cb" style="margin-bottom:5px;margin-left:-5px;"/>',labelSeparator:"",margin:"0",labelWidth:30,minValue:0,emptyText:e.text,listeners:{change:function(e,t,i){a.editor.doStyleAction(e.mxStyleKeys,[e.getValue()])}}}}}),Ext.define("JE.core.ux.mxgraph.Outline",{extend:"Ext.window.Window",alias:"widget.mxgraph.outline",closeAction:"hide",layout:"fit",height:200,width:200,title:"缩略图",bodyStyle:"background-color:#FFFFFF;",initComponent:function(){this.items={xtype:"box",itemId:"box"},this.on({resize:function(e,t,i,a,n){e.editor&&(e.editor.outline.update(!1),e.editor.outline.outline.sizeDidChange())}}),this.callParent(arguments)},afterRender:function(){this.callParent(arguments)}}),Ext.define("JE.core.ux.mxgraph.util.Action",{doAction:function(e){this.editorUI.actions.doAction(e)},doStyleAction:function(e,a){var n=this.editor;Ext.each(e,function(e,t){var i=a[t];n.graph.setCellStyles(e,i)})},addAction:function(e,t){this.editorUI.actions.addAction(e,t)},initAction:function(){var t=this,i=t.editorUI.editor,a=i.graph;t.addAction("topAlign",function(){a.alignCells(mxConstants.ALIGN_TOP)}),t.addAction("rightAlign",function(){a.alignCells(mxConstants.ALIGN_RIGHT)}),t.addAction("bottomAlign",function(){a.alignCells(mxConstants.ALIGN_BOTTOM)}),t.addAction("leftAlign",function(){a.alignCells(mxConstants.ALIGN_LEFT)}),t.addAction("middleAlign",function(){a.alignCells(mxConstants.ALIGN_MIDDLE)}),t.addAction("centerAlign",function(){a.alignCells(mxConstants.ALIGN_CENTER)}),t.addAction("removeAll",function(){JE.confirm("清空画布后，将丢失所有信息，确定清空吗？",function(e){"ok"==e&&(a.getModel().clear(),i.cellNames={})})}),t.addAction("outline",function(){t.showOutline()}),t.addAction("print",function(){JE.dialog("打印预览",function(e){"preview"==e?t.preview():"print"==e&&t.preview(!0)},{buttons:{preview:{text:"预览",btnClass:"btn-blue"},print:{text:"打印",btnClass:"btn-blue"},cancel:{text:"取消",keys:["esc"]}}})})}}),Ext.define("JE.core.ux.mxgraph.util.Cells",{thumbWidth:30,thumbHeight:30,thumbBorder:2,thumbStyle:"",createCell:function(e){return"edge"==e.type?this.createEdgeTemplate(e.style,e.width,e.height,e.value):this.createVertexTemplate(e.style,e.width,e.height,e.value)},loadCell:function(e){var t=e.url,o=e.content,r=e.style,l=e.ignore,s=this;mxStencilRegistry.loadStencilSet(t,mxUtils.bind(this,function(e,t,i,a,n){(null==l||mxUtils.indexOf(l,t)<0)&&o.appendChild(s.createVertexTemplate("shape="+e+t.toLowerCase()+r,Math.round(a),Math.round(n),""))}),!0)},createVertexTemplate:function(e,t,i,a){a=this.formatValue(a,"node");var n=new mxCell(a,new mxGeometry(0,0,t,i),e);return n.vertex=!0,this.buildCell(n),this.createTemplateFromCells([n],t,i)},createEdgeTemplate:function(e,t,i,a){a=this.formatValue(a,"line");var n=new mxCell(a,new mxGeometry(0,0,t,i),e);return n.geometry.setTerminalPoint(new mxPoint(0,i),!0),n.geometry.setTerminalPoint(new mxPoint(t,0),!1),n.edge=!0,this.buildCell(n),this.createTemplateFromCells([n],t,i)},createTemplateFromCells:function(e,t,i){var a=this.editor.graph,n=this.createItem(e);return this.createDragSource(n,this.createDropHandler(e,!0),this.createDragPreview(t,i)).isGuidesEnabled=mxUtils.bind(this,function(){return a.graphHandler.guidesEnabled}),n},createItem:function(e){var t=document.createElement("a");t.setAttribute("href","javascript:void(0);");var i=e[0].getValue();mxUtils.isNode(i)&&(i=e[0].getAttribute("name")),i=Ext.value(i,""),t.className="geItem",t.setAttribute("style",Ext.value(this.thumbStyle,"")),mxEvent.addListener(t,"click",function(e){mxEvent.consume(e)});var a=document.createElement("div");if(this.createThumb(e,this.thumbWidth,this.thumbHeight,a),a.style.width="100%",a.style.height="100%",a.align="center",t.appendChild(a),!Ext.isEmpty(i)){var n=document.createElement("span");n.innerHTML=i,n.align="center",n.style.fontFamily="黑体",n.style.fontSize="12px",n.style.fontWeight="bold",n.style.color="black",n.style.margin="5px 0",t.appendChild(n)}return t},createThumb:function(e,t,i,a,n,o){var r=this.editor,l=this.editor.graph;l.labelsVisible=null==o||o,l.view.scaleAndTranslate(1,0,0),l.addCells(e);var s=l.getGraphBounds(),d=this.thumbBorder,c=Math.min((t-2)/(s.width-s.x+d),(i-2)/(s.height-s.y+d)),u=-Math.min(s.x,0),p=-Math.min(s.y,0);l.view.scaleAndTranslate(c,u,p),s=l.getGraphBounds();var f=Math.max(0,Math.floor((t-s.width-s.x)/2)),E=Math.max(0,Math.floor((i-s.height-s.y)/2)),m=null;l.dialect!=mxConstants.DIALECT_SVG||mxClient.NO_FO?(m=l.container.cloneNode(!1)).innerHTML=l.container.innerHTML:m=l.view.getCanvas().ownerSVGElement.cloneNode(!0),l.getModel().clear(),mxClient.IS_IE6&&(a.style.backgroundImage="url("+r.editorUi.editor.transparentImage+")");m.style.position="relative",m.style.overflow="hidden",m.style.cursor="pointer",m.style.left=f+1+"px",m.style.top=E+1+"px",m.style.width=t+"px",m.style.height=i+"px",m.style.visibility="",m.style.minWidth="",m.style.minHeight="",a.appendChild(m)},createDragSource:function(e,t,i){var a=this.editor.graph,n=mxUtils.makeDraggable(e,a,t,i,0,0,a.autoscroll,!0,!0);return n.getDropTarget=function(e,t,i){var a=mxDragSource.prototype.getDropTarget.apply(this,arguments);return e.isValidRoot(a)||(a=null),a},n},createDropHandler:function(l,s){var d=this;return function(e,t,i,a,n){if(0<(l=e.getImportableCells(l)).length){if(0==d.beforeCellDrop(l[0]))return;var o=null!=i&&e.isValidDropTarget(i,l,t),r=null;null==i||o||(i=null),s&&e.isSplitEnabled()&&e.isSplitTarget(i,l,t)?(e.splitEdge(i,l,null,a,n),r=l):0<l.length&&(r=e.importCells(l,a,n,i)),null!=r&&0<r.length&&(d.cellDrop(r[0]),e.scrollCellToVisible(r[0]),e.setSelectionCells(r),d.endCellDrop(r[0]))}}},createDragPreview:function(e,t){var i=document.createElement("div");return i.style.border="1px dashed black",i.style.width=e+"px",i.style.height=t+"px",i},createNodeCell:function(e){var t=mxUtils.createXmlDocument().createElement(e.node);t.setAttribute("label",e.label||""),t.setAttribute("name",e.name||""),t.setAttribute("type",e.node||"");var i=new mxCell(t);return e.edge&&i.setEdge(!0),i.setStyle(e.style||""),i}}),Ext.define("JE.core.ux.mxgraph.util.Editor",{mixins:{action:"JE.core.ux.mxgraph.util.Action",style:"JE.core.ux.mxgraph.util.Style",util:"JE.core.ux.mxgraph.util.Util"},initEvent:Ext.emptyFn,buildCell:Ext.emptyFn,beforeCellDrop:Ext.emptyFn,cellDrop:Ext.emptyFn,endCellDrop:Ext.emptyFn,constructor:function(e){e=Ext.Object.merge({},e);window.mxLoadStylesheets=!1,window.mxBasePath=JE.buildCdnUrl("/static/ux/mxgraph/src"),window.STENCIL_PATH=window.mxBasePath+"/stencils",window.RESOURCES_PATH=window.mxBasePath+"/resources";var t=this.getMXGraphPath();JE.loadScript([t+"/css/mxgraph-min.css",t+"/js/Init.js",t+"/js/mxgraph-min.js"]),Ext.apply(this,e),this.init(e)},init:function(){this.initEditor(),this.initEvent(),this.initStyle(),this.initAction()},loadData:function(e){if(!Ext.isEmpty(e)&&"undefined"!=e){var t=this.editor;t.undoManager.clear();var i=mxUtils.parseXml(e);if("mxGraphModel"==i.documentElement.nodeName){var a=t.graph.getModel();new mxCodec(i).decode(i.documentElement,a),t.graph.importCells(a.getRoot())}else JE.log("xml字符串应以mxGraphModel为根节点，请修改后重新导入！！！")}},getData:function(){var e=this.editor,t=new mxCodec(mxUtils.createXmlDocument()).encode(e.graph.getModel());return mxUtils.getPrettyXml(t)},getAllCells:function(i,a,e,n){var t=this.editor.graph,o=(e=e||t.getDefaultParent(),mxUtils.bind(t,function(e){n=n||!1;var t=0==this.model.getChildCount(e)&&(this.model.isVertex(e)&&i||this.model.isEdge(e)&&a);return n||(t=t&&null!=this.view.getState(e)),t}));return t.model.filterDescendants(o,e)},highlightCells:function(e,a,i,n){var o=this,r=o.editor.graph;o.highlights=Ext.value(o.highlights,[]),Ext.each(o.highlights,function(e){e.destroy()}),o.highlights=[];var t=o.getAllCells(!0,!1);e=Ext.value(e,[]),a=Ext.value(a,"name"),i=Ext.value(i,"red"),n=Ext.value(n,3);var l=[],s=[];Ext.each(e,function(e){var t={};t=Ext.isString(e)?{code:e,color:i}:(e.color=Ext.value(e.color,i),e),s.push(t.code),l.push(t)}),Ext.isEmpty(e)||Ext.each(t,function(e){var t=s.indexOf(e.getAttribute(a));if(-1!=t){var i=new mxCellHighlight(r,l[t].color,n);i.opacity=80,i.highlight(r.view.getState(e)),o.highlights.push(i)}})},initEditor:function(){var i=this;if(mxClient.isBrowserSupported()){i.editorUI=new EditorUi(i),i.editor=i.editorUI.editor;var e=i.editor.graph;e.setDisconnectOnMove(!1),e.getAllConnectionConstraints=function(e,t){return null},e.getFoldingImage=function(e){return null},i.editor.getUrlImage=function(){return i.doImageExport()},i.rubberband=e.getRubberband(),i.outline=new mxOutline(e),e.addListener(mxEvent.CLICK,function(e,t){i.ownerCt&&i.ownerCt.focus()}),mxConnectionHandler.prototype.connectImage=new mxImage(i.getMXGraphPath()+"/images/connector.gif",16,16),1==i.readOnly&&i.setReadOnly(!0)}else mxUtils.error("该浏览器不支持图形化组件...",200,!1)},setReadOnly:function(e){var t=!Ext.value(e,!1);this.editor.graph.setEnabled(t),this.rubberband.setEnabled(t)},renderTo:function(e){var t=this;if(e){t.ownerCt=e,t.editorUI.keyHandlerDom=e.getEl().dom,t.editorUI.init(e.getGraphEl().dom),t.editor.graph.isEnabled()&&(t.initMenu(),t.editorUI.keyHandler=t.editorUI.createKeyHandler(t.editorUI.editor));var i=t.ownerCt.outlineWin;i&&i.on("afterrender",function(){t.outline.init(i.getCmp("box").getEl().dom)})}},initMenu:function(){var i=this;1!=i.readOnly&&(i.menu=Ext.create("JE.core.ux.mxgraph.Menu",{editor:i,renderTo:Ext.getBody()}),i.ownerCt&&i.ownerCt.getGraphEl().on({contextmenu:function(e,t){i.menu.cells=i.editor.graph.getSelectionCells(),i.menu.refreshItems(),i.menu.showAt(e.getXY())}}))},showOutline:function(){if(this.ownerCt&&this.ownerCt.outlineWin){var e=this.ownerCt.outlineWin,t=this.ownerCt.lastBox.width-e.width,i=this.ownerCt.lastBox.height-e.height;e.showAt(t,i)}}}),Ext.define("JE.core.ux.mxgraph.XmlCodeWin",{extend:"Ext.window.Window",alias:"widget.mxgraph.xmlcodewin",layout:"fit",bodyPadding:"4 0 0 0",modal:!0,width:600,height:400,layout:"fit",initComponent:function(){var t=this;t.items={xtype:"textarea",value:Ext.value(t.xmlCode,"")},"导入"==t.title&&(t.buttons=[{text:"确定",ref:"ok",handler:Ext.value(t.okFunc,Ext.emptyFn)},{text:"取消",ref:"cancle",handler:Ext.value(t.cancleFunc,function(e){t.close()})}],t.buttonAlign="center"),t.callParent(arguments)}}),Ext.define("JE.core.ux.PhotoClip",{extend:"Ext.panel.Panel",alias:"widget.uxphotoclip",autoScroll:!0,initComponent:function(){var i=this;i.cls=Ext.value(i.cls,"")+" je-ux-jcrop";JE.loadScript(["/static/ux/photoclip/js/hammer.min.js","/static/ux/photoclip/js/iscroll-zoom-min.js","/static/ux/photoclip/js/lrz.all.bundle.js","/static/ux/photoclip/js/PhotoClip.js"]),i.buttonAlign="center",i.buttons=[{text:"更换图片",cls:"btn JEPLUS_B_L10",handler:function(){JE.uploadFile({fileTypes:"jpg;png",type:"local",jeFileType:"PROJECT",callback:function(e){var t=new FileReader;t.readAsDataURL(e.files[0]),t.onload=function(){i.initUX(this.result)}}})}},{text:"裁剪",cls:"btn JEPLUS_B_C01",handler:function(){var e=i.photoClip.clip();i.callback(e),i.up("window").close()}},{text:"取消",handler:function(){i.up("window").close()}}],i.callParent(arguments)},afterRender:function(){this.callParent(arguments),this.initUX(this.params.path)},initUX:function(e){this.photoClip||(this.photoClip=new PhotoClip(this.body.dom,{size:200,outputSize:200})),this.photoClip.load(e)}}),Ext.define("JE.core.ux.QuickTip",{extend:"Ext.tip.QuickTip",alias:"widget.uxquicktip",constructor:function(){JE.loadScript(["/static/ux/jqueryPowertip/css/jquery.powertip.min.css","/static/ux/jqueryPowertip/jquery.powertip.js"],!0),this.callParent(arguments)},onTargetOver:function(e){var t,i=e.getTarget(this.delegate);if(!this.disabled&&i&&1===i.nodeType&&i!=document.documentElement&&i!=document.body&&(t=this.getTipCfg(e))&&t.target){i=t.target;var a=this.targets[Ext.id(i)];if(!a){(a=this.targets[Ext.id(i)]=i).setAttribute("title",a.getAttribute("data-qtip"));var n=a.getAttribute("data-qtip-type"),o={autoShow:!0,placement:"n",popupClass:"powertip",mouseOnToPopup:!1};JE.isNotEmpty(n)&&(o.mouseOnToPopup=-1!=["grid"].indexOf(n),o.popupClass+=" powertip-"+n),jQuery(a).powerTip(o)}}},onTargetOut:function(){},onMouseMove:function(){}}),Ext.define("JE.core.ux.StepView",{extend:"Ext.panel.Panel",alias:"widget.uxstepview",layout:"fit",border:0,idProperty:"code",useStepIcon:!1,initComponent:function(){var i=this,e=i.itemTpl||'<div class="item <tpl if="active">active</tpl> <tpl if="this.cmp.activeStep == code">active-step</tpl>" style="{[this.getWidth(values)]}"><tpl if="this.cmp.useStepIcon"><i class="fa fa-check item-icon"></i></tpl>{text}</div>',t=i.storeFields||["code","text","active"],a={xtype:"dataview",itemId:"view",cls:"je-ux-stepview",store:Ext.create("Ext.data.Store",{fields:t}),itemSelector:"div.item",tpl:['<div class="je-ux-stepview-body">','<tpl for=".">',e,"</tpl>","</div>",{cmp:i,getWidth:function(e){var t=7*e.text.strLen()+40+20;return"width:"+(1/i.getCmp("view").getStore().getCount()*100).toFixed(2)+"%;min-width:"+t+"px;"}}],listeners:{afterrender:function(i){i.getEl().on({mousedown:function(e){var t=i.getEl().down(".je-ux-stepview-body");t&&(i.moveInfo={taskBody:t,x:e.getX(),scrollLeft:t.dom.scrollLeft})},mousemove:function(e){i.moveInfo&&(i.moveInfo.taskBody.dom.scrollLeft=i.moveInfo.scrollLeft+(i.moveInfo.x-e.getX()))},mouseenter:function(e){delete i.moveInfo},mouseup:function(e){delete i.moveInfo}})},resize:function(e){var t=e.getEl().down(".je-ux-stepview-body");if(t){var i=t.dom.scrollWidth>t.dom.offsetWidth;e.getEl()[i?"addCls":"removeCls"]("enable-move")}},itemclick:function(e,t){i.itemClick&&i.itemClick(e,t)}}};i.items=[a],i.callParent(arguments)},loadStep:function(e){var t=this.getCmp("view");e=e||[];t.store.loadData(e),t.fireEvent("resize",t),this.setVisible(JE.isNotEmpty(e))},multiSteps:!1,activeStep:1,setStep:function(a){var n=this,o=n.getCmp("view");n.activeStep=a,n.multiSteps?o.store.each(function(e,t){if(e.set("active",!1),e.get(n.idProperty)==a)for(var i=0;i<=t;i++)o.store.getAt(i).set("active",!0)}):o.store.each(function(e){e.set("active",e.get(n.idProperty)==a)})}}),Ext.define("JE.core.ux.tab.BoxReorderer",{mixins:{observable:"Ext.util.Observable"},itemSelector:".x-box-item",animate:100,constructor:function(){this.addEvents("StartDrag","Drag","ChangeIndex","Drop"),this.mixins.observable.constructor.apply(this,arguments)},init:function(e){this.container=e,this.animatePolicy={},this.animatePolicy[e.getLayout().names.x]=!0,this.container.on({scope:this,boxready:this.afterFirstLayout,beforedestroy:this.onContainerDestroy})},onContainerDestroy:function(){var e=this.dd;e&&(e.unreg(),this.dd=null)},afterFirstLayout:function(){var e,t=this,i=t.container.getLayout(),a=i.names;e=t.dd=Ext.create("Ext.dd.DD",i.innerCt,t.container.id+"-reorderer"),Ext.apply(e,{animate:t.animate,reorderer:t,container:t.container,getDragCmp:this.getDragCmp,clickValidator:Ext.Function.createInterceptor(e.clickValidator,t.clickValidator,t,!1),onMouseDown:t.onMouseDown,startDrag:t.startDrag,onDrag:t.onDrag,endDrag:t.endDrag,getNewIndex:t.getNewIndex,doSwap:t.doSwap,findReorderable:t.findReorderable}),e.dim=a.width,e.startAttr=a.beforeX,e.endAttr=a.afterX},getDragCmp:function(e){return this.container.getChildByElement(e.getTarget(this.itemSelector,10))},clickValidator:function(e){var t=this.getDragCmp(e);return!(!t||!1===t.reorderable)},onMouseDown:function(e){var t,i,a,n=this,o=n.container;n.dragCmp=n.getDragCmp(e),n.dragCmp&&(i=n.dragCmp.getEl(),n.startIndex=n.curIndex=o.items.indexOf(n.dragCmp),a=i.getBox(),n.lastPos=a[this.startAttr],t=o.el.getBox(),"width"===n.dim?(n.minX=t.left,n.maxX=t.right-a.width,n.minY=n.maxY=a.top,n.deltaX=e.getPageX()-a.left):(n.minY=t.top,n.maxY=t.bottom-a.height,n.minX=n.maxX=a.left,n.deltaY=e.getPageY()-a.top),n.constrainY=n.constrainX=!0)},startDrag:function(){var e=this,t=e.dragCmp;t?(t.setPosition=Ext.emptyFn,t.animate=!1,e.animate&&(e.container.getLayout().animatePolicy=e.reorderer.animatePolicy),e.dragElId=t.getEl().id,e.reorderer.fireEvent("StartDrag",e,e.container,t,e.curIndex),t.suspendEvents(),t.disabled=!0,t.el.setStyle("zIndex",100)):e.dragElId=null},findReorderable:function(e){var t,i=this.container.items;if(!1===i.getAt(e).reorderable)if(t=i.getAt(e),e>this.startIndex)for(;t&&!1===t.reorderable;)e++,t=i.getAt(e);else for(;t&&!1===t.reorderable;)e--,t=i.getAt(e);return e=Math.min(Math.max(e,0),i.getCount()-1),!1===i.getAt(e).reorderable?-1:e},doSwap:function(e){var t,i,a,n=this,o=n.container.items,r=n.container,l=n.container._isLayoutRoot;-1!==(e=n.findReorderable(e))&&(n.reorderer.fireEvent("ChangeIndex",n,r,n.dragCmp,n.startIndex,e),t=o.getAt(n.curIndex),i=o.getAt(e),o.remove(t),a=Math.min(Math.max(e,0),o.getCount()-1),o.insert(a,t),o.remove(i),o.insert(n.curIndex,i),r._isLayoutRoot=!0,r.updateLayout(),r._isLayoutRoot=l,n.curIndex=e)},onDrag:function(e){var t;void 0!==(t=this.getNewIndex(e.getPoint()))&&(this.reorderer.fireEvent("Drag",this,this.container,this.dragCmp,this.startIndex,this.curIndex),this.doSwap(t))},endDrag:function(e){e&&e.stopEvent();var t,i=this,a=i.container.getLayout();i.dragCmp&&(delete i.dragElId,delete i.dragCmp.setPosition,i.dragCmp.animate=!0,i.dragCmp.lastBox[a.names.x]=i.dragCmp.getPosition(!0)[a.names.widthIndex],i.container._isLayoutRoot=!0,i.container.updateLayout(),i.container._isLayoutRoot=void 0,(t=Ext.fx.Manager.getFxQueue(i.dragCmp.el.id)[0])?t.on({afteranimate:i.reorderer.afterBoxReflow,scope:i}):Ext.Function.defer(i.reorderer.afterBoxReflow,1,i),i.animate&&delete a.animatePolicy,i.reorderer.fireEvent("drop",i,i.container,i.dragCmp,i.startIndex,i.curIndex))},afterBoxReflow:function(){this.dragCmp.el.setStyle("zIndex",""),this.dragCmp.disabled=!1,this.dragCmp.resumeEvents()},getNewIndex:function(e){var t,i,a,n=this,o=n.getDragEl(),r=Ext.fly(o).getBox(),l=0,s=n.container.items.items,d=s.length,c=n.lastPos;for(n.lastPos=r[n.startAttr];l<d;l++)if((t=s[l].getEl()).is(n.reorderer.itemSelector))if(a=(i=t.getBox())[n.startAttr]+(i[n.dim]>>1),l<n.curIndex){if(r[n.startAttr]<c&&r[n.startAttr]<a-5)return l}else if(l>n.curIndex&&r[n.startAttr]>c&&r[n.endAttr]>a+5)return l}}),Ext.define("JE.core.ux.tab.TabCloseMenu",{alias:"plugin.tabclosemenu",mixins:{observable:"Ext.util.Observable"},closeTabText:"关闭",showCloseOthers:!0,closeOthersTabsText:"关闭其他",closeRightTabsText:"关闭右侧",showCloseAll:!0,closeAllTabsText:"关闭所有",extraItemsHead:null,extraItemsTail:null,constructor:function(e){this.addEvents("aftermenu","beforemenu");var t=JE.getLocalLang("core.ux.tabclosemenu");Ext.apply(this,t),this.mixins.observable.constructor.call(this,e)},init:function(e){this.tabPanel=e,this.tabBar=e.down("tabbar"),this.mon(this.tabPanel,{scope:this,afterlayout:this.onAfterLayout,single:!0})},onAfterLayout:function(){this.mon(this.tabBar.el,{scope:this,contextmenu:this.onContextMenu,delegate:".x-tab"})},onBeforeDestroy:function(){Ext.destroy(this.menu),this.callParent(arguments)},onContextMenu:function(e,t){var i=this,a=i.createMenu(),n=!0,o=!0,r=!0,l=i.tabBar.getChildByElement(t),s=i.tabBar.items.indexOf(l);i.item=i.tabPanel.getComponent(s);var d=i.item.tab.nextSibling();a.child('*[text="'+i.closeTabText+'"]').setDisabled(!i.item.closable),(i.showCloseAll||i.showCloseOthers)&&(i.tabPanel.items.each(function(e){return!(e.closable&&!e.tab.isHidden()&&(n=!1,d&&!d.isHidden()&&(r=!1),e!=i.item))||(o=!1)}),i.showCloseAll&&a.child('*[text="'+i.closeAllTabsText+'"]').setDisabled(n),i.showCloseOthers&&a.child('*[text="'+i.closeOthersTabsText+'"]').setDisabled(o),a.child('*[text="'+i.closeRightTabsText+'"]').setDisabled(r)),e.preventDefault(),i.fireEvent("beforemenu",a,i.item,i),a.showAt(e.getXY())},createMenu:function(){var e=this;if(!e.menu){var t=[{text:e.closeTabText,scope:e,handler:e.onClose}];(e.showCloseAll||e.showCloseOthers)&&t.push("-"),e.showCloseOthers&&t.push({text:e.closeOthersTabsText,scope:e,handler:e.onCloseOthers}),e.showCloseAll&&t.push({text:e.closeAllTabsText,scope:e,handler:e.onCloseAll}),t.push({text:e.closeRightTabsText,scope:e,handler:e.onCloseRight}),e.extraItemsHead&&(t=e.extraItemsHead.concat(t)),e.extraItemsTail&&(t=t.concat(e.extraItemsTail)),e.menu=Ext.create("Ext.menu.Menu",{items:t,plain:!0,cls:"je-tab-closemenu",listeners:{hide:e.onHideMenu,scope:e}})}return e.menu},onHideMenu:function(){this.fireEvent("aftermenu",this.menu,this)},onClose:function(){this.item.tab.onCloseClick()},onCloseOthers:function(){this.doClose(!0)},onCloseAll:function(){this.doClose(!1)},onCloseRight:function(){var i=this.tabPanel.items.indexOf(this.item);this.tabPanel.items.each(function(e,t){e.closable&&i<t&&e.tab.onCloseClick()},this)},doClose:function(t){this.tabPanel.items.each(function(e){e.closable&&(t&&e==this.item||e.tab.onCloseClick())},this),Ext.each([],function(e){this.tabPanel.remove(e)},this)}}),Ext.define("JE.core.ux.tab.TabReorderer",{extend:"JE.core.ux.tab.BoxReorderer",itemSelector:".x-tab",init:function(e){this.callParent([e.getTabBar()]),e.onAdd=Ext.Function.createSequence(e.onAdd,this.onAdd)},afterFirstLayout:function(){var e,t,i,a=0;for(this.callParent(arguments),t=(e=this.container.items.items).length;a<t;a++)(i=e[a]).card&&(i.reorderable=i.card.reorderable)},onAdd:function(e,t){e.tab.reorderable=e.reorderable},afterBoxReflow:function(){this.callParent(arguments),this.dragCmp&&(this.dragCmp.el.dom.click(),this.container.tabPanel.setActiveTab(this.dragCmp.card),this.container.tabPanel.move(this.startIndex,this.curIndex))}}),Ext.define("JE.core.ux.uploadPanel.UploadPanel",{extend:"Ext.grid.Panel",alias:"widget.uploadpanel",width:700,height:300,columnLines:!0,uploadCompleteClose:!0,debug:!1,file_size_limit:2e3,file_types:"*.*",file_types_description:"All Files",file_upload_limit:0,file_queue_limit:0,post_params:{},upload_url:"",initComponent:function(){var a=this;a.file_size_limit=Ext.value(a.file_size_limit,2e3),a.initConfig(),a.localLang=JE.getLocalLang("core.ux.uploadpanel"),a.addFileBtnText=a.localLang.addFileBtnText,a.uploadBtnText=a.localLang.uploadBtnText,a.closeBtnText=a.localLang.closeBtnText,a.removeBtnText=a.localLang.removeBtnText,a.cancelBtnText=a.localLang.cancelBtnText,a.post_params.currentUserCode=JE.currentUser.userCode,a.post_params.jeFileType=a.post_params.jeFileType||"PROJECT",a.post_params.jeFileSource="batch",Ext.iterate(a.post_params,function(e,t){a.post_params[e]=Ext.value(t,"")}),"1"==JE.systemConfig.JE_SYS_ENCRYPT&&(a.des_keys=JE.DES(a.post_params));var t=new Ext.util.DelayedTask(function(){a.onUpload()});a.store=Ext.create("Ext.data.JsonStore",{autoLoad:!1,fields:["id","name","type","size","percent","status","fileName","file"]}),a.store.on("add",function(e){t.delay(500)}),a.columns=[{xtype:"rownumberer",text:"No.",width:35,align:"center"},{text:a.localLang.column.name,width:150,dataIndex:"name"},{text:a.localLang.column.type,width:70,dataIndex:"type",align:"center"},{text:a.localLang.column.size,width:70,dataIndex:"size",align:"center",renderer:function(e){return Ext.util.Format.fileSize(e)}},{text:a.localLang.column.percent,width:130,dataIndex:"percent",renderer:function(e){return'<div><div style="border:1px solid #008000;height:10px;width:115px;margin:2px 0px 1px 0px;float:left;"><div style="float:left;background:#FFCC66;width:'+e+'%;height:8px;"><div></div></div></div></div>'}},{text:a.localLang.column.status,width:80,dataIndex:"status",align:"center",renderer:function(e){var t,i=a.localLang.statusRenderer;return-1==e?t=i[1]:-2==e?t=i[2]:-3==e?t=JE.format("<div style='color:red;'>{0}</div>",i[3]):-4==e?t=i[4]:-5==e&&(t=i[5]),t}},{xtype:"actioncolumn",width:50,text:a.localLang.column.remove,align:"center",items:[{iconCls:"jeicon jeicon-error-circle",iconStyle:"color:#d53b2d;",handler:function(e,t,i){a.onDelete(e.store.getAt(t))}}]}],a.dockedItems=[{xtype:"toolbar",dock:"top",style:"border-width:0px;",itemId:"buttons",items:[{xtype:"button",itemId:"addFileBtn",iconCls:JE.getIconCls({iconCls:"jeicon jeicon-resource-table-addition",fontIconCls:"fa fa-folder"}),cls:"btn JEPLUS_B_L10",text:a.addFileBtnText,listeners:{afterrender:function(e){a.bindUploadBtn(e)},buffer:300}},{xtype:"button",itemId:"uploadBtn",hidden:!0,iconCls:JE.getIconCls({iconCls:"jeicon jeicon-arrow-up",fontIconCls:"fa fa-upload"}),cls:"btn JEPLUS_B_C01",text:a.uploadBtnText,scope:a,handler:a.onUpload},{xtype:"button",itemId:"removeBtn",iconCls:JE.getIconCls({iconCls:"jeicon jeicon-trash-o",fontIconCls:"fa fa-trash"}),cls:"btn JEPLUS_B_C02",text:a.removeBtnText,scope:a,handler:a.onRemoveAll},{xtype:"button",iconCls:JE.getIconCls({iconCls:"jeicon jeicon-cancel",fontIconCls:"fa fa-times"}),cls:"btn",text:a.closeBtnText,handler:function(e){a.colseWin(e)}},{xtype:"box",itemId:"fileBox",html:'<input type="file" multiple />',hidden:!0,listeners:{afterrender:function(e){a.fileInputEl=e.getEl().down("input"),a.fileInputEl.on("change",function(){var e=a.fileInputEl.dom.files;JE.isNotEmpty(e)&&a.h5_onfilechange(e)})}}}]}],a.callParent()},beforeDestroy:function(){this.destroyed=!0,this.swfupload&&(this.swfupload.stopUpload(),JE.msg("stopUpload停止上传"))},onUpload:function(){var t=this;0!=t.store.getCount()&&(this.swfupload?0<this.swfupload.getStats().files_queued&&(this.showBtn(this,!1),this.swfupload.uploadStopped=!1,this.swfupload.startUpload()):t.store.each(function(e){t.h5_upload(e)}))},onDelete:function(e){var t=e.get("id");this.store.remove(e),this.swfupload&&this.swfupload.cancelUpload(t,!1)},onRemoveAll:function(){var t=this,i=[];t.store.each(function(e){i.push(e.get("id"))}),t.store.removeAll(),t.swfupload&&(Ext.each(i,function(e){t.swfupload.cancelUpload(e,!1)}),t.swfupload.uploadStopped=!1)},onCancelUpload:function(){this.swfupload&&(this.swfupload.uploadStopped=!0,this.swfupload.stopUpload(),this.showBtn(this,!0))},showBtn:function(e,t){e.down("#addFileBtn").setDisabled(!t),e.down("#uploadBtn").setDisabled(!t),e.down("#removeBtn").setDisabled(!t),t?e.down("actioncolumn").show():e.down("actioncolumn").hide()},initConfig:function(){window.FormData?this.useH5=!0:JE.checkFlash()&&this.initSWFConfig()},bindUploadBtn:function(e){this.useFlash?this.bind4SWF(e):this.useH5?this.bind4H5(e):e.on("click",function(e){JE.alert("当前浏览器不支持上传附件！")})},initSWFConfig:function(){JE.loadScript(["/static/ux/uploadPanel/UploadPanel.css","/static/ux/uploadPanel/swfupload/swfupload.js"]),this.flash_url=JE.getStaticUrl("JE.core.ux.uploadPanel.UploadPanel.swfupload","swf"),this.flash9_url=JE.getStaticUrl("JE.core.ux.uploadPanel.UploadPanel.swfupload_fp9","swf"),this.useFlash=!0},bind4H5:function(e){var t=this;e.on("click",function(e){t.fileInputEl.dom.click()})},h5_upload:function(n){var a=this;if(!a.destroyed){var i=new FormData,o=n.get("file");i.append(a.file_post_name,o),Ext.iterate(a.post_params,function(e,t){i.append(e,t)}),a.showBtn(a,!1);var e={"Platform-Agent":"AppleWebKit/537.36 (KHTML, like Gecko)",authorization:Ext.util.Cookies.get("authorization")};a.des_keys&&(e[a.des_keys.code]=a.des_keys.value);var r=jQuery.ajax({type:"POST",url:a.upload_url,data:i,processData:!1,contentType:!1,headers:e,xhr:function(){var e=jQuery.ajaxSettings.xhr();if(e.upload)return n.set("status",-2),e.upload.addEventListener("progress",function(e){var t=e.loaded,i=e.total,a=Math.floor(100*t/i);n.set("percent",a),n.commit()},!1),e},success:function(e){if(!a.destroyed&&(a.success&&a.success(o,e),n.set({percent:100,status:-4}),n.commit(),a.showBtn(a,!0),0!=a.uploadCompleteClose&&"window"==a.ownerCt.xtype)){var t=0,i=a.store.getCount();a.store.each(function(e){-4==e.get("status")&&t++}),t==i&&setTimeout(function(){a.destroyed||a.ownerCt.close()},500)}},error:function(e,t,i){n.set({percent:0,status:-3}),n.commit(),r.abort(),a.showBtn(a,!0),a.failure&&a.failure(o,t,i.message)}})}},h5_onfilechange:function(e){var i=this,a=[],n=[],o=1024*i.file_size_limit*1024,r=[];JE.isNotEmpty(i.file_types)&&"*.*"!=i.file_types&&Ext.each(i.file_types.split(";"),function(e){"*"!=(e=e.split(".")[1])&&r.push(e)}),Ext.each(e,function(e){if(0<i.file_upload_limit&&i.store.getCount()==i.file_upload_limit)return JE.alert(i.localLang.alert.queueLimitExceeded),!1;if(e.size<=o){var t=e.name.substring(e.name.lastIndexOf(".")+1).toLowerCase();JE.isEmpty(r)||-1!=r.indexOf(t)?i.store.add({id:JE.uuid(),name:e.name,fileName:e.name,size:e.size,type:t,status:-1,percent:0,file:e}):0<r.length&&n.push(e.name)}else a.push(e.name+"("+Ext.Number.toFixed(e.size/1048576,2)+"MB)")});var t="";JE.isNotEmpty(a)&&(t+="以下文件大小超出限制，最大"+i.file_size_limit+"MB：<br/>"+a.join("<br/>")),JE.isNotEmpty(n)&&(t+="<div style='text-align: left;'><p>以下文件类型不支持上传："+n.join(",")+"</p><p style='word-break: break-word;margin-top:10px;'><span style='font-weight:600;'>支持格式为：</span></br><span style='margin-left:34px;'>"+r.join(",")+"</span></p></div>"),JE.isNotEmpty(t)&&JE.alert(t)},bind4SWF:function(e){var t=this,i=Ext.id(),a=e.getEl().child("em");null==a&&(a=Ext.get(e.getId()+"-btnWrap")),a.setStyle({position:"relative",display:"block"}),a.createChild({tag:"div",id:i}),t.des_keys&&t.post_params&&(t.post_params[t.des_keys.code]=t.des_keys.value);var n={debug:t.debug,file_post_name:t.file_post_name||"file",flash_url:t.flash_url,flash9_url:t.flash9_url,upload_url:t.upload_url,post_params:t.post_params||{savePath:"upload\\"},file_size_limit:1024*t.file_size_limit,file_types:t.file_types,file_types_description:t.file_types_description,file_upload_limit:t.file_upload_limit,file_queue_limit:t.file_queue_limit,button_width:a.getWidth(),button_height:a.getHeight(),button_window_mode:SWFUpload.WINDOW_MODE.TRANSPARENT,button_cursor:SWFUpload.CURSOR.HAND,button_placeholder_id:i,custom_settings:{scope_handler:t},swfupload_preload_handler:t.swfupload_preload_handler,file_queue_error_handler:t.file_queue_error_handler,swfupload_load_failed_handler:t.swfupload_load_failed_handler,upload_start_handler:t.upload_start_handler,upload_progress_handler:t.upload_progress_handler,upload_error_handler:t.upload_error_handler,upload_success_handler:t.upload_success_handler,upload_complete_handler:t.upload_complete_handler,file_queued_handler:t.file_queued_handler};t.swfupload=new SWFUpload(n);var o=Ext.get(t.swfupload.movieName);o&&o.setStyle({position:"absolute",top:0,left:-2})},swfupload_preload_handler:function(){var e=this.settings.custom_settings.scope_handler;if(!this.support.loading)return JE.alert(e.localLang.alert.nonSupport),!1},file_queue_error_handler:function(e,t,i){var a=this.settings.custom_settings.scope_handler;switch(t){case SWFUpload.QUEUE_ERROR.QUEUE_LIMIT_EXCEEDED:n(a.localLang.alert.queueLimitExceeded);break;case SWFUpload.QUEUE_ERROR.FILE_EXCEEDS_SIZE_LIMIT:n(a.localLang.alert.fileExceedsSizeLimit);break;case SWFUpload.QUEUE_ERROR.ZERO_BYTE_FILE:n(a.localLang.alert.zeroByteFile);break;case SWFUpload.QUEUE_ERROR.INVALID_FILETYPE:n(a.localLang.alert.invalidFileType)}function n(e){JE.alert(e)}},swfupload_load_failed_handler:function(){var e=this.settings.custom_settings.scope_handler;JE.alert(e.localLang.alert.loadFailed)},upload_start_handler:function(e){this.settings.custom_settings.scope_handler},upload_progress_handler:function(e,t,i){var a=this.settings.custom_settings.scope_handler,n=Math.ceil(t/i*100);n=100==n?99:n;var o=a.store.findRecord("id",e.id);o.set("percent",n),o.set("status",e.filestatus),o.commit()},upload_error_handler:function(e,t,i){var a=this.settings.custom_settings.scope_handler,n=a.store.findRecord("id",e.id);n.set("percent",0),n.set("status",e.filestatus),n.commit(),a.failure&&a.failure(e,t,i)},upload_success_handler:function(e,t,i){var a=this.settings.custom_settings.scope_handler,n=a.store.findRecord("id",e.id);Ext.JSON.decode(t).success?(n.set("percent",100),n.set("status",e.filestatus)):(n.set("percent",0),n.set("status",SWFUpload.FILE_STATUS.ERROR)),n.commit(),0<this.getStats().files_queued&&0==this.uploadStopped?this.startUpload():a.showBtn(a,!0),a.success&&a.success(e,t,i)},upload_complete_handler:function(e){var t=this.settings.custom_settings.scope_handler;if(0!=t.uploadCompleteClose&&"window"==t.ownerCt.xtype){var i=0,a=t.store.getCount();t.store.each(function(e){-4==e.get("status")&&i++}),i==a&&t.ownerCt.close()}},file_queued_handler:function(e){this.settings.custom_settings.scope_handler.store.add({id:e.id,name:e.name,fileName:e.name,size:e.size,type:e.type,status:e.filestatus,percent:0})},colseWin:function(e){var t=this,i=!1;t.store.each(function(e){"-2"!=e.data.status&&"-1"!=e.data.status||(i=!0)});var a=e.up("window");i?JE.confirm("如果关闭则放弃上传操作",function(e){"ok"==e&&(JE.isNotEmpty(a.body)?(t.beforeDestroy(),a.close()):JE.msg("文件已上传完成"))}):a.close()}}),Ext.define("JE.core.ux.UxPaging",{extend:"Ext.toolbar.Paging",alias:"widget.uxpagingtoolbar",cls:"je-ux-uxpaging",pageNum:!1,displayMsg:"共 {total} 条",displayAllMsg:'每页 <span class="pagesize">{pageSize}</span> 条/共 {total} 条，显示 {fromRecord}-{toRecord} 条',displayInfo:!0,displayInfoAlign:"right",initComponent:function(){var e=this;e.defaults=Ext.value(e.defaults,{}),Ext.applyIf(e.defaults,{clearButton:!1}),"right"==e.displayInfoAlign&&e.useTheme&&"plus"==JE.getTheme()&&(e.height=e.height||40,e.pageNum=!0);var t=e.localLang=JE.getLocalLang("core.jegridview.pageItems");e.displayMsg=t.displayMsg,0<e.store.pageSize&&(e.displayMsg=t.displayAllMsg),e.callParent(arguments)},getPagingItems:function(){var e=this.callParent(arguments);return e=this.pageNum?this.getPageNumItems():(this.height=54,this.getNewItems()),this.store.pageSize<1&&(e=e.slice(e.length-1),this.pageNum=!1),e},getNewItems:function(){var a=this,e=_JE_LOCAL_LANG;return a.displayInfo=!1,a.displayMsg="{fromRecord}-{toRecord}条/共{total}条","en"==e&&(a.displayMsg="line of page,displaying {fromRecord}-{toRecord} of {total}"),[{fieldLabel:a.localLang.lineNumber,labelAlign:"right",labelWidth:80,xtype:"cbbfield",name:"pageSize",itemId:"pageSize",editable:!0,clearButton:!1,margin:"en"==e?"0 0 0 30":"0",width:"en"==e?65:150,listConfig:{minWidth:40},value:a.store.pageSize,dataArray:[10,20,30,40,50,60,70,80,90,100],listeners:{change:function(e,t,i){e.queryTask||(e.queryTask=new Ext.util.DelayedTask(function(){var e=JE.toNum(this.getValue());0<e&&a.store.pageSize!=e&&(a.store.pageSize=e,a.movePage(1))},e)),e.queryTask.delay(400)}}},{itemId:"displayItem",cls:"label",xtype:"tbtext"},{itemId:"prev",text:a.prevText,disabled:!0,cls:"btn JEPLUS_B_C07",handler:a.movePrevious,scope:a},{itemId:"next",text:a.nextText,disabled:!0,cls:"btn JEPLUS_B_C07",handler:a.moveNext,scope:a},{xtype:"numberfield",itemId:"inputItem",name:"inputItem",cls:Ext.baseCSSPrefix+"tbar-page-number",allowDecimals:!1,minValue:1,hideTrigger:!0,enableKeyEvents:!0,keyNavEnabled:!1,selectOnFocus:!0,submitValue:!1,isFormField:!1,width:a.inputItemWidth,fieldLabel:a.localLang.leaveFor,width:100,labelWidth:40,labelAlign:"right",margins:"-1 2 3 2",listeners:{scope:a,keydown:a.onPagingKeyDown,blur:a.onPagingBlur}},{xtype:"box",cls:"label",html:a.localLang.pageText},{margins:"0 0 0 10",itemId:"refresh",tooltip:a.refreshText,overflowText:a.refreshText,iconCls:"fa fa-refresh",cls:"refresh",handler:a.doRefresh,scope:a}]},getPageNumItems:function(){var i=this;return[{itemId:"prev",tooltip:i.prevText,overflowText:i.prevText,iconCls:"fa fa-angle-left",cls:"prev",disabled:!0,handler:i.movePrevious,scope:i},{xtype:"panel",border:0,layout:{type:"hbox",align:"stretch"},bodyStyle:"background-color: transparent;",itemId:"pageGroup",cls:"je-btn-group",defaults:{flex:1,xtype:"button",hidden:!0,handler:function(e){var t=JE.toNum(e.getText());i.movePage(t)}},setActiveBtn:function(i){this.items.each(function(e){var t=e.getEl();t&&t[i==e?"addCls":"removeCls"]("active")})},items:[{text:"1",itemId:"first",hidden:!1},{html:"...",xtype:"box",cls:"ellipsis",itemId:"firstMore"},{text:"1",name:"num",page:-2},{text:"1",name:"num",page:-1},{text:"1",name:"num",page:0},{text:"1",name:"num",page:1},{text:"1",name:"num",page:2},{html:"...",xtype:"box",cls:"ellipsis",itemId:"lastMore"},{text:"1",itemId:"last"}]},{itemId:"next",tooltip:i.nextText,overflowText:i.nextText,iconCls:"fa fa-angle-right",disabled:!0,handler:i.moveNext,cls:"next",scope:i},{itemId:"refresh",tooltip:i.refreshText,overflowText:i.refreshText,iconCls:"fa fa-refresh",cls:"refresh",handler:i.doRefresh,scope:i}]},updatePageNumInfo:function(){var t=this.getPageData(),i=this.getCmp("pageGroup"),o=t.currentPage,r=t.pageCount,l=i.query("button[name=num]").length,s=l+2;s==r&&(o=l-2),i.getCmp("last").setText(r),i.items.each(function(e){var t=e.itemId,i=e.name;if("firstMore"==t)e.setVisible(s<r&&l<=o);else if("lastMore"==t)e.setVisible(s<r&&o<r-l+2);else if("last"==t)e.setVisible(1<r);else if("num"==i){var a=o;o<l?a=l-1:r-l+1<o&&(a=r-l+2);var n=a+e.page;e.setText(n),e.setVisible(n<r&&1<n)}}),setTimeout(function(){var e=i.down("button[text="+t.currentPage+"][hidden!=true]");i.setActiveBtn(e)},100)},updateInfo:function(){this.pageNum&&this.updatePageNumInfo();var e=this.getCmp("displayItem");if(e){var t=this.getPageData(),i=JE.toXT(this.displayMsg,t);e.setText(i)}},getPageData:function(){var e=this.callParent(arguments);return e.pageSize=this.store.pageSize,e},movePage:function(e){var t=this.getPageData();e=Ext.value(e,1);(e=Math.min(Math.max(1,e),t.pageCount))<=0&&(e=1),this.store.loadPage(e)},afterRender:function(){var a=this;a.callParent(arguments);var e=a.getCmp("displayItem");e&&a.pageNum&&("left"==a.displayInfoAlign?a.remove(e.prev()):"hidden"==a.displayInfoAlign&&e.hide(),a.pageEditor=new Ext.Editor({updateEl:!0,alignment:"r-r",field:{xtype:"cbbfield",name:"pageSize",cls:"je-field-basiccls",editable:!0,clearButton:!1,width:60,listConfig:{minWidth:40},value:a.store.pageSize,dataArray:[10,20,30,40,50,60,70,80,90,100],listeners:{change:function(e,t,i){e.queryTask||(e.queryTask=new Ext.util.DelayedTask(function(){var e=JE.toNum(this.getValue());0<e&&a.store.pageSize!=e&&(a.store.pageSize=e,a.movePage(1))},e)),e.queryTask.delay(400)}}}}),e.getEl().on("click",function(e){var t=Ext.get(e.target);t.hasCls("pagesize")&&(a.pageEditor.startEdit(t),a.pageEditor.field.expand())}))}}),Ext.define("baseUx.window.Notification",{extend:"Ext.window.Window",alias:"widget.messagebox",cls:"ux-notification-window",autoClose:!0,autoHeight:!0,plain:!1,draggable:!1,shadow:!1,focus:Ext.emptyFn,manager:null,useXAxis:!1,position:"br",spacing:6,paddingX:30,paddingY:10,slideInAnimation:"easeIn",slideBackAnimation:"bounceOut",slideInDuration:1500,slideBackDuration:1e3,hideDuration:500,autoCloseDelay:7e3,stickOnClick:!0,stickWhileHover:!0,isHiding:!1,readyToHide:!1,destroyAfterHide:!1,closeOnMouseOut:!1,xPos:0,yPos:0,statics:{defaultManager:{el:null}},initComponent:function(){var e=this;Ext.isDefined(e.corner)&&(e.position=e.corner),Ext.isDefined(e.slideDownAnimation)&&(e.slideBackAnimation=e.slideDownAnimation),Ext.isDefined(e.autoDestroyDelay)&&(e.autoCloseDelay=e.autoDestroyDelay),Ext.isDefined(e.autoHideDelay)&&(e.autoCloseDelay=e.autoHideDelay),Ext.isDefined(e.autoHide)&&(e.autoClose=e.autoHide),Ext.isDefined(e.slideInDelay)&&(e.slideInDuration=e.slideInDelay),Ext.isDefined(e.slideDownDelay)&&(e.slideBackDuration=e.slideDownDelay),Ext.isDefined(e.fadeDelay)&&(e.hideDuration=e.fadeDelay),e.position=e.position.replace(/c/,""),e.updateAlignment(e.position),e.setManager(e.manager),e.callParent(arguments)},onRender:function(){var e=this;e.el.hover(function(){e.mouseIsOver=!0},function(){e.mouseIsOver=!1,e.closeOnMouseOut&&(e.closeOnMouseOut=!1,e.close())},e),this.callParent(arguments)},updateAlignment:function(e){var t=this;switch(e){case"br":t.paddingFactorX=-1,t.paddingFactorY=-1,t.siblingAlignment="br-br",t.useXAxis?t.managerAlignment="bl-br":t.managerAlignment="tr-br";break;case"bl":t.paddingFactorX=1,t.paddingFactorY=-1,t.siblingAlignment="bl-bl",t.useXAxis?t.managerAlignment="br-bl":t.managerAlignment="tl-bl";break;case"tr":t.paddingFactorX=-1,t.paddingFactorY=1,t.siblingAlignment="tr-tr",t.useXAxis?t.managerAlignment="tl-tr":t.managerAlignment="br-tr";break;case"tl":t.paddingFactorX=1,t.paddingFactorY=1,t.siblingAlignment="tl-tl",t.useXAxis?t.managerAlignment="tr-tl":t.managerAlignment="bl-tl";break;case"b":t.paddingFactorX=0,t.paddingFactorY=-1,t.siblingAlignment="b-b",t.useXAxis=0,t.managerAlignment="t-b";break;case"t":t.paddingFactorX=0,t.paddingFactorY=1,t.siblingAlignment="t-t",t.useXAxis=0,t.managerAlignment="b-t";break;case"l":t.paddingFactorX=1,t.paddingFactorY=0,t.siblingAlignment="l-l",t.useXAxis=1,t.managerAlignment="r-l";break;case"r":t.paddingFactorX=-1,t.paddingFactorY=0,t.siblingAlignment="r-r",t.useXAxis=1,t.managerAlignment="l-r"}},getXposAlignedToManager:function(){var e=this,t=0;if(e.manager&&e.manager.el&&e.manager.el.dom){if(!e.useXAxis)return e.el.getLeft();"br"==e.position||"tr"==e.position||"r"==e.position?(t+=e.manager.el.getAnchorXY("r")[0],t-=e.el.getWidth()+e.paddingX):(t+=e.manager.el.getAnchorXY("l")[0],t+=e.paddingX)}return t},getYposAlignedToManager:function(){var e=this,t=0;if(e.manager&&e.manager.el&&e.manager.el.dom){if(e.useXAxis)return e.el.getTop();"br"==e.position||"bl"==e.position||"b"==e.position?(t+=e.manager.el.getAnchorXY("b")[1],t-=e.el.getHeight()+e.paddingY):(t+=e.manager.el.getAnchorXY("t")[1],t+=e.paddingY)}return t},getXposAlignedToSibling:function(e){return this.useXAxis?"tl"==this.position||"bl"==this.position||"l"==this.position?e.xPos+e.el.getWidth()+e.spacing:e.xPos-this.el.getWidth()-this.spacing:this.el.getLeft()},getYposAlignedToSibling:function(e){return this.useXAxis?this.el.getTop():"tr"==this.position||"tl"==this.position||"t"==this.position?e.yPos+e.el.getHeight()+e.spacing:e.yPos-this.el.getHeight()-e.spacing},getNotifications:function(e){return this.manager.notifications[e]||(this.manager.notifications[e]=[]),this.manager.notifications[e]},setManager:function(e){var t=this;t.manager=e,"string"==typeof t.manager&&(t.manager=Ext.getCmp(t.manager)),t.manager||(t.manager=t.statics().defaultManager,t.manager.el||(t.manager.el=Ext.getBody())),void 0===t.manager.notifications&&(t.manager.notifications={})},beforeShow:function(){var e=this;e.stickOnClick&&e.body&&e.body.dom&&Ext.fly(e.body.dom).on("click",function(){e.cancelAutoClose(),e.addCls("notification-fixed")},e),e.autoClose&&(e.task=new Ext.util.DelayedTask(e.doAutoClose,e),e.task.delay(e.autoCloseDelay)),e.el.setX(-1e4),e.el.setOpacity(1)},afterShow:function(){var e=this,t=e.getNotifications(e.managerAlignment);t.length?(e.el.alignTo(t[t.length-1].el,e.siblingAlignment,[0,0]),e.xPos=e.getXposAlignedToSibling(t[t.length-1]),e.yPos=e.getYposAlignedToSibling(t[t.length-1])):(e.el.alignTo(e.manager.el,e.managerAlignment,[e.paddingX*e.paddingFactorX,e.paddingY*e.paddingFactorY],!1),e.xPos=e.getXposAlignedToManager(),e.yPos=e.getYposAlignedToManager()),Ext.Array.include(t,e),e.el.animate({to:{x:e.xPos,y:e.yPos,opacity:1},easing:e.slideInAnimation,duration:e.slideInDuration,dynamic:!0}),this.callParent(arguments)},slideBack:function(){var e=this,t=e.getNotifications(e.managerAlignment),i=Ext.Array.indexOf(t,e);!e.isHiding&&e.el&&e.manager&&e.manager.el&&e.manager.el.dom&&e.manager.el.isVisible()&&(i?(e.xPos=e.getXposAlignedToSibling(t[i-1]),e.yPos=e.getYposAlignedToSibling(t[i-1])):(e.xPos=e.getXposAlignedToManager(),e.yPos=e.getYposAlignedToManager()),e.stopAnimation(),e.el.animate({to:{x:e.xPos,y:e.yPos},easing:e.slideBackAnimation,duration:e.slideBackDuration,dynamic:!0}))},cancelAutoClose:function(){this.autoClose&&this.task.cancel()},doAutoClose:function(){this.stickWhileHover&&this.mouseIsOver?this.closeOnMouseOut=!0:this.close()},removeFromManager:function(){if(this.manager){var e=this.getNotifications(this.managerAlignment),t=Ext.Array.indexOf(e,this);if(-1!=t)for(Ext.Array.erase(e,t,1);t<e.length;t++)e[t].slideBack()}},hide:function(){var e=this;!e.isHiding&&e.el&&(e.isHiding=!0,e.cancelAutoClose(),e.stopAnimation(),e.el.animate({to:{opacity:0},easing:"easeIn",duration:e.hideDuration,dynamic:!1,listeners:{afteranimate:function(){e.removeFromManager(),e.readyToHide=!0,e.hide(e.animateTarget,e.doClose,e)}}})),e.readyToHide&&(e.isHiding=!1,e.readyToHide=!1,e.removeCls("notification-fixed"),e.callParent(arguments),e.destroyAfterHide&&e.destroy())},destroy:function(){this.hidden?this.callParent(arguments):(this.destroyAfterHide=!0,this.hide(this.animateTarget,this.doClose,this))}}),Ext.define("JE.vue.util",{destroyEl:function(e){setTimeout(function(){e.$destroy(!0),e.$el.parentNode.removeChild(e.$el)},100)},elementUI:function(e){return this.elementUI_VM||(this.elementUI_VM=new Vue),e?this.elementUI_VM[e]:this.elementUI},msg:function(e,t){JE.loadVueScript(),JE.vue.elementUI("$message")({duration:2e3,showClose:!0,message:e,type:t||"info"})},selectUser:function(i){JE.loadVueScript(),JE.loadScript(["/static/vue/components/personSelector/index.min.js","/static/vue/components/personSelector/index.min.css"]);var e=document.createElement("div");e.setAttribute("id","jevue-persion-selector"),e.innerHTML='<div class="vue-box"><person-selector :ishowerroricon="ishowerroricon" :callback="callback" :params="params" :value="value" :value-type="valueType"></person-selector></div>';var t=Ext.getBody().appendChild(e);i.configInfo=i.configInfo||"";var a={show:!0,types:["dept"],title:i.title,width:i.width,height:i.height},n=i.configInfo.split(",");a.selectType=i.multiple?"multiple":-1!=["M","M_"].indexOf(n[3])?"multiple":"single",a.async=-1!=["S_","M_"].indexOf(n[3]),"1"==JE.getObjAttr(i.otherConfig,"ROLE")&&a.types.push("role"),new Vue({el:t.dom,data:function(){return{params:a,value:i.value,valueType:i.valueType,ishowerroricon:i.isShowErrorIcon}},methods:{callback:function(e,t){if("ok"==e){var a=[];return Ext.each(t,function(e){var t={};for(var i in e)t[i.toLocaleLowerCase()]=e[i];a.push(t)}),i.callback(a)}JE.vue.destroyEl(this)}}})},dtPicker:function(t){JE.loadVueScript(),JE.loadScript(["/static/vue/components/dateTimePicker/index.min.js","/static/vue/components/dateTimePicker/index.min.css"]);function e(e){for(;e.hasChildNodes();)e.removeChild(e.firstChild);e.parentNode.removeChild(e)}document.getElementById("jevue-dtPicker")&&e(document.getElementById("jevue-dtPicker")),document.getElementsByClassName("mu-popover")[0]&&e(document.getElementsByClassName("mu-popover")[0]);var i=document.createElement("div");i.setAttribute("id","jevue-dtPicker"),i.innerHTML='<date-time-picker @callback="callback" :params="params" />';var a=Ext.getBody().appendChild(i);new Vue({el:a.dom,data:function(){return{params:t.params}},methods:{callback:function(e){return t.callback(e)}}})}}),Ext.define("JE.vue.ux.form.VueField",{extend:"Ext.form.FieldContainer",layout:"fit",cls:"je-vue-field",mixins:["Ext.form.field.Field"],initComponent:function(){this.items={xtype:"container",layout:"fit",itemId:"vueBox",cls:"je-vue-field-box"},this.callParent(arguments),this.initField()},initVue:Ext.emptyFn,afterRender:function(){this.callParent(arguments),this.initVue(this.getCmp("vueBox").getEl().dom)},setReadOnly:function(e){e=Ext.value(e,!1);this.readOnly=e,this.vm&&(this.vm.readOnly=e)},setDisabled:function(e){var t=this.callParent(arguments);return this.vm&&(this.vm.disabled=e),t},getValue:function(){var e=this.value;return this.vm&&(e=this.vm.value),e},setValue:function(e){this.value=e,this.vm&&(this.vm.value=e)}}),Ext.define("JE.vue.ux.form.DateField",{extend:"JE.vue.ux.form.VueField",alias:["widget.vuedatefield"],initComponent:function(){this.callParent(arguments)},formatMaps:function(){},initVue:function(e){var t=this,i=["<el-date-picker",'size="small"','v-model="value"',':readonly="readonly"','type="date"','@change="change"','placeholder="'+(t.emptyText||"")+'">',"</el-date-picker>"].join(" ");e.innerHTML=i;var a=e.querySelector("el-date-picker");t.vm=new Vue({el:a,data:function(){return{value:t.value,readonly:t.readOnly,disabled:t.disabled,format:"yyyy-MM-dd"}},methods:{change:function(e){t.setValue(e)}}})}}),Ext.define("JE.core.view.TreeView",{extend:"Ext.tree.Panel",mixins:["JE.core.util.ViewUtil","JE.core.util.func.Tree"],animCollapse:!1,alias:"widget.jetreeview",useArrows:!0,autoload:!0,rootVisible:!1,multiSelect:!1,autoScroll:!0,funcTree:!0,selectParent:!1,animate:!1,searchBar:!0,onlyItem:!0,codeSearch:!1,async:!1,bodyBorder:!1,loadDic:!1,selectType:"T",useTools:!1,nodeHash:{},treeTip:!0,initComponent:function(){var b=this,e=b.funcInfo=b.funcData?b.funcData.info:{};if(b.cls=Ext.value(b.cls,"")+" je-tree","tree"==e.funcType&&e.funcDicConfig&&"TRUE"==e.funcDicConfig.async&&(b.async=!0),Ext.isEmpty(b.url)&&Ext.isEmpty(b.rootData)){var C=[],w=Ext.value(b.queryItems,[]),S={},I=Ext.value(b.treeItemsSql,{});Ext.each(w,function(e){var t=JE.isEmpty(e.configInfo)?[]:e.configInfo.split(","),i=JE.isEmpty(t[1])?[]:t[1].split("~"),a=JE.isEmpty(t[2])?[]:t[2].split("~"),n=Ext.value(e.title,""),o="cgroup"==e.xtype?"M":Ext.value(t[3],""),r=o.replace("_","")!=o,l=Ext.value(e.field,""),s=Ext.value(e.orderSql,""),d=Ext.value(e.whereSql,"");d+=" "+Ext.value(I[l],"");var c=Ext.value(t[0],"");r&&(b.async=!0);var u=JE.decode(Ext.value(e.otherConfig,"{}")),p=["rootId","queryField","nodeField","formatValue"],f=JE.toXT(Ext.value(u.rootId,""),b.formatData,b.parentData);JE.isEmpty(f)&&(1<c.split("/").length||1<c.split("\\").length)&&(f="__url");var E=Ext.value(u.queryField,""),m=Ext.value(u.nodeField,""),g=Ext.value(u.formatValue,"");if("JE_CORE_QUERYUSER"==c){var h={QUICKQUERY:u.QUICKQUERY,DEPT:"JE_CORE_DEPTUSER",SENTRY:"JE_CORE_VSENTRYUSER",ROLE:"JE_CORE_VROLEUSER",WORKGROUP:"JE_CORE_WORKGROUPUSER",QUERYPERM:"",gridTip:"",sqlRemark:"",pkName:""};c=Ext.value(h[h.QUICKQUERY],c),Ext.iterate(h,function(e,t){p.push(e)}),d="",JE.isEmpty(E)&&JE.isEmpty(m)&&Ext.each(a,function(e,t){if("USERID"==e)return m="id",E=i[t],!1})}var x={},v={};Ext.iterate(u,function(e,t){if(-1==p.indexOf(e)&&JE.isNotEmpty(t)&&JE.isNotEmpty(t.match(/\{.*?\}/g))){var i="";JE.isNotEmpty(t.match(/\{#.*?\#}/g))?i=t.replaceAll("{#","").replaceAll("#}",""):(i=JE.toXT(t,b.formatData,b.parentData),v[e]=t),x[e]=i,JE.isNotEmpty(v)&&(b.loadDic=!0)}}),S[l]={code:l,multiSelect:"M"==o||"M_"==o,expandDepth:JE.toNum(u.expandDepth)},Ext.each(i,function(e,t){S[l][a[t]]=e}),Ext.iterate(S[l],function(e,t){Ext.isString(t)&&(S[t]=S[l])}),l=S[l].code,JE.isEmpty(b.params)||(x=Ext.applyIf(x,b.params));var y=Ext.value(JE.dicInfoData[c],{});C.push({ddCode:c,ddName:n,async:r,whereSql:JE.toXT(Ext.value(d,""),b.formatData,b.parentData),orderSql:Ext.value(s,""),parentSql:"",rootId:f,nodeInfo:l,params:x,initParams:v,moreRoot:!1,queryField:E,nodeField:m,formatValue:g,zwfFlag:Ext.value(y.DICTIONARY_ZWFFLAG,"0")}),1==w.length&&(b.selectType=Ext.value(t[4],"T"),b.expandDepth=S[l].expandDepth)},b),b.configInfo=C,b.defValueFields=S}else b.configInfo=b.configInfo||[],b.defValueFields={};e.funcId&&1==b.loadDic&&(b.autoload=!1),JE.isNotEmpty(b.rootData)&&(b.rootData.id=Ext.value(b.rootData.id,"ROOT")),b.store||(b.store=Ext.create("JE.core.store.TreeStore",{treeObj:b})),b.selModel={selType:"treemodel"},b.dockedItems=Ext.value(b.dockedItems,[]),1!=b.enableMSModel&&!Ext.isEmpty(b.type)||(b.dockedItems.push(b.getTreeBbar(b,e)),b.selModel.allowDeselect=!0),b.treeTip&&!Ext.isEmpty(e.treeTip)&&b.dockedItems.push({xtype:"box",dock:"bottom",minHeight:30,html:e.treeTip,cls:"x-view-emtpytext"}),1==b.multiSelect&&(b.selModel.allowDeselect=!0,b.selModel.mode="SIMPLE"),b.searchBar&&b.dockedItems.push(b.getTreeTbar(b)),b.useTools&&(b.tools=b.getTreeTools()),b.viewConfig=Ext.value(b.viewConfig,{}),Ext.apply(b.viewConfig,{selectedItemCls:"x-tree-row-selected",focusedItemCls:"x-tree-row-focused",beforeFocusedItemCls:"x-tree-row-before-focused",tableFocusedFirstCls:"x-tree-table-focused-first"}),b.callParent(arguments),b.async&&b.on("beforeitemexpand",function(e){if(b.isAsyncNode(e)&&!e.isLoaded()){e.set("loading",!0);var t=b.nodeLoad(e);JE.isNotEmpty(t)&&(e.appendChild(t),e.eachChild(function(e){e.set("loaded","LEAF"==e.get("nodeType"))})),e.set("loading",!1),e.set("loaded",!0)}})},afterRender:function(){this.callParent(arguments),this.autoload&&this.load()},getConfigInfo:function(a){var e,n=this;if(!Ext.isEmpty(n.configInfo)){var t=n.configInfo;n.loadDic&&(t=[],Ext.each(n.configInfo,function(e){var i=Ext.clone(e);Ext.iterate(i.initParams,function(e,t){i.params[e]=JE.toXT(t,a,n.parentData)}),t.push(i)})),e=Ext.encode(t)}return e}}),Ext.define("JE.core.view.workflow.Util",{getMsgMenu:function(){var t=this;if(!t.msgMenu){var i=[];Ext.each(JE.getDicItems("JE_WF_APPROOPINION"),function(e){i.push({text:e.text})}),t.msgMenu=Ext.create("Ext.menu.Menu",{shadow:!1,plain:!0,defaults:{handler:function(e){t.setSubmitMsg&&t.setSubmitMsg(e.text)}},items:i})}return t.msgMenu},activeStep:[],activeNode:void 0,activeUserInfo:void 0,initWFData:function(e,t){var i=this,a=t.formObj.wfInfo;i.wfData=t;var n=[];t.treeData&&0<t.treeData.length?Ext.each(t.treeData,function(e){n.push({id:e.id,code:e.code,text:e.text||e.code,type:e.nodeInfo,description:e.description})}):JE.isNotEmpty(t.targerTaskName)?Ext.each(t.targerTaskName.split(","),function(e){n.push({id:e,code:e,text:e})}):"returnsubmit"==t.type&&t.returnSubmitInfo&&n.push({id:t.returnSubmitInfo.returnTaskName,code:t.returnSubmitInfo.returnTaskName,text:t.returnSubmitInfo.returnTaskName});var o={type:t.type,currentTask:a.taskName,nodes:n,buttonText:t.buttonText,comment:t.comment,users:t.treeData};if(("jewfformview"==i.xtype?i.items:i.getCmp("center").items).each(function(e){i.initItemData(e,o)}),i.initViewData&&i.initViewData(),i.activeNode&&i.setActiveStep(1,{node:i.activeNode,hideSelect:!0}),"1"==JE.systemConfig.JE_DIANJIAN&&"window"==i.up().xtype&&"3"==i.activeStep){var r=i.getCmp("center").getCmp("msg");r.getCmp("node").hide(),r.getCmp("user").hide(),i.getCmp("buttonBar").getCmp("prev").hide(),i.getCmp("stepview").hide(),i.up().setHeight(300)}},initItemData:function(e,t){var i=this;switch(e.itemId){case"node":var a=i.taskNodes=t.nodes;JE.isEmpty(a)?(e.hide(),i.activeNode={id:t.currentTask,code:t.currentTask,text:t.currentTask,type:"task"}):1==a.length&&(i.activeNode=a[0]);break;case"user":i.taskNodeUsers={},JE.isEmpty(t.users)?e.hide():Ext.each(t.users,function(e){var t=[];t=-1!=["fork"].indexOf(e.nodeInfo)?e.children:[e],i.taskNodeUsers[e.code]=t});break;case"msg":e.getCmp("content")&&(e.getCmp("content").getCmp("msg").setValue(t.comment),e.getCmp("content").getCmp("sendBtn").setText(t.buttonText))}},getInitUsers:function(){var e=this.taskNodeUsers[this.activeNode.code];if(e=e?e[0]:void 0,"countersign"==this.activeNode.type){var i=Ext.apply({taskName:e.code,taskType:e.nodeInfo,assgineeInfo:{userIds:[],userNames:[],userCodes:[]},users:[]},Ext.decode(e.description));return this.activeNode.description=e.description,Ext.each(e.children[0].children,function(e){var t={id:e.nodeInfo,text:e.text,code:e.code};i.assgineeInfo.userIds.push(t.id),i.assgineeInfo.userNames.push(t.text),i.assgineeInfo.userCodes.push(t.code),i.users.push(t)}),{tasks:[i],users:i.users}}if(e&&"diy"==Ext.value(e.icon,"")){var t=[];this.getSelectUser(e,t);i={taskName:e.code,taskType:e.nodeInfo,assgineeInfo:{userIds:[],userNames:[],userCodes:[]},users:[]};return Ext.each(t,function(e){i.assgineeInfo.userIds.push(e.id),i.assgineeInfo.userNames.push(e.text),i.assgineeInfo.userCodes.push(e.code),i.users.push(e)}),{single:!0,tasks:[i],users:i.users,hideSelect:!0}}if(e&&1==JE.toNum(Ext.value(e.fieldCodes,"0"))){var a=this.getSingleUser(e);if(a){var n=a.id,o=a.text,r=a.code;return{single:!0,tasks:[i={taskName:e.code,taskType:e.nodeInfo,assgineeInfo:{userIds:[n],userNames:[o],userCodes:[r]},users:[{id:n,text:o,code:r}]}],users:i.users,hideSelect:!0}}}else this.activeUserInfo={}},getSingleUser:function(e,t,i){var a=this;t=t||!1;if("ENDUSER"==e.nodeInfoType){if(t&&t.id!=e.nodeInfo)return!1;t={id:e.nodeInfo,text:e.text,code:e.code},i&&i.add(t)}else Ext.each(e.children,function(e){t=a.getSingleUser(e,t,i)});return t},getSelectUser:function(e,t){var i=this;e&&("ENDUSER"==e.nodeInfoType?t.push({id:e.nodeInfo,text:e.text,code:e.code}):e.children&&Ext.each(e.children,function(e){i.getSelectUser(e,t)}))},setActiveStep:function(e,t){var i=this;if(t)if(1==e){i.activeNode=t.node,i.getCmp("node").getCmp("content").update(t.node),t.hideSelect&&i.getCmp("node").getCmp("footer").hide();var a=i.taskNodeUsers[i.activeNode.code];if(a=a?void 0:a[0],"countersign"==i.activeNode.type){var n=Ext.apply({taskName:a.code,taskType:a.nodeInfo,assgineeInfo:{userIds:[],userNames:[],userCodes:[]},users:[]},Ext.decode(a.description));Ext.each(a.children[0].children,function(e){var t={id:e.nodeInfo,text:e.text,code:e.code};n.assgineeInfo.userIds.push(t.id),n.assgineeInfo.userNames.push(t.text),n.assgineeInfo.userCodes.push(t.code),n.users.push(t)});t={tasks:[n],users:n.users};i.setActiveStep(2,t)}else{if(a&&"diy"==Ext.value(a.icon,"")){var o=[];i.getSelectUser(a,o);n={taskName:a.code,taskType:a.nodeInfo,assgineeInfo:{userIds:[],userNames:[],userCodes:[]},users:[]};return Ext.each(o,function(e){n.assgineeInfo.userIds.push(e.id),n.assgineeInfo.userNames.push(e.text),n.assgineeInfo.userCodes.push(e.code),n.users.push(e)}),t={single:!0,tasks:[n],users:n.users,hideSelect:!0}}if(a&&1==JE.toNum(Ext.value(a.fieldCodes,"0"))){var r=i.getSingleUser(a);if(r){var l=r.id,s=r.text,d=r.code;t={tasks:[n={taskName:a.code,taskType:a.nodeInfo,assgineeInfo:{userIds:[l],userNames:[s],userCodes:[d]},users:[{id:l,text:s,code:d}]}],users:n.users,hideSelect:!0};i.setActiveStep(2,t)}}else i.activeUserInfo={},i.getCmp("user").getCmp("content").store.removeAll()}i.getCmp("user").getCmp("footer").show()}else if(2==e){if(i.activeUserInfo=t,i.getCmp("user").getCmp("content").store.removeAll(),i.getCmp("user").getCmp("content").store.add(t.users),t.hideSelect&&i.getCmp("user").getCmp("footer").hide(),JE.isEmpty(t.users))-1<(c=i.activeStep.indexOf(e))&&i.activeStep.splice(c,1),e=void 0}else if(3==e){var c;if(JE.isEmpty(t.msg))-1<(c=i.activeStep.indexOf(e))&&i.activeStep.splice(c,1),e=void 0}0==e?i.activeStep=[]:-1==i.activeStep.indexOf(e)&&i.activeStep.push(e),i.items.each(function(e,t){e[-1!=i.activeStep.indexOf(t+1)?"addCls":"removeCls"]("done")})},selectFile:function(e){JE.win({title:this.localLang.addFileTitle,width:400,height:500,autoShow:!0,items:{xtype:"jewffileview",fileStore:e}})},getSubmitConfig:function(e){var t=JE.getLocalLang("core.jewfview.alert"),i={sponsor:{url:"/jbpm/taskInfoAction!sponsorProcess.action",submitType:"to_submit",user:!0,msg:t.doWFSponsor},fork:{},countersign:{},returnsubmit:{submitType:"to_returnsubmit",msg:t.doWFReturnSubmit},back:{submitType:"to_withdraw",msg:t.doWFBack},returnback:{submitType:"to_returnback",msg:t.doWFReturnBack},regect:{submitType:"to_reject",user:!0,msg:t.doWFReturnBack},jump:{submitType:"to_jump",user:!0,msg:t.doWFSubmit},submit:{submitType:"to_submit",types:{circular:"to_circular"},user:!0,msg:t.doWFSubmit},allot:{submitType:"to_allot",user:!0,msg:t.doWFSubmit},nextdiyuser:{submitType:"to_nextuserdiy",user:!0,msg:t.doWFNextDiyUser},return:{submitType:"to_rollback",msg:t.doWFReturn},end:{},takeround:{submitType:"to_takeround",msg:t.doWFTakeRound,user:!0},pass:{submitType:"to_pass",msg:t.doWFPass},changepass:{submitType:"to_pass",msg:t.doWFPass},nopass:{submitType:"to_nopass",msg:t.doWFNoPass},waiverpass:{submitType:"to_waiverpass",msg:t.doWFWaiverPass},transmit:{submitType:"to_transmit",user:!0,msg:t.doWFTransmit},entrust:{submitType:"to_entrust",user:!0,msg:t.doWFEntrust},callentrust:{submitType:"to_callentrust",msg:t.doWFCallEntrust},suspend:{url:"/jbpm/taskInfoAction!endProcess.action",msg:t.doWFSuspend},reject:{submitType:"to_reject",user:!0,msg:t.doWFReject},userdiy:{submitType:"to_userdiy",msg:t.doWFUserDiy},backuserdiy:{submitType:"to_backuserdiy",msg:t.doWFBackUserDiy}}[e];return i&&(i.url=i.url||"/jbpm/taskInfoAction!completeTask.action",i.user=i.user||!1),i},doWFSubmitAction:function(e){var t=this,i=t.wfData,a=i.formObj,n=a.wfInfo;t.localLang=JE.getLocalLang("core.jewfview.workflow",!0);var o=t.activeNode,r=i.type;"reject"==i.type?i.targerTaskName=o.code:"allot"==i.type?i.targerTaskName=o.code:"decision"!=i.taskType&&"circular"!=i.taskType||(i.targerTaskName=o.code,Ext.each(i.targerTranInfos,function(e){e.to==o.code&&(i.targerTransition=e.name)}));var l=Ext.apply({taskId:n.taskId,pdid:n.pdid,beanId:n.pkValue,submitComments:"",commentDetails:"",targerTaskName:i.targerTaskName,targerTransition:i.targerTransition},t.getSubmitInfo()),s=t.getSubmitConfig(r)||{};if(s.user&&JE.isNotEmpty(i.treeData)){var d=t.activeUserInfo?t.activeUserInfo.tasks:[],c=[],u=[],p=[];if(Ext.each(d,function(e){c.push(e.assgineeInfo.userNames.join(",")),u.push(e.assgineeInfo.userCodes.join(",")),p.push(e.assgineeInfo.userIds.join(","))}),JE.isEmpty(c))return void JE.alert(t.localLang.msgEmptyUser);var f={assigeeName:c.join("#"),assigeeCode:u.join("#"),assigeeId:p.join("#")};Ext.apply(l,f)}if(!JE.isEmpty(l.submitComments)||"sponsor"==i.type&&n.info.easySponsor){if(JE.isNotEmpty(i.returnSubmitInfo))l.targerTaskName=i.returnSubmitInfo.returnTaskName,l.assigeeId=i.returnSubmitInfo.returnAssgineId;else if(JE.isNotEmpty(i.endInfo)&&i.targerTaskName==i.endInfo.targerTaskName)l.targerTaskName=i.endInfo.targerTaskName,l.targerTransition=i.endInfo.targerTransition;else if("fork"==o.type){var E={};E[l.targerTaskName]=t.activeUserInfo.tasks,l.forkInfos=Ext.encode(E)}else if("countersign"==o.type){var m={};Ext.each(d,function(e){m[e.taskName]={countersignAssgineId:e.countersignAssgineId,countersignAssgineName:e.countersignAssgineName,countersignOrder:e.countersignOrder,countersignProportion:e.countersignProportion,countersignType:e.countersignType,countersignUserIds:e.assgineeInfo.userIds.join(","),countersignUserNames:e.assgineeInfo.userNames.join(","),countersignAll:"1"}}),l.countersignInfos=Ext.encode(m)}else if("batchtask"==o.type){var g={};Ext.each(d,function(e){g[e.taskName]={sort:"1"==e.sort,userIds:e.assgineeInfo.userIds.join(","),userNames:e.assgineeInfo.userNames.join(",")}}),l.batchInfos=Ext.encode(g)}else"suspend"==r&&(l.piid=n.piid);l.submitType=s.submitType,"submit"==r&&"batchtask"!=i.taskType&&i.formObj.wfInfo.taskName==l.targerTaskName&&(l.submitType=s.types.circular),i.wfBatch&&(l.wfBatch="1",l.ids=n.ids,l.piid=n.piid,"sponsor"==i.type||(s.url="/jbpm/taskInfoAction!completeBatchTask.action")),"takeround"==r&&(l.roundUserId=l.assigeeId);var h=JE.ajax({url:s.url,params:l});h.success?(JE.msg(s.msg),i.wfBatch||JE.Action.doWFFormEdit(a,h.obj.bean,h.obj),delete a.activeWFBtn,e&&e()):JE.alert(h.obj)}else JE.alert(t.localLang.msgEmptyAlert)}}),Ext.define("JE.core.view.CenterView",{extend:"Ext.panel.Panel",border:0,layout:"card",alias:"widget.jecenterview",mixins:["JE.core.util.ViewUtil"],buildItems:!1,initComponent:function(){var t=this,e=t.funcData;t.id=e.info.funcCode+"_jecenterview"+e.info.idSuffix;var i=[{xtype:"jedataview",itemId:"jedataview",funcData:e}];"form"!=t.showView&&"formData"!=t.showView||(t.buildItems=!0,i=[{xtype:"jeeditview",itemId:"jeeditview",funcData:t.funcData}]);var a=t.getExtendPanels(e.info.extendPanels,{center:!0});if(t.centerEp=new Ext.util.MixedCollection,"tree"==e.info.funcType){var n={xtype:"panel",layout:"border",itemId:"jetreegridview_center",menuText:"树形列表",border:0,items:[{xtype:"jetreegridview",id:e.info.funcCode+"_jetreegridview"+e.info.idSuffix,funcData:e,itemId:"jetreegridview",region:"center",showView:t.showView}]};"treegrid"==t.showView?(i=[n],n.items=n.items.concat(t.getExtendPanels(e.info.extendPanels,{center:!1}))):e.info.useTreeGrid&&t.centerEp.add(n.itemId,n)}var o=i[0].itemId;Ext.each(a,function(e){t.centerEp.add(e.itemId,e),1==e.beActive&&(o=e.itemId,i.push(e))}),t.activeItem=o,t.items=i,t.callParent(arguments),t.rootFunc&&t.on("activechange",function(e,t,i){var o=e.ownerCt.getDockedCmp("locationBar");if(o){var a=o.getCmp("funcTpl"),n=Ext.clone(o.menus),r="";"jedataview"==t.xtype?a.show():"jeeditview"==t.xtype?(a.hide(),r=t.down("panel[xtype=jeformview]").title,!t.hasListener("activechange")&&1<t.items.getCount()&&t.on("activechange",function(e,t,i){var a=Ext.clone(o.menus),n=t.title;JE.isNotEmpty(n)&&a.push(n),o.getCmp("location").update(a.join('<span class="split-str">/</span>'))})):r=t.title,JE.isNotEmpty(r)&&n.push(r),o.getCmp("location").update(n.join('<span class="split-str">/</span>'))}})},afterRender:function(){var d=this,e=d.funcData;d.callParent(arguments);var t=JE.getLocalLang("core.jemainview.panelswitcher"),i=[],a=!1,n=d.getLayout().getActiveItem().itemId;if(d.items.each(function(e){"jedataview"==e.itemId?(a=!0,e.menuText=t.listText,i.push({text:e.menuText,code:e.itemId})):"jeeditview"!=e.itemId||a||(e.menuText=t.formText,i.push({text:e.menuText,code:e.itemId}))}),d.centerEp.each(function(e){Ext.isEmpty(e.menuText)||i.push({text:e.menuText,code:e.itemId})}),1<i.length){if(e.info.simpleBar)if(d.changeDataItems=i,d.addDocked({xtype:"toolbar",dock:"top",itemId:"dataviewBar",cls:"je-mainview-dataviewbar",hidden:!0,border:0,items:d.getChangeDataView(i,d)}),a=d.gridView=Ext.getCmp(e.info.funcCode+"_jegridview"+e.info.idSuffix))a.getDockedCmp("buttonBar").insert(0,d.getChangeDataView(i,d));var o={xtype:"cbbfield",fieldLabel:t.label,labelWidth:40,labelAlign:"right",width:190,hideTrigger1:!0,value:n,dataArray:i,listeners:{select:function(e,t){var i=t[0].get("code"),a=d.getCmp(i);Ext.isEmpty(a)&&(a=d.add(d.centerEp.get(i))),d.getLayout().setActiveItem(i);var n=d.getCmp("jetreegridview_center");if(n){var o=d.ownerCt.getCmp("dictree");i==n.itemId?(n.getCmp("jetreegridview").doLoad(),o&&o.hide()):"jedataview"==i&&o&&o.show()}if(d[e.otherCbb]){d[e.otherCbb].setValue(i);var r=-1==["jeeditview","jedataview","jetreegridview_center"].indexOf(i);if(d.centerExtendBox.setVisible(r),r){var l=d.getLayout().getActiveItem().xtype,s=d.getY();d.centerExtendBox.setLocalY("jechartview"==l?s+40:s)}}}}},r=-1==["jeeditview","jedataview","jetreegridview_center"].indexOf(n);if(a=Ext.getCmp(e.info.funcCode+"_jegridview"+e.info.idSuffix)){var l=a.getDockedCmp("pagingtoolbar");l?(d.gridExtendCbb=l.add(o),d.gridExtendCbb.otherCbb="centerExtendCbb"):r=!0}d.centerExtendCbb=Ext.widget("cbbfield",o),d.centerExtendCbb.otherCbb="gridExtendCbb",d.centerExtendBox=d.ownerCt.add({xtype:"box",height:"auto",width:o.width+10,constrain:!0,floating:!0,draggable:!0,simpleDrag:!0,autoShow:r,padding:"10 0",x:d.ownerCt.getWidth()-200,y:0,style:"cursor: move;background-color:#ffffff;box-shadow: rgb(136, 136, 136) 0px 0px 6px;-webkit-border-radius: 5px;-moz-border-radius: 5px;-ms-border-radius: 5px;-o-border-radius: 5px;border-radius: 5px;",listeners:{afterrender:function(e){d.centerExtendCbb.render(e.getEl())}}})}},buildItem:function(){this.add({xtype:"jeeditview",funcData:this.funcData}),this.buildItems=!0},changeDataView:function(i){var e=this,t=e.funcData,a=e.getCmp(i);if(Ext.isEmpty(a)){var n=(a=e.add(e.centerEp.get(i))).getCmp("jetreegridview");if(n)(c=n.getDockedCmp("buttonBar")).insert(0,e.getChangeDataView(e.changeDataItems,e))}e.getLayout().setActiveItem(i);var o=e.getCmp("jetreegridview_center");if(o){var r=e.ownerCt.getCmp("dictree");i==o.itemId?(o.getCmp("jetreegridview").doLoad(),r&&r.hide()):"jedataview"==i&&r&&r.show()}var l=[],s=e.getDockedCmp("dataviewBar");s.setVisible(-1==["jedataview","jetreegridview_center"].indexOf(i)),l.push(s.getCmp("changeDataView"));var d=JE.getFuncView(t.info.funcCode,"grid");if(d){var c=d.getDockedCmp("buttonBar");l.push(c.getCmp("changeDataView"))}if(o){c=o.getCmp("jetreegridview").getDockedCmp("buttonBar");l.push(c.getCmp("changeDataView"))}Ext.each(l,function(e){var t=e.store.findRecord("code",i);e.getSelectionModel().select(t,!1,!0)})}}),Ext.define("JE.core.view.ChartView",{extend:"Ext.panel.Panel",alias:"widget.jechartview",chartCode:"",hideSearchBar:void 0,chartAttrs:void 0,chartParams:void 0,chart:void 0,chartCfg:void 0,chartBean:void 0,paramsForm:void 0,split:!0,border:0,boxBorder:1,EChart:void 0,initComponent:function(){var t=this;t.localLang=JE.getLocalLang("core.jechartview"),t.exportFileName=JE.uuid(),t.addEvents("labelclick","load","beforeload"),t.chartAttrs=Ext.value(t.chartAttrs,{}),t.chartParams=Ext.value(t.chartParams,{}),t.buildChartBean(t.chartCode),t.buildChartCfg(t.chartBean),JE.loadChartScript(t.EChart),t.buildMenu(),t.layout="border",t.items={xtype:"box",region:"center",cls:"x-panel-body-default",itemId:"chartBox",listeners:{afterrender:function(e){1!=t.hideMenu&&e.getEl().on("contextmenu",function(e){e.stopEvent(),t.store&&0<t.store.getCount()&&t.menu.showAt(e.getXY())})}}},0==t.boxBorder&&(t.items.style="border-width:0px;"),t.callParent(arguments),t.chartCfg&&"1"==t.chartCfg.otherCfg.enableEvent&&JE.isNotEmpty(t.chartCfg.otherCfg.labelclick)&&t.on("labelclick",JE.eval(t.chartCfg.otherCfg.labelclick)),t.chartCfg&&"1"==t.chartCfg.otherCfg.enableLoadEvent&&JE.isNotEmpty(t.chartCfg.otherCfg.beforeload)&&t.on("beforeload",JE.eval(t.chartCfg.otherCfg.beforeload)),t.EChart&&t.on("resize",function(e){e.chart&&e.chart.resize()})},setChartAttrs:function(e,t){if(this.chart){var i={};Ext.isString(e)?i[e]=t:Ext.isObject(e)&&(i=e),this.chart.setChartAttribute(i)}},afterRender:function(){var i=this;i.callParent(arguments),i.buildParamsForm(),0!=i.autoLoad&&i.getCmp("chartBox").on("boxready",function(){var e=i.chartCfg&&"1"==i.chartCfg.dsCfg.initParams,t=(i.up("window"),i.chartParams=Ext.apply(i.getSearchDefVals(),Ext.value(i.chartParams,{})));i.load(t,e)})},destroyChart:function(){this.EChart&&this.chart&&(this.chart.timeFn&&clearInterval(this.chart.timeFn),this.chart.dispose(this.getCmp("chartBox").getEl().dom),delete this.chart)},reset:function(){this.paramsForm&&this.paramsForm.form.reset(),this.searchWin&&this.searchWin.getCmp("form").form.reset()},load:function(e,t){var i=this;if(i.chartCfg){if(t&&JE.isNotEmpty(i.searchFields))return i.showSearchWin(),void i.getCmp("chartBox").update("");var a=Ext.clone(i.chartParams);return i.chartCfg.params=Ext.apply(a,Ext.value(e,{})),Ext.iterate(i.chartCfg.params,function(e,t){i.chartCfg.params[e]=JE.toDefVal(t)}),i.fireEvent("beforeload",i,i.chartCfg.params),i.drawChart()}},drawChart:function(){return this.chart=JE.ChartUtil.drawChart(this.id,this.chartCfg,this.EChart?"echart":""),this.chart},exportFile:function(e){e=Ext.value(e,{});if(this.EChart){var t=this.getCmp("chartBox").getEl().getBox(),i={savePath:this.chart.getDataURL(),chartId:this.id,EChart:!0,width:t.width-2,height:t.height-2,statusCode:"1"};e.callback&&e.callback(i)}else if(this.chart.hasRendered()){var a={exportAtClient:"0",exportformat:Ext.value(e.fileType,"PNG"),exportAction:Ext.value(e.action,"save"),exportFileName:this.exportFileName,exportHandler:"FCExporter",exportparameters:"|chartId="+this.id+"|savePath=/JE/data/chart",exportCallback:"FC_Exported"};window.FC_Exported=Ext.value(e.callback,Ext.emptyFn),this.chart.exportChart(a)}else JE.alert(this.localLang.msg.exportReport)},buildChartBean:function(e){if(!Ext.isEmpty(e)&&!this.chartBean){var t=JE.ajax({url:JE.getUrlMaps("je.core.load"),params:{tableCode:"JE_CORE_CHARTS",whereSql:"and CHARTS_CODE = '"+this.chartCode+"'",limit:1}}).rows[0];if(t)return this.chartBean=t}},buildChartCfg:function(e){if(e&&!this.chartCfg){var t={code:e.CHARTS_CODE,type:e.CHARTS_TYPECODE,dsCfg:Ext.decode(Ext.value(e.CHARTS_DSCONFIG,"{}")),dsIds:e.CHARTS_DSIDS,ds:{}};t.dsCfg.params=Ext.decode(Ext.value(t.dsCfg.params,"[]")),t.otherCfg=Ext.value(t.dsCfg.otherCfg,{});var i=Ext.decode(Ext.value(e.CHARTS_ATTRCONFIG,"{}"));(t=Ext.apply(t,i)).chart=Ext.value(t.chart,{}),t.chart=Ext.apply(t.chart,this.chartAttrs),JE.isEmpty(this.EChart)&&JE.isNotEmpty(t.echart)&&(this.EChart=JE.toBool(t.echart.enableEChart||"1"));var a=JE.ajax({url:JE.getUrlMaps("je.core.load"),params:{tableCode:"JE_CORE_DATASOURCE",whereSql:"and JE_CORE_DATASOURCE_ID in('"+t.dsIds.replaceAll(",","','")+"')",limit:-1}}).rows;return Ext.each(a,function(e){t.ds[e.DATASOURCE_CODE]=JE.getChartDS(e)}),this.chartCfg=t}},showSearchWin:function(e){this.searchWin&&(this.searchWin.down("button[ref=closeBtn]").setVisible(1==e),this.searchWin.show())},buildSearchWin:function(){var t=this;if(t.chartCfg&&(t.searchWin&&t.remove(t.searchWin),JE.isNotEmpty(t.searchFields))){var e=Number(Ext.value(t.chartCfg.dsCfg.winWidth,400));t.searchWin=t.add({xtype:"window",title:t.localLang.searchForm.title,maxWidth:t.width,maxHeight:t.height,minWidth:260,width:e,closable:!1,height:22*t.searchFields.length+100,constrain:!0,layout:"fit",closeAction:"hide",modal:!0,items:{xtype:"form",itemId:"form",layout:"column",bodyPadding:"5",autoScroll:!0,border:0,defaults:{columnWidth:1,labelAlign:"right",labelWidth:80,margin:2},items:t.searchFields},buttonAlign:"center",buttons:[{text:t.localLang.searchForm.queryButton,iconCls:"jeicon jeicon-search",handler:function(){if(t.chartCfg){var e=t.searchWin.getCmp("form");t.paramsForm.form.setValues(e.form.getValues()),t.paramsForm.getDockedCmp("btnbar").getCmp("searchBtn").handler(),t.searchWin.hide()}}},{text:t.localLang.searchForm.resetButton,iconCls:"jeicon jeicon-turn-left",handler:function(){t.searchWin.getCmp("form").form.reset()}},{text:t.localLang.searchForm.close,iconCls:"jeicon jeicon-error",hidden:!0,ref:"closeBtn",handler:function(){t.searchWin.hide()}}]})}},getSearchDefVals:function(){var i={};return Ext.iterate(this.searchDefVals,function(e,t){Ext.isFunction(t)?i[e]=t():i[e]=JE.toDefVal(t)}),i},buildParamsForm:function(){var r=this;if(r.chartCfg){r.paramsForm&&r.remove(r.paramsForm),r.paramsTree&&r.remove(r.paramsTree);var e=r.chartCfg.dsCfg,t=Ext.value(e.region,"north"),i=Ext.value(e.btnRegion,"bottom"),a=r.hideSearchBar||Ext.isEmpty(e.params)||"1"==e.hideSearch,n="1"==e.collapsed,l=JE.toBool(e.treeSearch);r.searchFields=[],r.searchDefVals={},disFields=[],fields=[],Ext.each(e.params,function(e){var t={name:e.code,fieldLabel:e.name,xtype:Ext.value(e.xtype,"textfield"),configInfo:e.configInfo,valueFormat:e.format,rowField:e.field,hidden:JE.toBool(e.hidden)},i=r.chartBean?r.chartBean.CHART_TEXT:r.chartCfg.code,a=JE.eval(e.listeners,"图表【"+i+"】查询参数【"+e.name+"】的事件解析出错！");if(JE.isNotEmpty(a)&&(t.listeners=a),-1!=["cbbfield","rgroup","cgroup","treessfield"].indexOf(t.xtype)&&JE.isNotEmpty(t.configInfo)&&disFields.push(Ext.apply(Ext.clone(t),{field:t.name,title:t.fieldLabel})),t.xtype="datefield"==t.xtype?"datedayfield":t.xtype,JE.isNotEmpty(e.valueFn)){var n=JE.eval(e.valueFn);t.value=n(),r.searchDefVals[t.name]=n}else JE.isNotEmpty(e.value)&&(t.value=JE.toDefVal(e.value),r.searchDefVals[t.name]=e.value);if(t.value=Ext.value(r.chartParams[t.name],t.value),t.width=Ext.value(e.width,200),0==t.width&&(t.hidden=!0),l||"1"!=e.changeS||(t.listeners=Ext.value(t.listeners,{}),t.listeners=Ext.apply(t.listeners,{change:function(e,t){var i=e.up("form");i&&i.getDockedCmp("btnbar").getCmp("searchBtn").handler()}})),"1"==e.useText){var o=Ext.clone(t);o.name=o.name+"_TEXT",t.hidden=!0,t.rowField=Ext.value(t.rowField,o.name),fields.push(Ext.clone(o)),delete o.columnWidth,delete o.listeners,r.searchFields.push(Ext.clone(o))}fields.push(Ext.clone(t)),delete t.columnWidth,delete t.listeners,delete t.width,r.searchFields.push(Ext.clone(t))});var o=new Ext.util.MixedCollection;Ext.each(fields,function(e){var t=e.rowField;if(JE.isEmpty(t))o.add(e.name,[e]);else{var i=o.get(t);JE.isEmpty(i)&&(i=o.add(t,[])),i.push(e)}});var s=[];o.each(function(e){s.push({xtype:"container",layout:"hbox",columnWidth:1,defaults:{labelAlign:"right",labelWidth:60,margin:"1 0"},items:e})}),0==s.length&&(a=!0);var d="";"north"==t?d="bottom":"south"==t?d="top":"west"==t?d="right":"east"==t&&(d="left");var c={xtype:"form",itemId:"paramsForm",layout:"column",region:"north",border:1,bodyPadding:"2",autoScroll:!0,hidden:a,region:t,items:s,border:0,style:"border-width:1px;border-style:solid;border-"+d+"-width:0px;",bodyStyle:"border-width:0px;background-color:transparent;",dockedItems:[{xtype:"toolbar",dock:i,itemId:"btnbar",style:"background-color:transparent;border-width:0px !important;",layout:{type:"hbox",align:"top"},items:["->",{text:r.localLang.searchForm.queryButton,margin:"0 2",itemId:"searchBtn",cls:"btn btn-form JEPLUS_B_C01",iconCls:JE.getIconCls({iconCls:"jeicon jeicon-search",fontIconCls:"fa fa-search"}),handler:function(){if(r.chartCfg){var e=r.paramsForm,t=r.formatParams(e);r.load(t)}}},{text:r.localLang.searchForm.resetButton,margin:"0 2",cls:"btn btn-form JEPLUS_B_C02",iconCls:JE.getIconCls({iconCls:"jeicon jeicon-turn-left",fontIconCls:"fa fa-mail-reply"}),handler:function(){r.paramsForm.form.reset()}},"->"]}]};if(0==r.searchBorder&&(c.style+="border-width:0px;"),n&&Ext.apply(c,{split:!0,collapsible:!0,hideCollapseTool:!0,titleCollapse:!0,collapseMode:"mini",collapsed:n}),JE.isNotEmpty(e.bgcolor)&&(c.style+="background-color:"+e.bgcolor),-1!=["east","west"].indexOf(t)?c.width=Number(Ext.value(e.hw,"150")):(c.minHeight=55,-1!=["left","right"].indexOf(i)&&(c.height=c.minHeight="plus"==JE.getTheme()?43:30),JE.isNotEmpty(e.hw)&&(c.height=Number(e.hw))),JE.toBool(e.treeSearch)&&0<disFields.length){var u={xtype:"jetreeview",border:0,region:"west",cls:"je-grid-groupquery",style:"border-width:1px;border-style:solid;",type:"func",onlyItem:!1,multiSelect:!1,enableMSModel:!0,autoScroll:!0,width:Number(Ext.value(e.hw,"150")),split:!0,collapsible:!0,hideCollapseTool:!0,titleCollapse:!0,collapseMode:"mini",collapsed:n,queryItems:disFields,hidden:a,listeners:{selectionchange:function(e,t,i){if(r.chartCfg){e.view.panel;var a={};Ext.each(t,function(e){a[e.data.nodeInfo]=a[e.data.nodeInfo]||[],a[e.data.nodeInfo].push(e.data.code)});var n={};Ext.iterate(a,function(e,t){n[e]=t.join(",")}),r.paramsForm.form.reset(),r.paramsForm.form.setValues(n),r.paramsForm.getDockedCmp("btnbar").getCmp("searchBtn").handler()}},load:{fn:function(t){var i=r.getSearchDefVals();t.getRootNode().cascadeBy(function(e){if(i[e.data.nodeInfo]==e.data.code)return t.treeObj.getSelectionModel().select(e,!1,!0),!1})},single:!0}}};c.hidden=!0,r.paramsTree=r.add(u)}r.paramsForm=r.add(c),r.buildSearchWin()}},formatParams:function(a){var n=a.form.getValues();return Ext.iterate(n,function(e,t){var i=a.form.findField(e);i&&"in"==i.valueFormat&&(n[e]=n[e].replaceAll(",","','"))}),n},buildMenu:function(){var i=this;i.menu=Ext.create("Ext.menu.Menu",{listeners:{show:function(e){var t=i.chartCfg&&"1"==i.chartCfg.dsCfg.menuSearch;e.getCmp("search").setVisible(t),e.getCmp("searchT").setVisible(t),e.getCmp("exportPDF").setVisible(!i.EChart)}},items:[{text:i.localLang.menu.print,iconCls:"jeicon jeicon-print",handler:function(){if(i.EChart){i.chart._toolbox&&i.chart._toolbox.__onSaveAsImage();var e="<img src='"+i.chart.getDataURL()+"' />";JE.printHtml(e)}else i.chart.print()}},{text:i.localLang.menu.exportImg,iconCls:"jeicon jeicon-photo",handler:function(){i.EChart?(i.chart._toolbox&&i.chart._toolbox.__onSaveAsImage(),JE.openWindow(i.chart.getDataURL())):i.exportFile({fileType:"PNG",action:"download"})}},{text:i.localLang.menu.exportPdf,iconCls:"jeicon jeicon-pdf",itemId:"exportPDF",handler:function(){i.exportFile({fileType:"PDF",action:"download"})}},{xtype:"menuseparator",itemId:"searchT"},{text:i.localLang.menu.search,iconCls:"jeicon jeicon-search",itemId:"search",handler:function(){i.showSearchWin(!0)}}]})},setReadOnly:function(e){}}),Ext.define("JE.core.view.CodeEditor",{extend:"Ext.panel.Panel",alias:"widget.jecodeeditor",layout:"border",editorMode:"javascript",value:"",saveFn:void 0,useHelp:!0,helpType:"JE",autoSave:!1,mixins:["JE.core.util.ViewUtil"],lineWrapping:!1,initComponent:function(){var a=this;JE.loadScript(["/static/ux/editor/monacoEditor/min/vs/editor/editor.main.css","/static/ux/editor/monacoEditor/min/vs/loader.js"]);var e={xtype:"box",style:"background-color:#1E1E1E;font-size:14px;",html:'<div style="height:100%"></div>',itemId:"editorBox",region:"center",listeners:{resize:function(e,t,i){a.editor&&a.editor.layout()}}};a.items=[e],a.useHelp&&a.items.push(a.buildHelpTree()),a.callParent(arguments)},afterRender:function(){var i=this;i.callParent();var e=i.getCmp("editorBox");i.editorMode="htmlmixed"==i.editorMode?{name:"htmlmixed",scriptTypes:[{matches:/\/x-handlebars-template|\/x-mustache/i,mode:null},{matches:/(text|application)\/(x-)?vb(a|script)/i,mode:"vbscript"}]}:i.editorMode;var t=JE.getOnlineInfo("cdn")||"";require.config({paths:{vs:t+"/static/ux/editor/monacoEditor/min/vs"}}),require(["vs/editor/editor.main"],function(){var t;i.editor=monaco.editor.create(e.el.dom.firstChild,{value:JE.isNotEmpty(i.value)?i.value:"",language:i.editorMode,theme:"vs-dark",dragAndDrop:!0,emptySelectionClipboard:!0,mouseWheelZoom:!0,fontSize:18}),i.editor.addCommand(monaco.KeyMod.CtrlCmd|monaco.KeyCode.KEY_S,function(){i.saveFn&&i.saveFn(i.editor.getValue())}),i.autoSave&&i.editor.onDidChangeModelContent(function(e){i.saveFn&&(clearTimeout(t),t=setTimeout(function(){i.saveFn(i.editor.getValue())},2e3))});i.setValue(i.value)})},buildHelpTree:function(){var i=this,e="APP"==i.helpType?"JE_CORE_JEAPPAPI":"JE_CORE_JEAPI",t={xtype:"jetreeview",url:JE.getUrlMaps("je.core.getTree"),funcData:{info:{funcType:"tree"}},onlyItem:!0,type:"func",border:0,params:{moreRoot:!1,tableCode:e,excludes:"checked",whereSql:"and SY_PARENT "+("ORACLE"==JE.systemConfig.JE_SYS_DB?" IS NOT NULL":" !='' ")},listeners:{selectionchange:function(e,t){var i=e.view.panel,a=t[0];if(a){var n=Ext.htmlDecode(a.get("nodeInfo"));i.infoPanel.update(n),i.useFnBtn.funcStr=a.data.bean.JEAPI_EXAMPLE,i.useFnBtn.setDisabled(Ext.isEmpty(i.useFnBtn.funcStr))}},afterrender:function(e){e.infoPanel=e.ownerCt.getCmp("info"),e.useFnBtn=e.infoPanel.down("button[ref=useFn]")},load:function(e){e.getRootNode().appendChild({text:"EXTJS4-中文API",iconCls:"jeicon jeicon-lightning-on",leaf:!0,hrefTarget:"_blank",href:"http://extjs-doc-cn.github.io/ext4api/"})}},region:"center"};return{region:"east",title:'<i class="jeicon jeicon-question-circle" style="font-size: 14px;margin-right: 5px;"></i><span style="font-size:12px">帮助</span>',collapsed:!0,collapsible:!0,split:!0,width:200,border:1,layout:"border",items:[t,{xtype:"panel",border:0,region:"south",layout:"fit",itemId:"info",autoScroll:!0,bodyCls:"x-view-emtpytext",bodyStyle:"padding:2px;margin:0px;",height:200,split:!0,bbar:{xtype:"button",ref:"useFn",disabled:!0,text:"应用方法",handler:function(e){if(i.editor&&!Ext.isEmpty(e.funcStr)){var t=i.editor.getPosition();i.editor.executeEdits("",[{range:{startLineNumber:t.lineNumber,startColumn:t.column,endLineNumber:t.lineNumber,endColumn:t.column},text:e.funcStr}])}}}}],tools:i.getTreeTools(i)}},setValue:function(e){this.value=e,this.editor&&this.editor.setValue(this.value)},getValue:function(){var e="";return this.editor&&(this.value=e=this.editor.getValue()),e},setLineWrapping:function(e){this.editor&&this.editor.setOption("lineWrapping",e)}}),Ext.define("JE.core.view.DataView",{extend:"Ext.panel.Panel",border:0,layout:"border",animCollapse:!1,mixins:["JE.core.util.ChildUtil","JE.core.util.ViewUtil"],alias:"widget.jedataview",initComponent:function(){var a,n,e,t,d=this,o=d.funcData,i=o.info.idSuffix=Ext.value(o.info.idSuffix,"");d.items=[];var r={layout:"border",itemId:"jedataview_center",border:0,region:"center",items:[],listeners:{afterrender:function(t){if("jedataview_center"==t.itemId){var i=d.getCmp("westitem");if(!i){var e=d.up("jemainview");i=e&&e.getCmp("dictree")}if(i){t.body.setStyle({padding:"0 14px",backgroundColor:"#f6f9fc"});var a="product-navbar-collapse",n="jeicon-menu-expand",o="jeicon-menu-collapse1",r=document.createElement("div");r.setAttribute("class","product-navbar"),r.innerHTML='<div class="product-navbar-body"><div class="product-navbar-collapse-bg"></div><div class="product-navbar-collapse-icon"><i class="jeicon jeicon-menu-collapse1"></i></div></div>';var l=d.collapseEl=t.body.appendChild(r),s=l.down("i");i.isHidden()||(l.addCls(a),s.addCls(n),s.removeCls(o),t.body.setStyle("paddingLeft","20px")),l.on("click",function(){var e=l.hasCls(a);l.hide(),t.body.setStyle("paddingLeft",(e?"14":"20")+"px"),i.setVisible(!e),setTimeout(function(){l[e?"removeCls":"addCls"](a),s[e?"removeCls":"addCls"](n),s[e?"addCls":"removeCls"](o),l.show()},100)})}}}}},l={};if(Ext.isEmpty(d.type)){d.id=o.info.funcCode+"_jedataview"+i,a=o.info.funcCode+"_jetreeview"+i,n=o.info.funcCode+"_jegridview"+i,e=o.info.funcCode+"_jedataview_queryform"+i;var s=d.getChild(o,"dataview");Ext.isEmpty(s)||Ext.isEmpty(s.items)||(s.region="south",Ext.each(s.items,function(e){Ext.each(e.items,function(e){e.bodyPadding="1 0"})}),t=s,l.south=!1),!o.info.listForm&&"FORMUP"!=o.info.insertType||(d.items.push({xtype:"jeformview",funcData:o,region:"south",height:300,useChild:!1,hidden:!0,id:o.info.funcCode+"_jeformlistview"+i,split:!0,title:JE.getLocalLang("core.jemainview.formTitle"),tools:d.getListFormTools(o.info)}),d.dockedItems=[{dock:"bottom",xtype:"box",html:JE.getLocalLang("core.jemainview.formTitle"),cls:"x-view-emtpytext je-form-info-bar",listeners:{afterrender:function(i){i.getEl().on("click",function(){var e=JE.getFuncView(o.info.funcCode,"formlist",o.info.idSuffix);if(grid=Ext.getCmp(n),e){var t=grid.getSelectionModel().getSelection();e.getForm().findField(o.info.pkName);Ext.isEmpty(t)?JE.alert(JE.getLocalLang("core.jemainview.alert.dataview.unSelect")):1<t.length?JE.alert(JE.getLocalLang("core.jemainview.alert.dataview.singleSelect")):(i.hide(),e.show(),e.form.reset(),e.loadRecord(t[0]))}})}}}])}else if("query"==d.type){n=d.getId()+"_jegridview",a=d.getId()+"_jetreeview",e=d.getId()+"_queryform";var c=o.info.chHeight&&0<o.info.chHeight?o.info.chHeight:JE.getBodyHeight()/2+100;if(JE.isNotEmpty(d.queryChild)){var u={xtype:"panel",split:!0,id:d.getId()+"_childs",defaults:{flex:1,margin:"1 0 0 0"},height:c*d.queryChild.length,border:0,region:"south",layout:{type:"vbox",align:"stretch",pack:"start"},items:d.queryChild};l.south=!1,t=u}}l.center=!1,r.items=r.items.concat(d.getExtendPanels(o.info.extendPanels,l)),r.items.push({xtype:o.info.tableView?"jelistview":"jegridview",region:"center",id:n,type:d.type,multiSelect:Ext.value(d.multiSelect,o.info.multiSelect),funcData:o});var p="query"==d.type?o.select.groupQuery:o.grid.groupQuery;if(p=o.groupQuery||p,JE.isNotEmpty(p)){Ext.each(p,function(e){Ext.value(e.colSpan,1)});c=80,JE.getTheme();var f=Ext.value(o.info.gridHides,"");d.items.push({xtype:"jeformview",queryItems:p,funcData:o,id:e,itemId:"groupQueryForm",simpleQuery:JE.isNotEmpty(o.groupQuery),region:"north",height:"auto",hidden:Ext.isIE8m||-1!=f.indexOf("groupQuery"),split:!0,gridType:d.type,type:"query",border:0,animCollapse:!1,cls:"je-grid-groupquery",style:"border-width:1px;border-style:solid;",collapsible:!0,hideCollapseTool:!0,titleCollapse:!0,collapseMode:"mini",collapsed:!1,listeners:{afterrender:function(e){e.gridObj=Ext.getCmp(n)},hide:function(e){e.resetQuery(!0)}}});var E=d.items[d.items.length-1];"1"==JE.systemConfig.JE_GORUPQUERY_COLLAPESED||-1!=f.indexOf("keywordQuery")?(E.collapsed=!o.info.groupFormOpen,E.useCollapse=!0):(E.hidden=E.hidden||!o.info.groupFormOpen,o.info.simpleBar&&(E.collapsible=!1),E.collapse=function(){this.hide()})}var m="query"==d.type?o.select.treeQuery:o.grid.treeQuery;if("tree"!=o.info.funcType||"query"==d.type){var g=Number(Ext.isEmpty(o.info.qxcxWidth)||0==o.info.qxcxWidth?200:o.info.qxcxWidth),h=d.getTreeTools();h.unshift({type:"left",handler:function(){d.collapseEl.dom.click()}});var x={region:"west",title:JE.getObjAttr(o.info.otherConfig,"quickQueryTitle")||JE.getLocalLang("core.jemainview.treeQueryTitle"),split:!0,width:g,tools:h,cls:"je-tree-searchview",defaults:{xtype:"jetreeview",cls:"je-tree-searchtree",onlyItem:!1,ref:"query",flex:1},layout:{type:"hbox",pack:"start",align:"stretch"},padding:"0 10 0 0",items:[],listeners:{},itemId:"westitem"};if("plus"==JE.getTheme()&&(x.width=200<x.width?x.width:200,x.listeners.afterrender=function(e){e.splitter.on("afterrender",function(e){e.el.addCls("je-tree-searchview-splitter")})}),Ext.isEmpty(o.info.qxcxpz)){var v={border:0,funcData:o,id:a,listeners:{resize:function(e,t,i,a,n){var o=e.view.id,r=o+"-css",l=["#"+e.body.id+"{overflow:hidden !important;}","#"+o+"{width:"+(t+20)+"px !important;overflow:hidden !important;overflow-y:scroll !important;}","#"+o+">table{width:"+t+"px !important;}"];Ext.util.CSS.removeStyleSheet(r),Ext.util.CSS.createStyleSheet(l.join(" "),r)}}};if("query"==d.type&&"tree"==o.info.funcType){v.url=JE.getUrlMaps("je.core.getTree");var y=o.info.whereSql+o.info.treeFuncSql+Ext.value(d.quickSql,"");v.whereSql=y,v.parentSql=Ext.value(d.quickSql,""),v.autoload=!0,v.params={moreRoot:"TRUE"==o.info.funcDicConfig.moreRoot,tableCode:o.info.tableName,excludes:"checked"},v.searchModel=!1,v.listeners={load:function(e){e.getRootNode().hasChildNodes()||e.treeObj.ownerCt.hide()}},x.items.push(v)}else Ext.isEmpty(m)||(v.queryItems=m,v.treeItemsSql=Ext.value(d.treeItemsSql,{}),x.items.push(v));(Ext.isIE8m||o.info.treeRefresh)&&(Ext.each(x.items,function(e){e.autoload=!1}),x.hidden=!0,x.listeners.show={fn:function(e){e.items.each(function(e){e.getRootNode().hasChildNodes()||e.load()}),Ext.getCmp(n).store.loadBadge()},single:!0})}else x.defaults.onlyItem=!0,x.width=g*o.info.qxcxpz.length,Ext.each(o.info.qxcxpz,function(e,t){var i={queryItems:[e],title:e.title,padding:"0 1"};o.info.qxcxpz.length-1==t&&(i.id=a,i.funcData=o),x.items.push(i)});JE.isNotEmpty(x.items)&&d.items.push(x)}if(JE.isNotEmpty(t)){t.split=!0,t.listeners={beforerender:function(e){e.splitter.performCollapse=!1}},t.minHeight=t.height;var b=JE.toNum(Ext.value(JE.systemConfig["MINHEIGHT-"+o.info.funcCode],"400"));o.info.gridChildSS?(d.overflowY="auto",d.items.push(t),d.items.push(r),d.items={xtype:"panel",border:0,layout:"border",region:"center",minHeight:t.height+b,items:d.items}):(r.overflowY="auto",r.items.push(t),r.items={xtype:"panel",border:0,layout:"border",region:"center",minHeight:t.height+b,items:r.items,listeners:r.listeners},d.items.push(r))}else d.items.push(r);d.callParent(arguments)}}),Ext.define("JE.core.view.EditView",{extend:"Ext.tab.Panel",layout:"fit",mixins:["JE.core.util.ChildUtil"],alias:"widget.jeeditview",useChild:!0,cls:"je-editorview",initComponent:function(){var e,t=this,i=t.funcData,a=i.info.idSuffix;t.id=i.info.funcCode+"_jeeditview"+a,Ext.isEmpty(t.type)&&(e=i.info.funcCode+"_jeformview"+a);var n=[{xtype:"jeformview",funcData:i,title:Ext.value(i.info.funcFormTitle,JE.getLocalLang("core.jemainview.formTitle")),id:e,itemId:"jeformview",useChild:t.useChild}];if(t.tabBar={hidden:!0},t.useChild){var o=t.getChild(i,"editview");Ext.isEmpty(o)||(t.tabBar={height:40},t.tabBar.defaults={height:39},t.rootFunc&&(t.tabBar.cls="je-tab-bar-14"),n=n.concat(o),t.cls+=" use-tabs")}t.items=n,t.callParent(arguments)}}),Ext.define("JE.core.view.FormGridView",{extend:"Ext.grid.Panel",alias:"widget.jeformgridview",autoScroll:!0,maxWidth:600,minWidth:135,hideHeaders:!0,autoScroll:!0,columnLines:!1,buttonAlign:"center",hidden:!0,cls:"je-form-grid x-grid-with-col-lines-hideright x-grid-with-col-lines-hidebottom",initComponent:function(){var r=this,e=r.funcData;r.viewConfig={stripeRows:!1,loadMask:!1},r.store=r.store||Ext.create("JE.core.store.GridStore",{autoLoad:!0,gridObj:r}),r.relayEvents(r.store,["beforeload","load","loadrecords"]);var o=e.info.formPagingTpl.split("~~")[0],t=JE.toNum(e.info.formPagingTpl.split("~~")[1]);r.columns=[{flex:1,renderer:function(e,t,i){var a=Ext.clone(i.data),n=i.index;return JE.isEmpty(n)&&(n=0,r.store.each(function(e,t){e.index=t,e.set("_index",t)})),a.rownum=n+1,JE.toXT(o,a)}}],r.width=t>r.minWidth?t:r.minWidth,r.minButtonWidth=55,r.tbar={layout:{pack:"center"},style:"background-color: #f6f9fc;border-left:1px solid #eaeaea;",margin:0,padding:"7 0",defaults:{cls:"JEPLUS_B_C07",style:"padding: 4px !important;"},height:40,itemId:"buttonBar",items:[{text:"上一页",itemId:"prevPage",margin:"0 5 0 0",handler:function(){r.prevPage()}},{text:"下一页",itemId:"nextPage",margin:"0 0 0 5",handler:function(){r.nextPage()}}]},r.callParent(arguments),r.on("load",function(e){r.checkStatus()}),r.on("selectionchange",function(e,t){var i=t[0],a=r.funcData.info.pkName;if(i&&JE.Action.doEditForm(r.formObj,i,!1),r.gridObj)if(i){var n=i.get(a),o=r.gridObj.store.findRecord(a,n);o&&r.gridObj.getSelectionModel().select(o,!1,!0)}else r.gridObj.getSelectionModel().deselectAll(!0)})},afterRender:function(){var a=this;a.callParent(arguments),a.getEl().setStyle("right",-a.width+"px"),a.formObj.getCmp("editBox").on("resize",function(e,t,i){a.setHeight(i)}),a.buildExpandBtn()},setGridVisible:function(e){var t=this,i=t.getEl(),a=t.expandBtn.getEl(),n=t.width;e?(t.show(),i.setStyle("right",0),i.hide(),a.setStyle("right",n-1+"px"),a.hide(),i.slideIn("r",{easing:"ease",duration:200,callback:function(){t.gridVisible=!0,a.update('<i class="jeicon jeicon-menu-collapse"></i>'),a.show(),t.doLayout()}})):(a.hide(),i.slideOut("r",{easing:"ease",duration:200,callback:function(){i.setStyle("right",-n+"px"),a.setStyle("right",0),t.gridVisible=!1,a.update('<i class="jeicon jeicon-menu-expand"></i>'),a.show()}}))},buildExpandBtn:function(){var e=this,t=e.formObj.getCmp("editBox"),i=e.expandBtn=Ext.create("Ext.Component",{html:'<i class="jeicon jeicon-menu-expand"></i>',cls:"je-form-grid-expand",height:40,width:30});i.render(t.id),i.getEl().on("click",function(){e.setGridVisible(!e.gridVisible)})},loadInfo:function(e,t){this.checkStatus(),0!=t&&this.setGridVisible(!1)},checkStatus:function(){var e=this.store,t=this.getPageData();this.getDockedCmp("buttonBar").getCmp("prevPage").setDisabled(1==t.currentPage),this.getDockedCmp("buttonBar").getCmp("nextPage").setDisabled(t.currentPage==t.pageCount);var i=this.funcData.info.pkName,a=this.formObj.getValue(i),n=e.findRecord(i,a);n?this.getSelectionModel().select(n,!1,!0):this.getSelectionModel().deselectAll(!0)},prevRec:function(){var e=this,t=e.getPageData(),i=t.currentRecordIndex;t.currentRecord;0<=--i?e.getSelectionModel().select(e.store.getAt(i)):(i=e.store.pageSize-1,e.prevPage(function(){e.getSelectionModel().select(e.store.getAt(i))}))},nextRec:function(){var e=this,t=e.getPageData(),i=t.currentRecordIndex;t.currentRecord;0<=++i?e.getSelectionModel().select(e.store.getAt(i)):(i=e.store.pageSize-1,e.prevPage(function(){e.getSelectionModel().select(e.store.getAt(i))}))},prevPage:function(e){0<this.store.currentPage-1&&this.store.previousPage({callback:e})},nextPage:function(e){var t=this.getPageData().pageCount;this.store.currentPage+1<=t&&this.store.nextPage({callback:e})},getPageData:function(){var e=this.store,t=e.getTotalCount(),i={total:t,currentPage:e.currentPage,pageCount:Math.ceil(t/e.pageSize),fromRecord:(e.currentPage-1)*e.pageSize+1,toRecord:Math.min(e.currentPage*e.pageSize,t)},a=this.getSelectionModel().getSelection()[0];return a&&(i.currentRecordIndex=a.index,i.currentRecord=i.fromRecord+a.index),i}}),Ext.define("JE.core.view.FormPreView",{extend:"Ext.container.Container",alias:"widget.jeformpreview",autoScroll:!0,initComponent:function(){this.localLang=JE.getLocalLang("core.jeformview");var e=Ext.clone(this.funcData);this.funcCode=e.info.funcCode,this.cls=Ext.value(this.cls,"")+" je-form je-form-"+JE.getTheme(),this.callParent(arguments)}}),Ext.define("JE.core.view.FormView",{extend:"Ext.form.Panel",alias:"widget.jeformview",mixins:["JE.core.util.ViewUtil","JE.core.util.ChildUtil","JE.core.util.PermUtil","JE.core.util.func.Form","JE.core.util.PrintUtil"],readOnly:!1,autoScroll:!0,animCollapse:!1,frame:!1,useChild:!0,useWFLog:void 0,initComponent:function(){var o=this;o.localLang=JE.getLocalLang("core.jeformview"),o.addEvents("setvalues","selfactivate","beforesubmit","aftersubmit","endsubmit");var r=Ext.clone(o.funcData);if(o.funcCode=r.info.funcCode,o.cls=Ext.value(o.cls,"")+" je-form je-form-"+JE.getTheme(),"query"==o.type){o.cls+=" je-form-search",o.items=[],o.layout="column",o.bodyPadding="10",o.defaults={xtype:"textfield",labelAlign:"right"};var e=Ext.clone(r.form.queryButtons),t=Ext.value(r.info.gridHides,"");Ext.each(e,function(e){"groupSave"!=e.ref||"query"!=o.gridType&&-1==t.indexOf("cxcl")||(e.hidden=!0)});var l=new Ext.util.MixedCollection,s=!0;Ext.each(o.queryItems,function(e){var t=e.configInfo;if(JE.isNotEmpty(t)&&-1!=["rgroup","cgroup","cbbfield","searchfield","gridssfield","treessfield","queryuserfield"].indexOf(e.xtype)){var i=t.split(",")[1];i&&Ext.each(i.split("~"),function(e){l.add(e,{xtype:"hidden",name:e})})}var a=JE.toObj(e.otherConfig);JE.isNotEmpty(a)&&(a.editDic="0",e.otherConfig=a);var n=o.getFormGQ(e,r.info);o.allQuickQuery&&(n.columnWidth=.95),o.simpleQuery&&(n.hidden=!e.firstrow,n.firstrow=e.firstrow,n.hidden&&(s=!1),delete n.columnWidth),o.items.push(n)});var i=0;Ext.each(o.items,function(e){i+=JE.toNum(Ext.value(e.colSpan,1))});var a=3-i%3;if(o.simpleQuery){o.hidden=!1,o.collapsible=!1,o.split=!1,o.bodyPadding="5 10",o.style="border:0;",o.bodyStyle="background-color:#f6f9fc;";var n=[{text:"检索",cls:"btn JEPLUS_B_L10",ref:"groupQuery",handler:function(){JE.Action.doGroupQuery(o.gridObj,o,"form")}},{text:"清空",cls:"btn JEPLUS_B_C07",textStyle:"color:#386bd0;",handler:function(){o.resetQuery(!0)}}],d={padding:"0 0 0 10",xtype:"container",itemId:"buttonBar",margin:"2",layout:{type:"hbox",align:"middle"},defaults:{margin:"0 2",xtype:"button",width:80},items:Ext.clone(n),height:34};if(!s){o.buttons={itemId:"buttonBar",items:Ext.clone(n),margin:0,hidden:!0,defaults:{width:80},style:o.bodyStyle},o.buttonAlign="center";var c={text:"高级检索",cls:"btn JEPLUS_B_C07",textStyle:"color:#386bd0;",type:"showmore",handler:function(e){var t=o.getCmp("buttonBar"),i=o.getDockedCmp("buttonBar");t.setVisible("showsimple"==e.type),i.setVisible("showmore"==e.type),Ext.each(o.query("fieldcontainer[firstrow=false]"),function(e){e.setVisible(e.isHidden())})}},u=Ext.clone(c);u.text="收起",u.type="showsimple",d.items.push(c),o.buttons.items.push(u)}o.items.push(d)}else if(3==a)o.buttons=e,o.buttonAlign="center";else{d={padding:"0 0 0 10",xtype:"container",itemId:"buttonBar",columnWidth:a/3,layout:{type:"hbox",pack:"end",align:"bottom"},defaults:{margin:"0 2"},items:e,height:34};o.items.push(d)}if(Ext.each(o.queryItems,function(e){l.get(e.name)&&l.removeAtKey(e.name)}),0<l.getCount()){var p={xtype:"fieldcontainer",hidden:!0,defaults:{formCode:o.funcCode+"_form"},items:l.items};o.items.push(p)}o.resetQuery=function(e){o.form.reset();var t=o.query("button[ref=groupOrderBtn]");Ext.each(t,function(e){e.setTooltip(o.localLang.groupQuery.orderTip),e.setIconCls(e.initialConfig.iconCls)}),e&&JE.Action.doGroupQuery(o.gridObj,o,"form")}}else{var f=[];r.info.useTableForm?(o.cls="je-mainview-bg",o.layout={type:"vbox",align:"center"},f=o.buildIDITBox()):(o.layout="column",o.bodyPadding="10 10 0 10",o.defaults={xtype:"textfield",labelAlign:"right"},f=r.form.fields,!Ext.isEmpty(r.info.formLabelWidth)&&0<r.info.formLabelWidth&&(o.defaults.labelWidth=r.info.formLabelWidth),Ext.isEmpty(r.info.formBgColor)||(o.bodyStyle="background-color:"+r.info.formBgColor+";"),r.info.useTableForm||Ext.isEmpty(r.info.formTitleType)||"none"==r.info.formTitleType||Ext.isEmpty(r.info.formTitle)||(f=[o.getFormTitleBar()].concat(f))),o.layoutMinWidth=r.info.formMinWidth,o.trackResetOnLoad=!0,o.frame=!1,o.useFiles=r.info.file,o.useWF=r.info.wf,o.useWFLog=Ext.value(o.useWFLog,r.info.useWFLog),o.useDataLog=r.info.dataLog;e=o.buildButtons();o.tbar={itemId:"buttonBar",items:e,cls:"je-form-btnbar je-button-bar",hidden:r.info.hideFormTBar},r.info.simpleBar&&(o.tbar.cls+=" je-grid-btnbar-simple",o.tbar.height=50,o.tbar.padding="0 4",o.tbar.defaults={margin:"0 4"}),(Ext.isEmpty(e)||0==o.useTBar||o.useButtons)&&(delete o.tbar,o.useButtons&&(o.buttons=e,o.buttonAlign="left")),o.dockedItems=[],o.useWF&&o.dockedItems.push({xtype:"jewfworktaskview",itemId:"workflowTaskBar",dock:"top",weight:90,height:50}),"form"==JE.systemConfig.JE_CORE_WFTYPE&&o.dockedItems.push({xtype:"jewfformview",itemId:"workflowBar",dock:JE.isEmpty(o.buttons)?"top":"bottom",weight:100,height:160,hidden:!0});var E=-1;if(Ext.each(f,function(e,t){"child"==e.xtype&&(E=t)}),0==o.useChild)-1!=E&&f.splice(E,1);else{var m=[];if(!r.info.useTableForm){var g=o.getChild(r,"formview");Ext.isEmpty(g)||Ext.isEmpty(g.items)||(g.columnWidth=1,m.push(g))}-1!=E?Array.prototype.splice.apply(f,[E,1].concat(m)):Array.prototype.push.apply(f,m)}if(o.useFiles&&f.push({xtype:"filesset",title:o.localLang.filesLabel,formObj:o,itemId:"__files",padding:"4",margin:"4 0 0 0",columnWidth:1}),r.info.history&&!Ext.isEmpty(r.form.historyFields)){var h=o.getFormHistory();h.margin=3,f.push(h)}if(o.useWF&&o.useWFLog&&f.push(o.getFormWFLog()),Ext.isEmpty(r.info.formListeners)||(o.listeners=Ext.clone(r.info.formListeners)),!r.info.useTableForm&&0<o.layoutMinWidth&&Ext.each(f,function(e){e.hidden||(e.minWidth=e.columnWidth*o.layoutMinWidth)}),r.info.useTableForm){var x=Ext.value(r.info.tableFormWidth,210)+"mm";0<r.info.tableFormWidth2&&(x=Number(r.info.tableFormWidth2)),Ext.each(f,function(e){e.width=x,"htmlBox"!=e.itemId&&(e.style="background-color:#ffffff;")}),o.items=f}else o.items=f,o.buildFormInnerBox()}o.callParent(arguments),"query"!=o.type&&(o.form.hasInvalidField=function(){var e=!!this.getFields().findBy(function(e){var t,i=e.preventMark;return e.preventMark=!0,t=e.isValid(),e.preventMark=i,!t});return e?JE.Action.checkFieldValid(o):o.errorMenu&&o.errorMenu.hide(),e},o.formTitleBox=o.getIDITItem("formTitleBox"),o.formFilesSet=o.getIDITItem("__files"),o.formHistorySet=o.getIDITItem("__history"),o.formWFLog=o.getIDITItem("__wflog"))},getFormBox:function(){return this.getCmp("editBox")?this.getCmp("editBox").getCmp("centerBox").getCmp("formBox"):this},getIDITItem:function(e){return this.getFormBox().getCmp(e)},afterRender:function(){var e=this;e.callParent(arguments),JE.isNotEmpty(e.type)||(JE.Action.bindingFieldExp(e),e.on({destroy:function(){e.errorMenu&&e.errorMenu.hide()},hide:function(){e.errorMenu&&e.errorMenu.hide()}}))},isValid:function(){var t=this.form.isValid();if(t){var e=this.funcData;if(!Ext.isEmpty(e.form.childFuncFields)){var i=this.query("childfuncfield[formCode="+e.info.funcCode+"_form]");Ext.each(i,function(e){if(!e.isValid())return t=!1})}}return t},getPrintInfo:function(){var e=this.funcData,t={type:""};return t.func={code:e.info.funcCode,form:this},t.parentData=this.mainRecordData,e.info.lodopPrint&&e.info.lodopConfig&&-1!=e.info.lodopPrint.indexOf("FORM")?t.type="lodopPrint":(e.info.useTableForm||e.info.enableFormPrint)&&(t.type="form",e.info.tableFormPrint&&(t.lodop="PRINT"),t.parentData=this.buildPrintData()),t},buildPrintData:function(){var n={};return this.rendered&&this.getFields().each(function(e){if(e.getValue){var t=e.getValue();if("cbblistfield"==e.xtype&&!Ext.isEmpty(t)){var i=[],a=[];try{i=Ext.decode(t)}catch(e){}Ext.each(i,function(e){var t=Ext.value(e.text,e.code);a.push("<b>"+t+"</b>："+e.value)}),t=a.join("</br>")}n[e.name]=t}}),n},buildButtons:function(){var i=this,e=i.funcData,a=e.form.buttons,t=i.funcData.info.formWidth,n=[],o=[];Ext.each(a,function(e){if(0==i.useChild&&e.ref,JE.isNotEmpty(e.barPosition)&&-1!=e.barPosition.indexOf("MORE")){var t=Ext.clone(e);delete t.xtype,o.push(t)}else n.push(e);a=n}),JE.isNotEmpty(o)&&a.push({xtype:"button",text:"更多",cls:"JEPLUS_B_C07",itemId:"_moreButtons",menuAlign:"tr-br",menu:{cls:"je-menu-item34h je-menu-arrow je-menu-arrow-tr",plain:!0,shadow:!1,items:o}}),i.useWF&&(a.push("-"),a=a.concat(e.wf.formButtons)),a.push("->"),e.info.postil&&a.push({text:"批注(0)",itemId:"postilBtn",noReadOnly:!0,formObj:i,handler:function(e){var t=e.formObj.funcData.info,i=e.formObj.getValue(t.pkName);JE.isEmpty(i)?JE.alert("请先添加完数据再进行批注！"):JE.CoreUtil.showPostil({funcCode:t.funcCode,pkValue:i,button:e})}}),"left"!=e.info.formNavigatePos&&(a=a.concat(e.form.locateButtons)),i.useWF&&(a=a.concat(e.wf.commonButtons));var r=i.getPrintInfo();return JE.isNotEmpty(r.type)&&a.push(i.getFuncPrintBtn()),a=a.concat(e.common.buttons),JE.isNotEmpty(t)&&0<t&&"FORMWIN"!=e.info.insertType&&!e.info.useTableForm&&a.push(i.getFormWidthBtn()),i.configButtons&&a.push(i.configButtons),a},buildIDITBox:function(){var g=this,h=g.funcData,e=document.createElement("div");e.innerHTML=h.info.tableFormTpl;var t=Ext.get(e),i=t.query("input[type=button]"),a=[],n=[];Ext.each(i,function(e){var t=e.getAttribute("name");a.push(t)}),t.destroy(),Ext.iterate(g.funcData.basicFields,function(e,t){if("__child"!=e&&-1==a.indexOf(e)){var i=Ext.clone(t);i.hidden=!0,n.push(i)}});var o={xtype:"box",border:0,padding:"20",margin:"30 30 10 30",minHeight:200,itemId:"htmlBox",html:JE.getUEditorBox(h.info.tableFormTpl.replace("{__WF_LOG__}",""),!0),cls:"tableform-shadow",items:new Ext.util.MixedCollection,getRefItems:function(e){for(var t,i=this.items.items,a=i.length,n=0,o=[];n<a;n++)t=i[n],o[o.length]=t,e&&t.getRefItems&&o.push.apply(o,t.getRefItems(!0));return o},listeners:{afterrender:function(m){var e=m.el.query("input[type=button]");if(0<h.info.tableFormWidth2){var t=Ext.DomQuery.select("> div > table",m.el.dom);Ext.each(t,function(e){})}Ext.each(e,function(e){var t=Ext.get(e),i=Ext.get(e.parentNode),a=i.dom.style,n=Number(Ext.value(a.borderLeftWidth.replace("px",""),"0")),o=Number(Ext.value(a.borderRightWidth.replace("px",""),"0")),r=Number(Ext.value(a.paddingLeft.replace("px",""),"0")),l=Number(Ext.value(a.paddingRight.replace("px",""),"0")),s=i.dom.offsetWidth-n-o-r-l-3,d=e.getAttribute("name"),c=e.getAttribute("data-width"),u=e.getAttribute("data-height"),p=e.getAttribute("data-nobar");if("__child"!=d){var f=Ext.apply(Ext.clone(g.funcData.basicFields[d]),{hidden:!1,reportField:!0,width:s,margin:"0",padding:"0",hideLabel:!0,renderTo:i.id,cls:"je-field-basiccls",fieldCls:"x-form-field tableform-field",isFormField:!0});f.isFormField="childfuncfield"!=f.xtype,Ext.isNumeric(c)&&(f.width=Number(c)),Ext.isNumeric(u)&&(f.height=Number(u)),"1"==p&&(f.style="display:inline-table;"),(f=Ext.widget(f.xtype,f)).formObj=g,t.replaceWith(f.getEl()),g.fireEvent("add",g,f),m.items.add(d,f)}else{var E=g.getChild(h,"formview");Ext.isEmpty(E)||Ext.isEmpty(E.items)||(i.dom.removeAttribute("align"),E.renderTo=i.id,E.width=s,E.margin=0,E=Ext.widget(E.xtype,E),t.replaceWith(E.getEl()),m.items.add(E,E))}})}}};return n=[o].concat(n)},buildFormInnerBox:function(){var t=this,e=t.funcData,i={xtype:"container",layout:t.layout,defaults:t.defaults,autoScroll:!1,padding:t.bodyPadding,itemId:"formBox",items:t.items},a={xtype:"container",autoScroll:!0,itemId:"centerBox",layout:"fit",items:[i],beforeLayout:function(){this.beforeScrollTop=this.getEl().dom.scrollTop},listeners:{afterlayout:function(e){var t=e.beforeScrollTop;e.getEl().dom.scrollTop!=t&&(e.getEl().dom.scrollTop=t)}}};if(JE.isNotEmpty(e.info.formWidth)){i.width=Ext.isNumeric(e.info.formWidth)?JE.toNum(e.info.formWidth):e.info.formWidth;var n=JE.ajax({url:"je/load",params:{tableCode:"JE_CORE_USERINFO",whereSql:" and USERINFO_USERID ='"+JE.USER.id+"'  and USERINFO_FUNCCODE ='"+t.funcData.info.funcCode+"'  and USERINFO_TYPE ='FORMWIDTH'"}}).rows[0];JE.isNotEmpty(n)&&(i.width=JE.toNum(n.USERINFO_CONFIG)),a.layout={type:"hbox",align:"top",pack:"center"}}t.items=[{xtype:"container",itemId:"editBox",layout:"fit",items:[a],listeners:{afterrender:function(e){t.buildLeftLocation(e),t.buildFormGrid(e)}}},{xtype:"container",itemId:"readonlyBox"}],delete t.bodyPadding,t.autoScroll=!1,t.layout="card"},buildFormGrid:function(e){var t,i=this.funcData;i.info.formPaging&&JE.isNotEmpty(i.info.formPagingTpl)&&(t=Ext.getCmp(i.info.funcCode+"_jegridview"+i.info.idSuffix))&&(this.formGrid=Ext.create("JE.core.view.FormGridView",{store:t.store,gridObj:t,formObj:this,funcData:i})).render(e.id)},buildLeftLocation:function(a){var l=this,n=l.funcData;if("left"==n.info.formNavigatePos&&JE.isNotEmpty(n.form.locateButtons)){var s=l.leftNavbar=a.getEl().insertHtml("afterBegin",'<div class="je-form-left-navbar" style="width:150px;"></div>',!0);s.update(JE.toXT('<tpl for="."><div class="item" data-index="{#}" data-code="{info.code}">{info.name}</div></tpl>',n.form.locateButtons)),s.selectItem=function(e){var t=s.down(".active");t&&t.removeCls("active"),(t=Ext.isNumeric(e)?(e=JE.toNum(e)+1,s.down('div[data-index="'+e+'"]')):s.down('div[data-code="'+e+'"]'))&&t.addCls("active")},s.on("click",function(e){var t=e.getTarget(".item",1,!0);if(t){var i=t.getAttribute("data-code");s.selectItem(i),Ext.each(n.form.locateButtons,function(e){if(i==e.info.code)return a.scrolling=!0,JE.Action.doLocation(l,e.info),!1})}});var e=a.getCmp("centerBox");e.on("resize",function(e){var t=e.getCmp("formBox").getEl().getLocalX();s.setStyle("left",(0<t-150?t-150:0)+"px"),s.setVisible(-30<t-150)}),e.getEl().on({mousewheel:function(e,t){a.scrolling=!1},scroll:function(e,t){var r=t.scrollTop;a.scrolling||Ext.each(n.form.locateButtons,function(e){var t;if(t="child"==e.info.type?Ext.getCmp(e.info.code):l.getFields(e.info.code)){var i=t.getEl().dom,a=i.offsetTop,n=t.getEl().getMargin("t"),o=i.offsetTop+i.offsetHeight;if((a-n-0==10?0:a-0)<=r&&r<=o+0)return s.selectItem(e.info.code),!1}})}})}},getFormWidthBtn:function(){var l=this,s="",e=l.funcData.info.formWidth,d={1:"1000",2:"1024",3:"1280",4:"1366",5:"1440",6:"1600",7:"2100"},c={1:"8px",2:"17.66%",3:"32.33%",4:"47%",5:"61.4%",6:"75%",7:""},t=JE.ajax({url:"je/load",params:{tableCode:"JE_CORE_USERINFO",whereSql:" and USERINFO_USERID ='"+JE.USER.id+"'  and USERINFO_FUNCCODE ='"+l.funcData.info.funcCode+"'  and USERINFO_TYPE ='FORMWIDTH'"}}).rows[0];JE.isNotEmpty(t)&&(e=t.USERINFO_CONFIG);var n=new Ext.util.DelayedTask(function(){var e=document.getElementsByClassName("je-sliderfield"),t=d[s],i=t,a=l.getFormBox(),n=c[s];Ext.each(e,function(e){e.style.left==n?e.style.color="#386bd0":e.style.color="#A1A1A1"}),a.setWidth(JE.toNum(t)),l.getCmp("editBox").getCmp("centerBox").fireEvent("resize",l.getCmp("editBox").getCmp("centerBox"));var o=JE.ajax({url:"je/load",params:{tableCode:"JE_CORE_USERINFO",whereSql:" and USERINFO_USERID ='"+JE.USER.id+"'  and USERINFO_FUNCCODE ='"+l.funcData.info.funcCode+"'  and USERINFO_TYPE ='FORMWIDTH'"}}).rows[0];if(JE.isEmpty(o))JE.ajax({url:"/je/doSave",params:{tableCode:"JE_CORE_USERINFO",USERINFO_CONFIG:i,USERINFO_USERID:JE.USER.id,USERINFO_USERCODE:JE.USER.userCode,USERINFO_FUNCCODE:l.funcData.info.funcCode,USERINFO_FUNCID:l.funcData.info.funcId,USERINFO_TABLECODE:l.funcData.info.tableName,USERINFO_TYPE:"FORMWIDTH"}});else{var r=o.JE_CORE_USERINFO_ID;JE.ajax({url:"/je/doUpdate",params:{tableCode:"JE_CORE_USERINFO",JE_CORE_USERINFO_ID:r,USERINFO_CONFIG:i,USERINFO_USERID:JE.USER.id,USERINFO_USERCODE:JE.USER.userCode,USERINFO_FUNCCODE:l.funcData.info.funcCode,USERINFO_FUNCID:l.funcData.info.funcId,USERINFO_TABLECODE:l.funcData.info.tableName,USERINFO_TYPE:"FORMWIDTH"}})}});return{tooltip:"设置表单宽度",cls:"je-formview-formwidth",iconCls:"jeicon jeicon-form-zoom",xtype:"button",menuAlign:"tr-br",menu:{cls:"je-menu-item34h je-menu-arrow je-menu-arrow-tr",plain:!0,shadow:!1,items:[{xtype:"panel",width:300,border:0,layout:{type:"vbox",align:"stretch",pack:"start"},padding:"0 5",height:100,items:[{xtype:"box",margin:"10 0 0 0",html:'<span style="color:#A1A1A1;margin-left:9px;font-size:14px;">自定义表单宽度（px）</span>',height:20},{xtype:"sliderfield",cls:"je-field-slider",flex:1,increment:1,minValue:1,margin:"0 0 15 0",maxValue:7,value:{1e3:"1",1024:"2",1280:"3",1366:"4",1440:"5",1600:"6",2100:"7"}[e],labelAlign:"left",useTips:!1,listeners:{afterrender:function(e){var t=this.getEl().down(".x-slider-horz");t.insertHtml("beforeEnd",'<div class="je-sliderfield" style="left: 8px;margin-top:12px;position: absolute;color:#A1A1A1;">1000</div><div class="je-sliderfield" style="left:17.66%;margin-top:12px;position: absolute;color:#A1A1A1;">1024</div><div class="je-sliderfield" style="left:32.33%;margin-top:12px;position: absolute;color:#A1A1A1;">1280</div><div class="je-sliderfield" style="left:47%;margin-top:12px;position: absolute;color:#A1A1A1;">1366</div><div class="je-sliderfield" style="left:61.4%;margin-top:12px;position: absolute;color:#A1A1A1;">1440</div><div class="je-sliderfield" style="left:75%;margin-top:12px;position: absolute;color:#A1A1A1;">1600</div><div class="je-sliderfield" style="right:-10px;margin-top:11px;position: absolute;color:#A1A1A1;width: 40px;">2100</div>'),t.insertHtml("beforeEnd",'<div style="margin-top:-6px;position: absolute;height: 8px;width: 8px;background-color: #DDDDDD;border-radius: 50%;"></div><div style="left:21%;margin-top:-6px;position: absolute;height: 8px;width: 8px;background-color: #DDDDDD;border-radius: 50%;"></div><div style="left:36%;margin-top:-6px;position: absolute;height: 8px;width: 8px;background-color: #DDDDDD;border-radius: 50%;"></div><div style="left:51%;margin-top:-6px;position: absolute;height: 8px;width: 8px;background-color: #DDDDDD;border-radius: 50%;"></div><div style="left:65.4%;margin-top:-6px;position: absolute;height: 8px;width: 8px;background-color: #DDDDDD;border-radius: 50%;"></div><div style="left:80%;margin-top:-6px;position: absolute;height: 8px;width: 8px;background-color: #DDDDDD;border-radius: 50%;"></div><div style="right:14px;margin-top:-6px;position: absolute;height: 8px;width: 8px;background-color: #DDDDDD;border-radius: 50%;"></div>');var i=e.getValue(),a=document.getElementsByClassName("je-sliderfield"),n=(l.getFormBox(),c[i]);Ext.each(a,function(e){e.style.left==n?e.style.color="#386bd0":e.style.color="#A1A1A1"})},change:function(e,t,i,a){s=t,n.delay(500)}}}]}]}}}}),Ext.define("JE.core.view.GridView",{extend:"Ext.grid.Panel",alias:"widget.jegridview",mixins:["JE.core.util.ViewUtil","JE.core.util.PermUtil","JE.core.util.func.Grid","JE.core.util.PrintUtil"],readOnly:!1,cls:"je-grid-func",animCollapse:!1,autoScroll:!1,columnLines:!0,hideRightLines:!1,hideBottomLines:!1,initComponent:function(){var n=this,o=Ext.clone(n.funcData),e=Ext.decode(Ext.value(o.info.otherConfig,"{}"));n.initCommonConfig(o);var t=o.info.gridHideLines||"";n.hideBottomLines=-1!=t.indexOf("bottom"),n.hideRightLines=-1!=t.indexOf("right"),n.hideBottomLines&&(n.cls+=" x-grid-with-col-lines-hidebottom"),n.hideRightLines&&(n.cls+=" x-grid-with-col-lines-hideright");var i=0;if(viewConfig={stripeRows:!0},JE.isNotEmpty(e.rowColor)&&(viewConfig={stripeRows:"1"==e.rowColor}),n.relayEvents(n.store,["beforeload","load","loadrecords"]),"query"==n.type)n.columns={items:o.select.columns};else{n.addEvents("refreshlocation");var a=[],r=JE.CoreUtil.getUserInfo("COLUMN",o),l=o.grid.iditColumns,s=o.grid.columns;if(JE.isEmpty(l)&&(l=[]),l.push.apply(l,s),JE.isEmpty(r)?a=o.grid.columns:(Ext.each(o.grid.columns,function(e){e.locked&&a.push(e)}),Ext.each(r.config.show,function(t){Ext.each(l,function(e){if(e.dataIndex==t)return e.hidden=!1,a.push(e),!1})})),n.columns={items:a},"LIST"==o.info.insertType){n.cls+=" je-grid-insert";var d=o.basicColumns,c=o.basicFields,u=[];Ext.iterate(d,function(e,t){t.hidden&&u.push({name:t.dataIndex,xtype:"hidden",value:Ext.value(c[t.dataIndex],{value:""}).value})}),n.columns.items.push({width:0,hiddenColumn:!0,hideable:!1,hidden:!0,items:u})}if(Ext.isEmpty(o.info.gridListeners)||(n.listeners=Ext.clone(o.info.gridListeners),delete n.listeners.treequeryformat),n.gridUpdateBtnPrem()&&(n.plugins.push(Ext.create("Ext.grid.plugin.CellEditing",{clicksToEdit:1,pluginId:"cellEdit"})),o.info.gridDDOrder&&Ext.isEmpty(o.info.groupField)&&Ext.isEmpty(o.info.merges)&&(viewConfig.plugins=[{ptype:"gridviewdragdrop",dragText:JE.getLocalLang("common.dragText"),pluginId:"ddOrder",ddGroup:o.info.funcCode+"_GridDD"}],viewConfig.listeners={drop:function(e,t,i,a){JE.Action.doDrop(n,n.info,1)}},o.info.pageSize=-1,n.funcData.info.pageSize=-1,n.store.pageSize=-1)),o.info.summary){var p=!1;if(Ext.iterate(n.listeners,function(e,t){if("gridsummary"==e)return!(p=!0)}),!p){var f={ftype:"summary",summaryTableCls:"x-grid-row-summary-all",dock:"bottom",useSummaryAll:!0,showSummaryRow:!0};Ext.isEmpty(o.info.groupField)?o.info.gridDDOrder&&(f.showSummaryRow=!1):f.showSummaryRow=!1,o.info.gridBuffered&&(f.showSummaryRow=!1),n.features.push(f)}}if(!Ext.isEmpty(o.info.groupField)){var E={ftype:"grouping",groupByText:n.localLang.groupByText,showGroupsText:n.localLang.showGroupsText};Ext.isEmpty(o.info.groupFieldTpl)||(E.groupHeaderTpl=o.info.groupFieldTpl),o.info.summary&&(E.ftype="groupingsummary",E.summaryRowCls="x-grid-row-summary"),n.features.push(E)}Ext.isEmpty(o.info.merges)||(viewConfig={stripeRows:!1,trackOver:!1,overItemCls:""},n.columns.defaults=Ext.value(n.columns.defaults,{}),n.columns.defaults.sortable=!1),Ext.isEmpty(o.info.gridRowTip)||o.info.allowLocked||(n.setGridRowPlugin(viewConfig),o.info.gridRowTipShow||(i=1)),JE.isNotEmpty(o.gridExp)&&n.store.on("update",function(e,t,i){if("edit"==i){var a={},n=t.data;Ext.iterate(o.gridExp,function(e,t){JE.isNotEmpty(t.fn)?a[e]=JE.eval(t.fn)(n):a[e]=JE.toXT(t.exp,n)}),t.set(a)}})}n.columns.items=Ext.value(n.columns.items,[]),n.columns.defaults=Ext.value(n.columns.defaults,{}),n.columns.defaults.jecolumn=!0,n.viewConfig=Ext.apply(Ext.value(n.viewConfig,{}),viewConfig),n.viewConfig.enableTextSelection=!0,n.viewConfig.loadMask=!1,1==n.multiSelect&&(n.selModel={injectCheckbox:i,selType:"checkboxmodel",checkOnly:!0,headerWidth:40,checkSelector:".x-grid-cell-row-checker"}),n.store.buffered&&(delete n.bbar,(n.selModel=Ext.value(n.selModel,{})).pruneRemoved=!1);n.callParent(arguments),n.initSearchField(),n.lockable&&n.lockedGrid&&n.normalGrid&&(n.cls+=" je-lockedGrid",n.lockedGrid.funcData=n.normalGrid.funcData=n.funcData),n.getPlugin("cellEdit")&&o.info.sh&&n.on("beforeedit",function(e){if("1"==e.context.record.get("SY_ACKFLAG"))return!1})},buildDColumns:function(e){var t=this.store,i=this.headerCt,a=JE.ajax({url:JE.getUrlMaps("je.core.getIditProcedureColumn"),params:e}),n=[this.funcData.info.pkName];Ext.each(a,function(e){n.push(e.dataIndex)}),t.removeAll(),t.model.setFields(n);i.items.each(function(e){e.dcolumn&&i.remove(e)}),i.add(a),JE.msg("列重建成功")},afterRender:function(){this.callParent(arguments),"iditprocedure"==this.funcData.info.funcType&&this.buildDColumns(this.store.proxy.extraParams),JE.isNotEmpty(this.type)||-1!=["procedure","iditprocedure","sql"].indexOf(this.funcData.info.funcType)||(JE.Action.bindingColumnExp(this),this.initColumnEditCfg(),this.buildFloatAction())},getValues:function(){var t={},e=this.headerCt.query("[isFormField]");return Ext.each(e,function(e){t[e.name]=e.getValue()}),t},reset:function(){var e=this.headerCt.query("[isFormField]");Ext.each(e,function(e){e.reset()})},setValues:function(t){var e=this.headerCt.query("[isFormField]");Ext.each(e,function(e){t[e.name]&&e.setValue(t[e.name])})},getFields:function(e){var t="[isFormField]";if(Ext.isEmpty(e)){var i=new Ext.util.MixedCollection;return i.add(this.headerCt.query(t)),i}return this.headerCt.down(t+"[name="+e+"]")},isValid:function(){var t=!0,e=this.headerCt.query("[isFormField]");return Ext.each(e,function(e){if(!e.isValid())return t=!1}),t},doSubmit:function(t){var e=t.params,i=this.headerCt.query("[isFormField]"),a={};if(Ext.each(i,function(e){var t=e.getValue();Ext.isEmpty(t)||(t=JE.toDefVal(t),t=Ext.isBoolean(t)?t?"1":"0":t,a[e.name]=t)}),t.params=e=Ext.applyIf(a,e),Ext.each(i,function(e){t.params[e.name]||(t.params[e.name]="")}),!Ext.isEmpty(e.uploadableFields)){var n=this.buildForm(t);t.form=n.formEl,t.isUpload=!0}Ext.applyIf(t,{method:"POST",async:!1,failure:function(e){JE.error(e.responseText,t.url,"请求参数："+Ext.encode(t.params))}}),Ext.Ajax.request(t)},buildForm:function(t){var e,i,a=[],n=[],o=[],r=this.headerCt.query("[isFormField]");Ext.each(r,function(e){e.rendered&&(e.isFileUpload()?n.push(e):a.push({tag:"input",type:"hidden",name:e.name,value:Ext.String.htmlEncode(t.params[e.name])}))}),e={tag:"form",action:this.store.actUrls.save,method:"POST",target:"_self",style:"display:none",cn:a},n.length&&(e.encoding=e.enctype="multipart/form-data"),i=Ext.DomHelper.append(Ext.getBody(),e);for(var l=n.length,s=0;s<l;++s)el=n[s].extractFileInput(),i.appendChild(el),o.push(el);return{formEl:i,uploadFields:n,uploadEls:o}},buildFloatAction:function(){var r=this;if(r.funcData.grid.floatAction){var e=document.createElement("div");e.style="cursor: pointer;width:40px;color:#444;height:25px;line-height:25px;text-align:center;background:#fff;position: absolute;right:0;border-radius: 4px 0 0 4px;box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);",e.innerHTML='<i class="jeicon jeicon-more"/>',r.actionEl=r.body.appendChild(e);var i=[];Ext.each(r.funcData.grid.actions,function(e){var t=Ext.clone(e);t.text=e.tooltip,t.actions=t.listeners||{},delete t.tooltip,delete t.listeners,i.push(t)}),r.actionMenu=Ext.create("Ext.menu.Menu",{cls:"je-menu-item34h je-menu-arrow je-menu-arrow-tr",plain:!0,shadow:!1,items:i,defaults:{listeners:{click:function(e){e.actions&&e.actions.handler&&e.actions.handler(r,r.actionMenu.record)}}},listeners:{beforeshow:function(t){t.items.each(function(e){e.actions&&(e.actions.isEnabled&&e.setDisabled(0==e.actions.isEnabled(r,t.record)),e.actions.isHidden&&e.setVisible(!e.actions.isHidden(r,t.record)))})}}});var l=new Ext.util.DelayedTask(function(){r.actionEl.hide()});r.actionEl.on({click:function(){r.actionMenu.showBy(r.actionEl,"tr-br")},mouseenter:function(){setTimeout(function(){l.cancel()},300)}}),r.on("itemmouseenter",function(e,t,i,a,n){l.cancel(),r.actionMenu.record=t,r.actionMenu.hide(),r.actionEl.show();var o=r.actionEl.getAlignToXY(i,"r-r");r.actionEl.setY(o[1]),r.actionEl.setStyle({left:"auto",right:0})}),r.on("itemmouseleave",function(e,t,i,a,n){l.delay(500)})}}}),Ext.define("JE.core.view.IconView",{extend:"Ext.panel.Panel",alias:"widget.jeiconview",layout:"fit",funcCode:"JE_SYS_ICON",itemdblclick:Ext.emptyFn,initComponent:function(){this["build_"+this.funcCode+"_info"](),this.callParent(arguments)},build_JE_SYS_ICON_info:function(){var e={tableName:"JE_CORE_FONTICON",pkName:"JE_CORE_FONTICON_ID",orderSql:"order by FONTICON_CLS ASC,SY_CREATETIME DESC",queryFields:[{name:"FONTICON_CLS"},{name:"FONTICON_NAME"},{name:"FONTICON_FONT"}],tpl:['<tpl for=".">','<div class="icon" title="{FONTICON_CLS}">','<img src="{[values.ICON_PATH.split("*")[1]]}">','<span>{ICON_NAME}</span><span style="float:right;color:#cecece;">{ICON_SIZE_CODE}</span>',"</div>","</tpl>"]};this.store=JE.getStore({tableName:e.tableName,id:e.pkName,pageSize:100,autoLoad:!0,params:{whereSql:"",orderSql:e.orderSql}});var t=Ext.create("Ext.view.View",{itemId:"view",store:this.store,cls:"je-icon-view",tpl:e.tpl,autoScroll:!0,itemSelector:"div.icon",emptyText:"",overItemCls:"icon-over",selectedItemCls:"icon-select",listeners:{itemdblclick:this.itemdblclick}});this.items=t,this.tbar=[{xtype:"qqfield",gridObj:t,queryFields:e.queryFields}],this.bbar={xtype:"uxpagingtoolbar",itemId:"pagingtoolbar",store:this.store,useTheme:!0}},build_JE_CORE_FONTICON_info:function(){var a=this,e={tpl:['{% var font = "",fonts=[];%}','<tpl for=".">',"{% if(JE.isEmpty(font) || font != values.name){font = values.name;fonts.push(font);%}",'<div class="icon-name" data-name="{name}">{name}</div>','<div class="icons">',"{%}%}",'<div class="icon" title="{text}">','<i class="{cls}"></i>','<span class="cls">{[this.keyword(values.clsName)]}</span>','<span class="full-cls">{[this.keyword(values.cls)]}</span>',"</div>","{% if(!JE._fonticon_data_.data[xindex] || font != JE._fonticon_data_.data[xindex].name){%}","</div>","{%}%}","</tpl>",{keyword:function(e){return JE.isEmpty(e)?e:e.replace(a.keyword,'<span style="color:red;">'+a.keyword+"</span>")}}]};if(JE.isEmpty(JE._fonticon_data_)){var t=JE.ajax({url:"/static/fonts/font.json",urlMaps:!1}),i=[];Ext.each(t,function(e){-1==i.indexOf(e.name)&&i.push(e.name)}),JE._fonticon_data_={data:t,names:i}}a.tbar={itemId:"fontbar",cls:"je-button-bar",items:[],defaults:{handler:function(e){var t=a.getCmp("view").getEl(),i=t.down('.icon-name[data-name="'+e.text+'"]');JE.scrollBy(t,i,!0)}}},Ext.each(JE._fonticon_data_.names,function(e){a.tbar.items.push({text:e,cls:"btn JEPLUS_B_L10",margin:"0 4"})}),a.tbar.items.push({xtype:"textfield",width:200,margin:"0 10",emptyText:"请输入样式名称",itemId:"searchfield",listeners:{change:function(){a.doSearchKeyword()}}}),a.store=Ext.create("Ext.data.Store",{fields:["name","cls","clsName","FONTICON_CLS","text"],data:JE._fonticon_data_.data});var n=Ext.create("Ext.view.View",{itemId:"view",store:a.store,cls:"je-icon-view fonticon",tpl:e.tpl,itemSelector:"div.icon",emptyText:"",overItemCls:"icon-over",selectedItemCls:"icon-select",autoScroll:!0,listeners:{itemdblclick:a.itemdblclick}});a.items=n},doSearchKeyword:function(){var e=this;e.searchTask||(e.searchTask=new Ext.util.DelayedTask(function(){var n=e.getDockedCmp("fontbar").getCmp("searchfield").getValue().toLocaleLowerCase();e.keyword=n,e.getCmp("view").store.filterBy(function(e){var t=e.get("cls").toLocaleLowerCase(),i=e.get("name").toLocaleLowerCase(),a=e.get("text").toLocaleLowerCase();return-1!=t.indexOf(n)||-1!=i.indexOf(n)||-1!=a.indexOf(n)})})),e.searchTask.delay(100)}}),Ext.define("JE.core.view.IDITEditor",{extend:"JE.core.view.CodeEditor",alias:"widget.iditeditor",editorMode:"javascript",useHelp:!1,initComponent:function(){var e="",t="JE_SYS_JS",i=this.editorMode;"css"==i&&(t="JE_SYS_CSS");var a=JE.ajax({url:"/je/load",params:{tableCode:"JE_CORE_SETTING",whereSql:" AND CODE='"+t+"'",limit:-1}}).rows[0]||{};"javascript"==i?e=a.VALUE||"(function(){\n\n})()":"css"==i&&(e=a.VALUE||""),this.basicValue=this.value=e,this.basicTitle=this.title,this.callParent(arguments)},initEditorEvent:function(){var e=this;e.editor.onDidChangeModelContent(function(){e.hasChange()?e.setTitle(e.basicTitle+"*"):e.setTitle(e.basicTitle)})},hasChange:function(){return this.basicValue!=this.editor.getValue()},tabBeforeClose:function(){if(this.hasChange())return confirm("确定放弃本次编辑吗？")},saveFn:function(e){this.basicValue=e;var t="/je/sysConfig/sysConfig/saveJsFile";"css"==this.editorMode&&(t="/je/sysConfig/sysConfig/saveCssFile");var i=JE.ajax({url:t,params:{context:e,type:this.editorMode}});i.success?(this.setTitle(this.basicTitle),JE.msg(this.editorMode+" 代码已经生成，请刷新页面！")):JE.alert(i.obj)}}),Ext.define("JE.core.view.industry.Cell",{constructor:function(e){var t=this,i=e.cell,a=e.editor;t.cell=i,t.panel=e.panel,t.editor=a,t.name=t.getAttribute("name"),t.type=t.getAttribute("type"),t.label=t.getAttribute("label"),t.field=t.getAttribute("field"),t.group=t.getAttribute("group"),t.code=t.getAttribute("code"),t.text=t.getAttribute("text"),t.defaultValue=t.getAttribute("defValue"),t.id=i.getId(),t.box=i.geometry.clone(),t.util={defaultColor:"#ffffff"};e=t.getAttribute(t.type+"Config");if(JE.isNotEmpty(e)&&(t.config={},Ext.each(JE.decode(e),function(e){t.config[e.value]=e})),"scale"==t.type)t.scaleCell=i.getParent().insert(i.clone(),i.getParent().getIndex(i)),a.graph.setCellStyles("fillColor","transparent",[i]),a.graph.setCellStyles("strokeColor","transparent",[i]);else if("text"==t.type){JE.isNotEmpty(t.label.match(/\{.*?\}/g))&&(t.labelTpl=t.label)}else"custom"==t.type&&t.buildCustom();JE.isNotEmpty(t.defaultValue)&&t.setValue(t.defaultValue);var n=t.getAttribute("clickFn");JE.isNotEmpty(n)&&(t.clickFn=JE.eval(n))},setValue:function(){var e=this;switch(e.type){case"text":e.setLabel.apply(e,arguments);break;case"light":e.setLight.apply(e,arguments);break;case"path":e.animatPath.apply(e,arguments);break;case"scale":e.setScale.apply(e,arguments);break;case"switch":e.setSwitch.apply(e,arguments)}},setLabel:function(r,e,t){var i=this.cell,l="",s="";Ext.iterate(this.config,function(e,t){if(JE.isNotEmpty(e)){var i=e.split("-");if(1<i.length){var a=JE.toNum(i[0]),n=JE.toNum(i[1]),o=JE.toNum(r);if(a<o&&o<=n)return l=t.info,s=t.bgColor,!1}else if(e==r)return l=t.info,void(s=t.bgColor)}});e=Ext.value(e,l);JE.isNotEmpty(e)&&this.editor.graph.setCellStyles("fontColor",e,[i]);t=Ext.value(t,s);JE.isNotEmpty(t)&&this.editor.graph.setCellStyles("fillColor",t,[i]),this.labelTpl&&(r=JE.toXT(this.labelTpl,{value:r})),this.editor.graph.cellLabelChanged(this.cell,r)},getAttribute:function(e){return this.cell.getValue().getAttribute(e)},animatPath:function(e,t,i,a){var n=this;e=Ext.value(e,!1),i=Ext.value(i,!0),a=Ext.value(a,1);if(!Ext.isIE8m&&"path"==n.type&&-1!=[!0,!1,1,0,"1","0"].indexOf(e))if(e=Ext.isNumeric(e)?"1"==e||1==e:e,n.sort=Ext.isNumeric(i)?"1"==i||1==i:i,n.speed=-(a<1?1:a),JE.isNotEmpty(t)&&n.editor.graph.setCellStyles("strokeColor",t,[n.cell]),e&&e!=n.start){n.start=e,n.editor.graph.setCellStyles("dashed","1",[n.cell]);var o=n.editor.graph.view.getState(n.cell);if(JE.isEmpty(o))return;var r=Ext.get(o.shape.node).child("[visibility!=hidden]",!0);"path"==r.nodeName&&(n.pathDom=r,n.animatPathInfo=JE.defer(function(){var e=n.pathDom,t=e.getTotalLength(),i=n.speed;n.sort||(t=0,i=-i),t=JE.toNum(Ext.value(e.getAttribute("stroke-dashoffset"),t)),t+=i,e.setAttribute("stroke-dashoffset",t)},50))}else!e&&n.animatPathInfo&&(n.animatPathInfo.clear(),n.pathDom&&n.pathDom.setAttribute("stroke-dashoffset",""),delete n.animatPathInfo,delete n.pathDom,delete n.speed,delete n.sort,delete n.start,n.editor.graph.setCellStyles("dashed","0",[n.cell]))},setLight:function(e,t){if("light"==this.type){t=Ext.value(t,Ext.value(this.config[e],{}).info);this.editor.graph.setCellStyles("fillColor",Ext.value(t,this.util.defaultColor),[this.cell])}},setScale:function(e,o){var t=this.cell,i=this.box,a=t.geometry.clone(),r=JE.toNum(Ext.value(e,100));r<0?r=0:100<r&&(r=100),"H"==this.getAttribute("scaleHV")?a.width=r/100*i.width:(a.height=r/100*i.height,a.y=i.y+i.height-a.height),t.setGeometry(a);o=this.util.defaultColor;Ext.iterate(this.config,function(e,t){if(JE.isNotEmpty(e)){var i=e.split("-"),a=JE.toNum(i[0]),n=JE.toNum(i[1]);if(a<r&&r<=n)return o=t.info,!1}}),this.editor.graph.setCellStyles("fillColor",o,[t]),this.editor.graph.cellLabelChanged(this.scaleCell,r+"%"),this.editor.graph.refresh(t)},setSwitch:function(e,t){var i=this.cell;t=Ext.value(t,Ext.value(this.config[e],{}).info);this.editor.graph.setCellStyles("image",Ext.value(t,JE.getStaticUrl("JE.core.view.industry.Cell.image")),[i])},buildCustom:function(){var e,t=this;switch(t.getAttribute("funcType")){case"APP":var i=t.getAttribute("customMainCtr");Ext.isEmpty(i)||Ext.each(i.split(","),function(e){JE.initCtr(e)});var a=t.getAttribute("customMainView");e={xtype:JE.getXTypeByClassName(a)};break;case"HTML":e={xtype:"box",autoScroll:!0,tpl:t.getAttribute("customHtml"),data:{}};break;case"CHART":e={xtype:"jechartview",hideMenu:!0,chartCode:n=t.getAttribute("customChartCode")},Ext.isEmpty(n)&&(e.xtype="box",e.html="图表没有配置报表编码，无法显示！");break;case"REPORT":var n;e={xtype:"jereportview",hideMenu:!0,directLoad:!0,reportCode:n=t.getAttribute("customReportCode")},Ext.isEmpty(n)&&(e.xtype="box",e.html="报表没有配置报表编码，无法显示！")}if(e){e.itemId="item";var o=t.box;t.cmp=Ext.create("Ext.panel.Panel",{width:t.box.width,height:t.box.height,border:0,layout:"fit",bodyStyle:"background-color:transparent;",autoScroll:!1,items:e});var r=document.createElement("div");r.style="position: absolute;top:"+o.y+"px;left:"+o.x+"px;width:"+o.width+"px;height:"+o.height+"px;";var l=t.panel.getGraphEl().appendChild(r,!0);t.cmp.render(l);var s=t.editor.graph.view.getState(t.cell);if(JE.isEmpty(s))return;Ext.get(s.shape.node).hide()}},setVisible:function(e){this.editor.graph.setCellsVisible(this.cell,e)}}),Ext.define("JE.core.view.industry.IndustryView",{extend:"JE.core.ux.mxgraph.Graph",alias:"widget.jeindustryview",debug:!1,industryCode:void 0,type:"display",time:void 0,timerFn:void 0,initComponent:function(){var n=this;n.bodyStyle="background-color:#FFFFFF;",n.editor=Ext.create("JE.core.ux.mxgraph.util.Editor",{readOnly:!0,initEvent:function(){var e=this.editor.graph;"display"==n.type?(e.addListener(mxEvent.CLICK,function(e,t){var i=t.getProperty("cell");if(i){var a=n.getNode(i.getAttribute("name"));a&&a.clickFn&&a.clickFn(a,n)}}),e.getCursorForCell=function(e){if(e&&n.getNode(e.getAttribute("name"))&&n.getNode(e.getAttribute("name")).clickFn)return"pointer"}):(e.getCursorForCell=function(e){if(e&&"background"!=e.getAttribute("type"))return"pointer"},e.setCellsBendable(!1),mxEdgeHandler.prototype.isHandleVisible=function(e){return this.graph.isCellsBendable()},e.isCellResizable=function(e){return!1})}}),n.editor.editor.graph.click=function(e){var t=e.getEvent(),i=e.getCell();if(!i||"background"!=i.getAttribute("type")){var a=new mxEventObject(mxEvent.CLICK,"event",t,"cell",i);if(e.isConsumed()&&a.consume(),this.fireEvent(a),"select"==n.type)if(!mxEvent.isConsumed(t)&&!a.isConsumed())if(null!=i)if(this.isCellSelected(i))n.removeSelectItem(i),this.removeSelectionCell(i);else n.addSelectItem(i)&&this.addSelectionCell(i)}};var e=Ext.apply(n.buildGraphBox(),{style:"position: relative;"});n.items=[e],"select"==n.type&&(n.layout="border",e.region="center",n.items.push(n.buildSelectView())),n.callParent(arguments),n.on("destroy",function(){n.timer&&n.timer.clear()})},addSelectItem:function(e,t){var i=e.getAttribute("name"),a=e.getAttribute("code"),n=e.getAttribute("text"),o=e.getAttribute("type"),r=e.getAttribute("dataType");if(JE.isEmpty(a))return JE.msg("数据编码为空，无法加入！"),!1;var l=this.getCmp("grid"),s=l.store.findRecord("code",a);if(s){var d=JE.split(s.get("names"),",");d.push(i),s.set("names",d.join(","))}else l.store.add({code:a,text:n,type:o,dataType:r,names:i});return!0},removeSelectItem:function(e){var t=e.getAttribute("name"),i=e.getAttribute("code"),a=this.getCmp("grid"),n=a.store.findRecord("code",i);if(n){var o=JE.split(n.get("names"),","),r=o.indexOf(t);-1!=r&&o.splice(r,1),JE.isEmpty(o)?a.store.remove(n):n.set("names",o.join(","))}},afterRender:function(){var i=this;if(i.callParent(arguments),i.menu=Ext.create("Ext.menu.Menu",{renderTo:Ext.getBody(),items:[{text:"缩略图",iconCls:"jeicon jeicon-search",handler:function(){i.editor.showOutline()}},{text:"放大",iconCls:"zoomin_16",handler:function(){i.editor.editor.graph.zoomIn()}},{text:"缩小",iconCls:"zoomout_16",handler:function(){i.editor.editor.graph.zoomOut()}},{text:"正常",iconCls:"jeicon jeicon-table-column-synchronization",handler:function(){i.editor.editor.graph.zoomTo(1)}}]}),i.body.on("contextmenu",function(e,t){i.menu.showAt(e.getXY())}),JE.isNotEmpty(i.industryCode)){var e=JE.ajax({url:JE.getUrlMaps("je.core.load"),params:{tableCode:"JE_CORE_INDUSTRY",whereSql:" AND INDUSTRY_BM = '"+i.industryCode+"'",limit:1}}).rows[0];e&&JE.isNotEmpty(e.INDUSTRY_NR)&&(i.loadData(JE.decodeURI(e.INDUSTRY_NR)),i.childFunc||i.load())}},types:["switch","path","text","light","scale"],groups:void 0,nodes:void 0,doGroupAction:function(e,a){var n=a.items;delete a.items;var t=this.getGroup(e),i=this.getNode(e);JE.isEmpty(n)&&i&&(n=[group],t=[i]),Ext.each(t,function(t){var i=Ext.clone(a);if(Ext.each(n,function(e){if(e.name==t.name||e.type==t.type)return i=Ext.applyIf(e,i),!1}),JE.isNotEmpty(i.value)){var e=[i.value,i.color];switch(t.type){case"text":e.push(i.bgColor);break;case"path":e.push(i.front,i.speed);break;case"switch":e.splice(1,1,i.url)}t.setValue.apply(t,e)}JE.isNotEmpty(i.visible)&&t.setVisible(i.visible)})},loadData:function(e){var n=this;n.groups=Ext.create("Ext.util.MixedCollection"),n.nodes=Ext.create("Ext.util.MixedCollection"),n.editor.loadData(e);var t=n.editor.editor.graph,i=n.editor.getAllCells(!0,!0,null,!0),o=t.getModel(),a=o.getRoot();if(JE.isEmpty(n.timerFn)){var r=a.getAttribute("timerFn");JE.isNotEmpty(r)&&(n.timerFn=JE.eval(r))}if(JE.isEmpty(n.time)){var l=JE.toNum(a.getAttribute("time"));0<l&&(n.time=l)}if(Ext.each(i,function(e){if(!e.isEdge()||Ext.isIE&&!Ext.isIE9p||mxUtils.setCellStyles(o,[e],"endArrow","none"),"background"!=e.getAttribute("type")){var t=Ext.create("JE.core.view.industry.Cell",{cell:e,editor:n.editor.editor,panel:n});n.nodes.add(t.name,t);var i=t.group;if(JE.isNotEmpty(i)){var a=n.groups.get(i)||[];a.push(t),n.groups.add(i,a)}}else n.background=Ext.create("JE.core.view.industry.Cell",{cell:e,editor:n.editor.editor,panel:n})}),"select"==n.type&&n.initData){i=n.editor.getAllCells(!0,!0);var s=[],d=n.getCmp("grid");Ext.each(n.initData,function(e){d.store.add(e),Ext.each(JE.split(e.names,","),function(t){Ext.each(i,function(e){JE.isNotEmpty(e.id)&&t==e.getAttribute("name")&&s.push(e)})})}),JE.isNotEmpty(s)&&n.editor.editor.graph.setSelectionCells(s)}},setValues:function(e){var a=this;Ext.iterate(e,function(e,t){var i=a.nodes.get(e);i&&i.setValue(t)})},getNode:function(e){return this.nodes.get(e)},getGroup:function(e){return this.groups.get(e)},load:function(e){var t=this;if("select"!=t.type&&t.timerFn){var i=t.timerFn(t,Ext.value(e,{}));0<t.time&&0!=i&&1!=t.noTimer&&(t.timer&&t.timer.clear(),t.timer=JE.defer(function(){return t.timerFn(t)},1e3*t.time))}},buildSelectView:function(){var c=this;return{xtype:"grid",hideHeaders:!0,columns:[{text:"节点",dataIndex:"text",flex:1,renderer:function(e,t,i){return e+"("+i.get("code")+')<input type="button" class="jeicon jeicon-error je-button-icon remove" style="float:right;cursor: pointer;" />'}}],store:Ext.create("Ext.data.Store",{fields:["names","code","text","type","dataType"]}),region:"east",itemId:"grid",border:0,width:200,split:!0,listeners:{cellclick:function(e,t,i,a,n,o,r){if(r.getTarget(".remove")){var l=a.get("code");e.getStore().remove(a);var s=c.editor.editor.graph.getSelectionCells(),d=[];Ext.each(s,function(e){e.getAttribute("code")==l&&d.push(e)}),c.editor.editor.graph.removeSelectionCells(d)}}},tbar:[{xtype:"box",html:"数据规划",style:"color: #04468c;font-weight: bold;"},"->",{text:"确定",handler:function(){var t=[];c.getCmp("grid").store.each(function(e){t.push(e.data)}),c.selectFn&&c.selectFn(t)}}],style:"border-left-width: 1px;border-left-style: solid;",viewConfig:{plugins:[{ptype:"gridviewdragdrop",dragText:"拖动排序",pluginId:"ddOrder",ddGroup:"GridDD"}]}}}}),Ext.define("JE.core.view.ListenerEditor",{extend:"Ext.panel.Panel",alias:"widget.jelistenereditor",layout:"border",value:"",type:void 0,childType:void 0,saveFn:void 0,initComponent:function(){this.items=[this.buildEventGrid(),this.buildCodeEditor()],this.callParent(arguments)},afterRender:function(){this.callParent(),this.eventview=this.getCmp("eventview").getCmp("grid"),this.editorview=this.getCmp("editorview"),this.loadData(this.type,this.value,this.childType)},loadData:function(o,r,l){var s=this;setTimeout(function(){var e=s.getComponent("editorview"),t=s.eventview;if(e.setValue(""),JE.isEmpty(o)||void 0===r)t.store.removeAll();else{r=Ext.value(r,[]),Ext.isString(r)&&(r=JE.decode(r));var i=Ext.clone(Ext.value(JE.jsEditor[o],[])),a={};"field"==o?-1!=["gridssfield","gridssareafield","treessfield","treessareafield","queryuserfield","queryuserareafield"].indexOf(l)&&(l="ssfield"):-1==["actioncolumn"].indexOf(o)&&(i=i.concat(Ext.clone(JE.jsEditor.common))),JE.isNotEmpty(JE.jsEditor[l])&&(i=Ext.clone(JE.jsEditor[l]).concat(i));var n=new Ext.util.MixedCollection;Ext.each(i,function(e){a[e.code]=e.code}),Ext.each(i,function(t){Ext.each(r,function(e){t.code==e.code?Ext.apply(t,{fire:Ext.value(e.fire,!1),newfunc:e.newfunc}):a[e.code]||n.add(e.code,e)})}),i=n.items.concat(i),t.store.loadData(i)}},1e3)},buildCodeEditor:function(){var e=this;return{xtype:"jecodeeditor",region:"center",itemId:"editorview",border:0,saveFn:function(){e.eventview.getDockedCmp("buttonBar").getCmp("save").fireHandler()}}},buildEventGrid:function(){var l=this,e={xtype:"grid",region:"center",itemId:"grid",columnLines:!0,autoScroll:!0,split:!0,border:0,cls:"je-buildEventGrid-center",store:Ext.create("Ext.data.Store",{fields:["code","name","func","fire","newfunc"],data:[]}),columns:{defaults:{sortable:!1,resizable:!1,menuDisabled:!0},items:[{text:"监听事件",dataIndex:"name",flex:1,renderer:function(e,t,i){return Ext.isEmpty(i.get("func"))&&(t.tdAttr=' style="background-color:#DCFFC0;" '),e+"("+i.get("code")+")"}},{xtype:"uxcheckcolumn",dataIndex:"fire",uncheckedCls:"jeicon jeicon-lightning-off",rightBorderColor:"transparent",checkedCls:"jeicon jeicon-lightning-on",width:40,text:"注册",align:"center"}]}};e.listeners={selectionchange:function(e,t){var i=t[0]?t[0].data:{},a=e.view.panel,n=l.editorview,o=Ext.value(i.func,""),r=Ext.value(i.newfunc,"");a.getDockedComponent("buttonBar").items.each(function(e){"button"==e.xtype&&"save"!=e.itemId&&("removeL"==e.itemId?e.setDisabled(JE.isNotEmpty(o)):"save"!=e.itemId&&e.setDisabled(!1))}),o=Ext.value(r,o),n.setValue(o)},beforeselect:function(e,t,i){var a=e.getLastSelected();if(a){e.view.panel;var n=l.editorview.getValue();a.get("func")!=n?a.set("newfunc",n):a.set("newfunc","")}}},e.dockedItems=[{xtype:"toolbar",dock:"right",itemId:"buttonBar",disabled:JE.isEmpty(l.type),defaults:{disabled:!0},items:l.buildButtons()}];var t=l.buildFuncInfo();return{xtype:"panel",border:0,itemId:"eventview",region:"west",width:300,layout:"border",items:l.funcInfoHide?[e]:[e,t]}},buildButtons:function(){var n=this,e=JE.jsEditor["je-common"],t=[{tooltip:"保存",disabled:!1,itemId:"save",iconCls:"jeicon jeicon-save",handler:function(e){var t=n.eventview,i=[];t.fireEvent("beforeselect",t.getSelectionModel()),t.store.commitChanges(),t.store.each(function(e){!Ext.isEmpty(e.get("func"))&&Ext.isEmpty(e.get("newfunc"))||i.push(e.data)});var a=!0;n.saveFn&&(a=n.saveFn(i,n)),0!=a&&JE.msg("保存成功！")}},"-",{tooltip:"添加自定义事件",disabled:!1,itemId:"addL",iconCls:"jeicon jeicon-new-fine-plus-circle",handler:function(e){var t=n.eventview;JE.formWin({title:"添加自定义事件",width:300,height:120,items:[{xtype:"textfield",labelWidth:60,fieldLabel:"名称",name:"name",allowBlank:!1},{xtype:"textfield",labelWidth:60,fieldLabel:"编码",name:"code",allowBlank:!1}],fn:function(e){e.fire=!1,t.getStore().insert(0,e),JE.msg("数据添加成功...")}})}},{tooltip:"删除自定义事件,且方法体为空",itemId:"removeL",iconCls:"jeicon jeicon-error-circle",handler:function(){var t=n.eventview,i=t.getSelectionModel().getSelection()[0];i&&JE.confirm("确定删除吗？",function(e){"ok"==e&&(t.getStore().remove(i),JE.msg("删除成功..."))})}},"-"],i={log:"jeicon jeicon-defect-bug",alert:"jeicon jeicon-exclamation-triangle",error:"jeicon jeicon-exclamation-circle",msg:"jeicon jeicon-alert",ajax:"jeicon jeicon-ajax",selectWin:"jeicon jeicon-sms",showFunc:"jeicon jeicon-pop-up",DBTransaction:"jeicon jeicon-database"};return Ext.each(e,function(e){t.push({tooltip:e.name,iconCls:i[e.code],funcStr:e.func,code:e.code,handler:function(e){if("selectWin"==e.code)JE.win({title:"查询选择配置",border:0,width:900,height:650,autoShow:!0,items:{xtype:"jesswincfgview",callback:function(e){var t=n.getCmp("editorview").editor,i=t.getPosition();t.executeEdits("",[{range:{startLineNumber:i.lineNumber,startColumn:i.column,endLineNumber:i.lineNumber,endColumn:i.column},text:e}])}}});else{var t=n.getCmp("editorview").editor,i=t.getPosition();t.executeEdits("",[{range:{startLineNumber:i.lineNumber,startColumn:i.column,endLineNumber:i.lineNumber,endColumn:i.column},text:e.funcStr}])}}})}),t},buildFuncInfo:function(){if(JE.isEmpty(this.funcId))return[];var e=JE.ajax({url:JE.getUrlMaps("je.core.getInfoById"),params:{tableCode:"JE_CORE_FUNCINFO",pkValue:this.funcId}}),t=[{id:this.funcId,code:e.FUNCINFO_FUNCCODE,text:e.FUNCINFO_FUNCNAME}],i=JE.ajax({url:JE.getUrlMaps("je.core.load"),params:{tableCode:"JE_CORE_FUNCRELATION",whereSql:" and FUNCRELATION_FUNCINFO_ID = '"+this.funcId+"' and FUNCRELATION_ENABLED ='1' and SY_STATUS in('func','tree')"}});return Ext.each(i.rows,function(e){t.push({id:e.FUNCRELATION_FUNCID,code:e.FUNCRELATION_CODE,text:e.FUNCRELATION_NAME+"(子功能)"})}),{xtype:"panel",region:"south",bodyCls:"x-view-emtpytext",bodyStyle:"margin:0px;padding:2px",itemId:"fieldsBox",split:!0,height:200,tbar:{layout:"fit",items:{xtype:"cbbfield",name:"funcs",hideTrigger1:!0,fieldLabel:"功能信息",labelWidth:60,dataArray:t,listeners:{afterrender:function(e){e.fieldBox=e.ownerCt.ownerCt;var t=e.store.getAt(0);e.setValue(t.get("code")),JE.defer(function(){if(e.fieldBox.getEl())return e.fireEvent("select",e,[t]),!1},50)},select:function(e,t){var i=t[0],a={funcId:i.get("id"),funcCode:i.get("code"),fields:[]},n=" and RESOURCEFIELD_FUNCINFO_ID = '"+a.funcId+"' and RESOURCEFIELD_XTYPE not in('child','fieldset','displayfield','childfuncfield')",o=JE.ajax({url:JE.getUrlMaps("je.core.load"),params:{whereSql:n,orderSql:" order by SY_ORDERINDEX ASC ",limit:-1,tableCode:"JE_CORE_RESOURCEFIELD"}});a.fields=o.rows;var r=JE.toXT(["<div><b>编码：</b>{funcCode}</div>",'<div style="overflow-y: auto;width:100%;height:320px;margin:5px 0 0 0;">','<table width=100% border=1 style="border-collapse:collapse;border-spacing:0;">','<tpl for="fields">',"<tr>","<td>{RESOURCEFIELD_NAME}</td>","<td>{RESOURCEFIELD_CODE}</td>","</tr>","</tpl>","</table>","</div>"].join(""),a);e.fieldBox.update(r)}}}}}}}),Ext.define("JE.core.view.ListView",{extend:"Ext.panel.Panel",alias:"widget.jelistview",mixins:["JE.core.util.ViewUtil","JE.core.util.PermUtil","JE.core.util.func.Grid","JE.core.util.PrintUtil"],readOnly:!1,cls:"je-grid je-list",animCollapse:!1,autoScroll:!1,initComponent:function(){var d=this,c=Ext.clone(d.funcData);d.layout="fit",d.initCommonConfig(c),"query"==d.type||(Ext.isEmpty(c.info.gridListeners)||(d.listeners=Ext.clone(c.info.gridListeners),delete d.listeners.treequeryformat),c.info.gridDDOrder&&(c.info.pageSize=-1,d.funcData.info.pageSize=-1,d.store.pageSize=-1)),d.itemTplFn=Ext.value(JE.eval(c.info.tableViewTplFn,"",!1),Ext.emptyFn),d.viewConfig={cls:"je-list-view",panel:d,store:d.store,emptyText:d.emptyText,loadMask:!1,autoScroll:!0,itemSelector:"div.je-list-item-wrap",overItemCls:"je-list-item-over",selectedItemCls:"je-list-item-selected",multiSelect:d.multiSelect,allowDeselect:!0,plugins:[],tpl:['<tpl for=".">',"{[this.getItemTpl(values,xindex)]}","</tpl>",{itemCls:"je-list-item-wrap je-col-"+c.info.tableViewCols,getItemTpl:function(e,t){var i=Ext.clone(e),a=d.store.currentPage||1,n=d.store.pageSize;i.xrownum=(a-1)*n+t;var o={xrownum:i.xrownum},r=d.itemTplFn(i,o),l="padding:10px;"+Ext.value(o.itemStyle,""),s=this.itemCls+" "+Ext.value(o.itemCls,"");return JE.toXT('<div data-id="'+i[c.info.pkName]+'" class="'+s+'" style="'+l+'">'+r+"</div>",i)}}]},d.multiSelect&&d.viewConfig.plugins.push(Ext.create("JE.core.ux.DragSelector",{})),d.items=d.view=Ext.create("Ext.view.View",d.viewConfig),d.initViewEvents(),d.callParent(arguments),d.initSearchField()},afterRender:function(){this.callParent(arguments),this.funcData.info.gridDDOrder&&"query"!=this.type&&this.buildDDZone()},setValues:function(){},getSelectionModel:function(){return this.view.getSelectionModel()},getStore:function(){return this.store},initViewEvents:function(){this.relayEvents(this.store,["beforeload","load","loadrecords"]),this.relayEvents(this.view,["beforeitemmousedown","beforeitemmouseup","beforeitemmouseenter","beforeitemmouseleave","beforeitemclick","beforeitemdblclick","beforeitemcontextmenu","itemmousedown","itemmouseup","itemmouseenter","itemmouseleave","itemclick","itemdblclick","itemcontextmenu","beforecellclick","cellclick","beforecelldblclick","celldblclick","beforecellcontextmenu","cellcontextmenu","beforecellmousedown","cellmousedown","beforecellmouseup","cellmouseup","beforecellkeydown","cellkeydown","beforecontainermousedown","beforecontainermouseup","beforecontainermouseover","beforecontainermouseout","beforecontainerclick","beforecontainerdblclick","beforecontainercontextmenu","containermouseup","containermouseover","containermouseout","containerclick","containerdblclick","containercontextmenu","selectionchange","beforeselect","select","beforedeselect","deselect"])},buildDDZone:function(){var r=this,l=r.view;l.dragZone=new Ext.dd.DragZone(l.getEl(),{ddGroup:"jelistGroup",getDragData:function(e){var t=e.getTarget(l.itemSelector,10);if(t){var i=document.createElement("div"),a=l.getRecord(t);return i.innerHTML="拖动排序",{ddel:i,sourceEl:t,repairXY:Ext.fly(t).getXY(),dragRecord:a,sourceDataView:l}}},getRepairXY:function(){return this.dragData.repairXY}}),l.dropZone=new Ext.dd.DropZone(l.getEl(),{ddGroup:"jelistGroup",notifyOver:function(e,t,i){var a=t.getTarget(l.itemSelector,10);if(i.allowDD=!1,i.insertIndex=-1,a){var n=r.getItemPosition(t,a);if("before"==n||"after"==n){r.positionIndicator(a,n,t);var o=a.getAttribute("data-id");i.insertIndex=r.getStore().indexOfId(o),"after"==n&&i.insertIndex++,i.allowDD=!0}}return i.allowDD||r.hidetIndicator(),i.allowDD?e.dropAllowed:e.dropNotAllowed},notifyDrop:function(e,t,i){if(r.hidetIndicator(),-1<i.insertIndex){var a=[],n=[];a.push(Ext.clone(i.dragRecord.data)),i.dragRecord.set(r.funcData.info.pkName,JE.uuid()),n.push(i.dragRecord),l.store.insert(i.insertIndex,a),l.store.remove(n),r.doSort()}return i.allowDD}})},indicatorHtml:'<div class="formfield-move-top"></div><div class="formfield-move-bottom"></div>',indicatorCls:"je-formfield-drop-indicator",getIndicator:function(){return this.indicator||(this.indicator=new Ext.Component({html:this.indicatorHtml,cls:this.indicatorCls,style:"width:1px;",floating:!0,shadow:!1})),this.indicator},positionIndicator:function(e,t,i){var a=Ext.fly(e),n=a.getX(),o=a.getY()+0;"after"==t?n+=a.getWidth()+0:n-=0,this.getIndicator().setHeight(a.getHeight()).showAt(n,o)},hidetIndicator:function(){this.getIndicator().hide()},getItemPosition:function(e,t,i){var a,n=e.getXY()[1],o=e.getXY()[0],r=Ext.fly(t).getRegion();if(n<=r.bottom&&n>=r.top){var l=r.left+(r.right-r.left)/2;o<l?a="before":l<o&&(a="after")}return a},doSort:function(){var n=[],o=this.funcData.info;if(this.getStore().each(function(e,t){e.set("SY_ORDERINDEX",t+1);var i=e.getChanges();if(JE.isNotEmpty(i)&&i.hasOwnProperty("SY_ORDERINDEX")){var a={SY_ORDERINDEX:t+1};a[o.pkName]=e.get(o.pkName),n.push(a)}}),JE.isNotEmpty(n)){var e=JE.ajax({url:this.getStore().actUrls.updateList,params:{strData:Ext.encode(n),tableCode:o.tableName}});e.success?JE.msg("排序完成！"):JE.alert(e.obj)}}}),Ext.define("JE.core.view.MainView",{extend:"Ext.panel.Panel",border:0,alias:"widget.jemainview",layout:"border",buildItems:!1,readOnly:!1,idSuffix:"",cls:"je-mainview-bg-white",html:'<h1 align=center style="margin-top:150px;font-family: Microsoft YaHei;font-size: 36px;color: rgb(179, 179, 179);">内容载入中...</h1>',mixins:["JE.core.util.ViewUtil"],initComponent:function(){var e=this.funcData;e.info.idSuffix=Ext.value(this.idSuffix,Ext.value(e.info.idSuffix,"")),this.id=e.info.funcCode+"_jemainview"+e.info.idSuffix,Ext.isEmpty(this.title)||(this.iconCls=Ext.value(this.iconCls,Ext.value(e.info.funcIconCls,""))),this.callParent(arguments)},afterRender:function(){var a=this;a.callParent(arguments),Ext.defer(function(){if(a.funcData.info.funcId&&!a.buildItems&&a.buildItem(),a.dicItemFunc){var e="1"==Ext.value(JE.dicInfoData[a.idSuffix.substring(1)],{}).DICTIONARY_ZWFFLAG?"_ZWF":"",t=Ext.getCmp("JE_CORE_DICTIONARYITEM"+e+"_jegridview"+a.idSuffix);t.mainData=a.mainData;var i=t.getDockedCmp("buttonBar").getCmp("JE_ConfigEdit");i&&i.hide()}},50)},buildItem:function(e,t){var i=this;i.buildItems=!0,i.body&&i.addCls("je-mainview-bg"),!e&&i.funcData.info.funcId||(i.funcData=JE.getFuncData(i.funcData.info.funcCode,{refresh:Ext.value(e,!1),staticFunc:t})),"treegrid"!=i.showView&&i.funcData.info.oneToForm&&(i.showView="formData");var a=i.funcData.info,n=i.getItemsConfig(i.funcData);i.add(n);var o=Ext.getCmp(a.funcCode+"_jegridview"+a.idSuffix);o&&(o.refreshLocation(),o.hasListener("selfactivate")&&o.fireEvent("selfactivate",o),o.on({load:{fn:function(){Ext.defer(function(){Ext.isEmpty(o.type)&&o.gridEditBtnPrem()&&(a.oneInForm?i.fireEvent("activate",i):a.formLazy||"FORMWIN"==a.insertType&&"1"==JE.getObjAttr(a.otherConfig,"formWinEdit")||JE.Action.doBuildEdit(a))},500)},single:!0}})),i.childFunc&&(i.mainConfig=Ext.value(i.mainConfig,{readOnly:i.readOnly}),JE.CoreUtil.setChildObj(i,i.mainConfig))},getItemsConfig:function(e){var t=this;t.funcData.info.idSuffix=Ext.value(t.idSuffix,""),t.funcData.info.childFunc=t.childFunc,t.funcData.info.parentType=t.parentType;var i=[{xtype:"jecenterview",region:"center",itemId:"jecenterview",rootFunc:t.rootFunc,showView:t.showView,funcData:e,defaults:{rootFunc:t.rootFunc}}];if("tree"==e.info.funcType&&"treegrid"!=t.showView){var a=e.info.whereSql+e.info.treeFuncSql,n={xtype:"jetreeview",url:Ext.value(e.info.funcAction,JE.getUrlMaps("je.core"))+JE.getUrlMaps("method.getTree"),onlyItem:!0,ref:"query",border:0,autoload:!e.info.childFunc,parentSql:Ext.value(e.info.treeParentSql,""),whereSql:a,params:{moreRoot:"TRUE"==e.info.funcDicConfig.moreRoot,tableCode:e.info.tableName,excludes:"checked"},funcData:e,id:e.info.funcCode+"_jetreeview"+e.info.idSuffix,hideHeaders:!0,columns:[{xtype:"treecolumn",dataIndex:"text",flex:1,renderer:function(e){return e+'<i class="right-menu fa fa-gear" style="vertical-align: text-top;margin-left:20px;color:#c3c3c3;cursor: pointer;visibility: hidden;"></i>'}}],listeners:{beforeitemclick:function(e,t,i,a,n,o){var r=n.getTarget(".right-menu",1,!0);if(r)return e.panel.getActionMenu(t).showBy(r,"tl-br",[20,10]),!1},resize:function(e,t,i,a,n){var o=e.view.id,r=o+"-css",l=["#"+e.body.id+"{overflow:hidden !important;}","#"+o+"{width:"+(t+20)+"px !important;overflow:hidden !important;overflow-y:scroll !important;}","#"+o+">table{width:"+t+"px !important;}"];Ext.util.CSS.removeStyleSheet(r),Ext.util.CSS.createStyleSheet(l.join(" "),r)}}};t.setTreeDDPlugin(n);var o={xtype:"panel",region:"west",title:JE.getObjAttr(e.info.otherConfig,"quickQueryTitle")||JE.getLocalLang("core.jemainview.treeTitle"),collapsible:!0,split:!0,tools:t.getTreeTools(),width:Ext.isEmpty(e.info.qxcxWidth)||0==e.info.qxcxWidth?200:e.info.qxcxWidth,layout:"fit",itemId:"dictree",items:[n],listeners:{}},r=165;"plus"==JE.getTheme()&&(r=200,o.cls="je-tree-searchview",o.listeners.afterrender=function(e){JE.defer(function(){if(e.placeholder)return e.placeholder.el.addCls("je-tree-searchview-header"),!1},10),e.splitter.on("afterrender",function(e){e.el.addCls("je-tree-searchview-splitter")})}),o.width=o.width>r?o.width:r,(Ext.isIE8m||e.info.treeRefresh)&&(Ext.each(o.items,function(e){e.autoload=!1}),o.collapsed=!0,o.listeners.expand={fn:function(e){e.items.each(function(e){e.load()})},single:!0}),i.push(o)}return i},refreshFunc:function(){var e=this,t=e.funcData.info,i=t.idSuffix,a=Ext.getCmp(t.funcCode+"_jecenterview"+i),n=Ext.getCmp(t.funcCode+"_jedataview"+i),o=Ext.getCmp(t.funcCode+"_jeeditview"+i),r=Ext.getCmp(t.funcCode+"_jeformview"+i),l=Ext.getCmp(t.funcCode+"_jegridview"+i),s=Ext.getCmp(t.funcCode+"_jetreeview"+i),d=Ext.getCmp(t.funcCode+"_jetreegridview"+i),c=Ext.getCmp(t.funcCode+"_jedataview_queryform"+i);if(a){var u=a.activeItem;if(a.getLayout().setActiveItem(u),a.gridExtendCbb){var p=a.gridExtendCbb;(b=p.store.findRecord("code",u))&&(p.reset(),p.fireEvent("select",p,[b]))}}if(a&&n&&l){l.refreshLocation(),l.hasListener("selfactivate")&&l.fireEvent("selfactivate",l);var f=l.groupSearchWin;JE.isNotEmpty(f)&&f.down("[xtype=jetool.searchview]").resetQuery(),c&&c.getForm().reset(),Ext.getCmp(t.funcCode+"_childs_data"+i)&&JE.CoreUtil.setChildInfo({funcData:e.funcData,readOnly:e.readOnly}),JE.Action.doListForm(null,t);var E=!(Ext.isEmpty(l.store.sqls.group)&&Ext.isEmpty(l.store.sqls.quick)&&Ext.isEmpty(l.store.sqls.tree));if(l.store.sqls={basic:l.store.sqls.basic,treeFunc:l.store.sqls.treeFunc,parent:l.store.sqls.parent,order:l.store.sqls.order,cxcl:l.store.sqls.cxcl},l.store.proxy.extraParams.dbQueryObj=Ext.encode({}),0<l.getSelectionModel().getSelection().length&&l.getSelectionModel().deselectAll(),JE.DB.setWhereSql(l.store),s&&0<s.getSelectionModel().getSelection().length&&s.getSelectionModel().deselectAll(!0),e.childFunc){var m=l.store.sqls.parent.trim(),g=Ext.value(e.oldParentSql,"").trim(),h=!1;Ext.isEmpty(l.mainWhereFields)?(JE.DB.setWhereSql(l.store,"","parent"),l.getStore().loadPage(1)):"and 1 != 1"==m||"and ( 1 != 1)"==m?(l.store.removeAll(),h=!0):!E&&g==m||l.getStore().loadPage(1),JE.Action.doTreeLoad({parentData:e.mainRecordData,parentSql:l.store.sqls.parent,clearNodes:h},t)}else l.getStore().loadPage(1),d&&d.doLoad();var x=JE.Action.doDefaultValues(e.mainData,e.funcData.info);l.setValues&&l.setValues(x)}else if(a&&o&&r){var v;if(t.oneToForm){var y=Ext.value(t.funcAction,JE.getUrlMaps("je.core"));v=JE.ajax({url:y+JE.getUrlMaps("method.load"),params:{tableCode:t.tableName,whereSql:Ext.value(t.whereSql,"")+" "+Ext.value(r.mainWhereSql,"")}}).rows[0]}x=JE.Action.doDefaultValues(e.mainData,e.funcData.info);v=Ext.value(v,x);var b=Ext.create(t.modelName,v);r.form.loadRecord(b),t.oneToForm&&JE.CoreUtil.setChildInfo({funcData:e.funcData,readOnly:e.readOnly,data:v})}else a&&d&&d.doLoad();var C=e.readOnly;e.readOnly=!1,e.setReadOnly(C),!r||"form"!=e.showView&&"formData"!=e.showView||r.fireEvent("selfactivate",r)},setReadOnly:function(e){var t=this.funcData.info;if(this.readOnly!=e){this.readOnly=e;var i=Ext.getCmp(t.funcCode+"_jegridview"+t.idSuffix);i&&i.setReadOnly(e);var a=Ext.getCmp(t.funcCode+"_jeformview"+t.idSuffix);a&&a.setReadOnly(e);var n=Ext.getCmp(t.funcCode+"_jetreeview"+t.idSuffix);n&&n.setReadOnly(e)}}}),Ext.define("JE.core.view.PortalMenuView",{extend:"Ext.panel.Panel",alias:"widget.portal.menuview",autoScroll:!0,initComponent:function(){var n=this;n.infoData=Ext.decode(Ext.value(n.infoData,"{}")),n.editor=Ext.create("JE.core.ux.mxgraph.util.Editor",{readOnly:!0});var e=n.editor.editor.graph;e.defaultGraphBackground="transparent",e.getCursorForCell=function(e){if(null!=e&&null!=e.value&&1==e.vertex&&"1"==e.getAttribute("enable"))return"pointer"},e.addListener(mxEvent.CLICK,function(e,t){t.getProperty("event");var i=t.getProperty("cell");if(!t.isConsumed()&&null!=i&&"1"==i.getAttribute("enable"))if("func"==i.getAttribute("clickType")&&JE.isNotEmpty(i.getAttribute("info"))&&JE.isNotEmpty(i.getAttribute("menuId")))JE.openFunc({type:i.getAttribute("type"),info:i.getAttribute("info"),id:i.getAttribute("menuId"),title:Ext.value(i.getAttribute("title"),i.getAttribute("label")),iconCls:i.getAttribute("iconCls"),showView:i.getAttribute("funcType")});else if("idit"==i.getAttribute("clickType")&&JE.isNotEmpty(i.getAttribute("clickEvent"))){var a=i.getAttribute("clickEvent");try{JE.eval(a)(n)}catch(e){JE.error("方法错误，请检查！</br>"+a)}}}),e.click=function(e){var t=e.getEvent(),i=e.getCell(),a=new mxEventObject(mxEvent.CLICK,"event",t,"cell",i);e.isConsumed()&&a.consume(),this.fireEvent(a)};var t="background-color:"+Ext.value(n.infoData.bgColor,"#FFFFFF")+";";JE.isNotEmpty(n.infoData.bgImage)&&(t+="background-image:url('"+n.infoData.bgImage+"');",JE.isNotEmpty(n.infoData.bgImageRepeat)&&(t+="background-repeat:"+n.infoData.bgImageRepeat+";"));var i={border:0,outline:!1,editor:n.editor,bodyStyle:t};if("1"==n.infoData.graphCenter&&(n.layout={type:"table",tableAttrs:{align:"center",height:"100%"},tdAttrs:{valign:"middle"},columns:1},!Ext.isEmpty(n.infoData.graphWH))){var a=n.infoData.graphWH.split("*")[0],o=n.infoData.graphWH.split("*")[1];JE.isNotEmpty(a)&&(i.width=Number(a)),JE.isNotEmpty(o)&&(i.height=Number(o))}n.items=Ext.create("JE.core.ux.mxgraph.Graph",i),n.callParent(arguments)},afterRender:function(){this.callParent(arguments);var e=Ext.value(this.infoData.xmlCode,"");this.editor.loadData(e);var t=this.editor.editor.graph;t.setGridEnabled(!1),t.view.validateBackground()}}),Ext.define("JE.core.view.PortalView",{extend:"Ext.panel.Panel",border:0,alias:"widget.jeportalview",layout:"fit",initComponent:function(){this.portalUtil=Ext.create("JE.core.util.PortalUtil"),this.items=this.getPortalItem(),this.callParent(arguments)},getPortalData:function(){return this.bean||(this.bean=JE.ajax({url:JE.getUrlMaps("je.core.getInfoById"),params:{tableCode:"JE_CORE_PROTAL",pkValue:this.beanId}})),this.bean},getPortalItem:function(){var i=this,a=i.getPortalData();if(Ext.isEmpty(a.PROTAL_DATA))return{xtype:"box",html:JE.getLocalLang("core.jemainview.alert.PORTAL.noId")};var e={xtype:"container",layout:"fit"};if("PORTAL"==a.PROTAL_TYPE)e.listeners={afterrender:function(t){Ext.defer(function(){var e=i.portalUtil.buildPortal(a);t.add(e)},100)}};else if("MENU"==a.PROTAL_TYPE)e.xtype="portal.menuview",e.infoData=a.PROTAL_DATA;else if("IDDT"==a.PROTAL_TYPE){var n=Ext.decode(a.PROTAL_DATA);JE.isEmpty(n.mainview)?e.html=JE.getLocalLang("core.app.centerview.portalHtml"):(e.border=0,e.margin=1,e.listeners={afterrender:function(t){Ext.defer(function(){JE.isNotEmpty(n.ctr)&&Ext.each(n.ctr.split(","),function(e){JE.initCtr(e)});var e={};JE.isEmpty(n.funcCode)||(e.id=n.funcCode+"_mainview"),t.add(Ext.create(n.mainview,e))},100)}})}return e},afterRender:function(){this.callParent(arguments)}}),Ext.define("JE.core.view.ReportView",{extend:"Ext.panel.Panel",alias:"widget.jereportview",reportCode:"",hideSearchBar:void 0,reportParams:void 0,reportBean:void 0,paramsForm:void 0,renderer:void 0,split:!0,border:0,boxBorder:1,htmlTpl:"",editable:!0,values:void 0,initComponent:function(){var i=this;i.localLang=JE.getLocalLang("core.jereportview"),JE.loadScript("/static/ux/Formula.js"),i.addEvents("load","beforeload"),i.reportUtil=Ext.create("JE.util.ReportUtil",{view:i}),i.printUtil=Ext.create("JE.core.util.PrintUtil"),i.reportParams=Ext.value(i.reportParams,{}),i.reportBean||i.buildReportBean(i.reportCode),i.buildReportCfg(i.reportBean),i.layout="border",i.items={xtype:"form",itemId:"reportForm",layout:"fit",region:"center",border:i.boxBorder,items:{xtype:"box",padding:"5",autoScroll:!0,itemId:"reportBox",style:"",items:new Ext.util.MixedCollection,getRefItems:function(e){for(var t,i=this.items.items,a=i.length,n=0,o=[];n<a;n++)t=i[n],o[o.length]=t,e&&t.getRefItems&&o.push.apply(o,t.getRefItems(!0));return o}}},i.items.items.style+="background:"+Ext.value(i.reportCfg.dsCfg.pageColor,"white")+";",i.buildTBar(),i.buildPagingBar();var e=i.buildCommBtns().concat([{xtype:"menuseparator",itemId:"searchT"},{text:i.localLang.menu.search,iconCls:"jeicon jeicon-search",itemId:"search",handler:function(){i.showSearchWin(!0)}}]);i.menu=Ext.create("Ext.menu.Menu",{listeners:{show:function(e){var t=i.reportCfg&&"1"==i.reportCfg.dsCfg.menuSearch;e.getCmp("search").setVisible(t),e.getCmp("searchT").setVisible(t)}},items:e}),i.callParent(arguments)},afterRender:function(){var a=this;a.callParent(arguments);var e=a.getCmp("reportForm").getCmp("reportBox");1!=a.hideMenu&&e.getEl().on("contextmenu",function(e){e.stopEvent(),a.menu.showAt(e.getXY())}),a.buildParamsForm(),e.on("boxready",function(){var e=a.reportCfg&&"1"==a.reportCfg.dsCfg.initParams,t=a.up("window"),i=a.reportParams=Ext.apply(a.getSearchDefVals(),Ext.value(a.reportParams,{}));!a.ownerCt.childFunc&&t&&1!=a.directLoad?t.on({show:{fn:function(){a.load(i,a.values,e)},single:!0}}):a.load(i,a.values,e)})},reset:function(){this.paramsForm&&this.paramsForm.form.reset(),this.searchWin&&this.searchWin.getCmp("form").form.reset()},load:function(i,e,t){var a=this;if(a.reportCfg){var n=a.getCmp("reportForm").getCmp("reportBox");if(n.getEl())if(t&&JE.isNotEmpty(a.searchFields))a.showSearchWin();else{a.basicParams=Ext.value(i,{});var o=Ext.clone(a.reportParams);i=Ext.apply(o,a.basicParams);Ext.iterate(i,function(e,t){i[e]=JE.toDefVal(t)}),a.reportCfg.params=i,a.fireEvent("beforeload",a,a.reportCfg.params),JE.doMask(a.getCmp("reportForm"),a.localLang.loadingText,function(){a.reportCfg.doPageAct=Ext.value(a.reportCfg.doPageAct,"moveFirst"),a.htmlTpl=a.reportUtil.doReport(a.reportCfg),n.update(a.htmlTpl),delete a.reportCfg.doPageAct,delete a.reportCfg.doPageSize,delete a.reportCfg.doPageIndex,"EDIT"==a.reportBean.REPORT_TYPE&&a.renderFields(e),a.renderHeaders(),a.renderCharts(),a.fireEvent("load",a)})}}},loadHtmlData:function(e){var a=this.getCmp("reportForm").getCmp("reportBox").getEl();a&&Ext.iterate(e,function(e,t){var i=a.down("td[data-code="+e+"]",!0);i&&(i.innerHTML=t)})},buildPageHtml:function(e){var o=this;e.page=Ext.value(e.page,1),o.getEl().mask(JE.format(o.localLang.loadingPageText,e.page)),o.on({load:{fn:function(e){var i=setInterval(function(){var t=!0;Ext.each(o.charts,function(e){if(!Ext.getCmp(e).chart.hasRendered())return t=!1}),t&&(clearInterval(i),o.buildHtml(function(e){o.pageHtml=Ext.value(o.pageHtml,[]),o.pageHtml.push(e);var t=o.reportCfg.ds[o.reportCfg.bindDS];if(t){var i=t.getPageData(),a=i.currentPage+1;if(a<=i.pageCount)o.buildPageHtml({limit:i.limit,page:a,ds:o.reportCfg.bindDS});else{o.getEl().unmask();var n=[];Ext.each(o.pageHtml,function(e){n.push({bodyTpl:e})}),delete o.pageHtml,delete o.reportCfg.bindDS,o.printUtil.printPage(Ext.apply({pages:n},o.reportCfg.printInfo),"report")}}}))},500)},single:!0}}),o.reportCfg.bindDS=e.ds,o.reportCfg.doPageAct="loadPage",o.reportCfg.doPageSize=e.limit,o.reportCfg.doPageIndex=Ext.value(e.page,1),o.load()},getForm:function(){return this.getCmp("reportForm")},setValues:function(e){e=Ext.value(e,{});var t=this.getCmp("reportForm");this.editable?t.form.setValues(e):this.load({},e)},getValues:function(){return this.getCmp("reportForm").form.getValues()},buildReportBean:function(e){if(!Ext.isEmpty(e)&&!this.reportBean){var t=JE.ajax({url:JE.getUrlMaps("je.core.load"),params:{tableCode:"JE_CORE_REPORT",whereSql:"and REPORT_CODE = '"+this.reportCode+"'",limit:1}}).rows[0];if(t)return this.reportBean=t}},buildReportCfg:function(e){if(e){var t={htmlTpl:Ext.htmlDecode(e.REPORT_HTML),dsIds:e.REPORT_DSIDS,dsCfg:Ext.decode(Ext.value(e.REPORT_DSCONFIG,"{}")),ds:{}};t.printInfo=Ext.value(t.dsCfg.printInfo,{printPageSize:"210*297"}),t.printInfo.pageWidth=t.printInfo.printPageSize.split("*")[0],t.printInfo.pageHeight=t.printInfo.printPageSize.split("*")[1],t.dsCfg.params=Ext.decode(Ext.value(t.dsCfg.params,"[]")),t.otherCfg=Ext.value(t.dsCfg.otherCfg,{}),this.renderer?t.renderer=this.renderer:JE.isNotEmpty(e.REPORT_RENDERER)&&(t.renderer=JE.eval(e.REPORT_RENDERER));var i=JE.ajax({url:JE.getUrlMaps("je.core.load"),params:{tableCode:"JE_CORE_DATASOURCE",whereSql:"and JE_CORE_DATASOURCE_ID in('"+t.dsIds.replaceAll(",","','")+"')",limit:-1}}).rows;return"1"==t.dsCfg.usePage&&JE.isNotEmpty(t.dsCfg.pageDS)&&(t.pageInfo={pageSize:Number(t.dsCfg.pageSize,30),pageDS:t.dsCfg.pageDS,displayMsg:JE.toBool(t.dsCfg.displayMsg)}),Ext.each(i,function(e){t.ds[e.DATASOURCE_CODE]=JE.getChartDS(e),t.pageInfo&&t.pageInfo.pageDS==e.DATASOURCE_CODE&&(t.ds[e.DATASOURCE_CODE].pageSize=t.pageInfo.pageSize,t.ds[e.DATASOURCE_CODE].pageDS=t.pageInfo.pageDS)}),this.reportCfg=t,"EDIT"==e.REPORT_TYPE?this.buildFields(t.htmlTpl):this.editable=!1,t}},buildCommBtns:function(){var n=this,e=[{itemId:"printBtn",text:n.localLang.menu.print,iconCls:"jeicon jeicon-print",handler:function(){n.buildHtml(function(e){n.printUtil.printPage(Ext.apply({pages:[{bodyTpl:e}]},n.reportCfg.printInfo),"report")})}},{text:n.localLang.menu.printPage,iconCls:"jeicon jeicon-print",handler:function(){var e,t,i=[];Ext.iterate(n.reportCfg.ds,function(e,t){i.push(e)}),n.reportCfg.pageInfo?(e=n.reportCfg.pageInfo.pageSize,t=n.reportCfg.pageInfo.pageDS):1==i.length&&(t=i[0]),JE.formWin({title:n.localLang.pageInfo.title,width:400,height:150,items:[{fieldLabel:n.localLang.pageInfo.pageSizeLabel,value:e,xtype:"numberfield",name:"pageSize",minValue:1,allowBlank:!1},{fieldLabel:n.localLang.pageInfo.bindDSLabel,xtype:"cbbfield",value:t,dataArray:i,name:"bindDS",allowBlank:!1}],fn:function(e){n.buildPageHtml({ds:e.bindDS,limit:e.pageSize})}})}},"-",{itemId:"saveFile",text:n.localLang.menu.saveFile,iconCls:"jeicon jeicon-form",hidden:!0,handler:function(){n.buildHtml(function(a){JE.prompt(n.localLang.msg.saveOrSendFile,function(e,t){if("cancel"!=e&&!Ext.isEmpty(t)){var i="/JE/data/upload/filestem/"+t+".html";a='<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">'+a,JE.ajax({url:JE.getUrlMaps("je.core.doc.document","writeFile"),params:{fileName:i,strData:a}}).success?JE.File.addDocFiles(i,t+".html"):JE.alert(n.localLang.msg.saveOrSendFileError)}},null,n.reportBean.REPORT_TEXT)},!0)}},"-",{itemId:"expWord",text:n.localLang.menu.exportWord,iconCls:"jeicon jeicon-word",handler:function(){n.buildHtml(function(e){var t=n.reportBean.REPORT_CODE,i=n.reportBean.REPORT_TEXT,a=JE.ajax({url:JE.getUrlMaps("je.core.word","report2word"),params:{htmlContent:e,code:t,name:i}});window.open(JE.getFileUrl(a.obj)),JE.msg(n.localLang.msg.exportFileOk)},!0)}},{itemId:"expExcel",text:n.localLang.menu.exportExcel,iconCls:"jeicon jeicon-excel",handler:function(){n.buildHtml(function(e){var t=n.reportBean.REPORT_CODE,i=n.reportBean.REPORT_TEXT,a=JE.ajax({url:JE.getUrlMaps("je.core.word","report2excel"),params:{htmlContent:e,code:t,name:i}});window.open(JE.getFileUrl(a.obj)),JE.msg(n.localLang.msg.exportFileOk)},!0)}},"-",{itemId:"refersh",text:n.localLang.menu.refresh,iconCls:"jeicon jeicon-refresh",handler:function(){n.load()}}];return Ext.clone(e)},getPageData:function(){return this.reportCfg.pageInfo?this.reportCfg.ds[this.reportCfg.pageInfo.pageDS].getPageData():{fromRecord:1}},buildPagingBar:function(){var t=this;if(t.reportCfg.pageInfo){t.afterPageText=t.localLang.pageInfo.afterPageText,t.displayMsg=t.localLang.pageInfo.displayMsg;function e(e){t.reportCfg.doPageAct=e.itemId,e.setDisabled(!0),t.load(t.basicParams)}t.items.bbar={xtype:"toolbar",itemId:"pagingbar",items:[{itemId:"moveFirst",iconCls:Ext.baseCSSPrefix+"tbar-page-first",disabled:!0,handler:e},{itemId:"previousPage",iconCls:Ext.baseCSSPrefix+"tbar-page-prev",disabled:!0,handler:e},"-",{xtype:"tbtext",itemId:"afterTextItem",text:JE.format(t.afterPageText,1,0)},"-",{itemId:"nextPage",iconCls:Ext.baseCSSPrefix+"tbar-page-next",disabled:!0,handler:e},{itemId:"moveLast",iconCls:Ext.baseCSSPrefix+"tbar-page-last",disabled:!0,handler:e},"-",{itemId:"doRefresh",iconCls:Ext.baseCSSPrefix+"tbar-loading",handler:e}]},t.reportCfg.pageInfo.displayMsg&&t.items.bbar.items.push("->",{xtype:"tbtext",itemId:"displayItem",text:JE.format(t.displayMsg,0,0,0,0)}),t.on("load",function(e){var t,i,a,n,o,r,l=e.getCmp("reportForm").getDockedCmp("pagingbar"),s=e.reportCfg.ds[e.reportCfg.pageInfo.pageDS];o=(r=0===s.getCount())?(a=i=0,n=JE.format(e.afterPageText,0,0),JE.format(e.displayMsg,0,0,0,s.pageSize)):(i=(t=s.getPageData()).currentPage,a=t.pageCount,n=JE.format(e.afterPageText,i,a),JE.format(e.displayMsg,t.fromRecord,t.toRecord,t.total,s.pageSize)),l.getCmp("moveFirst").setDisabled(1===i||r),l.getCmp("previousPage").setDisabled(1===i||r),l.getCmp("nextPage").setDisabled(i===a||r),l.getCmp("moveLast").setDisabled(i===a||r),l.getCmp("doRefresh").setDisabled(!1),l.getCmp("afterTextItem").setText(n),l.getCmp("displayItem")&&l.getCmp("displayItem").setText(o)})}},buildTBar:function(){var i=this;if("1"==i.reportCfg.dsCfg.useTBar){var a=[];Ext.each(JE.toObj(Ext.value(i.reportCfg.dsCfg.tbarBtns,"[]")),function(t){t.hidden=JE.toBool(t.hidden);var e=Ext.decode(Ext.value(t.events,"[]"));delete t.events,t.listeners={},Ext.each(e,function(e){"1"==e.fire&&(t.listeners[e.code]=JE.eval(e.newfunc))}),t.reportView=i,a.push(t)});var e=i.buildCommBtns(),t=i.reportCfg.dsCfg.tbarCommBtns;JE.isNotEmpty(t)&&(t=t.split(","),Ext.each(e,function(e){-1!=t.indexOf(e.itemId)&&a.push(e)})),JE.isNotEmpty(a)&&(i.items.tbar=a)}},showSearchWin:function(e){this.searchWin&&(this.searchWin.down("button[ref=closeBtn]").setVisible(1==e),this.searchWin.show())},buildSearchWin:function(){var t=this;if(t.reportCfg&&(t.searchWin&&t.remove(t.searchWin),JE.isNotEmpty(t.searchFields))){var e=Number(Ext.value(t.reportCfg.dsCfg.winWidth,400));t.searchWin=t.add({xtype:"window",title:t.localLang.searchForm.title,maxWidth:t.width,maxHeight:t.height,width:e,closable:!1,height:22*t.searchFields.length+100,constrain:!0,layout:"fit",closeAction:"hide",modal:!0,items:{xtype:"form",itemId:"form",layout:"column",bodyPadding:"5",autoScroll:!0,border:0,defaults:{columnWidth:1,labelAlign:"right",labelWidth:80,margin:2},items:t.searchFields},buttonAlign:"center",buttons:[{text:t.localLang.searchForm.queryButton,iconCls:"jeicon jeicon-search",handler:function(){if(t.reportCfg){var e=t.searchWin.getCmp("form");t.paramsForm.form.setValues(e.form.getValues()),t.paramsForm.getDockedCmp("btnbar").getCmp("searchBtn").handler(),t.searchWin.hide()}}},{text:t.localLang.searchForm.resetButton,iconCls:"jeicon jeicon-turn-left",handler:function(){t.searchWin.getCmp("form").form.reset()}},{text:t.localLang.searchForm.close,hidden:!0,ref:"closeBtn",handler:function(){t.searchWin.hide()}}]})}},getSearchDefVals:function(){var i={};return Ext.iterate(this.searchDefVals,function(e,t){Ext.isFunction(t)?i[e]=t():i[e]=JE.toDefVal(t)}),i},buildParamsForm:function(){var r=this;if(r.reportCfg){r.paramsForm&&r.remove(r.paramsForm),r.paramsTree&&r.remove(r.paramsTree);var e=r.reportCfg.dsCfg,t=Ext.value(e.region,"north"),i=r.hideSearchBar||Ext.isEmpty(e.params)||"1"==e.hideSearch,a=Ext.value(e.btnRegion,"bottom"),n="1"==e.collapsed,l=JE.toBool(e.treeSearch);r.searchFields=[],r.searchDefVals={},disFields=[],fields=[],Ext.each(e.params,function(e){var t={name:e.code,fieldLabel:e.name,xtype:Ext.value(e.xtype,"textfield"),configInfo:e.configInfo,valueFormat:e.format,rowField:e.field,hidden:JE.toBool(e.hidden)},i=r.chartBean?r.reportBean.CHART_TEXT:r.reportCfg.code,a=JE.eval(e.listeners,"报表【"+i+"】查询参数【"+e.name+"】的事件解析出错！");if(JE.isNotEmpty(a)&&(t.listeners=a),-1!=["cbbfield","rgroup","cgroup","treessfield"].indexOf(t.xtype)&&JE.isNotEmpty(t.configInfo)&&disFields.push(Ext.apply(Ext.clone(t),{field:t.name,title:t.fieldLabel})),"cgroup"==t.xtype&&(t.checkAll=!1),t.xtype="datefield"==t.xtype?"datedayfield":t.xtype,JE.isNotEmpty(e.valueFn)){var n=JE.eval(e.valueFn);t.value=n(),r.searchDefVals[t.name]=n}else JE.isNotEmpty(e.value)&&(t.value=JE.toDefVal(e.value),r.searchDefVals[t.name]=e.value);if(t.value=Ext.value(r.reportParams[t.name],t.value),t.width=Ext.value(e.width,200),0==t.width&&(t.hidden=!0),l||"1"!=e.changeS||(t.listeners={change:function(e,t){var i=e.up("form");i&&i.getDockedCmp("btnbar").getCmp("searchBtn").handler()}}),"1"==e.useText){var o=Ext.clone(t);o.name=o.name+"_TEXT",t.hidden=!0,t.rowField=Ext.value(t.rowField,o.name),fields.push(Ext.clone(o)),delete o.columnWidth,delete o.listeners,r.searchFields.push(Ext.clone(o))}fields.push(Ext.clone(t)),delete t.columnWidth,delete t.listeners,delete t.width,r.searchFields.push(Ext.clone(t))});var o=new Ext.util.MixedCollection;Ext.each(fields,function(e){var t=e.rowField;if(JE.isEmpty(t))o.add(e.name,[e]);else{var i=o.get(t);JE.isEmpty(i)&&(i=o.add(t,[])),i.push(e)}});var s=[];o.each(function(e){s.push({xtype:"container",layout:"hbox",columnWidth:1,defaults:{labelAlign:"right",labelWidth:60,margin:"1 0"},items:e})}),0==s.length&&(i=!0);var d="";"north"==t?d="bottom":"south"==t?d="top":"west"==t?d="right":"east"==t&&(d="left");var c={xtype:"form",itemId:"paramsForm",layout:"column",region:"north",border:1,bodyPadding:"2",autoScroll:!0,hidden:i,region:t,items:s,border:0,style:"border-width:1px;border-style:solid;border-"+d+"-width:0px;",bodyStyle:"border-width:0px;background-color:transparent;",dockedItems:[{xtype:"toolbar",dock:a,itemId:"btnbar",style:"background-color:transparent;border-width:0px !important;",layout:{type:"hbox",align:"top"},items:["->",{text:r.localLang.searchForm.queryButton,margin:"0 2",itemId:"searchBtn",iconCls:"fa fa-search",cls:"btn btn-form JEPLUS_B_L10",handler:function(){r.reportCfg&&r.load(r.formatParams(r.paramsForm))}},{text:r.localLang.searchForm.resetButton,margin:"0 2",cls:"btn btn-form",iconCls:"fa fa-mail-reply",handler:function(){r.paramsForm.form.reset()}},"->"]}]};if(n&&Ext.apply(c,{split:!0,collapsible:!0,hideCollapseTool:!0,titleCollapse:!0,collapseMode:"mini",collapsed:n}),JE.isNotEmpty(e.bgcolor)&&(c.style+="background-color:"+e.bgcolor),-1!=["east","west"].indexOf(t)?c.width=Number(Ext.value(e.hw,"150")):(c.minHeight=55,-1!=["left","right"].indexOf(a)&&(c.height=c.minHeight="plus"==JE.getTheme()?43:30),JE.isNotEmpty(e.hw)&&(c.height=Number(e.hw))),JE.toBool(e.treeSearch)&&0<disFields.length){var u={xtype:"jetreeview",border:0,region:"west",cls:"je-grid-groupquery",style:"border-width:1px;border-style:solid;",type:"func",onlyItem:!1,multiSelect:!1,enableMSModel:!0,autoScroll:!0,width:Number(Ext.value(e.hw,"150")),split:!0,collapsible:!0,hideCollapseTool:!0,titleCollapse:!0,collapseMode:"mini",collapsed:n,queryItems:disFields,hidden:i,listeners:{selectionchange:function(e,t,i){if(r.reportCfg){e.view.panel;var a={};Ext.each(t,function(e){a[e.data.nodeInfo]=a[e.data.nodeInfo]||[],a[e.data.nodeInfo].push(e.data.code)});var n={};Ext.iterate(a,function(e,t){n[e]=t.join(",")}),r.paramsForm.form.reset(),r.paramsForm.form.setValues(n),r.paramsForm.getDockedCmp("btnbar").getCmp("searchBtn").handler()}},load:{fn:function(t){var i=r.getSearchDefVals();t.getRootNode().cascadeBy(function(e){if(i[e.data.nodeInfo]==e.data.code)return t.treeObj.getSelectionModel().select(e,!1,!0),!1})},single:!0}}};c.hidden=!0,r.paramsTree=r.add(u)}r.paramsForm=r.add(c),r.buildSearchWin()}},formatParams:function(a){var n=a.form.getValues();return Ext.iterate(n,function(e,t){var i=a.form.findField(e);i&&"in"==i.valueFormat&&(n[e]=n[e].replaceAll(",","','"))}),n},buildFields:function(e){var n=this,t=document.createElement("DIV");t.innerHTML=Ext.value(e,"");var i=Ext.DomQuery.select("input[type=button][reportBtn]",t);n.fields={},Ext.each(i,function(e){var t=e.getAttribute("data-code"),i=e.getAttribute("data-editable"),a=Ext.value(JE.decodeURI(e.getAttribute("data-field")),"{}");"1"==i&&(a=JE.toObj(a),Ext.iterate(a,function(e,t){Ext.isEmpty(t)?delete a[e]:-1!=["readOnly","allowBlank","editable"].indexOf(e)?a[e]=JE.toBool(t):-1!=["width","height"].indexOf(e)&&(a[e]=JE.toNum(t))}),"datefield"==(a=Ext.applyIf(a,{xtype:"textfield",width:50,configInfo:""})).xtype?(a.xtype="datetimefield",a.dateType="date",a.submitFormat="Y-m-d",a.format=Ext.value(a.configInfo.split(",")[0],a.submitFormat)):"datemonthfield"==a.xtype?(a.xtype="datetimefield",a.dateType="month",a.submitFormat="Y-m",a.format=Ext.value(a.configInfo,a.submitFormat)):"datetimefield"==a.xtype&&(a.dateType="datetime",a.submitFormat="Y-m-d H:i:s",a.format=Ext.value(a.configInfo,a.submitFormat)),n.fields[t]=a)})},renderCharts:function(){var r,l,s,d=this,e=d.getCmp("reportForm").getCmp("reportBox");d.charts=[],Ext.each(e.getEl().query("div[chartdiv]"),function(t){var e=t.getAttribute("chartCode"),i=Number(t.getAttribute("width")),a=Number(t.getAttribute("height")),n=t.getAttribute("paramsKeys");if(JE.isNotEmpty(e)){r&&r.chartCode!=e&&(s=l=null);var o=Ext.clone(d.reportCfg.params||{});JE.isNotEmpty(n)&&Ext.each(n.split(","),function(e){o[e]=t.getAttribute("params-"+e)}),r=Ext.create("JE.core.view.ChartView",{chartCode:e,height:a,width:i,chartParams:o,chartBean:l,chartCfg:s,renderTo:t}),l=r.chartBean,s=r.chartCfg,d.charts.push(r.getId())}})},renderFields:function(s){var d=this,c=(s=Ext.value(s,{}),d.getCmp("reportForm")),u=c.getCmp("reportBox");u.items.removeAll(),Ext.each(u.getEl().query("span[fieldspan]"),function(e){var t=Ext.get(e),i=Ext.get(e.parentNode),a=e.getAttribute("code"),n=e.getAttribute("name"),o=JE.decodeURI(Ext.value(e.getAttribute("value"),""));if(d.editable){var r=Ext.clone(d.fields[a]);(r=Ext.apply(r,{name:n,reportField:!0,margin:"0",padding:"0",renderTo:i.id,fieldStyle:"background-color:transparent;",style:"display:inline-table;",isFormField:!0,cls:"je-field-basiccls"})).xtype="datefield"==r.xtype?"datedayfield":r.xtype,r.value=JE.toDefVal(Ext.value(o,r.value)),(r=Ext.widget(r.xtype,r)).formObj=c,t.replaceWith(r.getEl()),c.fireEvent("add",c,r),u.items.add(n,r)}else{var l=document.createTextNode(Ext.value(s[n],""));e.parentNode.replaceChild(l,e)}}),d.editable&&c.form.setValues(s)},renderHeaders:function(){var e=this.getCmp("reportForm").getCmp("reportBox");Ext.each(e.getEl().query("div[headerdiv]"),function(e){var t=Ext.get(e),i=Ext.get(e.parentNode),a=i.dom.clientWidth,n=i.dom.clientHeight,o=JE.decodeURI(Ext.value(e.getAttribute("headers"),"")),r=["font-size","font-weight","font-style","font-family","fill"],l={},s=12;if(Ext.each(["fontSize","fontWeight","fontStyle","fontFamily","color"],function(e,t){JE.isNotEmpty(i.dom.style[e])&&(l[r[t]]=i.dom.style[e],"fontSize"==e&&(s=JE.toNum(i.dom.style[e].replace("px",""))))}),JE.isNotEmpty(o)){o=o.split(",");for(var d=[],c=[],u=[],p=i.up("table"),f=JE.toNum(i.getAttribute("rowspan")),E=JE.toNum(i.getAttribute("colspan")),m=[],g=[],h=f;h<p.dom.rows.length;h++){var x=p.dom.rows[h],v=0;if(Ext.each(x.cells,function(e){if(!(1==e.getAttribute("colspan")&&v<E))return!1;v++,m.push((0<m.length?m[m.length-1]:0)+e.clientWidth)}),v==E)break;m=[]}for(h=0;h<f;h++){x=p.dom.rows[h];g.push((0<g.length?g[g.length-1]:0)+x.clientHeight)}g.reverse();var y=0;Ext.each(m,function(e,t){d.push({x:e,y:n}),o[y]&&c.push(Ext.apply({type:"text",text:o[y],x:m[t-1]?m[t-1]+2:2,y:n},l)),y++}),Ext.each(g,function(e,t){0<t&&d.push({x:a,y:e}),o[y]&&c.push(Ext.apply({type:"text",text:o[y],x:a,y:g[t+1]?g[t+1]+2:2,"text-anchor":"end"},l)),y++}),Ext.each(d,function(e,t){u.push("0 0"),u.push(e.x+" "+e.y)}),Ext.each(c,function(e){e.y==n&&(e.y-=s),e.y+=s-6});var b={xtype:"draw",viewBox:!1,width:a,height:n,renderTo:i.id,items:[{type:"path",path:"M "+u.join(" ")+" Z",stroke:"black","stroke-width":.5}]};b.items=b.items.concat(c),i.dom.style.padding="0px",b=Ext.widget(b.xtype,b),t.replaceWith(b.getEl())}})},buildHtml:function(i,a){if(i){var n=this,e=n.getCmp("reportForm").getCmp("reportBox"),d=e.el.dom.innerHTML;if("EDIT"==n.reportBean.REPORT_TYPE&&n.editable){var o=e.el.dom.cloneNode(!0);e.items.each(function(e){var t=Ext.dom.Query.selectNode("table[id="+e.id+"]",o),i=document.createTextNode(Ext.value(e.getValue(),""));t.parentNode.replaceChild(i,t)}),d=o.innerHTML}if(Ext.isEmpty(n.charts)){if(a){var t=JE.ajax({url:"/static/css/je-ueditor.css",text:!0});d=(t='<style type="text/css">'+t+"</style>")+d}i(d)}else{var r=!0;if(Ext.each(n.charts,function(e){var t=Ext.getCmp(e);if(t.chart.hasRendered&&!t.chart.hasRendered())return JE.alert(n.localLang.msg.exportChartWait),r=!1}),!r)return;n.getEl().mask(n.localLang.msg.exportChartMask),Ext.defer(function(){var o=document.createElement("div");o.innerHTML=d;var r=0,l=!0,s="";Ext.each(n.charts,function(e){var n=Ext.getCmp(e);n.exportFile({callback:function(e){if(r++,JE.toBool(e.statusCode)){var t=0==n.boxBorder?"":"border: 1px solid #99bce8;",i=e.savePath+"/"+e.fileName;e.EChart&&(i=e.savePath);var a='<div style="width:'+(e.width+4)+"px;height:"+(e.height+4)+"px;"+t+'"><img src="'+i+'" width="'+e.width+'" height="'+e.height+'" style="margin:1px;"></div>';Ext.dom.Query.selectNode("div[id="+e.chartId+"]",o).parentNode.innerHTML=a}else l=!1,s+=e.notice+"</br>"}})});var t=setInterval(function(){if(n.charts.length==r)if(clearInterval(t),n.getEl().unmask(),d=o.innerHTML,l){if(a){var e='<link  rel="stylesheet" href="'+JE.buildCdnUrl("/static/css/je-ueditor.css")+'" />';d=e+d}i(d)}else JE.alert(n.localLang.msg.exportChartError+"</br>"+s)},500)},100)}}},setReadOnly:function(e){}}),Ext.define("JE.core.view.SSWinCfgView",{extend:"Ext.form.Panel",alias:"widget.jesswincfgview",layout:"column",bodyPadding:5,defaults:{labelAlign:"right",margin:"2 3",labelWidth:60},initComponent:function(){var a=this;a.items=[{fieldLabel:"标题",xtype:"textfield",columnWidth:.25,name:"title"},{fieldLabel:"展示形式",xtype:"rgroup",columnWidth:.25,name:"type",value:"grid",dataArray:[{code:"grid",text:"列表"},{code:"tree",text:"树形"}],listeners:{change:function(e,t,i){a.form.findField("_FUNCNAME").setFieldLabel("tree"==t?"目标字典":"目标功能")}}},{fieldLabel:"选择模式",xtype:"rgroup",columnWidth:.25,name:"multiSelect",value:"S",dataArray:[{code:"S",text:"单选"},{code:"M",text:"多选"}]},{fieldLabel:"宽，高",columnWidth:.25,xtype:"textfield",name:"_WH"},{fieldLabel:"目标功能",columnWidth:.25,name:"_FUNCNAME",xtype:"textfield",readOnly:!0,margin:"2 1 2 3"},{name:"_FUNCCODE",xtype:"gridssfield",margin:"2 3 2 0",editable:!0,configInfo:"JE_CORE_FUNCINFO,_FUNCNAME~_FUNCCODE~_FUNCID,FUNCINFO_FUNCNAME~FUNCINFO_FUNCCODE~JE_CORE_FUNCINFO_ID,S",whereSql:" AND SY_JESYS='1'",columnWidth:.25,listeners:{beforequery:function(e){var t=e.prev("rgroup[name=type]").getValue();e.configInfo="tree"==t?"JE_CORE_DICTIONARY,_FUNCNAME~_FUNCCODE,DICTIONARY_DDNAME~DICTIONARY_DDCODE,S":"JE_CORE_FUNCINFO,_FUNCNAME~_FUNCCODE~_FUNCID,FUNCINFO_FUNCNAME~FUNCINFO_FUNCCODE~JE_CORE_FUNCINFO_ID,S"}}},{xtype:"hidden",name:"_FUNCID"},{fieldLabel:"操作功能",columnWidth:.25,margin:"2 1 2 3",name:"_FUNCNAME2",xtype:"textfield",readOnly:!0},{name:"_FUNCCODE2",xtype:"gridssfield",margin:"2 3 2 0",columnWidth:.25,editable:!0,configInfo:"JE_CORE_FUNCINFO,_FUNCNAME2~_FUNCCODE2~_FUNCID2,FUNCINFO_FUNCNAME~FUNCINFO_FUNCCODE~JE_CORE_FUNCINFO_ID,S",whereSql:" AND SY_JESYS='1'"},{xtype:"hidden",name:"_FUNCID2"},{xtype:"jsonarrayfield",columnAlign:"left",name:"_CODES",height:300,title:"目标字段",defaultEditor:{xtype:"textfield",readOnly:!0},columns:[{dataIndex:"name",flex:.5,text:"目标字段"},{dataIndex:"code",flex:.5,text:"字段编码"}],columnWidth:.5,insertFn:a.selectCols},{xtype:"jsonarrayfield",name:"_CODES2",columnAlign:"left",height:300,title:"操作字段",defaultEditor:{xtype:"textfield",readOnly:!0},columns:[{dataIndex:"name",flex:.5,text:"操作字段"},{dataIndex:"code",flex:.5,text:"字段编码"}],columnWidth:.5,insertFn:a.selectCols},{fieldLabel:"whereSql",columnWidth:.9,xtype:"textfield",name:"whereSql",margin:"2 1 2 3"},{boxLabel:"覆盖功能sql",columnWidth:.1,margin:"2 1",xtype:"yesnofield",name:"coverWhereSql"},{fieldLabel:"orderSql",columnWidth:1,xtype:"textfield",name:"orderSql"},{xtype:"container",columnWidth:1,layout:"hbox",margin:0,defaults:{labelAlign:"right",margin:"2 3",labelWidth:60},items:[{fieldLabel:"赋值操作",xtype:"yesnofield",name:"_INSERT"},{fieldLabel:"确定唯一",xtype:"treessfield",configInfo:",_PKFIELD,code,S",rootData:{id:"ROOT",children:[]},name:"_PKFIELD",listeners:{beforequery:function(e){var t=a.form.findField("_CODES2").getData();if(JE.isEmpty(t))return JE.alert("请先选择操作字段！"),!1;var i=e.rootData.children=[];Ext.each(t,function(e){i.push({id:e.code,code:e.code,text:e.name+"("+e.code+")",leaf:!0})})}}},{fieldLabel:"唯一处理",xtype:"cbbfield",name:"_PKACT",value:"TH",dataArray:[{code:"TH",text:"替换"},{code:"GL",text:"过滤"},{code:"WS",text:"无视"}]},{fieldLabel:"启用默认值",labelWidth:80,xtype:"yesnofield",value:"1",name:"_DEFVAL"},{fieldLabel:"load功能",xtype:"yesnofield",name:"_LOAD"}]}],a.buttons=[{text:"确认（复制代码）",cls:"btn JEPLUS_B_L10",handler:function(){var e=a.buildCodes();0!=e&&(a.callback(e),a.ownerCt.close())}},{text:"取消",cls:"btn",width:130,handler:function(){a.ownerCt.close()}}],a.buttonAlign="center",a.callParent(arguments)},buildCodes:function(){var e=this.form.getValues(),t=JE.decode(Ext.value(e._CODES,"[]")),i=JE.decode(Ext.value(e._CODES2,"[]"));if((JE.isNotEmpty(t)||JE.isNotEmpty(i))&&t.length!=i.length)return JE.alert("两组字段的数量不同，请检查！"),!1;var a=[],n=[];Ext.each([t,i],function(e,t){var i=[n,a][t];Ext.each(e,function(e){i.push(e.code)})});var o=e._WH.split(","),r=JE.toNum(o[0]),l=JE.toNum(o[1]),s={title:e.title,type:e.type,width:r,height:l,multiSelect:"M"==e.multiSelect,configInfo:e._FUNCCODE+","+a.join("~")+","+n.join("~"),coverWhereSql:JE.toBool(e.coverWhereSql),whereSql:e.whereSql,orderSql:e.orderSql,cfg:Ext.encode({funcCode:e._FUNCCODE2,insert:JE.toBool(e._INSERT),defval:JE.toBool(e._DEFVAL),pkField:e._PKFIELD,pkAct:e._PKACT,load:JE.toBool(e._LOAD)})};if(JE.toBool(e._INSERT)){var d=[];d.push("var tableCode = funcData.info.tableName;"),JE.isNotEmpty(e._PKFIELD)&&(d.push('var whereSql = " and "+pkField+" in (\'"+pkVals.join("\',\'")+"\')"'),"GL"==e._PKACT?d=d.concat(["//过滤数据","var rows = JE.ajax({url:JE.getUrlMaps('je.core.load'),params:{whereSql:whereSql,limit:-1,tableCode:tableCode}}).rows;","var newData = [];","Ext.each(data,function(d){","\t var flag = true;","\tExt.each(rows,function(row){if(row[pkField] == d[pkField]){flag = false;return false;}});","\tif(flag){newData.push(d);}","});","data = newData;"]):"TH"==e._PKACT&&(d=d.concat(["//替换数据,删掉原始数据","JE.ajax({url:JE.getUrlMaps('je.core.dbsql', 'removeBySql'),\tparams:{tableCode:tableCode,whereSql:whereSql}});"]))),d=d.concat(["//插入数据","JE.ajax({url:JE.getUrlMaps('je.core.insertUpdateList'),params:{tableCode:tableCode,strData:Ext.encode(data)}});","JE.msg('添加成功！')"]),JE.toBool(e._LOAD)&&(d=d.concat(["//刷新列表","var grid = JE.getFuncView(funcData.info.funcCode,'grid');if(grid){grid.store.reload();}"])),s.insertTpl=d.join("\n\t\t")}var c=["title:'{title}',","type:'{type}',","multiSelect:{multiSelect},","configInfo:'{configInfo}',"];JE.isNotEmpty(s.whereSql)&&c.push('whereSql:"{whereSql}",'),JE.isNotEmpty(s.orderSql)&&c.push("orderSql:'{orderSql}',"),0<r&&c.push("width:{width},"),0<l&&c.push("height:{height},"),JE.toBool(e._INSERT)?c.push("cfg:{cfg},","callback:function(sels,beforeValues,win){","\tvar cfg = win.cfg,funcData = JE.getFuncData(cfg.funcCode),data = [];","\tvar defval = {};if(cfg.defval){defval = funcData.getDefVals();}//默认值",JE.isNotEmpty(e._PKFIELD)?"\tvar pkField = cfg.pkField,pkAct = cfg.pkAct,pkVals = [];//唯一字段":"","\tvar fields = JE.split(win.configInfo.split(',')[1],'~'),targetFields = JE.split(win.configInfo.split(',')[2],'~');","\tExt.each(sels,function(sel){","\t\tvar obj = Ext.clone(defval);//默认值","\t\tExt.each(fields,function(name,i){obj[name] = sel.get(targetFields[i]);});//带值",JE.isNotEmpty(e._PKFIELD)?"\t\tif(obj[pkField]){pkVals.push(obj[pkField]);}//唯一字段处理":"","\t\t//自定义赋值...","\t\t","\t\tdata.push(obj);","\t});","\t{insertTpl}","}"):c.push("callback:function(sels){","\tExt.each(sels,function(sel){","\t\t","\t});","}");var u=["JE.selectWin({"].concat(c).join("\n\t")+"\n});\n";return JE.toXT(u,s)},selectCols:function(i){var e=this.ownerCt.form.getValues(),t=[];if(i.store.each(function(e){t.push(e.get("code"))}),t=t.join(","),"_CODES"==this.name&&"tree"==e.type)JE.selectWin({title:this.title,type:"tree",multiSelect:!0,valueType:"code",value:t,rootData:{id:"ROOT",children:[{id:"1",code:"id",text:"id",leaf:!0,checked:!1},{id:"2",code:"text",text:"text",leaf:!0,checked:!1},{id:"3",code:"code",text:"code",leaf:!0,checked:!1},{id:"4",code:"id_",text:"id_(路径)",leaf:!0,checked:!1},{id:"5",code:"text_",text:"text_(路径)",leaf:!0,checked:!1},{id:"6",code:"code_",text:"code_(路径)",leaf:!0,checked:!1}]},callback:function(e){var t=[];Ext.each(e,function(e){t.push({name:e.get("text"),code:e.get("code")})}),i.getStore().add(t)}});else{var a="_CODES"==this.name?e._FUNCID:e._FUNCID2;if(Ext.isEmpty(a))return void JE.alert("请先选择目标功能在进行字段添加！");JE.selectWin({title:this.title,value:t,configInfo:"JE_CORE_RESOURCECOLUMN,,,M",type:"grid",whereSql:" and RESOURCECOLUMN_FUNCINFO_ID = '"+a+"'",callback:function(e){var t=[];Ext.each(e,function(e){t.push({name:e.get("RESOURCECOLUMN_NAME"),code:e.get("RESOURCECOLUMN_CODE")})}),i.getStore().add(t)}})}}}),Ext.define("JE.core.view.SSWinView",{extend:"Ext.window.Window",alias:"widget.jesswinview",mixins:["JE.core.util.ViewUtil","JE.core.util.FieldUtil"],cls:"je-sswin",modal:!0,layout:"fit",maximizable:!0,buttonAlign:"center",configInfo:"",whereSql:"",type:"grid",enableExp:void 0,enableExpFn:void 0,enableTip:void 0,initComponent:function(){var t=this;t.cls=Ext.value(t.cls,"")+" jesswinview",t.localLang=JE.getLocalLang("core.jesswinview",!0),t.configInfo=Ext.value(t.configInfo,""),t.otherConfig=Ext.value(t.otherConfig,{}),Ext.isString(t.otherConfig)&&(t.otherConfig=JE.decode(t.otherConfig));var e=t.configInfo.split(","),i={code:e[0],multiSelect:Ext.value(t.multiSelect,-1==["S","S_"].indexOf(Ext.value(e[3],"S"))),whereSql:t.whereSql,orderSql:t.orderSql,id:t.initialConfig.id,coverWhereSql:t.coverWhereSql};if(-1!=["JE_CORE_FONTICON"].indexOf(i.code))t.type="icon",t.border=0,t.width=Ext.value(t.width,850),t.height=Ext.value(t.height,JE.getBodyHeight()-200),t.items={xtype:"jeiconview",itemId:"iconview",funcCode:i.code,itemdblclick:t.itemdblclick};else if("grid"==t.type){var a=t.buildFunc(i);t.items=[a],i.multiSelect&&(t.layout="border",a.region="center")}else t.items=t.buildTree(i);t.buttons||(t.buttons=[{text:t.localLang.okButtonText,ref:"okButton",iconCls:"jeicon jeicon-check",scope:this,listeners:{click:t.okButton}},{text:t.localLang.cancelButtonText,ref:"cancelButton",iconCls:"jeicon jeicon-error",scope:this,listeners:{click:t.cancelButton}}],"plus"==JE.getTheme()&&(t.buttons[0].cls="btn JEPLUS_B_L10",t.buttons[0].iconCls="fa fa-check",t.buttons[1].cls="btn",t.buttons[1].iconCls="fa fa-close")),t.callParent(arguments),"grid"==t.type&&t.on("beforeclose",function(){var e=t.query("jegridview");Ext.each(e,function(e){var t=Ext.getCmp(e.id+"__moresearch_win");t&&t.close()})})},buildFunc:function(e){var o=this,t=e.code,i=e.multiSelect,a=e.whereSql,n=e.id,r=JE.getFuncData(t);r.info.quickSql=a,1!=e.coverWhereSql&&(r.info.quickSql=Ext.value(r.info.whereSql,"")+a),JE.isNotEmpty(e.orderSql)&&(r.info.orderSql=e.orderSql),r.info.pageSize=Ext.value(o.pageSize,r.info.pageSize),r.info.multiSelect=i,r.info.gridTip=Ext.value(o.otherConfig.gridTip,r.info.gridTip),o.border=0,o.width=Ext.value(o.width,JE.getBodyWidth()-200),o.height=Ext.value(o.height,JE.getBodyHeight()-120),n=Ext.isEmpty(n)?n:n+"_jedataview";var l={xtype:"jedataview",type:"query",reallyView:!0,funcData:r,quickSql:a,treeItemsSql:o.treeItemsSql,id:n,listeners:{afterrender:function(i){var a=Ext.getCmp(i.getId()+"_jegridview");(o.gridObj=a).on("itemdblclick",o.itemdblclick),JE.isNotEmpty(i.queryChild)&&a.on("selectionchange",function(e,t){o.filterChild(i,t)}),"JE_CORE_QUERYUSER"!=r.info.funcCode&&a.multiSelect&&o.buildListMSS(r,a);var n=a.getDockedCmp("buttonBar").getCmp("queryGridField");a.on("load",function(e,t){JE.isNotEmpty(t)&&1==t.length&&(a.getSelectionModel().select(t),n&&n.focus())}),n&&n.on("beforequery",function(e,t){if(1==a.getSelectionModel().getSelection().length&&"keyEvent"==t&&!a.funcData.info.multiSelect)return o.itemdblclick(a.view),!1})}}},s=o.otherConfig.parentFunc,d=o.otherConfig.parentFuncSql,c=o.otherConfig.childFunc;return JE.isNotEmpty(s)?(r.info.childFunc=!0,(l={xtype:"jedataview",type:"query",funcData:JE.getFuncData(s),id:n,queryChild:[l],listeners:{afterrender:function(i){Ext.getCmp(i.getId()+"_jegridview").on("selectionchange",function(e,t){o.filterChild(i,t)}),o.filterChild(i,[],!0)}}}).funcData.info.whereSql+=Ext.value(d,""),l.funcData.info.quickSql=Ext.value(l.funcData.info.whereSql,"")):JE.isNotEmpty(c)&&(l.queryChild=[],Ext.each(c.split(","),function(e){var t=JE.getFuncData(e);t.info.childFunc=!0,l.queryChild.push({xtype:"jedataview",type:"query",multiSelect:!1,funcData:t})})),l},buildTree:function(e){var a=this,t=e.multiSelect,i=e.whereSql,n=e.id;a.width=Ext.value(a.width,400),a.height=Ext.value(a.height,600),a.height=a.height>JE.getBodyHeight()?JE.getBodyHeight():a.height,a.tools=a.getTreeTools(),a.border=1;var o={xtype:"jetreeview",id:n=Ext.isEmpty(n)?n:n+"_jetreeview",border:0,type:"query",multiSelect:t,rootData:a.rootData,disableCheck:a.otherConfig.disableCheck,url:a.treeUrl,formatData:a.formatData,parentData:a.parentData,codeSearch:a.codeSearch,expandRootChild:a.expandRootChild,queryItems:[{otherConfig:JE.isEmpty(a.otherConfig)?"":JE.encode(a.otherConfig),configInfo:a.configInfo,whereSql:i}],listeners:{itemdblclick:function(e,t){var i=e.panel.getSelectionModel();i.deselectAll(),i.select([t]);var a=e.up("window").down("button[ref=okButton]");a.fireEvent("click",a)},afterrender:function(i){i.down("combobox[ref=queryTreeCBB]").on("specialkey",function(e,t){t.getKey()!=t.ENTER||e.picker&&!e.picker.isHidden()||1!=i.getSelectionModel().getSelection().length||a.itemdblclick(i.view)})}},frame:!1,params:a.params};a.on("show",function(e){a.treeRenderData(e.items.get(0))});var r=Ext.value(a.treeConfig,{});return Ext.apply(o,r),o},buildListMSS:function(e,i){var l=this,t=l.configInfo.split(","),a=e.basicColumns,n=e.info,o=t[1],r=t[2],s=[];if(JE.isNotEmpty(l.resultColumn)&&a[l.resultColumn]){var d=a[l.resultColumn];s.push({dataIndex:d.dataIndex,renderer:JE.renderer,tactics:d.tactics,text:d.text,flex:1,align:d.align,sortable:!1})}else JE.isNotEmpty(r)?Ext.each(r.split("~"),function(e){var t=a[e];s.push({dataIndex:t.dataIndex,renderer:JE.renderer,tactics:t.tactics,text:t.text,width:t.width,hidden:t.hidden,align:t.align,sortable:!1})}):Ext.each(e.select.columns,function(e,t){if(1<t)return!1;"rownumberer"!=e.xtype&&s.push({dataIndex:e.dataIndex,renderer:JE.renderer,tactics:e.tactics,text:e.text,flex:1,align:e.align,sortable:!1})});s[1<s.length?"unshift":"push"]({text:'<div class="fa fa-trash-o" style="color:#E94B4D;" data-qtip="'+l.localLang.selectPanel.clearColumnTip+'"></div>',resizable:!1,xtype:"actioncolumn",width:30,align:"center",sortable:!1,menuDisabled:!0,items:[{iconCls:"fa fa-times-circle",iconStyle:"color: #E94B4D;",handler:function(e,t,i){var a,n=l.gridObj.getSelectionModel().getSelection(),o=e.getStore().getAt(t),r=e.panel.pkName;Ext.each(n,function(e){if(e.get(r)==o.get(r))return a=e,!1}),a?l.gridObj.getSelectionModel().deselect(a):l.gridDeselected(l.gridObj,o)}}],listeners:{headerclick:function(e,t){JE.confirm(l.localLang.selectPanel.deselectTip,function(e){"ok"==e&&(l.getCmp("resultGrid").getStore().removeAll(),l.gridObj.selectRecords.removeAll(),l.gridObj.getSelectionModel().deselectAll())})}}});var c=[],u=Ext.value(l.otherConfig.pkName,n.pkName);if(JE.isNotEmpty(u)&&-1==["procedure","iditprocedure","sql"].indexOf(e.info.funcType)){var p="";Ext.each(r.split("~"),function(e,t){if(e==u)return p=o.split("~")[t],!1});var f=JE.isEmpty(l.parent)?l.value:l.getFieldValues({parent:l.parent,parentType:l.parentType,fieldName:p});if(JE.isNotEmpty(f)){var E=" and "+u+" in ('"+f.replaceAll(",","','")+"')";c=JE.ajax({url:Ext.value(n.funcAction+"/load",JE.getUrlMaps("je.core","load")),params:{whereSql:n.whereSql+E,tableCode:n.tableName,limit:-1,orderSql:n.orderSql}}).rows}}var m={xtype:"grid",region:"east",title:l.localLang.selectPanel.title,width:200,pkName:u,collapsible:!0,itemId:"resultGrid",split:!0,store:Ext.create("Ext.data.Store",{fields:e.modelFields,data:c}),viewConfig:{plugins:{ptype:"gridviewdragdrop",dragText:JE.getLocalLang("common.dragText"),pluginId:"ddOrder",ddGroup:"GridDD"}},columnLines:!0,columns:s};l.add(m),i.on({load:function(e){l.gridSelectSaved(i)},select:function(e,t){l.gridSelected(i,t)},deselect:function(e,t){l.gridDeselected(i,t)}})},afterRender:function(){this.callParent(arguments),this.sswinRender&&this.sswinRender(this)},filterChild:function(e,n,o){var r,l=e.funcData;0<n.length&&(record=n[n.length-1],r=record.data,l.info.gridChildFilter||(n=[])),Ext.each(l.child,function(a){Ext.getCmp(e.getId()+"_childs").items.each(function(e){if(a.code==e.funcData.info.funcCode){var t=Ext.getCmp(e.getId()+"_jegridview");if(o)t.store.removeAll(),JE.DB.setWhereSql(t.store," and 1!=1 ","parent");else{var i=JE.CoreUtil.buildChildSql(l.info,a.fields,r,n).whereFields;JE.DB.setWhereSql(t.store,i,"parent"),t.store.loadPage(1)}}})})},itemdblclick:function(e,t){e.getSelectionModel().select(t);var i=e.up("window").down("button[ref=okButton]");i.fireEvent("click",i)},treeRenderData:function(o){o.getStore();var e=o.up("window"),n=Ext.value(o.configInfo[0],{}),t=Ext.value(n.async,!1);if(!Ext.isEmpty(e.value)){var i=e.value.split(","),r=(o.getRootNode(),[]),l=-1!=(s=Ext.value(e.valueType,"code")).indexOf("_"),s=s.replace("_","");if(l){var a=[];Ext.each(i,function(e){var t=e.split("/");e=t[t.length-1],a.push(e)}),i=a}if(t&&-1!=["id","code"].indexOf(s)){var d=JE.ajax({url:JE.getUrlMaps("je.core.dd.tree.findAsyncNodes"),params:{type:s,value:i.join(","),strData:Ext.encode([n])}});Ext.each(d,function(e){var t=e.nodePath,i=e.id,a=e.nodeInfo;if(JE.isNotEmpty(a)){var n=[];Ext.each(t.split("/"),function(e){JE.isNotEmpty(e)&&(e+="_"+a),n.push(e)}),o.loadInfo.params.onlyItem?n[1]="ROOT":n.splice(1,0,"ROOT"),t=n.join("/")}o.expandPath(t),e=o.getStore().getNodeById(i),r.push(e)})}else Ext.each(i,function(e){var t={};if("id"==s){var i=Ext.value(n.nodeInfo,"");JE.isNotEmpty(i)&&(e+="_"+i),t=o.nodeHash[e]}else for(var a in o.nodeHash)if((t=o.nodeHash[a])[s]==e){if(!l)break;if(o.getNodeHashPath(t).substring(6)==e)break}t&&(o.expandPath(o.getNodeHashPath(t)),r.push(o.getStore().getNodeById(t.id)))});o.getSelectionModel().select(r,!0,!0)}},gridSelectSaved:function(i){var e=i.getStore(),t=this.getCmp("resultGrid"),a=t.pkName,n=[];i.selectRecords||(i.selectRecords=new Ext.util.MixedCollection,t.getStore().each(function(e){var t=Ext.create(i.store.model.$className,e.data);i.selectRecords.add(t.get(a),t)})),e.each(function(e){i.selectRecords.get(e.get(a))&&n.push(e)}),i.getSelectionModel().select(n)},gridSelected:function(e,t){var i=this.getCmp("resultGrid"),a=i.pkName,n=t.get(a);e.selectRecords.get(n)||(e.selectRecords.add(n,t),i.getStore().add(t.data))},gridDeselected:function(e,t){var i=this.getCmp("resultGrid"),a=i.pkName,n=t.get(a);e.selectRecords.removeAtKey(n),i.getStore().each(function(e){if(e.get(a)==n)return i.getStore().remove(e),!1})},cancelButton:function(e){var t=e.up("window"),i=!0;t.cancelButtonClick&&(i=t.cancelButtonClick(t)),0!=i&&t.close()},okButton:function(e){var r=e.up("window"),i=r.parent,l=r.parentType;cs=r.configInfo.split(","),fields=Ext.value(cs[1],"").split("~"),cols=Ext.value(cs[2],"").split("~");var t,s=[],d={},a=[];if("icon"==r.type)t=r.getCmp("iconview").getCmp("view"),s=t.getSelectionModel().getSelection();else if("grid"==r.type)t=Ext.getCmp(r.down("jedataview[reallyView]").getId()+"_jegridview"),s=t.getSelectionModel().getSelection(),1==t.multiSelect&&t.selectRecords&&(s=r.getCmp("resultGrid").getStore().data.items);else{t=r.down("treepanel"),s=t.getSelectionModel().getSelection();var n=[],o=r.enableExp,c=r.enableExpFn;Ext.each(s,function(e){var t=!0;if(JE.isNotEmpty(c)?t=Ext.value(c(e),!0):JE.isNotEmpty(o)?t=Ext.value(JE.eval(JE.toXT(o,e.data),r.localLang.disableTip.expTip+o),!1):"1"==e.get("disabled")&&(t=!1),t){var i=Ext.create(JE.getTreeModel(),e.raw);i.set("id",Ext.value(e.get("id"),"").split("_")[0]),i.set("text_",e.getPath("text").split("/").slice(2).join("/")),i.set("code_",e.getPath("code").split("/").slice(2).join("/")),i.set("id_",e.getPath().replaceAll("_"+r.name,"").split("/").slice(2).join("/")),n.push(i)}else a.push(e)}),s=n}if(0<a.length)JE.confirm(Ext.value(r.enableTip,r.localLang.disableTip.msg),function(e){"ok"==e&&t.getSelectionModel().deselect(a,!0)},r.localLang.disableTip.title,r.localLang.disableTip.okText,r.localLang.disableTip.cancelText);else{if("grid"==r.type&&t.funcData&&-1==["procedure","iditprocedure","sql"].indexOf(t.funcData.info.funcType)&&0<s.length){var u=Ext.value(t.store.proxy.extraParams.whereSql,""),p=t.store.proxy.url,f=Ext.value(t.funcData.info.viewTableName,t.funcData.info.tableName),E=t.funcData.info.pkName,m=[];Ext.each(s,function(e){m.push(e.get(E))}),u+=" and "+E+" in ('"+m.join("','")+"')";var g=JE.ajax({url:p,params:{whereSql:u,tableCode:f}});Ext.each(g.rows,function(t){Ext.each(s,function(e){if(e.get(E)==t[E])return e.data=t,e.commit(!0),!1})})}if(!r.okButtonClick||0!=r.okButtonClick(s,r)){i&&Ext.each(fields,function(e,t){var a,n=[],o=cols[t];Ext.each(s,function(e){var t=(a=e.data)[o];if("grid"!=r.type){var i=o.split(".");t=2==i.length?a[i[0]][i[1]]:a[o]}n.push(t)}),r.setFieldValues({parent:i,parentType:l,values:n,fieldName:e}),d[e]=""});var h=!0;r.callback&&(h=r.callback(s,d,r)),0!=h&&r.close()}}}}),Ext.define("JE.core.view.TabMainView",{extend:"Ext.panel.Panel",alias:"widget.jetabmainview",idSuffix:"",layout:"fit",cls:"je-tabmainview",initComponent:function(){var e=this,t=e.funcData,i=t.info.idSuffix;t.info.funcId||(t=JE.getFuncData(t.info.funcCode)),t.info.idSuffix=Ext.value(e.idSuffix,Ext.value(i,"")),e.id=t.info.funcCode+"_jetabmainview"+t.info.idSuffix,Ext.isEmpty(e.title)||(e.iconCls=Ext.value(e.iconCls,Ext.value(t.info.funcIconCls,"")));var a=Ext.value(t.childObj[5],[]),n=[{xtype:"jemainview",funcData:t,showView:e.showView,idSuffix:e.idSuffix,iconCls:e.iconCls,title:t.info.funcName}];Ext.each(a,function(e){var t=JE.CoreUtil.parseChildObj(e);delete t.fields,delete t.parentType,delete t.childFunc,delete t.bodyPadding,n.push(t)});var o=!0;1<n.length&&(o=!1),e.items={xtype:"tabpanel",itemId:"mainTab",items:n,plain:!0,defaults:{border:0,rootFunc:e.rootFunc},tabBar:{hidden:o,style:"background-color:#cbdbef;",cls:"je-tab-bar-14"},bodyStyle:"border-width:0px;"},e.bodyPadding=1,e.callParent(arguments),e.on("activate",function(){e.getCmp("mainTab").setActiveTab(0)})},refreshFunc:function(){this.getCmp("mainTab").items.each(function(e){e.refreshFunc&&e.refreshFunc()})}}),Ext.define("JE.core.view.tool.CxclView",{extend:"Ext.panel.Panel",alias:"widget.jetool.cxclview",border:0,layout:"column",initComponent:function(){var a=this,e=a.grid,t=e.funcData.info,n=JE.ajax({url:JE.getUrlMaps("je.core.load"),params:{limit:-1,tableCode:"JE_CORE_QUERYSTRATEGY",whereSql:" and QUERYSTRATEGY_FUNCCODE = '"+t.funcCode+"' and (QUERYSTRATEGY_USERID = '"+JE.USER.userId+"' or QUERYSTRATEGY_USERID ='' or QUERYSTRATEGY_USERID is null)",orderSql:" order by QUERYSTRATEGY_USERID,SY_ORDERINDEX"}}).rows;if(a.cxclData=n,a.userData=JE.CoreUtil.getUserInfo("CXCL",e.funcData,n),a.viewData={show:[],hide:[]},JE.isEmpty(a.userData))a.viewData.show=n;else{var o=a.userData.config;Ext.each(["show","hide"],function(i){Ext.each(o[i],function(t){Ext.each(n,function(e){if(t==e.JE_CORE_QUERYSTRATEGY_ID)return JE.isNotEmpty(o.def)&&(e.QUERYSTRATEGY_DEF=o.def==t?"1":"0"),a.viewData[i].push(e),!1})})})}a.items=[{xtype:"box",columnWidth:1,style:"font-size:14px;border-bottom:1px solid #ddd;padding:5px 0;",html:"您可以通过拖动来改变顺序或显示/隐藏标签"},{xtype:"box",style:"color:#999;padding:10px 0 5px;",columnWidth:.5,html:"显示的标签",margin:"0 5"},{xtype:"box",style:"color:#999;padding:10px 0 5px;",columnWidth:.5,html:"隐藏的标签",margin:"0 5"},a.buildList({cls:"je-tool-cxclview",itemId:"showview"}),a.buildList({cls:"je-tool-cxclview hideview",itemId:"hideview"}),{xtype:"box",columnWidth:1,padding:"10 5",html:'<span class="addCxcl" style="color: #3487e2;cursor: pointer;">+ 添加策略</span>',listeners:{afterrender:function(e){e.getEl().on("click",function(e){e.getTarget(".addCxcl")&&a.addCXCL()})}}}],a.buttons=[{text:"完成",cls:"JEPLUS_B_C01",handler:function(){a.doOK()}},{text:"恢复系统默认",cls:"JEPLUS_B_L10",handler:function(){JE.confirm("恢复后个人配置数据将清空，确定恢复吗？",function(e){"ok"==e&&(a.resetCXCL(),JE.msg("恢复成功！"))})}},{text:"取消",handler:function(){a.ownerCt.close()}}],a.buttonAlign="right",a.callParent(arguments)},afterRender:function(){this.callParent(arguments)},doOK:function(){var a,e=this,t=e.grid.funcData.info,n={show:[],hide:[],def:""};Ext.each(["show","hide"],function(i){e.getCmp(i+"view").getCmp("view").store.each(function(e){var t=e.get("JE_CORE_QUERYSTRATEGY_ID");n[i].push(t),"1"==e.get("QUERYSTRATEGY_DEF")&&(n.def=t,a=e)})});var i={tableCode:"JE_CORE_USERINFO",USERINFO_CONFIG:Ext.encode(n),USERINFO_USERID:JE.USER.userId,USERINFO_USERCODE:JE.USER.userCode,USERINFO_FUNCCODE:t.funcCode,USERINFO_FUNCID:t.funcId,USERINFO_TABLECODE:t.tableNamae,USERINFO_TYPE:"CXCL"},o="doSave";e.userData&&(i.JE_CORE_USERINFO_ID=e.userData.bean.JE_CORE_USERINFO_ID,o="doUpdate");var r=JE.ajax({url:JE.getUrlMaps("je.core",o),params:i});r.success?(JE.msg("保存成功！"),e.menuView.store.reload(),a&&e.menuView.ownerCt.doSearch(a.data),e.ownerCt.close()):JE.alert(r.obj)},buildList:function(e){var l=this,t={xtype:"boundlist",style:"border-color:#ddd;",store:Ext.create("Ext.data.Store",{model:JE.getModel({tableName:"JE_CORE_QUERYSTRATEGY"}),data:l.viewData["hideview"==e.itemId?"hide":"show"]}),tpl:['<ul class="'+Ext.plainListCls+'"><tpl for=".">','<li role="option" unselectable="on" class="x-boundlist-item" style="cursor: move;padding:0px 10px;">','<div class="item-def" <tpl if="QUERYSTRATEGY_DEF==\'1\'">style="background-color: #3487E2;"</tpl>></div>',"{QUERYSTRATEGY_NAME}",'<div class="item-acts">','<tpl if="QUERYSTRATEGY_USERID">','<i class="fa fa-pencil edit" title="编辑"></i>','<i class="fa fa-trash-o remove" title="删除"></i>',"</tpl>","<tpl if=\"QUERYSTRATEGY_DEF!='1'\">",'<i class="fa fa-check setdef" title="设为默认筛选标签"></i>',"</tpl>","</div>","</li>","</tpl></ul>"],listeners:{itemclick:function(i,a,e,t,n){if(n.getTarget(".remove"))JE.confirm("确定删除吗？",function(e){if("ok"==e){var t=a.get("JE_CORE_QUERYSTRATEGY_ID");JE.ajax({url:JE.getUrlMaps("je.core.remove"),params:{ids:t,tableCode:"JE_CORE_QUERYSTRATEGY"}}).success&&(JE.msg("删除成功！"),i.store.remove(a),l.menuView.store.remove(l.menuView.store.getById(t)),l.menuView.ownerCt.doSearch(l.menuView.store.getAt(0).data))}});else if(n.getTarget(".edit")){var o=Ext.decode(a.get("QUERYSTRATEGY_SQL"),!0);if(JE.isEmpty(o))return void JE.alert("SQL不支持编辑");JE.win({title:"编辑策略",width:600,height:360,autoShow:!0,items:{xtype:"jetool.searchview",type:"cxcl",grid:l.grid,menuView:l.menuView,record:a,editType:!0}})}else n.getTarget(".setdef")&&i.store.each(function(e){e.set("QUERYSTRATEGY_DEF",e.get("JE_CORE_QUERYSTRATEGY_ID")==a.get("JE_CORE_QUERYSTRATEGY_ID")?"1":"0")})}}};return Ext.apply(t,e),t.itemId="view",{xtype:"panel",columnWidth:.5,height:400,margin:"0 5",border:0,layout:"fit",itemId:e.itemId,items:t,listeners:{afterrender:function(e){var t=e.getCmp(0);t.selectedItemCls=" ",e.dragZone=Ext.create("Ext.view.DragZone",{view:t,ddGroup:"ddCXCL",dragText:"拖动操作"}),e.dropZone=Ext.create("Ext.view.DropZone",{view:t,ddGroup:"ddCXCL",notifyOver:function(e,t,i){var a=i.records[0];if("hideview"==this.view.ownerCt.itemId&&a&&"1"==a.get("QUERYSTRATEGY_DEF"))return this.invalidateDrop(),i.ddel.update("默认策略不能隐藏"),this.dropNotAllowed;i.ddel.update(a.get("QUERYSTRATEGY_NAME"));var n=this.getTargetFromEvent(t);return n?(this.lastOverNode!=n&&(this.lastOverNode&&this.onNodeOut(this.lastOverNode,e,t,i),this.onNodeEnter(n,e,t,i),this.lastOverNode=n),this.onNodeOver(n,e,t,i)):(this.lastOverNode&&(this.onNodeOut(this.lastOverNode,e,t,i),this.lastOverNode=null),this.onContainerOver(e,t,i))},handleNodeDrop:function(e,t,i){var a,n=this.view,o=n.getStore(),r=e.records;1!=l.sourceCopy&&e.view.store.remove(r),a=o.indexOf(t),"after"===i&&a++,0!=r.length&&(o.insert(a,r),n.getSelectionModel().select(r))}})}}}},addCXCL:function(){this.ownerCt.close(),JE.win({title:"新建查询策略",width:600,height:360,autoShow:!0,items:{xtype:"jetool.searchview",type:"cxcl",grid:this.grid,menuView:this.menuView}})},resetCXCL:function(){var e={show:[],hide:[]};e.show=this.cxclData,this.getCmp("hideview").getCmp("view").store.removeAll(),this.getCmp("showview").getCmp("view").store.removeAll(),this.getCmp("showview").getCmp("view").store.add(e),JE.CoreUtil.removeUserInfo("CXCL",this.grid.funcData),this.up("window").close()}}),Ext.define("JE.core.view.tool.EmailView",{extend:"Ext.form.Panel",alias:"widget.jeemailview",layout:"column",autoScroll:!0,tplCode:void 0,params:void 0,initComponent:function(){var o=this;o.localLang=JE.getLocalLang("sys.email.emailReadEdit"),Ext.apply(o.localLang,JE.getLocalLang("sys.email.common")),o.bodyPadding=10,o.defaults={columnWidth:1,labelAlign:"right",labelWidth:60,margin:"2 0"},o.items=[{fieldLabel:"收件人",xtype:"multiitem",name:"EMAILDATA_SJR",value:o.email,allowBlank:!1,regex:/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/,regexText:"请输入正确的邮箱",fields:["text","code"],displayTpl:"<b>{text}</b>",listeners:{afterrender:function(a){a.labelEl.appendChild({tag:"div",cls:"fa fa-sign-in",style:"cursor: pointer;padding:10px 5px;color:#444;font-size:12px;","data-qtip":"导入联系人"}).on("click",function(){JE.win({title:"导入联系人",items:{xtype:"textarea",emptyText:"多个联系人以分号“;”分隔"},width:600,height:500,useButton:!0,autoShow:!0,fn:function(e){var t=e.getCmp(0).getValue();if(JE.isNotEmpty(t)){var i=[];Ext.each(t.split(";"),function(e){a.regex.test(e)&&i.push({code:e,text:e})}),a.addData(i)}}})})}}},{fieldLabel:"抄送",xtype:"multiitem",name:"EMAILDATA_CS",regex:/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/,regexText:"请输入正确的邮箱",fields:["text","code"],displayTpl:"<b>{text}</b>",hidden:!0},{fieldLabel:"密送",xtype:"multiitem",name:"EMAILDATA_MS",regex:/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/,regexText:"请输入正确的邮箱",fields:["text","code"],displayTpl:"<b>{text}</b>",hidden:!0},{xtype:"box",itemId:"box",style:"padding-left:85px;",html:JE.format('<a name="CS" text="{0}" title="{1}" href="javascript:;" style="text-decoration: none;cursor: pointer;outline: none;color:#082a4e;">{2}{3}</a>&nbsp;-&nbsp;<a name="MS" text="{4}" title="{5}" href="javascript:;" style="text-decoration: none;cursor: pointer;outline: none;color:#082a4e;">{6}{7}</a>',o.localLang.carbonCopy,o.localLang.carbonCopyTitle,o.localLang.addText,o.localLang.carbonCopy,o.localLang.blindCarbonCopy,o.localLang.blindCarbonCopyTitle,o.localLang.addText,o.localLang.blindCarbonCopy),listeners:{afterrender:function(e){e.getEl().select("a").on("click",function(e,t){var i=t.getAttribute("name"),a=t.getAttribute("text"),n=o.form.findField("EMAILDATA_"+i);n.isHidden()||n.reset(),n.setVisible(n.isHidden()),n.setDisabled(n.isHidden()),t.innerHTML=(n.isHidden()?o.localLang.addText:o.localLang.deleteText)+a,n.isHidden()?Ext.each(["EMAILDATA_MS","EMAILDATA_CS","EMAILDATA_SJR"],function(e){var t=o.form.findField(e);if(!t.isHidden())return t.focus(),!1}):n.focus()})}}},{fieldLabel:"主题",xtype:"textfield",allowBlank:!1,value:o._title,name:"EMAILDATA_BT",columnWidth:.6},{xtype:"button",text:"邮件模板",margin:"2 0 2 5",cls:"btn btn-form JEPLUS_B_C01",columnWidth:.1,handler:function(){o.selectEmail()}},{xtype:"uxfilesfield",fieldLabel:"附件",filesIcon:"small",name:"EMAILDATA_FJ",noHeight:!0,minHeight:32,labelStyle:"cursor: pointer;color:blue;",listeners:{afterrender:function(e){e.labelEl.on("click",function(){e.doUploadFiles()})}},filesToolbar:"hide"},{xtype:"ueditor",imageUrlType:"base64",minHeight:500,simpleToolbar:!0,simpleToolbars:[["undo","redo","|","bold","italic","underline","forecolor","backcolor","fontfamily","fontsize","|","insertorderedlist","insertunorderedlist","|","justifyleft","justifycenter","justifyright","justifyjustify","|","simpleupload","emotion","|","source"]],name:"EMAILDATA_ZW"},{xtype:"container",layout:"hbox",items:[{fieldLabel:"发件人",xtype:"cbbfield",labelAlign:"right",name:"EMAILDATA_FJR",readOnly:"USER"!=o.type,dataArray:o.emailSend,value:o.emailSend[0].code,width:400},{xtype:"yesnofield",name:"EMAILDATA_JJZT",margin:"0 5 0 15",boxLabel:o.localLang.urgency},{xtype:"yesnofield",name:"EMAILDATA_SFHZ",margin:"0 5",boxLabel:o.localLang.readReceipt},{xtype:"yesnofield",name:"EMAILDATA_FBS",margin:"0 5",boxLabel:"分别发送"}]},{xtype:"box",columnWidth:1,style:"padding: 10px 5px;font-size: 13px;line-height: 25px;color: #ABABAB;",html:['<span style="color:#000000;">网上邮件使用协议</span>','<span style="color:blue;">1：所有邮件须带上全会带上公司签名。</span>','<span style="color:red;">2：受政策管制，近期群发邮件受到大面积的影响，发送前请务必慎重。</span>',"3：不发送任何非法的、骚扰性、中伤他人的、辱骂性的、恐吓性的、伤害性的、挑衅的、庸俗的、淫秽等内容的邮件消息。 ","4：不发送任何教唆他人构成犯罪行为的邮件消息。 ","5：不发送任何涉及国家安全和国家机密的邮件消息。","6：如违反以上规定各项，本公司将保留配合公安部门追查信息来源的权利。"].join("<br/>")}],o.buttons=[{text:"立即发送邮件",cls:"btn JEPLUS_B_L10",itemId:"sendSMSBtn",width:110,handler:function(){o.sendEmail()}},{text:"取消",cls:"btn",width:110,handler:function(){o.ownerCt.close()}}],o.buttonAlign="center",o.callParent(arguments)},afterRender:function(){if(this.callParent(arguments),this.tplCode){var e=JE.ajax({url:"/je/dynaActon!load.action",params:{tableCode:"JE_SYS_EMAILBASE",limit:1,whereSql:" AND EMAILBASE_CODE = '"+this.tplCode+"'"}});if(JE.isNotEmpty(e.rows)){var t=e.rows[0],i={EMAILDATA_BT:JE.toXT(t.EMAILBASE_ZT,this.params),EMAILDATA_ZW:JE.toXT(t.EMAILBASE_NR,this.params)};this.form.setValues(i)}}},sendEmail:function(){if(this.form.isValid()){var e=this.form.getValues();if(JE.isEmpty(e.EMAILDATA_ZW))JE.alert("请输入正文！");else e.tableCode="JE_SYS_EMAILDATA",e.EMAILDATA_SJ=Ext.Date.format(new Date,"Y-m-d H:i:s"),e.EMAILDATA_FBS="1",e.EMAILDATA_DQZT="0",e.EMAILDATA_ZT="send",e.EMAILDATA_FJR="[{code:'"+e.EMAILDATA_FJR+"',text:'"+e.EMAILDATA_FJR+"'}]",e.type=this.type,JE.ajax({url:JE.getUrlMaps("je.core.email","doSendEmail"),params:e}).success&&(JE.msg("发送成功！"),this.ownerCt.close()),this.callback&&this.callback()}},selectEmail:function(){var a=this;JE.selectWin({title:"邮箱库",configInfo:"JE_SYS_EMAILBASE",callback:function(e){var t=e[0];if(t){var i={EMAILDATA_BT:JE.toXT(t.get("EMAILBASE_ZT"),a.params),EMAILDATA_ZW:JE.toXT(t.get("EMAILBASE_NR"),a.params)};a.form.setValues(i)}}})}}),Ext.define("JE.core.view.tool.HistoryView",{extend:"Ext.panel.Panel",alias:"widget.jetool.historyview",layout:"fit",cls:"je-tool-history",initComponent:function(){var t=this;t.itemTpl=t.itemTpl||"";var e=JE.getLocalLang("core.jeformview.historySet.by");instead=JE.getLocalLang("core.jeformview.historySet.instead"),t.items=Ext.create("Ext.view.View",{cls:"timelineview",itemId:"view",emptyText:JE.CoreUtil.getEmptyDataTpl(),tpl:['<div class="view-body">','<tpl for=".">','<div class="item item-{[this.isSameDay(parent,values)]}">','<div class="item-line"></div>','<div class="item-time  item-time-{[this.isSameDay(parent,values)]}"><h3 style="display:inline-block;margin-right:20px;margin-top:8px;color:#111;font-size:18px;">{[this.getWeek(values.SY_CREATETIME.substring(0,10))]}</h3>{[values.SY_CREATETIME.substring(0,10)]}</div>','<div class="item-image-{[this.isSameDay(parent,values)]}"></div>','<div class="item-info" style="overflow:hidden;">','<div style="width:85px;float:left;color:#999">{[values.SY_CREATETIME.substring(11)]}</div>','<div style="width:60px;float:left;">{SY_CREATEUSERNAME}</div>','<div style="float:left;width:350px">','<tpl for="Ext.decode(PAGENICKED_NICKED)">','<span class="keyword" style="font-weight: bold;">{text}</span> '+e+' <span class="keyword">{[Ext.value(values.oldVal,"“”")]}</span> '+instead+' <span class="keyword">{[Ext.value(values.newVal,"“”")]}</span></br>',"</tpl>","</div>","</div>","</div>","</tpl>","</div>",{title:t.viewTitle,getItemTpl:function(e){return t.getItemTpl?t.getItemTpl(e):JE.toXT(t.itemTpl,e.data)},isSameDay:function(i,a){var n=!1;return Ext.each(i,function(e,t){e.JE_CORE_PAGENICKED_ID==a.JE_CORE_PAGENICKED_ID&&0!=t&&i[t-1].SY_CREATETIME.substring(0,10)==a.SY_CREATETIME.substring(0,10)&&(n=!0)}),n},getWeek:function(e){e=e.replace("-","/");var t=new Date(Date.parse(e));return["星期日","星期一","星期二","星期三","星期四","星期五","星期六"][Ext.Date.format(t,"N")]}}],autoScroll:!0,store:JE.getStore({autoLoad:!1,tableName:"JE_CORE_PAGENICKED",pageSize:-1,params:{orderSql:" order by SY_CREATETIME desc"}})}),t.items.store.on({load:{single:!0,fn:function(){t.getCmp("view").refresh()}}}),t.callParent(arguments)},load:function(e){var t=e.mainID,i=e.mainFuncCode;this.getCmp("view").store.load({params:{whereSql:" and PAGENICKED_FUNCCODE = '"+i+"' and PAGENICKED_BUSINESSID = '"+t+"'"}})},afterRender:function(){this.callParent(arguments)},setReadOnly:function(){}}),Ext.define("JE.core.view.tool.IDITColumnView",{extend:"Ext.panel.Panel",alias:"widget.jetool.iditcolumnview",border:0,layout:"hbox",initComponent:function(){var t=this,e=t.grid.funcData,a=e.grid.iditColumns,n=["id","text","pinyin"],o=e.grid.columns;if(Ext.each(o,function(t){Ext.each(a,function(e){if(e.itemId==t.itemId)return Ext.Array.remove(a,e),!1})}),t.userData=JE.CoreUtil.getUserInfo("COLUMN",e),t.viewData={show:[],hide:[]},JE.isEmpty(t.userData))Ext.each(a,function(e){t.viewData.hide.push({id:e.dataIndex,text:e.text,pinyin:JE.toPinYin(e.text,"pinyin")})}),t.buildColumns("show");else for(i in t.userData.config)Ext.each(t.userData.config[i],function(e){t.buildColumns(i,e)});t.defaults={height:"100%"},t.items=[t.buildList({title:"显示的列",store:Ext.create("Ext.data.Store",{fields:n,data:t.viewData.show}),itemId:"showview"}),{xtype:"container",layout:{type:"vbox",align:"center",pack:"center"},width:50,itemId:"buttons",defaults:{xtype:"button",margin:"10 0",cls:"btn JEPLUS_B_C07",style:"padding: 6px !important;",enableCls:"JEPLUS_B_L10",disableCls:"JEPLUS_B_C07",handler:function(e){t.moveColumn(e)}},items:[{iconCls:"fa fa-angle-right",itemId:"showview-btn"},{iconCls:"fa fa-angle-left",itemId:"hideview-btn"}]},t.buildList({title:"隐藏的列",store:Ext.create("Ext.data.Store",{fields:n,data:t.viewData.hide}),itemId:"hideview"})],t.buttons=[{text:"完成",cls:"JEPLUS_B_C01",handler:function(){t.doOK()}},{text:"恢复系统默认",cls:"JEPLUS_B_L10",handler:function(){JE.confirm("恢复后个人配置数据将清空，确定恢复吗？",function(e){"ok"==e&&(t.resetColumns(),JE.msg("恢复成功！"))})}},{text:"取消",handler:function(){t.ownerCt.close()}}],t.buttonAlign="right",t.callParent(arguments)},buildColumns:function(t,i){var a=this,e=a.grid.funcData,n=(e.grid.iditColumns,e.basicColumns);"actioncolumn_1"==i&&a.viewData[t].push({id:i,text:"操作",pinyin:JE.toPinYin("操作","pinyin")}),JE.isEmpty(a.userData)||JE.isEmpty(i)||"rownumberer_1"==i||"actioncolumn_1"==i?Ext.each(e.grid.columns,function(e){if(!e.locked)if(JE.isNotEmpty(i)){if(i==e.dataIndex)return a.viewData[t].push({id:e.dataIndex,text:e.text,pinyin:JE.toPinYin(e.text,"pinyin")}),!1}else a.viewData[t].push({id:e.dataIndex,text:e.text,pinyin:JE.toPinYin(e.text,"pinyin")})}):n[i]&&a.viewData[t].push({id:n[i].dataIndex,text:n[i].text,pinyin:JE.toPinYin(n[i].text,"pinyin")})},resetColumns:function(){this.viewData={show:[],hide:[]},this.buildColumns("show"),this.getCmp("hideview").getCmp("view").store.removeAll(),this.getCmp("showview").getCmp("view").store.removeAll(),this.getCmp("showview").getCmp("view").store.add(this.viewData.show),JE.CoreUtil.removeUserInfo("COLUMN",this.grid.funcData),this.ownerCt.close(),this.refreshGridColumn()},afterRender:function(){this.callParent(arguments)},moveColumn:function(e){var t=this.getCmp("hideview").getCmp("view"),i=this.getCmp("showview").getCmp("view");if("showview-btn"==e.itemId){var a=t;t=i,i=a}var n=t.getSelectionModel().getSelection();if(JE.isNotEmpty(n)){var o=[];Ext.each(n,function(e){o.push(e.data)}),t.store.remove(n),i.store.add(o)}},buildList:function(e){var l=this;return{xtype:"panel",flex:1,border:0,layout:"fit",itemId:e.itemId,bodyStyle:"border-top-width: 0px;",items:{xtype:"boundlist",itemId:"view",style:"border-color:#ddd;border-top-width:0px;",cls:"je-tool-iditcolumnview",itemTargetSelector:"div.x-form-cb",deselectOnContainerClick:!1,store:e.store,simpleSelect:!0,emptyText:'<div style="color: #ccc;text-align:center;margin-top:40%;font-size: 13px;">暂无'+e.title+"</div>",getInnerTpl:function(e){return'<div class="x-form-checkbox x-form-cb item-icon"></div>{text}'},listeners:{selectionchange:function(e,t){var i=e.view.ownerCt,a=i.ownerCt.getCmp("buttons").getCmp(i.itemId+"-btn");JE.isEmpty(t)?(a.removeCls(a.enableCls),a.addCls(a.disableCls)):(a.removeCls(a.disableCls),a.addCls(a.enableCls))},afterrender:function(e){e.refresh()}}},dockedItems:[{xtype:"toolbar",dock:"top",items:[e.title,"->",{xtype:"yesnofield",boxLabel:"全选",viewItemId:e.itemId,listeners:{change:function(e,t,i){l.getCmp(e.viewItemId).getCmp("view").getSelectionModel()[t?"selectAll":"deselectAll"]()}}}]},{xtype:"uxtrigger",dock:"top",width:250,viewStore:e.store,enableKeyEvents:!0,clearButton:!1,emptyText:"Search...",handler:function(e){var i=e.getValue();e.viewStore.filterBy(function(e){var t=i.toLocaleLowerCase();return-1!=e.get("text").toLocaleLowerCase().indexOf(t)||-1!=e.get("pinyin").indexOf(t)})},listeners:{keyup:function(e,t){e.handler(e)}}}],listeners:{afterrender:function(e){var t=e.getCmp(0);"hideview"!=e.itemId?(t.addCls("enabledd"),e.dragZone=Ext.create("Ext.view.DragZone",{view:t,ddGroup:"ddCXCL",dragText:"拖动排序",onInitDrag:function(e,t){var i=this.dragData,a=i.view,n=(a.getSelectionModel(),a.getRecord(i.item));return i.records=[n],i.isSelected=a.selModel.isSelected(n),this.ddel.update(n.get("text")),this.proxy.update(this.ddel.dom),this.onStartDrag(e,t),!0}}),e.dropZone=Ext.create("Ext.view.DropZone",{view:t,ddGroup:"ddCXCL",handleNodeDrop:function(e,t,i){var a,n=this.view,o=n.getStore(),r=e.records;1!=l.sourceCopy&&e.view.store.remove(r),a=o.indexOf(t),"after"===i&&a++,0!=r.length&&(r=o.insert(a,r),e.isSelected&&n.getSelectionModel().select(r,!0))}})):delete t.itemTargetSelector}}}},doOK:function(){var e=this,t=e.grid.funcData.info,i={show:[],hide:[]};Ext.each(["show","hide"],function(t){e.getCmp(t+"view").getCmp("view").store.each(function(e){i[t].push(e.get("id"))})});var a={tableCode:"JE_CORE_USERINFO",USERINFO_CONFIG:Ext.encode(i),USERINFO_USERID:JE.USER.userId,USERINFO_USERCODE:JE.USER.userCode,USERINFO_FUNCCODE:t.funcCode,USERINFO_FUNCID:t.funcId,USERINFO_TABLECODE:t.tableNamae,USERINFO_TYPE:"COLUMN"},n="doSave";e.userData&&(a.JE_CORE_USERINFO_ID=e.userData.bean.JE_CORE_USERINFO_ID,n="doUpdate");var o=JE.ajax({url:JE.getUrlMaps("je.core",n),params:a});o.success?(JE.msg("列表设置成功！"),e.ownerCt.close(),e.refreshGridColumn()):JE.alert(o.obj)},refreshGridColumn:function(){var e,t=Ext.clone(this.grid.initialConfig),i=this.grid.ownerCt,a=this.grid.getDockedCmp("buttonBar").getCmp("changeDataView");a&&(e=a.initialConfig),i.remove(this.grid);var n=i.add(t);e&&n.getDockedCmp("buttonBar").insert(0,e)}}),Ext.define("JE.core.view.tool.SearchView",{extend:"Ext.form.Panel",alias:"widget.jetool.searchview",layout:"column",mixins:["JE.core.util.ViewUtil"],defaults:{columnWidth:1,margin:"5 0"},bodyPadding:20,border:0,itemHeight:44,initComponent:function(){var s=this,e=s.grid,d=e.funcData,c=Ext.create("JE.core.util.FuncUtil"),t=d["query"==e.type?"select":"grid"].quickQuery,u={},p=[];Ext.each(t,function(e){var t=e.name,i=e.text,a=d.basicFields[t];if(a){var n=c.field(a,"group",d);n.fieldLabel=i,n.columnOtherConfig=e.columnOtherConfig;var o=(n=s.getFormGQ(n,d.info)).items[0],r=n.items[1],l=n.items[2];o.margin="0 5 0 0",o.hideTrigger=!1,o.width=100,o.listeners.afterrender=function(e){var a=e.ownerCt.getCmp(1),n=e.ownerCt.getCmp(2);e.on("change",function(e,t,i){a.setAllowBlank(!1,!1),"between"==t?(n.setAllowBlank(!1,!1),"rangedatefield"==n.xtype&&a.setAllowBlank(!0,!1)):n.setAllowBlank(!0,!1)}),JE.defer(function(){if(a.getEl()&&n.getEl())return e.fireEvent("change",e,e.getValue(),""),!1},10)},r.flex=l.flex=1,r.hideLabel=l.hideLabel=!0,delete r.listeners,delete l.listenres,u[t]=[o,r,l],p.push({text:i,code:t})}}),s.fields=u,s.fieldsArray=p,s.items=[{xtype:"fieldcontainer",fieldLabel:"查询条件",allowBlank:!1,labelAlign:"top",layout:"column",itemId:"queryBox",defaults:{columnWidth:1}},{xtype:"box",html:'<span class="addquery" style="color: #3487e2;cursor: pointer;">+ 添加查询条件</span>',padding:"0 0 20 0",listeners:{afterrender:function(t){t.getEl().on("click",function(e){e.getTarget(".addquery")&&t.ownerCt.addQuery()})}}}],s.buttons=[{text:"cxcl"==s.type?"保存":"查询",cls:"btn JEPLUS_B_L10",handler:function(){s.doOKButton()}},{text:"清除",handler:function(){s.resetQuery(!0)}},{text:"取消",handler:function(){s.up("window").close()}}],s.buttonAlign="right","cxcl"==s.type?(s.items[1].style="border-bottom:1px solid #ddd;",s.items=[{xtype:"textfield",fieldLabel:"策略名称",labelAlign:"top",maxLength:"20",allowBlank:!1,itemId:"cxclBox"}].concat(s.items),s.items.push({xtype:"yesnofield",boxLabel:"设为默认",itemId:"setDef"})):s.enableCXCL&&(s.items[1].style="border-bottom:1px solid #ddd;",s.items.push({xtype:"container",layout:"hbox",itemId:"cxclBox",items:[{xtype:"yesnofield",boxLabel:"保存为查询策略",width:120,itemId:"saveAs",listeners:{change:function(e,t,i){e.ownerCt.getCmp("text").setVisible(t),s.getCmp("setDef").setVisible(t)}}},{xtype:"textfield",emptyText:"请输入策略名称，最多10个字符",width:300,itemId:"text",hidden:!0},{xtype:"box",columnWidth:1}]},{xtype:"yesnofield",boxLabel:"设为默认",itemId:"setDef",hidden:!0})),s.callParent(arguments)},afterRender:function(){var e=this;e.callParent(arguments),e.record?setTimeout(function(){e.initCxclFields()}):e.addQuery()},initCxclFields:function(){var i=this,e=i.record,t=Ext.decode(e.get("QUERYSTRATEGY_SQL"),!0);Ext.each(t,function(e){var t=i.addQuery();t.getCmp("queryField").setValue(e.code),t.getCmp("queryItems").getCmp(0).setValue(e.type),t.getCmp("queryItems").getCmp(1).setValue(e.value),t.getCmp("queryItems").getCmp(2).setValue(e._value)}),i.getCmp("cxclBox").setValue(e.get("QUERYSTRATEGY_NAME")),i.getCmp("setDef").setValue(e.get("QUERYSTRATEGY_DEF"))},resetQuery:function(e){var t=this.ownerCt;e&&JE.Action.doGroupQuery(this.grid,[],"window"),this.form.reset(),this.getCmp("queryBox").removeAll(),t.setHeight(t.initialConfig.height),this.addQuery(),JE.Action.setGroupMark(this.grid,!1)},addQuery:function(){var n=this,e=n.fieldsArray[0].code,t={xtype:"container",layout:"hbox",type:"queryItem",margin:"0 0 10 0",items:[{xtype:"cbbfield",dataArray:n.fieldsArray,itemId:"queryField",width:150,value:e,margin:"0 5 0 0",listeners:{change:function(e,t,i){var a=e.ownerCt.getCmp("queryItems");a.removeAll(),a.add(n.fields[t])}}},{xtype:"container",layout:"hbox",flex:1,itemId:"queryItems",items:n.fields[e]},{xtype:"button",iconCls:"fa fa-remove",cls:"btn btn-form",margin:"0 0 0 5",width:40,itemId:"removeBtn",handler:function(e){n.removeQuery(e.ownerCt)}}]};return t=n.getCmp("queryBox").add(t),n.changeRemoveBtn(),n.changeWin("add"),t},removeQuery:function(e){this.getCmp("queryBox").remove(e),this.changeRemoveBtn(),this.changeWin("remove")},getQueryInfo:function(){var e=this,t=e.getCmp("queryBox");if(!e.form.isValid())return!1;var s=!1,d=[],c=[];if(t.items.each(function(e){var t=e.getCmp("queryField").getValue();if(-1!=c.indexOf(t))return!(s=!0);c.push(t);var i=e.getCmp("queryItems"),a=i.getCmp(0).getValue(),n=i.getCmp(1).getValue(),o="",r=i.getCmp(2),l=r.getValue();"between"==a&&("rangedatefield"==r.xtype?(n=r.getRangeValue(),o=r.getValue()):Ext.isEmpty(n)&&Ext.isEmpty(l)||(n=[n,l])),(JE.isNotEmpty(n)||JE.isNotEmpty(o))&&d.push({code:t,type:a,value:n,_value:o})}),JE.isEmpty(d))return JE.alert("查询条件的值不能为空,请您填写!"),!1;if(s)return JE.alert("查询条件中有重复值！"),!1;var i=e.getCmp("cxclBox"),a="",n="";if("cxcl"==e.type){if(a=i.getValue(),n=e.getCmp("setDef").getValue(),JE.isEmpty(e.editType)||!e.editType){var o=!1;if(e.menuView.store.each(function(e){if(e.get("QUERYSTRATEGY_NAME")==a)return!(o=!0)}),o)return JE.alert("策略的名称已存在，请修改！"),!1}}else if(e.enableCXCL){if(i.getCmp("saveAs").getValue()){if(a=i.getCmp("text").getValue(),n=e.getCmp("setDef").getValue(),JE.isEmpty(a))return JE.alert("请输入策略名称！"),!1;i.getCmp("text").reset(),e.getCmp("setDef").reset(),i.getCmp("saveAs").reset()}}return{fields:d,text:a,setDef:n}},doOKButton:function(){0!=("search"==this.type?this.doSearchGrid():this.doSaveCxcl())&&(this.callback&&this.callback(info),this.up("window").close())},doSaveCxcl:function(){this.grid;var e=this.getQueryInfo();return!!e&&(JE.isNotEmpty(e.text)&&this.saveAsCxcl(e),e)},doSearchGrid:function(){var e=this.grid,t=this.getQueryInfo();return!!t&&(JE.isNotEmpty(t.text)&&this.saveAsCxcl(t),JE.Action.doGroupQuery(e,t.fields,"window"),JE.Action.setGroupMark(e,JE.isNotEmpty(t.fields)),t)},saveAsCxcl:function(e,t){var i=this,a=i.grid.funcData.info.funcCode,n=e.fields,o=e.text,r=e.setDef;if(!JE.isEmpty(o)){var l={QUERYSTRATEGY_NAME:o,QUERYSTRATEGY_SQL:Ext.encode(n),QUERYSTRATEGY_DEF:r,QUERYSTRATEGY_USERID:JE.currentUser.userId,QUERYSTRATEGY_FUNCCODE:a,tableCode:"JE_CORE_QUERYSTRATEGY"},s="doSave";i.record&&(l.JE_CORE_QUERYSTRATEGY_ID=i.record.get("JE_CORE_QUERYSTRATEGY_ID"),s="doUpdate"),JE.ajax({url:JE.getUrlMaps("je.core",s),params:l,async:!0,success:function(e){if(data=JE.getAjaxData(e),data.success){JE.msg("策略"+("doSave"==s?"添加":"修改")+"成功！");var t=data.obj;if(i.record&&i.record.set(t),i.menuView)if(i.record)i.menuView.store.getById(i.record.get("JE_CORE_QUERYSTRATEGY_ID")).set(t);else i.menuView.store.add(t)}else JE.alert(data.obj)}})}},changeRemoveBtn:function(){var e=this.getCmp("queryBox").items;e.getAt(0).getCmp("removeBtn").setVisible(1<e.getCount())},changeWin:function(e){var t="add"==e?this.itemHeight:-this.itemHeight,i=this.ownerCt;i&&(i.setHeight(i.getHeight()+t),i.center())}}),Ext.define("JE.core.view.tool.SMSView",{extend:"Ext.panel.Panel",alias:"widget.jesmsview",layout:"column",_phone:"SMS_PHONE",_name:"SMS_NAME",configInfo:"JE_CORE_QUERYUSER,SMS_NAME~SMS_PHONE,USERNAME~PHONE,M",valid:!0,tplCode:void 0,params:void 0,initComponent:function(){var d=this,e=Ext.value(d.configInfo,"").split(","),t=Ext.value(e[1],"").split("~"),i=Ext.value(e[2],"").split("~");if(d.funcCode=e[0],d.configData={},fields=[],Ext.each(t,function(e,t){d.configData[e]=i[t],fields.push(e)}),d.defaults={border:0,columnWidth:1,margin:"0 10",layout:"column",xtype:"panel",border:0,columnWidth:.5,bodyStyle:"border-width:0px",defaults:{columnWidth:1}},d.items=[{itemId:"sms",items:[{xtype:"box",itemId:"smsCount",style:"font-size:13px;padding:10px 0px;",data:{count:0,sms:1},tpl:'<span style="font-weight:bold;">短信内容：</span>已经输入<span style="color:red;">{count}</span>字，将分为<span style="color:red;">{sms}</span>条短信发出，最多<span style="color:red;">440</span>字'},{xtype:"textarea",itemId:"smsField",margin:"0",height:200,value:Ext.value(d.smsBody,""),listeners:{change:function(e,t){var i=t.length,a=Math.ceil(t.length/70);d.smsCount.update({count:i,sms:a})}}},{xtype:"toolbar",border:0,ui:"footer",margin:0,style:"background-color:#ffffff;",itemId:"smsBar",items:[{xtype:"box",itemId:"smsBox",data:{text:"短信内容合法",color:"#239F75"},tpl:'<span style="color:{color};">{text}</span>'},"->",{xtype:"button",text:"合法性验证",cls:"btn JEPLUS_B_L10",itemId:"checkSms",handler:function(e){var t=d.smsField.getValue(),i={color:"#239F75",text:"短信内容合法"};if(JE.isNotEmpty(t)){var a=JE.ajax({url:JE.getUrlMaps("je.core.message.message","checkNoteMsg"),params:{context:t}});d.valid=a.success,a.success?JE.msg("验证成功！"):i={color:"red",text:"敏感词语："+a.obj}}else d.valid=!0;e.ownerCt.getCmp("smsBox").update(i)}},{xtype:"button",text:"从短信库中选择",cls:"btn JEPLUS_B_C03",handler:function(){JE.selectWin({title:"短信库",configInfo:"JE_SYS_NOTEBASE,,,S",callback:function(e){var t=e[0];if(t){var i=t.get("NOTEBASE_NR");i=JE.toXT(i,d.params),d.smsField.setValue(i)}}})}}]}]},{itemId:"phone",items:[{xtype:"box",style:"font-size:13px;padding:10px 0px;",data:{count:0},itemId:"phoneCount",tpl:'<span style="font-weight:bold;">接收人：</span>已经录入<span style="color:red;">{count}</span>个手机号'},{xtype:"multiitem",itemId:"phoneField",fields:fields,displayField:d._name,idProperty:d._phone,height:200,regex:/^1(3|4|5|7|8)\d{9}$/,regexText:"请输入正确的手机号",displayTpl:"<b>{"+d._name+"}</b>",listeners:{afterrender:function(e){function t(e){d.phoneCount.update({count:e.getCount()})}e.itemsview.store.on({load:t,add:t,remove:t})}}},{xtype:"toolbar",itemId:"phoneBar",border:0,style:"background-color:#ffffff;",ui:"footer",margin:"3 0 0 0",items:["->",{xtype:"button",text:"清空",cls:"btn JEPLUS_B_L10",handler:function(){d.phoneField.reset(),d.phoneCount.update({count:0})}},{xtype:"button",cls:"btn JEPLUS_B_C03",text:"选择",handler:function(){JE.selectWin({title:"联系方式",configInfo:d.configInfo,multiSelect:!0,callback:function(e){var n=[],o=[];Ext.each(e,function(i){var a={};Ext.iterate(d.configData,function(e,t){a[e]=i.get(t)});var e=a[d._phone],t=a[d._name];JE.isEmpty(e)||!/^1(3|4|5|7|8)\d{9}$/.test(e)?o.push(t+"："+e):n.push(a)}),d.phoneField.addData(n),JE.isNotEmpty(o)&&(o.unshift("以下电话有误："),JE.alert(o.join("<br/>")))}})}},{xtype:"yesnofield",boxLabel:"全体",itemId:"alluser"}]}]},{xtype:"box",columnWidth:1,style:"padding: 10px 5px;font-size: 13px;line-height: 25px;color: #ABABAB;",html:['<span style="color:#000000;">网上短信使用协议</span>','<span style="color:blue;">1：所有短信须带上全会带上公司签名。</span>','<span style="color:red;">2：受政策管制，近期群发短信受到大面积的影响，发送前请务必慎重。</span>',"3：不发送任何非法的、骚扰性、中伤他人的、辱骂性的、恐吓性的、伤害性的、挑衅的、庸俗的、淫秽等内容的短信消息。 ","4：不发送任何教唆他人构成犯罪行为的短信消息。 ","5：不发送任何涉及国家安全和国家机密的短信消息。","6：如违反以上规定各项，本公司将保留配合公安部门追查信息来源的权利。",'<span style="color:#000000;">注：短信模板可取变量：SMS_PHONE(手机号),SMS_NAME(姓名),如果取其他变量，可复写configInfo，自定义变量名。如：JE_CORE_QUERYUSER,SMS_NAME~SMS_PHONE~自定义变量,USERNAME~PHONE~字段名,M</span>'].join("<br/>")},{xtype:"yesnofield",columnWidth:1,boxLabel:'<span style="font-weight:bold;">我同意网上短信协议</span>',margin:"0 13",listeners:{change:function(e,t){d.getDockedCmp(0).getCmp("sendSMSBtn").setDisabled(!t)}}}],d.buttons=[{text:"立即发送短信",cls:"btn JEPLUS_B_L10",disabled:!0,itemId:"sendSMSBtn",width:110,handler:function(){var t=d.smsField.getValue(),i=d.phoneField.getData(),e=d.alluser.getValue(),a=d.getCmp("sms").getCmp("smsBar").getCmp("checkSms");if(JE.isEmpty(t))JE.alert("请填写短信内容！");else if(a.handler(a),d.valid)if(JE.isEmpty(i)&&"1"!=e)JE.alert("请输入手机号！");else if(d.valid=!0,e){var n=JE.getFuncData(d.funcCode).info,o=Ext.value(n.treeFuncSql,""),r=Ext.value(n.orderSql,""),l=Ext.value(n.whereSql,"")+o,s=JE.ajax({url:Ext.value(n.funcAction,JE.getUrlMaps("je.core.load")),params:{tableCode:n.viewTableName,whereSql:l,orderSql:r,limit:-1}}).rows;Ext.each(s,function(i){var a={};Ext.iterate(d.configData,function(e,t){a[e]=i[t]}),d.sendSMS(a,t,s.length)})}else Ext.each(i,function(e){d.sendSMS(e,t,i.length)});else JE.alert("短信中有敏感词汇，请进行修改！")}},{text:"取消",cls:"btn",width:110,handler:function(){d.ownerCt.close()}}],d.buttonAlign="center",d.callParent(arguments),d.phoneField=d.getCmp("phone").getCmp("phoneField"),d.phoneCount=d.getCmp("phone").getCmp("phoneCount"),d.phoneBar=d.getCmp("phone").getCmp("phoneBar"),d.alluser=d.phoneBar.getCmp("alluser"),d.smsField=d.getCmp("sms").getCmp("smsField"),d.smsCount=d.getCmp("sms").getCmp("smsCount"),d.tplCode){var a=JE.ajax({url:"/je/dynaActon!load.action",params:{tableCode:"JE_SYS_NOTEBASE",limit:1,whereSql:" AND NOTEBASE_CODE = '"+d.tplCode+"'"}});if(JE.isNotEmpty(a.rows)){var n=a.rows[0].NOTEBASE_NR;n=JE.toXT(n,d.params),d.smsField.setValue(n)}}},sendSMS:function(e,t,i){var a={toUser:e[this._name],phoneNumber:e[this._phone],context:JE.toXT(t,e)},n="";if(JE.isEmpty(a.phoneNumber))n="手机号为空！";else if(JE.isEmpty(a.context))n="短信内容为空！";else{var o=JE.ajax({url:JE.getUrlMaps("je.core.message.message","sendNoteMsg"),params:a});o.success||(n=o.obj)}this.showSendSMSWin(e,i,n)},showSendSMSWin:function(e,t,i){var a=this;a.smsWin||(a.smsWin=Ext.create("Ext.window.Window",{modal:!0,autoScroll:!0,title:"短信发送中...",width:500,height:300,layout:"column",defaults:{columnWidth:1},bodyPadding:20,items:[{xtype:"barfield",itemId:"count",configInfo:",1-99~blue,99-100~green",hideTrigger:!0},{xtype:"box",itemId:"infoBox",style:"text-align:center;margin:10px 0px;",tpl:' <span style="color:red;">{name}</span> 发送成功！({count}/{totalCount})'},{xtype:"box",itemId:"errorBox"}],buttonAlign:"center",buttons:[{text:"关闭",cls:"btn",width:110,handler:function(e){e.up("window").close(),a.ownerCt.close()}}]})),a.smsWin.isHidden()&&a.smsWin.show(),a.sendSMSCount=a.sendSMSCount||0,a.sendSMSCount++,a.smsWin.getCmp("count").setValue(parseInt(a.sendSMSCount/t*100)),a.smsWin.getCmp("infoBox").update({name:e[a._name],count:a.sendSMSCount,totalCount:t}),JE.isNotEmpty(i)&&(a.smsWin.getCmp("errorBox").getEl().dom.innerHTML+='<span style="color:red;">'+e[a._name]+'</span> 发送失败：<span style="color:red;">'+i+"</span><br/>");a.sendSMSCount==t&&(a.sendSMSCount=0,a.smsWin.setTitle("发送完毕！"),a.callback&&a.callback(),delete a.smsWin)},afterRender:function(){this.callParent(arguments),JE.isNotEmpty(this.phone)&&(this.phoneField.setValue(this.phone),this.phoneCount.update({count:this.phoneField.itemsview.store.getCount()}),this.phoneField.setReadOnly(!0),this.phoneBar.hide())}}),Ext.define("JE.core.view.tool.TPInfoView",{extend:"Ext.form.Panel",alias:"widget.jetpinfoview",layout:"column",autoScroll:!0,cls:"je-tool-jetpview",initComponent:function(){var t=this;t.bodyPadding=10,t.defaults={columnWidth:1,labelAlign:"right",labelWidth:80,margin:"2 0"},t.items=[{xtype:"box",itemId:"infoBox",tpl:['<div style="text-align:center;font-size:20px;padding-bottom:10px;">{TASK_BT}</div>','<div style="padding-left:28px;line-height:25px;">',"<div>&nbsp;&nbsp;&nbsp;发布人: ",'<tpl if="JOB_RWFQR">',"{JOB_RWFQR}","<tpl else>","{SY_CREATEUSERNAME}","</tpl>","</div>",'<div>任务方式: <i style="font-size:12px;margin-right:5px;" class="fa <tpl if="TASK_TASKFS_CODE==\'once\'">fa-italic<tpl else>fa-refresh</tpl>"></i>{TASK_TASKFS_NAME}， {info}</div>',"<div>任务内容: {TASK_RWNR}</div>",'<tpl if="TASK_RWZD"><div>任务指导: {TASK_RWZD}</div></tpl>',"</div>"]},{xtype:"jsonarrayfield",fieldLabel:"执行人",height:150,actionColumn:!1,editable:!1,hidden:!0,itemId:"users",columns:[{xtype:"rownumberer",text:"No."},{dataIndex:"SY_CREATEORGNAME",text:"部门",width:150},{dataIndex:"SY_CREATEUSERNAME",text:"执行人",width:150},{dataIndex:"JOBMX_LQSJ",text:"领取任务时间",flex:1},{dataIndex:"JOBMX_WCSJ",text:"完成任务时间",flex:1}]},{xtype:"uxfilesfield",fieldLabel:"相关附件",name:"TASK_XGFJ",readOnly:!0,height:150}],t.buttonAlign="center",t.buttons={itemId:"buttons",items:[{text:"领取任务",width:100,cls:"btn JEPLUS_B_C03",itemId:"lqrw",hidden:!0,handler:function(e){t.rw("receiveTask","JOBMX_SFLQRW","领取"),e.hide(),e.ownerCt.getCmp("wcrw").show()}},{text:"完成任务",width:100,itemId:"wcrw",cls:"btn JEPLUS_B_C01",hidden:!0,handler:function(e){t.rw("finishTask","JOBMX_SFWCRW","完成"),e.hide()}},{text:"批注",width:100,itemId:"pz",cls:"btn JEPLUS_B_L10",handler:function(){t.pz()}},{text:"关闭",width:100,cls:"btn",handler:function(){t.ownerCt.close()}}]},t.callParent(arguments)},afterRender:function(){var e=this;e.callParent(arguments),e.initData=e.record?e.record.data:e.initData;var t=e.initData;if(t.info=JE.toXT('从 {[values.TASK_RWKSSJ.substring(0,13)]}点 开始<tpl if="TASK_YQWCSJ">，到 {[values.TASK_YQWCSJ.substring(0,13)]}点 截止</tpl>',t),e.getCmp("infoBox").update(t),e.getDockedCmp("buttons").getCmp("pz").setText("批注("+(t.SY__POSTIL||0)+")"),e.form.setValues(t),-1!=["send","sendchild"].indexOf(e.viewType)){var i=JE.ajax({url:JE.getUrlMaps("je.core.load"),params:{whereSql:"sendchild"==e.viewType?"AND JE_SYS_JOB_ID = '"+t.JE_SYS_JOB_ID+"'":"AND JE_SYS_TASK_ID = '"+t.JE_SYS_TASK_ID+"'",orderSql:"order by SY_CREATETIME",tableCode:"JE_SYS_JOB_V",limit:-1}}).rows;e.getCmp("users").show(),e.getCmp("users").setValue(i)}else{var a=e.getDockedCmp("buttons");"1"!=t.JOBMX_SFLQRW?a.getCmp("lqrw").show():"1"!=t.JOBMX_SFWCRW&&a.getCmp("wcrw").show()}},rw:function(e,t,i){var a=this,n={};Ext.each(["JE_SYS_JOB_ID","JOB_RWFQRID","TASK_TASKFS_CODE","JE_SYS_TASK_ID"],function(e){n[e]=a.initData[e]}),JE.ajax({url:JE.getUrlMaps("je.core.job",e),params:n}).success&&(JE.msg(i+"任务成功！"),a.record&&a.record.set(t,"1"),a.callback&&a.callback())},pz:function(){var i=this,e=i.initData.JE_SYS_JOB_ID,t=i.initData.JE_SYS_TASK_ID,a={};if("send"==i.viewType){var n=JE.ajax({url:JE.getUrlMaps("je.core.selectOne"),params:{tableCode:"JE_SYS_JOB",whereSql:" AND JE_SYS_TASK_ID = '"+t+"'"}});if(!n.success)return void JE.alert(n.obj);a=n.obj}else a=JE.ajax({url:JE.getUrlMaps("je.core.getInfoById"),params:{tableCode:"JE_SYS_JOB",pkValue:e}});JE.CoreUtil.showPostil({funcCode:"JE_SYS_TASK",pkValue:a.JE_SYS_TASK_ID,userId:a.SY_CREATEUSERID,userName:a.SY_CREATEUSERNAME,callback:function(e){if(i.record&&i.record.set("SY__POSTIL",e),i.getDockedCmp("buttons").getCmp("pz").setText("批注("+e+")"),"once"==a.TASK_TASKFS_CODE){var t={tableCode:"JE_SYS_TASK",JE_SYS_TASK_ID:a.JE_SYS_TASK_ID,SY__POSTIL:e};JE.ajax({url:JE.getUrlMaps("je.core.update"),params:t,async:!0})}}})}}),Ext.define("JE.core.view.tool.TPView",{extend:"Ext.form.Panel",alias:"widget.jetpview",layout:"column",autoScroll:!0,cls:"je-tool-jetpview",border:0,initComponent:function(){var n=this;n.bodyPadding=10;for(var e=[],t=1;t<32;t++)e.push({text:t+"日",code:t+""});n.defaults={columnWidth:1,labelAlign:"right",labelWidth:80,margin:"2 0"};var i=JE.isEmpty(n.beans),a="",o="";if(n.beans){var r=[],l=[];Ext.each(n.beans,function(e){r.push(e.text),l.push(e.id)}),a=l.join(","),o=r.join(",")}n.items=[{xtype:"textarea",fieldLabel:"业务数据",readOnly:!0,name:"TASK_YWSJNAMEJH",value:o,hidden:i,disabled:i},{xtype:"hidden",name:"TASK_YWSJIDJH",value:a,disabled:i},{xtype:"hidden",name:"TASK_YWFL",value:n.type||""},{xtype:"rgroup",fieldLabel:"发送方式",name:"TASK_FSFS_CODE",value:"once",hidden:i,disabled:i,configInfo:"JE_SYS_FSFS,TASK_FSFS_NAME,text,S"},{xtype:"hidden",name:"TASK_FSFS_NAME",value:"统一发送",disabled:i},{xtype:"textfield",fieldLabel:"标题",value:n.titleText||"",allowBlank:!1,name:"TASK_BT",columnWidth:.7},{xtype:"rgroup",fieldLabel:"任务方式",name:"TASK_TASKFS_CODE",value:"once",hidden:!0,configInfo:"JE_SYS_TASKFS,TASK_TASKFS_NAME,text,S",listeners:{change:function(e,t,i){var a="once"==t;Ext.each(["TASK_XHSXRQ","TASK_SF","TASK_XHSXRQ","TASK_RWKSSJ","TASK_RWKSSJ2"],function(e){n.form.findField(e).setDisabled("TASK_RWKSSJ"==e?!a:a)}),Ext.each(["once","repeat"],function(e){n.getCmp(e).setVisible(t==e)})}}},{xtype:"hidden",name:"TASK_TASKFS_NAME",value:"单次任务"},{xtype:"container",itemId:"once",layout:"hbox",defaults:{labelAlign:"right",clearButton:!1,labelWidth:80},items:[{fieldLabel:"执行时间",xtype:"datetimefield",width:240,margin:0,clearButton:!0,allowBlank:!1,itemId:"kssj",format:"Y-m-d H点",name:"TASK_RWKSSJ"},{fieldLabel:"要求完成时间",xtype:"datetimefield",labelWidth:90,clearButton:!0,format:"Y-m-d H点",itemId:"yqwcsj",width:240,margin:0,name:"TASK_YQWCSJ"}]},{xtype:"container",layout:"column",itemId:"repeat",hidden:!0,defaults:{labelWidth:80,labelAlign:"right",columnWidth:1},items:[{xtype:"container",layout:"hbox",defaults:{labelAlign:"right",labelWidth:80},itemId:"timeBox",items:[{fieldLabel:"执行日期",xtype:"datetimefield",dateType:"date",format:"Y-m-d",submitFormat:"Y-m-d H:i:s",width:240,margin:0,name:"TASK_RWKSSJ2",disabled:!0,allowBlank:!1,itemId:"kssj"},{fieldLabel:"限期",xtype:"numberfield",dateType:"date",width:200,clearButton:!1,minValue:1,value:1,name:"TASK_YQJTHWC",unitTpl:"天完成"}]},{fieldLabel:"重复方式",xtype:"fieldcontainer",layout:"hbox",margin:"4 0 0 0",defaults:{labelWidth:80,labelAlign:"right",clearButton:!1,columnWidth:.5},items:[{xtype:"cbbfield",width:80,value:"day",name:"TASK_CFFS_CODE",configInfo:"JE_SYS_CFFS,TASK_CFFS_NAME,text,S",listeners:{change:function(e,t,i){var a=[e.ownerCt.getCmp("year"),e.ownerCt.getCmp("day"),e.ownerCt.ownerCt.getCmp("week"),e.ownerCt.ownerCt.getCmp("month")];Ext.each(a,function(e){e.setVisible(t==e.itemId),-1!=["week","month"].indexOf(e.itemId)?(e.setAllowBlank(t!=e.itemId),e.setDisabled(t!=e.itemId)):"year"==e.itemId&&e.getCmp("day").setDisabled("year"!=t)})}}},{xtype:"hidden",name:"TASK_CFFS_NAME",value:"间隔"},{xtype:"container",layout:"hbox",itemId:"year",hidden:!0,defaults:{xtype:"numberfield",clearButton:!1,width:80,margin:"0 2"},items:[{maxValue:12,minValue:1,unitTpl:"月",value:1,name:"TASK_Y_CODE",itemId:"month"},{maxValue:31,minValue:1,itemId:"day",value:1,name:"TASK_RY_CODE",unitTpl:"日"}]},{xtype:"numberfield",clearButton:!1,width:120,margin:"0 2",minValue:1,value:1,unitTpl:"天执行一次",name:"TASK_JGTS",itemId:"day"},{fieldLabel:"执行时间",xtype:"numberfield",disabled:!0,allowBlank:!1,clearButton:!1,width:160,maxValue:23,minValue:0,unitTpl:"点",name:"TASK_SF"}]},{xtype:"cgroup",hidden:!0,itemId:"week",margin:"4 0 0 0",dataArray:[{text:"周一",code:"1"},{text:"周二",code:"2"},{text:"周三",code:"3"},{text:"周四",code:"4"},{text:"周五",code:"5"},{text:"周六",code:"6"},{text:"周日",code:"7"}],name:"TASK_WEEK_CODE",configInfo:",TASK_WEEK_NAME,text,",fieldBodyStyle:"padding-left:80px;"},{xtype:"hidden",name:"TASK_WEEK_NAME"},{xtype:"cgroup",itemId:"month",hidden:!0,margin:"4 0 0 0",dataArray:e,name:"TASK_RY_CODE",disabled:!0,fieldBodyStyle:"padding-left:80px;",configInfo:",TASK_RY_NAME,text,",columns:10},{xtype:"hidden",name:"TASK_RY_NAME"},{fieldLabel:"有效期",xtype:"fieldcontainer",layout:"hbox",margin:"4 0 0 0",allowBlank:!1,items:[{xtype:"datetimefield",width:620,allowBlank:!1,disabled:!0,dateType:"date",name:"TASK_XHSXRQ",unitTpl:"设定本次循环任务的有效期，任务从开始日期起有效期内有效，过期即停止"}]}]},{xtype:"cgroup",fieldLabel:"提醒方式",checkAll:!1,value:"04",configInfo:"CRM_TXFS",name:"TASK_TXFS_CODE",dicItemCodes:"01,04"},{xtype:"hidden",name:"TASK_TXFS_NAME",value:"内部提醒"},{xtype:"textarea",fieldLabel:"任务内容",name:"TASK_RWNR",allowBlank:!1},{xtype:"textarea",fieldLabel:"任务指导",name:"TASK_RWZD"},{xtype:"vueuserareafield",allowBlank:!1,fieldLabel:"执行人",name:"TASK_ZPRNAME",height:80,configInfo:"JE_CORE_QUERYUSER,TASK_ZPRNAME~TASK_ZPRID,text~id,M"},{xtype:"hidden",name:"TASK_ZPRID"},{xtype:"uxfilesfield",fieldLabel:"相关附件",name:"TASK_XGFJ",height:150},{xtype:"hidden",name:"JE_SYS_TASK_ID"}],n.buttonAlign="center",n.buttons={itemId:"buttons",items:[{text:"edit"==n.type?"重新发布":"发布任务",width:100,cls:"btn JEPLUS_B_L10",itemId:"send",handler:function(){n.send()}},{text:"再次发布",width:100,cls:"btn JEPLUS_B_C01",itemId:"again",hidden:!0,handler:function(){n.send(!0)}},{text:"取消",width:100,cls:"btn",handler:function(){n.ownerCt.close()}}]},n.callParent(arguments)},getData:function(){if(this.form.isValid()){var t=this.form.getValues(),e=[];if("once"==t.TASK_TASKFS_CODE){if(e=["TASK_YQJTHWC","TASK_RWKSSJ2","TASK_CFFS_CODE","TASK_CFFS_NAME","TASK_Y_CODE","TASK_JGTS","TASK_SF","TASK_WEEK_CODE","TASK_WEEK_NAME","TASK_RY_CODE","TASK_RY_NAME","TASK_XHSXRQ"],t.TASK_RWKSSJ=t.TASK_RWKSSJ.substring(0,13)+":00:00",JE.isNotEmpty(t.TASK_YQWCSJ)){t.TASK_YQWCSJ=t.TASK_YQWCSJ.substring(0,13)+":00:00";var i=Ext.Date.parse(t.TASK_RWKSSJ,"Y-m-d H:i:s"),a=Ext.Date.parse(t.TASK_YQWCSJ,"Y-m-d H:i:s");if(i.getTime()>a.getTime())return void JE.alert("要求完成时间必须大于执行时间！")}}else{e=["TASK_YQWCSJ","TASK_RWKSSJ2"];var n=t.TASK_CFFS_CODE;"day"==n?e.push("TASK_WEEK_NAME","TASK_WEEK_CODE","TASK_RY_CODE","TASK_RY_NAME","TASK_Y_CODE"):"week"==n?e.push("TASK_Y_CODE","TASK_RY_CODE","TASK_RY_NAME","TASK_JGTS"):"month"==n?e.push("TASK_Y_CODE","TASK_WEEK_NAME","TASK_WEEK_CODE","TASK_JGTS"):"year"==n&&(e.push("TASK_WEEK_NAME","TASK_WEEK_NAME","TASK_JGTS"),t.TASK_Y_NAME=t.TASK_Y_CODE+"月",t.TASK_RY_NAME=t.TASK_RY_CODE+"日"),t.TASK_RWKSSJ=t.TASK_RWKSSJ2.substring(0,10)+" 00:00:00";i=Ext.Date.parse(t.TASK_RWKSSJ,"Y-m-d H:i:s"),a=Ext.Date.parse(t.TASK_XHSXRQ,"Y-m-d");if(i.getTime()>a.getTime())return void JE.alert("有效期必须大于执行日期！")}return Ext.each(e,function(e){delete t[e]}),t}},initData:function(){},send:function(e){var t=this.getData();if(t){"edit"==this.type&&e&&delete t.JE_SYS_TASK_ID;var i=JE.ajax({url:JE.getUrlMaps("je.core.job","addJobDesign"),params:t});i.success?(JE.msg("发布成功！"),this.ownerCt.close(),this.callback&&this.callback(i.obj)):JE.alert(i.obj)}}}),Ext.define("JE.core.view.TreeGridView",{extend:"JE.core.view.TreeView",alias:"widget.jetreegridview",type:"func",multiSelect:!1,searchBar:!1,columnLines:!0,treeTip:!1,autoload:!1,rowLines:!0,cls:"je-grid",initComponent:function(){var e=this,t=e.funcData,i=e.funcData.info;e.addEvents("beforeload"),e.autoload=!i.childFunc,e.animate=!1,e.enableAnimations=!1,e.animCollapse=!1,e.expandRootChild=!1,e.async="TRUE"==i.funcDicConfig.async,e.whereSql=i.whereSql,e.params={tableCode:i.tableName,orderSql:i.orderSql,limit:-1,moreRoot:"TRUE"==i.funcDicConfig.moreRoot},e.url=Ext.value(t.info.funcAction,JE.getUrlMaps("je.core"))+JE.getUrlMaps("method.loadGridTree");var a=i.funcDicConfig.text;e.columns=e.buildTreeColumn(Ext.clone(t.grid.columns),a),e.viewConfig={stripeRows:!0};var n=e.getTreeTbar(e).items[0];n=Ext.apply(n,{inputAttrTpl:"",fieldLabel:"查询",labelAlign:"right",labelWidth:40,width:200,cls:""}),e.tbar={xtype:"toolbar",itemId:"buttonBar",cls:"je-grid-btnbar je-button-bar",items:[n,{xtype:"button",text:"刷新",iconCls:"jeicon jeicon-refresh",fontIconCls:"fa fa-refresh",cls:"JEPLUS_B_C01",handler:function(){e.doLoad()}},{xtype:"button",text:"展开",iconCls:"jeicon jeicon-arrow-down",fontIconCls:"fa fa-chevron-down",cls:"JEPLUS_B_L10",handler:function(){e.expandAllByScroll()}},{xtype:"button",text:"收起",iconCls:"jeicon jeicon-arrow-up",cls:"JEPLUS_B_C03",fontIconCls:"fa fa-chevron-up",handler:function(){e.collapseAllByScroll()}}]},Ext.each(e.tbar.items,function(e){"button"==e.xtype&&(e.iconCls=JE.getIconCls(e))}),e.configButtons&&e.tbar.items.push("->",e.configButtons),e.store=Ext.create("Ext.data.TreeStore",{treeObj:e,model:JE.getModel({tableName:i.tableName,doTree:!0,excludes:"checked"}),root:{id:"ROOT",expanded:!0,children:[]}}),e.plugins=Ext.value(e.plugins,[]),e.plugins.push(Ext.create("Ext.grid.plugin.CellEditing",{clicksToEdit:1,pluginId:"cellEdit"})),e.callParent(arguments)},buildTreeColumn:function(e,t){var i=this;return Ext.each(e,function(e){e.dataIndex==t&&(e.xtype="treecolumn",delete e.renderer),i.buildTreeColumn(e.columns,t)}),e},doLoad:function(e){var a=this,n=a.funcData.info;JE.doMask(a,"加载中...",function(){var e=Ext.getCmp(n.funcCode+"_jetreeview"+n.idSuffix);e&&(a.parentSql=e.parentSql);var t={},i=i||{};t.whereSql=i.whereSql||"",a.load({params:t})})},afterRender:function(){var a=this;a.callParent(arguments),a.view.getEl().on("scroll",function(e,t){if(a.enableScrollExpand){var i=a.getRootNode().getChildAt(a.expandNodeIndex);i&&(nodeDom=a.view.getNode(i),nodeDom.offsetTop<t.clientHeight+t.scrollTop&&(i.expand(!0),a.expandNodeIndex++))}})},expandAllByScroll:function(){var a=this,n=a.getRootNode();a.enableScrollExpand=!0,a.expandNodeIndex=0,n.eachChild(function(e){e.expand(!0),a.expandNodeIndex++;var t=n.getChildAt(a.expandNodeIndex);if(t){var i=a.view.getEl().dom;if(a.view.getNode(t).offsetTop>i.clientHeight+i.scrollTop)return!1}})},collapseAllByScroll:function(){this.collapseAll(),this.enableScrollExpand=!1,this.expandNodeIndex=0}}),Ext.define("JE.core.view.UxView",{extend:"Ext.panel.Panel",layout:"border",alias:"widget.jeuxview",border:0,initComponent:function(){var i=this,e=i.getUx(),t={xtype:"treepanel",rootVisible:!1,region:"west",width:150,root:{id:"ROOT",text:"ROOT",expanded:!0,children:e},listeners:{selectionchange:function(e,t){t&&i.down("panel[ref=uxPanel]").getLayout().setActiveItem(t[0].get("id"))}}},n=[];Ext.each(e,function(e){if(e.uxItems){var a=[];Ext.each(e.uxItems,function(e){var t=Ext.clone(e);delete t.fieldLabel;var i=Ext.encode(t);a.push({xtype:"box",html:i})}),e.uxItems=e.uxItems.concat(a);var t={xtype:"form",bodyPadding:"20",itemId:e.id,items:e.uxItems};n.push(t)}});var a={xtype:"panel",region:"center",ref:"uxPanel",layout:"card",border:0,items:n};i.items=[t,a],i.callParent(arguments)},getUx:function(){return[{id:"colorfield",text:"颜色选择器",leaf:!0,uxItems:[{xtype:"colorfield",fieldLabel:"颜色选择器"}]},{id:"datefield",text:"日期控件",leaf:!0,uxItems:[{fieldLabel:"日期",xtype:"datetimefield",dateType:"date"},{fieldLabel:"月份",xtype:"datetimefield",dateType:"month"},{fieldLabel:"时分秒",xtype:"datetimefield",dateType:"datetime"}]},{id:"crgroup",text:"单选，多选",leaf:!0,uxItems:[{fieldLabel:"单选框",xtype:"rgroup",name:"rgroup",iconCls:"child_layout",configInfo:"YESORNO"},{fieldLabel:"多选框",xtype:"cgroup",name:"rgroup",configInfo:"YESORNO"}]},{id:"cbbfield",text:"下拉框",leaf:!0,uxItems:[{fieldLabel:"下拉框",xtype:"cbbfield",configInfo:"YESORNO"}]},{id:"ssfield",text:"查询选择",leaf:!0,uxItems:[{fieldLabel:"查询选择",xtype:"gridssfield",name:"gridssfield",configInfo:"testFunc,gridssareafield,TEST_WB,S"},{fieldLabel:"树形选择",xtype:"treessfield",name:"treessfield",configInfo:"YESORNO,gridssareafield,text,S"},{fieldLabel:"查询选择(大)",xtype:"gridssareafield",name:"gridssareafield",width:400,configInfo:"testFunc,gridssareafield,TEST_WB,S"},{fieldLabel:"树形选择(大)",xtype:"treessareafield",name:"treessareafield",width:400,configInfo:"YESORNO,treessareafield,text,S"}]},{id:"searchfield",text:"智能查询",leaf:!0,uxItems:[{fieldLabel:"智能查询",xtype:"searchfield",name:"searchfield",configInfo:"testFunc,,,S"}]},{id:"editor",leaf:!0,text:"html编辑器",uxItems:[{fieldLabel:"CKEditor",width:850,xtype:"ckeditorfield"}]},{id:"pingyin",leaf:!0,text:"拼音字段",uxItems:[{fieldLabel:"拼音字段",xtype:"pinyinfield",configInfo:"py~py,PY~PY,pinyin~pinyin,PINYIN~PINYIN,PinYin~PinYin"},{fieldLabel:"py",name:"py",xtype:"textfield"},{fieldLabel:"PY",name:"PY",xtype:"textfield"},{fieldLabel:"pinyin",name:"pinyin",xtype:"textfield"},{fieldLabel:"PINYIN",name:"PINYIN",xtype:"textfield"},{fieldLabel:"PinYin",name:"PinYin",xtype:"textfield"}]},{id:"file",leaf:!0,text:"附件",uxItems:[{fieldLabel:"附件",width:400,xtype:"uxfilefield"}]}]}}),Ext.define("JE.core.view.wf.GraphView",{extend:"Ext.panel.Panel",alias:"widget.jewfgraphview",autoScroll:!0,layout:"fit",border:0,initComponent:function(){this.editor=Ext.create("JE.core.view.wf.util.Editor",{}),this.bodyStyle=this.bodyStyle||"background-image:url('"+this.editor.getMXGraphPath()+"/images/grid_1.gif');background-color:#FFFFFF;",this.callParent(arguments),this.on("destroy",function(e){e.editor&&e.editor.editor.graph.setEnabled(!1)})},afterRender:function(){this.callParent(arguments),this.editor&&this.editor.renderTo(this)}}),Ext.define("JE.core.view.wf.util.Editor",{extend:"JE.core.ux.mxgraph.util.Editor",thumbWidth:40,thumbHeight:40,readOnly:!0,thumbStyle:"margin:10px;text-align:center;",loadData:function(t){this.editor.graph;var e=decodeURIComponent(Ext.value(t.xmlCode,""));this.callParent([e]);var i=Ext.clone(t.tasks),a=new Array;Ext.each(i,function(e){e==t.doTask?a.push({code:e,color:"red"}):a.push({code:e,color:"rgb(255, 123, 0)"})}),this.highlightCells(a),Ext.isEmpty(t.wfLogData)||this.highlightEdges(t.wfLogData,"name","limegreen")},highlightEdges:function(e,l,i,t){var s=this,a=s.editor.graph;s.edgeHighlights=Ext.value(s.edgeHighlights,{}),Ext.iterate(s.edgeHighlights,function(e,t){t.h&&t.h.destroy()}),s.edgeHighlights={};var d=s.getAllCells(!0,!1);l=Ext.value(l,"name"),i=Ext.value(i,"red"),t=Ext.value(t,3),Ext.each(e,function(a){if("CLOSEBATCH"==a.operate){var e=a.offLines;Ext.each(e,function(e){var t=e.name,i=e.tran;if("CLOSE"==e.oper)for(var a=0;a<d.length;a++){var n=d[a];if(n.getAttribute(l)==t){for(var o=0;o<n.edges.length;o++){var r=n.edges[o];if(r.getAttribute("name")==i&&r.source==n){s.edgeHighlights[r.id]&&delete s.edgeHighlights[r.id];break}}break}}})}else Ext.each(d,function(t){if("start"==t.getAttribute("type")){var e=t.edges[0];s.edgeHighlights[e.id]={edge:e}}else if(t.getAttribute(l)==a.nodeName&&!Ext.isEmpty(a.targerTransition)){var i=a.targerTransition.split(",");Ext.each(t.edges,function(e){if(-1!=i.indexOf(e.getAttribute(l)))if("OPEN"==a.operate&&e.source==t)s.edgeHighlights[e.id]={edge:e};else if("CLOSE"==a.operate&&e.target==t){s.edgeHighlights[e.id]&&delete s.edgeHighlights[e.id]}})}})}),Ext.iterate(s.edgeHighlights,function(e,t){a.setCellStyles(mxConstants.STYLE_STROKECOLOR,i,[t.edge]),a.setCellStyles(mxConstants.STYLE_STROKEWIDTH,2,[t.edge])})}}),Ext.define("JE.core.view.wf.WFImageView",{extend:"Ext.form.Panel",alias:"widget.jewfimageview",layout:"border",bodyPadding:"2",bodyStyle:"background-color:#ffffff;",useWF:!0,initComponent:function(){var e=!this.formObj;JE.getLocalLang("core.jewfview.wfLog");if(this.items=[{xtype:"mxgraph.graph",editor:Ext.create("JE.core.view.wf.util.Editor",{}),outline:!1,autoScroll:!0,itemId:"imageBox",margin:"0 0 4 0",region:"center"},{xtype:"panel",border:0,data:[],autoScroll:!0,split:!0,collapsible:!0,hideCollapseTool:!0,titleCollapse:!0,collapseMode:"mini",collapsed:!1,region:"south",height:300,itemId:"wflogGrid",tpl:JE.Action.buildWFLogTpl(e)}],!e){var t=this.formObj;this.tbar={itemId:"buttonBar",hidden:"ENDED"==t.wfInfo.audFlag,items:t.funcData.wf.formButtons},t.imageView=this}this.callParent(arguments)}}),Ext.define("JE.core.view.wf.WFProcessUserView",{extend:"Ext.panel.Panel",alias:"widget.jewfprocessuserview",autoScroll:!1,layout:"border",border:0,initComponent:function(){var d=this;d.localLang=JE.getLocalLang("core.jewfview.wfProcessUser");var c=Ext.id();d.tbar=[{text:d.localLang.tbar.remove,iconCls:"jeicon jeicon-error-circle",handler:function(e){var t=e.up("jewfprocessuserview").down("dataview"),i=t.getSelectionModel().getSelection();i&&0<i.length?t.getStore().remove(i):JE.alert(d.localLang.removeAlert)}},{text:d.localLang.tbar.removeAll,iconCls:"jeicon jeicon-trash",handler:function(e){e.up("jewfprocessuserview").down("dataview").getStore().removeAll()}}],d.items=[{region:"north",height:200,id:c,xtype:"dataview",style:{background:"white"},store:JE.getStore({tableName:"JE_CORE_ENDUSER",id:"USERID",params:{limit:-1},autoLoad:!1}),tpl:['<tpl for=".">','<div class=table-files style="border: 1px solid #fff;table-layout:fixed;word-wrap:break-word;float:left;margin:10px;width:58px;height:84px;">','<div style="text-align:center;width:48px;height:48px;"><table width=100% height=100%><tr><td align=center valign = middle><div class="JE_WF_PERSIN0124"></td></tr></table></div>','<div class="x-editable" style="height:35px;padding-top:4px;text-align:center;overflow:hidden;text-overflow:ellipsis;">{USERNAME}</div>',"</div>","</tpl>"],multiSelect:!0,overItemCls:"x-dataview-item-over",trackOver:!0,selectedItemCls:"x-dataview-item-selected",itemSelector:"div.table-files",emptyText:""},{xtype:"mxgraph.graph",editor:Ext.create("JE.core.view.wf.util.Editor",{readOnly:!0,initEvent:function(){this.editor.graph.addListener(mxEvent.CLICK,function(e,t){var i=e.lastMouseX,a=e.lastMouseY,n=t.getProperty("cell");if(n&&"transition"!=n.getAttribute("type")){d.msgBox||(d.msgBox=Ext.create("Ext.panel.Panel",{title:d.localLang.pressTitle,minWidth:150,minHeight:80,bodyStyle:"background-color:#fff;",floating:!0,closable:!0,closeAction:"hide"}));var o=n.getAttribute("name"),r=new Array,l=new Array;Ext.each(d.wfLogData,function(e){if(e.nodeName==o){var i=Ext.value(e.assignee,"").split("<br/>"),t=Ext.value(e.assigneeCode,"").split(",");Ext.each(t,function(e,t){Ext.isEmpty(e)||-1!=l.indexOf(e)||"PI_SYS_AUTONODE_ASSGINE"==e||(r.push({userId:e,userName:i[t]}),l.push(e))})}});var s="<table width=100%>";Ext.each(r,function(e){s+='<tr><td align=center valign = middle><a href="javascript:void(0)" onclick="JE.Action.doPromptUser(\''+c+"','"+e.userName+"','"+e.userId+"');\">"+e.userName+"</a></td></tr>"}),s+="</table>",d.msgBox.update(s),d.msgBox.showAt(i,a)}})}}),outline:!1,width:"100%",margin:"0 0 4 0",region:"center",listeners:{afterrender:function(e){e.editor.loadData({xmlCode:JE.Action.loadWFXmlContent(d.wfInfo.pdid),tasks:d.wfInfo.currentTasks,wfLogData:d.wfLogData})}}}],d.callParent(arguments)}}),Ext.define("JE.core.view.wf.WFPromptView",{extend:"Ext.tab.Panel",alias:"widget.jewfpromptview",autoScroll:!0,layout:"fit",border:0,initComponent:function(){var l=this;l.localLang=JE.getLocalLang("core.jewfview.wfPrompt",!0);var e=JE.getStore({id:"JE_CORE_PROMPTLOG_ID",tableName:"JE_CORE_PROMPTLOG",autoLoad:!0,params:{whereSql:" and PROMPTLOG_PIID='"+l.wfInfo.piid+"' AND PROMPTLOG_USERID='"+JE.currentUser.userId+"'",orderSql:" order by SY_CREATETIME DESC"}}),t=JE.getStore({id:"JE_CORE_PROMPTLOG_ID",tableName:"JE_CORE_PROMPTLOG",autoLoad:!0,params:{whereSql:" and PROMPTLOG_PIID='"+l.wfInfo.piid+"' AND PROMPTLOG_ACCEPTID like '%"+JE.currentUser.userId+"%'",orderSql:" order by SY_CREATETIME DESC"}});l.items=[{title:l.localLang.pressInfoTitle,xtype:"form",layout:"column",autoScroll:!0,border:0,bodyPadding:"10 20 0 20",defaults:{xtype:"textfield",labelAlign:"right",margin:"5 0 8 0",columnWidth:1},items:[{xtype:"hidden",fieldLabel:"实例ID",name:"piid",value:l.wfInfo.piid},{xtype:"hidden",fieldLabel:"部署ID",name:"pdid",value:l.wfInfo.pdid},{xtype:"cgroup",fieldLabel:l.localLang.pressInfoColumns.promptType,name:"promptType",value:"DWR,EMAIL",allowBlank:!1,configInfo:"JE_WF_MESSAGETYPE"},{xtype:"queryuserfield",configInfo:"JE_CORE_QUERYUSER,userNames~userIds,USERNAME~USERID,M",whereSql:"",allowBlank:!1,otherConfig:Ext.encode({DEPT:"1",SENTRY:"1",ROLE:"1",WORKGROUP:"1"}),fieldLabel:l.localLang.pressInfoColumns.userNames,name:"userNames",listeners:{beforequery:function(e){var n=e.up("form"),t=JE.win({title:l.localLang.userTitle,border:0,width:JE.getBodyWidth()-300,height:JE.getBodyHeight()-100,autoShow:!0,useButton:!0,listeners:{close:function(e){var t=e.down("jewfprocessuserview");t.msgBox&&t.msgBox.hide()}},items:[{xtype:"jewfprocessuserview",formObj:n,wfInfo:l.wfInfo,wfLogData:l.wfLogData}],fn:function(e){var t=e.down("jewfprocessuserview").down("dataview").getStore(),i=new Array,a=new Array;t.each(function(e){i.push(e.get("USERNAME")),a.push(e.get("USERID"))}),n.form.setValues({userNames:i.join(","),userIds:a.join(",")})}}),i=n.form.getValues();if(!Ext.isEmpty(i.userIds)){var a=i.userNames.split(","),o=i.userIds.split(","),r=t.down("dataview").getStore();Ext.each(o,function(e,t){r.add({USERID:e,USERNAME:a[t]})})}return!1}}},{xtype:"hidden",fieldLabel:"提醒人ID",name:"userIds"},{xtype:"textarea",fieldLabel:l.localLang.pressInfoColumns.copyContext,allowBlank:!1,name:"promptContext"},{xtype:"vueuserfield",configInfo:"JE_CORE_QUERYUSER,copyUserNames~copyUserIds,text~id,M",whereSql:"",otherConfig:Ext.encode({DEPT:"1",SENTRY:"1",ROLE:"1",WORKGROUP:"1"}),fieldLabel:l.localLang.pressInfoColumns.copyUserNames,name:"copyUserNames"},{xtype:"hidden",fieldLabel:"抄送ID",name:"copyUserIds"},{xtype:"textarea",fieldLabel:l.localLang.pressInfoColumns.copyContext,name:"copyContext"}],buttonAlign:"center",buttons:[{text:l.localLang.okButtonText,formBind:!0,cls:"JEPLUS_B_L10",handler:function(a){var e=a.up("form");JE.submit(e,{async:!1,url:JE.getUrlMaps("je.core.wf.taskInfo","doPrompt"),success:function(e,t){var i=t.result;i.success?(JE.msg(i.obj),a.up("window").close()):JE.alert(i.obj)}})}},{text:l.localLang.cancelButtonText,handler:function(e){e.up("window").close()}}]},{xtype:"gridpanel",title:l.localLang.meRemindTitle,multiSelect:!0,frame:!1,cls:"pcatgrid",columnLines:!0,columns:[{xtype:"rownumberer",width:35,text:"No.",align:"center"},{text:l.localLang.meRemindColumns.type,dataIndex:"PROMPTLOG_TYPE",tactics:[{bgCss:!0,type:"dic",dicCode:"JE_WF_PROMPTTYPE"}],renderer:JE.renderer,align:"center",width:70},{text:l.localLang.meRemindColumns.promptType,dataIndex:"PROMPTLOG_PROMPTTYPE",tactics:[{bgCss:!0,type:"dic",dicCode:"JE_WF_MESSAGETYPE"}],renderer:JE.renderer,align:"center",width:150},{text:l.localLang.meRemindColumns.context,dataIndex:"PROMPTLOG_CONTEXT",align:"center",width:250},{text:l.localLang.meRemindColumns.acceptName,dataIndex:"PROMPTLOG_ACCEPTNAME",align:"center",width:184}],store:e,dockedItems:[{xtype:"pagingtoolbar",store:e,dock:"bottom",displayInfo:!0}]},{xtype:"gridpanel",title:l.localLang.remindMeTitle,multiSelect:!0,frame:!1,cls:"pcatgrid",columnLines:!0,columns:[{xtype:"rownumberer",width:35,text:"No.",align:"center"},{text:l.localLang.remindMeColumns.userName,dataIndex:"PROMPTLOG_USERNAME",align:"center",width:70},{text:l.localLang.remindMeColumns.type,dataIndex:"PROMPTLOG_TYPE",tactics:[{bgCss:!0,type:"dic",dicCode:"JE_WF_PROMPTTYPE"}],renderer:JE.renderer,align:"center",width:70},{text:l.localLang.remindMeColumns.promptType,dataIndex:"PROMPTLOG_PROMPTTYPE",tactics:[{bgCss:!0,type:"dic",dicCode:"JE_WF_MESSAGETYPE"}],renderer:JE.renderer,align:"center",width:150},{text:l.localLang.remindMeColumns.context,dataIndex:"PROMPTLOG_CONTEXT",align:"center",width:300}],store:t,dockedItems:[{xtype:"pagingtoolbar",store:t,dock:"bottom",displayInfo:!0}]}],l.callParent(arguments)}}),Ext.define("JE.core.view.wf.WFSendMsgView",{extend:"Ext.panel.Panel",alias:"widget.jewfsendmsgview",layout:"border",border:0,bodyPadding:"2",easyApprove:!1,initComponent:function(){var s=this;s.changePass||(s.passMainUser=!0),s.localLang=JE.getLocalLang("core.jewfview.wfSendMsg");var e=JE.getLocalLang("core.jewfview.wfLog"),t=[],i=JE.getDicItems("JE_WF_APPROOPINION");i&&Ext.each(i,function(e){t.push({text:e.text})});var a={xtype:"form",layout:"anchor",region:"center",itemId:"msgView",tbar:{listeners:{afterrender:function(e){"1"==JE.systemConfig.JE_WF_GTJA&&e.insert(1,e.getCmp("tbfill"))}},items:[{iconCls:"jeicon jeicon-sms",text:s.localLang.approvalMsg,menu:{defaults:{handler:function(e){s.getComponent("msgView").form.setValues({msg:e.text})}},items:t}},{ref:"send",formBind:!0,iconCls:s.buttonIconCls,text:s.buttonText},{ref:"returnback",formBind:!0,hidden:!s.returnback,iconCls:"jeicon jeicon-cycle",text:s.localLang.button.returnback},{ref:"end",formBind:!0,hidden:!s.haveEnd,iconCls:"jeicon jeicon-pass",text:s.localLang.button.end},{ref:"nopass",formBind:!0,hidden:!s.changePass,iconCls:"jeicon jeicon-minus-polygon",text:s.localLang.button.nopass},{ref:"waiverpass",formBind:!0,hidden:s.passMainUser,iconCls:"jeicon jeicon-a-waiver",text:s.localLang.button.waiverpass},{xtype:"tbfill",itemId:"tbfill"},{ref:"seeImage",text:s.localLang.button.seeImage,hidden:s.wfBatch,iconCls:"jeicon jeicon-photo",handler:function(){s.ownerCt.close();var e=s.formObj;JE.Action.doWFImageWin(e)}}]},layout:{type:"vbox",align:"center"},defaults:{margin:"2",width:"100%"},items:[s.getMsgPanel(),{xtype:"box",title:e.title,flex:1,data:s.wfLogData,autoScroll:!0,tpl:JE.Action.buildWFLogTpl()}]};if(Ext.each(a.tbar,function(e){Ext.isObject(e)&&s.formObj&&s.formObj.funcData&&s.formObj.funcData.info.bigButton&&(e.iconCls&&(e.iconCls=e.iconCls+"_32"),"seeImage"==e.ref&&(e.tooltip=e.text,delete e.text),e.scale="large")}),s.items=[a],!Ext.isEmpty(s.treeData)){var n=[];Ext.each(s.treeData,function(t){var i={flex:1,title:t.text,name:t.code,minHeight:Math.floor(JE.getBodyHeight()/5),items:[]};if(!Ext.isEmpty(t.description)){if(!Ext.isEmpty(t.href)){var e=1*Ext.value(t.href,0);i.height=160+17*e}delete i.flex,delete i.minHeight,i.bodyStyle={borderBottomWidth:"0px"},i.dockedItems=[{xtype:"box",dock:"bottom",padding:"0",margin:"0",border:1,minHeight:30,tabObj:i,viewObj:s,html:t.description,style:{border:"1px solid #99bce8",background:"#f1f1f1"}}]}Ext.each(t.children,function(e){e.children[0]&&(e.children[0].cls="x-tree-row-focused"),i.items.push({title:e.text,multiSelect:"joint"==t.nodeType,allowDeselect:!0,rootData:e,name:t.code,listeners:{select:function(e,t,i,a){var n=e.view.panel,o=n.up("tabpanel"),r=o.up("panel[itemId=spListView]"),l=r.up("jewfsendmsgview");1<o.items.length&&o.items.each(function(e){e.id!=n.id&&e.getSelectionModel().deselectAll()}),1<r.items.length&&("reject"==s.type||-1!=["decision","circular"].indexOf(l.taskType))&&r.items.each(function(e){e.id!=o.id&&e.items.each(function(e){e.getSelectionModel().deselectAll()})})}}})}),1==i.items.length&&(i.tabBar={hidden:!0}),n.push(i)});var o={width:160,margin:"0 2 0 0",region:"west",itemId:"spListView",autoScroll:!0,layout:{type:"vbox",align:"center"},defaults:{width:"100%",xtype:"tabpanel",border:0,bodyStyle:"border-top-width: 0px;",defaults:{xtype:"jetreeview",type:"func",bodyStyle:"border-width:1px 0px;",emptyText:"该角色下没有任何人员</br>请到角色授权功能中设置.",searchBar:!0}},items:n};s.items.push(o)}s.callParent(arguments)},getMsgPanel:function(){var e={xtype:"panel",border:0,layout:"border",height:198,bodyStyle:"background-color:#ffffff;",items:[{xtype:"textarea",name:"msg",region:"west",width:190,allowBlank:!1,value:Ext.value(this.comment,""),emptyText:"审批意见。如需要更详细的说明，请在右侧填写！",margin:"0 5 0 0",fieldStyle:"background-color:rgb(252, 255, 187);",listeners:{afterrender:function(e){e.isValid()}}},{xtype:"ueditorfield",name:"commentDetails",region:"center",showFullScreenBtn:!0,simpleToolbar:!0,listeners:{editorready:function(e){e.editorTBarEl.down(".edui-editor-toolbarboxinner").setStyle("background","rgb(252, 255, 187)")}}}]};if("1"==JE.systemConfig.JE_WF_GTJA)e={xtype:"panel",border:0,layout:"column",bodyStyle:"background-color:#ffffff;",defaults:{columnWidth:1},items:[{xtype:"textarea",height:100,name:"msg",region:"west",allowBlank:!1,value:Ext.value(this.comment,""),emptyText:"审批意见。",margin:"0 0 5 0",fieldStyle:"background-color:rgb(252, 255, 187);",listeners:{afterrender:function(e){e.isValid()}}},{xtype:"uxfilesfield",name:"commentDetails",height:130}]};return e},afterRender:function(){this.callParent(arguments);var t=new Array,i=new Array,e=this.getComponent("spListView");e&&e.items.each(function(e){e.items.each(function(e){t.push(e),e.getRootNode().cascadeBy(function(e){"1"!=e.get("disabled")&&i.push(e)})})}),1==t.length&&1==i.length&&setTimeout(function(){t[0].getSelectionModel().select(i[0])},100)},getRejectUsers:function(){var r=this,e={},t=r.getComponent("spListView");if(t){var l=[],s=[],d=[];t.items.each(function(o){o.items.each(function(e){var i=[],a=[],n=[],t=e.getSelectionModel().getSelection();Ext.each(t,function(e){var t=Ext.value(e.get("nodeInfo"),e.get("id"));"1"!=e.get("disabled")&&(i.push(e.get("text")),a.push(e.get("code")),a.push(t)),0<i.length&&(r.targerTaskName=o.name,l.push(i.join(",")),s.push(a.join(",")),d.push(n.join(",")))})})}),0<l.length&&(e.assigeeName=l.join("#"),e.assigeeCode=s.join("#"),e.assigeeId=d.join("#"))}return e},getUsers:function(){var c=this,e={},t=c.getComponent("spListView");if(t){var i=[],a=[],n=[],u={},p={};if(t.items.each(function(d){d.items.each(function(e){var o=[],r=[],l=[],s={},t=e.getSelectionModel().getSelection();Ext.each(t,function(e){var t=Ext.value(e.get("nodeInfo"),e.get("id"));if("entrust"==c.type&&(t=e.get("id")),"1"==e.get("disabled")||s[t]||(o.push(e.get("text")),r.push(e.get("code")),l.push(t),s[t]=t),"countersign"==e.get("nodeInfoType")){var i=d.getEl().down("table[name=countersign]"),a=JE.Action.getCountersignInfo(i);a.userIds=a.userIds.join(","),a.userNames=a.userNames.join(","),delete a.allUserIds,u[d.name]=a}if("fork"==e.get("nodeInfoType")){i=d.getEl().down("table[name=forkInfo]");var n=JE.Action.getForkInfo(i);p[d.name]=n}}),0<o.length&&("decision"!=c.taskType&&"circular"!=c.taskType||(c.targerTaskName=d.name,Ext.each(c.targerTranInfos,function(e){e.to==d.name&&(c.targerTransition=e.name)})),i.push(o.join(",")),a.push(r.join(",")),n.push(l.join(",")))})}),e.countersignInfos=JE.isEmpty(u)?"":Ext.encode(u),e.forkInfos=JE.isEmpty(p)?"":Ext.encode(p),!JE.isEmpty(e.countersignInfos))for(var o in u){var r=u[o];if("ONE_ASSGINE"==r.countersignType&&Ext.isEmpty(r.countersignAssgine))return JE.alert(c.localLang.alert.countersignPrincipal),null}if(!JE.isEmpty(p))for(var l in p)for(var s=p[l],d=0;d<s.length;d++){var f=s[d];if("1"==f.doTask&&"countersign"!=f.taskType&&Ext.isEmpty(f.assgineeInfo.userIds))return JE.alert(JE.format(c.localLang.alert.selectProcessUser,f.taskName)),null}if(!(0<i.length))return c.haveEnd||JE.alert(c.localLang.alert.selectToUser),null;e.assigeeName=i.join("#"),e.assigeeCode=a.join("#"),e.assigeeId=n.join("#")}return e}}),Ext.define("JE.core.view.wf.WFTaskUserView",{extend:"Ext.panel.Panel",alias:"widget.jewftaskuserview",layout:"fit",border:0,bodyPadding:"2",initComponent:function(){if(this.items=[],!Ext.isEmpty(this.treeData)){var e=[];Ext.each(this.treeData,function(t){var i={flex:1,name:t.code,minHeight:Math.floor(JE.getBodyHeight()/5),items:[]};Ext.each(t.children,function(e){e.children[0]&&(e.children[0].cls="x-tree-row-focused"),i.items.push({title:e.text,multiSelect:"joint"==t.nodeType,allowDeselect:!0,rootData:e,name:t.code,listeners:{select:function(e,t,i,a){var n=e.view.panel,o=n.up("tabpanel"),r=o.up("panel[itemId=spListView]"),l=r.up("jewfsendmsgview");1<o.items.length&&o.items.each(function(e){e.id!=n.id&&e.getSelectionModel().deselectAll()}),1<r.items.length&&"decision"==l.taskType&&r.items.each(function(e){e.id!=o.id&&e.items.each(function(e){e.getSelectionModel().deselectAll()})})}}})}),1==i.items.length&&(i.tabBar={hidden:!0}),e.push(i)});var t={margin:"0 2 0 0",region:"west",itemId:"spListView",autoScroll:!0,layout:{type:"vbox",align:"center"},defaults:{width:"100%",xtype:"tabpanel",border:0,defaults:{xtype:"jetreeview",border:0,type:"func",searchBar:!1}},items:e};this.items.push(t)}this.callParent(arguments)},getUsers:function(){var l=this,e={},t=l.getComponent("spListView");if(t){var s=[],d=[],c=[];if(t.items.each(function(r){r.items.each(function(e){var i=[],a=[],n=[],o={},t=e.getSelectionModel().getSelection();Ext.each(t,function(e){var t=Ext.value(e.get("nodeInfo"),e.get("id"));"1"==e.get("disabled")||o[t]||(i.push(e.get("text")),a.push(e.get("code")),n.push(t),o[t]=t)}),0<i.length&&("decision"==l.taskType&&(l.targerTaskName=r.name,Ext.each(l.targerTranInfos,function(e){e.to==r.name&&(l.targerTransition=e.name)})),s.push(i.join(",")),d.push(a.join(",")),c.push(n.join(",")))})}),!(0<s.length))return JE.alert(JE.getLocalLang("core.jewfview.alert.selectAssigeeUser")),null;e.assigeeName=s.join("#"),e.assigeeCode=d.join("#"),e.assigeeId=c.join("#")}return e}}),Ext.define("JE.core.view.workflow.WFFileView",{extend:"Ext.panel.Panel",alias:"widget.jewffileview",layout:"fit",border:0,initComponent:function(){var r=this;r.localLang=JE.getLocalLang("core.jewfview.workflow",!0),r.items={xtype:"boundlist",itemId:"view",margin:10,store:r.fileStore,tpl:['<ul class="'+Ext.plainListCls+'"><tpl for=".">','<li role="option" unselectable="on" class="x-boundlist-item" style="padding:0px 10px;">{name}','<i style="margin: 0 10px 0 20px;" class="fa fa-download"></i>','<i class="fa fa-remove"></i></li>',"</tpl></ul>"],autoScroll:!0,listeners:{itemclick:function(e,t,i,a,n){if(n.getTarget(".fa-download"))window.open(JE.getFileUrl(t.get("path"),"","","",t.get("beanTableCode")));else if(n.getTarget(".fa-remove")){var o=r.up("panel[xtype=jewfwinview]").wfData.wfInfo||{};JE.ajax({url:"/je/doc/document/removeFormFiles",params:{beanTableCode:o.tableCode,tableCode:"JE_CORE_DOCUMENT",JE_CORE_DOCUMENT_ID:t.get("id")}}).success&&e.getStore().remove(t)}}}},r.store=r.items.store,r.buttons=[{text:r.localLang.addFileText,cls:"btn JEPLUS_B_L10",width:100,itemId:"okButton",handler:function(){r.doOKAct()}},{text:r.localLang.cancelButtonText,cls:"btn",width:100,handler:function(){r.doCancelAct()}}],r.buttonAlign="center",r.callParent(arguments),r.view=r.getCmp("view")},doOKAct:function(){var i=this,e=i.up("panel[xtype=jewfwinview]").wfData,t=e.formObj||{},a=e.wfInfo||{},n={funcCode:t.funcCode,tableCode:a.tableCode,jeFileType:"PROJECT",pkValue:a.pkValue,beanTableCode:a.tableCode,wf:"1",returnType:"all"};JE.uploadFile({multiSelect:!0,width:600,height:500,params:n,callback:function(e){var t=e.name;i.fileStore.add({name:t,cls:e.docInfo.DOCUMENT_ICONCLS,path:e.url,id:e.docInfo.JE_CORE_DOCUMENT_ID,beanTableCode:n.beanTableCode,extend:e.docInfo.DOCUMENT_THUMBNAILCLS})}})},doCancelAct:function(){this.up("window").close()}}),Ext.define("JE.core.view.workflow.WFFormView",{extend:"Ext.panel.Panel",mixins:["JE.core.view.workflow.Util"],alias:"widget.jewfformview",layout:"hbox",cls:"je-workflow-formview",initComponent:function(){this.localLang=JE.getLocalLang("core.jewfview.workflow",!0),this.defaults={xtype:"container",layout:"column",height:"100%",margin:10,defaults:{columnWidth:1}},this.items=[this.getNodeBox(),this.getUserBox(),this.getMsgBox()],this.callParent(arguments)},afterRender:function(){var e=this;e.callParent(arguments),e.body.insertHtml("beforeEnd",'<i style="position: absolute;right: 20px;top: 10px;padding: 10px;cursor: pointer;" class="fa fa-close"></i>',!0).on("click",function(){e.hide()})},contentHeight:60,getNodeBox:function(){var t=this;return{itemId:"node",width:150,cls:"step node",items:[{xtype:"box",cls:"step-title",itemId:"title",html:t.localLang.formStep1},{xtype:"box",height:t.contentHeight,cls:"step-content",tpl:"<div>{text}</div>",data:{text:t.localLang.emptyText},itemId:"content"},{xtype:"box",cls:"step-footer",itemId:"footer",html:t.localLang.selectNodeText,listeners:{afterrender:function(e){e.getEl().on("click",function(){t.selectNode(function(e){t.setActiveStep(1,{node:e})})})}}}]}},getUserBox:function(){var t=this;return{itemId:"user",width:150,cls:"step user",listeners:{afterrender:function(t){var i=t.getCmp("content").store;i.on("datachanged",function(){var e=i.getCount();e=5<e?6:e,t.setWidth(70*e+150)}),i.fireEvent("datachanged",i)}},items:[{xtype:"box",cls:"step-title",itemId:"title",html:t.localLang.formStep2},{itemId:"content",xtype:"dataview",height:t.contentHeight,store:Ext.create("Ext.data.Store",{fields:["text","code","id"],data:[]}),cls:"step-users step-content",itemSelector:"div.user",tpl:['<tpl for=".">','<tpl if="xindex &lt;= this.maxLength">','<div class="user">','<div class="user-header">{[this.getUserName(values)]}</div>','<div class="user-name">{text}</div>',"</div>","</tpl>","</tpl>",'<tpl if="values.length &gt; this.maxLength">','<div class="step-users-more">','<div class="user-header">...</div>','<div class="user-name">&nbsp;</div>',"</div>","</tpl>",'<tpl if="values.length==0">','<div class="step-users-empty">','<i class="fa fa-user-circle" style="font-size: 35px;color: #ddd;margin-top: 10px;"></i>',"</div>","</tpl>",{getUserName:function(e){var t=e.text;return t=2<t.length?t.substring(t.length-2,t.length):t},maxLength:5}]},{xtype:"box",itemId:"footer",cls:"step-footer",html:t.localLang.selectUserText,listeners:{afterrender:function(e){e.getEl().on("click",function(){t.selectUser(function(e){t.setActiveStep(2,e)})})}}}]}},getMsgBox:function(){var c=this;return{itemId:"msg",cls:"step msg",minWidth:150,flex:1,items:[{xtype:"box",cls:"step-title",itemId:"title",html:c.localLang.formStep3,listeners:{afterrender:function(e){e.getEl().on("click",function(e){var t=e.getTarget(".wf-msg");t&&c.getMsgMenu().showBy(t,null,[0,5])})}}},{xtype:"container",cls:"step-content",itemId:"content",layout:"hbox",height:c.contentHeight,defaults:{height:"100%"},items:[{xtype:"textarea",itemId:"msg",listeners:{change:function(e){c.setActiveStep(3,{msg:e.getValue()})}},flex:1},{xtype:"button",itemId:"sendBtn",cls:"btn JEPLUS_B_L10",minWidth:100,text:c.localLang.submitText,handler:function(){c.doWFSubmitAction(function(){c.hide()})}}]},{xtype:"dataview",itemId:"footer",store:Ext.create("Ext.data.Store",{fields:["name","path","cls","id","extend","beanTableCode"],data:[],listeners:{datachanged:function(e,t){c.rendered&&c.getCmp("msg").getCmp("footer").refresh()}}}),cls:"step-files",itemSelector:"div.file",tpl:['<span class="step-files-add"><i class="fa fa-file-text-o"></i> '+c.localLang.addFileText+"({[values.length]})</span>",'<tpl for=".">','<tpl if="xindex &lt;= this.maxLength">','<div class="file">{name} <span class="step-files-remove" data-id="{id}">'+c.localLang.clearFileText+"</span></div>","</tpl>","</tpl>",'<tpl if="values.length &gt; this.maxLength">','<i class="fa fa-ellipsis-h step-files-more" title="'+c.localLang.moreFileText+'"></i>',"</tpl>",{maxLength:4}],listeners:{afterrender:function(d){d.getEl().on("click",function(e){var t=e.getTarget(".step-files-more"),i=e.getTarget(".step-files-add"),a=e.getTarget(".step-files-remove");if(t)c.selectFile(d.store);else if(i){var n=(l=c.up("panel[xtype=jewfwinview]").wfData).formObj||{},o=l.wfInfo||{},r={funcCode:n.funcCode,tableCode:o.tableCode,jeFileType:"PROJECT",pkValue:o.pkValue,beanTableCode:o.tableCode,wf:"1",returnType:"all"};JE.uploadFile({multiSelect:!0,width:600,height:500,params:r,callback:function(e){var t=e.name,i=e.docInfo.JE_CORE_DOCUMENT_ID;d.getStore().add({name:t,cls:e.docInfo.DOCUMENT_ICONCLS,path:e.url,id:i,extend:e.docInfo.DOCUMENT_THUMBNAILCLS,beanTableCode:r.beanTableCode})}})}else if(a){o=(l=c.up("panel[xtype=jewfwinview]").wfData).wfInfo||{};var l,s=d.store.getById(a.getAttribute("data-id"));JE.ajax({url:"/je/doc/document/removeFormFiles",params:{beanTableCode:o.tableCode,tableCode:"JE_CORE_DOCUMENT",JE_CORE_DOCUMENT_ID:a.getAttribute("data-id")}}).success&&d.store.remove(s)}})}}}]}},getSubmitInfo:function(){var e=this.getCmp("msg").getCmp("content").getCmp("msg").getValue(),t=this.getCmp("msg").getCmp("footer"),i=[];return t.store.each(function(e){i.push(e.data)}),{submitComments:e,commentDetails:Ext.encode(i)}},setSubmitMsg:function(e){this.getCmp("msg").getCmp("content").getCmp("msg").setValue(e)},resetWFData:function(){var t=this;t.setActiveStep(0),delete t.activeNode,delete t.activeUserInfo,t.items.each(function(e){t.resetItemData(e)})},resetItemData:function(e){switch(e.show(),e.itemId){case"node":e.getCmp("content").update({text:this.localLang.emptyText}),e.getCmp("footer").show();break;case"user":e.getCmp("content").store.removeAll(),e.getCmp("footer").show();break;case"msg":e.getCmp("content").getCmp("msg").reset(),e.getCmp("footer").store.removeAll()}},setActiveStep:function(e,t){var i=this;if(t)if(1==e){i.activeNode=t.node,i.getCmp("node").getCmp("content").update(t.node),t.hideSelect&&i.getCmp("node").getCmp("footer").hide();var a=i.getInitUsers();a?i.setActiveStep(2,a):(i.activeUserInfo={},i.getCmp("user").getCmp("content").store.removeAll()),i.getCmp("user").getCmp("footer").show()}else if(2==e){if(i.activeUserInfo=t,i.getCmp("user").getCmp("content").store.removeAll(),i.getCmp("user").getCmp("content").store.add(t.users||[]),t.hideSelect&&i.getCmp("user").getCmp("footer").hide(),JE.isEmpty(t.users))-1<(n=i.activeStep.indexOf(e))&&i.activeStep.splice(n,1),e=void 0}else if(3==e){var n;if(JE.isEmpty(t.msg))-1<(n=i.activeStep.indexOf(e))&&i.activeStep.splice(n,1),e=void 0}0==e?i.activeStep=[]:-1==i.activeStep.indexOf(e)&&i.activeStep.push(e),i.items.each(function(e,t){e[-1!=i.activeStep.indexOf(t+1)?"addCls":"removeCls"]("done")})},selectNode:function(e){var t=this.taskNodes;JE.win({title:this.localLang.selectNodeText,width:400,height:500,autoShow:!0,items:{xtype:"jewfnodeview",nodeData:t,activeNode:this.activeNode,callback:e}})},selectUser:function(e){if(-1!=this.activeStep.indexOf(1)){var t=this.taskNodeUsers[this.activeNode.code],i=this.activeUserInfo;JE.win({title:this.localLang.userTitle,width:650,minWidth:650,height:600,autoShow:!0,items:{xtype:"jewfuserview",activeNode:this.activeNode,initData:i,users:t,wfData:this.wfData,callback:e}})}else JE.alert(this.localLang.selectNodeAlert)}}),Ext.define("JE.core.view.workflow.WFMsgView",{extend:"Ext.panel.Panel",alias:"widget.jewfmsgview",layout:"column",border:0,initComponent:function(){var c=this;c.localLang=JE.getLocalLang("core.jewfview.workflow",!0),c.bodyPadding=20,c.defaults={labelWidth:60,columnWidth:1,margin:4},c.items=[{xtype:"uxdisplayfield",fieldLabel:c.localLang.nodeLabel,itemId:"node",fieldStyle:"border-width:0;"},{xtype:"fieldcontainer",fieldLabel:c.localLang.userLabel,itemId:"user",layout:"fit",setValue:function(e){e=Ext.value(e,[]);this.getCmp("view").store.removeAll(),this.getCmp("view").store.add(e)},items:{itemId:"view",xtype:"dataview",store:Ext.create("Ext.data.Store",{fields:["text","code","id"],data:[]}),cls:"step-users step-content",itemSelector:"div.user",tpl:['<tpl for=".">','<div class="user">','<div class="user-header">{[this.getUserName(values)]}</div>','<div class="user-name">{text}</div>',"</div>","</tpl>",{getUserName:function(e){var t=e.text;return t=2<t.length?t.substring(t.length-2,t.length):t}}]}},{xtype:"textarea",itemId:"msg",emptyText:c.localLang.msgEmptyText,height:150,listeners:{afterrender:function(e){e.bodyEl.insertHtml("afterBegin",['<div style="position: absolute;left: 1px;bottom: 1px;width:100%;">','<div class="btn menu" style="float:right;margin-right: 2px;">更多常用意见 <i class="fa fa-caret-down"></i></div>','<div class="btn" style="display:inline-block;border-radius: 20px;padding: 4px 12px!important;margin-left:10px;">请审批</div>','<div class="btn" style="display:inline-block;border-radius: 20px;padding: 4px 12px!important;margin-left:10px;">同意</div>','<div class="btn" style="display:inline-block;border-radius: 20px;padding: 4px 12px!important;margin-left:10px;">不同意</div>',"</div>"].join(""),!0).on("click",function(e){if(e.getTarget(".menu",2)){var t=e.getTarget(".menu",2,!0);c.mainview.getMsgMenu().showBy(t,null,[0,5])}else if(e.getTarget(".btn",1)){var i=e.getTarget(".btn",1).innerHTML;c.getCmp("msg").setValue(i)}})}}},{xtype:"dataview",itemId:"files",store:Ext.create("Ext.data.Store",{fields:["name","path","cls","id","extend","beanTableCode"],data:[],listeners:{datachanged:function(e,t){c.rendered&&c.getCmp("files").refresh()}}}),cls:"step-files",itemSelector:"div.file",tpl:['<div class="step-files-add"><i class="fa fa-file-text-o"></i> '+c.localLang.addFileText+"({[values.length]})</div>",'<tpl for=".">','<div class="file">{name} <span class="step-files-remove" data-id="{id}">'+c.localLang.clearFileText+"</span></div>","</tpl>"],listeners:{afterrender:function(d){d.getEl().on("click",function(e){var t=e.getTarget(".step-files-more"),i=e.getTarget(".step-files-add"),a=e.getTarget(".step-files-remove");if(t)c.selectFile(d.store);else if(i){var n=(l=c.up("panel[xtype=jewfwinview]").wfData).formObj||{},o=l.wfInfo||{},r={funcCode:n.funcCode,tableCode:o.tableCode,jeFileType:"PROJECT",pkValue:o.pkValue,beanTableCode:o.tableCode,wf:"1",returnType:"all"};JE.uploadFile({multiSelect:!0,width:600,height:500,params:r,callback:function(e){var t=e.name,i=e.docInfo.JE_CORE_DOCUMENT_ID;d.getStore().add({name:t,cls:e.docInfo.DOCUMENT_ICONCLS,path:e.url,id:i,extend:e.docInfo.DOCUMENT_THUMBNAILCLS,beanTableCode:r.beanTableCode})}})}else if(a){o=(l=c.up("panel[xtype=jewfwinview]").wfData).wfInfo||{};var l,s=d.store.getById(a.getAttribute("data-id"));JE.ajax({url:"/je/doc/document/removeFormFiles",params:{beanTableCode:o.tableCode,tableCode:"JE_CORE_DOCUMENT",JE_CORE_DOCUMENT_ID:a.getAttribute("data-id")}}).success&&d.store.remove(s)}})}}}],c.callParent(arguments)},initMsgData:function(i){var a=this,n=a.btnType;a.items.each(function(e){if("files"==e.itemId)a.getCmp("files").store.removeAll();else if("msg"==e.itemId)"return"==n||"reject"==n?e.setValue("不同意"):e.setValue("同意");else{var t=i[e.itemId];e.setValue(t)}}),a.getCmp("user").setVisible(JE.isNotEmpty(i.user))}}),Ext.define("JE.core.view.workflow.WFNodeView",{extend:"Ext.panel.Panel",alias:"widget.jewfnodeview",layout:"fit",border:0,padding:10,initComponent:function(){var i=this;i.localLang=JE.getLocalLang("core.jewfview.workflow",!0),i.items={xtype:"boundlist",itemId:"view",cls:"je-workflow-nodelist",selModel:{deselectOnContainerClick:!1},store:Ext.create("Ext.data.Store",{fields:["text","code","type"],data:i.nodeData}),tpl:['<ul class="'+Ext.plainListCls+'" style="padding:0 25px;"><tpl for=".">','<li role="option" unselectable="on" class="x-boundlist-item" style="padding:0px 10px; margin-top:20px;">{text}</li>',"</tpl></ul>"],autoScroll:!0,listeners:{itemdblclick:function(e,t){"win"!=i.showType&&i.doOKAct()}}},i.store=i.items.store,"win"!=i.showType&&(i.buttons=[{text:i.localLang.okButtonText,cls:"btn JEPLUS_B_L10",width:100,itemId:"okButton",handler:function(){i.doOKAct()}},{text:i.localLang.cancelButtonText,cls:"btn",width:100,handler:function(){i.doCancelAct()}}],i.buttonAlign="center"),i.callParent(arguments),i.view=i.getCmp("view"),i.view.on("afterrender",function(e){i.setActiveNode(i.activeNode)})},setActiveNode:function(e){var t=this;t.activeNode=e,t.activeNode&&t.store.findBy(function(e){if(e.get("code")==t.activeNode.code)return t.view.getSelectionModel().select(e),!1})},doOKAct:function(){var e=this.view.getSelectionModel().getSelection()[0];e?(this.callback&&this.callback(e.data),this.doCancelAct()):JE.alert(this.localLang.selectNodeAlert)},doCancelAct:function(){this.up("window").close()}}),Ext.define("JE.core.view.workflow.WFUserView",{extend:"Ext.panel.Panel",alias:"widget.jewfuserview",layout:"column",border:0,autoScroll:!0,initComponent:function(){var e=this;e.localLang=JE.getLocalLang("core.jewfview.workflow",!0),e.bodyStyle="padding:20px;border-width:0px;",e.defaults={columnWidth:1,labelWidth:50,labelAlign:"right"},"win"!=e.showType&&(e.items=e.buildItems(),e.buttons=[{text:e.localLang.okButtonText,cls:"btn JEPLUS_B_L10",width:100,itemId:"okButton",handler:function(){e.doOKAct()}},{text:e.localLang.cancelButtonText,cls:"btn",width:100,handler:function(){e.doCancelAct()}}],e.buttonAlign="center"),e.callParent(arguments)},afterRender:function(){this.callParent(arguments),this.initUserData()},buildItems:function(){var a=this,t=[],i=[],e=a.wfData,n=e.formObj.wfInfo.info,o=(n.taskNodeInfos[e.formObj.wfInfo.taskName],a.activeNode),r=n.taskNodeInfos[o.code];a.muiltUsers=!1,r&&"entrust"!=e.type&&(a.muiltUsers=-1!=["joint","batchtask","countersign"].indexOf(r.type)),a.doUserSort=!1,a.readUserSort=!0,r&&("countersign"==r.type?(a.doUserSort=!0,r.countersignOrder&&(a.readUserSort=!1)):"batchtask"==r.type&&(a.doUserSort=!0,r.doUserSort&&(a.readUserSort=!1),r.doUserSortOnly&&(a.readUserSort=!0))),Ext.each(a.users,function(e){e.text=e.text||e.code,t.push(a.buildNodeView(e)),i.push({text:e.text,code:e.code})});var l={xtype:"container",itemId:"center",layout:"card",items:t};return[{xtype:"uxdisplayfield",fieldLabel:a.localLang.nodeLabel,labelWidth:60,itemId:"node",fieldStyle:"border-width:0;"},{xtype:"rgroup",fieldLabel:a.localLang.branchLabel,itemId:"branch",name:"branch",dataArray:i,hidden:1==i.length,listeners:{afterrender:function(e){JE.isNotEmpty(e.dataArray)&&e.setValue(e.dataArray[0].code)},change:function(e,t,i){a.getCmp("center").getLayout().setActiveItem(t)}}},l]},buildNodeView:function(o){var e=this,t=[];Ext.each(o.children,function(e){t.push({text:e.text,code:e.code})});var i="";0<t.length&&(i=t[0].code);var a={itemId:o.code,nodeInfo:{id:o.id,code:o.code,text:o.text,type:o.nodeInfo},layout:"column",xtype:"panel",autoScroll:!0,border:0,defaults:{labelWidth:50,columnWidth:1,labelAlign:"right"},items:[{xtype:"rgroup",fieldLabel:e.localLang.userTypeLabel,itemId:"treeType",name:"treeType_"+o.code,dataArray:t,hidden:t.length<=1,value:i,listeners:{change:function(e,t,i){e.ownerCt.getCmp("userBox").getCmp("tree").getLayout().setActiveItem(t)}}},e.buildUserView(o),{fieldLabel:e.localLang.sortLabel,xtype:"rgroup",hidden:!e.doUserSort,readOnly:e.readUserSort,itemId:"sort",name:"sort_"+o.code,value:e.readUserSort?"0":"1",dataArray:[{code:"0",text:e.localLang.noUseSort},{code:"1",text:e.localLang.useSort}]}]};return"fork"==e.activeNode.type?a.items.push({fieldLabel:e.localLang.doTaskLabel,xtype:"rgroup",itemId:"doTask",name:"doTask_"+o.code,value:"1",dataArray:[{code:"1",text:e.localLang.useForkTask},{code:"0",text:e.localLang.noUseForkTask}]},{fieldLabel:e.localLang.doJointLabel,xtype:"rgroup",itemId:"doJoint",hidden:"joint"!=o.nodeInfoType,name:"doJoint_"+o.code,value:"0",configInfo:"YESORNO"}):"countersign"==e.activeNode.type&&(a.infoData=info=Ext.decode(e.activeNode.description),a.items.push({xtype:"hidden",itemId:"selectUser",value:info.selectUser},{fieldLabel:e.localLang.countersingTypeLabel,xtype:"rgroup",itemId:"countersignType",name:"countersignType_"+o.code,value:info.countersignType,configInfo:"JE_WF_COUNTERSIGNTYPE",columnWidth:.5,readOnly:!0},{xtype:"container",columnWidth:.5,height:34,itemId:"countersignProportion",layout:{type:"hbox",align:"middle"},hidden:"ONE_ASSGINE"==info.countersignType,setValue:function(e){this.getCmp("value").setValue(100*JE.toNum(e))},getValue:function(){return.01*JE.toNum(this.getCmp("value").getValue())},items:[{xtype:"numberfield",margin:"0 2 0 0",minValue:0,maxValue:100,width:60,itemId:"value",value:100*JE.toNum(info.countersignProportion),cls:"je-field-basiccls",readOnly:!e.selectUser},{xtype:"box",html:e.localLang.countersignType1}]},{xtype:"container",columnWidth:.5,itemId:"countersignAssgineId",layout:{type:"hbox",align:"middle"},height:34,hidden:"PROPORTION_YES"==info.countersignType,setValue:function(e){this.getCmp("value").setValue(e)},getValue:function(){return this.getCmp("value").getValue()},items:[{xtype:"box",html:e.localLang.countersignType2Label},{xtype:"cbbfield",itemId:"value",margin:"0 2",width:100,value:info.countersignAssgineId,dataArray:[],cls:"je-field-basiccls",readOnly:!e.selectUser,valueField:"id",listeners:{change:function(e,t,i){var a=e.store,n=e.ownerCt.ownerCt.getCmp("countersignAssgineName");a.each(function(e){e.get("id")==t&&n.setValue(e.get("text"))})},afterrender:function(e){var t=e.ownerCt.ownerCt.getCmp("userBox").getCmp("userview").getCmp("view");e.store=t.store,e.setValue(e.getValue())}}},{xtype:"box",html:e.localLang.countersignType2}]},{xtype:"textfield",hidden:!0,itemId:"countersignAssgineName",width:100,value:info.countersignAssgineName}),info.selectUser||(a.items[1].readOnly=!0),a.listeners=a.listeners||{},a.listeners.afterrender=function(e){var t=e.getCmp("userBox"),i=t.getCmp("tree").getCmp(o.code),a=t.getCmp("userview").getCmp("view"),n=[];i.getRootNode().cascadeBy(function(e){"ENDUSER"!=e.get("nodeInfoType")||a.store.getById(e.get("nodeInfo"))||n.push({id:e.get("nodeInfo"),code:e.get("code"),text:e.get("text"),nodeId:e.get("id")})}),a.store.add(n)}),a},buildUserView:function(e){var l=this,n={xtype:"container",layout:"card",itemId:"tree",items:[]},o=Ext.decode(Ext.value(e.description,"{}")),r=l.muiltUsers;if("fork"==l.activeNode.type){var t=l.wfData.formObj.wfInfo.info.taskNodeInfos[e.code];t&&(r=-1!=["joint","batchtask","countersign"].indexOf(t.type))}Ext.each(e.children,function(e){var t=e.code;e.id="ROOT";var i={xtype:"jetreeview",width:250,type:"func",itemId:t,rootData:e,multiSelect:r,border:1,emptyText:l.localLang.userEmptyText,searchBar:!0,searchTpl:['<ul class="'+Ext.plainListCls+'">','<tpl for=".">','<li role="option" unselectable="on" class="x-boundlist-item">{[this.innerTpl(values)]}</li>',"</tpl>","</ul>",{innerTpl:function(e){return JE.isNotEmpty(e.parentText)&&e.leaf?e.text+"("+e.parentText+")":e.text}}],listeners:{itemclick:function(e,t){var i=e.panel.ownerCt.ownerCt.getCmp("buttons");if("ENDUSER"==t.get("nodeInfoType")||"entrust"==l.wfData.type&&"1"!=t.get("disabled")){var a=i.getCmp("add");a.handler(a)}}}};if("1"==JE.systemConfig.JE_DIANJIAN&&(i.searchTpl="{text}({parentText})"),"DEPTUSER"==t&&o.async){var a={ddCode:"JE_CORE_DEPTUSER",ddName:e.text,nodeInfo:"JE_CORE_DEPTUSER",async:!0,wfUser:!0,whereSql:Ext.value(o.whereSql),orderSql:Ext.value(o.orderSql),parentSql:"",rootId:"ROOT",params:{},initParams:{},moreRoot:!1,queryField:"",nodeField:"",formatValue:""};i.configInfo=[a],i.async=!0,i.loadInfo={url:"/jbpm/taskInfoAction!loadAsyncAssgine.action",params:{node:"ROOT",onlyItem:!1,excludes:"checked",whereSql:"",orderSql:"",strData:Ext.encode(i.configInfo)}}}n.items.push(i)});var i={xtype:"panel",items:{xtype:"boundlist",itemId:"view",simpleSelect:!0,emptyText:'<div style="color: #ccc;text-align:center;margin-top:40%;font-size: 13px;">'+l.localLang.userSelectTip+"</div>",store:Ext.create("Ext.data.Store",{fields:["id","text","code"],data:[]}),tpl:['<ul class="'+Ext.plainListCls+'"><tpl for=".">','<li role="option" unselectable="on" class="x-boundlist-item" style="padding:0px 10px;cursor: move;">{text}</li>',"</tpl></ul>"],autoScroll:!0},width:250,border:0,layout:"fit",itemId:"userview",listeners:{afterrender:function(e){if(!e.ownerCt.readOnly){var t=e.getCmp("view");e.dragZone=Ext.create("Ext.view.DragZone",{view:t,ddGroup:"ddCXCL",dragText:l.localLang.dragText,onInitDrag:function(e,t){var i=this.dragData,a=i.view,n=(a.getSelectionModel(),a.getRecord(i.item));return i.records=[n],i.isSelected=a.selModel.isSelected(n),this.ddel.update(n.get("text")),this.proxy.update(this.ddel.dom),this.onStartDrag(e,t),!0}}),e.dropZone=Ext.create("Ext.view.DropZone",{view:t,ddGroup:"ddCXCL",handleNodeDrop:function(e,t,i){var a,n=this.view,o=n.getStore(),r=e.records;1!=l.sourceCopy&&e.view.store.remove(r),a=o.indexOf(t),"after"===i&&a++,0!=r.length&&(r=o.insert(a,r),e.isSelected&&n.getSelectionModel().select(r,!0))}})}}}};return{xtype:"container",height:300,layout:{type:"hbox",pack:"center"},itemId:"userBox",defaults:{height:"100%"},items:[n,{width:40,xtype:"container",layout:{type:"vbox",align:"center",pack:"center"},itemId:"buttons",defaults:{xtype:"button",cls:"btn JEPLUS_B_C07",margin:"10 0",style:"padding: 3px !important;",handler:function(e){var t=e.up("[itemId=userBox]");l.selectUser(t,e.itemId)}},items:[{iconCls:"fa fa-angle-double-right",itemId:"addAll"},{iconCls:"fa fa-angle-right",itemId:"add"},{iconCls:"fa fa-angle-left",itemId:"remove"},{iconCls:"fa fa-angle-double-left",itemId:"removeAll"}]},i],listeners:{afterrender:function(e){e.readOnly&&e.getCmp("buttons").items.each(function(e){e.setDisabled(!0)})}}}},initUserData:function(){var o=this;o.activeNode&&o.getCmp("node").setValue(o.activeNode.text),o.initData&&Ext.each(o.initData.tasks||[],function(e){var t=o.getCmp("center").getCmp(e.taskName),i=t.getCmp("userBox").getCmp("userview").getCmp("view");for(var a in i.store.removeAll(),i.store.add(e.users),e){var n=t.getCmp(a);n&&n.setValue(e[a])}})},selectUser:function(e,t){var i=this,a=i.wfData,n=e.getCmp("tree").getLayout().getActiveItem(),o=e.getCmp("userview").getCmp("view"),r=n.multiSelect;if("addAll"==t)JE.confirm(i.localLang.selectUserTip.addAllConfirm,function(e){if("ok"==e){var t=[];if(n.getRootNode().cascadeBy(function(e){"entrust"==a.type?"1"==e.get("disabled")||o.store.getById(e.get("id"))||t.push({id:e.get("id"),code:e.get("code"),text:e.get("text"),nodeId:e.get("id")}):"ENDUSER"!=e.get("nodeInfoType")||o.store.getById(e.get("nodeInfo"))||t.push({id:e.get("nodeInfo"),code:e.get("code"),text:e.get("text"),nodeId:e.get("id")})}),r)o.store.add(t);else{if(1<t.length)return void JE.alert(i.localLang.selectUserTip.addAdminAlert);1==t.length&&(o.store.removeAll(),o.store.add(t))}}});else if("add"==t){var l=n.getSelectionModel().getSelection(),s=[],d=!0;if("entrust"==a.type?Ext.each(l,function(e){"1"!=e.get("disabled")&&(d=!1),"1"==e.get("disabled")||o.store.getById(e.get("id"))||s.push({id:e.get("id"),code:e.get("code"),text:e.get("text"),nodeId:e.get("id")})}):Ext.each(l,function(e){"ENDUSER"==e.get("nodeInfoType")&&(d=!1),"ENDUSER"!=e.get("nodeInfoType")||o.store.getById(e.get("nodeInfo"))||s.push({id:e.get("nodeInfo"),code:e.get("code"),text:e.get("text"),nodeId:e.get("id")})}),JE.isNotEmpty(l)&&JE.isEmpty(s))return void(d?JE.msg(i.localLang.selectUserTip.addOneMsg):JE.msg(i.localLang.selectUserTip.addOneSelectMsg));if(JE.isEmpty(s))return void JE.alert(i.localLang.selectUserTip.addOneMsg);if(r)o.store.add(s);else{if(1<s.length)return void JE.alert(i.localLang.selectUserTip.addAdminAlert);1==s.length&&(o.store.removeAll(),o.store.add(s))}}else if("removeAll"==t)JE.confirm(i.localLang.selectUserTip.removeAllConfig,function(e){"ok"==e&&o.store.removeAll()});else if("remove"==t){s=o.getSelectionModel().getSelection();if(JE.isEmpty(s))return void JE.alert(i.localLang.selectUserTip.removeOneSelectAlert);o.store.remove(s)}},getUsers:function(){var e={},n=[],t=[],i=this.getCmp("center"),o=this.activeNode.type;i.items.each(function(i){var a={taskName:i.nodeInfo.code,taskType:i.nodeInfo.type,assgineeInfo:{userIds:[],userNames:[],userCodes:[]},users:[]},e=["sort"];"fork"==o?e.push("doTask","doJoint"):"countersign"==o?e.push("selectUser","countersignType","countersignAssgineId","countersignAssgineName","countersignProportion","sort"):"batchtask"==o&&e.push("sort"),Ext.each(e,function(e){var t=i.getCmp(e).getValue();a[e]=t}),"countersign"==o&&(a.countersignOrder="1"==a.sort);i.getCmp("userBox").getCmp("userview").getCmp("view").store.each(function(e){var t=e.data;a.users.push(t),a.assgineeInfo.userIds.push(t.id),a.assgineeInfo.userNames.push(t.text),a.assgineeInfo.userCodes.push(t.code);var i=!0;Ext.each(n,function(e){if(e.id==t.id)return i=!1}),i&&n.push(t)}),t.push(a)}),e.tasks=t;var a=!0;if("fork"==o){var r=new Array;Ext.each(t,function(e){if("1"==e.doTask&&r.push(e),"1"==e.doTask&&JE.isEmpty(e.users))return a=!1,JE.alert(JE.format(JE.getLocalLang("core.jewfview.wfSendMsg.alert.selectProcessUser"),e.taskName)),!1}),a&&r.length<=0&&(a=!1,JE.alert(JE.getLocalLang("core.jewfview.wfSendMsg.alert.selectToTask")))}return e.users=n,JE.isEmpty(e.users)&&a?(JE.alert(this.localLang.selectUserTip.addOneMsg),!1):a?e:a},doOKAct:function(){var e=this.getUsers();0!=e&&(this.callback&&this.callback(e),this.doCancelAct())},doCancelAct:function(){this.up("window").close()}}),Ext.define("JE.core.view.workflow.WFWinView",{extend:"Ext.panel.Panel",mixins:["JE.core.view.workflow.Util"],alias:"widget.jewfwinview",layout:"border",cls:"je-workflow-formview je-workflow-winview",border:0,initComponent:function(){var t=this;t.localLang=JE.getLocalLang("core.jewfview.workflow",!0),t.items=[{xtype:"uxstepview",region:"north",itemId:"stepview",multiSteps:!0,useStepIcon:!0,height:50},{xtype:"container",layout:"card",region:"center",itemId:"center",defaults:{mainview:t,autoScroll:!0},items:[{xtype:"jewfnodeview",itemId:"node",showType:"win",step:1},{xtype:"jewfuserview",wfData:t.wfData,showType:"win",itemId:"user",step:2},{xtype:"jewfmsgview",itemId:"msg",btnType:t.btnType,step:3}]}],t.buttons={itemId:"buttonBar",items:[{itemId:"prev",text:t.localLang.winPrevStep,disabled:!0,handler:function(e){t.setStepPanel(e.itemId)}},{itemId:"next",cls:"JEPLUS_B_L10",text:t.localLang.winNextStep,handler:function(e){t.setStepPanel(e.itemId)}}]},t.callParent(arguments)},afterRender:function(){this.callParent(arguments),this.getCmp("stepview").loadStep([{code:"1",text:this.localLang.winStep1,active:!0},{code:"2",text:this.localLang.winStep2,active:!1},{code:"3",text:this.localLang.winStep3,active:!1}])},setStepPanel:function(e){var t=this.activeStep;"prev"==e?t--:t++;var i=!0;if("next"==e&&(i=this.setActiveStep(t)),0!=i){this.activeStep=t,this.getCmp("stepview").setStep(t),this.getCmp("center").getLayout().setActiveItem(t-1);var a=this.getDockedCmp("buttonBar").getCmp("prev"),n=this.getDockedCmp("buttonBar").getCmp("next");a.setDisabled(1==t),n.setText(3==t?this.wfData.buttonText:this.localLang.winNextStep)}},initViewData:function(){var e=this.getCmp("center").getCmp("node");JE.isEmpty(this.taskNodes)&&(this.taskNodes=[this.activeNode]),e.store.add(this.taskNodes),e.setActiveNode(this.taskNodes[0])},getSubmitInfo:function(){var e=this.getCmp("center").getCmp("msg").getCmp("msg").getValue(),t=this.getCmp("center").getCmp("msg").getCmp("files"),i=[];return t.store.each(function(e){i.push(e.data)}),{submitComments:e,commentDetails:Ext.encode(i)}},setSubmitMsg:function(e){this.getCmp("center").getCmp("msg").getCmp("msg").setValue(e)},activeStep:1,setActiveStep:function(e,t){var i=this;if(1==e){if(i.activeNode=t.node,1==i.taskNodes.length)return i.setStepPanel("next"),!1}else if(2==e){var a=i.getCmp("center").getCmp("node").view.getSelectionModel().getSelection()[0];i.activeNode=a?a.data:i.activeNode;var n=i.getCmp("center").getCmp("user"),o=i.taskNodeUsers[i.activeNode.code];if(i.activeUserInfo=i.getInitUsers(),Ext.apply(n,{activeNode:i.activeNode,initData:i.activeUserInfo,users:o,wfData:i.wfData}),n.removeAll(),n.add(n.buildItems()),n.initUserData(),JE.isEmpty(o)||-1==["fork"].indexOf(i.activeNode.type)&&i.activeUserInfo&&i.activeUserInfo.single)return i.activeStep=2,i.setStepPanel("next"),!1}else if(3==e){n=i.getCmp("center").getCmp("user");if(JE.isEmpty(i.taskNodeUsers[i.activeNode.code]))i.activeUserInfo={};else if(i.activeUserInfo=n.getUsers(),0==i.activeUserInfo)return!1;var r={node:i.activeNode.code,user:i.activeUserInfo.users,msg:i.wfData.comment};i.getCmp("center").getCmp("msg").initMsgData(r),i.getDockedCmp("buttonBar").getCmp("prev").setVisible(JE.isNotEmpty(r.user))}else if(4==e)return i.doWFSubmitAction(function(){i.up("window").close()}),!1}}),Ext.define("JE.core.view.workflow.WorkTaskView",{extend:"JE.core.ux.StepView",alias:"widget.jewfworktaskview",initComponent:function(){this.localLang=JE.getLocalLang("core.jewfview.workflow",!0),this.storeFields=["code","text","active","user","users"],this.itemTpl=['<div class="item <tpl if="active">active</tpl> <tpl if="user">user</tpl> <tpl if="JE.isNotEmpty(users)"></tpl>" style="{[this.cmp.getTextWidth(values)]}">{text}','<tpl if="user"> <i class="fa fa-user"></i><span class="users">{[this.cmp.getUsers(values.users)]}</span></tpl>',"</div>"].join(""),this.callParent(arguments)},getTextWidth:function(e){var t=this.getUsers(e.users),i=7*(e.text+t).strLen()+40+20+40;return"width:"+(1/this.getCmp("view").getStore().getCount()*100).toFixed(2)+"%;min-width:"+i+"px;"},getUsers:function(e){var t=[];e=e||[];return Ext.each(e,function(e){e.red?t.push('<font color="red">'+e.name+"</font>"):t.push(e.name)}),0<t.length?"【"+t.join("，")+"】":""},itemClick:function(e,o){var r=this.wfInfo,t=o.get("user");o.get("users");if((!JE.isNotEmpty(r.piid)||1==r.doTaskUserDiy)&&t){var i=JE.ajax({url:JE.getUrlMaps("je.core.wf.taskInfo","loadTaskAssgine"),params:{beanId:r.pkValue,pkValue:r.pkValue,pdid:r.pdid,userDiy:"1",targerTaskName:o.get("text")}}),a=i[0].children[0],n=Ext.decode(Ext.value(i[0].description,"{}")),l={};if("DEPTUSER"==a.code&&n.async){var s={ddCode:"JE_CORE_DEPTUSER",ddName:a.text,nodeInfo:"",async:!0,wfUser:!0,whereSql:Ext.value(n.whereSql),orderSql:Ext.value(n.orderSql),parentSql:"",rootId:"ROOT",params:{},initParams:{},moreRoot:!1,queryField:"",nodeField:"",formatValue:""};l.configInfo=[s],l.async=!0,l.loadInfo={url:"/jbpm/taskInfoAction!loadAsyncAssgine.action",params:{node:"ROOT",onlyItem:!1,excludes:"checked",whereSql:"",orderSql:"",pdid:r.pdid,userDiy:"1",targerTaskName:o.get("text"),strData:Ext.encode(l.configInfo)}}}l.searchTpl=['<ul class="'+Ext.plainListCls+'">','<tpl for=".">','<li role="option" unselectable="on" class="x-boundlist-item">{[this.innerTpl(values)]}</li>',"</tpl>","</ul>",{innerTpl:function(e){return JE.isNotEmpty(e.parentText)&&e.leaf?e.text+"("+e.parentText+")":e.text}}],JE.selectWin({title:this.localLang.userTitle,type:"tree",rootData:{id:"ROOT",text:"ROOT",children:a.children},treeConfig:l,multiSelect:-1!=["batchtask","joint","countersign"].indexOf(i[0].nodeInfoType),callback:function(e){var t=[],i=[],a=[];Ext.each(e,function(e){a.push({name:e.get("text"),id:e.get("nodeInfo"),red:!1}),t.push(e.get("nodeInfo")),i.push(e.get("text"))});var n=JE.ajax({url:JE.getUrlMaps("je.core.wf.taskInfo","doSetDiyUser"),params:{pdid:r.pdid,pkValue:r.pkValue,taskName:o.get("text"),userIds:t.join(","),userNames:i.join(",")}});n.success?(JE.msg(n.obj),o.set("users",a),o.commit()):JE.alert(n.obj)}})}},loadTask:function(d,e){var t={pkValue:(this.wfInfo=d).pkValue};"NOSTATUS"==d.audFlag&&e?t.pdid=e:(t.piid=d.piid,t.pdid=d.pdid);var i=[];JE.isNotEmpty(t.pkValue)&&JE.isNotEmpty(t.pdid)&&(i=JE.ajax({url:JE.getUrlMaps("je.core.wf.taskInfo","getWfTaskName"),params:t}),this.wfInfo.pdid=t.pdid);var c=[];Ext.each(i,function(e){var t=!1;d.taskName==e.name&&(t=!0);var i=!1,a=new Array;if(e.userDiyAble&&(i=!0,JE.isNotEmpty(e.beanMethod)))for(var n=e.beanName.split(","),o=e.beanMethod.split(","),r=Ext.value(e.beforeTaskNames,"").split(","),l=0;l<o.length;l++){var s={name:n[l],id:o[l],red:!1};-1!=r.indexOf(s.id)&&(s.red=!0),a.push(s)}c.push({id:e.name,text:e.name,active:t,user:i,users:a})}),this.loadStep(c)}}),Ext.define("JE.core.controller.TreeCtr",{initTree:function(e){e=Ext.apply(e,{"jetreeview[ref=query]":{itemclick:function(e,t){},selectionchange:function(e,t,i){var a=e.view.panel,n=a.funcData.info,o=Ext.value(n.idSuffix,""),r=a.nextSibling(),l=a.up("jedataview"),s=(Ext.isEmpty(l)||Ext.isEmpty(l.type)?n.funcCode:l.getId())+"_jegridview"+o,d=Ext.getCmp(s);if("SIMPLE"==e.selectionMode)t=a.getChecked();else if("func"==n.funcType&&"LIST"==n.insertType&&(f=0<t.length?t[0]:e.getLastSelected())){var c=f.get("nodeInfo"),u=f.get("code"),p=d.headerCt.down("[isFormField][name="+c+"]");p&&(0<t.length?p.setValue(u):p.reset())}if("tree"==n.funcType&&1==a.searchModel&&d.gridEditBtnPrem()){if(0==t.length)return;var f=t[0],E=JE.ajax({url:n.funcAction+"!getInfoById.action",params:{tableCode:n.viewTableName,pkValue:f.get("id")}}),m=Ext.create(d.store.model.$className,E);JE.Action.doEdit(d,m,n)}else r||JE.Action.doTreeQueryGrid(a,d)}}})}}),Ext.define("JE.core.controller.WFCtr",{initWF:function(e){var t=JE.getLocalLang("core.jewfview.alert");e=Ext.apply(e,{"form[useWF] button[ref^=wf]":{beforeclick:function(e){var t=e.up("form[useWF]");t.__activeWFButton=e.ref;var i=t.wfInfo;if(i&&i.info);else{var a=e.pdid;if((i=Ext.value(i,{})).info=t.funcData.wf.infos[a],JE.isEmpty(i.info)){var n=JE.ajax({url:JE.getUrlMaps("je.core.wf.taskInfo","loadWfPdInfo"),params:{pdid:a}});n.success&&(i.info=n.info,t.funcData.wf.infos[a]=n.info)}}var o=JE.Action.doWFResetWFForm(t,e);if(0==o)return o;if(JE.isNotEmpty(i)){var r=JE.Action.getWFButtonEvent(i,t.__activeWFButton,"beforeclick");if(r)return r(t,i,t.__activeWFButton)}}},"form[useWF] button[ref=wfStartBtn]":{click:function(t){var e=t.up("form[useWF]"),i=e.getButton("formSaveBtn"),a=e.getValue(e.funcData.info.pkName);i&&!i.isHidden()&&(0<e.getChanges().getCount()||Ext.isEmpty(a))?(e.on({endsubmit:{fn:function(e){e.wfInfo.pdid=t.pdid,JE.Action.doWFStart(e)},single:!0}}),i.fireHandler()):(e.wfInfo.pdid=t.pdid,JE.Action.doWFStart(e))}},"form[useWF] button[ref=wfSponsorBtn]":{click:function(t){var e=t.up("form[useWF]"),i=e.getButton("formSaveBtn"),a=e.getValue(e.funcData.info.pkName);i&&!i.isHidden()&&(0<e.getChanges().getCount()||Ext.isEmpty(a))?(e.on({endsubmit:{fn:function(e){e.wfInfo.pdid=t.pdid,e.wfInfo.piid="",e.wfInfo.info=e.funcData.wf.infos[t.pdid],e.wfInfo.taskName=e.wfInfo.info.firstTaskNode,JE.Action.doWFSubmitWin(e,"sponsor",t)},single:!0}}),i.fireHandler()):(e.wfInfo.pdid=t.pdid,e.wfInfo.piid="",e.wfInfo.info=e.funcData.wf.infos[t.pdid],e.wfInfo.taskName=e.wfInfo.info.firstTaskNode,JE.Action.doWFSubmitWin(e,"sponsor",t))}},"form[useWF] button[ref=wfBackBtn]":{click:function(e){var t=e.up("form[useWF]");JE.Action.doWFSubmitWin(t,"back",e)}},"form[useWF] button[ref=wfSubmitBtn]":{click:function(t){var e=t.up("form[useWF]"),i=e.down("button[ref=formSaveBtn]");if(i&&!i.isHidden()&&0<e.getChanges().getCount()){var a=e.__activeWFButton;e.on({endsubmit:{fn:function(e){JE.isNotEmpty(a)&&(e.__activeWFButton=a),JE.Action.doWFSubmitWin(e,"submit",t)},single:!0}}),i.fireHandler()}else JE.Action.doWFSubmitWin(e,"submit",t)}},"form[useWF] button[ref=wfAllotBtn]":{click:function(e){var t=e.up("form[useWF]");JE.Action.doWFSubmitWin(t,"allot",e)}},"form[useWF] button[ref=wfReturnBtn]":{click:function(e){var t=e.up("form[useWF]");JE.Action.doWFSubmitWin(t,"return",e)}},"form[useWF] button[ref=wfReturnSubmitBtn]":{click:function(e){var t=e.up("form[useWF]");JE.Action.doWFSubmitWin(t,"returnsubmit",e)}},"form[useWF] button[ref=wfNextDiyUserBtn]":{click:function(e){var t=e.up("form[useWF]");JE.Action.doWFSubmitWin(t,"nextdiyuser",e)}},"form[useWF] button[ref=wfRejectBtn]":{click:function(e){var t=e.up("form[useWF]");JE.Action.doWFSubmitWin(t,"reject",e)}},"form[useWF] button[ref=wfTakeBtn]":{click:function(e){var t=e.up("form[useWF]");JE.Action.doWFTake(t)}},"form[useWF] button[ref=wfCancelBtn]":{click:function(e){var i=e.up("form[useWF]");JE.confirm(t.cancelWfConfirm,function(e,t){"ok"==e&&JE.Action.doWFCancel(i)})}},"form[useWF] button[ref=wfBackDiyUserBtn]":{click:function(e){var i=e.up("form[useWF]");JE.confirm(t.userDiyWfConfirm,function(e,t){"ok"==e&&JE.Action.doWFUserDiy(i)})}},"form[useWF] button[ref=wfEntrustBtn]":{click:function(e){var t=e.up("form[useWF]");JE.Action.doWFSubmitWin(t,"entrust",e)}},"form[useWF] button[ref=wfCallEntrustBtn]":{click:function(e){var t=e.up("form[useWF]");JE.Action.doWFSubmitWin(t,"callentrust",e)}},"form[useWF] button[ref=wfTransmitBtn]":{click:function(e){var t=e.up("form[useWF]");JE.Action.doWFSubmitWin(t,"transmit",e)}},"form[useWF] button[ref=wfChagenTaskBtn]":{click:function(e){var t=e.up("form[useWF]");JE.Action.doChangeTask(t)}},"form[useWF] button[ref=wfChangeFormBtn]":{click:function(e){var t=e.up("form[useWF]");JE.Action.doChangeForm(t)}},"form[useWF] button[ref=wfLczzBtn]":{click:function(e){var t=e.up("form[useWF]"),i=t.getValue("SY_AUDFLAG");if(Ext.isEmpty(i)||"NOSTATUS"==i){var a=[];for(var n in t.funcData.wf.versions){var o=t.funcData.wf.infos[t.funcData.wf.versions[n].newest];a.push({pdid:o.processDefinitionId,code:o.processKey,title:o.processName,text:o.processName})}1==a.length?JE.Action.showWFImage(a[0]):(e.wfmenu||(e.wfmenu=Ext.create("Ext.menu.Menu",{shadow:!1,cls:"je-menu-item34h je-menu-arrow je-menu-arrow-tr",plain:!0,defaults:{handler:function(e){JE.Action.showWFImage(e)}},items:a})),e.wfmenu.showBy(e,"tr-br",[10,0]))}else JE.Action.doWFImageWin(t)}},"jewfsendmsgview button[ref=send]":{click:function(e){var t=e.up("jewfsendmsgview");t.wfBatch?(t.haveEnd=!1,JE.Action.doWFBatch(t)):"submit"==t.type?(t.haveEnd=!1,JE.Action.doWFSubmit(t)):"allot"==t.type?JE.Action.doWFAllot(t):"return"==t.type?JE.Action.doWFReturn(t):"reject"==t.type?JE.Action.doWFReject(t):"returnsubmit"==t.type?JE.Action.doWFReturnSubmit(t):"nextdiyuser"==t.type?JE.Action.doWFNextDiySubmit(t):"back"==t.type?JE.Action.doWFBack(t):"takeround"==t.type?JE.Action.doWFTakeRound(t):"nopass"==t.type?JE.Action.doWFNoPass(t):"pass"==t.type||"changepass"==t.type?JE.Action.doWFPass(t):"waiverpass"==t.type?JE.Action.doWFWaiverPass(t):"callentrust"==t.type?JE.Action.doWFCallEntrust(t):"entrust"==t.type?JE.Action.doWFEntrust(t):"transmit"==t.type?JE.Action.doWFTransmit(t):"sponsor"==t.type?(t.haveEnd=!1,JE.Action.doWFSponsor(t)):"suspend"==t.type&&(t.haveEnd=!1,JE.Action.doWFSuspend(t))}},"jewfsendmsgview button[ref=end]":{click:function(e){var t=e.up("jewfsendmsgview");t.haveEnd=!0,JE.Action.doWFEnd(t)}},"jewfsendmsgview button[ref=returnback]":{click:function(e){var t=e.up("jewfsendmsgview");JE.Action.doWFReturnBack(t)}},"jewfsendmsgview button[ref=nopass]":{click:function(e){var t=e.up("jewfsendmsgview");JE.Action.doWFNoPass(t)}},"jewfsendmsgview button[ref=waiverpass]":{click:function(e){var t=e.up("jewfsendmsgview");JE.Action.doWFWaiverPass(t)}},"form[useWF] button[ref=wfPassBtn]":{click:function(e){var t=e.up("form[useWF]");JE.Action.doWFSubmitWin(t,"pass",e)}},"form[useWF] button[ref=wfNoPassBtn]":{click:function(e){var t=e.up("form[useWF]");JE.Action.doWFSubmitWin(t,"nopass",e)}},"form[useWF] button[ref=wfWaiverPassBtn]":{click:function(e){var t=e.up("form[useWF]");JE.Action.doWFSubmitWin(t,"waiverpass",e)}},"form[useWF] button[ref=wfChangePassBtn]":{click:function(e){var t=e.up("form[useWF]");JE.Action.doWFSubmitWin(t,"changepass",e)}},"form[useWF] button[ref=wfRoundBtn]":{click:function(e){var t=e.up("form[useWF]");JE.Action.doWFRound(t)}},"form[useWF] button[ref=wfTakeRoundBtn]":{click:function(e){var t=e.up("form[useWF]");JE.Action.doWFSubmitWin(t,"takeround",e)}},"form[useWF] button[ref=wfSuspendBtn]":{click:function(e){var t=e.up("form[useWF]");JE.Action.doWFSubmitWin(t,"suspend",e)}},"form[useWF] button[ref=wfPromptBtn]":{click:function(e){var t=e.up("form[useWF]");t=e.up("form[useWF]");JE.Action.doWFPromptWin(t)}}})}}),Ext.define("JE.core.controller.ButtonCtr",{initButton:function(e){var r=this;e=Ext.apply(e,{"jegridview toolbar [ref=gridInsertBtn]":{click:function(e){var t=e.up("jegridview");JE.Action.doAdd(t,t.funcData.info,e)}},"jelistview toolbar [ref=gridInsertBtn]":{click:function(e){var t=e.up("jelistview");JE.Action.doAdd(t,t.funcData.info,e)}},"jegridview toolbar [ref=gridRemoveBtn]":{click:function(e){var t=e.up("jegridview");e.allowAfterClick=!1,JE.Action.doRemove(t,t.funcData.info,null,!1,e)}},"jelistview toolbar [ref=gridRemoveBtn]":{click:function(e){var t=e.up("jelistview");e.allowAfterClick=!1,JE.Action.doRemove(t,t.funcData.info,null,!1,e)}},"jegridview toolbar [ref=gridDisabledBtn]":{click:function(e){var t=e.up("jegridview");e.allowAfterClick=!1,JE.Action.doRemove(t,t.funcData.info,null,!0,e)}},"jelistview toolbar [ref=gridDisabledBtn]":{click:function(e){var t=e.up("jelistview");e.allowAfterClick=!1,JE.Action.doRemove(t,t.funcData.info,null,!0,e)}},"jegridview toolbar [ref=gridUpdateBtn]":{click:function(e){var t=e.up("jegridview");JE.Action.doUpdateList(t,t.funcData.info,null,e)}},"jelistview toolbar [ref=gridUpdateBtn]":{click:function(e){var t=e.up("jelistview");JE.Action.doUpdateList(t,t.funcData.info,null,e)}},"jegridview toolbar [ref=gridEditBtn]":{click:function(e){var t=e.up("jegridview"),i=t.getSelectionModel().getSelection();if(1==i.length)JE.Action.doEdit(t,i[0],t.funcData.info);else{if(0==i.length)return void JE.alert(t.localLang.alert.editNoSelect);if(1<i.length)return void JE.alert(JE.format(t.localLang.alert.editOneSelect,i.length))}}},"jelistview toolbar [ref=gridEditBtn]":{click:function(e){var t=e.up("jelistview"),i=t.getSelectionModel().getSelection();if(1==i.length)JE.Action.doEdit(t,i[0],t.funcData.info);else{if(0==i.length)return void JE.alert(t.localLang.alert.editNoSelect);if(1<i.length)return void JE.alert(JE.format(t.localLang.alert.editOneSelect,i.length))}}},"jegridview toolbar [ref=gridExportXLSBtn]":{click:function(e){var t=e.up("jegridview"),i=t.funcData.info;JE.Action.doExpExcel(t,i)}},"jelistview toolbar [ref=gridExportXLSBtn]":{click:function(e){var t=e.up("jelistview"),i=t.funcData.info;JE.Action.doExpExcel(t,i)}},"jegridview actioncolumn[funcColumn]":{beforerender:function(e){Ext.each(e.items,function(l){var s=l.listeners;JE.isNotEmpty(s)&&(s.handler&&(l.handler=function(e,t,i,a,n,o,r){JE.doButtonLog(l),s.handler(e.panel,o,t,i)}),s.isEnabled&&(l.isDisabled=function(e,t,i,a,n){return 0==s.isEnabled(e.panel,n,t,i)}),(s.getClass||s.isHidden)&&(l.getClass=function(e,t,i,a,n,o){var r=l.iconCls;return s.getClass&&(r=Ext.value(s.getClass(o.gridObj,i,a,n),r)),s.isHidden&&(r+=" "+(1==s.isHidden(o.gridObj,i,a,n)?" je-grid-actioncolumn-itemhidden":"")),r}),s.getStyle&&(l.getStyle=s.getStyle)),delete l.listeners})}},"jeformview toolbar [enableFormBind]":{beforeclick:function(e){var t=e.up("jeformview");return JE.Action.checkFieldValid(t,e)}},"jeformview toolbar [ref=formSaveBtn]":{click:function(e){var t=e.up("jeformview");JE.Action.doUpdate(t,t.funcData.info,"save",e)}},"jeformview toolbar [ref=formSubmitBtn]":{click:function(e){var t=e.up("jeformview");JE.Action.doSh(t,t.funcData.info,"submit",e)}},"jeformview toolbar [ref=formCacelBtn]":{click:function(e){var t=e.up("jeformview");JE.Action.doSh(t,t.funcData.info,"cacel",e)}},"jeformview toolbar [ref=formNewBtn]":{click:function(e){var t=e.up("jeformview");JE.Action.doUpdate(t,t.funcData.info,"new",e)}},"jeformview toolbar [ref=formCopyBtn]":{click:function(e){var t=e.up("jeformview");JE.Action.doUpdate(t,t.funcData.info,"copy",e)}},"jeformview toolbar [ref=formBackBtn]":{click:function(e){var t=e.up("jeformview");JE.Action.doBack(t,t.funcData.info)}},"jeformview toolbar [locateBtn]":{click:function(e){var t=e.up("jeformview");JE.Action.doLocation(t,e.info)}},"jeformview[type=query] button[ref=groupQuery]":{click:function(e){var t=e.up("jeformview");JE.Action.doGroupQuery(t.gridObj,t,"form")}},"jeformview[type=query] button[ref=groupClose]":{click:function(e){var t=e.up("jeformview");if(t.allQuickQuery)t.up("window").close();else{t.gridObj;t.hide(),t.resetQuery(!0)}}},"jeformview[type=query] button[ref=groupReset]":{click:function(e){e.up("jeformview").resetQuery(!0)}},"jeformview[type=query] button[ref=groupSave]":{click:function(e){var t=e.up("jeformview"),o=(t.funcData.info.idSuffix,t.funcData.info.funcCode),r=t.gridObj,l=r.store.sqls.group,s=t.localLang.groupQuery;Ext.isEmpty(l)?JE.alert(s.saveCxclAlert.no):JE.prompt(s.saveCxclAlert.name,function(e,t){if("ok"==e){var i={QUERYSTRATEGY_NAME:t,QUERYSTRATEGY_SQL:l,QUERYSTRATEGY_USERID:JE.currentUser.userId,QUERYSTRATEGY_FUNCCODE:o,tableCode:"JE_CORE_QUERYSTRATEGY"},a=JE.ajax({url:JE.getUrlMaps("je.core.save"),params:i});if(a.success){JE.msg(s.saveCxclAlert.addOk);var n=r.getDockedComponent("queryCL");n&&n.store.load()}else JE.alert(a.obj)}})}},"jeformview[type=query] button[ref=groupOrderBtn]":{click:function(e){var t=e.up("jeformview"),i=e.nextSibling("hidden[name="+e.fieldName+"__order]"),a=i.getValue();"asc"==a?(i.setValue("desc"),e.setTooltip(t.localLang.groupQuery.orderAscTip),e.setIconCls("fa fa-sort-alpha-desc")):"desc"==a?(i.setValue(""),e.setTooltip(t.localLang.groupQuery.orderTip),e.setIconCls("fa fa-sort")):(i.setValue("asc"),e.setTooltip(t.localLang.groupQuery.orderDescTip),e.setIconCls("fa fa-sort-alpha-asc"))}},"toolbar [JE_FuncPerm][ref=JE_FuncPerm]":{click:function(e){var t=e.up("jegridview"),i="";i=JE.isEmpty(t)?(t=e.up("jeformview")).up("jemainview").down("jegridview"):e.ownerCt.ownerButton.ownerCt.ownerCt;var a=t.funcData.info,n=a.funcCode,o=a.funcId;JE.showFuncCfg(o,"powerview",n,{type:"ZH",funcInfo:a,selfContr:r,cmp:i})}},"toolbar [JE_FuncHelp][ref=JE_FuncHelp]":{click:function(e){var t="";e.JE_CommonHelp?t=JE.systemConfig.JE_FUNC_COMMONHELP_TPL:(t=JE.ajax({url:JE.getUrlMaps("je.core.getInfoById"),params:{tableCode:"JE_CORE_FUNCINFO",pkValue:e.funcId}}).FUNCINFO_HELP,t=Ext.isEmpty(t)?JE.getLocalLang("core.jemainview.common.helpButton.noInfo"):Ext.htmlDecode(t));var i={},a=JE.getFuncData(e.funcCode).info.helpSource;JE.isNotEmpty(a)&&(i=JE.getDataSource(a).load({funcCode:funcCode,funcId:funcId})),t=JE.toXT(t,i),JE.win({title:JE.getLocalLang("core.jemainview.common.helpButton.title"),iconCls:"plus"==JE.getTheme()?e.iconCls:"jeicon jeicon-question-circle",html:t,bodyStyle:"padding:5px;background-color:#ffffff;",autoScroll:!0,autoShow:!0})}}})}}),Ext.define("JE.core.controller.FormCtr",{initForm:function(e){e=Ext.apply(e,{jeformview:{setvalues:function(a,n,e){var t=a.funcData;if(!Ext.isArray(n)&&!Ext.isEmpty(t)){if(a.getFields().each(function(e){e.hasListener("setvalue")&&e.fireEvent("setvalue",e,n[e.name]),JE.isNotEmpty(e.cascadeField)&&e.initCascadeInfo(n)}),t.info.postil){var i=a.getCmp("buttonBar").getCmp("postilBtn");i.setText("批注("+JE.toNum(n.SY__POSTIL)+")"),i.formObj=a}var o=a.formTitleBox;o&&o.update(n);var r,l=a.query("uxdisplayfield[formCode="+t.info.funcCode+"_form]");if(Ext.each(l,function(e){e.updateTpl(n)}),0!=e){if(!Ext.isEmpty(t.form.childFuncFields)){var s=a.query("childfuncfield[formCode="+t.info.funcCode+"_form]");Ext.each(s,function(e){e.doLoad(n)})}var d=a.formHistorySet;d&&d.loadHistory(n);var c=a.formFilesSet;c&&c.loadFiles();var u=a.formWFLog;u&&u.loadWfLog(n)}Ext.iterate(t.fieldExp,function(e,t){var i=a.form.findField(e);JE.Action.doFieldExp(a,i,n,!0)});var p=Ext.getCmp(t.info.funcCode+"_jemainview"+Ext.value(t.info.idSuffix,""));if(p&&(r=p.readOnly,a.setReadOnly(r)),Ext.isEmpty(r)||!r)if(a.formSaveBtnPrem()){if(!Ext.isEmpty(n[t.info.pkName])&&t.permInfo.selfUpdate){var f="SY_CREATEUSERID";JE.isNotEmpty(t.permInfo.userField)&&(f=t.permInfo.userField),r=n[f]!=JE.currentUser.userId,a.setReadOnly(r)}}else r=!0,a.setReadOnly(r);if(1==a.useWF){var E=a.getRecord(),m=Ext.clone(n);E&&E.raw&&!Ext.isEmpty(E.raw[t.info.pkName])&&(Ext.isEmpty(E.raw.__doTask)||(m.__doTask=E.raw.__doTask),Ext.isEmpty(E.raw.__doTaskForm)||(m.__doTaskForm=E.raw.__doTaskForm)),JE.Action.doWFResetWFForm(a),JE.Action.doWFFormEdit(a,m)}t.info.sh&&!t.info.wf&&a.setReadOnly("1"==n.SY_ACKFLAG)}}}})}}),Ext.define("JE.core.controller.GridCtr",{initGrid:function(e){var t={itemdblclick:function(e,t){var i=e.panel;if(i=e.lockingPartner?i.ownerLockable:i,Ext.isEmpty(i.type)&&i.gridEditBtnPrem()){var a=i.funcData.info;i.getSelectionModel().select(t),"FORMWIN"==a.insertType&&"1"==JE.getObjAttr(a.otherConfig,"formWinEdit")?JE.Action.doFormWinEdit(i,t,a):JE.Action.doEdit(i,t,a)}},selectionchange:function(e,t){var i=e.view,a=i.panel;if(a=i.lockingPartner?a.ownerLockable:a,Ext.isEmpty(a.type)){var n=a.getDockedCmp("buttonMultiBar");if(n){n.setVisible(JE.isNotEmpty(t)),n.getCmp("selectNum").update({num:t.length});var o=a.getDockedCmp("buttonBar");o&&o.setVisible(JE.isEmpty(t))}var r,l=t[0];Ext.getCmp(a.funcData.info.funcCode+"_childs_data"+a.funcData.info.idSuffix)&&(0<t.length&&(r=(l=t[t.length-1]).data,a.funcData.info.gridChildFilter||(t=[])),JE.CoreUtil.setChildInfo({funcData:a.funcData,data:r,datas:t,readOnly:a.readOnly})),JE.Action.doListForm(l,a.funcData.info)}}};e=Ext.apply(e,{jegridview:Ext.apply({loadrecords:function(e,t){var i=JE.CoreUtil.buildMergesInfo(e.gridObj.funcData.info.merges,t);Ext.apply(e,i)},load:function(e){var t=e.gridObj.getColumn("rownumberer_1");if(t){var i=7*(e.currentPage*e.pageSize).toString().strLen()+10,a=t.initialConfig.width;t.setWidth(a<i?i:a)}}},t),jelistview:t})}}),Ext.define("JE.core.controller.MainCtr",{extend:"Ext.app.Controller",mixins:["JE.core.util.ChildUtil","JE.core.controller.GridCtr","JE.core.controller.ButtonCtr","JE.core.controller.TreeCtr","JE.core.controller.FormCtr","JE.core.controller.WFCtr"],init:function(){var e={jemainview:{beforeactivate:function(t){var i=t.funcData.info,a=i.idSuffix,e=Ext.getCmp(i.funcCode+"_jegridview"+a);if(e&&e.hasListener("activate")&&e.fireEvent("activate",e),t.buildItems)if(1==t.needRefreshFunc)t.refreshFunc();else{var n=Ext.getCmp(i.funcCode+"_jecenterview"+Ext.value(i.idSuffix,""));if(n)"jedataview"==n.getLayout().getActiveItem().xtype&&t.refreshFunc()}else Ext.defer(function(){t.buildItem();var e=Ext.getCmp(i.funcCode+"_jegridview"+a);e&&e.hasListener("activate")&&e.fireEvent("activate",e),"form"!=t.showView&&"formData"!=t.showView||t.refreshFunc()},50);delete t.needRefreshFunc},activate:function(e){if(Ext.isEmpty(e.type)&&e.funcData&&e.funcData.info.oneInForm){var t=e.funcData,i=Ext.getCmp(t.info.funcCode+"_jegridview"+Ext.value(t.info.idSuffix,""));i&&JE.defer(function(){if(!i.store.isLoading()){if(1==i.store.getCount()){var e=i.store.getAt(0);Ext.getCmp(t.info.funcCode+"_jecenterview"+Ext.value(t.info.idSuffix,"")).getLayout().setActiveItem("jedataview"),i.getSelectionModel().select(e),i.fireEvent("itemdblclick",i.view,e)}return!1}},100)}}}};this.initGrid(e),this.initButton(e),this.initTree(e),this.initForm(e),this.initWF(e),this.control(e)},views:["JE.core.view.TabMainView","JE.core.view.MainView","JE.core.view.CenterView","JE.core.view.DataView","JE.core.view.EditView","JE.core.view.GridView","JE.core.view.TreeView","JE.core.view.TreeGridView","JE.core.view.FormView","JE.core.view.FormGridView","JE.core.view.wf.WFSendMsgView","JE.core.view.wf.WFImageView","JE.core.view.wf.WFPromptView","JE.core.view.wf.WFProcessUserView","JE.core.view.wf.WFTaskUserView","JE.core.view.wf.GraphView","JE.core.view.wf.util.Editor","JE.core.view.workflow.WFFormView","JE.core.view.workflow.WFNodeView","JE.core.view.workflow.WFUserView","JE.core.view.workflow.WFFileView","JE.core.view.workflow.WorkTaskView","JE.core.view.workflow.WFMsgView","JE.core.view.workflow.WFWinView","JE.core.view.UxView","JE.core.view.ChartView","JE.core.view.ReportView","JE.core.view.CodeEditor","JE.core.view.ListenerEditor","JE.core.view.IDITEditor","JE.core.view.industry.IndustryView","JE.core.view.PortalMenuView","JE.core.view.IconView","JE.core.view.tool.SMSView","JE.core.view.tool.EmailView","JE.core.view.tool.TPView","JE.core.view.tool.TPInfoView","JE.core.view.tool.SearchView","JE.core.view.tool.CxclView","JE.core.view.tool.IDITColumnView","JE.core.view.tool.HistoryView","JE.core.view.PortalView","JE.core.view.ListView"],stores:[],models:[]}),Ext.define("JE.sys.email.view.EmailRead",{extend:"Ext.panel.Panel",alias:"widget.email.emailread",initComponent:function(){var i=this;i.localLang=JE.getLocalLang("sys.email.emailReadEdit"),Ext.apply(i.localLang,JE.getLocalLang("sys.email.common")),i.bodyStyle="background-color:#fff;",i.layout="border";var e=i.emailInfo.data,t={xtype:"multiitem",menuConfig:{items:[{text:i.localLang.joinAddressBook,iconCls:"jeicon jeicon-lxrgl-pc ",handler:function(e){i.mainview.getCmp("emaillist").addAddress(e.ownerCt.fieldInfo.record.data)}}]},readOnly:!0,listeners:{afterrender:function(e){e.itemsview.getEl().setStyle({borderWidth:"0px",backgroundColor:"rgb(244, 244, 244)"})}}};i.items=[{xtype:"panel",region:"north",layout:"column",bodyPadding:"10 40 0 40",border:0,minHeight:90,autoScroll:!0,split:!0,collapsible:!0,hideCollapseTool:!0,titleCollapse:!0,collapseMode:"mini",defaults:{labelAlign:"right",labelWidth:80,margin:1,columnWidth:1},bodyStyle:"background:rgb(244, 244, 244)",items:[{xtype:"box",data:e,height:30,tpl:['<h1 style="margin:0px;font-family:黑体;">{EMAILDATA_BT}</h1>','<div style="position: absolute;right: 50px;top: 16px;"><input name="kd" type="button" class="jeicon jeicon-mail je-button-icon" style="margin-right:10px;cursor: pointer;" title="'+i.localLang.expressage+'"><input name="hf" type="button" class="jeicon jeicon-mail-editor je-button-icon" style="margin-right:10px;cursor: pointer;" title="'+i.localLang.reply+'"><input name="zf" type="button" class="jeicon jeicon-forward je-button-icon" style="margin-right:10px;cursor: pointer;" title="'+i.localLang.transpond+'"><input name="print" type="button" class="jeicon jeicon-print je-button-icon" style="cursor: pointer;" title="'+i.localLang.print+'"></div>'],listeners:{afterrender:function(e){e.getEl().down("input[name=kd]").on("click",function(){var e=i.emailInfo.data,t=Ext.value(e.EMAILDATA_ZW,"");t="TEXT"==e.EMAILDATA_CONTEXTTYPE?t.replaceAll("\n","<br/>"):Ext.htmlDecode(t),JE.showFunc("JE_SYS_OUTBOX",{type:"form",values:{OUTBOX_SUBJECT:e.EMAILDATA_BT,OUTBOX_CONTEXT:t,OUTBOX_DFJ:e.EMAILDATA_FJ},callback:function(e){e.on("endsubmit",function(){e.up("window").close()})}})}),e.getEl().down("input[name=hf]").on("click",function(){i.doHF()}),e.getEl().down("input[name=zf]").on("click",function(){i.doZF()}),e.getEl().down("input[name=print]").on("click",function(){i.doPrint()})}}},Ext.apply({fieldLabel:i.localLang.addresser,value:e.EMAILDATA_FJR},t),Ext.apply({fieldLabel:i.localLang.recipients,value:e.EMAILDATA_SJR},t),Ext.apply({fieldLabel:i.localLang.carbonCopy,value:e.EMAILDATA_CS,hidden:JE.isEmpty(Ext.decode(Ext.value(e.EMAILDATA_CS,"[]")))},t),{xtype:"uxfilesfield",fieldLabel:i.localLang.file,value:e.EMAILDATA_FJ,hidden:JE.isEmpty(e.EMAILDATA_FJ),minHeight:30,noHeight:!0,filesIcon:"small",readOnly:!0,width:"100%",filesToolbar:"hide",listeners:{afterrender:function(e){e.getCmp("filespanel").body.setStyle({borderWidth:"0px",backgroundColor:"rgb(244, 244, 244)"})}}}]}];var a="";a="TEXT"==e.EMAILDATA_CONTEXTTYPE?e.EMAILDATA_ZW.replaceAll("\n","<br/>"):Ext.htmlDecode(e.EMAILDATA_ZW),i.items.push({region:"center",xtype:"box",itemId:"htmlBox",padding:"10 20",html:a,autoScroll:!0}),i.callParent(arguments)},doFJR:function(){JE.msg(this.emailInfo.data.EMAILDATA_FJR+this.localLang.addSuccessAlert)},doSJR:function(){JE.msg(this.emailInfo.data.EMAILDATA_SJR)},doFJ:function(){},doZF:function(){var e=this.mainview.getCmp("emaillist"),t=this.emailInfo.email,i=this.emailInfo.data,a={EMAILDATA_BT:this.localLang.transpond+"："+i.EMAILDATA_BT,EMAILDATA_FJR:t.EMAILCONFIG_YXDZ,EMAILDATA_ZW:e.buildEmailZW(i),EMAILDATA_FJ:i.EMAILDATA_FJ};e.editEmail(e,"add",{title:this.localLang.transpond,email:t,data:a})},doHF:function(){var e=this.mainview.getCmp("emaillist"),t=this.emailInfo.email,i=this.emailInfo.data,a={EMAILDATA_BT:this.localLang.reply+"："+i.EMAILDATA_BT,EMAILDATA_FJR:t.EMAILCONFIG_YXDZ,EMAILDATA_SJR:i.EMAILDATA_FJR,EMAILDATA_ZW:e.buildEmailZW(i)};e.editEmail(e,"add",{title:this.localLang.reply,email:t,data:a})},doPrint:function(){var e=this.getCmp("htmlBox").getEl().dom.innerHTML;JE.printHtml(e)}}),Ext.define("JE.sys.email.view.EmailEdit",{extend:"Ext.form.Panel",alias:"widget.email.emailedit",bodyPadding:"10",autoScroll:!0,initComponent:function(){var d=this;d.localLang=JE.getLocalLang("sys.email.emailReadEdit"),Ext.apply(d.localLang,JE.getLocalLang("sys.email.common")),d.layout={type:"vbox",align:"left"},d.defaults={labelAlign:"right",labelWidth:80,margin:2,width:"100%"},d.tbar=[{text:d.localLang.send,iconCls:"jeicon jeicon-shipping",handler:function(){if(d.form.isValid()){var e=d.form.getValues();if(e.tableCode="JE_SYS_EMAILDATA",e.EMAILDATA_SJ=Ext.Date.format(new Date,"Y-m-d H:i:s"),e.EMAILDATA_DQZT="0",e.EMAILDATA_ZT="send",e.EMAILDATA_FJR="[{code:'"+e.EMAILDATA_FJR+"',text:'"+e.EMAILDATA_FJR+"'}]",JE.ajax({url:JE.getUrlMaps("je.core.email","doSend"),params:e}).success){JE.msg(d.localLang.sendAlert),d.mainview.getCmp("emaillist").fireEmailClick(d.mainview.getCmp("emaillist")),"send"==d.mainview.getCmp("emaildata").getDockedCmp("msgBox").data.type&&d.mainview.getCmp("emaildata").store.load();var t=d.up("window");t&&t.close()}}}},{text:d.localLang.saveDraft,iconCls:"jeicon jeicon-draft-box",handler:function(){if(d.form.isValid()){var e=d.form.getValues();e.tableCode="JE_SYS_EMAILDATA",e.EMAILDATA_SJ=Ext.Date.format(new Date,"Y-m-d H:i:s"),e.EMAILDATA_DQZT="0",e.EMAILDATA_ZT="drafts",e.EMAILDATA_FJR="[{code:'"+e.EMAILDATA_FJR+"',text:'"+e.EMAILDATA_FJR+"'}]";var t=JE.isEmpty(e.JE_SYS_EMAILDATA_ID)?"doSave":"doUpdate",i=JE.ajax({url:JE.getUrlMaps("je.core",t),params:e});i.success&&(JE.msg(d.localLang.saveDraftAlert),d.form.setValues({JE_SYS_EMAILDATA_ID:i.obj.JE_SYS_EMAILDATA_ID}),d.mainview.getCmp("emaillist").fireEmailClick(d.mainview.getCmp("emaillist")))}}},"->",{text:d.localLang.addressBook,iconCls:"jeicon jeicon-lxrgl-pc",handler:function(){var e=d.getDockedCmp("address");e.setVisible(e.isHidden())}}];var t=[],e=JE.ajax({url:JE.getUrlMaps("je.core.load"),params:{tableCode:"JE_SYS_EMAILUSERS",whereSql:" and EMAILUSERS_USERID = '"+JE.USER.userId+"' and EMAILUSERS_LX = 'USER'",limit:-1}}).rows;Ext.each(e,function(e){t.push({text:e.EMAILUSERS_TEXT,code:e.EMAILUSERS_CODE})});e=JE.ajax({url:JE.getUrlMaps("je.core.load"),params:{tableCode:"JE_CORE_ENDUSER",whereSql:" and STATUS = '1'  and SHADOW = '0' and COMPANYEMAIL != ''",orderSql:" ORDER BY DEPTORDERINDEX ASC ,USERORDER ASC",limit:-1}}).rows;Ext.each(e,function(e){t.push({text:e.USERNAME,code:e.COMPANYEMAIL})});var i={xtype:"multiitem",regex:/^(")?(?:[^\."])(?:(?:[\.])?(?:[\w\-!#$%&'*+/=?^_`{|}~]))*\1@(\w[\-\w]*\.){1,5}([A-Za-z]){2,6}$/,regexText:d.localLang.emailRegexText,formatTextToObj:function(e){return{code:e,text:e}},buildPickerData:function(e){e.getPicker().store.loadData(t)},labelStyle:"cursor: pointer;color:blue;",listeners:{focus:{fn:d.markFocusField,scope:d},afterrender:function(a){var e=a.labelEl;e.dom.setAttribute("title","批量导入"),e.on("click",function(){JE.win({title:"批量导入联系人",width:600,height:400,items:{xtype:"textarea",itemId:"users",inputAttrTpl:'style="border-width:0px;"'},autoShow:!0,useButton:!0,fn:function(e){var t=e.getCmp("users").getValue();if(JE.isNotEmpty(t)){var i=[];Ext.each(t.split(";"),function(e){i.push({code:e,text:e})}),t=i}a.setValue(t)}})})}}};d.items=[{xtype:"fieldset",title:d.localLang.recipients,collapsible:!0,style:"background-color:#F2F6FF;",defaults:{labelAlign:"right",labelWidth:80,columnWidth:1,margin:2,width:"100%"},layout:"column",itemId:"fieldset",items:[Ext.apply({fieldLabel:d.localLang.recipients,name:"EMAILDATA_SJR",allowBlank:!1},i),Ext.apply({fieldLabel:d.localLang.carbonCopy,hidden:!0,name:"EMAILDATA_CS"},i),Ext.apply({fieldLabel:d.localLang.blindCarbonCopy,hidden:!0,name:"EMAILDATA_MS"},i),{xtype:"box",itemId:"box",style:"padding-left:85px;",html:JE.format('<a name="CS" text="{0}" title="{1}" href="javascript:;" style="text-decoration: none;cursor: pointer;outline: none;color:#082a4e;">{2} {3}</a>&nbsp;-&nbsp;<a name="MS" text="{4}" title="{5}" href="javascript:;" style="text-decoration: none;cursor: pointer;outline: none;color:#082a4e;">{6} {7}</a>',d.localLang.carbonCopy,d.localLang.carbonCopyTitle,d.localLang.addText,d.localLang.carbonCopy,d.localLang.blindCarbonCopy,d.localLang.blindCarbonCopyTitle,d.localLang.addText,d.localLang.blindCarbonCopy),listeners:{afterrender:function(e){e.getEl().select("a").on("click",function(e,t){var i=t.getAttribute("name"),a=t.getAttribute("text"),n=d.form.findField("EMAILDATA_"+i);n.reset(),n.setVisible(n.isHidden()),n.setDisabled(n.isHidden()),t.innerHTML=(n.isHidden()?d.localLang.addText:d.localLang.deleteText)+a,n.isHidden()?Ext.each(["EMAILDATA_MS","EMAILDATA_CS","EMAILDATA_SJR"],function(e){var t=d.form.findField(e);if(!t.isHidden())return t.focus(),!1}):n.focus()})}}},{xtype:"textfield",fieldLabel:d.localLang.subject,allowBlank:!1,name:"EMAILDATA_BT"},{xtype:"uxfilesfield",fieldLabel:d.localLang.fileLabel,width:"100%",filesIcon:"small",name:"EMAILDATA_FJ",labelStyle:"cursor: pointer;color:blue;",noHeight:!0,minHeight:30,listeners:{afterrender:function(e){e.labelEl.on("click",function(){e.doUploadFiles()}),e.getCmp("filespanel").body.setStyle({borderColor:"#b5b8c8"})}},filesToolbar:"hide"}]},{xtype:"ueditor",width:"100%",imageUrlType:"base64",minHeight:500,simpleToolbar:!0,simpleToolbars:[["undo","redo","|","bold","italic","underline","forecolor","backcolor","fontfamily","fontsize","|","insertorderedlist","insertunorderedlist","|","justifyleft","justifycenter","justifyright","justifyjustify","|","simpleupload","emotion","|","source"]],name:"EMAILDATA_ZW",flex:1},{xtype:"panel",border:0,layout:{type:"hbox",align:"stretch"},items:[{xtype:"cbbfield",fieldLabel:d.localLang.addresser,dataArray:d.emailList,labelAlign:"right",labelWidth:80,inputAttrTpl:"style='font-weight: bold;'",name:"EMAILDATA_FJR",listeners:{change:function(e,t){var i=e.getStore().findRecord("code",t);d.form.setValues({JE_SYS_EMAILCONFIG_ID:i.get("id"),EMAILDATA_SSYX:i.get("code")})}},hideTrigger1:!0,width:400},{xtype:"yesnofield",name:"EMAILDATA_JJZT",margin:"0 5 0 15",boxLabel:d.localLang.urgency},{xtype:"yesnofield",name:"EMAILDATA_SFHZ",margin:"0 5",boxLabel:d.localLang.readReceipt},{xtype:"yesnofield",name:"EMAILDATA_FBS",margin:"0 5",boxLabel:"分别发送"},{xtype:"box",flex:1},{xtype:"cbbfield",fieldLabel:d.localLang.signature,dataArray:[],labelAlign:"right",labelWidth:80,isFormField:!1,valueField:"id",ref:"qmField",listeners:{change:function(e,t){var i=e.getStore().findRecord("id",t);i&&d.form.setValues({EMAILDATA_ZW:Ext.htmlEncode("<p><p>")+i.get("code")})}},hideTrigger1:!0,width:300}]},{xtype:"hidden",name:"EMAILDATA_GSRID"},{xtype:"hidden",name:"EMAILDATA_ZT",value:"send"},{xtype:"hidden",name:"JE_SYS_EMAILCONFIG_ID"},{xtype:"hidden",name:"EMAILDATA_SSYX"},{xtype:"hidden",name:"EMAILDATA_SFZF"},{xtype:"hidden",name:"EMAILDATA_SJ"},{xtype:"hidden",name:"EMAILDATA_TDZT"},{xtype:"hidden",name:"JE_SYS_EMAILDATA_ID"}];var a=[{ddCode:"JE_SYS_EMAILADDRESS",ddName:d.localLang.recentContacts,async:!1,whereSql:"",orderSql:"",parentSql:"",rootId:"",nodeInfo:"ABC",moreRoot:!0},{ddCode:"JE_EMAIL_ADDRESS",ddName:d.localLang.addressBook,async:!1,whereSql:"",orderSql:" ORDER BY SY_CREATETIME",parentSql:" AND EMAILUSERS_USERID = '"+JE.USER.userId+"'",rootId:d.rootId,nodeInfo:"ADDRESS",moreRoot:!0},{ddCode:"JE_CORE_DEPTUSER",ddName:d.localLang.companyAddressBook,async:!1,whereSql:" ",orderSql:"",parentSql:"",rootId:"",nodeInfo:"DEPTUSER"}];d.rbar={xtype:"jetreeview",width:200,url:JE.getUrlMaps("je.core.dd.tree","loadTree"),multiSelect:!1,enableMSModel:!1,itemId:"address",type:"func",margin:"0 0 0 4",bodyStyle:"border-left:1px solid #99bce8 !important;",params:{node:"ROOT",onlyItem:!1,excludes:"checked",strData:Ext.encode(a)},hideHeaders:!0,columns:[{xtype:"treecolumn",flex:1,dataIndex:"text",field:{xtype:"textfield"}},{xtype:"actioncolumn",width:20,items:[{handler:function(e,t,i,a,n,o,r){var l=[];o.cascadeBy(function(e){e.raw;e.isLeaf()&&l.push(e)});var s=e.panel;s.addAddress(s,d.focusField,l)},getClass:function(e,t,i,a,n,o){var r="je-grid-actioncolumn-itemhidden";return i.isLeaf()||(r="JE_WF_CALLENTRUST"),r}}]}],listeners:{afterrender:function(e){e.getRootNode().cascadeBy(function(e){var t=e.raw;e.isLeaf()&&("DEPTUSER"==t.nodeInfo?e.set("qtitle",t.bean.COMPANYEMAIL):e.set("qtitle",t.code),e.commit())})},beforeselect:function(e,t,i,a){return!1},itemclick:function(e,t){if(t.isLeaf()){var i=e.panel;i.addAddress(i,d.focusField,[t])}}},addAddress:function(e,t,i){var a=[];Ext.each(i,function(e){e.isLeaf()&&JE.isNotEmpty(e.get("qtitle"))&&a.push({code:e.get("qtitle"),text:e.get("text")})});var n=d.form.findField(t);n.addData(a),n.focus()}},d.callParent(arguments)},markFocusField:function(e){this.focusField=e.name},afterRender:function(){this.callParent(arguments),this.focusField="EMAILDATA_SJR"}}),Ext.define("JE.app.util.Util",{buildTheme:function(e,t,i){var a=JE.getTheme(),n=[];if("default"!=a&&(t.height=50,i.margins="0 0 0 0",n.push(".je-app-header .header-title .logo{margin:5px 10px;}",".je-app-header .header-info .person-nav div{padding-bottom:0px;}")),this["build_"+a]){var o=this["build_"+a](e,t,i);n=n.concat(Ext.value(o,[]))}n.push(".je-app-header .header-title{line-height:"+t.height+"px;}"),this.buildCss(n)},build_plus:function(e,t,i){t.xtype="appnorthview2";var a=this.buildHomeData();1<a.length?(t.xtype=window._NORTHMENUVIEW_||"appnorthmenuview",t.homeData=a,i.tabBar.hidden=!0):(i.tabBar.height=45,i.tabBar.defaults={height:44}),Ext.override(Ext.panel.Tool,{renderTpl:['<i role="presentation" id="{id}-toolEl" class="{baseCls}-icon {baseCls}-{type}{childElCls}" style="{style}"></i>'],initComponent:function(){this.renderData.style=this.style,this.callParent(arguments)}}),Ext.override(Ext.grid.Panel,{initComponent:function(){this.cls=Ext.value(this.cls,"")+" je-grid",this.callParent(arguments)}}),JE.systemConfig.JE_SYS_TOPFONTCOLOR="",JE.systemConfig.JE_SYS_TOPBGCOLOR="",JE.systemConfig.JE_SYS_TOPBGCOLOR="",JE.systemConfig.JE_SYS_TOPBGIMG="";var n=JE.toNum(JE.systemConfig.JE_SYS_MENUWIDTH);n=0<n?n:200,e&&(e.maxWidth=e.width=n,e.xtype="appmenuleft");return[".je-menu-left .je-treemenu-tree .x-tree-view .x-grid-table{width:"+n+"px !important;}",".je-menu-left .je-treemenu-tree .x-tree-view{width:"+(n+20)+"px !important;}"]},build_saas:function(e,t,i){e&&(e.xtype="appmenuview"),JE.systemConfig.JE_SYS_TOPFONTCOLOR="#FFFFFF",JE.systemConfig.JE_SYS_TOPBGCOLOR="#0077A0"},buildUserPhoto:function(){return JE.__USERS__&&(JE.__USERS__[JE.USER.userId].photo=JE.__USERS__[JE.USER.userCode].photo=JE.USER.photo),JE.getUserPhoto(!0)},bindUserInfo:function(){var i=this,e=Ext.get("__je_userinfo__");e&&(i.userInfoMenu=Ext.create("Ext.menu.Menu",{width:250,shadow:!1,cls:"je-menu-item34h je-menu-arrow je-menu-arrow-tr",plain:!0,layout:"fit",bodyStyle:"padding:0;",items:{xtype:"appinfo.userinfo"}}),e.on({click:function(e){var t=e.getTarget(".je-user-photo");t&&i.userInfoMenu.isHidden()&&(i.userInfoMenu.showBy(t,"tr-br",[12,5]),i.userInfoMenu.getCmp(0).updateUserInfo())}}))},doAuthInfo:function(e){var t=e.type;if(e.disableAuth)return JE.ajax({url:JE.getUrlMaps("je.core.rbac.user","doCallAt"),params:{type:t}});if("qq"==t){var i=JE.ajax({url:"/je/saas/saasYh/createState",params:{type:"QQ",loginType:"PC"}}),a=JE.systemConfig.QQ_LOGIN_APPID,n=JE.systemConfig.QQ_LOGIN_APPURL;i.success&&window.open("https://graph.qq.com/oauth2.0/authorize?response_type=code&client_id="+a+"&redirect_uri=https%3a%2f%2f"+n+"%2fje%2fsaas%2fsaasYh%2fdoUserRz%3ftype%3dRZ%26userId%3d"+JE.currentUser.userId+"&state="+i.obj.STATE)}else if("weixin"==t){i=JE.ajax({url:"/je/saas/saasYh/createState",params:{type:"WX",loginType:"PC"}});var o=JE.systemConfig.WX_LOGIN_APPID,r=JE.systemConfig.WX_LOGIN_APPURL;i.success&&window.open("https://open.weixin.qq.com/connect/qrconnect?appid="+o+"&redirect_uri=http%3a%2f%2f"+r+"%2fje%2fsaas%2fsaasYh%2fdoUserRz%3ftype%3dRZ%26userId%3d"+JE.currentUser.userId+"&response_type=code&scope=snsapi_login&state="+i.obj.STATE+"#wechat_redirect")}else if("dt"==t){i=JE.ajax({url:"/je/saas/saasYh/createState",params:{type:"DT",loginType:"PC"}});var l=JE.systemConfig.DINGTALK_APPID,s=JE.systemConfig.DINGTALK_REDIRECT_URI;i.success&&window.open("https://oapi.dingtalk.com/connect/qrconnect?appid="+l+"&response_type=code&scope=snsapi_login&state="+i.obj.STATE+"&redirect_uri=http%3a%2f%2f"+s+"%2fje%2fsaas%2fsaasYh%2fdoUserRz%3ftype%3dRZ%26userId%3d"+JE.currentUser.userId)}else if(-1!=["phone","email"].indexOf(t)){var d=e.vcodeBtn;t=t.toLocaleUpperCase();if(d){var c=30,u={email:e.value,cz:"RZ",type:t};d.setDisabled(!0),(i=JE.ajax({url:JE.getUrlMaps("je.core.saasYh","sendRandom"),params:u})).success?(JE.msg("验证码已发送!"),d.getEl().removeCls("JEPLUS_B_L10"),JE.defer(function(){return!!d.getEl()&&(1==c?(d.setDisabled(!1),d.setText(d.initialConfig.text),d.getEl().addCls("JEPLUS_B_L10"),!1):(c--,void d.setText(c+"s")))},1e3,!0)):(d.setDisabled(!1),JE.alert(i.obj))}else{var p=e.values.value,f=e.values.vcode;if(JE.isEmpty(p))return JE.alert("请输入信息！"),!1;if(JE.isEmpty(f))return JE.alert("请输入验证码！"),!1;if(!(i=JE.ajax({url:JE.getUrlMaps("je.core.saasYh","doRzRandom"),params:{email:p,code:f,type:t,cz:"RZ"}})).success)return i.obj;JE.msg("修改成功！"),"PHONE"==t?JE.currentUser.phone=p:"EMAIL"==t&&(JE.currentUser.companyEmail=p)}}else if("password"==t){var E=JE.ajax({url:JE.getUrlMaps("je.core.rbac.user","modifyPassWord"),params:e.values});if(!E.success)return E.obj;JE.msg("修改成功！")}else JE.msg("无操作")},doUpdateUserInfo:function(e){JE.ajax({url:JE.getUrlMaps("je.core.rbac.user","doUpdateInfo"),async:!0,params:Ext.apply({tableCode:"JE_CORE_ENDUSER",USERID:JE.currentUser.userId},e)})},getAuthInfo:function(){var e=JE.ajax({url:JE.getUrlMaps("je.core.saasYh","getUserAt"),params:{userId:JE.currentUser.userId}}),t={phone:"",phoneFlag:"0",email:"",emailFlag:"0",qq:"",qqFlag:"0",weixin:"",weixinFlag:"0",dt:"",dtFlag:"0"};if(e.success){var i=e.obj;JE.isNotEmpty(i.AT_PHONE)&&(t.phone=i.AT_PHONE,t.phoneFlag="1"),JE.isNotEmpty(i.AT_EMAIL)&&(t.email=i.AT_EMAIL,t.emailFlag="1"),JE.isNotEmpty(i.AT_WX_OPENID)&&(t.weixin=i.AT_WX_NAME,t.weixinFlag="1"),JE.isNotEmpty(i.AT_QQ_OPENID)&&(t.qq=i.AT_QQ_NAME,t.qqFlag="1"),JE.isNotEmpty(i.AT_DD_NAME)&&(t.dt=i.AT_DD_NAME,t.dtFlag="1")}return"0"==t.phoneFlag&&(t.phone=JE.currentUser.phone),"0"==t.emailFlag&&(t.email=JE.currentUser.email),t},buildCss:function(e){var t=this,i=(e=Ext.value(e,[]),JE.systemConfig.JE_SYS_TOPBGCOLOR),a=JE.systemConfig.JE_SYS_TOPBGIMG,n="1"==JE.systemConfig.JE_SYS_TOPNOREPEAT?"no-repeat":"repeat",o=Ext.value(JE.systemConfig.JE_SYS_TOPBGIMGX,"left"),r=Ext.value(JE.systemConfig.JE_SYS_TOPBGIMGY,"top"),l=[];JE.isNotEmpty(i)&&l.push(i),JE.isNotEmpty(a)&&(a=a.split("*")[1],l.push("url("+a+")",n,o,r)),JE.isNotEmpty(l)&&(l.push("!important"),e.push(".je-app-header,.x-nlg .je-app-header{background:none;background:"+l.join(" ")+";}"));var s=JE.systemConfig.JE_SYS_TOPFONTCOLOR,d=JE.systemConfig.JE_SYS_TOPFONTOCOLOR,c=JE.systemConfig.JE_SYS_TOPUSERCOLOR;JE.isNotEmpty(s)&&e.push(".je-app-header .header-info .person-nav div a{color:"+s+"}"),JE.isNotEmpty(d)&&e.push(".je-app-header .header-info .person-nav div a:hover{color:"+d+"}"),JE.isNotEmpty(c)&&e.push(".je-app-header .header-info .person-nav.username{color:"+c+"}"),Ext.util.CSS.createStyleSheet(e.join(" ")),JE.defer(function(){if(t.boxEl){var e={color:JE.systemConfig.JE_SYS_TOPFONTCOLOR||"#C0D7F8",top:"5px"};return"plus"==JE.getTheme()&&(e={color:"#ffffff",fontSize:"13px",top:"15px",fontFamily:"tahoma ,微软雅黑"}),t.boxEl.setStyle(e),!1}},100)},doProxy:function(){JE.showFunc("JE_CORE_USERPROXY",{})},doPassword:function(){JE.win({title:"密码修改",items:{xtype:"appinfo.password",defaults:{margin:"2 0"}},okButtonText:"确认修改",autoShow:!0,maximizable:!1,width:450,height:"plus"==JE.getTheme()?270:180,useButton:!0,buttonAlign:"right",fn:function(e){return e.getCmp(0).updatePwd()}})},doInfoAuth:function(){JE.win({title:"信息认证",items:{xtype:"appinfo.infoauth",defaults:{margin:"2 0"}},autoShow:!0,maximizable:!1,width:450,height:"plus"==JE.getTheme()?260:190,useButton:!1,buttons:[{text:"刷新信息",cls:"btn JEPLUS_B_C01",iconCls:JE.getIconCls({iconCls:"jeicon jeicon-refresh",fontIconCls:"fa fa-refresh"}),itemId:"okButton",handler:function(e){var t=e.up("window");if(t){var i=t.down("panel[xtype=appinfo.infoauth]");i&&(i.refreshInfo(),JE.msg("刷新成功!"))}}},{text:"关闭",cls:"btn JEPLUS_B_C04",iconCls:JE.getIconCls({iconCls:"jeicon jeicon-error",fontIconCls:"fa fa-close"}),itemId:"cancelButton",handler:function(e){e.up("window").close()}}],buttonAlign:"right",showFn:function(e){e.down("panel[xtype=appinfo.infoauth]").refreshInfo()}})},statics:{doUserCfg:function(e){if(e){Ext.get(e);var t=Ext.getCmp("app-header");t.userCfgMenu||(t.userCfgMenu=Ext.create("Ext.menu.Menu",{shadow:!1,plain:!0,items:[{text:"代理设置",handler:function(){t.doPrexy()}},{text:"密码修改",handler:function(){t.doPassword()}},{text:"信息认证",handler:function(){t.doInfoAuth()}}]})),t.userCfgMenu.showBy(e,"br-tr")}}}}),Ext.define("JE.app.view.CenterView",{extend:"Ext.tab.Panel",alias:"widget.appcenterview",id:"_appcenterview",margins:"2 0 0 0",tabPosition:"top",plugins:[{ptype:"tabclosemenu"},Ext.create("JE.core.ux.tab.TabReorderer")],initComponent:function(){this.localLang=JE.getLocalLang("core.menuHeadSet.func"),this.items=[],JE.systemConfig.JE_SYS_MENULOCATION=JE.systemConfig.JE_SYS_MENULOCATION||"crumbs","crumbs"==JE.systemConfig.JE_SYS_MENULOCATION&&(this.tabBar={hidden:!0},this.buildLocationTabbar()),this.defaults=this.defaults||{},this.defaults.rootFunc=!0,this.callParent(arguments)},buildLocationTabbar:function(){JE.loadScript("/static/ux/sortable/Sortable.min.js");var r=this,e={dock:"top",xtype:"container",layout:"border",height:50,itemId:"location-tabbar",style:"background-color: #f6f9fc;",cls:"je-location-tabbar-box",hidden:!0,items:[{xtype:"dataview",region:"center",itemId:"view",itemSelector:"div.item",cls:"je-location-tabbar",overItemCls:"item-over",selModel:{deselectOnContainerClick:!1},store:Ext.create("Ext.data.Store",{fields:["id","text","iconCls","cls","closable","iconStyle"],data:[]}),tpl:['<tpl for=".">','<div class="item {cls}" data-id="{id}">','<i class="{iconCls}" style="{iconStyle}"></i>{text}',"</div>","</tpl>",'<i class="fa fa-angle-double-right hiddenmenu"></i>'],addMenu:function(e,t){var i=this;if(i.disableAddMenu)delete i.disableAddMenu;else{var a=i.store.getById(e.id);a?(e.closable||t)&&(i.store.remove(a),i.store.insert(0,e)):a=i.store.insert(0,e),i.getSelectionModel().select(a),i.fireEvent("resize",i,i.getWidth())}},closeMenu:function(t,e){var i=this;if(!(i.store.data.items.length<=1)){var a=i.getSelectionModel().getSelection()[0];if("self"==e)i.store.remove(t);else if("other"==e){var n=[];i.store.each(function(e){e.get("id")!=t.get("id")&&n.push(e)}),i.store.remove(n)}else if("right"==e){n=[];var o=!1;i.store.each(function(e){o&&n.push(e),e.get("id")==t.get("id")&&(o=!0)}),i.store.remove(n)}if(-1!=["self","other"].indexOf(e)){var r=i.store.getById(a.get("id"));r?i.getSelectionModel().select(r,!1,!0):i.getSelectionModel().select(i.store.getAt(0))}}},listeners:{resize:function(i,a,e){var n=0;i.store.each(function(e){var t=i.getNode(e);if(t){n+=t.clientWidth+16,e.set("cls",a<n?"item-hidden":"")}});var t=i.getEl();t&&0<n&&t[a<n?"addCls":"removeCls"]("show-hiddenmenu")},afterrender:function(o,e){r.locationTabbar=r.getDockedCmp("location-tabbar");var t=JE.ajax({url:"je/load",params:{tableCode:"JE_CORE_USERINFO",whereSql:"and USERINFO_USERID ='"+JE.USER.userId+"' and USERINFO_TYPE ='tabMenu'"}});if(JE.isNotEmpty(t.rows))if("newTabs"==t.rows[0].USERINFO_CONFIG){r.locationTabbar.show();var i=r.getEl(),a="location-tabbar";i.hasCls(a)||i.addCls(a)}else r.locationTabbar.hide();o.getEl().on("click",function(e){var t=e.getTarget(".hiddenmenu",1,!0),i=e.getTarget(".close",1,!0);if(t){r.hiddenMenu||(r.hiddenMenu=Ext.create("Ext.menu.Menu",{shadow:!1,plain:!0,cls:"je-menu-item34h je-menu-arrow je-menu-arrow-t",items:[],defaults:{handler:function(e){o.addMenu({id:e.id,text:e.text,iconCls:JE.isEmpty(e.iconCls)?"fa fa-circle-o":e.iconCls,closable:e.closable},!0)}}})),r.hiddenMenu.removeAll();var a=[];o.store.each(function(e){"item-hidden"==e.get("cls")&&a.push(e.raw)}),r.hiddenMenu.add(a),r.hiddenMenu.showBy(t,"t-b",[-10,0])}else if(i){var n=o.store.getById(i.parent().getAttribute("data-id"));o.closeMenu(n,"self")}}),Sortable.create(o.getEl().dom,{group:"menus",animation:150,scroll:!1,handle:".item",draggable:".item",onEnd:function(e){var i=[],t=e.item.getAttribute("data-id");Ext.each(o.getEl().query(".item"),function(e){var t=o.store.getById(e.getAttribute("data-id"));i.push(t.raw)}),o.store.removeAll(),o.store.add(i),o.getSelectionModel().select(o.store.getById(t),!1,!0),o.fireEvent("resize",o,o.getWidth())}})},beforeitemclick:function(e,t,i,a,n){return!n.getTarget(".close",1)},selectionchange:function(e,t,i){var a=t[0];if(a){document.getElementsByClassName("hiddenmenu");e.view.disableAddMenu=!0,JE.openFuncById(a.get("id"))}},itemcontextmenu:function(t,e,i,a,n){n.stopEvent(),t.contextMenu||(t.contextMenu=Ext.create("Ext.menu.Menu",{shadow:!1,plain:!0,cls:"je-menu-item34h je-menu-arrow je-menu-arrow-t je-menu-item-left",items:[{itemId:"self",text:r.localLang.closeThisLabel},{itemId:"other",text:r.localLang.closeOtherLabel},{itemId:"right",text:r.localLang.closeRightLabel}],defaults:{handler:function(e){t.closeMenu(t.contextMenu.activeMenu,e.itemId)}}})),t.contextMenu.activeMenu=e,t.contextMenu.getCmp("self").setDisabled(t.store.data.items.length<=1),t.contextMenu.showBy(i,"t-b")}}},{region:"east",width:100,xtype:"container",style:"padding-top:6px;",cls:"je-location-tabbar-button",layout:{type:"vbox",align:"center",pack:"center"},items:[{cls:"JEPLUS_B_C07 button_switcherMode",xtype:"button",border:0,style:"background: #F6F9FC;color:#7b7b7b;",bodyStyle:"color:#7b7b7b;",text:r.localLang.switchingMode,iconCls:"jeicon jeicon-mode-switch-down",handler:function(){r.changeLocationBar()}}]}]};r.dockedItems=[e]},changeLocationBar:function(){var e="",t=this.getEl(),i="location-tabbar";if(t.hasCls(i)){var a=this.getCmp("location-tabbar").getCmp("view").store,n=[];t.removeCls(i),this.locationTabbar.hide(),e="crumbs",a.each(function(e){n.push({menuId:e.get("id"),text:e.get("text"),iconCls:e.get("iconCls")})}),JE._menu_history=n}else{var o=this.locationTabbar.getCmp("view");t.addCls(i),this.locationTabbar.show(),o.fireEvent("resize",o,o.getWidth()),e="newTabs"}var r=JE.ajax({url:"je/load",params:{tableCode:"JE_CORE_USERINFO",whereSql:"and USERINFO_USERID ='"+JE.USER.userId+"' and USERINFO_TYPE ='tabMenu'"}}),l={tableCode:"JE_CORE_USERINFO",USERINFO_CONFIG:e,USERINFO_USERID:JE.USER.userId,USERINFO_USERCODE:JE.USER.userCode,USERINFO_TYPE:"tabMenu"};if(JE.isNotEmpty(r.rows))r=JE.ajax({url:JE.getUrlMaps("je.core","doUpdate"),params:{JE_CORE_USERINFO_ID:r.rows[0].JE_CORE_USERINFO_ID,tableCode:"JE_CORE_USERINFO",USERINFO_CONFIG:e}});else r=JE.ajax({url:JE.getUrlMaps("je.core","doSave"),params:l})},afterRender:function(){this.callParent(arguments),JE.isEmpty(JE.requestParams.funcCode)&&this.buildPortal();var e=JE.requestParams,t=e.funcCode;if(JE.isNotEmpty(t))if("workflow"==e.showView)e.type="func",JE.showWFView(e);else if("report"==e.showView){var i=Ext.create("JE.core.view.ReportView",{reportCode:t,boxBorder:0});this.add(i),this.setBorder(0)}else"iframe"==e.showView?this.add({xtype:"panel",html:'<iframe scrolling="auto" frameborder="0" width="100%" height="100%" src="'+t+'" ></iframe>',border:0}):JE.openFuncByCode(t,e)},buildPortal:function(){var i=this;JE.ajax({url:JE.getUrlMaps("je.core.portal","load"),async:!0,params:{tableCode:"JE_CORE_PROTAL",whereSql:" and PROTAL_QY_CODE = '1' and PROTAL_JHFS_CODE = 'portal'",orderSql:"order by SY_ORDERINDEX",initSys:!0,limit:-1},success:function(e){var t=Ext.decode(Ext.value(e.responseText,"{}")).rows;Ext.each(t,function(e){var t={xtype:"jeportalview",title:JE.CoreUtil.lang_portal_title(e),layout:"fit",reorderable:!1,itemId:e.JE_CORE_PROTAL_ID,iconCls:JE.getIconCls(e,"PROTAL_CLS","PROTAL_CLS2"),bean:e};i.add(t)}),JE.isEmpty(t)&&setTimeout(function(){i.add({xtype:"panel",tabConfig:{hidden:!0},html:Ext.value(JE.systemConfig.JE_SYS_HOMEEMPTYHTML,"")})})}})}}),Ext.define("JE.app.view.ConfigView",{extend:"Ext.panel.Panel",border:0,autoScroll:!0,alias:"widget.appconfigview",id:"app-configview",cls:"je-app-configview",layout:"vbox",border:0,header:!1,collapsed:!0,collapsible:!0,hideCollapseTool:!0,titleCollapse:!1,defaults:{width:300,cls:"configview-item"},mixins:["JE.app.util.Util"],initComponent:function(){this.placeholder={hidden:!0,border:0},this.items=[],this.buildButtonBox(),this.buildMenuView(),this.callParent(arguments)},afterRender:function(){this.callParent(arguments)},toggle:function(){this.animCollapse=200,this.floatCollapsedPanel(),this.el.un("mouseleave",this.onMouseLeaveFloated,this),this.el.un("mouseenter",this.onMouseEnterFloated,this)},buildMenuView:function(){var e={xtype:"appshortcutview",itemId:"menu"},t=10+this.northHeight;Ext.each(this.items,function(e){t+=e.height+10}),e.minHeight=JE.getBodyHeight()-t-10,this.items.push(e)},buildThemeBox:function(){return{xtype:"container",itemId:"theme",cls:"plustheme",layout:"column",defaults:{columnWidth:1},items:[{xtype:"rgroup",name:"themeType",dataArray:[{text:"顶部主题",code:"head"},{text:"菜单主题",code:"menu"},{text:"顶部菜单",code:"menutop"}],listeners:{change:function(e,t,i){var a=e.next().getValue().split(","),n=e.next("dataview"),o=a[0],r=a[1],l=a[2],s="head"==t?o:"menu"==t?r:l,d=n.store.findRecord("theme",s);d&&n.getSelectionModel().select(d,!0,!0)},afterrender:function(e){e.setValue("head"),e.getEl().down("table.x-table-plain").dom.setAttribute("align","center")}}},{xtype:"hidden",name:"theme",value:Ext.value(JE.currentUser.theme,"blue,black,blue")},{xtype:"dataview",cls:"je-plus-themes",itemSelector:"div.item",store:Ext.create("Ext.data.Store",{fields:["color","theme"],data:[{color:"#373d41",theme:"black"},{color:"#444444",theme:"dark"},{color:"#6C7A89",theme:"gray"},{color:"#f9fafc",theme:"white"},{color:"#3c8dbc",theme:"blue"},{color:"#00a65a",theme:"green"},{color:"#957BBD",theme:"purple"},{color:"#D24D57",theme:"red"}]}),tpl:['<tpl for="."><div class="item" data-color="{color}"><i class="fa fa-circle theme" style="color:{color}"></i></div></tpl>'],listeners:{selectionchange:function(e,t){var i=t[0],a=e.view.prev("[name=themeType]").getValue(),n=e.view.prev("[name=theme]"),o=n.getValue().split(","),r=(i.get("color"),i.get("theme"));"head"==a?(o[0]=r,Ext.get("JE-plus-theme-head").dom.href=JE.buildCdnUrl("/static/css/theme/head-"+r+".css")):"menu"==a?(o[1]=r,Ext.get("JE-plus-theme-menu").dom.href=JE.buildCdnUrl("/static/css/theme/menu-"+r+".css")):(o[2]=r,Ext.get("JE-plus-theme-menutop").dom.href=JE.buildCdnUrl("/static/css/theme/menutop-"+r+".css")),n.setValue(o.join(",")),JE.ajax({url:JE.getUrlMaps("je.core.rbac.user","doUpdateInfo"),async:!0,params:{tableCode:"JE_CORE_ENDUSER",USERID:JE.currentUser.userId,THEME:n.getValue()}})}}}]}},buildButtonBox:function(){var o=this,e={xtype:"rgroup",fieldLabel:"菜单位置",labelAlign:"right",labelWidth:60,cls:"je-field-basiccls",name:"menuType",dataArray:[{text:"左侧菜单",code:"left"},{text:"顶部菜单",code:"top"},{text:"组合菜单",code:"lefttop"}],value:Ext.value(JE.USER.menuType,"left"),listeners:{change:function(e,t,i){JE.ajax({url:JE.getUrlMaps("je.core.rbac.user","doUpdateInfo"),async:!0,params:{tableCode:"JE_CORE_ENDUSER",MENUTYPE:t,USERID:JE.USER.userId}}),JE.confirm("刷新页面可以看到最新菜单！",function(e){"ok"==e&&window.location.reload()},"菜单位置","立即刷新")},afterrender:function(e){}}},t={xtype:"box",itemId:"buttons",cls:"buttons",html:("0"==JE.systemConfig.JE_SYS_PROXYSET?"":'<button type="button" class="proxy">代理设置</button>')+'<button type="button" class="pwd">密码修改</button>'+("0"==JE.systemConfig.JE_SYS_QUICKLOGIN?"":'<button type="button" class="info">快捷登录</button>')+("0"==JE.USER.sound?'<i class="fa fa-bell-slash-o bell" title="开启提示音"></i>':'<i class="fa fa-bell-o bell" title="关闭提示音"></i>')+'<i class="fe icon-lock-2 lock" title="锁屏"></i>',listeners:{afterrender:function(e){e.getEl().on("click",function(e){var t=Ext.get(e.getTarget());if(t.hasCls("proxy"))o.doProxy();else if(t.hasCls("pwd"))o.doPassword();else if(t.hasCls("info"))o.doInfoAuth();else if(t.hasCls("lock"))JE.lockAPP();else if(t.hasCls("bell")){var i="fa-bell-o",a="fa-bell-slash-o",n=t.getAttribute("title");t.hasCls(i)?(t.removeCls(i),t.addCls(a),t.dom.setAttribute("title","开启提示音"),JE.USER.sound="0"):(t.removeCls(a),t.addCls(i),t.dom.setAttribute("title","关闭提示音"),JE.USER.sound="1"),JE.msg("已"+n+"!"),JE.ajax({url:JE.getUrlMaps("je.core.rbac.user","doUpdateInfo"),async:!0,params:{tableCode:"JE_CORE_ENDUSER",SOUND:JE.USER.sound,USERID:JE.USER.userId}})}})}}},i={xtype:"container",layout:"column",defaults:{columnWidth:1},height:45,items:[]};"plus"==JE.getTheme()&&(i.items.push(o.buildThemeBox()),i.items.push(e),i.height+=157),i.items.push(t),o.items.push(i)}}),Ext.define("JE.app.view.info.InfoAuth",{extend:"Ext.form.Panel",border:0,layout:"column",bodyPadding:4,alias:"widget.appinfo.infoauth",initComponent:function(){this.defaults=this.defaults||{},Ext.applyIf(this.defaults,{labelAlign:"right",columnWidth:.9,margin:1,beforeLabelTextTpl:'<i class="fa fa-check-circle" style="color:#e6e6e6;margin-right:10px;"></i>',authColor:"#18a55d",unAuthColor:"#e6e6e6",unitListTpl:[{text:"认证",handler:function(e){e.ownerCt.doAuth(e)}},{text:"取消认证",handler:function(i){JE.confirm("是否取消认证？",function(e,t){"ok"==e&&JE.ajax({url:JE.getUrlMaps("je.core.rbac.user","doCallAt"),params:{type:i.name}}).success&&(i.up("panel[xtype=appinfo.infoauth]").refreshInfo(),JE.msg("取消认证成功!"))})}}]}),this.items=[{xtype:"textfield",fieldLabel:"手机",name:"phone"},{xtype:"textfield",fieldLabel:"微信",readOnly:!0,hidden:"0"==JE.systemConfig.JE_SYS_WXQUICKLOGIN,name:"wx"},{xtype:"textfield",fieldLabel:" QQ",hidden:"0"==JE.systemConfig.JE_SYS_QQQUICKLOGIN,beforeLabelTextTpl:'<i class="fa fa-check-circle" style="color:#e6e6e6;margin-right:12px;"></i>',readOnly:!0,name:"qq"},{xtype:"textfield",fieldLabel:"邮箱",name:"email"}],this.callParent(arguments)},doAuth:function(l){var s=this,i=(s.rzInfo,l.getValue()),d=l.fieldLabel,e=l.name;if("qq"==e){var t=JE.ajax({url:JE.getUrlMaps("je.core.saasYh","createState"),params:{type:"QQ",loginType:"PC"}}),a=JE.systemConfig.QQ_LOGIN_APPID,n=JE.systemConfig.QQ_LOGIN_APPURL;t.success?window.open("https://graph.qq.com/oauth2.0/authorize?response_type=code&client_id="+a+"&redirect_uri=http%3a%2f%2f"+n+"%2fsaas%2fdoUserRz.action%3ftype%3dRZ%26userId%3d"+JE.currentUser.userId+"&state="+t.obj):JE.alert("发送状态机出错，请稍后再试!")}else if("wx"==e){t=JE.ajax({url:JE.getUrlMaps("je.core.saasYh","createState"),params:{type:"WX",loginType:"PC"}});var o=JE.systemConfig.WX_LOGIN_APPID,r=JE.systemConfig.WX_LOGIN_APPURL;t.success?window.open("https://open.weixin.qq.com/connect/qrconnect?appid="+o+"&redirect_uri=http%3a%2f%2f"+r+"%2fsaas%2fdoUserRz.action%3ftype%3dRZ%26userId%3d"+JE.currentUser.userId+"&response_type=code&scope=snsapi_login&state="+t.obj+"#wechat_redirect"):JE.alert("发送状态机出错，请稍后再试!")}else{if(JE.isEmpty(i))return void JE.alert("请输入"+d+"信息！");JE.formWin({title:d+"认证",defaults:{columnWidth:.9},height:120,items:[{xtype:"textfield",value:i,name:"email",readOnly:!0,fieldLabel:d},{fieldLabel:"验证码",allowBlank:!1,name:"code",unitTpl:"获取验证码",unitTplHandler:function(e){if(!e.locking){e.unitTplEl.setStyle("color","#A0A0A0"),e.second=30;var t={};t.email=i,t.cz="RZ","phone"==l.name?t.type="PHONE":"email"==l.name&&(t.type="EMAIL"),JE.ajax({url:JE.getUrlMaps("je.core.saasYh","sendRandom"),params:t}).success?(JE.msg("验证码已发送!"),JE.defer(function(){if(1==e.second)return e.locking=!1,e.unitTplEl.setStyle("color","#000000"),e.unitTplEl.dom.innerHTML=e.unitTpl,!1;e.locking=!0,e.second--,e.unitTplEl.dom.innerHTML=e.second+"s"},1e3,!0)):JE.alert("发送验证码失败!")}}}],fn:function(e,t){var i=l.labelEl.down("i"),a=e.email,n=e.code,o="PHONE";if("phone"==l.name?o="PHONE":"email"==l.name&&(o="EMAIL"),JE.isEmpty(a))return JE.alert(d+"信息为空,无法认证！"),!1;if(JE.isEmpty(n))return JE.alert("请输入验证码！"),!1;var r=JE.ajax({url:JE.getUrlMaps("je.core.saasYh","doRzRandom"),params:{email:a,code:n,type:o,cz:"RZ"}});if(!r.success)return JE.alert(r.obj),!1;JE.msg("认证成功"),"phone"==l.name?JE.currentUser.phone=a:"email"==l.name&&(JE.currentUser.companyEmail=a),i.setStyle("color",l.authColor),s.refreshInfo()}})}},refreshInfo:function(){var l=this,e=(JE.currentUser.userId,JE.ajax({url:JE.getUrlMaps("je.core.saasYh","getUserAt"),params:{userId:JE.currentUser.userId}})),s={phone:"",phoneFlag:"0",email:"",emailFlag:"0",qq:"",qqFlag:"0",wx:"",wxFlag:"0"};if(e.success){var t=e.obj;JE.isNotEmpty(t.AT_PHONE)&&(s.phone=t.AT_PHONE,s.phoneFlag="1"),JE.isNotEmpty(t.AT_EMAIL)&&(s.email=t.AT_EMAIL,s.emailFlag="1"),JE.isNotEmpty(t.AT_WX_OPENID)&&(s.wx=t.AT_WX_NAME,s.wxFlag="1"),JE.isNotEmpty(t.AT_QQ_OPENID)&&(s.qq=t.AT_QQ_NAME,s.qqFlag="1")}"0"==s.phoneFlag&&(s.phone=JE.currentUser.phone),"0"==s.emailFlag&&(s.email=JE.currentUser.email),Ext.each(["phone","email","qq","wx"],function(e){var t="1"==s[e+"Flag"],i=l.form.findField(e),a=i.labelEl.down("i"),n=t?i.authColor:i.unAuthColor;a.setStyle("color",n);var o=i.getEl().down(".je-field-unittpl"),r=o.down(".unittpl-inner span");t?(o.dom.setAttribute("width",120),r.dom.innerText=" 重新认证 "):(o.dom.setAttribute("width",100),r.dom.innerText=" 认证 ")}),l.form.setValues(s),l.rzInfo=s}}),Ext.define("JE.app.view.info.Password",{extend:"Ext.form.Panel",border:0,alias:"widget.appinfo.password",layout:"column",bodyPadding:4,initComponent:function(){this.defaults=this.defaults||{},Ext.applyIf(this.defaults,{labelAlign:"right",columnWidth:.9,margin:1});var e=this.localLang=JE.getLocalLang("core.util.Util.modifyPw");this.items=[{xtype:"displayfield",fieldLabel:e.userNameLabel,value:JE.currentUser.username},{xtype:"textfield",fieldLabel:e.passwordLabel,inputType:"password",allowBlank:!1,name:"oldPw"},{xtype:"textfield",fieldLabel:e.newPasswordLabel,allowBlank:!1,inputType:"password",id:"modifyPwNewPassword",name:"newPw"},{xtype:"textfield",fieldLabel:e.newPassword2Label,allowBlank:!1,inputType:"password",vtype:"repetition",vtypeText:e.newPassword2VtypeText,updateText:e.updateSuccessMsg,repetition:{targetCmpId:"modifyPwNewPassword"},name:"newPw2"}],this.callParent(arguments)},updatePwd:function(){if(!this.form.isValid())return!1;var e=this.form.getValues();delete e.newPw2,function(e){var t={oldPw:"o",newPw:"n"};for(var i in t)e.hasOwnProperty(i)&&(e[t[i]]=window.btoa(window.btoa(e[i])),delete e[i])}(e);var t=JE.ajax({url:JE.getUrlMaps("je.core.rbac.user","modifyPassWord"),params:e});if(!t.success)return JE.alert(t.obj),!1;JE.msg(this.localLang.updateSuccessMsg)}}),Ext.define("JE.app.view.info.UpdateInfo",{extend:"Ext.panel.Panel",border:0,alias:"widget.appinfo.updateinfo",layout:"fit",border:0,mixins:["JE.app.util.Util"],cls:"je-app-updateinfo",initComponent:function(){var o=this;o.localLang=JE.getLocalLang("core.util.Util.modifyPw"),o.winLocalLang=JE.getLocalLang("core.menuHeadSet.headSet.winText"),o.defaults={xtype:"form",layout:"column",defaults:{columnWidth:1,margin:"10 0"},border:0,cls:"info-panel"},o.padding="0 20 20 20",o.items=o.getItemPanel(),o.bbar={xtype:"box",itemId:"errorBox",cls:"error-box",weight:100},o.buttons=[{text:o.winLocalLang.okbutton,cls:"btn JEPLUS_B_L10",width:90,handler:function(){var e=o.getCmp(0),t=e.getErrorText();if(o.setErrorText(t),JE.isEmpty(t)){var i=e.form.getValues(),a=o.infoType,n=e.itemId;t=o.doAuthInfo({type:n,values:i}),JE.isNotEmpty(t)?o.setErrorText(t):("password"==a&&JE.logout(),o.up("window").close())}}},{text:o.winLocalLang.onbutton,cls:"btn",hidden:o.passwordConfig.closeType,width:90,handler:function(){o.up("window").close()}}],o.buttonAlign="right",o.callParent(arguments)},setErrorText:function(e){var t=this,i=t.winLocalLang.password.pwdError,a=t.passwordConfig;a&&JE.isNotEmpty(a.passwordMsg)&&"1"==JE.systemConfig.INITPASSWORD&&(i=a.passwordMsg),e={phoneError:t.winLocalLang.password.phoneError,phoneEmpty:t.winLocalLang.password.phoneEmpty,emailError:t.winLocalLang.password.emailError,emailEmpty:t.winLocalLang.password.emailEmpty,pwdError:i,pwdEmpty:t.winLocalLang.password.pwdEmpty,pwdNewEmpty:t.winLocalLang.password.pwdNewEmpty,pwdUnequal:t.winLocalLang.password.pwdUnequal,vcodeEmpty:t.winLocalLang.password.vcodeEmpty}[e]||e,t.getDockedCmp("errorBox").setVisible(JE.isNotEmpty(e)),t.getDockedCmp("errorBox").update(e)},getItemPanel:function(){return"phone"==this.infoType?this.getPhonePanel():"email"==this.infoType?this.getEmailPanel():this.getPwdPanel()},getPwdPanel:function(){var r=this,e=r.winLocalLang.password.pwdError,l="^(?![0-9]+$)(?![a-zA-Z]+$)[0-9A-Za-z]{6,20}$",t=r.passwordConfig;t&&(JE.isNotEmpty(t.passwordMsg)&&"1"==JE.systemConfig.INITPASSWORD&&(e=t.passwordMsg),JE.isNotEmpty(t.passwordRegular)&&"1"==JE.systemConfig.INITPASSWORD&&(l=t.passwordRegular));var i={itemId:"password",items:[{xtype:"box",html:['<div class="info-title">'+r.winLocalLang.password.passwordTitle+"</div>",'<div class="info-title-sub">'+e+"</div>"].join("")},{xtype:"textfield",emptyText:r.localLang.passwordLabel,iconCls:"jeicon jeicon-lock",name:"oldPw"},{xtype:"textfield",emptyText:r.localLang.newPasswordLabel,iconCls:"jeicon jeicon-lock",name:"newPw"},{xtype:"box",itemId:"pwdStatus",hidden:!0,cls:"password-status",html:['<div class="state s1"></div>','<div class="state s2"></div>','<div class="state s3"></div>','<span class="text s1">'+r.winLocalLang.password.passwordStrengthWeak+"</span>",'<span class="text s2">'+r.winLocalLang.password.passwordStrengthCentre+"</span>",'<span class="text s3">'+r.winLocalLang.password.passwordStrengthStrong+"</span>"].join("")},{xtype:"textfield",emptyText:r.localLang.newPassword2Label,iconCls:"jeicon jeicon-lock",name:"newPw2"}],getErrorText:function(){var e=this.form.getValues();return JE.isEmpty(e.oldPw)?"pwdEmpty":JE.isEmpty(e.newPw)?"pwdNewEmpty":JE.regStr(e.newPw,l)?e.newPw2!=e.newPw?"pwdUnequal":void 0:"pwdError"}};return Ext.each(i.items,function(e){"textfield"==e.xtype&&(e.listeners={focus:function(e){e.inputEl.dom.setAttribute("type","password")},afterrender:function(e){e.inputEl.insertHtml("beforeBegin",'<div class="icon"><i class="'+e.iconCls+'"></i></div>')},change:function(e,t,i){if("newPw"==e.name){var a="",n=e.ownerCt.getCmp("pwdStatus");if(JE.regStr(t,l)){var o=JE.checkPassword(t);n.getEl().removeCls("s1 s2 s3"),n.getEl().addCls("s"+o),n.show()}else a="pwdError",n.hide();r.setErrorText(a)}}})}),i},getPhonePanel:function(){var n=this;return{itemId:"phone",items:[{xtype:"box",padding:"0 0 20 0",html:['<div class="info-title">'+n.winLocalLang.phone.phoneTitle+"</div>",'<div class="info-title-sub">'+n.winLocalLang.phone.phoneMsg+"</div>"].join("")},{xtype:"textfield",emptyText:n.winLocalLang.phone.poneText,iconCls:"jeicon jeicon-mobile",name:"value",listeners:{afterrender:function(e){e.inputEl.insertHtml("beforeBegin",'<div class="icon"><i class="'+e.iconCls+'" style="font-size:18px;"></i></div>')},change:function(e,t,i){var a="";JE.regStr(t,"phone")||(a="phoneError"),n.setErrorText(a)}}},{xtype:"container",layout:{type:"hbox",align:"bottom"},cls:"field-box",items:[{xtype:"textfield",emptyText:n.winLocalLang.phone.verificationCcode,iconCls:"fa fa-get-pocket",name:"vcode",flex:1,listeners:{afterrender:function(e){e.inputEl.insertHtml("beforeBegin",'<div class="icon"><i class="'+e.iconCls+'"></i></div>')}}},{xtype:"button",text:n.winLocalLang.phone.phoneButton,margin:5,cls:"btn JEPLUS_B_L10",handler:function(e){var t=e.up("form"),i=t.form.findField("value").getValue(),a=t.getErrorText(!1);JE.isNotEmpty(a)?n.setErrorText(a):n.doAuthInfo({type:"phone",vcodeBtn:e,value:i})}}]}],getErrorText:function(e){var t=this.form.getValues();return JE.isEmpty(t.value)?"phoneEmpty":JE.regStr(t.value,"phone")?0!=e&&JE.isEmpty(t.vcode)?"vcodeEmpty":void 0:"phoneError"}}},getEmailPanel:function(){var n=this;return{itemId:"email",items:[{xtype:"box",padding:"0 0 20 0",html:['<div class="info-title">'+n.winLocalLang.email.emailTitle+"</div>",'<div class="info-title-sub">'+n.winLocalLang.email.emailMsg+"</div>"].join("")},{xtype:"textfield",emptyText:n.winLocalLang.email.emailText,iconCls:"jeicon jeicon-envelope-o",name:"value",listeners:{afterrender:function(e){e.inputEl.insertHtml("beforeBegin",'<div class="icon"><i class="'+e.iconCls+'" style="font-size:14px;"></i></div>')},change:function(e,t,i){var a="";JE.regStr(t,"email")||(a="emailError"),n.setErrorText(a)}}},{xtype:"container",layout:{type:"hbox",align:"bottom"},cls:"field-box",items:[{xtype:"textfield",emptyText:n.winLocalLang.email.emailCode,iconCls:"fa fa-get-pocket",name:"vcode",flex:1,listeners:{afterrender:function(e){e.inputEl.insertHtml("beforeBegin",'<div class="icon"><i class="'+e.iconCls+'"></i>')}}},{xtype:"button",text:n.winLocalLang.email.emailButton,margin:5,cls:"btn JEPLUS_B_L10",handler:function(e){var t=e.up("form"),i=t.form.findField("value").getValue(),a=t.getErrorText(!1);JE.isNotEmpty(a)?n.setErrorText(a):n.doAuthInfo({type:"email",vcodeBtn:e,value:i})}}]}],getErrorText:function(e){var t=this.form.getValues();return JE.isEmpty(t.value)?"emailEmpty":JE.regStr(t.value,"email")?0!=e&&JE.isEmpty(t.vcode)?"vcodeEmpty":void 0:"emailError"}}}}),Ext.define("JE.app.view.info.UserInfo",{extend:"Ext.container.Container",layout:"column",alias:"widget.appinfo.userinfo",cls:"je-app-userinfo",mixins:["JE.app.util.Util"],initComponent:function(){this.localLang=JE.getLocalLang("core.menuHeadSet.headSet"),this.defaults={columnWidth:1},this.items=[this.getUserInfoBox(),this.getConfigBox(),this.getThemeBox(),this.getAuthBox(),this.getLogoutBox()],this.callParent(arguments)},updateUserInfo:function(){this.getCmp("userinfo").update(JE.USER)},getUserInfoBox:function(){var e=this;return{xtype:"box",cls:"userinfo",itemId:"userinfo",tpl:['<div class="photoinfo">{[this.getPhoto()]}</div><div class="text">{deptName}</div>',{getPhoto:function(){return e.buildUserPhoto()}}],data:JE.USER,listeners:{afterrender:function(e){e.getEl().on("click",function(e){e.getTarget(".je-user-photo")&&JE.CoreUtil.updateUserPhoto()})}}}},getConfigBox:function(){var a=this;return{xtype:"box",cls:"config",itemId:"config",html:['<div class="item password">'+a.localLang.passWordUpdate+"</div>",'<div class="item prexy">'+a.localLang.proxyCap+"</div>",'<div class="item phone">'+a.localLang.phoneUpdate+"</div>",'<div class="item email">'+a.localLang.emailUpdate+"</div>"].join(""),listeners:{afterrender:function(e){var i=JE.systemConfig.JE_SYS_PROXYSET;if("1"!=i){var t=document.getElementsByClassName("prexy")[0];t.style.color="#DDDDDD",t.style.cursor="unset"}e.getEl().on("click",function(e){var t=e.getTarget("",1,!0);if(t.hasCls("prexy")){if("1"!=i)return;a.doProxy()}else Ext.each(["password","phone","email"],function(e){if(t.hasCls(e))return JE.win({width:390,height:400,autoShow:!0,items:{xtype:"appinfo.updateinfo",infoType:e,passwordConfig:{closeType:!1,passwordRegular:JE.systemConfig.REGEXP,passwordMsg:JE.systemConfig.PROMPT}},showFn:function(e){e.header.hide()},listeners:{show:function(){var e=document.getElementsByClassName("el-input__inner");JE.isNotEmpty(e)&&Ext.each(e,function(e){e.disabled=!0})},close:function(){var e=document.getElementsByClassName("el-input__inner");JE.isNotEmpty(e)&&Ext.each(e,function(e){e.disabled=!1})}}}),!1})})}}}},getThemeBox:function(){return{xtype:"dataview",cls:"je-plus-themes",itemSelector:"div.item",store:Ext.create("Ext.data.Store",{fields:["color","theme","colorType"],data:[{color:"#386bd0",theme:"blue",colorType:"primary"},{color:"#00a65a",theme:"green",colorType:"primary"},{color:"#D24D57",theme:"red",colorType:"primary"},{color:"#957BBD",theme:"purple",colorType:"primary"},{color:"#373d41",theme:"black",colorType:"primary"},{color:"#386bd0",theme:"gradual-one",colorType:"gradual"},{color:"#00a65a",theme:"gradual-two",colorType:"gradual"},{color:"#D24D57",theme:"gradual-three",colorType:"gradual"},{color:"#957BBD",theme:"gradual-four",colorType:"gradual"},{color:"#373d41",theme:"gradual-five",colorType:"gradual"}]}),selModel:{deselectOnContainerClick:!1},tpl:['<div class="box-title">'+this.localLang.themeUpdate+"</div>",'<tpl for=".">',"<tpl if=\"colorType == 'primary'\">",'<div class="item jeicon" data-color="{color}" style="margin: 2px 10px;border-radius: 50%;height: 25px;width: 25px;background-color:{color}"></div>',"</tpl>","<tpl if=\"colorType == 'gradual'\">",'<div class="item {theme} jeicon" data-color="{color}" style="margin: 2px 10px;border-radius: 50%;height: 25px;width: 25px;"></div>',"</tpl>","</tpl>"],listeners:{selectionchange:function(e,t){var i=t[0];JE.changeTheme(i.get("theme"),!0)},refresh:function(e){var t=Ext.value(JE.currentUser.theme,"blue,black,blue").split(",")[0],i=e.store.findRecord("theme",t);i&&e.getSelectionModel().select(i,!0,!0)}}}},getAuthBox:function(){var s=this,e=s.getAuthInfo(),t=JE.systemConfig.JE_SYS_QUICKLOGIN,i=JE.systemConfig.JE_SYS_WXQUICKLOGIN,a=JE.systemConfig.JE_SYS_QQQUICKLOGIN,n=JE.systemConfig.JE_SYS_DDQUICKLOGIN,o=[];return"1"==i&&o.push({type:"weixin",number:e.weixin}),"1"==a&&o.push({type:"qq",number:e.qq}),"1"==n&&o.push({type:"dt",number:e.dt}),{xtype:"dataview",hidden:"1"!=t||"1"!=i&&"1"!=a&&"1"!=n,cls:"auth",itemSelector:"div.item",store:Ext.create("Ext.data.Store",{fields:["type","number"],data:o}),tpl:['<div class="box-title">'+s.localLang.bindingMsg+"</div>",'<tpl for=".">','<div class="item <tpl if="JE.isNotEmpty(number)">binding</tpl>">',"<tpl if=\" type == 'dt' \">",'<i class="icon jeicon jeicon-dingding" title="'+s.localLang.bindingTitle+'"></i>',"<tpl else>",'<i class="icon jeicon jeicon-{type}" title="'+s.localLang.bindingTitle+'"></i>',"</tpl>",'<tpl if="JE.isNotEmpty(number)">','<div class="number">{number}</div>','<div class="unbindtext">'+s.localLang.bindingCallOff+"</div>","<tpl else>",'<div class="bindtext">'+s.localLang.bindingCallOn+"</div>","</tpl>","</div>","</tpl>"],listeners:{itemclick:function(e,i,t,a,n){var o=n.getTarget("",1,!0),r=i.get("type");if(o.hasCls("icon")){var l=s.getAuthInfo();e.store.each(function(e){e.set("number",Ext.value(l[e.get("type")],""))})}else o.hasCls("bindtext")?s.doAuthInfo({type:r}):o.hasCls("unbindtext")&&JE.confirm(s.localLang.bindingCallOffMsg,function(e,t){"ok"==e&&s.doAuthInfo({disableAuth:!0,type:r}).success&&(i.set("number",""),JE.msg(s.localLang.bindingCallOffSuccess))})}}}},getLogoutBox:function(){return{xtype:"box",cls:"logout",itemId:"logout",html:['<i class="fe icon-logout"></i> '+this.localLang.exitText].join(""),listeners:{afterrender:function(e){e.getEl().on("click",function(){JE.logout()})}}}}}),Ext.define("JE.app.view.LockView",{extend:"Ext.panel.Panel",border:0,alias:"widget.applockview",id:"app-lockview",cls:"je-app-lockview",initComponent:function(){this.layout={type:"table",columns:1,tableAttrs:{style:{width:"100%",height:"100%"}},tdAttrs:{align:"center",vAlign:"middle"}},this.items={xtype:"container",layout:{type:"vbox",align:"center"},items:[{xtype:"box",itemId:"photo",cls:"photo-box",tpl:["<img src={photo}>","<div>{name}</div>","<p>输入登录密码进入系统</p>"]},{xtype:"textfield",hidden:!0},{xtype:"uxtrigger",margin:20,width:300,cls:"lock-password",clearButton:!1,inputAttrTpl:"onfocus=\"this.type='password'\"",itemId:"lockfield",handler:function(e){var t=e.getValue(),i=e.next("box");JE.isEmpty(t)?i.update("请输入密码！"):JE.ajax({url:JE.getUrlMaps("je.core.login.checkUser"),params:{j_username:JE.USER.userCode,j_password:e.getValue()}}).success?(JE.lockAPP(!1),i.update("")):i.update("密码错误！")}},{xtype:"box",itemId:"error",cls:"error-box"}]},this.callParent(arguments),this.on("activate",function(e){var t=e.getCmp(0).getCmp("photo"),i=JE.getUserPhoto()||JE.getStaticUrl("JE.common.user");t.update({photo:i,name:JE.USER.username})}),this.lockField=this.getCmp(0).getCmp("lockfield")}}),Ext.define("JE.app.view.MainView",{extend:"Ext.panel.Panel",border:0,layout:"border",alias:"widget.appmainview",id:"app-mainview",mixins:["JE.app.util.Util"],initComponent:function(){var e=this,t={region:"north",xtype:"appnorthview",height:65,border:0,hidden:1==window.__HIDDEN_JE_HEADER,items:[]},i={xtype:"appcenterview",region:"center",tabBar:{cls:"je-header-tabbar",style:"border-top-color:transparent;"}};if(JE.requestParams.funcCode)return i.tabBar.hidden=!0,i.margins="0",t.hidden=!0,e.items=[t,i],void e.callParent(arguments);e.buildTheme(null,t,i),e.items=[t,{xtype:"panel",border:0,region:"center",layout:"card",itemId:"center"}],e.itemsConfig={main:{xtype:"panel",border:0,items:i,itemId:"main",layout:"border",listeners:{afterrender:function(){e.buildMenu()}}}},e.callParent(arguments)},afterRender:function(){this.callParent(arguments),!JE.isEmpty(this.homeData)&&1!=this.homeData.length||this.setActiveView("main")},buildHomeData:function(){var a=[],n=_JE_LOCAL_LANG,e=JE.ajax({url:"/je/portal/homeIndex/load",params:{tableCode:"JE_CORE_HOME",limit:-1,orderSql:"order by sy_orderindex",whereSql:"AND SY_STATUS='1'"}});return JE.isNotEmpty(e.rows)&&Ext.each(e.rows,function(e){var t=JE.split(e.HOME_KJRY_CODE,",");if(JE.isEmpty(t)||-1!=t.indexOf(JE.USER.phone)){var i=e.HOME_BT;"en"==n&&JE.isNotEmpty(e.HOME_YWBT)&&(i=e.HOME_YWBT),a.push({code:e.HOME_BM,title:i,type:e.HOME_LX,code:e.HOME_BM,icon:e.HOME_TB,configInfo:e.HOME_PZXX,layer:JE.toNum(e.HOME_BZ||"4"),menuId:e.HOME_CSGN_ID})}}),this.homeData=a},getItemsCfg:function(e){return this.itemsConfig[e]},setActiveView:function(e){e=Ext.isString(e)?{code:e}:e;var t=Ext.getCmp("app-mainview").getCmp("center");if(t){var i=-1!=["MAIN","MENU"].indexOf(e.type)?"main":e.code,a=t.getCmp(i);if(!a){if(a={itemId:i},this.getItemsCfg(i))a=Ext.applyIf(a,this.getItemsCfg(i));else if(JE.isNotEmpty(e.configInfo))if("IDIT"==e.type){var n=e.configInfo.split(","),o=n[1],r=n[0];a.xtype=JE.getXTypeByClassName(r),o&&JE.initCtr(o)}else if("IFRAME"==e.type){var l=e.configInfo;a=Ext.applyIf(a,{xtype:"box",html:'<iframe scrolling="auto" frameborder="0" width="100%" height="100%" src='+l+"></iframe>",listeners:{afterrender:function(e){var t=e.getEl().down("iframe").dom;t.contentWindow.onfocus=function(){JE.browser.focus(!0)},t.contentWindow.onblur=function(){JE.browser.blur(!0)}}}})}else"PORTAL"==e.type&&(a=Ext.applyIf(a,{xtype:"jeportalview",beanId:e.configInfo}));else a=Ext.applyIf(a,{xtype:"box",html:"功能配置信息不存在！"});a=t.add(a)}if(a){t.getLayout().setActiveItem(a);Ext.getCmp("app-topmenu");var s=Ext.getCmp("_jewestview");if("MENU"==e.type?JE.openFuncById(e.configInfo):"MAIN"==e.type&&s&&"appmenutiled"==s.xtype&&s.loadMenuData(),-1!=["MENU","MAIN"].indexOf(e.type)&&JE.isNotEmpty(JE._MENUS)){var d=JE.split(e.menuId,","),c=!0;if(Ext.each(d,function(e){if(JE._MENUS[e])return JE.openFuncById(e),c=!1}),c){var u="__empty_func__",p=Ext.getCmp("_appcenterview");p.getCmp(u)||p.add({xtype:"box",html:'<img src="'+JE.getStaticUrl("JE.app.view.MainView.no-perm")+'" style="margin-top: -200px;position: absolute;top: 50%;left: 50%;margin-left: -300px;height:350px;">',itemId:u}),p.getLayout().setActiveItem(u)}}JE.isNotEmpty(e.type)&&s&&"appmenutiled"==s.xtype&&s.setVisible(-1!=["MENU","MAIN"].indexOf(e.type))}else JE.msg("功能不存在！")}},initHomeMenu:function(){var e=Ext.getCmp("app-header");if(e){var t=e.getMenuBar&&e.getMenuBar();if(t){var i=t.getSelectionModel().getSelection()[0]||t.store.getAt(0);this.setActiveView(i.data)}}},buildMenu:function(){var r=this;if(r.getCmp("center")){var l=r.getCmp("center").getCmp("main"),i=JE.getTheme(),a=Ext.util.Cookies.get("je-local-lang")||"zh_CN",n=0,s=function(e){if("plus"==i&&(e.iconCls=JE.getIconCls(e.bean,"MENU_ICONCLS","MENU_FONTICONCLS")),delete e.checked,e.text="en"==a?Ext.value(e.bean.MENU_MENUSUBNAME,e.text):e.text,"1"==(JE._MENUS[e.id]=e).bean.MENU_QUICKSTART&&JE._MENUS4SHORT.push({KJMENU_YHUD:JE.USER.userId,KJMENU_CDID:e.id,SY_ORDERINDEX:++n}),-1==["IFRAME","MENU","URL"].indexOf(e.nodeInfoType)){var t=JE.split(e.nodeInfo,",")[0];t&&(JE._MENUS4CODE[t]=e)}Ext.each(e.children,function(e){s(e)})};JE.ajax({url:JE.getUrlMaps("je.core.staticize","loadStaticize"),params:{type:"MENU"},async:!0,success:function(e){var t=Ext.decode(Ext.value(e.responseText,"{}"));s(t),r.menuData=Ext.clone(t);var i=JE.USER.menuType=JE.systemConfig.JE_SYS_MENUTYPE||"left-tiled";if(-1!=["top","lefttop"].indexOf(i)){"top"==i&&(window.__HIDDEN_JE_MENU=!0);var a={xtype:"appmenutop",region:"north",menuData:t};setTimeout(function(){l.add(a)})}if(1!=window.__HIDDEN_JE_MENU){var n;if(-1!=["lefttop","left"].indexOf(i)){var o=JE.toNum(JE.systemConfig.JE_SYS_MENUWIDTH);n={xtype:"appmenuleft",region:"west",width:o=0<o?o:200,maxWidth:o,menuData:t}}else"left-tiled"==i&&(n={xtype:"appmenutiled",region:"west",initMenuData:(r.homeData||[]).length<=1,menuData:t});setTimeout(function(){l.add(n)})}setTimeout(function(){JE.loadBadge(),r.initHomeMenu()},100)}})}},doFullScreen:function(){var e=Ext.getCmp("app-header"),t=e.isHidden();if(e[t?"show":"hide"](),1!=window.__HIDDEN_JE_MENU){var i=Ext.getCmp("_jewestview");i&&(i.changeView?i.changeView(!t):i[t?"expand":"collapse"]())}},toggleConfigView:function(){var e=Ext.getCmp("app-configview");(e=e||this.add({xtype:"appconfigview",width:320,region:"east",northHeight:Ext.getCmp("app-header").height})).toggle()}}),Ext.define("JE.app.view.menu.MenuLeftView",{extend:"Ext.panel.Panel",alias:"widget.appmenuleft",id:"_jewestview",layout:"card",cls:"je-menu-left",menuSmall:!1,border:0,width:200,minWidth:50,maxWidth:200,initComponent:function(){var i=this;delete i.title,delete i.iconCls,i.items=i.buildMenu(i.menuData);var e=JE.getUserPhoto()||JE.getStaticUrl("JE.common.user");i.tbar={xtype:"panel",layout:"column",border:0,itemId:"tbar",defaults:{columnWidth:1},items:[{xtype:"box",cls:"je-menu-user-small",itemId:"user-small",tpl:'<img src="{photo}">',padding:10,hidden:!0,data:{photo:e},listeners:{afterrender:function(e){e.getEl().down("img").on("click",function(){i.changeView(!1)})}}},{xtype:"box",height:"auto",padding:10,itemId:"user",cls:"je-menu-user",tpl:['<div class="pull-left image"><img src="{photo}"></div>','<div class="pull-left info"><div class="name">{userName}</div>'+(JE.isEmpty(JE.USER.depts)?'<div class="dept"><i class="fa fa-circle" style="color:#3c763d;margin-right:5px;"></i>{deptName}</div>':'<div class="dept dept-menu" title="切换部门" style="cursor: pointer;"><i class="fa fa-circle" style="color:#3c763d;margin-right:5px;"></i>{deptName}<i class="fa fa-caret-down" style="color:#ffffff;margin-left:5px;"></i></div>')+"</div>",'<i class="fa fa-refresh refresh"></i>'],data:{userName:JE.currentUser.username,deptName:JE.currentUser.deptName,photo:e},listeners:{afterrender:function(e){e.getEl().on("click",function(e){if(e.getTarget("img",1))i.changeView(!0);else if(e.getTarget(".dept",2)){var t=e.getTarget(".dept",2,!0);t.hasCls("dept-menu")&&i.changeUserDept(t)}})}}}]},i.callParent(arguments)},changeUserDept:function(e){if(!this.deptMenu){var t=JE.USER.depts;this.deptMenu=Ext.create("Ext.menu.Menu",{shadow:!1,plain:!0,items:t})}this.deptMenu.showBy(e,"tr-br")},changeView:function(t){this.getEl()[t?"addCls":"removeCls"]("je-menu-small"),this.menuSmall=t;var e=this.getDockedCmp("tbar");e.getCmp("user-small").setVisible(t),e.getCmp("user").setVisible(!t),this.items.each(function(e){e.getDockedCmp("search").setVisible(!t),e.collapseAll()}),this.setWidth(t?this.minWidth:this.maxWidth)},buildSearchItem:function(e){var t=new Ext.data.Store({fields:["id","text","code","pinyin","iconCls"],data:this.buildSearchData(e)}),i=new Ext.util.Filter({filterFn:function(e){var t=Ext.value(this.value,"").toLocaleLowerCase();return-1!=e.get("text").toLocaleLowerCase().indexOf(t)||-1!=e.get("pinyin").indexOf(t)}});return t.addFilter(i,!1),{xtype:"cbbfield",itemId:"search",cls:"je-menu-search je-tree-search",editable:!0,clearButton:!1,hideTrigger2:!0,minChars:1,store:t,emptyText:"Search...",queryFilter:i,margin:0,listConfig:{cls:"je-menu-search-list",getInnerTpl:function(e){return'<i class="{iconCls} icon"></i><span class="text">{text}</span>'}},reset:function(){this.setValue(""),this.doQuery()},doQuery:function(e,t,i){return JE.isEmpty(e)?(this.collapse(),!1):this.superclass.doQuery.call(this,e,t,i)},listeners:{select:function(e,t){var i=t[0].data.id,a=e.tree,n=(a=a||(e.tree=e.up("treepanel"))).store.getNodeById(i);n&&(a.selectPath(n.getPath()),setTimeout(function(){var e=Ext.get(a.view.getNode(n));JE.scrollBy(a.view,e)},300))}}}},buildSearchData:function(e){var t=this,i=[];return Ext.each(e,function(e){e.iconCls;JE.isNotEmpty(e.children)?i=i.concat(t.buildSearchData(e.children)):i.push({id:e.id,code:e.code,text:e.text,pinyin:JE.toPinYin(e.text,"pinyin"),iconCls:e.iconCls})}),i},getMenuTree:function(e,t){var l=this,i={xtype:"treepanel",useArrows:!0,animate:!1,type:t,itemId:e.id,root:e,rootVisible:!1,cls:"je-treemenu-tree",border:0,store:Ext.create("JE.core.store.TreeStore"),hideHeaders:!0,viewConfig:{toggleOnDblClick:!1,overItemCls:"je-treemenu-over",selectedItemCls:"je-treemenu-selected",focusedItemCls:"je-treemenu-focused",beforeFocusedItemCls:"je-treemenu-before-focused",tableFocusedFirstCls:"je-treemenu-focused-first",expandedCls:"je-treemenu-node-expanded"},columns:[{flex:1,dataIndex:"text",type:t,renderer:function(e,t,i){var a=i.raw.iconCls,n=i.getDepth();"main"==this.type&&1==n?t.innerCls="je-menu-treefolder":(t.innerCls="je-menu-treeinner",t.style="padding-left:"+15*(n-1)+"px"),e='<i class="icon '+a+'"></i><span class="text">'+e+"</span>";var o="",r=JE._BADGES[i.getId()];if(r){var l=JE.toNum(r.num);if(0<l)o='<div class="badge '+Ext.value(r.cls,"")+'" style="'+Ext.value(r.style,"")+'">'+l+"</div>"}return i.hasChildNodes()&&(o+='<i class="fa fa-angle-left icon-arrow"></i>'),e+='<div class="node-right">'+o+"</div>"}}],listeners:{beforeselect:function(e,t,i,a){return!t.hasChildNodes()},itemclick:function(e,t,i,a,n,o){var r=t.isExpanded();"main"!=e.panel.type||1!=t.getDepth()||r||e.panel.collapseAll(),t[r?"collapse":"expand"](),l.openFunc(t.raw),"child"==e.panel.type&&!t.hasChildNodes()&&l.menu&&l.menu.hide()},afterrender:function(r){"main"==r.type&&r.body.on("mouseover",function(e){if(l.menuSmall&&l.menu){var t=e.getTarget(".x-grid-data-row",5,!0);if(t){var i=r.view.getRecord(t);if(1==i.getDepth()){var a=r.getWidth(),n=t.getY(),o=i.getId();if(l.menu.getCmp(o)||l.menu.itemsData[o])l.menu.getCmp(o)||l.menu.add(l.menu.itemsData[o]),l.menu.getLayout().setActiveItem(o),l.menu.showAt(a,n);else l.menu.hide()}else l.menu.hide()}}})},beforeitemexpand:function(e){return"child"==this.type||"main"==this.type&&!l.menuSmall},itemcollapse:function(e){if("child"==this.type){var t=l.getLayout().getActiveItem(),i=l.menu.getLayout().getActiveItem().itemId,a=t.store.getNodeById(i),n=Ext.get(t.view.getNode(a)),o=l.minWidth,r=n.getY();setTimeout(function(){l.menu.showAt(o,r)},100)}}}};return e.expanded=!0,JE.isNotEmpty(e.children)&&1==e.children.length&&(e.children[0].expanded=!0),"main"==t?(i.tbar=l.buildSearchItem(e.children),i.bodyStyle="border-width:0px;"):"child"==t&&(i.tbar={xtype:"box",html:e.text+'<div class="node-right"><i class="fa fa-angle-left icon-arrow"></i></div>',cls:"je-menu-treetitle",height:44,listeners:{afterrender:function(e){e.getEl().on("click",function(){l.openFunc(e.ownerCt.getRootNode().raw)})}}}),i},buildMenu:function(e){var n=this,t=JE.USER.menuType,o=[],r={},l={};return"lefttop"==t?(Ext.each(n.menuData.children,function(e,t){if(JE.isNotEmpty(e.children)){var i=Ext.clone(e),a=n.getMenuTree(i,"main");0==t?o.push(a):l[a.itemId]=a,Ext.each(i.children,function(e,t){if(JE.isNotEmpty(e.children)){var i=n.getMenuTree(Ext.clone(e),"child");r[i.itemId]=i}})}}),n.trees=l):(Ext.each(n.menuData.children,function(e,t){if(JE.isNotEmpty(e.children)){var i=n.getMenuTree(Ext.clone(e),"child");r[i.itemId]=i}}),o.push(n.getMenuTree(e,"main"))),n.menu=Ext.create("Ext.menu.Menu",{cls:"je-menu-left",shadow:!1,layout:"card",plain:!0,width:n.width,maxHeight:750,itemsData:r,items:[]}),o},setActiveMenu:function(e){var t=this.getCmp(e);t||(t=this.add(this.trees[e])).getDockedCmp("search").setVisible(!this.menuSmall),this.getLayout().setActiveItem(e)},loadModelMenu:function(e){},refreshUserInfo:function(e){},buildRefreshTool:function(e){var t=this;t.refreshMenu=Ext.create("Ext.menu.Menu",{shadow:!1,defaults:{handler:function(e){JE.CoreUtil.refreshCache(e.type)}},items:[{text:"清空变量缓存",type:"sysvar",iconCls:"fa fa-file-o"},{text:"清空功能缓存",type:"func",iconCls:"fa fa-file-o"},{text:"清空字典缓存",type:"dic",iconCls:"fe icon-book-alt"},{text:"清空菜单缓存",type:"menu",iconCls:"fa fa-navicon"},{text:"清空所有缓存",type:"all",iconCls:"fe icon-arrows-cw"}]});var i=t.getDockedCmp("tbar").getCmp("user");if(i.rendered){var a=i.getEl().down(".refresh");a.setStyle("visibility","visible"),a.on("click",function(){t.refreshMenu.showBy(a,"tl-br",[-10,10])})}else i.on("afterrender",function(){var e=i.getEl().down(".refresh");e.setStyle("visibility","visible"),e.on("click",function(){t.refreshMenu.showBy(e,"tl-br",[-10,10])})})},openFunc:function(e){var t=e.iconCls,i={type:e.nodeInfoType,info:e.nodeInfo,id:e.id,title:e.text,iconCls:t,showView:e.hrefTarget,tree:this.getCmp("tree"),modelId:this.modelId,fontIconColor:e.bean.MENU_FONTICONCOLOR,cpids:e.bean.CPID};JE.openFunc(i);var a=Ext.getCmp("app-configview");a&&!a.collapsed&&a.toggle()}}),Ext.define("JE.app.view.menu.MenuTiledView",{extend:"Ext.container.Container",border:0,alias:"widget.appmenutiled",id:"_jewestview",border:0,layout:"fit",maxWidth:230,minWidth:60,width:60,initComponent:function(){var e=this;e.localLang=JE.getLocalLang("core.menuHeadSet.leftmenu"),JE.loadScript("/static/ux/sortable/Sortable.min.js"),e.basicMenus=e.menuData,e.callParent(arguments),e.on({boxready:function(){e.initMenus(),e.initMenuData&&e.loadMenuData(e.basicMenus)},resize:function(){e.resetShortcutViewSize()}})},afterRender:function(){this.callParent(arguments)},initLockData:function(){var e="and USERINFO_USERID='"+JE.USER.userId+"' AND USERINFO_TYPE='MENU_LOCK'",t=JE.ajax({url:JE.getUrlMaps("je.core.rbac.rbac.load"),params:{limit:1,tableCode:"JE_CORE_USERINFO",whereSql:e}});JE.isNotEmpty(t.rows)&&(this.locked=t.rows[0].JE_CORE_USERINFO_ID,this.lockMenu(!0))},lockMenu:function(e){var t=this,i=0!=e;if(i){if(!t.locked){var a=JE.ajax({url:JE.getUrlMaps("je.core.save"),params:{USERINFO_USERID:JE.USER.userId,USERINFO_TYPE:"MENU_LOCK",tableCode:"JE_CORE_USERINFO"}});a.success&&(t.locked=a.obj.JE_CORE_USERINFO_ID)}}else t.locked&&JE.ajax({url:JE.getUrlMaps("je.core.remove"),async:!0,params:{ids:t.locked,tableCode:"JE_CORE_USERINFO"}}),delete t.locked;t.setWidth(i?t.maxWidth:t.minWidth),i&&t.shortcutView.setWidth(i?t.maxWidth:t.minWidth),t.shortcutView.refresh()},setVisible:function(e){this.callParent(arguments),this.shortcutView&&this.shortcutView.getEl().setVisible(e),this.menuPanel.getEl().hide()},loadMenuData:function(e){var t=Ext.getCmp("app-header"),i=4;if(t&&e){var a=t.getMenuBar&&t.getMenuBar();if(a){var n=a.getSelectionModel().getSelection()[0];i=JE.toNum(n.get("layer"))}2!=i&&3!=i||(e={children:e})}this.buildMenuData(e||this.basicMenus,i),this.shortcutView.store.loadData(this.menuData.shortcutMenus),this.menusView.store.loadData(this.menuData.menus),this.locationView.store.loadData(this.menuData.locations),JE.loadBadge()},initMenus:function(){var e=this;e.shortcutView=e.getShortcutView(),e.menuPanel=e.getMenuView(),e.menusView=e.menuPanel.getCmp("menusview"),e.locationView=e.menuPanel.getCmp("locationview"),e.searchField=e.menuPanel.getCmp("searchView").getCmp("searchField"),e.shortcutView.showBy(e,"tl-tl"),e.menuPanel.showBy(e.shortcutView,"tl-tr"),e.menuPanel.getEl().hide(),e.resetShortcutViewSize(),e.initCollapseMenusEvent(),e.initLockData()},resetShortcutViewSize:function(){this.shortcutView.setHeight(this.getHeight()),this.menuPanel.setHeight(this.getHeight())},initCollapseMenusEvent:function(){var n=this;Ext.getBody().on("click",function(e){var t=e.getTarget(".je-tiledview-menusview",10,!0),i=e.getTarget(".je-tiledview-shortcutview",10,!0),a=e.getTarget(".menus",3,!0);a||t||i?i&&!a&&n.setMenuVisible(!1):n.setMenuVisible(!1,function(){n.setShortVisible(!1)})})},buildMenuData:function(e,t){var o=_JE_LOCAL_LANG,n=function(e,i){var a=[];return Ext.each(e,function(e){if("MENU"!=e.nodeInfoType){var t=e.text;"en"==o&&JE.isNotEmpty(e.bean.MENU_MENUSUBNAME)&&(t=e.bean.MENU_MENUSUBNAME),a.push(Ext.apply({id:e.id,text:t,code:JE.toPinYin(e.text,"pinyin"),iconCls:e.iconCls,iconColor:e.bean.MENU_FONTICONCOLOR},i))}a=a.concat(n(e.children,i))}),a},r=[];Ext.each(e.children,function(a){if("MENU"!=a.nodeInfoType){var e=a.text;"en"==o&&JE.isNotEmpty(a.bean.MENU_MENUSUBNAME)&&(e=a.bean.MENU_MENUSUBNAME),r.push({id:a.id,text:e,code:JE.toPinYin(a.text,"pinyin"),iconCls:a.iconCls,iconColor:a.bean.MENU_FONTICONCOLOR,menu:a.text,menuId:a.id,model:a.text,modelId:a.id})}Ext.each(a.children,function(e){var t=e.text;"en"==o&&JE.isNotEmpty(e.bean.MENU_MENUSUBNAME)&&(t=e.bean.MENU_MENUSUBNAME);var i={menu:t,menuId:e.id,model:a.text,modelId:a.id};"MENU"!=e.nodeInfoType?r.push(Ext.apply({id:e.id,text:t,code:JE.toPinYin(e.text,"pinyin"),iconCls:e.iconCls,iconColor:a.bean.MENU_FONTICONCOLOR},i)):r=r.concat(n(e.children,i))})});var i=[],a=[],l=[];Ext.each(r,function(e){2==t&&(e.menu="",e.menuId=""),-1==a.indexOf(e.modelId)&&(a.push(e.modelId),i.push({id:e.modelId,type:"model",text:e.model})),-1==a.indexOf(e.menuId)&&(a.push(e.menuId),i.push({id:e.menuId,type:"menu",text:e.menu})),l.push(e.id)});var s=JE.ajax({url:JE.getUrlMaps("je.core.rbac.rbac.load"),params:{tableCode:"JE_CORE_KJMENU",whereSql:" and KJMENU_YHUD='"+JE.currentUser.userId+"'",orderSql:" order by SY_ORDERINDEX",limit:-1}}).rows;JE.isEmpty(s)&&(s=this.initDefaultShortMenu());var d=[];Ext.each(s,function(e,t){var i=e.KJMENU_CDID,a=JE._MENUS[i];if(a){var n=a.text;"en"==o&&JE.isNotEmpty(a.bean.MENU_MENUSUBNAME)&&(n=a.bean.MENU_MENUSUBNAME),d.push({id:a.id,text:n,code:a.code,iconCls:a.iconCls,index:t,dataId:e.JE_CORE_KJMENU_ID})}}),this.menuData={menus:r,shortcutMenus:d,locations:i}},initDefaultShortMenu:function(){var e=[];if(JE.isNotEmpty(JE._MENUS4SHORT)){var t=JE.ajax({url:JE.getUrlMaps("je.core.rbac.rbac.insertUpdateList"),params:{tableCode:"JE_CORE_KJMENU",strData:Ext.encode(JE._MENUS4SHORT)}});t.success&&(e=t.obj)}return e},getShortcutView:function(){var l=this;return Ext.create("Ext.view.View",{floating:!0,shadow:!1,width:l.width,minWidth:l.minWidth,maxWidth:l.maxWidth,itemId:"shortcutview",selModel:{deselectOnContainerClick:!1},selectedItemCls:"func-select",overItemCls:"func-over",cls:"je-tiledview-shortcutview",itemSelector:"li.func",tpl:['<div class="shortcutview">','<ul class="shortmenus">','<tpl for=".">','<li class="func" data-id="{id}">','<div class="icon"><div class="{[Ext.value(values.iconCls,"fa fa-circle-o")]}"></div></div>','<span class="text">{text}</span>','<i class="remove-icon jeicon jeicon-error"></i>','<i class="move-icon jeicon jeicon-move"></i>',"</li>","</tpl>","</ul>","</div>",'<div class="menus">','<div><i class="icon fa fa-th"></i><span class="text">'+l.localLang.leftmenuTitle+'</span><i class="right-icon fa fa-angle-right"></i></div>',"</div>",'<div class="menu-lock" style="width:'+l.maxWidth+'px;">','<div class="menu-style-color">','<div class="menu-color-option black jeicon" data-type="black"></div>','<div class="menu-color-option black-gradual jeicon" data-type="black-gradual"></div>','<div class="menu-color-option white jeicon" data-type="white"></div>','<div class="menu-color-option white-gradual jeicon" data-type="white-gradual"></div>',"</div>",'<tpl if="this.mainCmp.locked">','<div class="unlock" style="padding:0 7px 0;"><i class="icon fa fa-unlock"></i>'+l.localLang.menuOpen+"</div>","<tpl else>",'<div class="lock" style="padding:0 9px 0;"><i class="icon fa fa-lock"></i> '+l.localLang.menulock+"</div>","</tpl>","</div>",{mainCmp:l}],store:Ext.create("Ext.data.Store",{fields:["id","text","code","iconCls","icon","nodeInfo","dataId","index"]}),listeners:{afterrender:function(o){setTimeout(function(){var e=o.getEl().dom.childNodes[2].childNodes[0].childNodes,i=JE.currentUser.theme.split(",")[1];Ext.each(e,function(t){Ext.each(t.classList,function(e){e==i&&t.classList.add("menu-color-selected")})})},500),o.getEl().on({click:function(e){var t=e.getTarget(".menus",3,!0),i=e.getTarget(".menu-color-option",3);if(t)JE.defer(function(){if(!l.shortcutView.animating)return l.setShortVisible(!0,function(){l.setMenuVisible(l.menuPanel.isHiddening)}),!1},1);else if(e.getTarget(".lock",2))l.lockMenu(!0);else if(e.getTarget(".unlock",2))l.lockMenu(!1);else if(i){var a=i.parentNode.childNodes;Ext.each(a,function(e){e.classList.remove("menu-color-selected")});var n=i.getAttribute("data-type");i.classList.add("menu-color-selected"),window._JE_SYS_THEME_LEFTMENU=n,JE.changeTheme(n,!0,"leftMenu")}o.getEl().focus()},mouseenter:function(e){o.animating=!1,l.funcOpening||l.setShortVisible(!0)},mouseleave:function(e){var t=l.shortcutView.getEl(),i=e.getX(),a=e.getY(),n=t.getWidth(),o=t.getX(),r=t.getY();(o+n<i||a<r)&&l.setShortVisible(!1)}})},beforeitemclick:function(e,t,i,a,n){var o=n.getTarget(".remove-icon"),r=n.getTarget(".move-icon");return o&&setTimeout(function(){l.doShortAct("remove",t.get("id"))}),!r&&!o},itemclick:function(e,t,i,a,n){l.openFunc(t.get("id"))},refresh:function(e){var t=e.getEl().dom.childNodes[2].childNodes[0].childNodes,i=window._JE_SYS_THEME_LEFTMENU;Ext.each(t,function(t){Ext.each(t.classList,function(e){e==i&&t.classList.add("menu-color-selected")})}),l.buildShortcutDDZone()}}})},setShortVisible:function(e,t){var i=this.shortcutView,a=i.getEl();if(this.locked)return t&&t(),void a.addCls("menu-color-show");e?i.animating||(a.getWidth()==i.maxWidth?t&&t():(i.animating=!0,a.addCls("showing"),a.addCls("menu-color-show"),a.setWidth(i.maxWidth,{duration:200,easing:"ease",callback:function(){delete i.animating,t&&t()}}))):!i.animating&&this.menuPanel.isHiddening&&(a.getWidth()==i.minWidth?t&&t():(i.animating=!0,a.setWidth(i.minWidth,{duration:100,easing:"ease",callback:function(){a.removeCls("showing"),a.removeCls("menu-color-show"),delete i.animating,t&&t()}})))},setMenuVisible:function(e,t){if(this.menuPanel.isHiddening!=!e)if(e){this.menuPanel.isHiddening=!1;var i=this.shortcutView.getEl(),a=i.getX()+i.getWidth(),n=i.getY();this.menuPanel.getEl().setXY([a,n]),this.menuPanel.getEl().hide(),this.menuPanel.getEl().slideIn("l",{easing:"ease",duration:300,callback:function(){t&&t()}})}else this.menuPanel.isHiddening=!0,this.menuPanel.getEl().slideOut("l",{easing:"ease",duration:200,callback:function(){t&&t()}});else t&&t()},getMenuView:function(){var e=[],t=Ext.create("Ext.data.Store",{fields:["id","text","code","model","menu","menuId","modelId","iconCls","iconColor"]}),i=Ext.create("Ext.data.Store",{fields:["id","text","type"]}),a=this.getMenusView(t),n=this.getMenuLocationView(i),o=this.getSearchView();return e.push(a,n,o),Ext.create("Ext.container.Container",{floating:!0,shadow:!1,isHiddening:!0,width:960,cls:"je-tiledview-menusview",layout:"border",items:e})},getSearchView:function(){var i=this;return{xtype:"container",layout:"column",region:"north",padding:"40 0 0 30",height:80,itemId:"searchView",items:[{xtype:"textfield",width:720,height:40,itemId:"searchField",emptyText:i.localLang.queryText,cls:"menusview-searchfield",listeners:{afterrender:function(e){e.inputEl.insertHtml("beforeBegin",'<i class="search-icon fa fa-search"></i>',!0);i.listKeyNav=new Ext.view.BoundListKeyNav(e.inputEl,{boundList:i.menusView,forceKeyDown:!0,enter:function(e){this.selectHighlighted(e);var t=this.boundList.getSelectionModel().getSelection()[0];t&&i.openFunc(t.get("id"))}}),i.listKeyNav.highlightAt=function(e){var t=this.boundList,i=t.all.item(e);i&&(i=i.dom,t.highlightItem(i),t.getEl().down(".scroll-body").scrollByEl(Ext.get(i),!1))}},change:function(){i.doSearchKeyword()}}}],listeners:{afterrender:function(e){e.getEl().insertHtml("afterEnd",'<i class="close-icon fe icon-cancel-4"></i>',!0).on("click",function(){i.setMenuVisible(!1,function(){i.setShortVisible(!1)})})}}}},doSearchKeyword:function(){var e=this;e.searchTask||(e.searchTask=new Ext.util.DelayedTask(function(){var n=e.searchField.getValue().toLocaleLowerCase(),o=[];e.menusView.store.filterBy(function(e){var t=e.get("text").toLocaleLowerCase(),i=e.get("code").toLocaleLowerCase(),a=e.data;return(-1!=t.indexOf(n)||-1!=i.indexOf(n))&&(-1==o.indexOf(a.model)&&o.push(a.model),-1==o.indexOf(a.menu)&&o.push(a.menu),!0)}),e.locationView.store.filterBy(function(e){return-1!=o.indexOf(e.get("text"))})})),e.searchTask.delay(100)},getMenusView:function(e){var l=this;return Ext.create("Ext.view.View",{itemId:"menusview",selectedItemCls:"func-select",overItemCls:"func-over",cls:"menusview-menus",itemSelector:"div.func",region:"center",tpl:['{% var model = "",menu = "";%}',"{[this.getKeywordInfo()]}",'<div class="scroll-body">','<tpl for=".">',"{% if(model != values.model){model = values.model;%}",'<div class="model" data-text="{model}" data-id="{modelId}" data-type="menu">{model}</div>',"{%}%}","{% if(menu != values.menu){menu = values.menu;%}",'<div class="menu" data-text="{menu}" data-id="{menuId}" data-type="menu">{menu}</div>',"{%}%}",'<div class="func {[this.isStar(values)]}" data-id="{id}">','<div class="icon {[Ext.value(values.iconCls,"fa fa-circle-o")]}" style="{[this.getIconStyle(values)]}"></div>',"<span>{text}</span>",'<i class="star-o fa fa-star-o"></i>','<i class="star fa fa-star"></i>',"</div>","</tpl>","</div>",{isStar:function(e){return l.shortcutView.store.getById(e.id)?"shortcut":""},getKeywordInfo:function(){var e=l.searchField.getValue(),t="";return JE.isNotEmpty(e)&&(t=0==l.menusView.store.getCount()?'<div class="keyword-view">未找到与“<span class="keyword">'+e+"</span>”相关的功能。</div>":'<div class="keyword-view">以下是与“<span class="keyword">'+e+"</span>”相关的功能：</div>"),t},getIconStyle:function(e){var t="margin-right:5px;";if(JE.isNotEmpty(e.iconColor))t="margin-right:5px;color:"+e.iconColor+";";return t}}],store:e,listeners:{itemclick:function(e,t,i,a,n){var o=n.getTarget(".star-o"),r=n.getTarget(".star");Ext.get(i);o?l.doShortAct("save",t.get("id")):r?l.doShortAct("remove",t.get("id")):l.openFunc(t.get("id"))}}})},getMenuLocationView:function(e){var r=this;return Ext.create("Ext.view.View",{itemId:"locationview",selectedItemCls:"item-select",overItemCls:"item-over",cls:"menusview-location",itemSelector:"div.item",region:"center",region:"east",width:180,selModel:{deselectOnContainerClick:!1},tpl:['<div class="scroll-body">','<tpl for=".">','<div class="item {type}" data-id="{id}" data-text="{text}">{text}</div>',"</tpl>","</div>"],store:e,listeners:{itemclick:function(e,t,i){var a=t.get("text"),n=r.menusView.getEl().down(".scroll-body"),o=n.down('div[data-type="menu"][data-text="'+a+'"]');JE.scrollBy(n,o,{color:"#f0f0f0",cfg:{attr:"backgroundColor",easing:"easeIn",duration:2e3}})}}})},buildShortcutDDZone:function(){var i=this,a=i.shortcutView,n=a.overItemCls,e=a.getEl().down(".shortmenus");Sortable.create(e.dom,{group:"shortcut",animation:150,scroll:e.dom,handle:".move-icon",draggable:".func",onEnd:function(e){var t=e.item;Ext.isIE9||Ext.each(t.childNodes,function(e){e.style.visibility=""}),i.doShortAct("sort",t.getAttribute("data-id")),a.overItemCls=n},onStart:function(e){var t=e.item;a.overItemCls="",Ext.get(t).removeCls(n),Ext.isIE9||Ext.each(t.childNodes,function(e){e.style.visibility="hidden"})}})},doShortAct:function(e,t){var o=this,i=_JE_LOCAL_LANG;if("save"==e){var a=JE.uuid(),n=t,r=JE._MENUS[n],l=r.text;"en"==i&&JE.isNotEmpty(r.bean.MENU_MENUSUBNAME)&&(l=r.bean.MENU_MENUSUBNAME);var s=o.shortcutView.store.add({id:r.id,text:l,code:r.code,iconCls:r.iconCls,dataId:a})[0];(d=o.menusView.getNode(o.menusView.store.getById(n)))&&((d=Ext.get(d)).addCls("shortcut"),JE.loadBadgeById(n)),JE.ajax({url:JE.getUrlMaps("je.core.rbac.rbac.save"),async:!0,params:{tableCode:"JE_CORE_KJMENU",JE_CORE_KJMENU_ID:a,KJMENU_YHUD:JE.currentUser.userId,KJMENU_CDID:n,SY_ORDERINDEX:o.shortcutView.store.getCount()}})}else if("remove"==e){n=t;var d,c=(s=o.shortcutView.store.getById(n)).get("dataId");o.shortcutView.store.remove(s),(d=o.menusView.getNode(o.menusView.store.getById(n)))&&Ext.get(d).removeCls("shortcut"),JE.ajax({url:JE.getUrlMaps("je.core.rbac.rbac.remove"),async:!0,params:{tableCode:"JE_CORE_KJMENU",ids:c}})}else if("sort"==e){var u=t,p=[],f=o.shortcutView.getEl().query(".func");Ext.each(f,function(e,t){var i=e.getAttribute("data-id"),a=o.shortcutView.store.getById(i),n=a.get("dataId");a.set("index",t),p.push({JE_CORE_KJMENU_ID:n,SY_ORDERINDEX:t}),JE.loadBadgeById(i)});var E=o.shortcutView.store.getById(u),m=Ext.clone(E.data);o.shortcutView.store.remove(E),o.shortcutView.store.insert(E.get("index"),m),JE.ajax({url:JE.getUrlMaps("je.core.rbac.rbac.updateList"),async:!0,params:{tableCode:"JE_CORE_KJMENU",strData:Ext.encode(p)}})}else if("insertAll"==e){var g=[];o.shortcutView.store.each(function(e,t){var i=JE.uuid(),a={JE_CORE_KJMENU_ID:i,KJMENU_YHUD:JE.currentUser.userId,KJMENU_CDID:e.get("id"),SY_ORDERINDEX:t};g.push(a),e.set("dataId",i)}),JE.isNotEmpty(g)&&JE.ajax({url:JE.getUrlMaps("je.core.rbac.rbac.insertUpdateList"),async:!0,params:{tableCode:"JE_CORE_KJMENU",strData:Ext.encode(p)}})}},openFunc:function(t){var i,e=this;if(Ext.each(e.basicMenus.children,function(e){if(t==e.id)return i=e,!1}),i)e.loadMenuData(i);else{var a=JE._MENUS[t],n={type:a.nodeInfoType,info:a.nodeInfo,id:a.id,title:a.text,iconCls:a.iconCls,showView:a.hrefTarget,fontIconColor:a.bean.MENU_FONTICONCOLOR,cpids:a.bean.CPID};e.funcOpening=!0,e.setMenuVisible(!1,function(){e.setShortVisible(!1,function(){setTimeout(function(){e.funcOpening=!1},500),setTimeout(function(){JE.openFunc(n)})})});var o=e.shortcutView.store.getById(t);if(o){var r=e.shortcutView.getEl().down(".shortcutview").dom.scrollTop;e.shortcutView.getSelectionModel().select(o),e.shortcutView.refresh(),e.shortcutView.store.each(function(e){JE.loadBadgeById(e.get("id"))}),e.shortcutView.getEl().down(".shortcutview").dom.scrollTop=r}}},loadBadge:function(a,n){var o=JE._BADGES[a];JE.isEmpty(o)||Ext.each([this.menusView,this.shortcutView,this.locationView],function(e){var t=e.getEl();if(t){var i=t.query('[data-id="'+a+'"]');Ext.each(i,function(e){var t=Ext.get(e),i=t.down(".badge");if(i&&i.remove(),0<n){var a='<div class="badge '+Ext.value(o.cls,"")+'" style="margin-left:5px;'+Ext.value(o.style,"")+'">'+n+"</div>";t.insertHtml("beforeEnd",a)}})}})},buildRefreshTool:function(e){var t=this;if(t.refreshMenu=Ext.create("Ext.menu.Menu",{shadow:!1,cls:"je-menu-item34h je-menu-arrow je-menu-arrow-t",plain:!0,defaults:{handler:function(e){JE.CoreUtil.refreshCache(e.type)}},items:[{text:t.localLang.emptyVariableCache,type:"sysvar",iconCls:"fa fa-file-o"},{text:t.localLang.emptyFuncCache,type:"func",iconCls:"fa fa-file-o"},{text:t.localLang.emptyDicCache,type:"dic",iconCls:"fe icon-book-alt"},{text:t.localLang.emptyMenuCache,type:"menu",iconCls:"fa fa-navicon"},{text:t.localLang.emptyAllCache,type:"all",iconCls:"fe icon-arrows-cw"}]}),t.menuPanel&&t.menuPanel.getCmp("searchView").getEl()){var i=t.menuPanel.getCmp("searchView").getEl().insertHtml("afterEnd",'<i class="refresh-icon fa fa-refresh"></i>',!0);i.on("click",function(){t.refreshMenu.showBy(i,"t-b")})}}}),Ext.define("JE.app.view.menu.MenuTopView",{extend:"Ext.container.Container",alias:"widget.appmenutop",id:"app-topmenu",cls:"je-menu-top",height:35,initComponent:function(){var n=this,i=JE.USER.menuType;n.layout={type:"hbox",align:"middle",overflowHandler:"Scroller"},n.defaults="top"==i?{xtype:"button",height:"100%",toggleGroup:"topmenu",enableToggle:!0,toggleHandler:function(e,t){var i=JE._MENUS[e.itemId];if(i&&t){if(JE.isNotEmpty(i.children)){var a=n.menu.getCmp(e.itemId);a=a||n.menu.add(n.menu.itemsData[e.itemId]),n.menu.getLayout().setActiveItem(e.itemId),n.menu.showBy(e,"",[-1,1])}}else n.menu.hide()},handler:function(e){n.openFunc(e.itemId)}}:{xtype:"button",height:"100%",toggleGroup:"topmenu",enableToggle:!0,allowDepress:!1,toggleHandler:function(e,t){var i=JE._MENUS[e.itemId];i&&JE.isNotEmpty(i.children)&&t&&Ext.getCmp("_jewestview").setActiveMenu(e.itemId)},handler:function(e){n.openFunc(e.itemId)}},n.items=[],Ext.each(n.menuData.children,function(e,t){n.items.push({text:e.text,iconCls:e.iconCls,itemId:e.id,pressed:"lefttop"==i&&0==t})}),n.callParent(arguments),"top"==i&&n.buildMenu()},afterRender:function(){var e=this;e.callParent(arguments),e.getEl().on("click",function(){e.hideConfigView()})},buildMenu:function(){var r=this,l={},s=function(e){var t=[];return Ext.each(e,function(e){"MENU"==e.nodeInfoType?t=t.concat(s(e.children)):t.push(e)}),t};Ext.each(r.menuData.children,function(e,t){var i=Ext.clone(e),a=i.id,n=[];Ext.each(i.children,function(e,t){var i=n.length-1;"MENU"!=e.nodeInfoType&&n[i]&&!n[i].isEnd||(e.isFirst=!0),n.push(e),JE.isNotEmpty(e.children)&&((n=n.concat(s(e.children)))[n.length-1].isEnd=!0)});var o={xtype:"dataview",itemId:a,store:Ext.create("Ext.data.Store",{fields:["id","text","iconCls","nodeInfoType","bean","isFirst","isEnd"],data:n}),autoScroll:!0,cls:"overmenu",tpl:["<table><tr>",'<tpl for=".">','<tpl if="isFirst">','<td class="model">',"</tpl>",'<div class="item <tpl if="nodeInfoType == \'MENU\'">folder<tpl else>func</tpl>"><div class="{iconCls} item-icon" style="{[this.getIconStyle(values)]}"></div>{text}{[this.getBadge(values)]}','</div><tpl if="isEnd">',"</td>","</tpl>","</tpl>","</tr></table>",{getIconStyle:function(e){var t=e.bean.MENU_FONTICONCOLOR;return JE.isEmpty(t)?"":"color:"+t+";"},getBadge:function(e){var t="",i=JE._BADGES[e.id];if(i){var a=JE.toNum(i.num);if(0<a)t='<div class="badge '+Ext.value(i.cls,"")+'" style="'+Ext.value(i.style,"")+'">'+a+"</div>"}return t}}],itemSelector:"div.item",overItemCls:"item-over",selectedItemCls:"item-selected",listeners:{beforeselect:function(e,t){return"MENU"!=t.get("nodeInfoType")},itemclick:function(e,t){setTimeout(function(){r.menu.hide(),r.openFunc(t.get("id"))})}}};0<n.length&&(l[a]=o)});var e=JE.toNum(Ext.value(JE.systemConfig.JE_SYS_TOPMENU_MAXHEIGHT,"600"));r.menu=Ext.create("Ext.menu.Menu",{cls:"je-menu-top-overmenu",shadow:!1,layout:"card",plain:!0,width:r.width,maxWidth:1280,maxHeight:e,itemsData:l,listeners:{hide:function(e){var t=e.getLayout().getActiveItem(),i=r.getCmp(t.itemId);i&&i.toggle(!1,!0)}}})},openFunc:function(e){var t=JE._MENUS[e],i=t.iconCls,a={type:t.nodeInfoType,info:t.nodeInfo,id:t.id,title:t.text,iconCls:i,showView:t.hrefTarget,fontIconColor:t.bean.MENU_FONTICONCOLOR,cpids:t.bean.CPID};JE.openFunc(a),this.hideConfigView()},hideConfigView:function(){var e=Ext.getCmp("app-configview");e&&!e.collapsed&&e.toggle()}}),Ext.define("JE.app.view.menu.ShortcutView",{extend:"Ext.container.Container",border:0,alias:"widget.appshortcutview",id:"app-shortcutview",layout:"column",border:0,defaults:{columnWidth:1},initComponent:function(){var i=this,e={xtype:"box",style:"font-size:15px;padding:10px;",itemId:"title",data:{text:"快捷菜单",id:""},tpl:'{text}<tpl if="id"><i class="fa fa-reply back" data-id="{id}" style="float:right;padding:0px 5px;cursor: pointer;color:#444;"></i></tpl>',height:40,listeners:{afterrender:function(e){e.getEl().on("click",function(e){var t=e.getTarget(".back");t&&i.loadMenuData(t.getAttribute("data-id"))})}}},t=i.buildMenuView(),a=Ext.value(JE.systemConfig.JE_SYS_SETTINGHTML,'<img src="'+JE.getStaticUrl("JE.common.logo-small")+'" style="width: 20px;height: 20px;vertical-align: top;"><a href="http://www.jeplus.cn" target="_black;" style="text-decoration: none;color: #a09c96;margin-left: 5px;">JEPLUS.CN INSIDE</a>');i.items=[e,t,{xtype:"box",style:"text-align:center;position: absolute;bottom: 2px;line-height: 20px;",html:a}];var n=JE.ajax({url:JE.getUrlMaps("je.core.rbac.rbac.load"),params:{tableCode:"JE_CORE_KJMENU",whereSql:" and KJMENU_YHUD='"+JE.currentUser.userId+"'",orderSql:" order by SY_ORDERINDEX",limit:-1}}).rows;i.menus=new Ext.util.MixedCollection,Ext.each(n,function(e){i.menus.add(e.KJMENU_CDID,{id:e.JE_CORE_KJMENU_ID,menuId:e.KJMENU_CDID,userId:e.KJMENU_YHUD,index:e.SY_ORDERINDEX})}),i.callParent(arguments)},afterRender:function(){this.callParent(arguments),this.loadMenuData()},loadMenuData:function(e){var t=this,i=t.getCmp("view"),a={id:e,text:"快捷菜单",data:[]},n=[];JE.isEmpty(a.id)||"ROOT"==a.id?(i.getEl().removeCls("menu"),t.isROOT=!0,a.id="",t.menus.each(function(e){var t=JE._MENUS[e.menuId];t&&n.push(t)})):(i.getEl().hasCls("menu")||i.getEl().addCls("menu"),t.isROOT=!1,node=JE._MENUS[e],a.id=node.parent,a.text=node.text,t.menus.containsKey(e)&&(a.id="ROOT"),Ext.each(node.children,function(e){n.push(e)})),Ext.each(n,function(e){a.data.push(t.buildNode(e))}),t.refreshMenu(a)},refreshMenu:function(e){this.getCmp("title").update(e),this.getCmp("view").store.loadData(e.data)},buildNode:function(e){var t=e.isModel?e.data:e,i={id:t.id,text:t.text,iconCls:Ext.value(t.bean.MENU_FONTICONCLS,"fe icon-circle-empty"),bean:t.bean,leaf:t.leaf},a=JE._BADGES[t.id];return a&&(i.num=a.num,i.numCls=a.cls,i.numStyle=a.style),i},buildMenuView:function(){var d=this,e={xtype:"dataview",itemId:"view",cls:"config-menuview",store:Ext.create("Ext.data.Store",{fields:["id","text","iconCls","num","numCls","numStyle","leaf"],data:[]}),tpl:['<tpl for=".">','<div class="func" data-id="{id}" id="{id}_shortcut" title="{text}">','<div class="icon {iconCls}"></div>','<div class="text">{text}</div>','<div class="act">','<div class="move fa fa-arrows"></div>','<div class="remove fe icon-cancel-4"></div>',"</div>",'<tpl if="num &gt; 0"><div class="badge {numCls}" style="{numStyle}">{num}</div></tpl>',"</div>","</tpl>",'<div class="addFunc">','<div class="icon fa fa-plus"></div>',"</div>"],itemSelector:"div.func",draggable:{delegate:"div.func"},emptyText:"",overItemCls:"",selectedItemCls:"",listeners:{itemclick:function(e,i,t,a,n,o){var r=n.getTarget(".move"),l=n.getTarget(".remove");if(r)return!1;if(l)return JE.confirm("确认删除吗？",function(e){if("ok"==e){var t=d.menus.get(i.get("id"));JE.ajax({url:JE.getUrlMaps("je.core.rbac.rbac.remove"),async:!0,params:{tableCode:"JE_CORE_KJMENU",ids:t.id}}),d.store.remove(i),d.menus.remove(t),d.doSort(),JE.msg("删除成功！")}}),!1;var s=i.get("id");i.get("leaf")?(d.ownerCt.toggle(),setTimeout(function(){JE.openFuncById(s)},300)):d.loadMenuData(s)},afterrender:function(e){e.getEl().on("click",function(e){if(e.getTarget(".addFunc",2,!0)){var t=Ext.getCmp("app-mainview").menuData;JE.selectWin({title:"菜单",type:"tree",rootData:t,callback:function(e){var t=e[0],i=t.get("id");if(d.store.getById(i))return JE.alert("菜单已经有了，再选点别的吧！"),!1;d.store.add(d.buildNode(t)),JE.msg("加入成功！"),JE.ajax({url:JE.getUrlMaps("je.core.rbac.rbac.save"),params:{tableCode:"JE_CORE_KJMENU",KJMENU_YHUD:JE.currentUser.userId,KJMENU_CDID:i,SY_ORDERINDEX:d.store.getCount()},async:!0,success:function(e){var t=Ext.decode(Ext.value(e.responseText,"{}")).obj;d.menus.add(t.KJMENU_CDID,{id:t.JE_CORE_KJMENU_ID,menuId:t.KJMENU_CDID,userId:t.KJMENU_YHUD})}})}})}}),d.buildDDZone()}}};return d.store=e.store,e},buildDDZone:function(){var r=this,l=r.getCmp("view");l.dragZone=new Ext.dd.DragZone(l.getEl(),{ddGroup:"menuGroup",getDragData:function(e){var t=e.getTarget(l.itemSelector,10);if(t){var i=document.createElement("div"),a=l.getRecord(t);return i.innerHTML=a.get("text"),{ddel:i,sourceEl:t,repairXY:Ext.fly(t).getXY(),dragRecord:a,sourceDataView:l}}},getRepairXY:function(){return this.dragData.repairXY},onBeforeDrag:function(e,t,i){return!(!t.getTarget(".move")||!r.isROOT)}}),l.dropZone=new Ext.dd.DropZone(l.getEl(),{ddGroup:"menuGroup",notifyOver:function(e,t,i){var a=t.getTarget(l.itemSelector,10);if(i.allowDD=!1,i.insertIndex=-1,a){var n=r.getItemPosition(t,a);if("before"==n||"after"==n){r.positionIndicator(a,n,t);var o=a.getAttribute("data-id");i.insertIndex=JE.toNum(r.menus.get(o).index),"before"==n&&i.insertIndex--,i.allowDD=!0}}return i.allowDD||r.hidetIndicator(),i.allowDD?e.dropAllowed:e.dropNotAllowed},notifyDrop:function(e,t,i){if(r.hidetIndicator(),-1<i.insertIndex){var a=[],n=[];a.push(Ext.clone(i.dragRecord.data)),i.dragRecord.set("id",JE.uuid()),n.push(i.dragRecord),l.store.insert(i.insertIndex,a),l.store.remove(n),r.doSort()}return i.allowDD}})},indicatorHtml:'<div class="formfield-move-top"></div><div class="formfield-move-bottom"></div>',indicatorCls:"je-formfield-drop-indicator",getIndicator:function(){return this.indicator||(this.indicator=new Ext.Component({html:this.indicatorHtml,cls:this.indicatorCls,style:"width:1px;",floating:!0,shadow:!1})),this.indicator},positionIndicator:function(e,t,i){var a=Ext.fly(e),n=a.getX(),o=a.getY()+6;"after"==t?n+=a.getWidth()+6:n-=6,this.getIndicator().setHeight(a.getHeight()-10).showAt(n,o)},hidetIndicator:function(){this.getIndicator().hide()},getItemPosition:function(e,t,i){var a,n=e.getXY()[1],o=e.getXY()[0],r=Ext.fly(t).getRegion();if(n<=r.bottom&&n>=r.top){var l=r.left+(r.right-r.left)/2;o<l?a="before":l<o&&(a="after")}return a},doSort:function(){var o=this,r=(o.getCmp("view"),[]);o.store.each(function(e,t){var i=e.get("id"),a=t+1,n=o.menus.get(i);n.index=a,r.push({JE_CORE_KJMENU_ID:n.id,SY_ORDERINDEX:a})}),o.menus.sort("index","ASC"),JE.ajax({url:JE.getUrlMaps("je.core.rbac.rbac.updateList"),async:!0,params:{tableCode:"JE_CORE_KJMENU",strData:Ext.encode(r)}})}}),Ext.define("JE.app.view.MenuView",{extend:"Ext.panel.Panel",alias:"widget.appmenuview",id:"_jewestview",border:0,margins:"0 0 0 0",width:180,layout:"border",bodyStyle:"border:0px;",initComponent:function(){var n=this;n.items=[n.buildMenu()],delete n.title,delete n.iconCls,n.tbar={xtype:"box",height:30,itemId:"titleBar",style:"background-color: #394555;cursor: pointer;position: relative;text-align:center;padding-top: 7px;color:#aeb9c2;",html:JE.getIconTpl("menu-expand",{style:"cursor: pointer;"}),listeners:{afterrender:function(a){a.barEl=a.el.down(".menu-expand"),a.el.on("click",function(){var e=a.barEl.hasCls("menu-collapse"),t=e?180:50,i=n.getCmp("tree");n.selfCollapsed=!e,a.barEl[e?"removeCls":"addCls"]("menu-collapse"),n.setWidth(t),a.refreshEl&&a.refreshEl.setVisible(e),i.view[e?"removeCls":"addCls"]("je-treemenu-collapsed"),n.updateLayout()})}}},n.menu=Ext.create("Ext.menu.Menu",{cls:"je-treemenu-submenu",shadow:!1}),n.callParent(arguments)},buildSubMenuData:function(e,a){var n=this,o=[];return Ext.each(e,function(e){var t={text:e.text,id:e.id,iconCls:e.iconCls,raw:e,arrowCls:"x-menu-item-arrow folder-collapse",handler:function(e){n.openFunc(e.raw)}};if(JE.isNotEmpty(e.children)&&(t.menuExpandDelay=0,t.menuHideDelay=0,t.menu={items:n.buildSubMenuData(e.children,a),cls:"je-treemenu-submenu",shadow:!1}),!a){var i=Ext.value(e.bean.MENU_MENUSUBNAME,"");JE.isNotEmpty(i)&&(t.text='<div class="je-treemenu-text" style="float:left;padding-top:12px;line-height:12px;"><div style="margin-bottom: 2px;">'+e.bean.MENU_MENUNAME+'</div><div style="color: #A2A2A2;">'+i+"</div></div>"),t.iconCls=e.bean.MENU_BIGICONCLS+"--menu",t.menu&&(t.menu.cls+=" je-treemenu-submenu-big")}o.push(t)}),o},buildMenu:function(){var s=this,e={xtype:"treepanel",useArrows:!0,animate:!1,region:"center",itemId:"tree",rootVisible:!1,cls:"je-treemenu-tree",border:0,listeners:{itemmouseenter:function(e,t,i,a){var n=Ext.get(i).down(".menuicon",!0);n&&(s.selfCollapsed?JE.isEmpty(t.raw.childMenu)&&"1"!=n.getAttribute("powerTip")&&(n.setAttribute("title",t.get("text")),n.setAttribute("powerTip","1"),jQuery(n).powerTip({placement:"e",offset:20,autoShow:!0})):(jQuery.powerTip.destroy(n),n.setAttribute("powerTip","0")));var o=t.raw;if(JE.isNotEmpty(o.childMenu)){s.menu.rootId=o.id,s.menu.removeAll(),s.menu.add(s.buildSubMenuData(o.childMenu,s.selfCollapsed)),s.selfCollapsed&&(s.menu.insert(0,{xtype:"menuseparator",style:"background-color:transparent;border-width:1px;"}),s.menu.insert(0,'<span class="x-menu-item-text">'+o.text+"</span>")),s.selfCollapsed?s.menu.removeCls("je-treemenu-submenu-big"):s.menu.hasCls("je-treemenu-submenu-big")||s.menu.addCls("je-treemenu-submenu-big");var r=e.panel.getWidth(),l=Ext.get(i).getY();s.menu.showAt(r,l)}else s.menu.hide()},beforeselect:function(e,t,i,a){return t.isLeaf()},itemclick:function(e,t,i,a,n,o){var r=t.raw;if(s.openFunc(r),JE.isNotEmpty(r.childMenu)&&e.panel.fireEvent("itemmouseenter",e,t,i,a),!t.isLeaf()){var l=t.isExpanded();e.panel.collapseAll(),t[l?"collapse":"expand"]()}}},hideHeaders:!0,viewConfig:{overItemCls:"je-treemenu-over",selectedItemCls:"je-treemenu-selected",focusedItemCls:"je-treemenu-focused",beforeFocusedItemCls:"je-treemenu-before-focused",tableFocusedFirstCls:"je-treemenu-focused-first",expandedCls:"je-treemenu-node-expanded"},columns:[{flex:1,dataIndex:"text",renderer:function(e,t,i){var a=i.raw,n=a.bean.MENU_BIGICONCLS+"--menu",o=Ext.value(a.bean.MENU_MENUSUBNAME,""),r=Ext.isEmpty(o)?"margin-top:6px;":"",l=a.bean.MENU_MENUNAME;return i.isLeaf()?(t.style="background-color: #293038;border-bottom-color: #293038;",'<div class="je-menu-treebtn-icon menuicon" style="float:left;">'+JE.getIconTpl(a.iconCls+" smallIcon",{style:"width:16px;height:16px;margin-left:5px;"})+JE.getIconTpl(n+" bigIcon",{style:"width:32px;height:32px;"})+'</div><div class="je-treemenu-text" style="float:left;padding:7px 0 0 7px;width:100px;"><div style="margin-bottom: 2px;'+r+'">'+l+'</div><div style="color: #A2A2A2;">'+o+"</div></div>"):(t.style="line-height:35px;",JE.getIconTpl("menuicon "+(i.get("expanded")?"folder-expand":"folder-collapse"),{style:"margin-left:10px;cursor: pointer;"})+'<span class="je-treemenu-text" style="margin-left:15px;">'+a.text+"</span>")}}]},a=s.menuData,t=a.children;return delete a.children,Ext.each(t,function(e,t){0==t&&(e.expanded=!0),Ext.each(e.children,function(e){e.childMenu=Ext.clone(e.children),e.children=[],e.leaf=!0})}),"TOPBUTTON"==s.menuType||"TOPBUTTON16"==s.menuType?(s.menus={},Ext.each(t,function(e,t){var i=Ext.clone(a);e.expanded=!0,i.children=[e],s.menus[e.id]=i,0==t&&(a=Ext.clone(i))})):a.children=t,e.root=a,e},loadModelMenu:function(e){var t=Ext.clone(this.menus[e]);t?(this.getCmp("tree").setRootNode(t),this.modelId=e):JE.alert("模块不存在！")},refreshUserInfo:function(e){},buildRefreshTool:function(e){var t=this.getDockedCmp("titleBar");t.refreshEl=t.el.insertHtml("beforeEnd",JE.getIconTpl("menu-refresh",{style:"cursor: pointer;position: absolute;top:10px;right:5px;"}),!0),t.refreshEl.on("click",function(){e.handler()})},openFunc:function(e){var t={type:e.nodeInfoType,info:e.nodeInfo,id:e.id,title:e.text,iconCls:e.iconCls,showView:e.hrefTarget,tree:this.getCmp("tree"),modelId:this.modelId,cpids:e.bean.CPID};JE.openFunc(t)}}),Ext.define("JE.app.view.NorthMenuMiniView",{extend:"Ext.panel.Panel",alias:"widget.appnorthmenuminiview",id:"app-header",layout:"fit",bodyCls:"je-app-header je-app-headermenu",mixins:["JE.app.util.Util"],initComponent:function(){this.height=80,this.localLang=JE.getLocalLang("core.app.northview"),this.html=['<div class="header-title">',JE.toXT(['<tpl if="logo"><img class="logo" src="{logo}"></tpl>','<div class="title">{easyTitle}</div>'].join(""),{logo:Ext.value(JE.systemConfig.JE_SYS_LOGO,"").split("*")[1],easyTitle:JE.systemConfig.JE_SYS_EASYTITLE,fullTitle:JE.systemConfig.JE_SYS_FULLTITLE}),"</div>",'<div class="header-info" style="font-size: 14px;position: absolute;right: 0;bottom: 0;color:#fff;text-align:right;height: auto;">',JE.toXT(['<div style="line-height:2;margin-top:20px;">','<tpl for="."><span style="padding: 0 10px;cursor: pointer;" class="func" data-code="{code}">{title}</span></tpl>','<span style="padding: 0 10px;cursor: pointer;" class="func" data-code="config">设置</span>','<span style="padding: 0 10px;cursor: pointer;" class="func" data-code="logout">退出</span>',"</div>",'<div class="time" style="line-height:2;padding: 0 10px;cursor: pointer;">'+Ext.Date.format(new Date,"Y年m月d日 l")+"</div>"].join(""),this.homeData),"</div>"],this.callParent(arguments)},afterRender:function(){var i=this;i.callParent(arguments),i.ownerCt.setActiveView(i.homeData[0]),i.body.down(".header-info").on("click",function(e){if(e.getTarget(".func")){var t=e.getTarget(".func").getAttribute("data-code");if("logout"==t)return void JE.logout();if("config"==t)return void Ext.getCmp("app-mainview").toggleConfigView();Ext.each(i.homeData,function(e){if(e.code==t)return i.ownerCt.setActiveView(e),!1})}Ext.getCmp("app-configview")&&!Ext.getCmp("app-configview").collapsed&&Ext.getCmp("app-configview").toggle()})}}),Ext.define("JE.app.view.NorthMenuView",{extend:"Ext.panel.Panel",alias:"widget.appnorthmenuview",id:"app-header",layout:"fit",bodyCls:"je-app-header je-app-headermenu",mixins:["JE.app.util.Util"],initComponent:function(){var a=this;a.localLang=JE.getLocalLang("core.app.northview"),a.items=[{xtype:"dataview",cls:"header-menu je-drag-view",itemId:"menubar",store:Ext.create("Ext.data.Store",{fields:["title","icon","code","configInfo","badge","type","layer","menuId"],data:a.homeData}),tpl:['<div class="scroll-body">','<tpl for=".">','<div class="item">','<div><i class="{icon}"></i><span>{title}</span></div>',"</div>","</tpl>","</div>"],selectedItemCls:"select",itemSelector:"div.item",selModel:{deselectOnContainerClick:!1},listeners:{itemclick:function(e,t){a.ownerCt.setActiveView(t.data)},selectionchange:function(e,t){var i=t[0];i&&a.ownerCt.setActiveView(i.data)},beforeselect:function(e,t){var i=e.view;if(i.getEl().hasCls("enable-drag")){var a=i.viewDraged;if(beforeDragSelected=i.beforeDragSelected,delete i.viewDraged,delete i.beforeDragSelected,beforeDragSelected&&beforeDragSelected!=t&&a)return i.getSelectionModel().select(beforeDragSelected,!1,!0),!1}},afterrender:function(a){a.getSelectionModel().select(a.store.getAt(0)),a.getEl().on({mousedown:function(e){if(a.getEl().hasCls("enable-drag")){var t=a.getEl().down(".scroll-body");if(t){a.startDraging=!0,a.moveInfo={scrollBody:t,x:e.getX(),scrollLeft:t.dom.scrollLeft},a.beforeDragSelected=a.getSelectionModel().getSelection()[0];var i=a.getRecord(e.getTarget(".item",3));a.beforeDragSelected==i&&delete a.beforeDragSelected}}},mousemove:function(e){var t=a.getEl();a.startDraging&&t.hasCls("enable-drag")&&(a.moveInfo.scrollBody.dom.scrollLeft=a.moveInfo.scrollLeft+(a.moveInfo.x-e.getX()),a.viewDraged=!0)},mouseleave:function(e){delete a.startDraging,a.beforeDragSelected||delete a.viewDraged},mouseup:function(e){delete a.startDraging,a.beforeDragSelected||delete a.viewDraged}})},refresh:function(e){e.fireEvent("resize",e)},resize:function(e){var t=e.getEl().down(".scroll-body");if(t){var i=t.dom.scrollWidth>t.dom.offsetWidth;e.getEl()[i?"addCls":"removeCls"]("enable-drag")}}}}],a.items={xtype:"container",layout:"fit",items:a.items,itemId:"menubar"},a.callParent(arguments)},getMenuBar:function(){return this.getCmp("menubar").getCmp("menubar")},afterRender:function(){var t=this;t.callParent(arguments);var e=JE.getFileUrl(JE.split(JE.systemConfig.JE_SYS_LOGO,"*")[1],"","","","JE_SAAS_YH")||JE.getStaticUrl("JE.common.logo"),i=JE.toXT(['<div class="header-title">','<tpl if="logo"><img class="logo" src="{logo}"></tpl>','<div class="title">{easyTitle}</div>',"</div>"].join(""),{logo:e,easyTitle:JE.systemConfig.JE_SYS_EASYTITLE,fullTitle:JE.systemConfig.JE_SYS_FULLTITLE}),a=['<div class="header-info">','<div id="__je_userinfo__">',t.buildUserPhoto(),"</div>","</div>"].join(""),n=t.body.insertHtml("beforeEnd",i,!0),o=t.body.insertHtml("afterBegin",a,!0);setTimeout(function(){var e=n.getWidth()>o.getWidth()?n.getWidth():o.getWidth();e+="px",t.getCmp("menubar").getEl().setStyle({paddingLeft:e,paddingRight:e}),t.getCmp("menubar").doLayout()},100),t.bindUserInfo()}}),Ext.define("JE.app.view.NorthView",{extend:"Ext.panel.Panel",alias:"widget.appnorthview",id:"app-header",layout:"border",bodyCls:"je-app-header",mixins:["JE.app.util.Util"],initComponent:function(){this.localLang=JE.getLocalLang("core.app.northview");var e='<div class="header-info"><div class="person-nav"><div>{userMsgIcon}<a href="javascript:void(0)" onclick=JE.showFunc("JE_SYS_USERMSG",{}) id="___userMsg">0</a></div><div>{msgIcon}<a href="javascript:void(0)" id="___msgA">'+this.localLang.message+'</a></div><div>{confIcon}<a href="javascript:void(0)" id="___userconfig">'+this.localLang.user+'</a></div><div style="margin:0px;">{logOutIcon}<a href="javascript:void(0)" onclick=JE.logout() >'+this.localLang.exit+'</a></div></div><div class="person-nav username"><div>{userIcon}{userName}:{deptName}<tpl if="proxy">&nbsp;&nbsp;{loginUserName}('+this.localLang.agentLogin+")</tpl></div></div></div>";e=JE.toXT(e,{proxy:JE.currentUser.proxy,userName:JE.currentUser.username,deptName:JE.currentUser.deptName,loginUserName:JE.currentUser.loginUserName,userMsgIcon:JE.getIconTpl("je_message_notice icon"),dlIcon:JE.getIconTpl("JE_CORE_TOPDL icon"),msgIcon:JE.getIconTpl("JE_CORE_TOPNEW icon"),confIcon:JE.getIconTpl("JE_CORE_TOPGRSZ icon"),logOutIcon:JE.getIconTpl("JE_CORE_TOPTC icon"),userIcon:JE.getIconTpl("JE_CORE_TOPDLR icon")});var t='<div class="header-title"><tpl if="logo"><img class="logo" src="{logo}"></tpl><div class="title">{easyTitle}</div><div class="title title-full">{fullTitle}</div></div>';"1"==JE.systemConfig.JE_SYS_ENABLEDHTML?t='<div class="header-html">'+Ext.value(JE.systemConfig["JE_SYS_HEADERHTML_"+JE.getTheme().toUpperCase()],"")+"</div>":t=JE.toXT(t,{logo:Ext.value(JE.systemConfig.JE_SYS_LOGO,"").split("*")[1],easyTitle:JE.systemConfig.JE_SYS_EASYTITLE,fullTitle:JE.systemConfig.JE_SYS_FULLTITLE});"TOPBUTTON"==JE.getMenuType()?this.items.push({xtype:"box",itemId:"logo",region:"west",html:t,minWidth:360},{xtype:"box",itemId:"info",region:"east",html:e,minWidth:240}):this.html=t+e,this.callParent(arguments)},afterRender:function(){var e=this;e.callParent(arguments),e.userCfgMenu=Ext.create("Ext.menu.Menu",{shadow:!1,plain:!0,items:[{text:"代理设置",iconCls:"jeicon jeicon-calendar",handler:function(){e.doProxy()}},{text:"密码修改",iconCls:"jeicon jeicon-automatic-pen",handler:function(){e.doPassword()}},{text:"信息认证",iconCls:"jeicon jeicon-check",handler:function(){e.doInfoAuth()}},{text:"锁屏",iconCls:"jeicon jeicon-lock",handler:function(){JE.lockAPP()}}]}),Ext.get("___userconfig").on("click",function(){e.userCfgMenu.showBy(Ext.get("___userconfig"),"tr-br",[0,10])})}}),Ext.define("JE.app.view.NorthView2",{extend:"Ext.panel.Panel",alias:"widget.appnorthview2",id:"app-header",layout:"border",bodyCls:"je-app-header",mixins:["JE.app.util.Util"],initComponent:function(){this.localLang=JE.getLocalLang("core.app.northview");var e="";"1"==JE.systemConfig.JE_SYS_ENABLEDHTML?e='<div class="header-html">'+Ext.value(JE.systemConfig["JE_SYS_HEADERHTML_"+JE.getTheme().toUpperCase()],"")+"</div>":e=JE.toXT(['<div class="header-title">','<tpl if="logo"><img class="logo" src="{logo}"></tpl>','<div class="title">{easyTitle}</div>',"</div>"].join(""),{logo:JE.getFileUrl(Ext.value(JE.systemConfig.JE_SYS_LOGO,"").split("*")[1]),easyTitle:JE.systemConfig.JE_SYS_EASYTITLE,fullTitle:JE.systemConfig.JE_SYS_FULLTITLE});this.html=[e,'<div class="header-info">','<div id="__je_userinfo__">',this.buildUserPhoto(),"</div>","</div>"].join(""),this.callParent(arguments)},afterRender:function(){this.callParent(arguments),this.bindUserInfo()}}),Ext.define("JE.app.view.TopMenuView",{extend:"Ext.toolbar.Toolbar",border:0,alias:"widget.apptopmenuview",id:"_apptopmenuview",initComponent:function(){this.localLang=JE.getLocalLang("core.app.topmenuview"),this.buttonScale="TOPMENU32"==this.menuType?"large":"small",this.height="TOPMENU32"==this.menuType?45:26,Ext.apply(this,{itemId:"menuBar",cls:"je-app-header",layout:{overflowHandler:"Menu"},items:this.buildMenu()}),this.callParent(arguments)},buildMenu:function(){var o=this,i=[],r=function(e,t){var i=[],a=t.textPath,n=t.idPath;return Ext.each(e,function(e){var t={text:e.text,iconCls:e.iconCls,smallIconCls:e.iconCls,menuType:e.nodeInfoType,nodeInfo:e.nodeInfo,textPath:a+"__"+e.text,idPath:n+"__"+e.id,itemId:e.id};JE.isEmpty(e.children)?t.handler=function(e){JE.openFunc({type:e.menuType,info:e.nodeInfo,id:e.itemId,title:e.text,iconCls:e.iconCls,isFunc:!0});var t=o.getCmp("openFunc");if(t.menu.getCmp("closeAll")||t.menu.add([{xtype:"menuseparator",isFunc:!0},{text:"<b>"+o.localLang.closeAllText+"</b>",itemId:"closeAll",isFunc:!0}]),!t.menu.getCmp(e.itemId)){var i=Ext.clone(e.initialConfig);delete i.handler,i.isFunc=!0,i.tooltip=o.localLang.position+i.textPath.replaceAll("__"," -> "),i.tooltipType="title",t.menu.insert(t.menu.items.getCount()-1,i)}t.setText(e.text),t.setIconCls(e.iconCls)}:(t.menu=r(e.children,t),t.hideOnClick=!1),i.push(t)}),i};return Ext.each(o.menuData.children,function(e){var t={text:e.text,scale:o.buttonScale,itemId:e.id,nodeInfo:e.nodeInfo,menuType:e.nodeInfoType,showView:e.hrefTarget,textPath:e.text,idPath:e.id,cls:"JE-menu-button",focusCls:"menufocus",overCls:"menuover",menu:[]};t.smallIconCls=e.iconCls,t.bigIconCls=e.bean.MENU_BIGICONCLS,t.iconCls="large"==o.buttonScale?t.bigIconCls:t.smallIconCls,t.menu=r(e.children,t),i.push(t)}),i.push("->",{xtype:"button",itemId:"openFunc",tooltip:o.localLang.openFuncTip,cls:"JE-topmenu-openbutton",focusCls:"menufocus",overCls:"menuover",tooltipType:"qtip",menu:{defaults:{handler:function(t){"closeAll"==t.itemId&&(t=t.ownerCt.getCmp(0)).ownerCt.items.each(function(e){e.isFunc&&t.ownerCt.remove(e)}),JE.openFunc({type:t.menuType,info:t.nodeInfo,id:t.itemId,title:t.text,iconCls:t.iconCls}),t.ownerCt.ownerButton.setText(t.text),t.ownerCt.ownerButton.setIconCls(t.smallIconCls)}},items:[]},listeners:{afterrender:function(e){var t=Ext.getCmp("_appcenterview"),a=[];t.items.each(function(e,t){var i={text:e.title,iconCls:Ext.value(e.iconCls,""),smallIconCls:Ext.value(e.iconCls,""),menuType:"PORTAL_",itemId:e.itemId};a.push(i)}),e.menu.add(a);var i=e.menu.getCmp(0);e.setText(i.text),e.setIconCls(i.smallIconCls)}}}),i}}),Ext.define("JE.app.view.WestView",{extend:"Ext.panel.Panel",alias:"widget.appwestview",id:"_jewestview",collapsible:!0,split:!0,border:1,margins:"2 2 0 0",width:180,minWidth:180,maxWidth:250,layout:"border",initComponent:function(){var a=this;a.localLang=JE.getLocalLang("core.app.westview"),a.title=a.localLang.title,a.defaults={border:0},a.buildSearchBbar();var e=JE.toNum(JE.systemConfig.JE_SYS_MENUWIDTH);if(0<e&&(a.width=e,a.minWidth=a.width<=a.minWidth?a.width:a.minWidth,a.maxWidth=a.width>=a.maxWidth?a.width:a.maxWidth),-1!=["south","north"].indexOf(JE.systemConfig.JE_SYS_USERINFO)){var t={xtype:"box",region:JE.systemConfig.JE_SYS_USERINFO,height:150,itemId:"userInfo",cls:"x-view-emtpytext",style:"font-size: 12px;margin:0px;padding:8px 2px;background:#FEFECE;",listeners:{afterrender:function(e){var t=JE.ajax(JE.getUrlMaps("je.core.portal","getCurrentInfo"));t.success&&a.refreshUserInfo(t.obj)}},refreshData:function(t){var e=Ext.value(JE.currentUser.gender,"MAN"),i=JE.getStaticUrl("JE.app.view.WestView."+e);i=Ext.value(JE.currentUser.photo.split("*")[1],i),this.userData||(this.userData={userImg:i,userName:JE.currentUser.username,infos:[{iconCls:"jeicon jeicon-light-bulb",info:a.localLang.userData.work,infoNum:"0",name:"work"},{iconCls:"jeicon jeicon-pass",info:a.localLang.userData.submit,infoNum:"0",name:"submit"},{iconCls:"fe icon-spread",info:a.localLang.userData.round,infoNum:"0",name:"round"},{iconCls:"jeicon jeicon-commission-o",info:a.localLang.userData.entrust,infoNum:"0",name:"entrust"},{iconCls:"jeicon jeicon-mail-message",info:a.localLang.userData.email,infoNum:"0",name:"email"},{iconCls:"jeicon jeicon-calendar",info:a.localLang.userData.calendar,infoNum:"0",name:"calendar"}]}),t=Ext.value(t,{}),Ext.each(this.userData.infos,function(e){e.infoNum=Ext.value(t[e.name],e.infoNum)}),this.update(this.userData)},tpl:['<div style="text-align:center;float:left;">','<img src="{userImg}" height=110 width=80 />',"<br/><span>{userName}</span>","</div>",'<div style="float:left;padding-left:4px;">','<tpl for="infos">','<div style="margin-bottom:3px;">'+JE.getIconTpl()+" {info}",'(<tpl if="infoNum &gt; 0">','<span style="text-decoration:underline;color:blue;cursor:pointer;" onclick="{[this.infoClick(values)]}">{infoNum}</span>',"<tpl else>","{infoNum}","</tpl>)","</div>","</tpl>","</div>",{infoClick:function(e){var t="function(){}";return"letter"==e.name?t="function(){JE.showFunc('JE_CORE_PCMAIL',{whereSql:' and PCMAIL_USERID = \\'"+JE.currentUser.userId+"\\' and PCMAIL_ISLOOK=\\'0\\''});}":"submit"==e.name?t="function(){JE.initCtr('JE.sys.workflowfunc.controller.WorkflowFuncCtr');JE.win({title:'工作台',items:{xtype:'workflowfunc.mainview'}}).show();}":"round"==e.name?t="function(){JE.initCtr('JE.sys.workflowfunc.controller.WorkflowFuncCtr');JE.win({title:'工作台',items:{xtype:'workflowfunc.mainview',querySql:' AND DBID_ IN (SELECT TASK_ FROM JBPM4_PARTICIPATION WHERE USERID_=\\'"+JE.currentUser.userId+"\\' AND TYPE_=\\'viewer\\' AND HANDLE_=\\'0\\')'}}).show();}":"entrust"==e.name?t="function(){JE.initCtr('JE.sys.workflowfunc.controller.WorkflowFuncCtr');JE.win({title:'工作台',items:{xtype:'workflowfunc.mainview',querySql:' AND ASSIGNEE_ like \\'%"+JE.currentUser.userId+"%\\' AND DBID_ IN (SELECT TASK_ FROM JBPM4_PARTICIPATION WHERE TYPE_=\\'owner\\')'}}).show();}":"work"==e.name?t="function(){JE.showFunc('JE_SYS_MYASSIGN',{whereSql:' and ASSIGNMX_YBL_CODE=\\'0\\''});}":"calendar"==e.name?t="function(){JE.openFuncById('949bae1c-bbdc-4782-928f-52a8a5763cb6','5a675576-c061-4282-91d7-6b5c1158f238');}":"email"==e.name&&(t="function(){JE.showFunc('JE_SYS_INBOX',{whereSql:' and INBOX_READ=\\'0\\''});}"),"("+t+")(this)"}}]};a.items.push(t)}a.callParent(arguments)},refreshUserInfo:function(e){var t=this.getComponent("userInfo");t&&t.refreshData(e)},buildSearchBbar:function(){var s=this,o=function(e,i,a){var n=[];return Ext.each(e,function(e){var t="func";Ext.isEmpty(i)?(t="model",a=e.id):"GENERAL"==e.nodeType&&(t="folder"),n.push({id:e.id,text:e.text,iconCls:e.iconCls,type:t,pinyin:JE.toPinYin(e.text,"pinyin"),parentText:Ext.value(i,""),parentId:Ext.value(a,"")}),n=n.concat(o(e.children,(Ext.isEmpty(i)?"":i+"/")+e.text,a))}),n},e=o(s.menuData.children),t=new Ext.util.Filter({filterFn:function(e){var t=Ext.value(this.value,"").toLocaleLowerCase();return-1!=e.get("text").toLocaleLowerCase().indexOf(t)||-1!=e.get("pinyin").indexOf(t)}}),i=new Ext.data.Store({fields:["id","text","type","pinyin","parentText","parentId","iconCls"],data:e});i.addFilter(t,!1);var a={xtype:"combobox",queryMode:"local",store:i,hideTrigger:!0,valueField:"id",displayField:"text",inputAttrTpl:"style='border-width:0;'",ref:"queryTreeCBB",emptyText:s.localLang.queryMenuEmptyText,listConfig:{getInnerTpl:function(e){return"{text}<tpl if='parentText'><div style='color:#C0C0C0;font-size:4px;'>{parentText}</div></tpl>"}},queryFilter:t,listeners:{select:function(e,t){var i,a=t[0].data,n=s.items.get(0),o=n.type;if("tree"==o)i=n;else if("card"==o){i=n.getCmp(a.parentId),Ext.getCmp("app-header").getCmp("topButtonBar").getCmp(a.parentId+"-btn").handler(!1)}else(i=n.getCmp(a.parentId)).expand();var r=i.getStore().getNodeById(a.id);if(r){i.selectPath(r.getPath());var l=Ext.get(i.view.getNode(r));JE.scrollBy(i.view,l)}}}};s.tbar={xtype:"toolbar",itemId:"searchBar",layout:"fit",hidden:!0,style:"background:#fff;",items:a},s.tools=[{type:"search",tooltip:s.localLang.queryMenuTip,handler:function(e,t,i){var a=s.getDockedCmp("searchBar");a.setVisible(a.isHidden())}}]}}),Ext.define("JE.app.controller.MainController",{extend:"Ext.app.Controller",init:function(){JE.initCtr("JE.core.controller.MainCtr"),JE.isEmpty(JE.requestParams.funcCode)&&(JE.initCtr("JE.sys.workflow.controller.WorkflowCtr"),JE.initCtr("JE.sys.flowchart.controller.FlowChartCtr"),JE.initCtr("JE.sys.portal.controller.MainController"),JE.initCtr("JE.sys.documentation.controller.DocumentationController"),JE.initCtr("JE.sys.im.controller.IMMainCtr"),JE.initCtr("JE.sys.table.controller.ResourceTableController"),JE.initCtr("JE.sys.svg.controller.MainController"),JE.initCtr("JE.sys.rbac.controller.RoleUserPermController"));var e={"#_appcenterview":{add:function(e,t){t.tab.on({beforeclose:function(e){var t,i=e.tabBar,a=e.card,n=i.tabPanel;if(a.tabBeforeClose&&0==a.tabBeforeClose())return!1;return e.active&&1<i.items.getCount()&&(t=e.next("tab[hidden=false]")||e.prev("tab[hidden=false]"),t=JE.isEmpty(t)||t.isHidden()?i.items.items[0]:t,i.setActiveTab(t),n&&n.setActiveTab(t.card)),a.isShow=!1,e.hide(),JE.openFuncById(n.getActiveTab().itemId),!1},afterrender:function(a,e,t){a.el.on("click",function(e){var t=a.card;if(!e.getTarget(".x-tab-close-btn",1)){JE.locationFuncById(t.itemId);var i=Ext.getCmp("app-configview");i&&!i.collapsed&&i.toggle()}}),1!=window.__DISABEL_FUNCTAB_DBLCLICK&&1!=window.__HIDDEN_JE_HEADER&&a.el.on("dblclick",function(){Ext.getCmp("app-mainview").doFullScreen()})}})}}};this.control(e)},views:["JE.app.view.CenterView","JE.app.view.MainView","JE.app.view.WestView","JE.app.view.NorthView","JE.app.view.NorthView2","JE.app.view.TopMenuView","JE.app.view.MenuView","JE.app.view.menu.MenuLeftView","JE.app.view.menu.MenuTopView","JE.app.view.menu.MenuTiledView","JE.app.view.LockView","JE.app.view.info.InfoAuth","JE.app.view.info.Password","JE.app.view.ConfigView","JE.app.view.menu.ShortcutView","JE.app.view.NorthMenuView","JE.app.view.NorthMenuMiniView","JE.app.view.info.UserInfo","JE.app.view.info.UpdateInfo"],stores:[],models:[]}),Ext.Loader.setPath("JE","JE");var JE=JE||{};Ext.define("JE",Ext.apply({singleton:!0,mixins:["JE.util.Common","JE.util.Util","JE.util.DataUtil","JE.core.util.MenuUtil","JE.util.RendererUtil","JE.util.PinYinUtil","JE.util.DwrMsgUtil","JE.util.RbacUtil"]},JE)),Ext.define("JE.vue",{singleton:!0,mixins:["JE.vue.util"]}),Ext.define("JE.DB",{singleton:!0,mixins:["JE.core.util.SqlUtil"]}),Ext.define("JE.Action",{singleton:!0,mixins:["JE.core.action.FormAction","JE.core.action.GridAction","JE.core.action.ChildAction","JE.core.action.TreeAction","JE.core.action.WFAction"]}),Ext.define("JE.CoreUtil",{singleton:!0,mixins:["JE.core.util.ChildUtil","JE.core.util.Util","JE.core.util.PermUtil","JE.core.util.LocalLangUtil"]}),Ext.define("JE.DATE",{singleton:!0,mixins:["JE.util.DateUtil"]}),Ext.define("JE.ChartUtil",{singleton:!0,mixins:["JE.util.ChartUtil"]}),Ext.define("JE.File",{singleton:!0,mixins:["JE.util.OpenFileUtil"]}),Ext.define("JE.WebSocket",{singleton:!0,mixins:["JE.util.WebSocket"]});var DES=function(){var g="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";return this.strEncode=function(e,t,i,a){if(null==e||null==e||0==(e=new String(e)).length)return"";for(var n=(new Date).valueOf(),o=0,r=0;r<t.length;r++)o+=t.charCodeAt(r);for(r=0;r<i.length;r++)o-=i.charCodeAt(r);var l=!1;for(r=0;r<a.length;r++)l?o+=a.charCodeAt(r):o-=a.charCodeAt(r),l=!l;o<0&&(o=-o);var s=4+(o+n)%16,d=(o+s)%g.length,c=[],u=encodeBase64(e).split(""),p=[];for(r=0;r<u.length;r++){var f=g.indexOf(u[r]);if(f=(f+d)%g.length,p.push(g.charAt(f)),p.length==s){for(var E=p.length-1;0<=E;E--)c.push(p[E]);p=[]}}if(0!=p.length)for(E=p.length-1;0<=E;E--)c.push(p[E]);for(var m=(s+=c.length+4).toString(16);m.length<4;)m="0"+m;return c.push(m),c.join("")},this.strDecode=function(e,t,i,a){return""},_keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",this.encodeBase64=function(e){var t,i,a,n,o,r,l,s="",d=0;for(e=_utf8_encode(e);d<e.length;)n=(t=e.charCodeAt(d++))>>2,o=(3&t)<<4|(i=e.charCodeAt(d++))>>4,r=(15&i)<<2|(a=e.charCodeAt(d++))>>6,l=63&a,isNaN(i)?r=l=64:isNaN(a)&&(l=64),s=s+_keyStr.charAt(n)+_keyStr.charAt(o)+_keyStr.charAt(r)+_keyStr.charAt(l);return s},this.decodeBase64=function(e){var t,i,a,n,o,r,l="",s=0;for(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");s<e.length;)t=_keyStr.indexOf(e.charAt(s++))<<2|(n=_keyStr.indexOf(e.charAt(s++)))>>4,i=(15&n)<<4|(o=_keyStr.indexOf(e.charAt(s++)))>>2,a=(3&o)<<6|(r=_keyStr.indexOf(e.charAt(s++))),l+=String.fromCharCode(t),64!=o&&(l+=String.fromCharCode(i)),64!=r&&(l+=String.fromCharCode(a));return l=_utf8_decode(l)},_utf8_encode=function(e){e=e.replace(/\r\n/g,"\n");for(var t="",i=0;i<e.length;i++){var a=e.charCodeAt(i);a<128?t+=String.fromCharCode(a):(127<a&&a<2048?t+=String.fromCharCode(a>>6|192):(t+=String.fromCharCode(a>>12|224),t+=String.fromCharCode(a>>6&63|128)),t+=String.fromCharCode(63&a|128))}return t},_utf8_decode=function(e){for(var t="",i=0,a=c1=c2=0;i<e.length;)(a=e.charCodeAt(i))<128?(t+=String.fromCharCode(a),i++):191<a&&a<224?(c2=e.charCodeAt(i+1),t+=String.fromCharCode((31&a)<<6|63&c2),i+=2):(c2=e.charCodeAt(i+1),c3=e.charCodeAt(i+2),t+=String.fromCharCode((15&a)<<12|(63&c2)<<6|63&c3),i+=3);return t},this}();!function(e,t){"object"==typeof exports?module.exports=exports=t():"function"==typeof define&&define.amd?define([],t):e.CryptoJS=t()}(this,function(){var c,i,e,t,a,u,n,o,r,l,s,d,p,f,E,m,g,h,x,v,y,b,C,w,S,I,T,_,J,D,A,N,O,R,L,P,M,F,k,U,j,B,Y,V,W,q,H,G,X,K,z,Q,Z,$,ee,te,ie,ae,ne,oe,re,le,se,de,ce,ue,pe,fe,Ee,me,ge,he,xe,ve,ye,be,Ce,we,Se,Ie,Te,_e,Je,De,Ae,Ne,Oe,Re,Le,Pe,Me,Fe,ke,Ue=Ue||(c=Math,i=Object.create||function(e){var t;return je.prototype=e,t=new je,je.prototype=null,t},t=(e={}).lib={},a=t.Base={extend:function(e){var t=i(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),(t.init.prototype=t).$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},u=t.WordArray=a.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||o).stringify(this)},concat:function(e){var t=this.words,i=e.words,a=this.sigBytes,n=e.sigBytes;if(this.clamp(),a%4)for(var o=0;o<n;o++){var r=i[o>>>2]>>>24-o%4*8&255;t[a+o>>>2]|=r<<24-(a+o)%4*8}else for(o=0;o<n;o+=4)t[a+o>>>2]=i[o>>>2];return this.sigBytes+=n,this},clamp:function(){var e=this.words,t=this.sigBytes;e[t>>>2]&=4294967295<<32-t%4*8,e.length=c.ceil(t/4)},clone:function(){var e=a.clone.call(this);return e.words=this.words.slice(0),e},random:function(e){function t(t){t=t;var i=987654321,a=4294967295;return function(){var e=((i=36969*(65535&i)+(i>>16)&a)<<16)+(t=18e3*(65535&t)+(t>>16)&a)&a;return e/=4294967296,(e+=.5)*(.5<c.random()?1:-1)}}for(var i,a=[],n=0;n<e;n+=4){var o=t(4294967296*(i||c.random()));i=987654071*o(),a.push(4294967296*o()|0)}return new u.init(a,e)}}),n=e.enc={},o=n.Hex={stringify:function(e){for(var t=e.words,i=e.sigBytes,a=[],n=0;n<i;n++){var o=t[n>>>2]>>>24-n%4*8&255;a.push((o>>>4).toString(16)),a.push((15&o).toString(16))}return a.join("")},parse:function(e){for(var t=e.length,i=[],a=0;a<t;a+=2)i[a>>>3]|=parseInt(e.substr(a,2),16)<<24-a%8*4;return new u.init(i,t/2)}},r=n.Latin1={stringify:function(e){for(var t=e.words,i=e.sigBytes,a=[],n=0;n<i;n++){var o=t[n>>>2]>>>24-n%4*8&255;a.push(String.fromCharCode(o))}return a.join("")},parse:function(e){for(var t=e.length,i=[],a=0;a<t;a++)i[a>>>2]|=(255&e.charCodeAt(a))<<24-a%4*8;return new u.init(i,t)}},l=n.Utf8={stringify:function(e){try{return decodeURIComponent(escape(r.stringify(e)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(e){return r.parse(unescape(encodeURIComponent(e)))}},s=t.BufferedBlockAlgorithm=a.extend({reset:function(){this._data=new u.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=l.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(e){var t=this._data,i=t.words,a=t.sigBytes,n=this.blockSize,o=a/(4*n),r=(o=e?c.ceil(o):c.max((0|o)-this._minBufferSize,0))*n,l=c.min(4*r,a);if(r){for(var s=0;s<r;s+=n)this._doProcessBlock(i,s);var d=i.splice(0,r);t.sigBytes-=l}return new u.init(d,l)},clone:function(){var e=a.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),t.Hasher=s.extend({cfg:a.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){s.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(i){return function(e,t){return new i.init(t).finalize(e)}},_createHmacHelper:function(i){return function(e,t){return new d.HMAC.init(i,t).finalize(e)}}}),d=e.algo={},e);function je(){}function Be(e,t,i){return e^t^i}function Ye(e,t,i){return e&t|~e&i}function Ve(e,t,i){return(e|~t)^i}function We(e,t,i){return e&i|t&~i}function qe(e,t,i){return e^(t|~i)}function He(e,t){return e<<t|e>>>32-t}function Ge(e,t,i,a){var n=this._iv;if(n){var o=n.slice(0);this._iv=void 0}else o=this._prevBlock;a.encryptBlock(o,0);for(var r=0;r<i;r++)e[t+r]^=o[r]}function Xe(e){if(255==(e>>24&255)){var t=e>>16&255,i=e>>8&255,a=255&e;255===t?(t=0,255===i?(i=0,255===a?a=0:++a):++i):++t,e=0,e+=t<<16,e+=i<<8,e+=a}else e+=1<<24;return e}function Ke(){for(var e=this._X,t=this._C,i=0;i<8;i++)_e[i]=t[i];t[0]=t[0]+1295307597+this._b|0,t[1]=t[1]+3545052371+(t[0]>>>0<_e[0]>>>0?1:0)|0,t[2]=t[2]+886263092+(t[1]>>>0<_e[1]>>>0?1:0)|0,t[3]=t[3]+1295307597+(t[2]>>>0<_e[2]>>>0?1:0)|0,t[4]=t[4]+3545052371+(t[3]>>>0<_e[3]>>>0?1:0)|0,t[5]=t[5]+886263092+(t[4]>>>0<_e[4]>>>0?1:0)|0,t[6]=t[6]+1295307597+(t[5]>>>0<_e[5]>>>0?1:0)|0,t[7]=t[7]+3545052371+(t[6]>>>0<_e[6]>>>0?1:0)|0,this._b=t[7]>>>0<_e[7]>>>0?1:0;for(i=0;i<8;i++){var a=e[i]+t[i],n=65535&a,o=a>>>16,r=((n*n>>>17)+n*o>>>15)+o*o,l=((4294901760&a)*a|0)+((65535&a)*a|0);Je[i]=r^l}e[0]=Je[0]+(Je[7]<<16|Je[7]>>>16)+(Je[6]<<16|Je[6]>>>16)|0,e[1]=Je[1]+(Je[0]<<8|Je[0]>>>24)+Je[7]|0,e[2]=Je[2]+(Je[1]<<16|Je[1]>>>16)+(Je[0]<<16|Je[0]>>>16)|0,e[3]=Je[3]+(Je[2]<<8|Je[2]>>>24)+Je[1]|0,e[4]=Je[4]+(Je[3]<<16|Je[3]>>>16)+(Je[2]<<16|Je[2]>>>16)|0,e[5]=Je[5]+(Je[4]<<8|Je[4]>>>24)+Je[3]|0,e[6]=Je[6]+(Je[5]<<16|Je[5]>>>16)+(Je[4]<<16|Je[4]>>>16)|0,e[7]=Je[7]+(Je[6]<<8|Je[6]>>>24)+Je[5]|0}function ze(){for(var e=this._X,t=this._C,i=0;i<8;i++)Me[i]=t[i];t[0]=t[0]+1295307597+this._b|0,t[1]=t[1]+3545052371+(t[0]>>>0<Me[0]>>>0?1:0)|0,t[2]=t[2]+886263092+(t[1]>>>0<Me[1]>>>0?1:0)|0,t[3]=t[3]+1295307597+(t[2]>>>0<Me[2]>>>0?1:0)|0,t[4]=t[4]+3545052371+(t[3]>>>0<Me[3]>>>0?1:0)|0,t[5]=t[5]+886263092+(t[4]>>>0<Me[4]>>>0?1:0)|0,t[6]=t[6]+1295307597+(t[5]>>>0<Me[5]>>>0?1:0)|0,t[7]=t[7]+3545052371+(t[6]>>>0<Me[6]>>>0?1:0)|0,this._b=t[7]>>>0<Me[7]>>>0?1:0;for(i=0;i<8;i++){var a=e[i]+t[i],n=65535&a,o=a>>>16,r=((n*n>>>17)+n*o>>>15)+o*o,l=((4294901760&a)*a|0)+((65535&a)*a|0);Fe[i]=r^l}e[0]=Fe[0]+(Fe[7]<<16|Fe[7]>>>16)+(Fe[6]<<16|Fe[6]>>>16)|0,e[1]=Fe[1]+(Fe[0]<<8|Fe[0]>>>24)+Fe[7]|0,e[2]=Fe[2]+(Fe[1]<<16|Fe[1]>>>16)+(Fe[0]<<16|Fe[0]>>>16)|0,e[3]=Fe[3]+(Fe[2]<<8|Fe[2]>>>24)+Fe[1]|0,e[4]=Fe[4]+(Fe[3]<<16|Fe[3]>>>16)+(Fe[2]<<16|Fe[2]>>>16)|0,e[5]=Fe[5]+(Fe[4]<<8|Fe[4]>>>24)+Fe[3]|0,e[6]=Fe[6]+(Fe[5]<<16|Fe[5]>>>16)+(Fe[4]<<16|Fe[4]>>>16)|0,e[7]=Fe[7]+(Fe[6]<<8|Fe[6]>>>24)+Fe[5]|0}return f=(p=Ue).lib.WordArray,p.enc.Base64={stringify:function(e){var t=e.words,i=e.sigBytes,a=this._map;e.clamp();for(var n=[],o=0;o<i;o+=3)for(var r=(t[o>>>2]>>>24-o%4*8&255)<<16|(t[o+1>>>2]>>>24-(o+1)%4*8&255)<<8|t[o+2>>>2]>>>24-(o+2)%4*8&255,l=0;l<4&&o+.75*l<i;l++)n.push(a.charAt(r>>>6*(3-l)&63));var s=a.charAt(64);if(s)for(;n.length%4;)n.push(s);return n.join("")},parse:function(e){var t=e.length,i=this._map,a=this._reverseMap;if(!a){a=this._reverseMap=[];for(var n=0;n<i.length;n++)a[i.charCodeAt(n)]=n}var o=i.charAt(64);if(o){var r=e.indexOf(o);-1!==r&&(t=r)}return function(e,t,i){for(var a=[],n=0,o=0;o<t;o++)if(o%4){var r=i[e.charCodeAt(o-1)]<<o%4*2,l=i[e.charCodeAt(o)]>>>6-o%4*2;a[n>>>2]|=(r|l)<<24-n%4*8,n++}return f.create(a,n)}(e,t,a)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="},function(c){var e=Ue,t=e.lib,i=t.WordArray,a=t.Hasher,n=e.algo,T=[];!function(){for(var e=0;e<64;e++)T[e]=4294967296*c.abs(c.sin(e+1))|0}();var o=n.MD5=a.extend({_doReset:function(){this._hash=new i.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,t){for(var i=0;i<16;i++){var a=t+i,n=e[a];e[a]=16711935&(n<<8|n>>>24)|4278255360&(n<<24|n>>>8)}var o=this._hash.words,r=e[t+0],l=e[t+1],s=e[t+2],d=e[t+3],c=e[t+4],u=e[t+5],p=e[t+6],f=e[t+7],E=e[t+8],m=e[t+9],g=e[t+10],h=e[t+11],x=e[t+12],v=e[t+13],y=e[t+14],b=e[t+15],C=o[0],w=o[1],S=o[2],I=o[3];w=A(w=A(w=A(w=A(w=D(w=D(w=D(w=D(w=J(w=J(w=J(w=J(w=_(w=_(w=_(w=_(w,S=_(S,I=_(I,C=_(C,w,S,I,r,7,T[0]),w,S,l,12,T[1]),C,w,s,17,T[2]),I,C,d,22,T[3]),S=_(S,I=_(I,C=_(C,w,S,I,c,7,T[4]),w,S,u,12,T[5]),C,w,p,17,T[6]),I,C,f,22,T[7]),S=_(S,I=_(I,C=_(C,w,S,I,E,7,T[8]),w,S,m,12,T[9]),C,w,g,17,T[10]),I,C,h,22,T[11]),S=_(S,I=_(I,C=_(C,w,S,I,x,7,T[12]),w,S,v,12,T[13]),C,w,y,17,T[14]),I,C,b,22,T[15]),S=J(S,I=J(I,C=J(C,w,S,I,l,5,T[16]),w,S,p,9,T[17]),C,w,h,14,T[18]),I,C,r,20,T[19]),S=J(S,I=J(I,C=J(C,w,S,I,u,5,T[20]),w,S,g,9,T[21]),C,w,b,14,T[22]),I,C,c,20,T[23]),S=J(S,I=J(I,C=J(C,w,S,I,m,5,T[24]),w,S,y,9,T[25]),C,w,d,14,T[26]),I,C,E,20,T[27]),S=J(S,I=J(I,C=J(C,w,S,I,v,5,T[28]),w,S,s,9,T[29]),C,w,f,14,T[30]),I,C,x,20,T[31]),S=D(S,I=D(I,C=D(C,w,S,I,u,4,T[32]),w,S,E,11,T[33]),C,w,h,16,T[34]),I,C,y,23,T[35]),S=D(S,I=D(I,C=D(C,w,S,I,l,4,T[36]),w,S,c,11,T[37]),C,w,f,16,T[38]),I,C,g,23,T[39]),S=D(S,I=D(I,C=D(C,w,S,I,v,4,T[40]),w,S,r,11,T[41]),C,w,d,16,T[42]),I,C,p,23,T[43]),S=D(S,I=D(I,C=D(C,w,S,I,m,4,T[44]),w,S,x,11,T[45]),C,w,b,16,T[46]),I,C,s,23,T[47]),S=A(S,I=A(I,C=A(C,w,S,I,r,6,T[48]),w,S,f,10,T[49]),C,w,y,15,T[50]),I,C,u,21,T[51]),S=A(S,I=A(I,C=A(C,w,S,I,x,6,T[52]),w,S,d,10,T[53]),C,w,g,15,T[54]),I,C,l,21,T[55]),S=A(S,I=A(I,C=A(C,w,S,I,E,6,T[56]),w,S,b,10,T[57]),C,w,p,15,T[58]),I,C,v,21,T[59]),S=A(S,I=A(I,C=A(C,w,S,I,c,6,T[60]),w,S,h,10,T[61]),C,w,s,15,T[62]),I,C,m,21,T[63]),o[0]=o[0]+C|0,o[1]=o[1]+w|0,o[2]=o[2]+S|0,o[3]=o[3]+I|0},_doFinalize:function(){var e=this._data,t=e.words,i=8*this._nDataBytes,a=8*e.sigBytes;t[a>>>5]|=128<<24-a%32;var n=c.floor(i/4294967296),o=i;t[15+(64+a>>>9<<4)]=16711935&(n<<8|n>>>24)|4278255360&(n<<24|n>>>8),t[14+(64+a>>>9<<4)]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),e.sigBytes=4*(t.length+1),this._process();for(var r=this._hash,l=r.words,s=0;s<4;s++){var d=l[s];l[s]=16711935&(d<<8|d>>>24)|4278255360&(d<<24|d>>>8)}return r},clone:function(){var e=a.clone.call(this);return e._hash=this._hash.clone(),e}});function _(e,t,i,a,n,o,r){var l=e+(t&i|~t&a)+n+r;return(l<<o|l>>>32-o)+t}function J(e,t,i,a,n,o,r){var l=e+(t&a|i&~a)+n+r;return(l<<o|l>>>32-o)+t}function D(e,t,i,a,n,o,r){var l=e+(t^i^a)+n+r;return(l<<o|l>>>32-o)+t}function A(e,t,i,a,n,o,r){var l=e+(i^(t|~a))+n+r;return(l<<o|l>>>32-o)+t}e.MD5=a._createHelper(o),e.HmacMD5=a._createHmacHelper(o)}(Math),m=(E=Ue).lib,g=m.WordArray,h=m.Hasher,x=E.algo,v=[],y=x.SHA1=h.extend({_doReset:function(){this._hash=new g.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var i=this._hash.words,a=i[0],n=i[1],o=i[2],r=i[3],l=i[4],s=0;s<80;s++){if(s<16)v[s]=0|e[t+s];else{var d=v[s-3]^v[s-8]^v[s-14]^v[s-16];v[s]=d<<1|d>>>31}var c=(a<<5|a>>>27)+l+v[s];c+=s<20?1518500249+(n&o|~n&r):s<40?1859775393+(n^o^r):s<60?(n&o|n&r|o&r)-1894007588:(n^o^r)-899497514,l=r,r=o,o=n<<30|n>>>2,n=a,a=c}i[0]=i[0]+a|0,i[1]=i[1]+n|0,i[2]=i[2]+o|0,i[3]=i[3]+r|0,i[4]=i[4]+l|0},_doFinalize:function(){var e=this._data,t=e.words,i=8*this._nDataBytes,a=8*e.sigBytes;return t[a>>>5]|=128<<24-a%32,t[14+(64+a>>>9<<4)]=Math.floor(i/4294967296),t[15+(64+a>>>9<<4)]=i,e.sigBytes=4*t.length,this._process(),this._hash},clone:function(){var e=h.clone.call(this);return e._hash=this._hash.clone(),e}}),E.SHA1=h._createHelper(y),E.HmacSHA1=h._createHmacHelper(y),function(n){var e=Ue,t=e.lib,i=t.WordArray,a=t.Hasher,o=e.algo,r=[],v=[];!function(){function e(e){for(var t=n.sqrt(e),i=2;i<=t;i++)if(!(e%i))return!1;return!0}function t(e){return 4294967296*(e-(0|e))|0}for(var i=2,a=0;a<64;)e(i)&&(a<8&&(r[a]=t(n.pow(i,.5))),v[a]=t(n.pow(i,1/3)),a++),i++}();var y=[],l=o.SHA256=a.extend({_doReset:function(){this._hash=new i.init(r.slice(0))},_doProcessBlock:function(e,t){for(var i=this._hash.words,a=i[0],n=i[1],o=i[2],r=i[3],l=i[4],s=i[5],d=i[6],c=i[7],u=0;u<64;u++){if(u<16)y[u]=0|e[t+u];else{var p=y[u-15],f=(p<<25|p>>>7)^(p<<14|p>>>18)^p>>>3,E=y[u-2],m=(E<<15|E>>>17)^(E<<13|E>>>19)^E>>>10;y[u]=f+y[u-7]+m+y[u-16]}var g=a&n^a&o^n&o,h=(a<<30|a>>>2)^(a<<19|a>>>13)^(a<<10|a>>>22),x=c+((l<<26|l>>>6)^(l<<21|l>>>11)^(l<<7|l>>>25))+(l&s^~l&d)+v[u]+y[u];c=d,d=s,s=l,l=r+x|0,r=o,o=n,n=a,a=x+(h+g)|0}i[0]=i[0]+a|0,i[1]=i[1]+n|0,i[2]=i[2]+o|0,i[3]=i[3]+r|0,i[4]=i[4]+l|0,i[5]=i[5]+s|0,i[6]=i[6]+d|0,i[7]=i[7]+c|0},_doFinalize:function(){var e=this._data,t=e.words,i=8*this._nDataBytes,a=8*e.sigBytes;return t[a>>>5]|=128<<24-a%32,t[14+(64+a>>>9<<4)]=n.floor(i/4294967296),t[15+(64+a>>>9<<4)]=i,e.sigBytes=4*t.length,this._process(),this._hash},clone:function(){var e=a.clone.call(this);return e._hash=this._hash.clone(),e}});e.SHA256=a._createHelper(l),e.HmacSHA256=a._createHmacHelper(l)}(Math),function(){var e=Ue,n=e.lib.WordArray,t=e.enc;t.Utf16=t.Utf16BE={stringify:function(e){for(var t=e.words,i=e.sigBytes,a=[],n=0;n<i;n+=2){var o=t[n>>>2]>>>16-n%4*8&65535;a.push(String.fromCharCode(o))}return a.join("")},parse:function(e){for(var t=e.length,i=[],a=0;a<t;a++)i[a>>>1]|=e.charCodeAt(a)<<16-a%2*16;return n.create(i,2*t)}};function r(e){return e<<8&4278255360|e>>>8&16711935}t.Utf16LE={stringify:function(e){for(var t=e.words,i=e.sigBytes,a=[],n=0;n<i;n+=2){var o=r(t[n>>>2]>>>16-n%4*8&65535);a.push(String.fromCharCode(o))}return a.join("")},parse:function(e){for(var t=e.length,i=[],a=0;a<t;a++)i[a>>>1]|=r(e.charCodeAt(a)<<16-a%2*16);return n.create(i,2*t)}}}(),function(){if("function"==typeof ArrayBuffer){var e=Ue.lib.WordArray,n=e.init;(e.init=function(e){if(e instanceof ArrayBuffer&&(e=new Uint8Array(e)),(e instanceof Int8Array||"undefined"!=typeof Uint8ClampedArray&&e instanceof Uint8ClampedArray||e instanceof Int16Array||e instanceof Uint16Array||e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array||e instanceof Float64Array)&&(e=new Uint8Array(e.buffer,e.byteOffset,e.byteLength)),e instanceof Uint8Array){for(var t=e.byteLength,i=[],a=0;a<t;a++)i[a>>>2]|=e[a]<<24-a%4*8;n.call(this,i,t)}else n.apply(this,arguments)}).prototype=e}}(),Math,C=(b=Ue).lib,w=C.WordArray,S=C.Hasher,I=b.algo,T=w.create([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13]),_=w.create([5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11]),J=w.create([11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6]),D=w.create([8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11]),A=w.create([0,1518500249,1859775393,2400959708,2840853838]),N=w.create([1352829926,1548603684,1836072691,2053994217,0]),O=I.RIPEMD160=S.extend({_doReset:function(){this._hash=w.create([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var i=0;i<16;i++){var a=t+i,n=e[a];e[a]=16711935&(n<<8|n>>>24)|4278255360&(n<<24|n>>>8)}var o,r,l,s,d,c,u,p,f,E,m,g=this._hash.words,h=A.words,x=N.words,v=T.words,y=_.words,b=J.words,C=D.words;c=o=g[0],u=r=g[1],p=l=g[2],f=s=g[3],E=d=g[4];for(i=0;i<80;i+=1)m=o+e[t+v[i]]|0,m+=i<16?Be(r,l,s)+h[0]:i<32?Ye(r,l,s)+h[1]:i<48?Ve(r,l,s)+h[2]:i<64?We(r,l,s)+h[3]:qe(r,l,s)+h[4],m=(m=He(m|=0,b[i]))+d|0,o=d,d=s,s=He(l,10),l=r,r=m,m=c+e[t+y[i]]|0,m+=i<16?qe(u,p,f)+x[0]:i<32?We(u,p,f)+x[1]:i<48?Ve(u,p,f)+x[2]:i<64?Ye(u,p,f)+x[3]:Be(u,p,f)+x[4],m=(m=He(m|=0,C[i]))+E|0,c=E,E=f,f=He(p,10),p=u,u=m;m=g[1]+l+f|0,g[1]=g[2]+s+E|0,g[2]=g[3]+d+c|0,g[3]=g[4]+o+u|0,g[4]=g[0]+r+p|0,g[0]=m},_doFinalize:function(){var e=this._data,t=e.words,i=8*this._nDataBytes,a=8*e.sigBytes;t[a>>>5]|=128<<24-a%32,t[14+(64+a>>>9<<4)]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8),e.sigBytes=4*(t.length+1),this._process();for(var n=this._hash,o=n.words,r=0;r<5;r++){var l=o[r];o[r]=16711935&(l<<8|l>>>24)|4278255360&(l<<24|l>>>8)}return n},clone:function(){var e=S.clone.call(this);return e._hash=this._hash.clone(),e}}),b.RIPEMD160=S._createHelper(O),b.HmacRIPEMD160=S._createHmacHelper(O),L=(R=Ue).lib.Base,P=R.enc.Utf8,R.algo.HMAC=L.extend({init:function(e,t){e=this._hasher=new e.init,"string"==typeof t&&(t=P.parse(t));var i=e.blockSize,a=4*i;t.sigBytes>a&&(t=e.finalize(t)),t.clamp();for(var n=this._oKey=t.clone(),o=this._iKey=t.clone(),r=n.words,l=o.words,s=0;s<i;s++)r[s]^=1549556828,l[s]^=909522486;n.sigBytes=o.sigBytes=a,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t=this._hasher,i=t.finalize(e);return t.reset(),t.finalize(this._oKey.clone().concat(i))}}),F=(M=Ue).lib,k=F.Base,U=F.WordArray,j=M.algo,B=j.SHA1,Y=j.HMAC,V=j.PBKDF2=k.extend({cfg:k.extend({keySize:4,hasher:B,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var i=this.cfg,a=Y.create(i.hasher,e),n=U.create(),o=U.create([1]),r=n.words,l=o.words,s=i.keySize,d=i.iterations;r.length<s;){var c=a.update(t).finalize(o);a.reset();for(var u=c.words,p=u.length,f=c,E=1;E<d;E++){f=a.finalize(f),a.reset();for(var m=f.words,g=0;g<p;g++)u[g]^=m[g]}n.concat(c),l[0]++}return n.sigBytes=4*s,n}}),M.PBKDF2=function(e,t,i){return V.create(i).compute(e,t)},q=(W=Ue).lib,H=q.Base,G=q.WordArray,X=W.algo,K=X.MD5,z=X.EvpKDF=H.extend({cfg:H.extend({keySize:4,hasher:K,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var i=this.cfg,a=i.hasher.create(),n=G.create(),o=n.words,r=i.keySize,l=i.iterations;o.length<r;){s&&a.update(s);var s=a.update(e).finalize(t);a.reset();for(var d=1;d<l;d++)s=a.finalize(s),a.reset();n.concat(s)}return n.sigBytes=4*r,n}}),W.EvpKDF=function(e,t,i){return z.create(i).compute(e,t)},Z=(Q=Ue).lib.WordArray,$=Q.algo,ee=$.SHA256,te=$.SHA224=ee.extend({_doReset:function(){this._hash=new Z.init([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428])},_doFinalize:function(){var e=ee._doFinalize.call(this);return e.sigBytes-=4,e}}),Q.SHA224=ee._createHelper(te),Q.HmacSHA224=ee._createHmacHelper(te),ae=(ie=Ue).lib,ne=ae.Base,oe=ae.WordArray,(re=ie.x64={}).Word=ne.extend({init:function(e,t){this.high=e,this.low=t}}),re.WordArray=ne.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:8*e.length},toX32:function(){for(var e=this.words,t=e.length,i=[],a=0;a<t;a++){var n=e[a];i.push(n.high),i.push(n.low)}return oe.create(i,this.sigBytes)},clone:function(){for(var e=ne.clone.call(this),t=e.words=this.words.slice(0),i=t.length,a=0;a<i;a++)t[a]=t[a].clone();return e}}),function(p){var e=Ue,t=e.lib,f=t.WordArray,a=t.Hasher,c=e.x64.Word,i=e.algo,D=[],A=[],N=[];!function(){for(var e=1,t=0,i=0;i<24;i++){D[e+5*t]=(i+1)*(i+2)/2%64;var a=(2*e+3*t)%5;e=t%5,t=a}for(e=0;e<5;e++)for(t=0;t<5;t++)A[e+5*t]=t+(2*e+3*t)%5*5;for(var n=1,o=0;o<24;o++){for(var r=0,l=0,s=0;s<7;s++){if(1&n){var d=(1<<s)-1;d<32?l^=1<<d:r^=1<<d-32}128&n?n=n<<1^113:n<<=1}N[o]=c.create(r,l)}}();var O=[];!function(){for(var e=0;e<25;e++)O[e]=c.create()}();var n=i.SHA3=a.extend({cfg:a.cfg.extend({outputLength:512}),_doReset:function(){for(var e=this._state=[],t=0;t<25;t++)e[t]=new c.init;this.blockSize=(1600-2*this.cfg.outputLength)/32},_doProcessBlock:function(e,t){for(var i=this._state,a=this.blockSize/2,n=0;n<a;n++){var o=e[t+2*n],r=e[t+2*n+1];o=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),r=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8),(S=i[n]).high^=r,S.low^=o}for(var l=0;l<24;l++){for(var s=0;s<5;s++){for(var d=0,c=0,u=0;u<5;u++){d^=(S=i[s+5*u]).high,c^=S.low}var p=O[s];p.high=d,p.low=c}for(s=0;s<5;s++){var f=O[(s+4)%5],E=O[(s+1)%5],m=E.high,g=E.low;for(d=f.high^(m<<1|g>>>31),c=f.low^(g<<1|m>>>31),u=0;u<5;u++){(S=i[s+5*u]).high^=d,S.low^=c}}for(var h=1;h<25;h++){var x=(S=i[h]).high,v=S.low,y=D[h];if(y<32)d=x<<y|v>>>32-y,c=v<<y|x>>>32-y;else d=v<<y-32|x>>>64-y,c=x<<y-32|v>>>64-y;var b=O[A[h]];b.high=d,b.low=c}var C=O[0],w=i[0];C.high=w.high,C.low=w.low;for(s=0;s<5;s++)for(u=0;u<5;u++){var S=i[h=s+5*u],I=O[h],T=O[(s+1)%5+5*u],_=O[(s+2)%5+5*u];S.high=I.high^~T.high&_.high,S.low=I.low^~T.low&_.low}S=i[0];var J=N[l];S.high^=J.high,S.low^=J.low}},_doFinalize:function(){var e=this._data,t=e.words,i=(this._nDataBytes,8*e.sigBytes),a=32*this.blockSize;t[i>>>5]|=1<<24-i%32,t[(p.ceil((1+i)/a)*a>>>5)-1]|=128,e.sigBytes=4*t.length,this._process();for(var n=this._state,o=this.cfg.outputLength/8,r=o/8,l=[],s=0;s<r;s++){var d=n[s],c=d.high,u=d.low;c=16711935&(c<<8|c>>>24)|4278255360&(c<<24|c>>>8),u=16711935&(u<<8|u>>>24)|4278255360&(u<<24|u>>>8),l.push(u),l.push(c)}return new f.init(l,o)},clone:function(){for(var e=a.clone.call(this),t=e._state=this._state.slice(0),i=0;i<25;i++)t[i]=t[i].clone();return e}});e.SHA3=a._createHelper(n),e.HmacSHA3=a._createHmacHelper(n)}(Math),function(){var e=Ue,t=e.lib.Hasher,i=e.x64,a=i.Word,n=i.WordArray,o=e.algo;function r(){return a.create.apply(a,arguments)}var we=[r(1116352408,3609767458),r(1899447441,602891725),r(3049323471,3964484399),r(3921009573,2173295548),r(961987163,4081628472),r(1508970993,3053834265),r(2453635748,2937671579),r(2870763221,3664609560),r(3624381080,2734883394),r(310598401,1164996542),r(607225278,1323610764),r(1426881987,3590304994),r(1925078388,4068182383),r(2162078206,991336113),r(2614888103,633803317),r(3248222580,3479774868),r(3835390401,2666613458),r(4022224774,944711139),r(264347078,2341262773),r(604807628,2007800933),r(770255983,1495990901),r(1249150122,1856431235),r(1555081692,3175218132),r(1996064986,2198950837),r(2554220882,3999719339),r(2821834349,766784016),r(2952996808,2566594879),r(3210313671,3203337956),r(3336571891,1034457026),r(3584528711,2466948901),r(113926993,3758326383),r(338241895,168717936),r(666307205,1188179964),r(773529912,1546045734),r(1294757372,1522805485),r(1396182291,2643833823),r(1695183700,2343527390),r(1986661051,1014477480),r(2177026350,1206759142),r(2456956037,344077627),r(2730485921,1290863460),r(2820302411,3158454273),r(3259730800,3505952657),r(3345764771,106217008),r(3516065817,3606008344),r(3600352804,1432725776),r(4094571909,1467031594),r(275423344,851169720),r(430227734,3100823752),r(506948616,1363258195),r(659060556,3750685593),r(883997877,3785050280),r(958139571,3318307427),r(1322822218,3812723403),r(1537002063,2003034995),r(1747873779,3602036899),r(1955562222,1575990012),r(2024104815,1125592928),r(2227730452,2716904306),r(2361852424,442776044),r(2428436474,593698344),r(2756734187,3733110249),r(3204031479,2999351573),r(3329325298,3815920427),r(3391569614,3928383900),r(3515267271,566280711),r(3940187606,3454069534),r(4118630271,4000239992),r(116418474,1914138554),r(174292421,2731055270),r(289380356,3203993006),r(460393269,320620315),r(685471733,587496836),r(852142971,1086792851),r(1017036298,365543100),r(1126000580,2618297676),r(1288033470,3409855158),r(1501505948,4234509866),r(1607167915,987167468),r(1816402316,1246189591)],Se=[];!function(){for(var e=0;e<80;e++)Se[e]=r()}();var l=o.SHA512=t.extend({_doReset:function(){this._hash=new n.init([new a.init(1779033703,4089235720),new a.init(3144134277,2227873595),new a.init(1013904242,4271175723),new a.init(2773480762,1595750129),new a.init(1359893119,2917565137),new a.init(2600822924,725511199),new a.init(528734635,4215389547),new a.init(1541459225,327033209)])},_doProcessBlock:function(e,t){for(var i=this._hash.words,a=i[0],n=i[1],o=i[2],r=i[3],l=i[4],s=i[5],d=i[6],c=i[7],u=a.high,p=a.low,f=n.high,E=n.low,m=o.high,g=o.low,h=r.high,x=r.low,v=l.high,y=l.low,b=s.high,C=s.low,w=d.high,S=d.low,I=c.high,T=c.low,_=u,J=p,D=f,A=E,N=m,O=g,R=h,L=x,P=v,M=y,F=b,k=C,U=w,j=S,B=I,Y=T,V=0;V<80;V++){var W=Se[V];if(V<16)var q=W.high=0|e[t+2*V],H=W.low=0|e[t+2*V+1];else{var G=Se[V-15],X=G.high,K=G.low,z=(X>>>1|K<<31)^(X>>>8|K<<24)^X>>>7,Q=(K>>>1|X<<31)^(K>>>8|X<<24)^(K>>>7|X<<25),Z=Se[V-2],$=Z.high,ee=Z.low,te=($>>>19|ee<<13)^($<<3|ee>>>29)^$>>>6,ie=(ee>>>19|$<<13)^(ee<<3|$>>>29)^(ee>>>6|$<<26),ae=Se[V-7],ne=ae.high,oe=ae.low,re=Se[V-16],le=re.high,se=re.low;q=(q=(q=z+ne+((H=Q+oe)>>>0<Q>>>0?1:0))+te+((H=H+ie)>>>0<ie>>>0?1:0))+le+((H=H+se)>>>0<se>>>0?1:0);W.high=q,W.low=H}var de,ce=P&F^~P&U,ue=M&k^~M&j,pe=_&D^_&N^D&N,fe=J&A^J&O^A&O,Ee=(_>>>28|J<<4)^(_<<30|J>>>2)^(_<<25|J>>>7),me=(J>>>28|_<<4)^(J<<30|_>>>2)^(J<<25|_>>>7),ge=(P>>>14|M<<18)^(P>>>18|M<<14)^(P<<23|M>>>9),he=(M>>>14|P<<18)^(M>>>18|P<<14)^(M<<23|P>>>9),xe=we[V],ve=xe.high,ye=xe.low,be=B+ge+((de=Y+he)>>>0<Y>>>0?1:0),Ce=me+fe;B=U,Y=j,U=F,j=k,F=P,k=M,P=R+(be=(be=(be=be+ce+((de=de+ue)>>>0<ue>>>0?1:0))+ve+((de=de+ye)>>>0<ye>>>0?1:0))+q+((de=de+H)>>>0<H>>>0?1:0))+((M=L+de|0)>>>0<L>>>0?1:0)|0,R=N,L=O,N=D,O=A,D=_,A=J,_=be+(Ee+pe+(Ce>>>0<me>>>0?1:0))+((J=de+Ce|0)>>>0<de>>>0?1:0)|0}p=a.low=p+J,a.high=u+_+(p>>>0<J>>>0?1:0),E=n.low=E+A,n.high=f+D+(E>>>0<A>>>0?1:0),g=o.low=g+O,o.high=m+N+(g>>>0<O>>>0?1:0),x=r.low=x+L,r.high=h+R+(x>>>0<L>>>0?1:0),y=l.low=y+M,l.high=v+P+(y>>>0<M>>>0?1:0),C=s.low=C+k,s.high=b+F+(C>>>0<k>>>0?1:0),S=d.low=S+j,d.high=w+U+(S>>>0<j>>>0?1:0),T=c.low=T+Y,c.high=I+B+(T>>>0<Y>>>0?1:0)},_doFinalize:function(){var e=this._data,t=e.words,i=8*this._nDataBytes,a=8*e.sigBytes;return t[a>>>5]|=128<<24-a%32,t[30+(128+a>>>10<<5)]=Math.floor(i/4294967296),t[31+(128+a>>>10<<5)]=i,e.sigBytes=4*t.length,this._process(),this._hash.toX32()},clone:function(){var e=t.clone.call(this);return e._hash=this._hash.clone(),e},blockSize:32});e.SHA512=t._createHelper(l),e.HmacSHA512=t._createHmacHelper(l)}(),se=(le=Ue).x64,de=se.Word,ce=se.WordArray,ue=le.algo,pe=ue.SHA512,fe=ue.SHA384=pe.extend({_doReset:function(){this._hash=new ce.init([new de.init(3418070365,3238371032),new de.init(1654270250,914150663),new de.init(2438529370,812702999),new de.init(355462360,4144912697),new de.init(1731405415,4290775857),new de.init(2394180231,1750603025),new de.init(3675008525,1694076839),new de.init(1203062813,3204075428)])},_doFinalize:function(){var e=pe._doFinalize.call(this);return e.sigBytes-=16,e}}),le.SHA384=pe._createHelper(fe),le.HmacSHA384=pe._createHmacHelper(fe),Ue.lib.Cipher||function(){var e=Ue,t=e.lib,i=t.Base,s=t.WordArray,a=t.BufferedBlockAlgorithm,n=e.enc,o=(n.Utf8,n.Base64),r=e.algo.EvpKDF,l=t.Cipher=a.extend({cfg:i.extend(),createEncryptor:function(e,t){return this.create(this._ENC_XFORM_MODE,e,t)},createDecryptor:function(e,t){return this.create(this._DEC_XFORM_MODE,e,t)},init:function(e,t,i){this.cfg=this.cfg.extend(i),this._xformMode=e,this._key=t,this.reset()},reset:function(){a.reset.call(this),this._doReset()},process:function(e){return this._append(e),this._process()},finalize:function(e){return e&&this._append(e),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(a){return{encrypt:function(e,t,i){return d(t).encrypt(a,e,t,i)},decrypt:function(e,t,i){return d(t).decrypt(a,e,t,i)}}}});function d(e){return"string"==typeof e?y:x}t.StreamCipher=l.extend({_doFinalize:function(){return this._process(!0)},blockSize:1});var c,u=e.mode={},p=t.BlockCipherMode=i.extend({createEncryptor:function(e,t){return this.Encryptor.create(e,t)},createDecryptor:function(e,t){return this.Decryptor.create(e,t)},init:function(e,t){this._cipher=e,this._iv=t}}),f=u.CBC=((c=p.extend()).Encryptor=c.extend({processBlock:function(e,t){var i=this._cipher,a=i.blockSize;E.call(this,e,t,a),i.encryptBlock(e,t),this._prevBlock=e.slice(t,t+a)}}),c.Decryptor=c.extend({processBlock:function(e,t){var i=this._cipher,a=i.blockSize,n=e.slice(t,t+a);i.decryptBlock(e,t),E.call(this,e,t,a),this._prevBlock=n}}),c);function E(e,t,i){var a=this._iv;if(a){var n=a;this._iv=void 0}else n=this._prevBlock;for(var o=0;o<i;o++)e[t+o]^=n[o]}var m=(e.pad={}).Pkcs7={pad:function(e,t){for(var i=4*t,a=i-e.sigBytes%i,n=a<<24|a<<16|a<<8|a,o=[],r=0;r<a;r+=4)o.push(n);var l=s.create(o,a);e.concat(l)},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}},g=(t.BlockCipher=l.extend({cfg:l.cfg.extend({mode:f,padding:m}),reset:function(){l.reset.call(this);var e=this.cfg,t=e.iv,i=e.mode;if(this._xformMode==this._ENC_XFORM_MODE)var a=i.createEncryptor;else{a=i.createDecryptor;this._minBufferSize=1}this._mode&&this._mode.__creator==a?this._mode.init(this,t&&t.words):(this._mode=a.call(i,this,t&&t.words),this._mode.__creator=a)},_doProcessBlock:function(e,t){this._mode.processBlock(e,t)},_doFinalize:function(){var e=this.cfg.padding;if(this._xformMode==this._ENC_XFORM_MODE){e.pad(this._data,this.blockSize);var t=this._process(!0)}else{t=this._process(!0);e.unpad(t)}return t},blockSize:4}),t.CipherParams=i.extend({init:function(e){this.mixIn(e)},toString:function(e){return(e||this.formatter).stringify(this)}})),h=(e.format={}).OpenSSL={stringify:function(e){var t=e.ciphertext,i=e.salt;if(i)var a=s.create([1398893684,1701076831]).concat(i).concat(t);else a=t;return a.toString(o)},parse:function(e){var t=o.parse(e),i=t.words;if(1398893684==i[0]&&1701076831==i[1]){var a=s.create(i.slice(2,4));i.splice(0,4),t.sigBytes-=16}return g.create({ciphertext:t,salt:a})}},x=t.SerializableCipher=i.extend({cfg:i.extend({format:h}),encrypt:function(e,t,i,a){a=this.cfg.extend(a);var n=e.createEncryptor(i,a),o=n.finalize(t),r=n.cfg;return g.create({ciphertext:o,key:i,iv:r.iv,algorithm:e,mode:r.mode,padding:r.padding,blockSize:e.blockSize,formatter:a.format})},decrypt:function(e,t,i,a){return a=this.cfg.extend(a),t=this._parse(t,a.format),e.createDecryptor(i,a).finalize(t.ciphertext)},_parse:function(e,t){return"string"==typeof e?t.parse(e,this):e}}),v=(e.kdf={}).OpenSSL={execute:function(e,t,i,a){a=a||s.random(8);var n=r.create({keySize:t+i}).compute(e,a),o=s.create(n.words.slice(t),4*i);return n.sigBytes=4*t,g.create({key:n,iv:o,salt:a})}},y=t.PasswordBasedCipher=x.extend({cfg:x.cfg.extend({kdf:v}),encrypt:function(e,t,i,a){var n=(a=this.cfg.extend(a)).kdf.execute(i,e.keySize,e.ivSize);a.iv=n.iv;var o=x.encrypt.call(this,e,t,n.key,a);return o.mixIn(n),o},decrypt:function(e,t,i,a){a=this.cfg.extend(a),t=this._parse(t,a.format);var n=a.kdf.execute(i,e.keySize,e.ivSize,t.salt);return a.iv=n.iv,x.decrypt.call(this,e,t,n.key,a)}})}(),Ue.mode.CFB=((Ee=Ue.lib.BlockCipherMode.extend()).Encryptor=Ee.extend({processBlock:function(e,t){var i=this._cipher,a=i.blockSize;Ge.call(this,e,t,a,i),this._prevBlock=e.slice(t,t+a)}}),Ee.Decryptor=Ee.extend({processBlock:function(e,t){var i=this._cipher,a=i.blockSize,n=e.slice(t,t+a);Ge.call(this,e,t,a,i),this._prevBlock=n}}),Ee),Ue.mode.ECB=((me=Ue.lib.BlockCipherMode.extend()).Encryptor=me.extend({processBlock:function(e,t){this._cipher.encryptBlock(e,t)}}),me.Decryptor=me.extend({processBlock:function(e,t){this._cipher.decryptBlock(e,t)}}),me),Ue.pad.AnsiX923={pad:function(e,t){var i=e.sigBytes,a=4*t,n=a-i%a,o=i+n-1;e.clamp(),e.words[o>>>2]|=n<<24-o%4*8,e.sigBytes+=n},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}},Ue.pad.Iso10126={pad:function(e,t){var i=4*t,a=i-e.sigBytes%i;e.concat(Ue.lib.WordArray.random(a-1)).concat(Ue.lib.WordArray.create([a<<24],1))},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}},Ue.pad.Iso97971={pad:function(e,t){e.concat(Ue.lib.WordArray.create([2147483648],1)),Ue.pad.ZeroPadding.pad(e,t)},unpad:function(e){Ue.pad.ZeroPadding.unpad(e),e.sigBytes--}},Ue.mode.OFB=(ge=Ue.lib.BlockCipherMode.extend(),he=ge.Encryptor=ge.extend({processBlock:function(e,t){var i=this._cipher,a=i.blockSize,n=this._iv,o=this._keystream;n&&(o=this._keystream=n.slice(0),this._iv=void 0),i.encryptBlock(o,0);for(var r=0;r<a;r++)e[t+r]^=o[r]}}),ge.Decryptor=he,ge),Ue.pad.NoPadding={pad:function(){},unpad:function(){}},ve=(xe=Ue).lib.CipherParams,ye=xe.enc.Hex,xe.format.Hex={stringify:function(e){return e.ciphertext.toString(ye)},parse:function(e){var t=ye.parse(e);return ve.create({ciphertext:t})}},function(){var e=Ue,t=e.lib.BlockCipher,i=e.algo,d=[],c=[],u=[],p=[],f=[],E=[],m=[],g=[],h=[],x=[];!function(){for(var e=[],t=0;t<256;t++)e[t]=t<128?t<<1:t<<1^283;var i=0,a=0;for(t=0;t<256;t++){var n=a^a<<1^a<<2^a<<3^a<<4;n=n>>>8^255&n^99,d[i]=n;var o=e[c[n]=i],r=e[o],l=e[r],s=257*e[n]^16843008*n;u[i]=s<<24|s>>>8,p[i]=s<<16|s>>>16,f[i]=s<<8|s>>>24,E[i]=s;s=16843009*l^65537*r^257*o^16843008*i;m[n]=s<<24|s>>>8,g[n]=s<<16|s>>>16,h[n]=s<<8|s>>>24,x[n]=s,i?(i=o^e[e[e[l^o]]],a^=e[e[a]]):i=a=1}}();var v=[0,1,2,4,8,16,32,64,128,27,54],a=i.AES=t.extend({_doReset:function(){if(!this._nRounds||this._keyPriorReset!==this._key){for(var e=this._keyPriorReset=this._key,t=e.words,i=e.sigBytes/4,a=4*(1+(this._nRounds=6+i)),n=this._keySchedule=[],o=0;o<a;o++)if(o<i)n[o]=t[o];else{var r=n[o-1];o%i?6<i&&o%i==4&&(r=d[r>>>24]<<24|d[r>>>16&255]<<16|d[r>>>8&255]<<8|d[255&r]):(r=d[(r=r<<8|r>>>24)>>>24]<<24|d[r>>>16&255]<<16|d[r>>>8&255]<<8|d[255&r],r^=v[o/i|0]<<24),n[o]=n[o-i]^r}for(var l=this._invKeySchedule=[],s=0;s<a;s++){o=a-s;if(s%4)r=n[o];else r=n[o-4];l[s]=s<4||o<=4?r:m[d[r>>>24]]^g[d[r>>>16&255]]^h[d[r>>>8&255]]^x[d[255&r]]}}},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._keySchedule,u,p,f,E,d)},decryptBlock:function(e,t){var i=e[t+1];e[t+1]=e[t+3],e[t+3]=i,this._doCryptBlock(e,t,this._invKeySchedule,m,g,h,x,c);i=e[t+1];e[t+1]=e[t+3],e[t+3]=i},_doCryptBlock:function(e,t,i,a,n,o,r,l){for(var s=this._nRounds,d=e[t]^i[0],c=e[t+1]^i[1],u=e[t+2]^i[2],p=e[t+3]^i[3],f=4,E=1;E<s;E++){var m=a[d>>>24]^n[c>>>16&255]^o[u>>>8&255]^r[255&p]^i[f++],g=a[c>>>24]^n[u>>>16&255]^o[p>>>8&255]^r[255&d]^i[f++],h=a[u>>>24]^n[p>>>16&255]^o[d>>>8&255]^r[255&c]^i[f++],x=a[p>>>24]^n[d>>>16&255]^o[c>>>8&255]^r[255&u]^i[f++];d=m,c=g,u=h,p=x}m=(l[d>>>24]<<24|l[c>>>16&255]<<16|l[u>>>8&255]<<8|l[255&p])^i[f++],g=(l[c>>>24]<<24|l[u>>>16&255]<<16|l[p>>>8&255]<<8|l[255&d])^i[f++],h=(l[u>>>24]<<24|l[p>>>16&255]<<16|l[d>>>8&255]<<8|l[255&c])^i[f++],x=(l[p>>>24]<<24|l[d>>>16&255]<<16|l[c>>>8&255]<<8|l[255&u])^i[f++];e[t]=m,e[t+1]=g,e[t+2]=h,e[t+3]=x},keySize:8});e.AES=t._createHelper(a)}(),function(){var e=Ue,t=e.lib,i=t.WordArray,a=t.BlockCipher,n=e.algo,d=[57,49,41,33,25,17,9,1,58,50,42,34,26,18,10,2,59,51,43,35,27,19,11,3,60,52,44,36,63,55,47,39,31,23,15,7,62,54,46,38,30,22,14,6,61,53,45,37,29,21,13,5,28,20,12,4],c=[14,17,11,24,1,5,3,28,15,6,21,10,23,19,12,4,26,8,16,7,27,20,13,2,41,52,31,37,47,55,30,40,51,45,33,48,44,49,39,56,34,53,46,42,50,36,29,32],u=[1,2,4,6,8,10,12,14,15,17,19,21,23,25,27,28],p=[{0:8421888,268435456:32768,536870912:8421378,805306368:2,1073741824:512,1342177280:8421890,1610612736:8389122,1879048192:8388608,2147483648:514,2415919104:8389120,2684354560:33280,2952790016:8421376,3221225472:32770,3489660928:8388610,3758096384:0,4026531840:33282,134217728:0,402653184:8421890,671088640:33282,939524096:32768,1207959552:8421888,1476395008:512,1744830464:8421378,2013265920:2,2281701376:8389120,2550136832:33280,2818572288:8421376,3087007744:8389122,3355443200:8388610,3623878656:32770,3892314112:514,4160749568:8388608,1:32768,268435457:2,536870913:8421888,805306369:8388608,1073741825:8421378,1342177281:33280,1610612737:512,1879048193:8389122,2147483649:8421890,2415919105:8421376,2684354561:8388610,2952790017:33282,3221225473:514,3489660929:8389120,3758096385:32770,4026531841:0,134217729:8421890,402653185:8421376,671088641:8388608,939524097:512,1207959553:32768,1476395009:8388610,1744830465:2,2013265921:33282,2281701377:32770,2550136833:8389122,2818572289:514,3087007745:8421888,3355443201:8389120,3623878657:0,3892314113:33280,4160749569:8421378},{0:1074282512,16777216:16384,33554432:524288,50331648:1074266128,67108864:1073741840,83886080:1074282496,100663296:1073758208,117440512:16,134217728:540672,150994944:1073758224,167772160:1073741824,184549376:540688,201326592:524304,218103808:0,234881024:16400,251658240:1074266112,8388608:1073758208,25165824:540688,41943040:16,58720256:1073758224,75497472:1074282512,92274688:1073741824,109051904:524288,125829120:1074266128,142606336:524304,159383552:0,176160768:16384,192937984:1074266112,209715200:1073741840,226492416:540672,243269632:1074282496,260046848:16400,268435456:0,285212672:1074266128,301989888:1073758224,318767104:1074282496,335544320:1074266112,352321536:16,369098752:540688,385875968:16384,402653184:16400,419430400:524288,436207616:524304,452984832:1073741840,469762048:540672,486539264:1073758208,503316480:1073741824,520093696:1074282512,276824064:540688,293601280:524288,310378496:1074266112,327155712:16384,343932928:1073758208,360710144:1074282512,377487360:16,394264576:1073741824,411041792:1074282496,427819008:1073741840,444596224:1073758224,461373440:524304,478150656:0,494927872:16400,511705088:1074266128,528482304:540672},{0:260,1048576:0,2097152:67109120,3145728:65796,4194304:65540,5242880:67108868,6291456:67174660,7340032:67174400,8388608:67108864,9437184:67174656,10485760:65792,11534336:67174404,12582912:67109124,13631488:65536,14680064:4,15728640:256,524288:67174656,1572864:67174404,2621440:0,3670016:67109120,4718592:67108868,5767168:65536,6815744:65540,7864320:260,8912896:4,9961472:256,11010048:67174400,12058624:65796,13107200:65792,14155776:67109124,15204352:67174660,16252928:67108864,16777216:67174656,17825792:65540,18874368:65536,19922944:67109120,20971520:256,22020096:67174660,23068672:67108868,24117248:0,25165824:67109124,26214400:67108864,27262976:4,28311552:65792,29360128:67174400,30408704:260,31457280:65796,32505856:67174404,17301504:67108864,18350080:260,19398656:67174656,20447232:0,21495808:65540,22544384:67109120,23592960:256,24641536:67174404,25690112:65536,26738688:67174660,27787264:65796,28835840:67108868,29884416:67109124,30932992:67174400,31981568:4,33030144:65792},{0:2151682048,65536:2147487808,131072:4198464,196608:2151677952,262144:0,327680:4198400,393216:2147483712,458752:4194368,524288:2147483648,589824:4194304,655360:64,720896:2147487744,786432:2151678016,851968:4160,917504:4096,983040:2151682112,32768:2147487808,98304:64,163840:2151678016,229376:2147487744,294912:4198400,360448:2151682112,425984:0,491520:2151677952,557056:4096,622592:2151682048,688128:4194304,753664:4160,819200:2147483648,884736:4194368,950272:4198464,1015808:2147483712,1048576:4194368,1114112:4198400,1179648:2147483712,1245184:0,1310720:4160,1376256:2151678016,1441792:2151682048,1507328:2147487808,1572864:2151682112,1638400:2147483648,1703936:2151677952,1769472:4198464,1835008:2147487744,1900544:4194304,1966080:64,2031616:4096,1081344:2151677952,1146880:2151682112,1212416:0,1277952:4198400,1343488:4194368,1409024:2147483648,1474560:2147487808,1540096:64,1605632:2147483712,1671168:4096,1736704:2147487744,1802240:2151678016,1867776:4160,1933312:2151682048,1998848:4194304,2064384:4198464},{0:128,4096:17039360,8192:262144,12288:536870912,16384:537133184,20480:16777344,24576:553648256,28672:262272,32768:16777216,36864:537133056,40960:536871040,45056:553910400,49152:553910272,53248:0,57344:17039488,61440:553648128,2048:17039488,6144:553648256,10240:128,14336:17039360,18432:262144,22528:537133184,26624:553910272,30720:536870912,34816:537133056,38912:0,43008:553910400,47104:16777344,51200:536871040,55296:553648128,59392:16777216,63488:262272,65536:262144,69632:128,73728:536870912,77824:553648256,81920:16777344,86016:553910272,90112:537133184,94208:16777216,98304:553910400,102400:553648128,106496:17039360,110592:537133056,114688:262272,118784:536871040,122880:0,126976:17039488,67584:553648256,71680:16777216,75776:17039360,79872:537133184,83968:536870912,88064:17039488,92160:128,96256:553910272,100352:262272,104448:553910400,108544:0,112640:553648128,116736:16777344,120832:262144,124928:537133056,129024:536871040},{0:268435464,256:8192,512:270532608,768:270540808,1024:268443648,1280:2097152,1536:2097160,1792:268435456,2048:0,2304:268443656,2560:2105344,2816:8,3072:270532616,3328:2105352,3584:8200,3840:270540800,128:270532608,384:270540808,640:8,896:2097152,1152:2105352,1408:268435464,1664:268443648,1920:8200,2176:2097160,2432:8192,2688:268443656,2944:270532616,3200:0,3456:270540800,3712:2105344,3968:268435456,4096:268443648,4352:270532616,4608:270540808,4864:8200,5120:2097152,5376:268435456,5632:268435464,5888:2105344,6144:2105352,6400:0,6656:8,6912:270532608,7168:8192,7424:268443656,7680:270540800,7936:2097160,4224:8,4480:2105344,4736:2097152,4992:268435464,5248:268443648,5504:8200,5760:270540808,6016:270532608,6272:270540800,6528:270532616,6784:8192,7040:2105352,7296:2097160,7552:0,7808:268435456,8064:268443656},{0:1048576,16:33555457,32:1024,48:1049601,64:34604033,80:0,96:1,112:34603009,128:33555456,144:1048577,160:33554433,176:34604032,192:34603008,208:1025,224:1049600,240:33554432,8:34603009,24:0,40:33555457,56:34604032,72:1048576,88:33554433,104:33554432,120:1025,136:1049601,152:33555456,168:34603008,184:1048577,200:1024,216:34604033,232:1,248:1049600,256:33554432,272:1048576,288:33555457,304:34603009,320:1048577,336:33555456,352:34604032,368:1049601,384:1025,400:34604033,416:1049600,432:1,448:0,464:34603008,480:33554433,496:1024,264:1049600,280:33555457,296:34603009,312:1,328:33554432,344:1048576,360:1025,376:34604032,392:33554433,408:34603008,424:0,440:34604033,456:1049601,472:1024,488:33555456,504:1048577},{0:134219808,1:131072,2:134217728,3:32,4:131104,5:134350880,6:134350848,7:2048,8:134348800,9:134219776,10:133120,11:134348832,12:2080,13:0,14:134217760,15:133152,2147483648:2048,2147483649:134350880,2147483650:134219808,2147483651:134217728,2147483652:134348800,2147483653:133120,2147483654:133152,2147483655:32,2147483656:134217760,2147483657:2080,2147483658:131104,2147483659:134350848,2147483660:0,2147483661:134348832,2147483662:134219776,2147483663:131072,16:133152,17:134350848,18:32,19:2048,20:134219776,21:134217760,22:134348832,23:131072,24:0,25:131104,26:134348800,27:134219808,28:134350880,29:133120,30:2080,31:134217728,2147483664:131072,2147483665:2048,2147483666:134348832,2147483667:133152,2147483668:32,2147483669:134348800,2147483670:134217728,2147483671:134219808,2147483672:134350880,2147483673:134217760,2147483674:134219776,2147483675:0,2147483676:133120,2147483677:2080,2147483678:131104,2147483679:134350848}],f=[4160749569,528482304,33030144,2064384,129024,8064,504,2147483679],o=n.DES=a.extend({_doReset:function(){for(var e=this._key.words,t=[],i=0;i<56;i++){var a=d[i]-1;t[i]=e[a>>>5]>>>31-a%32&1}for(var n=this._subKeys=[],o=0;o<16;o++){var r=n[o]=[],l=u[o];for(i=0;i<24;i++)r[i/6|0]|=t[(c[i]-1+l)%28]<<31-i%6,r[4+(i/6|0)]|=t[28+(c[i+24]-1+l)%28]<<31-i%6;r[0]=r[0]<<1|r[0]>>>31;for(i=1;i<7;i++)r[i]=r[i]>>>4*(i-1)+3;r[7]=r[7]<<5|r[7]>>>27}var s=this._invSubKeys=[];for(i=0;i<16;i++)s[i]=n[15-i]},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._subKeys)},decryptBlock:function(e,t){this._doCryptBlock(e,t,this._invSubKeys)},_doCryptBlock:function(e,t,i){this._lBlock=e[t],this._rBlock=e[t+1],E.call(this,4,252645135),E.call(this,16,65535),m.call(this,2,858993459),m.call(this,8,16711935),E.call(this,1,1431655765);for(var a=0;a<16;a++){for(var n=i[a],o=this._lBlock,r=this._rBlock,l=0,s=0;s<8;s++)l|=p[s][((r^n[s])&f[s])>>>0];this._lBlock=r,this._rBlock=o^l}var d=this._lBlock;this._lBlock=this._rBlock,this._rBlock=d,E.call(this,1,1431655765),m.call(this,8,16711935),m.call(this,2,858993459),E.call(this,16,65535),E.call(this,4,252645135),e[t]=this._lBlock,e[t+1]=this._rBlock},keySize:2,ivSize:2,blockSize:2});function E(e,t){var i=(this._lBlock>>>e^this._rBlock)&t;this._rBlock^=i,this._lBlock^=i<<e}function m(e,t){var i=(this._rBlock>>>e^this._lBlock)&t;this._lBlock^=i,this._rBlock^=i<<e}e.DES=a._createHelper(o);var r=n.TripleDES=a.extend({_doReset:function(){var e=this._key.words;this._des1=o.createEncryptor(i.create(e.slice(0,2))),this._des2=o.createEncryptor(i.create(e.slice(2,4))),this._des3=o.createEncryptor(i.create(e.slice(4,6)))},encryptBlock:function(e,t){this._des1.encryptBlock(e,t),this._des2.decryptBlock(e,t),this._des3.encryptBlock(e,t)},decryptBlock:function(e,t){this._des3.decryptBlock(e,t),this._des2.encryptBlock(e,t),this._des1.decryptBlock(e,t)},keySize:6,ivSize:2,blockSize:2});e.TripleDES=a._createHelper(r)}(),function(){var e=Ue,t=e.lib.StreamCipher,i=e.algo,a=i.RC4=t.extend({_doReset:function(){for(var e=this._key,t=e.words,i=e.sigBytes,a=this._S=[],n=0;n<256;n++)a[n]=n;n=0;for(var o=0;n<256;n++){var r=n%i,l=t[r>>>2]>>>24-r%4*8&255;o=(o+a[n]+l)%256;var s=a[n];a[n]=a[o],a[o]=s}this._i=this._j=0},_doProcessBlock:function(e,t){e[t]^=n.call(this)},keySize:8,ivSize:0});function n(){for(var e=this._S,t=this._i,i=this._j,a=0,n=0;n<4;n++){i=(i+e[t=(t+1)%256])%256;var o=e[t];e[t]=e[i],e[i]=o,a|=e[(e[t]+e[i])%256]<<24-8*n}return this._i=t,this._j=i,a}e.RC4=t._createHelper(a);var o=i.RC4Drop=a.extend({cfg:a.cfg.extend({drop:192}),_doReset:function(){a._doReset.call(this);for(var e=this.cfg.drop;0<e;e--)n.call(this)}});e.RC4Drop=t._createHelper(o)}(),Ue.mode.CTRGladman=(be=Ue.lib.BlockCipherMode.extend(),Ce=be.Encryptor=be.extend({processBlock:function(e,t){var i=this._cipher,a=i.blockSize,n=this._iv,o=this._counter;n&&(o=this._counter=n.slice(0),this._iv=void 0),function(e){0===(e[0]=Xe(e[0]))&&(e[1]=Xe(e[1]))}(o);var r=o.slice(0);i.encryptBlock(r,0);for(var l=0;l<a;l++)e[t+l]^=r[l]}}),be.Decryptor=Ce,be),Se=(we=Ue).lib.StreamCipher,Ie=we.algo,Te=[],_e=[],Je=[],De=Ie.Rabbit=Se.extend({_doReset:function(){for(var e=this._key.words,t=this.cfg.iv,i=0;i<4;i++)e[i]=16711935&(e[i]<<8|e[i]>>>24)|4278255360&(e[i]<<24|e[i]>>>8);var a=this._X=[e[0],e[3]<<16|e[2]>>>16,e[1],e[0]<<16|e[3]>>>16,e[2],e[1]<<16|e[0]>>>16,e[3],e[2]<<16|e[1]>>>16],n=this._C=[e[2]<<16|e[2]>>>16,4294901760&e[0]|65535&e[1],e[3]<<16|e[3]>>>16,4294901760&e[1]|65535&e[2],e[0]<<16|e[0]>>>16,4294901760&e[2]|65535&e[3],e[1]<<16|e[1]>>>16,4294901760&e[3]|65535&e[0]];for(i=this._b=0;i<4;i++)Ke.call(this);for(i=0;i<8;i++)n[i]^=a[i+4&7];if(t){var o=t.words,r=o[0],l=o[1],s=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8),d=16711935&(l<<8|l>>>24)|4278255360&(l<<24|l>>>8),c=s>>>16|4294901760&d,u=d<<16|65535&s;n[0]^=s,n[1]^=c,n[2]^=d,n[3]^=u,n[4]^=s,n[5]^=c,n[6]^=d,n[7]^=u;for(i=0;i<4;i++)Ke.call(this)}},_doProcessBlock:function(e,t){var i=this._X;Ke.call(this),Te[0]=i[0]^i[5]>>>16^i[3]<<16,Te[1]=i[2]^i[7]>>>16^i[5]<<16,Te[2]=i[4]^i[1]>>>16^i[7]<<16,Te[3]=i[6]^i[3]>>>16^i[1]<<16;for(var a=0;a<4;a++)Te[a]=16711935&(Te[a]<<8|Te[a]>>>24)|4278255360&(Te[a]<<24|Te[a]>>>8),e[t+a]^=Te[a]},blockSize:4,ivSize:2}),we.Rabbit=Se._createHelper(De),Ue.mode.CTR=(Ae=Ue.lib.BlockCipherMode.extend(),Ne=Ae.Encryptor=Ae.extend({processBlock:function(e,t){var i=this._cipher,a=i.blockSize,n=this._iv,o=this._counter;n&&(o=this._counter=n.slice(0),this._iv=void 0);var r=o.slice(0);i.encryptBlock(r,0),o[a-1]=o[a-1]+1|0;for(var l=0;l<a;l++)e[t+l]^=r[l]}}),Ae.Decryptor=Ne,Ae),Re=(Oe=Ue).lib.StreamCipher,Le=Oe.algo,Pe=[],Me=[],Fe=[],ke=Le.RabbitLegacy=Re.extend({_doReset:function(){for(var e=this._key.words,t=this.cfg.iv,i=this._X=[e[0],e[3]<<16|e[2]>>>16,e[1],e[0]<<16|e[3]>>>16,e[2],e[1]<<16|e[0]>>>16,e[3],e[2]<<16|e[1]>>>16],a=this._C=[e[2]<<16|e[2]>>>16,4294901760&e[0]|65535&e[1],e[3]<<16|e[3]>>>16,4294901760&e[1]|65535&e[2],e[0]<<16|e[0]>>>16,4294901760&e[2]|65535&e[3],e[1]<<16|e[1]>>>16,4294901760&e[3]|65535&e[0]],n=this._b=0;n<4;n++)ze.call(this);for(n=0;n<8;n++)a[n]^=i[n+4&7];if(t){var o=t.words,r=o[0],l=o[1],s=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8),d=16711935&(l<<8|l>>>24)|4278255360&(l<<24|l>>>8),c=s>>>16|4294901760&d,u=d<<16|65535&s;a[0]^=s,a[1]^=c,a[2]^=d,a[3]^=u,a[4]^=s,a[5]^=c,a[6]^=d,a[7]^=u;for(n=0;n<4;n++)ze.call(this)}},_doProcessBlock:function(e,t){var i=this._X;ze.call(this),Pe[0]=i[0]^i[5]>>>16^i[3]<<16,Pe[1]=i[2]^i[7]>>>16^i[5]<<16,Pe[2]=i[4]^i[1]>>>16^i[7]<<16,Pe[3]=i[6]^i[3]>>>16^i[1]<<16;for(var a=0;a<4;a++)Pe[a]=16711935&(Pe[a]<<8|Pe[a]>>>24)|4278255360&(Pe[a]<<24|Pe[a]>>>8),e[t+a]^=Pe[a]},blockSize:4,ivSize:2}),Oe.RabbitLegacy=Re._createHelper(ke),Ue.pad.ZeroPadding={pad:function(e,t){var i=4*t;e.clamp(),e.sigBytes+=i-(e.sigBytes%i||i)},unpad:function(e){for(var t=e.words,i=e.sigBytes-1;!(t[i>>>2]>>>24-i%4*8&255);)i--;e.sigBytes=i+1}},Ue}),function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.JSEncrypt={})}(this,function(e){"use strict";var t="0123456789abcdefghijklmnopqrstuvwxyz";function s(e){return t.charAt(e)}function i(e,t){return e&t}function d(e,t){return e|t}function a(e,t){return e^t}function n(e,t){return e&~t}function o(e){if(0==e)return-1;var t=0;return 0==(65535&e)&&(e>>=16,t+=16),0==(255&e)&&(e>>=8,t+=8),0==(15&e)&&(e>>=4,t+=4),0==(3&e)&&(e>>=2,t+=2),0==(1&e)&&++t,t}function r(e){for(var t=0;0!=e;)e&=e-1,++t;return t}var l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";function c(e){var t,i,a="";for(t=0;t+3<=e.length;t+=3)i=parseInt(e.substring(t,t+3),16),a+=l.charAt(i>>6)+l.charAt(63&i);for(t+1==e.length?(i=parseInt(e.substring(t,t+1),16),a+=l.charAt(i<<2)):t+2==e.length&&(i=parseInt(e.substring(t,t+2),16),a+=l.charAt(i>>2)+l.charAt((3&i)<<4));0<(3&a.length);)a+="=";return a}function u(e){var t,i="",a=0,n=0;for(t=0;t<e.length&&"="!=e.charAt(t);++t){var o=l.indexOf(e.charAt(t));o<0||(a=0==a?(i+=s(o>>2),n=3&o,1):1==a?(i+=s(n<<2|o>>4),n=15&o,2):2==a?(i+=s(n),i+=s(o>>2),n=3&o,3):(i+=s(n<<2|o>>4),i+=s(15&o),0))}return 1==a&&(i+=s(n<<2)),i}var p,f,E=function(e,t){return(E=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},m={decode:function(e){var t;if(void 0===f){var i="= \f\n\r\t \u2028\u2029";for(f=Object.create(null),t=0;t<64;++t)f["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(t)]=t;for(t=0;t<i.length;++t)f[i.charAt(t)]=-1}var a=[],n=0,o=0;for(t=0;t<e.length;++t){var r=e.charAt(t);if("="==r)break;if(-1!=(r=f[r])){if(void 0===r)throw new Error("Illegal character at offset "+t);n|=r,4<=++o?(a[a.length]=n>>16,a[a.length]=n>>8&255,a[a.length]=255&n,o=n=0):n<<=6}}switch(o){case 1:throw new Error("Base64 encoding incomplete: at least 2 bits missing");case 2:a[a.length]=n>>10;break;case 3:a[a.length]=n>>16,a[a.length]=n>>8&255}return a},re:/-----BEGIN [^-]+-----([A-Za-z0-9+\/=\s]+)-----END [^-]+-----|begin-base64[^\n]+\n([A-Za-z0-9+\/=\s]+)====/,unarmor:function(e){var t=m.re.exec(e);if(t)if(t[1])e=t[1];else{if(!t[2])throw new Error("RegExp out of sync");e=t[2]}return m.decode(e)}},g=(y.prototype.mulAdd=function(e,t){var i,a,n=this.buf,o=n.length;for(i=0;i<o;++i)(a=n[i]*e+t)<1e13?t=0:a-=1e13*(t=0|a/1e13),n[i]=a;0<t&&(n[i]=t)},y.prototype.sub=function(e){var t,i,a=this.buf,n=a.length;for(t=0;t<n;++t)e=(i=a[t]-e)<0?(i+=1e13,1):0,a[t]=i;for(;0===a[a.length-1];)a.pop()},y.prototype.toString=function(e){if(10!=(e||10))throw new Error("only base 10 is supported");for(var t=this.buf,i=t[t.length-1].toString(),a=t.length-2;0<=a;--a)i+=(1e13+t[a]).toString().substring(1);return i},y.prototype.valueOf=function(){for(var e=this.buf,t=0,i=e.length-1;0<=i;--i)t=1e13*t+e[i];return t},y.prototype.simplify=function(){var e=this.buf;return 1==e.length?e[0]:this},y),h="…",x=/^(\d\d)(0[1-9]|1[0-2])(0[1-9]|[12]\d|3[01])([01]\d|2[0-3])(?:([0-5]\d)(?:([0-5]\d)(?:[.,](\d{1,3}))?)?)?(Z|[-+](?:[0]\d|1[0-2])([0-5]\d)?)?$/,v=/^(\d\d\d\d)(0[1-9]|1[0-2])(0[1-9]|[12]\d|3[01])([01]\d|2[0-3])(?:([0-5]\d)(?:([0-5]\d)(?:[.,](\d{1,3}))?)?)?(Z|[-+](?:[0]\d|1[0-2])([0-5]\d)?)?$/;function y(e){this.buf=[+e||0]}function b(e,t){return e.length>t&&(e=e.substring(0,t)+h),e}var C,w=(j.prototype.get=function(e){if(void 0===e&&(e=this.pos++),e>=this.enc.length)throw new Error("Requesting byte offset "+e+" on a stream of length "+this.enc.length);return"string"==typeof this.enc?this.enc.charCodeAt(e):this.enc[e]},j.prototype.hexByte=function(e){return this.hexDigits.charAt(e>>4&15)+this.hexDigits.charAt(15&e)},j.prototype.hexDump=function(e,t,i){for(var a="",n=e;n<t;++n)if(a+=this.hexByte(this.get(n)),!0!==i)switch(15&n){case 7:a+="  ";break;case 15:a+="\n";break;default:a+=" "}return a},j.prototype.isASCII=function(e,t){for(var i=e;i<t;++i){var a=this.get(i);if(a<32||176<a)return!1}return!0},j.prototype.parseStringISO=function(e,t){for(var i="",a=e;a<t;++a)i+=String.fromCharCode(this.get(a));return i},j.prototype.parseStringUTF=function(e,t){for(var i="",a=e;a<t;){var n=this.get(a++);i+=n<128?String.fromCharCode(n):191<n&&n<224?String.fromCharCode((31&n)<<6|63&this.get(a++)):String.fromCharCode((15&n)<<12|(63&this.get(a++))<<6|63&this.get(a++))}return i},j.prototype.parseStringBMP=function(e,t){for(var i,a,n="",o=e;o<t;)i=this.get(o++),a=this.get(o++),n+=String.fromCharCode(i<<8|a);return n},j.prototype.parseTime=function(e,t,i){var a=this.parseStringISO(e,t),n=(i?x:v).exec(a);return n?(i&&(n[1]=+n[1],n[1]+=+n[1]<70?2e3:1900),a=n[1]+"-"+n[2]+"-"+n[3]+" "+n[4],n[5]&&(a+=":"+n[5],n[6]&&(a+=":"+n[6],n[7]&&(a+="."+n[7]))),n[8]&&(a+=" UTC","Z"!=n[8]&&(a+=n[8],n[9]&&(a+=":"+n[9]))),a):"Unrecognized time: "+a},j.prototype.parseInteger=function(e,t){for(var i,a=this.get(e),n=127<a,o=n?255:0,r="";a==o&&++e<t;)a=this.get(e);if(0==(i=t-e))return n?-1:0;if(4<i){for(r=a,i<<=3;0==(128&(+r^o));)r=+r<<1,--i;r="("+i+" bit)\n"}n&&(a-=256);for(var l=new g(a),s=e+1;s<t;++s)l.mulAdd(256,this.get(s));return r+l.toString()},j.prototype.parseBitString=function(e,t,i){for(var a=this.get(e),n="("+((t-e-1<<3)-a)+" bit)\n",o="",r=e+1;r<t;++r){for(var l=this.get(r),s=r==t-1?a:0,d=7;s<=d;--d)o+=l>>d&1?"1":"0";if(o.length>i)return n+b(o,i)}return n+o},j.prototype.parseOctetString=function(e,t,i){if(this.isASCII(e,t))return b(this.parseStringISO(e,t),i);var a=t-e,n="("+a+" byte)\n";(i/=2)<a&&(t=e+i);for(var o=e;o<t;++o)n+=this.hexByte(this.get(o));return i<a&&(n+=h),n},j.prototype.parseOID=function(e,t,i){for(var a="",n=new g,o=0,r=e;r<t;++r){var l=this.get(r);if(n.mulAdd(128,127&l),o+=7,!(128&l)){if(""===a)if((n=n.simplify())instanceof g)n.sub(80),a="2."+n.toString();else{var s=n<80?n<40?0:1:2;a=s+"."+(n-40*s)}else a+="."+n.toString();if(a.length>i)return b(a,i);n=new g,o=0}}return 0<o&&(a+=".incomplete"),a},j),S=(U.prototype.typeName=function(){switch(this.tag.tagClass){case 0:switch(this.tag.tagNumber){case 0:return"EOC";case 1:return"BOOLEAN";case 2:return"INTEGER";case 3:return"BIT_STRING";case 4:return"OCTET_STRING";case 5:return"NULL";case 6:return"OBJECT_IDENTIFIER";case 7:return"ObjectDescriptor";case 8:return"EXTERNAL";case 9:return"REAL";case 10:return"ENUMERATED";case 11:return"EMBEDDED_PDV";case 12:return"UTF8String";case 16:return"SEQUENCE";case 17:return"SET";case 18:return"NumericString";case 19:return"PrintableString";case 20:return"TeletexString";case 21:return"VideotexString";case 22:return"IA5String";case 23:return"UTCTime";case 24:return"GeneralizedTime";case 25:return"GraphicString";case 26:return"VisibleString";case 27:return"GeneralString";case 28:return"UniversalString";case 30:return"BMPString"}return"Universal_"+this.tag.tagNumber.toString();case 1:return"Application_"+this.tag.tagNumber.toString();case 2:return"["+this.tag.tagNumber.toString()+"]";case 3:return"Private_"+this.tag.tagNumber.toString()}},U.prototype.content=function(e){if(void 0===this.tag)return null;void 0===e&&(e=1/0);var t=this.posContent(),i=Math.abs(this.length);if(!this.tag.isUniversal())return null!==this.sub?"("+this.sub.length+" elem)":this.stream.parseOctetString(t,t+i,e);switch(this.tag.tagNumber){case 1:return 0===this.stream.get(t)?"false":"true";case 2:return this.stream.parseInteger(t,t+i);case 3:return this.sub?"("+this.sub.length+" elem)":this.stream.parseBitString(t,t+i,e);case 4:return this.sub?"("+this.sub.length+" elem)":this.stream.parseOctetString(t,t+i,e);case 6:return this.stream.parseOID(t,t+i,e);case 16:case 17:return null!==this.sub?"("+this.sub.length+" elem)":"(no elem)";case 12:return b(this.stream.parseStringUTF(t,t+i),e);case 18:case 19:case 20:case 21:case 22:case 26:return b(this.stream.parseStringISO(t,t+i),e);case 30:return b(this.stream.parseStringBMP(t,t+i),e);case 23:case 24:return this.stream.parseTime(t,t+i,23==this.tag.tagNumber)}return null},U.prototype.toString=function(){return this.typeName()+"@"+this.stream.pos+"[header:"+this.header+",length:"+this.length+",sub:"+(null===this.sub?"null":this.sub.length)+"]"},U.prototype.toPrettyString=function(e){void 0===e&&(e="");var t=e+this.typeName()+" @"+this.stream.pos;if(0<=this.length&&(t+="+"),t+=this.length,this.tag.tagConstructed?t+=" (constructed)":!this.tag.isUniversal()||3!=this.tag.tagNumber&&4!=this.tag.tagNumber||null===this.sub||(t+=" (encapsulates)"),t+="\n",null!==this.sub){e+="  ";for(var i=0,a=this.sub.length;i<a;++i)t+=this.sub[i].toPrettyString(e)}return t},U.prototype.posStart=function(){return this.stream.pos},U.prototype.posContent=function(){return this.stream.pos+this.header},U.prototype.posEnd=function(){return this.stream.pos+this.header+Math.abs(this.length)},U.prototype.toHexString=function(){return this.stream.hexDump(this.posStart(),this.posEnd(),!0)},U.decodeLength=function(e){var t=e.get(),i=127&t;if(i==t)return i;if(6<i)throw new Error("Length over 48 bits not supported at position "+(e.pos-1));if(0==i)return null;for(var a=t=0;a<i;++a)t=256*t+e.get();return t},U.prototype.getHexStringValue=function(){var e=this.toHexString(),t=2*this.header,i=2*this.length;return e.substr(t,i)},U.decode=function(e){var a;function t(){var e=[];if(null!==o){for(var t=r+o;a.pos<t;)e[e.length]=U.decode(a);if(a.pos!=t)throw new Error("Content size is not correct for container starting at offset "+r)}else try{for(;;){var i=U.decode(a);if(i.tag.isEOC())break;e[e.length]=i}o=r-a.pos}catch(e){throw new Error("Exception while decoding undefined length content: "+e)}return e}a=e instanceof w?e:new w(e,0);var i=new w(a),n=new I(a),o=U.decodeLength(a),r=a.pos,l=r-i.pos,s=null;if(n.tagConstructed)s=t();else if(n.isUniversal()&&(3==n.tagNumber||4==n.tagNumber))try{if(3==n.tagNumber&&0!=a.get())throw new Error("BIT STRINGs with unused bits cannot encapsulate.");s=t();for(var d=0;d<s.length;++d)if(s[d].tag.isEOC())throw new Error("EOC is not supposed to be actual content.")}catch(e){s=null}if(null===s){if(null===o)throw new Error("We can't skip over an invalid tag with undefined length at offset "+r);a.pos=r+Math.abs(o)}return new U(i,l,o,n,s)},U),I=(k.prototype.isUniversal=function(){return 0===this.tagClass},k.prototype.isEOC=function(){return 0===this.tagClass&&0===this.tagNumber},k),T=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997],_=(1<<26)/T[T.length-1],J=(F.prototype.toString=function(e){if(this.s<0)return"-"+this.negate().toString(e);var t;if(16==e)t=4;else if(8==e)t=3;else if(2==e)t=1;else if(32==e)t=5;else{if(4!=e)return this.toRadix(e);t=2}var i,a=(1<<t)-1,n=!1,o="",r=this.t,l=this.DB-r*this.DB%t;if(0<r--)for(l<this.DB&&0<(i=this[r]>>l)&&(n=!0,o=s(i));0<=r;)l<t?(i=(this[r]&(1<<l)-1)<<t-l,i|=this[--r]>>(l+=this.DB-t)):(i=this[r]>>(l-=t)&a,l<=0&&(l+=this.DB,--r)),0<i&&(n=!0),n&&(o+=s(i));return n?o:"0"},F.prototype.negate=function(){var e=B();return F.ZERO.subTo(this,e),e},F.prototype.abs=function(){return this.s<0?this.negate():this},F.prototype.compareTo=function(e){var t=this.s-e.s;if(0!=t)return t;var i=this.t;if(0!=(t=i-e.t))return this.s<0?-t:t;for(;0<=--i;)if(0!=(t=this[i]-e[i]))return t;return 0},F.prototype.bitLength=function(){return this.t<=0?0:this.DB*(this.t-1)+X(this[this.t-1]^this.s&this.DM)},F.prototype.mod=function(e){var t=B();return this.abs().divRemTo(e,null,t),this.s<0&&0<t.compareTo(F.ZERO)&&e.subTo(t,t),t},F.prototype.modPowInt=function(e,t){var i;return i=e<256||t.isEven()?new A(t):new N(t),this.exp(e,i)},F.prototype.clone=function(){var e=B();return this.copyTo(e),e},F.prototype.intValue=function(){if(this.s<0){if(1==this.t)return this[0]-this.DV;if(0==this.t)return-1}else{if(1==this.t)return this[0];if(0==this.t)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]},F.prototype.byteValue=function(){return 0==this.t?this.s:this[0]<<24>>24},F.prototype.shortValue=function(){return 0==this.t?this.s:this[0]<<16>>16},F.prototype.signum=function(){return this.s<0?-1:this.t<=0||1==this.t&&this[0]<=0?0:1},F.prototype.toByteArray=function(){var e=this.t,t=[];t[0]=this.s;var i,a=this.DB-e*this.DB%8,n=0;if(0<e--)for(a<this.DB&&(i=this[e]>>a)!=(this.s&this.DM)>>a&&(t[n++]=i|this.s<<this.DB-a);0<=e;)a<8?(i=(this[e]&(1<<a)-1)<<8-a,i|=this[--e]>>(a+=this.DB-8)):(i=this[e]>>(a-=8)&255,a<=0&&(a+=this.DB,--e)),0!=(128&i)&&(i|=-256),0==n&&(128&this.s)!=(128&i)&&++n,(0<n||i!=this.s)&&(t[n++]=i);return t},F.prototype.equals=function(e){return 0==this.compareTo(e)},F.prototype.min=function(e){return this.compareTo(e)<0?this:e},F.prototype.max=function(e){return 0<this.compareTo(e)?this:e},F.prototype.and=function(e){var t=B();return this.bitwiseTo(e,i,t),t},F.prototype.or=function(e){var t=B();return this.bitwiseTo(e,d,t),t},F.prototype.xor=function(e){var t=B();return this.bitwiseTo(e,a,t),t},F.prototype.andNot=function(e){var t=B();return this.bitwiseTo(e,n,t),t},F.prototype.not=function(){for(var e=B(),t=0;t<this.t;++t)e[t]=this.DM&~this[t];return e.t=this.t,e.s=~this.s,e},F.prototype.shiftLeft=function(e){var t=B();return e<0?this.rShiftTo(-e,t):this.lShiftTo(e,t),t},F.prototype.shiftRight=function(e){var t=B();return e<0?this.lShiftTo(-e,t):this.rShiftTo(e,t),t},F.prototype.getLowestSetBit=function(){for(var e=0;e<this.t;++e)if(0!=this[e])return e*this.DB+o(this[e]);return this.s<0?this.t*this.DB:-1},F.prototype.bitCount=function(){for(var e=0,t=this.s&this.DM,i=0;i<this.t;++i)e+=r(this[i]^t);return e},F.prototype.testBit=function(e){var t=Math.floor(e/this.DB);return t>=this.t?0!=this.s:0!=(this[t]&1<<e%this.DB)},F.prototype.setBit=function(e){return this.changeBit(e,d)},F.prototype.clearBit=function(e){return this.changeBit(e,n)},F.prototype.flipBit=function(e){return this.changeBit(e,a)},F.prototype.add=function(e){var t=B();return this.addTo(e,t),t},F.prototype.subtract=function(e){var t=B();return this.subTo(e,t),t},F.prototype.multiply=function(e){var t=B();return this.multiplyTo(e,t),t},F.prototype.divide=function(e){var t=B();return this.divRemTo(e,t,null),t},F.prototype.remainder=function(e){var t=B();return this.divRemTo(e,null,t),t},F.prototype.divideAndRemainder=function(e){var t=B(),i=B();return this.divRemTo(e,t,i),[t,i]},F.prototype.modPow=function(e,t){var i,a,n=e.bitLength(),o=G(1);if(n<=0)return o;i=n<18?1:n<48?3:n<144?4:n<768?5:6,a=n<8?new A(t):t.isEven()?new O(t):new N(t);var r=[],l=3,s=i-1,d=(1<<i)-1;if(r[1]=a.convert(this),1<i){var c=B();for(a.sqrTo(r[1],c);l<=d;)r[l]=B(),a.mulTo(c,r[l-2],r[l]),l+=2}var u,p,f=e.t-1,E=!0,m=B();for(n=X(e[f])-1;0<=f;){for(s<=n?u=e[f]>>n-s&d:(u=(e[f]&(1<<n+1)-1)<<s-n,0<f&&(u|=e[f-1]>>this.DB+n-s)),l=i;0==(1&u);)u>>=1,--l;if((n-=l)<0&&(n+=this.DB,--f),E)r[u].copyTo(o),E=!1;else{for(;1<l;)a.sqrTo(o,m),a.sqrTo(m,o),l-=2;0<l?a.sqrTo(o,m):(p=o,o=m,m=p),a.mulTo(m,r[u],o)}for(;0<=f&&0==(e[f]&1<<n);)a.sqrTo(o,m),p=o,o=m,m=p,--n<0&&(n=this.DB-1,--f)}return a.revert(o)},F.prototype.modInverse=function(e){var t=e.isEven();if(this.isEven()&&t||0==e.signum())return F.ZERO;for(var i=e.clone(),a=this.clone(),n=G(1),o=G(0),r=G(0),l=G(1);0!=i.signum();){for(;i.isEven();)i.rShiftTo(1,i),t?(n.isEven()&&o.isEven()||(n.addTo(this,n),o.subTo(e,o)),n.rShiftTo(1,n)):o.isEven()||o.subTo(e,o),o.rShiftTo(1,o);for(;a.isEven();)a.rShiftTo(1,a),t?(r.isEven()&&l.isEven()||(r.addTo(this,r),l.subTo(e,l)),r.rShiftTo(1,r)):l.isEven()||l.subTo(e,l),l.rShiftTo(1,l);0<=i.compareTo(a)?(i.subTo(a,i),t&&n.subTo(r,n),o.subTo(l,o)):(a.subTo(i,a),t&&r.subTo(n,r),l.subTo(o,l))}return 0!=a.compareTo(F.ONE)?F.ZERO:0<=l.compareTo(e)?l.subtract(e):l.signum()<0?(l.addTo(e,l),l.signum()<0?l.add(e):l):l},F.prototype.pow=function(e){return this.exp(e,new D)},F.prototype.gcd=function(e){var t=this.s<0?this.negate():this.clone(),i=e.s<0?e.negate():e.clone();if(t.compareTo(i)<0){var a=t;t=i,i=a}var n=t.getLowestSetBit(),o=i.getLowestSetBit();if(o<0)return t;for(n<o&&(o=n),0<o&&(t.rShiftTo(o,t),i.rShiftTo(o,i));0<t.signum();)0<(n=t.getLowestSetBit())&&t.rShiftTo(n,t),0<(n=i.getLowestSetBit())&&i.rShiftTo(n,i),0<=t.compareTo(i)?(t.subTo(i,t),t.rShiftTo(1,t)):(i.subTo(t,i),i.rShiftTo(1,i));return 0<o&&i.lShiftTo(o,i),i},F.prototype.isProbablePrime=function(e){var t,i=this.abs();if(1==i.t&&i[0]<=T[T.length-1]){for(t=0;t<T.length;++t)if(i[0]==T[t])return!0;return!1}if(i.isEven())return!1;for(t=1;t<T.length;){for(var a=T[t],n=t+1;n<T.length&&a<_;)a*=T[n++];for(a=i.modInt(a);t<n;)if(a%T[t++]==0)return!1}return i.millerRabin(e)},F.prototype.copyTo=function(e){for(var t=this.t-1;0<=t;--t)e[t]=this[t];e.t=this.t,e.s=this.s},F.prototype.fromInt=function(e){this.t=1,this.s=e<0?-1:0,0<e?this[0]=e:e<-1?this[0]=e+this.DV:this.t=0},F.prototype.fromString=function(e,t){var i;if(16==t)i=4;else if(8==t)i=3;else if(256==t)i=8;else if(2==t)i=1;else if(32==t)i=5;else{if(4!=t)return void this.fromRadix(e,t);i=2}this.t=0,this.s=0;for(var a=e.length,n=!1,o=0;0<=--a;){var r=8==i?255&+e[a]:H(e,a);r<0?"-"==e.charAt(a)&&(n=!0):(n=!1,0==o?this[this.t++]=r:o+i>this.DB?(this[this.t-1]|=(r&(1<<this.DB-o)-1)<<o,this[this.t++]=r>>this.DB-o):this[this.t-1]|=r<<o,(o+=i)>=this.DB&&(o-=this.DB))}8==i&&0!=(128&+e[0])&&(this.s=-1,0<o&&(this[this.t-1]|=(1<<this.DB-o)-1<<o)),this.clamp(),n&&F.ZERO.subTo(this,this)},F.prototype.clamp=function(){for(var e=this.s&this.DM;0<this.t&&this[this.t-1]==e;)--this.t},F.prototype.dlShiftTo=function(e,t){var i;for(i=this.t-1;0<=i;--i)t[i+e]=this[i];for(i=e-1;0<=i;--i)t[i]=0;t.t=this.t+e,t.s=this.s},F.prototype.drShiftTo=function(e,t){for(var i=e;i<this.t;++i)t[i-e]=this[i];t.t=Math.max(this.t-e,0),t.s=this.s},F.prototype.lShiftTo=function(e,t){for(var i=e%this.DB,a=this.DB-i,n=(1<<a)-1,o=Math.floor(e/this.DB),r=this.s<<i&this.DM,l=this.t-1;0<=l;--l)t[l+o+1]=this[l]>>a|r,r=(this[l]&n)<<i;for(l=o-1;0<=l;--l)t[l]=0;t[o]=r,t.t=this.t+o+1,t.s=this.s,t.clamp()},F.prototype.rShiftTo=function(e,t){t.s=this.s;var i=Math.floor(e/this.DB);if(i>=this.t)t.t=0;else{var a=e%this.DB,n=this.DB-a,o=(1<<a)-1;t[0]=this[i]>>a;for(var r=i+1;r<this.t;++r)t[r-i-1]|=(this[r]&o)<<n,t[r-i]=this[r]>>a;0<a&&(t[this.t-i-1]|=(this.s&o)<<n),t.t=this.t-i,t.clamp()}},F.prototype.subTo=function(e,t){for(var i=0,a=0,n=Math.min(e.t,this.t);i<n;)a+=this[i]-e[i],t[i++]=a&this.DM,a>>=this.DB;if(e.t<this.t){for(a-=e.s;i<this.t;)a+=this[i],t[i++]=a&this.DM,a>>=this.DB;a+=this.s}else{for(a+=this.s;i<e.t;)a-=e[i],t[i++]=a&this.DM,a>>=this.DB;a-=e.s}t.s=a<0?-1:0,a<-1?t[i++]=this.DV+a:0<a&&(t[i++]=a),t.t=i,t.clamp()},F.prototype.multiplyTo=function(e,t){var i=this.abs(),a=e.abs(),n=i.t;for(t.t=n+a.t;0<=--n;)t[n]=0;for(n=0;n<a.t;++n)t[n+i.t]=i.am(0,a[n],t,n,0,i.t);t.s=0,t.clamp(),this.s!=e.s&&F.ZERO.subTo(t,t)},F.prototype.squareTo=function(e){for(var t=this.abs(),i=e.t=2*t.t;0<=--i;)e[i]=0;for(i=0;i<t.t-1;++i){var a=t.am(i,t[i],e,2*i,0,1);(e[i+t.t]+=t.am(i+1,2*t[i],e,2*i+1,a,t.t-i-1))>=t.DV&&(e[i+t.t]-=t.DV,e[i+t.t+1]=1)}0<e.t&&(e[e.t-1]+=t.am(i,t[i],e,2*i,0,1)),e.s=0,e.clamp()},F.prototype.divRemTo=function(e,t,i){var a=e.abs();if(!(a.t<=0)){var n=this.abs();if(n.t<a.t)return null!=t&&t.fromInt(0),void(null!=i&&this.copyTo(i));null==i&&(i=B());var o=B(),r=this.s,l=e.s,s=this.DB-X(a[a.t-1]);0<s?(a.lShiftTo(s,o),n.lShiftTo(s,i)):(a.copyTo(o),n.copyTo(i));var d=o.t,c=o[d-1];if(0!=c){var u=c*(1<<this.F1)+(1<d?o[d-2]>>this.F2:0),p=this.FV/u,f=(1<<this.F1)/u,E=1<<this.F2,m=i.t,g=m-d,h=null==t?B():t;for(o.dlShiftTo(g,h),0<=i.compareTo(h)&&(i[i.t++]=1,i.subTo(h,i)),F.ONE.dlShiftTo(d,h),h.subTo(o,o);o.t<d;)o[o.t++]=0;for(;0<=--g;){var x=i[--m]==c?this.DM:Math.floor(i[m]*p+(i[m-1]+E)*f);if((i[m]+=o.am(0,x,i,g,0,d))<x)for(o.dlShiftTo(g,h),i.subTo(h,i);i[m]<--x;)i.subTo(h,i)}null!=t&&(i.drShiftTo(d,t),r!=l&&F.ZERO.subTo(t,t)),i.t=d,i.clamp(),0<s&&i.rShiftTo(s,i),r<0&&F.ZERO.subTo(i,i)}}},F.prototype.invDigit=function(){if(this.t<1)return 0;var e=this[0];if(0==(1&e))return 0;var t=3&e;return 0<(t=(t=(t=(t=t*(2-(15&e)*t)&15)*(2-(255&e)*t)&255)*(2-((65535&e)*t&65535))&65535)*(2-e*t%this.DV)%this.DV)?this.DV-t:-t},F.prototype.isEven=function(){return 0==(0<this.t?1&this[0]:this.s)},F.prototype.exp=function(e,t){if(4294967295<e||e<1)return F.ONE;var i=B(),a=B(),n=t.convert(this),o=X(e)-1;for(n.copyTo(i);0<=--o;)if(t.sqrTo(i,a),0<(e&1<<o))t.mulTo(a,n,i);else{var r=i;i=a,a=r}return t.revert(i)},F.prototype.chunkSize=function(e){return Math.floor(Math.LN2*this.DB/Math.log(e))},F.prototype.toRadix=function(e){if(null==e&&(e=10),0==this.signum()||e<2||36<e)return"0";var t=this.chunkSize(e),i=Math.pow(e,t),a=G(i),n=B(),o=B(),r="";for(this.divRemTo(a,n,o);0<n.signum();)r=(i+o.intValue()).toString(e).substr(1)+r,n.divRemTo(a,n,o);return o.intValue().toString(e)+r},F.prototype.fromRadix=function(e,t){this.fromInt(0),null==t&&(t=10);for(var i=this.chunkSize(t),a=Math.pow(t,i),n=!1,o=0,r=0,l=0;l<e.length;++l){var s=H(e,l);s<0?"-"==e.charAt(l)&&0==this.signum()&&(n=!0):(r=t*r+s,++o>=i&&(this.dMultiply(a),this.dAddOffset(r,0),r=o=0))}0<o&&(this.dMultiply(Math.pow(t,o)),this.dAddOffset(r,0)),n&&F.ZERO.subTo(this,this)},F.prototype.fromNumber=function(e,t,i){if("number"==typeof t)if(e<2)this.fromInt(1);else for(this.fromNumber(e,i),this.testBit(e-1)||this.bitwiseTo(F.ONE.shiftLeft(e-1),d,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(t);)this.dAddOffset(2,0),this.bitLength()>e&&this.subTo(F.ONE.shiftLeft(e-1),this);else{var a=[],n=7&e;a.length=1+(e>>3),t.nextBytes(a),0<n?a[0]&=(1<<n)-1:a[0]=0,this.fromString(a,256)}},F.prototype.bitwiseTo=function(e,t,i){var a,n,o=Math.min(e.t,this.t);for(a=0;a<o;++a)i[a]=t(this[a],e[a]);if(e.t<this.t){for(n=e.s&this.DM,a=o;a<this.t;++a)i[a]=t(this[a],n);i.t=this.t}else{for(n=this.s&this.DM,a=o;a<e.t;++a)i[a]=t(n,e[a]);i.t=e.t}i.s=t(this.s,e.s),i.clamp()},F.prototype.changeBit=function(e,t){var i=F.ONE.shiftLeft(e);return this.bitwiseTo(i,t,i),i},F.prototype.addTo=function(e,t){for(var i=0,a=0,n=Math.min(e.t,this.t);i<n;)a+=this[i]+e[i],t[i++]=a&this.DM,a>>=this.DB;if(e.t<this.t){for(a+=e.s;i<this.t;)a+=this[i],t[i++]=a&this.DM,a>>=this.DB;a+=this.s}else{for(a+=this.s;i<e.t;)a+=e[i],t[i++]=a&this.DM,a>>=this.DB;a+=e.s}t.s=a<0?-1:0,0<a?t[i++]=a:a<-1&&(t[i++]=this.DV+a),t.t=i,t.clamp()},F.prototype.dMultiply=function(e){this[this.t]=this.am(0,e-1,this,0,0,this.t),++this.t,this.clamp()},F.prototype.dAddOffset=function(e,t){if(0!=e){for(;this.t<=t;)this[this.t++]=0;for(this[t]+=e;this[t]>=this.DV;)this[t]-=this.DV,++t>=this.t&&(this[this.t++]=0),++this[t]}},F.prototype.multiplyLowerTo=function(e,t,i){var a=Math.min(this.t+e.t,t);for(i.s=0,i.t=a;0<a;)i[--a]=0;for(var n=i.t-this.t;a<n;++a)i[a+this.t]=this.am(0,e[a],i,a,0,this.t);for(n=Math.min(e.t,t);a<n;++a)this.am(0,e[a],i,a,0,t-a);i.clamp()},F.prototype.multiplyUpperTo=function(e,t,i){--t;var a=i.t=this.t+e.t-t;for(i.s=0;0<=--a;)i[a]=0;for(a=Math.max(t-this.t,0);a<e.t;++a)i[this.t+a-t]=this.am(t-a,e[a],i,0,0,this.t+a-t);i.clamp(),i.drShiftTo(1,i)},F.prototype.modInt=function(e){if(e<=0)return 0;var t=this.DV%e,i=this.s<0?e-1:0;if(0<this.t)if(0==t)i=this[0]%e;else for(var a=this.t-1;0<=a;--a)i=(t*i+this[a])%e;return i},F.prototype.millerRabin=function(e){var t=this.subtract(F.ONE),i=t.getLowestSetBit();if(i<=0)return!1;var a=t.shiftRight(i);T.length<(e=e+1>>1)&&(e=T.length);for(var n=B(),o=0;o<e;++o){n.fromInt(T[Math.floor(Math.random()*T.length)]);var r=n.modPow(a,this);if(0!=r.compareTo(F.ONE)&&0!=r.compareTo(t)){for(var l=1;l++<i&&0!=r.compareTo(t);)if(0==(r=r.modPowInt(2,this)).compareTo(F.ONE))return!1;if(0!=r.compareTo(t))return!1}}return!0},F.prototype.square=function(){var e=B();return this.squareTo(e),e},F.prototype.gcda=function(e,t){var i=this.s<0?this.negate():this.clone(),a=e.s<0?e.negate():e.clone();if(i.compareTo(a)<0){var n=i;i=a,a=n}var o=i.getLowestSetBit(),r=a.getLowestSetBit();if(r<0)t(i);else{o<r&&(r=o),0<r&&(i.rShiftTo(r,i),a.rShiftTo(r,a));var l=function(){0<(o=i.getLowestSetBit())&&i.rShiftTo(o,i),0<(o=a.getLowestSetBit())&&a.rShiftTo(o,a),0<=i.compareTo(a)?(i.subTo(a,i),i.rShiftTo(1,i)):(a.subTo(i,a),a.rShiftTo(1,a)),0<i.signum()?setTimeout(l,0):(0<r&&a.lShiftTo(r,a),setTimeout(function(){t(a)},0))};setTimeout(l,10)}},F.prototype.fromNumberAsync=function(e,t,i,a){if("number"==typeof t)if(e<2)this.fromInt(1);else{this.fromNumber(e,i),this.testBit(e-1)||this.bitwiseTo(F.ONE.shiftLeft(e-1),d,this),this.isEven()&&this.dAddOffset(1,0);var n=this,o=function(){n.dAddOffset(2,0),n.bitLength()>e&&n.subTo(F.ONE.shiftLeft(e-1),n),n.isProbablePrime(t)?setTimeout(function(){a()},0):setTimeout(o,0)};setTimeout(o,0)}else{var r=[],l=7&e;r.length=1+(e>>3),t.nextBytes(r),0<l?r[0]&=(1<<l)-1:r[0]=0,this.fromString(r,256)}},F),D=(M.prototype.convert=function(e){return e},M.prototype.revert=function(e){return e},M.prototype.mulTo=function(e,t,i){e.multiplyTo(t,i)},M.prototype.sqrTo=function(e,t){e.squareTo(t)},M),A=(P.prototype.convert=function(e){return e.s<0||0<=e.compareTo(this.m)?e.mod(this.m):e},P.prototype.revert=function(e){return e},P.prototype.reduce=function(e){e.divRemTo(this.m,null,e)},P.prototype.mulTo=function(e,t,i){e.multiplyTo(t,i),this.reduce(i)},P.prototype.sqrTo=function(e,t){e.squareTo(t),this.reduce(t)},P),N=(L.prototype.convert=function(e){var t=B();return e.abs().dlShiftTo(this.m.t,t),t.divRemTo(this.m,null,t),e.s<0&&0<t.compareTo(J.ZERO)&&this.m.subTo(t,t),t},L.prototype.revert=function(e){var t=B();return e.copyTo(t),this.reduce(t),t},L.prototype.reduce=function(e){for(;e.t<=this.mt2;)e[e.t++]=0;for(var t=0;t<this.m.t;++t){var i=32767&e[t],a=i*this.mpl+((i*this.mph+(e[t]>>15)*this.mpl&this.um)<<15)&e.DM;for(e[i=t+this.m.t]+=this.m.am(0,a,e,t,0,this.m.t);e[i]>=e.DV;)e[i]-=e.DV,e[++i]++}e.clamp(),e.drShiftTo(this.m.t,e),0<=e.compareTo(this.m)&&e.subTo(this.m,e)},L.prototype.mulTo=function(e,t,i){e.multiplyTo(t,i),this.reduce(i)},L.prototype.sqrTo=function(e,t){e.squareTo(t),this.reduce(t)},L),O=(R.prototype.convert=function(e){if(e.s<0||e.t>2*this.m.t)return e.mod(this.m);if(e.compareTo(this.m)<0)return e;var t=B();return e.copyTo(t),this.reduce(t),t},R.prototype.revert=function(e){return e},R.prototype.reduce=function(e){for(e.drShiftTo(this.m.t-1,this.r2),e.t>this.m.t+1&&(e.t=this.m.t+1,e.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);e.compareTo(this.r2)<0;)e.dAddOffset(1,this.m.t+1);for(e.subTo(this.r2,e);0<=e.compareTo(this.m);)e.subTo(this.m,e)},R.prototype.mulTo=function(e,t,i){e.multiplyTo(t,i),this.reduce(i)},R.prototype.sqrTo=function(e,t){e.squareTo(t),this.reduce(t)},R);function R(e){this.m=e,this.r2=B(),this.q3=B(),J.ONE.dlShiftTo(2*e.t,this.r2),this.mu=this.r2.divide(e)}function L(e){this.m=e,this.mp=e.invDigit(),this.mpl=32767&this.mp,this.mph=this.mp>>15,this.um=(1<<e.DB-15)-1,this.mt2=2*e.t}function P(e){this.m=e}function M(){}function F(e,t,i){null!=e&&("number"==typeof e?this.fromNumber(e,t,i):null==t&&"string"!=typeof e?this.fromString(e,256):this.fromString(e,t))}function k(e){var t=e.get();if(this.tagClass=t>>6,this.tagConstructed=0!=(32&t),this.tagNumber=31&t,31==this.tagNumber){for(var i=new g;t=e.get(),i.mulAdd(128,127&t),128&t;);this.tagNumber=i.simplify()}}function U(e,t,i,a,n){if(!(a instanceof I))throw new Error("Invalid tag value.");this.stream=e,this.header=t,this.length=i,this.tag=a,this.sub=n}function j(e,t){this.hexDigits="0123456789ABCDEF",e instanceof j?(this.enc=e.enc,this.pos=e.pos):(this.enc=e,this.pos=t)}function B(){return new J(null)}function Y(e,t){return new J(e,t)}C="Microsoft Internet Explorer"==navigator.appName?(J.prototype.am=function(e,t,i,a,n,o){for(var r=32767&t,l=t>>15;0<=--o;){var s=32767&this[e],d=this[e++]>>15,c=l*s+d*r;n=((s=r*s+((32767&c)<<15)+i[a]+(1073741823&n))>>>30)+(c>>>15)+l*d+(n>>>30),i[a++]=1073741823&s}return n},30):"Netscape"!=navigator.appName?(J.prototype.am=function(e,t,i,a,n,o){for(;0<=--o;){var r=t*this[e++]+i[a]+n;n=Math.floor(r/67108864),i[a++]=67108863&r}return n},26):(J.prototype.am=function(e,t,i,a,n,o){for(var r=16383&t,l=t>>14;0<=--o;){var s=16383&this[e],d=this[e++]>>14,c=l*s+d*r;n=((s=r*s+((16383&c)<<14)+i[a]+n)>>28)+(c>>14)+l*d,i[a++]=268435455&s}return n},28),J.prototype.DB=C,J.prototype.DM=(1<<C)-1,J.prototype.DV=1<<C,J.prototype.FV=Math.pow(2,52),J.prototype.F1=52-C,J.prototype.F2=2*C-52;var V,W,q=[];for(V="0".charCodeAt(0),W=0;W<=9;++W)q[V++]=W;for(V="a".charCodeAt(0),W=10;W<36;++W)q[V++]=W;for(V="A".charCodeAt(0),W=10;W<36;++W)q[V++]=W;function H(e,t){var i=q[e.charCodeAt(t)];return null==i?-1:i}function G(e){var t=B();return t.fromInt(e),t}function X(e){var t,i=1;return 0!=(t=e>>>16)&&(e=t,i+=16),0!=(t=e>>8)&&(e=t,i+=8),0!=(t=e>>4)&&(e=t,i+=4),0!=(t=e>>2)&&(e=t,i+=2),0!=(t=e>>1)&&(e=t,i+=1),i}J.ZERO=G(0),J.ONE=G(1);var K=(z.prototype.init=function(e){var t,i,a;for(t=0;t<256;++t)this.S[t]=t;for(t=i=0;t<256;++t)i=i+this.S[t]+e[t%e.length]&255,a=this.S[t],this.S[t]=this.S[i],this.S[i]=a;this.i=0,this.j=0},z.prototype.next=function(){var e;return this.i=this.i+1&255,this.j=this.j+this.S[this.i]&255,e=this.S[this.i],this.S[this.i]=this.S[this.j],this.S[this.j]=e,this.S[e+this.S[this.i]&255]},z);function z(){this.i=0,this.j=0,this.S=[]}var Q,Z,$=256,ee=null;if(null==ee){ee=[];var te=void(Z=0);if(window.crypto&&window.crypto.getRandomValues){var ie=new Uint32Array(256);for(window.crypto.getRandomValues(ie),te=0;te<ie.length;++te)ee[Z++]=255&ie[te]}var ae=function(e){if(this.count=this.count||0,256<=this.count||$<=Z)window.removeEventListener?window.removeEventListener("mousemove",ae,!1):window.detachEvent&&window.detachEvent("onmousemove",ae);else try{var t=e.x+e.y;ee[Z++]=255&t,this.count+=1}catch(e){}};window.addEventListener?window.addEventListener("mousemove",ae,!1):window.attachEvent&&window.attachEvent("onmousemove",ae)}function ne(){if(null==Q){for(Q=new K;Z<$;){var e=Math.floor(65536*Math.random());ee[Z++]=255&e}for(Q.init(ee),Z=0;Z<ee.length;++Z)ee[Z]=0;Z=0}return Q.next()}var oe=(re.prototype.nextBytes=function(e){for(var t=0;t<e.length;++t)e[t]=ne()},re);function re(){}var le=(se.prototype.doPublic=function(e){return e.modPowInt(this.e,this.n)},se.prototype.doPrivate=function(e){if(null==this.p||null==this.q)return e.modPow(this.d,this.n);for(var t=e.mod(this.p).modPow(this.dmp1,this.p),i=e.mod(this.q).modPow(this.dmq1,this.q);t.compareTo(i)<0;)t=t.add(this.p);return t.subtract(i).multiply(this.coeff).mod(this.p).multiply(this.q).add(i)},se.prototype.setPublic=function(e,t){null!=e&&null!=t&&0<e.length&&0<t.length?(this.n=Y(e,16),this.e=parseInt(t,16)):console.error("Invalid RSA public key")},se.prototype.encrypt=function(e){var t=function(e,t){if(t<e.length+11)return console.error("Message too long for RSA"),null;for(var i=[],a=e.length-1;0<=a&&0<t;){var n=e.charCodeAt(a--);n<128?i[--t]=n:127<n&&n<2048?(i[--t]=63&n|128,i[--t]=n>>6|192):(i[--t]=63&n|128,i[--t]=n>>6&63|128,i[--t]=n>>12|224)}i[--t]=0;for(var o=new oe,r=[];2<t;){for(r[0]=0;0==r[0];)o.nextBytes(r);i[--t]=r[0]}return i[--t]=2,i[--t]=0,new J(i)}(e,this.n.bitLength()+7>>3);if(null==t)return null;var i=this.doPublic(t);if(null==i)return null;var a=i.toString(16);return 0==(1&a.length)?a:"0"+a},se.prototype.setPrivate=function(e,t,i){null!=e&&null!=t&&0<e.length&&0<t.length?(this.n=Y(e,16),this.e=parseInt(t,16),this.d=Y(i,16)):console.error("Invalid RSA private key")},se.prototype.setPrivateEx=function(e,t,i,a,n,o,r,l){null!=e&&null!=t&&0<e.length&&0<t.length?(this.n=Y(e,16),this.e=parseInt(t,16),this.d=Y(i,16),this.p=Y(a,16),this.q=Y(n,16),this.dmp1=Y(o,16),this.dmq1=Y(r,16),this.coeff=Y(l,16)):console.error("Invalid RSA private key")},se.prototype.generate=function(e,t){var i=new oe,a=e>>1;this.e=parseInt(t,16);for(var n=new J(t,16);;){for(;this.p=new J(e-a,1,i),0!=this.p.subtract(J.ONE).gcd(n).compareTo(J.ONE)||!this.p.isProbablePrime(10););for(;this.q=new J(a,1,i),0!=this.q.subtract(J.ONE).gcd(n).compareTo(J.ONE)||!this.q.isProbablePrime(10););if(this.p.compareTo(this.q)<=0){var o=this.p;this.p=this.q,this.q=o}var r=this.p.subtract(J.ONE),l=this.q.subtract(J.ONE),s=r.multiply(l);if(0==s.gcd(n).compareTo(J.ONE)){this.n=this.p.multiply(this.q),this.d=n.modInverse(s),this.dmp1=this.d.mod(r),this.dmq1=this.d.mod(l),this.coeff=this.q.modInverse(this.p);break}}},se.prototype.decrypt=function(e){var t=Y(e,16),i=this.doPrivate(t);return null==i?null:function(e,t){for(var i=e.toByteArray(),a=0;a<i.length&&0==i[a];)++a;if(i.length-a!=t-1||2!=i[a])return null;for(++a;0!=i[a];)if(++a>=i.length)return null;for(var n="";++a<i.length;){var o=255&i[a];o<128?n+=String.fromCharCode(o):191<o&&o<224?(n+=String.fromCharCode((31&o)<<6|63&i[a+1]),++a):(n+=String.fromCharCode((15&o)<<12|(63&i[a+1])<<6|63&i[a+2]),a+=2)}return n}(i,this.n.bitLength()+7>>3)},se.prototype.generateAsync=function(e,t,n){var o=new oe,r=e>>1;this.e=parseInt(t,16);var l=new J(t,16),s=this,d=function(){function t(){if(s.p.compareTo(s.q)<=0){var e=s.p;s.p=s.q,s.q=e}var t=s.p.subtract(J.ONE),i=s.q.subtract(J.ONE),a=t.multiply(i);0==a.gcd(l).compareTo(J.ONE)?(s.n=s.p.multiply(s.q),s.d=l.modInverse(a),s.dmp1=s.d.mod(t),s.dmq1=s.d.mod(i),s.coeff=s.q.modInverse(s.p),setTimeout(function(){n()},0)):setTimeout(d,0)}var i=function(){s.q=B(),s.q.fromNumberAsync(r,1,o,function(){s.q.subtract(J.ONE).gcda(l,function(e){0==e.compareTo(J.ONE)&&s.q.isProbablePrime(10)?setTimeout(t,0):setTimeout(i,0)})})},a=function(){s.p=B(),s.p.fromNumberAsync(e-r,1,o,function(){s.p.subtract(J.ONE).gcda(l,function(e){0==e.compareTo(J.ONE)&&s.p.isProbablePrime(10)?setTimeout(i,0):setTimeout(a,0)})})};setTimeout(a,0)};setTimeout(d,0)},se.prototype.sign=function(e,t,i){var a=function(e,t){if(t<e.length+22)return console.error("Message too long for RSA"),null;for(var i=t-e.length-6,a="",n=0;n<i;n+=2)a+="ff";return Y("0001"+a+"00"+e,16)}((de[i]||"")+t(e).toString(),this.n.bitLength()/4);if(null==a)return null;var n=this.doPrivate(a);if(null==n)return null;var o=n.toString(16);return 0==(1&o.length)?o:"0"+o},se.prototype.verify=function(e,t,i){var a=Y(t,16),n=this.doPublic(a);return null==n?null:function(e){for(var t in de)if(de.hasOwnProperty(t)){var i=de[t],a=i.length;if(e.substr(0,a)==i)return e.substr(a)}return e}(n.toString(16).replace(/^1f+00/,""))==i(e).toString()},se);function se(){this.n=null,this.e=0,this.d=null,this.p=null,this.q=null,this.dmp1=null,this.dmq1=null,this.coeff=null}var de={md2:"3020300c06082a864886f70d020205000410",md5:"3020300c06082a864886f70d020505000410",sha1:"3021300906052b0e03021a05000414",sha224:"302d300d06096086480165030402040500041c",sha256:"3031300d060960864801650304020105000420",sha384:"3041300d060960864801650304020205000430",sha512:"3051300d060960864801650304020305000440",ripemd160:"3021300906052b2403020105000414"},ce={};ce.lang={extend:function(e,t,i){if(!t||!e)throw new Error("YAHOO.lang.extend failed, please check that all dependencies are included.");function a(){}if(a.prototype=t.prototype,e.prototype=new a,(e.prototype.constructor=e).superclass=t.prototype,t.prototype.constructor==Object.prototype.constructor&&(t.prototype.constructor=t),i){var n;for(n in i)e.prototype[n]=i[n];var o=function(){},r=["toString","valueOf"];try{/MSIE/.test(navigator.userAgent)&&(o=function(e,t){for(n=0;n<r.length;n+=1){var i=r[n],a=t[i];"function"==typeof a&&a!=Object.prototype[i]&&(e[i]=a)}})}catch(e){}o(e.prototype,i)}}};var ue={};void 0!==ue.asn1&&ue.asn1||(ue.asn1={}),ue.asn1.ASN1Util=new function(){this.integerToByteHex=function(e){var t=e.toString(16);return t.length%2==1&&(t="0"+t),t},this.bigIntToMinTwosComplementsHex=function(e){var t=e.toString(16);if("-"!=t.substr(0,1))t.length%2==1?t="0"+t:t.match(/^[0-7]/)||(t="00"+t);else{var i=t.substr(1).length;i%2==1?i+=1:t.match(/^[0-7]/)||(i+=2);for(var a="",n=0;n<i;n++)a+="f";t=new J(a,16).xor(e).add(J.ONE).toString(16).replace(/^-/,"")}return t},this.getPEMStringFromHex=function(e,t){return hextopem(e,t)},this.newObject=function(e){var t=ue.asn1,i=t.DERBoolean,a=t.DERInteger,n=t.DERBitString,o=t.DEROctetString,r=t.DERNull,l=t.DERObjectIdentifier,s=t.DEREnumerated,d=t.DERUTF8String,c=t.DERNumericString,u=t.DERPrintableString,p=t.DERTeletexString,f=t.DERIA5String,E=t.DERUTCTime,m=t.DERGeneralizedTime,g=t.DERSequence,h=t.DERSet,x=t.DERTaggedObject,v=t.ASN1Util.newObject,y=Object.keys(e);if(1!=y.length)throw"key of param shall be only one.";var b=y[0];if(-1==":bool:int:bitstr:octstr:null:oid:enum:utf8str:numstr:prnstr:telstr:ia5str:utctime:gentime:seq:set:tag:".indexOf(":"+b+":"))throw"undefined key: "+b;if("bool"==b)return new i(e[b]);if("int"==b)return new a(e[b]);if("bitstr"==b)return new n(e[b]);if("octstr"==b)return new o(e[b]);if("null"==b)return new r(e[b]);if("oid"==b)return new l(e[b]);if("enum"==b)return new s(e[b]);if("utf8str"==b)return new d(e[b]);if("numstr"==b)return new c(e[b]);if("prnstr"==b)return new u(e[b]);if("telstr"==b)return new p(e[b]);if("ia5str"==b)return new f(e[b]);if("utctime"==b)return new E(e[b]);if("gentime"==b)return new m(e[b]);if("seq"==b){for(var C=e[b],w=[],S=0;S<C.length;S++){var I=v(C[S]);w.push(I)}return new g({array:w})}if("set"==b){for(C=e[b],w=[],S=0;S<C.length;S++)I=v(C[S]),w.push(I);return new h({array:w})}if("tag"==b){var T=e[b];if("[object Array]"===Object.prototype.toString.call(T)&&3==T.length){var _=v(T[2]);return new x({tag:T[0],explicit:T[1],obj:_})}var J={};if(void 0!==T.explicit&&(J.explicit=T.explicit),void 0!==T.tag&&(J.tag=T.tag),void 0===T.obj)throw"obj shall be specified for 'tag'.";return J.obj=v(T.obj),new x(J)}},this.jsonToASN1HEX=function(e){return this.newObject(e).getEncodedHex()}},ue.asn1.ASN1Util.oidHexToInt=function(e){for(var t="",i=parseInt(e.substr(0,2),16),a=(t=Math.floor(i/40)+"."+i%40,""),n=2;n<e.length;n+=2){var o=("00000000"+parseInt(e.substr(n,2),16).toString(2)).slice(-8);a+=o.substr(1,7),"0"==o.substr(0,1)&&(t=t+"."+new J(a,2).toString(10),a="")}return t},ue.asn1.ASN1Util.oidIntToHex=function(e){function l(e){var t=e.toString(16);return 1==t.length&&(t="0"+t),t}function t(e){var t="",i=new J(e,10).toString(2),a=7-i.length%7;7==a&&(a=0);for(var n="",o=0;o<a;o++)n+="0";for(i=n+i,o=0;o<i.length-1;o+=7){var r=i.substr(o,7);o!=i.length-7&&(r="1"+r),t+=l(parseInt(r,2))}return t}if(!e.match(/^[0-9.]+$/))throw"malformed oid string: "+e;var i="",a=e.split("."),n=40*parseInt(a[0])+parseInt(a[1]);i+=l(n),a.splice(0,2);for(var o=0;o<a.length;o++)i+=t(a[o]);return i},ue.asn1.ASN1Object=function(){this.getLengthHexFromValue=function(){if(void 0===this.hV||null==this.hV)throw"this.hV is null or undefined.";if(this.hV.length%2==1)throw"value hex must be even length: n="+"".length+",v="+this.hV;var e=this.hV.length/2,t=e.toString(16);if(t.length%2==1&&(t="0"+t),e<128)return t;var i=t.length/2;if(15<i)throw"ASN.1 length too long to represent by 8x: n = "+e.toString(16);return(128+i).toString(16)+t},this.getEncodedHex=function(){return null!=this.hTLV&&!this.isModified||(this.hV=this.getFreshValueHex(),this.hL=this.getLengthHexFromValue(),this.hTLV=this.hT+this.hL+this.hV,this.isModified=!1),this.hTLV},this.getValueHex=function(){return this.getEncodedHex(),this.hV},this.getFreshValueHex=function(){return""}},ue.asn1.DERAbstractString=function(e){ue.asn1.DERAbstractString.superclass.constructor.call(this),this.getString=function(){return this.s},this.setString=function(e){this.hTLV=null,this.isModified=!0,this.s=e,this.hV=stohex(this.s)},this.setStringHex=function(e){this.hTLV=null,this.isModified=!0,this.s=null,this.hV=e},this.getFreshValueHex=function(){return this.hV},void 0!==e&&("string"==typeof e?this.setString(e):void 0!==e.str?this.setString(e.str):void 0!==e.hex&&this.setStringHex(e.hex))},ce.lang.extend(ue.asn1.DERAbstractString,ue.asn1.ASN1Object),ue.asn1.DERAbstractTime=function(e){ue.asn1.DERAbstractTime.superclass.constructor.call(this),this.localDateToUTC=function(e){return utc=e.getTime()+6e4*e.getTimezoneOffset(),new Date(utc)},this.formatDate=function(e,t,i){var a=this.zeroPadding,n=this.localDateToUTC(e),o=String(n.getFullYear());"utc"==t&&(o=o.substr(2,2));var r=o+a(String(n.getMonth()+1),2)+a(String(n.getDate()),2)+a(String(n.getHours()),2)+a(String(n.getMinutes()),2)+a(String(n.getSeconds()),2);if(!0===i){var l=n.getMilliseconds();if(0!=l){var s=a(String(l),3);r=r+"."+(s=s.replace(/[0]+$/,""))}}return r+"Z"},this.zeroPadding=function(e,t){return e.length>=t?e:new Array(t-e.length+1).join("0")+e},this.getString=function(){return this.s},this.setString=function(e){this.hTLV=null,this.isModified=!0,this.s=e,this.hV=stohex(e)},this.setByDateValue=function(e,t,i,a,n,o){var r=new Date(Date.UTC(e,t-1,i,a,n,o,0));this.setByDate(r)},this.getFreshValueHex=function(){return this.hV}},ce.lang.extend(ue.asn1.DERAbstractTime,ue.asn1.ASN1Object),ue.asn1.DERAbstractStructured=function(e){ue.asn1.DERAbstractString.superclass.constructor.call(this),this.setByASN1ObjectArray=function(e){this.hTLV=null,this.isModified=!0,this.asn1Array=e},this.appendASN1Object=function(e){this.hTLV=null,this.isModified=!0,this.asn1Array.push(e)},this.asn1Array=new Array,void 0!==e&&void 0!==e.array&&(this.asn1Array=e.array)},ce.lang.extend(ue.asn1.DERAbstractStructured,ue.asn1.ASN1Object),ue.asn1.DERBoolean=function(){ue.asn1.DERBoolean.superclass.constructor.call(this),this.hT="01",this.hTLV="0101ff"},ce.lang.extend(ue.asn1.DERBoolean,ue.asn1.ASN1Object),ue.asn1.DERInteger=function(e){ue.asn1.DERInteger.superclass.constructor.call(this),this.hT="02",this.setByBigInteger=function(e){this.hTLV=null,this.isModified=!0,this.hV=ue.asn1.ASN1Util.bigIntToMinTwosComplementsHex(e)},this.setByInteger=function(e){var t=new J(String(e),10);this.setByBigInteger(t)},this.setValueHex=function(e){this.hV=e},this.getFreshValueHex=function(){return this.hV},void 0!==e&&(void 0!==e.bigint?this.setByBigInteger(e.bigint):void 0!==e.int?this.setByInteger(e.int):"number"==typeof e?this.setByInteger(e):void 0!==e.hex&&this.setValueHex(e.hex))},ce.lang.extend(ue.asn1.DERInteger,ue.asn1.ASN1Object),ue.asn1.DERBitString=function(e){if(void 0!==e&&void 0!==e.obj){var t=ue.asn1.ASN1Util.newObject(e.obj);e.hex="00"+t.getEncodedHex()}ue.asn1.DERBitString.superclass.constructor.call(this),this.hT="03",this.setHexValueIncludingUnusedBits=function(e){this.hTLV=null,this.isModified=!0,this.hV=e},this.setUnusedBitsAndHexValue=function(e,t){if(e<0||7<e)throw"unused bits shall be from 0 to 7: u = "+e;var i="0"+e;this.hTLV=null,this.isModified=!0,this.hV=i+t},this.setByBinaryString=function(e){var t=8-(e=e.replace(/0+$/,"")).length%8;8==t&&(t=0);for(var i=0;i<=t;i++)e+="0";var a="";for(i=0;i<e.length-1;i+=8){var n=e.substr(i,8),o=parseInt(n,2).toString(16);1==o.length&&(o="0"+o),a+=o}this.hTLV=null,this.isModified=!0,this.hV="0"+t+a},this.setByBooleanArray=function(e){for(var t="",i=0;i<e.length;i++)1==e[i]?t+="1":t+="0";this.setByBinaryString(t)},this.newFalseArray=function(e){for(var t=new Array(e),i=0;i<e;i++)t[i]=!1;return t},this.getFreshValueHex=function(){return this.hV},void 0!==e&&("string"==typeof e&&e.toLowerCase().match(/^[0-9a-f]+$/)?this.setHexValueIncludingUnusedBits(e):void 0!==e.hex?this.setHexValueIncludingUnusedBits(e.hex):void 0!==e.bin?this.setByBinaryString(e.bin):void 0!==e.array&&this.setByBooleanArray(e.array))},ce.lang.extend(ue.asn1.DERBitString,ue.asn1.ASN1Object),ue.asn1.DEROctetString=function(e){if(void 0!==e&&void 0!==e.obj){var t=ue.asn1.ASN1Util.newObject(e.obj);e.hex=t.getEncodedHex()}ue.asn1.DEROctetString.superclass.constructor.call(this,e),this.hT="04"},ce.lang.extend(ue.asn1.DEROctetString,ue.asn1.DERAbstractString),ue.asn1.DERNull=function(){ue.asn1.DERNull.superclass.constructor.call(this),this.hT="05",this.hTLV="0500"},ce.lang.extend(ue.asn1.DERNull,ue.asn1.ASN1Object),ue.asn1.DERObjectIdentifier=function(e){function l(e){var t=e.toString(16);return 1==t.length&&(t="0"+t),t}function o(e){var t="",i=new J(e,10).toString(2),a=7-i.length%7;7==a&&(a=0);for(var n="",o=0;o<a;o++)n+="0";for(i=n+i,o=0;o<i.length-1;o+=7){var r=i.substr(o,7);o!=i.length-7&&(r="1"+r),t+=l(parseInt(r,2))}return t}ue.asn1.DERObjectIdentifier.superclass.constructor.call(this),this.hT="06",this.setValueHex=function(e){this.hTLV=null,this.isModified=!0,this.s=null,this.hV=e},this.setValueOidString=function(e){if(!e.match(/^[0-9.]+$/))throw"malformed oid string: "+e;var t="",i=e.split("."),a=40*parseInt(i[0])+parseInt(i[1]);t+=l(a),i.splice(0,2);for(var n=0;n<i.length;n++)t+=o(i[n]);this.hTLV=null,this.isModified=!0,this.s=null,this.hV=t},this.setValueName=function(e){var t=ue.asn1.x509.OID.name2oid(e);if(""===t)throw"DERObjectIdentifier oidName undefined: "+e;this.setValueOidString(t)},this.getFreshValueHex=function(){return this.hV},void 0!==e&&("string"==typeof e?e.match(/^[0-2].[0-9.]+$/)?this.setValueOidString(e):this.setValueName(e):void 0!==e.oid?this.setValueOidString(e.oid):void 0!==e.hex?this.setValueHex(e.hex):void 0!==e.name&&this.setValueName(e.name))},ce.lang.extend(ue.asn1.DERObjectIdentifier,ue.asn1.ASN1Object),ue.asn1.DEREnumerated=function(e){ue.asn1.DEREnumerated.superclass.constructor.call(this),this.hT="0a",this.setByBigInteger=function(e){this.hTLV=null,this.isModified=!0,this.hV=ue.asn1.ASN1Util.bigIntToMinTwosComplementsHex(e)},this.setByInteger=function(e){var t=new J(String(e),10);this.setByBigInteger(t)},this.setValueHex=function(e){this.hV=e},this.getFreshValueHex=function(){return this.hV},void 0!==e&&(void 0!==e.int?this.setByInteger(e.int):"number"==typeof e?this.setByInteger(e):void 0!==e.hex&&this.setValueHex(e.hex))},ce.lang.extend(ue.asn1.DEREnumerated,ue.asn1.ASN1Object),ue.asn1.DERUTF8String=function(e){ue.asn1.DERUTF8String.superclass.constructor.call(this,e),this.hT="0c"},ce.lang.extend(ue.asn1.DERUTF8String,ue.asn1.DERAbstractString),ue.asn1.DERNumericString=function(e){ue.asn1.DERNumericString.superclass.constructor.call(this,e),this.hT="12"},ce.lang.extend(ue.asn1.DERNumericString,ue.asn1.DERAbstractString),ue.asn1.DERPrintableString=function(e){ue.asn1.DERPrintableString.superclass.constructor.call(this,e),this.hT="13"},ce.lang.extend(ue.asn1.DERPrintableString,ue.asn1.DERAbstractString),ue.asn1.DERTeletexString=function(e){ue.asn1.DERTeletexString.superclass.constructor.call(this,e),this.hT="14"},ce.lang.extend(ue.asn1.DERTeletexString,ue.asn1.DERAbstractString),ue.asn1.DERIA5String=function(e){ue.asn1.DERIA5String.superclass.constructor.call(this,e),this.hT="16"},ce.lang.extend(ue.asn1.DERIA5String,ue.asn1.DERAbstractString),ue.asn1.DERUTCTime=function(e){ue.asn1.DERUTCTime.superclass.constructor.call(this,e),this.hT="17",this.setByDate=function(e){this.hTLV=null,this.isModified=!0,this.date=e,this.s=this.formatDate(this.date,"utc"),this.hV=stohex(this.s)},this.getFreshValueHex=function(){return void 0===this.date&&void 0===this.s&&(this.date=new Date,this.s=this.formatDate(this.date,"utc"),this.hV=stohex(this.s)),this.hV},void 0!==e&&(void 0!==e.str?this.setString(e.str):"string"==typeof e&&e.match(/^[0-9]{12}Z$/)?this.setString(e):void 0!==e.hex?this.setStringHex(e.hex):void 0!==e.date&&this.setByDate(e.date))},ce.lang.extend(ue.asn1.DERUTCTime,ue.asn1.DERAbstractTime),ue.asn1.DERGeneralizedTime=function(e){ue.asn1.DERGeneralizedTime.superclass.constructor.call(this,e),this.hT="18",this.withMillis=!1,this.setByDate=function(e){this.hTLV=null,this.isModified=!0,this.date=e,this.s=this.formatDate(this.date,"gen",this.withMillis),this.hV=stohex(this.s)},this.getFreshValueHex=function(){return void 0===this.date&&void 0===this.s&&(this.date=new Date,this.s=this.formatDate(this.date,"gen",this.withMillis),this.hV=stohex(this.s)),this.hV},void 0!==e&&(void 0!==e.str?this.setString(e.str):"string"==typeof e&&e.match(/^[0-9]{14}Z$/)?this.setString(e):void 0!==e.hex?this.setStringHex(e.hex):void 0!==e.date&&this.setByDate(e.date),!0===e.millis&&(this.withMillis=!0))},ce.lang.extend(ue.asn1.DERGeneralizedTime,ue.asn1.DERAbstractTime),ue.asn1.DERSequence=function(e){ue.asn1.DERSequence.superclass.constructor.call(this,e),this.hT="30",this.getFreshValueHex=function(){for(var e="",t=0;t<this.asn1Array.length;t++)e+=this.asn1Array[t].getEncodedHex();return this.hV=e,this.hV}},ce.lang.extend(ue.asn1.DERSequence,ue.asn1.DERAbstractStructured),ue.asn1.DERSet=function(e){ue.asn1.DERSet.superclass.constructor.call(this,e),this.hT="31",this.sortFlag=!0,this.getFreshValueHex=function(){for(var e=new Array,t=0;t<this.asn1Array.length;t++){var i=this.asn1Array[t];e.push(i.getEncodedHex())}return 1==this.sortFlag&&e.sort(),this.hV=e.join(""),this.hV},void 0!==e&&void 0!==e.sortflag&&0==e.sortflag&&(this.sortFlag=!1)},ce.lang.extend(ue.asn1.DERSet,ue.asn1.DERAbstractStructured),ue.asn1.DERTaggedObject=function(e){ue.asn1.DERTaggedObject.superclass.constructor.call(this),this.hT="a0",this.hV="",this.isExplicit=!0,this.asn1Object=null,this.setASN1Object=function(e,t,i){this.hT=t,this.isExplicit=e,this.asn1Object=i,this.isExplicit?(this.hV=this.asn1Object.getEncodedHex(),this.hTLV=null,this.isModified=!0):(this.hV=null,this.hTLV=i.getEncodedHex(),this.hTLV=this.hTLV.replace(/^../,t),this.isModified=!1)},this.getFreshValueHex=function(){return this.hV},void 0!==e&&(void 0!==e.tag&&(this.hT=e.tag),void 0!==e.explicit&&(this.isExplicit=e.explicit),void 0!==e.obj&&(this.asn1Object=e.obj,this.setASN1Object(this.isExplicit,this.hT,this.asn1Object)))},ce.lang.extend(ue.asn1.DERTaggedObject,ue.asn1.ASN1Object);var pe,fe,Ee,me=(E(fe=xe,Ee=pe=le),fe.prototype=null===Ee?Object.create(Ee):(ve.prototype=Ee.prototype,new ve),xe.prototype.parseKey=function(e){try{var t=0,i=0,a=/^\s*(?:[0-9A-Fa-f][0-9A-Fa-f]\s*)+$/.test(e)?function(e){var t;if(void 0===p){var i="0123456789ABCDEF",a=" \f\n\r\t \u2028\u2029";for(p={},t=0;t<16;++t)p[i.charAt(t)]=t;for(i=i.toLowerCase(),t=10;t<16;++t)p[i.charAt(t)]=t;for(t=0;t<a.length;++t)p[a.charAt(t)]=-1}var n=[],o=0,r=0;for(t=0;t<e.length;++t){var l=e.charAt(t);if("="==l)break;if(-1!=(l=p[l])){if(void 0===l)throw new Error("Illegal character at offset "+t);o|=l,2<=++r?(n[n.length]=o,r=o=0):o<<=4}}if(r)throw new Error("Hex encoding incomplete: 4 bits missing");return n}(e):m.unarmor(e),n=S.decode(a);if(3===n.sub.length&&(n=n.sub[2].sub[0]),9===n.sub.length){t=n.sub[1].getHexStringValue(),this.n=Y(t,16),i=n.sub[2].getHexStringValue(),this.e=parseInt(i,16);var o=n.sub[3].getHexStringValue();this.d=Y(o,16);var r=n.sub[4].getHexStringValue();this.p=Y(r,16);var l=n.sub[5].getHexStringValue();this.q=Y(l,16);var s=n.sub[6].getHexStringValue();this.dmp1=Y(s,16);var d=n.sub[7].getHexStringValue();this.dmq1=Y(d,16);var c=n.sub[8].getHexStringValue();this.coeff=Y(c,16)}else{if(2!==n.sub.length)return!1;var u=n.sub[1].sub[0];t=u.sub[0].getHexStringValue(),this.n=Y(t,16),i=u.sub[1].getHexStringValue(),this.e=parseInt(i,16)}return!0}catch(e){return!1}},xe.prototype.getPrivateBaseKey=function(){var e={array:[new ue.asn1.DERInteger({int:0}),new ue.asn1.DERInteger({bigint:this.n}),new ue.asn1.DERInteger({int:this.e}),new ue.asn1.DERInteger({bigint:this.d}),new ue.asn1.DERInteger({bigint:this.p}),new ue.asn1.DERInteger({bigint:this.q}),new ue.asn1.DERInteger({bigint:this.dmp1}),new ue.asn1.DERInteger({bigint:this.dmq1}),new ue.asn1.DERInteger({bigint:this.coeff})]};return new ue.asn1.DERSequence(e).getEncodedHex()},xe.prototype.getPrivateBaseKeyB64=function(){return c(this.getPrivateBaseKey())},xe.prototype.getPublicBaseKey=function(){var e=new ue.asn1.DERSequence({array:[new ue.asn1.DERObjectIdentifier({oid:"1.2.840.113549.1.1.1"}),new ue.asn1.DERNull]}),t=new ue.asn1.DERSequence({array:[new ue.asn1.DERInteger({bigint:this.n}),new ue.asn1.DERInteger({int:this.e})]}),i=new ue.asn1.DERBitString({hex:"00"+t.getEncodedHex()});return new ue.asn1.DERSequence({array:[e,i]}).getEncodedHex()},xe.prototype.getPublicBaseKeyB64=function(){return c(this.getPublicBaseKey())},xe.wordwrap=function(e,t){if(!e)return e;var i="(.{1,"+(t=t||64)+"})( +|$\n?)|(.{1,"+t+"})";return e.match(RegExp(i,"g")).join("\n")},xe.prototype.getPrivateKey=function(){var e="-----BEGIN RSA PRIVATE KEY-----\n";return(e+=xe.wordwrap(this.getPrivateBaseKeyB64())+"\n")+"-----END RSA PRIVATE KEY-----"},xe.prototype.getPublicKey=function(){var e="-----BEGIN PUBLIC KEY-----\n";return(e+=xe.wordwrap(this.getPublicBaseKeyB64())+"\n")+"-----END PUBLIC KEY-----"},xe.hasPublicKeyProperty=function(e){return(e=e||{}).hasOwnProperty("n")&&e.hasOwnProperty("e")},xe.hasPrivateKeyProperty=function(e){return(e=e||{}).hasOwnProperty("n")&&e.hasOwnProperty("e")&&e.hasOwnProperty("d")&&e.hasOwnProperty("p")&&e.hasOwnProperty("q")&&e.hasOwnProperty("dmp1")&&e.hasOwnProperty("dmq1")&&e.hasOwnProperty("coeff")},xe.prototype.parsePropertiesFrom=function(e){this.n=e.n,this.e=e.e,e.hasOwnProperty("d")&&(this.d=e.d,this.p=e.p,this.q=e.q,this.dmp1=e.dmp1,this.dmq1=e.dmq1,this.coeff=e.coeff)},xe),ge=(he.prototype.setKey=function(e){this.log&&this.key&&console.warn("A key was already set, overriding existing."),this.key=new me(e)},he.prototype.setPrivateKey=function(e){this.setKey(e)},he.prototype.setPublicKey=function(e){this.setKey(e)},he.prototype.decrypt=function(e){try{return this.getKey().decrypt(u(e))}catch(e){return!1}},he.prototype.encrypt=function(e){try{return c(this.getKey().encrypt(e))}catch(e){return!1}},he.prototype.sign=function(e,t,i){try{return c(this.getKey().sign(e,t,i))}catch(e){return!1}},he.prototype.verify=function(e,t,i){try{return this.getKey().verify(e,u(t),i)}catch(e){return!1}},he.prototype.getKey=function(e){if(!this.key){if(this.key=new me,e&&"[object Function]"==={}.toString.call(e))return void this.key.generateAsync(this.default_key_size,this.default_public_exponent,e);this.key.generate(this.default_key_size,this.default_public_exponent)}return this.key},he.prototype.getPrivateKey=function(){return this.getKey().getPrivateKey()},he.prototype.getPrivateKeyB64=function(){return this.getKey().getPrivateBaseKeyB64()},he.prototype.getPublicKey=function(){return this.getKey().getPublicKey()},he.prototype.getPublicKeyB64=function(){return this.getKey().getPublicBaseKeyB64()},he.version="3.0.0-rc.1",he);function he(e){e=e||{},this.default_key_size=parseInt(e.default_key_size,10)||1024,this.default_public_exponent=e.default_public_exponent||"010001",this.log=e.log||!1,this.key=null}function xe(e){var t=pe.call(this)||this;return e&&("string"==typeof e?t.parseKey(e):(xe.hasPrivateKeyProperty(e)||xe.hasPublicKeyProperty(e))&&t.parsePropertiesFrom(e)),t}function ve(){this.constructor=fe}window.JSEncrypt=ge,e.JSEncrypt=ge,e.default=ge,Object.defineProperty(e,"__esModule",{value:!0})}),Ext.define("JE.sys.flowchart.util.Editor",{extend:"JE.core.ux.mxgraph.util.Editor",thumbWidth:40,thumbHeight:40,thumbStyle:"margin:10px;text-align:center;",initAction:function(){var e=this;e.callParent(arguments),e.addAction("save",function(){e.saveAction&&e.saveAction(e.getData())})}}),Ext.define("JE.sys.flowchart.view.Cells",{extend:"Ext.panel.Panel",alias:"widget.flowchart.cells",layout:{type:"accordion",animate:!0},defaults:{border:1,autoScroll:!0,layout:"fit",bodyPadding:5,xtype:"panel"},initComponent:function(e){items=[{title:"【工作流】",itemId:"workflowcells",fn:"addWorkflowPalette",iconCls:"jeicon jeicon-user-department"},{title:"【常用】",itemId:"generalcells",fn:"addGeneralPalette",iconCls:"jeicon jeicon-circular-o"},{title:"【元素】",itemId:"basiccells",fn:"addBasicPalette",iconCls:"jeicon jeicon-pie-chart"},{title:"【流程】",itemId:"flowchartcells",fn:"addFlowchartPalette",iconCls:"jeicon jeicon-sitemap-three"},{title:"【箭头】",itemId:"arrowcells",fn:"addArrowsPalette",iconCls:"jeicon jeicon-arrow"}],this.items=items,this.callParent(arguments)},afterRender:function(){var t=this;t.callParent(arguments),t.editor.editorUI.sidebar.container=t.body.dom,t.items.each(function(e){e.body&&t.editor.editorUI.sidebar[e.fn](e.body.dom)})}}),Ext.define("JE.sys.flowchart.view.Graph",{extend:"JE.core.ux.mxgraph.Graph",alias:"widget.flowchart.graph",initComponent:function(){var e=this,t=[{iconCls:"jeicon jeicon-check-circle",ref:"save",hidden:1==e.readOnly,handler:function(){e.editor.doAction("save")},tooltip:"确定"},"-"];t=t.concat(e.buildTbar()),e.dockedItems=[{xtype:"toolbar",dock:"top",defaults:{scale:"medium"},items:t}],e.callParent(arguments)},afterRender:function(){var i=this;i.callParent(arguments);new Ext.util.KeyMap({target:i.getEl(),binding:[{key:Ext.EventObject.S,ctrl:!0,fn:function(e,t){t.stopEvent(),i.editor.doAction("save")}}]})}}),Ext.define("JE.sys.flowchart.view.MainView",{extend:"Ext.panel.Panel",alias:"widget.flowchart.mainview",layout:"border",border:0,bodyPadding:"2",initComponent:function(){this.editor||(this.editor=Ext.create("JE.sys.flowchart.util.Editor",{saveAction:this.saveAction})),this.defaults={editor:this.editor},this.items=Ext.value(this.items,[]),this.items.push({xtype:"flowchart.graph",itemId:"flowchart.graph",region:"center"},{xtype:"mxgraph.cells",itemId:"flowchart.cells",region:"west"}),this.callParent(arguments)},afterRender:function(){this.callParent(arguments),this.initAction&&this.initAction(this)}}),Ext.define("JE.sys.flowchart.controller.FlowChartCtr",{extend:"Ext.app.Controller",init:function(){this.control({})},views:["JE.sys.flowchart.view.MainView","JE.sys.flowchart.view.Graph","JE.sys.flowchart.view.Cells"],stores:[],models:[]}),Ext.define("JE.sys.documentation.util.DocumentationUtil",{queryFile:function(e,t,i,a){var n=e.form.getValues();a.getDockedItems('toolbar[dock="bottom"]')[0].show();var o=a.down("button[ref=permOne]"),r=a.down("button[ref=permBatch]"),l=this.getFileView(a).getStore();a.modeType="QUERY";var s=a.down("button[ref=oper]"),d=a.down("button[ref=addDir]"),c=a.down("button[ref=addFile]"),u=a.down("button[ref=callQueryBtn]");l.getProxy().extraParams.tableCode="JE_SYS_DOCUMENTATION",d.setDisabled(!0),c.setDisabled(!0),u.setVisible(!0),s.show(),"COMPANY"!=a.fileMode||a.readOnly||(o.show(),r.show()),this.setButtons("QUERY",s),a.readOnly&&this.setButtons("READONLY",s);var p=i.getDockedItems("toolbar[dock=top]")[0];this.updateToolbar(null,p,null,"QUERY");var f="",E=" AND SY_CREATEUSER='"+JE.currentUser.userCode+"'",m=this.getOrderSql(a.orderType);Ext.isEmpty(n.JE_SYS_FILENAME)||(f+=" AND DOCUMENTATION_TEXT like '%"+n.JE_SYS_FILENAME+"%'"),Ext.isEmpty(n.JE_SYS_DIRID)||(f+=" AND SY_PATH like '%"+n.JE_SYS_DIRID+"%'");var g=new Array;if(Ext.isEmpty(n.JE_SYS_FILETYPE)||Ext.each(n.JE_SYS_FILETYPE.split(","),function(e){switch(e){case"doc":g.push("doc"),g.push("docx");break;case"xls":g.push("xls"),g.push("xlsx");break;case"pdf":g.push("pdf");break;case"ppt":g.push("ppt"),g.push("pptx");break;case"zip":g.push("zip"),g.push("rar");break;case"jpg":g.push("jpg"),g.push("png"),g.push("gif"),g.push("ico"),g.push("bmp"),g.push("jpeg");break;case"mp4":g.push("avi"),g.push("mov"),g.push("wmv"),g.push("wmv"),g.push("mp4"),g.push("flv"),g.push("rmvb");break;case"mp3":g.push("mp3");break;case"png":g.push("dwf"),g.push("dwg")}}),Ext.isEmpty(n.JE_SYS_DIYTYPE)||Ext.each(n.JE_SYS_DIYTYPE.split(","),function(e){g.push(e)}),0<g.length&&(f+=" AND DOCUMENTATION_FILETYPE IN ('"+g.join("','")+"')"),Ext.isEmpty(n.JE_SYS_DIYSTARTSIZE))if(Ext.isEmpty(n.JE_SYS_DIYENDSIZE)){if("all"!=n.JE_SYS_FILESIZE)switch(n.JE_SYS_FILESIZE){case"1000000":f+=" AND DOCUMENTATION_SIZE>1000000000 ";break;case"100000":f+=" AND DOCUMENTATION_SIZE>100000000 ";break;case"1000":f+=" AND DOCUMENTATION_SIZE>1000000 ";break;case"-1000":f+=" AND DOCUMENTATION_SIZE<1000000 ";break;case"100":f+=" AND DOCUMENTATION_SIZE>100000 "}}else{f+=" AND DOCUMENTATION_SIZE<="+1e6*Ext.value(n.JE_SYS_DIYENDSIZE,0)}else f+=" AND DOCUMENTATION_SIZE>="+1e6*Ext.value(n.JE_SYS_DIYSTARTSIZE,0);if(Ext.isEmpty(n.JE_SYS_DIYDATE)){if("all"!=n.JE_SYS_MODFIYDATE){var h=new Date;switch(n.JE_SYS_MODFIYDATE){case"week":var x=new Date,v=h.getDay();x.setDate(x.getDate()-v+1),h.setDate(h.getDate()+(7-v)),f+=" AND SY_MODIFYTIME>='"+Ext.Date.format(x,"Y-m-d")+" 00:00:00' AND SY_MODIFYTIME<='"+Ext.Date.format(h,"Y-m-d")+" 23:59:59'";break;case"month":var y=Ext.Date.format(h,"Y-m");f+=" AND SY_MODIFYTIME>='"+y+"-01 00:00:00' AND SY_MODIFYTIME<='"+y+"-31 23:59:59'";break;case"year":f+=" AND SY_MODIFYTIME>='"+(b=Ext.Date.format(h,"Y"))+"-01-01 00:00:00' AND SY_MODIFYTIME<='"+b+"-12-31 23:59:59'";break;case"beforeyear":var b;h.setYear(h.getYear()+1900-1),f+=" AND SY_MODIFYTIME>='"+(b=Ext.Date.format(h,"Y"))+"-01-01 00:00:00' AND SY_MODIFYTIME<='"+b+"-12-31 23:59:59'"}}}else f+=" AND SY_MODIFYTIME>='"+n.JE_SYS_DIYDATE+" 00:00:00' AND SY_MODIFYTIME<='"+n.JE_SYS_DIYDATE+" 23:59:59'";l.proxy.extraParams.whereSql="",l.proxy.extraParams.querySql=f,l.proxy.extraParams.permSql=E,l.proxy.extraParams.baseSql="AND SY_STATUS='1'",l.proxy.extraParams.orderSql=m,l.proxy.extraParams.dirOnly=!1,l.loadPage(1)},openFile:function(e,t,i){var a=i.proxy.extraParams.tableCode;if("JE_SYS_DOCUMENTATION"==a&&!JE.ajax({url:JE.getUrlMaps("je.core.doc.documentation","doOpenFile"),params:{tableCode:a,pkValue:t.get("JE_SYS_DOCUMENTATION_ID")}}).success)return void JE.alert(JE.getLocalLang("sys.document.util.updateTimeAlert"));if("DIR"==t.get("DOCUMENTATION_TYPE")){var n=e.getStore().getNodeById(t.get("JE_SYS_DOCUMENTATION_ID"));if(n)e.selectPath(n.getPath());else{if(e.readOnly)return;var o=!0;"COMPANY"!=e.fileMode||this.checkUpdatePerm(t.get("DOCUMENTATION_PERMJSON"),t.get("SY_CREATEUSERID"),!0)||(o=!1),"1"==t.get("DOCUMENTATION_PACKAGE")?JE.win({title:t.get("DOCUMENTATION_TEXT"),iconCls:"jeicon jeicon-zip",useButton:!1,layout:"border",autoShow:!0,width:JE.getBodyWidth()-300,height:JE.getBodyHeight()-300,items:[{xtype:"documentation.zipdirtree",region:"west",title:t.get("DOCUMENTATION_TEXT"),permStatus:o,iconCls:"jeicon jeicon-zip",width:200,fileMode:e.fileMode,zipId:t.get("JE_SYS_DOCUMENTATION_ID")},{xtype:"documentation.zipfileview",region:"center",fileMode:e.fileMode,zipId:t.get("JE_SYS_DOCUMENTATION_ID")}]}):JE.alert(JE.getLocalLang("sys.document.ctr.noFindFolderAlert"))}}else{var r=new Array;i.each(function(e){"DIR"!=e.get("DOCUMENTATION_TYPE")&&r.push({id:e.get("JE_SYS_DOCUMENTATION_ID"),name:e.get("DOCUMENTATION_TEXT"),path:e.get("DOCUMENTATION_ADDRESS")})}),JE.File.openFileByExtension(t,!1,r,"docinfo")}},updateToolbar:function(e,t,i,a){t.removeAll();var n=new Array;if(n.push({xtype:"button",tooltip:JE.getLocalLang("sys.document.util.upTip"),iconCls:"jeicon jeicon-calendar-back-o",modeType:a,ref:"upDirBtn"}),n.push("-"),"QUERY"==a)return n.push({xtype:"button",ref:"dirBtn",text:JE.getLocalLang("sys.document.util.fileSearch"),iconCls:"jeicon jeicon-search",modeType:a}),void t.add(n);if(i){var o=i.getPath(),r=e.getStore();Ext.each(o.split("/"),function(e){if(!Ext.isEmpty(e)){var t=r.getNodeById(e);t&&"ROOT"!=t.get("id")&&("SYSTEM"!=t.get("nodeInfo")&&"ROOT"!=t.get("parentId")&&n.push(">"),n.push({xtype:"button",ref:"dirBtn",text:t.get("text"),iconCls:t.get("iconCls"),nodeId:e,modeType:a}))}}),t.add(n)}else t.add(n)},getFileView:function(e){return"detailed"==e.viewType?e.down("gridpanel"):e.down("dataview")},doZipFile:function(e,t,i){var n=this,o=Ext.apply(JE.getLocalLang("sys.document.util"),JE.getLocalLang("sys.document.treeMenu")),r=t.down("dataview");"detailed"==t.modeType&&(r=t.down("gridpanel"));var l=e.getStore(),s=r.getSelectionModel().getSelection();switch(i){case"seeFile":if(0==s.length)JE.alert(o.selectAlert);else if(1<s.length)JE.alert(JE.format(o.selectOneAlert,o.browse));else if("DIR"==s[0].get("DOCUMENTATION_TYPE"))n.openFile(fileMenuTree,s[0],r.getStore());else{var a=new Array;r.getStore().each(function(e){"DIR"!=e.get("DOCUMENTATION_TYPE")&&a.push({id:e.get("JE_SYS_DOCUMENTATION_ID"),name:e.get("DOCUMENTATION_TEXT"),path:e.get("DOCUMENTATION_ADDRESS")})}),JE.File.openFileByExtension(record[0],!0,a,"docinfo")}break;case"downloadFile":if(0==s.length)JE.alert(o.selectAlert);else if(1<s.length)JE.alert(JE.format(o.selectOneAlert,o.download));else if("DIR"==s[0].get("DOCUMENTATION_TYPE")&&"1"!=s[0].get("DOCUMENTATION_PACKAGE"))JE.alert(o.folderCantDownload);else if("DIR"==s[0].get("DOCUMENTATION_TYPE")&&"1"==s[0].get("DOCUMENTATION_PACKAGE")){var d=JE.getUrlMaps("je.core.doc.documentation","downloadPackage");window.open(d+"?ieFlag="+(Ext.isIE?"1":"0")+"&fileName="+encodeURIComponent(s[0].get("DOCUMENTATION_TEXT"))+"&pkValue="+s[0].get("JE_SYS_DOCUMENTATION_ID"))}else window.open(JE.getUrlMaps("je.core.doc.document.download")+"?ieFlag="+(Ext.isIE?"1":"0")+"&path="+s[0].get("DOCUMENTATION_ADDRESS")+"&fileName="+encodeURIComponent(s[0].get("DOCUMENTATION_TEXT"))+"&type=docinfo&pkValue="+s[0].get("JE_SYS_DOCUMENTATION_ID"));break;case"rename":if(0==s.length)JE.alert(o.selectAlert);else if(1<s.length)JE.alert(JE.format(o.selectOneAlert,o.operation));else{if(!e.permStatus)return void JE.alert(o.noPermAlert);var c="",u="0";"DIR"!=s[0].get("DOCUMENTATION_TYPE")&&-1!=s[0].get("DOCUMENTATION_TEXT").lastIndexOf(".")&&(c=s[0].get("DOCUMENTATION_TEXT").substring(s[0].get("DOCUMENTATION_TEXT").lastIndexOf(".")+1)),JE.prompt(o.newNameAlert,function(e,t){if("cancel"!=e&&!Ext.isEmpty(t)){if("DIR"!=s[0].get("DOCUMENTATION_TYPE")){var i="";if(-1!=t.lastIndexOf(".")&&(i=t.substring(t.lastIndexOf(".")+1)),Ext.isEmpty(c)&&!Ext.isEmpty(i))u="1";else if(c!=i)return void JE.alert(o.nameCantUpdate)}if(!n.checkFileName(t,s[0].get("DOCUMENTATION_TYPE"),r.getStore().data.items))return JE.alert(o.nameIllegalAlert),!1;if(JE.ajax({url:JE.getUrlMaps("je.core.doc.documentation","doUpdate"),params:{tableCode:"JE_SYS_DOCUMENTATION",DOCUMENTATION_ADDRESS:s[0].get("DOCUMENTATION_ADDRESS"),syncFileType:u,JE_SYS_DOCUMENTATION_ID:s[0].get("JE_SYS_DOCUMENTATION_ID"),DOCUMENTATION_TEXT:t}}).success){if(s[0].set("DOCUMENTATION_TEXT",t),s[0].commit(),"DIR"==s[0].get("DOCUMENTATION_TYPE")){var a=l.getNodeById(s[0].get("JE_SYS_DOCUMENTATION_ID"));a&&(a.set("text",t),a.commit())}JE.msg(o.renameSuccess)}else JE.alert(o.renameFailure)}},null,s[0].get("DOCUMENTATION_TEXT"))}break;case"remove":if(0<s.length){if(!e.permStatus)return void JE.alert(o.noPermAlert);var p=new Array;Ext.each(s,function(e){p.push(e.get("JE_SYS_DOCUMENTATION_ID"))}),JE.confirm(o.deleteConfirm,function(e){"ok"==e&&(JE.ajax({url:JE.getUrlMaps("je.core.doc.documentation","doDisable"),params:{tableCode:"JE_SYS_DOCUMENTATION",ids:p.join(",")}}).success?(Ext.each(s,function(e){if("DIR"==e.get("DOCUMENTATION_TYPE")){var t=l.getNodeById(e.get("JE_SYS_DOCUMENTATION_ID"));t&&t.remove()}}),r.getStore().remove(s),JE.msg(o.deleteSuccess)):JE.alert(o.deleteFailure))})}else JE.alert(o.selectAlert);break;case"selectAll":r.getSelectionModel().selectAll();break;case"refresh":r.getSelectionModel().deselectAll(),r.getStore().load()}},doFile:function(s,d,e){var o=this,r=o.getFileView(d),l=(r.getStore().proxy.extraParams.tableCode,s.getStore()),c=r.getSelectionModel().getSelection(),u=Ext.apply(JE.getLocalLang("sys.document.util"),JE.getLocalLang("sys.document.treeMenu"));switch(e){case"openFile":0==c.length?JE.alert(u.selectAlert):1<c.length?JE.alert(JE.format(u.selectOneAlert,u.open)):o.openFile(s,c[0],r.getStore());break;case"seeFile":if(0==c.length)JE.alert(u.selectAlert);else if(1<c.length)JE.alert(JE.format(u.selectOneAlert,u.browse));else if("DIR"==c[0].get("DOCUMENTATION_TYPE"))o.openFile(s,c[0],r.getStore());else{var t=new Array;r.getStore().each(function(e){"DIR"!=e.get("DOCUMENTATION_TYPE")&&t.push({id:e.get("JE_SYS_DOCUMENTATION_ID"),name:e.get("DOCUMENTATION_TEXT"),path:e.get("DOCUMENTATION_ADDRESS")})}),JE.File.openFileByExtension(c[0],!0,t,"docinfo")}break;case"downloadFile":if(0==c.length)JE.alert(u.selectAlert);else if(1<c.length)JE.alert(JE.format(u.selectOneAlert,u.download));else if("DIR"==c[0].get("DOCUMENTATION_TYPE")&&"0"==c[0].get("DOCUMENTATION_PACKAGE"))JE.alert(u.folderCantDownload);else if("DIR"==c[0].get("DOCUMENTATION_TYPE")&&"1"==c[0].get("DOCUMENTATION_PACKAGE")){var i=JE.getUrlMaps("je.core.doc.documentation","downloadPackage");window.open(i+"?ieFlag="+(Ext.isIE?"1":"0")+"&fileName="+encodeURIComponent(c[0].get("DOCUMENTATION_TEXT"))+"&pkValue="+c[0].get("JE_SYS_DOCUMENTATION_ID"))}else window.open(JE.getUrlMaps("je.core.doc.document.download")+"?ieFlag="+(Ext.isIE?"1":"0")+"&fileName="+encodeURIComponent(c[0].get("DOCUMENTATION_TEXT"))+"&pkValue="+c[0].get("JE_SYS_DOCUMENTATION_ID"));break;case"packageDownload":0==c.length?JE.alert(u.selectAlert):JE.prompt(u.packageAlert,function(e,t){if("cancel"!=e&&!Ext.isEmpty(t)){var i=new Array;Ext.each(c,function(e){i.push(e.get("JE_SYS_DOCUMENTATION_ID"))});var a=" AND JE_SYS_DOCUMENTATION_ID IN ('"+i.join("','")+"')";if("FILE"==d.modeType){var n=s.getSelectionModel().getSelection()[0];if(!n)return void JE.alert(u.selectFolderAlert);var o=n.get("id");"myfile"==o&&(o="ROOT");var r=JE.getUrlMaps("je.core.doc.documentation","downloadPackage");window.open(r+"?ieFlag="+(Ext.isIE?"1":"0")+"&fileName="+encodeURIComponent(t+".zip")+"&pkValue="+o)}else{var l=JE.getUrlMaps("je.core.doc.documentation","downloadZip");window.open(l+"?ieFlag="+(Ext.isIE?"1":"0")+"&fileName="+encodeURIComponent(t+".zip")+"&querySql="+encodeURIComponent(a))}}});break;case"copyFile":if(0==c.length)JE.alert(u.selectAlert);else{var a=[],n=[];Ext.each(c,function(e){a.push({JE_SYS_DOCUMENTATION_ID:e.get("JE_SYS_DOCUMENTATION_ID"),DOCUMENTATION_TYPE:e.get("DOCUMENTATION_TYPE")}),n.push("<font color=red>"+e.get("DOCUMENTATION_TEXT")+"</font>")}),o.copyInfo={oper:"copy",datas:a},JE.msg(u.copyAlert)}break;case"cutFile":if(0==c.length)JE.alert(u.selectAlert);else{a=[],n=[];var p=!0;if(Ext.each(c,function(e){"COMPANY"!=s.fileMode||o.checkUpdatePerm(e.get("DOCUMENTATION_PERMJSON"),e.get("SY_CREATEUSERID"),!0)||(p=!1),a.push({JE_SYS_DOCUMENTATION_ID:e.get("JE_SYS_DOCUMENTATION_ID"),DOCUMENTATION_TYPE:e.get("DOCUMENTATION_TYPE")}),n.push("<font color=red>"+e.get("DOCUMENTATION_TEXT")+"</font>")}),!p)return void JE.alert(u.noPermAlert);o.copyInfo={oper:"cut",datas:a},JE.msg(u.copyAlert)}break;case"pasteFile":if(o.copyInfo){e=o.copyInfo.oper;var f=new Array,E=new Array,m=s.getSelectionModel().getSelection()[0];if("COMPANY"==s.fileMode&&!o.checkUpdatePerm(m.get("description"),m.get("bean").SY_CREATEUSERID))return void JE.alert(u.noPermAlert);if(Ext.each(o.copyInfo.datas,function(e){"FUNC"==e.DOCUMENTATION_TYPE?E.push(e.JE_SYS_DOCUMENTATION_ID):f.push(e.JE_SYS_DOCUMENTATION_ID)}),(h=JE.ajax({url:JE.getUrlMaps("je.core.doc.documentation","paste"),params:{tableCode:"JE_SYS_DOCUMENTATION",JE_SYS_DOCUMENTATION_ID:"myfile"==m.get("id")?"ROOT":m.get("id"),oper:e,fileMode:s.fileMode,ids:f.join(","),funcFileIds:E.join(",")}})).success){var g=r.getStore();Ext.each(h.obj,function(e){var t=e.SY_PARENT;if("ROOT"==t&&(t="myfile"),"DIR"==e.DOCUMENTATION_TYPE){l.getNodeById(e.JE_SYS_DOCUMENTATION_ID).remove();var i=l.getNodeById(t),a={id:e.JE_SYS_DOCUMENTATION_ID,text:e.DOCUMENTATION_TEXT,code:e.DOCUMENTATION_CODE,leaf:"LEAF"==e.SY_NODETYPE,nodePath:e.SY_PATH,parentPath:e.SY_PARENTPATH,nodeInfoType:e.DOCUMENTATION_TYPE,iconCls:e.DOCUMENTATION_ICONCLS,parent:e.SY_PARENT,children:[],description:e.DOCUMENTATION_PERMJSON,bean:e,expandable:!0};i.appendChild(a)}s.getSelectionModel().getSelection()[0].get("id")==t&&g.add(e)}),JE.msg(u.pasteAlert)}else JE.alert(h.obj)}else JE.alert(u.cutEmptyAlert);break;case"reducePackage":if(c.length<=0)return void JE.alert(u.selectAlert);m=s.getSelectionModel().getSelection()[0];if("COMPANY"==s.fileMode&&!o.checkUpdatePerm(m.get("description"),m.get("bean").SY_CREATEUSERID))return void JE.alert(u.noPermAlert);JE.prompt(u.packageAlert,function(e,t){if("cancel"!=e&&!Ext.isEmpty(t)){if(!o.checkFileName(t,"DIR",r.getStore().data.items))return JE.alert(u.nameIllegalAlert),!1;var i=new Array;Ext.each(c,function(e){i.push(e.get("JE_SYS_DOCUMENTATION_ID"))});var a=JE.ajax({url:JE.getUrlMaps("je.core.doc.documentation","packageFile"),params:{tableCode:"JE_SYS_DOCUMENTATION",DOCUMENTATION_TEXT:t,fileMode:s.fileMode,JE_SYS_DOCUMENTATION_ID:"myfile"==m.get("id")?"ROOT":m.get("id"),ids:i.join(",")}});if(a.success){var n=r.getStore();Ext.each(a.obj,function(e){var t=e.SY_PARENT;"ROOT"==t&&(t="myfile"),s.getSelectionModel().getSelection()[0].get("id")==t&&n.add(e)}),JE.msg(u.packageSuccess)}else JE.alert(a.obj)}});break;case"addUse":if(0<c.length){var h;f=new Array;if(Ext.each(c,function(e){"DIR"==e.get("DOCUMENTATION_TYPE")&&"0"==e.get("DOCUMENTATION_PACKAGE")&&f.push(e.get("JE_SYS_DOCUMENTATION_ID"))}),f.length==c.length)(h=JE.ajax({url:JE.getUrlMaps("je.core.doc.documentation","addFaster"),params:{tableCode:"JE_SYS_DOCUMENTATION",ids:f.join(","),fileMode:s.fileMode}})).success?(JE.msg(h.obj),s.loadFaster()):JE.alert(h.obj);else JE.alert(u.commonAlert)}else JE.alert(u.selectFolderAlert);break;case"sendExpress":if(0<c.length){t=new Array;Ext.each(c,function(e){"DIR"!=e.get("DOCUMENTATION_TYPE")&&t.push({id:"",name:e.get("DOCUMENTATION_TEXT"),cls:e.get("DOCUMENTATION_BIGICONCLS"),path:e.get("DOCUMENTATION_ADDRESS")})}),0<t.length?JE.showFunc("JE_SYS_OUTBOX",{type:"form",values:{OUTBOX_SEND:"0",OUTBOX_TYPE:"OUTBOX",OUTBOX_SUBJECT:"",OUTBOX_CONTEXT:"",OUTBOX_DFJ:JE.toStr(t)},callback:function(e){e.form.findField("OUTBOX_DFJ").doChange(!0)}}):JE.alert(u.sendAlert)}else JE.alert(u.selectAlert);break;case"rename":if(0==c.length)JE.alert(u.selectAlert);else if(1<c.length)JE.alert(JE.format(u.selectOneAlert,u.operation));else{var x="",v="0";if("DIR"!=c[0].get("DOCUMENTATION_TYPE")&&-1!=c[0].get("DOCUMENTATION_TEXT").lastIndexOf(".")&&(x=c[0].get("DOCUMENTATION_TEXT").substring(c[0].get("DOCUMENTATION_TEXT").lastIndexOf(".")+1)),"COMPANY"==s.fileMode&&!o.checkUpdatePerm(c[0].get("DOCUMENTATION_PERMJSON"),c[0].get("SY_CREATEUSERID"),!0))return void JE.alert(u.noPermAlert);JE.prompt(u.newNameAlert,function(e,t){if("cancel"!=e&&!Ext.isEmpty(t)){if("DIR"!=c[0].get("DOCUMENTATION_TYPE")){var i="";if(-1!=t.lastIndexOf(".")&&(i=t.substring(t.lastIndexOf(".")+1)),Ext.isEmpty(x)&&!Ext.isEmpty(i))v="1";else if(x!=i)return void JE.alert(u.nameCantUpdate)}if(!o.checkFileName(t,c[0].get("DOCUMENTATION_TYPE"),r.getStore().data.items))return JE.alert(u.nameIllegalAlert),!1;if(JE.ajax({url:JE.getUrlMaps("je.core.doc.documentation","doUpdate"),params:{tableCode:"JE_SYS_DOCUMENTATION",DOCUMENTATION_ADDRESS:c[0].get("DOCUMENTATION_ADDRESS"),syncFileType:v,JE_SYS_DOCUMENTATION_ID:c[0].get("JE_SYS_DOCUMENTATION_ID"),DOCUMENTATION_TEXT:t}}).success){if(c[0].set("DOCUMENTATION_TEXT",t),c[0].commit(),"DIR"==c[0].get("DOCUMENTATION_TYPE")){var a=l.getNodeById(c[0].get("JE_SYS_DOCUMENTATION_ID"));a&&(a.set("text",t),a.commit())}JE.msg(u.renameSuccess)}else JE.alert(u.renameFailure)}},null,c[0].get("DOCUMENTATION_TEXT"))}break;case"remove":if(0<c.length){f=new Array,p=!0;if(Ext.each(c,function(e){"COMPANY"!=s.fileMode||o.checkUpdatePerm(e.get("DOCUMENTATION_PERMJSON"),e.get("SY_CREATEUSERID"),!0)||(p=!1),f.push(e.get("JE_SYS_DOCUMENTATION_ID"))}),!p)return void JE.alert(u.noPermAlert);JE.confirm(u.deleteConfirm,function(e){"ok"==e&&(JE.ajax({url:JE.getUrlMaps("je.core.doc.documentation","doDisable"),params:{tableCode:"JE_SYS_DOCUMENTATION",ids:f.join(",")}}).success?(Ext.each(c,function(e){if("DIR"==e.get("DOCUMENTATION_TYPE")){var t=l.getNodeById(e.get("JE_SYS_DOCUMENTATION_ID"));t&&t.remove()}}),s.loadFaster(),r.getStore().remove(c),JE.msg(u.deleteSuccess)):JE.alert(u.deleteFailure))})}else JE.alert(u.selectAlert);break;case"selectAll":r.getSelectionModel().selectAll();break;case"refresh":r.getSelectionModel().deselectAll(),r.getStore().load(),o.copyInfo=null;break;case"restore":if(0<c.length){f=new Array,p=!0;if(Ext.each(c,function(e){"COMPANY"!=s.fileMode||o.checkUpdatePerm(e.get("DOCUMENTATION_PERMJSON"),e.get("SY_CREATEUSERID"),!0)||(p=!1),f.push(e.get("JE_SYS_DOCUMENTATION_ID"))}),!p)return void JE.alert(u.noPermAlert);JE.confirm(u.restoreAlert,function(e){if("ok"==e){var t=JE.getUrlMaps("je.core.doc.documentation","doRestore");JE.ajax({url:t,params:{tableCode:"JE_SYS_DOCUMENTATION",ids:f.join(",")}}).success?(Ext.each(c,function(e){if("DIR"==e.get("DOCUMENTATION_TYPE")){var t=e.get("SY_PARENT");"ROOT"==t&&(t="myfile");var i=l.getNodeById(t);if(i){var a=e.data,n={id:a.JE_SYS_DOCUMENTATION_ID,text:a.DOCUMENTATION_TEXT,code:a.DOCUMENTATION_CODE,leaf:"LEAF"==a.SY_NODETYPE,nodePath:a.SY_PATH,parentPath:a.SY_PARENTPATH,nodeInfoType:a.DOCUMENTATION_TYPE,iconCls:a.DOCUMENTATION_ICONCLS,parent:a.SY_PARENT,children:[],description:a.DOCUMENTATION_PERMJSON,bean:a,expandable:!0};i.appendChild(n)}}}),r.getStore().remove(c),JE.msg(u.restoreSuccess)):JE.alert(u.restoreFailure)}})}else JE.alert(u.selectAlert);break;case"sheerRemove":if(0<c.length){p=!0;if(Ext.each(c,function(e){"COMPANY"!=s.fileMode||o.checkUpdatePerm(e.get("DOCUMENTATION_PERMJSON"),e.get("SY_CREATEUSERID"),!0)||(p=!1)}),!p)return void JE.alert(u.noPermAlert);JE.confirm(u.deleteAlert,function(e){if("ok"==e){var t=new Array;Ext.each(c,function(e){t.push(e.get("JE_SYS_DOCUMENTATION_ID"))}),JE.ajax({url:JE.getUrlMaps("je.core.doc.documentation","doRemove"),params:{tableCode:"JE_SYS_DOCUMENTATION",ids:t.join(","),fileMode:s.fileMode}}).success?(r.getStore().load(),JE.msg(u.deleteSuccess)):JE.alert(u.deleteFailure)}})}else JE.alert(u.selectAlert);break;case"clearRecycle":JE.confirm(u.clearAlert,function(e){"ok"==e&&(JE.ajax({url:JE.getUrlMaps("je.core.doc.documentation","doClear"),params:{tableCode:"JE_SYS_DOCUMENTATION",fileMode:s.fileMode}}).success?(r.getStore().loadPage(1),JE.msg(u.clearSuccess)):JE.alert(u.clearFailure))});break;case"perm":break;case"attribute":if(0==c.length)return void JE.alert(u.selectAlert);if(1<c.length)return void JE.alert(JE.format(u.selectOneAlert,u.operation));var y=c[0],b=Ext.clone(y.data),C=!1;"DIR"==b.DOCUMENTATION_TYPE?(b.DOCUMENTATION_TYPENAME="文件夹","1"==b.DOCUMENTATION_PACKAGE&&(b.DOCUMENTATION_TYPENAME="压缩包"),C=!0):(b.DOCUMENTATION_TYPENAME="文件",b.DOCUMENTATION_FILE=b.DOCUMENTATION_TEXT+"*"+b.DOCUMENTATION_ADDRESS);var w=JE.getLocalLang("sys.document.fileData");JE.formWin({title:u.attribute,width:577,height:343,border:0,frame:!1,autoShow:!0,iconCls:b.DOCUMENTATION_ICONCLS,formConfig:{bodyPadding:"10 10 0 10"},defaults:{xtype:"textfield",readOnly:!0,columnWidth:.5,padding:"3 0 3 0"},items:[{hidden:!0,name:"JE_SYS_DOCUMENTATION_ID",fieldLabel:"主键ID"},{name:"DOCUMENTATION_TEXT",fieldLabel:w.name},{name:"DOCUMENTATION_TYPENAME",fieldLabel:w.type},{xtype:"uxfilefield",name:"DOCUMENTATION_FILE",fieldLabel:w.path,hidden:C},{name:"DOCUMENTATION_FILETYPENAME",fieldLabel:w.type,hidden:C},{name:"DOCUMENTATION_FILESIZE",fieldLabel:w.size,hidden:C},{name:"DOCUMENTATION_DOWNTIME",fieldLabel:w.downloadTime},{name:"SY_CREATEUSERNAME",fieldLabel:w.uploader},{name:"SY_CREATETIME",fieldLabel:w.uploadTime},{xtype:"textarea",readOnly:!1,name:"DOCUMENTATION_REMARK",fieldLabel:w.remark,columnWidth:1}],showFn:function(e){e.down("form").form.setValues(b)},fn:function(e,t){e.tableCode="JE_SYS_DOCUMENTATION";var i=JE.ajax({url:JE.getUrlMaps("je.core.update"),params:e});if(i.success){var a=i.obj;a.JE_SYS_DOCUMENTATION_ID!=y.get("JE_SYS_DOCUMENTATION_ID")?r.getStore().remove(y):(y.set("DOCUMENTATION_REMARK",a.DOCUMENTATION_REMARK),y.commit()),JE.msg(u.updateSuccess)}else JE.alert(u.updateFailure)}});break;case"officeWord":JE.prompt(u.officeNewName,function(e,t){"cancel"==e||Ext.isEmpty(t)||o.doCreateFile(s,d,t,"doc")},null,u.docName);break;case"officeExcel":JE.prompt(u.officeNewName,function(e,t){"cancel"==e||Ext.isEmpty(t)||o.doCreateFile(s,d,t,"xls")},null,u.xlsName);break;case"officePowerPoint":JE.prompt(u.officeNewName,function(e,t){"cancel"==e||Ext.isEmpty(t)||o.doCreateFile(s,d,t,"ppt")},null,u.pptName);break;case"txt":JE.prompt(u.officeNewName,function(e,t){"cancel"==e||Ext.isEmpty(t)||o.doCreateFile(s,d,t,"txt")},null,u.txtName)}},doCreateFile:function(e,t,i,a){var n=e.getSelectionModel().getSelection()[0];if(n)if("COMPANY"!=e.fileMode||this.checkUpdatePerm(n.get("description"),n.get("bean").SY_CREATEUSERID)){var o=this.getFileView(t),r=o.getStore(),l={tableCode:"JE_SYS_DOCUMENTATION",SY_PARENT:"myfile"!=n.get("id")?n.get("id"):"ROOT",SY_PATH:n.get("nodePath"),SY_LAYER:n.get("layer")+1,SY_NODETYPE:"LEAF",DOCUMENTATION_FILEMODE:e.fileMode,fileName:i,fileType:a},s=JE.ajax({url:JE.getUrlMaps("je.core.doc.documentation","newFile"),params:l});if(s.success){var d=r.add(s.obj)[0];o.getSelectionModel().select(d),this.openFile(e,d,r)}else JE.alert(s.obj)}else JE.alert(JE.getLocalLang("sys.document.util.noPermAlert"));else JE.alert(JE.getLocalLang("sys.document.util.selectFolderAlert"))},doFolder:function(a,e,n,t){var o=this,r=n.getSelectionModel().getSelection()[0],l=JE.getLocalLang("sys.document.util");if(r)switch(t){case"new":o.addFolder(a,e,n);break;case"delete":if("COMPANY"==n.fileMode&&!o.checkUpdatePerm(r.get("description"),r.get("bean").SY_CREATEUSERID,!0))return void JE.alert(l.noPermAlert);JE.confirm(l.deleteConfirm,function(e){if("ok"==e)if(JE.ajax({url:JE.getUrlMaps("je.core.doc.documentation","doDisable"),params:{tableCode:"JE_SYS_DOCUMENTATION",ids:r.get("id")}}).success){var t=r.parentNode;n.getSelectionModel().select(t),n.loadFaster(),r.remove(),JE.msg(l.deleteSuccess)}else JE.alert(l.deleteFailure)});break;case"rename":if("COMPANY"==n.fileMode&&!o.checkUpdatePerm(r.get("description"),r.get("bean").SY_CREATEUSERID,!0))return void JE.alert(l.noPermAlert);JE.prompt(l.newNameAlert,function(e,t){if("cancel"!=e&&!Ext.isEmpty(t)){if(!o.checkFileName(t,"DIR",[]))return JE.alert(l.nameIllegalAlert),!1;if(JE.ajax({url:JE.getUrlMaps("je.core.doc.documentation","doUpdate"),params:{tableCode:"JE_SYS_DOCUMENTATION",JE_SYS_DOCUMENTATION_ID:r.get("id"),DOCUMENTATION_TEXT:t}}).success){r.set("text",t),r.commit();var i=a.up("panel[xtype=documentation.centerview]").getDockedItems("toolbar[dock=top]")[0];o.updateToolbar(n,i,r,"FILE"),JE.msg(l.renameSuccess)}else JE.alert(l.renameFailure)}},null,r.get("text"));break;case"doPerm":o.doPerm(e,n,"tree",!1);break;case"addUse":var i=JE.ajax({url:JE.getUrlMaps("je.core.doc.documentation","addFaster"),params:{tableCode:"JE_SYS_FASTERDOC",ids:r.get("id"),fileMode:n.fileMode}});i.success?(JE.msg(i.obj),n.loadFaster()):JE.alert(i.obj)}else JE.alert(l.selectFolderAlert)},doFaster:function(e,t){var i=e.getSelectionModel().getSelection();switch(t){case"doTop":if(1==i.length)(a=JE.ajax({url:JE.getUrlMaps("je.core.doc.documentation","orderFaster"),params:{tableCode:"JE_SYS_FASTERDOC",ids:i[0].get("JE_SYS_FASTERDOC_ID"),fileMode:e.fileMode,doTop:"1"}})).success?(JE.msg(JE.getLocalLang("sys.document.util.topAlert")),e.getStore().load()):JE.alert(a.obj);else JE.alert(JE.getLocalLang("sys.document.util.selectOneFolder"));break;case"doDown":if(1==i.length)(a=JE.ajax({url:JE.getUrlMaps("je.core.doc.documentation","orderFaster"),params:{tableCode:"JE_SYS_FASTERDOC",ids:i[0].get("JE_SYS_FASTERDOC_ID"),fileMode:e.fileMode,doTop:"0"}})).success?(JE.msg(JE.getLocalLang("sys.document.util.lastAlert")),e.getStore().load()):JE.alert(a.obj);else JE.alert(JE.getLocalLang("sys.document.util.selectOneFolder"));break;case"cacelUse":var a,n=new Array;Ext.each(i,function(e){n.push(e.get("JE_SYS_FASTERDOC_ID"))}),(a=JE.ajax({url:JE.getUrlMaps("je.core.remove"),params:{tableCode:"JE_SYS_FASTERDOC",ids:n.join(",")}})).success?(JE.msg(JE.getLocalLang("sys.document.util.unCommonAlert")),e.getStore().load()):JE.alert(a.obj)}},changeViewType:function(e,t,i,a,n){t.up("button[ref=view]").down("menuitem[code="+e.viewType+"]").setIconCls(""),t.setIconCls("jeicon jeicon-check"),e.viewType=t.code;var o=i.id;"thumbnail"==t.code?(i.show(),a.hide(),i.tpl=n?new Ext.XTemplate(['<tpl for=".">','<div class=table-files style="border: 1px solid #fff;table-layout:fixed;word-wrap:break-word;float:left;margin:9px;width:104px;height:133px;">','<div style="text-align:center;width:96px;height:96px;"><table width=100% height=100%><tr><td align=center valign = middle>{[this.formatFile(values)]}</td></tr></table></div>','<div class="x-editable" style="height:36px;padding-top:4px;text-align:center;overflow:hidden;text-overflow:ellipsis;" title="{DOCUMENTATION_TEXT}">{[values.DOCUMENTATION_TEXT.ellipsis(14)]}</div>',"</div>","</tpl>",{formatFile:function(e){return JE.getFileThumbnail(e,{width:"96",height:"96",styleConfig:"DOCUMENTATION_THUMBNAILCLS",imgUrl:"DOCUMENTATION_PRIVATEKEY",imgCdnUrl:"DOCUMENTATION_ADDRESS",imgName:"DOCUMENTATION_TEXT",icon:"DOCUMENTATION_ICONCLS",imgType:"docinfo",tableCode:"JE_SYS_DOCUMENTATION"})}}]):new Ext.XTemplate(['<div id = "'+o+'_JEMaskView" style="display: none; position: fixed; right: 0px; bottom: 0px; opacity: 0.6; z-index: 9998; background: rgb(0, 0, 0);"><div id = "'+o+'_JEMaskViewText" style="font-family: Helvetica, Helvetica Neue, Century Gothic, 微软雅黑, Microsoft Yahei, STXihei;position: absolute; z-index: 9999; width: auto; height: auto;"><div style="font-size:50px;color:#fff;opacity:0.6;">'+JE.getLocalLang("sys.document.fileData.uploadTpl")+'</div></div></div></div></div> <tpl for=".">','<div class=table-files style="border: 1px solid #fff;table-layout:fixed;word-wrap:break-word;float:left;margin:9px;width:104px;height:133px;">','<div style="text-align:center;width:96px;height:96px;"><table width=100% height=100%><tr><td align=center valign = middle>{[this.formatFile(values)]}</td></tr></table></div>','<div class="x-editable" style="height:36px;padding-top:4px;text-align:center;overflow:hidden;text-overflow:ellipsis;" title="{DOCUMENTATION_TEXT}">{[values.DOCUMENTATION_TEXT.ellipsis(14)]}</div>',"</div>","</tpl>",{formatFile:function(e){return JE.getFileThumbnail(e,{width:"96",height:"96",styleConfig:"DOCUMENTATION_THUMBNAILCLS",imgUrl:"DOCUMENTATION_PRIVATEKEY",imgCdnUrl:"DOCUMENTATION_ADDRESS",imgName:"DOCUMENTATION_TEXT",icon:"DOCUMENTATION_ICONCLS",imgType:"docinfo",tableCode:"JE_SYS_DOCUMENTATION"})}}]),i.getStore().load()):"icon"==t.code?(i.show(),a.hide(),i.tpl=n?new Ext.XTemplate(['<tpl for=".">','<div class=table-files style="border: 1px solid #fff;table-layout:fixed;word-wrap:break-word;float:left;margin:10px;width:58px;height:84px;">','<div style="text-align:center;width:48px;height:48px;"><table width=100% height=100%><tr><td align=center valign = middle>>{[this.formatFile(values)]}</td></tr></table></div>','<div class="x-editable" style="height:35px;padding-top:4px;text-align:center;overflow:hidden;text-overflow:ellipsis;" title="{DOCUMENTATION_TEXT}">{[values.DOCUMENTATION_TEXT.ellipsis(7)]}</div>',"</div>","</tpl>",{formatFile:function(e){var t=JE.getFileIcon(e.DOCUMENTATION_TEXT).color;return imgHtml='<i style="'+("font-size:35px; color:"+t)+'" class ="'+e.DOCUMENTATION_ICONCLS+'"></i>',imgHtml}}]):new Ext.XTemplate(['<div id = "'+o+'_JEMaskView" style="display: none; position: fixed; right: 0px; bottom: 0px; opacity: 0.6; z-index: 9998; background: rgb(0, 0, 0);"><div id = "'+o+'_JEMaskViewText" style="font-family: Helvetica, Helvetica Neue, Century Gothic, 微软雅黑, Microsoft Yahei, STXihei;position: absolute; z-index: 9999; width: auto; height: auto;"><div style="font-size:50px;color:#fff;opacity:0.6;">'+JE.getLocalLang("sys.document.fileData.uploadTpl")+'</div></div></div></div></div> <tpl for=".">','<div class=table-files style="border: 1px solid #fff;table-layout:fixed;word-wrap:break-word;float:left;margin:10px;width:58px;height:84px;">','<div style="text-align:center;width:48px;height:48px;"><table width=100% height=100%><tr><td align=center valign = middle>{[this.formatFile(values)]}</td></tr></table></div>','<div class="x-editable" style="height:35px;padding-top:4px;text-align:center;overflow:hidden;text-overflow:ellipsis;" title="{DOCUMENTATION_TEXT}">{[values.DOCUMENTATION_TEXT.ellipsis(7)]}</div>',"</div>","</tpl>",{formatFile:function(e){var t=JE.getFileIcon(e.DOCUMENTATION_TEXT).color;return imgHtml='<i style="'+("font-size:35px; color:"+t)+'" class ="'+e.DOCUMENTATION_ICONCLS+'"></i>',imgHtml}}]),i.getStore().load()):"detailed"==t.code&&(i.hide(),a.show(),a.getStore().load())},changeOrderType:function(e,t,i){if(e.orderType!=i.code){i.up("button[ref=order]").down("menuitem[code="+e.orderType+"]").setIconCls(""),i.setIconCls("jeicon jeicon-check"),e.orderType=i.code;var a=t.getStore(),n=a.getProxy().extraParams.orderSql,o=this.getOrderSql(i.code);-1==[" ORDER BY DOCUMENTATION_DOWNTIME DESC"," ORDER BY SY_CREATETIME DESC"," ORDER BY DOCUMENTATION_OPENTIME DESC"].indexOf(n)&&(a.getProxy().extraParams.orderSql=o,a.load())}},getOrderSql:function(e){var t="";return"name"==e?t=" ORDER BY DOCUMENTATION_TYPE ASC,DOCUMENTATION_PACKAGE ASC,DOCUMENTATION_TEXT ASC":"size"==e?t=" ORDER BY DOCUMENTATION_TYPE ASC,DOCUMENTATION_PACKAGE ASC,DOCUMENTATION_SIZE ASC":"type"==e?t=" ORDER BY DOCUMENTATION_TYPE ASC,DOCUMENTATION_PACKAGE ASC,DOCUMENTATION_FILETYPE ASC":"uploadTime"==e&&(t=" ORDER BY DOCUMENTATION_TYPE ASC,DOCUMENTATION_PACKAGE ASC,SY_MODIFYTIME ASC"),t},setButtons:function(e,t){var i=new Array;switch(e){case"FILE":break;case"FUNC":i=["openFile","cutFile","reducePackage","rename","pasteFile","remove","perm"];break;case"QUERY":i=["pasteFile","reducePackage","rename","remove","perm"];break;case"READONLY":i=["copyFile","cutFile","pasteFile","reducePackage","rename","remove","perm"];break;case"RECYCLE":!1}Ext.each(t.menu.items.items,function(e){e.setDisabled(-1!=i.indexOf(e.code))})},renameFile:function(e,t,i){if(t.get("DOCUMENTATION_TEXT")!=i){var a=e.up("panel[xtype=documentation.filedataview]").up("panel[xtype=documentation.mainview]").down("treepanel[xtype=documentation.filemenuview]"),n=a.getStore(),o=(e.getStore().proxy.extraParams.tableCode,n=a.getStore(),""),r="0";if("DIR"!=t.get("DOCUMENTATION_TYPE")&&-1!=t.get("DOCUMENTATION_TEXT").lastIndexOf(".")&&(o=t.get("DOCUMENTATION_TEXT").substring(t.get("DOCUMENTATION_TEXT").lastIndexOf(".")+1)),"DIR"!=t.get("DOCUMENTATION_TYPE")){var l="";if(-1!=i.lastIndexOf(".")&&(l=i.substring(i.lastIndexOf(".")+1)),Ext.isEmpty(o)&&!Ext.isEmpty(l))r="1";else if(o!=l)return void JE.alert(JE.getLocalLang("sys.document.util.nameCantUpdate"))}if(!this.checkFileName(i,t.get("DOCUMENTATION_TYPE"),e.getStore().data.items))return JE.alert(JE.getLocalLang("sys.document.util.nameIllegalAlert")),!1;if(JE.ajax({url:JE.getUrlMaps("je.core.doc.documentation","doUpdate"),params:{tableCode:"JE_SYS_DOCUMENTATION",DOCUMENTATION_ADDRESS:t.get("DOCUMENTATION_ADDRESS"),syncFileType:r,JE_SYS_DOCUMENTATION_ID:t.get("JE_SYS_DOCUMENTATION_ID"),DOCUMENTATION_TEXT:i}}).success){if(t.set("DOCUMENTATION_TEXT",i),t.commit(),"DIR"==t.get("DOCUMENTATION_TYPE")){var s=n.getNodeById(t.get("JE_SYS_DOCUMENTATION_ID"));s&&(s.set("text",i),s.commit())}JE.msg(JE.getLocalLang("sys.document.util.renameSuccess"))}else JE.alert(JE.getLocalLang("sys.document.util.renameFailure"))}},addFolder:function(e,t,r){var l=this,s=t.getStore(),d=s.data.items,c=r.getSelectionModel().getSelection()[0];c?"COMPANY"!=r.fileMode||l.checkUpdatePerm(c.get("description"),c.get("bean").SY_CREATEUSERID)?JE.prompt(JE.getLocalLang("sys.document.util.newNameAlert"),function(e,t){if("cancel"!=e&&!Ext.isEmpty(t)){if(!l.checkFileName(t,"DIR",d))return JE.alert(JE.getLocalLang("sys.document.util.nameIllegalAlert")),!1;var i={tableCode:"JE_SYS_DOCUMENTATION",SY_PARENT:"myfile"!=c.get("id")?c.get("id"):"ROOT",SY_PATH:c.get("nodePath"),SY_LAYER:c.get("layer")+1,DOCUMENTATION_TEXT:t,DOCUMENTATION_CODE:JE.toPinYin(t,"PY"),DOCUMENTATION_ICONCLS:"jeicon jeicon-folder",DOCUMENTATION_BIGICONCLS:"je_document_dir48",DOCUMENTATION_THUMBNAILCLS:'<div class="je_document_dir96"> </div>',DOCUMENTATION_TYPE:"DIR",DOCUMENTATION_FILEMODE:r.fileMode,DOCUMENTATION_FILETYPE:"dir",DOCUMENTATION_FILETYPENAME:"文件夹",SY_NODETYPE:"GENERAL",DOCUMENTATION_PACKAGE:"0"},a=JE.ajax({url:JE.getUrlMaps("je.core.doc.documentation","doSave"),params:i});if(a.success){var n=a.obj,o={id:n.JE_SYS_DOCUMENTATION_ID,text:n.DOCUMENTATION_TEXT,code:n.DOCUMENTATION_CODE,leaf:"LEAF"==n.SY_NODETYPE,nodePath:n.SY_PATH,parentPath:n.SY_PARENTPATH,nodeInfoType:n.DOCUMENTATION_TYPE,iconCls:n.DOCUMENTATION_ICONCLS,parent:n.SY_PARENT,children:[],expandable:!0,description:n.DOCUMENTATION_PERMJSON,bean:n};c.appendChild(o);c.expand(),s.add(n),JE.msg(JE.getLocalLang("sys.document.util.folderCreateAlert"))}else JE.alert(a.obj)}}):JE.alert(JE.getLocalLang("sys.document.util.noPermAlert")):JE.alert(JE.getLocalLang("sys.document.util.selectFolderAlert"))},doPerm:function(e,w,S,t){var I=this,i={},T=e.getSelectionModel().getSelection(),_=w.getSelectionModel().getSelection()[0],a=null,n=null,J=new Array;if("view"==S){if(T.length<=0)return void JE.alert(JE.getLocalLang("sys.document.util.permOneFolder"));for(var o=0;o<T.length;o++){if("DIR"!=(r=T[o]).get("DOCUMENTATION_TYPE")||"0"!=r.get("DOCUMENTATION_PACKAGE"))return void JE.alert("【"+r.get("DOCUMENTATION_TEXT")+"】"+JE.getLocalLang("sys.document.util.permFolderAlert"));if("COMPANY"==w.fileMode&&!I.checkUpdatePerm(r.get("DOCUMENTATION_PERMJSON"),r.get("SY_CREATEUSERID"),!0))return void JE.alert("【"+r.get("DOCUMENTATION_TEXT")+"】"+JE.getLocalLang("sys.document.util.noPermAlert"));J.push(r.get("JE_SYS_DOCUMENTATION_ID"))}if(!t){if(1<T.length)return void JE.alert(JE.getLocalLang("sys.document.util.selectFolderAlert"));var r;a=(r=T[0]).get("DOCUMENTATION_PERMJSON"),n=r.get("DOCUMENTATION_SEEPERMJSON")}}else{if("COMPANY"==w.fileMode&&!I.checkUpdatePerm(_.get("description"),_.get("bean").SY_CREATEUSERID,!0))return void JE.alert(JE.getLocalLang("sys.document.util.noPermAlert"));a=_.get("description"),n=_.get("bean").DOCUMENTATION_SEEPERMJSON,J.push(_.get("id"))}var l=JE.toObj(Ext.value(a,"{}")),s=JE.toObj(Ext.value(n,"{}"));if(!t){var d=new Array,c=new Array,u=new Array,p=new Array,f=new Array,E=new Array,m=new Array,g=new Array,h=new Array,x=new Array,v=new Array,y=new Array,b=new Array,C=new Array,D=new Array,A=new Array;if(s.user){for(var N in s.user)d.push(s.user[N]),c.push(N);i.seeUserNames=d.join(","),i.seeUserIds=c.join(",")}if(s.dept){for(var O in s.dept)u.push(s.dept[O]),p.push(O);i.seeDeptNames=u.join(","),i.seeDeptIds=p.join(",")}if(s.role){for(var R in s.role)f.push(s.role[R]),E.push(R);i.seeRoleNames=f.join(","),i.seeRoleIds=E.join(",")}if(s.sentry){for(var L in s.sentry)m.push(s.sentry[L]),g.push(L);i.seeSentryNames=m.join(","),i.seeSentryIds=g.join(",")}if(l.user){for(var N in l.user)h.push(l.user[N]),x.push(N);i.updateUserNames=h.join(","),i.updateUserIds=x.join(",")}if(l.dept){for(var O in l.dept)v.push(l.dept[O]),y.push(O);i.updateDeptNames=v.join(","),i.updateDeptIds=y.join(",")}if(l.role){for(var R in l.role)b.push(l.role[R]),C.push(R);i.updateRoleNames=b.join(","),i.updateRoleIds=C.join(",")}if(l.sentry){for(var L in l.sentry)D.push(l.sentry[L]),A.push(L);i.updateSentryNames=D.join(","),i.updateSentryIds=A.join(",")}}JE.win({title:JE.getLocalLang("sys.document.treeMenu.authorize"),iconCls:"jeicon jeicon-data-authorization",width:JE.getBodyWidth()-200,height:JE.getBodyHeight()-200,useButton:!0,items:{xtype:"documentation.docpermform"},fn:function(e){var t=e.down("form[xtype=documentation.docpermform]").form.getValues(),a={},i={user:{},dept:{},role:{},sentry:{}},n={user:{},dept:{},role:{},sentry:{}},o=t.seeUserNames.split(","),r=t.seeUserIds.split(","),l=t.seeDeptNames.split(","),s=t.seeDeptIds.split(","),d=t.seeRoleNames.split(","),c=t.seeRoleIds.split(","),u=t.seeSentryNames.split(","),p=t.seeSentryIds.split(","),f=t.updateUserNames.split(","),E=t.updateUserIds.split(","),m=t.updateDeptNames.split(","),g=t.updateDeptIds.split(","),h=t.updateRoleNames.split(","),x=t.updateRoleIds.split(","),v=t.updateSentryNames.split(","),y=t.updateSentryIds.split(",");Ext.each(r,function(e,t){Ext.isEmpty(e)||(n.user[e]=o[t])}),Ext.each(s,function(e,t){Ext.isEmpty(e)||(n.dept[e]=l[t])}),Ext.each(c,function(e,t){Ext.isEmpty(e)||(n.role[e]=d[t])}),Ext.each(p,function(e,t){Ext.isEmpty(e)||(n.sentry[e]=u[t])}),Ext.each(E,function(e,t){Ext.isEmpty(e)||(i.user[e]=f[t])}),Ext.each(g,function(e,t){Ext.isEmpty(e)||(i.dept[e]=m[t])}),Ext.each(x,function(e,t){Ext.isEmpty(e)||(i.role[e]=h[t])}),Ext.each(y,function(e,t){Ext.isEmpty(e)||(i.sentry[e]=v[t])}),a.DOCUMENTATION_PERMJSON=JE.toStr(i),a.DOCUMENTATION_SEEPERMJSON=JE.toStr(n),a.DOCUMENTATION_SEEUSERIDS=t.seeUserIds,a.DOCUMENTATION_SEEDEPTIDS=t.seeDeptIds,a.DOCUMENTATION_SEEROLEIDS=t.seeRoleIds,a.DOCUMENTATION_SEESENTRYIDS=t.seeSentryIds,a.cascadeChild=t.cascadeChild,a.tableCode="JE_SYS_DOCUMENTATION",a.ids=J.join(",");var b=JE.ajax({url:JE.getUrlMaps("je.core.doc.documentation","doUpdatePerm"),params:a});if(b.success){if("tree"==S){_.set("description",a.DOCUMENTATION_PERMJSON);var C=_.get("bean");C.DOCUMENTATION_SEEPERMJSON=a.DOCUMENTATION_SEEPERMJSON,_.set("bean",C),"1"==a.cascadeChild&&I.eachAllChild(_,function(e){if(I.checkUpdatePerm(e.get("description"),e.get("bean").SY_CREATEUSERID,!0)){var t=e.get("bean");t.DOCUMENTATION_SEEPERMJSON=a.DOCUMENTATION_SEEPERMJSON,e.set("bean",t),e.commit()}}),_.commit()}else Ext.each(T,function(e){e.set("DOCUMENTATION_PERMJSON",a.DOCUMENTATION_PERMJSON),e.set("DOCUMENTATION_SEEPERMJSON",a.DOCUMENTATION_SEEPERMJSON),e.set("DOCUMENTATION_SEEUSERIDS",a.DOCUMENTATION_SEEUSERIDS),e.set("DOCUMENTATION_SEEDEPTIDS",a.DOCUMENTATION_SEEDEPTIDS),e.set("DOCUMENTATION_SEEROLEIDS",a.DOCUMENTATION_SEEROLEIDS),e.set("DOCUMENTATION_SEESENTRYIDS",a.DOCUMENTATION_SEESENTRYIDS),e.commit();var t=w.getStore().getNodeById(e.get("JE_SYS_DOCUMENTATION_ID"));if(t){t.set("description",a.DOCUMENTATION_PERMJSON);var i=t.get("bean");t.DOCUMENTATION_SEEPERMJSON=a.DOCUMENTATION_SEEPERMJSON,t.set("bean",i),"1"==a.cascadeChild&&I.eachAllChild(t,function(e){if(I.checkUpdatePerm(e.get("description"),e.get("bean").SY_CREATEUSERID,!0)){var t=e.get("bean");t.DOCUMENTATION_SEEPERMJSON=a.DOCUMENTATION_SEEPERMJSON,e.set("bean",t),e.commit()}})}});JE.msg(b.obj)}else JE.alert(b.obj)},showFn:function(e){var t=e.down("form[xtype=documentation.docpermform]");i.cascadeChild="1",t.form.setValues(i)}}).show()},isRenameFile:function(e,t){var i=e.up("panel[xtype=documentation.filedataview]").modeType;return"FUNC"!=i&&"RECYCLE"!=i},checkFileName:function(e,t,i){return!/[\/\\"<>\?\*]/gi.test(e)},eachAllChild:function(e,t){var i=this;e.eachChild(function(e){t(e),e.hasChildNodes()&&i.eachAllChild(e,t)})},checkUpdatePerm:function(e,t,i){if(JE.currentUser.userId==t)return!0;if(-1!=Ext.value(JE.systemConfig.JE_SYS_DOCADMINID,"").split(",").indexOf(JE.currentUser.userId))return!0;if(1==i)return!1;var a=JE.toObj(Ext.value(e,"{}"));if(a.user&&!Ext.isEmpty(a.user[JE.currentUser.userId]))return!0;if(a.dept&&!Ext.isEmpty(a.dept[JE.currentUser.deptId]))return!0;if(a.sentry)for(var n=JE.currentUser.sentrys,o=0;o<n.length;o++)if(!Ext.isEmpty(a.sentry[n[o].sentryId]))return!0;if(a.role){var r=JE.currentUser.roles;for(o=0;o<r.length;o++)if("ROLE"==r[o].roleType&&!Ext.isEmpty(a.role[r[o].roleId]))return!0}return!1},fileProgress:{addFile:function(e){var i=new Array;Ext.each(e,function(e){var t={id:e.id,name:e.name,size:e.size,progress:0,status:"等待上传"};i.push(t)});var t=Ext.getCmp("jefileprogressview");t||((t=JE.win({title:JE.getLocalLang("sys.document.ctr.uploadTitle"),border:0,closeAction:"hide",id:"jefileprogressview",width:748,height:400,items:[{xtype:"documentation.fileprogressview"}]})).grid=t.down("panel[xtype=documentation.fileprogressview]")),t.show(),t.grid.getStore().loadData(i)},updateFile:function(e,t,i){var a=Ext.getCmp("jefileprogressview").grid.getStore().findRecord("id",e.id);a&&(a.set("progress",t),a.set("status",i),a.commit())},reset:function(){var e=Ext.getCmp("jefileprogressview");e.grid.getStore().removeAll(),e.hide()}}}),Ext.define("JE.sys.documentation.drag.DragSelector",{alias:"plugin.dragselector",extend:"Ext.AbstractPlugin",init:function(e){(this.dataview=e).mon(e,{beforecontainerclick:this.cancelClick,scope:this,render:{fn:this.onRender,scope:this,single:!0}})},onRender:function(){this.tracker=Ext.create("Ext.dd.DragTracker",{dataview:this.dataview,el:this.dataview.el,dragSelector:this,onBeforeStart:this.onBeforeStart,onStart:this.onStart,onDrag:this.onDrag,onEnd:this.onEnd}),this.dragRegion=Ext.create("Ext.util.Region")},onBeforeStart:function(e){return!this.dragSelector.disabled&&e.target==this.dataview.getEl().dom},onStart:function(e){var t=this.dragSelector,i=this.dataview;this.dragging=!0,t.fillRegions(),t.getProxy().show(),i.getSelectionModel().deselectAll()},cancelClick:function(){return!this.tracker.dragging},onDrag:function(e){var t,i,a=this.dragSelector,n=a.dataview.getSelectionModel(),o=a.dragRegion,r=a.bodyRegion,l=a.getProxy(),s=a.regions,d=s.length,c=this.startXY,u=this.getXY(),p=Math.min(c[0],u[0]),f=Math.min(c[1],u[1]),E=Math.abs(c[0]-u[0]),m=Math.abs(c[1]-u[1]);for(Ext.apply(o,{top:f,left:p,right:p+E,bottom:f+m}),o.constrainTo(r),l.setRegion(o),i=0;i<d;i++)t=s[i],o.intersect(t)?n.select(i,!0):n.deselect(i)},onEnd:Ext.Function.createDelayed(function(e){this.dataview.getSelectionModel();var t=this.dragSelector;this.dragging=!1,t.getProxy().hide()},1),getProxy:function(){return this.proxy&&Ext.get(this.proxy.id)||(this.proxy=this.dataview.getEl().createChild({tag:"div",cls:"x-view-selector"})),this.proxy},fillRegions:function(){var e=this.dataview,t=this.regions=[];e.all.each(function(e){t.push(e.getRegion())}),this.bodyRegion=e.getEl().getRegion()},setDisabled:function(e){this[e?"disable":"enable"]()}}),Ext.define("JE.sys.documentation.drag.LabelEditor",{extend:"Ext.Editor",alignment:"tl-tl",completeOnEnter:!0,cancelOnEsc:!0,shim:!1,mixins:{docUtil:"JE.sys.documentation.util.DocumentationUtil"},autoSize:{width:"boundEl",height:"field"},labelSelector:"x-editable",constructor:function(e){e.field=e.field||Ext.create("Ext.form.field.Text",{allowBlank:!1,selectOnFocus:!0}),this.callParent([e])},init:function(e){this.view=e,this.mon(e,"render",this.bindEvents,this),this.on("complete",this.onSave,this)},bindEvents:function(){this.mon(this.view.getEl(),{click:{fn:this.onClick,scope:this}})},onClick:function(e,t){var i,a,n=this;!Ext.fly(t).hasCls(n.labelSelector)||n.editing||e.ctrlKey||e.shiftKey||!n.isRenameFile(n.view)?n.editing&&(n.field.blur(),e.preventDefault()):(e.stopEvent(),i=n.view.findItemByChild(t),a=n.view.store.getAt(n.view.indexOf(i)),n.startEdit(t,a.data[n.dataIndex]),n.activeRecord=a)},onSave:function(e,t){this.renameFile(this.view,this.activeRecord,t)}}),Ext.define("JE.sys.documentation.view.CenterView",{extend:"Ext.panel.Panel",border:1,alias:"widget.documentation.centerview",bodyPadding:"1 0 0 0",layout:"fit",initComponent:function(){this.localLang=JE.getLocalLang("sys.document.treeMenu"),this.tbar=[{xtype:"button",tooltip:this.localLang.back,iconCls:"jeicon jeicon-calendar-back-o",ref:"back"},{xtype:"button",tooltip:this.localLang.forward,iconCls:"jeicon jeicon-calendar-next-o",ref:"next"}],this.items={xtype:"documentation.filedataview",noDnd:this.noDnd,fileMode:this.fileMode,readOnly:this.readOnly},this.callParent()}}),Ext.define("JE.sys.documentation.view.CompanyMainView",{extend:"Ext.panel.Panel",alias:"widget.documentation.companymainview",border:0,layout:"fit",noDnd:!1,initComponent:function(){this.fileMode=Ext.value(this.fileMode,"COMPANY"),this.items=[{xtype:"documentation.mainview",fileMode:this.fileMode,noDnd:!1}],this.callParent()}}),Ext.define("JE.sys.documentation.view.FasterTreeMenu",{extend:"Ext.menu.Menu",alias:"widget.documentation.fastertreemenu",defaultAlign:"br-tr",frame:!1,border:1,initComponent:function(){this.localLang=JE.getLocalLang("sys.document.treeMenu"),this.items=[{text:this.localLang.top,code:"doTop",iconCls:"jeicon jeicon-arrow-up"},{text:this.localLang.last,code:"doDown",iconCls:"jeicon jeicon-arrow-down"},{text:this.localLang.cancelCommon,code:"cacelUse",iconCls:"jeicon jeicon-error"}],this.callParent()}}),Ext.define("JE.sys.documentation.view.FasterView",{extend:"Ext.view.View",alias:"widget.documentation.fasterview",tpl:['<tpl for=".">','<div class=table-files style="border: 1px solid #fff;table-layout:fixed;word-wrap:break-word;float:left;margin:2px;width:58px;height:84px;">','<div style="text-align:center;width:48px;height:48px;"><table width=100% height=100%><tr><td align=center valign = middle><div class="{FASTERDOC_ICONCLS}"></td></tr></table></div>','<div class="x-editable" style="height:35px;padding-top:4px;text-align:center;overflow:hidden;text-overflow:ellipsis;" title="{FASTERDOC_TEXT}">{[values.FASTERDOC_TEXT.ellipsis(7)]}</div>',"</div>","</tpl>"],multiSelect:!0,overItemCls:"x-dataview-item-over",trackOver:!0,selectedItemCls:"x-dataview-item-selected",itemSelector:"div.table-files",emptyText:"",plugins:[Ext.create("JE.sys.documentation.drag.DragSelector",{})],initComponent:function(){this.store=JE.getStore({tableName:"JE_SYS_FASTERDOC",action:JE.getUrlMaps("je.core"),id:"JE_SYS_FASTERDOC_ID",params:{limit:6,orderSql:" ORDER BY SY_ORDERINDEX ASC",whereSql:" AND SY_CREATEUSERID='"+JE.currentUser.userId+"' AND FASTERDOC_FILEMODE='"+this.fileMode+"'"},autoLoad:!0}),this.menuWin=Ext.create("JE.sys.documentation.view.FasterTreeMenu",{frame:!1,border:1,fileMode:this.fileMode,fasterView:this}),this.callParent()}}),Ext.define("JE.sys.documentation.view.FileDataView",{extend:"Ext.panel.Panel",alias:"widget.documentation.filedataview",layout:"fit",viewType:"thumbnail",orderType:"name",modeType:"FILE",border:0,initComponent:function(){var e=this;e.localLang=JE.getLocalLang("sys.document.fileData"),Ext.apply(e.localLang,JE.getLocalLang("sys.document.treeMenu"));var t=JE.getStore({tableName:"JE_SYS_DOCUMENTATION",pageSize:100,action:JE.getUrlMaps("je.core.doc.documentation"),id:"JE_SYS_DOCUMENTATION_ID",params:{whereSql:" AND SY_PARENT='ROOT'",orderSql:" ORDER BY DOCUMENTATION_TYPE ASC,DOCUMENTATION_PACKAGE ASC,DOCUMENTATION_TEXT ASC",baseSql:" AND SY_STATUS='1'",permSql:" AND SY_CREATEUSER='"+JE.currentUser.userCode+"'",fileMode:e.fileMode,dirOnly:!1},autoLoad:!1}),i=Ext.id(),a=Ext.id();e.items=[{xtype:"dataview",noDnd:e.noDnd,readOnly:e.readOnly,autoScroll:!0,id:i,tpl:['<div id = "'+i+'_JEMaskView" style="display: none; position: fixed; right: 0px; bottom: 0px; opacity: 0.6; z-index: 9998; background: rgb(0, 0, 0);"><div id = "'+i+'_JEMaskViewText" style="font-family: Helvetica, Helvetica Neue, Century Gothic, 微软雅黑, Microsoft Yahei, STXihei;position: absolute; z-index: 9999; width: auto; height: auto;"><div style="font-size:50px;color:#fff;opacity:0.6;">'+e.localLang.uploadTpl+'</div></div></div></div></div> <tpl for=".">','<DIV class=table-files style="border: 1px solid #fff;table-layout:fixed;word-wrap:break-word;float:left;margin:9px;width:104px;height:133px;">','<div style="text-align:center;width:96px;height:96px;"><table width=100% height=100%><tr><td align=center valign = middle>{[this.formatFile(values)]}</td></tr></table></div>','<div class="x-editable" style="height:36px;padding-top:4px;text-align:center;overflow:hidden;text-overflow:ellipsis;" title="{DOCUMENTATION_TEXT}">{[values.DOCUMENTATION_TEXT.ellipsis(14)]}</div>',"</div>","</tpl>",{formatFile:function(e){return JE.getFileThumbnail(e,{width:"96",height:"96",styleConfig:"DOCUMENTATION_THUMBNAILCLS",imgUrl:"DOCUMENTATION_PRIVATEKEY",imgCdnUrl:"DOCUMENTATION_ADDRESS",imgName:"DOCUMENTATION_TEXT",icon:"DOCUMENTATION_ICONCLS",imgType:"docinfo",tableCode:"JE_SYS_DOCUMENTATION"})}}],plugins:[Ext.create("JE.sys.documentation.drag.DragSelector",{}),Ext.create("JE.sys.documentation.drag.LabelEditor",{dataIndex:"DOCUMENTATION_TEXT"})],multiSelect:!0,overItemCls:"x-dataview-item-over",trackOver:!0,selectedItemCls:"x-dataview-item-selected",itemSelector:"div.table-files",emptyText:"",store:t,menuTree:Ext.create("JE.sys.documentation.view.TreeMenu",{menuType:"item",modeType:"FILE",fileDataView:e}),recycleMenu:Ext.create("JE.sys.documentation.view.TreeMenu",{menuType:"item",modeType:"RECYCLE",fileDataView:e}),queryMenu:Ext.create("JE.sys.documentation.view.TreeMenu",{menuType:"item",modeType:"QUERY",fileDataView:e}),funcMenu:Ext.create("JE.sys.documentation.view.TreeMenu",{menuType:"item",modeType:"FUNC",fileDataView:e})},{xtype:"gridpanel",hidden:!0,cls:"jegrid",border:0,multiSelect:!0,autoScroll:!0,columnLines:!0,animCollapse:!1,viewConfig:{id:a,noDnd:e.noDnd,tpl:'<div id = "'+a+'_JEMaskView" style="display: none; position: fixed; right: 0px; bottom: 0px; opacity: 0.6; z-index: 9998; background: rgb(0, 0, 0);"><div id = "'+a+'_JEMaskViewText" style="font-family: Helvetica, Helvetica Neue, Century Gothic, 微软雅黑, Microsoft Yahei, STXihei;position: absolute; z-index: 9999; width: auto; height: auto;"><div style="font-size:50px;color:#fff;opacity:0.6;">'+e.localLang.uploadTpl+"</div></div></div></div></div>{%values.view.tableTpl.applyOut(values, out)%}"},columns:[{text:e.localLang.name,dataIndex:"DOCUMENTATION_TEXT",width:200,renderer:function(e,t,i,a,n,o,r,l,s){return"<input type='button' class='"+i.get("DOCUMENTATION_ICONCLS")+" je-button-icon'/>"+e}},{text:e.localLang.modifyTime,dataIndex:"SY_MODIFYTIME",width:150},{text:e.localLang.type,dataIndex:"DOCUMENTATION_FILETYPENAME",width:100},{text:e.localLang.size,dataIndex:"DOCUMENTATION_SIZE",width:100,renderer:function(e,t,i,a,n,o,r,l,s){if("DIR"==i.get("DOCUMENTATION_TYPE"))return"";var d=1*Ext.value(e,0);return Math.ceil(d/1e3)+" KB"}},{text:e.localLang.remark,dataIndex:"DOCUMENTATION_REMARK",width:300}],store:t,menuTree:Ext.create("JE.sys.documentation.view.TreeMenu",{menuType:"item",modeType:"FILE",fileDataView:e}),recycleMenu:Ext.create("JE.sys.documentation.view.TreeMenu",{menuType:"item",modeType:"RECYCLE",fileDataView:e}),queryMenu:Ext.create("JE.sys.documentation.view.TreeMenu",{menuType:"item",modeType:"QUERY",fileDataView:e}),funcMenu:Ext.create("JE.sys.documentation.view.TreeMenu",{menuType:"item",modeType:"FUNC",fileDataView:e})}],e.menuTree=Ext.create("JE.sys.documentation.view.TreeMenu",{menuType:"panel",modeType:"FILE",fileDataView:e}),e.recycleMenu=Ext.create("JE.sys.documentation.view.TreeMenu",{menuType:"panel",modeType:"RECYCLE",fileDataView:e}),e.queryMenu=Ext.create("JE.sys.documentation.view.TreeMenu",{menuType:"panel",modeType:"QUERY",fileDataView:e}),e.tbar=[{xtype:"button",text:e.localLang.newText,ref:"addDir",iconCls:"jeicon jeicon-table-module-addition"},{xtype:"button",text:e.localLang.upload,ref:"addFile",iconCls:"jeicon jeicon-function-configuration"},{ref:"view",text:e.localLang.view,iconCls:"jeicon jeicon-view",menu:[{text:e.localLang.thumbnail,code:"thumbnail",iconCls:"jeicon jeicon-check"},{text:e.localLang.icon,code:"icon"},{text:e.localLang.detail,code:"detailed"}]},{ref:"order",text:e.localLang.order,iconCls:"jeicon jeicon-sorting",menu:[{text:e.localLang.name,iconCls:"jeicon jeicon-check",code:"name"},{text:e.localLang.size,code:"size"},{text:e.localLang.type,code:"type"},{text:e.localLang.modifyTime,code:"uploadTime"}]},{ref:"oper",text:e.localLang.operation,iconCls:"jeicon jeicon-system-management",menu:[{text:e.localLang.open,code:"openFile",iconCls:"jeicon jeicon-check"},{text:e.localLang.browse,code:"seeFile",iconCls:"jeicon jeicon-search"},{text:e.localLang.download,code:"downloadFile",iconCls:"jeicon jeicon-download-recently"},{text:e.localLang.packDownload,code:"packageDownload",iconCls:"jeicon jeicon-compress-static"},"-",{text:e.localLang.copy,code:"copyFile",iconCls:"jeicon jeicon-chart-copy"},{text:e.localLang.cut,code:"cutFile",iconCls:"jeicon jeicon-scissors"},{text:e.localLang.paste,code:"pasteFile",iconCls:"jeicon jeicon-paste"},{text:e.localLang.zipPackage,code:"reducePackage",iconCls:"jeicon jeicon-upgrade-package"},"-",{text:e.localLang.rename,code:"rename",iconCls:"jeicon jeicon-rename-o"},{text:e.localLang.remove,code:"remove",iconCls:"jeicon jeicon-error"},"-",{text:e.localLang.attribute,code:"attribute",iconCls:"jeicon jeicon-set-up"}]}],"COMPANY"!=e.fileMode||e.readOnly||(e.tbar.push({xtype:"button",text:e.localLang.authorize,ref:"permOne",iconCls:"jeicon jeicon-data-authorization"}),e.tbar.push({xtype:"button",text:e.localLang.batchAuthorize,ref:"permBatch",iconCls:"jeicon jeicon-data-authorization"})),e.tbar.push({xtype:"button",text:e.localLang.returns,ref:"callQueryBtn",iconCls:"jeicon jeicon-rejected"}),e.tbar.push("->"),e.tbar.push({xtype:"qqfield",labelStyle:"cursor: pointer;color:blue;text-decoration: underline;font-family: arial;",labelWidth:32,name:"quickquery",labelSeparator:"",queryFields:[{name:"DOCUMENTATION_TEXT"},{name:"DOCUMENTATION_REMARK"}]}),e.dockedItems=[{xtype:"uxpagingtoolbar",cls:"je-user-uxpagingtoolbar-left",store:t,dock:"bottom",displayInfo:!0}],this.callParent()}}),Ext.define("JE.sys.documentation.view.FileMenuView",{extend:"Ext.tree.Panel",border:0,alias:"widget.documentation.filemenuview",useArrows:!0,rootVisible:!1,mixins:{docUtil:"JE.sys.documentation.util.DocumentationUtil"},viewConfig:{selectedItemCls:"x-tree-row-selected",focusedItemCls:"x-tree-row-focused",beforeFocusedItemCls:"x-tree-row-before-focused",tableFocusedFirstCls:"x-tree-table-focused-first"},initComponent:function(){var p=this;p.localLang=JE.getLocalLang("sys.document.fileMenu"),p.store=JE.getStore({type:"tree",autoLoad:!1,tableName:"JE_SYS_DOCUMENTATION",url:JE.getUrlMaps("je.core.doc.documentation","getFileMenuTree"),params:{fileMode:p.fileMode,baseSql:" AND SY_STATUS='1'"}}),p.viewConfig=Ext.value(p.viewConfig,{}),p.viewConfig.plugins=Ext.value(p.viewConfig.plugins,[]),p.viewConfig.listeners=Ext.value(p.viewConfig.listeners,{}),p.readOnly||(p.viewConfig.plugins.push({ptype:"treeviewdragdrop",allowParentInserts:!0,appendOnly:!0}),p.viewConfig.listeners=Ext.apply(p.viewConfig.listeners,{beforedrop:function(e,t,i,a,n){t.records[0].parentNode.getId()!=i.getId()&&"SYSTEM"!=t.records[0].get("nodeInfo")&&"SYSTEM"!=i.get("nodeInfoType")||n.cancelDrop(),"COMPANY"==p.fileMode&&n.cancelDrop()},drop:function(e,t,i,a,n){var o,r=this.panel,l=t.records[0],s=i,d=s.getId();"myfile"==d&&(d="ROOT");var c={tableCode:"JE_SYS_DOCUMENTATION",SY_PARENT:d,SY_PATH:s.getPath(),SY_LAYER:s.getDepth()+1};if(c.JE_SYS_DOCUMENTATION_ID=l.getId(),(o=JE.ajax({url:JE.getUrlMaps("je.core.doc.documentation","treeMove"),params:c})).success){var u=o.obj;l.set("layer",u.SY_LAYER),l.set("nodePath",u.SY_PATH),l.set("parent",u.SY_PARENT),l.set("parentPath",u.SY_PARENTPATH),l.commit(),r.getSelectionModel().deselectAll(),r.getSelectionModel().select(l),JE.msg(p.localLang.dropOkAlert)}else JE.alert(o.obj)}})),p.menuWin=Ext.create("JE.sys.documentation.view.FolderTreeMenu",{frame:!1,border:1,fileMode:p.fileMode,fileMenuTree:p}),p.bodyStyle="border-bottom-width:1px !important;",p.dockedItems=[{xtype:"panel",layout:"fit",border:0,bodyStyle:"border-top-width:1px !important;",items:{xtype:"documentation.fasterview",fileMode:p.fileMode},title:p.localLang.myCommonTitle,dock:"bottom",height:205}],this.callParent()},loadFaster:function(){this.down("dataview[xtype=documentation.fasterview]").getStore().load()}}),Ext.define("JE.sys.documentation.view.FileProgressView",{extend:"Ext.grid.Panel",border:1,alias:"widget.documentation.fileprogressview",columnLines:!0,multiSelect:!0,enableKeyNav:!0,initComponent:function(){this.localLang=JE.getLocalLang("sys.document.fileProgress"),this.columns=[{text:this.localLang.id,hidden:!0,dataIndex:"id"},{text:this.localLang.name,dataIndex:"name",width:250},{text:this.localLang.size,dataIndex:"size",width:92,renderer:function(e){return Ext.util.Format.fileSize(e)}},{text:this.localLang.status,dataIndex:"status",width:100},{text:this.localLang.progress,dataIndex:"progress",width:272,tactics:[{type:"bar",configInfo:",1-99~orange,100-100~green"}],align:"left",renderer:JE.renderer}],this.store=Ext.create("Ext.data.Store",{fields:[{name:"id",type:"string"},{name:"name",type:"string"},{name:"size",type:"float"},{name:"status",type:"string"},{name:"progress",type:"int"}]}),this.callParent()}}),Ext.define("JE.sys.documentation.view.FolderTreeMenu",{extend:"Ext.menu.Menu",alias:"widget.documentation.foldertreemenu",defaultAlign:"br-tr",frame:!1,border:1,initComponent:function(){this.localLang=JE.getLocalLang("sys.document.treeMenu"),this.items=[{text:this.localLang.newText,code:"new",iconCls:"jeicon jeicon-table-module-addition"},{text:this.localLang.remove,code:"delete",iconCls:"jeicon jeicon-error"},{text:this.localLang.rename,code:"rename",iconCls:"jeicon jeicon-rename-o"},{text:this.localLang.toCommon,code:"addUse",iconCls:"jeicon jeicon-produce"}],"COMPANY"==this.fileMode&&this.items.push({text:this.localLang.authorize,code:"doPerm",iconCls:"jeicon jeicon-data-authorization"}),this.callParent()}}),Ext.define("JE.sys.documentation.view.FuncInfoTreeView",{extend:"Ext.tree.Panel",border:0,alias:"widget.documentation.funcinfotreeview",useArrows:!0,rootVisible:!1,initComponent:function(){this.store=JE.getStore({type:"tree",tableName:"JE_SYS_DOCUMENTATION",url:JE.getUrlMaps("je.core.doc.documentation","getFuncInfoTree"),params:{}}),this.callParent()}}),Ext.define("JE.sys.documentation.view.MainView",{extend:"Ext.panel.Panel",alias:"widget.documentation.mainview",border:0,layout:"border",noDnd:!1,fileMode:"USER",readOnly:!1,hideFunc:!1,initComponent:function(){var e=this.readOnly;this.fileMode=Ext.value(this.fileMode,"USER");var t=200;"plus"==JE.getTheme()&&(t=300),this.items=[{xtype:"documentation.westview",region:"west",fileMode:this.fileMode,padding:"0 4 0 0",width:t,hideFunc:this.hideFunc,readOnly:e},{region:"center",xtype:"documentation.centerview",noDnd:this.noDnd,readOnly:e,fileMode:this.fileMode}],this.callParent()}}),Ext.define("JE.sys.documentation.view.OfficeView",{extend:"Ext.panel.Panel",border:1,alias:"widget.documentation.officeview",bodyPadding:"1 0 0 0",layout:"fit",initComponent:function(){var i=this;i.localLang=JE.getLocalLang("sys.document.officeView"),i.isRevisionOnly=Ext.value(i.isRevisionOnly,!1),i.readOnly=Ext.value(i.readOnly,!1);var e=Ext.value(i.otherParams,{});i.isSeal=Ext.value(e.seal,!1),i.isRed=Ext.value(e.red,!1),i.isHistory=Ext.value(e.history,!1);var t=e.user_id,a="";JE.isNotEmpty(t)&&(a=" AND SEAL_DEPTUSER_ID like '%"+t+"%'"),i.mb=Ext.value(i.mb,""),i.items={xtype:"panel",tbar:[{xtype:"button",text:i.localLang.taohong,ref:"taohong",hidden:!i.isRed||i.readOnly,handler:function(){if(i.setIframeVisable(!1),!i.filePath.match(/.doc$|.docx$/g))return JE.msg(i.localLang.taohongAlert),i.setIframeVisable(!0),!1;var e=i.filePath.split(".")[i.filePath.split(".").length-1];JE.selectWin({title:i.localLang.taohongTitle,configInfo:"JE_SYS_REDTOP,,,S",type:"grid",whereSql:" and REDTOP_MBWJ like '%"+e+"' ",callback:function(e){if(e||0<e.length){i.mb=e[0].get("REDTOP_MBWJ").split("*")[1];var t=e[0].get("JE_SYS_REDTOP_ID");JE.ajax({url:JE.getUrlMaps("je.core.save"),params:{funcCode:"JE_SYS_REDTOPREC",codeGenFieldInfo:[],tableCode:"JE_SYS_REDTOPREC",REDTOPREC_WJID:t,REDTOPREC_DEPTUSER_NAME:JE.currentUser.username,REDTOPREC_DEPTUSER_CODE:JE.currentUser.userCode,REDTOPREC_WJM:i.fileName,REDTOPREC_WJDZ:i.filePath}})}i.setIframeVisable(!0),i.updateIframe()},cancelButtonClick:function(){i.setIframeVisable(!0)}})}},{xtype:"button",text:i.localLang.seal,ref:"gaizhang",hidden:!i.isSeal||i.readOnly,handler:function(){i.setIframeVisable(!1),JE.selectWin({title:i.localLang.sealTitle,configInfo:"JE_SYS_SEAL,,,S",type:"grid",whereSql:a,callback:function(e){if(e||0<e.length){i.officeObj.InsertWebImage(e[0].get("SEAL_TP").split("*")[1]);var t=e[0].get("JE_SYS_SEAL_ID");JE.ajax({url:JE.getUrlMaps("je.core.save"),params:{funcCode:"JE_SYS_SEALREC",codeGenFieldInfo:[],tableCode:"JE_SYS_SEALREC",SEALREC_WJID:t,SEALREC_DEPTUSER_NAME:JE.currentUser.username,SEALREC_DEPTUSER_CODE:JE.currentUser.userCode,SEALREC_WJM:i.fileName,SEALREC_WJDZ:i.filePath}})}i.setIframeVisable(!0)},cancelButtonClick:function(){i.setIframeVisable(!0)}})}},{xtype:"button",text:i.localLang.traceEnable,ref:"liuhen",hidden:!i.isHistory||i.readOnly,handler:function(){if(!i.filePath.match(/.doc$|.docx$/g))return JE.msg(i.localLang.traceAlert),!1;(i.isRevisionOnly=!i.isRevisionOnly)?this.setText(i.localLang.traceDisable):this.setText(i.localLang.traceEnable),i.updateIframe()}}],html:'<iframe id="-iframe" scrolling="auto" frameborder="0"  width="100%" height="100%" src="/static/ux/pageoffice/index.jsp?path='+i.filePath+"&readOnly="+i.readOnly+"&isRevisionOnly="+i.isRevisionOnly+"&username="+JE.currentUser.username+'" name=officePage ></iframe>'},this.callParent(arguments)},afterRender:function(){this.callParent(),this.officePanel=this.items.get(0),this.initIframe()},updateIframe:function(){this.iframeDom.location.href="/static/ux/pageoffice/index.jsp?path="+this.filePath+"&readOnly="+this.readOnly+"&isRevisionOnly="+this.isRevisionOnly+"&username="+JE.currentUser.username+"&mb="+this.mb,this.initIframe()},initIframe:function(){var e=this;if(Ext.get("-iframe")){var t=Ext.get("-iframe").dom;t.onload=function(){e.iframeDom=t.contentWindow.document,e.officeObj=e.iframeDom.getElementById("PageOfficeCtrl1")}}},setIframeVisable:function(e){Ext.get("-iframe")&&Ext.get("-iframe").setVisible(e)},getButton:function(e){return this.down("button[ref="+e+"]")}}),Ext.define("JE.sys.documentation.view.perm.DocPermForm",{extend:"Ext.form.Panel",alias:"widget.documentation.docpermform",frame:!1,layout:"column",border:0,autoScroll:!0,bodyStyle:{background:"#f1f1f1"},bodyPadding:"10 20 0 20",defaults:{xtype:"fieldset",labelAlign:"right",margin:"5 0 0 0 ",layout:"column",collapsible:!0,columnWidth:1,defaults:{xtype:"textfield",labelAlign:"right",margin:"5 0 8 0",columnWidth:1}},initComponent:function(){var e=this;e.localLang=JE.getLocalLang("sys.document.docPermForm"),this.items=[{title:e.localLang.visiblePermTitle,items:[{fieldLabel:e.localLang.user,name:"seeUserNames",xtype:"queryuserareafield",configInfo:"JE_CORE_QUERYUSER,seeUserNames~seeUserIds,USERNAME~USERID,M",otherConfig:JE.toStr({DEPT:"1",SENTRY:"1",ROLE:"1",WORKGROUP:"1",QUICKQUERY:"NONE"})},{fieldLabel:"可见人员ID",xtype:"hidden",name:"seeUserIds"},{fieldLabel:e.localLang.department,name:"seeDeptNames",xtype:"treessareafield",configInfo:"JE_RBAC_DEPARTMENT,seeDeptNames~seeDeptIds,text~id,M"},{fieldLabel:"可见部门ID",xtype:"hidden",name:"seeDeptIds"},{fieldLabel:e.localLang.role,xtype:"treessareafield",name:"seeRoleNames",configInfo:"JE_RBAC_ROLE,seeRoleNames~seeRoleIds,text~id,M"},{fieldLabel:"可见角色ID",xtype:"hidden",name:"seeRoleIds"},{fieldLabel:e.localLang.post,xtype:"treessareafield",name:"seeSentryNames",configInfo:"JE_RBAC_SENTRY,seeSentryNames~seeSentryIds,text~id,M"},{fieldLabel:"可见岗位ID",xtype:"hidden",name:"seeSentryIds"},{xtype:"yesnofield",fieldLabel:e.localLang.cascadeSubFolder,name:"cascadeChild"}]},{title:e.localLang.controllablePermTitle,items:[{fieldLabel:e.localLang.user,name:"updateUserNames",xtype:"queryuserareafield",configInfo:"JE_CORE_QUERYUSER,updateUserNames~updateUserIds,USERNAME~USERID,M",otherConfig:JE.toStr({DEPT:"1",SENTRY:"1",ROLE:"1",WORKGROUP:"1",QUICKQUERY:"NONE"}),listeners:{query:function(e,t){var i=e.up("form[xtype=documentation.docpermform]"),a=i.form.getValues(),n=[];Ext.isEmpty(a.seeUserNames)||(n=Ext.value(a.seeUserNames,"").split(","));var o=[];Ext.isEmpty(a.seeUserIds)||(o=Ext.value(a.seeUserIds,"").split(",")),Ext.each(t,function(e){-1==o.indexOf(e.get("USERID"))&&(o.push(e.get("USERID")),n.push(e.get("USERNAME")))}),i.form.setValues({seeUserNames:n.join(","),seeUserIds:o.join(",")})}}},{fieldLabel:"可控人员ID",xtype:"hidden",name:"updateUserIds"},{fieldLabel:e.localLang.department,xtype:"treessareafield",name:"updateDeptNames",configInfo:"JE_RBAC_DEPARTMENT,updateDeptNames~updateDeptIds,text~id,M",listeners:{query:function(e,t){var i=e.up("form[xtype=documentation.docpermform]"),a=i.form.getValues(),n=[];Ext.isEmpty(a.seeDeptNames)||(n=Ext.value(a.seeDeptNames,"").split(","));var o=[];Ext.isEmpty(a.seeDeptIds)||(o=Ext.value(a.seeDeptIds,"").split(",")),Ext.each(t,function(e){-1==o.indexOf(e.get("id"))&&(o.push(e.get("id")),n.push(e.get("text")))}),i.form.setValues({seeDeptNames:n.join(","),seeDeptIds:o.join(",")})}}},{fieldLabel:"可控部门ID",xtype:"hidden",name:"updateDeptIds"},{fieldLabel:e.localLang.role,xtype:"treessareafield",name:"updateRoleNames",configInfo:"JE_RBAC_ROLE,updateRoleNames~updateRoleIds,text~id,M",listeners:{query:function(e,t){var i=e.up("form[xtype=documentation.docpermform]"),a=i.form.getValues(),n=[];Ext.isEmpty(a.seeRoleNames)||(n=Ext.value(a.seeRoleNames,"").split(","));var o=[];Ext.isEmpty(a.seeRoleIds)||(o=Ext.value(a.seeRoleIds,"").split(",")),Ext.each(t,function(e){-1==o.indexOf(e.get("id"))&&(o.push(e.get("id")),n.push(e.get("text")))}),i.form.setValues({seeRoleNames:n.join(","),seeRoleIds:o.join(",")})}}},{fieldLabel:"可控角色ID",xtype:"hidden",name:"updateRoleIds"},{fieldLabel:e.localLang.post,xtype:"treessareafield",name:"updateSentryNames",configInfo:"JE_RBAC_SENTRY,updateSentryNames~updateSentryIds,text~id,M",listeners:{query:function(e,t){var i=e.up("form[xtype=documentation.docpermform]"),a=i.form.getValues(),n=[];Ext.isEmpty(a.seeSentryNames)||(n=Ext.value(a.seeSentryNames,"").split(","));var o=[];Ext.isEmpty(a.seeSentryIds)||(o=Ext.value(a.seeSentryIds,"").split(",")),Ext.each(t,function(e){-1==o.indexOf(e.get("id"))&&(o.push(e.get("id")),n.push(e.get("text")))}),i.form.setValues({seeSentryNames:n.join(","),seeSentryIds:o.join(",")})}}},{fieldLabel:"可控岗位ID",xtype:"hidden",name:"updateSentryIds"}]}],this.callParent()}}),Ext.define("JE.sys.documentation.view.QueryFormView",{extend:"Ext.form.Panel",alias:"widget.documentation.queryformview",layout:"column",border:0,autoScroll:!0,defaults:{xtype:"fieldset",labelAlign:"right",margin:"5 0 0 0 ",layout:"column",collapsible:!1,columnWidth:1,defaults:{xtype:"textfield",labelAlign:"right",margin:"5 0 8 0",labelWidth:40,columnWidth:1}},initComponent:function(){var e=this;e.localLang=JE.getLocalLang("sys.document.queryForm"),e.items=[{title:e.localLang.fileTitle,style:"background: aliceblue;",margin:"4",minHeight:84,minWidth:183,items:[{labelWidth:60,fieldLabel:e.localLang.fileName,name:"JE_SYS_FILENAME"},{labelWidth:60,xtype:"treessfield",fieldLabel:e.localLang.filePath,name:"JE_SYS_PATH",configInfo:"JE_SYS_DOCUMENTATION,JE_SYS_PATH~JE_SYS_DIRID,text~id",whereSql:" AND SY_CREATEUSER='"+JE.currentUser.userCode+"'"},{labelWidth:60,xtype:"hidden",name:"JE_SYS_DIRID"}]},{title:e.localLang.formatTitle,margin:"4",style:"background: aliceblue;",minHeight:186,minWidth:183,items:[{xtype:"cgroup",columns:2,configInfo:"JE_DOCUMENTATION_FILETYPE",name:"JE_SYS_FILETYPE"},{fieldLabel:e.localLang.appoint,name:"JE_SYS_DIYTYPE"}]},{title:e.localLang.sizeTitle,margin:"4",style:"background: aliceblue;",minHeight:136,minWidth:183,items:[{xtype:"rgroup",columns:2,configInfo:"JE_DOCUMENTATION_FILESIZE",name:"JE_SYS_FILESIZE",value:"all"},{xtype:"numberfield",fieldLabel:e.localLang.appoint,hideTrigger:!0,name:"JE_SYS_DIYSTARTSIZE",columnWidth:.45},{xtype:"box",cellCls:"tableform-title",colspan:2,margin:"10 0 0 5",html:"M",columnWidth:.05},{labelWidth:25,xtype:"numberfield",fieldLabel:e.localLang.to,hideTrigger:!0,labelSeparator:"",name:"JE_SYS_DIYENDSIZE",columnWidth:.42},{xtype:"box",cellCls:"tableform-title",colspan:2,margin:"10 0 0 5",html:"M",columnWidth:.05}]},{title:e.localLang.lastModifyTime,margin:"4",style:"background: aliceblue;",minHeight:126,minWidth:183,items:[{xtype:"rgroup",columns:2,configInfo:"JE_DOCUMENTATION_MODFIYTIME",name:"JE_SYS_MODFIYDATE",value:"all"},{xtype:"datetimefield",dateType:"date",fieldLabel:e.localLang.appoint,format:e.localLang.timeFormat,name:"JE_SYS_DIYDATE"}]}],e.buttons=[{text:e.localLang.queryText,ref:"okQuery",iconCls:"jeicon jeicon-check"},{text:e.localLang.resetText,ref:"resetQuery",iconCls:"jeicon jeicon-error"}],e.buttonAlign="center",this.callParent()}}),Ext.define("JE.sys.documentation.view.TreeMenu",{extend:"Ext.menu.Menu",alias:"widget.documentation.treemenu",defaultAlign:"br-tr",frame:!1,border:1,initComponent:function(){var t=this;t.localLang=JE.getLocalLang("sys.document.treeMenu");var e=t.fileDataView,i=[{text:t.localLang.open,code:"openFile",iconCls:"jeicon jeicon-check"},{text:t.localLang.browse,code:"seeFile",iconCls:"jeicon jeicon-search"},{text:t.localLang.download,code:"downloadFile",iconCls:"jeicon jeicon-download-recently"},{text:t.localLang.sendExpress,code:"sendExpress",iconCls:"jeicon jeicon-shipping",disabled:e.readOnly},{text:t.localLang.packDownload,code:"packageDownload",iconCls:"jeicon jeicon-compress-static"},"-",{text:t.localLang.copy,code:"copyFile",iconCls:"jeicon jeicon-chart-copy",disabled:e.readOnly},{text:t.localLang.cut,code:"cutFile",iconCls:"jeicon jeicon-scissors",disabled:e.readOnly},{text:t.localLang.zipPackage,code:"reducePackage",iconCls:"jeicon jeicon-upgrade-package",disabled:e.readOnly},{text:t.localLang.toCommon,code:"addUse",iconCls:"jeicon jeicon-produce",disabled:e.readOnly},"-",{text:t.localLang.rename,code:"rename",iconCls:"jeicon jeicon-rename-o",disabled:e.readOnly},{text:t.localLang.remove,code:"remove",iconCls:"jeicon jeicon-error",disabled:e.readOnly},"-",{text:t.localLang.restore,code:"restore",iconCls:"jeicon jeicon-check",disabled:e.readOnly},{text:t.localLang.del,code:"sheerRemove",iconCls:"jeicon jeicon-trash-o",disabled:e.readOnly},{text:t.localLang.attribute,code:"attribute",iconCls:"jeicon jeicon-set-up"}],a=[{text:t.localLang.checkAll,code:"selectAll",iconCls:"jeicon jeicon-check-circle"},{text:t.localLang.refresh,code:"refresh",iconCls:"jeicon jeicon-refresh"},{text:t.localLang.paste,code:"pasteFile",iconCls:"jeicon jeicon-paste",disabled:e.readOnly},{text:t.localLang.emptyTrash,iconCls:"jeicon jeicon-paste",code:"clearRecycle",disabled:e.readOnly},{text:t.localLang.newText,code:"newFile",iconCls:"jeicon jeicon-resource-table-addition",disabled:e.readOnly,menu:[{text:t.localLang.word,code:"officeWord",iconCls:"jeicon jeicon-word"},{text:t.localLang.excel,code:"officeExcel",iconCls:"jeicon jeicon-excel"},{text:t.localLang.ppt,code:"officePowerPoint",iconCls:"jeicon jeicon-ppt"},{text:t.localLang.txt,code:"txt",iconCls:"jeicon jeicon-txt"}]}],n=[];switch(t.modeType){case"FILE":n=["restore","sheerRemove","clearRecycle"];break;case"RECYCLE":n=["openFile","seeFile","downloadFile","packageDownload","copyFile","cutFile","rename","reducePackage","rename","remove","pasteFile","newFile","sendExpress","addUse"];break;case"QUERY":n=["reducePackage","restore","sheerRemove","pasteFile","clearRecycle","newFile","addUse"];break;case"FUNC":n=["openFile","cutFile","reducePackage","rename","remove","attribute","restore","sheerRemove","attribute","pasteFile","clearRecycle","newFile","addUse"]}if("item"==t.menuType){var o=[];Ext.each(i,function(e){Ext.isEmpty(e.code)||(-1!=n.indexOf(e.code)?e.hidden=!0:"RECYCLE"!=t.modeType&&"FUNC"!=t.modeType||o.push(e))}),"RECYCLE"==t.modeType||"FUNC"==t.modeType?t.items=o:t.items=i}else Ext.each(a,function(e){Ext.isEmpty(e.code)||-1!=n.indexOf(e.code)&&(e.hidden=!0)}),t.items=a;this.callParent()}}),Ext.define("JE.sys.documentation.view.WestView",{extend:"Ext.panel.Panel",alias:"widget.documentation.westview",layout:"accordion",layoutConfig:{titleCollapse:!1,animate:!1,activeOnTop:!0},border:1,initComponent:function(){var e=JE.getLocalLang("sys.document.westview");this.items=[{title:e.filemenuTitle,itemId:"filemenuview",readOnly:this.readOnly,iconCls:"jeicon jeicon-folders",fileMode:this.fileMode,xtype:"documentation.filemenuview",listeners:{expand:function(e,t){var i=e.getSelectionModel(),a=i.getSelection();e.fireEvent("selectionchange",i,a)}}},{title:e.queryformTitle,iconCls:"jeicon jeicon-search",itemId:"queryformview",fileMode:this.fileMode,xtype:"documentation.queryformview",listeners:{expand:function(e,t){var i=e.down("button[ref=okQuery]");i.fireEvent("click",i)}}}],"USER"!=this.fileMode||this.hideFunc||this.items.push({title:e.functreeTitle,iconCls:"jeicon jeicon-data-authorization",itemId:"funcinfotreeview",xtype:"documentation.funcinfotreeview",listeners:{expand:function(e,t){var i=e.getSelectionModel(),a=i.getSelection();e.fireEvent("selectionchange",i,a)}}}),this.callParent()}}),Ext.define("JE.sys.documentation.view.zip.ZipDirTree",{extend:"Ext.tree.Panel",border:0,alias:"widget.documentation.zipdirtree",useArrows:!0,rootVisible:!1,viewConfig:{selectedItemCls:"x-tree-row-selected",focusedItemCls:"x-tree-row-focused",beforeFocusedItemCls:"x-tree-row-before-focused",tableFocusedFirstCls:"x-tree-table-focused-first"},selModel:{allowDeselect:!0,mode:"SINGLE"},initComponent:function(){this.store=JE.getStore({type:"tree",tableName:"JE_SYS_DOCUMENTATION",url:JE.getUrlMaps("je.core.cogetTree"),params:{fileMode:this.fileMode,rootId:this.zipId,moreRoot:!1,whereSql:" AND SY_STATUS='1' AND DOCUMENTATION_TYPE='DIR' AND SY_CREATEUSER='"+JE.currentUser.userCode+"'"}}),this.callParent()}}),Ext.define("JE.sys.documentation.view.zip.ZipFileView",{extend:"Ext.panel.Panel",alias:"widget.documentation.zipfileview",layout:"fit",viewType:"thumbnail",orderType:"name",plugins:[Ext.create("JE.sys.documentation.drag.DragSelector",{})],initComponent:function(){var e=this;e.localLang=JE.getLocalLang("sys.document.treeMenu"),Ext.apply(e.localLang,JE.getLocalLang("sys.document.fileData"));var t=JE.getStore({tableName:"JE_SYS_DOCUMENTATION",pageSize:100,action:JE.getUrlMaps("je.core.doc.documentation"),id:"JE_SYS_DOCUMENTATION_ID",params:{fileMode:e.fileMode,whereSql:" AND SY_PARENT='"+e.zipId+"'",orderSql:" ORDER BY DOCUMENTATION_TEXT",baseSql:" AND SY_STATUS='1'",permSql:" AND SY_CREATEUSER='"+JE.currentUser.userCode+"'"},autoLoad:!0});e.items=[{xtype:"dataview",tpl:['<tpl for=".">','<div class=table-files style="border: 1px solid #fff;table-layout:fixed;word-wrap:break-word;float:left;margin:9px;width:104px;height:133px;">','<div style="text-align:center;width:96px;height:96px;"><table width=100% height=100%><tr><td align=center valign = middle>{DOCUMENTATION_THUMBNAILCLS}</td></tr></table></div>','<div class="x-editable" style="height:36px;padding-top:4px;text-align:center;overflow:hidden;text-overflow:ellipsis;" title="{DOCUMENTATION_TEXT}">{[values.DOCUMENTATION_TEXT.ellipsis(14)]}</div>',"</div>","</tpl>"],multiSelect:!0,overItemCls:"x-view-over",trackOver:!0,selectedItemCls:"x-dataview-item-selected",itemSelector:"div.table-files",emptyText:"",store:t,menuTree:Ext.create("JE.sys.documentation.view.zip.ZipTreeMenu",{frame:!1,border:1,items:[{text:e.localLang.browse,code:"seeFile",iconCls:"jeicon jeicon-search"},{text:e.localLang.download,code:"downloadFile",iconCls:"jeicon jeicon-form-configuration"},{text:e.localLang.rename,code:"rename",iconCls:"jeicon jeicon-form-configuration"},{text:e.localLang.remove,code:"remove",iconCls:"jeicon jeicon-error"}],fileView:e})},{xtype:"gridpanel",hidden:!0,cls:"jegrid",multiSelect:!0,autoScroll:!0,columnLines:!0,animCollapse:!1,columns:[{text:e.localLang.name,dataIndex:"DOCUMENTATION_TEXT",width:200,renderer:function(e,t,i,a,n,o,r,l,s){return"<input type='button' class='"+i.get("DOCUMENTATION_ICONCLS")+" je-button-icon'/>"+e}},{text:e.localLang.modifyTime,dataIndex:"SY_MODIFYTIME",width:150},{text:e.localLang.type,dataIndex:"DOCUMENTATION_FILETYPENAME",width:100},{text:e.localLang.size,dataIndex:"DOCUMENTATION_SIZE",width:100,renderer:function(e,t,i,a,n,o,r,l,s){if("DIR"==i.get("DOCUMENTATION_TYPE"))return"";var d=1*Ext.value(e,0);return Math.ceil(d/1e3)+" KB"}}],store:t,menuTree:Ext.create("JE.sys.documentation.view.zip.ZipTreeMenu",{frame:!1,border:1,items:[{text:e.localLang.browse,code:"seeFile",iconCls:"jeicon jeicon-search"},{text:e.localLang.download,code:"downloadFile",iconCls:"jeicon jeicon-form-configuration"},{text:e.localLang.rename,code:"rename",iconCls:"jeicon jeicon-form-configuration"},{text:e.localLang.remove,code:"remove",iconCls:"jeicon jeicon-error"}],fileView:e})}],e.menuTree=Ext.create("JE.sys.documentation.view.zip.ZipTreeMenu",{frame:!1,border:1,items:[{text:e.localLang.chackAll,code:"selectAll",iconCls:"jeicon jeicon-check"},{text:e.localLang.refresh,code:"refresh",iconCls:"jeicon jeicon-check"}],fileView:e}),e.tbar=[{ref:"view",text:e.localLang.view,iconCls:"jeicon jeicon-view",menu:[{text:e.localLang.thumbnail,iconCls:"jeicon jeicon-check",code:"thumbnail"},{text:e.localLang.icon,code:"icon"},{text:e.localLang.detail,code:"detailed"}]},{ref:"order",text:e.localLang.order,iconCls:"jeicon jeicon-sorting",menu:[{text:e.localLang.name,iconCls:"jeicon jeicon-check",code:"name"},{text:e.localLang.size,code:"size"},{text:e.localLang.type,code:"type"},{text:e.localLang.modifyTime,code:"uploadTime"}]},{ref:"oper",text:e.localLang.operation,iconCls:"jeicon jeicon-system-management",menu:[{text:e.localLang.browse,code:"seeFile",iconCls:"jeicon jeicon-search"},{text:e.localLang.download,code:"downloadFile",iconCls:"jeicon jeicon-form-configuration"},{text:e.localLang.rename,code:"rename",iconCls:"jeicon jeicon-form-configuration"},{text:e.localLang.remove,code:"remove",iconCls:"jeicon jeicon-error"}]}],e.dockedItems=[{xtype:"pagingtoolbar",store:t,dock:"bottom",displayInfo:!0}],this.callParent()}}),Ext.define("JE.sys.documentation.view.zip.ZipTreeMenu",{extend:"Ext.menu.Menu",alias:"widget.documentation.ziptreemenu",defaultAlign:"br-tr",frame:!0,border:0}),Ext.define("JE.sys.documentation.controller.DocumentationController",{extend:"Ext.app.Controller",mixins:{docUtil:"JE.sys.documentation.util.DocumentationUtil"},init:function(){var I=this;I.copyInfo=null;var e={"treepanel[xtype=documentation.filemenuview]":{selectionchange:function(e,t,i){var a=e.view.panel,n=t[0],o=a.up("panel[xtype=documentation.mainview]"),r=o.down("panel[xtype=documentation.filedataview]"),l=r.getDockedItems('toolbar[dock="bottom"]')[0],s=o.down("panel[xtype=documentation.centerview]"),d=I.getFileView(r),c=r.down("button[ref=addDir]"),u=r.down("button[ref=addFile]"),p=r.down("button[ref=oper]"),f=r.down("button[ref=permOne]"),E=r.down("button[ref=permBatch]");r.down("button[ref=callQueryBtn]").setVisible(!1);var m=d.getStore();"FUNC"==r.modeType&&(m.proxy.extraParams.tableCode="JE_SYS_DOCUMENTATION");var g="AND SY_PARENT='ROOT'",h=" AND SY_STATUS='1'",x=" AND SY_CREATEUSER='"+JE.currentUser.userCode+"'",v=I.getOrderSql(r.orderType);if(m.proxy.extraParams.dirOnly=!1,n){var y=n.get("nodeInfoType"),b=n.get("code");switch(p.show(),l.show(),"COMPANY"!=a.fileMode||r.readOnly||(f.show(),E.show()),y){case"SYSTEM":switch(c.setDisabled(!0),u.setDisabled(!0),b){case"myrecycle":g="",h=" AND SY_STATUS='0' AND SY_CHILDRENSTATUS='0'",r.modeType="RECYCLE",p.hide(),"COMPANY"!=a.fileMode||r.readOnly||(f.hide(),E.hide());break;case"myupload":g=" AND DOCUMENTATION_TYPE='FILE'",r.modeType="QUERY",v=" ORDER BY SY_CREATETIME DESC",l.hide(),"COMPANY"!=a.fileMode||r.readOnly||(f.hide(),E.hide());break;case"mydownload":g="  AND (DOCUMENTATION_TYPE='FILE' OR (DOCUMENTATION_TYPE='DIR' AND DOCUMENTATION_PACKAGE='1')) AND DOCUMENTATION_DOWNTIME "+("ORACLE"==JE.systemConfig.JE_SYS_DB?" IS NOT NULL":" !='' "),r.modeType="QUERY",v=" ORDER BY DOCUMENTATION_DOWNTIME DESC",l.hide(),"COMPANY"!=a.fileMode||r.readOnly||(f.hide(),E.hide());break;case"myopen":g=" AND DOCUMENTATION_TYPE='FILE' AND DOCUMENTATION_OPENTIME "+("ORACLE"==JE.systemConfig.JE_SYS_DB?" IS NOT NULL":" !='' "),r.modeType="QUERY",v=" ORDER BY DOCUMENTATION_OPENTIME DESC",l.hide(),"COMPANY"!=a.fileMode||r.readOnly||(f.hide(),E.hide())}break;case"DIR":r.modeType="FILE",r.readOnly?(c.setDisabled(!0),u.setDisabled(!0)):(c.setDisabled(!1),u.setDisabled(!1));var C="myfile"==n.get("id")?"ROOT":n.get("id");if("COMPANY"==a.fileMode&&"0"==n.get("hrefTarget")){var w=new Array;n.eachChild(function(e){w.push(e.get("id"))}),g=" AND JE_SYS_DOCUMENTATION_ID IN ('"+w.join("','")+"')",m.proxy.extraParams.dirOnly=!0}else g=" AND SY_PARENT='"+C+"'"}I.setButtons(r.modeType,p),r.readOnly&&I.setButtons("READONLY",p)}else r.modeType="FILE",p.hide(),c.setDisabled(!0),u.setDisabled(!0),g=" AND 1!=1";m.proxy.extraParams.whereSql=g,m.proxy.extraParams.baseSql=h,m.proxy.extraParams.querySql="",m.proxy.extraParams.permSql=x,m.proxy.extraParams.orderSql=v,m.loadPage(1);var S=s.getDockedItems("toolbar[dock=top]")[0];I.updateToolbar(a,S,n,"FILE")},load:function(e,t,i,a){var n=e.ownerTree,o=e.getRootNode().findChild("id","myfile");if(o){var r=n.getSelectionModel();r.select(o,!0,!0);var l=n.up("panel[xtype=documentation.mainview]");if(l){n.fireEvent("selectionchange",r,[o]);var s=l.down("panel[xtype=documentation.centerview]").getDockedItems("toolbar[dock=top]")[0];I.updateToolbar(n,s,o,"FILE")}}},itemcontextmenu:function(e,t,i,a,n,o){var r=e.panel,l=r.menuWin;n.stopEvent(),"SYSTEM"!=t.get("nodeInfo")&&(r.readOnly||(l.showAt(n.getXY()),l.doConstrain()))}},"treepanel[xtype=documentation.filemenuview] dataview[xtype=documentation.fasterview]":{itemdblclick:function(e,t,i,a,n,o){var r=e.up("treepanel[xtype=documentation.filemenuview]"),l=r.getStore(),s=l.getNodeById(t.get("FASTERDOC_DOC_ID"));s?(r.getSelectionModel().select(s),Ext.each(s.getPath().split("/"),function(e){if(!Ext.isEmpty(e)&&"ROOT"!=e){var t=l.getNodeById(e);t&&t.expand()}})):JE.msg(JE.getLocalLang("sys.document.ctr.noFolderAlert"))},beforeitemcontextmenu:function(e,t,i,a,n,o){var r=e.getSelectionModel().getSelection();if(0<r.length){var l=!1;Ext.each(r,function(e){t.get("JE_SYS_FASTERDOC_ID")==e.get("JE_SYS_FASTERDOC_ID")&&(l=!0)}),l?e.getSelectionModel().select(r):e.getSelectionModel().select(t)}else e.getSelectionModel().select(t)},itemcontextmenu:function(e,t,i,a,n,o){var r=e.menuWin;n.stopEvent(),r.showAt(n.getXY()),r.doConstrain()}},"treepanel[xtype=documentation.funcinfotreeview]":{selectionchange:function(e,t,i){var a=e.view.panel,n=a.up("panel[xtype=documentation.mainview]"),o=n.down("panel[xtype=documentation.centerview]"),r=n.down("panel[xtype=documentation.filedataview]"),l=r.getDockedItems('toolbar[dock="bottom"]')[0],s=I.getFileView(r),d=r.down("button[ref=addDir]"),c=r.down("button[ref=addFile]"),u=r.down("button[ref=oper]"),p=r.down("button[ref=callQueryBtn]"),f=t[0],E=s.getStore(),m="AND DOCUMENTATION_TYPE='FUNC'",g=I.getOrderSql(r.orderType);if("FUNC"!=r.modeType){r.modeType="FUNC";s=I.getFileView(r);I.setButtons("FUNC",u),r.readOnly&&I.setButtons("READONLY",u),d.setDisabled(!0),c.setDisabled(!0),l.show(),p.setVisible(!1),E.getProxy().extraParams.tableCode="JE_SYS_FUNCSELECT"}if(f=f||a.getRootNode()){var h=new Array;"MT"==f.get("nodeInfoType")?h.push(f.get("nodeInfo")):"SUB_FUNC"==f.get("nodeInfoType")&&h.push(f.get("code")),I.eachAllChild(f,function(e){"MT"==e.get("nodeInfoType")?h.push(e.get("nodeInfo")):"SUB_FUNC"==e.get("nodeInfoType")&&h.push(e.get("code"))}),m+=" AND DOCUMENT_FUNCCODE IN ('"+h.join("','")+"') AND SY_CREATEUSER='"+JE.currentUser.userCode+"'"}var x=o.getDockedItems("toolbar[dock=top]")[0];I.updateToolbar(a,x,f,"FUNC"),E.proxy.extraParams.whereSql=m,E.proxy.extraParams.baseSql=" AND SY_STATUS='1'",E.proxy.extraParams.permSql="",E.proxy.extraParams.dirOnly=!1,E.proxy.extraParams.querySql="",E.proxy.extraParams.orderSql=g,E.loadPage(1)}},"panel[xtype=documentation.filedataview] dataview":{itemdblclick:function(e,t,i,a,n,o){var r=e.up("panel[xtype=documentation.mainview]"),l=r.down("treepanel[xtype=documentation.filemenuview]"),s=e.up("panel[xtype=documentation.filedataview]"),d=s.modeType;if("RECYCLE"!=d){if("DIR"!=t.get("DOCUMENTATION_TYPE")){if(e.noDnd){var c=r.up("window");return c.fn(c),void c.close()}}else if(e.noDnd&&"1"==t.get("DOCUMENTATION_PACKAGE"))return;var u=(e=I.getFileView(s)).getStore();if("QUERY"==d&&"DIR"==t.get("DOCUMENTATION_TYPE")&&"0"==t.get("DOCUMENTATION_PACKAGE")){var p=" AND SY_PARENT='"+t.get("JE_SYS_DOCUMENTATION_ID")+"'";u.proxy.extraParams.whereSql=p,u.loadPage(1)}else I.openFile(l,t,u)}},beforeitemcontextmenu:function(e,t,i,a,n,o){var r=e.getSelectionModel().getSelection();if(0<r.length){var l=!1;Ext.each(r,function(e){t.get("JE_SYS_DOCUMENTATION_ID")==e.get("JE_SYS_DOCUMENTATION_ID")&&(l=!0)}),l?e.getSelectionModel().select(r):e.getSelectionModel().select(t)}else e.getSelectionModel().select(t)},itemcontextmenu:function(e,t,i,a,n,o){var r=e.up("panel[xtype=documentation.filedataview]"),l=r.modeType;"detailed"==r.viewType&&(e=e.panel);var s=e.menuTree;"RECYCLE"==l?s=e.recycleMenu:"QUERY"==l?s=e.queryMenu:"FUNC"==l&&(s=e.funcMenu),n.stopEvent(),s.showAt(n.getXY()),s.doConstrain()},afterrender:function(d){var n=d.id;if(!d.noDnd&&!d.readOnly){JE.loadScript("/static/ux/webuploader/js/webuploader.js");var e={tableCode:"JE_SYS_DOCUMENTATION"};if("1"==JE.systemConfig.JE_SYS_ENCRYPT){var t=JE.DES(e);e[t.code]=t.value}var i=WebUploader.create({formData:e,fileVal:"DOCUMENTATION_ADDRESS",dnd:"#"+n,chunked:!1,swf:JE.getStaticUrl("JE.common.file.Uploader","swf"),server:JE.getUrlMaps("je.core.doc.documentation","uploadFile"),disableGlobalDnd:!0,prepareNextFile:!0,fileNumLimit:1e3,fileSingleSizeLimit:1048576e3,dndDragEnter:function(e){if("FILE"==d.up("panel[xtype=documentation.filedataview]").modeType){var t=d.getEl(),i=Ext.get(n+"_JEMaskView"),a=Ext.get(n+"_JEMaskViewText");"none"==i.getStyle("display")&&(i.setStyle("left",t.getX()+"px"),i.setStyle("top",t.getY()+"px"),a.setStyle("top",(t.getHeight()-50)/2+"px"),a.setStyle("left",(t.getWidth()-300)/2+"px"),i.setStyle("display","block"))}},dndDragOver:function(e){},dndDragLeave:function(e){if("FILE"==d.up("panel[xtype=documentation.filedataview]").modeType){var t=Ext.get(n+"_JEMaskView");"block"==t.getStyle("display")&&t.setStyle("display","none")}},dndDrop:function(e){if("FILE"==d.up("panel[xtype=documentation.filedataview]").modeType){var t=Ext.get(n+"_JEMaskView");"block"==t.getStyle("display")&&t.setStyle("display","none")}},dndFolders:function(e){var i=!0;if(e&&0<e.length){var t=d.up("panel[xtype=documentation.filedataview]");if("FILE"!=t.modeType)return!1;var n=t.up("panel[xtype=documentation.mainview]").down("treepanel[xtype=documentation.filemenuview]"),o=n.getSelectionModel().getSelection()[0];if(!o)return JE.alert(JE.getLocalLang("sys.document.util.selectFolderAlert")),!1;if("COMPANY"==n.fileMode&&!I.checkUpdatePerm(o.get("description"),o.get("bean").SY_CREATEUSERID))return JE.alert(JE.getLocalLang("sys.document.util.noPermAlert")),!1;var r="myfile"!=o.get("id")?o.get("id"):"ROOT",a=new Array;if(Ext.each(e,function(t){"NO"==t.pId&&d.getStore().each(function(e){"dir"==e.get("DOCUMENTATION_FILETYPE")&&e.get("DOCUMENTATION_TEXT")==t.name&&(i=!1,JE.alert("文件夹【"+t.name+"】已存在!"))}),a.push({id:t.id,name:t.name,pId:t.pId})}),0==i)return i;var l=JE.ajax({url:JE.getUrlMaps("je.core.doc.documentation","saveDirs"),params:{strData:JE.encode(a),fileMode:n.fileMode,pId:r}});if(!l.success)return JE.alert(l.obj),!1;var s=l.obj;Ext.each(s,function(e){var t=e.SY_PARENT,i=n.getStore().getNodeById(t);if(t==r&&(d.getStore().add(e),i=o),i){var a={id:e.JE_SYS_DOCUMENTATION_ID,text:e.DOCUMENTATION_TEXT,code:e.DOCUMENTATION_CODE,leaf:"LEAF"==e.SY_NODETYPE,nodePath:e.SY_PATH,parentPath:e.SY_PARENTPATH,nodeInfoType:e.DOCUMENTATION_TYPE,iconCls:e.DOCUMENTATION_ICONCLS,parent:e.SY_PARENT,children:[],expandable:!0,description:e.DOCUMENTATION_PERMJSON,bean:e};i.appendChild(a);i.get("id")==r&&o.expand()}})}return i}});i.on("beforeFileQueued",function(e){var t=d.up("panel[xtype=documentation.filedataview]");if("FILE"!=t.modeType)return!1;d.getStore();var i=t.up("panel[xtype=documentation.mainview]").down("treepanel[xtype=documentation.filemenuview]"),a=i.getSelectionModel().getSelection()[0];return a?"COMPANY"!=i.fileMode||I.checkUpdatePerm(a.get("description"),a.get("bean").SY_CREATEUSERID)?void 0:(JE.alert(JE.getLocalLang("sys.document.util.noPermAlert")),!1):(JE.alert(JE.getLocalLang("sys.document.util.selectFolderAlert")),!1)}),i.on("fileQueued",function(e){e&&(I.fileProgress.addFile([e]),i.upload())}),i.on("dndAccept",function(e){}),i.on("filesQueued",function(e){e.length<=0||(I.fileProgress.addFile(e),i.upload())}),i.on("uploadBeforeSend",function(e,t,i){i["Platform-Agent"]="AppleWebKit/537.36 (KHTML, like Gecko)",i.authorization=Ext.util.Cookies.get("authorization");var a=d.up("panel[xtype=documentation.filedataview]");if("FILE"!=a.modeType)return!1;d.getStore();var n=a.up("panel[xtype=documentation.mainview]").down("treepanel[xtype=documentation.filemenuview]"),o=Ext.value(Ext.value(e.file,{}).source,{}).pId;if(JE.isNotEmpty(o)&&"NO"!=o)t.SY_PARENT=o,t.SY_PATH="",t.SY_LAYER=-1;else{var r=n.getSelectionModel().getSelection()[0],l=(o="myfile"!=r.get("id")?r.get("id"):"ROOT",r.get("nodePath"));t.SY_PARENT=o,t.SY_PATH=l,t.SY_LAYER=r.get("layer")+1}t.DOCUMENTATION_FILEMODE=a.fileMode,t.SY_NODETYPE="LEAF",t.docType="docinfo",t.beanTableCode="JE_SYS_DOCUMENTATION"}),i.on("uploadSuccess",function(e,t){if(I.fileProgress.updateFile(e,100,JE.getLocalLang("sys.document.ctr.uploadSuccess")),1==t.success){var i=d.up("panel[xtype=documentation.filedataview]").up("panel[xtype=documentation.mainview]").down("treepanel[xtype=documentation.filemenuview]").getSelectionModel().getSelection()[0],a="myfile"!=i.get("id")?i.get("id"):"ROOT";t.obj.SY_PARENT==a&&d.getStore().add(t.obj)}else JE.error(t.obj,t)}),i.on("uploadProgress",function(e,t){var i=Math.floor(100*t);100==i&&(i=99),I.fileProgress.updateFile(e,i,JE.getLocalLang("sys.document.ctr.uploading"))}),i.on("uploadError",function(e,t){I.fileProgress.updateFile(e,0,JE.getLocalLang("sys.document.ctr.uploadError")),JE.error(JE.format(JE.getLocalLang("sys.document.ctr.uploadErrorMsg"),e.name))}),i.on("uploadComplete",function(e){i.removeFile(e)}),i.on("error",function(e){i.reset(),"F_EXCEED_SIZE"==e?JE.error(JE.getLocalLang("sys.document.ctr.uploadErrorSize")):"Q_EXCEED_NUM_LIMIT"==e?JE.error(JE.getLocalLang("sys.document.ctr.uploadErrorLimit")):"F_DUPLICATE"==e?JE.error(JE.getLocalLang("sys.document.ctr.uploadErrorDuplicate")):JE.error(JE.format(JE.getLocalLang("sys.document.ctr.uploadErrorOther"),e))})}}},"panel[xtype=documentation.filedataview]":{afterrender:function(o){o.getEl().on("contextmenu",function(e,t,i){var a=o.menuTree,n=o.modeType;"RECYCLE"==n?a=o.recycleMenu:"QUERY"==n?a=o.queryMenu:"FUNC"==n&&(a=o.queryMenu),e.stopEvent(),a.showAt(e.getXY()),a.doConstrain()})}},"panel[xtype=documentation.centerview] button[ref=dirBtn]":{click:function(e){var t=e.up("panel[xtype=documentation.mainview]");if("QUERY"!=e.modeType){var i=t.down("treepanel[xtype=documentation.filemenuview]");"FUNC"==e.modeType&&(i=t.down("treepanel[xtype=documentation.funcinfotreeview]"));var a=i.getStore().getNodeById(e.nodeId);a?i.getSelectionModel().select(a):JE.alert(JE.getLocalLang("sys.document.ctr.noFindFolderAlert"))}else{var n=t.down("panel[xtype=documentation.queryformview]").down("button[ref=okQuery]");n.fireEvent("click",n)}}},"panel[xtype=documentation.centerview] button[ref=upDirBtn]":{click:function(e){var t=e.up("panel[xtype=documentation.mainview]"),i=e.modeType;if("QUERY"!=i){var a=t.down("treepanel[xtype=documentation.filemenuview]");"FUNC"==i&&(a=t.down("treepanel[xtype=documentation.funcinfotreeview]"));var n=a.getSelectionModel(),o=n.getSelection()[0];o?"ROOT"==o.parentNode.get("id")?JE.alert(JE.getLocalLang("sys.document.ctr.topFolderAlert")):n.select(o.parentNode):JE.alert(JE.getLocalLang("sys.document.ctr.noSelectInfo"))}else JE.alert(JE.getLocalLang("sys.document.ctr.topFolderAlert"))}},"panel[xtype=documentation.filedataview] button[ref=addDir]":{click:function(e){var t=e.up("panel[xtype=documentation.filedataview]"),i=t.up("panel[xtype=documentation.mainview]"),a=I.getFileView(t),n=i.down("treepanel[xtype=documentation.filemenuview]");I.addFolder(t,a,n)}},"panel[xtype=documentation.filedataview] button[ref=addFile]":{click:function(e){var t=e.up("panel[xtype=documentation.filedataview]"),n=I.getFileView(t).getStore(),i=t.up("panel[xtype=documentation.mainview]").down("treepanel[xtype=documentation.filemenuview]"),a=i.getSelectionModel().getSelection()[0];if(a)if("COMPANY"!=i.fileMode||I.checkUpdatePerm(a.get("description"),a.get("bean").SY_CREATEUSERID)){var o={tableCode:"JE_SYS_DOCUMENTATION",SY_PARENT:"myfile"!=a.get("id")?a.get("id"):"ROOT",SY_PATH:a.get("nodePath"),DOCUMENTATION_FILEMODE:i.fileMode,SY_LAYER:a.get("layer")+1,SY_NODETYPE:"LEAF",currentUserId:JE.currentUser.userId,docType:"docinfo",beanTableCode:"JE_SYS_DOCUMENTATION"};JE.win({title:JE.getLocalLang("sys.document.ctr.uploadTitle"),width:800,height:600,items:{xtype:"uploadpanel",upload_url:JE.getUrlMaps("je.core.doc.documentation","uploadFile")+"?login=TRUE",file_post_name:"DOCUMENTATION_ADDRESS",post_params:o,failure:function(e,t,i){JE.error(t+"\n"+i)},success:function(e,t,i){var a=Ext.decode(Ext.value(t,"{}"));1==a.success?n.add(a.obj):JE.error(t,t)}}}).show()}else JE.alert(JE.getLocalLang("sys.document.util.noPermAlert"));else JE.alert(JE.getLocalLang("sys.document.util.selectFolderAlert"))}},"panel[xtype=documentation.filedataview] button[ref=view] menuitem":{click:function(e){var t=e.up("panel[xtype=documentation.filedataview]"),i=t.down("dataview"),a=t.down("gridpanel");t.viewType!=e.code&&I.changeViewType(t,e,i,a,!1)}},"panel[xtype=documentation.filedataview] button[ref=order] menuitem":{click:function(e){var t=e.up("panel[xtype=documentation.filedataview]"),i=I.getFileView(t);t.orderType!=e.code&&I.changeOrderType(t,i,e)}},"panel[xtype=documentation.filedataview] button[ref=oper] menuitem":{click:function(e){var t=e.up("panel[xtype=documentation.filedataview]"),i=t.up("panel[xtype=documentation.mainview]").down("treepanel[xtype=documentation.filemenuview]");I.doFile(i,t,e.code)}},"panel[xtype=documentation.filedataview] button[ref=permOne]":{click:function(e){var t=e.up("panel[xtype=documentation.filedataview]"),i=I.getFileView(t),a=t.up("panel[xtype=documentation.mainview]").down("treepanel[xtype=documentation.filemenuview]");I.doPerm(i,a,"view",!1)}},"panel[xtype=documentation.filedataview] button[ref=permBatch]":{click:function(e){var t=e.up("panel[xtype=documentation.filedataview]"),i=I.getFileView(t),a=t.up("panel[xtype=documentation.mainview]").down("treepanel[xtype=documentation.filemenuview]");I.doPerm(i,a,"view",!0)}},"panel[xtype=documentation.filedataview] button[ref=callQueryBtn]":{click:function(e){var t=e.up("panel[xtype=documentation.filedataview]").up("panel[xtype=documentation.mainview]").down("panel[xtype=documentation.queryformview]").down("button[ref=okQuery]");t.fireEvent("click",t)}},"menu[xtype=documentation.treemenu] menuitem":{click:function(e){var t=e.up("menu[xtype=documentation.treemenu]").fileDataView,i=t.up("panel[xtype=documentation.mainview]").down("treepanel[xtype=documentation.filemenuview]");I.doFile(i,t,e.code)}},"menu[xtype=documentation.foldertreemenu] menuitem":{click:function(e){var t=e.up("menu[xtype=documentation.foldertreemenu]").fileMenuTree,i=t.up("panel[xtype=documentation.mainview]").down("panel[xtype=documentation.filedataview]"),a=I.getFileView(i);I.doFolder(i,a,t,e.code)}},"menu[xtype=documentation.fastertreemenu] menuitem":{click:function(e){var t=e.up("menu[xtype=documentation.fastertreemenu]").fasterView;I.doFaster(t,e.code)}},"panel[xtype=documentation.queryformview] button[ref=okQuery]":{click:function(e){var t=e.up("panel[xtype=documentation.queryformview]"),i=t.up("panel[xtype=documentation.mainview]"),a=i.down("panel[xtype=documentation.centerview]"),n=i.down("panel[xtype=documentation.filedataview]");I.queryFile(t,i,a,n)}},"panel[xtype=documentation.queryformview] button[ref=resetQuery]":{click:function(e){var t=e.up("panel[xtype=documentation.queryformview]");t.form.findField("JE_SYS_FILESIZE").setValue("all"),t.form.findField("JE_SYS_MODFIYDATE").setValue("all"),t.form.reset();var i=t.up("panel[xtype=documentation.mainview]").down("panel[xtype=documentation.filedataview]"),a=I.getFileView(i).getStore();a.proxy.extraParams.whereSql=" AND DOCUMENTATION_TYPE='FILE'",a.proxy.extraParams.querySql="",a.proxy.extraParams.dirOnly=!1,a.loadPage(1)}},"panel[xtype=documentation.zipdirtree]":{selectionchange:function(e,t,i){var a=e.view.panel,n=t[0],o=a.up("window").down("panel[xtype=documentation.zipfileview]"),r=o.down("dataview");"详细信息"==o.modeType&&(r=o.down("gridpanel"));var l=r.getStore(),s=" AND SY_PARENT='"+a.zipId+"'";n&&(s="AND SY_PARENT='"+n.get("id")+"'"),l.getProxy().extraParams.whereSql=s,l.loadPage(1)}},"panel[xtype=documentation.zipfileview] dataview":{itemdblclick:function(e,t,i,a,n,o){var r=e.up("window").down("treepanel[xtype=documentation.zipdirtree]");I.openFile(r,t,e.getStore())},beforeitemcontextmenu:function(e,t,i,a,n,o){var r=e.getSelectionModel().getSelection();if(0<r.length){var l=!1;Ext.each(r,function(e){t.get("JE_SYS_DOCUMENTATION_ID")==e.get("JE_SYS_DOCUMENTATION_ID")&&(l=!0)}),l?e.getSelectionModel().select(r):e.getSelectionModel().select(t)}else e.getSelectionModel().select(t)},itemcontextmenu:function(e,t,i,a,n,o){"详细信息"==e.up("panel[xtype=documentation.zipfileview]").viewType&&(e=e.panel);var r=e.menuTree;n.stopEvent(),r.showAt(n.getXY()),r.doConstrain()}},"panel[xtype=documentation.zipfileview] button[ref=view] menuitem":{click:function(e){var t=e.up("panel[xtype=documentation.zipfileview]"),i=t.down("dataview"),a=t.down("gridpanel");t.viewType!=e.code&&I.changeViewType(t,e,i,a,!0)}},"panel[xtype=documentation.zipfileview] button[ref=order] menuitem":{click:function(e){var t=e.up("panel[xtype=documentation.zipfileview]"),i=t.down("dataview");"detailed"==t.modeType&&(i=t.down("gridpanel")),t.orderType!=e.code&&I.changeOrderType(t,i,e)}},"panel[xtype=documentation.zipfileview] button[ref=oper] menuitem":{click:function(e){var t=e.up("panel[xtype=documentation.zipfileview]");if(t.orderType!=e.code){var i=t.up("window").down("treepanel[xtype=documentation.zipdirtree]");I.doZipFile(i,t,e.code)}}},"panel[xtype=documentation.zipfileview]":{afterrender:function(n){n.getEl().on("contextmenu",function(e,t,i){var a=n.menuTree;e.stopEvent(),a.showAt(e.getXY()),a.doConstrain()})}},"menu[xtype=documentation.ziptreemenu] menuitem":{click:function(e){var t=e.up("menu[xtype=documentation.ziptreemenu]").fileView,i=t.up("window").down("treepanel[xtype=documentation.zipdirtree]");I.doZipFile(i,t,e.code)}},"panel[xtype=documentation.filedataview] qqfield[name=quickquery]":{query:function(e){var t=e.up("panel[xtype=documentation.filedataview]"),i=I.getFileView(t).store;i.proxy.extraParams.quickSql=" AND (DOCUMENTATION_TEXT LIKE '%"+e.getValue()+"%' OR DOCUMENTATION_REMARK LIKE '%"+e.getValue()+"%')",i.loadPage(1)},reset:function(e){var t=e.up("panel[xtype=documentation.filedataview]"),i=I.getFileView(t).store;i.proxy.extraParams.quickSql="",i.loadPage(1)}}};I.control(e)},views:["JE.sys.documentation.view.WestView","JE.sys.documentation.view.MainView","JE.sys.documentation.view.CompanyMainView","JE.sys.documentation.view.CenterView","JE.sys.documentation.view.TreeMenu","JE.sys.documentation.view.FileMenuView","JE.sys.documentation.view.QueryFormView","JE.sys.documentation.view.FuncInfoTreeView","JE.sys.documentation.view.FileDataView","JE.sys.documentation.view.zip.ZipDirTree","JE.sys.documentation.view.zip.ZipFileView","JE.sys.documentation.view.zip.ZipTreeMenu","JE.sys.documentation.drag.DragSelector","JE.sys.documentation.drag.LabelEditor","JE.sys.documentation.view.FileProgressView","JE.sys.documentation.view.FolderTreeMenu","JE.sys.documentation.view.perm.DocPermForm","JE.sys.documentation.view.FasterView","JE.sys.documentation.view.FasterTreeMenu"]}),Ext.define("JE.sys.file.util.FileUtil",{doFile:function(i,a,e){var n=this,o=n.getFileView(a),r=(o.getStore().proxy.extraParams.tableCode,i.getStore(),o.getSelectionModel().getSelection());switch(e){case"oepnFile":0==r.length?JE.alert("请选中文件!"):1<r.length?JE.alert("只能打开一个文件!"):n.openFile(i,r[0],o.getStore());break;case"seeFile":if(0==r.length)JE.alert("请选中文件!");else if(1<r.length)JE.alert("只能浏览一个文件!");else{var t=new Array;o.getStore().each(function(e){t.push({id:e.get("JE_SYS_FILE_ID"),name:e.get("FILE_NAME"),path:e.get("FILE_ADDRESS")})}),JE.File.openFileByPath(r[0].get("FILE_ADDRESS"),r[0].get("FILE_NAME"),!0,t,null,"docfile",r[0].get("JE_SYS_FILE_ID"))}break;case"downloadFile":if(0==r.length)JE.alert("请选中文件!");else if(1<r.length)JE.alert("只能下载一个文件!");else{var l=JE.getUrlMaps("je.core.doc.document","download");window.open(l+"?ieFlag="+(Ext.isIE?"1":"0")+"&enCode=1&fileName="+encodeURIComponent(r[0].get("FILE_NAME"))+"&type=docfile&pkValue="+r[0].get("JE_SYS_FILE_ID")+"&path="+r[0].get("FILE_ADDRESS"))}break;case"packageDownload":0==r.length?JE.alert("请选中文件!"):JE.prompt("请输入压缩包名称...",function(e,t){if("cancel"!=e&&!Ext.isEmpty(t)){var i=new Array;Ext.each(r,function(e){i.push(e.get("JE_SYS_FILE_ID"))}),window.open(JE.getUrlMaps("je.core.doc.file","downloadPackage")+"?fileName="+t+"&ids="+i.join(","))}});break;case"copyFile":if(0==r.length)JE.alert("请选中文件!");else{var s=[],d=[];Ext.each(r,function(e){s.push({JE_SYS_FILE_ID:e.get("JE_SYS_FILE_ID")}),d.push("<font color=red>"+e.get("FILE_NAME")+"</font>")}),n.copyInfo={oper:"copy",datas:s},JE.msg("已成功放入剪切板!")}break;case"cutFile":if(0==r.length)JE.alert("请选中文件!");else{s=[],d=[];Ext.each(r,function(e){s.push({JE_SYS_FILE_ID:e.get("JE_SYS_FILE_ID")}),d.push("<font color=red>"+e.get("FILE_NAME")+"</font>")}),n.copyInfo={oper:"cut",datas:s},JE.msg("已成功放入剪切板!")}break;case"pasteFile":if(n.copyInfo){e=n.copyInfo.oper;var c=new Array;new Array;if(!(h=i.getSelectionModel().getSelection()[0]))return void JE.alert("请选中文件分类!");if("ROOT"==h.get("nodeType"))return void JE.alert("请选中文件分类!");Ext.each(n.copyInfo.datas,function(e){c.push(e.JE_SYS_FILE_ID)});var u=JE.ajax({url:JE.getUrlMaps("je.core.doc.file","paste"),params:{tableCode:"JE_SYS_FILE",FILE_DIC_ID:h.get("id"),FILE_DIC_NAME:h.get("text"),FILE_DIC_CODE:h.get("code"),oper:e,ids:c.join(",")}});if(u.success){var p=o.getStore();Ext.each(u.obj,function(e){var t=e.FILE_DIC_ID;i.getSelectionModel().getSelection()[0].get("id")==t&&(p.getById(e.JE_SYS_FILE_ID)||p.add(e))}),JE.msg("粘贴成功!")}else JE.alert(u.obj)}else JE.alert("剪切板为空!");break;case"rename":if(0==r.length)JE.alert("请选中文件!");else if(1<r.length)JE.alert("只能操作一个文件!");else{var f=r[0].get("FILE_NAME").substring(r[0].get("FILE_NAME").lastIndexOf(".")+1),E="0";JE.prompt("请输入新名称...",function(e,t){if("cancel"!=e&&!Ext.isEmpty(t)){var i="";if(-1!=t.lastIndexOf(".")&&(i=t.substring(t.lastIndexOf(".")+1)),Ext.isEmpty(f)&&!Ext.isEmpty(i))E="1";else if(f!=i)return void JE.alert("文件后缀名不允许修改!");if(!n.checkFileName(t,o.getStore().data.items))return JE.alert("您输入的名称不合法,请重新输入!"),!1;JE.ajax({url:JE.getUrlMaps("je.core.doc.file","doUpdate"),params:{tableCode:"JE_SYS_FILE",FILE_ADDRESS:r[0].get("FILE_ADDRESS"),syncFileType:E,JE_SYS_FILE_ID:r[0].get("JE_SYS_FILE_ID"),FILE_NAME:t}}).success?(r[0].set("FILE_NAME",t),r[0].commit(),JE.msg("重命名成功!")):JE.alert("重命名失败!")}},null,r[0].get("FILE_NAME"))}break;case"remove":if(0<r.length){c=new Array;Ext.each(r,function(e){c.push(e.get("JE_SYS_FILE_ID"))}),JE.confirm("确定删除吗?",function(e){"ok"==e&&(JE.ajax({url:JE.getUrlMaps("je.core.doc.file","doRemove"),params:{tableCode:"JE_SYS_FILE",ids:c.join(",")}}).success?(o.getStore().remove(r),JE.msg("删除成功!")):JE.alert("删除失败!"))})}else JE.alert("请选择文件!");break;case"selectAll":o.getSelectionModel().selectAll();break;case"refresh":o.getSelectionModel().deselectAll(),o.getStore().load(),n.copyInfo=null;break;case"attribute":if(0==r.length)return void JE.alert("请选中文件!");if(1<r.length)return void JE.alert("只能操作一个文件!");var m=r[0],g=Ext.clone(m.data);g.FILE_TYPENAME="文件",g.FILE_FILE=g.FILE_NAME+"*"+g.FILE_ADDRESS,JE.formWin({title:"文件信息",width:600,height:430,border:0,frame:!1,autoShow:!0,useButton:!a.readOnly,iconCls:g.FILE_ICONCLS,formConfig:{bodyPadding:"10 10 0 10",bodyStyle:{background:"#f1f1f1"}},defaults:{xtype:"textfield",columnWidth:.5,readOnly:!0,padding:"3 0 3 0"},items:[{name:"FILE_NAME",allowBlank:!1,fieldLabel:"文件名称"},{name:"FILE_DIC_NAME",fieldLabel:"文件分类",xtype:"treessfield",readOnly:!1,allowBlank:!1,configInfo:i.ddCode+",FILE_DIC_NAME~FILE_DIC_CODE~FILE_DIC_ID,text~code~id,S"},{xtype:"uxfilefield",name:"FILE_FILE",fieldLabel:"地址"},{name:"FILE_FILETYPENAME",fieldLabel:"文件类型"},{name:"SY_CREATEORGNAME",fieldLabel:"上传部门"},{name:"FILE_SIZE",fieldLabel:"文件大小",unitTpl:"(字节)"},{name:"SY_CREATEUSERNAME",fieldLabel:"上传人"},{name:"SY_CREATETIME",fieldLabel:"上传时间"},{xtype:"textarea",readOnly:!1,name:"FILE_REMARK",height:150,fieldLabel:"备注",columnWidth:1},{xtype:"hidden",name:"FILE_FOREIGN_ID",fieldLabel:"外键"},{xtype:"hidden",name:"JE_SYS_FILE_ID",fieldLabel:"主键"},{xtype:"hidden",name:"FILE_DIC_ID",fieldLabel:"分类主键"},{xtype:"hidden",name:"FILE_DIC_CODE",fieldLabel:"分类编码"}],showFn:function(e){e.down("form").form.setValues(g)},fn:function(e,t){e.tableCode="JE_SYS_FILE";var i=JE.ajax({url:JE.getUrlMaps("je.core.doc.file","doUpdate"),params:e});if(i.success){var a=i.obj;a.FILE_DIC_ID!=m.get("FILE_DIC_ID")?o.getStore().remove(m):(m.set("FILE_REMARK",a.FILE_REMARK),m.commit()),JE.msg("修改成功!")}else JE.alert("修改失败!")}});break;case"officeWord":if("ROOT"==(h=i.getSelectionModel().getSelection()[0]).get("nodeType"))return void JE.alert("请选中文件分类!");JE.prompt("请输入文件名称...",function(e,t){"cancel"==e||Ext.isEmpty(t)||n.doCreateFile(i,a,t,"doc")},null,"新建 Microsoft Office Word 文档.doc");break;case"officeExcel":if("ROOT"==(h=i.getSelectionModel().getSelection()[0]).get("nodeType"))return void JE.alert("请选中文件分类!");JE.prompt("请输入文件名称...",function(e,t){"cancel"==e||Ext.isEmpty(t)||n.doCreateFile(i,a,t,"xls")},null,"新建 Microsoft Office Excel 工作表.xls");break;case"officePowerPoint":if("ROOT"==(h=i.getSelectionModel().getSelection()[0]).get("nodeType"))return void JE.alert("请选中文件分类!");JE.prompt("请输入文件名称...",function(e,t){"cancel"==e||Ext.isEmpty(t)||n.doCreateFile(i,a,t,"ppt")},null,"新建 Microsoft Office PowerPoint 演示文稿.ppt");break;case"txt":var h;if("ROOT"==(h=i.getSelectionModel().getSelection()[0]).get("nodeType"))return void JE.alert("请选中文件分类!");JE.prompt("请输入文件名称...",function(e,t){"cancel"==e||Ext.isEmpty(t)||n.doCreateFile(i,a,t,"txt")},null,"新建文本文档.txt")}},queryFile:function(e,t,i,a){var n=e.form.getValues(),o=this.getFileView(a).getStore();a.modeType="QUERY";var r=a.down("button[ref=oper]"),l=r.down("menuitem[code=pasteFile]");a.down("button[ref=addFile]").setDisabled(!0),l.setDisabled(!0),r.show();var s=i.getDockedItems("toolbar[dock=top]")[0];this.updateToolbar(null,s,null,"QUERY");var d="",c=this.getOrderSql(a.orderType);Ext.isEmpty(n.JE_SYS_FILENAME)||(d+=" AND FILE_NAME like '%"+n.JE_SYS_FILENAME+"%'"),Ext.isEmpty(n.JE_SYS_DIRID)||(d+=" AND FILE_DIC_ID = '"+n.JE_SYS_DIRID+"'");var u=new Array;if(Ext.isEmpty(n.JE_SYS_FILETYPE)||Ext.each(n.JE_SYS_FILETYPE.split(","),function(e){switch(e){case"doc":u.push("doc"),u.push("docx");break;case"xls":u.push("xls"),u.push("xlsx");break;case"pdf":u.push("pdf");break;case"ppt":u.push("ppt"),u.push("pptx");break;case"zip":u.push("zip"),u.push("rar");break;case"jpg":u.push("jpg"),u.push("png"),u.push("gif"),u.push("ico"),u.push("bmp"),u.push("jpeg");break;case"mp4":u.push("avi"),u.push("mov"),u.push("wmv"),u.push("wmv"),u.push("mp4"),u.push("flv"),u.push("rmvb");break;case"mp3":u.push("mp3");break;case"png":u.push("dwf"),u.push("dwg")}}),Ext.isEmpty(n.JE_SYS_DIYTYPE)||Ext.each(n.JE_SYS_DIYTYPE.split(","),function(e){u.push(e)}),0<u.length&&(d+=" AND FILE_FILETYPE IN ('"+u.join("','")+"')"),Ext.isEmpty(n.JE_SYS_DIYSTARTSIZE))if(Ext.isEmpty(n.JE_SYS_DIYENDSIZE)){if("all"!=n.JE_SYS_FILESIZE)switch(n.JE_SYS_FILESIZE){case"1000000":d+=" AND FILE_SIZE>1000000000 ";break;case"100000":d+=" AND FILE_SIZE>100000000 ";break;case"1000":d+=" AND FILE_SIZE>1000000 ";break;case"-1000":d+=" AND FILE_SIZE<1000000 ";break;case"100":d+=" AND FILE_SIZE>100000 "}}else{d+=" AND DOCUMENTATION_SIZE<="+1e6*Ext.value(n.JE_SYS_DIYENDSIZE,0)}else d+=" AND DOCUMENTATION_SIZE>="+1e6*Ext.value(n.JE_SYS_DIYSTARTSIZE,0);if(Ext.isEmpty(n.JE_SYS_DIYDATE)){if("all"!=n.JE_SYS_MODFIYDATE){var p=new Date;switch(n.JE_SYS_MODFIYDATE){case"week":var f=new Date,E=p.getDay();f.setDate(f.getDate()-E+1),p.setDate(p.getDate()+(7-E)),d+=" AND SY_MODIFYTIME>='"+Ext.Date.format(f,"Y-m-d")+" 00:00:00' AND SY_MODIFYTIME<='"+Ext.Date.format(p,"Y-m-d")+" 23:59:59'";break;case"month":var m=Ext.Date.format(p,"Y-m");d+=" AND SY_MODIFYTIME>='"+m+"-01 00:00:00' AND SY_MODIFYTIME<='"+m+"-31 23:59:59'";break;case"year":d+=" AND SY_MODIFYTIME>='"+(g=Ext.Date.format(p,"Y"))+"-01-01 00:00:00' AND SY_MODIFYTIME<='"+g+"-12-31 23:59:59'";break;case"beforeyear":var g;p.setYear(p.getYear()+1900-1),d+=" AND SY_MODIFYTIME>='"+(g=Ext.Date.format(p,"Y"))+"-01-01 00:00:00' AND SY_MODIFYTIME<='"+g+"-12-31 23:59:59'"}}}else d+=" AND SY_MODIFYTIME>='"+n.JE_SYS_DIYDATE+" 00:00:00' AND SY_MODIFYTIME<='"+n.JE_SYS_DIYDATE+" 23:59:59'";o.proxy.extraParams.querySql=d,o.proxy.extraParams.orderSql=c,o.proxy.extraParams.nodeSql="",o.loadPage(1)},doCreateFile:function(e,t,i,a){var n=t.up("panel[xtype=file.mainview]"),o=e.getSelectionModel().getSelection()[0];if(o){var r=this.getFileView(t),l=r.getStore(),s={tableCode:"JE_SYS_FILE",FILE_DIC_ID:o.get("id"),FILE_DIC_NAME:o.get("text"),FILE_DIC_CODE:o.get("code"),fileName:i,fileType:a,uploadPath:t.uploadPath,FILE_FOREIGN_ID:n.FILE_FOREIGN_ID},d=JE.ajax({url:JE.getUrlMaps("je.core.doc.file","newFile"),params:s});if(d.success){var c=l.add(d.obj)[0];r.getSelectionModel().select(c),this.openFile(e,c,l)}else JE.alert(d.obj)}else JE.alert("请选中目录!")},openFile:function(e,t,i){var a=new Array;i.each(function(e){a.push({id:e.get("JE_SYS_FILE_ID"),name:e.get("FILE_NAME"),path:e.get("FILE_ADDRESS")})}),JE.File.openFileByPath(t.get("FILE_ADDRESS"),t.get("FILE_NAME"),!1,a,null,"docfile",t.get("JE_SYS_FILE_ID"))},changeOrderType:function(e,t,i){if(e.orderType!=i.code){i.up("button[ref=order]").down("menuitem[code="+e.orderType+"]").setIconCls(""),i.setIconCls("jeicon jeicon-check"),e.orderType=i.code;var a=t.getStore(),n=(a.getProxy().extraParams.orderSql,this.getOrderSql(i.code));a.getProxy().extraParams.orderSql=n,a.load()}},changeViewType:function(e,t,i,a){t.up("button[ref=view]").down("menuitem[code="+e.viewType+"]").setIconCls(""),t.setIconCls("jeicon jeicon-check"),e.viewType=t.code;var n=i.id;"thumbnail"==t.code?(i.show(),a.hide(),i.tpl=new Ext.XTemplate(['<div id = "'+n+'_JEMaskView" style="display: none; position: fixed; right: 0px; bottom: 0px; opacity: 0.6; z-index: 9998; background: rgb(0, 0, 0);"><div id = "'+n+'_JEMaskViewText" style="font-family: Helvetica, Helvetica Neue, Century Gothic, 微软雅黑, Microsoft Yahei, STXihei;position: absolute; z-index: 9999; width: auto; height: auto;"><div style="font-size:50px;color:#fff;opacity:0.6;">松开即可上传!</div></div></div></div></div> <tpl for=".">','<div class=table-files style="border: 1px solid #fff;table-layout:fixed;word-wrap:break-word;float:left;margin:9px;width:104px;height:133px;">','<div style="text-align:center;width:96px;height:96px;"><table width=100% height=100%><tr><td align=center valign = middle>{[this.formatFile(values)]}</td></tr></table></div>','<div class="x-editable" style="height:36px;padding-top:4px;text-align:center;overflow:hidden;text-overflow:ellipsis;" title="{FILE_NAME}">{[values.FILE_NAME.ellipsis(14)]}</div>',"</div>","</tpl>",{formatFile:function(e){return JE.getFileThumbnail(e,{width:"96",height:"96",styleConfig:"FILE_THUMBNAILCLS",imgUrl:"FILE_PRIVATEKEY",imgCdnUrl:"FILE_ADDRESS",imgName:"FILE_NAME",icon:"FILE_ICONCLS",imgType:"docfile",tableCode:"JE_SYS_FILE"})}}]),i.getStore().load()):"icon"==t.code?(i.show(),a.hide(),i.tpl=new Ext.XTemplate(['<div id = "'+n+'_JEMaskView" style="display: none; position: fixed; right: 0px; bottom: 0px; opacity: 0.6; z-index: 9998; background: rgb(0, 0, 0);"><div id = "'+n+'_JEMaskViewText" style="font-family: Helvetica, Helvetica Neue, Century Gothic, 微软雅黑, Microsoft Yahei, STXihei;position: absolute; z-index: 9999; width: auto; height: auto;"><div style="font-size:50px;color:#fff;opacity:0.6;">松开即可上传!</div></div></div></div></div> <tpl for=".">','<div class=table-files style="border: 1px solid #fff;table-layout:fixed;word-wrap:break-word;float:left;margin:10px;width:58px;height:84px;">','<div style="text-align:center;width:48px;height:48px;"><table width=100% height=100%><tr><td align=center valign = middle>{[this.formatFile(values)]}</td></tr></table></div>','<div class="x-editable" style="height:35px;padding-top:4px;text-align:center;overflow:hidden;text-overflow:ellipsis;" title="{FILE_NAME}">{[values.FILE_NAME.ellipsis(7)]}</div>',"</div>","</tpl>",{formatFile:function(e){var t=JE.getFileIcon(e.FILE_NAME).color;return imgHtml='<i style="'+("font-size:35px; color:"+t)+'" class ="'+e.FILE_ICONCLS+'"></i>',imgHtml}}]),i.getStore().load()):"detailed"==t.code&&(i.hide(),a.show(),a.getStore().load())},updateToolbar:function(e,t,i,a){t.removeAll();var n=new Array;if(n.push({xtype:"button",tooltip:"向上",iconCls:"jeicon jeicon-calendar-back-o",modeType:a,ref:"upDirBtn"}),n.push("-"),"QUERY"==a)return n.push({xtype:"button",ref:"dirBtn",text:"文件检索",iconCls:"jeicon jeicon-search",modeType:a}),void t.add(n);if(i){var o=i.getPath(),r=e.getStore();Ext.each(o.split("/"),function(e){if(!Ext.isEmpty(e)){var t=r.getNodeById(e);t&&!t.isRoot()&&n.push({xtype:"button",ref:"dirBtn",text:t.get("text"),iconCls:t.get("iconCls"),nodeId:e,modeType:a})}}),t.add(n)}else t.add(n)},getFileView:function(e){return"detailed"==e.viewType?e.down("gridpanel"):e.down("dataview")},getOrderSql:function(e){var t="";return"name"==e?t=" ORDER BY FILE_NAME ASC":"size"==e?t=" ORDER BY FILE_SIZE ASC":"type"==e?t=" ORDER BY FILE_FILETYPE ASC":"uploadTime"==e&&(t=" ORDER BY SY_MODIFYTIME ASC"),t},checkFileName:function(e,t){return!/[\/\\"<>\?\*]/gi.test(e)},fileProgress:{addFile:function(e){var i=new Array;Ext.each(e,function(e){var t={id:e.id,name:e.name,size:e.size,progress:0,status:"等待上传"};i.push(t)});var t=Ext.getCmp("jefileprogressview_file");t||((t=JE.win({title:"文件上传",border:0,closeAction:"hide",id:"jefileprogressview_file",width:748,height:400,items:[{xtype:"file.fileprogressview"}]})).grid=t.down("panel[xtype=file.fileprogressview]")),t.show(),t.grid.getStore().loadData(i)},updateFile:function(e,t,i){var a=Ext.getCmp("jefileprogressview_file").grid.getStore().findRecord("id",e.id);a&&(a.set("progress",t),a.set("status",i),a.commit())},reset:function(){var e=Ext.getCmp("jefileprogressview");e.grid.getStore().removeAll(),e.hide()}}}),Ext.define("JE.sys.file.view.CenterView",{extend:"Ext.panel.Panel",border:1,alias:"widget.file.centerview",bodyPadding:"1 0 0 0",layout:"fit",initComponent:function(){this.tbar=[],this.items={xtype:"file.filedataview",uploadPath:this.uploadPath},this.callParent()}}),Ext.define("JE.sys.file.view.FileDataView",{extend:"Ext.panel.Panel",alias:"widget.file.filedataview",layout:"fit",viewType:"thumbnail",orderType:"name",modeType:"FILE",border:0,readOnly:!1,initComponent:function(){var e=this,t=JE.getStore({tableName:"JE_SYS_FILE",pageSize:100,action:JE.getUrlMaps("je.core.doc.file"),id:"JE_SYS_FILE_ID",params:{orderSql:" ORDER BY FILE_NAME ASC",baseSql:" AND 1!=1",nodeSql:"",querySql:""},autoLoad:!1}),i=Ext.id(),a=Ext.id();e.items=[{xtype:"dataview",autoScroll:!0,id:i,tpl:['<div id = "'+i+'_JEMaskView" style="display: none; position: fixed; right: 0px; bottom: 0px; opacity: 0.6; z-index: 9998; background: rgb(0, 0, 0);"><div id = "'+i+'_JEMaskViewText" style="font-family: Helvetica, Helvetica Neue, Century Gothic, 微软雅黑, Microsoft Yahei, STXihei;position: absolute; z-index: 9999; width: auto; height: auto;"><div style="font-size:50px;color:#fff;opacity:0.6;">松开即可上传!</div></div></div></div></div> <tpl for=".">','<DIV class=table-files style="border: 1px solid #fff;table-layout:fixed;word-wrap:break-word;float:left;margin:9px;width:104px;height:133px;">','<div style="text-align:center;width:96px;height:96px;"><table width=100% height=100%><tr><td align=center valign = middle>{[this.formatFile(values)]}</td></tr></table></div>','<div class="x-editable" style="height:36px;padding-top:4px;text-align:center;overflow:hidden;text-overflow:ellipsis;" title="{FILE_NAME}">{[values.FILE_NAME.ellipsis(14)]}</div>',"</div>","</tpl>",{formatFile:function(e){return JE.getFileThumbnail(e,{width:"96",height:"96",styleConfig:"FILE_THUMBNAILCLS",imgUrl:"FILE_PRIVATEKEY",imgCdnUrl:"FILE_ADDRESS",imgName:"FILE_NAME",icon:"FILE_ICONCLS",imgType:"docfile",tableCode:"JE_SYS_FILE"})}}],plugins:[Ext.create("JE.sys.documentation.drag.DragSelector",{})],multiSelect:!0,overItemCls:"x-dataview-item-over",trackOver:!0,selectedItemCls:"x-dataview-item-selected",itemSelector:"div.table-files",emptyText:"",store:t,menuTree:Ext.create("JE.sys.file.view.TreeMenu",{menuType:"item",modeType:"FILE",fileDataView:e}),queryMenu:Ext.create("JE.sys.file.view.TreeMenu",{menuType:"item",modeType:"QUERY",fileDataView:e})},{xtype:"gridpanel",hidden:!0,cls:"jegrid",border:0,multiSelect:!0,autoScroll:!0,columnLines:!0,animCollapse:!1,viewConfig:{id:a,tpl:'<div id = "'+a+'_JEMaskView" style="display: none; position: fixed; right: 0px; bottom: 0px; opacity: 0.6; z-index: 9998; background: rgb(0, 0, 0);"><div id = "'+a+'_JEMaskViewText" style="font-family: Helvetica, Helvetica Neue, Century Gothic, 微软雅黑, Microsoft Yahei, STXihei;position: absolute; z-index: 9999; width: auto; height: auto;"><div style="font-size:50px;color:#fff;opacity:0.6;">松开即可上传!</div></div></div></div></div>{%values.view.tableTpl.applyOut(values, out)%}'},columns:[{text:"名称",dataIndex:"FILE_NAME",width:200,renderer:function(e,t,i,a,n,o,r,l,s){return"<input type='button' class='"+i.get("FILE_ICONCLS")+" je-button-icon'/>"+e}},{text:"文件分类",dataIndex:"FILE_DIC_NAME",width:100},{text:"上传时间",dataIndex:"SY_CREATETIME",width:140},{text:"类型",dataIndex:"FILE_FILETYPENAME",width:100},{text:"大小",dataIndex:"FILE_SIZE",width:100,renderer:function(e,t,i,a,n,o,r,l,s){var d=1*Ext.value(e,0);return Math.ceil(d/1e3)+" KB"}},{text:"备注",dataIndex:"FILE_REMARK",width:300}],store:t,menuTree:Ext.create("JE.sys.file.view.TreeMenu",{menuType:"item",modeType:"FILE",fileDataView:e,readOnly:!1}),queryMenu:Ext.create("JE.sys.file.view.TreeMenu",{menuType:"item",modeType:"QUERY",fileDataView:e,readOnly:!1}),menuReadOnlyTree:Ext.create("JE.sys.file.view.TreeMenu",{menuType:"item",modeType:"FILE",fileDataView:e,readOnly:!0}),queryReadOnlyMenu:Ext.create("JE.sys.file.view.TreeMenu",{menuType:"item",modeType:"QUERY",fileDataView:e,readOnly:!0})}],e.menuTree=Ext.create("JE.sys.file.view.TreeMenu",{menuType:"panel",modeType:"FILE",fileDataView:e,readOnly:!1}),e.queryMenu=Ext.create("JE.sys.file.view.TreeMenu",{menuType:"panel",modeType:"QUERY",fileDataView:e,readOnly:!1}),e.menuReadOnlyTree=Ext.create("JE.sys.file.view.TreeMenu",{menuType:"panel",modeType:"FILE",fileDataView:e,readOnly:!0}),e.queryReadOnlyMenu=Ext.create("JE.sys.file.view.TreeMenu",{menuType:"panel",modeType:"QUERY",fileDataView:e,readOnly:!0}),e.tbar=[{xtype:"button",text:"上传",ref:"addFile",iconCls:"jeicon jeicon-function-configuration"},{ref:"view",text:"视图",iconCls:"jeicon jeicon-view",menu:[{text:"缩略图",iconCls:"jeicon jeicon-check",code:"thumbnail"},{text:"图标",code:"icon"},{text:"详细信息",code:"detailed"}]},{ref:"order",text:"排序",iconCls:"jeicon jeicon-sorting",menu:[{text:"名称",iconCls:"jeicon jeicon-check",code:"name"},{text:"大小",code:"size"},{text:"类型",code:"type"},{text:"修改时间",code:"uploadTime"}]},{ref:"oper",text:"操作",iconCls:"jeicon jeicon-system-management",menu:[{text:"打开",code:"openFile",iconCls:"jeicon jeicon-check"},{text:"浏览",code:"seeFile",iconCls:"jeicon jeicon-search"},{text:"下载文件",code:"downloadFile",iconCls:"jeicon jeicon-download-recently"},{text:"打包下载",code:"packageDownload",iconCls:"jeicon jeicon-compress-static"},"-",{text:"复制",code:"copyFile",iconCls:"jeicon jeicon-chart-copy"},{text:"剪切",code:"cutFile",iconCls:"jeicon jeicon-scissors"},{text:"粘贴",code:"pasteFile",iconCls:"jeicon jeicon-paste"},"-",{text:"重命名",code:"rename",iconCls:"jeicon jeicon-rename-o"},{text:"删除",code:"remove",iconCls:"jeicon jeicon-error"},"-",{text:"属性",code:"attribute",iconCls:"jeicon jeicon-set-up"}]}],e.tbar.push("->"),e.tbar.push({xtype:"qqfield",labelStyle:"cursor: pointer;color:blue;text-decoration: underline;font-family: arial;",labelWidth:32,name:"quickquery",labelSeparator:"",queryFields:[{name:"FILE_NAME"}]}),e.dockedItems=[{xtype:"pagingtoolbar",store:t,dock:"bottom",displayInfo:!0}],this.callParent()}}),Ext.define("JE.sys.file.view.FileDicView",{extend:"JE.core.view.TreeView",border:0,alias:"widget.file.filedicview",useArrows:!0,rootVisible:!1,animate:!0,autoScroll:!1,onlyItem:!1,initComponent:function(){var e=this.ddCode;this.queryItems=[{configInfo:e,title:"文件分类",field:"",whereSql:""}],this.onlyItem=!1,this.searchBar=!1,this.type="query",this.callParent()}}),Ext.define("JE.sys.file.view.FileProgressView",{extend:"Ext.grid.Panel",border:1,alias:"widget.file.fileprogressview",columnLines:!0,multiSelect:!0,enableKeyNav:!0,columns:[{text:"主键",hidden:!0,dataIndex:"id"},{text:"名称",dataIndex:"name",width:250},{text:"大小",dataIndex:"size",width:92,renderer:function(e){return Ext.util.Format.fileSize(e)}},{text:"状态",dataIndex:"status",width:100},{text:"进度",dataIndex:"progress",width:272,tactics:[{type:"bar",configInfo:",1-99~orange,100-100~green"}],align:"left",renderer:JE.renderer}],initComponent:function(){this.store=Ext.create("Ext.data.Store",{fields:[{name:"id",type:"string"},{name:"name",type:"string"},{name:"size",type:"float"},{name:"status",type:"string"},{name:"progress",type:"int"}]}),this.callParent()}}),Ext.define("JE.sys.file.view.MainView",{extend:"Ext.panel.Panel",alias:"widget.file.mainview",border:0,layout:"border",ddCode:"JE_SYSTEM",uploadPath:"",FILE_FOREIGN_ID:"",readOnly:!1,initComponent:function(){this.ddCode=Ext.value(this.ddCode,"JE_SYSTEM"),this.items=[{xtype:"file.westview",region:"west",ddCode:this.ddCode,padding:"0 4 0 0",width:200},{region:"center",xtype:"file.centerview",uploadPath:this.uploadPath}],this.callParent()},setReadOnly:function(e){this.readOnly=e;var t=this.down("panel[xtype=file.filedataview]");if(t){var i=t.down("button[ref=oper]");i.down("menuitem[code=copyFile]").setDisabled(e),i.down("menuitem[code=cutFile]").setDisabled(e),i.down("menuitem[code=pasteFile]").setDisabled(e),i.down("menuitem[code=rename]").setDisabled(e),i.down("menuitem[code=remove]").setDisabled(e),t.down("button[ref=addFile]").setDisabled(e),t.readOnly=e}},load:function(e){this.FILE_FOREIGN_ID=e.mainID;var t=this.down("panel[xtype=file.filedataview]"),i=("detailed"==t.viewType?t.down("gridpanel"):t.down("dataview")).getStore();i.proxy.extraParams.baseSql=" AND FILE_FOREIGN_ID='"+e.mainID+"'",i.loadPage(1)}}),Ext.define("JE.sys.file.view.QueryFormView",{extend:"Ext.form.Panel",alias:"widget.file.queryformview",layout:"column",border:0,autoScroll:!0,defaults:{xtype:"fieldset",labelAlign:"right",margin:"5 0 0 0 ",layout:"column",collapsible:!1,columnWidth:1,defaults:{xtype:"textfield",labelAlign:"right",margin:"5 0 8 0",labelWidth:40,columnWidth:1}},initComponent:function(){var e=this.ddCode;this.items=[{title:"文件",style:"background: aliceblue;",margin:"4",minHeight:84,minWidth:183,items:[{labelWidth:60,fieldLabel:"文件名称",name:"JE_SYS_FILENAME"},{labelWidth:60,xtype:"treessfield",fieldLabel:"文件分类",name:"JE_SYS_PATH",configInfo:e+",JE_SYS_PATH~JE_SYS_DIRID,text~id"},{labelWidth:60,xtype:"hidden",fieldLabel:"文件分类ID",name:"JE_SYS_DIRID"}]},{title:"格式",margin:"4",style:"background: aliceblue;",minHeight:186,minWidth:183,items:[{xtype:"cgroup",columns:2,configInfo:"JE_DOCUMENTATION_FILETYPE",name:"JE_SYS_FILETYPE"},{fieldLabel:"指定",name:"JE_SYS_DIYTYPE"}]},{title:"大小",margin:"4",style:"background: aliceblue;",minHeight:136,minWidth:183,items:[{xtype:"rgroup",columns:2,configInfo:"JE_DOCUMENTATION_FILESIZE",name:"JE_SYS_FILESIZE",value:"all"},{xtype:"numberfield",fieldLabel:"指定",hideTrigger:!0,name:"JE_SYS_DIYSTARTSIZE",columnWidth:.45},{xtype:"box",cellCls:"tableform-title",colspan:2,margin:"10 0 0 5",html:"M",columnWidth:.05},{labelWidth:25,xtype:"numberfield",fieldLabel:"到",hideTrigger:!0,labelSeparator:"",name:"JE_SYS_DIYENDSIZE",columnWidth:.42},{xtype:"box",cellCls:"tableform-title",colspan:2,margin:"10 0 0 5",html:"M",columnWidth:.05}]},{title:"最后修改时间",margin:"4",style:"background: aliceblue;",minHeight:126,minWidth:183,items:[{xtype:"rgroup",columns:2,configInfo:"JE_DOCUMENTATION_MODFIYTIME",name:"JE_SYS_MODFIYDATE",value:"all"},{xtype:"datetimefield",dateType:"date",fieldLabel:"指定",format:"Y年m月d日",name:"JE_SYS_DIYDATE"}]}],this.buttons=[{text:"查询",ref:"okQuery",iconCls:"jeicon jeicon-check"},{text:"重置",ref:"resetQuery",iconCls:"jeicon jeicon-error"}],this.buttonAlign="center",this.callParent()}}),Ext.define("JE.sys.file.view.TreeMenu",{extend:"Ext.menu.Menu",alias:"widget.file.treemenu",defaultAlign:"br-tr",frame:!1,border:1,initComponent:function(){var e=[{text:"打开",code:"oepnFile",iconCls:"jeicon jeicon-check"},{text:"浏览",code:"seeFile",iconCls:"jeicon jeicon-search"},{text:"下载文件",code:"downloadFile",iconCls:"jeicon jeicon-download-recently"},{text:"打包下载",code:"packageDownload",iconCls:"jeicon jeicon-compress-static"},"-",{text:"复制",code:"copyFile",iconCls:"jeicon jeicon-chart-copy"},{text:"剪切",code:"cutFile",iconCls:"jeicon jeicon-scissors"},"-",{text:"重命名",code:"rename",iconCls:"jeicon jeicon-rename-o"},{text:"删除",code:"remove",iconCls:"jeicon jeicon-error"},"-",{text:"属性",code:"attribute",iconCls:"jeicon jeicon-set-up"}],t=[{text:"全选",code:"selectAll",iconCls:"jeicon jeicon-check-circle"},{text:"刷新",code:"refresh",iconCls:"jeicon jeicon-refresh"},{text:"粘贴",code:"pasteFile",iconCls:"jeicon jeicon-paste"},{text:"新建",code:"newFile",iconCls:"jeicon jeicon-resource-table-addition",menu:[{text:"Microsoft Office Word 文档",code:"officeWord",iconCls:"jeicon jeicon-word"},{text:"Microsoft Office Excel 工作表",code:"officeExcel",iconCls:"jeicon jeicon-excel"},{text:"Microsoft Office PowerPoint 演示文稿",code:"officePowerPoint",iconCls:"jeicon jeicon-ppt"},{text:"文本文档",code:"txt",iconCls:"jeicon jeicon-txt"}]}],i=[];switch(this.modeType){case"FILE":i=this.readOnly?["openFile","copyFile","cutFile","pasteFile","rename","remove","newFile"]:[];break;case"QUERY":i=this.readOnly?["openFile","copyFile","cutFile","pasteFile","rename","remove","newFile"]:["newFile","pasteFile"]}if("item"==this.menuType){Ext.each(e,function(e){Ext.isEmpty(e.code)||-1!=i.indexOf(e.code)&&(e.hidden=!0)}),this.items=e}else Ext.each(t,function(e){Ext.isEmpty(e.code)||-1!=i.indexOf(e.code)&&(e.hidden=!0)}),this.items=t;this.callParent()}}),Ext.define("JE.sys.file.view.WestView",{extend:"Ext.panel.Panel",alias:"widget.file.westview",layout:"accordion",layoutConfig:{titleCollapse:!1,animate:!1,activeOnTop:!0},border:1,initComponent:function(){this.items=[{title:"文件分类",itemId:"filedicview",iconCls:"jeicon jeicon-folders",ddCode:this.ddCode,xtype:"file.filedicview",listeners:{expand:function(e,t){var i=e.getSelectionModel(),a=i.getSelection();e.fireEvent("selectionchange",i,a)}}},{title:"高级检索",iconCls:"jeicon jeicon-search",itemId:"queryformview",xtype:"file.queryformview",ddCode:this.ddCode,listeners:{expand:function(e,t){var i=e.down("button[ref=okQuery]");i.fireEvent("click",i)}}}],this.callParent()}}),Ext.define("JE.sys.file.controller.FileController",{extend:"Ext.app.Controller",mixins:{docUtil:"JE.sys.file.util.FileUtil"},init:function(){var m=this;m.copyInfo=null;var e={"treepanel[xtype=file.filedicview]":{selectionchange:function(e,t,i){var a=e.view.panel,n=t[0],o=a.up("panel[xtype=file.mainview]"),r=o.down("panel[xtype=file.centerview]"),l=o.down("panel[xtype=file.filedataview]"),s=m.getFileView(l).getStore(),d=l.down("button[ref=oper]"),c=l.down("button[ref=addFile]"),u=d.down("menuitem[code=pasteFile]");u.setDisabled(!1),c.setDisabled(!1),o.readOnly&&(u.setDisabled(o.readOnly),c.setDisabled(o.readOnly));var p="",f=m.getOrderSql(l.orderType);l.modeType="FILE",n&&(p="ROOT"==n.get("nodeType")?"":" AND FILE_DIC_ID='"+n.get("id")+"'"),s.proxy.extraParams.nodeSql=p,s.proxy.extraParams.querySql="",s.proxy.extraParams.orderSql=f,s.loadPage(1);var E=r.getDockedItems("toolbar[dock=top]")[0];m.updateToolbar(a,E,n,"FILE")},afterrender:function(e){var t=e.getRootNode();if(t&&(t.cascadeBy(function(e){e.set("iconCls","jeicon jeicon-folder"),e.commit()}),t.hasChildNodes())){var i=t.getChildAt(0);i.set("iconCls","jeicon jeicon-folder"),i.set("text","文件分类"),i.commit(),e.getSelectionModel().select(i)}}},"panel[xtype=file.filedataview] dataview":{itemdblclick:function(e,t,i,a,n,o){var r=e.up("panel[xtype=file.mainview]").down("treepanel[xtype=file.filedicview]"),l=e.up("panel[xtype=file.filedataview]"),s=(l.modeType,(e=m.getFileView(l)).getStore());m.openFile(r,t,s)},beforeitemcontextmenu:function(e,t,i,a,n,o){var r=e.getSelectionModel().getSelection();if(0<r.length){var l=!1;Ext.each(r,function(e){t.get("JE_SYS_DOCUMENTATION_ID")==e.get("JE_SYS_DOCUMENTATION_ID")&&(l=!0)}),l?e.getSelectionModel().select(r):e.getSelectionModel().select(t)}else e.getSelectionModel().select(t)},itemcontextmenu:function(e,t,i,a,n,o){var r=e.up("panel[xtype=file.filedataview]"),l=r.modeType;"detailed"==r.viewType&&(e=e.panel);var s=e.menuTree;r.readOnly&&(s=e.menuReadOnlyTree),"QUERY"==l&&(s=e.queryMenu,r.readOnly&&(s=e.queryReadOnlyMenu)),n.stopEvent(),s.showAt(n.getXY()),s.doConstrain()},afterrender:function(r){var n=r.id;JE.loadScript("/static/ux/webuploader/js/webuploader.js");var e={tableCode:"JE_SYS_FILE"};if("1"==JE.systemConfig.JE_SYS_ENCRYPT){var t=JE.DES(e);e[t.code]=t.value}var i=WebUploader.create({formData:e,fileVal:"FILE_ADDRESS",dnd:"#"+n,chunked:!1,swf:JE.getStaticUrl("JE.common.file.Uploader","swf"),server:JE.getUrlMaps("je.core.doc.file","uploadFile"),disableGlobalDnd:!0,prepareNextFile:!0,fileNumLimit:1e3,fileSingleSizeLimit:1048576e3,dndDragEnter:function(e){if("FILE"==r.up("panel[xtype=file.filedataview]").modeType){var t=r.getEl(),i=Ext.get(n+"_JEMaskView"),a=Ext.get(n+"_JEMaskViewText");"none"==i.getStyle("display")&&(i.setStyle("left",t.getX()+"px"),i.setStyle("top",t.getY()+"px"),a.setStyle("top",(t.getHeight()-50)/2+"px"),a.setStyle("left",(t.getWidth()-300)/2+"px"),i.setStyle("display","block"))}},dndDragOver:function(e){},dndDragLeave:function(e){if("FILE"==r.up("panel[xtype=file.filedataview]").modeType){var t=Ext.get(n+"_JEMaskView");"block"==t.getStyle("display")&&t.setStyle("display","none")}},dndDrop:function(e){if("FILE"==r.up("panel[xtype=file.filedataview]").modeType){var t=Ext.get(n+"_JEMaskView");"block"==t.getStyle("display")&&t.setStyle("display","none")}}});i.on("beforeFileQueued",function(e){var t=r.up("panel[xtype=file.filedataview]");if("FILE"!=t.modeType)return!1;r.getStore();var i=t.up("panel[xtype=file.mainview]"),a=i.down("treepanel[xtype=file.filedicview]").getSelectionModel().getSelection()[0];return a?"ROOT"==a.get("nodeType")?(JE.alert("请选中文件分类!"),!1):i.readOnly?(JE.alert("功能已只读,无法上传!"),!1):JE.isEmpty(i.FILE_FOREIGN_ID)?(JE.alert("请选择一条主功能数据，再进行添加...!"),!1):void 0:(JE.alert("请选中文件分类!"),!1)}),i.on("fileQueued",function(e){e&&(m.fileProgress.addFile([e]),i.upload())}),i.on("filesQueued",function(e){e.length<=0||(m.fileProgress.addFile(e),i.upload())}),i.on("uploadBeforeSend",function(e,t,i){i["Platform-Agent"]="AppleWebKit/537.36 (KHTML, like Gecko)",i.authorization=Ext.util.Cookies.get("authorization");var a=r.up("panel[xtype=file.filedataview]");if("FILE"!=a.modeType)return!1;r.getStore();var n=a.up("panel[xtype=file.mainview]"),o=n.down("treepanel[xtype=file.filedicview]").getSelectionModel().getSelection()[0];t.FILE_DIC_CODE=o.get("code"),t.FILE_DIC_NAME=o.get("text"),t.FILE_DIC_ID=o.get("id"),t.uploadPath=a.uploadPath,t.FILE_FOREIGN_ID=n.FILE_FOREIGN_ID,t.docType="docfile",t.beanTableCode="JE_SYS_FILE"}),i.on("uploadSuccess",function(e,t){m.fileProgress.updateFile(e,100,"上传成功"),1==t.success?r.getStore().add(t.obj):JE.error(t.obj,t)}),i.on("uploadProgress",function(e,t){var i=Math.floor(100*t);100==i&&(i=99),m.fileProgress.updateFile(e,i,"正在上传")}),i.on("uploadError",function(e,t){m.fileProgress.updateFile(e,0,"上传出错"),JE.error("文件"+e.name+"上传出错!")}),i.on("uploadComplete",function(e){i.removeFile(e)}),i.on("error",function(e){i.reset(),"F_EXCEED_SIZE"==e?JE.error("上传出错，文件大小超过1G。"):"Q_EXCEED_NUM_LIMIT"==e?JE.error("上传出错，一次性只能上传1000个文件。"):"F_DUPLICATE"==e?JE.error("文件重复。"):JE.error("上传出错，错误编码:"+e+",请联系管理员!")})}},"panel[xtype=file.filedataview]":{afterrender:function(n){n.getEl().on("contextmenu",function(e,t,i){var a=n.menuTree;n.readOnly&&(a=n.menuReadOnlyTree),"QUERY"==n.modeType&&(a=n.queryMenu,n.readOnly&&(a=n.queryMenu)),e.stopEvent(),a.showAt(e.getXY()),a.doConstrain()})}},"panel[xtype=file.centerview] button[ref=dirBtn]":{click:function(e){var t=e.up("panel[xtype=file.mainview]");if("QUERY"!=e.modeType){var i=t.down("treepanel[xtype=file.filedicview]"),a=i.getStore().getNodeById(e.nodeId);a?i.getSelectionModel().select(a):JE.alert("未找到目录!")}else{var n=t.down("panel[xtype=file.queryformview]").down("button[ref=okQuery]");n.fireEvent("click",n)}}},"panel[xtype=file.centerview] button[ref=upDirBtn]":{click:function(e){var t=e.up("panel[xtype=file.mainview]");if("QUERY"!=e.modeType){var i=t.down("treepanel[xtype=file.filedicview]").getSelectionModel(),a=i.getSelection()[0];a?a.parentNode.isRoot()?JE.alert("已经到了顶层目录!"):i.select(a.parentNode):JE.alert("无选中信息!")}else JE.alert("已经到了顶层目录!")}},"panel[xtype=file.filedataview] button[ref=addFile]":{click:function(e){var t=e.up("panel[xtype=file.filedataview]"),n=m.getFileView(t).getStore(),i=t.up("panel[xtype=file.mainview]"),a=i.down("treepanel[xtype=file.filedicview]").getSelectionModel().getSelection()[0];if(a)if("ROOT"!=a.get("nodeType"))if(JE.isEmpty(i.FILE_FOREIGN_ID))JE.alert("请选择一条主功能数据，再进行添加...!");else{var o={tableCode:"JE_SYS_FILE",FILE_DIC_ID:a.get("id"),FILE_DIC_NAME:a.get("text"),FILE_DIC_CODE:a.get("code"),uploadPath:t.uploadPath,FILE_FOREIGN_ID:i.FILE_FOREIGN_ID,currentUserId:JE.currentUser.userId,docType:"docfile",beanTableCode:"JE_SYS_FILE"};JE.win({title:"附件上传",width:800,height:600,items:{xtype:"uploadpanel",upload_url:JE.getUrlMaps("je.core.doc.file","uploadFile")+"?login=TRUE",file_post_name:"FILE_ADDRESS",post_params:o,failure:function(e,t,i){JE.error(t+"\n"+i)},success:function(e,t,i){var a=Ext.decode(Ext.value(t,"{}"));1==a.success?n.add(a.obj):JE.error(t,t)}}}).show()}else JE.alert("请选中分类!");else JE.alert("请选中分类!")}},"panel[xtype=file.filedataview] button[ref=view] menuitem":{click:function(e){var t=e.up("panel[xtype=file.filedataview]"),i=t.down("dataview"),a=t.down("gridpanel");t.viewType!=e.code&&m.changeViewType(t,e,i,a,!1)}},"panel[xtype=file.filedataview] button[ref=order] menuitem":{click:function(e){var t=e.up("panel[xtype=file.filedataview]"),i=m.getFileView(t);t.orderType!=e.code&&m.changeOrderType(t,i,e)}},"panel[xtype=file.filedataview] button[ref=oper] menuitem":{click:function(e){var t=e.up("panel[xtype=file.filedataview]"),i=t.up("panel[xtype=file.mainview]").down("treepanel[xtype=file.filedicview]");m.doFile(i,t,e.code)}},"menu[xtype=file.treemenu] menuitem":{click:function(e){var t=e.up("menu[xtype=file.treemenu]").fileDataView,i=t.up("panel[xtype=file.mainview]").down("treepanel[xtype=file.filedicview]");m.doFile(i,t,e.code)}},"panel[xtype=file.filedataview] button[ref=callQueryBtn]":{click:function(e){var t=e.up("panel[xtype=file.filedataview]").up("panel[xtype=file.mainview]").down("panel[xtype=file.queryformview]").down("button[ref=okQuery]");t.fireEvent("click",t)}},"panel[xtype=file.queryformview] button[ref=okQuery]":{click:function(e){var t=e.up("panel[xtype=file.queryformview]"),i=t.up("panel[xtype=file.mainview]"),a=i.down("panel[xtype=file.centerview]"),n=i.down("panel[xtype=file.filedataview]");m.queryFile(t,i,a,n)}},"panel[xtype=file.queryformview] button[ref=resetQuery]":{click:function(e){var t=e.up("panel[xtype=file.queryformview]");t.form.findField("JE_SYS_FILESIZE").setValue("all"),t.form.findField("JE_SYS_MODFIYDATE").setValue("all"),t.form.reset();var i=t.up("panel[xtype=file.mainview]").down("panel[xtype=file.filedataview]"),a=m.getFileView(i).getStore();a.proxy.extraParams.querySql="",a.loadPage(1)}},"panel[xtype=file.filedataview] qqfield[name=quickquery]":{query:function(e){var t=e.up("panel[xtype=file.filedataview]"),i=m.getFileView(t).store;i.proxy.extraParams.quickSql=" AND (FILE_NAME LIKE '%"+e.getValue()+"%' OR FILE_REMARK LIKE '%"+e.getValue()+"%')",i.loadPage(1)},reset:function(e){var t=e.up("panel[xtype=file.filedataview]"),i=m.getFileView(t).store;i.proxy.extraParams.quickSql="",i.loadPage(1)}}};m.control(e)},views:["JE.sys.file.view.MainView","JE.sys.file.view.WestView","JE.sys.file.view.CenterView","JE.sys.file.view.FileDicView","JE.sys.file.view.QueryFormView","JE.sys.file.view.TreeMenu","JE.sys.file.view.FileDataView","JE.sys.file.view.FileProgressView"]}),Ext.define("JE.sys.dataimpl.view.ColumnCols",{extend:"Ext.grid.Panel",alias:"widget.dataimpl.columncols",frame:!1,border:1,style:"background-color: #FEFECE;border-bottom:1px solid #99bce8;",bodyStyle:"background-color:#FEFECE;border-width: 1px 0 0 0;",padding:10,columns:[],initComponent:function(){var n=this;n.listeners={columnresize:function(e,t,i){n.updateRec("DATAFIELD_WIDTH",t.dataIndex,i)}},"en"!=n.lang&&Ext.apply(n.listeners,{columnhide:function(e,t){n.updateRec("DATAFIELD_HIDDEN",t.dataIndex,"1")},columnshow:function(e,t){n.updateRec("DATAFIELD_HIDDEN",t.dataIndex,"0")},columnmove:function(e,t,i,a){e.items.each(function(e,t){n.updateRec("SY_ORDERINDEX",e.dataIndex,t+1)})}}),n.callParent(arguments)},loadCols:function(e){var t=this.dgColumns(e);this.headerCt.removeAll(),this.headerCt.add(t),this.view.refresh()},dgColumns:function(n,o){var r=this,l=[];r.lang;return Ext.each(n,function(e){var t=e.data.DATAFIELD_XTYPE;["textfield","cbbfield"].indexOf(t)?t="uxcolumn":"rownumbercolumn"==t&&(t="rownumberer");var i={dataIndex:e.data.DATAFIELD_CODE,text:e.data.DATAFIELD_NAME,hidden:JE.toBool(e.data.DATAFIELD_HIDDEN),width:JE.toNum(e.data.DATAFIELD_WIDTH),moreColumnName:e.data.DATAFIELD_SSDBT,sortable:!1};if(Ext.value(o,"")==Ext.value(i.moreColumnName,"")){if("morecolumn"==t){var a=r.dgColumns(n,i.dataIndex);i.columns=a}l.push(i)}}),l},updateRec:function(e,t,i){var a=JE.getFunc("JE_SYS_DATAFIELD").gridview.store.findRecord("DATAFIELD_CODE",t);a&&a.set(e,i)}}),Ext.define("JE.sys.dataimpl.view.ExcelColumnCols",{extend:"Ext.grid.Panel",alias:"widget.dataimpl.excelcolumncols",frame:!1,border:1,style:"background-color: #FEFECE;border-bottom:1px solid #99bce8;",bodyStyle:"background-color:#FEFECE;border-width: 1px 0 0 0;",padding:10,columns:[],autoScroll:!0,initComponent:function(){var n=this;n.listeners={columnresize:function(e,t,i){n.updateRec("EXCELFIELD_WIDTH",t.dataIndex,i)}},Ext.apply(n.listeners,{columnhide:function(e,t){n.updateRec("EXCELFIELD_HIDDEN",t.dataIndex,"1")},columnshow:function(e,t){n.updateRec("EXCELFIELD_HIDDEN",t.dataIndex,"0")},columnmove:function(e,t,i,a){e.items.each(function(e,t){n.updateRec("SY_ORDERINDEX",e.dataIndex,t+1)})}}),n.callParent(arguments)},loadCols:function(e){var t=this.dgColumns(e);this.headerCt.removeAll(),this.headerCt.add(t),this.view.refresh()},dgColumns:function(n,o){var r=this,l=[];r.lang;return Ext.each(n,function(e){var t=e.data.DATAFIELD_XTYPE;["textfield","cbbfield"].indexOf(t)?t="uxcolumn":"rownumbercolumn"==t&&(t="rownumberer");var i={dataIndex:e.data.EXCELFIELD_CODE,text:e.data.EXCELFIELD_NAME,hidden:JE.toBool(e.data.EXCELFIELD_HIDDEN),width:JE.toNum(e.data.EXCELFIELD_WIDTH),moreColumnName:e.data.EXCELFIELD_SSDBT,sortable:!1};if(Ext.value(o,"")==Ext.value(i.moreColumnName,"")){if("morecolumn"==t){var a=r.dgColumns(n,i.dataIndex);i.columns=a}l.push(i)}}),l},updateRec:function(e,t,i){var a=JE.getFunc("JE_CORE_EXCELFIELD").gridview.store.findRecord("EXCELFIELD_CODE",t);a&&a.set(e,i)}}),Ext.define("JE.sys.dataimpl.view.MainView",{extend:"Ext.panel.Panel",border:0,layout:"fit",alias:"widget.dataimpl.mainview",bodyPadding:2,initComponent:function(){this.callParent(arguments)},load:function(e){var t=e.mainID,i=this.up("jeformview"),a=e.JE_CORE_EXCELGROUP_ID;JE.isEmpty(a)&&(a=i.form.findField("JE_CORE_EXCELGROUP_ID").getValue());var o=[];if(this.removeAll(),JE.isNotEmpty(a)){var n=JE.ajax({url:JE.getUrlMaps("je.core.develop.excel","loadSheetInfo"),params:{groupTemId:t,groupId:a}});Ext.each(n,function(e){var t=JE.getFuncData("JE_EXCEL_DATATEMP");t.info.whereSql=" AND JE_EXCEL_CONFIGTEMP_ID='"+e.temId+"' ";var n=new Array;n.push({xtype:"rownumberer",width:35,text:"No.",align:"center"}),n.push({text:"状态",dataIndex:"CODE",renderer:JE.renderer,width:80,align:"center",tactics:[{bgCss:!0,type:"dic",dicCode:"JE_EXCEL_DATASTATUS"}],field:{xtype:"cbbfield",configInfo:"JE_EXCEL_DATASTATUS"}}),n.push({text:"状态消息",dataIndex:"MSG",width:200,field:{xtype:"textfield"}}),Ext.each(e.columns,function(a){Ext.each(t.grid.columns,function(e){if(e.dataIndex==a.dataIndex){var t=a.field;delete a.field;var i=Ext.apply(e,a);return t&&Ext.each(["field","searchField","editField"],function(e){i[e]&&Ext.apply(i[e],t)}),i.field&&-1!=["rgroup","cgroup","cbbfield"].indexOf(i.field.xtype)&&(i.tactics=[{type:"dic",dicCode:i.field.configInfo.split(",")[0]}],i.renderer=JE.renderer),n.push(i),!1}-1!=["JE_EXCEL_CONFIGTEMP_ID","CODE","MSG","JE_EXCEL_DATATEMP_ID"].indexOf(e.dataIndex)&&n.push(e)})}),t.grid.columns=n,o.push({xtype:"jemainview",bodyPadding:1,title:e.sheetName,idSuffix:"JE_EXCEL_DATATEMP"+e.sheetIndex,funcData:t,border:1,columns:e.columns})})}0<o.length&&this.add(o)}}),Ext.define("JE.sys.dataimpl.controller.DataImplController",{extend:"Ext.app.Controller",init:function(){this.control({})},views:["JE.sys.dataimpl.view.ColumnCols","JE.sys.dataimpl.view.ExcelColumnCols","JE.sys.dataimpl.view.MainView"]}),Ext.define("JE.sys.im.util.IMUtil",{singleton:!0,alternateClassName:["IMUtil"],msgObj:{channelId:"402880c5357ec13b01357eeb94d1000a_402880bc38094343013809449e040001",channelType:"USER",context:"<p>洒洒水</p>",id:"0a516049-7a48-4db9-bd78-1d3bedb2561a",sendTime:"2014-07-24 13:24:17",sendUserId:"402880c5357ec13b01357eeb94d1000a",sendUserName:"吝志超"},msgArray:[],channelMap:{},pushMsg:function(e){JE.log(e);var t=null;if((e=Ext.decode(e))&&e.id&&e.channelId?t=e:e.length&&0<e.length&&(t=e[0]),t){var i='<span style="color:green;margin:5px;font-size:14px;">'+t.sendUserName+"在"+t.sendTime+'给您发来一条消息，请注意查收！</span><div style="margin:8px;font-size:15px;">'+t.context+"</div>",a={type:"im",beanId:t.id,title:"及时消息提醒",msg:i,see:"1",read:"0"};JE.sendWsSysMsg(a)}this.receiveMsg(e)},setMsgCache:function(e){this.msgArray;if(!JE.isEmpty(e)){if(Ext.isArray(e))this.msgArray=this.msgArray.concat(e);else{this.msgArray.push(e);var t=JE.getLocalLang("sys.IM.notice");JE.notice(e.sendUserName+t.msg,t.title)}this.updateMsgA(Ext.isEmpty(this.msgArray))}},clearMsgCache:function(t){var i=[];t?(Ext.each(this.msgArray,function(e){e.channelId!=t&&i.push(e)}),this.msgArray=i):this.msgArray=[],this.updateMsgA(0==this.msgArray.length)},receiveMsg:function(e,t){var i=Ext.getCmp("_appcenterview"),a=i.getCmp("immsgMainView"),n=!1;if(JE.isNotEmpty(e)&&Ext.getCmp(e.channelId+"_window")){var o={msgBox:Ext.getCmp(e.channelId+"_window").getCmp(e.channelId).getMsgBox(),user:{text:e.sendUserName,type:"receive"},msg:Ext.value(e.msgs,e.context),time:e.sendTime,color:"blue",cfg:e,channelId:e.channelId,channelType:e.channelType};this.updateMsg(o),n=!0}if(JE.isNotEmpty(e)){var r="";Ext.isEmpty(e.sendUserPhoto)||(r=e.sendUserPhoto.split("*")[1]);var l=JE.getLocalLang("sys.IM.notice");JE.desktopNotice(e.sendUserName+l.msg,l.title,null,r)}if(!a){if(!t)return void(n||this.setMsgCache(e));var s=JE.ajax({url:JE.getUrlMaps("je.core.load"),params:{tableCode:"JE_CORE_MENU",whereSql:"and MENU_NODEINFOTYPE = 'IDDT' AND MENU_NODEINFO LIKE '%JE.sys.im.view.MainView'",orderSql:"",queryFields:"",limit:-1}}),d=s&&s.rows&&1==s.rows.length?s.rows[0]:JE.error("数据获取失败！");d=Ext.value(d,{}),a=i.add({title:Ext.value(d.MENU_MENUNAME,JE.getLocalLang("sys.IM.title")),iconCls:JE.getIconCls(d,"MENU_ICONCLS","MENU_FONTICONCLS","jeicon jeicon-color-qq"),closable:!0,xtype:"im.mainview",itemId:"immsgMainView"})}if(a&&t&&i.setActiveTab(a),!Ext.isEmpty(e)){var c=a.getCmp("msgWins"),u=c.getCmp(e.channelId);if(!u){if(!t)return void(n||this.setMsgCache(e));var p=a["GROUP"==e.channelType?"talkgroupview":"userview"];a.getCmp("usertab").setActiveTab(p);var f="GROUP"==e.channelType?e.channelId:e.sendUserId,E=p.nodeHash[f];p.expandPath(p.getNodeHashPath(E)),E=p.getStore().getNodeById(f),p.getSelectionModel().select(E),this.openMsgDialog(E,e.channelType),u=c.getCmp(e.channelId)}o={msgBox:u.getMsgBox(),user:{text:e.sendUserName,type:"receive"},msg:Ext.value(e.msgs,e.context),time:e.sendTime,color:"blue",cfg:e,channelId:e.channelId,channelType:e.channelType};c.getActiveTab()!=u&&u.setIconCls("jeicon jeicon-sms"),this.updateMsg(o)}},sendMsg:function(e){if(e.user.type="send",e.color=Ext.value(e.color,"green"),this.updateMsg(e),e.window){e.fireEvent=!1;var t=Ext.getCmp("_appcenterview").getCmp("immsgMainView");t&&(userMsg=t.getCmp("msgWins").getCmp(e.channelId),userMsg&&(e.msgBox=userMsg.getMsgBox(),this.updateMsg(e)))}},updateMsg:function(t){var i=t.user,e=t.msgBox,a=t.msg,n=t.channelType,o=t.channelId;fireEvent=Ext.value(t.fireEvent,!0);var r=[],l=[];if(Ext.isArray(a))r=a;else{var s=Ext.value(t.time,Ext.Date.format(new Date,"Y-m-d H:i:s"));r.push({msg:a,time:s,cfg:t.cfg})}var d="";if(Ext.each(r,function(e){d+='<div style="clear:both;"><span  style="color:'+Ext.value(e.color,t.color)+';margin:5px;font-size:13px;">'+Ext.value(e.sendUser,Ext.value(e.sendUserName,i.text))+"&nbsp;&nbsp;"+e.time+'</span><div  style="margin:10px;">'+e.msg+"</div></div>",e.cfg&&l.push(e.cfg.id)}),e.el.dom.innerHTML+=d,e.el.scroll("b",1e5,!0),fireEvent)if("send"==i.type)JE.ajax({url:"/je/jms/jms/sendMsg",params:{channelId:o,msg:a,channelType:n}});else if(0<l.length){var c=l.join(",");JE.ajax({url:"/je/jms/jms/sendMsg",params:{id:c,channelType:n}})}},loadUnReadMsg:function(){var n=this;JE.ajax({url:JE.getUrlMaps("je.core.jms.loadMsg"),async:!0,success:function(e){var t=Ext.decode(Ext.value(e.responseText,"[]"));if(n.clearMsgCache(),n.setMsgCache(t),0<t.length){var i='<span style="color:green;margin:5px;font-size:14px;">'+t[0].sendUserName+"在"+t[0].sendTime+'给您发来一条消息，请注意查收！</span><div style="margin:8px;font-size:15px;">'+t[0].context+"</div>",a={type:"im",beanId:t[0].id,title:"消息提醒",msg:i,see:"1",read:"0"};JE.sendWsSysMsg(a)}}})},updateMsgA:function(e){var t=Ext.get("___msgA");if(t){var i=this.msgArray.length;t.hasCls("badge")?t.dom.innerHTML=i:t.dom.innerHTML=e?JE.getLocalLang("sys.IM.msgTag"):'<img src="'+JE.getStaticUrl("JE.sys.im.util.IMUtil.new")+'" title="'+JE.getLocalLang("sys.IM.msgNewTag")+'">'}},readUnReadMsg:function(){var t=this;if(0<t.msgArray.length){var a=new Ext.util.MixedCollection;Ext.each(t.msgArray,function(e){var t="blue";e.sendUserId==JE.currentUser.userId&&(t="green");var i=a.get(e.channelId);i?i.msgs.push({color:t,msg:e.context,time:e.sendTime,cfg:e,sendUserName:e.sendUserName}):((i=Ext.clone(e)).msgs=[{color:t,msg:i.context,time:i.sendTime,cfg:e,sendUserName:e.sendUserName}],delete i.context,a.add(i.channelId,i))}),a.each(function(e){t.receiveMsg(e,!0)}),t.clearMsgCache()}else t.receiveMsg(null,!0)},openMsgDialog:function(e,t,i,a){if(e){var n,o=e.isModel?e.data:e,r=this;if("USER"==t){if("1"==o.disabled||o.id==JE.currentUser.userId)return;n=Ext.value(IMUtil.channelMap[o.id+"_"+JE.currentUser.userId],IMUtil.channelMap[JE.currentUser.userId+"_"+o.id])}else n=IMUtil.channelMap[o.id];if(!n){var l=JE.ajax({url:JE.getUrlMaps("je.core.jms.getChannle"),params:{changeType:t,ids:o.id,groupId:o.id}});n={channelId:l.obj.id,channelType:l.obj.type,name:l.obj.name,ownerId:l.obj.ownerId,ownerName:l.obj.ownerName},IMUtil.channelMap[n.channelId]=n}function s(e,t){var i={channelId:t.channelId,channelType:t.channelType,fireEvent:!1,user:{text:t.name},msgBox:e,msg:[]},a=[];Ext.each(r.msgArray,function(e){e.channelId==i.channelId&&a.push({JMSHISTORY_CONTEXT:e.context,JMSHISTORY_SENDTIME:e.sendTime,JMSHISTORY_SENDUSERNAME:e.sendUserName,JMSHISTORY_SENDUSERID:e.setUserId})}),r.clearMsgCache(i.channelId),0==a.length&&(a=JE.ajax({url:JE.getUrlMaps("je.core.jms.loadHistory"),tableName:"JE_SYS_JMSHISTORY",params:{tableCode:"JE_SYS_JMSHISTORY",channelId:t.channelId,limit:10,orderSql:"ORDER BY JMSHISTORY_SENDTIME DESC"}}).rows);var n=[];Ext.each(a,function(e){n.push({msg:e.JMSHISTORY_CONTEXT,time:e.JMSHISTORY_SENDTIME,sendUser:e.JMSHISTORY_SENDUSERNAME,color:e.JMSHISTORY_SENDUSERID==JE.currentUser.userId?"green":"blue"})}),i.msg=n,r.updateMsg(i)}if(i){var d=Ext.getCmp(n.channelId+"_window");(d=d||JE.win({title:o.text,border:0,id:n.channelId+"_window",items:{xtype:"im.msgmainview",itemId:n.channelId,type:t,window:!0,channelData:n,listeners:{afterrneder:function(e){a&&s(e.getMsgBox(),e.channelData)}}}})).show()}else{var c=Ext.getCmp("_appcenterview").getCmp("immsgMainView").getCmp("msgWins"),u=c.getComponent(n.channelId);u=u||c.add({xtype:"im.msgmainview",itemId:n.channelId,type:t,title:o.text,channelData:n,listeners:{activate:function(e){e.setIconCls("")}},closable:!0,listeners:{activate:function(e){e.setIconCls("")},afterrender:function(e){a&&s(e.getMsgBox(),e.channelData)}}}),c.setActiveTab(u),"GROUP"==t&&u.talkusersview.renderUsers(o)}}},sendFiles:function(i){var a=this,n=i.mainView,o=JE.getLocalLang("sys.IM.myFiles"),r=Ext.create("Ext.window.Window",{title:o.sendFileTitle,width:800,height:600,modal:!0,layout:"fit",files:new Ext.util.MixedCollection,items:{xtype:"uploadpanel",itemId:"uploadpanel",upload_url:JE.getUrlMaps("je.core.jms.uploadFile"),file_post_name:"formUploadFiles",post_params:{filePath:"/upload/jms",funcCode:"JE_SYS_JMSHISTORY",tableCode:"JE_SYS_JMSHISTORY",jeFileType:"PROJECT",beanTableCode:"JE_SYS_JMSHISTORY"},failure:function(e,t,i){alert(t+"\n"+i)},success:function(e,t,i){var a=Ext.decode(Ext.value(t,"{}"));1==a.success?r.files.add(e.id,{name:e.name,path:a.obj.DOCUMENT_ADDRESS,cls:a.obj.DOCUMENT_BIGICONCLS}):JE.alert(t)}},listeners:{close:function(e){var t=a.buildFileMsg(e.files.items);Ext.isEmpty(t)||(a.sendMsg({channelId:n.itemId,user:{text:JE.currentUser.username},channelType:n.channelData.channelType,msg:t,color:"green",msgBox:i.msgBox}),JE.msg(o.sendSuccess))}}});r.show()},sendDocuments:function(r){var l=this,s=r.mainView,d=JE.getLocalLang("sys.IM.myFiles");JE.win({title:d.myFilesTitle,useButton:!0,autoShow:!0,items:{xtype:"documentation.mainview",noDnd:!0},fn:function(e){var t=e.down("panel[xtype=documentation.filedataview]"),i=t.down("dataview");"详细信息"==t.viewType&&(i=t.down("gridpanel"));var a=i.getSelectionModel().getSelection();if(!(0<a.length))return JE.alert(d.selectFileAlert),!1;var n=new Array;if(Ext.each(a,function(e){"DIR"!=e.get("DOCUMENTATION_TYPE")&&n.push({name:e.get("DOCUMENTATION_TEXT"),cls:e.get("DOCUMENTATION_BIGICONCLS"),path:e.get("DOCUMENTATION_ADDRESS")})}),!(0<n.length))return JE.alert(d.selectFileAlert),!1;var o=l.buildFileMsg(n);l.sendMsg({channelId:s.itemId,user:{text:JE.currentUser.username},channelType:s.channelData.channelType,msg:o,color:"green",msgBox:r.msgBox}),JE.msg(d.sendSuccess)}})},buildFileMsg:function(e){if(Ext.isEmpty(e))return"";var t=JE.getLocalLang("sys.IM.myFiles"),i=['<tpl for=".">',"<table width=200 height=50 class=table-files style='float:left;'>","<tr>","<td rowspan=2 width=50><div class='{cls}'></div></td>","<td data-qtip='{name}'>{[values.name.ellipsis(10)]}</td>","</tr>","<tr>","<td align = left>","<a style='color:blue;text-decoration:none;' href='javascript:void(0)' onclick='{[this.downClick(values)]}'>"+t.download+"</a>|","<a style='color:green;text-decoration:none;' href='javascript:void(0)' onclick='{[this.openClick(values)]}'>"+t.preview+"</a>|","<a style='color:red;text-decoration:none;' href='javascript:void(0)' onclick='{[this.save(values)]}'>"+t.saveFile+"</a>","</td>","</tr>","</table>","</tpl>",{downClick:function(e){return"("+('function(down){window.open("'+JE.getUrlMaps("je.core.doc.document","download")+"?ieFlag="+(Ext.isIE?"1":"0")+"&enCode=1&fileName="+encodeURIComponent(e.name)+"&path="+e.path+'")}')+")(this)"},openClick:function(e){return"("+('function(down){JE.File.openFileByPath("'+e.path+'","'+e.name+'",true)}')+")(this)"},save:function(e){return"("+('function(down){JE.File.addDocFiles("'+e.path+'","'+e.name+'")}')+")(this)"}}];return(i=new Ext.XTemplate(i)).apply(e)},sendExpress:function(e){var t=e.channelData,i=new Array,a=new Array,n=new Array;if("USER"==t.channelType){var o=t.channelId.split("_")[0];JE.currentUser.userId==o&&(o=t.channelId.split("_")[1]);var r=JE.ajax({url:JE.getUrlMaps("je.core.load"),params:{tableCode:"JE_CORE_ENDUSER",whereSql:" AND USERID='"+o+"'",orderSql:"",queryFields:"",limit:-1}}),l=r&&r.rows&&1==r.rows.length?r.rows[0]:JE.error("数据获取失败！");i.push(l.USERID),a.push(l.USERCODE),n.push(l.USERNAME)}else{var s=Ext.getCmp("_appcenterview").getCmp("immsgMainView"),d=(s.talkgroupview,s.userview,t.channelId),c=s.talkgroupview.getStore().getNodeById(d).get("bean").JMSGROUP_USERIDS.split(","),u=JE.ajax({url:JE.getUrlMaps("je.core.rbac.rbac.load"),params:{limit:-1,tableCode:"JE_CORE_ENDUSER",whereSql:" AND USERID IN ('"+c.join("','")+"')"}}).rows;Ext.each(u,function(e){e.USERID!=JE.currentUser.userId&&(i.push(e.USERID),a.push(e.USERCODE),n.push(e.USERNAME))})}JE.showFunc("JE_SYS_OUTBOX",{type:"form",values:{OUTBOX_RECEIVE_NAME:n.join(","),OUTBOX_RECEIVE_CODE:a.join(","),OUTBOX_RECEIVE_ID:i.join(","),OUTBOX_SEND:"0",OUTBOX_TYPE:"OUTBOX",OUTBOX_SUBJECT:"",OUTBOX_CONTEXT:""},callback:function(e){}})},sendNote:function(e){var t=e.channelData,i=new Array;if("USER"==t.channelType){var a=t.channelId.split("_")[0];JE.currentUser.userId==a&&(a=t.channelId.split("_")[1]),i.push(a)}else{var n=Ext.getCmp("_appcenterview").getCmp("immsgMainView"),o=(n.talkgroupview,n.userview,t.channelId);i=n.talkgroupview.getStore().getNodeById(o).get("bean").JMSGROUP_USERIDS.split(",")}var r=JE.ajax({url:JE.getUrlMaps("je.core.rbac.rbac.load"),params:{limit:-1,tableCode:"JE_CORE_ENDUSER",whereSql:" AND USERID IN ('"+i.join("','")+"')"}}).rows,l=new Array,s=new Array,d=new Array;Ext.each(r,function(e){e.USERID!=JE.currentUser.userId&&(s.push(e.USERNAME),l.push(e.USERCODE),d.push(e.PHONE))})},doGroupDwr:function(e){var t=JE.toObj(e),i=Ext.getCmp("_appcenterview").getCmp("immsgMainView"),a=JE.getLocalLang("sys.IM.talkGroup");switch(t.oper){case"refresh":if(i)(n=i.talkgroupview.getStore().getNodeById(t.id))&&(n.data.bean.JMSGROUP_USERIDS=t.userIds,n.data.bean.JMSGROUP_USERNAMES=t.userNames,n.commit()),(o=i.getCmp("msgWins").getCmp(t.id))&&o.talkusersview.renderUsers(n.data);JE.msg(JE.format(a.updateAlert,t.name));break;case"join":i&&i.talkgroupview.load(),JE.msg(JE.format(a.addAlert,t.name));break;case"update":if(i)(n=i.talkgroupview.getStore().getNodeById(t.id))&&(n.set("text",t.name),n.commit()),(o=i.getCmp("msgWins").getCmp(t.id))&&(o.setTitle(t.name),o.channelData.name=t.name,o.talkusersview.channelData.name=t.name);break;case"kickOut":case"exit":case"remove":if(i){var n,o;(n=i.talkgroupview.getStore().getNodeById(t.id))&&n.remove(),(o=i.getCmp("msgWins").getCmp(t.id))&&i.getCmp("msgWins").remove(o),delete this.channelMap[t.id];var r=[];Ext.each(this.msgArray,function(e){e.channelId!=t.id&&r.push(e)}),this.msgArray=r,this.updateMsgA(Ext.isEmpty(this.msgArray))}var l=JE.format(a.kickAlert,t.name);"remove"==t.oper?l=JE.format(a.removeAlert,t.name):"exit"==t.oper&&(l=JE.format(a.exitAlert,t.name)),JE.msg(l)}},doGroup:function(r,e){var l=JE.getLocalLang("sys.IM.talkGroup");switch(e){case"添加":JE.prompt(l.groupNameAlert,function(e,t){if("cancel"!=e&&!Ext.isEmpty(t)){var i=JE.ajax({url:JE.getUrlMaps("je.core.jms.getChannle"),params:{changeType:"GROUP",ids:"",groupId:"",groupName:t}});if(i.success){var a=i.obj,n={id:a.id,text:a.name,code:"",iconCls:"jeicon jeicon-group",leaf:!0,nodeInfo:"",nodeInfoType:a.type,bean:{JE_SYS_JMSGROUP_ID:a.id,JMSGROUP_NAME:a.name,SY_CREATEUSERID:JE.currentUser.userId,SY_CREATEUSERNAME:JE.currentUser.username,JMSGROUP_USERIDS:JE.currentUser.userId,JMSGROUP_USERNAMES:JE.currentUser.username,JMSGROUP_USERCOUNT:1}},o=r.getRootNode().appendChild(n);r.getSelectionModel().select(o),r.fireEvent("itemdblclick",r.getView(),o),JE.msg(l.addSuccessAlert)}else JE.alert(i.obj)}});break;case"编辑":if(!(a=r.getSelectionModel().getSelection()[0]))return void JE.alert(l.selectGroupAlert);JE.prompt(l.groupNameAlert,function(e,t){if("cancel"!=e&&!Ext.isEmpty(t)){var i=JE.ajax({url:JE.getUrlMaps("je.core.jms.updateGroup"),params:{tableCode:"JE_SYS_JMSGROUP",groupId:a.get("id"),groupName:t}});i.success||JE.alert(i.obj)}});break;case"删除":if(!(a=r.getSelectionModel().getSelection()[0]))return void JE.alert(l.selectGroupAlert);JE.currentUser.userId==a.get("bean").SY_CREATEUSERID?JE.confirm(l.removeGroupAlert,function(e,t){if("ok"==e){var i=JE.ajax({url:JE.getUrlMaps("je.core.jms.removeGroup"),params:{tableCode:"JE_SYS_JMSGROUP",groupId:a.get("id")}});i.success||JE.alert(i.obj)}}):JE.alert(l.createRemoveGroupAlert);break;case"退出":var a;if(!(a=r.getSelectionModel().getSelection()[0]))return void JE.alert(l.selectGroupAlert);this.doUpdateGroupUser(a.get("id"),JE.currentUser.userId,"remove")}},doTreeMenu:function(e,t,i){var a=this,n=null,o=JE.getLocalLang("sys.IM.talkGroup");switch(t){case"groupNode":if("邀请"==i){if(!(n=e.getSelectionModel().getSelection()[0]))return void JE.alert(o.selectGroupAlert);n=n}else a.doGroup(e,i);break;case"group":"添加"==i?a.doGroup(e,i):"刷新"==i&&(e.load(),JE.msg(o.refershGroupAlert));break;case"relation":"刷新"==i&&(e.load(),JE.msg(o.refershGroupAlert));break;case"groupNodeUser":if("移除"==i){if(!(n=e.getSelectionModel().getSelection()[0]))return void JE.alert(o.removeUserAlert);a.doUpdateGroupUser(e.channelData.channelId,n.get("id"),"remove")}break;case"groupUser":if("邀请"==i){var r=e.up("panel[itemId=immsgMainView]");if(!(n=r.talkgroupview.getStore().getNodeById(e.channelData.channelId)))return void JE.alert(o.noSearchGroupAlert)}else"退出"==i&&a.doUpdateGroupUser(e.channelData.channelId,JE.currentUser.userId,"remove")}if("邀请"==i){var l=n.data.bean.JMSGROUP_USERIDS;JE.selectWin({parent:null,parentType:"self",title:o.groupUserTitle,configInfo:"JE_CORE_QUERYUSER,,,M",whereSql:" AND USERID NOT IN ('"+l.split(",").join("','")+"')",type:"grid",callback:function(e,t){var i=new Array;Ext.each(e,function(e){i.push(e.get("USERID"))}),0<i.length&&a.doUpdateGroupUser(n.get("id"),i.join(","),"add")}})}},doUpdateGroupUser:function(e,t,i){var a=JE.ajax({url:JE.getUrlMaps("je.core.jms.updateGroupUser"),params:{groupId:e,ids:t,oper:i}});a.success||JE.alert(a.obj)}}),Ext.define("JE.sys.im.view.HistoryView",{extend:"Ext.panel.Panel",alias:"widget.im.allhistoryview",layout:"border",mixins:["JE.core.util.ViewUtil"],initComponent:function(){this.localLang=JE.getLocalLang("sys.IM.allHistory"),this.items=[this.getHistoryBox(),this.getUserTree()],this.callParent(arguments)},getHistoryBox:function(){var t=this;t.store=JE.getStore({url:JE.getUrlMaps("je.core.jms.loadImMsg"),tableName:"JE_SYS_JMSHISTORY",autoLoad:!0,params:{tableCode:"JE_SYS_JMSHISTORY",orderSql:"ORDER BY JMSHISTORY_SENDTIME DESC"}}),t.store.sqls={basic:" and 1!=1 "},JE.DB.setWhereSql(t.store);var e=new Ext.XTemplate('<tpl for=".">','<div class="msgdiv" style="clear:both;">','<div style="color:{[this.getUserColor(values.JMSHISTORY_SENDUSERID)]};font-size:12px;margin:4px;">',"{JMSHISTORY_SENDUSERNAME}&nbsp;&nbsp;{JMSHISTORY_SENDTIME}","</div>","<div>{[this.redKeyWord(values.JMSHISTORY_CONTEXT)]}</div>","</div>","</tpl>",{redKeyWord:function(e){return Ext.isEmpty(t.keyWord)||(e=e.replaceAll(t.keyWord,'<font color="red">'+t.keyWord+"</font>")),e},getUserColor:function(e){return e==t.firstUserId?"green":"blue"}});return{xtype:"panel",layout:"fit",itemId:"history",region:"center",bodyPadding:"0 5",tbar:{xtype:"toolbar",itemId:"searchbar",mainview:t,items:[{xtype:"label",itemId:"title",style:"color: #04408c;font-weight: bold;",html:t.localLang.explainHtml,basicText:t.localLang.explainHtml},"->",{xtype:"rangedatefield",itemId:"time",fieldLabel:t.localLang.range,labelWidth:40,width:225,separator:"~",labelAlign:"right"},{xtype:"uxtrigger",itemId:"text",fieldLabel:t.localLang.content,labelWidth:40,labelAlign:"right"}]},border:0,items:{xtype:"dataview",itemId:"dataview",store:t.store,tpl:e,autoScroll:!0,emptyText:"<div class=x-view-emtpytext >"+t.localLang.emptyText+"</div>"},bbar:{xtype:"pagingtoolbar",store:t.store,displayInfo:!0,items:t.getPageitems(t.store)}}},getUserTree:function(){var e=JE.ajax({url:JE.getUrlMaps("je.core.dd.dd","loadTree"),params:{node:"ROOT",onlyItem:!0,excludes:"checked",strData:'[{"ddCode":"JE_CORE_DEPTUSER","ddName":"","async":false,"whereSql":" ","orderSql":"","parentSql":"","rootId":"","nodeInfo":"","params":{},"initParams":{},"moreRoot":false,"queryField":"","nodeField":"","formatValue":""}]',parentSql:"",whereSql:""}});return{xtype:"panel",layout:{type:"hbox",align:"stretch"},defaults:{flex:1,layout:"fit",border:0,items:{xtype:"jetreeview",border:0,title:JE.getLocalLang("sys.IM.main.contactsTitle"),mainview:this,rootData:e[0],async:!1,type:"func",useTools:!0}},width:300,region:"west",border:0,bodyStyle:"border-right-width:1px !important;",items:[{xtype:"panel",bodyStyle:"border-right-width:1px !important;"},{xtype:"panel"}]}}}),Ext.define("JE.sys.im.view.MainView",{extend:"Ext.panel.Panel",alias:"widget.im.mainview",layout:"border",initComponent:function(){var e=JE.getLocalLang("sys.IM.main");this.bodyPadding=0,this.itemId="immsgMainView",this.border=0,this.items=[{xtype:"tabpanel",region:"west",split:!0,plain:!0,bodyStyle:"border-left-width:0px;",minWidth:120,maxWidth:230,width:130,margin:"2 0 0 0",itemId:"usertab",items:[{xtype:"im.userview",border:0,tooltip:e.contactsTitle,iconCls:"jeicon jeicon-khgl-pc",itemId:"user"},{xtype:"im.talkgroupview",border:0,tooltip:e.talkGroupTitle,iconCls:"jeicon jeicon-group",itemId:"talkgroup"},{xtype:"im.relationview",border:0,tooltip:e.recentContactsTitle,iconCls:"jeicon jeicon-alarm",itemId:"recentUser"}]},{xtype:"tabpanel",region:"center",itemId:"msgWins",margin:"2 0 0 0",plain:!0,items:[{title:e.wolcomeTitle,iconCls:"jeicon jeicon-sms",itemId:"welcome",html:'<div style="background:url('+JE.getStaticUrl("JE.sys.im.view.MainView.mibg")+');height:900px;-moz-background-size: 100% 100%;background-size: 100% 100%;"></div>'}]}],this.callParent(arguments),this.userview=this.getCmp("usertab").getCmp("user"),this.talkgroupview=this.getCmp("usertab").getCmp("talkgroup")}}),Ext.define("JE.sys.im.view.msg.HistoryView",{extend:"Ext.panel.Panel",alias:"widget.im.historyview",keyWord:"",autoScroll:!0,bodyPadding:4,initComponent:function(){var i=this;i.localLang=JE.getLocalLang("sys.IM.msgWin.history"),i.bodyStyle="border-width:0 0 1px 0;",i.dockedItems=[{xtype:"panel",dock:"top",border:0,layout:"fit",items:[{xtype:"triggerfield",emptyText:i.localLang.searchEmptyText,trigger1Cls:Ext.baseCSSPrefix+"form-clear-trigger",trigger2Cls:Ext.baseCSSPrefix+"form-search-trigger",onTrigger1Click:function(){this.reset()},onTrigger2Click:function(){var e=this.getValue(),t="";Ext.isEmpty(e)||(t=" and JMSHISTORY_CONTEXT like '%"+e+"%'"),i.keyWord=e,i.store.proxy.extraParams.whereSql=t,i.store.load()},listeners:{specialkey:function(e,t){t.getKey()==t.ENTER&&e.onTrigger2Click()}}}]},{xtype:"panel",dock:"bottom",border:0,layout:"fit",items:[{xtype:"button",text:i.localLang.seeMoreBtnText,limit:-1,handler:function(e){i.store.proxy.extraParams.limit=e.limit,i.store.load(),-1==e.limit?(e.limit=100,e.setText(i.localLang.top100BtnText)):(e.limit=-1,e.setText(i.localLang.seeMoreBtnText))}}]}],i.store=JE.getStore({url:JE.getUrlMaps("je.core.jms.loadHistory"),tableName:"JE_SYS_JMSHISTORY",params:{tableCode:"JE_SYS_JMSHISTORY",channelId:i.channelId,limit:100,orderSql:"ORDER BY JMSHISTORY_SENDTIME DESC"}});var e=new Ext.XTemplate('<tpl for=".">','<div class="msgdiv" style="clear:both;">','<div style="color:{[this.getUserColor(values.JMSHISTORY_SENDUSERID)]};font-size:12px;margin:4px;">',"{JMSHISTORY_SENDUSERNAME}&nbsp;&nbsp;{JMSHISTORY_SENDTIME}","</div>","<div>{[this.redKeyWord(values.JMSHISTORY_CONTEXT)]}</div>","</div>","</tpl>",{redKeyWord:function(e){return Ext.isEmpty(i.keyWord)||(e=e.replaceAll(i.keyWord,'<font color="red">'+i.keyWord+"</font>")),e},getUserColor:function(e){return e==JE.currentUser.userId?"green":"blue"}});i.items={xtype:"dataview",itemId:"dataview",store:i.store,tpl:e,emptyText:i.localLang.viewEmptyText},i.callParent(arguments)}}),Ext.define("JE.sys.im.view.msg.MainView",{extend:"Ext.panel.Panel",alias:"widget.im.msgmainview",layout:"border",initComponent:function(){var t=this;t.localLang=JE.getLocalLang("sys.IM.msgWin"),t.tbar=[{text:t.localLang.buttons.file,iconCls:"jeicon jeicon-database-cycle",handler:function(){var e={channelId:t.itemId,user:{text:JE.currentUser.username},msgBox:t.getMsgBox(),mainView:t};IMUtil.sendFiles(e)}},{text:t.localLang.buttons.cloud,iconCls:"jeicon jeicon-form",handler:function(){var e={channelId:t.itemId,user:{text:JE.currentUser.username},msgBox:t.getMsgBox(),mainView:t};IMUtil.sendDocuments(e)}},{text:t.localLang.buttons.email,iconCls:"jeicon jeicon-mail",handler:function(){IMUtil.sendExpress({channelData:t.channelData})}},{text:t.localLang.buttons.sms,iconCls:"jeicon jeicon-mobile",handler:function(){IMUtil.sendNote({channelData:t.channelData})}}],t.items=[{xtype:"im.msgview",region:"center",itemId:"msgview",channelId:t.itemId,border:0},{xtype:"tabpanel",itemId:"tabpanel",margin:"1 0 0 0",split:!0,region:"east",plain:!0,collapsible:!0,collapsed:!0,hideCollapseTool:!0,titleCollapse:!0,collapseMode:"mini",minWidth:200,activeItem:1,bodyStyle:"border-top-width:0px;",maxWidth:250,width:200,tabBar:{hidden:!0},listeners:{expand:function(e){t.historyview.store.load()}},items:[{xtype:"im.talkusersview",itemId:"talkusersview",channelId:t.itemId,channelData:t.channelData,title:t.localLang.title.talk},{xtype:"im.historyview",title:t.localLang.title.history,itemId:"historyview",channelId:t.itemId}]}],"GROUP"==t.type&&(t.items[1].collapsed=!1,t.items[1].tabBar.hidden=!1,t.items[1].activeItem=0),t.callParent(arguments),t.historyview=t.getCmp("tabpanel").getCmp("historyview"),t.talkusersview=t.getCmp("tabpanel").getCmp("talkusersview")},getMsgBox:function(){return this.getCmp("msgview").getCmp("msgbox")}}),Ext.define("JE.sys.im.view.msg.MsgView",{extend:"Ext.panel.Panel",alias:"widget.im.msgview",layout:"border",minWidth:610,initComponent:function(){var a=this;a.localLang=JE.getLocalLang("sys.IM.msgWin"),a.items=[{xtype:"box",itemId:"msgbox",region:"center",layout:"fit",autoScroll:!0,style:"border:1px solid #99bce8!important;border-top-width:0px!important;border-left-width:0px!important;background-color:#FFFFFF;background: rgb(255, 253, 240);"},{xtype:"ueditorfield",simpleToolbar:!0,itemId:"ueditor",region:"south",listeners:{editorready:function(e){var t=e.editor;t.commands.sendmsg={execCommand:function(){return a.down("button[ref=sendmsg]").handler(),!0}},t.addshortcutkey({sendmsg:"ctrl+13"})}},height:240,minHeight:100,split:!0}],a.buttons=[{text:a.localLang.buttons.close,iconCls:JE.getIconCls({iconCls:"jeicon jeicon-minus-circle",fontIconCls:"fa fa-close"}),cls:"btn JEPLUS_B_L10",handler:function(e){a.ownerCt.window?a.ownerCt.ownerCt.close():a.ownerCt.ownerCt.tabBar.closeTab(a.ownerCt.tab)}},{text:a.localLang.buttons.msgLog,iconCls:JE.getIconCls({iconCls:"jeicon jeicon-search",fontIconCls:"fe icon-history"}),cls:"btn JEPLUS_B_C03",handler:function(e){var t=a.ownerCt.historyview,i=t.ownerCt;i.collapsed?(i.expand(),i.setActiveTab(t)):i.tabBar.hidden?i.collapse():(i.setActiveTab(t),t.store.load())}},{text:a.localLang.buttons.send,iconCls:JE.getIconCls({iconCls:"jeicon jeicon-arrow-right",fontIconCls:"fa fa-send"}),cls:"btn JEPLUS_B_C01",ref:"sendmsg",handler:function(e){var t=a.getCmp("ueditor").editor,i=t.getContent();Ext.isEmpty(i)||(IMUtil.sendMsg({channelId:a.ownerCt.itemId,user:{text:JE.currentUser.username},channelType:a.ownerCt.channelData.channelType,msg:i,color:"green",window:a.ownerCt.window,msgBox:a.getMsgBox()}),t.setContent(""))}}],a.buttonAlign="left",a.callParent(arguments)},getMsgBox:function(){return this.getCmp("msgbox")}}),Ext.define("JE.sys.im.view.msg.TalkUsersView",{extend:"Ext.tree.Panel",alias:"widget.im.talkusersview",useArrows:!0,rootVisible:!1,animate:!1,initComponent:function(){this.nodeWin=Ext.create("JE.sys.im.view.user.TreeMenu",{type:"groupNodeUser",tree:this}),this.menuWin=Ext.create("JE.sys.im.view.user.TreeMenu",{type:"groupUser",tree:this}),this.callParent(arguments)},renderUsers:function(e){var t=e.bean,i=t.JE_SYS_JMSGROUP_ID,a=t.JMSGROUP_NAME,n=t.SY_CREATEUSERID,o=t.JMSGROUP_USERIDS.split(","),r=t.JMSGROUP_USERNAMES.split(","),l={id:i,text:a,createUserId:n,children:[]};Ext.each(o,function(e,t){l.children.push({id:e,text:r[t],iconCls:e!=n?"jeicon jeicon-khgl-pc":"jeicon jeicon-group",leaf:!0})}),this.setRootNode(l)}}),Ext.define("JE.sys.im.view.user.RelationView",{extend:"JE.core.view.TreeView",alias:"widget.im.relationview",initComponent:function(){this.type="func",this.url=JE.getUrlMaps("je.core.jms.loadRelation"),this.params={tableName:"JE_SYS_JMSGROUP",limit:10},this.menuWin=Ext.create("JE.sys.im.view.user.TreeMenu",{type:"relation",tree:this}),this.callParent(arguments)}}),Ext.define("JE.sys.im.view.user.TalkGroupView",{extend:"JE.core.view.TreeView",alias:"widget.im.talkgroupview",initComponent:function(){this.type="func",this.url=JE.getUrlMaps("je.core.jms.loadGroup"),this.params={tableName:"JE_SYS_JMSGROUP"},this.nodeWin=Ext.create("JE.sys.im.view.user.TreeMenu",{type:"groupNode",tree:this}),this.menuWin=Ext.create("JE.sys.im.view.user.TreeMenu",{type:"group",tree:this}),this.callParent(arguments)}}),Ext.define("JE.sys.im.view.user.TreeMenu",{extend:"Ext.menu.Menu",alias:"widget.im.treemenu",defaultAlign:"br-tr",frame:!1,border:1,initComponent:function(){var e=this;e.localLang=JE.getLocalLang("sys.IM.userMenu");var t=[];switch(e.type){case"groupNode":t=[{text:e.localLang.invite,iconCls:"jeicon jeicon-khgl-pc"},{text:e.localLang.edit,iconCls:"jeicon jeicon-pencil"},{text:e.localLang.del,iconCls:"jeicon jeicon-minus-circle"},{text:e.localLang.exit,iconCls:"jeicon jeicon-turn-left"}];break;case"group":t=[{text:e.localLang.add,iconCls:"jeicon jeicon-plus-circle"},{text:e.localLang.refresh,iconCls:"jeicon jeicon-refresh"}];break;case"groupNodeUser":t=[{text:e.localLang.remove,iconCls:"jeicon jeicon-minus-circle"}];break;case"groupUser":t=[{text:e.localLang.invite,iconCls:"jeicon jeicon-khgl-pc"},{text:e.localLang.exit,iconCls:"jeicon jeicon-turn-left"}];break;case"relation":t=[{text:e.localLang.refresh,iconCls:"jeicon jeicon-refresh"}]}e.items=t,this.callParent()}}),Ext.define("JE.sys.im.view.user.UserView",{extend:"JE.core.view.TreeView",alias:"widget.im.userview",initComponent:function(){this.type="func",this.queryItems=[{configInfo:"JE_CORE_DEPTUSER,,,S",whereSql:" and STATUS='1' AND VALID='1'"}],this.callParent(arguments)}}),Ext.define("JE.sys.im.controller.IMMainCtr",{extend:"Ext.app.Controller",init:function(){Ext.syncRequire(["JE.sys.im.util.IMUtil"]),this.control({"panel[xtype=im.allhistoryview] panel[itemId=history] uxtrigger":{beforerender:function(r){r.handler=function(){var e=r.ownerCt,t=e.mainview,i=t.store,a=e.getCmp("time").getValue(),n=e.getCmp("text").getValue(),o=[];" and 1!=1 "!=i.sqls.basic&&(t.keyWord=n,JE.isNotEmpty(n)&&o.push({code:"JMSHISTORY_CONTEXT",type:"like",value:n}),JE.isNotEmpty(a)&&o.push({code:"JMSHISTORY_SENDTIME",type:"BETWEEN",value:a.split("~")}),JE.DB.setWhereSql(i,o,"quick"),i.loadPage(1))}}},"panel[xtype=im.allhistoryview] jetreeview":{selectionchange:function(e,t){var i=e.view.panel.mainview,a=[],n=0;Ext.each(i.query("jetreeview"),function(e){var t=e.getSelectionModel().getSelection()[0];t&&(n++,"1"!=t.get("disabled")&&a.push(t.data))});var o=i.store,r=i.getCmp("history").getDockedCmp("searchbar");if(2==a.length&&a[0].id==a[1].id&&(a=[]),2==a.length){o.sqls={basic:"and (JMSHISTORY_CHANNEL = '"+a[0].id+"_"+a[1].id+"' or JMSHISTORY_CHANNEL = '"+a[1].id+"_"+a[0].id+"') and JMSHISTORY_CHANNELTYPE = 'USER'"};var l=o.getProxy().extraParams;l.uId=a[0].id,l.userId=a[1].id,JE.DB.setWhereSql(o),o.loadPage(1),i.keyWord="",i.firstUserId=a[0].id,r.getCmp("title").update(i.localLang.barTitleText+"<font color=green >"+a[0].text+"</font><->"+a[1].text),r.getCmp("time").reset(),r.getCmp("text").reset()}else n<2&&(o.sqls={basic:" and 1!=1 "},JE.DB.setWhereSql(o),o.loadPage(1),i.keyWord="",i.firstUserId="",r.getCmp("title").update(r.getCmp("title").basicText),r.getCmp("time").reset(),r.getCmp("text").reset())}},"jetreeview[xtype=im.userview]":{itemdblclick:function(e,t){IMUtil.openMsgDialog(t,"USER",!1,!0)}},"treepanel[xtype=im.talkusersview]":{itemdblclick:function(e,t){IMUtil.openMsgDialog(t,"USER",!1,!0)},itemcontextmenu:function(e,t,i,a,n,o){var r=e.panel,l=r.nodeWin;n.stopEvent();var s=r.channelData.ownerId;t.get("id")!=JE.currentUser.userId&&s==JE.currentUser.userId&&(l.showAt(n.getXY()),l.doConstrain())},afterrender:function(n){n.getEl().on("contextmenu",function(e,t,i){var a=n.menuWin;e.stopEvent(),a.showAt(e.getXY()),a.doConstrain()})}},"treepanel[xtype=im.talkgroupview]":{itemdblclick:function(e,t){IMUtil.openMsgDialog(t,"GROUP",!1,!0)},itemcontextmenu:function(e,t,i,a,n,o){var r=e.panel.nodeWin;n.stopEvent(),r.showAt(n.getXY()),r.doConstrain()},afterrender:function(n){n.getEl().on("contextmenu",function(e,t,i){var a=n.menuWin;e.stopEvent(),a.showAt(e.getXY()),a.doConstrain()})}},"treepanel[xtype=im.relationview]":{itemdblclick:function(e,t){IMUtil.openMsgDialog(t,t.get("nodeInfoType"),!1,!0)},itemcontextmenu:function(e,t,i,a,n,o){n.stopEvent()},afterrender:function(n){n.getEl().on("contextmenu",function(e,t,i){var a=n.menuWin;e.stopEvent(),a.showAt(e.getXY()),a.doConstrain()})}},"menu[xtype=im.treemenu] menuitem":{click:function(e){var t=e.up("menu[xtype=im.treemenu]"),i=t.tree;IMUtil.doTreeMenu(i,t.type,e.text)}}})},views:["JE.sys.im.view.MainView","JE.sys.im.view.user.UserView","JE.sys.im.view.msg.MsgView","JE.sys.im.view.msg.MainView","JE.sys.im.view.msg.HistoryView","JE.sys.im.view.msg.TalkUsersView","JE.sys.im.view.user.TalkGroupView","JE.sys.im.view.user.RelationView","JE.sys.im.view.user.TreeMenu","JE.sys.im.view.HistoryView"]}),Ext.define("JE.sys.calendar.util.CalendarUtil",{doGroup:function(u,e){var t=!0,i=null,p=u.getSelectionModel().getSelection()[0],f=JE.getLocalLang("sys.calendar.msg");switch(e){case"add":break;case"edit":i=p.raw.bean;break;case"delete":if(t=!1,"1"==p.get("nodeInfoType"))return void JE.alert(f.noDeleteAlert);JE.confirm(JE.format(f.deleteConfirm,p.get("text")),function(e){if("ok"==e){var t=JE.ajax({url:JE.getUrlMaps("je.core.calendar","removeGroup"),params:{tableCode:"JE_SYS_CALENDARGROUP",ids:p.get("id")}});t.success?(p.remove(),JE.msg(JE.getLocalLang("common.deleteSuccessAlert"))):JE.alert(t.obj)}});break;case"refresh":t=!1,u.getStore().load()}if(t){var a=150,n=400;"plus"==JE.getTheme()&&(a=220,n=550);var o=JE.win({title:JE.getLocalLang("sys.calendar.group.title"),iconCls:"jeicon jeicon-group",useButton:!0,layout:"border",autoShow:!0,width:550,height:n,items:[{xtype:"calendar.groupform",region:"north",height:a},{xtype:"calendar.groupusergrid",region:"center"}],fn:function(e){var t=e.down("panel[xtype=calendar.groupform]"),i=e.down("panel[xtype=calendar.groupusergrid]"),a=t.form.getValues();if(Ext.isEmpty(a.CALENDARGROUP_NAME))return JE.alert(f.nameEmptyAlert),!1;var n="doSave";Ext.isEmpty(a.JE_SYS_CALENDARGROUP_ID)||(n="doUpdate"),a.tableCode="JE_SYS_CALENDARGROUP";var o=JE.ajax({url:JE.getUrlMaps("je.core.calendar",n),params:a});if(!o.success)return JE.alert(o.obj),!1;if("doUpdate"==n)if(p.raw.bean=o.obj,p.set("text",o.obj.CALENDARGROUP_NAME),p.set("code",o.obj.CALENDARGROUP_COLOR),p.commit(),0<i.getStore().getUpdatedRecords().length){var r=i.down("button[ref=gridSave]");r.fireEvent("click",r)}else JE.msg(JE.getLocalLang("common.updateSuccessAlert"));else{var l=o.obj,s={id:l.JE_SYS_CALENDARGROUP_ID,code:l.CALENDARGROUP_COLOR,text:l.CALENDARGROUP_NAME,nodeInfo:"INSERT,UPDATE,DELETE",description:l.CALENDARGROUP_REMARK,parent:"ROOT",parentId:"ROOT",iconCls:"jeicon jeicon-group",bean:l};u.getRootNode().appendChild(s);var d=(i=e.down("panel[xtype=calendar.groupusergrid]")).getStore(),c=new Array;d.each(function(e){c.push(e.get("GROUPUSER_USERID"))}),0<c.length&&JE.ajax({url:JE.getUrlMaps("je.core.calendar","addGroupUsers"),params:{tableCode:"JE_SYS_CALENDARGROUP",JE_SYS_CALENDARGROUP_ID:l.JE_SYS_CALENDARGROUP_ID,ids:c.join(",")}}),JE.msg(JE.getLocalLang("common.addSuccessAlert"))}u.fireEvent("load",u.getStore())}}),r=o.down("panel[xtype=calendar.groupusergrid]"),l=r.getStore(),s=o.down("button[itemId=okButton]");if(null!=i){var d=o.down("panel[xtype=calendar.groupform]");d.form.setValues(i),l.proxy.extraParams.whereSql=" AND GROUPUSER_GROUP_ID='"+i.JE_SYS_CALENDARGROUP_ID+"'";var c=JE.currentUser.userCode==i.SY_CREATEUSER;d.form.setItemsReadOnly(!c),s.setDisabled(!c)}else l.proxy.extraParams.whereSql=" AND 1!=1",s.setDisabled(!1),r.doReadOnly(!0);l.load()}},showEditWindow:function(e,t,i){this.editWin?(this.editWin.calendarStore=e.calendarStore,this.editWin.calendarPanel=e,this.editWin.activeRecord=t,this.editWin.activeNode=i,this.editWin.groupData=this.groupData,this.editWin.show()):this.editWin=Ext.create("JE.sys.calendar.form.EventWindow",{calendarStore:e.calendarStore,calendarPanel:e,activeRecord:t,activeNode:i,groupData:this.groupData,listeners:{eventadd:function(e,t){e.hide()},eventupdate:function(e,t){e.hide(),t.data&&t.commit()},eventdelete:function(e,t){t.data&&this.calendarPanel.calendarStore.remove(t),e.hide()},editdetails:function(e,t){}}})}}),Ext.define("JE.sys.calendar.dd.StatusProxy",{extend:"Ext.dd.StatusProxy",animRepair:!0,moveEventCls:"ext-cal-dd-move",addEventCls:"ext-cal-dd-add",childEls:["ghost","message"],renderTpl:['<div class="'+Ext.baseCSSPrefix+'dd-drop-icon"></div><div class="ext-dd-ghost-ct"><div id="{id}-ghost" class="'+Ext.baseCSSPrefix+'dd-drag-ghost"></div><div id="{id}-message" class="'+Ext.baseCSSPrefix+'dd-msg"></div></div>'],update:function(e){this.callParent(arguments);var t=this.ghost.dom.firstChild;t&&Ext.fly(t).setHeight("auto")},updateMsg:function(e){this.message.update(e)}}),Ext.define("JE.sys.calendar.dd.DragZone",{extend:"Ext.dd.DragZone",requires:["JE.sys.calendar.dd.StatusProxy"],ddGroup:"CalendarDD",eventSelector:".ext-cal-evt",constructor:function(e,t){JE.sys.calendar._statusProxyInstance||(JE.sys.calendar._statusProxyInstance=new JE.sys.calendar.dd.StatusProxy),this.proxy=JE.sys.calendar._statusProxyInstance,this.callParent(arguments)},getDragData:function(e){var t=e.getTarget(this.eventSelector,3);if(t){var i=this.view.getEventRecordFromEl(t);return{type:"eventdrag",ddel:t,eventStart:JE.DATE.parseDateTime(i.data.CALENDAR_STARTTIME),eventEnd:JE.DATE.parseDateTime(i.data.CALENDAR_ENDTIME),proxy:this.proxy}}return(t=this.view.getDayAt(e.getPageX(),e.getPageY())).el?{type:"caldrag",start:t.date,proxy:this.proxy}:null},onInitDrag:function(e,t){if(this.dragData.ddel){var i=this.dragData.ddel.cloneNode(!0),a=Ext.fly(i).down("dl");Ext.fly(i).setWidth("auto"),a&&a.setHeight("auto"),this.proxy.update(i),this.onStartDrag(e,t)}else this.dragData.start&&this.onStartDrag(e,t);return this.view.onInitDrag(),!0},afterRepair:function(){Ext.enableFx&&this.dragData.ddel&&Ext.fly(this.dragData.ddel).highlight(this.hlColor||"c3daf9"),this.dragging=!1},getRepairXY:function(e){if(this.dragData.ddel)return Ext.fly(this.dragData.ddel).getXY()},afterInvalidDrop:function(e,t){Ext.select(".ext-dd-shim").hide()}}),Ext.define("JE.sys.calendar.dd.DropZone",{extend:"Ext.dd.DropZone",ddGroup:"CalendarDD",eventSelector:".ext-cal-evt",shims:[],getTargetFromEvent:function(e){var t=this.dragOffset||0,i=e.getPageY()-t,a=this.view.getDayAt(e.getPageX(),i);return a.el?a:null},onNodeOver:function(e,t,i,a){var n="eventdrag"==a.type?e.date:JE.DATE.min(a.start,e.date),o="eventdrag"==a.type?JE.DATE.add(e.date,{days:JE.DATE.diffDays(a.eventStart,a.eventEnd)}):JE.DATE.max(a.start,e.date);if(!this.dragStartDate||!this.dragEndDate||0!=JE.DATE.diffDays(n,this.dragStartDate)||0!=JE.DATE.diffDays(o,this.dragEndDate)){this.dragStartDate=n,this.dragEndDate=JE.DATE.add(o,{days:1,millis:-1,clearTime:!0}),this.shim(n,o);var r=Ext.Date.format(n,"n/j");0<JE.DATE.diffDays(n,o)&&(r+="-"+Ext.Date.format(o,"n/j"));var l=Ext.util.Format.format("eventdrag"==a.type?this.moveText:this.createText,r);a.proxy.updateMsg(l)}return this.dropAllowed},shim:function(e,t){this.currWeek=-1,this.DDMInstance.notifyOccluded=!0;var i,a,n=Ext.Date.clone(e),o=0,r=JE.DATE.diffDays(n,t)+1;for(Ext.each(this.shims,function(e){e&&(e.isActive=!1)});o++<r;){var l=this.view.getDayEl(n);if(l){var s=this.view.getWeekIndex(n);(i=this.shims[s])||(i=this.createShim(),this.shims[s]=i),s!=this.currWeek?(i.boxInfo=l.getBox(),this.currWeek=s):(a=l.getBox(),i.boxInfo.right=a.right,i.boxInfo.width=a.right-i.boxInfo.x),i.isActive=!0}n=JE.DATE.add(n,{days:1})}Ext.each(this.shims,function(e){e&&(e.isActive?(e.show(),e.setBox(e.boxInfo)):e.isVisible()&&e.hide())})},createShim:function(){this.shimCt||(this.shimCt=Ext.get("ext-dd-shim-ct"),this.shimCt||(this.shimCt=document.createElement("div"),this.shimCt.id="ext-dd-shim-ct",Ext.getBody().appendChild(this.shimCt)));var e=document.createElement("div");return e.className="ext-dd-shim",this.shimCt.appendChild(e),new Ext.Layer({shadow:!1,useDisplay:!0,constrain:!1},e)},clearShims:function(){Ext.each(this.shims,function(e){e&&e.hide()}),this.DDMInstance.notifyOccluded=!1},onContainerOver:function(e,t,i){return this.dropAllowed},onCalendarDragComplete:function(){delete this.dragStartDate,delete this.dragEndDate,this.clearShims()},onNodeDrop:function(e,t,i,a){if(e&&a){if("eventdrag"==a.type){var n=this.view.getEventRecordFromEl(a.ddel),o=JE.DATE.copyTime(JE.DATE.parseDateTime(n.data.CALENDAR_STARTTIME),e.date);return this.view.onEventDrop(n,o),this.onCalendarDragComplete(),!0}if("caldrag"==a.type)return this.view.onCalendarEndDrag(this.dragStartDate,this.dragEndDate,Ext.bind(this.onCalendarDragComplete,this)),!0}return this.onCalendarDragComplete(),!1},onContainerDrop:function(e,t,i){return this.onCalendarDragComplete(),!1}}),Ext.define("JE.sys.calendar.dd.DayDragZone",{extend:"JE.sys.calendar.dd.DragZone",ddGroup:"DayViewDD",resizeSelector:".ext-evt-rsz",getDragData:function(e){var t,i,a=e.getTarget(this.resizeSelector,2,!0);return a?(t=a.parent(this.eventSelector),i=this.view.getEventRecordFromEl(t),{type:"eventresize",ddel:t.dom,eventStart:JE.DATE.parseDateTime(i.data.CALENDAR_STARTTIME),eventEnd:JE.DATE.parseDateTime(i.data.CALENDAR_ENDTIME),proxy:this.proxy}):(a=e.getTarget(this.eventSelector,3))?(i=this.view.getEventRecordFromEl(a),{type:"eventdrag",ddel:a,eventStart:JE.DATE.parseDateTime(i.data.CALENDAR_STARTTIME),eventEnd:JE.DATE.parseDateTime(i.data.CALENDAR_ENDTIME),proxy:this.proxy}):(a=this.view.getDayAt(e.getPageX(),e.getPageY())).el?{type:"caldrag",dayInfo:a,proxy:this.proxy}:null},onBeforeDrag:function(e,t){if(!t.getTarget(".ext-cal-day-col-gutter"))return!1}}),Ext.define("JE.sys.calendar.dd.DayDropZone",{extend:"JE.sys.calendar.dd.DropZone",ddGroup:"DayViewDD",onNodeOver:function(e,t,i,a){var n=i.getTarget(".ext-cal-day-col-gutter"),o=i.getTarget(".ext-dd-shim");if(!n&&!o)return this.dropNotAllowed;var r,l,s,d,c,u,p,f,E=this.createText;return"caldrag"==a.type?(this.dragStartMarker||(this.dragStartMarker=e.el.parent().createChild({style:"position:absolute;"}),this.dragStartMarker.setBox(e.timeBox),this.dragCreateDt=e.date),(l=this.dragStartMarker.getBox()).height=Math.ceil(Math.abs(i.xy[1]-l.y)/e.timeBox.height)*e.timeBox.height,i.xy[1]<l.y?(l.height+=e.timeBox.height,l.y=l.y-l.height+e.timeBox.height,s=Ext.Date.add(this.dragCreateDt,Ext.Date.MINUTE,30)):e.date=Ext.Date.add(e.date,Ext.Date.MINUTE,30),this.shim(this.dragCreateDt,l),d=JE.DATE.copyTime(e.date,this.dragCreateDt),this.dragStartDate=JE.DATE.min(this.dragCreateDt,d),this.dragEndDate=s||JE.DATE.max(this.dragCreateDt,d),r=Ext.Date.format(this.dragStartDate,"g:ia-")+Ext.Date.format(this.dragEndDate,"g:ia")):(f=(p=Ext.get(a.ddel)).parent().parent(),(l=p.getBox()).width=f.getWidth(),"eventdrag"==a.type&&(void 0===this.dragOffset?(this.dragOffset=e.timeBox.y-l.y,l.y=e.timeBox.y-this.dragOffset):l.y=e.timeBox.y,r=Ext.Date.format(e.date,"n/j g:ia"),l.x=e.el.getX(),this.shim(e.date,l),E=this.moveText),"eventresize"==a.type&&(this.resizeDt||(this.resizeDt=e.date),l.x=f.getX(),l.height=Math.ceil(Math.abs(i.xy[1]-l.y)/e.timeBox.height)*e.timeBox.height,i.xy[1]<l.y?l.y-=l.height:e.date=Ext.Date.add(e.date,Ext.Date.MINUTE,30),this.shim(this.resizeDt,l),d=JE.DATE.copyTime(e.date,this.resizeDt),c=JE.DATE.min(a.eventStart,d),u=JE.DATE.max(a.eventStart,d),a.resizeDates={StartDate:c,EndDate:u},r=Ext.Date.format(c,"g:ia-")+Ext.Date.format(u,"g:ia"),E=this.resizeText)),a.proxy.updateMsg(Ext.util.Format.format(E,r)),this.dropAllowed},shim:function(e,t){Ext.each(this.shims,function(e){e&&(e.isActive=!1,e.hide())});var i=this.shims[0];i||(i=this.createShim(),this.shims[0]=i),i.isActive=!0,i.show(),i.setBox(t),this.DDMInstance.notifyOccluded=!0},onNodeDrop:function(e,t,i,a){var n;if(e&&a){if("eventdrag"==a.type)return n=this.view.getEventRecordFromEl(a.ddel),this.view.onEventDrop(n,e.date),this.onCalendarDragComplete(),delete this.dragOffset,!0;if("eventresize"==a.type)return n=this.view.getEventRecordFromEl(a.ddel),this.view.onEventResize(n,a.resizeDates),this.onCalendarDragComplete(),delete this.resizeDt,!0;if("caldrag"==a.type)return Ext.destroy(this.dragStartMarker),delete this.dragStartMarker,delete this.dragCreateDt,this.view.onCalendarEndDrag(this.dragStartDate,this.dragEndDate,Ext.bind(this.onCalendarDragComplete,this)),!0}return this.onCalendarDragComplete(),!1}}),Ext.define("JE.sys.calendar.template.BoxLayout",{extend:"Ext.XTemplate",constructor:function(e){Ext.apply(this,e);var t=this.showWeekLinks?'<div id="{weekLinkId}" class="ext-cal-week-link">{weekNum}</div>':"";this.callParent(['<tpl for="weeks">','<div id="{[this.id]}-wk-{[xindex-1]}" class="ext-cal-wk-ct" style="top:{[this.getRowTop(xindex, xcount)]}%; height:{[this.getRowHeight(xcount)]}%;">',t,'<table class="ext-cal-bg-tbl" cellpadding="0" cellspacing="0">',"<tbody>","<tr>",'<tpl for=".">','<td id="{[this.id]}-day-{date:date("Ymd")}" class="{cellCls}">&#160;</td>',"</tpl>","</tr>","</tbody>","</table>",'<table class="ext-cal-evt-tbl" cellpadding="0" cellspacing="0">',"<tbody>","<tr>",'<tpl for=".">','<td id="{[this.id]}-ev-day-{date:date("Ymd")}" class="{titleCls}"><div>{title}</div></td>',"</tpl>","</tr>","</tbody>","</table>","</div>","</tpl>",{getRowTop:function(e,t){return 100/t*(e-1)},getRowHeight:function(e){return 100/e}}])},applyTemplate:function(e){Ext.apply(this,e);for(var t=0,i="",a=!0,n=!1,o=!1,r=!1,l=!1,s=[[]],d=Ext.Date.clone(this.viewStart),c=this.startDate.getMonth();(t<this.weekCount||-1==this.weekCount)&&!(d>this.viewEnd);t++){s[t]=[];for(var u=0;u<this.dayCount;u++){if(n=d.getTime()===JE.DATE.today().getTime(),o=a||1==d.getDate(),r=d.getMonth()<c&&-1==this.weekCount,l=d.getMonth()>c&&-1==this.weekCount,1==d.getDay()&&(s[t].weekNum=this.showWeekNumbers?Ext.Date.format(d,"W"):"&#160;",s[t].weekLinkId="ext-cal-week-"+Ext.Date.format(d,"Ymd")),o)i=n?this.getTodayText():Ext.Date.format(d,1==this.dayCount?"Y年m月j日 l":a?"Y年m月j日":"m月j日");else{var p=0==t&&!0!==this.showHeader?"j日 D":"j日";i=n?this.getTodayText():Ext.Date.format(d,p)}s[t].push({title:i,date:Ext.Date.clone(d),titleCls:"ext-cal-dtitle "+(n?" ext-cal-dtitle-today":"")+(0==t?" ext-cal-dtitle-first":"")+(r?" ext-cal-dtitle-prev":"")+(l?" ext-cal-dtitle-next":""),cellCls:"ext-cal-day "+(n?" ext-cal-day-today":"")+(0==u?" ext-cal-day-first":"")+(r?" ext-cal-day-prev":"")+(l?" ext-cal-day-next":"")}),d=JE.DATE.add(d,{days:1}),a=!1}}return this.applyOut({weeks:s},[]).join("")},getTodayText:function(){var e,t=Ext.Date.format(new Date,"Y年m月j日 l"),i=!1!==this.showTodayText?this.todayText:"",a=!1!==this.showTime?' <span id="'+this.id+'-clock" class="ext-cal-dtitle-time">'+Ext.Date.format(new Date,"g:i a")+"</span>":"",n=0<i.length||0<a.length?" &mdash; ":"";return 1==this.dayCount?t+n+i+a:(e=1==this.weekCount?"j日 D":"j日",0<i.length?i+a:Ext.Date.format(new Date,e)+a)}},function(){this.createAlias("apply","applyTemplate")}),Ext.define("JE.sys.calendar.template.DayBody",{extend:"Ext.XTemplate",constructor:function(e){Ext.apply(this,e),this.callParent(['<table class="ext-cal-bg-tbl" cellspacing="0" cellpadding="0"  style = "height:{[values.times.length*42]}px;">',"<tbody>",'<tr height="1">','<td class="ext-cal-gutter"></td>','<td colspan="{dayCount}">','<div class="ext-cal-bg-rows">','<div class="ext-cal-bg-rows-inner">','<tpl for="times">','<div class="ext-cal-bg-row">','<div class="ext-cal-bg-row-div ext-row-{[xindex]}"></div>',"</div>","</tpl>","</div>","</div>","</td>","</tr>","<tr>",'<td class="ext-cal-day-times">','<tpl for="times">','<div class="ext-cal-bg-row">','<div class="ext-cal-day-time-inner">{.}</div>',"</div>","</tpl>","</td>",'<tpl for="days">','<td class="ext-cal-day-col">','<div class="ext-cal-day-col-inner">','<div id="{[this.id]}-day-col-{.:date("Ymd")}" class="ext-cal-day-col-gutter" style = "height:{[parent.times.length*42]}px;"></div>',"</div>","</td>","</tpl>","</tr>","</tbody>","</table>"])},applyTemplate:function(e){this.today=JE.DATE.today(),this.dayCount=this.dayCount||1;for(var t=0,i=[],a=Ext.Date.clone(e.viewStart),n=[];t<this.dayCount;t++)i[t]=JE.DATE.add(a,{days:t});a=Ext.Date.clearTime(new Date("5/26/1972"));var o=Ext.value(this.startHours,0),r=Ext.value(this.endHours,24);for(a=JE.DATE.add(a,{hours:o}),t=o;t<r;t++)n.push(Ext.Date.format(a,"H:i")),a=JE.DATE.add(a,{hours:1});return this.applyOut({days:i,dayCount:i.length,times:n},[]).join("")},apply:function(e){return this.applyTemplate.apply(this,arguments)}}),Ext.define("JE.sys.calendar.template.DayHeader",{extend:"Ext.XTemplate",requires:["JE.sys.calendar.template.BoxLayout"],constructor:function(e){Ext.apply(this,e),this.allDayTpl=new JE.sys.calendar.template.BoxLayout(e),this.allDayTpl.compile(),this.callParent(['<div class="ext-cal-hd-ct">','<table class="ext-cal-hd-days-tbl" cellspacing="0" cellpadding="0">',"<tbody>","<tr>",'<td class="ext-cal-gutter"></td>','<td class="ext-cal-hd-days-td"><div class="ext-cal-hd-ad-inner">{allDayTpl}</div></td>','<td class="ext-cal-gutter-rt"></td>',"</tr>","</tobdy>","</table>","</div>"])},applyTemplate:function(e){return this.applyOut({allDayTpl:this.allDayTpl.apply(e)},[]).join("")},apply:function(e){return this.applyTemplate.apply(this,arguments)}}),Ext.define("JE.sys.calendar.template.Month",{extend:"Ext.XTemplate",requires:["JE.sys.calendar.template.BoxLayout"],constructor:function(e){Ext.apply(this,e),this.weekTpl=new JE.sys.calendar.template.BoxLayout(e),this.weekTpl.compile();var t=this.showWeekLinks?'<div class="ext-cal-week-link-hd">&#160;</div>':"";this.callParent(['<div class="ext-cal-inner-ct {extraClasses}">','<div class="ext-cal-hd-ct ext-cal-month-hd">',t,'<table class="ext-cal-hd-days-tbl" cellpadding="0" cellspacing="0">',"<tbody>","<tr>",'<tpl for="days">','<th class="ext-cal-hd-day{[xindex==1 ? " ext-cal-day-first" : ""]}" title="{.:date("l, F j, Y")}">{.:date("D")}</th>',"</tpl>","</tr>","</tbody>","</table>","</div>",'<div class="ext-cal-body-ct">{weeks}</div>',"</div>"])},applyTemplate:function(e){for(var t=[],i=this.weekTpl.apply(e),a=e.viewStart,n=0;n<7;n++)t.push(JE.DATE.add(a,{days:n}));var o=!0===this.showHeader?"":"ext-cal-noheader";return this.showWeekLinks&&(o+=" ext-cal-week-links"),this.applyOut({days:t,weeks:i,extraClasses:o},[]).join("")},apply:function(e){return this.applyTemplate.apply(this,arguments)}}),Ext.define("JE.sys.calendar.view.AbstractCalendar",{extend:"Ext.Component",alias:"widget.calendar.calendarview",startDay:0,spansHavePriority:!1,trackMouseOver:!0,enableFx:!0,enableAddFx:!0,enableUpdateFx:!1,enableRemoveFx:!0,enableDD:!0,monitorResize:!0,weekCount:1,dayCount:1,eventSelector:".ext-cal-evt",eventOverClass:"ext-evt-over",eventElIdDelimiter:"-evt-",dayElIdDelimiter:"-day-",getEventBodyMarkup:Ext.emptyFn,getEventTemplate:Ext.emptyFn,initComponent:function(){this.localLang=JE.getLocalLang("sys.calendar.text"),Ext.apply(this,{ddCreateEventText:this.localLang.ddCreateEventText,ddMoveEventText:this.localLang.ddMoveEventText,ddResizeEventText:this.localLang.ddResizeEventText}),this.setStartDate(this.startDate||new Date,!1,"calendar.monthview"!=this.xtype),this.callParent(arguments),this.addEvents({eventsrendered:!0,eventclick:!0,eventover:!0,eventout:!0,datechange:!0,rangeselect:!0,eventmove:!0,initdrag:!0,dayover:!0,dayout:!0})},afterRender:function(){this.callParent(arguments),this.renderTemplate(),this.store&&this.setStore(this.store,!0),this.el.on({mouseover:this.onMouseOver,mouseout:this.onMouseOut,click:this.onClick,scope:this}),this.el.unselectable(),this.enableDD&&this.initDD&&this.initDD(),this.on("eventsrendered",this.forceSize),Ext.defer(this.forceSize,100,this)},forceSize:function(){if(this.el&&this.el.down){var e=this.el.down(".ext-cal-hd-ct"),t=this.el.down(".ext-cal-body-ct");if(null==t||null==e)return;var i=e.getHeight(),a=this.el.parent().getSize();t.setHeight(a.height-i)}},refresh:function(){this.prepareData(),this.renderTemplate(),this.renderItems()},getWeekCount:function(){var e=JE.DATE.diffDays(this.viewStart,this.viewEnd);return Math.ceil(e/this.dayCount)},prepareData:function(){var a,e=Ext.Date.getLastDateOfMonth(this.startDate),n=0,o=Ext.Date.clone(this.viewStart),t=this.weekCount<1?6:this.weekCount;this.eventGrid=[[]],this.allDayGrid=[[]],this.evtMaxCount=[];for(var i=this.store.queryBy(function(e){return this.isEventVisible(e.data)},this);n<t&&(this.evtMaxCount[n]=0,!(-1==this.weekCount&&e<o));n++)for(this.eventGrid[n]=this.eventGrid[n]||[],this.allDayGrid[n]=this.allDayGrid[n]||[],a=0;a<this.dayCount;a++){if(0<i.getCount()){var r=i.filterBy(function(e){var t=JE.DATE.parseDateTime(e.data.CALENDAR_STARTTIME),i=Ext.Date.clearTime(t,!0);return o.getTime()==i.getTime()||0==n&&0==a&&t<o},this);this.sortEventRecordsForDay(r),this.prepareEventGrid(r,n,a)}o=JE.DATE.add(o,{days:1})}this.currentWeekCount=n},prepareEventGrid:function(e,n,o){var r=this,l=0,s=r.maxEventsPerDay?r.maxEventsPerDay:999;e.each(function(e){var t=JE.DATE.parseDateTime(e.data.CALENDAR_STARTTIME),i=JE.DATE.parseDateTime(e.data.CALENDAR_ENDTIME),a=JE.DATE.diffDays(JE.DATE.max(r.viewStart,t),JE.DATE.min(r.viewEnd,i))+1;return 1<a||1<JE.DATE.diffDays(t,i)?(r.prepareEventGridSpans(e,r.eventGrid,n,o,a),r.prepareEventGridSpans(e,r.allDayGrid,n,o,a,!0)):(l=r.findEmptyRowIndex(n,o),r.eventGrid[n][o]=r.eventGrid[n][o]||[],"1"==(r.eventGrid[n][o][l]=e).data.CALENDAR_YESORNO_CODE&&(l=r.findEmptyRowIndex(n,o,!0),r.allDayGrid[n][o]=r.allDayGrid[n][o]||[],r.allDayGrid[n][o][l]=e)),r.evtMaxCount[n]<r.eventGrid[n][o].length&&(r.evtMaxCount[n]=Math.min(s+1,r.eventGrid[n][o].length)),!0})},prepareEventGridSpans:function(e,t,i,a,n,o){var r=i,l=a,s=this.findEmptyRowIndex(i,a,o),d=Ext.Date.clone(this.viewStart),c={event:e,isSpan:!0,isSpanStart:!0,spanLeft:!1,spanRight:6==a};for(t[i][a]=t[i][a]||[],t[i][a][s]=c;--n&&!((d=JE.DATE.add(d,{days:1}))>this.viewEnd);)6<++l&&(l=0,r++,s=this.findEmptyRowIndex(r,0)),t[r]=t[r]||[],t[r][l]=t[r][l]||[],t[r][l][s]={event:e,isSpan:!0,isSpanStart:0==l,spanLeft:i<r&&l%7==0,spanRight:6==l&&1<n}},findEmptyRowIndex:function(e,t,i){for(var a=i?this.allDayGrid:this.eventGrid,n=a[e]&&a[e][t]||[],o=0,r=n.length;o<r;o++)if(null==n[o])return o;return r},renderTemplate:function(){this.tpl&&(this.tpl.overwrite(this.el,this.getParams()),this.lastRenderStart=Ext.Date.clone(this.viewStart),this.lastRenderEnd=Ext.Date.clone(this.viewEnd))},disableStoreEvents:function(){this.monitorStoreEvents=!1},enableStoreEvents:function(e){(this.monitorStoreEvents=!0)===e&&this.refresh()},onResize:function(){this.callParent(arguments),this.refresh()},onInitDrag:function(){this.fireEvent("initdrag",this)},onEventDrop:function(e,t){var i=JE.DATE.parseDateTime(e.data.CALENDAR_STARTTIME),a=JE.DATE.parseDateTime(e.data.CALENDAR_ENDTIME);if(0!==JE.DATE.compare(i,t)){var n=t.getTime()-i.getTime();e.set("CALENDAR_STARTTIME",JE.DATE.formatDateTime(t)),e.set("CALENDAR_ENDTIME",JE.DATE.formatDateTime(JE.DATE.add(a,{millis:n}))),this.fireEvent("eventmove",this,e)}},onCalendarEndDrag:function(e,t,i){if(e&&t){this.dragPending=!0;var a={},n=1*Ext.value(JE.systemConfig.JE_CALENDAR_WORKBEGINTIMEAM,"8"),o=1*Ext.value(JE.systemConfig.JE_CALENDAR_WORKENDTIMEPM,"16"),r="calendar.daybodyview"!=this.xtype;r&&(e.setHours(n),t.setHours(o)),a.CALENDAR_STARTTIME=JE.DATE.formatDateTime(e),a.CALENDAR_ENDTIME=JE.DATE.formatDateTime(t),a.CALENDAR_YESORNO_CODE=r?"1":"0",a.CALENDAR_YESORNO_NAME=r?"是":"否",this.fireEvent("rangeselect",this,a,Ext.bind(this.onCalendarEndDragComplete,this,[i]))}},onCalendarEndDragComplete:function(e){e(),this.dragPending=!1},onUpdate:function(e,t,i){!1!==this.monitorStoreEvents&&i==Ext.data.Record.COMMIT&&(this.refresh(),this.enableFx&&this.enableUpdateFx&&this.doUpdateFx(this.getEventEls(t.data.JE_SYS_CALENDAR_ID),{scope:this}))},doUpdateFx:function(e,t){this.highlightEvent(e,null,t)},onAdd:function(e,t,i){if(!1!==this.monitorStoreEvents){var a=t[0];this.tempEventId=a.id,this.refresh(),this.enableFx&&this.enableAddFx&&this.doAddFx(this.getEventEls(a.data.JE_SYS_CALENDAR_ID),{scope:this})}},doAddFx:function(e,t){e.fadeIn(Ext.apply(t,{duration:2e3}))},onRemove:function(e,t){!1!==this.monitorStoreEvents&&(this.enableFx&&this.enableRemoveFx?this.doRemoveFx(this.getEventEls(t.data.JE_SYS_CALENDAR_ID),{remove:!0,scope:this,callback:this.refresh}):(this.getEventEls(t.data.JE_SYS_CALENDAR_ID).remove(),this.refresh()))},doRemoveFx:function(e,t){e.fadeOut(t)},highlightEvent:function(e,t,i){var a;this.enableFx&&(Ext.isIE||Ext.isOpera?e.each(function(e){e.highlight(t,Ext.applyIf({attr:"color"},i)),(a=e.down(".ext-cal-evm"))&&a.highlight(t,i)},this):e.highlight(t,i))},getEventIdFromEl:function(e){var t=(e=Ext.get(e)).id.split(this.eventElIdDelimiter)[1],i=t.lastIndexOf("-");return-1<i&&(t=t.substr(0,i)),t},getEventId:function(e){return void 0===e&&this.tempEventId&&(e=this.tempEventId),e},getEventSelectorCls:function(e,t){return(t?".":"")+this.id+this.eventElIdDelimiter+this.getEventId(e)},getEventEls:function(e){var t=Ext.select(this.getEventSelectorCls(this.getEventId(e),!0),!1,this.el.dom);return new Ext.CompositeElement(t)},isToday:function(){var e=Ext.Date.clearTime(new Date).getTime();return this.viewStart.getTime()<=e&&this.viewEnd.getTime()>=e},onDataChanged:function(e){this.refresh()},isEventVisible:function(e){var t=e.data||e,i=this.viewStart.getTime(),a=this.viewEnd.getTime(),n=JE.DATE.parseDateTime(t.CALENDAR_STARTTIME),o=JE.DATE.parseDateTime(t.CALENDAR_ENDTIME),r=n.getTime(),l=o.getTime();return l=JE.DATE.add(o,{seconds:-1}).getTime(),this.rangesOverlap(i,a,r,l)},rangesOverlap:function(e,t,i,a){return i<=e&&e<=a||i<=t&&t<=a||e<=i&&a<=t},isOverlapping:function(e,t){var i=e.data?e.data:e,a=t.data?t.data:t,n=JE.DATE.parseDateTime(i.CALENDAR_STARTTIME),o=JE.DATE.parseDateTime(i.CALENDAR_ENDTIME),r=JE.DATE.parseDateTime(a.CALENDAR_STARTTIME),l=JE.DATE.parseDateTime(a.CALENDAR_ENDTIME),s=n.getTime(),d=JE.DATE.add(o,{seconds:-1}).getTime(),c=r.getTime(),u=JE.DATE.add(l,{seconds:-1}).getTime();return d<s&&(d=s),u<c&&(u=c),s<=u&&c<=d},getDayEl:function(e){return Ext.get(this.getDayId(e))},getDayId:function(e){return Ext.isDate(e)&&(e=Ext.Date.format(e,"Ymd")),this.id+this.dayElIdDelimiter+e},getStartDate:function(){return this.startDate},setStartDate:function(e,t,i){this.startDate=Ext.Date.clearTime(e),this.setViewBounds(e),this.store.proxy.extraParams.whereSql=" AND CALENDAR_STARTTIME>='"+JE.DATE.formatDateTime(this.viewStart)+"' AND CALENDAR_ENDTIME<='"+JE.DATE.formatDateTime(this.viewEnd)+"'",1!=i&&this.store.load(),!0===t&&this.refresh(),this.fireEvent("datechange",this,this.startDate,this.viewStart,this.viewEnd)},setViewBounds:function(e){var t=e||this.startDate,i=t.getDay()-this.startDay;switch(this.weekCount){case 0:case 1:return this.viewStart=this.dayCount<7?t:JE.DATE.add(t,{days:-i,clearTime:!0}),this.viewEnd=JE.DATE.add(this.viewStart,{days:this.dayCount||7}),void(this.viewEnd=JE.DATE.add(this.viewEnd,{seconds:-1}));case-1:i=(t=Ext.Date.getFirstDateOfMonth(t)).getDay()-this.startDay,this.viewStart=JE.DATE.add(t,{days:-i,clearTime:!0});var a=JE.DATE.add(t,{months:1,seconds:-1});return void(this.viewEnd=JE.DATE.add(a,{days:6-a.getDay()}));default:this.viewStart=JE.DATE.add(t,{days:-i,clearTime:!0}),this.viewEnd=JE.DATE.add(this.viewStart,{days:7*this.weekCount,seconds:-1})}},getViewBounds:function(){return{start:this.viewStart,end:this.viewEnd}},sortEventRecordsForDay:function(e){e.length<2||e.sortBy(Ext.bind(function(e,t){var i=e.data,a=t.data;if("1"==i.CALENDAR_YESORNO_CODE)return-1;if("1"==a.CALENDAR_YESORNO_CODE)return 1;var n=JE.DATE.parseDateTime(i.CALENDAR_STARTTIME),o=JE.DATE.parseDateTime(i.CALENDAR_ENDTIME),r=JE.DATE.parseDateTime(a.CALENDAR_STARTTIME),l=JE.DATE.parseDateTime(a.CALENDAR_ENDTIME);return this.spansHavePriority?0<JE.DATE.diffDays(n,o)?0<JE.DATE.diffDays(r,l)?n.getTime()==r.getTime()?l.getTime()-o.getTime():n.getTime()-r.getTime():-1:0<JE.DATE.diffDays(r,l)?1:n.getTime()-r.getTime():n.getTime()-r.getTime()},this))},moveTo:function(e,t){return Ext.isDate(e)?(this.setStartDate(e),!1!==t&&this.refresh(),this.startDate):e},moveNext:function(e){return this.moveTo(JE.DATE.add(this.viewEnd,{days:1}))},movePrev:function(e){var t=JE.DATE.diffDays(this.viewStart,this.viewEnd)+1;return this.moveDays(-t,e)},moveMonths:function(e,t){return this.moveTo(JE.DATE.add(this.startDate,{months:e}),t)},moveWeeks:function(e,t){return this.moveTo(JE.DATE.add(this.startDate,{days:7*e}),t)},moveDays:function(e,t){return this.moveTo(JE.DATE.add(this.startDate,{days:e}),t)},moveToday:function(e){return this.moveTo(new Date,e)},setStore:function(e,t){!t&&this.store&&(this.store.un("datachanged",this.onDataChanged,this),this.store.un("add",this.onAdd,this),this.store.un("remove",this.onRemove,this),this.store.un("update",this.onUpdate,this),this.store.un("clear",this.refresh,this)),e&&(e.on("datachanged",this.onDataChanged,this),e.on("add",this.onAdd,this),e.on("remove",this.onRemove,this),e.on("update",this.onUpdate,this),e.on("clear",this.refresh,this)),(this.store=e)&&0<e.getCount()&&this.refresh()},getEventRecord:function(e){var t=this.store.find("JE_SYS_CALENDAR_ID",e);return this.store.getAt(t)},getEventRecordFromEl:function(e){return this.getEventRecord(this.getEventIdFromEl(e))},getParams:function(){return{viewStart:this.viewStart,viewEnd:this.viewEnd,startDate:this.startDate,dayCount:this.dayCount,weekCount:this.weekCount,title:this.getTitle()}},getTitle:function(){return Ext.Date.format(this.startDate,"F Y")},onClick:function(e,t){var i=e.getTarget(this.eventSelector,5);if(i){var a=this.getEventIdFromEl(i);return this.fireEvent("eventclick",this,this.getEventRecord(a),i),!0}},onMouseOver:function(e,t){!1===this.trackMouseOver||null!=this.dragZone&&this.dragZone.dragging||this.handleEventMouseEvent(e,t,"over")||this.handleDayMouseEvent(e,t,"over")},onMouseOut:function(e,t){!1===this.trackMouseOver||null!=this.dragZone&&this.dragZone.dragging||this.handleEventMouseEvent(e,t,"out")||this.handleDayMouseEvent(e,t,"out")},handleEventMouseEvent:function(e,t,i){var a,n,o=e.getTarget(this.eventSelector,5,!0);return!!o&&(o==(a=Ext.get(e.getRelatedTarget()))||o.contains(a)||(n=this.getEventIdFromEl(o),this.eventOverClass&&this.getEventEls(n)["over"==i?"addCls":"removeCls"](this.eventOverClass),this.fireEvent("event"+i,this,this.getEventRecord(n),o)),!0)},getDateFromId:function(e,t){var i=e.split(t);return i[i.length-1]},handleDayMouseEvent:function(e,t,i){if((t=e.getTarget("td",3))&&t.id&&-1<t.id.indexOf(this.dayElIdDelimiter)){var a,n,o=this.getDateFromId(t.id,this.dayElIdDelimiter),r=Ext.get(e.getRelatedTarget());if(r&&(n=(a=r.is("td")?r:r.up("td",3))&&a.id?this.getDateFromId(a.id,this.dayElIdDelimiter):""),!r||o!=n){var l=this.getDayEl(o);l&&""!=this.dayOverClass&&l["over"==i?"addCls":"removeCls"](this.dayOverClass),this.fireEvent("day"+i,this,Ext.Date.parse(o,"Ymd"),l)}}},renderItems:function(){throw"This method must be implemented by a subclass"},destroy:function(){this.callParent(arguments),this.el&&this.el.un("contextmenu",this.onContextMenu,this),Ext.destroy(this.editWin,this.eventMenu,this.dragZone,this.dropZone)}}),Ext.define("JE.sys.calendar.view.Month",{extend:"JE.sys.calendar.view.AbstractCalendar",alias:"widget.calendar.monthview",requires:["JE.sys.calendar.template.Month"],showTime:!0,showTodayText:!0,todayText:"Today",showHeader:!1,showWeekLinks:!1,showWeekNumbers:!1,weekLinkOverClass:"ext-week-link-over",daySelector:".ext-cal-day",moreSelector:".ext-cal-ev-more",weekLinkSelector:".ext-cal-week-link",weekCount:-1,dayCount:7,moreElIdDelimiter:"-more-",weekLinkIdDelimiter:"ext-cal-week-",initComponent:function(){this.callParent(arguments),this.addEvents({dayclick:!0,weekclick:!0,dayover:!0,dayout:!0})},initDD:function(){var e={view:this,createText:this.ddCreateEventText,moveText:this.ddMoveEventText,ddGroup:"MonthViewDD"};this.dragZone=new JE.sys.calendar.dd.DragZone(this.el,e),this.dropZone=new JE.sys.calendar.dd.DropZone(this.el,e)},onDestroy:function(){Ext.destroy(this.ddSelector),Ext.destroy(this.dragZone),Ext.destroy(this.dropZone),this.callParent(arguments)},afterRender:function(){this.tpl||(this.tpl=new JE.sys.calendar.template.Month({id:this.id,showTodayText:this.showTodayText,todayText:this.todayText,showTime:this.showTime,showHeader:this.showHeader,showWeekLinks:this.showWeekLinks,showWeekNumbers:this.showWeekNumbers})),this.tpl.compile(),this.addCls("ext-cal-monthview ext-cal-ct"),this.callParent(arguments)},onResize:function(){this.callParent(arguments),this.maxEventsPerDay=this.getMaxEventsPerDay(),this.monitorResize&&this.refresh()},forceSize:function(){if(this.showWeekLinks&&this.el){var e=this.el.down(".ext-cal-hd-days-tbl"),t=this.el.select(".ext-cal-bg-tbl"),i=this.el.select(".ext-cal-evt-tbl"),a=this.el.down(".ext-cal-week-link").getWidth(),n=this.el.getWidth()-a;e.setWidth(n),t.setWidth(n),i.setWidth(n)}this.callParent(arguments)},initClock:function(){null!==Ext.fly(this.id+"-clock")&&(this.prevClockDay=(new Date).getDay(),this.clockTask&&Ext.TaskManager.stop(this.clockTask),this.clockTask=Ext.TaskManager.start({run:function(){var e=Ext.fly(this.id+"-clock"),t=new Date;t.getDay()==this.prevClockDay?e&&e.update(Ext.Date.format(t,"g:i a")):(this.prevClockDay=t.getDay(),this.moveTo(t))},scope:this,interval:1e3}))},getEventBodyMarkup:function(){return this.eventBodyMarkup||(this.eventBodyMarkup=["{Title}",'<tpl if="_isReminder">','<i class="ext-cal-ic ext-cal-ic-rem">&#160;</i>',"</tpl>",'<tpl if="_isRecurring">','<i class="ext-cal-ic ext-cal-ic-rcr">&#160;</i>',"</tpl>",'<tpl if="spanLeft">','<i class="ext-cal-spl">&#160;</i>',"</tpl>",'<tpl if="spanRight">','<i class="ext-cal-spr">&#160;</i>',"</tpl>"].join("")),this.eventBodyMarkup},getEventTemplate:function(){if(!this.eventTpl){var e,t=this.getEventBodyMarkup();(e=Ext.isIE||Ext.isOpera?new Ext.XTemplate('<tpl if="_renderAsAllDay">','<div id="{_elId}" class="{_selectorCls} {spanCls} {_colorCls} ext-cal-evt ext-cal-evo">','<div class="ext-cal-evm">','<div class="ext-cal-evi">',"</tpl>",'<tpl if="!_renderAsAllDay">','<div id="{_elId}" class="{_selectorCls} {_colorCls} ext-cal-evt ext-cal-evr">',"</tpl>",t,'<tpl if="_renderAsAllDay">',"</div>","</div>","</tpl>","</div>"):new Ext.XTemplate('<div id="{_elId}" class="{_selectorCls} {_colorCls} {spanCls} ext-cal-evt ext-cal-evr">',t,"</div>")).compile(),this.eventTpl=e}return this.eventTpl},getTemplateEventData:function(e){var t=this.getEventSelectorCls(e.JE_SYS_CALENDAR_ID),i=e.CALENDAR_TITLE,a=JE.DATE.parseDateTime(e.CALENDAR_STARTTIME);i='<font color="'+Ext.value(e.CALENDAR_GROUPCOLOR,"#FFF")+'">'+(i&&0!=i.length?i:"(No title)")+"</font>";return Ext.isEmpty(e.CALENDAR_GROUPCOLOR)&&(i=i&&0!=i.length?i:"(No title)"),Ext.applyIf({_selectorCls:t,_colorCls:"ext-color-"+(e.CALENDAR_CALENDARTYPE_CODE?e.CALENDAR_CALENDARTYPE_CODE:"default")+(e._renderAsAllDay?"-ad":"-noad"),_elId:t+"-"+e._weekIndex,_isRecurring:e.Recurrence&&""!=e.Recurrence,_isReminder:0<=1*e.CALENDAR_REMINDER_CODE,Title:("1"==e.CALENDAR_YESORNO_CODE?"":Ext.Date.format(a,"H:i "))+i},e)},refresh:function(){this.detailPanel&&this.detailPanel.hide(),this.callParent(arguments),!1!==this.showTime&&this.initClock()},renderItems:function(){this.renderData({eventGrid:this.allDayOnly?this.allDayGrid:this.eventGrid,viewStart:this.viewStart,tpl:this.getEventTemplate(),maxEventsPerDay:this.maxEventsPerDay,id:this.id,maxEventsDayHeader:this.maxEventsDayHeader,templateDataFn:Ext.bind(this.getTemplateEventData,this),evtMaxCount:this.evtMaxCount,weekCount:this.weekCount,dayCount:this.dayCount}),this.fireEvent("eventsrendered",this)},getDayEl:function(e){return Ext.get(this.getDayId(e))},getDayId:function(e){return Ext.isDate(e)&&(e=Ext.Date.format(e,"Ymd")),this.id+this.dayElIdDelimiter+e},getWeekIndex:function(e){var t=this.getDayEl(e).up(".ext-cal-wk-ct");return parseInt(t.id.split("-wk-")[1],10)},getDaySize:function(e){var t=this.el.down(this.daySelector).getBox(),i=t.width,a=t.height;if(e){var n=this.el.select(".ext-cal-dtitle").first().parent("tr");a=n?a-n.getHeight(!0):a}return{height:a,width:i}},getEventHeight:function(){if(!this.eventHeight){var e=this.el.down(".ext-cal-evt");this.eventHeight=e?e.parent("tr").getHeight():18,(e=this.el.down(".ext-cal-evr"))&&(this.eventHeight=Math.max(this.eventHeight,e?e.parent("tr").getHeight():18))}return this.eventHeight},getMaxEventsPerDay:function(){var e=this.getDaySize(!0).height,t=this.getEventHeight();return Math.max(Math.floor((e-t)/t),0)},getDayAt:function(e,t){var i=this.el.getBox(),a=this.getDaySize(),n=Math.floor((e-i.x)/a.width),o=7*Math.floor((t-i.y)/a.height)+n,r=JE.DATE.add(this.viewStart,{days:o});return{date:r,el:this.getDayEl(r)}},moveNext:function(){return this.moveMonths(1)},movePrev:function(){return this.moveMonths(-1)},onInitDrag:function(){this.callParent(arguments),this.dayOverClass&&Ext.select(this.daySelector).removeCls(this.dayOverClass),this.detailPanel&&this.detailPanel.hide()},onMoreClick:function(e){this.detailPanel?this.detailPanel.setTitle(Ext.Date.format(e,"F j")):this.detailPanel=Ext.create("Ext.Panel",{id:this.id+"-details-panel",title:Ext.Date.format(e,"F j"),layout:"fit",floating:!0,renderTo:Ext.getBody(),tools:[{type:"close",handler:function(e,t,i){i.ownerCt.hide()}}],items:{xtype:"calendar.monthdaydetailview",id:this.id+"-details-view",date:e,view:this,store:this.store,listeners:{eventsrendered:Ext.bind(this.onDetailViewUpdated,this)}}}),this.detailPanel.getComponent(this.id+"-details-view").update(e)},onDetailViewUpdated:function(e,t,i){var a=this.detailPanel,n=this.getDayEl(t),o=n.getBox();a.setWidth(Math.max(o.width,220)),a.show(),a.getPositionEl().alignTo(n,"t-t?")},onHide:function(){this.callParent(arguments),this.detailPanel&&this.detailPanel.hide()},onClick:function(e,t){if(this.detailPanel&&this.detailPanel.hide(),!JE.sys.calendar.view.Month.superclass.onClick.apply(this,arguments)){this.dropZone&&this.dropZone.clearShims();var i,a,n=e.getTarget(this.weekLinkSelector,3);return n?(i=n.id.split(this.weekLinkIdDelimiter)[1],void this.fireEvent("weekclick",this,Ext.Date.parseDate(i,"Ymd"))):(n=e.getTarget(this.moreSelector,3))?(i=n.id.split(this.moreElIdDelimiter)[1],void this.onMoreClick(Ext.Date.parseDate(i,"Ymd"))):(n=e.getTarget("td",3))&&n.id&&-1<n.id.indexOf(this.dayElIdDelimiter)?(i=(a=n.id.split(this.dayElIdDelimiter))[a.length-1],void this.fireEvent("dayclick",this,Ext.Date.parse(i,"Ymd"),!0,Ext.get(this.getDayId(i)))):void 0}},handleDayMouseEvent:function(e,t,i){var a=e.getTarget(this.weekLinkSelector,3,!0);a&&this.weekLinkOverClass?a["over"==i?"addCls":"removeCls"](this.weekLinkOverClass):this.callParent(arguments)},getEventRow:function(e,t,i){var a,n=Ext.get(e+"-wk-"+t);if(n){var o=n.child(".ext-cal-evt-tbl",!0);a=(a=o.tBodies[0].childNodes[i+1])||Ext.core.DomHelper.append(o.tBodies[0],"<tr></tr>")}return Ext.get(a)},renderData:function(e){for(var t,i=0,a=e.eventGrid,n=Ext.Date.clone(e.viewStart),o=e.tpl,r=null!=e.maxEventsDayHeader?e.maxEventsDayHeader:999,l=e.weekCount<1?6:e.weekCount,s=1==e.weekCount?e.dayCount:7;i<l;i++)if(a[i]&&0!=a[i].length)for(var d,c=0,u=a[i],p=Ext.Date.clone(n),f=JE.DATE.add(p,{days:s,millis:-1});c<s;c++){if(u[c]){for(var E,m=0,g=0,h=0,x=u[c],v=x.length;m<v;m++)if(x[m]){if(0<g&&m-g<r&&(d=this.getEventRow(e.id,i,m-g),t={tag:"td",cls:"ext-cal-ev",id:e.id+"-empty-"+v+"-day-"+Ext.Date.format(n,"Ymd")},1<g&&g<r-m&&(t.rowspan=Math.min(g,r-m)),Ext.core.DomHelper.append(d,t),g=0),r<=m)h++;else if(!(E=x[m]).isSpan||E.isSpanStart){var y=E.data||E.event.data;y._weekIndex=i;var b=JE.DATE.parseDateTime(y.CALENDAR_STARTTIME),C=JE.DATE.parseDateTime(y.CALENDAR_ENDTIME);y._renderAsAllDay="1"==y.CALENDAR_YESORNO_CODE||E.isSpanStart,y.spanLeft=b.getTime()<p.getTime(),y.spanRight=C.getTime()>f.getTime(),y.spanCls=y.spanLeft?y.spanRight?"ext-cal-ev-spanboth":"ext-cal-ev-spanleft":y.spanRight?"ext-cal-ev-spanright":"",d=this.getEventRow(e.id,i,m),t={tag:"td",cls:"ext-cal-ev",cn:o.apply(e.templateDataFn(y))};var w=JE.DATE.diffDays(n,C)+1,S=Math.min(w,s-c);1<S&&(t.colspan=S),Ext.core.DomHelper.append(d,t)}}else g++;if(r<m&&(d=this.getEventRow(e.id,i,r),Ext.core.DomHelper.append(d,{tag:"td",cls:"ext-cal-ev-more",id:"ext-cal-ev-more-"+Ext.Date.format(n,"Ymd"),cn:{tag:"a",html:"+"+h+" 更多..."}})),v<e.evtMaxCount[i]&&(d=this.getEventRow(e.id,i,v))){t={tag:"td",cls:"ext-cal-ev",id:e.id+"-empty-"+(v+1)+"-day-"+Ext.Date.format(n,"Ymd")};var I=e.evtMaxCount[i]-v;1<I&&(t.rowspan=I),Ext.core.DomHelper.append(d,t)}}else(d=this.getEventRow(e.id,i,0))&&(t={tag:"td",cls:"ext-cal-ev",id:e.id+"-empty-day-"+Ext.Date.format(n,"Ymd")},1<e.evtMaxCount[i]&&(t.rowSpan=e.evtMaxCount[i]),Ext.core.DomHelper.append(d,t));n=JE.DATE.add(n,{days:1})}else 1==l&&(d=this.getEventRow(e.id,i,0),t={tag:"td",cls:"ext-cal-ev",id:e.id+"-empty-0-day-"+Ext.Date.format(n,"Ymd"),html:"&#160;"},1<s&&(t.colspan=s),Ext.core.DomHelper.append(d,t)),n=JE.DATE.add(n,{days:7})}}),Ext.define("JE.sys.calendar.view.Day",{extend:"Ext.container.Container",alias:"widget.calendar.dayview",showTime:!0,showTodayText:!0,todayText:"Today",ddCreateEventText:"Create event for {0}",ddMoveEventText:"Move event to {0}",dayCount:1,initComponent:function(){this.dayCount=7<this.dayCount?7:this.dayCount;var e=Ext.apply({},this.initialConfig);e.showTime=this.showTime,e.showTodatText=this.showTodayText,e.todayText=this.todayText,e.dayCount=this.dayCount,e.weekCount=1;var t=Ext.applyIf({xtype:"calendar.dayheaderview",id:this.id+"-hd"},e),i=Ext.applyIf({xtype:"calendar.daybodyview",id:this.id+"-bd",startHours:this.startHours,endHours:this.endHours},e);this.items=[t,i],this.addCls("ext-cal-dayview ext-cal-ct"),this.callParent(arguments)},afterRender:function(){this.callParent(arguments),this.header=Ext.getCmp(this.id+"-hd"),this.body=Ext.getCmp(this.id+"-bd"),this.body.on("eventsrendered",this.forceSize,this)},refresh:function(){this.header.refresh(),this.body.refresh()},forceSize:function(){Ext.defer(function(){var e=this.el.up(".x-panel-body"),t=this.el.down(".ext-cal-day-header"),i=e.getHeight()-t.getHeight();this.el.down(".ext-cal-body-ct").setHeight(i)},10,this)},onResize:function(){this.callParent(arguments),this.forceSize()},getViewBounds:function(){return this.header.getViewBounds()},getStartDate:function(){return this.header.getStartDate()},setStartDate:function(e){this.header.setStartDate(e,!0),this.body.setStartDate(e,!0)},renderItems:function(){this.header.renderItems(),this.body.renderItems()},isToday:function(){return this.header.isToday()},moveTo:function(e,t){return this.header.moveTo(e,t),this.body.moveTo(e,t)},moveNext:function(e){return this.header.moveNext(e),this.body.moveNext(e)},movePrev:function(e){return this.header.movePrev(e),this.body.movePrev(e)},moveDays:function(e,t){return this.header.moveDays(e,t),this.body.moveDays(e,t)},moveToday:function(e){return this.header.moveToday(e),this.body.moveToday(e)}}),Ext.define("JE.sys.calendar.view.DayBody",{extend:"JE.sys.calendar.view.AbstractCalendar",alias:"widget.calendar.daybodyview",requires:["JE.sys.calendar.template.DayBody","JE.sys.calendar.dd.DayDragZone","JE.sys.calendar.dd.DayDropZone"],dayColumnElIdDelimiter:"-day-col-",initComponent:function(){this.callParent(arguments),this.addEvents({eventresize:!0,dayclick:!0})},initDD:function(){var e={createText:this.ddCreateEventText,moveText:this.ddMoveEventText,resizeText:this.ddResizeEventText};this.el.ddScrollConfig={vthresh:Ext.isIE||Ext.isOpera?100:40,hthresh:-1,frequency:50,increment:100,ddGroup:"DayViewDD"},this.dragZone=new JE.sys.calendar.dd.DayDragZone(this.el,Ext.apply({view:this,containerScroll:!0},e)),this.dropZone=new JE.sys.calendar.dd.DayDropZone(this.el,Ext.apply({view:this},e))},refresh:function(){var e=this.el.getScroll().top;this.prepareData(),this.renderTemplate(),this.renderItems(),this.scrollReady&&this.scrollTo(e)},scrollTo:function(e,t){(t=t||Ext.isIE||Ext.isOpera)?Ext.defer(function(){this.el.scrollTo("top",e,!0),this.scrollReady=!0},10,this):(this.el.scrollTo("top",e,!0),this.scrollReady=!0)},afterRender:function(){this.tpl||(this.tpl=new JE.sys.calendar.template.DayBody({id:this.id,dayCount:this.dayCount,showTodayText:this.showTodayText,todayText:this.todayText,showTime:this.showTime,startHours:this.startHours,endHours:this.endHours})),this.tpl.compile(),this.addCls("ext-cal-body-ct"),this.callParent(arguments),this.scrollTo(294)},forceSize:Ext.emptyFn,onEventResize:function(e,t){var i=JE.DATE.parseDateTime(e.data.CALENDAR_STARTTIME),a=JE.DATE.parseDateTime(e.data.CALENDAR_ENDTIME);0===JE.DATE.compare(i,t.StartDate)&&0===JE.DATE.compare(a,t.EndDate)||(e.set("CALENDAR_STARTTIME",JE.DATE.formatDateTime(t.StartDate)),e.set("CALENDAR_ENDTIME",JE.DATE.formatDateTime(t.EndDate)),this.fireEvent("eventresize",this,e))},getEventBodyMarkup:function(){return this.eventBodyMarkup||(this.eventBodyMarkup=["{Title}",'<tpl if="_isReminder">','<i class="ext-cal-ic ext-cal-ic-rem">&#160;</i>',"</tpl>",'<tpl if="_isRecurring">','<i class="ext-cal-ic ext-cal-ic-rcr">&#160;</i>',"</tpl>"].join("")),this.eventBodyMarkup},getEventTemplate:function(){return this.eventTpl||(this.eventTpl=Ext.isIE||Ext.isOpera?new Ext.XTemplate('<div id="{_elId}" class="ext-cal-evt {_selectorCls} {_colorCls}-x" style="left: {_left}%; width: {_width}%; top: {_top}px;">','<div class="ext-cal-evb">&#160;</div>','<dl style="height: {_height}px;" class="ext-cal-evdm">','<dd class="ext-evt-bd">',this.getEventBodyMarkup(),"</dd>",'<div class="ext-evt-rsz"><div class="ext-evt-rsz-h">&#160;</div></div>',"</dl>",'<div class="ext-cal-evb">&#160;</div>',"</div>"):new Ext.XTemplate('<div id="{_elId}" class="{_selectorCls} {_colorCls} ext-cal-evt ext-cal-evr" style="left: {_left}%; width: {_width}%; top: {_top}px; height: {_height}px;">','<div class="ext-evt-bd">',this.getEventBodyMarkup(),"</div>",'<div class="ext-evt-rsz"><div class="ext-evt-rsz-h">&#160;</div></div>',"</div>"),this.eventTpl.compile()),this.eventTpl},getEventAllDayTemplate:function(){if(!this.eventAllDayTpl){var e,t=this.getEventBodyMarkup();(e=Ext.isIE||Ext.isOpera?new Ext.XTemplate('<div id="{_elId}" class="ext-cal-evt" style="left: {_left}%; width: {_width}%; top: {_top}px; height: {_height}px;">','<div class="{_selectorCls} {spanCls} {_colorCls} ext-cal-evo">','<div class="ext-cal-evm">','<div class="ext-cal-evi">',t,"</div>","</div>","</div></div>"):new Ext.XTemplate('<div id="{_elId}" class="{_selectorCls} {_colorCls} {spanCls} ext-cal-evt ext-cal-evr" style="left: {_left}%; width: {_width}%; top: {_top}px; height: {_height}px;">',t,"</div>")).compile(),this.eventAllDayTpl=e}return this.eventAllDayTpl},getTemplateEventData:function(e){var t=this.getEventSelectorCls(e.JE_SYS_CALENDAR_ID),i={};this.getTemplateEventBox(e);var a=JE.DATE.parseDateTime(e.CALENDAR_STARTTIME);i._selectorCls=t,i._colorCls="ext-color-"+(e.CALENDAR_CALENDARTYPE_CODE||"0")+(e._renderAsAllDay?"-ad":"-noad"),i._elId=t+(e._weekIndex?"-"+e._weekIndex:""),i._isRecurring=e.Recurrence&&""!=e.Recurrence,i._isReminder="1"==e.CALENDAR_REMINDER_CODE&&""!=e.CALENDAR_REMINDER_CODE;var n=e.CALENDAR_TITLE,o=Ext.value(e.CALENDAR_GROUPCOLOR,"#FFF");return i.Title=("1"==e.CALENDAR_YESORNO_CODE?"":Ext.Date.format(a,"H:i "))+'<font color="'+o+'">'+(n&&0!=n.length?n:"(无标题)")+"</font>",Ext.applyIf(i,e)},getTemplateEventBox:function(e){var t=JE.DATE.parseDateTime(e.CALENDAR_STARTTIME),i=JE.DATE.parseDateTime(e.CALENDAR_ENDTIME),a=60*t.getHours()+t.getMinutes(),n=60*i.getHours()+i.getMinutes(),o=n-a,r=Ext.value(this.startHours,0),l=Ext.value(this.endHours,23);i.getHours()>l&&(o=(n=60*l)-a),a=60*(t.getHours()-r)+t.getMinutes(),e._left=0,e._width=100,e._top=Math.round(.7*a),e._height=Math.max(.7*o,15)},renderItems:function(){for(var e,t,i,a,n,o,r,l,s,d,c,u,p,f=0,E=[];f<this.dayCount;f++)for(e=0,i=(t=this.eventGrid[0][f])?t.length:0;e<i;e++)(l=t[e])&&((a=l.data||l.event.data)._renderAsAllDay||(Ext.apply(a,{cls:"ext-cal-ev",_positioned:!0}),E.push({data:this.getTemplateEventData(a),date:JE.DATE.add(this.viewStart,{days:f})})));for(n=o=d=0,r=E.length;n<r;n++)for(l=E[n].data,s=null,d,o=0;o<r;o++)n!=o&&(s=E[o].data,this.isOverlapping(l,s)&&(l._overlap=null==l._overlap?1:l._overlap+1,n<o&&(void 0===l._overcol&&(l._overcol=0),s._overcol=l._overcol+1,d=Math.max(d,s._overcol))));for(n=0;n<r;n++)void 0!==(l=E[n].data)._overlap&&(100-(c=100/(d+1))*l._overlap,l._width=c,l._left=c*l._overcol),u=this.getEventTemplate().apply(l),p=this.id+"-day-col-"+Ext.Date.format(E[n].date,"Ymd"),Ext.core.DomHelper.append(p,u);this.fireEvent("eventsrendered",this)},getDayEl:function(e){return Ext.get(this.getDayId(e))},getDayId:function(e){return Ext.isDate(e)&&(e=Ext.Date.format(e,"Ymd")),this.id+this.dayColumnElIdDelimiter+e},getDaySize:function(){var e=this.el.down(".ext-cal-day-col-inner").getBox();return{height:e.height,width:e.width}},getDayAt:function(e,t){var i=Ext.value(this.startHours,0),a=Ext.value(this.endHours,24),n=this.el.down(".ext-cal-day-times").getWidth(),o=this.el.getBox(),r=this.getDaySize(!1),l=e-o.x-n,s=Math.floor(l/r.width),d=this.el.getScroll(),c=this.el.down(".ext-cal-bg-row").getHeight()/2,u=t-o.y-c+d.top,p=Math.max(0,Math.ceil(u/c)),f=30*p+60*i,E=JE.DATE.add(this.viewStart,{days:s,minutes:f}),m=this.getDayEl(E),g=e;m&&(g=m.getX());var h=JE.DATE.add(this.viewStart,{days:s,hours:a});return E.getTime()<h.getTime()?{date:E,el:m,timeBox:{x:g,y:21*p+o.y-d.top,width:r.width,height:c}}:{}},onClick:function(e,t){if(!this.dragPending&&!JE.sys.calendar.view.DayBody.superclass.onClick.apply(this,arguments)&&null===e.getTarget(".ext-cal-day-times",3)){var i=e.getTarget("td",3);if(i&&i.id&&-1<i.id.indexOf(this.dayElIdDelimiter)){var a=this.getDateFromId(i.id,this.dayElIdDelimiter);this.fireEvent("dayclick",this,Ext.Date.parseDate(a,"Ymd"),!0,Ext.get(this.getDayId(a,!0)))}else{var n=this.getDayAt(e.getX(),e.getY());n&&n.date&&this.fireEvent("dayclick",this,n.date,!1,null)}}}}),Ext.define("JE.sys.calendar.view.DayHeader",{extend:"JE.sys.calendar.view.Month",alias:"widget.calendar.dayheaderview",requires:["JE.sys.calendar.template.DayHeader"],weekCount:1,dayCount:1,allDayOnly:!0,monitorResize:!1,afterRender:function(){this.tpl||(this.tpl=new JE.sys.calendar.template.DayHeader({id:this.id,showTodayText:this.showTodayText,todayText:this.todayText,showTime:this.showTime})),this.tpl.compile(),this.addCls("ext-cal-day-header"),this.callParent(arguments)},forceSize:Ext.emptyFn,refresh:function(){this.callParent(arguments),this.recalcHeaderBox()},recalcHeaderBox:function(){var e=this.el.down(".ext-cal-evt-tbl").getHeight();this.el.setHeight(e+7),this.el.down(".ext-cal-hd-ad-inner").setHeight(e+5),this.el.down(".ext-cal-bg-tbl").setHeight(e+5)},moveNext:function(e){return this.moveDays(this.dayCount,e)},movePrev:function(e){return this.moveDays(-this.dayCount,e)},onClick:function(e,t){var i,a,n=e.getTarget("td",3);if(n&&n.id&&-1<n.id.indexOf(this.dayElIdDelimiter))return a=(i=n.id.split(this.dayElIdDelimiter))[i.length-1],void this.fireEvent("dayclick",this,Ext.Date.parse(a,"Ymd"),!0,Ext.get(this.getDayId(a)));this.callParent(arguments)}}),Ext.define("JE.sys.calendar.view.MonthDayDetail",{extend:"Ext.Component",alias:"widget.calendar.monthdaydetailview",initComponent:function(){this.callParent(arguments),this.addEvents({eventsrendered:!0})},afterRender:function(){this.tpl=this.getTemplate(),this.callParent(arguments),this.el.on({click:this.view.onClick,mouseover:this.view.onMouseOver,mouseout:this.view.onMouseOut,scope:this.view})},getTemplate:function(){return this.tpl||(this.tpl=new Ext.XTemplate('<div class="ext-cal-mdv x-unselectable">','<table class="ext-cal-mvd-tbl" cellpadding="0" cellspacing="0">',"<tbody>",'<tpl for=".">','<tr><td class="ext-cal-ev">{markup}</td></tr>',"</tpl>","</tbody>","</table>","</div>")),this.tpl.compile(),this.tpl},update:function(e){this.date=e,this.refresh()},refresh:function(){if(this.rendered){var n=this.view.getEventTemplate(),o=[],e=this.store.queryBy(function(e){var t=Ext.Date.clearTime(this.date,!0).getTime(),i=JE.DATE.parseDateTime(e.data.CALENDAR_STARTTIME),a=Ext.Date.clearTime(i,!0).getTime(),n=t==a,o=!1;if(!n){var r=JE.DATE.parseDateTime(e.data.CALENDAR_ENDTIME),l=Ext.Date.clearTime(r,!0).getTime();o=a<t&&t<=l}return n||o},this);e.each(function(e){var t=e.data,i=JE.DATE.parseDateTime(t.CALENDAR_STARTTIME),a=JE.DATE.parseDateTime(t.CALENDAR_ENDTIME);t._renderAsAllDay="1"==t.CALENDAR_YESORNO_CODE||0<JE.DATE.diffDays(i,a),t.spanLeft=0<JE.DATE.diffDays(i,this.date),t.spanRight=0<JE.DATE.diffDays(this.date,a),t.spanCls=t.spanLeft?t.spanRight?"ext-cal-ev-spanboth":"ext-cal-ev-spanleft":t.spanRight?"ext-cal-ev-spanright":"",o.push({markup:n.apply(this.getTemplateEventData(t))})},this),this.tpl.overwrite(this.el,o),this.fireEvent("eventsrendered",this,this.date,e.getCount())}},getTemplateEventData:function(e){var t=this.view.getTemplateEventData(e);return t._elId="dtl-"+t._elId,t}}),Ext.define("JE.sys.calendar.view.Week",{extend:"JE.sys.calendar.view.Day",alias:"widget.calendar.weekview",dayCount:7}),Ext.define("JE.sys.calendar.form.EventWindow",{extend:"Ext.window.Window",alias:"widget.calendar.eventeditwindow",width:956,autoShow:!0,border:!0,modal:!0,resizable:!0,closeAction:"hide",buttonAlign:"center",layout:"fit",cls:"je-calendar-eventeditwindow",callback:void 0,onEsc:function(e,t){t.target.blur(),this.onCancel()},onShow:function(){this.callParent(arguments);var e=this.down("form"),t=this.activeRecord,i=e.getDockedItems("toolbar[dock=bottom]")[0],a=e.form.findField("CALENDAR_GROUPID");if(a&&a.getStore().loadData(this.groupData),t&&t.data){e.form.setValues(t.data);var n=JE.currentUser.userCode==t.get("SY_CREATEUSER");e.form.setItemsReadOnly(!n),i.setVisible(n)}else e.form.setItemsReadOnly(!1),e.form.findField("JE_SYS_CALENDAR_ID").setValue(""),e.form.findField("CALENDAR_TITLE").setValue(""),e.form.findField("CALENDAR_NOTES").setValue(""),i.setVisible(!0),(t=t||{})&&(t.CALENDAR_MESSAGETYPE_CODE="DWR,PCMAIL",t.CALENDAR_MESSAGETYPE_NAME="页面,站内信",e.form.setValues(t))},onClose:function(){var e=this.down("form");e.form.findField("CALENDAR_STARTTIME").setValue(""),e.form.findField("CALENDAR_ENDTIME").setValue(""),this.close()},initComponent:function(){var i=this;i.localLang=JE.getLocalLang("sys.calendar.eventWin",!0),i.title=i.localLang.title,this.addEvents({eventadd:!0,eventupdate:!0,eventdelete:!0,eventcancel:!0,editdetails:!0}),this.items={xtype:"form",layout:"column",listeners:{afterrender:function(e){var t=e.up("window");t.on("close",function(){var e=t.down("form").form;e.findField("CALENDAR_STARTTIME").setValue(""),e.findField("CALENDAR_ENDTIME").setValue(""),e.findField("CALENDAR_TITLE").setValue(""),e.findField("CALENDAR_NOTES").setValue("")})}},defaults:{xtype:"textfield",columnWidth:.5,msgTarget:"side",labelWidth:65,labelAlign:"right",margin:"5px 50px "},border:0,frame:!1,bodyStyle:"background:transparent;padding:5px 10px 10px;",buttonAlign:"center",items:[{xtype:"hidden",name:"JE_SYS_CALENDAR_ID",listeners:{change:function(e,t){i.down("button[ref=delete]").setVisible(JE.isNotEmpty(t))}}},{fieldLabel:i.localLang.column.title,name:"CALENDAR_TITLE",allowBlank:!1,columnWidth:1,emptyText:i.localLang.column.titleEmptyText},{fieldLabel:i.localLang.column.createUser,name:"SY_CREATEUSERNAME",readOnly:!0,value:JE.currentUser.username,columnWidth:.5},{fieldLabel:i.localLang.column.allDay,xtype:"cbbfield",name:"CALENDAR_YESORNO_CODE",configInfo:"YESORNO,CALENDAR_YESORNO_CODE~CALENDAR_YESORNO_NAME,code~text",value:"1",hidden:!0},{fieldLabel:i.localLang.column.type,xtype:"cbbfield",name:"CALENDAR_CALENDARTYPE_CODE",configInfo:"JE_SYS_CALENDARTYPE,CALENDAR_CALENDARTYPE_CODE~CALENDAR_CALENDARTYPE_NAME,code~text",columnWidth:.5,value:"1"},{xtype:"hidden",name:"CALENDAR_CALENDARTYPE_NAME",value:"日常记录"},{xtype:"hidden",name:"CALENDAR_YESORNO_NAME",value:"是"},{xtype:"hidden",name:"SY_CREATEUSER",value:JE.currentUser.userCode},{xtype:"hidden",name:"SY_CREATEUSERID",value:JE.currentUser.id},{fieldLabel:i.localLang.column.start,xtype:"datedayfield",format:"Y-m-d",submitFormat:"Y-m-d H:i:s",name:"CALENDAR_STARTTIME",allowBlank:!1,columnWidth:.5,value:JE.isNotEmpty(i.selectDate)?i.selectDate:""},{fieldLabel:i.localLang.column.end,xtype:"datedayfield",format:"Y-m-d",allowBlank:!1,submitFormat:"Y-m-d H:i:s",name:"CALENDAR_ENDTIME",columnWidth:.5,value:JE.isNotEmpty(i.selectDate)?i.selectDate:""},{fieldLabel:i.localLang.column.remind,xtype:"rgroup",name:"CALENDAR_REMINDER_CODE",configInfo:"YESORNO,CALENDAR_REMINDER_CODE~CALENDAR_REMINDER_NAME,code~text",value:"1"},{xtype:"hidden",name:"CALENDAR_REMINDER_NAME",value:"从不"},{xtype:"hidden",name:"CALENDAR_GROUPCOLOR"},{fieldLabel:i.localLang.column.notifications,xtype:"cgroup",cls:"je-calendar-eventeditwindow-80",name:"CALENDAR_MESSAGETYPE_CODE",configInfo:"JE_WF_MESSAGETYPE,CALENDAR_MESSAGETYPE_CODE~CALENDAR_MESSAGETYPE_NAME,code~text",value:"PCMAIL",hidden:!0,checkAll:!1},{xtype:"hidden",name:"CALENDAR_MESSAGETYPE_NAME"},{fieldLabel:"颜色",xtype:"cbbfield",name:"CALENDAR_COLOR",configInfo:",CALENDAR_COLOR~CALENDAR_,code~text",value:"#386BD0",dataArray:[{code:"#FF625C",text:"红色"},{code:"#F9A646",text:"橙色"},{code:"#F4CE4A",text:"黄色"},{code:"#386BD0",text:"蓝色"},{code:"#6DCC51",text:"绿色"},{code:"#4BB8F3",text:"浅蓝"},{code:"#D088E1",text:"紫色"}]},{fieldLabel:i.localLang.column.remark,xtype:"ueditor",simpleToolbar:!0,name:"CALENDAR_NOTES",allowBlank:!1,columnWidth:1}],buttons:[{text:i.localLang.column.save,ref:"save",formBind:!0,cls:"JEPLUS_B_L10"},{text:i.localLang.deleteText,ref:"delete",formBind:!0,hidden:!0,cls:"JEPLUS_B_C03"},{text:i.localLang.closeText,ref:"close"}]},this.callParent()},roundTime:function(e,t){t=t||15;var i=parseInt(e.getMinutes(),10);return e.add("mi",t-i%t)},updateRecord:function(e,t){if(!e.data)return this;var i=this.down("form").getForm().getValues();return e.beginEdit(),e.set(i),t||e.endEdit(),this},onCancel:function(){this.cleanup(!0),this.fireEvent("eventcancel",this)},cleanup:function(e){this.activeRecord&&this.activeRecord.dirty&&this.activeRecord.reject(),delete this.activeRecord,!0===e&&this.hide()}}),Ext.define("JE.sys.calendar.group.GroupForm",{extend:"Ext.form.Panel",alias:"widget.calendar.groupform",frame:!1,layout:"column",autoScroll:!0,bodyStyle:{background:"#f1f1f1"},bodyPadding:"10 20 0 20",defaults:{xtype:"textfield",labelAlign:"right",margin:"5 0 8 0",columnWidth:.5},initComponent:function(){this.localLang=JE.getLocalLang("sys.calendar.group"),this.items=[{xtype:"hidden",name:"JE_SYS_CALENDARGROUP_ID"},{fieldLabel:this.localLang.name,name:"CALENDARGROUP_NAME",allowBlank:!1},{fieldLabel:this.localLang.color,xtype:"colorfield",name:"CALENDARGROUP_COLOR"},{fieldLabel:this.localLang.defaults,xtype:"hidden",value:"0",name:"CALENDARGROUP_DEFAULT"},{fieldLabel:this.localLang.createUser,name:"SY_CREATEUSERNAME",readOnly:!0,value:JE.currentUser.username},{xtype:"hidden",name:"SY_CREATEUSER",value:JE.currentUser.userCode},{fieldLabel:this.localLang.createDept,readOnly:!0,name:"SY_CREATEDEPTNAME",value:JE.currentUser.deptName},{fieldLabel:this.localLang.remark,xtype:"textarea",name:"CALENDARGROUP_REMARK",columnWidth:1}],this.callParent()}}),Ext.define("JE.sys.calendar.group.GroupUserGrid",{extend:"Ext.grid.Panel",alias:"widget.calendar.groupusergrid",border:0,multiSelect:!0,frame:!1,selModel:{selType:"checkboxmodel"},enableKeyNav:!0,columnLines:!0,cls:"pcatgrid",initComponent:function(){this.localLang=JE.getLocalLang("sys.calendar.group"),this.tbar=[{xtype:"button",text:this.localLang.importText,ref:"gridInsert",iconCls:"jeicon jeicon-new-form"},{xtype:"button",text:JE.getLocalLang("common.deleteText"),ref:"gridDelete",iconCls:"jeicon jeicon-physics-delete"}],this.columns=[{dataIndex:"JE_SYS_GROUPUSER_ID",hidden:!0},{xtype:"rownumberer",width:35,text:"No.",align:"center"},{text:this.localLang.userName,width:200,dataIndex:"GROUPUSER_USERNAME"},{text:this.localLang.department,width:200,dataIndex:"GROUPUSER_DEPTNAME"}],this.editing=Ext.create("Ext.grid.plugin.CellEditing",{clicksToEdit:1}),this.plugins=[this.editing],this.store=JE.getStore({id:"JE_SYS_GROUPUSER_ID",tableName:"JE_SYS_GROUPUSER",autoLoad:!1,params:{limit:-1,whereSql:" and 1!=1",orderSql:" order by SY_ORDERINDEX"}}),this.callParent(arguments)},doReadOnly:function(e){var t=this.down("button[ref=gridInsert]"),i=this.down("button[ref=gridDelete]");t.setDisabled(e),i.setDisabled(e)}}),Ext.define("JE.sys.calendar.tree.GroupTree",{extend:"Ext.tree.Panel",border:0,alias:"widget.calendar.grouptree",useArrows:!0,rootVisible:!1,animate:!0,multiSelect:!1,selModel:{selType:"treemodel",allowDeselect:!0,mode:"SINGLE"},viewConfig:{selectedItemCls:"x-tree-row-selected",focusedItemCls:"x-tree-row-focused",beforeFocusedItemCls:"x-tree-row-before-focused",tableFocusedFirstCls:"x-tree-table-focused-first"},initComponent:function(){this.store=JE.getStore({type:"tree",tableName:"JE_SYS_CALENDAR",url:JE.getUrlMaps("je.core.calendar","getGroupTree"),params:{}});var e=JE.getLocalLang("common");this.itemMenu=Ext.create("JE.sys.calendar.tree.TreeMenu",{frame:!1,border:1,items:[{text:e.editText,itemId:"edit",iconCls:"jeicon jeicon-pencil"},{text:e.deleteText,itemId:"delete",iconCls:"jeicon jeicon-minus-circle"}],treePanel:this}),this.panelMenu=Ext.create("JE.sys.calendar.tree.TreeMenu",{frame:!1,border:1,items:[{text:e.addText,itemId:"add",iconCls:"jeicon jeicon-plus-circle"},{text:e.refreshText,itemId:"refresh",iconCls:"jeicon jeicon-refresh"}],treePanel:this}),this.listeners={itemcontextmenu:function(e,t,i,a,n,o){var r=e.panel.itemMenu;n.stopEvent(),r.showAt(n.getXY()),r.doConstrain()},containercontextmenu:function(e,t,i){var a=e.panel.panelMenu;t.stopEvent(),a.showAt(t.getXY()),a.doConstrain()}},this.callParent()}}),Ext.define("JE.sys.calendar.tree.MyTaskTree",{extend:"Ext.tree.Panel",border:0,alias:"widget.calendar.mytasktree",useArrows:!0,rootVisible:!1,viewConfig:{selectedItemCls:"x-tree-row-selected",focusedItemCls:"x-tree-row-focused",beforeFocusedItemCls:"x-tree-row-before-focused",tableFocusedFirstCls:"x-tree-table-focused-first"},initComponent:function(){this.store=JE.getStore({type:"tree",tableName:"JE_SYS_CALENDARGROUP",url:JE.getUrlMaps("je.core.calendar","getMyTaskTree"),params:{}}),this.callParent()}}),Ext.define("JE.sys.calendar.tree.ShareTaskTree",{extend:"Ext.tree.Panel",border:0,alias:"widget.calendar.sharetasktree",useArrows:!0,rootVisible:!1,viewConfig:{selectedItemCls:"x-tree-row-selected",focusedItemCls:"x-tree-row-focused",beforeFocusedItemCls:"x-tree-row-before-focused",tableFocusedFirstCls:"x-tree-table-focused-first"},initComponent:function(){this.store=JE.getStore({type:"tree",tableName:"JE_SYS_CALENDAR",url:JE.getUrlMaps("je.core.calendar","getShareTaskTree"),params:{}}),this.callParent()}}),Ext.define("JE.sys.calendar.tree.TreeMenu",{extend:"Ext.menu.Menu",alias:"widget.calendar.treemenu",defaultAlign:"br-tr",frame:!0,border:0,initComponent:function(){this.callParent()}}),Ext.define("JE.sys.calendar.CalendarPanel",{extend:"Ext.panel.Panel",alias:"widget.calendar.calendarpanel",showDayView:!0,showWeekView:!0,showMonthView:!0,showNavBar:!0,showTodayText:!0,showTime:!0,layoutConfig:{layoutOnCardChange:!0,deferredRender:!0},initComponent:function(){this.startDate=new Date,this.localLang=JE.getLocalLang("sys.calendar.text"),Ext.apply(this,{todayText:this.localLang.todayText,dayText:this.localLang.dayText,weekText:this.localLang.weekText,monthText:this.localLang.monthText}),this.startHours=1*Ext.value(6,6),this.endHours=1*Ext.value(18,18),this.tbar=[{handler:this.onPrevClick,scope:this,iconCls:"fa fa-angle-left je-calendar-fa",style:{border:"1px solid rgb(239,239,239)",height:"30px",width:"30px",margin:"5px 0"}},{xtype:"box",itemId:"dateText",cls:"je-today-date je-today-date1"},{handler:this.onNextClick,scope:this,iconCls:"fa fa-angle-right je-calendar-fa",style:{border:"1px solid rgb(239,239,239)",height:"30px",width:"30px"}},"->"],this.viewCount=0,this.showDayView&&(this.tbar.push("-"),this.tbar.push({id:this.id+"-tb-day",cls:"je-calendar-data-style",text:"日",handler:this.onDayClick,scope:this,toggleGroup:"tb-views"}),this.viewCount++),this.showWeekView&&(this.tbar.push("-"),this.tbar.push({id:this.id+"-tb-week",cls:"je-calendar-data-style",text:"周",handler:this.onWeekClick,scope:this,toggleGroup:"tb-views"}),this.viewCount++),!this.showMonthView&&0!=this.viewCount||(this.tbar.push("-"),this.tbar.push({id:this.id+"-tb-month",cls:"je-calendar-data-style",text:"月",handler:this.onMonthClick,scope:this,toggleGroup:"tb-views"}),this.tbar.push("->"),this.viewCount++,this.showMonthView=!0),this.tbar.push("-");var e=this.viewCount-1;if(this.activeItem=void 0===this.activeItem?e:this.activeItem>e?e:this.activeItem,this.tbar.push({text:this.localLang.todayText,scope:this,handler:this.onTodayClick,cls:"je-today-date je-today-date2",iconCls:"fe icon-calendar-2"}),!1===this.showNavBar&&(delete this.tbar,this.addCls("x-calendar-nonav")),this.callParent(),this.addEvents({eventadd:!0,eventupdate:!0,eventdelete:!0,eventcancel:!0,viewchange:!0}),this.layout="card",this.showDayView){var t=Ext.apply({xtype:"calendar.dayview",todayText:this.todayText,showToday:this.showToday,maxEventsDayHeader:2,showTodayText:this.showTodayText,showTime:this.showTime,startHours:this.startHours,endHours:this.endHours},this.dayViewCfg);t.id=this.id+"-day",t.store=t.store||this.calendarStore,this.initEventRelay(t),this.add(t)}if(this.showWeekView){var i=Ext.applyIf({xtype:"calendar.weekview",todayText:this.todayText,showToday:this.showToday,maxEventsDayHeader:2,showTodayText:this.showTodayText,showTime:this.showTime,startHours:this.startHours,endHours:this.endHours},this.weekViewCfg);i.id=this.id+"-week",i.store=i.store||this.calendarStore,this.initEventRelay(i),this.add(i)}if(this.showMonthView){var a=Ext.applyIf({xtype:"calendar.monthview",todayText:this.todayText,showToday:this.showToday,showTodayText:this.showTodayText,showTime:this.showTime,listeners:{weekclick:{fn:function(e,t){this.showWeek(t)},scope:this}}},this.monthViewCfg);a.id=this.id+"-month",a.store=a.store||this.calendarStore,this.initEventRelay(a),this.add(a)}},initEventRelay:function(e){e.listeners=e.listeners||{},e.listeners.afterrender={fn:function(e){this.relayEvents(e,["eventsrendered","eventclick","eventover","eventout","dayclick","eventmove","datechange","rangeselect","eventdelete","eventresize","initdrag"])},scope:this,single:!0}},afterRender:function(){this.callParent(arguments),this.body.addCls("x-cal-body"),Ext.defer(function(){this.updateNavState(),this.fireViewChange(),this.setNowData(this.down("[itemId=dateText]"))},10,this)},onLayout:function(){this.callParent(),this.navInitComplete||(this.updateNavState(),this.navInitComplete=!0)},setActiveView:function(e){var t=this.layout,i=this.getDockedItems("toolbar")[0];i&&i[e===this.id+"-edit"?"hide":"show"](),t.setActiveItem(e),this.doComponentLayout(),this.activeView=t.getActiveItem(),e!==this.id+"-edit"&&(e!==this.preEditView&&t.activeItem.setStartDate(this.startDate,!0),this.updateNavState()),this.fireViewChange()},fireViewChange:function(){if(this.layout&&this.layout.getActiveItem){var e=this.layout.getActiveItem();if(e&&e.getViewBounds)var t=e.getViewBounds(),i={activeDate:e.getStartDate(),viewStart:t.start,viewEnd:t.end};this.fireEvent("viewchange",this,e,i)}},updateNavState:function(){if(!1!==this.showNavBar){var e=this.layout.activeItem.id.split(this.id+"-")[1],t=Ext.getCmp(this.id+"-tb-"+e);t&&t.toggle(!0)}},setStartDate:function(e){this.startDate=e,this.layout.activeItem.setStartDate(e,!0),this.updateNavState(),this.fireViewChange()},showWeek:function(e){this.setActiveView(this.id+"-week"),this.setStartDate(e)},onPrevClick:function(e){this.startDate=this.layout.activeItem.movePrev(),this.updateNavState(),this.fireViewChange();var t=e.next();this.setNowData(t,"prev")},onNextClick:function(e){this.startDate=this.layout.activeItem.moveNext(),this.updateNavState(),this.fireViewChange();var t=e.prev();this.setNowData(t,"next")},onTodayClick:function(){this.setStartDate(new Date)},onRefreshClick:function(){var e=this.up("panel[xtype=calendar.mainview]").down("datepicker[name=CALENDAR_DATESELECT]");this.setStartDate(e.getValue())},onDayClick:function(){this.setActiveView(this.id+"-day"),this.setNowData(this.down("[itemId=dateText]"))},onWeekClick:function(){this.setActiveView(this.id+"-week"),this.setNowData(this.down("[itemId=dateText]"))},onMonthClick:function(){this.setActiveView(this.id+"-month"),this.setNowData(this.down("[itemId=dateText]"))},setNowData:function(e){var t=this.layout.activeItem.id,i=t.substr(t.lastIndexOf("-")+1,t.length),a="";if("day"==i)a=Ext.Date.format(this.startDate,"Y年m月d日");else if("week"==i){var n=Date.parse(this.startDate)+6048e5;a=Ext.Date.format(this.startDate,"Y年m月d日")+"-"+Ext.Date.format(new Date(n),"Y年m月d日")}else"month"==i&&(a=Ext.Date.format(this.startDate,"Y年m月"));e.update(a)},getActiveView:function(){return this.layout.activeItem}}),Ext.define("JE.sys.calendar.WestView",{extend:"Ext.panel.Panel",alias:"widget.calendar.westview",layout:"accordion",layoutConfig:{titleCollapse:!1,animate:!1,activeOnTop:!0},border:1,initComponent:function(){this.localLang=JE.getLocalLang("sys.calendar.west"),this.items=[{title:this.localLang.taskTitle,iconCls:"jeicon jeicon-folder",xtype:"calendar.mytasktree"},{title:this.localLang.shareTitle,iconCls:"jeicon jeicon-share",xtype:"calendar.sharetasktree"},{title:this.localLang.groupTitle,iconCls:"jeicon jeicon-group",xtype:"calendar.grouptree"}],this.callParent()}}),Ext.define("JE.sys.calendar.MainView",{extend:"Ext.panel.Panel",alias:"widget.calendar.mainview",layout:"border",cls:"je-calendar-mainview",initComponent:function(){JE.loadScript("/static/css/calendar.css"),this.calendarStore=JE.getStore({tableName:"JE_SYS_CALENDAR",id:"JE_SYS_CALENDAR_ID",action:JE.getUrlMaps("je.core.calendar"),autoLoad:!1,params:{limit:-1,permSql:" AND (SY_CREATEUSER='"+JE.currentUser.userCode+"' OR CALENDAR_GROUPID IN (SELECT GROUPUSER_GROUP_ID FROM JE_SYS_GROUPUSER WHERE GROUPUSER_USERID='"+JE.currentUser.userId+"') OR CALENDAR_GROUPID IN (SELECT JE_SYS_CALENDARGROUP_ID FROM JE_SYS_CALENDARGROUP WHERE SY_CREATEUSER='"+JE.currentUser.userCode+"'))"}}),this.items=[{region:"center",layout:"border",items:[{xtype:"container",hidden:!0,region:"west",width:179,style:"background:#157fcc;",padding:"1",layout:"border",items:[{region:"north",height:200,xtype:"datepicker",name:"CALENDAR_DATESELECT",cls:"ext-cal-nav-picker"},{region:"center",xtype:"calendar.westview"}]},{xtype:"calendar.calendarpanel",calendarStore:this.calendarStore,border:!1,region:"center",padding:"0 0 0 1",activeItem:3,monthViewCfg:{showHeader:!0,showWeekLinks:!0,showWeekNumbers:!0}}]}],this.callParent(arguments)}}),Ext.define("JE.sys.calendar.controller.CalendarController",{extend:"Ext.app.Controller",mixins:{calendarUtil:"JE.sys.calendar.util.CalendarUtil"},groupData:[],init:function(){var s=this,e={"panel[xtype=calendar.mainview] datepicker[name=CALENDAR_DATESELECT]":{select:function(e,t){e.up("panel[xtype=calendar.mainview]").down("panel[xtype=calendar.calendarpanel]").setStartDate(t)}},"panel[xtype=calendar.calendarpanel]":{eventclick:function(e,t,i){var a=e.up("panel[xtype=calendar.calendarpanel]");s.showEditWindow(a,t)},eventover:function(e,t,i){},eventout:function(e,t,i){},eventadd:function(e,t){JE.msg("Event "+t.data.Title+" was added")},eventupdate:function(e,t){JE.msg("Event "+t.data.Title+" was updated")},eventcancel:function(e,t){},viewchange:function(e,t,i){s.editWin&&s.editWin.hide(),i&&e.up("panel[xtype=calendar.mainview]").down("datepicker[name=CALENDAR_DATESELECT]").setValue(i.activeDate)},dayclick:function(e,t,i,a){var n=e.up("panel[xtype=calendar.calendarpanel]"),o=1*Ext.value(JE.systemConfig.JE_CALENDAR_WORKBEGINTIMEAM,"8"),r=1*Ext.value(JE.systemConfig.JE_CALENDAR_WORKENDTIMEPM,"18"),l=Ext.Date.clone(t);i?(t.setHours(o),l.setHours(r)):l.setMinutes(t.getMinutes()+30),s.showEditWindow(n,{CALENDAR_STARTTIME:JE.DATE.formatDateTime(t),CALENDAR_ENDTIME:JE.DATE.formatDateTime(l),CALENDAR_YESORNO_CODE:i?"1":"0"})},rangeselect:function(e,t,i){var a=e.up("panel[xtype=calendar.calendarpanel]"),n=a.up("panel[xtype=calendar.mainview]");s.showEditWindow(a,t),s.editWin.on("hide",i,n,{single:!0})},eventmove:function(e,t){var i=Ext.clone(t.data);i.tableCode="JE_SYS_CALENDAR";var a=JE.ajax({url:JE.getUrlMaps("je.core.calendar","doUpdate"),params:i});a.success?(t.commit(),JE.msg(JE.getLocalLang("common.updateSuccessAlert"))):JE.alert(a.obj)},eventresize:function(e,t){var i=Ext.clone(t.data);i.tableCode="JE_SYS_CALENDAR";var a=JE.ajax({url:JE.getUrlMaps("je.core.calendar","doUpdate"),params:i});a.success?(t.commit(),JE.msg(JE.getLocalLang("common.updateSuccessAlert"))):JE.alert(a.obj)},eventdelete:{fn:function(e,t){var i={tableCode:"JE_SYS_CALENDAR"};i.ids=t.get("JE_SYS)CALENDAR_ID");var a=JE.ajax({url:JE.getUrlMaps("je.core.calendar","doRemove"),params:i});a.success?(t.commit(),JE.msg(JE.getLocalLang("common.deleteSuccessAlert"))):JE.alert(a.obj)},scope:this},initdrag:function(e){s.editWin&&s.editWin.isVisible()&&s.editWin.hide()}},"window[xtype=calendar.eventeditwindow]":{close:function(e){var t=e.down("form").form;t.findField("CALENDAR_STARTTIME").setValue(""),t.findField("CALENDAR_ENDTIME").setValue(""),t.findField("CALENDAR_TITLE").setValue(""),t.findField("CALENDAR_NOTES").setValue("")}},"window[xtype=calendar.eventeditwindow] button[ref=save]":{click:function(e){var n=e.up("window"),t=n.down("form"),o=t.form.findField("JE_SYS_CALENDAR_ID").getValue(),i=t.form.findField("CALENDAR_NOTES").getValue();if(JE.isEmpty(i))return JE.msg("请填写内容！");JE.submit(t,{async:!1,params:{tableCode:"JE_SYS_CALENDAR"},url:JE.getUrlMaps("je.core.calendar",Ext.isEmpty(o)?"doSave":"doUpdate"),success:function(e,t){var i,a=t.result.obj;(e.setValues(a),Ext.isEmpty(o))?(JE.msg(JE.getLocalLang("common.saveSuccessAlert")),n.calendarStore&&(n.activeRecord=n.calendarStore.add(a)[0]),(i=n.calendarPanel)&&i.up("panel[xtype=calendar.mainview]").down("panel[xtype=calendar.mytasktree]").getStore().load()):(JE.msg(JE.getLocalLang("common.updateSuccessAlert")),(i=n.calendarPanel)&&i.up("panel[xtype=calendar.mainview]").down("panel[xtype=calendar.mytasktree]").getStore().load());n.activeRecord&&n.updateRecord(n.activeRecord),n.callback&&n.callback(Ext.isEmpty(o)?"add":"update",a),n.fireEvent(Ext.isEmpty(o)?"eventadd":"eventupdate",n,n.activeRecord,n.animateTarget),n.onClose()}})}},"window[xtype=calendar.eventeditwindow] form field[name=CALENDAR_YESORNO_CODE]":{change:function(e,t,i){var a=e.up("form").form,n=a.findField("CALENDAR_STARTTIME"),o=a.findField("CALENDAR_ENDTIME");"1"==t?(n.format="Y-m-d",o.format="Y-m-d"):(n.format="Y-m-d H:i",o.format="Y-m-d H:i"),n.setValue(n.getValue()),o.setValue(o.getValue())}},"window[xtype=calendar.eventeditwindow] form field[name=CALENDAR_STARTTIME]":{change:function(e,t,i){var a=e.up("form").form.findField("CALENDAR_ENDTIME").getValue();if(!Ext.isEmpty(t)&&!Ext.isEmpty(a)){var n=JE.DATE.parseDateTime(t),o=JE.DATE.parseDateTime(a);n.getTime()>o.getTime()&&(JE.msg(JE.getLocalLang("sys.calendar.msg.timeAlert")),e.setValue(i))}}},"window[xtype=calendar.eventeditwindow] form field[name=CALENDAR_ENDTIME]":{change:function(e,t,i){var a=e.up("form").form.findField("CALENDAR_STARTTIME").getValue();if(!Ext.isEmpty(t)&&!Ext.isEmpty(a)){var n=JE.DATE.parseDateTime(t);JE.DATE.parseDateTime(a).getTime()>n.getTime()&&(JE.msg(JE.getLocalLang("sys.calendar.msg.timeAlert")),e.setValue(i))}}},"window[xtype=calendar.eventeditwindow] button[ref=delete]":{click:function(o){JE.confirm("确定删除吗？",function(e){if("ok"==e){var t=o.up("window"),i=t.down("form").form.findField("JE_SYS_CALENDAR_ID").getValue();if(Ext.isEmpty(i))JE.alert(JE.getLocalLang("sys.calendar.msg.cannotDeleteAlert"));else{var a=JE.ajax({url:JE.getUrlMaps("je.core.calendar","doRemove"),params:{tableCode:"JE_SYS_CALENDAR",ids:i}});if(a.success){JE.msg(JE.getLocalLang("common.deleteSuccessAlert"));var n=t.calendarPanel;if(n)n.up("panel[xtype=calendar.mainview]").down("panel[xtype=calendar.mytasktree]").getStore().load();t.callback&&t.callback("remove",i),t.fireEvent("eventdelete",t,t.activeRecord),t.close()}else JE.alert(a.obj)}}})}},"window[xtype=calendar.eventeditwindow] button[ref=close]":{click:function(e){e.up("window").close();var t=e.up("form").form;t.findField("CALENDAR_STARTTIME").setValue(""),t.findField("CALENDAR_ENDTIME").setValue(""),t.findField("CALENDAR_TITLE").setValue(""),t.findField("CALENDAR_NOTES").setValue("")}},"menu[xtype=calendar.treemenu] menuitem":{click:function(e){var t=e.up("menu[xtype=calendar.treemenu]").treePanel;s.doGroup(t,e.itemId)}},"panel[xtype=calendar.mytasktree]":{itemdblclick:function(e,t,i,a,n,o){var r=e.panel.up("panel[xtype=calendar.mainview]").down("panel[xtype=calendar.calendarpanel]"),l=r.calendarStore.findRecord("JE_SYS_CALENDAR_ID",t.get("id"));l?s.showEditWindow(r,l,t):s.showEditWindow(r,t.raw.bean,t)}},"panel[xtype=calendar.grouptree]":{load:function(e,t,i,a,n){var o=e.tree;Ext.iterate(o.nodeHash,function(e,t){"ROOT"!=e&&s.groupData.push(Ext.clone(t.data))})},selectionchange:function(e,t,i){var a=e.view.panel.up("panel[xtype=calendar.mainview]"),n=a.down("datepicker[name=CALENDAR_DATESELECT]"),o=n.getValue(),r=(a.down("panel[xtype=calendar.calendarpanel]"),a.calendarStore),l=t[0],s="";l&&(s=" AND CALENDAR_GROUPID='"+l.get("id")+"'"),r.proxy.extraParams.groupSql=s,n.fireEvent("select",n,o)}},"panel[xtype=calendar.sharetasktree]":{itemdblclick:function(e,t,i,a,n,o){var r=e.panel.up("panel[xtype=calendar.mainview]").down("panel[xtype=calendar.calendarpanel]"),l=r.calendarStore.findRecord("JE_SYS_CALENDAR_ID",t.get("id"));l?s.showEditWindow(r,l,t):s.showEditWindow(r,t.raw.bean,t)}},"panel[xtype=calendar.groupusergrid] button[ref=gridInsert]":{click:function(e){var t=e.up("panel[xtype=calendar.groupusergrid]"),i=t.up("window").down("panel[xtype=calendar.groupform]").form.findField("SY_CREATEUSER").getValue(),n=t.getStore(),o=new Array;n.each(function(e){o.push(e.get("GROUPUSER_USERID"))});var r=t.up("window").down("panel[xtype=calendar.groupform]").form.findField("JE_SYS_CALENDARGROUP_ID").getValue();JE.selectWin({parent:null,parentType:"self",title:JE.getLocalLang("sys.calendar.group.selectUserTitle"),configInfo:"JE_CORE_QUERYUSER,,,M",whereSql:" AND USERCODE!='"+i+"'",type:"grid",callback:function(e,t){var i=new Array;if(Ext.each(e,function(e){-1==o.indexOf(e.get("USERID"))&&i.push(e.get("USERID"))}),0<i.length)if(Ext.isEmpty(r))Ext.each(e,function(e){-1==o.indexOf(e.get("USERID"))&&n.add({GROUPUSER_GROUP_ID:e.get("USERID"),GROUPUSER_USERCODE:e.get("USERCODE"),GROUPUSER_USERNAME:e.get("USERNAME"),GROUPUSER_USERID:e.get("USERID"),GROUPUSER_DEPTNAME:e.get("DEPTNAME"),GROUPUSER_DEPTCODE:e.get("DEPTCODE"),GROUPUSER_DEPTID:e.get("DEPTID"),GROUPUSER_PERM:"INSERT,UPDATE"})[0].commit()}),JE.msg(JE.getLocalLang("sys.calendar.msg.importAlert"));else{var a=JE.ajax({url:JE.getUrlMaps("je.core.calendar","addGroupUsers"),params:{tableCode:"JE_SYS_CALENDARGROUP",JE_SYS_CALENDARGROUP_ID:r,ids:i.join(",")}});a.success?(Ext.each(a.obj,function(e){n.add(e)[0].commit()}),JE.msg(JE.getLocalLang("sys.calendar.msg.importAlert"))):JE.alert(a.obj)}},okButtonClick:function(t,e){var i=e.down("grid[xtype=query.selectedusergrid]");t.splice(0,t.length),i.getStore().each(function(e){t.push(e)})},sswinRender:function(e){var t=e.down("grid[xtype=query.selectedusergrid]");if(0<o.length){var i=JE.ajax({url:JE.getUrlMaps("je.core.rbac.rbac.load"),params:{tableCode:"JE_CORE_ENDUSER",limit:-1,whereSql:" AND USERID IN ('"+o.join("','")+"')"}});t.getStore().loadData(i.rows)}}})}},"panel[xtype=calendar.groupusergrid] button[ref=gridDelete]":{click:function(e){var a=e.up("panel[xtype=calendar.groupusergrid]"),n=a.up("window").down("panel[xtype=calendar.groupform]").form.findField("JE_SYS_CALENDARGROUP_ID").getValue(),o=a.getSelectionModel().getSelection();0<o.length?JE.confirm(JE.getLocalLang("common.deleteConfirm"),function(e){if("ok"==e){if(Ext.isEmpty(n))return a.getStore().remove(o),void JE.msg(JE.getLocalLang("common.deleteSuccessAlert"));var t=new Array;Ext.each(o,function(e){t.push(e.get("JE_SYS_GROUPUSER_ID"))});var i=JE.ajax({url:JE.getUrlMaps("je.core.calendar","doRemove"),params:{tableCode:"JE_SYS_GROUPUSER",ids:t.join(",")}});i.success?(a.getStore().remove(o),JE.msg(JE.getLocalLang("common.deleteSuccessAlert"))):JE.alert(i.obj)}}):JE.alert(JE.getLocalLang("sys.calendar.msg.selectAlert"))}},"panel[xtype=calendar.groupform]":{validitychange:function(e,t,i){var a=e.owner.up("window").down("panel[xtype=calendar.groupusergrid]");e.findField("SY_CREATEUSER").getValue()==JE.currentUser.userCode?a.doReadOnly(!t):a.doReadOnly(!0)}}};s.control(e)},views:["JE.sys.calendar.MainView","JE.sys.calendar.CalendarPanel","JE.sys.calendar.view.AbstractCalendar","JE.sys.calendar.view.Day","JE.sys.calendar.view.DayBody","JE.sys.calendar.view.DayHeader","JE.sys.calendar.view.Month","JE.sys.calendar.view.MonthDayDetail","JE.sys.calendar.view.Week","JE.sys.calendar.form.EventWindow","JE.sys.calendar.tree.GroupTree","JE.sys.calendar.tree.MyTaskTree","JE.sys.calendar.tree.ShareTaskTree","JE.sys.calendar.WestView","JE.sys.calendar.tree.TreeMenu","JE.sys.calendar.group.GroupForm","JE.sys.calendar.group.GroupUserGrid"]}),Ext.define("JE.sys.configuration.view.ConfigurationForm",{extend:"Ext.form.Panel",alias:"widget.configuration.configurationform",frame:!1,layout:"column",autoScroll:!0,bodyStyle:{background:"#f1f1f1"},bodyPadding:"10 20 0 20",defaults:{xtype:"fieldset",basicColor:"#373650",margin:"5 0 0 0 ",padding:"0 10",layout:"column",collapsible:!0,columnWidth:1,defaults:{xtype:"textfield",labelAlign:"top",margin:"5 2",columnWidth:.25,labelSeparator:" ",labelStyle:"font-weight:bold;padding-bottom:6px;"}},tbar:{cls:"je-button-bar",items:[{ref:"save",text:"保存",formBind:!0,iconCls:"jeicon jeicon-save"}]},initComponent:function(){this.items=[{title:'界面设置<span style="margin-left:50px;font-size:12px;">注意：本表单信息记录在数据表JE_CORE_SETTING中。</span>',basicColor:"#3C8DBC",items:[{fieldLabel:"皮肤",hidden:!0,fieldBodyStyle:"padding:0px",columnWidth:1,xtype:"rgroup",name:"JE_SYS_THEME",dataArray:[{code:"plus",text:"科技灰(JEPLUS专有皮肤)"},{code:"default",text:"经典蓝(传统皮肤)"},{code:"saas",text:"睿智黑(JESAAS使用皮肤)"}],value:"default"},{xtype:"fieldcontainer",columnWidth:.5,fieldLabel:"浏览器展示Logo",layout:"fit",hidden:!0,items:{xtype:"textfield",name:"JE_SYS_SYSLOGO",unitTpl:"像素:16*16、格式:ico"}},{fieldLabel:"页面Title",name:"JE_SYS_TITLE",columnWidth:.5},{fieldLabel:"版权信息",name:"JE_SYS_COPYRIGHT",columnWidth:.5},{xtype:"fieldcontainer",columnWidth:.5,fieldLabel:"首页头部Logo",hidden:!0,layout:"fit",items:{xtype:"textfield",name:"JE_SYS_LOGO",unitTpl:"格式:png"}},{fieldLabel:"首页头部英文标题",hidden:!0,name:"JE_SYS_EASYTITLE"},{fieldLabel:"首页头部中文标题",hidden:!0,name:"JE_SYS_FULLTITLE"},{fieldLabel:"首页空白提示HTML",hidden:!0,xtype:"textarea",name:"JE_SYS_HOMEEMPTYHTML",height:100,columnWidth:1},{xtype:"box",style:"border-left:5px solid #FF9933;background-color:#FFFFCC;color:#458FA6;padding:10px;border-radius: 4px 0px 0px 4px;font-family: tahoma,微软雅黑;font-weight: bold;",columnWidth:1,hidden:!0,html:"首页Logo组成：首页头部Logo+首页头部英文标题+首页头部中文标题。注意：在启动自定义样式后失效"},{xtype:"rgroup",fieldLabel:"首页信息启用自定义样式",name:"JE_SYS_ENABLEDHTML",hidden:!0,configInfo:"YESORNO",fieldBodyStyle:"padding:0px",columnWidth:1},{fieldLabel:"自定义头部HTML",xtype:"textarea",hidden:!0,name:"JE_SYS_HEADERHTML_PLUS",height:100,columnWidth:1},{fieldLabel:"经典灰皮肤自定义头部HTML",hidden:!0,xtype:"textarea",name:"JE_SYS_HEADERHTML_DEFAULT",height:100,columnWidth:1},{fieldLabel:"睿智黑皮肤自定义头部HTML",hidden:!0,xtype:"textarea",name:"JE_SYS_HEADERHTML_SAAS",height:100,columnWidth:1},{xtype:"box",style:"border-left:5px solid #FF9933;background-color:#FFFFCC;color:#458FA6;padding:10px;border-radius: 4px 0px 0px 4px;font-family: tahoma,微软雅黑;font-weight: bold;",columnWidth:1,hidden:!0,html:"以下配置项为设置首页头部背景样式。"},{fieldLabel:"背景颜色",xtype:"colorfield",hidden:!0,name:"JE_SYS_TOPBGCOLOR",columnWidth:.2},{fieldLabel:"字体颜色",hidden:!0,xtype:"colorfield",value:"#C0D7F8",name:"JE_SYS_TOPFONTCOLOR"},{fieldLabel:"字体划过颜色",hidden:!0,xtype:"colorfield",value:"#FFFFFF",name:"JE_SYS_TOPFONTOCOLOR"},{fieldLabel:"用户字体颜色",hidden:!0,xtype:"colorfield",value:"#FFFFFF",name:"JE_SYS_TOPUSERCOLOR"},{xtype:"fieldcontainer",columnWidth:.4,fieldLabel:"背景图片",hidden:!0,layout:"column",defaults:{columnWidth:.5},items:[{xtype:"yesnofield",boxLabel:"使用原始图片",name:"JE_SYS_TOPNOREPEAT"}]},{fieldLabel:"图片位置(X)",xtype:"cbbfield",editable:!0,hidden:!0,value:"left",columnWidth:.2,dataArray:[{code:"left",text:"left"},{code:"center",text:"center"},{code:"right",text:"right"},{code:"%",text:"%"},{code:"px",text:"px"}],name:"JE_SYS_TOPBGIMGX"},{fieldLabel:"图片位置(Y)",xtype:"cbbfield",columnWidth:.2,hidden:!0,editable:!0,value:"top",dataArray:[{code:"top",text:"top"},{code:"center",text:"center"},{code:"bottom",text:"bottom"},{code:"%",text:"%"},{code:"px",text:"px"}],name:"JE_SYS_TOPBGIMGY"}]},{title:"菜单设置",basicColor:"#373650",hidden:!0,items:[{fieldLabel:"个人信息位置",name:"JE_SYS_USERINFO",hidden:!0,xtype:"rgroup",fieldBodyStyle:"padding:0px",columnWidth:1,dataArray:[{code:"north",text:"菜单上方"},{code:"south",text:"菜单下方"},{code:"hide",text:"隐藏"}]},{xtype:"fieldcontainer",columnWidth:.5,fieldLabel:"模块限制数",hidden:!0,layout:"fit",items:{xtype:"numberfield",name:"JE_SYS_MODELNUM",minValue:0,unitTpl:"超出限制数，菜单整体变为树形"}},{xtype:"numberfield",fieldLabel:"菜单宽度",name:"JE_SYS_MENUWIDTH",minValue:100},{xtype:"numberfield",fieldLabel:"顶部菜单最大高度",name:"JE_SYS_TOPMENU_MAXHEIGHT",minValue:300},{xtype:"cbbfield",fieldLabel:"菜单类型",name:"JE_SYS_MENUTYPE",dataArray:[{text:"左侧菜单",code:"left"},{text:"左侧平铺菜单",code:"left-tiled"},{text:"顶部菜单",code:"top"},{text:"组合菜单",code:"lefttop"}]},,{xtype:"cbbfield",fieldLabel:"菜单导航",name:"JE_SYS_MENULOCATION",dataArray:[{code:"crumbs",text:"面包屑"},{code:"tabs",text:"功能标签"}]}]},{title:"运行设置",basicColor:"#466645",defaults:{xtype:"textfield",labelAlign:"top",margin:"5 2",columnWidth:1,labelSeparator:" ",labelStyle:"font-weight:bold;padding-bottom:6px;"},items:[{fieldLabel:"系统模式",fieldBodyStyle:"padding:0px;",xtype:"rgroup",hidden:!0,configInfo:"JE_SYSMODE",value:"0",name:"JE_SYSMODE"},{fieldLabel:"保存新建、复制先执行当前表单保存",fieldBodyStyle:"padding:0px;",xtype:"rgroup",configInfo:"YESORNO",value:"1",name:"JE_SYS_SAVETYPE",checkAll:!1},{fieldLabel:"前台采用弹窗提醒，去除调试提醒",fieldBodyStyle:"padding:0px;",xtype:"rgroup",configInfo:"YESORNO",value:"0",name:"JE_SYS_ERRORTYPE",checkAll:!1},{fieldLabel:"弹出功能窗口，右下角关闭按钮显示",fieldBodyStyle:"padding:0px;",xtype:"rgroup",configInfo:"YESORNO",value:"1",name:"JE_SYS_FORMWINCLOSEBTN",checkAll:!1},{fieldLabel:"流程审批界面方式",fieldBodyStyle:"padding:0px;",xtype:"rgroup",configInfo:"JE_WF_SUBMITTYPE",hidden:!0,value:"window",name:"JE_CORE_WFTYPE",checkAll:!1},{fieldLabel:"服务器性质",fieldBodyStyle:"padding:0px;",xtype:"rgroup",columnWidth:.8,configInfo:"JE_CORE_SERVERRUN",value:"ALL",name:"JE_CORE_SERVERRUN"},{fieldLabel:"子功能默认展示类型",fieldBodyStyle:"padding:0px;",xtype:"rgroup",configInfo:"JE_CHILDREN_LAYOUT",value:"1",name:"JE_FUNC_CHILDSHOWTYPE"},{xtype:"fieldcontainer",fieldLabel:"日志开关",layout:"hbox",defaults:{margin:"0 4 0 0"},items:[{xtype:"yesnofield",boxLabel:"异常日志",name:"JE_SYS_EXCEPTION"},{xtype:"yesnofield",boxLabel:"执行日志",name:"JE_SYS_EXECUITE"},{xtype:"yesnofield",boxLabel:"登录日志",name:"JE_SYS_LOGINLOG"},{xtype:"yesnofield",boxLabel:"移动端消息推送日志",hidden:!0,name:"JE_SYS_GETUILOG"},{xtype:"yesnofield",boxLabel:"短信日志",name:"JE_SYS_NOTELOG"},{xtype:"yesnofield",boxLabel:"邮件日志",name:"JE_SYS_EMAILLOG"},{xtype:"yesnofield",boxLabel:"RTX日志",hidden:!0,name:"JE_SYS_RTXLOG"},{xtype:"yesnofield",boxLabel:"按钮点击日志",name:"JE_SYS_BTNLOG"},{xtype:"yesnofield",boxLabel:"开发日志",name:"JE_SYS_DEVELOPLOG"}]},{xtype:"fieldcontainer",fieldLabel:"权限开关",layout:"hbox",defaults:{margin:"0 4 0 0"},items:[{xtype:"yesnofield",boxLabel:"权限分级管理",name:"JE_SYS_ADMINPERM"},{xtype:"yesnofield",boxLabel:"分公司过滤",name:"JE_SYS_COMPANYWHERE"},{xtype:"yesnofield",boxLabel:"权限申请",name:"JE_SYS_USERPERM",value:"1"},{xtype:"yesnofield",boxLabel:"代理设置",name:"JE_SYS_PROXYSET",value:"1"},{xtype:"yesnofield",boxLabel:"产品开发角色对其他人隐藏",name:"JE_SYS_ADMINROLESEE",value:"1"}]},{xtype:"fieldcontainer",fieldLabel:"其他开关",layout:"hbox",defaults:{margin:"0 4 0 0"},items:[{xtype:"yesnofield",boxLabel:"网络环境",name:"JE_SYS_INTERNET",value:"1"},{xtype:"yesnofield",boxLabel:"IM通讯",name:"JE_SYS_IMMSG",value:"1"},{xtype:"yesnofield",boxLabel:"启用PageOffice",name:"JE_SYS_PAGEOFFICE"},{xtype:"yesnofield",boxLabel:"验证码登录",name:"JE_CORE_JCAPTCHA",hidden:!0},{xtype:"yesnofield",boxLabel:"开启静态化",name:"JE_SYS_STATICIZE",hidden:!0},{xtype:"yesnofield",boxLabel:"启动加载字典",name:"JE_SYS_PRODICTIONARY"},{xtype:"yesnofield",boxLabel:"启用手机App",hidden:!0,name:"JE_SYS_APPPERM"},{xtype:"yesnofield",boxLabel:"提示音",name:"JE_SYS_PLAYAUDIO",value:"1"},{xtype:"yesnofield",boxLabel:"生态圈",name:"JE_SYS_CIRCLE",hidden:!0,value:"1"},{xtype:"yesnofield",boxLabel:"消息提醒",hidden:!0,name:"JE_SYS_MSGWARN",value:"1"},{xtype:"yesnofield",hidden:!0,boxLabel:"流程审批单击打开单据",name:"JE_SYS_WFITEMCLICK",value:"0"}]},{xtype:"box",columnWidth:1},{xtype:"fieldcontainer",columnWidth:.5,fieldLabel:"系统名称",value:"JEPaaS",layout:"fit",items:{xtype:"textfield",name:"JE_SYS_SYSTEM",value:"JEPAAS",unitTpl:"以系统名义发送短信、邮箱时的标识"}},{xtype:"box",columnWidth:1},{xtype:"fieldcontainer",columnWidth:.5,fieldLabel:"客服电话号码",value:"JEPaaS",layout:"fit",items:{xtype:"textfield",name:"JE_SYS_ERRORPHONE",value:"",unitTpl:"400电话号码，当系统出问题会显示该电话号码"}},{xtype:"box",columnWidth:1},{xtype:"fieldcontainer",columnWidth:.5,hidden:!0,fieldLabel:"tab展示功能个数",layout:"fit",items:{xtype:"textfield",name:"JE_SYS_MAINCOUNT",unitTpl:"超过限定功能个数时系统会提醒关闭"}},{xtype:"box",columnWidth:1},{xtype:"fieldcontainer",columnWidth:.5,fieldLabel:"访问地址",layout:"fit",items:{xtype:"textfield",name:"JE_SYS_LOCALADDRESS",unitTpl:"外网部署时请填写IP或者域名"}},{xtype:"box",columnWidth:1},{fieldLabel:"平台版本",hidden:!0,name:"JE_JEPF_VERSION",columnWidth:.5,readOnly:!0},{xtype:"fieldcontainer",columnWidth:1,fieldLabel:"加密设定",layout:"vbox",defaults:{xtype:"textfield",labelAlign:"right"},items:[{fieldLabel:"启用",xtype:"yesnofield",boxLabel:"请求加密",name:"JE_SYS_ENCRYPT"},{fieldLabel:"加密参数",hidden:!0,value:"whereSql,orderSql,tableCode,sql,pkValue,expandSql,parentSql,useOrderSql,funcCode,funcId,permSql",unitTpl:"设定前端加密的参数名，多个按逗号隔开 例如:tableCode,whereSql,funcCode",name:"JE_SYS_ENCRYPT_FIELD",unitTplStyle:"text-align:left;"},{fieldLabel:"密钥1",unitTpl:"设定加密算法的密钥1",name:"JE_SYS_ENCRYPT_KEY1",unitTplStyle:"text-align:left;"},{fieldLabel:"密钥2",unitTpl:"设定加密算法的密钥2",name:"JE_SYS_ENCRYPT_KEY2",unitTplStyle:"text-align:left;"},{fieldLabel:"密钥3",unitTpl:"设定加密算法的密钥3",name:"JE_SYS_ENCRYPT_KEY3",unitTplStyle:"text-align:left;"}]},{xtype:"box",columnWidth:1},{xtype:"fieldcontainer",columnWidth:.5,hidden:!0,fieldLabel:"解除URL加密值",layout:"fit",items:{name:"JE_CORE_PHONE",xtype:"textfield",unitTpl:"外部系统请求传入参数phone"}},{xtype:"box",columnWidth:1},{xtype:"fieldcontainer",columnWidth:.6,fieldLabel:"前台AJAX超时时间设定",layout:"fit",items:{name:"JE_CORE_AJAXTIMEOUT",xtype:"numberfield",hideTrigger:!0,decimalPrecision:0,unitTpl:"设置AJAX的超时时间，默认是 30秒 单位是秒"}},{xtype:"box",columnWidth:1},{fieldLabel:"websocket服务地址",fieldBodyStyle:"padding:0px;",name:"JE_CORE_WEBSOCKETURL",columnWidth:.5},{fieldLabel:"websocket业务服务地址",fieldBodyStyle:"padding:0px;",name:"JE_CORE_BACKWEBSOCKETURL",columnWidth:.5},{fieldLabel:"手机websocket服务地址",fieldBodyStyle:"padding:0px;",name:"JE_CORE_WEBSOCKETURL4APP",columnWidth:.5},{fieldLabel:"IM应用服务链接",fieldBodyStyle:"padding:0px;",name:"IM_PROXY_URL",columnWidth:.5},{xtype:"box",columnWidth:1},{fieldLabel:"批量加载模型",columnWidth:.5,name:"JE_SYS_MULTIMODELS"},{xtype:"fieldcontainer",columnWidth:.51,fieldLabel:"定时执行延时",hidden:!0,layout:"fit",items:{xtype:"numberfield",name:"JE_TASK_DELAY",hideTrigger:!0,decimalPrecision:0,enableTip:"当延时大于0会执行延时操作",value:0,unitTpl:"多台服务后，则可配置执行的延迟"}},{xtype:"fieldcontainer",columnWidth:.51,hidden:"0"==JE.systemConfig.JE_SYSMODE,fieldLabel:"每日租户注册限制",layout:"fit",items:{xtype:"numberfield",name:"JE_CORE_REGISTERNUM",hideTrigger:!0,decimalPrecision:0,value:0,unitTpl:"限制每日注册数量,如果为-1代表不启用"}},{xtype:"box",columnWidth:1},{xtype:"fieldcontainer",columnWidth:.5,fieldLabel:"超级管理员",layout:"fit",items:{xtype:"vueuserfield",configInfo:"JE_CORE_DEPTUSER,JE_SYS_ADMIN,code,M",name:"JE_SYS_ADMIN",unitTpl:"顶层管理员编码"}},{fieldLabel:"运维管理员",xtype:"vueuserfield",configInfo:"JE_CORE_DEPTUSER,JE_CORE_DEVOPSUSERNAMES~JE_CORE_DEVOPSUSERIDS,text~id,M",fieldBodyStyle:"padding:0px;",name:"JE_CORE_DEVOPSUSERNAMES",columnWidth:1},{fieldLabel:"运维管理员ID",hidden:!0,name:"JE_CORE_DEVOPSUSERIDS"},{fieldLabel:"超级管理员专属菜单",xtype:"treessareafield",configInfo:"JE_CORE_MENU,JE_CORE_ADMINMENU_NAME~JE_CORE_ADMINMENU_ID,text~id,M",fieldBodyStyle:"padding:0px;",name:"JE_CORE_ADMINMENU_NAME",columnWidth:1},{fieldLabel:"管理员菜单ID",hidden:!0,name:"JE_CORE_ADMINMENU_ID"},{xtype:"jsonarrayfield",columns:[{text:"执行Bean",dataIndex:"key",flex:.3},{text:"执行方法",dataIndex:"value",flex:.7}],fieldLabel:"启动服务执行",name:"JE_SYS_STARTUP"},{xtype:"jsonarrayfield",height:400,columns:[{text:"启用",dataIndex:"enabled",flex:.05,field:{xtype:"cbbfield",configInfo:"YESORNO"},tactics:[{bgCss:!0,type:"dic",dicCode:"YESORNO"}],renderer:JE.renderer},{text:"URL链接",dataIndex:"url",flex:.4},{text:"用途",dataIndex:"remark",flex:.55}],defaultRecordValue:{enabled:"1"},fieldLabel:"URL过滤",name:"JE_SYS_URLPATTERN"},{xtype:"textarea",name:"JE_SYS_SETTINGHTML",hidden:!0,height:100,fieldLabel:"用户设定底部设定HTML",value:'<img src="'+JE.getStaticUrl("JE.common.logo-small")+'" style="width: 20px;height: 20px;vertical-align: top;"><a href="http://www.jeplus.cn" target="_black;" style="text-decoration: none;color: #a09c96;margin-left: 5px;">JEPLUS.CN INSIDE</a>'},{xtype:"textarea",name:"JE_SYS_SAASHTML",hidden:!0,height:100,fieldLabel:"商城头部HTML"},{xtype:"jsonarrayfield",height:200,hidden:!0,columns:[{text:"图标",dataIndex:"icon",flex:.2,field:{xtype:"gridssfield",configInfo:"JE_CORE_FONTICON,icon,FONTICON_CLS,S, "},renderer:JE.renderer},{text:"名称",dataIndex:"text",flex:.3},{text:"JS执行代码",dataIndex:"jsdm",flex:.5}],defaultRecordValue:{enabled:"1"},fieldLabel:"商城底部链接",name:"JE_SYS_SAASJS"},{fieldLabel:"图标版本",name:"JE_ICON_VERSION",hidden:!0,columnWidth:.5,readOnly:!0}]},{title:"登录服务",items:[{xtype:"fieldcontainer",fieldLabel:"登录设定",layout:"hbox",columnWidth:.9,defaults:{margin:"0 4 0 0"},items:[{xtype:"yesnofield",boxLabel:"PC同时登录",name:"JE_SYS_PCLOGIN",value:"0"},{xtype:"yesnofield",boxLabel:"手机同时登录",name:"JE_SYS_APPLOGIN",value:"0"},{xtype:"yesnofield",boxLabel:"启用SSO认证",name:"JE_CORE_SSOFLAG",value:"1"},{xtype:"yesnofield",boxLabel:"快捷登录",name:"JE_SYS_QUICKLOGIN",value:"1"},{xtype:"yesnofield",boxLabel:"微信快捷登录",name:"JE_SYS_WXQUICKLOGIN",value:"1"},{xtype:"yesnofield",boxLabel:"QQ快捷登录",name:"JE_SYS_QQQUICKLOGIN",value:"1"},{xtype:"yesnofield",boxLabel:"钉钉快捷登录",name:"JE_SYS_DDQUICKLOGIN",value:"1"}]},{xtype:"box",columnWidth:1},{fieldLabel:"登录方式",fieldBodyStyle:"padding:0px;",xtype:"cgroup",configInfo:"JE_CORE_VERIFY",value:"BM",name:"JE_CORE_VERIFY",checkAll:!1},{xtype:"box",columnWidth:1},{xtype:"fieldcontainer",columnWidth:.5,fieldLabel:"用户默认密码",value:"123456",layout:"fit",items:{xtype:"textfield",name:"JE_SYS_PASSWORD",unitTpl:"用户初始化时候的密码"}},{xtype:"box",columnWidth:1},{xtype:"fieldcontainer",columnWidth:.6,fieldLabel:"密码错误次数锁定账户",layout:"fit",items:{name:"JE_CORE_ERRORPW",xtype:"numberfield",hideTrigger:!0,decimalPrecision:0,value:0,unitTpl:"输入密码错误将用户锁定，设置3以下值表示不启动该功能"}},{xtype:"box",columnWidth:1},{fieldLabel:"token登录验证类",fieldBodyStyle:"padding:0px;",name:"JE_CORE_TOKENBEAN",columnWidth:.4},{fieldLabel:"token登录验证方法",fieldBodyStyle:"padding:0px;",name:"JE_CORE_TOKENMETHOD",columnWidth:.4},{fieldLabel:"SSO登录验证类",fieldBodyStyle:"padding:0px;",name:"JE_CORE_SSOBEAN",columnWidth:.4},{fieldLabel:"SSO登录验证方法",fieldBodyStyle:"padding:0px;",name:"JE_CORE_SSOMETHOD",columnWidth:.4}]},{title:"第三方服务",items:[{xtype:"fieldcontainer",columnWidth:1,fieldLabel:"微信登录",layout:"vbox",defaults:{xtype:"textfield",labelAlign:"right"},items:[{fieldLabel:"AppID",unitTpl:"应用ID(微信开放平台--\x3e网站应用，申请地址：https://open.weixin.qq.com)",name:"WX_LOGIN_APPID",unitTplStyle:"text-align:left;"},{fieldLabel:"AppSecret",unitTpl:"应用KEY(如果APP登录跟网站登录同步，则需要在开放平台将移动应用跟网站应用绑定)",name:"WX_LOGIN_APPSECRET",unitTplStyle:"text-align:left;"},{fieldLabel:"访问域名",unitTpl:"系统访问域名，格式为：www.baidu.com",name:"WX_LOGIN_APPURL",unitTplStyle:"text-align:left;"}]},{xtype:"fieldcontainer",columnWidth:1,fieldLabel:"QQ登录",layout:"vbox",defaults:{xtype:"textfield",labelAlign:"right"},items:[{fieldLabel:"AppID",unitTpl:"应用ID(QQ互联开放平台，申请地址：https://connect.qq.com/index.html,)",name:"QQ_LOGIN_APPID",unitTplStyle:"text-align:left;"},{fieldLabel:"AppKey",unitTpl:"应用ID(如果APP登录跟网站登录同步,则需发送邮件打通网站跟移动应用，参考：http://www.jianshu.com/p/5775fcead59b)",name:"QQ_LOGIN_APPKEY",unitTplStyle:"text-align:left;"},{fieldLabel:"访问域名",unitTpl:"系统访问域名，格式为：www.baidu.com",name:"QQ_LOGIN_APPURL",unitTplStyle:"text-align:left;"}]},{xtype:"fieldcontainer",columnWidth:1,fieldLabel:"企业微信",layout:"vbox",defaults:{xtype:"textfield",labelAlign:"right"},items:[{fieldLabel:"CorpId",unitTpl:"微信企业号AppId",name:"JE_WXCP_CORPID",width:440,unitTplStyle:"text-align:left;"},{fieldLabel:"通讯录CorpSecret",name:"JE_WXCP_USERCORPSECRET",unitTpl:"用户API管理企业用户的Secret",width:520,unitTplStyle:"text-align:left;"},{fieldLabel:"消息CorpSecret",name:"JE_WXCP_CORPSECRET",unitTpl:"用户给企业用户发送消息的Secret",width:540,unitTplStyle:"text-align:left;"},{fieldLabel:"AgentId",name:"JE_WXCP_AGENTID",unitTpl:"微信企业号应用ID",width:443,unitTplStyle:"text-align:left;"},{fieldLabel:"管理员帐号",name:"JE_WXCP_ADMINID",unitTpl:"指定企业微信中管理员帐号，多个按逗号隔开.",width:620,unitTplStyle:"text-align:left;"},{fieldLabel:"邀请标题",name:"JE_WXCP_JOINTITLE",unitTpl:"邀请用户加入的标题..",width:700,unitTplStyle:"text-align:left;"},{fieldLabel:"邀请链接",name:"JE_WXCP_JOINURL",unitTpl:"邀请用户加入的链接..",width:700,unitTplStyle:"text-align:left;"}]},{xtype:"fieldcontainer",columnWidth:1,fieldLabel:"微信公众平台",layout:"vbox",defaults:{xtype:"textfield",labelAlign:"right"},items:[{fieldLabel:"AppID",unitTpl:"应用ID",name:"WX_GZH_APPID",width:370,unitTplStyle:"text-align:left;"},{fieldLabel:"AppSecret",name:"WX_GZH_APPSECRET",unitTpl:"应用秘钥",width:384,unitTplStyle:"text-align:left;"},{fieldLabel:"URL",name:"WX_GZH_URL",unitTpl:"服务器地址",width:397,unitTplStyle:"text-align:left;"},{fieldLabel:"Token",unitTpl:"令牌",name:"WX_GZH_TOKEN",width:365,unitTplStyle:"text-align:left;"},{fieldLabel:"EncodingAESKey",unitTpl:"消息加解密秘钥",name:"WX_GZH_ENCODINGAESKEY",width:425,unitTplStyle:"text-align:left;"}]},{xtype:"fieldcontainer",columnWidth:1,fieldLabel:"微信开放平台",layout:"vbox",defaults:{xtype:"textfield",labelAlign:"right"},items:[{fieldLabel:"AppID",name:"WX_KFPT_APPID",unitTpl:"应用ID",width:370,unitTplStyle:"text-align:left;"},{fieldLabel:"AppSecret",unitTpl:"应用秘钥",name:"WX_KFPT_APPSECRET",width:384,unitTplStyle:"text-align:left;"}]},{xtype:"fieldcontainer",columnWidth:1,fieldLabel:"微信网页支付",layout:"vbox",defaults:{xtype:"textfield",labelAlign:"right"},items:[{fieldLabel:"appId",name:"WX_PAY_PC_APP_ID",unitTpl:"公众帐号ID",width:372,unitTplStyle:"text-align:left;"},{fieldLabel:"mch_id",name:"WX_PAY_PC_MCH_ID",unitTpl:"商户ID",width:372,unitTplStyle:"text-align:left;"},{fieldLabel:"key",name:"WX_PAY_PC_KEY_ID",unitTpl:"MD5 安全检验码",width:372,unitTplStyle:"text-align:left;"},{fieldLabel:"attach",unitTpl:"额外参数",hidden:!0,name:"WX_PAY_PC_ATTACH",width:387,unitTplStyle:"text-align:left;"},{fieldLabel:"spbill_create_ip",unitTpl:"用户终端IP",name:"WX_PAY_PC_SPBILL_CREATE_IP",width:400,unitTplStyle:"text-align:left;"},{fieldLabel:"系统访问域名",name:"WX_PAY_PC_SYS_URL",unitTpl:"系统访问域名，格式为：www.baidu.com",width:575,unitTplStyle:"text-align:left;"}]},{xtype:"fieldcontainer",columnWidth:1,fieldLabel:"微信APP支付",layout:"vbox",defaults:{xtype:"textfield",labelAlign:"right"},items:[{fieldLabel:"mch_id",name:"WX_APP_MCH_ID",unitTpl:"商户ID",width:360,unitTplStyle:"text-align:left;"},{fieldLabel:"body_name",unitTpl:"商户名称",name:"WX_APP_BODY_NAME",width:373,unitTplStyle:"text-align:left;"},{fieldLabel:"attach",unitTpl:"附件数据",name:"WX_APP_ATTACH",width:373,unitTplStyle:"text-align:left;"},{fieldLabel:"spbill_create_ip",unitTpl:"用户终端IP",name:"WX_APP_SPBILL_CREATE_IP",width:386,unitTplStyle:"text-align:left;"},{fieldLabel:"notify_url",unitTpl:"通知地址-必填",name:"WX_APP_NOTIFY_URL",width:410,unitTplStyle:"text-align:left;"},{fieldLabel:"trade_type",unitTpl:"交易类型",name:"WX_APP_TRADE_TYPE",value:"APP",width:375,unitTplStyle:"text-align:left;"}]},{xtype:"fieldcontainer",columnWidth:1,fieldLabel:"支付宝支付",layout:"vbox",defaults:{xtype:"textfield",labelAlign:"right"},items:[{fieldLabel:"PARTNER",name:"ZFB_PAY_PC_PARTNER",unitTpl:"合作身份者ID，签约账号",width:490,unitTplStyle:"text-align:left;"},{fieldLabel:"seller_id",name:"ZFB_PAY_PC_SELLER_ID",unitTpl:"收款支付宝账号,一般情况下收款账号就是签约账号",width:651,unitTplStyle:"text-align:left;"},{fieldLabel:"KEY",name:"ZFB_PAY_PC_KEY_ID",unitTpl:"MD5安全检验码",width:651,unitTplStyle:"text-align:left;"},{fieldLabel:"sign_type",name:"ZFB_PAY_PC_SIGN_TYPE",unitTpl:"验签及签名方式",width:651,unitTplStyle:"text-align:left;"},{fieldLabel:"log_path",name:"ZFB_PAY_PC_LOG_PATH",unitTpl:"pc版支付日志路径",width:651,unitTplStyle:"text-align:left;"},{hidden:!0,fieldLabel:"SIGN_ALGORITHMS",name:"ZFB_PAY_PC_SIGN_ALGORITHMS",value:"SHA1WithRSA",unitTpl:"加密类型",width:390,unitTplStyle:"text-align:left;"},{hidden:!0,fieldLabel:"PRIVATE_KEY",name:"ZFB_PC_PRIVATE_KEY",unitTpl:"支付宝私钥",width:405,unitTplStyle:"text-align:left;"},{hidden:!0,fieldLabel:"ALI_PUBLIC_KEY",name:"ZFB_PC_ALI_PUBLIC_KEY",unitTpl:"支付宝公钥",width:405,unitTplStyle:"text-align:left;"},{hidden:!0,fieldLabel:"KEY",name:"ZFB_PC_KEY",unitTpl:"MD5密钥，安全检验码",width:467,unitTplStyle:"text-align:left;"},{fieldLabel:"NOTIFY_URL",name:"ZFB_PC_SYS_URL",unitTpl:"系统访问域名，格式为：www.baidu.com",width:580,unitTplStyle:"text-align:left;"},{hidden:!0,fieldLabel:"SIGN_TYPE",name:"ZFB_PC_SIGN_TYPE",unitTpl:"签名方式",value:"MD5",width:395,unitTplStyle:"text-align:left;"},{fieldLabel:"EXTER_INVOKE_IP",name:"ZFB_PC_EXTER_INVOKE_IP",unitTpl:"客户端的IP地址 非局域网的外网IP地址，如：221.0.0.1",width:688,unitTplStyle:"text-align:left;"}]},{xtype:"fieldcontainer",columnWidth:1,fieldLabel:"钉钉集成",layout:"vbox",defaults:{xtype:"textfield",labelAlign:"right"},items:[{fieldLabel:"APPID",name:"DINGTALK_APPID",unitTpl:"APPID",width:490,unitTplStyle:"text-align:left;"},{fieldLabel:"AppKey",unitTpl:"AppKey",name:"DINGTALK_APPKEY",unitTplStyle:"text-align:left;"},{fieldLabel:"访问域名",unitTpl:"系统访问域名，格式为：www.baidu.com",name:"DINGTALK_REDIRECT_URI",unitTplStyle:"text-align:left;"},{fieldLabel:"AGENTID",unitTpl:"钉钉AgentId",name:"DINGTALK_AGENT_ID",unitTplStyle:"text-align:left;"}]},{xtype:"fieldcontainer",columnWidth:1,fieldLabel:"阿里云存储 [工具类ThirdFileUtil]",layout:"vbox",defaults:{xtype:"textfield",labelAlign:"right",width:600},items:[{fieldLabel:"accessKeyId",unitTpl:"accessKeyId (系统分配给用户的，称为ID)",name:"ALIYUN_OSS_ACCESSKEYID",unitTplStyle:"text-align:left;"},{fieldLabel:"accessKeySecret",unitTpl:"系统分配给用户的，称为签名",name:"ALIYUN_OSS_ACCESSKEYSECRET",unitTplStyle:"text-align:left;"},{fieldLabel:"endPoint",unitTpl:"阿里云服务器地址(不带http://，例如：oss-cn-beijing.aliyuncs.com)",name:"ALIYUN_OSS_ENDPOINT",width:800,unitTplStyle:"text-align:left;"},{fieldLabel:"bucketName",unitTpl:"Bucket是OSS上的命名空间",name:"ALIYUN_OSS_BUCKETNAME",unitTplStyle:"text-align:left;"}]},{xtype:"fieldcontainer",columnWidth:1,fieldLabel:"阿里云名片识别 [工具类AliOCRUtil]",layout:"vbox",defaults:{xtype:"textfield",labelAlign:"right",width:600},items:[{fieldLabel:"host",unitTpl:"host",name:"ALIYUN_OSS_HOST",unitTplStyle:"text-align:left;"},{fieldLabel:"path",unitTpl:"alibaba.ocr.path",name:"ALIYUN_OCR_PATH",unitTplStyle:"text-align:left;"},{fieldLabel:"appkey",unitTpl:"alibaba.ocr.appkey",name:"ALIYUN_OCR_APPKEY",unitTplStyle:"text-align:left;"},{fieldLabel:"appsecret",unitTpl:"alibaba.ocr.appsecret",name:"ALIYUN_OCR_APPSECRET",unitTplStyle:"text-align:left;"},{fieldLabel:"appcode",unitTpl:"alibaba.ocr.appcode",name:"ALIYUN_OCR_APPCODE",unitTplStyle:"text-align:left;"}]},{xtype:"fieldcontainer",columnWidth:1,fieldLabel:"阿里云高德地图IP识别 [工具类AliIpAddressUtil]",layout:"vbox",defaults:{xtype:"textfield",labelAlign:"right",width:600},items:[{fieldLabel:"host",unitTpl:"amap.ip.host",name:"ALIYUN_IP_HOST",unitTplStyle:"text-align:left;"},{fieldLabel:"path",unitTpl:"amap.ip.path",name:"ALIYUN_IP_PATH",unitTplStyle:"text-align:left;"},{fieldLabel:"appkey",unitTpl:"amap.ip.appkey",name:"ALIYUN_IP_APPKEY",unitTplStyle:"text-align:left;"},{fieldLabel:"appsecret",unitTpl:"amap.ip.appsecret",name:"ALIYUN_IP_APPSECRET",unitTplStyle:"text-align:left;"},{fieldLabel:"appcode",unitTpl:"amap.ip.appcode",name:"ALIYUN_IP_APPCODE",unitTplStyle:"text-align:left;"}]},{xtype:"fieldcontainer",columnWidth:1,fieldLabel:"工商查询253接口 [工具类Company235Util]",layout:"vbox",defaults:{xtype:"textfield",labelAlign:"right",width:600},items:[{fieldLabel:"appId",unitTpl:"appId",name:"COMPANY_253_APPID",unitTplStyle:"text-align:left;"},{fieldLabel:"appKey",unitTpl:"appKey",name:"COMPANY_253_APPKEY",unitTplStyle:"text-align:left;"},{fieldLabel:"API_URL",unitTpl:"API_URL",name:"COMPANY_253_APIURL",unitTplStyle:"text-align:left;"},{fieldLabel:"KEY_TYPE",unitTpl:"KEY_TYPE",name:"COMPANY_253_KEYTYPE",unitTplStyle:"text-align:left;"},{fieldLabel:"SEARCH_API_URL",unitTpl:"SEARCH_API_URL",name:"COMPANY_253_SEARCHAPIURL",unitTplStyle:"text-align:left;"}]},{xtype:"fieldcontainer",columnWidth:1,fieldLabel:"短信253接口 [工具类Note235Util]",layout:"vbox",defaults:{xtype:"textfield",labelAlign:"right",width:600},items:[{fieldLabel:"username",unitTpl:"username",name:"NOTE_253_USERNAME",unitTplStyle:"text-align:left;"},{fieldLabel:"passWord",unitTpl:"passWord",name:"NOTE_253_PASSWORD",unitTplStyle:"text-align:left;"},{fieldLabel:"sign",unitTpl:"sign",name:"NOTE_253_SIGN",unitTplStyle:"text-align:left;"},{fieldLabel:"report",unitTpl:"report",name:"NOTE_253_REPORT",unitTplStyle:"text-align:left;"},{fieldLabel:"sendUrl",unitTpl:"sendUrl",name:"NOTE_253_SENDURL",unitTplStyle:"text-align:left;"}]}]},{title:"功能默认",hidden:!0,items:[{xtype:"numberfield",fieldLabel:"每页展示条数",name:"JE_SYS_FUNCLIMIT"},{xtype:"numberfield",fieldLabel:"表单列数",name:"JE_SYS_FUNCFORM"},{xtype:"numberfield",fieldLabel:"审批展示条数",name:"JE_SYS_WFLIMIT"},{xtype:"rgroup",fieldLabel:"列表对齐方式",name:"JE_SYS_FUNCCOLUMNALIGN",configInfo:"JE_CORE_ALIGN"}]},{title:"消息服务",items:[{xtype:"fieldcontainer",columnWidth:1,fieldLabel:"调试",defaults:{margin:"0 20 0 0"},items:[{xtype:"button",text:"邮箱",ref:"email",code:"message",iconCls:"jeicon jeicon-mail-message"},{xtype:"button",text:"短信",ref:"note",code:"message",iconCls:"jeicon jeicon-message"},{xtype:"button",text:"RTX",hidden:!0,ref:"rtx",code:"message",iconCls:"jeicon jeicon-alert"},{xtype:"button",text:"代码",ref:"jstest",iconCls:"jeicon jeicon-function"}]},{columnWidth:.5,xtype:"rgroup",value:"SYS",configInfo:"JE_CORE_NOTETYPE",fieldLabel:"短信发送方式",name:"JE_SYS_NOTEDIY"},{fieldLabel:"每天发送短信最大数",xtype:"numberfield",name:"JE_SYS_NOTE_COUNT",columnWidth:.5},{fieldLabel:"网建短信服务用户名",name:"JE_SYS_NOTE_USER"},{xtype:"fieldcontainer",columnWidth:.6,fieldLabel:"网建短信服务密码",layout:"fit",items:{xtype:"textfield",name:"JE_SYS_NOTE_PASSWORD",unitTpl:"服务申请地址：http://www.smschinese.cn"}},{fieldLabel:"RTX服务器IP",hidden:!0,name:"JE_SYS_RTXIP"},{fieldLabel:"RTX服务器端口",hidden:!0,name:"JE_SYS_RTXPORT"},{xtype:"box",columnWidth:1},{fieldLabel:"邮箱服务器",name:"JE_SYS_EMAIL_SERVERHOST",columnWidth:.2},{fieldLabel:"邮箱服务器端口",columnWidth:.2,name:"JE_SYS_EMAIL_SERVERPORT"},{fieldLabel:"邮箱管理员帐号",columnWidth:.2,name:"JE_SYS_EMAIL_USERNAME"},{fieldLabel:"邮箱管理员密码",name:"JE_SYS_EMAIL_PASSWORD",columnWidth:.2},{xtype:"yesnofield",fieldLabel:"邮箱服务使用身份验证",name:"JE_SYS_EMAIL_SERVERVALIDATE",columnWidth:.2,boxLabel:"使用"}]},{title:"文档管理",items:[{xtype:"fieldcontainer",fieldLabel:"文档设定",layout:"hbox",defaults:{margin:"0 4 0 0"},items:[{xtype:"yesnofield",boxLabel:"隐藏多附件文件库",name:"JE_FILES_HIDEFILES",value:"1"},{xtype:"yesnofield",boxLabel:"隐藏多附件公司文件库",name:"JE_FILES_HIDECOMPANYFILES",value:"1"},{xtype:"yesnofield",boxLabel:"隐藏多附件移动",name:"JE_FILES_HIDEMOVEFILES",value:"1"}]},{xtype:"queryuserfield",name:"JE_SYS_DOCADMIN",columnWidth:1,configInfo:"JE_CORE_QUERYUSER,JE_SYS_DOCADMIN~JE_SYS_DOCADMINID,USERNAME~USERID,M",fieldLabel:"文库管理员",otherConfig:JE.toStr({DEPT:"1",SENTRY:"1",ROLE:"1",WORKGROUP:"1",QUICKQUERY:"NONE"})},{xtype:"hidden",name:"JE_SYS_DOCADMINID",fieldLabel:"文库管理员ID"},{xtype:"cbblistfield",fieldLabel:"文件格式",columnWidth:1,name:"JE_SYS_DOCFILETYPE",configInfo:"JE_SYS_DOCFILETYPE",typeConfig:{value:"office"},valueConfig:{emptyText:"请输入文件后缀名，多个用逗号隔开。"},value:'[{"code":"office","text":"","value":""}]'}]},{title:"工作服务",items:[{fieldLabel:"工作日",xtype:"cgroup",columnWidth:1,checkAll:!1,fieldBodyStyle:"padding:0px",configInfo:"JE_CALENDAR_WEEK",name:"JE_CALENDAR_WORKDAYS"},{xtype:"cbblistfield",fieldLabel:"节假日",columnWidth:.4,name:"JE_CALENDAR_FESTIVAL",configInfo:"JE_CALENDAR_FESTIVAL",typeConfig:{value:"CJ"},valueConfig:{xtype:"datetimefield",dateType:"date",submitFormat:"m-d",format:"m月d日",multiSelect:!0},value:'[{"code":"CJ","text":"","value":""}]'},{xtype:"fieldcontainer",columnWidth:1,fieldLabel:"工作时间(上午)",layout:"hbox",items:[{xtype:"cbbfield",configInfo:"JE_CALENDAR_HOURS",decimalPrecision:0,width:170,name:"JE_CALENDAR_WORKBEGINTIMEAM",value:"8"},{xtype:"cbbfield",configInfo:"JE_CALENDAR_HOURS",value:"12",decimalPrecision:0,fieldLabel:"~",labelWidth:20,width:200,labelSeparator:"",name:"JE_CALENDAR_WORKENDTIMEAM"}]},{xtype:"fieldcontainer",columnWidth:1,layout:"hbox",fieldLabel:"工作时间(下午)",items:[{xtype:"cbbfield",configInfo:"JE_CALENDAR_HOURS",decimalPrecision:0,name:"JE_CALENDAR_WORKBEGINTIMEPM",width:170,value:"13"},{xtype:"cbbfield",configInfo:"JE_CALENDAR_HOURS",value:"18",decimalPrecision:0,fieldLabel:"~",labelWidth:20,width:200,labelSeparator:"",name:"JE_CALENDAR_WORKENDTIMEPM"}]}]}],this.callParent()}}),Ext.define("JE.sys.configuration.view.MainView",{extend:"Ext.panel.Panel",border:0,layout:"fit",alias:"widget.configuration.mainview",bodyPadding:2,items:[{xtype:"configuration.configurationform"}]}),Ext.define("JE.sys.configuration.controller.ConfigurationController",{extend:"Ext.app.Controller",init:function(){var self=this,ctr={"panel[xtype=configuration.configurationform] button[ref=save]":{click:function(e){var i=e.up("panel[xtype=configuration.configurationform]"),a=[];Ext.iterate(i.form.getValues(),function(e,t){i.form.findField(e)&&a.push(e)}),a.push("JE_SYS_TOPBGIMG"),JE.submit(i,{async:!1,params:{allFields:a.join(",")},url:JE.getUrlMaps("je.core.sys.config","writeSysVariables"),success:function(e,t){var i=t.result.obj;Ext.each(["SAAS","DEFAULT","PLUS"],function(e){delete i["JE_SYS_HEADERHTML_"+e]}),delete i.JE_SYS_HOMEEMPTYHTML,delete i.JE_SYS_ENABLEDHTML,delete i.JE_SYS_SAASHTML,delete i.JE_SYS_SETTINGHTML,e.setValues(i),JE.msg("保存成功!")}})}},"panel[xtype=configuration.configurationform] button[code=message]":{click:function(e){var t=e.ref,i="",a="";switch(t){case"email":i="邮件发送",a="邮箱地址";break;case"note":i="短信发送",a="手机号";break;case"rtx":i="腾讯通RTX发送",a="RTX帐号"}self.sendMsg(i,a,t)}},"panel[xtype=configuration.configurationform] button[ref=jstest]":{click:function(btn){JE.win({autoShow:!0,title:"JS脚本调试",items:[{xtype:"jecodeeditor",region:"center",itemId:"editorview",border:0,value:" /**\n* 平台提示,不用可以随时删除这段注释.\n* var func = JE.getFunc('功能编码'),//得到功能对象\n*     kqtree = func.treeview,//得到快速查询树对象\n*     mainRecord = func.getParentData();//得到父亲功能对象\n* var formRecord = func.getFormData();//如果是表单按钮就可以得到本功能表单里的数据\n*     var fieldValue = formRecord.fieldCode;\n* var form = func.formview;//得到表单对象,findField(fieldName)找到字段组件\n* var basicForm = form.form;\n*/\n\n\n\n",saveFn:function(val){JE.isNotEmpty(val)&&eval(val)}}]})}},"panel[xtype=configuration.configurationform]":{afterrender:function(e){var t=JE.ajax({url:JE.getUrlMaps("je.core.sys.config","loadSysVariables")});t.success&&e.form.setValues(t.obj)}}};self.control(ctr)},sendMsg:function(e,a,n){JE.formWin({title:e,width:450,height:300,border:0,layout:"column",formConfig:{bodyStyle:{background:"#f1f1f1"},bodyPadding:"10 10 0 10"},frame:!1,autoShow:!0,items:[{xtype:"textfield",columnWidth:.9,fieldLabel:a,allowBlank:!1,name:"value"},{xtype:"textarea",columnWidth:.9,height:150,fieldLabel:"内容",allowBlank:!1,name:"context"}],fn:function(e,t){if(Ext.isEmpty(e.value))return JE.alert(a+"不能为空!"),!1;if(Ext.isEmpty(e.context))return JE.alert("内容不能为空!"),!1;e.type=n;var i=JE.ajax({url:JE.getUrlMaps("je.core.message.message","sendMsg"),params:e});if(!i.success)return JE.alert(i.obj),!1;JE.msg(i.obj)}})},views:["JE.sys.configuration.view.MainView","JE.sys.configuration.view.ConfigurationForm"]}),Ext.define("JE.sys.dd.controller.DictionaryController",{extend:"Ext.app.Controller",init:function(){var e={"jeformview[id=JE_CORE_DICTIONARY_jeformview] field[name=DICTIONARY_DDTYPE]":{change:function(e,t,i){var a=Ext.getCmp("JE_CORE_DICTIONARY_jeformview").getForm(),n=a.findField("DICTIONARY_SQLCONFIG"),o=a.findField("DICTIONARY_SQL"),r=a.findField("DICTIONARY_CLASSNAME").getValue(),l=Ext.getCmp("JE_CORE_DICTIONARY_childs_form_H");t&&("LIST"==t||"DYNA_TREE"==t&&Ext.isEmpty(r)?(l.show(),n.hide(),o.hide()):"SQL"==t?(l.hide(),n.show(),o.show()):(n.hide(),o.hide(),l.hide()))}}};this.control(e)}}),Ext.define("JE.sys.dd.controller.DictionaryItemController",{extend:"Ext.app.Controller",init:function(){var e={"jegridview[id=JE_CORE_DICTIONARYITEM_jegridview] uxcolumn[dataIndex=DICTIONARYITEM_BACKGROUNDCOLOR] field[name=DICTIONARYITEM_BACKGROUNDCOLOR]":{change:function(e,t,i){var a=Ext.getCmp("JE_CORE_DICTIONARYITEM_jegridview"),n=a.down("uxcolumn[dataIndex=DICTIONARYITEM_ITEMNAME]").down("field[name=DICTIONARYITEM_ITEMNAME]"),o=a.down("uxcolumn[dataIndex=DICTIONARYITEM_FONTCOLOR]").down("field[name=DICTIONARYITEM_FONTCOLOR]").getValue(),r=Ext.isEmpty(t)?"#fff":"#"+t;o=Ext.isEmpty(o)?"#000":"#"+o,n.inputEl.setStyle({backgroundImage:"none",backgroundColor:r,color:o})}},"jegridview[id=JE_CORE_DICTIONARYITEM_jegridview] uxcolumn[dataIndex=DICTIONARYITEM_FONTCOLOR] field[name=DICTIONARYITEM_FONTCOLOR]":{change:function(e,t,i){var a=Ext.getCmp("JE_CORE_DICTIONARYITEM_jegridview"),n=a.down("uxcolumn[dataIndex=DICTIONARYITEM_ITEMNAME]").down("field[name=DICTIONARYITEM_ITEMNAME]"),o=a.down("uxcolumn[dataIndex=DICTIONARYITEM_BACKGROUNDCOLOR]").down("field[name=DICTIONARYITEM_BACKGROUNDCOLOR]").getValue(),r=Ext.isEmpty(o)?"#fff":"#"+o,l=Ext.isEmpty(t)?"#000":"#"+t;n.inputEl.setStyle({backgroundImage:"none",backgroundColor:r,color:l})}},"jegridview[id=JE_CORE_DICTIONARYITEM_jegridview] gridcolumn[dataIndex=DICTIONARYITEM_ITEMNAME]":{render:function(e,t){e.renderer=function(e,t,i,a,n,o,r,l,s){var d=i.get("DICTIONARYITEM_BACKGROUNDCOLOR"),c=i.get("DICTIONARYITEM_FONTCOLOR");return d=Ext.isEmpty(d)?"none":"#"+d,c=Ext.isEmpty(c)?"none":"#"+c,t.tdAttr+=' style="background-color:'+d+";color:"+c+';"',e}}}};this.control(e)}}),Ext.define("JE.sys.icon.controller.IconController",{extend:"Ext.app.Controller",init:function(){var e={"jegridview[id=JE_SYS_ICON_jegridview] button[ref=generateCSS]":{click:function(e){var t=JE.ajax({url:JE.getUrlMaps("je.core.icon","generateCSS")});t.success?JE.msg("CSS初始化成功，请刷新页面!"):alert(t.obj)}},"jeformview[id=JE_SYS_ICON_jeformview] field[name=ICON_PATH]":{change:function(e,t,i){var a=e.up("#JE_SYS_ICON_jeformview").getForm();if(!Ext.isEmpty(t)){var n=a.findField("ICON_FORMAT"),o=t.lastIndexOf("."),r=null;0<=o&&(r=t.substring(o+1).toLowerCase()),!Ext.isEmpty(n.getValue())&&n.getValue()==r||n.setValue(r)}}}};this.control(e)}}),Ext.define("JE.sys.menu.store.menuStore",{extend:"Ext.data.TreeStore",defaultRootId:"ROOT",sorters:[{property:"orderIndex",direction:"ASC"}],constructor:function(e){this.model=JE.getTreeModel(),this.proxy={type:"ajax",extraParams:{tableCode:"JE_CORE_MENU"},url:JE.getUrlMaps("je.core.getTree"),reader:"json"},this.callParent(arguments)}}),Ext.define("JE.sys.menu.view.CenterView",{extend:"Ext.form.Panel",alias:"widget.menu.centerview",frame:!1,bodyPadding:4,bodyStyle:"background-color:#f1f1f1",autoScroll:!0,tbar:[{ref:"add",text:"添加",iconCls:"jeicon jeicon-resource-table-addition",menu:[{text:"模块",iconCls:"jeicon jeicon-module",ref:"MK"},{text:"菜单",iconCls:"jeicon jeicon-menu",ref:"MENU"},{text:"功能",iconCls:"jeicon jeicon-set-up",ref:"MT"},{text:"字典功能",iconCls:"jeicon jeicon-dictionary",ref:"DIC"}]},{ref:"save",text:"保存",formBind:!0,iconCls:"jeicon jeicon-new-preservation"},{ref:"remove",text:"删除",iconCls:"jeicon jeicon-error"},{ref:"doStaticize",text:"清空菜单缓存",iconCls:"jeicon jeicon-broom-o"},{ref:"exportWord",text:"导出操作手册",hidden:!0,iconCls:"jeicon jeicon-word"},{ref:"exportExcel",text:"导出功能权限",hidden:!0,iconCls:"jeicon jeicon-excel"}],initComponent:function(){var a=this;delete a.defaults,a.defaults={anchor:Ext.value(a.fieldAnchor,"90%"),labelAlign:"right"};var e=Ext.isEmpty(a.fieldAnchor)?"2":"2 2 2 105",t=Ext.isEmpty(a.fieldAnchor)?"100%":"90%";a.items=[{xtype:"textfield",fieldLabel:"菜单",allowBlank:!1,name:"MENU_MENUNAME"},{xtype:"textfield",fieldLabel:"英文标题",name:"MENU_MENUSUBNAME"},{xtype:"numberfield",fieldLabel:"排序",allowBlank:!1,value:0,name:"SY_ORDERINDEX"},{xtype:"rgroup",fieldLabel:"启用",configInfo:"YESORNO",value:"1",name:"SY_STATUS"},{xtype:"yesnofield",fieldLabel:"菜单导航",name:"MENU_HIDELOCATION",boxLabel:"禁用"},{xtype:"rgroup",fieldLabel:"快捷菜单",configInfo:"YESORNO",value:"0",hidden:!0,name:"MENU_QUICKSTART"},{xtype:"textfield",fieldLabel:"层数",configInfo:"YESORNO",hidden:!0,name:"SY_LAYER"},{xtype:"gridssfield",fieldLabel:"样式",hidden:!0,configInfo:"JE_CORE_FONTICON,MENU_ICONCLS,FONTICON_CLS,S",name:"MENU_ICONCLS"},{xtype:"gridssfield",fieldLabel:"大按钮样式",hidden:!0,configInfo:"JE_CORE_FONTICON,MENU_BIGICONCLS,FONTICON_CLS,S",name:"MENU_BIGICONCLS",unitTpl:"经典蓝、睿智黑(主题)"},{xtype:"yesnofield",fieldLabel:"大按钮菜单",boxLabel:"启用(经典蓝主题)",hidden:!0,name:"MENU_BIGBUTTON"},{xtype:"gridssfield",fieldLabel:"字体图标",configInfo:"JE_CORE_FONTICON,MENU_FONTICONCLS,FONTICON_CLS,S",name:"MENU_FONTICONCLS",unitTpl:"科技灰(主题)"},{xtype:"colorfield",fieldLabel:"图标颜色",name:"MENU_FONTICONCOLOR",unitTpl:"科技灰(主题)"},{xtype:"textfield",fieldLabel:"节点类型",hidden:!0,name:"SY_NODETYPE"},{xtype:"fieldcontainer",fieldLabel:"类型",layout:"hbox",itemId:"typeBox",items:[{xtype:"cbbfield",configInfo:"JE_MENUTYPE",name:"MENU_NODEINFOTYPE",flex:1,listeners:{change:function(e,t,i){a.getCmp("badgeBox").setVisible(-1!=["MENU","MT","IDDT"].indexOf(t))}}},{xtype:"button",width:80,hidden:!0,ref:"selectFunc",margin:"0 0 0 4",text:"选择功能",cls:"btn btn-form"}]},{xtype:"cbbfield",fieldLabel:"功能类型",configInfo:"JE_MENU_FUNCTYPE",name:"MENU_FUNCTYPE",hidden:!0,value:"grid"},{xtype:"cbbfield",fieldLabel:"流程模块",configInfo:"JE_CORE_WFMODULE",name:"MENU_WFMODULE",hidden:!0,value:""},{xtype:"textfield",fieldLabel:"流程菜单别名",name:"MENU_WFNAME",hidden:!0,value:""},{xtype:"textarea",fieldLabel:"信息",name:"MENU_NODEINFO",anchor:"90%",height:200},{xtype:"box",padding:"5",margin:e,anchor:t,cls:"x-view-emtpytext",data:{},itemId:"helpMsg",tpl:["<b>配置信息说明：</b>",'<tpl if="text">',"</br>{text}","<tpl else>","无","</tpl>"]},{xtype:"container",layout:"anchor",anchor:"90%",itemId:"badgeBox",hidden:!0,defaults:{labelAlign:"right",anchor:Ext.value(a.fieldAnchor,"100%")},items:[{xtype:"yesnofield",fieldLabel:"数字提醒",name:"MENU_BADGE",boxLabel:"启用(科技灰主题)"},{xtype:"rgroup",fieldLabel:"数字样式",name:"MENU_BADGECLS",value:"red",anchor:"100%",dataArray:[{code:"yellow",text:"黄色"},{code:"red",text:"红色"},{code:"green",text:"绿色"},{code:"blue",text:"蓝色"},{code:"idit",text:"自定义"}],listeners:{change:function(e,t,i){var a=e.next("colorfield[name=MENU_BADGEBGCOLOR]"),n=e.next("colorfield[name=MENU_BADGECOLOR]");a&&(a.setVisible("idit"==t),n.setVisible("idit"==t))}}},{xtype:"colorfield",fieldLabel:"数字背景",name:"MENU_BADGEBGCOLOR",hidden:!0},{xtype:"colorfield",fieldLabel:"数字颜色",name:"MENU_BADGECOLOR",hidden:!0},{xtype:"rgroup",fieldLabel:"数字来源",name:"MENU_BADGETYPE",value:"sql",dataArray:[{code:"sql",text:"SQL"},{code:"action",text:"自定义"},{code:"menu",text:"其他菜单加和"}],listeners:{change:function(e,t,i){var a=e.next("treessareafield[name=MENU_BADGEMENUTEXTS]"),n=e.next("textarea[name=MENU_BADGEINFO]");a&&(a.setVisible("menu"==t),n.setVisible("menu"!=t))}}},{xtype:"treessareafield",fieldLabel:"加和菜单",anchor:"100%",height:80,hidden:!0,configInfo:",MENU_BADGEMENUTEXTS~MENU_BADGEINFO,text~id,M",name:"MENU_BADGEMENUTEXTS",expandRootChild:!1,listeners:{beforequery:function(e){e.rootData=JE.ajax({url:JE.getUrlMaps("je.core.menu","getTree"),params:{tableCode:"JE_CORE_MENU"}})}}},{xtype:"textarea",fieldLabel:"来源内容",anchor:"100%",height:80,name:"MENU_BADGEINFO",emptyText:"SQL:标准sql；自定义:bean,方法名；"},{xtype:"rgroup",fieldLabel:"更新条件",name:"MENU_BADGELOAD",value:"idit",dataArray:[{code:"idit",text:"插件自维护"},{code:"load",text:"功能Load"}]}]},{xtype:"textarea",fieldLabel:"说明",name:"MENU_HELP",anchor:"90%",hidden:!0,height:200},{xtype:"button",anchor:"50%",ref:"doDevelopBtn",margin:"10 10 10 100",text:"授权给开发人员"},{xtype:"hidden",allowBlank:!1,name:"SY_PARENT"},{xtype:"hidden",name:"SY_PATH"},{xtype:"hidden",name:"JE_CORE_MENU_ID"},{xtype:"hidden",name:"MENU_ISDESKTOP"}],a.callParent(arguments)}}),Ext.define("JE.sys.menu.view.MainView",{extend:"Ext.panel.Panel",border:0,layout:"border",alias:"widget.menu.mainview",bodyPadding:2,items:[{xtype:"menu.westview",region:"west",width:200,margins:"0 3 0 0"},{xtype:"menu.centerview",fieldAnchor:"50%",region:"center"}]}),Ext.define("JE.sys.menu.view.WestView",{extend:"Ext.tree.Panel",alias:"widget.menu.westview",mixins:["JE.core.util.ViewUtil"],useArrows:!0,rootVisible:!1,animate:!1,initComponent:function(){var e=this;e.store=JE.getStore({type:"tree",tableName:"JE_CORE_MENU",url:JE.getUrlMaps("je.core.menu","getTree")}),e.dockedItems=[],e.dockedItems.push(e.getTreeTbar(e)),e.dockedItems.push({dock:"bottom",xtype:"box",border:0,height:30,html:'<center style = "background:rgb(249,237,192) url(/JE/data/upload/icon/d8f913d7-380d-468d-9ce4-eded326aae8d.png) no-repeat 5px center;" >请尝试拖动的方式调整菜单</center>',style:"margin:3px;padding:5px;",cls:"x-view-emtpytext"}),e.viewConfig=Ext.value(e.viewConfig,{}),e.viewConfig.plugins=Ext.value(e.viewConfig.plugins,[]),e.viewConfig.listeners=Ext.value(e.viewConfig.listeners,{}),e.viewConfig.plugins.push({ptype:"treeviewdragdrop",allowParentInserts:!0}),e.viewConfig.listeners=Ext.apply(e.viewConfig.listeners,{beforedrop:function(e,t,i,a,n){t.append=!1,t.order=!1,"append"==a?t.records[0].parentNode.getId()==i.getId()?n.cancelDrop():t.append=!0:(t.records[0].parentNode.getId()==i.parentNode.getId()||(t.append=!0),t.order=!0)},drop:function(e,t,i,a,n){var o=this.panel,r="JE_CORE_MENU_ID",l="JE_CORE_MENU",s={success:!0},d=t.records[0];if(t.append){var c=t.order?i.parentNode:i,u="",p="",f=c.getPath(),E=f.indexOf("/",6);u=-1!=E?f.substring(6,E):f.substring(6),Ext.isEmpty(u)&&(u=d.get("id")),p=-1!=(E=(f=d.get("nodePath")).indexOf("/",6))?f.substring(6,E):f.substring(6);var m={tableCode:l,SY_PARENT:c.getId(),oldParentId:d.get("parent"),SY_PATH:c.getPath(),SY_LAYER:c.getDepth()+1,newModuleId:u,oldModuleId:p};if(m[r]=d.getId(),(s=JE.ajax({url:JE.getUrlMaps("je.core.menu","menuMove"),params:m})).success){var g=s.obj;d.set("nodePath",g.SY_PATH),d.set("parent",g.SY_PARENT),d.commit()}else JE.alert(s.obj)}if(t.order&&s.success){var h=[];i.parentNode.eachChild(function(e){var t={};t[r]=e.get("id"),t.SY_ORDERINDEX=e.get("index")+1,e.set("orderIndex",t.SY_ORDERINDEX),h.push(t)}),s=JE.ajax({url:JE.getUrlMaps("je.core.menu","updateList"),params:{strData:Ext.encode(h),tableCode:l}})}s.success?(o.getSelectionModel().deselectAll(),o.fireEvent("selectionchange",o.getSelectionModel(),[]),JE.msg("操作完成")):JE.alert(s.obj)}}),e.callParent(arguments)}}),Ext.define("JE.sys.menu.controller.West",{getWestCtr:function(){return{"[xtype=menu.westview]":{itemclick:function(e,t,i,a,n){var o=t.raw||t.data,r=JE.ajax({url:JE.getUrlMaps("je.core.rbac.rbac.getInfoById"),params:{tableCode:"JE_CORE_MENU",pkValue:o.id}}),l=e.panel.up("[xtype=menu.mainview]").down("[xtype=menu.centerview]");r.SY_LAYER=t.getDepth(),l.form.setValues(r)}}}}}),Ext.define("JE.sys.menu.controller.Center",{getCenterCtr:function(){return{"[xtype=menu.centerview] cbbfield[name=MENU_NODEINFOTYPE]":{change:function(e,t,i,a){var n=e.up("form"),o=!1;-1!=["PORTAL","MT","DIC","CHART","REPORT","COMBINE","INDUSTRY"].indexOf(t)&&(o=!0),e.nextSibling().setVisible(o),n.getComponent("helpMsg").update({text:JE.helpMsg.menu[t]});var r=n.form.findField("MENU_FUNCTYPE"),l=n.form.findField("MENU_WFMODULE"),s=n.form.findField("MENU_WFNAME"),d=n.form.findField("MENU_HELP"),c=n.form.findField("SY_NODETYPE"),u=n.form.findField("MENU_QUICKSTART");"MENU"==t?c.setValue("GENERAL"):c.setValue("LEAF"),r.setVisible("MT"==t),l.setVisible("MT"==t),s.setVisible("MT"==t),d.setVisible("MT"!=t),u.setVisible("MENU"!=t)}},"[xtype=menu.centerview]":{setvalues:function(e,t){e.form.findField("MENU_MENUNAME");var i=e.form.findField("MENU_BIGBUTTON"),a=(e.getCmp("typeBox"),"");a="1"==t.SY_LAYER?"模块":"MENU"==t.MENU_NODEINFOTYPE?"菜单":"功能",i.setVisible("模块"==a)}},"[xtype=menu.centerview] button[ref=selectFunc]":{click:function(e){var i=e.up("form"),t="",a="",n="grid",o="",r=e.previousSibling().getValue();"MT"==r?(o="功能",n="tree",a="JE_CORE_FUNCINFO,MENU_NODEINFO~MENU_MENUNAME~MENU_MENUSUBNAME,code~text~bean.FUNCINFO_FUNCNAME_EN,S,",t=" AND SY_JESYS='1' AND FUNCINFO_NODEINFOTYPE!='FUNCFIELD'"):"PORTAL"==r?(o="首页portal",n="grid",a="JE_CORE_PROTAL,MENU_NODEINFO~MENU_MENUNAME~MENU_ICONCLS~MENU_MENUSUBNAME,JE_CORE_PROTAL_ID~PROTAL_BT~PROTAL_CLS~PROTAL_BT_EN,S,",t=" and PROTAL_JHFS_CODE = 'func' and PROTAL_QY_CODE = '1' "):"DIC"==r?(o="字典",n="grid",a="JE_CORE_DICTIONARY,MENU_NODEINFO~MENU_MENUNAME,DICTIONARY_DDCODE~DICTIONARY_DDNAME,S,",t=" AND SY_JESYS='1' AND DICTIONARY_DDTYPE IN('TREE','LIST')"):"CHART"==r?(o="统计图",n="tree",a="JE_CORE_CHARTS,MENU_NODEINFO~MENU_MENUNAME,code~text,S,",t=" AND SY_JESYS='1' "):"REPORT"==r?(o="报表",n="tree",a="JE_CORE_REPORT,MENU_NODEINFO~MENU_MENUNAME,code~text,S,",t=" AND SY_JESYS='1' "):"INDUSTRY"==r?(o="工业图",n="grid",a="JE_CORE_INDUSTRY,MENU_NODEINFO~MENU_MENUNAME,INDUSTRY_BM~INDUSTRY_MC,S,"):"COMBINE"==r&&(o="功能组态",n="grid",a="JE_CORE_COMBINE,MENU_NODEINFO~MENU_MENUNAME,JE_CORE_COMBINE_ID~COMBINE_NAME,S,",t=""),JE.selectWin({title:o,configInfo:a,type:n,codeSearch:!0,parent:i,parentType:"form",whereSql:t,callback:function(e){if(e&&e[0]){var t=e[0];"CHART"==r?i.form.setValues({MENU_NODEINFO:"JE_CHART_"+t.get("code")+","+t.get("code")}):"REPORT"==r?i.form.setValues({MENU_NODEINFO:"JE_REPORT_"+t.get("code")+","+t.get("code")}):"PORTAL"==r?i.form.setValues({MENU_NODEINFO:"JE_PORTAL_"+JE.toPinYin(t.get("PROTAL_BT"),"PY")+","+t.get("JE_CORE_PROTAL_ID")}):"INDUSTRY"==r&&i.form.setValues({MENU_NODEINFO:"JE_INDUSTRY_"+t.get("INDUSTRY_BM")+","+t.get("INDUSTRY_BM")})}}})}},"[xtype=menu.centerview] button[ref=doDevelopBtn]":{click:function(e){var t=e.up("form"),i=t.form.findField("JE_CORE_MENU_ID").getValue();if(JE.isEmpty(i))JE.alert("请选中菜单!");else{var a=t.form.getValues();a.tableCode="JE_CORE_MENU",a.pkValue=i;var n=JE.ajax({url:JE.getUrlMaps("je.core.rbac.perm","doDevelopPerm"),params:a});n.success?JE.msg("授权成功!"):JE.alert(n.obj)}}},"[xtype=menu.centerview] button[ref=save]":{click:function(e){var o=e.up("form"),t=o.form.findField("JE_CORE_MENU_ID").getValue(),r="doUpdate",l="修改",s=e.treeObj?e.treeObj:e.up("[xtype=menu.mainview]").down("[xtype=menu.westview]"),d=Ext.value(s.getSelectionModel().getSelection()[0],s.getRootNode());if(e.treeObj)r="doSave",l="添加";else if(Ext.isEmpty(t))return void JE.alert("请选择要保存的数据！");o.getForm().submit({url:JE.getUrlMaps("je.core.menu",r),submitEmptyText:!1,params:{tableCode:"JE_CORE_MENU"},success:function(e,t){JE.msg("数据"+l+"成功...");var i=t.result.obj,a=i.MENU_ICONCLS;if("plus"==JE.getTheme()&&JE.isNotEmpty(i.MENU_FONTICONCLS)&&(a=i.MENU_FONTICONCLS),"doSave"==r){var n={id:i.JE_CORE_MENU_ID,text:i.MENU_MENUNAME,nodeInfoType:i.MENU_NODEINFOTYPE,iconCls:a,expandable:!0,leaf:"LEAF"==i.SY_NODETYPE,children:[]};n=d.appendChild(n),s.selectPath(n.getPath()),s.fireEvent("itemclick",s.view,n),o.ownerCt.close()}else d.set("text",i.MENU_MENUNAME),d.set("iconCls",a),d.set("nodeInfoType",i.MENU_NODEINFOTYPE),d.commit()},failure:function(e,t){}})}},"[xtype=menu.centerview] menuitem":{click:function(e){var t=e.up("[xtype=menu.mainview]").down("[xtype=menu.westview]"),i=t.getSelectionModel().getSelection()[0],a="MT",n="ROOT",o="ROOT",r=1,l="GENERAL";if("MK"==e.ref)a="MENU",t.getSelectionModel().deselectAll();else{if(!i)return void JE.alert("请选择父节点","warn");if("MENU"!=i.get("nodeInfoType")&&"PORTAL"!=i.get("nodeInfoType"))return void JE.alert("功能上不能再添加任何节点！","warn");n=i.get("id"),o=i.getPath(),r=i.getDepth()+1,"MENU"!=(a=e.ref)&&(l="LEAF")}var s=JE.win({title:e.text+"添加",border:0,width:600,height:700,items:{xtype:"menu.centerview",margin:"1",tbar:[{ref:"save",text:"保存",formBind:!0,iconCls:"jeicon jeicon-new-preservation",treeObj:t}]}});s.show(null,function(){s.items.get(0).form.setValues({SY_LAYER:r,MENU_NODEINFOTYPE:a,SY_PARENT:n,SY_PATH:o,SY_NODETYPE:l,SY_STATUS:"1",MENU_QUICKSTART:"0"}),"MENU"==a&&s.items.get(0).down("[xtype=fieldcontainer]").hide()})}},"[xtype=menu.centerview] button[ref=remove]":{click:function(e){var t=e.up("form"),i=t.getForm(),a=t.up("[xtype=menu.mainview]").down("[xtype=menu.westview]").getSelectionModel().getSelection()[0];if(a){var n=a.get("text"),o=a.get("id");JE.confirm("确定删除菜单："+n+" ?",function(e){"ok"==e&&(JE.ajax({url:JE.getUrlMaps("je.core.menu","remove"),params:{ids:o,tableCode:"JE_CORE_MENU",doTree:!0}}),i.reset(),a.remove(),JE.msg("菜单删除成功..."))})}}},"[xtype=menu.centerview] button[ref=exportExcel]":{click:function(e){JE.selectWin({title:"选择导出的模块",type:"tree",multiSelect:!0,configInfo:"JE_CORE_MENU,,",whereSql:" AND SY_PARENT='ROOT' ",callback:function(e){var t=new Array;Ext.each(e,function(e){t.push(e.get("id"))});var i=JE.ajax({url:JE.getUrlMaps("je.core.menu","expSysExcel"),params:{moduleIds:t.join(",")}});i.success&&(JE.msg("成功"),window.open(i.obj))}})}},"[xtype=menu.centerview] button[ref=exportWord]":{click:function(e){var t=e.up("form"),i=(t.getForm(),t.up("[xtype=menu.mainview]").down("[xtype=menu.westview]").getSelectionModel().getSelection()[0]);if(i){var a=i.get("id");JE.formWin({title:"导出操作手册",width:400,height:180,items:[{xtype:"textfield",fieldLabel:"项目名",allowBlank:!1,name:"proName"},{xtype:"textfield",fieldLabel:"版本",allowBlank:!1,name:"versionNum"},{xtype:"textfield",fieldLabel:"制作公司",allowBlank:!1,name:"producer"},{xtype:"textfield",fieldLabel:"页眉内容",allowBlank:!0,name:"headName"},{xtype:"textfield",name:"id",hidden:!0,value:a}],fn:function(e){var t=JE.ajax({url:JE.getUrlMaps("je.core.word","exportMenu"),params:e});if(!t.success)return JE.alert(t.obj),!1;window.open(t.obj)}})}else JE.alert("请选中模块!")}},"[xtype=menu.centerview] button[ref=doStaticize]":{click:function(e){JE.ajax({url:JE.getUrlMaps("je.core.staticize","resetMenuStaticize"),async:!0,mask:!0,timeout:3e5,params:{},success:function(e){var t=Ext.decode(Ext.value(e.responseText,"{}"));t.success?JE.msg("缓存已清除!"):JE.alert(t.obj)}})}}}}}),Ext.define("JE.sys.menu.controller.Main",{extend:"Ext.app.Controller",mixins:["JE.sys.menu.controller.Center","JE.sys.menu.controller.West"],init:function(){var e=this.getCenterCtr();e=Ext.apply(e,this.getWestCtr()),this.control(e)},views:["JE.sys.menu.view.WestView","JE.sys.menu.view.CenterView","JE.sys.menu.view.MainView"]}),Ext.define("JE.sys.processinfo.controller.ProcessController",{extend:"Ext.app.Controller",init:function(){this.control({})}}),Ext.define("JE.sys.rbac.query.QueryUserTree",{extend:"Ext.panel.Panel",alias:"widget.rbac.queryusertree",frame:!1,title:"人员查询",iconCls:"jeicon jeicon-khgl-pc",cls:"jeicon jeicon-khgl-pc",split:!0,border:1,margins:"1 1 0 0",layout:"fit",showTitle:!1,initComponent:function(){var d=this,e=JE.ajax({url:JE.getUrlMaps("je.core.rbac.user","loadQueryInfo"),params:{tableCode:"JE_CORE_ENDUSER",node:"ROOT",excludes:"checked"}}),a=[],t={border:0};d.defaults=t,Ext.each(e,function(e){var t=e.children,l=Ext.create("Ext.form.field.ComboBox",{queryMode:"local",store:new Ext.data.Store({fields:["id","text","parentText"]}),hideTrigger:!0,valueField:"id",displayField:"text",ref:"queryTreeCBB",emptyText:"输入查询信息...",listConfig:{},cls:"je-rbac-user-query"}),i={xtype:"treepanel",title:e.text,useArrows:!0,animate:!1,rootVisible:!1,onlyItem:!0,border:0,itemId:e.id+"_"+e.nodeInfo,iconCls:e.iconCls,listeners:{selectionchange:function(e,t,i){var a=e.view.panel,n=t[0],o=n.raw.nodePath,r=a.up("jesswinview").down("jegridview[type=query]").getStore(),l=n.raw.nodeInfo,s=n.raw.id;if(r.sqls=Ext.applyIf(r.sqls,{basic:"",group:"",tree:"",parent:"",chart:"",order:"",quick:""}),"DEPARTMENT"==l)r.proxy.extraParams.whereSql=r.sqls.basic+" "+r.sqls.group+" "+r.sqls.parent+" "+r.sqls.chart+" "+r.sqls.tree+" "+r.sqls.quick+"  and DEPTID in (select DEPTID FROM JE_CORE_DEPARTMENT WHERE PATH like'%"+o+"%')";else if("ROLE"==l)r.proxy.extraParams.whereSql=r.sqls.basic+" "+r.sqls.group+" "+r.sqls.parent+" "+r.sqls.chart+" "+r.sqls.tree+" "+r.sqls.quick+"  and USERID in (select USERID from JE_CORE_ROLE_USER where ROLEID IN (SELECT ROLEID FROM JE_CORE_ROLE WHERE PATH LIKE'%"+o+"%'))";else if("SENTRY"==l)r.proxy.extraParams.whereSql=r.sqls.basic+" "+r.sqls.group+" "+r.sqls.parent+" "+r.sqls.chart+" "+r.sqls.tree+" "+r.sqls.quick+"  and USERID in (select USERID from JE_CORE_SENTRY_USER where SENTRYID in (SELECT SENTRYID FROM JE_CORE_SENTRY WHERE PATH LIKE '%"+o+"%'))";else{if("WORKGROUP"!=l)return void alert("数据读取错误!");r.proxy.extraParams.whereSql=r.sqls.basic+" "+r.sqls.group+" "+r.sqls.parent+" "+r.sqls.chart+" "+r.sqls.tree+" "+r.sqls.quick+"  and USERID in (select USERID from JE_CORE_WORKGROUP_USER where GROUPID='"+s+"')"}r.load(),d.deselectTree(a.up("panel[ref=accordionpanel]").items.items,a.itemId)},render:function(n){var e=n.getStore().tree.nodeHash,t="";for(var i in e){var a=e[i],o=a.get("text"),r=Ext.value(a.get("id"),"");"1"!=a.get("disabled")&&(r=="ROOT_"+a.get("nodeInfo")&&(t=o),"ROOT"!=r.toUpperCase()&&l.store.add({text:o,id:r,parentText:t}))}l.on("select",function(e,t){var i=t[0].data.id,a=n.getStore().getNodeById(i);a&&n.selectPath(a.getPath())})}},root:{text:"ROOT",id:e.id,expanded:!0,children:t},dockedItems:{dock:"top",xtype:"panel",layout:"column",defaults:{columnWidth:1},bodyStyle:"background:none;",itemId:"queryBar",border:0,items:[l]}};a.push(i)});var i={layout:"accordion",ref:"accordionpanel",defaults:t,layoutConfig:{titleCollapse:!1,animate:!0,activeOnTop:!0},items:a};d.items=i,d.tools=[{type:"refresh",tooltip:"刷新",handler:function(e,t,i,a){var n=a.up("panel[xtype=rbac.queryusertree]"),o=n.down("panel[ref=accordionpanel]"),r=n.up("jesswinview").down("jegridview[type=query]").getStore();r.getProxy().extraParams;r.sqls=Ext.applyIf(r.sqls,{basic:"",group:"",tree:"",parent:"",chart:"",order:""}),r.proxy.extraParams.whereSql=r.sqls.basic+" "+r.sqls.group+" "+r.sqls.parent+" "+r.sqls.chart+" "+r.sqls.tree,r.load(),d.deselectTree(o.items.items,"")}}],d.callParent(arguments)},deselectTree:function(e,t){Ext.each(e,function(e){t!=e.itemId&&e.getSelectionModel().deselectAll(!0)})}}),Ext.define("JE.sys.rbac.query.SelectedUserGrid",{extend:"Ext.grid.Panel",border:1,alias:"widget.query.selectedusergrid",title:"已选列表",columnLines:!0,enableKeyNav:!0,frame:!1,split:!0,margins:"0",bbar:{xtype:"toolbar",cls:"je-button-bar",items:["->",{xtype:"button",ref:"clear",text:"清除",cls:"JEPLUS_B_C02",iconCls:JE.getIconCls({iconCls:"jeicon jeicon-delete-form",fontIconCls:"fa fa-trash"})}]},columns:[{text:"帐号",dataIndex:"USERID",hidden:!0},{text:"姓名",dataIndex:"USERNAME",width:135},{text:"部门",dataIndex:"DEPTNAME",hidden:!0},{text:"操作",xtype:"actioncolumn",width:50,align:"center",items:[{iconCls:"jeicon jeicon-error",tooltip:"删除",handler:function(e,t,i){var a=e.panel,n=a.up("jesswinview").down("jegridview"),o=a.getStore(),r=o.getAt(t),l=n.getStore().findRecord("USERID",r.get("USERID"));o.remove(r),l&&n.getSelectionModel().deselect(l,!0)}}]}],initComponent:function(){this.store=JE.getStore({id:"USERID",autoLoad:!1,tableName:"JE_CORE_ENDUSER",params:{limit:-1}}),this.callParent(arguments)}}),Ext.define("JE.sys.rbac.view.cjgl.CjglTree",{extend:"Ext.tree.Panel",alias:"widget.cjgl.cjgltree",useArrows:!0,rootVisible:!1,animate:!1,multiSelect:!1,selModel:{selType:"treemodel",allowDeselect:!0,mode:"SINGLE"},viewConfig:{selectedItemCls:"x-tree-row-selected",focusedItemCls:"x-tree-row-focused",beforeFocusedItemCls:"x-tree-row-before-focused",tableFocusedFirstCls:"x-tree-table-focused-first"},listeners:{itemcontextmenu:function(e,t,i,a,n,o){e.panel}},initComponent:function(){var e="",t="1"==JE.systemConfig.JE_SYSMODE;t&&(e=" AND SY_ZHID='"+JE.currentUser.zhId+"'"),this.store=JE.getStore({type:"tree",tableName:"JE_CORE_YWCJ",url:JE.getUrlMaps("je.core.rbac.cjgl","getTree"),multi:!1,params:{whereSql:e}}),t&&!JE.currentUser.saas||(this.rbar=[{xtype:"button",tooltip:"添加",ref:"ins",iconCls:"jeicon jeicon-resource-table-addition"},{xtype:"button",tooltip:"修改",ref:"modfiy",iconCls:"jeicon jeicon-form-editing"},{xtype:"button",tooltip:"删除",ref:"del",iconCls:"jeicon jeicon-delete-form"},{xtype:"button",tooltip:"复制",ref:"copy",iconCls:"jeicon jeicon-save-copy"},{xtype:"button",tooltip:"粘贴",ref:"paste",iconCls:"jeicon jeicon-paste"},{xtype:"button",tooltip:"存为字典",ref:"saveDd",iconCls:"jeicon jeicon-dictionary"},{xtype:"button",tooltip:"刷新",ref:"refresh",iconCls:"jeicon jeicon-refresh"}]),this.callParent(arguments)}}),Ext.define("JE.sys.rbac.view.cjgl.DeptForm",{extend:"Ext.form.Panel",alias:"widget.cjgl.deptform",trackResetOnLoad:!0,initComponent:function(){var e=this;e.layout="anchor";e.defaults={anchor:"95%",labelAlign:"right",margin:"6 0 2 0",labelWidth:80};e.parentNode&&(e.parentNode.get("text"),e.parentNode.get("code"),e.parentNode.get("id"));var t="";"1"==JE.systemConfig.JE_SYSMODE&&(t=" AND SY_ZHID='"+JE.currentUser.zhId+"'"),e.items=[{xtype:"textfield",fieldLabel:"主键",name:"DEPTID",hidden:!0},{xtype:"textfield",fieldLabel:"公司主键",name:"JE_CORE_JDGSINFO_ID",hidden:!0},{xtype:"textfield",fieldLabel:"名称",name:"DEPTNAME",allowBlank:!1},{xtype:"textfield",fieldLabel:"编码",name:"DEPTCODE",hidden:!0},{xtype:"treessfield",fieldLabel:"公司",name:"JTGSMC",whereSql:t,configInfo:"JE_CORE_JDGSINFO,JTGSMC~JTGSID~GSBMID,text~id~bean.JDGSINFO_GSID,S",allowBlank:!0},{xtype:"textfield",fieldLabel:"产品ID",name:"JTGSID",hidden:!0},{xtype:"textfield",fieldLabel:"公司部门ID",name:"GSBMID",hidden:!0},{xtype:"rgroup",fieldLabel:"监管类型",configInfo:"JE_CORE_YECJTYPE",name:"JDGSINFO_YECJTYPE_CODE",value:"GS",hidden:!0,readOnly:!0},{xtype:"rgroup",fieldLabel:"节点类型",configInfo:"JE_TREE_LEAF,SY_NODETYPE,code,S",name:"SY_NODETYPE",value:"LEAF"},{xtype:"gridssareafield",fieldLabel:"监管",name:"JTJGGSNAME",whereSql:t,configInfo:"JE_CORE_JDGSINFO,JTJGGSNAME~JTJGGSID,JDGSINFO_GSMC~JE_CORE_JDGSINFO_ID,M"},{xtype:"textfield",fieldLabel:"监管ID",name:"JTJGGSID",hidden:!0}],e.hideBtn||(e.buttons=[{text:"保存",iconCls:"jeicon jeicon-save",ref:"formSaveBtn",formBind:!0},{text:"删除",iconCls:"jeicon jeicon-error",ref:"formDelBtn",formBind:!0}],e.buttonAlign="left"),e.callParent(arguments)}}),Ext.define("JE.sys.rbac.view.cjgl.DeptTree",{extend:"Ext.tree.Panel",alias:"widget.cjgl.depttree",useArrows:!0,rootVisible:!1,animate:!1,multiSelect:!1,selModel:{selType:"treemodel",allowDeselect:!0,mode:"SINGLE"},listeners:{itemcontextmenu:function(e,t,i,a,n,o){}},buttons:[{xtype:"rgroup",name:"cascade",value:"1",width:200,dataArray:[{id:"0",code:"0",text:"单节点拖拽"},{id:"1",code:"1",text:"级联拖拽"}]}],tools:[{type:"expand",callback:function(e,t,i){var a=t.type;e[a+"All"](),t.setType("expand"==a?"collapse":"expand")}}],buttonAlign:"left",initComponent:function(){var e="";"1"==JE.systemConfig.JE_SYSMODE&&(e=" AND ZHID='"+JE.currentUser.zhId+"'"),this.store=JE.getStore({type:"tree",tableName:"JE_CORE_DEPARTMENT",url:JE.getUrlMaps("je.core.rbac.rbac","getTree"),multi:!1,params:{whereSql:e}}),this.viewConfig={plugins:{ptype:"treeviewdragdrop",enableDrop:!1,ddGroup:"treeSelect"},selectedItemCls:"x-tree-row-selected",focusedItemCls:"x-tree-row-focused",beforeFocusedItemCls:"x-tree-row-before-focused",tableFocusedFirstCls:"x-tree-table-focused-first"},this.callParent(arguments)}}),Ext.define("JE.sys.rbac.view.cjgl.MainView",{extend:"Ext.panel.Panel",frame:!1,margin:1,alias:"widget.cjgl.mainview",layout:"border",items:[{xtype:"cjgl.cjgltree",region:"west",width:300,title:"业务层级关系",collapsible:!0,split:!0},{region:"center",xtype:"panel",layout:"border",border:0,items:[{title:"关系规划",xtype:"cjgl.resulttree",height:160,region:"center"},{xtype:"cjgl.deptform",region:"south",bodyStyle:"border-top-width:0px !important;background:#ffc;"}]},{xtype:"cjgl.depttree",region:"east",title:"组织结构",width:300,collapsible:!0,split:!0}],initComponent:function(){this.callParent(arguments)}}),Ext.define("JE.sys.rbac.view.cjgl.ResultTree",{extend:"Ext.tree.Panel",alias:"widget.cjgl.resulttree",useArrows:!0,rootVisible:!1,animate:!1,multiSelect:!1,funcTree:!0,selectType:"A",dropGroup:"treeSelect",sourceCopy:!0,onlyChildren:!0,listeners:{drop:function(e,t){t.length}},selModel:{selType:"treemodel",allowDeselect:!0,mode:"SINGLE"},root:{text:"ROOT",id:"ROOT",expanded:!0,children:[]},tools:[{type:"expand",callback:function(e,t,i){var a=t.type;e[a+"All"](),t.setType("expand"==a?"collapse":"expand")}}],initComponent:function(){var v=this;v.viewConfig=Ext.value(v.viewConfig,{selectedItemCls:"x-tree-row-selected",focusedItemCls:"x-tree-row-focused",beforeFocusedItemCls:"x-tree-row-before-focused",tableFocusedFirstCls:"x-tree-table-focused-first"}),v.viewConfig.plugins=Ext.value(v.viewConfig.plugins,[]),v.viewConfig.listeners=Ext.value(v.viewConfig.listeners,{}),v.viewConfig.plugins.push({ptype:"treeviewdragdrop",allowParentInserts:!0,ddGroup:"treeSelect"}),v.viewConfig.listeners=Ext.apply(v.viewConfig.listeners,{beforedrop:function(e,t,i,a,n){var o=t.view.panel;if(t.append=!1,t.order=!1,"ROOT"==i.get("id"))return JE.msg("无法在第一层添加!"),!1;if("append"==a){if("ROOT"==i.get("id"))return!1;if(t.records[0].parentNode.getId()==i.getId()?n.cancelDrop():t.append=!0,1==i.get("leaf"))return JE.msg("无法在叶子节点添加!"),!1}else if(t.records[0].parentNode.getId()==i.parentNode.getId())t.order=!0;else{if("ROOT"==(i=i.parentNode).get("id"))return!1;t.append=!0,t.order=!0}if("cjgl.resulttree"==o.xtype)return!0;var r=o.up("panel[xtype=cjgl.mainview]"),l=r.down("rgroup[name=cascade]").getValue(),s=r.down("panel[xtype=cjgl.cjgltree]").getSelectionModel().getSelection()[0],d=t.records[0],c=new Array,u=v.getStore(),p=(u.getRootNode(),u.tree.nodeHash),f=(o.getStore().tree.nodeHash,new Array),E=new Array,m=!1;for(var g in p){p[g].raw.nodeInfo==d.get("id")&&(m=!0)}if(-1==c.indexOf(d.get("id"))&&-1==c.indexOf(d.get("parent"))||(m=!0),m?c.push(d.get("id")):(f.push(d.get("id")),E.push(d)),0<f.length){var h=JE.ajax({url:JE.getUrlMaps("je.core.rbac.cjgl","doAddNode"),params:{tableCode:"JE_CORE_JDGSINFO",parentId:i.get("id"),ywcjId:s.get("id"),cascade:l,ids:f.join(","),rootId:d.get("id")}}),x=o.getStore();i.appendChild([h]),i.cascadeBy(function(e){var t=x.getNodeById(e.raw.nodeInfo);t&&(t.set("cls","rbac-cjgl-sel"),t.commit())})}else JE.msg("该节点已经添加！");return!1},drop:function(e,t,n,i,a){var o=this.panel,r=function(e,t){e.eachChild(function(e){t(e),e.hasChildNodes&&r(e,t)})},l="JE_CORE_JDGSINFO_ID",s="JE_CORE_JDGSINFO",d={success:!0},c=t.records[0];if(t.append){var u=t.order?n.parentNode:n,p="",f="",E=u.getPath(),m=E.indexOf("/",6);p=-1!=m?E.substring(6,m):E.substring(6),Ext.isEmpty(p)&&(p=c.get("id")),f=-1!=(m=(E=c.raw.nodePath).indexOf("/",6))?E.substring(6,m):E.substring(6);var g={tableCode:s,SY_PARENT:u.getId(),oldParentId:c.get("parent"),SY_PATH:u.getPath(),SY_LAYER:u.getDepth()+1,newModuleId:p,oldModuleId:f};if(g[l]=c.getId(),(d=JE.ajax({url:JE.getUrlMaps("je.core.rbac.cjgl","gsMove"),params:g})).success){var h=d.obj;if(c.set("nodePath",h.SY_PATH),c.raw.nodePath=h.SY_PATH,c.set("parent",h.SY_PARENT),d.success&&d.obj&&c.hasChildNodes()){var x=c.raw.treeOrderIndex,v=Ext.value(d.obj.SY_TREEORDERINDEX,d.obj.TREEORDERINDEX);r(c,function(e){var t=e.raw.treeOrderIndex;e.raw.treeOrderIndex=v+t.substring(x.length)})}d.success&&d.obj&&(c.raw.treeOrderIndex=Ext.value(d.obj.SY_TREEORDERINDEX,d.obj.TREEORDERINDEX)),c.commit()}else JE.alert(d.obj)}if(t.order&&d.success){var y=[];n.parentNode.eachChild(function(i){var a={},e=i.get("index")+1;a[l]=i.get("id"),a.SY_ORDERINDEX=e,a.SY_TREEORDERINDEX=n.parentNode.raw.treeOrderIndex+JE.preFillUp(e,6,"0"),i.hasChildNodes()&&r(i,function(e){var t={};t[l]=e.get("id"),t.SY_TREEORDERINDEX=a.SY_TREEORDERINDEX+e.raw.treeOrderIndex.substring(i.raw.treeOrderIndex.length),e.raw.treeOrderIndex=t.SY_TREEORDERINDEX,y.push(t)}),i.raw.orderIndex=a.SY_ORDERINDEX,i.raw.treeOrderIndex=a.SY_TREEORDERINDEX,a.SY_ORDERINDEX=e,a.SY_TREEORDERINDEX=n.parentNode.raw.treeOrderIndex+JE.preFillUp(e,6,"0"),y.push(a)}),d=JE.ajax({url:JE.getUrlMaps("je.core.rbac.cjgl","doUpdateList"),params:{strData:Ext.encode(y),tableCode:s}})}d.success?(o.getSelectionModel().deselectAll(),o.fireEvent("selectionchange",o.getSelectionModel(),[]),JE.msg("操作完成")):JE.alert(d.obj)}}),v.callParent(arguments)}}),Ext.define("JE.sys.rbac.view.perm.AdminTree",{extend:"Ext.tree.Panel",alias:"widget.perm.admintree",useArrows:!0,rootVisible:!1,animate:!1,multiSelect:!1,selModel:{selType:"treemodel",allowDeselect:!0,mode:"SINGLE"},rbar:[{xtype:"button",tooltip:"添加",ref:"ins",iconCls:"jeicon jeicon-resource-table-addition"},{xtype:"button",tooltip:"清除缓存",ref:"refresh",iconCls:"jeicon jeicon-refresh"}],viewConfig:{selectedItemCls:"x-tree-row-selected",focusedItemCls:"x-tree-row-focused",beforeFocusedItemCls:"x-tree-row-before-focused",tableFocusedFirstCls:"x-tree-table-focused-first"},listeners:{itemcontextmenu:function(e,t,i,a,n,o){var r=e.panel.menuWin;n.stopEvent(),r.showAt(n.getXY()),r.doConstrain()}},initComponent:function(){var e="";"1"==JE.systemConfig.JE_SYSMODE&&(e=" AND SY_ZHID='"+JE.currentUser.zhId+"'"),this.store=JE.getStore({type:"tree",url:JE.getUrlMaps("je.core.rbac.adminPerm","getTree"),tableName:"JE_CORE_ADMININFO",multi:!1,params:{whereSql:e}}),this.menuWin=Ext.create("JE.sys.rbac.view.perm.TreeMenu",{frame:!1,border:1,items:[{text:"修改",iconCls:"jeicon jeicon-refresh",ref:"update",scope:this},{text:"删除",iconCls:"jeicon jeicon-error",ref:"del",scope:this}],adminTree:this}),this.callParent(arguments)}}),Ext.define("JE.sys.rbac.view.perm.AdminUserView",{extend:"Ext.panel.Panel",layout:"fit",alias:"widget.perm.adminuserview",initComponent:function(){this.items={xtype:"dataview",store:JE.getStore({tableName:"JE_CORE_ENDUSER",url:JE.getUrlMaps("je.core.rbac.rbac","load"),id:"USERID",params:{limit:-1},autoLoad:!1}),tpl:['<tpl for=".">','<div class="thumb-wrap" name="{USERCODE}">','<div class="thumb">',"{USERNAME}({BACKUSERCODE})","</div>","</div>","</tpl>"],multiSelect:!0,trackOver:!0,overItemCls:"x-dataview-item-over",selectedItemCls:"x-dataview-item-selected",itemSelector:"div.thumb-wrap",emptyText:""},this.tbar=[{text:"按部门导入",disabled:!0,iconCls:"jeicon jeicon-user-department",ref:"deptImpl"},{text:"按岗位导入",disabled:!0,iconCls:"jeicon jeicon-user-department",ref:"sentryImpl"},{text:"按角色导入",disabled:!0,iconCls:"jeicon jeicon-import",ref:"roleImpl"},{text:"删除",disabled:!0,iconCls:"jeicon jeicon-error",ref:"remove"},{text:"删除全部",disabled:!0,iconCls:"jeicon jeicon-trash-o",ref:"removeAll"}],this.callParent(arguments)},disabledBtn:function(e){var t=this.down("button[ref=deptImpl]"),i=this.down("button[ref=sentryImpl]"),a=this.down("button[ref=roleImpl]"),n=this.down("button[ref=remove]"),o=this.down("button[ref=removeAll]");t.setDisabled(e),i.setDisabled(e),a.setDisabled(e),n.setDisabled(e),o.setDisabled(e)}}),Ext.define("JE.sys.rbac.view.perm.CenterView",{extend:"Ext.panel.Panel",alias:"widget.perm.centerview",border:0,padding:"0 0 0 2",layout:{type:"hbox",align:"stretch"},buttonAlign:"left",buttons:[{text:"保存",ref:"saveBtn",iconCls:"jeicon jeicon-check"},{text:"恢复默认",ref:"resetBtn",iconCls:"jeicon jeicon-take-back"}],initComponent:function(){var e="",t=" AND ROLERANK='SYS'";"1"==JE.systemConfig.JE_SYSMODE&&(JE.currentUser.saas||(t=" AND ROLERANK='YH' AND ZHID='"+JE.currentUser.zhId+"'"),e=" AND ZHID='"+JE.currentUser.zhId+"'"),this.items=[{title:"可控平台资源",xtype:"panel",padding:"0 2 0 0",layout:{type:"hbox",align:"stretch"},flex:1,items:[{xtype:"perm.moduletree",flex:4,padding:"1"},{xtype:"perm.permtree",padding:"1",flex:6}]},{title:"可控被授权人",xtype:"tabpanel",tabPosition:"left",padding:"0 2 0 0",items:[{title:"角色",store:JE.getStore({type:"tree",tableName:"JE_CORE_ROLE",url:JE.getUrlMaps("je.core.rbac.rbac","getTree"),multi:!0,params:{whereSql:" and ROLETYPE='ROLE' "+t}}),xtype:"perm.roletree",ref:"ROLE_PERM"},{title:"部门",store:JE.getStore({type:"tree",tableName:"JE_CORE_ROLE",url:JE.getUrlMaps("je.core.rbac.rbac","getTree"),multi:!0,params:{whereSql:" and ROLETYPE='DEPT' AND DEPTID IN (SELECT DEPTID FROM JE_CORE_DEPARTMENT WHERE STATUS='1' "+e+")"}}),xtype:"perm.depttree",ref:"DEPT_PERM"},{title:"岗位",store:JE.getStore({type:"tree",tableName:"JE_CORE_ROLE",url:JE.getUrlMaps("je.core.rbac.rbac","getTree"),multi:!0,params:{whereSql:" and ROLETYPE='SENTRY' AND SENTRYID IN (SELECT SENTRYID FROM JE_CORE_SENTRY WHERE STATUS='1' "+e+")"}}),xtype:"perm.sentrytree",ref:"SENTRY_PERM"}],flex:1},{xtype:"tabpanel",layout:"fit",title:"可操作范围",flex:1,tabPosition:"bottom",items:[{title:"可见",xtype:"tabpanel",iconCls:"jeicon jeicon-see-jurisdiction",tabPosition:"left",border:0,items:[{title:"角色",store:JE.getStore({type:"tree",tableName:"JE_CORE_ROLE",url:JE.getUrlMaps("je.core.rbac.rbac","getTree"),multi:!0,params:{whereSql:" and ROLETYPE='ROLE' "+t}}),xtype:"perm.roletree",ref:"ROLE_SELECT"},{title:"部门",store:JE.getStore({type:"tree",tableName:"JE_CORE_ROLE",url:JE.getUrlMaps("je.core.rbac.rbac","getTree"),multi:!0,params:{whereSql:" and ROLETYPE='DEPT' AND DEPTID IN (SELECT DEPTID FROM JE_CORE_DEPARTMENT WHERE STATUS='1' "+e+")"}}),xtype:"perm.depttree",ref:"DEPT_SELECT"},{title:"岗位",store:JE.getStore({type:"tree",tableName:"JE_CORE_ROLE",url:JE.getUrlMaps("je.core.rbac.rbac","getTree"),multi:!0,params:{whereSql:" and ROLETYPE='SENTRY' AND SENTRYID IN (SELECT SENTRYID FROM JE_CORE_SENTRY WHERE STATUS='1' "+e+")"}}),xtype:"perm.sentrytree",ref:"SENTRY_SELECT"}]},{title:"可编辑",xtype:"tabpanel",iconCls:"jeicon jeicon-form-editing",layout:"fit",tabPosition:"left",border:0,items:[{title:"角色",store:JE.getStore({type:"tree",tableName:"JE_CORE_ROLE",url:JE.getUrlMaps("je.core.rbac.rbac","getTree"),multi:!0,params:{whereSql:" and ROLETYPE='ROLE' "+t}}),xtype:"perm.roletree",ref:"ROLE_UPDATE"},{title:"部门",store:JE.getStore({type:"tree",tableName:"JE_CORE_ROLE",url:JE.getUrlMaps("je.core.rbac.rbac","getTree"),multi:!0,params:{whereSql:" and ROLETYPE='DEPT' AND DEPTID IN (SELECT DEPTID FROM JE_CORE_DEPARTMENT WHERE STATUS='1' "+e+")"}}),xtype:"perm.depttree",ref:"DEPT_UPDATE"},{title:"岗位",store:JE.getStore({type:"tree",tableName:"JE_CORE_ROLE",url:JE.getUrlMaps("je.core.rbac.rbac","getTree"),multi:!0,params:{whereSql:" and ROLETYPE='SENTRY' AND SENTRYID IN (SELECT SENTRYID FROM JE_CORE_SENTRY WHERE STATUS='1' "+e+")"}}),xtype:"perm.sentrytree",ref:"SENTRY_UPDATE"}]}]}],this.callParent(arguments)}}),Ext.define("JE.sys.rbac.view.perm.DeptTree",{extend:"Ext.tree.Panel",alias:"widget.perm.depttree",useArrows:!0,rootVisible:!1,animate:!1,border:0,multiSelect:!0,funcTree:!0,selectType:"A",selModel:{selType:"treemodel",allowDeselect:!0,mode:"SIMPLE"},initComponent:function(){this.callParent(arguments)}}),Ext.define("JE.sys.rbac.view.perm.imp.RoleDUTView",{extend:"Ext.tree.Panel",frame:!0,margins:"0 0 0 9",ref:"oktree",useArrows:!0,rootVisible:!1,animate:!1,buttonAlign:"center",buttons:[{text:"移除选中的用户",iconCls:"jeicon jeicon-error",ref:"treeDelete"}],initComponent:function(){var e=this,t="部门 - 人 员";"SENTRY"==e.impType?t="岗位 - 人员":"ROLE"==e.impType&&(t="角色 - 人员"),e.title=t,e.root={text:"ROOT",id:"ROOT",expanded:!0,children:[]},e.tools=[{type:"expand",tooltip:"展开",handler:function(){e.expandAll()}},{type:"collapse",tooltip:"收起",handler:function(){e.collapseAll()}}];var i=Ext.create("Ext.form.field.ComboBox",{queryMode:"local",store:new Ext.data.Store({fields:["id","text","parentText"]}),hideTrigger:!0,valueField:"id",displayField:"text",ref:"queryTreeCBB",emptyText:"输入查询信息..."});e.tbar={dock:"top",xtype:"panel",layout:"column",defaults:{columnWidth:1},bodyStyle:"background:none;",border:0,items:[i]},e.callParent(arguments)},loadUsers:function(e){var t=e.recs,i=e.tree,a=this;a.getRootNode().removeAll();var n=[];Ext.each(t,function(e){n.push(e.data),a.searchParnet(i,e)}),a.expandAll();var o=a.down("combobox[ref=queryTreeCBB]");o.store.loadData(n),o.reset()},searchParnet:function(e,t){var i,a=e.getStore().getNodeById(t.get("id"));"SENTRY"!=this.impType&&"ROLE"!=this.impType||a||(a=e.getRootNode().findChild("nodeInfoType",t.get("id"),!0));if(!a)return i;i=Ext.clone(a.raw);for(var n=a.getPath().replace("/ROOT/","").split("/"),o=(a.getDepth(),n.length-1);0<=o;o--){var r=n[o],l=this.getStore().getNodeById(r);if(l){l.appendChild(i),l.expand(!0),i=void 0;break}l=e.getStore().getNodeById(r);var s=Ext.clone(l.raw);s.children=[i],i=s}i&&(i=this.getRootNode().appendChild(i),this.getRootNode().expand(!0))}}),Ext.define("JE.sys.rbac.view.perm.imp.RoleInsDeptUserTreeView",{extend:"JE.core.view.TreeView",margins:"0 9 0 0",ref:"deptusertree",frame:!0,bbar:{dock:"bottom",xtype:"box",border:0,height:30,html:"<center>把人员直接拖动到角色中</center>",style:"margin:3px;padding:5px;",cls:"x-view-emtpytext"},initComponent:function(){var e="部门 - 人 员",t="JE_CORE_DEPTUSER,,,S_",i="JE_CORE_DEPTUSER",a="部门人员",n="ORDER BY NODEINFO",o="";"1"==JE.systemConfig.JE_SYSMODE&&(o=" AND ZHID='"+JE.currentUser.zhId+"'"),"SENTRY"==this.impType?(e="岗位 - 人员",t="JE_CORE_VSENTRYUSER,,,S_",i="JE_CORE_VSENTRYUSER",a="岗位人员",n="ORDER BY NODEINFOTYPE desc"):"ROLE"==this.impType&&(e="角色 - 人员",t="JE_CORE_VROLEUSER,,,S_",i="JE_CORE_VROLEUSER",a="角色 人员",n="ORDER BY ORDERINDEX"),this.title=e,this.viewConfig={plugins:{ptype:"treeviewdragdrop",enableDrop:!1,ddGroup:"treeSelect"}},this.url=JE.getUrlMaps("je.core.dd.tree","loadTree"),this.queryItems=[{configInfo:t,whereSql:" and STATUS='1' AND VALID='1'"}],this.multiSelect=!1,this.showTitle=!1;var r=[{ddCode:i,ddName:a,async:!(this.type="query"),whereSql:o+" AND (DISABLED='1' OR (DISABLED='0' AND PARENT!='ROOT')) AND STATUS='1' AND VALID='1'",orderSql:n,parentSql:"",rootId:"ROOT",nodeInfo:"",moreRoot:!1}];this.params={excludes:"checked",onlyItem:!0,strData:Ext.encode(r)},this.on("load",function(e,t){var i=e.treeObj,a=i.up("window[xtype=perm.userinswinview]"),n=a.down("multiselect[ref=multiselect]");a.down("treepanel[ref=oktree]").loadUsers({tree:i,recs:n.store.data.items})}),this.callParent(arguments)}}),Ext.define("JE.sys.rbac.view.perm.imp.UserInsWinView",{extend:"Ext.window.Window",width:700,height:600,alias:"widget.perm.userinswinview",maximizable:!0,layout:{type:"hbox",pack:"start",align:"stretch",padding:1},defaults:{flex:5},modal:!0,buttonAlign:"center",buttons:[{text:"确定",ref:"okBtn",iconCls:"jeicon jeicon-check"},{text:"取消",ref:"cancleBtn",iconCls:"jeicon jeicon-cancel"}],constructor:function(e){var r=Ext.create("JE.sys.rbac.view.perm.imp.RoleInsDeptUserTreeView",{impType:e.impType}),l=Ext.create("JE.sys.rbac.view.perm.imp.RoleDUTView",{impType:e.impType}),t=Ext.create("JE.core.ux.form.MultiSelect",{ref:"multiselect",dropGroup:"treeSelect",sourceCopy:!0,onlyChildren:!0,displayField:"text",valueField:"DEPT"==e.impType?"id":"nodeInfoType",store:{fields:["id","text","parentText","parentId","nodeInfoType"]},listConfig:{getInnerTpl:function(e){return"{text}<tpl if='parentText'><span style='color:#C0C0C0;'>({parentText})</span></tpl>"},listeners:{itemclick:function(e,t,i){var a=t.get("id"),n=l.getStore().getNodeById(a);n&&l.selectPath(n.getPath());var o=r.getStore().getNodeById(a);o&&r.selectPath(o.getPath())}}},listeners:{drop:function(e,t){if(0<t.length){var i=e.up("window[xtype=perm.userinswinview]"),a=i.down("treepanel[ref=deptusertree]"),n=i.down("treepanel[ref=oktree]");Ext.each(t,function(e){n.searchParnet(a,e)})}}}});this.items=[r,{layout:"fit",frame:!0,title:"角色人员",ref:"roleuser",buttonAlign:"center",buttons:[{text:"移除选中的用户",iconCls:"jeicon jeicon-error",ref:"delete"}],items:t},l],this.callParent(arguments)}}),Ext.define("JE.sys.rbac.view.perm.MainView",{extend:"Ext.panel.Panel",border:0,frame:!1,alias:"widget.perm.mainview",layout:"border",items:[{xtype:"perm.admintree",region:"west",width:160,border:0,split:!0},{region:"center",xtype:"panel",layout:"border",items:[{border:0,xtype:"perm.adminuserview",height:160,region:"north"},{xtype:"perm.centerview",region:"center"}]}],initComponent:function(){this.callParent(arguments)}}),Ext.define("JE.sys.rbac.view.perm.ModuleTree",{extend:"Ext.tree.Panel",alias:"widget.perm.moduletree",useArrows:!0,rootVisible:!1,animate:!1,multiSelect:!0,selModel:{selType:"treemodel",allowDeselect:!0,mode:"SIMPLE"},viewConfig:{selectedItemCls:"x-tree-row-selected",focusedItemCls:"x-tree-row-focused",beforeFocusedItemCls:"x-tree-row-before-focused",tableFocusedFirstCls:"x-tree-table-focused-first"},initComponent:function(){this.store=JE.getStore({type:"tree",tableName:"JE_CORE_MENU",multi:!1,params:{url:JE.getUrlMaps("je.core.rbac.perm","getMouleTree"),whereSql:" and SY_PARENT='ROOT' AND SY_STATUS='1'"}}),this.callParent(arguments)}}),Ext.define("JE.sys.rbac.view.perm.PermTree",{extend:"Ext.tree.Panel",alias:"widget.perm.permtree",useArrows:!0,rootVisible:!1,animate:!1,multiSelect:!0,funcTree:!0,selectType:"A",selModel:{selType:"treemodel",allowDeselect:!0,mode:"SIMPLE"},root:{text:"ROOT",id:"ROOT",expanded:!0,children:[]}}),Ext.define("JE.sys.rbac.view.perm.RoleTree",{extend:"Ext.tree.Panel",alias:"widget.perm.roletree",useArrows:!0,rootVisible:!1,animate:!1,border:0,multiSelect:!0,funcTree:!0,selectType:"A",selModel:{selType:"treemodel",allowDeselect:!0,mode:"SIMPLE"},initComponent:function(){this.callParent(arguments)}}),Ext.define("JE.sys.rbac.view.perm.SentryTree",{extend:"Ext.tree.Panel",alias:"widget.perm.sentrytree",useArrows:!0,rootVisible:!1,animate:!1,border:0,multiSelect:!0,funcTree:!0,selectType:"A",selModel:{selType:"treemodel",allowDeselect:!0,mode:"SIMPLE"},initComponent:function(){this.callParent(arguments)}}),Ext.define("JE.sys.rbac.view.perm.TreeMenu",{extend:"Ext.menu.Menu",alias:"widget.perm.treemenu",defaultAlign:"br-tr",frame:!0,border:0}),Ext.define("JE.sys.rbac.view.proxy.MainView",{extend:"Ext.panel.Panel",border:1,frame:!1,alias:"widget.proxy.mainview",title:"赋予代理人的菜单项",iconCls:"jeicon jeicon-role",layout:"fit",items:[{xtype:"proxy.permproxyview",border:0}],buttonAlign:"center",buttons:[{text:"确定授权",ref:"okBtn",iconCls:"jeicon jeicon-check"}],initComponent:function(){this.callParent(arguments)}}),Ext.define("JE.sys.rbac.view.proxy.PermProxyView",{extend:"Ext.tree.Panel",alias:"widget.proxy.permproxyview",useArrows:!0,rootVisible:!1,animate:!1,multiSelect:!0,funcTree:!0,selectType:"A",selModel:{selType:"treemodel",allowDeselect:!0,mode:"SIMPLE"},root:{text:"ROOT",id:"ROOT",expanded:!0,children:[]},dockedItems:[{xtype:"box",dock:"bottom",padding:"5",margin:"5",minHeight:30,html:"<font color='#333333'>保存：代理人则在规定时间范围内拥有所被授予的权限。</font>",cls:"x-view-emtpytext"}]}),Ext.define("JE.sys.rbac.view.proxy.ProxyDeptTree",{extend:"Ext.tree.Panel",border:0,alias:"widget.proxy.proxydepttree",useArrows:!0,rootVisible:!1,viewConfig:{selectedItemCls:"x-tree-row-selected",focusedItemCls:"x-tree-row-focused",beforeFocusedItemCls:"x-tree-row-before-focused",tableFocusedFirstCls:"x-tree-table-focused-first"},selModel:{selType:"treemodel",allowDeselect:!0,mode:"SIMPLE"},initComponent:function(){this.store=Ext.create("JE.core.store.TreeStore",{treeObj:this}),this.callParent()}}),Ext.define("JE.sys.rbac.view.proxy.ProxyRoleTree",{extend:"Ext.tree.Panel",border:0,alias:"widget.proxy.proxyroletree",useArrows:!0,rootVisible:!1,viewConfig:{selectedItemCls:"x-tree-row-selected",focusedItemCls:"x-tree-row-focused",beforeFocusedItemCls:"x-tree-row-before-focused",tableFocusedFirstCls:"x-tree-table-focused-first"},selModel:{selType:"treemodel",allowDeselect:!0,mode:"SIMPLE"},initComponent:function(){this.store=Ext.create("JE.core.store.TreeStore",{treeObj:this}),this.callParent()}}),Ext.define("JE.sys.rbac.view.proxy.ProxySentryTree",{extend:"Ext.tree.Panel",border:0,alias:"widget.proxy.proxysentrytree",useArrows:!0,rootVisible:!1,viewConfig:{selectedItemCls:"x-tree-row-selected",focusedItemCls:"x-tree-row-focused",beforeFocusedItemCls:"x-tree-row-before-focused",tableFocusedFirstCls:"x-tree-table-focused-first"},selModel:{selType:"treemodel",allowDeselect:!0,mode:"SIMPLE"},initComponent:function(){this.store=Ext.create("JE.core.store.TreeStore",{treeObj:this}),this.callParent()}}),Ext.define("JE.sys.rbac.view.proxy.WestView",{extend:"Ext.panel.Panel",border:1,alias:"widget.proxy.westview",layout:"accordion",layoutConfig:{titleCollapse:!1,animate:!1,activeOnTop:!0},initComponent:function(){this.items=[{title:"代理角色",iconCls:"jeicon jeicon-users-fs",xtype:"proxy.proxyroletree"},{title:"代理部门",iconCls:"jeicon jeicon-user-department",xtype:"proxy.proxydepttree"},{title:"代理岗位",iconCls:"jeicon jeicon-user-department",xtype:"proxy.proxysentrytree"}],this.callParent(arguments)}}),Ext.define("JE.sys.rbac.view.public.AppTree",{extend:"Ext.tree.Panel",alias:"widget.public.apptree",useArrows:!0,rootVisible:!1,animate:!1,multiSelect:!1,selModel:{selType:"treemodel",allowDeselect:!0,mode:"SINGLE"},viewConfig:{selectedItemCls:"x-tree-row-selected",focusedItemCls:"x-tree-row-focused",beforeFocusedItemCls:"x-tree-row-before-focused",tableFocusedFirstCls:"x-tree-table-focused-first"},initComponent:function(){this.store=JE.getStore({type:"tree",tableName:"JE_PHONE_APK",url:JE.getUrlMaps("je.core.rbac.perm","getAppTree"),multi:!1,params:{whereSql:""}}),this.callParent(arguments)}}),Ext.define("JE.sys.rbac.view.public.FuncTree",{extend:"Ext.tree.Panel",alias:"widget.public.functree",useArrows:!0,rootVisible:!1,animate:!1,multiSelect:!0,selModel:{selType:"treemodel",allowDeselect:!0,mode:"SIMPLE"},viewConfig:{selectedItemCls:"x-tree-row-selected",focusedItemCls:"x-tree-row-focused",beforeFocusedItemCls:"x-tree-row-before-focused",tableFocusedFirstCls:"x-tree-table-focused-first"},initComponent:function(){this.buttons=[{text:"导入",iconCls:"jeicon jeicon-import-view",ref:"implFunc"},{text:"删除",iconCls:"jeicon jeicon-error",ref:"delFunc"}],this.buttonAlign="left",this.store=JE.getStore({type:"tree",tableName:"JE_CORE_FUNCINFO",url:JE.getUrlMaps("je.core.rbac.perm","getFuncTree"),multi:!1,params:{whereSql:""},autoLoad:!1}),this.callParent(arguments)}}),Ext.define("JE.sys.rbac.view.public.MainView",{extend:"Ext.panel.Panel",border:0,frame:!1,alias:"widget.public.mainview",layout:"border",items:[{xtype:"tabpanel",border:0,split:!0,width:260,region:"west",layout:"fit",frame:!1,ref:"public_permtype_tab",border:1,items:[{title:"菜单授权",xtype:"public.moduletree"},{title:"功能授权",xtype:"public.functree"},{title:"APP授权",xtype:"public.apptree"}]},{region:"center",xtype:"public.permtree"}],initComponent:function(){this.callParent(arguments)}}),Ext.define("JE.sys.rbac.view.public.ModuleTree",{extend:"Ext.tree.Panel",alias:"widget.public.moduletree",useArrows:!0,rootVisible:!1,animate:!1,multiSelect:!0,selModel:{selType:"treemodel",allowDeselect:!0,mode:"SIMPLE"},viewConfig:{selectedItemCls:"x-tree-row-selected",focusedItemCls:"x-tree-row-focused",beforeFocusedItemCls:"x-tree-row-before-focused",tableFocusedFirstCls:"x-tree-table-focused-first"},initComponent:function(){this.store=JE.getStore({type:"tree",tableName:"JE_CORE_MENU",multi:!1,params:{whereSql:" and SY_PARENT='ROOT' AND SY_STATUS='1'"}}),this.callParent(arguments)}}),Ext.define("JE.sys.rbac.view.public.PermTree",{extend:"Ext.tree.Panel",alias:"widget.public.permtree",useArrows:!0,rootVisible:!1,animate:!1,multiSelect:!0,funcTree:!0,selectType:"A",selModel:{selType:"treemodel",allowDeselect:!0,mode:"SIMPLE"},root:{text:"ROOT",id:"ROOT",expanded:!0,children:[]},buttons:[{text:"保存",iconCls:"jeicon jeicon-save",ref:"permSave"},{text:"全部展开",iconCls:"jeicon jeicon-arrow-down",ref:"expandAll"},{text:"全部收缩",iconCls:"jeicon jeicon-arrow-up",ref:"collapseAll"},{text:"刷新数据",iconCls:"jeicon jeicon-refresh",ref:"refreshPerm"}],buttonAlign:"left",dockedItems:[{xtype:"box",dock:"bottom",padding:"5",margin:"5",minHeight:30,html:"<font color='#333333'>公共权限：当勾选的权限之后，即用户无须通过角色再授权才能看见该功能。比如功能：审批工作台。每个员工应该有这个权限。</font>",cls:"x-view-emtpytext"}]}),Ext.define("JE.sys.rbac.view.role.AppTree",{extend:"Ext.tree.Panel",alias:"widget.role.apptree",useArrows:!0,rootVisible:!1,multiSelect:!1,selModel:{selType:"treemodel",allowDeselect:!0,mode:"SINGLE"},viewConfig:{selectedItemCls:"x-tree-row-selected",focusedItemCls:"x-tree-row-focused",beforeFocusedItemCls:"x-tree-row-before-focused",tableFocusedFirstCls:"x-tree-table-focused-first"},initComponent:function(){this.store=JE.getStore({type:"tree",tableName:"JE_PHONE_APK",url:JE.getUrlMaps("je.core.rbac.perm","getAppTree"),multi:!1,params:{whereSql:""}}),this.callParent(arguments)}}),Ext.define("JE.sys.rbac.view.role.DeptTree",{extend:"Ext.tree.Panel",alias:"widget.role.depttree",ref:"roletree",title:"部门",useArrows:!0,rootVisible:!1,animate:!1,border:0,initComponent:function(){this.buttonAlign="center",this.buttons={layout:"column",margin:"0 0 10px 0",defaults:{xtype:"button",columnWidth:.27},items:[{text:"同步数据",margin:"0 0 10px 10px",ref:"syncOrder"},{margin:"0 0 10px 10px",text:"清除缓存",ref:"refresh"}]},this.store=JE.getStore({type:"tree",tableName:"JE_CORE_ROLE",url:JE.getUrlMaps("je.core.rbac.perm","getDeptTree"),params:{whereSql:" and ROLETYPE='DEPT' AND DEPTID IN (SELECT DEPTID FROM JE_CORE_DEPARTMENT WHERE STATUS='1')"}}),this.callParent(arguments)}}),Ext.define("JE.sys.rbac.view.role.FuncTree",{extend:"Ext.tree.Panel",alias:"widget.role.functree",useArrows:!0,rootVisible:!1,multiSelect:!0,selModel:{selType:"treemodel",allowDeselect:!0,mode:"SIMPLE"},viewConfig:{selectedItemCls:"x-tree-row-selected",focusedItemCls:"x-tree-row-focused",beforeFocusedItemCls:"x-tree-row-before-focused",tableFocusedFirstCls:"x-tree-table-focused-first"},initComponent:function(){var e=!1,t=!1;"1"==JE.systemConfig.JE_SYSMODE&&(e=!0,JE.currentUser.saas&&(t=!0)),this.buttons=[{hidden:e&&!t,text:"导入",ref:"implFunc"},{text:"删除",hidden:e&&!t,ref:"delFunc"}],this.buttonAlign="center",this.store=JE.getStore({type:"tree",tableName:"JE_CORE_FUNCINFO",url:JE.getUrlMaps("je.core.rbac.perm","getFuncTree"),multi:!1,params:{whereSql:""},autoLoad:!1}),this.callParent(arguments)}}),Ext.define("JE.sys.rbac.view.role.imp.RoleDUTView",{extend:"Ext.tree.Panel",frame:!0,margins:"0 0 0 9",ref:"oktree",bodyStyle:"border:0",useArrows:!0,rootVisible:!1,animate:!1,buttonAlign:"center",buttons:[{text:"移除选中的用户",cls:"btn JEPLUS_B_C02",iconCls:"fa fa-close",ref:"treeDelete"}],initComponent:function(){var e=this;e.title="DEPT"==e.impType?"角色  - 部门 - 人 员":"角色  - 岗位- 人 员",e.root={text:"ROOT",id:"ROOT",expanded:!0,children:[]},e.tools=[{type:"expand",tooltip:"展开",handler:function(){e.expandAll()}},{type:"collapse",tooltip:"收起",handler:function(){e.collapseAll()}}];var t=Ext.create("Ext.form.field.ComboBox",{queryMode:"local",store:new Ext.data.Store({fields:["id","text","parentText"]}),hideTrigger:!0,valueField:"id",displayField:"text",ref:"queryTreeCBB",emptyText:"输入查询信息..."});e.tbar={dock:"top",xtype:"panel",layout:"column",defaults:{columnWidth:1},bodyStyle:"background:none;",border:0,items:[t]},e.callParent(arguments),e.on("afterrender",function(e){e.header.getEl().dom.style.border=0,e.dockedItems.each(function(e){"headercontainer"==e.xtype&&e.setBorder(0)})})},loadUsers:function(e){var t=e.recs,i=e.tree,a=this;a.getRootNode().removeAll();var n=[];Ext.each(t,function(e){n.push(e.data),a.searchParnet(i,e)}),a.expandAll();var o=a.down("combobox[ref=queryTreeCBB]");o.store.loadData(n),o.reset()},searchParnet:function(e,t){var i,a=null;a=e.getStore().getNodeById(t.get("id")),"SENTRY"!=this.impType||a||(a=e.getRootNode().findChild("nodeInfoType",t.get("id"),!0));if(!a)return i;i=Ext.clone(a.raw);for(var n=a.getPath().replace("/ROOT/","").split("/"),o=(a.getDepth(),n.length-1);0<=o;o--){var r=n[o],l=this.getStore().getNodeById(r);if(l){l.appendChild(i),l.expand(!0),i=void 0;break}l=e.getStore().getNodeById(r);var s=Ext.clone(l.raw);s.children=[i],i=s}i&&(this.getRootNode().appendChild(i),this.getRootNode().expand(!0))}}),Ext.define("JE.sys.rbac.view.role.imp.RoleInsDeptUserTreeView",{extend:"JE.core.view.TreeView",margins:"0 9 0 0",ref:"deptusertree",frame:!0,bbar:{dock:"bottom",xtype:"box",border:0,height:30,html:"<center>把人员直接拖动到角色中</center>",style:"margin:3px;padding:5px;",cls:"x-view-emtpytext"},initComponent:function(){(t=this).title="DEPT"==t.impType?"组织结构":"岗位人员",t.viewConfig={plugins:{ptype:"treeviewdragdrop",enableDrop:!1,ddGroup:"treeSelect"}},this.url=JE.getUrlMaps("je.core.dd.tree","loadTree");var e=JE.ajax({url:JE.getUrlMaps("je.core.rbac.adminPerm","getQuerySql"),params:{tableCode:"DEPT"==t.impType?"JE_CORE_VDEPTUSER":"JE_CORE_VSENTRYUSER"}}).obj;this.queryItems=[{configInfo:"DEPT"==t.impType?"JE_CORE_DEPTUSER":"JE_CORE_VSENTRYUSER",whereSql:" and STATUS='1' AND VALID='1'"}],this.multiSelect=!1,this.showTitle=!1,this.type="query";var t,i=[{ddCode:"DEPT"==t.impType?"JE_CORE_DEPTUSER":"JE_CORE_VSENTRYUSER",ddName:"DEPT"==t.impType?"部门人员":"岗位人员",async:!1,whereSql:" AND (DISABLED='1' OR (DISABLED='0' AND PARENT!='ROOT')) AND STATUS='1'  AND VALID='1'"+e,orderSql:"DEPT"==t.impType?"":" ORDER BY NODEINFOTYPE desc",parentSql:"",rootId:"ROOT",nodeInfo:"",moreRoot:!1}];this.params={excludes:"checked",onlyItem:!0,strData:Ext.encode(i)},this.on("load",function(e,t){var i=e.treeObj,a=i.up("window[xtype=role.userinswinview]"),n=a.down("multiselect[ref=multiselect]");a.down("treepanel[ref=oktree]").loadUsers({tree:i,recs:n.store.data.items})}),this.callParent(arguments),(t=this).on("afterrender",function(e){e.header.getEl().dom.style.border=0,e.dockedItems.each(function(e){"headercontainer"==e.xtype&&e.setBorder(0)})})}}),Ext.define("JE.sys.rbac.view.role.imp.UserInsWinView",{extend:"Ext.window.Window",width:700,height:600,alias:"widget.role.userinswinview",maximizable:!0,layout:{type:"hbox",pack:"start",align:"stretch",padding:1},defaults:{flex:5},modal:!0,buttonAlign:"center",buttons:[{text:"确定",ref:"okBtn",cls:"btn JEPLUS_B_L10",iconCls:"fa fa-check"},{text:"取消",ref:"cancleBtn",cls:"btn",iconCls:"fa fa-close"}],constructor:function(e){var r=Ext.create("JE.sys.rbac.view.role.imp.RoleInsDeptUserTreeView",{border:0,impType:e.impType}),l=Ext.create("JE.sys.rbac.view.role.imp.RoleDUTView",{border:0,impType:e.impType}),t=Ext.create("JE.core.ux.form.MultiSelect",{ref:"multiselect",dropGroup:"treeSelect",sourceCopy:!0,onlyChildren:!0,displayField:"text",valueField:"DEPT"==e.impType?"id":"nodeInfoType",store:{fields:["id","text","parentText","parentId","nodeInfoType"]},listConfig:{border:0,getInnerTpl:function(e){return"{text}<tpl if='parentText'><span style='color:#C0C0C0;'>({parentText})</span></tpl>"},listeners:{itemclick:function(e,t,i){var a=t.get("id"),n=l.getStore().getNodeById(a);n&&l.selectPath(n.getPath());var o=r.getStore().getNodeById(a);o&&r.selectPath(o.getPath())}}},listeners:{drop:function(e,t){if(0<t.length){var i=e.up("window[xtype=role.userinswinview]"),a=i.down("treepanel[ref=deptusertree]"),n=i.down("treepanel[ref=oktree]");Ext.each(t,function(e){n.searchParnet(a,e)})}}}});this.items=[r,{layout:"fit",frame:!0,title:"角色人员",ref:"roleuser",buttonAlign:"center",buttons:[{text:"移除选中的用户",cls:"btn JEPLUS_B_C02",iconCls:"fa fa-close",ref:"delete"}],items:t,listeners:{afterrender:function(e){e.header.getEl().dom.style.border=0}}},l],this.callParent(arguments)}}),Ext.define("JE.sys.rbac.view.role.MainView",{extend:"Ext.panel.Panel",border:0,frame:!1,alias:"widget.role.mainview",layout:"border",cls:"je-user-jurisdiction",cpDics:[],initComponent:function(){var e=!1,t="",i=[];"1"==JE.systemConfig.JE_SYS_APPPERM&&(e=!0);var a="",n=" AND ROLERANK='SYS' ",o=[],r=!1,l=!1;"1"==JE.systemConfig.JE_SYSMODE&&(r=!0,n=" AND ZHID='"+JE.currentUser.zhId+"' AND ROLERANK='YH'",JE.currentUser.saas&&(l=!0)),l&&(0<(o=JE.ajax({url:JE.getUrlMaps("je.core.saas.cpInfo","loadCpDicInfo"),params:{}})).length&&(a=o[0].id),"SYS"==a&&(n=" AND ROLERANK='SYS' ")),this.items=[{region:"north",border:0,bodyStyle:"background:#f6f9fc;",style:"margin-top:-1px;",items:[{margin:"10px 0 10px 0",xtype:"cbbfield",border:0,name:"JE_SAAS_CP",editable:!1,fieldLabel:"授权操作前请选对应的产品或模块",labelWidth:190,hideTrigger1:!0,value:t,hidden:!l,dataArray:i,width:340,labelAlign:"left",listeners:{beforerender:function(){var e=this.up().up("panel[xtype=role.mainview]").down("panel[ref=westpanel]").down("panel[xtype=role.roletree]");i=JE.isNotEmpty(e.cpDics)?e.cpDics:[{code:"SYS",text:"系统"}],t=Ext.value(e.defaultCpId,"SYS"),this.store.loadData(i),this.setValue(t)}}}]},{xtype:"panel",ref:"westpanel",layout:"border",region:"west",padding:"0 2 0 0",width:l?330:350,border:0,split:!0,items:[{region:"center",xtype:"tabpanel",titleAlign:"center",layout:"fit",ref:"role_group_tab",bodyStyle:"background:rgba(240, 244, 249, 1)",tabPosition:"top",border:1,cls:"je-rbac-usertree",items:[{xtype:"role.roletree",margin:"10px 10px 20px 10px",cpDics:o,roleSql:n,defaultCpId:a},{xtype:"role.depttree",margin:"10px 10px 20px 10px",hidden:r&&l},{xtype:"role.sentrytree",margin:"10px 10px 20px 10px",hidden:!0},{xtype:"role.rolegrouptree",margin:"10px 10px 20px 10px",hidden:r&&l}]}]},{xtype:"panel",layout:"border",region:"center",border:0,items:[{region:"center",xtype:"tabpanel",layout:"fit",tabPosition:"top",border:1,items:[{title:"人员配置",xtype:"user.usergrid",margin:"10px 10px 20px 10px",split:!0,cls:"je-user-main-table",style:"margin:0 10px 10px 10px;"},{title:"权限配置",xtype:"panel",layout:"border",margin:"10px 10px 20px 10px",region:"center",border:0,items:[{region:"west",xtype:"panel",ref:"role_permtype_tab",width:300,style:"margin:0 10px 10px 0;",defaults:{bodyStyle:"padding:15px;"},layout:{type:"accordion",titleCollapse:!0,animate:!0,activeOnTop:!1},items:[{title:"菜单授权",xtype:"role.moduletree"},{title:"功能授权",xtype:"role.functree"},{hidden:!e,title:"APP授权",xtype:"role.apptree"}]},{xtype:"role.permtree",region:"center",style:"margin-bottom:10px;",frame:!1}]}]}]}],this.callParent(arguments)}}),Ext.define("JE.sys.rbac.view.role.ModuleTree",{extend:"Ext.tree.Panel",alias:"widget.role.moduletree",useArrows:!0,rootVisible:!1,multiSelect:!0,selModel:{selType:"treemodel",allowDeselect:!0,mode:"SIMPLE"},viewConfig:{selectedItemCls:"x-tree-row-selected",focusedItemCls:"x-tree-row-focused",beforeFocusedItemCls:"x-tree-row-before-focused",tableFocusedFirstCls:"x-tree-table-focused-first"},initComponent:function(){this.store=JE.getStore({type:"tree",tableName:"JE_CORE_MENU",url:JE.getUrlMaps("je.core.rbac.perm","getMouleTree"),multi:!1,params:{whereSql:" and SY_PARENT='ROOT' AND SY_STATUS='1'"}}),this.callParent(arguments)}}),Ext.define("JE.sys.rbac.view.role.PermTree",{extend:"Ext.tree.Panel",alias:"widget.role.permtree",useArrows:!0,rootVisible:!1,animate:!1,multiSelect:!0,funcTree:!0,selectType:"A",rootRole:!0,selModel:{selType:"treemodel",allowDeselect:!0,mode:"SIMPLE"},root:{text:"ROOT",id:"ROOT",expanded:!0,children:[]},border:0,buttons:{style:"margin-top:-100px;padding-bottom:10px;",items:[{text:"保存",ref:"permSave"},{text:"硬性保存",ref:"hardSave"},{text:"全部展开",ref:"expandAll"},{text:"全部收缩",ref:"collapseAll"},{text:"刷新数据",ref:"refreshPerm"}]},buttonAlign:"left"}),Ext.define("JE.sys.rbac.view.role.RoleForm",{extend:"Ext.form.Panel",alias:"widget.role.roleform",trackResetOnLoad:!0,initComponent:function(){var e=this;e.layout="anchor",e.defaults={anchor:"95%",labelAlign:"right",margin:"6 0 2 0",labelWidth:80};var t=!0,i=!0,a="SYS",n="1"==JE.systemConfig.JE_SYSMODE;n?(e.height=360,JE.currentUser.saas?t=!1:(a="YH",e.height=250)):e.height=250,-1!=Ext.value(JE.systemConfig.JE_SYS_ADMIN,"admin").indexOf(JE.currentUser.userCode)&&(i=!1),i=i||t&&n;var o="",r="";e.parentNode&&(o=e.parentNode.get("text"),r=e.parentNode.get("code"),e.parentNode.get("id")),e.items=[{xtype:"textfield",fieldLabel:"主键",name:"ROLEID",hidden:!0,value:JE.isNotEmpty(e.sels)?e.sels.data.id:""},{xtype:"textfield",fieldLabel:"名称",name:"ROLENAME",allowBlank:!1,value:JE.isNotEmpty(e.sels)?e.sels.data.text:""},{xtype:"textfield",fieldLabel:"编码",name:"ROLECODE",allowBlank:!1,readOnly:!0,value:JE.isNotEmpty(e.sels)?e.sels.data.bean.ROLECODE:"<系统自动生成>"},{xtype:"gridssfield",fieldLabel:"集团公司",name:"JTGSMC",hidden:!0,readOnly:n,configInfo:"JE_CORE_JDGSINFO,JTGSMC~JTGSID,JDGSINFO_GSMC~JE_CORE_JDGSINFO_ID,S",value:JE.isNotEmpty(e.sels)?e.sels.data.bean.JTGSMC:""},{xtype:"textfield",fieldLabel:"集团公司ID",name:"JTGSID",value:JE.isNotEmpty(e.sels)?e.sels.data.bean.JTGSID:"",hidden:!0},{xtype:"rgroup",fieldLabel:"级别",name:"ROLERANK",configInfo:"JE_CORE_ROLERANK",readOnly:!0,hidden:t,value:a},{xtype:"gridssfield",fieldLabel:"产品",readOnly:!0,configInfo:"JE_SAAS_CP,CPNAME~CPID,CP_MC~CP_DM,S",hidden:!0,name:"CPNAME"},{xtype:"gridssfield",fieldLabel:"产品ID",hidden:!0,name:"CPID"},{xtype:"treessfield",fieldLabel:"系统角色",hidden:!0,configInfo:"JE_RBAC_ROLE,BASEROLENAME~BASEROLEID,text~id,S",name:"BASEROLENAME"},{xtyle:"treessfield",fieldLabel:"系统角色ID",hidden:!0,name:"BASEROLEID"},{xtype:"rgroup",fieldLabel:"SAAS权",configInfo:"YESORNO",name:"SAAS",value:"0",hidden:t},{xtype:"rgroup",fieldLabel:"开发权",configInfo:"YESORNO",name:"DEVELOP",value:JE.isNotEmpty(e.sels)?e.sels.data.bean.DEVELOP:"0",hidden:i},{xtype:"rgroup",fieldLabel:"角色类型",configInfo:"JE_TREE_LEAF",hidden:!0,name:"NODETYPE",value:"LEAF"},{xtype:"textfield",fieldLabel:"角色类型",name:"ROLETYPE",value:"ROLE",hidden:!0},{xtype:"treessfield",fieldLabel:"权限组",name:"GROUPNAME",hidden:!t,configInfo:"JE_CORE_ROLEGROUP,GROUPNAME~GROUPCODE,text~id,M,",whereSql:n?" AND SY_JTGSID='"+JE.currentUser.jtgsId+"'":"",value:JE.isNotEmpty(e.sels)?e.sels.data.bean.GROUPNAME:""},{xtype:"textfield",fieldLabel:"聚合编码",name:"GROUPCODE",hidden:!0,value:JE.isNotEmpty(e.sels)?e.sels.data.bean.GROUPCODE:""},{xtype:"treessfield",fieldLabel:"继承",readOnly:!0,name:"PARENTNAME",configInfo:"JE_RBAC_ROLE,PARENTNAME~PARENTCODE~PARENT,text~code~id,S,",whereSql:" and ROLETYPE='ROLE'",value:o,hidden:!0},{xtype:"textfield",fieldLabel:"继承编码",name:"PARENTCODE",hidden:!0,parentCode:r}],e.hideBtn||(e.buttons=[{text:"保存",cls:"btn JEPLUS_B_L10",iconCls:"fa fa-check",ref:"formSaveBtn",formBind:!0},{text:"取消",cls:"btn",iconCls:"fa fa-close",handler:function(){e.up().close()}}],e.buttonAlign="center"),e.callParent(arguments)}}),Ext.define("JE.sys.rbac.view.role.RoleGroupForm",{extend:"Ext.form.Panel",frame:!0,alias:"widget.role.rolegroupform",trackResetOnLoad:!0,initComponent:function(){var e=this;e.layout="anchor",e.defaults={anchor:"95%",labelAlign:"right",margin:"6 0 2 0",labelWidth:80,useDirty:!0},e.items=[{xtype:"textfield",fieldLabel:"主键",hidden:!0,name:"JE_CORE_ROLEGROUP_ID",value:JE.isNotEmpty(e.sels)?e.sels.data.bean.JE_CORE_ROLEGROUP_ID:""},{xtype:"textfield",fieldLabel:"权限组名称",name:"ROLEGROUP_TEXT",allowBlank:!1,value:JE.isNotEmpty(e.sels)?e.sels.data.bean.ROLEGROUP_TEXT:""},{xtype:"textfield",fieldLabel:"权限组编码",name:"ROLEGROUP_CODE",allowBlank:!1,value:JE.isNotEmpty(e.sels)?e.sels.data.bean.ROLEGROUP_CODE:""},{xtype:"numberfield",fieldLabel:"排序",name:"SY_ORDERINDEX",value:JE.isNotEmpty(e.sels)?e.sels.data.bean.SY_ORDERINDEX:""}],e.hideBtn||(e.buttons=[{text:"保存",cls:"btn JEPLUS_B_L10",iconCls:"fa fa-check",ref:"formSaveBtn",formBind:!0},{text:"取消",cls:"btn",iconCls:"fa fa-close",handler:function(){e.up().close()}}],e.buttonAlign="center"),e.callParent(arguments)}}),Ext.define("JE.sys.rbac.view.role.RoleGroupTree",{extend:"Ext.tree.Panel",alias:"widget.role.rolegrouptree",title:"权限组",useArrows:!0,rootVisible:!1,animate:!1,border:0,listeners:{itemcontextmenu:function(e,t,i,a,n,o){var r=e.panel.menuWin;n.stopEvent(),r.showAt(n.getXY()),r.doConstrain()},afterrender:function(){me=this,me.down("[ref=del]").disable(),me.down("[ref=update]").disable()}},initComponent:function(){this.buttonAlign="center",this.buttons={layout:"column",margin:"0 0 10px 0",defaults:{xtype:"button",columnWidth:.33,margin:"0 5px 10px 5px"},items:[{text:"添加",ref:"ins"},{text:"清除缓存",ref:"refresh"},{text:"删除",ref:"del"},{text:"编辑",ref:"update"}]};var e="";"1"==JE.systemConfig.JE_SYSMODE&&(e=" AND SY_ZHID='"+JE.currentUser.zhId+"'"),this.store=JE.getStore({type:"tree",tableName:"JE_CORE_ROLEGROUP",params:{whereSql:e}}),this.menuWin=Ext.create("JE.sys.rbac.view.role.TreeMenu",{items:[{text:"删除",iconCls:"jeicon jeicon-error",ref:"del",scope:this},{text:"移动",iconCls:"jeicon jeicon-refresh",ref:"move",scope:this}],roleTree:this}),this.callParent(arguments)}}),Ext.define("JE.sys.rbac.view.role.RoleTree",{extend:"Ext.tree.Panel",alias:"widget.role.roletree",title:"角色",useArrows:!0,rootVisible:!1,ref:"roletree",border:0,cls:"je-rbac-roleTree",animate:!1,refreshRoot:function(){var e=Ext.value(this.roleSql,""),t=JE.ajax({url:JE.getUrlMaps("je.core.rbac.perm","getRoleTree"),params:{tableCode:"JE_CORE_ROLE",excludes:"checked",whereSql:" and ROLETYPE='ROLE'"+e}});this.getStore().setRootNode(t),this.down("[ref=insChild]").disable(),this.down("[ref=update]").disable(),this.down("[ref=del]").disable(),this.down("[ref=move]").disable()},initComponent:function(){var e=this;Ext.value(e.cpDics,[]),Ext.value(e.roleSql,""),Ext.value(e.defaultCpId,"");e.buttonAlign="center",e.buttons={layout:"column",margin:"0 0 10px 0px",defaults:{xtype:"button",columnWidth:.33,margin:"0 5px 10px 5px"},items:[{text:"添加角色",ref:"ins"},{text:"添加子角色",ref:"insChild",scope:e},{text:"编辑",ref:"update"},{xtype:"button",text:"删除",ref:"del",scope:e},{text:"移动",ref:"move",scope:e},{text:"刷新",ref:"refresh"}]},"1"==JE.systemConfig.JE_SYSMODE&&JE.currentUser.saas,e.listeners={itemclick:function(){this.down("[ref=insChild]").enable(),this.down("[ref=update]").enable(),this.down("[ref=del]").enable(),this.down("[ref=move]").enable()},afterrender:function(){this.down("[ref=insChild]").disable(),this.down("[ref=update]").disable(),this.down("[ref=del]").disable(),this.down("[ref=move]").disable(),this.refreshRoot()}},e.store=Ext.create("Ext.data.TreeStore",{sorters:[{property:"SY_ORDERINDEX",direction:"ASC"}],root:{id:"ROOT",expanded:!0,children:[]},model:JE.getTreeModel()}),e.menuWin=Ext.create("JE.sys.rbac.view.role.TreeMenu",{frame:!1,border:1,items:[{text:"添加子角色",iconCls:"jeicon jeicon-resource-table-addition",ref:"insChild",scope:e},{text:"删除",iconCls:"jeicon jeicon-error",ref:"del",scope:e},{text:"移动",iconCls:"jeicon jeicon-refresh",ref:"move",scope:e}],roleTree:e}),e.viewConfig=Ext.value(e.viewConfig,{}),e.viewConfig.plugins=Ext.value(e.viewConfig.plugins,[]),e.viewConfig.listeners=Ext.value(e.viewConfig.listeners,{}),e.viewConfig.plugins.push({ptype:"treeviewdragdrop",allowParentInserts:!1}),e.viewConfig.listeners=Ext.apply(e.viewConfig.listeners,{beforedrop:function(e,t,i,a,n){if(t.append=!1,t.order=!1,"append"==a?t.records[0].parentNode.getId()==i.getId()?n.cancelDrop():t.append=!0:(t.records[0].parentNode.getId()==i.parentNode.getId()||(t.append=!0),t.order=!0),t.append)return!1},drop:function(e,t,i,a,n){var o=this.panel,r={success:!0};t.records[0];if(t.order&&r.success){var l=[];i.parentNode.eachChild(function(e){var t={};t.ROLEID=e.get("id"),t.ORDERINDEX=e.get("index")+1,e.set("orderIndex",t.ORDERINDEX),l.push(t)}),r=JE.ajax({url:JE.getUrlMaps("je.core.updateList"),params:{strData:Ext.encode(l),tableCode:"JE_CORE_ROLE"}})}r.success?(o.getSelectionModel().deselectAll(),o.fireEvent("selectionchange",o.getSelectionModel(),[]),JE.msg("操作完成")):JE.alert(r.obj)}}),this.callParent(arguments)}}),Ext.define("JE.sys.rbac.view.role.SentryTree",{extend:"Ext.tree.Panel",alias:"widget.role.sentrytree",title:"岗位",ref:"roletree",useArrows:!0,rootVisible:!1,animate:!1,border:0,initComponent:function(){this.buttonAlign="center",this.buttons={layout:"column",margin:"0 0 10px 0",defaults:{xtype:"button",columnWidth:.27},items:[{text:"同步数据",margin:"0 0 10px 10px",ref:"syncOrder"},{margin:"0 0 10px 10px",text:"清除缓存",ref:"refresh"}]},this.store=JE.getStore({type:"tree",tableName:"JE_CORE_ROLE",url:JE.getUrlMaps("je.core.rbac.perm","getSentryTree"),params:{whereSql:" and ROLETYPE='SENTRY' AND SENTRYID IN (SELECT SENTRYID FROM JE_CORE_SENTRY WHERE STATUS='1')"}}),this.callParent(arguments)}}),Ext.define("JE.sys.rbac.view.role.TreeMenu",{extend:"Ext.menu.Menu",alias:"widget.role.treemenu",defaultAlign:"br-tr",frame:!0,border:0}),Ext.define("JE.sys.rbac.view.roleuser.MainPermView",{extend:"Ext.panel.Panel",alias:"widget.roleuser.mainpermview",layout:"border",border:0,initComponent:function(){this.items=[{xtype:"panel",region:"west",width:300,layout:"border",border:0,itemId:"west",split:!0,items:[{xtype:"panel",title:"申请人信息",bodyStyle:"padding:10px;line-height:2;",tpl:['<div style="font-size: 20px;text-align: center;">{SY_CREATEUSERNAME}</div>','<div style="padding: 5px 10%;font-size: 14px;">部门：{SY_CREATEORGNAME}</div>','<div style="padding: 5px 10%;font-size: 14px;">申请时间：{SY_CREATETIME}</div>'],itemId:"info",region:"north",height:200,split:!0},this.getTreeView({title:"角色信息",region:"center",itemId:"roleTree"})]},this.getTreeView({title:"权限信息",region:"center",itemId:"permTree",dockedItems:[{xtype:"box",dock:"bottom",padding:"5",margin:"5",minHeight:30,html:"<font color='#333333'>普通颜色节点代表角色的模版权限，<br/>蓝色代表申请的浮动权限。</font>",cls:"x-view-emtpytext"}]})],this.callParent(arguments)},load:function(e){var t=this.getCmp("west").getCmp("info"),i=this.getCmp("west").getCmp("roleTree"),a=this.getCmp("permTree"),n=e.mainID;t.update(e);var o=JE.ajax({url:JE.getUrlMaps("je.core.rbac.perm","loadPermRoles"),params:{pkValue:n}}),r=i.getRootNode();r.removeAll(),0<o.length&&r.appendChild(o);var l=JE.ajax({url:JE.getUrlMaps("je.core.rbac.perm","loadRolePermSee"),params:{mainId:n}}),s=a.getRootNode();s.removeAll(),0<l.length&&s.appendChild(l);var d=a.getStore(),c=JE.ajax({url:JE.getUrlMaps("je.core.rbac.perm","loadUserDiyPerm"),params:{mainId:n}});Ext.each(c,function(e){var t=d.getNodeById(e);t&&(t.set("cls","je-perm-unable-node"),t.commit())})},setDisabled:function(){},getTreeView:function(e){return Ext.apply({xtype:"treepanel",rootVisible:!1,animCollapse:!1,useArrows:!0,animCollapse:!1,animate:!1,tools:[{type:"expand",callback:function(e,t,i){var a=t.type;e[a+"All"](),t.setType("expand"==a?"collapse":"expand")}}],viewConfig:{overItemCls:"",selectedItemCls:"",focusedItemCls:"",beforeFocusedItemCls:"",tableFocusedFirstCls:""}},e)}}),Ext.define("JE.sys.rbac.view.roleuser.MainView",{extend:"Ext.panel.Panel",border:1,frame:!1,alias:"widget.roleuser.mainview",title:"浮动权限的设定项",iconCls:"jeicon jeicon-role",layout:"fit",items:[{xtype:"roleuser.permdiyview",border:0}],buttonAlign:"center",buttons:[{text:"确定",ref:"okBtn",iconCls:"jeicon jeicon-check"}],initComponent:function(){this.callParent(arguments)}}),Ext.define("JE.sys.rbac.view.roleuser.PermDiyView",{extend:"Ext.tree.Panel",alias:"widget.roleuser.permdiyview",useArrows:!0,rootVisible:!1,animate:!1,multiSelect:!0,funcTree:!0,selectType:"A",selModel:{selType:"treemodel",allowDeselect:!0,mode:"SIMPLE"},root:{text:"ROOT",id:"ROOT",expanded:!0,children:[]},dockedItems:[{xtype:"box",dock:"bottom",padding:"5",margin:"5",minHeight:30,html:"<font color='#333333'>保存：代理人则在规定时间范围内拥有所被授予的权限。</font>",cls:"x-view-emtpytext"}]}),Ext.define("JE.sys.rbac.view.roleuser.RolePermCheckTree",{extend:"Ext.tree.Panel",alias:"widget.roleuser.rolepermchecktree",useArrows:!0,rootVisible:!1,animate:!1,multiSelect:!0,funcTree:!0,selectType:"A",selModel:{selType:"treemodel",allowDeselect:!0,mode:"SIMPLE"},root:{text:"ROOT",id:"ROOT",expanded:!0,children:[]},buttonAlign:"left",buttons:[{text:"确定",ref:"okBtn",iconCls:"jeicon jeicon-check"},{text:"全部展开",iconCls:"jeicon jeicon-arrow-down",ref:"expandAll",handler:function(e){e.up("panel[xtype=roleuser.rolepermchecktree]").expandAll()}},{text:"全部收缩",iconCls:"jeicon jeicon-arrow-up",ref:"collapseAll",handler:function(e){e.up("panel[xtype=roleuser.rolepermchecktree]").collapseAll()}}]}),Ext.define("JE.sys.rbac.view.roleuser.RolePermSeeTree",{extend:"Ext.tree.Panel",alias:"widget.roleuser.rolepermseetree",useArrows:!0,rootVisible:!1,animate:!1,border:1,multiSelect:!0,funcTree:!0,selectType:"A",selModel:{selType:"treemodel",allowDeselect:!0,mode:"SIMPLE"},buttons:[{text:"全部展开",iconCls:"jeicon jeicon-arrow-down",ref:"expandAll",hidden:!0,handler:function(e){e.up("panel[xtype=roleuser.rolepermseetree]").expandAll()}},{text:"全部收缩",iconCls:"jeicon jeicon-arrow-up",ref:"collapseAll",handler:function(e){e.up("panel[xtype=roleuser.rolepermseetree]").collapseAll()}}],buttonAlign:"left",initComponent:function(){this.callParent(arguments)}}),Ext.define("JE.sys.rbac.view.roleuser.RolePermTree",{extend:"Ext.tree.Panel",alias:"widget.roleuser.rolepermtree",useArrows:!0,rootVisible:!1,animate:!1,border:0,multiSelect:!1,funcTree:!0,selectType:"A",selModel:{selType:"treemodel",allowDeselect:!0,mode:"SINGLE"},viewConfig:{selectedItemCls:"x-tree-row-selected",focusedItemCls:"x-tree-row-focused",beforeFocusedItemCls:"x-tree-row-before-focused",tableFocusedFirstCls:"x-tree-table-focused-first"},initComponent:function(){this.callParent(arguments)}}),Ext.define("JE.sys.rbac.view.roleuser.RolePermView",{extend:"Ext.panel.Panel",alias:"widget.roleuser.rolepermview",layout:"card",border:0,initComponent:function(){var c=this,u=c.mainId,e=c.getTreeView({title:"角色信息",itemId:"roleTree",hideHeaders:!0,columns:[{xtype:"treecolumn",dataIndex:"text",flex:!0},{xtype:"actioncolumn",width:100,funcColumn:!0,align:"center",items:[{tooltip:"查看权限",iconCls:"fa fa-cog",iconStyle:"color:#3c8dbc",handler:function(e,t,i,a,n){var o=n.getTarget(".x-grid-row",4),r=e.getRecord(o).get("id"),l=c.getTreeView({title:"权限信息",itemId:"rolePermSeeTree",dockedItems:[{xtype:"box",dock:"bottom",padding:"5",margin:"5",minHeight:30,html:"<font color='#333333'>指定角色权限查看，<br/>普通颜色节点代表该角色模版授权，<br/>蓝色代表浮动权限，浮动权限可勾选申请。</font>",cls:"x-view-emtpytext"}]});JE.win({title:"权限查看",width:500,x:c.getX()+100,height:JE.getBodyHeight()-300,items:l,autoShow:!0,showFn:function(e){var t=e.getCmp("rolePermSeeTree"),i=JE.ajax({url:JE.getUrlMaps("je.core.rbac.perm","loadRoleAllPermSee"),params:{roleId:r}});t.getRootNode().appendChild(i);var a=JE.ajax({url:JE.getUrlMaps("je.core.rbac.perm","loadRoleDiyPermSee"),params:{roleId:r}}),n=t.store;Ext.each(a,function(e){var t=n.getById(e);t&&(t.set("cls","je-perm-unable-node"),t.commit())})}})}}]}],dockedItems:[{xtype:"box",dock:"bottom",padding:"5",margin:"5",minHeight:30,html:"<font color='#333333'>选择申请角色信息，<br/>普通颜色节点代表可以申请该角色，<br/>蓝色代表已有角色。</font>",cls:"x-view-emtpytext"}]}),t=c.getTreeView({title:"权限信息",itemId:"permTree",dockedItems:[{xtype:"box",dock:"bottom",padding:"5",margin:"5",minHeight:30,html:"<font color='#333333'>勾选浮动权限的申请，<br/>普通颜色节点代表可以申请的权限资源，<br/>蓝色代表该角色有包含权限，无需勾选。</font>",cls:"x-view-emtpytext"}]});c.items=[e,t],c.buttons=[{text:"下一步",itemId:"step",type:"next",cls:"JEPLUS_B_L10",handler:function(e){var t=e.type;if("next"==t){var i=c.getCmp("roleTree").getChecked();if(JE.isEmpty(i))return void JE.alert("请选择角色！");var a=[];Ext.each(i,function(e){a.push(e.raw.bean.ROLEID)});var n=c.getCmp("permTree").getRootNode();n.removeAll();var o=c.loadTreeData("perm",{roleIds:a.join(",")});JE.isNotEmpty(o)&&n.appendChild(o);var r=JE.ajax({url:JE.getUrlMaps("je.core.rbac.perm","loadCheckRolePerms"),params:{roleIds:a.join(",")}});Ext.each(r,function(e){var t=c.getCmp("permTree").store.getNodeById(e);t&&(t.set("checked",null),t.set("cls","je-perm-unable-node"),t.commit())})}e.type="next"==t?"prev":"next",e.setText("next"==t?"上一步":"下一步"),e.next().setVisible("next"==t),c.getLayout().setActiveItem("next"==t?"permTree":"roleTree")}},{text:"确定申请",itemId:"ok",hidden:!0,cls:"JEPLUS_B_C01",handler:function(){var e=c.getCmp("roleTree").getChecked(),t=c.getCmp("permTree").getChecked(),i=new Array,o=new Array;Ext.each(e,function(e){i.push(e.get("id"))}),Ext.each(t,function(e){var t=e.getPath(),i=t.indexOf("/",6),a="";a=-1!=i?t.substring(6,i):t.substring(6);var n=e.raw.nodeInfoType;o.push(a+"#"+n+"#"+e.get("id"))});var a=JE.ajax({url:JE.getUrlMaps("je.core.rbac.perm","doSaveRoleCheckPerm"),params:{mainId:u,roleIds:i.join(","),permIds:o.join(","),startWf:JE.isEmpty(u)?"1":"0"}});if(a.success)if(JE.isNotEmpty(c.mainId)){if(c.mainForm){c.mainForm.setValues({PERMWF_ROLENAME:a.obj.PERMWF_ROLENAME,PERMWF_ROLEID:a.obj.PERMWF_ROLEID},!0);var n=c.mainForm.up("jemainview");if(n){var r=n.down("jegridview");if(r){var l=r.store.getById(u);l&&(l.set("PERMWF_ROLENAME",a.obj.PERMWF_ROLENAME),l.set("PERMWF_ROLEID",a.obj.PERMWF_ROLEID),l.commit())}var s=c.mainForm.down("panel[xtype=roleuser.mainpermview]");if(s){var d=Ext.applyIf({mainID:c.mainId},a.obj);s.load(d)}}}JE.msg("权限重新设定成功!")}else JE.msg("权限申请成功!");else JE.alert("申请出错，请联系管理员!");c.up("window").close()}},{text:"取消",itemId:"calcel",handler:function(){c.up("window").close()}}],c.callParent(arguments)},afterRender:function(){var i=this;i.callParent(arguments);var e=i.loadTreeData("role");if(JE.isNotEmpty(e)){i.getCmp("roleTree").getRootNode().appendChild(e);var t=JE.ajax({url:JE.getUrlMaps("je.core.rbac.perm","loadUserRoles")});if(Ext.each(t,function(e){var t=i.getCmp("roleTree").store.getNodeById(e);t&&(t.set("checked",null),t.set("cls","je-perm-unable-node"),t.commit())}),JE.isNotEmpty(i.mainId)){var a=JE.ajax({url:JE.getUrlMaps("je.core.getInfoById"),params:{tableCode:"JE_SYS_PERMWF",pkValue:i.mainId}});if(JE.isNotEmpty(a)){var n=Ext.value(a.PERMWF_ROLEID,"").split(","),o=i.getCmp("roleTree").store;Ext.each(n,function(e){var t=o.getNodeById(e);t&&"je-perm-unable-node"!=t.get("cls")&&(t.set("checked",!0),t.commit())})}}}},loadTreeData:function(e,t){t=t||{};var i={ddCode:"role"==e?"JE_RBAC_ROLE":"JE_SYS_ROLEDIYPERM",ddName:"",async:!1,whereSql:"",orderSql:"",parentSql:"",rootId:"",nodeInfo:"",params:{},initParams:{},moreRoot:!1,queryField:"",nodeField:"",formatValue:"",zwfFlag:"0"};if("role"==e){var a=JE.ajax({url:JE.getUrlMaps("je.core.rbac.perm","loadDeptRoles")});i.whereSql=" AND ROLEID IN ('"+a.join("','")+"')"}return i.params=t,JE.ajax({url:JE.getUrlMaps("je.core.dd.tree","loadTree"),params:Ext.apply({roleIds:"",node:"ROOT",onlyItem:!0,excludes:"",strData:Ext.encode([i]),parentSql:"",whereSql:""},t)})},getTreeView:function(e){return Ext.apply({xtype:"treepanel",rootVisible:!1,animCollapse:!1,useArrows:!0,animCollapse:!1,animate:!1,selectType:"A",funcTree:!0,selModel:{selType:"treemodel",allowDeselect:!0,mode:"SIMPLE"},tools:[{type:"expand",callback:function(e,t,i){var a=t.type;e[a+"All"](),t.setType("expand"==a?"collapse":"expand")}}],viewConfig:{overItemCls:"",selectedItemCls:"",focusedItemCls:"",beforeFocusedItemCls:"",tableFocusedFirstCls:""}},e)}}),Ext.define("JE.sys.rbac.view.user.DeptUserTree",{extend:"Ext.tree.Panel",alias:"widget.user.deptusertree",useArrows:!0,rootVisible:!1,animate:!1,border:0,multiSelect:!1,initComponent:function(){var e=this,t="";"1"==JE.systemConfig.JE_SYSMODE&&(t=" AND ZHID='"+JE.currentUser.zhId+"'"),e.store=JE.getStore({type:"tree",tableName:"JE_CORE_VDEPTUSER",multi:!1,params:{whereSql:" and STATUS='1'  AND VALID='1' AND NODEINFOTYPE='0' "+t,orderSql:" ORDER BY PARENT asc,NODEINFO asc, ORDERINDEX asc "}}),e.viewConfig=Ext.value(e.viewConfig,{}),e.viewConfig.plugins=Ext.value(e.viewConfig.plugins,[]),e.viewConfig.listeners=Ext.value(e.viewConfig.listeners,{}),e.viewConfig.plugins.push({ptype:"treeviewdragdrop",allowParentInserts:!1}),e.viewConfig.listeners=Ext.apply(e.viewConfig.listeners,{beforedrop:function(e,t,i,a,n){return t.append=!1,t.order=!1,"append"==a?(n.cancelDrop(),!1):t.records[0].parentNode.getId()!=i.parentNode.getId()?(n.cancelDrop(),!1):void(t.order=!0)},drop:function(e,t,i,a,n){var o=this.panel,r={success:!0};t.records[0];if(t.order&&r.success){var l=[];i.parentNode.eachChild(function(e){var t={};"1"!=e.get("NODEINFO")&&(t.USERID=e.get("id"),t.USERORDER=e.get("index")+1,e.set("orderIndex",t.USERORDER),l.push(t))}),r=JE.ajax({url:JE.getUrlMaps("je.core.updateList"),params:{strData:Ext.encode(l),tableCode:"JE_CORE_ENDUSER"}})}r.success?(o.getSelectionModel().deselectAll(),o.fireEvent("selectionchange",o.getSelectionModel(),[]),JE.msg("操作完成")):JE.alert(r.obj)}}),this.callParent(arguments)}}),Ext.define("JE.sys.rbac.view.user.UserGrid",{extend:"Ext.grid.Panel",alias:"widget.user.usergrid",selModel:{selType:"checkboxmodel"},frame:!1,enableColumnHide:!1,sortableColumns:!1,columnLines:!0,multiSelect:!0,enableKeyNav:!0,cls:"je-show-rows",dockedItems:[{xtype:"toolbar",dock:"bottom",margin:"0 0 10px 0",padding:"10px 0",defaults:{style:"margin: 0px 0px 0px 10px;width: 89px;cursor: pointer;padding: 6px 12px !important;border-radius: 4px;background-image: none;background-color: rgba(240, 244, 249, 1);color: #444;"},items:[{xtype:"button",ref:"implUser",text:"添加人员"},{xtype:"button",ref:"impl",text:"按部门导入"},{xtype:"button",ref:"implSentry",text:"按岗位导入",hidden:!0},{xtype:"button",ref:"remove",text:"移除人员"}]}],columns:{items:[{text:"主键",cls:"je-user-noright",dataIndex:"USERID",hidden:!0},{xtype:"rownumberer",cls:"je-user-noright",width:35,text:"No.",align:"left"},{text:"姓名",cls:"je-user-noright",dataIndex:"USERNAME",width:110,henderInnerStyle:"text-align:left;"},{text:"帐号",cls:"je-user-noright",dataIndex:"BACKUSERCODE",width:150,henderInnerStyle:"text-align:left;"},{text:"帐号(登录)",dataIndex:"USERCODE",width:110,hidden:!0,henderInnerStyle:"text-align:left;"},{text:"部门",cls:"je-user-noright",dataIndex:"DEPTNAME",width:120,henderInnerStyle:"text-align:left;"},{text:"创建人",cls:"je-user-noright",dataIndex:"CREATEUSERNAME",width:120,henderInnerStyle:"text-align:left;"},{text:"创建时间",cls:"je-user-noright",dataIndex:"CREATETIME",width:135,henderInnerStyle:"text-align:left;"},{text:"操作",xtype:"actioncolumn",align:"center",funcColumn:!0,tdCls:"je-grid-actioncolumn",minWidth:150,flex:1,items:[{style:"color:red;text-decoration:none",tooltip:"移除",handler:function(e,t,i){var a=e.panel,n=a.up("panel[xtype=role.mainview]").down("panel[ref=role_group_tab]").getActiveTab().getSelectionModel().getSelection()[0];if(n)if(n.raw&&"DEPT"==n.raw.nodeInfo)JE.alert("部门 人员不允许删除!");else if(n.raw&&"SENTRY"==n.raw.nodeInfo)JE.alert("岗位人员不允许删除!");else{var o=a.getStore().getAt(t);JE.confirm("确定移除吗？",function(e){if("ok"==e){var t=JE.ajax({url:JE.getUrlMaps("je.core.rbac.role","removeUsers"),params:{tableCode:"JE_CORE_ROLE",ids:o.get("USERID"),pkValue:n.get("id")}});t.success?(a.getStore().remove(o),JE.msg("移除成功!")):JE.alert(t.obj)}})}else JE.alert("请选择角色!")}},{style:"text-decoration:none",tooltip:"查看权限",handler:function(e,t,i){var a=e.panel.getStore().getAt(t),n=JE.ajax({url:JE.getUrlMaps("je.core.rbac.perm","getUserPermTree"),params:{tableCode:"JE_CORE_ENDUSER",USERID:a.get("USERID"),excludes:"checked"}});JE.win({title:"权限查看("+a.get("USERNAME")+")",width:400,height:JE.getBodyHeight()<700?JE.getBodyHeight()-100:700,maximizable:!1,items:{xtype:"treepanel",useArrows:!0,animate:!1,border:0,rootVisible:!1,root:{text:"ROOT",id:"ROOT",expanded:!0,children:n.children}},cancelButtonText:"关闭",useButton:["cancelButton"],autoShow:!0})}}]}]},initComponent:function(){this.store=JE.getStore({id:"USERID",tableName:"JE_CORE_ENDUSER",params:{limit:30,whereSql:" and 1!=1"}}),this.bbar={cls:"je-user-uxpagingtoolbar",items:[{xtype:"uxpagingtoolbar",cls:"je-user-uxpagingtoolbar-left",store:this.store,border:0,displayInfo:!0,height:20},"->",{xtype:"uxtrigger",fieldLabel:"查询",labelWidth:35,style:"margin-right:30px;",width:200,ref:"querytext"}]},this.plugins=[Ext.create("Ext.grid.plugin.CellEditing",{clicksToEdit:1,pluginId:"cellEdit"})],this.callParent(arguments)}}),Ext.define("JE.sys.rbac.controller.AdminPermController",{extend:"Ext.app.Controller",init:function(){var l=this;l.permData=l.initPermTree();var e={"treepanel[xtype=perm.admintree]":{selectionchange:function(e,t,i){var a=e.view.panel,n=a.up("panel[xtype=perm.mainview]"),o=n.down("treepanel[xtype=perm.permtree]"),r=n.down("treepanel[xtype=perm.moduletree]");l.loadPermTree(a,r,o,n,"ADMIN")}},"treepanel[xtype=perm.admintree] button[ref=ins]":{click:function(e){var r=e.up("treepanel[xtype=perm.admintree]"),l=r.getRootNode();JE.prompt("请输入分级管理员名称",function(e,t){if("cancel"!=e&&!Ext.isEmpty(t)){var i={tableCode:"JE_CORE_ADMININFO",SY_PARENT:l.get("id"),SY_PATH:l.getPath(),SY_LAYER:"1",ADMININFO_TEXT:t,ADMININFO_CODE:JE.toPinYin(t,"PY"),ADMININFO_ICONCLS:"jeicon jeicon-khgl-pc",SY_NODETYPE:"LEAF"},a=JE.ajax({url:JE.getUrlMaps("je.core.rbac.adminPerm","doSave"),params:i});if(!a.success)return JE.alert(a.obj),!1;var n=a.obj,o={id:n.JE_CORE_ADMININFO_ID,text:n.ADMININFO_TEXT,code:n.ADMININFO_CODE,leaf:"LEAF"==n.SY_NODETYPE,nodePath:n.SY_PATH,parentPath:n.SY_PARENTPATH,nodeInfo:n.SY_NODEINFO,nodeInfoType:n.SY_NODEINFOTYPE,iconCls:n.ADMININFO_ICONCLS,parent:n.SY_PARENT,children:[],expandable:!0};o=l.appendChild(o);r.selectPath(o.getPath())}})}},"menu[xtype=perm.treemenu]":{click:function(e,t,i,a){var n=e.adminTree.getSelectionModel().getSelection()[0];n&&("update"==t.ref?JE.prompt("请输入分级管理员名称",function(e,t){if("cancel"!=e&&!Ext.isEmpty(t)){var i=JE.ajax({url:JE.getUrlMaps("je.core.rbac.adminPerm","doUpdate"),params:{tableCode:"JE_CORE_ADMININFO",JE_CORE_ADMININFO_ID:n.get("id"),ADMININFO_TEXT:t,ADMININFO_CODE:JE.toPinYin(t,"PY")}});i.success?(n.set("text",i.obj.ADMININFO_TEXT),n.set("code",i.obj.ADMININFO_CODE),n.commit()):JE.alert(i.obj)}}):JE.confirm("是否删除("+n.get("text")+")",function(e,t){if("ok"==e){var i=JE.ajax({url:JE.getUrlMaps("je.core.rbac.adminPerm","doRemove"),params:{tableCode:"JE_CORE_ADMININFO",ids:n.get("id")}});i.success?(n.remove(),JE.msg("删除成功!")):JE.alert(i.obj)}}))}},"treepanel[xtype=perm.admintree] button[ref=refresh]":{click:function(e){e.up("treepanel[xtype=perm.admintree]").getStore().load()}},"treepanel[xtype=perm.moduletree]":{selectionchange:function(e,t,i){var a=e.view.panel,n=a.up("panel[xtype=perm.mainview]"),o=n.down("treepanel[xtype=perm.permtree]"),r=n.down("treepanel[xtype=perm.admintree]");l.loadPermTree(r,a,o,n,"MODULE")}},"panel[xtype=perm.centerview] button[ref=saveBtn]":{click:function(e){var t=e.up("panel[xtype=perm.mainview]"),i=t.down("treepanel[xtype=perm.admintree]");l.doUpdatePerm(t,i)}},"panel[xtype=perm.centerview] button[ref=resetBtn]":{click:function(e){var t=e.up("panel[xtype=perm.mainview]").down("treepanel[xtype=perm.admintree]"),i=t.getSelectionModel().getSelection()[0];i&&t.fireEvent("selectionchange",t.getSelectionModel(),[i])}},"panel[xtype=perm.adminuserview] button[ref=deptImpl]":{click:function(e){var t=e.up("panel[xtype=perm.adminuserview]").down("dataview"),i=t.up("panel[xtype=perm.mainview]").down("panel[xtype=perm.admintree]").getSelectionModel().getSelection()[0];i?Ext.create("JE.sys.rbac.view.perm.imp.UserInsWinView",{title:"管理员( : "+i.get("text")+")",userView:t,adminId:i.get("id"),impType:"DEPT"}).show():JE.alert("请选择分级管理员!")}},"panel[xtype=perm.adminuserview] button[ref=sentryImpl]":{click:function(e){var t=e.up("panel[xtype=perm.adminuserview]").down("dataview"),i=t.up("panel[xtype=perm.mainview]").down("panel[xtype=perm.admintree]").getSelectionModel().getSelection()[0];i?Ext.create("JE.sys.rbac.view.perm.imp.UserInsWinView",{title:"管理员( : "+i.get("text")+")",userView:t,adminId:i.get("id"),impType:"SENTRY"}).show():JE.alert("请选择分级管理员!")}},"panel[xtype=perm.adminuserview] button[ref=roleImpl]":{click:function(e){var t=e.up("panel[xtype=perm.adminuserview]").down("dataview"),i=t.up("panel[xtype=perm.mainview]").down("panel[xtype=perm.admintree]").getSelectionModel().getSelection()[0];i?Ext.create("JE.sys.rbac.view.perm.imp.UserInsWinView",{title:"管理员( : "+i.get("text")+")",userView:t,adminId:i.get("id"),impType:"ROLE"}).show():JE.alert("请选择分级管理员!")}},"panel[xtype=perm.adminuserview] button[ref=remove]":{click:function(e){var a=e.up("panel[xtype=perm.adminuserview]").down("dataview"),n=a.up("panel[xtype=perm.mainview]").down("panel[xtype=perm.admintree]").getSelectionModel().getSelection()[0];if(n){var t=a.getSelectionModel().getSelection(),o=new Array;Ext.each(t,function(e){o.push(e.get("USERID"))}),0<o.length?JE.confirm("是否删除选中人员?",function(e,t){if("ok"==e){var i=JE.ajax({url:JE.getUrlMaps("je.core.rbac.adminPerm","doRemoveUsers"),params:{tableCode:"JE_CORE_ADMININFO",pkValue:n.get("id"),ids:o.join(",")}});i.success?(JE.msg(i.obj),a.getStore().load()):JE.alert(i.obj)}}):JE.alert("请选择人员!")}else JE.alert("请选择分级管理员!")}},"panel[xtype=perm.adminuserview] button[ref=removeAll]":{click:function(e){var a=e.up("panel[xtype=perm.adminuserview]").down("dataview"),n=a.up("panel[xtype=perm.mainview]").down("panel[xtype=perm.admintree]").getSelectionModel().getSelection()[0];if(n){var o=new Array;a.getStore().each(function(e){o.push(e.get("USERID"))}),0<o.length&&JE.confirm("是否删除选中人员?",function(e,t){if("ok"==e){var i=JE.ajax({url:JE.getUrlMaps("je.core.rbac.adminPerm","doRemoveUsers"),params:{tableCode:"JE_CORE_ADMININFO",pkValue:n.get("id"),ids:o.join(",")}});i.success?(JE.msg(i.obj),a.getStore().load()):JE.alert(i.obj)}})}else JE.alert("请选择分级管理员!")}},"window[xtype=perm.userinswinview]":{render:function(o){var t=[],i="DEPTNAME";"SENTRY"==o.impType?i="SENTRYNAMES":"ROLE"==o.impType&&(i="ROLENAMES"),o.userView.getStore().each(function(e){t.push({id:e.get("USERID"),text:e.get("USERNAME"),parentId:e.get("DEPTID"),nodeInfoType:e.get("USERID"),parentText:e.get(i)})}),o.down("[ref=multiselect]").store.loadData(t),o.down("treepanel[ref=oktree] combobox[ref=queryTreeCBB]").store.loadData(t),o.down("button[ref=delete]").on("click",function(e){var t=o.down("[ref=multiselect]"),i=t.getSelected();if(0!=i.length){t.store.remove(i),0<t.store.data.length&&t.boundList.getSelectionModel().select(0);var a=o.down("treepanel[ref=deptusertree]");o.down("treepanel[ref=oktree]").loadUsers({tree:a,recs:t.store.data.items})}else JE.alert("请选中人员！")}),o.down("button[ref=treeDelete]").on("click",function(e){var t=o.down("[ref=oktree]"),i=o.down("[ref=multiselect]"),a=t.getSelectionModel().getSelection()[0];if(a){a.isLeaf()?i.store.remove(i.store.getById(a.get("id"))):a.findChildBy(function(e){e.isLeaf()&&i.store.remove(i.store.getById(e.get("id")))},a,!0);var n=o.down("treepanel[ref=deptusertree]");t.loadUsers({tree:n,recs:i.store.data.items})}}),o.down("button[ref=okBtn]").on("click",function(e){var t=o.down("[ref=multiselect]"),i=[];t.store.each(function(e){i.push(e.get(t.valueField))});var a=i.join(",");if(0!=i.length){var n=JE.ajax({url:JE.getUrlMaps("je.core.rbac.adminPerm","doUpdateUsers"),params:{tableCode:"JE_CORE_ADMININFO",pkValue:o.adminId,ids:a}});n.success?(JE.msg(n.obj),o.userView.getStore().load()):JE.alert(n.obj)}o.close()}),o.down("button[ref=cancleBtn]").on("click",function(e){o.close()})}}};l.control(e)},loadPermTree:function(e,t,i,a,n){var o=this,r=i.getRootNode();r.removeAll();var l=e.getSelectionModel().getSelection()[0],s=t.getSelectionModel().getSelection();if(o.permData){if(0<s.length){var d=new Array;Ext.each(s,function(e){var t=e.get("id"),i=o.permData.get(t);d.push(Ext.clone(i))}),d.sort(function(e,t){return Ext.value(e.orderIndex,0)-Ext.value(t.orderIndex,0)}),r.appendChild(d)}var c=a.down("treepanel[ref=ROLE_PERM]"),u=a.down("treepanel[ref=ROLE_SELECT]"),p=a.down("treepanel[ref=ROLE_UPDATE]"),f=a.down("treepanel[ref=DEPT_PERM]"),E=a.down("treepanel[ref=DEPT_SELECT]"),m=a.down("treepanel[ref=DEPT_UPDATE]"),g=a.down("treepanel[ref=SENTRY_PERM]"),h=a.down("treepanel[ref=SENTRY_SELECT]"),x=a.down("treepanel[ref=SENTRY_UPDATE]");if("ADMIN"==n){o.doDelChecked(c),o.doDelChecked(u),o.doDelChecked(p),o.doDelChecked(f),o.doDelChecked(E),o.doDelChecked(m),o.doDelChecked(g),o.doDelChecked(h),o.doDelChecked(x);var v=a.down("panel[xtype=perm.adminuserview]"),y=v.down("dataview").getStore();l?(v.disabledBtn(!1),y.getProxy().extraParams.whereSql=" AND USERID IN (SELECT USERID FROM JE_CORE_ADMIN_USER WHERE ADMINID='"+l.get("id")+"')"):(v.disabledBtn(!0),y.getProxy().extraParams.whereSql=" AND 1!=1"),y.load()}if(l){var b=i.getStore(),C=c.getStore(),w=u.getStore(),S=p.getStore(),I=f.getStore(),T=E.getStore(),_=m.getStore(),J=g.getStore(),D=h.getStore(),A=x.getStore(),N=new Array,O=new Array,R=new Array,L=new Array,P=new Array,M=new Array,F=new Array,k=new Array,U=new Array,j=new Array,B=JE.ajax({url:JE.getUrlMaps("je.core.rbac.adminPerm","getAdminPerm"),params:{tableCode:"JE_CORE_ADMINPERM",pkValue:l.get("id")}});Ext.each(B,function(e){var t=e.ADMINPERM_TYPE,i=e.ADMINPERM_RESID;if("RES_MENU"==t||"RES_SUBFUNC"==t)(a=b.getNodeById(i))&&(a.set("checked",!0),a.commit(),N.push(Ext.clone(a)));else if("ROLE_PERM"==t){(a=C.getNodeById(i))&&(a.set("checked",!0),a.commit(),O.push(Ext.clone(a)))}else if("ROLE_SELECT"==t){(a=w.getNodeById(i))&&(a.set("checked",!0),a.commit(),R.push(Ext.clone(a)))}else if("ROLE_UPDATE"==t){(a=S.getNodeById(i))&&(a.set("checked",!0),a.commit(),L.push(Ext.clone(a)))}else if("DEPT_PERM"==t){(a=I.getNodeById(i))&&(a.set("checked",!0),a.commit(),P.push(Ext.clone(a)))}else if("DEPT_SELECT"==t){(a=T.getNodeById(i))&&(a.set("checked",!0),a.commit(),M.push(Ext.clone(a)))}else if("DEPT_UPDATE"==t){(a=_.getNodeById(i))&&(a.set("checked",!0),a.commit(),F.push(Ext.clone(a)))}else if("SENTRY_PERM"==t){(a=J.getNodeById(i))&&(a.set("checked",!0),a.commit(),k.push(Ext.clone(a)))}else if("SENTRY_SELECT"==t){(a=D.getNodeById(i))&&(a.set("checked",!0),a.commit(),U.push(Ext.clone(a)))}else if("SENTRY_UPDATE"==t){var a;(a=A.getNodeById(i))&&(a.set("checked",!0),a.commit(),j.push(Ext.clone(a)))}}),i.oldCheckedRecord=N,c.oldCheckedRecord=O,u.oldCheckedRecord=R,p.oldCheckedRecord=L,f.oldCheckedRecord=P,E.oldCheckedRecord=M,m.oldCheckedRecord=F,g.oldCheckedRecord=k,h.oldCheckedRecord=U,x.oldCheckedRecord=j}}},doUpdatePerm:function(e,t){var i=this,a=t.getSelectionModel().getSelection()[0];if(a){var n=e.down("treepanel[xtype=perm.permtree]"),o=e.down("treepanel[ref=ROLE_PERM]"),r=e.down("treepanel[ref=ROLE_SELECT]"),l=e.down("treepanel[ref=ROLE_UPDATE]"),s=e.down("treepanel[ref=DEPT_PERM]"),d=e.down("treepanel[ref=DEPT_SELECT]"),c=e.down("treepanel[ref=DEPT_UPDATE]"),u=e.down("treepanel[ref=SENTRY_PERM]"),p=e.down("treepanel[ref=SENTRY_SELECT]"),f=e.down("treepanel[ref=SENTRY_UPDATE]"),E=new Array,m=new Array;i.doCheckedPerm(n,"RES_MENU",E,m),i.doCheckedPerm(o,"ROLE_PERM",E,m),i.doCheckedPerm(r,"ROLE_SELECT",E,m),i.doCheckedPerm(l,"ROLE_UPDATE",E,m),i.doCheckedPerm(s,"DEPT_PERM",E,m),i.doCheckedPerm(d,"DEPT_SELECT",E,m),i.doCheckedPerm(c,"DEPT_UPDATE",E,m),i.doCheckedPerm(u,"SENTRY_PERM",E,m),i.doCheckedPerm(p,"SENTRY_SELECT",E,m),i.doCheckedPerm(f,"SENTRY_UPDATE",E,m);var g={tableCode:"JE_CORE_ADMININFO",JE_CORE_ADMININFO_ID:a.get("id")};g.delPermIds=E.join(","),g.addPermIds=m.join(",");var h=JE.ajax({url:JE.getUrlMaps("je.core.rbac.adminPerm","doUpdatePerm"),params:g});h.success?(n.oldCheckedRecord=n.getChecked(),o.oldCheckedRecord=o.getChecked(),r.oldCheckedRecord=r.getChecked(),l.oldCheckedRecord=l.getChecked(),s.oldCheckedRecord=s.getChecked(),d.oldCheckedRecord=d.getChecked(),c.oldCheckedRecord=c.getChecked(),u.oldCheckedRecord=u.getChecked(),p.oldCheckedRecord=p.getChecked(),f.oldCheckedRecord=f.getChecked(),JE.msg(h.obj)):JE.alert(h.obj)}else JE.alert("请选择分级管理员!")},doCheckedPerm:function(e,a,t,n){var i=e.getChecked(),o=e.oldCheckedRecord;Ext.each(i,function(t){var i=!1;Ext.each(o,function(e){t.get("id")==e.get("id")&&(i=!0,e.isHave=!0)}),i||("SUB_FUNC"==t.raw.nodeInfoType?n.push(t.get("id")+"#RES_SUBFUNC"):n.push(t.get("id")+"#"+a))}),Ext.each(o,function(e){e.isHave||("SUB_FUNC"==e.raw.nodeInfoType?t.push(e.get("id")+"#RES_SUBFUNC"):t.push(e.get("id")+"#"+a)),delete e.isHave})},doDelChecked:function(e){Ext.each(e.getChecked(),function(e){e.set("checked",!1),e.commit()}),e.oldCheckedRecord=[]},initPermTree:function(){var e=JE.ajax({url:JE.getUrlMaps("je.core.rbac.adminPerm","getPermTree"),params:{node:"ROOT"}});if(0<e.children.length){var t=Ext.create("Ext.util.MixedCollection");return Ext.each(e.children,function(e){t.add(e.id,e)}),t}return null},views:["JE.sys.rbac.view.perm.AdminTree","JE.sys.rbac.view.perm.AdminUserView","JE.sys.rbac.view.perm.DeptTree","JE.sys.rbac.view.perm.ModuleTree","JE.sys.rbac.view.perm.PermTree","JE.sys.rbac.view.perm.RoleTree","JE.sys.rbac.view.perm.SentryTree","JE.sys.rbac.view.perm.MainView","JE.sys.rbac.view.perm.CenterView","JE.sys.rbac.view.perm.imp.RoleDUTView","JE.sys.rbac.view.perm.imp.RoleInsDeptUserTreeView","JE.sys.rbac.view.perm.imp.UserInsWinView","JE.sys.rbac.view.perm.TreeMenu"]}),Ext.define("JE.sys.rbac.controller.CjglController",{extend:"Ext.app.Controller",init:function(){var s=this;s.copyInfo=null;var e={"treepanel[xtype=cjgl.cjgltree]":{selectionchange:function(e,t,i){var a=e.view.panel.up("panel[xtype=cjgl.mainview]"),n=a.down("treepanel[xtype=cjgl.resulttree]"),o=a.down("treepanel[xtype=cjgl.depttree]"),r=t[0],l=(n.getStore(),n.getRootNode()),s=o.getStore();l.removeAll();s.getRootNode();var d=s.tree.nodeHash;for(var c in d){var u=d[c];u.set("cls",""),u.commit()}if(r){var p={tableCode:"JE_CORE_JDGSINFO",parentSql:" AND JE_CORE_YWCJ_ID='"+r.get("id")+"'",whereSql:"  AND JE_CORE_YWCJ_ID='"+r.get("id")+"' AND JDGSINFO_TYPE_CODE='SHOW'",moreRoot:!0,excludes:"checked"},f=JE.ajax({url:JE.getUrlMaps("je.core.rbac.cjgl","getTree"),params:p});JE.isNotEmpty(f.id)&&(f.parent="ROOT",datas=l.appendChild([f]),l.cascadeBy(function(e){var t=e.raw.nodeInfo;if(JE.isNotEmpty(t)){var i=s.getNodeById(t);null!=i&&(i.set("cls","rbac-cjgl-sel"),i.commit())}}))}}},"treepanel[xtype=cjgl.cjgltree] button[ref=ins]":{click:function(e){var r=e.up("treepanel[xtype=cjgl.cjgltree]"),l=r.getRootNode();JE.prompt("请输入业务关系名称",function(e,t){if("cancel"!=e&&!Ext.isEmpty(t)){var i={tableCode:"JE_CORE_YWCJ",SY_PARENT:l.get("id"),SY_PATH:l.getPath(),SY_LAYER:"1",SY_NODETYPE:"LEAF",YWCJ_MC:t,YWCJ_BM:JE.toPinYin(t,"PY"),YWCJ_YECJTYPE_NAME:"部门级",YWCJ_YECJTYPE_CODE:"DEPT",YWCJ_BASEID:"SYSTEM",YWCJ_TYPE:"OTHER"},a=JE.ajax({url:JE.getUrlMaps("je.core.rbac.cjgl","doSave"),params:i});if(!a.success)return JE.alert(a.obj),!1;var n=a.obj,o={id:n.JE_CORE_YWCJ_ID,text:n.YWCJ_MC,code:n.YWCJ_BM,leaf:"LEAF"==n.SY_NODETYPE,nodePath:n.SY_PATH,parentPath:n.SY_PARENTPATH,nodeInfo:n.SY_NODEINFO,nodeInfoType:n.SY_NODEINFOTYPE,parent:n.SY_PARENT,children:[],expandable:!0};o=l.appendChild(o);r.selectPath(o.getPath())}})}},"treepanel[xtype=cjgl.cjgltree] button[ref=modfiy]":{click:function(e){var t=e.up("treepanel[xtype=cjgl.cjgltree]"),r=(t.getRootNode(),t.up("panel[xtype=cjgl.mainview]").down("treepanel[xtype=cjgl.resulttree]")),l=t.getSelectionModel().getSelection()[0];l?JE.prompt("请输入新业务关系名称",function(e,t){if("cancel"!=e&&!Ext.isEmpty(t)){var i={tableCode:"JE_CORE_YWCJ",JE_CORE_YWCJ_ID:l.get("id"),YWCJ_MC:t},a=JE.ajax({url:JE.getUrlMaps("je.core.rbac.cjgl","doUpdate"),params:i});if(!a.success)return JE.alert(a.obj),!1;var n=a.obj;l.set("text",n.YWCJ_MC),l.commit();var o=r.getRootNode().getChildAt(0);o&&(o.set("text",n.YWCJ_MC),o.commit()),JE.msg("修改成功!")}},null,l.get("text")):JE.alert("请选中业务关系节点!")}},"treepanel[xtype=cjgl.cjgltree] button[ref=del]":{click:function(e){var n=e.up("treepanel[xtype=cjgl.cjgltree]"),o=(n.getRootNode(),n.getSelectionModel().getSelection()[0]);if(o){if("JTGS"==o.get("bean").YWCJ_TYPE)return void JE.alert("组织架构层级不允许删除!");JE.confirm("是否要删除该关系?",function(e,t){if("ok"==e){var i={tableCode:"JE_CORE_YWCJ",ids:o.get("id")},a=JE.ajax({url:JE.getUrlMaps("je.core.rbac.cjgl","doRemove"),params:i});if(!a.success)return JE.alert(a.obj),!1;n.getStore().load(),JE.msg("删除成功!")}})}else JE.alert("请选中业务关系节点!")}},"treepanel[xtype=cjgl.cjgltree] button[ref=copy]":{click:function(e){var t=e.up("treepanel[xtype=cjgl.cjgltree]"),i=(t.getRootNode(),t.getSelectionModel().getSelection()[0]);if(i){if("JTGS"==i.get("bean").YWCJ_TYPE)return void JE.alert("组织架构层级不允许复制!");s.copyInfo=i.get("id"),JE.msg("已经将【"+i.get("text")+"】放入剪切板!")}else JE.alert("请选中业务关系节点!")}},"treepanel[xtype=cjgl.cjgltree] button[ref=paste]":{click:function(e){var r=e.up("treepanel[xtype=cjgl.cjgltree]"),l=r.getRootNode();JE.isNotEmpty(s.copyInfo)?JE.confirm("确定要粘贴该关系?",function(e,t){if("ok"==e){var i={tableCode:"JE_CORE_YWCJ",ids:s.copyInfo},a=JE.ajax({url:JE.getUrlMaps("je.core.rbac.cjgl","paste"),params:i});if(a.success){var n=a.obj,o={id:n.JE_CORE_YWCJ_ID,text:n.YWCJ_MC,code:n.YWCJ_BM,leaf:"LEAF"==n.SY_NODETYPE,nodePath:n.SY_PATH,parentPath:n.SY_PARENTPATH,nodeInfo:n.SY_NODEINFO,nodeInfoType:n.SY_NODEINFOTYPE,parent:n.SY_PARENT,children:[],expandable:!0};o=l.appendChild(o);r.selectPath(o.getPath()),JE.msg("粘贴成功!")}else JE.alert(a.obj)}}):JE.alert("剪切板为空，请先复制关系!")}},"treepanel[xtype=cjgl.cjgltree] button[ref=saveDd]":{click:function(e){var a=e.up("treepanel[xtype=cjgl.cjgltree]").getSelectionModel().getSelection()[0];a?JE.win({title:"添加字典",width:350,height:300,border:0,layout:"fit",items:{xtype:"form",layout:"anchor",width:320,margin:"0 2 0 0",bodyPadding:"10",bodyStyle:{background:"#FFFEDB"},defaults:{xtype:"textfield",labelAlign:"right",labelWidth:100,anchor:"100%",allowBlank:!1},items:[{fieldLabel:"字典名称",name:"DICTIONARY_DDNAME"},{fieldLabel:"字典编码",name:"DICTIONARY_DDCODE"},{xtype:"treessfield",fieldLabel:"所属子系统",configInfo:"JE_SYSTEM,DICTIONARY_BELONGSTONAME~DICTIONARY_BELONGSTO,text~code,S",name:"DICTIONARY_BELONGSTONAME"},{xtype:"rgroup",fieldLabel:"类型",allowBlank:!0,configInfo:"JE_CORE_DEPTDICTYPE",value:"DEPT",name:"DEPTDICTYPE"},{xtype:"hidden",name:"DICTIONARY_BELONGSTO"}]},useButton:!0,fn:function(e){var t=e.down("form").form.getValues();if(t.tableCode="JE_CORE_DICTIONARY",t.cjglId=a.get("id"),JE.isEmpty(t.DICTIONARY_DDNAME))JE.alert("请输入字典名称!");else if(JE.isEmpty(t.DICTIONARY_DDCODE))JE.alert("请输入字典编码!");else if(JE.isEmpty(t.DICTIONARY_BELONGSTONAME))JE.alert("请选择字典所属的子系统!");else{var i=JE.ajax({url:JE.getUrlMaps("je.core.rbac.cjgl","saveDicNode"),params:t});i.success?JE.msg("字典添加成功!"):JE.alert(i.obj)}}}).show():JE.alert("请选择业务关系!")}},"treepanel[xtype=cjgl.cjgltree] button[ref=refresh]":{click:function(e){var t=e.up("treepanel[xtype=cjgl.cjgltree]"),i=t.up("panel[xtype=cjgl.mainview]");t.getStore().load(),i.down("panel[xtype=cjgl.depttree]").getStore().load()}},"treepanel[xtype=cjgl.resulttree]":{selectionchange:function(e,t,i){var a=e.view.panel.up("panel[xtype=cjgl.mainview]"),n=a.down("panel[xtype=cjgl.depttree]"),o=a.down("panel[xtype=cjgl.deptform]"),r=t[0];if(r){var l=r.raw.nodeInfo,s=JE.ajax({url:JE.getUrlMaps("je.core.rbac.rbac","getInfoById"),params:{tableCode:"JE_CORE_DEPARTMENT",pkValue:l}});if(null!=s&&0!=s.success){var d={DEPTID:s.DEPTID,DEPTNAME:r.raw.bean.JDGSINFO_GSMC,DEPTCODE:s.DEPTCODE,JTGSMC:s.JTGSMC,JTGSID:s.JTGSID,GSBMID:s.GSBMID,JDGSINFO_YECJTYPE_CODE:r.raw.bean.JDGSINFO_YECJTYPE_CODE,JTJGGSNAME:r.raw.bean.JDGSINFO_JGGS_NAME,JTJGGSID:r.raw.bean.JDGSINFO_JGGS_ID,JE_CORE_JDGSINFO_ID:r.raw.bean.JE_CORE_JDGSINFO_ID,SY_NODETYPE:r.raw.bean.SY_NODETYPE};o.setDisabled(!1),o.form.setValues(d),o.mainRecord=r;var c=n.getStore(),u=c.getNodeById(l);if(u){n.getSelectionModel().select([u]);var p=u.getPath();JE.isNotEmpty(p)&&Ext.each(p.split("/"),function(e){if(JE.isNotEmpty(e)){var t=c.getNodeById(e);t&&t.expand()}})}}else n.getSelectionModel().deselectAll(),o.form.reset(),o.setDisabled(!0),o.mainRecord=null}else n.getSelectionModel().deselectAll(),o.form.reset(),o.setDisabled(!0),o.mainRecord=null}},"panel[xtype=cjgl.deptform] button[ref=formSaveBtn]":{click:function(e){var t=e.up("panel[xtype=cjgl.deptform]"),i=t.up("panel[xtype=cjgl.mainview]").down("treepanel[xtype=cjgl.resulttree]"),a=t.getValues();a.tableCode="JE_CORE_DEPARTMENT";var n=i.getStore().getNodeById(a.JE_CORE_JDGSINFO_ID);if(n){var o=JE.ajax({url:JE.getUrlMaps("je.core.rbac.cjgl","saveNode"),params:a});if(o.success){var r=o.obj;n.raw.bean=r,n.set("text",r.JDGSINFO_GSMC),n.set("leaf","LEAF"==r.SY_NODETYPE),n.commit(),JE.msg("保存成功")}else JE.alert("保存失败，请联系管理员!")}}},"panel[xtype=cjgl.deptform] button[ref=formDelBtn]":{click:function(e){var t=e.up("panel[xtype=cjgl.deptform]"),i=t.up("panel[xtype=cjgl.mainview]").down("panel[xtype=cjgl.depttree]").getStore(),a=t.mainRecord;if(a){var n=new Array;a.cascadeBy(function(e){n.push(e.raw.nodeInfo)}),JE.confirm("是否要删除该节点?",function(e,t){"ok"==e&&(JE.ajax({url:JE.getUrlMaps("je.core.rbac.cjgl","removeNode"),params:{tableCode:"JE_CORE_JDGSINFO",tableCode:"JE_CORE_JDGSINFO",ids:a.get("id"),doTree:!0}}).success?(Ext.each(n,function(e){var t=i.getNodeById(e);t&&(t.set("cls",""),t.commit())}),a.remove(),JE.msg("删除成功")):JE.alert("删除失败，请联系管理员!"))})}else JE.alert("请选择要删除的节点!")}}};s.control(e)},views:["JE.sys.rbac.view.cjgl.CjglTree","JE.sys.rbac.view.cjgl.DeptForm","JE.sys.rbac.view.cjgl.DeptTree","JE.sys.rbac.view.cjgl.ResultTree","JE.sys.rbac.view.cjgl.MainView"]}),Ext.define("JE.sys.rbac.controller.DeptController",{extend:"Ext.app.Controller",init:function(){var i=this,e={"jeformview[id=JE_CORE_DEPARTMENT_jeformview] field[name=DEPTCODE]":{blur:function(e){var t=e.up("#JE_CORE_DEPARTMENT_jeformview");Ext.isEmpty(e.getValue())||e.originalValue==e.getValue()||(JE.ajax({url:JE.getUrlMaps("je.core.rbac.dept","checkFieldUniquen"),params:{tableCode:"JE_CORE_DEPARTMENT",FIELDCODE:"DEPTCODE",DEPTCODE:e.getValue()}}).success?i.disableBindButtons(t,!1):(i.disableBindButtons(t,!0),e.markInvalid("该部门编码已经被使用!")))}}};i.control(e)},disableBindButtons:function(e,t){var i=e.getDockedItems('toolbar[dock="top"]')[0];Ext.each(i.items.items,function(e){1==e.formBind&&(t?e.disable():e.enable())})}}),Ext.define("JE.sys.rbac.controller.DeptUserController",{extend:"Ext.app.Controller",init:function(){this.control({"jegridview[id=JE_CORE_DEPTUSERS_jegridview] button[ref=userImpl]":{click:function(e){}},"jegridview[id=JE_CORE_DEPTUSERS_jegridview] gridcolumn[dataIndex=ICONCLS]":{render:function(e){e.renderer=function(e,t,i,a,n,o,r,l,s){return"<div class='"+e+"'> </div>"}}}})}}),Ext.define("JE.sys.rbac.controller.PublicPermController",{extend:"Ext.app.Controller",init:function(){var r=this;r.permData=r.initPermTree(),r.funcPermData=r.initFuncPermTree(),r.appPermData=r.initAppPermTree();var e={"panel[ref=public_permtype_tab]":{tabchange:function(e,t,i,a){e.up("panel[xtype=public.mainview]")}},"panel[xtype=public.moduletree]":{selectionchange:function(e,t,i){var a=e.view.panel,n=a.up("panel[ref=public_permtype_tab]"),o=a.up("panel[xtype=public.mainview]").down("panel[xtype=public.permtree]");r.loadPermTree(n,o)}},"panel[xtype=public.functree]":{selectionchange:function(e,t,i){var a=e.view.panel,n=a.up("panel[ref=public_permtype_tab]"),o=a.up("panel[xtype=public.mainview]").down("panel[xtype=public.permtree]");r.loadPermTree(n,o)}},"panel[xtype=public.apptree]":{selectionchange:function(e,t,i){var a=e.view.panel,n=a.up("panel[ref=public_permtype_tab]"),o=a.up("panel[xtype=public.mainview]").down("panel[xtype=public.permtree]");r.loadPermTree(n,o)}},"panel[xtype=public.permtree] button[ref=permSave]":{click:function(e){var t=e.up("panel[xtype=public.permtree]");r.updatePerm(t)}},"panel[xtype=public.permtree] button[ref=expandAll]":{click:function(e){e.up("panel[xtype=public.permtree]").expandAll()}},"panel[xtype=public.permtree] button[ref=collapseAll]":{click:function(e){e.up("panel[xtype=public.permtree]").collapseAll()}},"panel[xtype=public.permtree] button[ref=refreshPerm]":{click:function(e){r.permData=r.initPermTree(),r.funcPermData=r.initFuncPermTree(),r.appPermData=r.initAppPermTree();var t=e.up("panel[xtype=public.mainview]"),i=t.down("panel[xtype=public.moduletree]"),a=t.down("panel[xtype=public.functree]"),n=t.down("panel[xtype=public.apptree]");i.store.load(),i.getSelectionModel().deselectAll(!1),a&&(a.getSelectionModel().deselectAll(!1),a.store.load()),n&&(n.getSelectionModel().deselectAll(!1),n.store.load()),JE.msg("刷新成功!")}},"panel[xtype=public.functree] button[ref=implFunc]":{click:function(e){var t=e.up("panel[xtype=public.functree]"),a=(e.up("panel[xtype=public.mainview]"),t.getRootNode());JE.selectWin({title:"功能授权选择",configInfo:"JE_CORE_FUNCINFO,,,M",type:"grid",orderSql:" order by SY_CREATETIME DESC",whereSql:" AND JE_CORE_FUNCINFO_ID NOT IN (SELECT PERMCODE FROM JE_CORE_PERMISSION WHERE PERMTYPE='FUNC') ",okButtonClick:function(e,t){if(!e)return!1},callback:function(e){if(e&&0<e.length){var t=new Array;Ext.each(e,function(e){t.push(e.get("JE_CORE_FUNCINFO_ID"))});var i=JE.ajax({url:JE.getUrlMaps("je.core.rbac.perm","impFuncTreeNode"),params:{ids:t.join(",")}});0<i.children.length&&(r.funcPermData||(r.funcPermData=Ext.create("Ext.util.MixedCollection")),Ext.each(i.children,function(e){var t=Ext.clone(e);t.children=[],delete t.checked,a.appendChild(t),r.funcPermData.add(e.id,e)}),JE.msg("导入成功!"))}else JE.alert("请选中功能数据!")}})}},"panel[xtype=public.functree] button[ref=delFunc]":{click:function(e){var t=e.up("panel[xtype=public.functree]"),n=t.getRootNode(),o=t.getSelectionModel().getSelection();o&&0<o.length?JE.confirm("确定要删除吗？",function(e,t){if("ok"==e){var i=new Array;Ext.each(o,function(e){i.push(e.get("id"))});var a=JE.ajax({url:JE.getUrlMaps("je.core.rbac.perm","removeFuncTreeNode"),params:{ids:i.join(",")}});a.success?(Ext.each(o,function(e){n.removeChild(e),r.funcPermData&&r.funcPermData.removeAtKey(e.get("id"))}),JE.msg(a.obj)):JE.alert("删除错误，请联系管理员!")}}):JE.alert("请选择需删除的功能!")}}};r.control(e)},initPermTree:function(){var e=JE.ajax({url:JE.getUrlMaps("je.core.rbac.perm","getPermTree"),params:{node:"ROOT",whereSql:" and SY_STATUS='1'"}});if(0<e.children.length){var t=Ext.create("Ext.util.MixedCollection");return Ext.each(e.children,function(e){t.add(e.id,e)}),t}return null},initFuncPermTree:function(){var e=JE.ajax({url:JE.getUrlMaps("je.core.rbac.perm","initFuncTreeNode"),params:{node:"ROOT",whereSql:""}});if(0<e.children.length){var t=Ext.create("Ext.util.MixedCollection");return Ext.each(e.children,function(e){t.add(e.id,e)}),t}return null},initAppPermTree:function(){var e=JE.ajax({url:JE.getUrlMaps("je.core.rbac.perm","initAppTreeNode"),params:{node:"ROOT",whereSql:""}});if(0<e.children.length){var t=Ext.create("Ext.util.MixedCollection");return Ext.each(e.children,function(e){Ext.each(e.children,function(e){e.parent="ROOT"}),t.add(e.id,e.children)}),t}return null},loadPermTree:function(e,t){var i=t.getRootNode();t.up("panel[xtype=public.mainview]");i.removeAll();var a=e.getActiveTab();if("public.moduletree"==a.xtype){if((E=a.getSelectionModel().getSelection()).length<=0)return;var n=this.permData;if(!n)return;var o=new Array,r=new Array;Ext.each(E,function(e){var t=e.get("id");r.push("'"+t+"'");var i=n.get(t);i&&o.push(Ext.clone(i))}),o.sort(function(e,t){return Ext.value(e.orderIndex,0)-Ext.value(t.orderIndex,0)}),0<o.length&&i.appendChild(o);var l=t.getStore();t.getSelectionModel();(f={}).module=r.join(","),f.type="menu";var s=JE.ajax({url:JE.getUrlMaps("je.core.rbac.perm","getPublicCheckedPerm"),params:f}),d=new Array;Ext.each(s.obj,function(e){var t=l.getNodeById(e);t&&(t.set("checked",!0),t.commit(),d.push(Ext.clone(t)))}),t.oldCheckedRecord=d}else if("public.functree"==a.xtype){var c=a.getSelectionModel().getSelection();if(c.length<=0)return;var u=this.funcPermData;if(!u)return;o=new Array;Ext.each(c,function(e){var t=u.get(e.get("id"));t&&o.push(Ext.clone(t))}),o.sort(function(e,t){return Ext.value(e.orderIndex,0)-Ext.value(t.orderIndex,0)}),0<o.length&&i.appendChild(o);l=t.getStore(),t.getSelectionModel();var p=new Array;i.cascadeBy(function(e){p.push(e.get("id")),e.set("checked",!1),e.commit()});var f={type:"func"};s=JE.ajax({url:JE.getUrlMaps("je.core.rbac.perm","getPublicCheckedPerm"),params:f}),d=new Array;Ext.each(s.obj,function(e){var t=l.getNodeById(e);t&&(t.set("checked",!0),t.commit(),d.push(Ext.clone(t)))}),t.oldFuncCheckedRecord=d}else{var E;if((E=a.getSelectionModel().getSelection()).length<=0)return;var m=this.appPermData;if(!m)return;o=new Array,r=new Array;Ext.each(E,function(e){var t=e.get("id");r.push("'"+t+"'");var i=m.get(t);i&&(o=Ext.clone(i))}),o.sort(function(e,t){return Ext.value(e.orderIndex,0)-Ext.value(t.orderIndex,0)}),0<o.length&&i.appendChild(o);l=t.getStore(),t.getSelectionModel(),f={type:"app"},s=JE.ajax({url:JE.getUrlMaps("je.core.rbac.perm","getPublicCheckedPerm"),params:f}),d=new Array;Ext.each(s.obj,function(e){var t=l.getNodeById(e);t&&(t.set("checked",!0),t.commit(),d.push(Ext.clone(t)))}),t.oldAppCheckedRecord=d}},updatePerm:function(i){var e={},r=i.up("panel[xtype=public.mainview]").down("tabpanel[ref=public_permtype_tab]").getActiveTab(),t=r.getSelectionModel().getSelection(),a=new Array,l="";Ext.each(t,function(e){var t=e.get("id");l=e.get("id"),a.push("'"+t+"'")}),e.module=a.join(","),e.permType="menu";var s=new Array,n=new Array,o=i.getChecked(),d=Ext.value(i.oldCheckedRecord,[]);"public.functree"==r.xtype?(d=Ext.value(i.oldFuncCheckedRecord,[]),e.type="func"):"public.apptree"==r.xtype&&(d=Ext.value(i.oldAppCheckedRecord,[]),e.type="app"),Ext.each(o,function(t){Ext.each(d,function(e){t.get("id")==e.get("id")&&(!0,e.isHave=!0)});var e=t.raw.nodeInfo,i=t.raw.nodeInfoType;if("public.functree"==r.xtype)-1==["BUTTON","SUB_FUNC"].indexOf(i)&&(e=""),s.push("#"+i+"#"+t.get("id")+"#"+e);else if("public.apptree"==r.xtype)s.push(l+"#"+i+"#"+t.get("id")+"#"+e);else{var a=t.getPath(),n=a.indexOf("/",6),o="";o=-1!=n?a.substring(6,n):a.substring(6),-1==["BUTTON","SUB_FUNC"].indexOf(i)&&(e=""),s.push(o+"#"+i+"#"+t.get("id")+"#"+e)}}),Ext.each(d,function(e){e.isHave||n.push(e.get("id")),delete e.isHave}),e.delPermIds=n.join(","),e.addPermIds=s.join(","),"public.functree"==r.xtype&&(e.module=""),JE.ajax({url:JE.getUrlMaps("je.core.rbac.perm","doUpdatePublicPerm"),async:!0,mask:!0,timeout:6e5,params:e,success:function(e){var t=Ext.decode(Ext.value(e.responseText,"{}"));t.success?("public.functree"==r.xtype?i.oldFuncCheckedRecord=o:"public.apptree"==r.xtype?i.oldAppCheckedRecord=o:i.oldCheckedRecord=o,JE.msg("授权成功")):JE.alert(t.obj)}})},views:["JE.sys.rbac.view.public.MainView","JE.sys.rbac.view.public.ModuleTree","JE.sys.rbac.view.public.AppTree","JE.sys.rbac.view.public.FuncTree","JE.sys.rbac.view.public.PermTree"]}),Ext.define("JE.sys.rbac.controller.QueryUserController",{extend:"Ext.app.Controller",init:function(){this.control({"panel[xtype=query.selectedusergrid] button[ref=clear]":{click:function(e){var t=e.up("panel[xtype=query.selectedusergrid]"),i=t.up("jesswinview").down("jegridview"),a=t.getStore();i.getSelectionModel().deselectAll(!0),a.removeAll(),i.selectRecords&&i.selectRecords.removeAll()}},"panel[xtype=query.selectedusergrid]":{render:function(e){if(e.up("jesswinview")){var t=e.up("jesswinview").down("jegridview");t.on("select",function(e,t,i,a){var n=e.view.panel,o=n.up("jesswinview").down("panel[xtype=query.selectedusergrid]").getStore(),r=o.model;n.multiSelect||o.removeAll(),o.findRecord("USERID"),t.get("USERID")&&o.insert(o.count(),new r(t.data))}),t.on("deselect",function(e,t,i,a){var n=e.view.panel.up("jesswinview").down("panel[xtype=query.selectedusergrid]").getStore(),o=n.findRecord("USERID",t.get("USERID"));o&&n.remove(o)}),t.on("load",function(i,e){var t=i.gridObj,a=t.getSelectionModel();t.up("jesswinview").down("panel[xtype=query.selectedusergrid]").getStore().each(function(e){var t=i.findRecord("USERID",e.get("USERID"));t&&a.select(t,!0,!0)})}),t.down("gridcolumn[dataIndex=ICONCLS]").renderer=function(e,t,i,a,n,o,r,l,s){return"<div class='"+e+"'> </div>"}}}}})}}),Ext.define("JE.sys.rbac.controller.RolePermController",{extend:"Ext.app.Controller",init:function(){var T=this;T.permData=T.initPermTree(),T.funcPermData=T.initFuncPermTree(),T.appPermData=T.initAppPermTree(),T.cpPermData=T.initCpPermTree(),T.cpFuncPermData=T.initCpFuncPermTree(),T.cpAppPermData=T.initCpAppPermTree();var e={"panel[ref=role_group_tab]":{tabchange:function(e,t,i,a){var n=e.up("panel[ref=westpanel]").up("panel[xtype=role.mainview]").down("panel[xtype=user.usergrid]"),o=n.down("[xtype=toolbar]"),r=n.down("button[ref=impl]"),l=n.down("button[ref=remove]"),s=n.down("button[ref=implSentry]"),d=n.down("button[ref=implUser]"),c=n.getStore(),u=c.getProxy().extraParams,p=t.up("panel[xtype=role.mainview]").down("panel[xtype=role.permtree]"),f=t.up("panel[xtype=role.mainview]").down("panel[ref=role_permtype_tab]"),E=p.down("button[ref=hardSave]"),m="";if("role.rolegrouptree"==t.xtype)u.whereSql="and 1!=1",c.loadPage(1),r.disable(),l.disable(),E.disable(),s.disable(),d.disable(),o.hide(),m="PERM_ROLEGROUP";else{var g=t.getSelectionModel().getSelection()[0];g?(u.whereSql=" and STATUS='1' AND VALID='1' and USERID in (SELECT USERID FROM JE_CORE_ROLE_USER WHERE ROLEID='"+g.get("id")+"')",t.fireEvent("selectionchange",t.getSelectionModel(),[g])):u.whereSql="and 1!=1","role.roletree"==t.xtype?(r.enable(),l.enable(),s.enable(),d.enable(),o.show()):(c.loadPage(1),r.disable(),l.disable(),s.disable(),d.disable(),o.hide()),c.loadPage(1),E.enable(),m="PERM_ROLE"}T.loadPermTree(m,t,f,p)}},"panel[ref=role_permtype_tab]":{tabchange:function(e,t,i,a){var n=e.up("panel[xtype=role.mainview]"),o=n.down("tabpanel[ref=role_group_tab]"),r=n.down("panel[xtype=role.permtree]"),l="PERM_ROLE",s=o.getActiveTab();"role.rolegrouptree"==s.xtype&&(l="PERM_ROLEGROUP"),T.loadPermTree(l,s,e,r)}},"treepanel[ref=roletree]":{selectionchange:function(e,t,i){var a=e.view.panel,n=a.up("panel[xtype=role.mainview]").down("panel[xtype=user.usergrid]").getStore(),o=n.getProxy().extraParams;if(!(t.length<=0)){var r=t[0];JE.ajax({url:JE.getUrlMaps("je.core.rbac.rbac.getInfoById"),params:{tableCode:"JE_CORE_ROLE",pkValue:r.get("id")}})&&(o.whereSql=" and STATUS='1' AND VALID='1' and USERID in (SELECT USERID FROM JE_CORE_ROLE_USER WHERE ROLEID='"+r.get("id")+"')",n.loadPage(1));var l=a.up("panel[xtype=role.mainview]").down("panel[ref=role_permtype_tab]"),s=a.up("panel[xtype=role.mainview]").down("panel[xtype=role.permtree]");T.loadPermTree("PERM_ROLE",a,l,s,!0)}}},"panel[xtype=role.rolegrouptree]":{selectionchange:function(e,t,i){var a=e.view.panel;if(!(t.length<=0)){var n=t[0],o=(JE.ajax({url:JE.getUrlMaps("je.core.rbac.rbac.getInfoById"),params:{tableCode:"JE_CORE_ROLEGROUP",pkValue:n.get("id")}}),a.up("panel[xtype=role.mainview]").down("panel[ref=role_permtype_tab]")),r=a.up("panel[xtype=role.mainview]").down("panel[xtype=role.permtree]");T.loadPermTree("PERM_ROLEGROUP",a,o,r,!0),a.down("button[ref=del]").enable(),a.down("button[ref=update]").enable()}}},"panel[xtype=role.mainview] cbbfield[name=JE_SAAS_CP]":{change:function(e,t,i){if(!JE.isEmpty(t)&&!e.isHidden()){var a=e.up("panel[xtype=role.mainview]").down("panel[xtype=role.roletree]"),n=a.up("panel[xtype=role.mainview]"),o=n.down("panel[xtype=role.functree]"),r=n.down("panel[xtype=role.apptree]"),l=n.down("panel[xtype=role.moduletree]"),s=(n.down("panel[xtype=role.roleform]"),n.down("panel[xtype=user.usergrid]")),d=s.down("button[ref=impl]"),c=s.down("button[ref=remove]"),u=s.down("button[ref=implUser]"),p=s.down("button[ref=implSentry]");o.getSelectionModel().deselectAll(!1);var f="",E="",m="",g="";if("SYS"==t)f=" AND ROLERANK='SYS'";else{var h=JE.ajax({url:JE.getUrlMaps("je.core.saas.cpInfo.loadCpZy"),params:{cpId:t,type:"CP,CPFUNC,APP"}}),x={CP:[],CPFUNC:[],APP:[]},v={};for(var y in Ext.each(h,function(e){var t=e.CPYHZY_TYPE;x[t]&&x[t].push(e.CPYHZY_ZYID)}),x)v[y]="'"+(x[y]?x[y].join("','"):"")+"'";E=" AND JE_CORE_MENU_ID IN ("+v.CP+")",m=" AND JE_CORE_FUNCINFO_ID IN ("+v.CPFUNC+")",g=" AND JE_PHONE_APK_ID IN ("+v.APP+")",f=" AND ROLERANK='CP' AND CPID='"+t+"'"}a.getStore().proxy.extraParams.whereSql=" and ROLETYPE='ROLE'"+f,a.roleSql=f,a.refreshRoot();var b=s.getStore();b.getProxy().extraParams.whereSql=" AND STATUS='1'  AND VALID='1' AND 1!=1",b.loadPage(1);var C=l.getStore();C.getProxy().extraParams.whereSql=" and SY_PARENT='ROOT' AND SY_STATUS='1'"+E,C.load();var w=o.getStore();w.getProxy().extraParams.whereSql=m,w.load();var S=r.getStore();S.getProxy().extraParams.whereSql=g,S.load();var I=t;JE.isEmpty(I)&&(I="SYS"),"SYS"!=I?(T.initCpPermTree(I),T.initCpFuncPermTree(I),T.initCpAppPermTree(I),d.setDisabled(!0),c.setDisabled(!0),p.setDisabled(!0),u.setDisabled(!0)):(d.setDisabled(!1),c.setDisabled(!1),p.setDisabled(!1),u.setDisabled(!1))}}},"panel[xtype=role.roletree] button[ref=ins]":{click:function(e){var t=e.up("panel[xtype=role.roletree]"),i=t.getStore().getRootNode();if(T.saas&&T.saasAdmin){var a=t.up("panel[xtype=role.mainview]").down("cbbfield[name=JE_SAAS_CP]").getValue();if(JE.isNotEmpty(a)&&"SYS"!=a)return void JE.alert("不能为产品添加角色!")}T.insertWin({bodyStyle:"background:red;",tree:t,tableCode:"JE_CORE_ROLE",parentNode:i,xtype:"role.roleform",url:JE.getUrlMaps("je.core.rbac.role","doSave")})}},"treepanel[ref=roletree] button[ref=refresh]":{click:function(e){var t=e.up("treepanel[ref=roletree]");if("role.roletree"==t.xtype){var i=e.up("panel[xtype=role.mainview]").down("panel[xtype=user.usergrid]").getStore();i.getProxy().extraParams.whereSql=" and 1!=1",i.loadPage(1),t.refreshRoot();var a=t.up("panel[xtype=role.mainview]").down("panel[ref=role_permtype_tab]"),n=t.up("panel[xtype=role.mainview]").down("panel[xtype=role.permtree]");T.loadPermTree("PERM_ROLE",t,a,n,!0),t.down("[ref=insChild]").disable(),t.down("[ref=update]").disable(),t.down("[ref=del]").disable(),t.down("[ref=move]").disable()}}},"treepanel[xtype=role.depttree] button[ref=syncOrder]":{click:function(e){var i=e.up("treepanel[xtype=role.depttree]").down("button[ref=refresh]");JE.confirm("该操作会将部门数据同步到角色中作为授权使用，是否继续？",function(e,t){"ok"==e&&(JE.ajax({url:JE.getUrlMaps("je.core.rbac.role","syncDeptOrder")}).success?(i.fireEvent("click",i),JE.msg("同步成功!")):JE.alert("同步出错,请联系管理员!"))})}},"treepanel[xtype=role.sentrytree] button[ref=syncOrder]":{click:function(e){var i=e.up("treepanel[xtype=role.sentrytree]").down("button[ref=refresh]");JE.confirm("该操作会将岗位数据同步到角色中作为授权使用，是否继续？",function(e,t){"ok"==e&&(JE.ajax({url:JE.getUrlMaps("je.core.rbac.role","syncSentryOrder")}).success?(i.fireEvent("click",i),JE.msg("同步成功!")):JE.alert("同步出错,请联系管理员!"))})}},"panel[xtype=role.rolegrouptree] button[ref=ins]":{click:function(e){var t=e.up("panel[xtype=role.rolegrouptree]"),i=t.getSelectionModel().getSelection()[0];i=t.getRootNode(),T.insertWin({tree:t,tableCode:"JE_CORE_ROLEGROUP",parentNode:i,xtype:"role.rolegroupform",url:JE.getUrlMaps("je.core.rbac.workGroup","doSave")})}},"panel[xtype=role.rolegrouptree] button[ref=del]":{click:function(e){var i=e.up("panel[xtype=role.rolegrouptree]").getSelectionModel().getSelection()[0];i?JE.confirm("确定要删除权限组["+i.get("text")+"]吗?",function(e){if("ok"==e){var t=JE.ajax({url:JE.getUrlMaps("je.core.rbac.roleGroup","doRemove"),params:{tableCode:"JE_CORE_ROLEGROUP",ids:i.get("id"),doTree:!0}});t.success?(i.remove(),JE.msg(t.obj)):JE.alert(t.obj)}}):JE.alert("请选择角色并删除!")}},"panel[xtype=role.rolegrouptree] button[ref=refresh]":{click:function(e){var t=e.up("panel[xtype=role.rolegrouptree]");t.getStore().load();var i=t.up("panel[xtype=role.mainview]").down("panel[ref=role_permtype_tab]"),a=t.up("panel[xtype=role.mainview]").down("panel[xtype=role.permtree]");T.loadPermTree("PERM_ROLEGROUP",t,i,a,!0),t.down("[ref=del]").disable(),t.down("[ref=update]").disable()}},"panel[xtype=role.rolegrouptree] button[ref=update]":{click:function(e){var t=e.up("panel[xtype=role.rolegrouptree]"),i=t.getSelectionModel().getSelection()[0];JE.win({title:"编辑权限组",xtype:"panel",width:380,height:250,autoShow:!0,items:[{xtype:"role.rolegroupform",sels:i,tree:t}]})}},"panel[xtype=role.roleform] field[name=ROLETYPE]":{change:function(e,t,i){var a=e.up("panel[xtype=role.roleform]").getForm(),n=a.findField("ROLENAME"),o=a.findField("ROLECODE"),r=a.findField("JTGSMC"),l=a.findField("JTGSID"),s=a.findField("NODETYPE");"ROLE"==t?(n.setReadOnly(!1),o.setReadOnly(!1),r.setReadOnly(!1),l.setReadOnly(!1),s.setReadOnly(!1)):(n.setReadOnly(!0),o.setReadOnly(!0),r.setReadOnly(!0),l.setReadOnly(!0),s.setReadOnly(!0))}},"panel[xtype=role.roleform] field[name=ROLECODE]":{},"panel[xtype=role.roleform] button[ref=formSaveBtn]":{click:function(e){var i=e.up("panel[xtype=role.roleform]");JE.submit(i,{url:JE.getUrlMaps("je.core.rbac.role","doUpdate"),params:{tableCode:"JE_CORE_ROLE"},success:function(e,t){i.tree.refreshRoot(),JE.msg("保存成功..."),i.up().close()}})}},"panel[xtype=role.rolegroupform] field[name=ROLEGROUPCODE]":{blur:function(e){var t=e.up("panel[xtype=role.rolegroupform]");if(!Ext.isEmpty(e.getValue())&&e.originalValue!=e.getValue()){var i=JE.ajax({url:JE.getUrlMaps("je.core.rbac.user","checkFieldUniquen"),params:{tableCode:"JE_CORE_ROLEGROUP",FIELDCODE:"ROLEGROUPCODE",ROLEGROUPCODE:e.getValue()}}).success,a=t.down("button[ref=formSaveBtn]");a=a||t.down("button[ref=ok]"),i?a.enable():(e.markInvalid("该权限组编码已经被使用!"),a.disable())}}},"panel[xtype=role.rolegroupform] button[ref=formSaveBtn]":{click:function(e){var i=e.up("panel[xtype=role.rolegroupform]"),t=i.getForm().findField("JE_CORE_ROLEGROUP_ID").getValue();Ext.isEmpty(t)?JE.alert("请选择角色组!"):JE.submit(i,{url:"/je/rbac/roleGroup/doUpdate",params:{tableCode:"JE_CORE_ROLEGROUP"},success:function(e,t){i.tree.getStore().load(),i.up().close(),JE.msg("保存成功...")}})}},"panel[xtype=user.usergrid] button[ref=implUser]":{click:function(e){var r=e.up("panel[xtype=user.usergrid]"),l=r.up("panel[xtype=role.mainview]").down("panel[xtype=role.roletree]").getSelectionModel().getSelection()[0];if(l){var t=!1;"1"==JE.systemConfig.JE_SYSMODE&&(t=!0);var i="";t&&(i=" AND ZHID='"+JE.currentUser.zhId+"'");var a=JE.selectWin({title:"添加人员",type:"grid",multiSelect:!0,otherConfig:JE.toStr({DEPT:"1",SENTRY:"1",ROLE:"1",WORKGROUP:"0",QUICKQUERY:"NONE"}),whereSql:" AND USERID NOT IN (SELECT USERID  FROM JE_CORE_ROLE_USER WHERE ROLEID='"+l.get("id")+"') "+i,configInfo:"JE_CORE_QUERYUSER,,M",callback:function(t,e,i){var a=i.down("grid[xtype=query.selectedusergrid]");t.splice(0,t.length),a.getStore().each(function(e){t.push(e)});var n=[];if(Ext.each(t,function(e){n.push(e.get("USERID"))}),n.length<=0)return JE.alert("请选择需要添加的人员!"),!1;var o=JE.ajax({url:JE.getUrlMaps("je.core.rbac.role","doImplUser"),params:{roleId:l.get("id"),ids:n.join(",")}});o.success?(r.store.load(),JE.msg(o.obj)):JE.alert("添加失败，请联系管理员!")}}),n=(a.down("panel[xtype=rbac.queryusertree]"),a.down("treepanel[itemId=ROOT_SENTRY]"));n&&n.hide();var o=a.down("treepanel[itemId=ROOT_WORKGROUP]");o&&o.hide()}else JE.alert("请选择角色!")}},"panel[xtype=user.usergrid] button[ref=impl]":{click:function(e){var t=e.up("panel[xtype=user.usergrid]"),i=t.up("panel[xtype=role.mainview]").down("panel[xtype=role.roletree]").getSelectionModel().getSelection()[0];if(i){var a=JE.ajax({url:JE.getUrlMaps("je.core.rbac.role","loadRoleUsers"),params:{roleId:i.get("id")}});Ext.create("JE.sys.rbac.view.role.imp.UserInsWinView",{title:"角色 : "+i.get("text"),userGrid:t,users:a,roleId:i.get("id"),impType:"DEPT"}).show()}else JE.alert("请选择角色!")}},"panel[xtype=user.usergrid] button[ref=implSentry]":{click:function(e){var t=e.up("panel[xtype=user.usergrid]"),i=t.up("panel[xtype=role.mainview]").down("panel[xtype=role.roletree]").getSelectionModel().getSelection()[0];if(i){var a=JE.ajax({url:JE.getUrlMaps("je.core.rbac.role","loadRoleUsers"),params:{roleId:i.get("id")}});Ext.create("JE.sys.rbac.view.role.imp.UserInsWinView",{title:"角色 : "+i.get("text"),userGrid:t,users:a,roleId:i.get("id"),impType:"SENTRY"}).show()}else JE.alert("请选择角色!")}},"panel[xtype=user.usergrid] uxtrigger[ref=querytext]":{click:function(e){var t=e.getValue(),i=e.up("panel[xtype=user.usergrid]"),a="";Ext.isEmpty(t)||(a=" and (USERNAME like '%"+t+"%' or USERCODE like '%"+t+"%' or DEPTNAME like '%"+t+"%') "),i.getStore().proxy.extraParams.expandSql=a,i.getStore().load()}},"window[xtype=role.userinswinview]":{render:function(o){var t=[],e=o.users;Ext.each(e,function(e){t.push({id:e.USERID,text:e.USERNAME,parentId:e.DEPTID,nodeInfoType:e.USERID,parentText:"DEPT"==o.impType?e.DEPTNAME:Ext.value(e.SENTRYNAMES,"无岗位")})}),o.down("[ref=multiselect]").store.loadData(t),o.down("treepanel[ref=oktree] combobox[ref=queryTreeCBB]").store.loadData(t),o.down("button[ref=delete]").on("click",function(e){var t=o.down("[ref=multiselect]"),i=t.getSelected();if(0!=i.length){t.store.remove(i),0<t.store.data.length&&t.boundList.getSelectionModel().select(0);var a=o.down("treepanel[ref=deptusertree]");o.down("treepanel[ref=oktree]").loadUsers({tree:a,recs:t.store.data.items})}else JE.alert("请选中人员！")}),o.down("button[ref=treeDelete]").on("click",function(e){var t=o.down("[ref=oktree]"),i=o.down("[ref=multiselect]"),a=t.getSelectionModel().getSelection()[0];if(a){a.isLeaf()?i.store.remove(i.store.getById(a.get("id"))):a.findChildBy(function(e){e.isLeaf()&&i.store.remove(i.store.getById(e.get("id")))},a,!0);var n=o.down("treepanel[ref=deptusertree]");t.loadUsers({tree:n,recs:i.store.data.items})}}),o.down("button[ref=okBtn]").on("click",function(e){var t=o.down("[ref=multiselect]"),i=[];t.store.each(function(e){i.push(e.get(t.valueField))});var a=i.join(",");if(0!=i.length){var n=JE.ajax({url:JE.getUrlMaps("je.core.rbac.role","doUpdateUsers"),params:{tableCode:"JE_CORE_ROLE",pkValue:o.roleId,ids:a}});if(!n.success)return void JE.alert(n.obj);o.userGrid.getStore().load()}o.close()}),o.down("button[ref=cancleBtn]").on("click",function(e){o.close()})}},"panel[xtype=user.usergrid] button[ref=remove]":{click:function(e){var i=e.up("panel[xtype=user.usergrid]"),a=i.up("panel[xtype=role.mainview]").down("panel[xtype=role.roletree]").getSelectionModel().getSelection()[0];if(a){var t=i.getSelectionModel().getSelection();if(t.length<=0)JE.alert("请选择人员!");else{var n=new Array;Ext.each(t,function(e){n.push(e.get("USERID"))}),JE.confirm("确定要移除吗?",function(e){if("ok"==e){var t=JE.ajax({url:JE.getUrlMaps("je.core.rbac.role","removeUsers"),params:{tableCode:"JE_CORE_ROLE",ids:n.join(","),pkValue:a.get("id")}});t.success?(i.getStore().load(),JE.msg(t.obj)):JE.alert(t.obj)}})}}else JE.alert("请选择角色!")}},"panel[xtype=role.moduletree]":{selectionchange:function(e,t,i){var a=e.view.panel,n=a.up("panel[ref=role_permtype_tab]"),o=a.up("panel[xtype=role.mainview]").down("tabpanel[ref=role_group_tab]"),r=a.up("panel[xtype=role.mainview]").down("panel[xtype=role.permtree]"),l="PERM_ROLE",s=o.getActiveTab();"role.rolegrouptree"==s.xtype&&(l="PERM_ROLEGROUP"),T.loadPermTree(l,s,n,r,!1)}},"panel[xtype=role.functree]":{selectionchange:function(e,t,i){var a=e.view.panel,n=a.up("panel[ref=role_permtype_tab]"),o=a.up("panel[xtype=role.mainview]").down("tabpanel[ref=role_group_tab]"),r=a.up("panel[xtype=role.mainview]").down("panel[xtype=role.permtree]"),l="PERM_ROLE",s=o.getActiveTab();"role.rolegrouptree"==s.xtype&&(l="PERM_ROLEGROUP"),T.loadPermTree(l,s,n,r,!1)}},"panel[xtype=role.apptree]":{selectionchange:function(e,t,i){var a=e.view.panel,n=a.up("panel[ref=role_permtype_tab]"),o=a.up("panel[xtype=role.mainview]").down("tabpanel[ref=role_group_tab]"),r=a.up("panel[xtype=role.mainview]").down("panel[xtype=role.permtree]"),l="PERM_ROLE",s=o.getActiveTab();"role.rolegrouptree"==s.xtype&&(l="PERM_ROLEGROUP"),T.loadPermTree(l,s,n,r,!1)}},"panel[xtype=role.functree] button[ref=implFunc]":{click:function(e){var t=e.up("panel[xtype=role.functree]"),i=e.up("panel[xtype=role.mainview]"),a=t.getRootNode(),n="";T.saas&&T.saasAdmin&&(n=i.down("cbbfield[name=JE_SAAS_CP]").getValue());var o=JE.ajax({url:JE.getUrlMaps("je.core.rbac.perm","getImplFuncIds"),params:{cpId:n}}),r="";o.success&&(r="in"==o.obj.type?" AND JE_CORE_FUNCINFO_ID IN ('"+o.obj.funcIds.join("','")+"')":" AND JE_CORE_FUNCINFO_ID NOT IN ('"+o.obj.funcIds.join("','")+"')"),JE.selectWin({title:"功能授权选择",configInfo:"JE_CORE_FUNCINFO,,,M",type:"grid",orderSql:" order by SY_CREATETIME DESC",whereSql:r,okButtonClick:function(e,t){if(!e)return!1},callback:function(e){if(e&&0<e.length){var t=new Array;Ext.each(e,function(e){t.push(e.get("JE_CORE_FUNCINFO_ID"))});var i=JE.ajax({url:JE.getUrlMaps("je.core.rbac.perm","impFuncTreeNode"),params:{ids:t.join(",")}});0<i.children.length&&(T.funcPermData||(T.funcPermData=Ext.create("Ext.util.MixedCollection")),Ext.each(i.children,function(e){var t=Ext.clone(e);t.children=[],delete t.checked,a.appendChild(t),T.funcPermData.add(e.id,e)}),JE.msg("导入成功!"))}else JE.alert("请选中功能数据!")}})}},"panel[xtype=role.functree] button[ref=delFunc]":{click:function(e){var t=e.up("panel[xtype=role.functree]"),n=t.getRootNode(),o=t.getSelectionModel().getSelection();if(o&&0<o.length){if(T.saas&&!T.saasAdmin)return void JE.alert("不允许删除功能权限！");JE.confirm("确定要删除吗？",function(e,t){if("ok"==e){var i=new Array;Ext.each(o,function(e){i.push(e.get("id"))});var a=JE.ajax({url:JE.getUrlMaps("je.core.rbac.perm","removeFuncTreeNode"),params:{ids:i.join(",")}});a.success?(Ext.each(o,function(e){n.removeChild(e),T.funcPermData&&T.funcPermData.removeAtKey(e.get("id"))}),JE.msg(a.obj)):JE.alert("删除错误，请联系管理员!")}})}else JE.alert("请选择需删除的功能!")}},"panel[xtype=role.roletree] button[ref=update]":{click:function(e){var t=e.up("panel[xtype=role.roletree]"),i=t.getSelectionModel().getSelection()[0];JE.win({title:"编辑角色",xtype:"panel",width:500,height:400,autoShow:!0,items:[{xtype:"role.roleform",sels:i,tree:t}]})}},"panel[xtype=role.rolegrouptree] button[ref=move]":{click:function(e){var l=e.up("panel[xtype=role.rolegrouptree]"),s=l.getSelectionModel(),d=s.getSelection()[0],t="";if(T.saas){var i=d.get("bean");if("SYS"==i.ROLERANK)t=" AND ROLERANK='SYS' ";else if("YH"==i.ROLERANK){if(JE.isNotEmpty(i.BASEROLEID))return void JE.alert("系统角色不允许移动!");t=" AND ROLERANK='YH' AND JTGSID='"+JE.currentUser.jtgsId+"'"}}JE.selectWin({parent:null,parentType:"self",title:"角色移动",configInfo:"JE_RBAC_ROLE",whereSql:" AND ROLEID NOT IN ('"+d.get("id")+"') AND ROLETYPE='ROLE' "+t,type:"tree",callback:function(e,t){var i=e[0];if(i.get("id")!=d.get("parent")&&i){var a=JE.ajax({url:JE.getUrlMaps("je.core.rbac.role","roleMove"),params:{tableCode:"JE_CORE_ROLE",ROLEID:d.get("id"),PARENT:i.get("id"),PATH:i.getPath(),oldParentId:d.get("parent")}});if(a.success){var n=a.obj,o={id:n.ROLEID,text:n.ROLENAME,code:n.ROLECODE,leaf:"LEAF"==n.NODETYPE,nodePath:n.PATH,parentPath:n.PARENTPATH,nodeInfo:n.NODEINFO,nodeInfoType:n.NODEINFOTYPE,iconCls:n.ICONCLS,parent:n.PARENT,children:[],expandable:!0};Ext.clone(d),d.parentNode;d.remove();var r=l.getStore().getNodeById(i.get("id")).appendChild(o);s.select(r),JE.msg("移动成功!")}else JE.alert("移动失败!")}}})}},"panel[xtype=role.roletree] button":{click:function(e,t,i,a){var c=e.up("panel[xtype=role.roletree]"),n={};if("role.roletree"==c.xtype?(n.tableCode="JE_CORE_ROLE",n.url=JE.getUrlMaps("je.core.rbac.role"),n.xtype="role.roleform",n.title="角色"):(n.tableCode="JE_CORE_ROLEGROUP",n.url=JE.getUrlMaps("je.core.rbac.workGroup"),n.xtype="role.rolegroupform",n.title="权限组"),"insChild"==e.ref){var o=c.getSelectionModel().getSelection()[0];if(o){if(T.saas){var r=(s=o.get("bean")).ROLERANK,l=s.BASEROLEID;if("YH"==r){if(JE.isNotEmpty(l))return void JE.alert("系统角色无法添加子角色!")}else if("CP"==r)return void JE.alert("产品角色无法添加子角色!")}T.insertWin({tree:c,tableCode:n.tableCode,height:700,parentNode:o,xtype:n.xtype,url:n.url+"!doSave.action"})}else o=tree.getStore().getRootNode(),T.insertWin({tree:c,height:700,tableCode:n.tableCode,parentNode:o,xtype:n.xtype,url:n.url+"!doSave.action"})}else if("del"==e.ref){if(p=c.getSelectionModel().getSelection()[0]){var s=p.get("bean"),d="";if(T.saas){r=s.ROLERANK,l=s.BASEROLEID;if("YH"==r){if(JE.isNotEmpty(l))return void JE.alert("系统角色无法删除!")}else{if("CP"==r)return void JE.alert("产品角色无法删除!");"SYS"==r&&(d='<p style="color:red;">该角色为系统角色，删除后会级联删除产品角色跟用户角色，</p>')}}JE.confirm(d+"确定要删除"+n.title+"["+p.get("text")+"]吗?",function(e){if("ok"==e){var t=JE.ajax({url:n.url+"!doRemove.action",params:{tableCode:n.tableCode,ids:p.get("id"),doTree:!0}});t.success?(p.remove(),JE.msg(t.obj),c.down("[ref=insChild]").disable(),c.down("[ref=update]").disable(),c.down("[ref=del]").disable(),c.down("[ref=move]").disable()):JE.alert(t.obj)}})}else JE.alert("请选择角色并删除!")}else if("move"==e.ref){var u=c.getSelectionModel(),p=u.getSelection()[0],f="";if(T.saas)if("SYS"==(s=p.get("bean")).ROLERANK)f=" AND ROLERANK='SYS' ";else if("YH"==s.ROLERANK){if(JE.isNotEmpty(s.BASEROLEID))return void JE.alert("系统角色不允许移动!");f=" AND ROLERANK='YH' AND JTGSID='"+JE.currentUser.jtgsId+"'"}JE.selectWin({parent:null,parentType:"self",title:"角色移动",configInfo:"JE_RBAC_ROLE",whereSql:" AND ROLEID NOT IN ('"+p.get("id")+"') AND ROLETYPE='ROLE' "+f,type:"tree",callback:function(e,t){var i=e[0],a=c.getRootNode(),n="",o="";if(JE.isEmpty(i))n=a.get("id"),o=a.getPath();else{if(i.get("id")==p.get("parent"))return;n=i.get("id"),o=i.getPath()}var r=JE.ajax({url:JE.getUrlMaps("je.core.rbac.role","roleMove"),params:{tableCode:"JE_CORE_ROLE",ROLEID:p.get("id"),PARENT:n,PATH:o,oldParentId:p.get("parent")}});if(r.success){var l=r.obj,s={id:l.ROLEID,text:l.ROLENAME,code:l.ROLECODE,leaf:"LEAF"==l.NODETYPE,nodePath:l.PATH,parentPath:l.PARENTPATH,nodeInfo:l.NODEINFO,nodeInfoType:l.NODEINFOTYPE,iconCls:l.ICONCLS,parent:l.PARENT,children:[],expandable:!0};Ext.clone(p),p.parentNode;p.remove();var d=c.getStore().getNodeById(n).appendChild(s);u.select(d),c.refreshRoot(),JE.msg("移动成功!")}else JE.alert("移动失败!")}})}}},"panel[xtype=role.permtree] button[ref=permSave]":{click:function(e){var t=e.up("panel[xtype=role.permtree]");T.updatePerm(t,!1)}},"panel[xtype=role.permtree] button[ref=hardSave]":{click:function(e){var t=e.up("panel[xtype=role.permtree]");T.updatePerm(t,!0)}},"panel[xtype=role.permtree] button[ref=expandAll]":{click:function(e){e.up("panel[xtype=role.permtree]").expandAll()}},"panel[xtype=role.permtree] button[ref=collapseAll]":{click:function(e){e.up("panel[xtype=role.permtree]").collapseAll()}},"panel[xtype=role.permtree] button[ref=refreshPerm]":{click:function(e){e.disable(),T.permData=T.initPermTree(),T.funcPermData=T.initFuncPermTree(),T.appPermData=T.initAppPermTree(),T.saas&&(T.cpPermData={},T.cpFuncPermData={},T.cpAppPermData={});var t=e.up("panel[xtype=role.mainview]"),i=t.down("panel[xtype=role.moduletree]"),a=t.down("panel[xtype=role.functree]"),n=t.down("panel[xtype=role.apptree]");i.store.load(),i.getSelectionModel().deselectAll(!1),a&&(a.getSelectionModel().deselectAll(!1),a.store.load()),n&&(n.getSelectionModel().deselectAll(!1),n.store.load()),JE.msg("刷新成功!"),setTimeout(function(){e.enable()},2e3)}}};T.control(e)},insertWin:function(a){var n=this,e=250,t=320;"role.roleform"==a.xtype&&(t=500,e=400,n.saas&&(e=n.saasAdmin?420:300)),JE.win({title:"role.roleform"==a.xtype?"添加角色":"添加角色组",layout:"fit",border:0,width:t,height:e,items:[{xtype:a.xtype,parentNode:a.parentNode,hideBtn:!0,buttonAlign:"center",buttons:[{xtype:"button",text:"确定",cls:"btn JEPLUS_B_L10",iconCls:"fa fa-check",ref:"ok",handler:function(e){var t=e.up("window"),i=t.down("panel[xtype="+a.xtype+"]").getForm().getValues();"JE_CORE_ROLE"==a.tableCode?(i.PARENT=a.parentNode.get("id"),i.PARENTNAME=a.parentNode.get("text"),i.PARENTCODE=a.parentNode.get("code"),i.LAYER=a.parentNode.getDepth()+1,i.ICONCLS="jeicon jeicon-role"):(i.SY_PARENT=a.parentNode.get("id"),i.SY_NODETYPE="LEAF",i.SY_LAYER=a.parentNode.getDepth()+1),n.addNode({tree:a.tree,nodeObj:i,tableCode:a.tableCode,parentNode:a.parentNode,url:a.url})&&("role.roleform"==a.xtype?a.tree.refreshRoot():a.tree.getStore().load(),JE.msg("添加成功!"),t.close())}},{xtype:"button",text:"取消",cls:"btn",iconCls:"fa fa-close",handler:function(e){e.up("window").close()}}]}]}).show()},addNode:function(e){var t=e.tree,i=e.nodeObj;"JE_CORE_ROLE"==e.tableCode?("ROOT"==i.PARENT?e.parentNode=t.getRootNode():e.parentNode.get("id")!=i.PARENT&&(e.parentNode=t.getStore().getNodeById(i.PARENT)),i.PATH=e.parentNode.getPath(),i.STATUS="1"):("ROOT"==i.PARENT?e.parentNode=t.getRootNode():e.parentNode.get("id")!=i.SY_PARENT&&(e.parentNode=t.getStore().getNodeById(i.SY_PARENT)),i.SY_PATH=e.parentNode.getPath()),i.tableCode=e.tableCode;var a=JE.ajax({url:e.url,params:i});if(a.success){var n=a.obj,o={};return o="JE_CORE_ROLE"==e.tableCode?{id:n.ROLEID,text:n.ROLENAME,code:n.ROLECODE,leaf:"LEAF"==n.NODETYPE,nodePath:n.PATH,parentPath:n.PARENTPATH,nodeInfo:n.NODEINFO,nodeInfoType:n.NODEINFOTYPE,iconCls:n.ICONCLS,parent:n.PARENT,children:[],expandable:!0}:{id:n.JE_CORE_ROLEGROUP_ID,text:n.ROLEGROUP_TEXT,code:n.ROLEGROUP_CODE,nodeType:n.SY_NODETYPE,leaf:!0,nodePath:n.SY_PATH,parent:n.SY_PARENT,nodeInfo:n.ROLEGROUP_NODEINFO,nodeInfoType:n.ROLEGROUP_NODEINFOTYPE,children:[],expandable:!0},e.parentNode.data.leaf&&(e.parentNode.set("leaf",!1),e.parentNode.commit()),o=e.parentNode.appendChild(o),t.selectPath(o.getPath()),t.fireEvent("selectionchange",t.getSelectionModel(),[o]),o}return JE.alert(a.obj),null},loadPermTree:function(e,t,i,a,n){var o=this,r=a.getRootNode(),l=a.up("panel[xtype=role.mainview]"),s="";if(o.saas&&o.saasAdmin){s=l.down("cbbfield[name=JE_SAAS_CP]").getValue();!JE.isEmpty(s)&&"SYS"!=s||(s="SYS")}var d=t.getSelectionModel().getSelection()[0];if(d){r.removeAll();var c=i.layout.getExpanded()[0];if("role.moduletree"==c.xtype){var u=c.getSelectionModel().getSelection();if(n){var p=c.getSelectionModel(),f=c.getStore(),E=JE.ajax({url:JE.getUrlMaps("je.core.rbac.perm","loadRoleModule"),params:{roleId:d.get("id")}}),m=new Array;return Ext.each(E,function(e){var t=f.getNodeById(e);t&&m.push(t)}),p.deselectAll(),void p.select(m)}var g=o.permData;if(o.saas&&o.saasAdmin&&"SYS"!=s&&(o.cpPermData[s]||o.initCpPermTree(s),g=o.cpPermData[s]),!g)return;var h=new Array,x=new Array;Ext.each(u,function(e){var t=e.get("id");x.push("'"+t+"'");var i=g.get(t);i&&h.push(Ext.clone(i))}),h.sort(function(e,t){return Ext.value(e.orderIndex,0)-Ext.value(t.orderIndex,0)}),0<h.length&&r.appendChild(h);var v=a.getStore();a.getSelectionModel();(T={}).permType=e,T.module=x.join(","),"PERM_ROLE"==e?(T.tableCode="JE_CORE_ROLE",T.ROLEID=d.get("id"),T.ROLECODE=d.get("code"),T.ROLENAME=d.get("text"),T.PARENT=d.get("parent")):(T.tableCode="JE_CORE_ROLEGROUP",T.JE_CORE_ROLEGROUP_ID=d.get("id"),T.ROLEGROUP_CODE=d.get("code"),T.ROLEGROUP_TEXT=d.get("text"));var y=JE.ajax({url:JE.getUrlMaps("je.core.rbac.perm","getCheckedPerm"),params:T}),b=new Array;o.doSelfPerm(a,r,"ROOT"==T.PARENT,y.selfPerm),Ext.each(y.checkedPerm,function(e){var t=v.getNodeById(e);t&&(t.set("checked",!0),t.commit(),b.push(Ext.clone(t)))}),a.oldCheckedRecord=b}else if("role.functree"==c.xtype){var C=c.getSelectionModel().getSelection();if(C.length<=0){p=c.getSelectionModel(),f=c.getStore(),E=JE.ajax({url:JE.getUrlMaps("je.core.rbac.perm","loadRoleFunc"),params:{roleId:d.get("id")}}),m=new Array;return Ext.each(E,function(e){var t=f.getNodeById(e);t&&m.push(t)}),void p.select(m)}var w=o.funcPermData;if(o.saas&&o.saasAdmin&&"SYS"!=s&&(o.cpFuncPermData[s]||o.initCpFuncPermTree(s),w=o.cpFuncPermData[s]),!w)return;h=new Array;Ext.each(C,function(e){var t=w.get(e.get("id"));t&&h.push(Ext.clone(t))}),h.sort(function(e,t){return Ext.value(e.orderIndex,0)-Ext.value(t.orderIndex,0)}),0<h.length&&r.appendChild(h);v=a.getStore(),a.getSelectionModel();var S=new Array;r.cascadeBy(function(e){S.push(e.get("id")),e.set("checked",!1),e.commit()}),(T={}).permType=e,T.permCodeIds=S.join(","),"PERM_ROLE"==e?(T.tableCode="JE_CORE_ROLE",T.ROLEID=d.get("id"),T.ROLECODE=d.get("code"),T.ROLENAME=d.get("text"),T.PARENT=d.get("parent")):(T.tableCode="JE_CORE_ROLEGROUP",T.JE_CORE_ROLEGROUP_ID=d.get("id"),T.ROLEGROUP_CODE=d.get("code"),T.ROLEGROUP_TEXT=d.get("text"));y=JE.ajax({url:JE.getUrlMaps("je.core.rbac.perm","getFuncCheckedPerm"),params:T}),b=new Array;o.doSelfPerm(a,r,"ROOT"==T.PARENT,y.selfPerm),Ext.each(y.checkedPerm,function(e){var t=v.getNodeById(e);t&&(t.set("checked",!0),t.commit(),b.push(Ext.clone(t)))}),a.oldFuncCheckedRecord=b}else{if((u=c.getSelectionModel().getSelection()).length<=0)return;var I=o.appPermData;if(o.saas&&o.saasAdmin&&"SYS"!=s&&(o.cpAppPermData[s]||o.initCpAppPermTree(s),I=o.cpAppPermData[s]),!I)return;h=new Array,x=new Array;Ext.each(u,function(e){var t=e.get("id");x.push("'"+t+"'");var i=I.get(t);i&&(h=Ext.clone(i))}),h.sort(function(e,t){return Ext.value(e.orderIndex,0)-Ext.value(t.orderIndex,0)}),0<h.length&&r.appendChild(h);var T;v=a.getStore(),a.getSelectionModel();(T={}).permType=e,T.module=x.join(","),"PERM_ROLE"==e?(T.tableCode="JE_CORE_ROLE",T.ROLEID=d.get("id"),T.ROLECODE=d.get("code"),T.ROLENAME=d.get("text"),T.PARENT=d.get("parent")):(T.tableCode="JE_CORE_ROLEGROUP",T.JE_CORE_ROLEGROUP_ID=d.get("id"),T.ROLEGROUP_CODE=d.get("code"),T.ROLEGROUP_TEXT=d.get("text"));y=JE.ajax({url:JE.getUrlMaps("je.core.rbac.perm","getAppCheckedPerm"),params:T}),b=new Array;o.doSelfPerm(a,r,"ROOT"==T.PARENT,y.selfPerm),Ext.each(y.checkedPerm,function(e){var t=v.getNodeById(e);t&&(t.set("checked",!0),t.commit(),b.push(Ext.clone(t)))}),a.oldAppCheckedRecord=b}}},updatePerm:function(i,e){var a=this,t=i.up("panel[xtype=role.mainview]"),n=t.down("tabpanel[ref=role_group_tab]"),o=t.down("panel[ref=role_permtype_tab]"),r="PERM_ROLE",l={tableCode:"JE_CORE_ROLE"},s=n.getActiveTab(),d=s.getSelectionModel().getSelection()[0];if(d){var c=o.layout.getExpanded()[0],u=c.getSelectionModel().getSelection(),p=new Array,f="";Ext.each(u,function(e){var t=e.get("id");f=e.get("id"),p.push("'"+t+"'")}),l.module=p.join(","),"role.rolegrouptree"==s.xtype?(r="PERM_ROLEGROUP",l.tableCode="JE_CORE_ROLEGROUP",l.JE_CORE_ROLEGROUP_ID=d.get("id"),l.ROLEGROUP_TEXT=d.get("text"),l.ROLEGROUP_CODE=d.get("code")):(l.ROLEID=d.get("id"),l.ROLENAME=d.get("text"),l.ROLECODE=d.get("code"),l.PARENT=d.get("parent")),l.permType=r,l.isHard=e,l.type="menu";var E=new Array,m=new Array,g=i.getChecked(),h=Ext.value(i.oldCheckedRecord,[]);if("role.functree"==c.xtype?(h=Ext.value(i.oldFuncCheckedRecord,[]),l.type="func"):"role.apptree"==c.xtype&&(h=Ext.value(i.oldAppCheckedRecord,[]),l.type="app"),Ext.each(g,function(t){var i=!1;if(Ext.each(h,function(e){t.get("id")==e.get("id")&&(i=!0,e.isHave=!0)}),!i){var e=t.raw.nodeInfo,a=t.raw.nodeInfoType;if("role.functree"==c.xtype)-1==["BUTTON","SUB_FUNC"].indexOf(a)&&(e=""),E.push("#"+a+"#"+t.get("id")+"#"+e);else if("role.apptree"==c.xtype)E.push(f+"#"+a+"#"+t.get("id")+"#"+e);else{var n=t.getPath(),o=n.indexOf("/",6),r="";r=-1!=o?n.substring(6,o):n.substring(6),-1==["BUTTON","SUB_FUNC"].indexOf(a)&&(e=""),E.push(r+"#"+a+"#"+t.get("id")+"#"+e)}}}),Ext.each(h,function(e){e.isHave||m.push(e.get("id")),delete e.isHave}),l.delPermIds=m.join(","),l.addPermIds=E.join(","),a.saas&&a.saasAdmin){var x=t.down("cbbfield[name=JE_SAAS_CP]").getValue();JE.isNotEmpty(x)&&"SYS"!=x&&(l.cpId=x)}JE.getUrlMaps("je.core.rbac.perm","doUpdatePerm");"role.functree"==c.xtype&&(l.module=""),JE.ajax({url:JE.getUrlMaps("je.core.rbac.perm","doUpdatePerm"),async:!0,mask:!0,timeout:6e5,params:l,success:function(e){var t=Ext.decode(Ext.value(e.responseText,"{}"));t.success?("role.functree"==c.xtype?i.oldFuncCheckedRecord=g:"role.apptree"==c.xtype?i.oldAppCheckedRecord=g:i.oldCheckedRecord=g,JE.msg("授权成功"),a.doSelfPerm(i,i.getStore().getRootNode(),"ROOT"==l.PARENT,t.obj.selfPerm)):JE.alert(t.obj)}})}else JE.alert("请选择授权目标!")},initPermTree:function(){var e=JE.ajax({url:JE.getUrlMaps("je.core.rbac.perm","getPermTree"),params:{node:"ROOT",whereSql:" and SY_STATUS='1'"}});if(0<e.children.length){var t=Ext.create("Ext.util.MixedCollection");return Ext.each(e.children,function(e){t.add(e.id,e)}),t}return null},initFuncPermTree:function(){var e=JE.ajax({url:JE.getUrlMaps("je.core.rbac.perm","initFuncTreeNode"),params:{node:"ROOT",whereSql:""}});if(0<e.children.length){var t=Ext.create("Ext.util.MixedCollection");return Ext.each(e.children,function(e){t.add(e.id,e)}),t}return null},initAppPermTree:function(){var e=JE.ajax({url:JE.getUrlMaps("je.core.rbac.perm","initAppTreeNode"),params:{node:"ROOT",whereSql:""}});if(0<e.children.length){var t=Ext.create("Ext.util.MixedCollection");return Ext.each(e.children,function(e){Ext.each(e.children,function(e){e.parent="ROOT"}),t.add(e.id,e.children)}),t}return null},initCpPermTree:function(e){if(JE.isNotEmpty(e)){var t=JE.ajax({url:JE.getUrlMaps("je.core.rbac.perm","getPermTree"),params:{node:"ROOT",cpId:e,whereSql:" and SY_STATUS='1'"}});if(0<t.children.length){var i=Ext.create("Ext.util.MixedCollection");Ext.each(t.children,function(e){i.add(e.id,e)}),this.cpPermData[e]=i}return this.cpPermData}var a=!1,n=!1;return"1"==JE.systemConfig.JE_SYSMODE&&(a=!0,JE.currentUser.saas&&(n=!0)),this.saas=a,this.saasAdmin=n,{}},initCpFuncPermTree:function(e){if(JE.isNotEmpty(e)){var t=JE.ajax({url:JE.getUrlMaps("je.core.rbac.perm","initFuncTreeNode"),params:{node:"ROOT",cpId:e,whereSql:""}});if(0<t.children.length){var i=Ext.create("Ext.util.MixedCollection");Ext.each(t.children,function(e){i.add(e.id,e)}),this.cpFuncPermData[e]=i}return this.cpFuncPermData}var a=!1,n=!1;return"1"==JE.systemConfig.JE_SYSMODE&&(a=!0,JE.currentUser.saas&&(n=!0)),this.saas=a,this.saasAdmin=n,{}},initCpAppPermTree:function(e){if(JE.isNotEmpty(e)){var t=JE.ajax({url:JE.getUrlMaps("je.core.rbac.perm","initAppTreeNode"),params:{node:"ROOT",cpId:e,whereSql:""}});if(0<t.children.length){var i=Ext.create("Ext.util.MixedCollection");Ext.each(t.children,function(e){Ext.each(e.children,function(e){e.parent="ROOT"}),i.add(e.id,e.children)}),this.cpAppPermData[e]=i}return this.cpAppPermData}var a=!1,n=!1;return"1"==JE.systemConfig.JE_SYSMODE&&(a=!0,JE.currentUser.saas&&(n=!0)),this.saas=a,this.saasAdmin=n,{}},doSelfPerm:function(e,t,i,a){i?e.rootRole||(t.cascadeBy(function(e){e.set("cls",""),e.commit()}),e.rootRole=!0):(t.cascadeBy(function(e){-1!=a.indexOf(e.get("id"))?e.set("cls","roleperm-selfperm"):e.set("cls",""),e.commit()}),e.rootRole=!1)},views:["JE.sys.rbac.view.role.MainView","JE.sys.rbac.view.role.ModuleTree","JE.sys.rbac.view.role.PermTree","JE.sys.rbac.view.role.RoleForm","JE.sys.rbac.view.role.RoleTree","JE.sys.rbac.view.role.DeptTree","JE.sys.rbac.view.role.SentryTree","JE.sys.rbac.view.role.RoleGroupForm","JE.sys.rbac.view.role.RoleGroupTree","JE.sys.rbac.view.user.UserGrid","JE.sys.rbac.view.role.imp.UserInsWinView","JE.sys.rbac.view.role.imp.RoleInsDeptUserTreeView","JE.sys.rbac.view.role.imp.RoleDUTView","JE.sys.rbac.view.role.TreeMenu","JE.sys.rbac.view.role.FuncTree","JE.sys.rbac.view.role.AppTree"]}),Ext.define("JE.sys.rbac.controller.RoleUserPermController",{extend:"Ext.app.Controller",init:function(){var e={"panel[xtype=roleuser.mainview]":{afterrender:function(e){var t=e.down("panel[xtype=roleuser.permdiyview]"),i=JE.ajax({url:JE.getUrlMaps("je.core.rbac.perm","getRoleUserDiyPerm"),params:{}});0<i.length&&t.getRootNode().appendChild(i),e.setDisabled(!0)}},"panel[xtype=roleuser.mainview] button[ref=okBtn]":{click:function(e){var t=e.up("panel[xtype=roleuser.mainview]"),i=t.down("panel[xtype=roleuser.permdiyview]"),a=new Array;i.getRootNode().cascadeBy(function(e){1==e.get("checked")&&a.push(e.get("id"))});t.proxyRecord;var n=t.up("jemainview").down("jegridview").getSelectionModel().getSelection()[0];n?JE.ajax({url:JE.getUrlMaps("je.core.rbac.perm","updateRoleUserDiyPerm"),params:{roleId:n.get("ROLEID"),permIds:a.join(",")}}).success?JE.msg("设定成功!"):JE.alert("后台出错了，请联系管理员!"):JE.alert("请选中数据!")}}};this.control(e)},views:["JE.sys.rbac.view.roleuser.MainView","JE.sys.rbac.view.roleuser.PermDiyView","JE.sys.rbac.view.roleuser.MainPermView","JE.sys.rbac.view.roleuser.RolePermTree","JE.sys.rbac.view.roleuser.RolePermCheckTree","JE.sys.rbac.view.roleuser.RolePermSeeTree","JE.sys.rbac.view.roleuser.RolePermView"]}),Ext.define("JE.sys.rbac.controller.SentryController",{extend:"Ext.app.Controller",init:function(){var i=this,e={"jeformview[id=JE_CORE_SENTRY_jeformview] field[name=SENTRYCODE]":{blur:function(e){var t=e.up("#JE_CORE_SENTRY_jeformview");Ext.isEmpty(e.getValue())||e.originalValue==e.getValue()||(JE.ajax({url:JE.getUrlMaps("je.core.rbac.dept","checkFieldUniquen"),params:{tableCode:"JE_CORE_SENTRY",FIELDCODE:"SENTRYCODE",SENTRYCODE:e.getValue()}}).success?i.disableBindButtons(t,!1):(i.disableBindButtons(t,!0),e.markInvalid("该岗位编码已经被使用!")))}}};i.control(e)},disableBindButtons:function(e,t){var i=e.getDockedItems('toolbar[dock="top"]')[0];Ext.each(i.items.items,function(e){1==e.formBind&&(t?e.disable():e.enable())})}}),Ext.define("JE.sys.rbac.controller.SentryUserController",{extend:"Ext.app.Controller",init:function(){var e={"jegridview[id=JE_CORE_SENTRYUSERS_jegridview] button[ref=userImpl]":{click:function(e){var t=Ext.getCmp("JE_CORE_SENTRYUSERS_jegridview"),i=Ext.getCmp("JE_CORE_SENTRY_jeformview").getForm(),n=t.getStore(),o=(n.model,i.findField("SENTRYID").getValue());if(Ext.isEmpty(o))JE.alert("请先保存岗位数据!");else{var a=new Array;n.each(function(e){a.push("'"+e.get("USERID")+"'")});var r=0<a.length?" AND USERID NOT IN ("+a.join(",")+")":"";JE.selectWin({parent:null,parentType:"self",title:"人员",configInfo:"JE_CORE_QUERYUSER,,,M",whereSql:r,type:"grid",callback:function(e,t){var i=new Array;if(Ext.each(e,function(e){i.push(e.get("USERID"))}),0<i.length){var a=JE.ajax({url:JE.getUrlMaps("je.core.rbac.sentry","implUsers"),params:{tableCode:"JE_CORE_SENTRY",pkValue:o,ids:i.join(",")}});a.success?(n.load(),JE.msg("导入成功")):JE.alert(a.obj)}}})}}},"jegridview[id=JE_CORE_SENTRYUSERS_jegridview] button[ref=userDel]":{click:function(e){var t=Ext.getCmp("JE_CORE_SENTRYUSERS_jegridview"),i=Ext.getCmp("JE_CORE_SENTRY_jeformview").getForm(),a=t.getSelectionModel().getSelection(),n=i.findField("SENTRYID").getValue();if(Ext.isEmpty(n))JE.alert("请先保存岗位数据!");else if(0<a.length){var o=new Array;Ext.each(a,function(e){o.push(e.get("USERID"))});var r=JE.ajax({url:JE.getUrlMaps("je.core.rbac.sentry","removeUsers"),params:{tabelCode:"JE_CORE_SENTRY",ids:o.join(","),pkValue:n}});r.success?(JE.msg(r.obj),t.getStore().load()):JE.alert(r.obj)}else JE.alert("请选中人员!")}},"jegridview[id=JE_CORE_SENTRYUSERS_jegridview] gridcolumn[dataIndex=ICONCLS]":{render:function(e){e.renderer=function(e,t,i,a,n,o,r,l,s){return"<div class='"+e+"'> </div>"}}}};this.control(e)}}),Ext.define("JE.sys.rbac.controller.UserController",{extend:"Ext.app.Controller",init:function(){var i=this,e={"jeformview[id=JE_CORE_ENDUSER_jeformview]":{selfactivate:function(e,t){i.formActiveateCtr(e,"JE_CORE_ENDUSER",!1)}},"jeformview[id=JE_CORE_DEPTUSERS_jeformview]":{selfactivate:function(e,t){i.formActiveateCtr(e,"JE_CORE_DEPTUSERS",!1)}},"jeformview[id=JE_CORE_SENTRYUSERS_jeformview]":{selfactivate:function(e,t){i.formActiveateCtr(e,"JE_CORE_SENTRYUSERS",!0)}},"jeformview[id=JE_CORE_ENDUSER_jeformview] field[name=SENTRYNAMES]":{query:function(e,t,i){var a=e.up("jeformview[id=JE_CORE_ENDUSER_jeformview]");a.fireEvent("selfactivate",a)}},"jeformview[id=JE_CORE_DEPTUSERS_jeformview] field[name=SENTRYNAMES]":{query:function(e,t,i){var a=e.up("jeformview[id=JE_CORE_DEPTUSERS_jeformview]");a.fireEvent("selfactivate",a)}}};i.control(e)},formActiveateCtr:function(i,a,n){var o=this,e=i.getForm();Ext.each(i.query("fieldset[ref=sentryParams]"),function(e){i.remove(e)});var t=e.findField("SENTRYIDS").getValue(),r=e.findField("USERID").getValue(),l=JE.ajax({url:JE.getUrlMaps("je.core.rbac.user","loadSentryParams"),params:{tableCode:"JE_CORE_ENDUSER",SENTRYIDS:t,USERID:r}}),s=(new Array,e.findField("FIELDCODES"));if(0<l.length){var d=new Array;Ext.each(l,function(e){var t=o.parseSentry(e,a,n);0<t.fieldCodes.length&&(d=d.concat(t.fieldCodes),i.add(t))}),s?s.setValue(d.join(",")):i.add({xtype:"textfield",fieldLabel:"岗位参数",hidden:!0,name:"FIELDCODES",formCode:a+"_form",value:d.join(",")})}else s&&s.setValue("")},parseSentry:function(e,n,o){var t={xtype:"fieldset",ref:"sentryParams",title:e.SENTRYNAME,collapsible:!0,defaults:{labelAlign:"right",margin:"0 0 4 0"},layout:"column",margin:"0 0 4 0",columnWidth:1,style:"background-color:rgb(241, 241, 241);"},r=new Array,l=new Array;return 0<e.sentryParams.length&&Ext.each(e.sentryParams,function(e){var t=e.values;r.push(t.SENTRYPARAMS_CODE);var i={xtype:"textfield",fieldLabel:t.SENTRYPARAMS_NAME,name:t.SENTRYPARAMS_CODE,readOnly:o,columnWidth:Ext.value(1*t.SENTRYPARAMS_COSPAN,1)/3,value:Ext.value(t.SENTRYPARAMS_VALUE,""),formCode:n+"_form"},a=t.SENTRYPARAMS_TYPECODE;"numberfield"==a?(i.xtype=a,i.hideTrigger=!0,i.editable=!0,Ext.value(t.SENTRYPARAMS_VALUE,0)):"datafield"==a?(i.xtype="datetimefield",i.dateType="date",i.format="Y-m-d"):"datemonthfield"==a?(i.xtype="datetimefield",i.dateType="month",i.format="Y-m"):"datetimefield"==a?(i.xtype="datetimefield",i.dateType="datetime",i.format="Y-m-d H:i:s"):-1!=["gridssareafield","gridssfield","treessareafield","treessfield"].indexOf(a)?(i.xtype=a,i.configInfo=t.SENTRYPARAMS_CONFIGINFO,i.whereSql=Ext.value(t.SENTRYPARAMS_WHERESQL,"")):-1!=["cbbfield","cgroup","rgroup"].indexOf(a)?(i.xtype=a,i.configInfo=t.SENTRYPARAMS_CONFIGINFO):"displayfield"==i.xtype?(i.xtype=a,i.fieldStyle="width:100%;height:100%;"):i.xtype=a,l.push(i)}),t.fieldCodes=r,t.items=l,t},checkUserCode:function(e){return JE.ajax({url:JE.getUrlMaps("je.core.rbac.user","checkFieldUniquen"),params:{tableCode:"JE_CORE_ENDUSER",FIELDCODE:"BACKUSERCODE",BACKUSERCODE:e}}).success},disableBindButtons:function(e,t){var i=e.getDockedItems('toolbar[dock="top"]')[0];Ext.each(i.items.items,function(e){1==e.formBind&&(t?e.disable():e.enable())})},views:["JE.sys.rbac.view.user.DeptUserTree"]}),Ext.define("JE.sys.rbac.controller.UserProxyController",{extend:"Ext.app.Controller",treeData:null,init:function(){var e={"panel[xtype=proxy.mainview]":{afterrender:function(e){var t=e.down("panel[xtype=proxy.permproxyview]"),i=JE.ajax({url:JE.getUrlMaps("je.core.rbac.perm","getProxyPermTree"),params:{}});0<i.length&&t.getRootNode().appendChild(i),e.setDisabled(!0)}},"panel[xtype=proxy.mainview] button[ref=okBtn]":{click:function(e){var t=e.up("panel[xtype=proxy.mainview]"),i=t.down("panel[xtype=proxy.permproxyview]"),a=new Array;i.getRootNode().cascadeBy(function(e){1==e.get("checked")&&a.push(e.get("id"))});t.proxyRecord;var n=t.up("jemainview").down("jegridview"),o=n.getSelectionModel().getSelection()[0];if(o){o.set("USERPROXY_EXCLUDEPERMS",a.join(","));var r=n.down("button[ref=gridUpdateBtn]");r.fireEvent("click",r)}else JE.alert("请选中数据!")}},"panel[xtype=proxy.permproxyview] button[ref=refreshPerm]":{click:function(e){}}};this.control(e)},buildTreeData:function(i){var a=new Array,e=JE.currentUser.roles;return Ext.each(e,function(e){var t={id:e.roleId,text:e.roleName,code:e.roleCode,iconCls:e.iconCls,nodeInfo:e.roleType,nodeInfoType:e.nodeInfoType,nodePath:e.path,leaf:!0,layer:e.layer,parent:e.parent,orderIndex:e.orderIndex,bean:e};e.roleType==i&&a.push(t)}),a},views:["JE.sys.rbac.view.proxy.MainView","JE.sys.rbac.view.proxy.WestView","JE.sys.rbac.view.proxy.ProxyRoleTree","JE.sys.rbac.view.proxy.ProxyDeptTree","JE.sys.rbac.view.proxy.ProxySentryTree","JE.sys.rbac.view.proxy.PermProxyView"]}),Ext.define("JE.sys.rbac.controller.WorkGroupUserController",{extend:"Ext.app.Controller",init:function(){var e={"jegridview[id=JE_CORE_WORKGROUPUSERS_jegridview] button[ref=userImpl]":{click:function(e){var t=Ext.getCmp("JE_CORE_WORKGROUPUSERS_jegridview"),i=Ext.getCmp("JE_CORE_WORKGROUP_jeformview").getForm(),n=t.getStore(),o=(n.model,i.findField("JE_CORE_WORKGROUP_ID").getValue());if(Ext.isEmpty(o))JE.alert("请先保存工作组数据!");else{var a=new Array;n.each(function(e){a.push("'"+e.get("USERID")+"'")});var r="AND USERID NOT IN (SELECT USERID FROM JE_CORE_WORKGROUP_USER WHERE GROUPID='"+o+"')";JE.selectWin({parent:null,parentType:"self",title:"人员",configInfo:"JE_CORE_QUERYUSER,,,M",whereSql:r,type:"grid",callback:function(e,t){var i=new Array;if(Ext.each(e,function(e){i.push(e.get("USERID"))}),0<i.length){var a=JE.ajax({url:JE.getUrlMaps("je.core.rbac.workGroup","implUsers"),params:{tableCode:"JE_CORE_WORKGROUP",pkValue:o,ids:i.join(",")}});a.success?(n.load(),JE.msg("导入成功")):JE.alert(a.obj)}}})}}},"jegridview[id=JE_CORE_WORKGROUPUSERS_jegridview] button[ref=gridRemoveBtn]":{beforeclick:function(e){var a=Ext.getCmp("JE_CORE_WORKGROUPUSERS_jegridview"),t=Ext.getCmp("JE_CORE_WORKGROUP_jeformview").getForm(),n=a.getSelectionModel().getSelection(),o=t.findField("JE_CORE_WORKGROUP_ID").getValue();return Ext.isEmpty(o)?JE.alert("请先保存工作组数据!"):0<n.length?JE.confirm("确定删除吗？",function(e){if("ok"==e){var t=new Array;Ext.each(n,function(e){t.push(e.get("USERID"))});var i=JE.ajax({url:JE.getUrlMaps("je.core.rbac.workGroup","removeUsers"),params:{tabelCode:"JE_CORE_WORKGROUP",ids:t.join(","),pkValue:o}});i.success?(JE.msg(i.obj),a.getStore().load()):JE.alert(i.obj)}}):JE.alert("请选中人员!"),!1}},"jegridview[id=JE_CORE_WORKGROUPUSERS_jegridview] gridcolumn[dataIndex=ICONCLS]":{render:function(e){e.renderer=function(e,t,i,a,n,o,r,l,s){return"<div class='"+e+"'> </div>"}}},"jegridview[id=JE_CORE_WORKGROUPUSERS_jegridview]":{beforeload:function(e){e.gridObj;var t=" AND 1!=1",i=(Ext.getCmp("JE_CORE_WORKGROUPUSERS_jegridview"),Ext.getCmp("JE_CORE_WORKGROUP_jeformview").getForm().findField("JE_CORE_WORKGROUP_ID").getValue());e.sqls=Ext.applyIf(e.sqls,{basic:"",group:"",tree:"",parent:"",chart:"",order:"",quick:""}),Ext.isEmpty(i)||(t=" AND USERID IN (SELECT USERID FROM JE_CORE_WORKGROUP_USER WHERE GROUPID='"+i+"')"),e.sqls.parent=t,e.proxy.extraParams.whereSql=e.sqls.basic+" "+e.sqls.group+" "+e.sqls.parent+" "+e.sqls.chart+" "+e.sqls.tree+" "+e.sqls.quick}}};this.control(e)}}),Ext.define("JE.sys.upgrade.view.UpgradeView",{extend:"Ext.form.Panel",alias:"widget.upgrade.upgradeview",frame:!1,id:"jeupgradeview",layout:"column",autoScroll:!0,bodyPadding:"10 20 0 20",defaults:{xtype:"fieldset",labelAlign:"right",margin:"5 0 0 0 ",layout:"column",collapsible:!0,columnWidth:1,defaults:{xtype:"displayfield",labelAlign:"right",labelSeparator:"",cls:"je-upgrade-start",margin:"5 0 8 0",columnWidth:.2}},initComponent:function(){var e=this.upgradeRecord,i=Ext.value(e.get("UPHISTORY_FUNCNAME"),"").split(","),t=Ext.value(e.get("UPHISTORY_FUNCCODE"),"").split(","),a=Ext.value(e.get("UPHISTORY_TABLENAMES"),"").split(","),n=Ext.value(e.get("UPHISTORY_TABLECODES"),"").split(","),o=Ext.value(e.get("UPHISTORY_PROCESSNAMES"),"").split(","),r=Ext.value(e.get("UPHISTORY_PROCESSKEYS"),"").split(","),l=Ext.value(e.get("UPHISTORY_DDNAMES"),"").split(","),s=Ext.value(e.get("UPHISTORY_DDCODES"),"").split(","),d=Ext.value(e.get("UPHISTORY_ICONNAMES"),"").split(","),c=Ext.value(e.get("UPHISTORY_ICONCODES"),"").split(","),u=[],p=[],f=[],E=[],m=[];Ext.isEmpty(e.get("UPHISTORY_FUNCCODE"))||Ext.each(t,function(e,t){u.push({name:e,value:i[t]+"("+e+")"})}),Ext.isEmpty(e.get("UPHISTORY_TABLECODES"))||Ext.each(n,function(e,t){p.push({name:e,value:a[t]+"("+e+")"})}),Ext.isEmpty(e.get("UPHISTORY_PROCESSKEYS"))||Ext.each(r,function(e,t){f.push({name:e,value:o[t]+"("+e+")"})}),Ext.isEmpty(e.get("UPHISTORY_DDCODES"))||Ext.each(s,function(e,t){E.push({name:e,value:l[t]+"("+e+")"})}),Ext.isEmpty(e.get("UPHISTORY_ICONCODES"))||Ext.each(c,function(e,t){m.push({name:e,value:d[t]+"("+e+")"})}),this.items=[{title:"功能升级",items:u},{title:"辅助表升级",items:p},{title:"工作流升级",items:f},{title:"字典升级",items:E},{title:"图标升级",items:m}],this.callParent()}}),Ext.define("JE.sys.upgrade.controller.UpgradeController",{extend:"Ext.app.Controller",init:function(){this.control({})},views:["JE.sys.upgrade.view.UpgradeView"]}),Ext.define("JE.sys.workflowfunc.view.CenterView",{extend:"Ext.grid.Panel",alias:"widget.workflowfunc.centerview",cls:"jegrid",columnLines:!0,cls:"je-tp-tpview je-tp-tplistview je-wffunc-list",WFType:"PREAPPROV",hideHeaders:!0,viewConfig:{stripeRows:!1,tableFocusedFirstCls:"",tableSelectedFirstCls:"",tableOverFirstCls:"",beforeOverItemCls:"",beforeSelectedItemCls:""},initComponent:function(){var p=this;p.localLang=JE.getLocalLang("core.jewfview.workflowCtr",!0);var e="";Ext.isEmpty(p.piids)||(e=" AND EXECUTION_ID_ IN ('"+p.piids.split(",").join("','")+"')"),Ext.isEmpty(p.querySql)||(e+=p.querySql),p.store=Ext.create("Ext.data.Store",{pageSize:1*Ext.value(JE.systemConfig.JE_SYS_WFLIMIT,11),remoteSort:!0,autoLoad:!0,fields:["taskId","taskName","proccessName","tableCode","funcName","funcCode","displayConfigInfo","createTime","pkValue","pdid","piid","priority","bean","isNew","delay","status"],gridObj:p,proxy:{type:"ajax",method:"POST",url:JE.getUrlMaps("je.core.wf.taskInfo","getCurrentTask"),extraParams:{queryType:"PI_PREAPPROV",whereSql:e},reader:{type:"json",root:"rows",totalProperty:"totalCount"},writer:{type:"json"}},listeners:{load:function(e){var t=e.getProxy().getReader().jsonData,i={OWNER:"ownerCount",APPROVED:"approvedCount",PREAPPROV:"preapprovCount",DELAY:"delayCount"};p.searchBar.items.each(function(e){e.setText&&e.setText(e.basicText+"("+t[i[e.itemId]]+")")});var a=p.ownerCt.id.replace("_mainview","");JE.loadBadge(a)}}}),p.relayEvents(p.store,["beforeload","load"]),p.listTpl=new Ext.XTemplate(['<div class="tplistview-item">','<div class="first">','<span class="title">{rowNum}. {proccessName}<tpl if="isNew"><img src="'+JE.getStaticUrl("JE.sys.workflowfunc.view.CenterView.new")+'"/></tpl></span>','<span class="user">{user}，{createTime}</span>',"</div>",'<div class="info">{info}</div>','<div class="buttons">',"<tpl if=\"['APPROVED','OWNER'].indexOf(this.cmp.WFType) == -1\">",'<div class="button delay" data-value="{delay}"><tpl if="delay==\'1\'">'+p.localLang.callDeloy+"<tpl else>"+p.localLang.addDeloy+"</tpl></div>","</tpl>",'<div class="button history">'+p.localLang.dataHistory+"</div>",'<div class="button priority"><i class="fa <tpl if="priority==\'1\'">fa-star<tpl else>fa-star-o</tpl>"></i>'+p.localLang.addStar+"</div>","</div>",'<div style="position: absolute;top:5px;right:10px;font-size:18px;">',"<tpl if=\"status=='YQ'\">",'<span style="color:#D60000;">'+p.localLang.warnYq+"</span>","<tpl elseif=\"status=='YJ'\">",'<span style="color:#F97300;">'+p.localLang.warnYj+"</span>","</tpl>","</div>","</div>",{cmp:p}]),p.columns=[{dataIndex:"taskName",flex:1,renderer:function(e,t,i,a,n,o,r){var l=i.data,s=p.store.currentPage||1,d=p.store.pageSize;rowNum=(s-1)*d+a+1,l.rowNum=rowNum;var c="需处理任务："+l.taskName,u=l.displayConfigInfo;return Ext.isEmpty(u)||(c=JE.toXT(u,l)),l.info=c,-1!=["PREAPPROV","DELAY"].indexOf(p.WFType)?l.user=l.bean.SY_LASTFLOWUSER:l.user=l.bean.SY_PREAPPROVUSERNAMES,p.listTpl.apply(l)}}],p.bbar={xtype:"uxpagingtoolbar",store:p.store,pageNum:!0,displayInfo:!0},p.dockedItems=[p.getSearchBar(),p.getTodoBar()],p.callParent(arguments),p.searchBar=p.getDockedCmp("searchBar"),p.todoBar=p.getDockedCmp("todoBar")},afterRender:function(){this.callParent(arguments)},changeView:function(e){this.searchBar.setVisible(!e),this.todoBar.setVisible(e),this.getSelectionModel().setSelectionMode(e?"SIMPLE":"SINGLE"),this.getStore().load()},getSearchBar:function(){var t=this;return{xtype:"container",layout:{type:"hbox",align:"middle"},height:40,style:"background-color:#fff;",cls:"tplistview-buttons",itemId:"searchBar",defaults:{allowDepress:!1,cls:"btn JEPLUS_B_L10",enableToggle:!0,toggleGroup:"tpBtns",width:140,margin:"0 5",xtype:"button",handler:function(e){t.WFType=e.itemId,t.store.getProxy().extraParams.queryType="PI_"+e.itemId,t.store.loadPage(1)}},items:[{text:t.localLang.preapprov,basicText:t.localLang.preapprov,itemId:"PREAPPROV",pressed:!0},{text:t.localLang.approved,basicText:t.localLang.approved,itemId:"APPROVED"},{text:t.localLang.owner,basicText:t.localLang.owner,itemId:"OWNER"},{text:t.localLang.delay,basicText:t.localLang.delay,itemId:"DELAY"},{xtype:"tbfill",cls:""},{xtype:"box",cls:"",width:100,html:"双击进行审批"}]}},getTodoBar:function(){var i=this;return{xtype:"toolbar",itemId:"todoBar",dock:"top",hidden:!0,height:40,style:"background-color:#fff;border-width:0px;",items:[{margin:"0 0 0 10",xtype:"yesnofield",boxLabel:i.localLang.allTask,listeners:{change:function(e,t){i.getSelectionModel()[t?"selectAll":"deselectAll"]()}}},{xtype:"rgroup",configInfo:"JE_WF_BATCHTYPE",name:"BATCHTYPE",value:"submit"},"",{xtype:"button",iconCls:JE.getIconCls({iconCls:"jeicon jeicon-pass",fontIconCls:"fa fa-play"}),cls:"btn JEPLUS_B_C01",ref:"submit",text:i.localLang.doWf},"->",{xtype:"button",iconCls:JE.getIconCls({iconCls:"jeicon jeicon-sitemap-three",fontIconCls:"fe icon-sitemap"}),cls:"btn JEPLUS_B_L10",ref:"showImage",text:i.localLang.wfImg}]}}}),Ext.define("JE.sys.workflowfunc.view.MainView",{extend:"Ext.panel.Panel",alias:"widget.workflowfunc.mainview",layout:"border",border:0,bodyPadding:"0",bodyStyle:"background-color:#fff",initComponent:function(){var e=!1;"1"==JE.systemConfig.JE_DIANJIAN&&(e=!0),this.items=[{xtype:"workflowfunc.westview",width:200,region:"west",hidden:e,split:!0,itemId:"west",margin:"0 2 0 0"},{xtype:"workflowfunc.centerview",itemId:"center",region:"center",piids:this.piids,querySql:this.querySql}],this.callParent(arguments)}}),Ext.define("JE.sys.workflowfunc.view.WestView",{extend:"Ext.panel.Panel",alias:"widget.workflowfunc.westview",layout:"border",defaults:{border:0},bodyStyle:"background-color:#FFFFFF;border-top-width:0px;",cls:"je-tree-searchview",initComponent:function(){var a=this;a.localLang=JE.getLocalLang("core.jewfview.workflowCtr",!0),a.tools=[{type:"refresh",qtip:a.localLang.refresh,handler:function(e,t,i){i.ownerCt.down("treepanel[ref=processtree]").getSelectionModel().deselectAll()}}],a.title=a.localLang.title,"plus"==JE.getTheme()&&(a.header={hidden:!0});var e={region:"south",xtype:"panel",height:40,layout:"fit",items:{xtype:"yesnofield",inputType:"switch",boxLabel:a.localLang.batchWf,value:"0",name:"selectModel",fieldTdAttr:"align=center",listeners:{change:function(e,t,i){a.changeView(t)}}},bodyStyle:"background:none;",cls:"x-view-hinttext"};a.items=[e,{region:"center",xtype:"treepanel",itemId:"tree",useArrows:!0,rootVisible:!1,cls:"je-tree-searchtree",multiSelect:!0,selModel:{selType:"treemodel",allowDeselect:!0,mode:"SINGLE"},ref:"processtree",border:0,animate:!1,wfBatch:!1,bodyStyle:"plus"==JE.getTheme()?"padding-top:5px;border-width:0px;":"",store:JE.getStore({type:"tree",tableName:"JE_CORE_PROCESSINFO",url:JE.getUrlMaps("je.core.wf.processInfo","getProcessTree"),multi:!1,params:{whereSql:""}}),viewConfig:{selectedItemCls:"x-tree-row-selected",focusedItemCls:"x-tree-row-focused",beforeFocusedItemCls:"x-tree-row-before-focused",tableFocusedFirstCls:"x-tree-table-focused-first"}}],a.callParent(arguments),a.getCmp("tree").store.on("load",function(e){e.getRootNode().eachChild(function(e){e.expand(),e.set("cls","je-tree-search-root")})})},changeView:function(e){var t=this.getCmp("tree"),i=t.getStore().getProxy();t.getSelectionModel().deselectAll(),e?(i.url=JE.getUrlMaps("je.core.wf.processInfo","getCurrentTaskTree"),i.extraParams.whereSql=" AND (ASSIGNEE = '"+JE.currentUser.userId+"' OR TASKID IN (SELECT TASK_ FROM JBPM4_PARTICIPATION WHERE USERID_='"+JE.currentUser.userId+"' AND TYPE_='viewer'))",t.wfBatch=!0):(i.url=JE.getUrlMaps("je.core.wf.processInfo","getProcessTree"),i.extraParams.whereSql="",t.wfBatch=!1),t.getStore().load(),this.ownerCt.getComponent("center").changeView(e)}}),Ext.define("JE.sys.workflowfunc.controller.WorkflowFuncCtr",{extend:"Ext.app.Controller",init:function(){var m=this,e={"panel[xtype=workflowfunc.westview] treepanel[ref=processtree]":{selectionchange:function(e,t,i){var a=e.view.panel,n=a.up("panel[xtype=workflowfunc.mainview]").down("gridpanel[xtype=workflowfunc.centerview]");if(t=Ext.value(t,[]),a.wfBatch){var o=t[0];if(f="",o)if("PROCESS"==o.get("nodeType"))f=" AND EXECUTION_ID_ IN (SELECT ID_ FROM JBPM4_EXECUTION WHERE PROCDEFID_ = '"+o.get("id")+"')";else{var r=o.parentNode;f=" AND EXECUTION_ID_ IN (SELECT ID_ FROM JBPM4_EXECUTION WHERE PROCDEFID_ = '"+r.get("id")+"' AND ACTIVITYNAME_='"+o.get("text")+"')";var l=n.down("rgroup[name=BATCHTYPE]").getValue(),s=m.getProcess(r.get("id")),d=s.taskNodeInfos[o.get("text")];if("submit"==l)"decision"==d.type?f=" AND 1!=1":f+=" AND ASSIGNEE_='"+JE.currentUser.userId+"'";else if("return"==l){var c=s.rollbackAble;d.name==s.firstTaskNode&&(c=!1),"join"==d.type&&(c=!1);var u=d.beforeTaskNames.split(",");1==u.length&&null!=s.taskNodeInfos[u[0]]?-1!=["countersign","fork"].indexOf(s.taskNodeInfos[u[0]].type)&&(c=!1):c=!1,c?f+=" AND ASSIGNEE_='"+JE.currentUser.userId+"'":f=" AND 1!=1"}else"takeround"==l&&(f+=" AND DBID_ IN (SELECT TASK_ FROM JBPM4_PARTICIPATION WHERE USERID_='"+JE.currentUser.userId+"' AND TYPE_='viewer')")}(p=n.getStore()).getProxy().extraParams.whereSql=f,p.loadPage(1)}else{var p,f="";if(t&&0<t.length){var E=new Array;Ext.each(t,function(e){"PROCESS"==e.get("nodeInfo")&&E.push(e.get("code")),m.eachAllChild(e,function(e){"PROCESS"==e.get("nodeInfo")&&E.push(e.get("code"))})}),0<E.length&&(f=" AND EXECUTION_ID_ IN (SELECT ID_ FROM JBPM4_EXECUTION WHERE PROCDEFID_ in (SELECT PROCESSINFO_PROCESSDEFINIT_ID FROM JE_CORE_PROCESSINFO WHERE PROCESSINFO_LASTVERSION!='none' AND PROCESSINFO_DEPLOYSTATUS='1' AND PROCESSINFO_ENABLED='1' AND PROCESSINFO_PROCESSKEY IN ('"+E.join("','")+"')))")}(p=n.getStore()).getProxy().extraParams.whereSql=f,p.loadPage(1)}}},"gridpanel[xtype=workflowfunc.centerview]":{itemclick:function(e,t,i,a,n,o){var r=n.getTarget(".button",2,!0);if(r){if(n.stopPropagation(),r.hasCls("history"))JE.Action.showLogTpl(r.dom,t.get("tableCode"),t.get("pkValue"));else if(r.hasCls("delay")){var l="1"==(l=t.get("delay"))?"0":"1";(s=JE.ajax({url:JE.getUrlMaps("je.core.wf.taskInfo","updateTaskDelay"),params:{taskId:t.get("taskId"),delay:l}})).success?(e.getStore().load(),"1"==l?JE.msg("已进入我的延迟中..."):JE.msg("已取消延迟...")):JE.alert(s.obj)}else if(r.hasCls("priority")){var s,d="1"==(d=t.get("priority"))?"0":"1";(s=JE.ajax({url:JE.getUrlMaps("je.core.wf.taskInfo","updateTaskPriority"),params:{taskId:t.get("taskId"),priority:d}})).success?(t.set("priority",d),t.commit()):JE.alert(s.obj)}}else"1"==JE.systemConfig.JE_SYS_WFITEMCLICK&&e.panel.fireEvent("itemdblclick",e,t,i,a,n,o)},itemdblclick:function(e,t,i,a,n,o){var r=e.panel;1==t.get("isNew")&&t.set("isNew",!1);var l=JE.ajax({url:JE.getUrlMaps("je.core.getInfoById"),params:{tableCode:t.get("tableCode"),pkValue:t.get("pkValue")}});l.__doTask=t.get("taskName");var s={maximized:!1};"1"==JE.systemConfig.JE_DIANJIAN&&(s={maximized:!0}),JE.showFunc(t.get("funcCode"),{winConfig:s,useChild:!0,values:l,readOnly:!1,type:"form",callback:function(n){n.up("window").on("close",function(e){var t=n.form.findField("SY_PREAPPROVUSERS"),i=n.wfInfo;if(t){var a=t.getValue();Ext.isEmpty(a)||-1==a.split(",").indexOf(JE.currentUser.userId)||(!1,i&&-1==i.btns.indexOf("wfSubmitBtn")&&!0),i&&-1!=i.btns.indexOf("wfChangePassBtn")&&!0,"PREAPPROV"==r.WFType&&r.store.load()}})}})}},"gridpanel[xtype=workflowfunc.centerview] rgroup[name=BATCHTYPE]":{change:function(e,t,i){if(!(1<t.split(",").length)){var a=e.up("gridpanel[xtype=workflowfunc.centerview]"),n=a.up("panel[xtype=workflowfunc.mainview]").down("panel[xtype=workflowfunc.westview] treepanel[ref=processtree]").getSelectionModel().getSelection()[0];if(n&&"TASK"==n.get("nodeType")){var o=n.parentNode,r=" AND EXECUTION_ID_ IN (SELECT ID_ FROM JBPM4_EXECUTION WHERE PROCDEFID_ = '"+o.get("id")+"' AND ACTIVITYNAME_='"+n.get("text")+"')",l=t,s=m.getProcess(o.get("id")),d=s.taskNodeInfos[n.get("text")];if("submit"==l)"decision"==d.type?r=" AND 1!=1":r+=" AND ASSIGNEE_='"+JE.currentUser.userId+"'";else if("return"==l){var c=s.rollbackAble;d.name==s.firstTaskNode&&(c=!1),"join"==d.type&&(c=!1);var u=d.beforeTaskNames.split(",");1==u.length&&null!=s.taskNodeInfos[u[0]]?-1!=["countersign","fork"].indexOf(s.taskNodeInfos[u[0]].type)&&(c=!1):c=!1,c?r+=" AND ASSIGNEE_='"+JE.currentUser.userId+"'":r=" AND 1!=1"}else"takeround"==l&&(r+=" AND DBID_ IN (SELECT TASK_ FROM JBPM4_PARTICIPATION WHERE USERID_='"+JE.currentUser.userId+"' AND TYPE_='viewer')");var p=a.getStore();p.getProxy().extraParams.whereSql=r,p.loadPage(1)}}}},"gridpanel[xtype=workflowfunc.centerview] button[ref=showImage]":{click:function(e){var t=e.up("panel[xtype=workflowfunc.mainview]").down("panel[xtype=workflowfunc.westview] treepanel[ref=processtree]").getSelectionModel().getSelection()[0];if(t){var i=t.get("description");"TASK"==t.get("nodeType")&&(i=t.parentNode.get("description")),JE.Action.showWFImage({xmlContext:i})}else JE.alert("请选中流程")}},"gridpanel[xtype=workflowfunc.centerview] button[ref=submit]":{click:function(e){var t=e.up("gridpanel[xtype=workflowfunc.centerview]"),i=t.up("panel[xtype=workflowfunc.mainview]").down("panel[xtype=workflowfunc.westview] treepanel[ref=processtree]"),a=i.getSelectionModel().getSelection()[0],n=t.down("rgroup[name=BATCHTYPE]").getValue();if(a)if("TASK"==a.get("nodeType")){var o=t.getSelectionModel().getSelection();if(o.length<=0)JE.alert("请选择数据!");else{var r=a.parentNode,l=m.getProcess(r.get("id")),s=(l.taskNodeInfos[a.get("text")],o[0]),d=new Array,c=new Array;Ext.each(o,function(e){d.push(e.get("pkValue")),c.push(e.get("piid"))});var u={audFlag:s.get("bean").SY_AUDFLAG,btns:[],currentTasks:[],info:l,pdid:r.get("id"),piid:c.join(","),tableCode:l.tableCode,pkValue:"",ids:d.join(","),taskId:"",taskName:a.get("text"),wfBatch:!0,callback:function(){i.getStore().load(),i.getSelectionModel().deselectAll(),t.getStore().loadPage(1)}};JE.Action.doWFSubmitWin({wfInfo:u},n)}}else JE.alert("请选择需要处理的任务节点!");else JE.alert("请选择需要处理的任务节点!")}}};m.control(e)},getProcess:function(e){if(this.wfInfos||(this.wfInfos={}),this.wfInfos[e])return this.wfInfos[e];var t=JE.ajax({url:JE.getUrlMaps("je.core.wf.processInfo","getProcessInfo"),params:{tableCode:"JE_CORE_PROCESSINFO",SY_PDID:e}});if(t.success)return this.wfInfos[e]=t.obj,t.obj;JE.alert("流程信息未找到")},eachAllChild:function(e,t){var i=this;e.eachChild(function(e){t(e),e.hasChildNodes()&&i.eachAllChild(e,t)})},views:["JE.sys.workflowfunc.view.MainView","JE.sys.workflowfunc.view.WestView","JE.sys.workflowfunc.view.CenterView"],stores:[],models:[]}),Ext.define("JE.sys.email.util.EmailFileUtil",{doFile:function(e,t,i){var a=this.getFileView(t),o=(a.getStore().proxy.extraParams.tableCode,a.getSelectionModel().getSelection()),n=JE.getLocalLang("sys.email.file.util");switch(Ext.apply(n,JE.getLocalLang("sys.email.file.treeMenu")),i){case"openFile":0==o.length?JE.alert(n.selectAlert):1<o.length?JE.alert(JE.format(n.selectOneAlert,n.open)):this.openFile(o[0],a.getStore());break;case"seeFile":if(0==o.length)JE.alert(n.selectAlert);else if(1<o.length)JE.alert(JE.format(n.selectOneAlert,n.browse));else{var r=new Array;a.getStore().each(function(e){r.push({id:e.get("JE_SYS_DOCUMENTATION_ID"),name:e.get("DOCUMENTATION_TEXT"),path:e.get("DOCUMENTATION_ADDRESS")})}),JE.File.openFileByPath(o[0].get("DOCUMENTATION_ADDRESS"),o[0].get("DOCUMENTATION_TEXT"),!0,r,null,"docinfo",o[0].get("JE_SYS_DOCUMENTATION_ID"))}break;case"saveFile":if(0==o.length)JE.alert(n.selectAlert);else{var l=new Array;Ext.each(o,function(e){l.push({id:rec.get("JE_SYS_DOCUMENTATION_ID"),name:e.get("DOCUMENTATION_TEXT"),path:e.get("DOCUMENTATION_ADDRESS")})}),JE.File.addDocBatchFiles(l)}break;case"downloadFile":if(0==o.length)JE.alert(n.selectAlert);else if(1<o.length)JE.alert(JE.format(n.selectOneAlert,n.download));else{var s=JE.getUrlMaps("je.core.doc.documentation","download");window.open(s+"?ieFlag="+(Ext.isIE?"1":"0")+"&enCode=1&fileName="+encodeURIComponent(o[0].get("DOCUMENTATION_TEXT"))+"&path="+o[0].get("DOCUMENTATION_ADDRESS"))}break;case"packageDownload":0==o.length?JE.alert(n.selectAlert):JE.prompt(n.packageAlert,function(e,t){if("cancel"!=e&&!Ext.isEmpty(t)){var i=new Array;Ext.each(o,function(e){i.push(e.get("JE_SYS_DOCUMENTATION_ID"))});var a=" AND JE_SYS_DOCUMENTATION_ID IN ('"+i.join("','")+"')",n=JE.getUrlMaps("je.core.doc.documentation","downloadZip");window.open(n+"?ieFlag="+(Ext.isIE?"1":"0")+"&fileName="+encodeURIComponent(t+".zip")+"&email=1beanTableCode=JE_SYS_EMAILSELECT&querySql="+encodeURIComponent(a))}});break;case"selectAll":a.getSelectionModel().selectAll();break;case"refresh":a.getSelectionModel().deselectAll(),a.getStore().load(),this.copyInfo=null;break;case"attribute":if(0==o.length)return void JE.alert(n.selectAlert);if(1<o.length)return void JE.alert(JE.format(n.selectOneAlert,JE.getLocalLang("sys.email.fileData.operation")));var d=o[0],c=Ext.clone(d.data);c.FILE_TYPENAME="文件",c.FILE_FILE=c.DOCUMENTATION_TEXT+"*"+c.DOCUMENTATION_ADDRESS,JE.formWin({title:n.fileTitle,width:600,height:430,border:0,frame:!1,autoShow:!0,iconCls:c.FILE_ICONCLS,formConfig:{bodyPadding:"10 10 0 10",bodyStyle:{background:"#f1f1f1"}},defaults:{xtype:"textfield",columnWidth:.5,readOnly:!0,padding:"3 0 3 0"},items:[{name:"EMAILDATA_BT",fieldLabel:n.emailTitle,xtype:"textfield"},{name:"DOCUMENTATION_TEXT",fieldLabel:n.name},{xtype:"uxfilefield",name:"FILE_FILE",fieldLabel:n.path},{name:"DOCUMENTATION_FILETYPENAME",fieldLabel:n.type},{name:"SY_CREATEORGNAME",fieldLabel:n.uploadDept},{name:"DOCUMENTATION_SIZE",fieldLabel:n.size,unitTpl:n.sizeUnitTpl},{name:"SY_CREATEUSERNAME",fieldLabel:n.uploadUser},{name:"SY_CREATETIME",fieldLabel:n.uploadTime},{xtype:"textarea",name:"DOCUMENTATION_REMARK",height:150,fieldLabel:n.remark,columnWidth:1},{xtype:"hidden",name:"JE_SYS_DOCUMENTATION_ID"}],showFn:function(e){e.down("form").form.setValues(c)}})}},queryFile:function(e,t,i,a){var n=e.form.getValues(),o=this.getFileView(a).getStore();a.modeType="QUERY";var r="",l=this.getOrderSql(a.orderType);Ext.isEmpty(n.JE_SYS_FILENAME)||(r+=" AND DOCUMENTATION_TEXT like '%"+n.JE_SYS_FILENAME+"%'"),Ext.isEmpty(n.JE_SYS_DIRID)||(r+=" AND JE_SYS_EMAILCONFIG_ID = '"+n.JE_SYS_DIRID+"'");var s=new Array;if(Ext.isEmpty(n.JE_SYS_FILETYPE)||Ext.each(n.JE_SYS_FILETYPE.split(","),function(e){switch(e){case"doc":s.push("doc"),s.push("docx");break;case"xls":s.push("xls"),s.push("xlsx");break;case"pdf":s.push("pdf");break;case"ppt":s.push("ppt"),s.push("pptx");break;case"zip":s.push("zip"),s.push("rar");break;case"jpg":s.push("jpg"),s.push("png"),s.push("gif"),s.push("ico"),s.push("bmp"),s.push("jpeg");break;case"mp4":s.push("avi"),s.push("mov"),s.push("wmv"),s.push("wmv"),s.push("mp4"),s.push("flv"),s.push("rmvb");break;case"mp3":s.push("mp3");break;case"png":s.push("dwf"),s.push("dwg")}}),Ext.isEmpty(n.JE_SYS_DIYTYPE)||Ext.each(n.JE_SYS_DIYTYPE.split(","),function(e){s.push(e)}),0<s.length&&(r+=" AND DOCUMENTATION_FILETYPE IN ('"+s.join("','")+"')"),Ext.isEmpty(n.JE_SYS_DIYSTARTSIZE))if(Ext.isEmpty(n.JE_SYS_DIYENDSIZE)){if("all"!=n.JE_SYS_FILESIZE)switch(n.JE_SYS_FILESIZE){case"1000000":r+=" AND DOCUMENTATION_SIZE>1000000000 ";break;case"100000":r+=" AND DOCUMENTATION_SIZE>100000000 ";break;case"1000":r+=" AND DOCUMENTATION_SIZE>1000000 ";break;case"-1000":r+=" AND DOCUMENTATION_SIZE<1000000 ";break;case"100":r+=" AND DOCUMENTATION_SIZE>100000 "}}else{r+=" AND DOCUMENTATION_SIZE<="+1e6*Ext.value(n.JE_SYS_DIYENDSIZE,0)}else r+=" AND DOCUMENTATION_SIZE>="+1e6*Ext.value(n.JE_SYS_DIYSTARTSIZE,0);if(Ext.isEmpty(n.JE_SYS_DIYDATE)){if("all"!=n.JE_SYS_MODFIYDATE){var d=new Date;switch(n.JE_SYS_MODFIYDATE){case"week":var c=new Date,u=d.getDay();c.setDate(c.getDate()-u+1),d.setDate(d.getDate()+(7-u)),r+=" AND SY_CREATETIME>='"+Ext.Date.format(c,"Y-m-d")+" 00:00:00' AND SY_CREATETIME<='"+Ext.Date.format(d,"Y-m-d")+" 23:59:59'";break;case"month":var p=Ext.Date.format(d,"Y-m");r+=" AND SY_CREATETIME>='"+p+"-01 00:00:00' AND SY_CREATETIME<='"+p+"-31 23:59:59'";break;case"year":r+=" AND SY_CREATETIME>='"+(f=Ext.Date.format(d,"Y"))+"-01-01 00:00:00' AND SY_CREATETIME<='"+f+"-12-31 23:59:59'";break;case"beforeyear":var f;d.setYear(d.getYear()+1900-1),r+=" AND SY_CREATETIME>='"+(f=Ext.Date.format(d,"Y"))+"-01-01 00:00:00' AND SY_CREATETIME<='"+f+"-12-31 23:59:59'"}}}else r+=" AND SY_CREATETIME>='"+n.JE_SYS_DIYDATE+" 00:00:00' AND SY_CREATETIME<='"+n.JE_SYS_DIYDATE+" 23:59:59'";o.proxy.extraParams.querySql=r,o.proxy.extraParams.orderSql=l,o.proxy.extraParams.nodeSql="",o.loadPage(1)},openFile:function(e,t){var i=new Array;t.each(function(e){i.push({id:e.get("JE_SYS_DOCUMENTATION_ID"),name:e.get("DOCUMENTATION_TEXT"),path:e.get("DOCUMENTATION_ADDRESS")})}),JE.File.openFileByPath(e.get("DOCUMENTATION_ADDRESS"),e.get("DOCUMENTATION_NAME"),!1,i,null,"docinfo",e.get("JE_SYS_DOCUMENTATION_ID"))},changeOrderType:function(e,t,i){if(e.orderType!=i.code){i.up("button[ref=order]").down("menuitem[code="+e.orderType+"]").setIconCls(""),i.setIconCls("jeicon jeicon-check"),e.orderType=i.code;var a=t.getStore(),n=(a.getProxy().extraParams.orderSql,this.getOrderSql(i.code));a.getProxy().extraParams.orderSql=n,a.load()}},changeViewType:function(e,t,i,a){t.up("button[ref=view]").down("menuitem[code="+e.viewType+"]").setIconCls(""),t.setIconCls("jeicon jeicon-check"),e.viewType=t.code;i.id;"thumbnail"==t.code?(i.show(),a.hide(),i.tpl=new Ext.XTemplate(['<tpl for=".">','<div class=table-files style="border: 1px solid #fff;table-layout:fixed;word-wrap:break-word;float:left;margin:9px;width:104px;height:133px;">','<div style="text-align:center;width:96px;height:96px;"><table width=100% height=100%><tr><td align=center valign = middle>{[this.formatFile(values)]}</td></tr></table></div>','<div class="x-editable" style="height:36px;padding-top:4px;text-align:center;overflow:hidden;text-overflow:ellipsis;" title="{DOCUMENTATION_TEXT}">{[values.DOCUMENTATION_TEXT.ellipsis(14)]}</div>',"</div>","</tpl>"],{formatFile:function(e){return JE.getFileThumbnail(e,{width:"96",height:"96",styleConfig:"DOCUMENTATION_THUMBNAILCLS",imgUrl:"DOCUMENTATION_PRIVATEKEY",imgCdnUrl:"DOCUMENTATION_ADDRESS",imgName:"DOCUMENTATION_TEXT",icon:"DOCUMENTATION_ICONCLS",imgType:"docinfo",tableCode:"JE_SYS_DOCUMENTATION"})}}),i.getStore().load()):"icon"==t.code?(i.show(),a.hide(),i.tpl=new Ext.XTemplate(['<tpl for=".">','<div class=table-files style="border: 1px solid #fff;table-layout:fixed;word-wrap:break-word;float:left;margin:10px;width:58px;height:84px;">','<div style="text-align:center;width:48px;height:48px;"><table width=100% height=100%><tr><td align=center valign = middle>{[this.formatFile(values)]}</td></tr></table></div>','<div class="x-editable" style="height:35px;padding-top:4px;text-align:center;overflow:hidden;text-overflow:ellipsis;" title="{DOCUMENTATION_TEXT}">{[values.DOCUMENTATION_TEXT.ellipsis(7)]}</div>',"</div>","</tpl>",{formatFile:function(e){var t=JE.getFileIcon(e.DOCUMENTATION_TEXT).color;return imgHtml='<i style="'+("font-size:35px; color:"+t)+'" class ="'+e.DOCUMENTATION_ICONCLS+'"></i>',imgHtml}}]),i.getStore().load()):"detailed"==t.code&&(i.hide(),a.show(),a.getStore().load())},getFileView:function(e){return"detailed"==e.viewType?e.down("gridpanel"):e.down("dataview")},getOrderSql:function(e){var t="";return"name"==e?t=" ORDER BY DOCUMENTATION_TEXT ASC":"size"==e?t=" ORDER BY DOCUMENTATION_SIZE ASC":"type"==e?t=" ORDER BY DOCUMENTATION_FILETYPE ASC":"uploadTime"==e&&(t=" ORDER BY SY_CREATETIME DESC"),t}}),Ext.define("JE.sys.email.util.Util",{statics:{runStatus:"standby",updateReceiveInfo:function(e){var t=this,i=JE.getLocalLang("sys.email.util.receiveMsg"),a=JE.toObj(e),n=Ext.getCmp("_emailprocesswin"),o="",r=a.title,l=0,s=100,d=1,c="",u="";if(-1!=r.indexOf("msg")){var p=JE.toObj(a.context);u=p.id,o=p.msg,d=1*r.substring(3)}else if("search"==r){p=JE.toObj(a.context);u=p.id,o=JE.format(i.search,p.lastDate,p.index,p.nowDate),l=p.index,s=p.count,d=2}else if("accept"==r){p=JE.toObj(a.context);u=p.id,l=p.success+p.failure,o=JE.format(i.accept,p.count,l+1,p.success,p.failure),JE.isEmpty(p.fileMsg)||(o+="<br/>"+p.fileMsg),s=p.count,d=3}else if("end"==r){p=JE.toObj(a.context);return u=p.id,o=p.msg,"front"==t.runStatus?n.close():"back"==t.runStatus&&t.updatePageMsg(""),void(t.runStatus="standby")}if(Ext.getCmp("_appcenterview").getCmp("emailMainView"))if(1==d?c=i.step1:2==d?c=i.step2:3==d&&(c=i.step3),"back"==t.runStatus){c=JE.format(i.back,d,c,d);t.updatePageMsg("<img style='float:left' src='/JE/data/upload/icon/qYeEqvJ1EQ4sS00Wczu.gif' /> &nbsp;&nbsp;&nbsp;"+i.back2)}else{t.runStatus="front",(n=n||JE.win({title:i.frontTitle,useButton:!1,id:"_emailprocesswin",autoShow:!0,width:480,height:150,maximizable:!1,closable:!1,layout:"column",items:[{columnWidth:1,height:40,name:"msg",padding:"1 5 1 5",xtype:"displayfield"},{columnWidth:1,name:"process",hideTrigger:!0,xtype:"barfield",padding:"1 5 1 5",configInfo:",1-99~orange,100-100~green"},{columnWidth:1,height:20,name:"step",padding:"1 5 1 5",xtype:"displayfield"},{columnWidth:.7,name:"zhan",padding:"1 5 1 5",xtype:"displayfield"},{xtype:"fieldcontainer",columnWidth:.3,layout:{type:"hbox",align:"stretch"},items:[{xtype:"button",text:i.frontBackButton,handler:function(e){t.runStatus="back",e.up("window").close()}},{xtype:"button",text:i.frontStopButton,margin:"0 0 0 5",handler:function(e){JE.ajax({url:JE.getUrlMaps("je.core.email","stopReceive"),params:{pkValue:u}}).success&&JE.msg(i.frontStopMsg),t.runStatus="back",e.up("window").close()}}]}]})).down("displayfield[name=msg]").setValue(o),n.down("barfield[name=process]").setValue(1*Ext.Number.toFixed(100*Ext.Number.toFixed(l/s,2),0)),n.down("displayfield[name=step]").setValue(JE.format(i.back,d,c,d))}},updatePageMsg:function(e){var t=Ext.getCmp("_appcenterview").getCmp("emailMainView");t&&t.getCmp("emaildata").getDockedCmp("pagingtoolbar").getCmp("infoMsg").update(e)}},receiveEmail:function(n){var o=JE.getLocalLang("sys.email.util.receiveEmail");if("back"!=JE.sys.email.util.Util.runStatus){var r=n.ownerCt.getCmp("emaildata").email;JE.isEmpty(r)?JE.alert(o.selectAlert):JE.ajax({url:JE.getUrlMaps("je.core.email","doReceive"),params:{pkValue:r.JE_SYS_EMAILCONFIG_ID},async:!0,timeout:18e5,success:function(e){var t=Ext.decode(Ext.value(e.responseText,"{}"));if(t.success){var i=n.getCmp("small").getDockedCmp("bar").getCmp(r.EMAILCONFIG_YXDZ);i.fireEvent("click",i),JE.msg(o.receiveSuccess)}else{var a=Ext.getCmp("_emailprocesswin");a&&a.close(),JE.alert(t.obj)}}})}else JE.alert(o.backAlert)},updateMsgBox:function(e,t){var i=e.ownerCt.getCmp("emaildata"),a=i.getDockedCmp("msgBox"),n=e.getCmp("big"),o=e.getCmp("small").getDockedCmp("bar"),r={},l={},s=JE.getLocalLang("sys.email.util.updateMsgBox");if(!t){if(!(t=n.getSelectionModel().getSelection()[0]))return void a.update({type:"receive",email:s,name:s,boxCount:0,readCount:0});JE.isNotEmpty(t.raw.email)&&(t=t.getChildAt(0))}if("menuitem"==t.xtype)l=t.ownerCt.ownerButton.email,r={type:t.itemId,email:l.EMAILCONFIG_YXDZ,name:l.EMAILCONFIG_ZHMC,boxType:t.text1,boxCount:0,iconCls:t.iconCls};else{var d=t.raw;l=t.parentNode.raw.email,r={type:d.itemId,email:l.EMAILCONFIG_YXDZ,name:l.EMAILCONFIG_ZHMC,boxType:d.text1,boxCount:0,iconCls:d.iconCls}}var c=JE.ajax({url:JE.getUrlMaps("je.core.email","getUnreadCount"),params:{pkValue:l.JE_SYS_EMAILCONFIG_ID}});if(c.success){var u,p,f=c.obj;n.getRootNode().eachChild(function(e){if(e.raw.itemId==r.email)return u=e,!1}),u.eachChild(function(e){var t=e.raw.text1,i=f[e.raw.itemId];0<i&&(t+=" ("+i+")"),e.set("text",t),e.commit()}),(p=o.getCmp(r.email)).setText("("+f.receive+")"),p.menu.items.each(function(e){var t=e.text1,i=f[e.itemId];0<i&&(t+=" ("+i+")"),e.setText(t)}),r.readCount=f[r.type],r.boxCount=f[r.type+"Count"]}(p=o.getCmp(r.email)).setTooltip(r.name),a.data=r,a.update(r),i.email=l,a.show()},updateEmailData:function(e,t){this.updateMsgBox(e,t);var i=e.ownerCt.getCmp("emaildata"),a=i.getDockedCmp("msgBox"),n=i.getDockedCmp("buttonBar"),o=a.data,r=Ext.value(i.email,{}),l={receive:["EMAILDATA_SJR"],send:["EMAILDATA_FJR"],drafts:[],mark:[],remove:[],rubbish:["EMAILDATA_SJR"]};Ext.each(i.columns,function(e){e.setVisible(-1==l[o.type].indexOf(e.dataIndex))});var s=" AND EMAILDATA_GSRID='"+JE.USER.userId+"' AND EMAILDATA_SSYX='"+r.EMAILCONFIG_YXDZ+"'";"mark"==o.type?s+=" AND EMAILDATA_BJXB='1' AND EMAILDATA_ZT != 'remove'":s+=" AND EMAILDATA_ZT='"+o.type+"'",s=t?s:" and 1!=1 ",i.getStore().basicSql=s,i.getStore().proxy.extraParams.whereSql=s,i.getStore().loadPage(1),i.searchField.reset(),n.getCmp("removeBtn").setVisible("remove"!=o.type),n.getCmp("removeAllBtn").setVisible("remove"==o.type);var d=n.getCmp("markBtn").menu.getCmp("receive");d.setVisible("rubbish"==o.type),d.previousSibling().setVisible("rubbish"==o.type),n.items.each(function(e){e.setDisabled(!t)})},searchEmailData:function(e,t,i,a){var n=e.getStore().basicSql;"mark"==t?n+=" and EMAILDATA_BJXB = '"+i+"'":"read"==t?n+=" and EMAILDATA_DQZT = '"+i+"'":"like"==t&&JE.isNotEmpty(i)&&(n+=" and ( EMAILDATA_SJR like '%"+i+"%' or EMAILDATA_FJR like '%"+i+"%' or EMAILDATA_BT like '%"+i+"%' or EMAILDATA_SJ like '%"+i+"%')"),a&&a.ownerCt.ownerButton.setIconCls(Ext.value(a.iconCls1,a.iconCls)),e.getStore().proxy.extraParams.whereSql=n,e.getStore().loadPage(1)},editEmail:function(e,t,l){var i={},a="",n=JE.getLocalLang("sys.email.util.editEmail");"add"==t?(i.xtype="email.emailedit",i.itemId="emailedit",i.rootId=e.ownerCt.emailAddressRoot,i.emailList=[],e.getCmp("big").getRootNode().eachChild(function(e){i.emailList.push({text:e.raw.email.EMAILCONFIG_ZHMC+" ("+e.raw.email.EMAILCONFIG_YXDZ+")",code:e.raw.email.EMAILCONFIG_YXDZ,id:e.raw.email.JE_SYS_EMAILCONFIG_ID})}),a=n.addTitle):"read"==t&&(i.xtype="email.emailread",a=n.readTitle),Ext.apply(i,{mainview:e.ownerCt,emailInfo:{data:l.data,email:l.email}}),JE.win({title:a,border:0,items:i,showFn:function(e){var r=e.getCmp("emailedit");if(r){var t={EMAILDATA_FJR:l.email.EMAILCONFIG_YXDZ,EMAILDATA_GSRID:JE.USER.userId};l.data&&(Ext.apply(t,l.data),JE.isNotEmpty(t.EMAILDATA_FJR)&&(t.EMAILDATA_FJS=JE.toObj(t.EMAILDATA_FJS)),JE.isEmpty(t.EMAILDATA_FJS)&&(t.EMAILDATA_FJR=l.email.EMAILCONFIG_YXDZ));var i=JE.ajax({url:JE.getUrlMaps("je.core.load"),params:{tableCode:"JE_SYS_EMAILSIGN",whereSql:" and JE_SYS_EMAILCONFIG_ID = '"+l.email.JE_SYS_EMAILCONFIG_ID+"'",limit:-1}}).rows,a=[],n={id:"",code:""};Ext.each(i,function(e,t){a.push({id:e.JE_SYS_EMAILSIGN_ID,code:e.EMAILSIGN_QM,text:e.EMAILSIGN_MC}),"1"==e.EMAILSIGN_MR&&(n=a[t])});var o=r.down("cbbfield[ref=qmField]");o.store.loadData(a),JE.isEmpty(t.JE_SYS_EMAILDATA_ID)?JE.isEmpty(t.EMAILDATA_ZW)?(r.form.setValues(t),o.setValue(n.id)):(t.EMAILDATA_ZW=Ext.htmlEncode("<p><p>")+n.code+t.EMAILDATA_ZW,o.setValue(n.id),r.form.setValues(t)):(o.setValue(n.id),r.form.setValues(t)),r.getCmp("fieldset").getCmp("box").getEl().select("a").each(function(e){var t=e.getAttribute("name"),i=e.getAttribute("text"),a=r.form.findField("EMAILDATA_"+t),n=JE.decode(Ext.value(a.getValue(),"[]")),o=!Ext.isEmpty(n);a.setVisible(o),a.setDisabled(o),e.dom.innerHTML=(a.isHidden()?JE.getLocalLang("sys.email.common.addText"):JE.getLocalLang("sys.email.common.deleteText"))+i})}}}).show()},addEmail:function(e,t){var i=e,a=t.EMAILCONFIG_ZHMC,n=t.EMAILCONFIG_YXDZ,o=JE.getLocalLang("sys.email.util.addEmail"),r=(t.EMAILCONFIG_ZHMC,[{text:o.inbox,text1:o.inbox,leaf:!0,iconCls:"jeicon jeicon-receiving",itemId:"receive"},{text:o.outbox,text1:o.outbox,leaf:!0,iconCls:"jeicon jeicon-shipping",itemId:"send"},{text:o.draftbox,text1:o.draftbox,leaf:!0,iconCls:"jeicon jeicon-draft-box",itemId:"drafts"},{text:o.tagemail,text1:o.tagemail,leaf:!0,iconCls:"jeicon jeicon-stars",itemId:"mark"},{text:o.spam,text1:o.spam,leaf:!0,iconCls:"jeicon jeicon-mail-delete",itemId:"rubbish"},{text:o.recycleBin,text1:o.recycleBin,leaf:!0,iconCls:"jeicon jeicon-trash-o",itemId:"remove"}]),l=n.substring(n.indexOf("@")).toLowerCase(),s=Ext.value(i.emailIcons[l],i.emailIcons.all),d={xtype:"splitbutton",iconCls:s,tooltip:a,tooltipType:"title",margin:"10 0 0 5",iconAlign:"top",iconStyle:"margin-left:7px;",textStyle:"padding:20px 0 0 0;",closable:!0,itemId:n,email:t,width:45,text:"(0)",menu:{items:Ext.clone(r)}};i.getCmp("small").getDockedCmp("bar").add(d);var c={text:a,itemId:n,type:"email",iconCls:s,email:t,children:Ext.clone(r)};c=i.getCmp("big").getRootNode().appendChild(c),i.updateMsgBox(i,c.getChildAt(0))},moveEmail:function(e,t){var i=e.getCmp("big"),a=e.getCmp("small").getDockedCmp("bar");if(root=i.getRootNode(),node=e.menu.editInfo.record,up=node.previousSibling,next=node.nextSibling,!("up"==t&&JE.isEmpty(up)||"down"==t&&JE.isEmpty(next))){if("up"==t){var n=up.get("index"),o=node.get("index");a.move(o,n),root.insertBefore(node,up)}else{var r=next.get("index");o=node.get("index");a.move(o,r),root.insertBefore(next,node)}var l=[];root.eachChild(function(e){l.push({JE_SYS_EMAILCONFIG_ID:e.raw.email.JE_SYS_EMAILCONFIG_ID,SY_ORDERINDEX:e.get("index")})}),JE.ajax({url:JE.getUrlMaps("je.core","updateList"),params:{strData:JE.encode(l),tableCode:"JE_SYS_EMAILCONFIG"}})}},emailConfig:function(r,l,s){var d=JE.getLocalLang("sys.email.util.emailConfig");JE.win({title:d.title,width:600,height:400,border:0,items:{xtype:"email.emailconfig",itemId:"form"},useButton:!0,showFn:function(e){var t=e.getCmp("form");JE.isNotEmpty(s)&&t.form.setValues(s.raw.email)},fn:function(e){var t=e.getCmp("form");if(!t.isValid())return!1;var i=t.form.getValues(),a=JE.getUrlMaps("je.core.email","doAddConfig"),n=i.EMAILCONFIG_MM;if("doUpdate"==l)a=JE.getUrlMaps("je.core.email","updateConfig"),s.raw.email.EMAILCONFIG_MM==n&&delete i.EMAILCONFIG_MM;else if("true"!=i.fjServer||"true"!=i.sjServer)return JE.alert(d.failureAlert),!1;delete i.fjServer,delete i.sjServer;var o=JE.ajax({url:a,params:i});o.success&&("doSave"==l?(JE.msg(JE.getLocalLang("sys.email.common.addSuccessAlert")),r.addEmail(r,o.obj)):(JE.msg(JE.getLocalLang("sys.email.common.updateSuccessAlert")),s.set("text",o.obj.EMAILCONFIG_ZHMC),o.obj.EMAILCONFIG_MM=Ext.value(o.obj.EMAILCONFIG_MM,n),s.raw.email=o.obj,s.commit(),r.updateMsgBox(r,s.getChildAt(0))))}}).show()},markEmail:function(e,t,i,a){var n={},o="",r=JE.getLocalLang("sys.email.util.markEmail");if("mark"==t?o="EMAILDATA_BJXB":"read"==t?o="EMAILDATA_DQZT":"receive"==t&&(o="EMAILDATA_ZT",i="receive"),a){var l={tableCode:"JE_SYS_EMAILDATA",whereSql:e.getStore().proxy.extraParams.whereSql};l[o]=i,n=JE.ajax({url:JE.getUrlMaps("je.core","listUpdate"),params:l})}else{var s=e.getSelectionModel().getSelection();if(JE.isEmpty(s))return void JE.alert(r.selectAlert);var d=[];Ext.each(s,function(e){var t={JE_SYS_EMAILDATA_ID:e.get("JE_SYS_EMAILDATA_ID")};t[o]=i,d.push(t)}),n=JE.ajax({url:JE.getUrlMaps("je.core","updateList"),params:{strData:JE.encode(d),tableCode:"JE_SYS_EMAILDATA"}})}n.success&&(JE.msg(r.successAlert),this.updateMsgBox(e.emailList),e.getStore().load())},fireEmailClick:function(e){var t=e.getCmp("big"),i=t.getSelectionModel().getSelection()[0];i&&t.fireEvent("itemclick",t.view,i)},disableEmail:function(e){var t=e.getSelectionModel().getSelection();if(JE.isEmpty(t))JE.alert(JE.getLocalLang("sys.email.util.removeEmailAlert"));else{var i=[];Ext.each(t,function(e){i.push({JE_SYS_EMAILDATA_ID:e.get("JE_SYS_EMAILDATA_ID"),EMAILDATA_ZT:"remove"})}),JE.ajax({url:JE.getUrlMaps("je.core","updateList"),params:{strData:JE.encode(i),tableCode:"JE_SYS_EMAILDATA"}}).success&&(JE.msg(JE.getLocalLang("sys.email.common.deleteSuccessAlert")),this.updateMsgBox(e.emailList),e.getStore().load())}},removeEmail:function(i,e){var a=this,n=i.getSelectionModel().getSelection();JE.isEmpty(n)?JE.alert(JE.getLocalLang("sys.email.util.removeEmailAlert")):JE.confirm(JE.getLocalLang("sys.email.common.deleteConfirm"),function(e){if("ok"==e){var t=[];Ext.each(n,function(e){t.push(e.get("JE_SYS_EMAILDATA_ID"))}),JE.ajax({url:JE.getUrlMaps("je.core","remove"),params:{ids:t.join(","),tableCode:"JE_SYS_EMAILDATA"}}).success&&(JE.msg(JE.getLocalLang("sys.email.common.deleteSuccessAlert")),a.updateMsgBox(i.emailList),i.getStore().load())}})},showAddress:function(e){JE.win({title:JE.getLocalLang("sys.email.common.addressBook"),iconCls:"jeicon jeicon-lxrgl-pc",border:0,width:875,height:600,items:{xtype:"email.emailaddress",rootId:e.emailAddressRoot}}).show()},addAddress:function(e){var t={EMAILUSERS_TEXT:e.text,EMAILUSERS_CODE:e.code},i=JE.getLocalLang("sys.email.emailAddress");if(0<JE.ajax({url:JE.getUrlMaps("je.core.load"),params:{tableCode:"JE_SYS_EMAILUSERS",whereSql:" and EMAILUSERS_USERID = '"+JE.USER.userId+"' and EMAILUSERS_CODE='"+e.code+"' and EMAILUSERS_LX = 'USER' ",limit:1}}).totalCount)JE.msg(i.existEmailAlert);else{var a=JE.ajax({url:JE.getUrlMaps("je.core.load"),params:{tableCode:"JE_SYS_EMAILUSERS",whereSql:" and EMAILUSERS_USERID = '"+JE.USER.userId+"' and EMAILUSERS_LX IN ('DEFAULT','GROUP')",limit:-1}}).rows,n=[];Ext.each(a,function(e){"ROOT"!=e.SY_NODETYPE&&(n.push({text:e.EMAILUSERS_TEXT,code:e.SY_PATH,id:e.JE_SYS_EMAILUSERS_ID}),"DEFAULT"==e.EMAILUSERS_LX&&(t.SY_PARENT=e.JE_SYS_EMAILUSERS_ID,t.SY_PATH=e.SY_PATH))}),JE.formWin({title:"Email",defaults:{labelWidth:60,columnWidth:1},items:[{xtype:"textfield",fieldLabel:i.column.name,allowBlank:!1,value:t.EMAILUSERS_TEXT,name:"EMAILUSERS_TEXT"},{xtype:"textfield",fieldLabel:"Email",vtype:"email",allowBlank:!1,value:t.EMAILUSERS_CODE,name:"EMAILUSERS_CODE"},{xtype:"cbbfield",fieldLabel:i.column.grouping,allowBlank:!1,dataArray:n,value:t.SY_PARENT,configInfo:",SY_PATH,code,",valueField:"id",name:"SY_PARENT"},{xtype:"textfield",fieldLabel:i.column.phone,name:"EMAILUSERS_DH"},{xtype:"textarea",fieldLabel:i.column.remark,height:100,name:"EMAILUSERS_BZ"},{xtype:"hidden",value:t.SY_PATH,name:"SY_PATH"}],fn:function(e,t){(e=Ext.apply(e,{tableCode:"JE_SYS_EMAILUSERS",EMAILUSERS_LX:"USER",EMAILUSERS_USERID:JE.USER.userId,SY_LAYER:1,SY_NODETYPE:"LEAF",SY_DISABLED:"0"})).SY_PATH+="/"+e.SY_PARENT,JE.ajax({url:JE.getUrlMaps("je.core.save"),params:e}).success&&JE.msg(JE.getLocalLang("sys.email.common.addSuccessAlert"))}})}},buildEmailZW:function(e){var a=Ext.clone(e),t=JE.getLocalLang("sys.email.common"),i=["<p><p>","<hr>",'<div style="background-color:rgb(239,239,239);padding:10px;">','<div style="padding-bottom:4px;"><b>'+t.addresser+"：</b>{EMAILDATA_FJR}</div>",'<div style="padding-bottom:4px;"><b>'+t.time+"：</b>{EMAILDATA_SJ}</div>",'<div style="padding-bottom:4px;"><b>'+t.subject+"：</b>{EMAILDATA_BT}</div>",'<div style="padding-bottom:4px;"><b>'+t.recipients+"：</b>{EMAILDATA_SJR}</div>","<div><b>"+t.carbonCopy+"：</b>{EMAILDATA_CS}</div>","</div>","<p><p>","<div>{EMAILDATA_ZW}</div>"];return Ext.each(["EMAILDATA_SJR","EMAILDATA_FJR","EMAILDATA_CS"],function(e){var t=JE.toObj(a[e]);if(null!=t){var i=[];Ext.each(t,function(e){i.push(e.code)}),a[e]=i.join(",")}}),JE.toXT(i.join(""),a)}}),Ext.define("JE.sys.email.view.EmailAddress",{extend:"Ext.panel.Panel",alias:"widget.email.emailaddress",layout:"border",border:0,initComponent:function(){var u=this;u.localLang=JE.getLocalLang("sys.email.emailAddress"),Ext.apply(u.localLang,JE.getLocalLang("sys.email.common"));var e={xtype:"treepanel",animate:!1,root:{id:"ROOT"},region:"west",useArrows:!0,rootVisible:!1,split:!0,minWidth:200,width:200,itemId:"tree",hideHeaders:!0,columns:[{xtype:"treecolumn",flex:1,dataIndex:"text",field:{xtype:"textfield"}},{xtype:"actioncolumn",width:20,items:[{handler:function(n,e,t,i,a,o,r){"ROOT"==o.raw.code?JE.prompt(u.localLang.groupAddAlert,function(e,t){if("ok"==e){u.getCmp("users").getCmp("address"),u.getCmp("tree");var i=o,a={tableCode:"JE_SYS_EMAILUSERS",EMAILUSERS_LX:"GROUP",EMAILUSERS_TEXT:t,EMAILUSERS_USERID:JE.USER.userId,SY_LAYER:0,SY_PATH:i.getPath().replaceAll("_"+i.raw.nodeInfo,"").replace("/ROOT",""),SY_PARENT:i.get("id").replaceAll("_"+i.raw.nodeInfo,""),SY_NODETYPE:"GENERAL",SY_DISABLED:"0"},n=JE.ajax({url:JE.getUrlMaps("je.core.save"),params:a});n.success&&(JE.msg(u.localLang.addSuccessAlert),i.appendChild({id:n.obj.JE_SYS_EMAILUSERS_ID+"_ADDRESS",text:t,nodeInfo:"ADDRESS",bean:n.obj,expandable:!1}))}},u.localLang.groupAddAlertTitle):JE.confirm(u.localLang.groupDeleteAlert,function(e){if("ok"==e){var t,i=o.raw.bean.JE_SYS_EMAILUSERS_ID,a=JE.ajax({url:JE.getUrlMaps("je.core.remove"),params:{ids:i,tableCode:"JE_SYS_EMAILUSERS"}});if(a.success)o.parentNode.eachChild(function(e){if("DEFAULT"==e.raw.bean.EMAILUSERS_LX)return t=e,!1}),a=JE.ajax({url:JE.getUrlMaps("je.core","listUpdate"),params:{tableCode:"JE_SYS_EMAILUSERS",SY_PATH:t.getPath().replaceAll("_"+t.raw.nodeInfo,"").replace("/ROOT",""),SY_PARENT:t.get("id").replaceAll("_"+t.raw.nodeInfo,""),whereSql:" and SY_PARENT = '"+i+"'"}}),n.panel.getSelectionModel().select(t),o.remove(),JE.msg(u.localLang.deleteSuccessAlert)}})},getClass:function(e,t,i,a,n,o){var r="je-grid-actioncolumn-itemhidden";return"ADDRESS"==i.raw.nodeInfo&&"GROUP"==i.raw.bean.EMAILUSERS_LX?r="jeicon jeicon-error":"ADDRESS"==i.raw.nodeInfo&&"ROOT"==i.raw.code&&(r="jeicon jeicon-resource-table-addition"),r}}]}],plugins:[Ext.create("Ext.grid.plugin.CellEditing",{pluginId:"cellEdit"})],listeners:{beforeedit:function(e,t){return"ADDRESS"==t.record.raw.nodeInfo&&"ROOT"!=t.record.raw.code},edit:function(e,t){var i=t.record.get("text"),a=t.record.raw.bean;i!=a.EMAILUSERS_TEXT&&JE.ajax({url:JE.getUrlMaps("je.core.update"),params:{EMAILUSERS_TEXT:i,JE_SYS_EMAILUSERS_ID:a.JE_SYS_EMAILUSERS_ID,tableCode:"JE_SYS_EMAILUSERS"}}).success&&(a.EMAILUSERS_TEXT=i,t.record.commit(),JE.msg(u.localLang.updateSuccessAlert))},selectionchange:function(e,t,i){var a=t[0];if(a){var n=a.raw,o="ADDRESS"==n.nodeInfo?"address":"users",r=u.getCmp("users").getCmp(o),l="";if(u.getCmp("users").getLayout().setActiveItem(r),"users"==o){l=" and STATUS = '1'  and SHADOW = '0'";var s=[];"ROOT"!=n.code&&a.cascadeBy(function(e){s.push(e.raw.code)}),0<s.length&&(l+="and  DEPTCODE in ('"+s.join("','")+"')")}else{l="and EMAILUSERS_USERID = '"+JE.USER.userId+"' and EMAILUSERS_LX = 'USER' ";var d=[];"ROOT"!=n.code&&a.cascadeBy(function(e){d.push(e.raw.id.replace("_"+n.nodeInfo,""))}),0<d.length&&(l+="and  SY_PARENT in ('"+d.join("','")+"')");var c="ROOT"==n.code?[]:["gridInsertBtn","gridUpdateBtn","gridRemoveBtn"];r.getDockedCmp("buttonBar").items.each(function(e){"button"==e.xtype&&e.setDisabled(-1==c.indexOf(e.ref))})}r.store.proxy.extraParams.basicSql=l,r.store.proxy.extraParams.whereSql=l,r.store.loadPage(1)}}}},t=u.buildUsersInfo4PT(),i=u.buildUsersInfo();u.items=[e,{xtype:"panel",region:"center",layout:"card",border:0,itemId:"users",items:[i,t]}],u.callParent(arguments)},afterRender:function(){this.loadTree(),this.callParent(arguments)},loadTree:function(){var e=[{ddCode:"JE_EMAIL_ADDRESS",ddName:this.localLang.addressBook,async:!1,whereSql:" AND EMAILUSERS_LX IN ('DEFAULT','GROUP') ",orderSql:" ORDER BY SY_CREATETIME",parentSql:" AND EMAILUSERS_USERID = '"+JE.USER.userId+"'",rootId:this.rootId,nodeInfo:"ADDRESS",moreRoot:!0},{ddCode:"JE_RBAC_DEPARTMENT",ddName:this.localLang.companyAddressBook,async:!1,whereSql:" ",orderSql:"",parentSql:"",rootId:"",nodeInfo:"DEPARTMENT"}],t=JE.ajax({url:JE.getUrlMaps("je.core.dd.tree","loadTree"),params:{node:"ROOT",onlyItem:!1,excludes:"checked",strData:Ext.encode(e)}}),i=this.getCmp("tree"),a=i.setRootNode({id:"ROOT",children:t});a.expandChildren(),a.getChildAt(1).eachChild(function(e){if("ADDRESS"==e.raw.nodeInfo&&"DEFAULT"==e.raw.bean.EMAILUSERS_LX)return i.getSelectionModel().select(e),!1})},buildUsersInfo:function(){var r=this,e=JE.getStore({tableName:"JE_SYS_EMAILUSERS",autoLoad:!1});return{xtype:"grid",region:"center",columnLines:!0,itemId:"address",cls:"jegrid",columns:{defaults:{tdCls:"je-grid-td-middle"},items:[{xtype:"rownumberer",text:"No.",width:30,align:"center",dataIndex:"rownumberer",tdCls:Ext.baseCSSPrefix+"grid-cell-row-numberer "+Ext.baseCSSPrefix+"grid-cell-special je-grid-td-middle"},{dataIndex:"EMAILUSERS_TEXT",width:100,xtype:"uxcolumn",enableEdit:!0,editField:{xtype:"textfield",allowBlank:!1},field:{xtype:"textfield",allowBlank:!1},text:r.localLang.column.name},{dataIndex:"EMAILUSERS_CODE",width:150,xtype:"uxcolumn",enableEdit:!0,editField:{xtype:"textfield",allowBlank:!1,vtype:"email"},field:{xtype:"textfield",allowBlank:!1},text:"Email"},{dataIndex:"EMAILUSERS_DH",width:150,xtype:"uxcolumn",enableEdit:!0,editField:{xtype:"textfield"},field:{xtype:"textfield"},text:r.localLang.column.phone},{dataIndex:"EMAILUSERS_BZ",width:200,xtype:"uxcolumn",enableEdit:!0,editField:{xtype:"textfield"},field:{xtype:"textfield"},text:r.localLang.column.remark}]},store:e,bbar:{xtype:"pagingtoolbar",itemId:"pagingtoolbar",store:e,displayInfo:!0},selModel:{selType:"checkboxmodel"},plugins:[Ext.create("Ext.grid.plugin.CellEditing",{clicksToEdit:1,pluginId:"cellEdit",beforeEdit:function(e){}})],tbar:{itemId:"buttonBar",items:[{text:r.localLang.addText,iconCls:"jeicon jeicon-new-form",ref:"gridInsertBtn",listeners:{click:function(e){if(!e.isDisabled()){var t=r.getCmp("users").getCmp("address"),i=r.getCmp("tree");if(t.isValid()){var a=t.getValues(),n=i.getSelectionModel().getSelection()[0];a=Ext.apply(a,{tableCode:"JE_SYS_EMAILUSERS",EMAILUSERS_LX:"USER",EMAILUSERS_USERID:JE.USER.userId,SY_LAYER:n.getDepth()-1,SY_PATH:n.getPath().replaceAll("_"+n.raw.nodeInfo,"").replace("/ROOT",""),SY_PARENT:n.get("id").replaceAll("_"+n.raw.nodeInfo,""),SY_NODETYPE:"LEAF",SY_DISABLED:"0"});var o=JE.ajax({url:JE.getUrlMaps("je.core.save"),params:a});o.success&&(JE.msg(r.localLang.addSuccessAlert),t.store.add(o.obj)),t.reset()}}}}},{text:r.localLang.updateText,iconCls:"jeicon jeicon-form-save",ref:"gridUpdateBtn",handler:function(e){var t=r.getCmp("users").getCmp("address").store,i="JE_SYS_EMAILUSERS_ID",a=t.getUpdatedRecords().concat(t.getNewRecords());if(Ext.isEmpty(a))JE.msg(r.localLang.noUpdateAlert);else{var n=[];Ext.each(a,function(e){var t=e.getChanges();Ext.Object.isEmpty(t)||(t[i]=e.data[i],n.push(t))});var o=JE.ajax({url:JE.getUrlMaps("je.core.updateList"),params:{strData:Ext.encode(n),tableCode:"JE_SYS_EMAILUSERS"}});o.success&&(JE.msg(o.obj),Ext.each(a,function(e){e.commit()}))}}},{text:r.localLang.deleteText,iconCls:"jeicon jeicon-delete-form",ref:"gridRemoveBtn",handler:function(e){var a=r.getCmp("users").getCmp("address"),n=a.getSelectionModel().getSelection();JE.isNotEmpty(n)&&JE.confirm(r.localLang.deleteConfirm,function(e){if("ok"==e){var t=[];Ext.each(n,function(e){t.push(e.get("JE_SYS_EMAILUSERS_ID"))});var i=JE.ajax({url:JE.getUrlMaps("je.core.remove"),params:{tableCode:"JE_SYS_EMAILUSERS",ids:t.join(",")}});i.success&&(a.store.load(),JE.msg(i.obj))}})}},"->",{xtype:"uxtrigger",handler:function(e){var t=e.getValue(),i=r.getCmp("users").getCmp("address"),a="";JE.isNotEmpty(t)&&(a=" and (EMAILUSERS_TEXT like '%"+t+"%' or EMAILUSERS_CODE like '%"+t+"%' or EMAILUSERS_DH like '%"+t+"%' or EMAILUSERS_BZ  like '%"+t+"%' )"),i.store.proxy.extraParams.whereSql=i.store.proxy.extraParams.basicSql+a,i.store.loadPage(1)}}]},getValues:function(){var t={},e=this.headerCt.query("[isFormField]");return Ext.each(e,function(e){t[e.name]=e.getValue()}),t},reset:function(){var e=this.headerCt.query("[isFormField]");Ext.each(e,function(e){e.reset()})},setValues:function(t){var e=this.headerCt.query("[isFormField]");Ext.each(e,function(e){t[e.name]&&e.setValue(t[e.name])})},isValid:function(){var t=!0,e=this.headerCt.query("[isFormField]");return Ext.each(e,function(e){if(!e.isValid())return t=!1}),t}}},buildUsersInfo4PT:function(){var n=this,e=JE.getStore({tableName:"JE_CORE_ENDUSER",autoLoad:!1,params:{orderSql:" ORDER BY DEPTORDERINDEX ASC ,USERORDER ASC"}});return{xtype:"grid",region:"center",columnLines:!0,itemId:"users",cls:"jegrid",columns:{defaults:{tdCls:"je-grid-td-middle"},items:[{xtype:"rownumberer",text:"No.",width:30,align:"center",dataIndex:"rownumberer",tdCls:Ext.baseCSSPrefix+"grid-cell-row-numberer "+Ext.baseCSSPrefix+"grid-cell-special je-grid-td-middle"},{dataIndex:"USERNAME",width:60,text:n.localLang.column.name},{dataIndex:"COMPANYEMAIL",width:150,text:"Email"},{dataIndex:"PHONE",width:150,text:n.localLang.column.phone},{dataIndex:"ZUOJI",width:150,text:n.localLang.column.telephone},{dataIndex:"DEPTNAME",width:60,text:n.localLang.column.department},{dataIndex:"EXECUTIVENAME",width:80,text:n.localLang.column.duty}]},store:e,bbar:{xtype:"pagingtoolbar",itemId:"pagingtoolbar",store:e,displayInfo:!0},tbar:["->",{xtype:"uxtrigger",handler:function(e){var t=e.getValue(),i=n.getCmp("users").getCmp("users"),a="";JE.isNotEmpty(t)&&(a=" and (USERNAME like '%"+t+"%' or COMPANYEMAIL like '%"+t+"%' or PHONE like '%"+t+"%' )"),i.store.proxy.extraParams.whereSql=i.store.proxy.extraParams.basicSql+a,i.store.loadPage(1)}}]}}}),Ext.define("JE.sys.email.view.EmailConfig",{extend:"Ext.form.Panel",alias:"widget.email.emailconfig",autoScroll:!0,layout:"column",bodyPadding:"10",initComponent:function(){var o=this;o.localLang=JE.getLocalLang("sys.email.emailConfig"),o.defaults={labelAlign:"right",columnWidth:1,labelWidth:80,margin:2,allowBlank:!1};JE.getDicItems("JE_CORE_MAILTYPE");o.items=[{xtype:"cbbfield",configInfo:"JE_CORE_MAILTYPE",editable:!0,name:"EMAILCONFIG_YXDZ",vtype:"email",listeners:{blur:function(e){if(!e.readOnly){var t=e.getValue(),i="",a="";if(JE.isNotEmpty(t)&&-1!=t.indexOf("@")){var n=t.substring(t.indexOf("@")+1).toLowerCase();"hotmail.com"==n&&(n="live.com"),i="pop."+n,a="smtp."+n}o.form.setValues({EMAILCONFIG_ZHMC:t,EMAILCONFIG_SJXY:i,EMAILCONFIG_FJXY:a})}}},fieldLabel:o.localLang.email},{xtype:"textfield",inputType:"password",name:"EMAILCONFIG_MM",fieldLabel:o.localLang.password},{xtype:"textfield",name:"EMAILCONFIG_ZHMC",fieldLabel:o.localLang.name},{xtype:"fieldcontainer",defaults:o.defaults,layout:{type:"hbox",align:"stretch",allowBlank:!1},items:[{xtype:"textfield",fieldLabel:"POP3",name:"EMAILCONFIG_SJXY",flex:1},{xtype:"textfield",labelWidth:40,fieldLabel:o.localLang.port,name:"EMAILCONFIG_SJDK",value:"995",width:90},{xtype:"button",text:o.localLang.test,handler:function(){var e=o.form.getValues();e.type="sj",delete e.fjServer,delete e.sjServer,JE.ajax({url:JE.getUrlMaps("je.core.email","testConfig"),params:e}).success?JE.msg(o.localLang.serverSuccess):JE.msg(o.localLang.serverFailure),o.form.findField("sjServer").setValue(!0)}}]},{xtype:"fieldcontainer",defaults:o.defaults,layout:{type:"hbox",align:"stretch"},items:[{xtype:"textfield",fieldLabel:"IMAP",name:"EMAILCONFIG_IMAPXY",flex:1,allowBlank:!0},{xtype:"textfield",labelWidth:40,fieldLabel:o.localLang.port,name:"EMAILCONFIG_IMAPDK",value:"995",width:90,allowBlank:!0},{xtype:"box",cellCls:"tableform-title",html:"<b>"+o.localLang.dustbin+"</b>"}]},{xtype:"fieldcontainer",defaults:o.defaults,layout:{type:"hbox",align:"stretch",allowBlank:!1},items:[{xtype:"textfield",fieldLabel:"SMTP",name:"EMAILCONFIG_FJXY",flex:1},{xtype:"textfield",labelWidth:40,fieldLabel:o.localLang.port,name:"EMAILCONFIG_FJDK",value:"25",width:90},{xtype:"button",text:o.localLang.test,handler:function(){var e=o.form.getValues();e.type="send",delete e.fjServer,delete e.sjServer,JE.ajax({url:JE.getUrlMaps("je.core.email","testConfig"),params:e}).success?JE.msg(o.localLang.serverSuccess):JE.msg(o.localLang.serverFailure),o.form.findField("fjServer").setValue(!0)}}]},{xtype:"hidden",name:"EMAILCONFIG_GSR",value:JE.USER.username},{xtype:"hidden",name:"EMAILCONFIG_GSR_ID",value:JE.USER.userId},{xtype:"hidden",name:"EMAILCONFIG_GSR_CODE",value:JE.USER.userCode},{xtype:"hidden",name:"JE_SYS_EMAILCONFIG_ID",allowBlank:!0,listeners:{change:function(e,t){var i=JE.isNotEmpty(t);o.form.findField("EMAILCONFIG_YXDZ").setReadOnly(i)}}},{xtype:"hidden",name:"tableCode",value:"JE_SYS_EMAILCONFIG"},{xtype:"hidden",name:"fjServer"},{xtype:"hidden",name:"sjServer"}],o.callParent(arguments)}}),Ext.define("JE.sys.email.view.EmailData",{extend:"Ext.grid.Panel",alias:"widget.email.emaildata",cls:"jegrid",autoScroll:!0,columnLines:!0,margin:"0 0 0 4",initComponent:function(){var o=this;o.localLang=JE.getLocalLang("sys.email.emailData"),o.emptyText="<div class=x-view-emtpytext >提示:单击右侧╋按钮增加新用户.</div>",Ext.apply(o.localLang,JE.getLocalLang("sys.email.common"));var e="JE_SYS_EMAILDATA";o.style="border-left-width:1px;border-left-style: solid;",o.store=Ext.create("Ext.data.Store",{pageSize:50,remoteSort:!0,model:JE.getModel({tableName:e}),autoLoad:!1,proxy:{type:"ajax",method:"POST",async:!0,url:JE.getUrlMaps("je.core.email","load"),extraParams:{tableCode:e,useOrderSql:1,whereSql:" and 1!=1 ",orderSql:" order by  EMAILDATA_SJ desc"},reader:{type:"json",root:"rows",totalProperty:"totalCount"},writer:{type:"json"}}}),o.relayEvents(o.store,["beforeload","load","loadrecords"]),o.bbar={xtype:"pagingtoolbar",itemId:"pagingtoolbar",store:o.store,items:[{xtype:"box",itemId:"infoMsg",margin:"0 4"}],displayInfo:!0},o.selModel={selType:"checkboxmodel"},o.columns={defaults:{tdCls:"je-grid-td-middle",sortable:!1,menuDisabled:!0},items:[{xtype:"rownumberer",text:"No.",width:45,align:"center",dataIndex:"rownumberer",tdCls:Ext.baseCSSPrefix+"grid-cell-row-numberer "+Ext.baseCSSPrefix+"grid-cell-special je-grid-td-middle"},{dataIndex:"EMAILDATA_DQZT",renderer:JE.renderer,tactics:[{bgCss:!0,dicCode:"JE_EXPRESS_READ",enableIcon:!0,type:"dic"}],width:50,text:o.localLang.read},{dataIndex:"EMAILDATA_FJR",width:200,text:o.localLang.addresser,renderer:function(e,t,i){var a=JE.toObj(e),n=[];return Ext.each(a,function(e){n.push(Ext.value(e.text,e.code))}),e=null==a?e:n.join(","),o.reandererQuery(e)}},{dataIndex:"EMAILDATA_SJR",width:200,text:o.localLang.recipients,hidden:!0,renderer:function(e,t,i){var a=JE.toObj(e),n=[];return Ext.each(a,function(e){n.push(Ext.value(e.text,e.code))}),e=o.reandererQuery(null==a?e:n.join(",")),"send"==i.get("EMAILDATA_ZT")&&(e=JE.getIconTpl("je-email-sendstate"+Ext.value(i.get("EMAILDATA_TDZT"),"2"))+e),e}},{dataIndex:"EMAILDATA_BT",flex:1,text:o.localLang.subject,renderer:function(e,t,i){return e=o.reandererQuery(e),"1"==i.get("EMAILDATA_YWFJ")&&(e=JE.getIconTpl("je-email-fileflag")+e),e}},{dataIndex:"EMAILDATA_SJ",width:200,text:o.localLang.time,renderer:function(e,t,i){return e=JE.DATE.humanityDate(JE.DATE.parseDateTime(e))}},{dataIndex:"EMAILDATA_BJXB",width:50,align:"center",xtype:"uxcheckcolumn",uncheckedCls:"je_config_unstart",checkedCls:"je_config_start",text:o.localLang.mark,listeners:{checkchange:function(e,t,i){var a=e.ownerCt.grid.getStore().getAt(t),n=e.ownerCt.grid.emailList;JE.ajax({url:JE.getUrlMaps("je.core.update"),params:{tableCode:"JE_SYS_EMAILDATA",JE_SYS_EMAILDATA_ID:a.get("JE_SYS_EMAILDATA_ID"),EMAILDATA_BJXB:i}}),a.commit(),n.updateMsgBox(n)}}}]},o.viewConfig={getRowClass:function(e,t,i,a){if("1"!=e.get("EMAILDATA_DQZT"))return"je-email-font-b"}},o.dockedItems=[{xtype:"box",itemId:"msgBox",cls:"x-panel-header-text-container-default je-emaildata-header",style:"background: #cbddf3;",tpl:['<div style="font-size:24px;float:left;margin:10px;">{name}</div>','<div style="margin:4px 0 0 10px;float:left;text-align:left;font-weight: normal;">','<span style="font-size:12px;color:#919191">{email}</span></br>','<tpl if="readCount &gt; 0">',JE.format(o.localLang.msgBoxTpl,'<span name="all" style="font-weight: bold;cursor: pointer;color:green;text-decoration: underline;">{boxCount}</span>','<span name="noread" style="font-weight: bold;cursor: pointer;color:green;text-decoration: underline;">{readCount}</span>'),'，<span name="allread" style="cursor: pointer;color:rgb(98, 15, 50);text-decoration: underline;">'+o.localLang.markAllRead+"</span>","<tpl else>",JE.format(o.localLang.msgBoxTpl,'<font color="green">{boxCount}</font>','<font color="green">{readCount}</font>'),"</tpl>",' - <span style="cursor: pointer;text-decoration: underline;"  name="txl">'+o.localLang.addressBook+"</span></div>"],listeners:{boxrefresh:function(i){var e=[{name:"all",fn:function(){o.emailList.searchEmailData(o,"all","")}},{name:"allread",fn:function(){o.emailList.markEmail(o,"read","1",!0)}},{name:"noread",fn:function(){o.emailList.searchEmailData(o,"read","0")}},{name:"txl",fn:function(){o.emailList.showAddress(o.ownerCt)}}];Ext.each(e,function(e){var t=i.getEl().down("span[name="+e.name+"]");t&&t.on("click",e.fn)})}},height:40},{xtype:"toolbar",dock:"top",itemId:"buttonBar",items:[{text:o.localLang.receive,iconCls:"jeicon jeicon-download-recently",handler:function(){o.emailList.receiveEmail(o.emailList)}},{text:o.localLang.tbar.write,iconCls:"jeicon jeicon-mail-editor",handler:function(){o.emailList.editEmail(o.emailList,"add",{title:"写邮件",email:o.email})}},"-",{text:o.localLang.tbar.remove,iconCls:"jeicon jeicon-error",itemId:"removeBtn",handler:function(){o.emailList.disableEmail(o)}},{text:o.localLang.tbar.del,iconCls:"jeicon jeicon-trash-o",itemId:"removeAllBtn",handler:function(){o.emailList.removeEmail(o)}},{text:o.localLang.transpond,iconCls:"jeicon jeicon-forward",handler:function(){var e=o.getSelectionModel().getSelection()[0];if(e){var t=o.emailList,i=o.email,a=e.data,n={EMAILDATA_BT:o.localLang.tbar.transpond+"："+a.EMAILDATA_BT,EMAILDATA_FJR:i.EMAILCONFIG_YXDZ,EMAILDATA_ZW:t.buildEmailZW(a)};t.editEmail(t,"add",{title:o.localLang.tbar.transpond,email:i,data:n})}else JE.alert(o.localLang.tbar.selectEmailAlert)}},{text:o.localLang.tbar.markedFor,iconCls:"jeicon jeicon-automatic-pen",itemId:"markBtn",menu:{items:[{text:o.localLang.tbar.read,iconCls:"jeicon jeicon-file-mail",handler:function(){o.emailList.markEmail(o,"read","1")}},{text:o.localLang.tbar.unRead,iconCls:"jeicon jeicon-mail",handler:function(){o.emailList.markEmail(o,"read","0")}},"-",{text:o.localLang.tbar.star,iconCls:"jeicon jeicon-stars",handler:function(){o.emailList.markEmail(o,"mark","1")}},{text:o.localLang.tbar.unStar,iconCls:"jeicon jeicon-stars-o",handler:function(){o.emailList.markEmail(o,"mark","0")}},{xtype:"menuseparator",hidden:!0},{text:o.localLang.tbar.inInbox,hidden:!0,itemId:"receive",iconCls:"jeicon jeicon-receiving",handler:function(){o.emailList.markEmail(o,"receive")}}]}},{xtype:"uxtrigger",width:240,itemId:"searchField",handler:function(e){o.emailList.searchEmailData(o,"like",e.getValue())}},"->",{text:o.localLang.tbar.files,ref:"emailfileBtn",iconCls:"jeicon jeicon-folder"}]}],o.callParent(arguments),o.searchField=o.getDockedCmp("buttonBar").getCmp("searchField")},afterRender:function(){this.callParent(arguments),this.emailList=this.ownerCt.getCmp("emaillist")},reandererQuery:function(e){var t=this.searchField.getValue();return JE.isNotEmpty(e)&&JE.isNotEmpty(t)&&(t==(e=e.replaceAll(t,"<font color='red'>"+t+"</font>"))&&(e=e.replaceAll(t.toUpperCase(),"<font color='red'>"+t.toUpperCase()+"</font>")),t==e&&(e=e.replaceAll(t.toLowerCase(),"<font color='red'>"+t.toLowerCase()+"</font>"))),e}}),Ext.define("JE.sys.email.view.EmailList",{extend:"Ext.panel.Panel",alias:"widget.email.emaillist",layout:{type:"hbox",align:"stretch"},mixins:["JE.sys.email.util.Util"],initComponent:function(){var e=this;e.localLang=JE.getLocalLang("sys.email.emailList"),Ext.apply(e.localLang,JE.getLocalLang("sys.email.common")),e.bulidMenu(),e.buildEmailList(),e.callParent(),e.smallList=e.getCmp("small"),e.bigList=e.getCmp("big"),e.bodyStyle="border-right-width:1px !important;"},buildEmailList:function(){var e=this,t=JE.getDicItems("JE_CORE_MAILTYPE"),i={all:"email_emailcom"};Ext.each(t,function(e){i[e.text]=e.iconCls}),e.emailIcons=i;var a={xtype:"panel",width:54,lbar:{xtype:"toolbar",itemId:"bar",items:[],cls:"je-email-tbar",border:0,style:"border-top:1px solid #99bce8 !important;"},itemId:"small",hidden:!0,tools:[{type:"right",handler:function(){e.smallList.hide(),e.bigList.show(),e.setWidth(170)}},{type:"plus"}]},n={xtype:"treepanel",flex:1,root:{id:"",children:[]},title:e.localLang.title,menu:e.menu,hideHeaders:!0,animate:!1,columns:[{xtype:"treecolumn",flex:1,dataIndex:"text",field:{xtype:"textfield"}}],plugins:[Ext.create("Ext.grid.plugin.CellEditing",{pluginId:"cellEdit"})],rootVisible:!1,useArrows:!0,itemId:"big",tools:[{type:"left",handler:function(){e.smallList.show(),e.bigList.hide(),e.setWidth(54)}},{type:"collapse",handler:function(){e.getCmp("big").getRootNode().collapseChildren()}},{type:"plus"}]};e.defaults={border:0},e.minWidth=54,e.width=170,e.items=[a,n]},bulidMenu:function(){var n=this;n.menu=Ext.create("Ext.menu.Menu",{width:100,margin:"0 0 10 0",items:[{text:n.localLang.receive,itemId:"receive",iconCls:"jeicon jeicon-download-recently",handler:function(e){n.receiveEmail(n)}},"-",{text:n.localLang.emptyTrash,itemId:"remove",iconCls:"jeicon jeicon-trash-o",handler:function(e){JE.confirm(n.localLang.deleteConfirm,function(e){if("ok"==e){var t=n.menu.editInfo.record;"email"!=t.raw.type&&(t=t.parentNode);var i=t.raw.email,a=" AND EMAILDATA_GSRID='"+JE.USER.userId+"' AND EMAILDATA_SSYX='"+i.EMAILCONFIG_YXDZ+"' AND JE_SYS_EMAILCONFIG_ID = '"+i.JE_SYS_EMAILCONFIG_ID+"' AND EMAILDATA_ZT='remove'";JE.ajax({url:JE.getUrlMaps("je.core.dbsql","removeBySql"),params:{tableCode:"JE_SYS_EMAILDATA",whereSql:a}}).success&&JE.msg(n.localLang.emptySuccessAlert)}})}},"-",{text:n.localLang.rename,itemId:"rename",handler:function(e){var t=n.menu.editInfo;t.tree.getPlugin("cellEdit").startEdit(t.record,t.index)}},{text:n.localLang.removeEmail,itemId:"removeEmail",handler:function(e){JE.confirm(n.localLang.deleteConfirm,function(e){if("ok"==e){var t=n.menu.editInfo,i=t.record,a=t.tree;JE.ajax({url:JE.getUrlMaps("je.core.remove"),params:{tableCode:"JE_SYS_EMAILCONFIG",ids:i.raw.email.JE_SYS_EMAILCONFIG_ID}}).success&&(n.getCmp("small").getDockedCmp("bar").remove(i.raw.email.EMAILCONFIG_YXDZ),i.remove(),(i=a.getRootNode().getChildAt(0))&&(a.expandNode(i,!0),a.getSelectionModel().select(i)),a.fireEvent("itemclick",a.view,i),JE.msg(n.localLang.deleteSuccessAlert))}})}},"-",{text:n.localLang.config,itemId:"config",iconCls:"jeicon jeicon-set-up",handler:function(){var e=n.menu.editInfo.record;"email"!=e.raw.type&&(e=e.parentNode),n.emailConfig(n,"doUpdate",e)}},{text:n.localLang.signature,itemId:"sign",handler:function(){var e=n.menu.editInfo.record;"email"!=e.raw.type&&(e=e.parentNode),JE.win({title:n.localLang.sign,width:800,height:400,items:{xtype:"email.emailsign",email:e.raw.email}}).show()}},{text:n.localLang.collapse,itemId:"shouqi",handler:function(){n.menu.editInfo.tree.getRootNode().collapseChildren()}},"-",{text:n.localLang.up,itemId:"up",iconCls:"jeicon jeicon-arrow-up",handler:function(){n.moveEmail(n,"up")}},{text:n.localLang.down,itemId:"down",iconCls:"jeicon jeicon-arrow-down",handler:function(){n.moveEmail(n,"down")}}]})}}),Ext.define("JE.sys.email.view.EmailSign",{extend:"Ext.panel.Panel",alias:"widget.email.emailsign",layout:"border",border:0,initComponent:function(){this.localLang=JE.getLocalLang("sys.email.emailSign"),Ext.apply(this.localLang,JE.getLocalLang("sys.email.common")),this.items=[this.buildList(),this.buildForm()],this.callParent(arguments)},afterRender:function(){this.callParent(arguments)},buildList:function(){var n=this,e=JE.getStore({tableName:"JE_SYS_EMAILSIGN",autoLoad:!0,params:{whereSql:" AND JE_SYS_EMAILCONFIG_ID = '"+n.email.JE_SYS_EMAILCONFIG_ID+"'",orderSql:" order by sy_createtime",limit:-1}});return{xtype:"grid",region:"west",columnLines:!0,itemId:"grid",border:0,cls:"jegrid",split:!0,listeners:{selectionchange:function(e,t){0<t.length?n.getCmp("form").form.setValues(t[0].data):n.getCmp("form").form.reset()}},columns:{defaults:{tdCls:"je-grid-td-middle",sortable:!1,menuDisabled:!0},items:[{dataIndex:"EMAILSIGN_MC",flex:1,text:n.localLang.name,renderer:function(e,t,i){return"1"==i.get("EMAILSIGN_MR")&&(e='<span style="font-weight: bold;color:red;" >'+e+"</span>"),e}},{text:'<div class="jeicon jeicon-resource-table-addition" title="'+n.localLang.addText+'" style="width:16px;height:16px;"></div>',resizable:!1,xtype:"actioncolumn",width:30,align:"center",items:[{iconCls:"jeicon jeicon-error",handler:function(e,t,i){var a=e.getStore().getAt(t);JE.ajax({url:JE.getUrlMaps("je.core.remove"),params:{tableCode:"JE_SYS_EMAILSIGN",ids:a.get("JE_SYS_EMAILSIGN_ID")}}).success&&(JE.msg(n.localLang.deleteSuccessAlert),e.getStore().removeAt(t))}}],listeners:{headerclick:function(e,t){n.doSaveAction({EMAILSIGN_SYYX:n.email.EMAILCONFIG_YXDZ,JE_SYS_EMAILCONFIG_ID:n.email.JE_SYS_EMAILCONFIG_ID,EMAILSIGN_SSYHID:JE.USER.userId,EMAILSIGN_MR:"0"})}}}]},width:200,store:e}},buildForm:function(){var o=this;return{xtype:"form",itemId:"form",layout:{type:"vbox",align:"center"},border:0,bodyPadding:4,region:"center",defaults:{width:"100%",labelAlign:"right",labelWidth:60,margin:1,xtype:"hidden"},items:[{fieldLabel:o.localLang.name,xtype:"textfield",name:"EMAILSIGN_MC"},{fieldLabel:o.localLang.signature,xtype:"ueditor",flex:1,simpleToolbar:!0,name:"EMAILSIGN_QM"},{xtype:"panel",border:0,itemId:"buttonBox",layout:{type:"hbox",align:"stretch"},items:[{xtype:"box",flex:1},{xtype:"button",text:o.localLang.addText,width:100,itemId:"save",handler:function(){var e=o.getCmp("form").form.getValues();o.doSaveAction(e)}},{xtype:"button",margin:"0 0 0 10",text:o.localLang.setDefault,itemId:"mr",disabled:!0,width:100,handler:function(){var t=o.getCmp("form").form.getValues();t.EMAILSIGN_MR="1";var i=[t];o.getCmp("grid").getStore().each(function(e){e.data.JE_SYS_EMAILSIGN_ID!=t.JE_SYS_EMAILSIGN_ID?(i.push({JE_SYS_EMAILSIGN_ID:e.data.JE_SYS_EMAILSIGN_ID,EMAILSIGN_MR:"0"}),e.set("EMAILSIGN_MR","0")):e.set(t),e.commit()}),JE.ajax({url:JE.getUrlMaps("je.core.updateList"),params:{strData:Ext.encode(i),tableCode:"JE_SYS_EMAILSIGN"}}).success&&JE.msg(o.localLang.updateAlert)}},{xtype:"box",flex:1}]},{name:"JE_SYS_EMAILSIGN_ID",listeners:{change:function(e,t,i){var a=o.getCmp("form").getCmp("buttonBox").getCmp("mr"),n=o.getCmp("form").getCmp("buttonBox").getCmp("save");a.setDisabled(Ext.isEmpty(t)),n.setText(Ext.isEmpty(t)?o.localLang.addText:o.localLang.updateText)}}}]}},doSaveAction:function(e){e.tableCode="JE_SYS_EMAILSIGN";var t=JE.isEmpty(e.JE_SYS_EMAILSIGN_ID),i=t?"doSave":"doUpdate",a=t?this.localLang.addSuccessAlert:this.localLang.updateSuccessAlert,n=JE.ajax({url:JE.getUrlMaps("je.core",i),params:e});if(n.success){JE.msg(a);var o=this.getCmp("grid");if(t){var r=o.getStore().add(n.obj)[0];o.getSelectionModel().select(r)}else{(r=o.getSelectionModel().getSelection()[0]).set(n.obj),r.commit()}}}}),Ext.define("JE.sys.email.view.file.CenterView",{extend:"Ext.panel.Panel",border:0,alias:"widget.email.filecenterview",bodyPadding:"1 0 0 0",layout:"fit",frame:!1,initComponent:function(){this.items={xtype:"email.filedataview"},this.callParent()}}),Ext.define("JE.sys.email.view.file.FileDataView",{extend:"Ext.panel.Panel",alias:"widget.email.filedataview",layout:"fit",viewType:"thumbnail",orderType:"uploadTime",modeType:"FILE",border:0,readOnly:!1,initComponent:function(){var e=this;e.localLang=JE.getLocalLang("sys.email.file.fileData"),Ext.apply(e.localLang,JE.getLocalLang("sys.email.file.treeMenu"));var t=JE.getStore({tableName:"JE_SYS_EMAILSELECT",pageSize:100,action:JE.getUrlMaps("je.core.doc.file"),id:"JE_SYS_DOCUMENTATION_ID",params:{orderSql:" ORDER BY SY_CREATETIME DESC",baseSql:" AND EMAILDATA_GSRID='"+JE.currentUser.userId+"'",nodeSql:"",querySql:""},autoLoad:!0}),i=Ext.id();Ext.id();e.items=[{xtype:"dataview",autoScroll:!0,id:i,tpl:['<tpl for=".">','<DIV class=table-files style="border: 1px solid #fff;table-layout:fixed;word-wrap:break-word;float:left;margin:9px;width:104px;height:133px;">','<div style="text-align:center;width:96px;height:96px;"><table width=100% height=100%><tr><td align=center valign = middle>{DOCUMENTATION_THUMBNAILCLS}</td></tr></table></div>','<div class="x-editable" style="height:36px;padding-top:4px;text-align:center;overflow:hidden;text-overflow:ellipsis;" title="{DOCUMENTATION_TEXT}">{[values.DOCUMENTATION_TEXT.ellipsis(14)]}</div>',"</div>","</tpl>"],plugins:[Ext.create("JE.sys.documentation.drag.DragSelector",{})],multiSelect:!0,overItemCls:"x-dataview-item-over",trackOver:!0,selectedItemCls:"x-dataview-item-selected",itemSelector:"div.table-files",emptyText:"",store:t,queryMenu:Ext.create("JE.sys.email.view.file.TreeMenu",{fileDataView:e,type:"node"})},{xtype:"gridpanel",hidden:!0,cls:"jegrid",border:0,multiSelect:!0,autoScroll:!0,columnLines:!0,animCollapse:!1,columns:[{text:e.localLang.name,dataIndex:"DOCUMENTATION_TEXT",width:200,renderer:function(e,t,i,a,n,o,r,l,s){return"<input type='button' class='"+i.get("DOCUMENTATION_ICONCLS")+" je-button-icon'/>"+e}},{text:e.localLang.title,dataIndex:"EMAILDATA_BT",width:200},{text:JE.getLocalLang("sys.email.common.addresser"),dataIndex:"EMAILDATA_FJR",width:130,renderer:function(e,t,i,a,n,o,r,l,s){var d=JE.toObj(Ext.value(e,"[]")),c=new Array;return Ext.each(d,function(e){c.push(e.code)}),c.join(",")}},{text:JE.getLocalLang("sys.email.common.recipients"),dataIndex:"EMAILDATA_SJR",width:200,renderer:function(e,t,i,a,n,o,r,l,s){var d=JE.toObj(Ext.value(e,"[]")),c=new Array;return Ext.each(d,function(e){c.push(e.code)}),c.join(",")}},{text:e.localLang.uploadTime,dataIndex:"SY_CREATETIME",width:140},{text:e.localLang.type,dataIndex:"DOCUMENTATION_FILETYPENAME",width:100},{text:e.localLang.size,dataIndex:"DOCUMENTATION_SIZE",width:100,renderer:function(e,t,i,a,n,o,r,l,s){var d=1*Ext.value(e,0);return Math.ceil(d/1e3)+" KB"}},{text:e.localLang.remark,dataIndex:"DOCUMENTATION_REMARK",width:300}],store:t,queryMenu:Ext.create("JE.sys.email.view.file.TreeMenu",{fileDataView:e,type:"node"})}],e.queryMenu=Ext.create("JE.sys.email.view.file.TreeMenu",{fileDataView:e,type:"panel"}),e.tbar=[{ref:"view",text:e.localLang.view,iconCls:"jeicon jeicon-view",menu:[{text:e.localLang.thumbnail,code:"thumbnail",iconCls:"jeicon jeicon-check"},{text:e.localLang.icon,code:"icon"},{text:e.localLang.detail,code:"detailed"}]},{ref:"order",text:e.localLang.order,iconCls:"jeicon jeicon-sorting",menu:[{text:e.localLang.name,code:"name"},{text:e.localLang.size,code:"size"},{text:e.localLang.type,code:"type"},{text:e.localLang.uploadTime,iconCls:"jeicon jeicon-check",code:"uploadTime"}]},{ref:"oper",text:e.localLang.operation,iconCls:"jeicon jeicon-system-management",menu:[{text:e.localLang.open,iconCls:"jeicon jeicon-check",code:"openFile"},{text:e.localLang.download,iconCls:"jeicon jeicon-download-recently",code:"downloadFile"},{text:e.localLang.packDownload,iconCls:"jeicon jeicon-compress-static",code:"packageDownload"},"-",{text:e.localLang.attribute,iconCls:"jeicon jeicon-set-up",code:"attribute"}]}],e.tbar.push("->"),e.tbar.push({xtype:"qqfield",labelStyle:"cursor: pointer;color:blue;text-decoration: underline;font-family: arial;",labelWidth:32,name:"quickquery",labelSeparator:"",queryFields:[{name:"FILE_NAME"}]}),e.tbar.push({text:e.localLang.returns,ref:"emailDataBtn",iconCls:"jeicon jeicon-folder"}),e.dockedItems=[{xtype:"pagingtoolbar",store:t,dock:"bottom",displayInfo:!0}],this.callParent()}}),Ext.define("JE.sys.email.view.file.QueryFormView",{extend:"Ext.form.Panel",alias:"widget.email.filequeryformview",layout:"column",border:0,width:200,autoScroll:!0,defaults:{xtype:"fieldset",labelAlign:"right",margin:"5 0 0 0 ",layout:"column",collapsible:!1,columnWidth:1,defaults:{xtype:"textfield",labelAlign:"right",margin:"5 0 8 0",labelWidth:40,columnWidth:1}},initComponent:function(){var e=this;e.localLang=JE.getLocalLang("sys.email.file.queryForm"),e.title=e.localLang.title;e.ddCode;e.items=[{title:e.localLang.fileTitle,style:"background: aliceblue;",margin:"4",minHeight:84,minWidth:183,items:[{labelWidth:60,fieldLabel:e.localLang.fileName,name:"JE_SYS_FILENAME"},{labelWidth:60,xtype:"treessfield",fieldLabel:e.localLang.email,name:"JE_SYS_PATH",whereSql:" AND EMAILCONFIG_GSR_ID='"+JE.currentUser.userId+"'",configInfo:"JE_SYS_EMAILCONFIG,JE_SYS_PATH~JE_SYS_DIRID,text~id"},{labelWidth:60,xtype:"hidden",name:"JE_SYS_DIRID"}]},{title:e.localLang.formatTitle,margin:"4",style:"background: aliceblue;",minHeight:186,minWidth:183,items:[{xtype:"cgroup",columns:2,configInfo:"JE_DOCUMENTATION_FILETYPE",name:"JE_SYS_FILETYPE"},{fieldLabel:e.localLang.appoint,name:"JE_SYS_DIYTYPE"}]},{title:e.localLang.sizeTitle,margin:"4",style:"background: aliceblue;",minHeight:136,minWidth:183,items:[{xtype:"rgroup",columns:2,configInfo:"JE_DOCUMENTATION_FILESIZE",name:"JE_SYS_FILESIZE",value:"all"},{xtype:"numberfield",fieldLabel:e.localLang.appoint,hideTrigger:!0,name:"JE_SYS_DIYSTARTSIZE",columnWidth:.45},{xtype:"box",cellCls:"tableform-title",colspan:2,margin:"10 0 0 5",html:"M",columnWidth:.05},{labelWidth:25,xtype:"numberfield",fieldLabel:e.localLang.to,hideTrigger:!0,labelSeparator:"",name:"JE_SYS_DIYENDSIZE",columnWidth:.42},{xtype:"box",cellCls:"tableform-title",colspan:2,margin:"10 0 0 5",html:"M",columnWidth:.05}]},{title:e.localLang.uploadTitle,margin:"4",style:"background: aliceblue;",minHeight:126,minWidth:183,items:[{xtype:"rgroup",columns:2,configInfo:"JE_DOCUMENTATION_MODFIYTIME",name:"JE_SYS_MODFIYDATE",value:"all"},{xtype:"datetimefield",dateType:"date",fieldLabel:e.localLang.appoint,format:e.localLang.timeFormat,name:"JE_SYS_DIYDATE"}]}],e.buttons=[{text:e.localLang.queryText,ref:"okQuery",iconCls:"jeicon jeicon-check"},{text:e.localLang.resetText,ref:"resetQuery",iconCls:"jeicon jeicon-error"}],e.buttonAlign="center",this.callParent()}}),Ext.define("JE.sys.email.view.file.TreeMenu",{extend:"Ext.menu.Menu",alias:"widget.email.filetreemenu",defaultAlign:"br-tr",frame:!1,border:1,initComponent:function(){var e=this;e.localLang=JE.getLocalLang("sys.email.file.treeMenu");var t=[];t="panel"==e.type?[{text:e.localLang.checkAll,code:"selectAll",iconCls:"jeicon jeicon-check-circle"},{text:e.localLang.refresh,iconCls:"jeicon jeicon-refresh",code:"refresh"}]:[{text:e.localLang.open,iconCls:"jeicon jeicon-check",code:"openFile"},{text:e.localLang.download,iconCls:"jeicon jeicon-download-recently",code:"downloadFile"},{text:e.localLang.packageDownLoad,iconCls:"jeicon jeicon-compress-static",code:"packageDownload"},{text:e.localLang.saveFile,iconCls:"jeicon jeicon-database-cycle",code:"saveFile"},"-",{text:e.localLang.attribute,iconCls:"jeicon jeicon-set-up",code:"attribute"}],e.items=t,this.callParent()}}),Ext.define("JE.sys.email.view.file.WestView",{extend:"Ext.panel.Panel",alias:"widget.email.filewestview",layout:{type:"hbox",align:"stretch"},mixins:["JE.sys.email.util.Util"],initComponent:function(){this.items=[{xtype:"email.filequeryformview"}],this.callParent(),this.bodyStyle="border-right:1px solid #99bce8 !important;"}}),Ext.define("JE.sys.email.view.MainView",{extend:"Ext.panel.Panel",alias:"widget.email.mainview",layout:"border",cls:"je-emailmainview",initComponent:function(){this.itemId="emailMainView",JE.isEmpty(this.emailAddressRoot)&&(this.emailAddressRoot=JE.ajax({url:JE.getUrlMaps("je.core.email","loadUserRoot"),params:{pkValue:JE.USER.userId}}).obj.rootId),this.defaults={border:0},this.items=[{xtype:"email.emaillist",itemId:"emaillist",region:"west"},{xtype:"email.filewestview",itemId:"emailfilewestview",region:"west",hidden:!0},{xtype:"email.emaildata",itemId:"emaildata",region:"center"},{xtype:"email.filecenterview",itemId:"emailfile",region:"center",hidden:!0}],this.callParent()}}),Ext.define("JE.sys.email.controller.EmailMainCtr",{extend:"Ext.app.Controller",mixins:{docUtil:"JE.sys.email.util.EmailFileUtil"},init:function(){var s=this,e={"panel[xtype=email.emaillist]":{afterrender:function(i){var e=JE.ajax({url:JE.getUrlMaps("je.core.load"),params:{tableCode:"JE_SYS_EMAILCONFIG",whereSql:" and EMAILCONFIG_GSR_ID = '"+JE.USER.userId+"'",orderSql:" order by SY_ORDERINDEX",limit:-1}});Ext.each(e.rows,function(e,t){i.addEmail(i,e)}),Ext.defer(function(){var e=i.getCmp("big"),t=e.getRootNode().getChildAt(0);t&&(e.expandNode(t,!0),e.getSelectionModel().select(t)),e.fireEvent("itemclick",e.view,t)},500)}},"panel[xtype=email.emaillist] treepanel":{containercontextmenu:function(e,t,i){t.stopEvent()},itemcontextmenu:function(e,t,i,a,n,o){n.stopEvent();var r=e.panel;r.menu.editInfo={tree:r,record:t,index:a};var l="receive"==t.raw.itemId||"email"==t.raw.type,s=r.menu.getCmp("receive");s.setVisible(l),s.nextSibling().setVisible(l);var d="remove"==t.raw.itemId||"email"==t.raw.type;(u=r.menu.getCmp("remove")).setVisible(d),u.nextSibling().setVisible(d);var c="email"==t.raw.type,u=r.menu.getCmp("removeEmail"),p=r.menu.getCmp("rename");up=r.menu.getCmp("up"),down=r.menu.getCmp("down"),u.setVisible(c),p.setVisible(c),u.nextSibling().setVisible(c),down.setVisible(c),up.setVisible(c),up.previousSibling().setVisible(c),r.menu.showAt(n.getXY())},itemclick:function(e,t,i,a,n,o){var r=e.panel;if(JE.isEmpty(t)||JE.isEmpty(t.raw.email)){var l=e.up("panel[xtype=email.emaillist]");l.updateEmailData(l,t)}else{var s=t.getChildAt(0);r.fireEvent("itemclick",e,s)}},beforeedit:function(e,t){return"email"==t.record.raw.type},edit:function(e,t,i){var a=t.record,n=a.raw,o=a.get("text");if(o!=n.text&&(n.email.EMAILCONFIG_ZHMC=o,a.commit(),JE.ajax({url:JE.getUrlMaps("je.core.update"),params:{tableCode:"JE_SYS_EMAILCONFIG",JE_SYS_EMAILCONFIG_ID:n.email.JE_SYS_EMAILCONFIG_ID,EMAILCONFIG_ZHMC:o}}).success)){JE.msg("OK");var r=t.grid.ownerCt;r.updateMsgBox(r,a.getChildAt(0))}}},"panel[xtype=email.emaillist] panel[itemId=small] toolbar button":{click:function(e){var t=e.menu.getCmp("receive");t.fireEvent("click",t)}},"panel[xtype=email.emaillist] panel[itemId=small] toolbar button menu menuitem":{click:function(e){var t=e.up("panel[xtype=email.emaillist]");t.updateEmailData(t,e)}},"panel[xtype=email.emaillist] tool[type=plus]":{click:function(e){var t=e.up("panel[xtype=email.emaillist]");t.emailConfig(t,"doSave")}},"grid[xtype=email.emaildata]":{itemdblclick:function(e,t){var i=e.panel.ownerCt.getCmp("emaillist"),a=JE.ajax({url:JE.getUrlMaps("je.core.getInfoById"),params:{tableCode:"JE_SYS_EMAILDATA",pkValue:t.get("JE_SYS_EMAILDATA_ID")}}),n=Ext.clone(t.data);n.EMAILDATA_ZW=a.EMAILDATA_ZW,"drafts"==n.EMAILDATA_ZT?i.editEmail(i,"add",{data:n,email:e.panel.email}):i.editEmail(i,"read",{data:n,email:e.panel.email}),"1"!=t.get("EMAILDATA_YHZ")&&"1"==t.get("EMAILDATA_SFHZ")&&"receive"==t.get("EMAILDATA_ZT")&&(a.tableCode="JE_SYS_EMAILDATA",JE.ajax({url:JE.getUrlMaps("je.core.email","doReply"),params:a}),t.set("EMAILDATA_YHZ","1"),t.commit()),"1"!=t.get("EMAILDATA_DQZT")&&(JE.ajax({url:JE.getUrlMaps("je.core.update"),params:{tableCode:"JE_SYS_EMAILDATA",JE_SYS_EMAILDATA_ID:t.get("JE_SYS_EMAILDATA_ID"),EMAILDATA_DQZT:"1"}}),t.set("EMAILDATA_DQZT","1"),t.commit(),i.updateMsgBox(i))}},"grid[xtype=email.emaildata] button[ref=emailfileBtn]":{click:function(e){var t=e.up("panel[xtype=email.mainview]"),i=e.up("grid[xtype=email.emaildata]"),a=t.down("panel[xtype=email.emaillist]"),n=t.down("panel[xtype=email.filecenterview]"),o=t.down("panel[xtype=email.filewestview]");a.hide(),i.hide(),o.show(),n.show()}},"panel[xtype=email.filecenterview] button[ref=emailDataBtn]":{click:function(e){var t=e.up("panel[xtype=email.mainview]"),i=e.up("panel[xtype=email.filecenterview]"),a=t.down("grid[xtype=email.emaildata]"),n=t.down("panel[xtype=email.emaillist]"),o=t.down("panel[xtype=email.filewestview]");n.show(),a.show(),o.hide(),i.hide()}},"panel[xtype=email.filedataview] dataview":{itemdblclick:function(e,t,i,a,n,o){e.up("panel[xtype=email.mainview]");var r=e.up("panel[xtype=email.filedataview]"),l=(e=s.getFileView(r)).getStore();s.openFile(t,l)},beforeitemcontextmenu:function(e,t,i,a,n,o){var r=e.getSelectionModel().getSelection();if(0<r.length){var l=!1;Ext.each(r,function(e){t.get("JE_SYS_DOCUMENTATION_ID")==e.get("JE_SYS_DOCUMENTATION_ID")&&(l=!0)}),l?e.getSelectionModel().select(r):e.getSelectionModel().select(t)}else e.getSelectionModel().select(t)},itemcontextmenu:function(e,t,i,a,n,o){var r=e.up("panel[xtype=email.filedataview]");r.modeType;"detailed"==r.viewType&&(e=e.panel);var l=e.queryMenu;n.stopEvent(),l.showAt(n.getXY()),l.doConstrain()}},"panel[xtype=email.filedataview]":{afterrender:function(n){n.getEl().on("contextmenu",function(e,t,i){var a=n.queryMenu;n.modeType;e.stopEvent(),a.showAt(e.getXY()),a.doConstrain()})}},"panel[xtype=email.filedataview] button[ref=view] menuitem":{click:function(e){var t=e.up("panel[xtype=email.filedataview]"),i=t.down("dataview"),a=t.down("gridpanel");t.viewType!=e.code&&s.changeViewType(t,e,i,a,!1)}},"panel[xtype=email.filedataview] button[ref=order] menuitem":{click:function(e){var t=e.up("panel[xtype=email.filedataview]"),i=s.getFileView(t);t.orderType!=e.code&&s.changeOrderType(t,i,e)}},"panel[xtype=email.filedataview] button[ref=oper] menuitem":{click:function(e){var t=e.up("panel[xtype=email.filedataview]"),i=t.up("panel[xtype=email.mainview]");s.doFile(i,t,e.code)}},"menu[xtype=email.filetreemenu] menuitem":{click:function(e){var t=e.up("menu[xtype=email.filetreemenu]").fileDataView,i=t.up("panel[xtype=email.mainview]");s.doFile(i,t,e.code)}},"panel[xtype=email.filequeryformview] button[ref=okQuery]":{click:function(e){var t=e.up("panel[xtype=email.filequeryformview]"),i=t.up("panel[xtype=email.mainview]"),a=i.down("panel[xtype=email.filecenterview]"),n=i.down("panel[xtype=email.filedataview]");s.queryFile(t,i,a,n)}},"panel[xtype=email.filequeryformview] button[ref=resetQuery]":{click:function(e){var t=e.up("panel[xtype=email.filequeryformview]");t.form.findField("JE_SYS_FILESIZE").setValue("all"),t.form.findField("JE_SYS_MODFIYDATE").setValue("all"),t.form.reset();var i=t.up("panel[xtype=email.mainview]").down("panel[xtype=email.filedataview]"),a=s.getFileView(i).getStore();a.proxy.extraParams.querySql="",a.loadPage(1)}},"panel[xtype=email.filedataview] qqfield[name=quickquery]":{query:function(e){var t=e.up("panel[xtype=email.filedataview]"),i=s.getFileView(t).store;i.proxy.extraParams.quickSql=" AND (EMAILDATA_BT LIKE '%"+e.getValue()+"%' OR EMAILDATA_FJR LIKE '%"+e.getValue()+"%' OR EMAILDATA_SJR LIKE '%"+e.getValue()+"%' OR DOCUMENTATION_TEXT LIKE '%"+e.getValue()+"%' OR DOCUMENTATION_REMARK LIKE '%"+e.getValue()+"%')",i.loadPage(1)},reset:function(e){var t=e.up("panel[xtype=email.filedataview]"),i=s.getFileView(t).store;i.proxy.extraParams.quickSql="",i.loadPage(1)}}};s.control(e)},views:["JE.sys.email.view.EmailList","JE.sys.email.view.MainView","JE.sys.email.view.EmailData","JE.sys.email.view.EmailEdit","JE.sys.email.view.EmailRead","JE.sys.email.view.EmailConfig","JE.sys.email.view.EmailAddress","JE.sys.email.view.EmailSign","JE.sys.email.view.file.CenterView","JE.sys.email.view.file.FileDataView","JE.sys.documentation.drag.DragSelector","JE.sys.email.view.file.QueryFormView","JE.sys.email.view.file.WestView"]}),Ext.define("JE.sys.phone.view.app.CfgView",{extend:"Ext.form.Panel",alias:"widget.phone.cfgview",autoScroll:!0,layout:"column",bodyPadding:"4",itemId:"cfgview",iconCls:"jeicon jeicon-set-up",title:"配置项",initComponent:function(){var n=this;n.defaults={labelAlign:"right",labelWidth:90,columnWidth:.9,margin:"1",xtype:"textfield"},n.items=n.items||[],n.items=[{fieldLabel:"功能名称",allowBlank:!1,columnWidth:.45,regex:/^.{0,6}$/,regexText:"最多6个文字",name:"APP_TEXT"},{fieldLabel:"功能编码",columnWidth:.45,readOnly:!0,name:"APP_CODE"},{fieldLabel:"功能图标",columnWidth:.45,xtype:"uxfilefield",name:"APP_ICON"},{fieldLabel:"功能版本",columnWidth:.45,readOnly:!0,name:"APP_VERSION"},{xtype:"panel",layout:"column",border:0,defaults:n.defaults,padding:0,items:[{fieldLabel:"标题背景",columnWidth:.25,xtype:"colorfield",name:"APP_HEADER_BGCOLOR"},{fieldLabel:"标题文字",columnWidth:.25,xtype:"colorfield",name:"APP_HEADER_TEXTCOLOR"},{fieldLabel:"标题按钮",columnWidth:.25,xtype:"colorfield",name:"APP_HEADER_BTNCOLOR"},{fieldLabel:"标题按钮",columnWidth:.25,xtype:"hidden",name:""}]},{xtype:"panel",layout:"column",border:0,defaults:n.defaults,padding:0,items:[{fieldLabel:"功能字体图标",name:"APP_FONTICON",columnWidth:.25,xtype:"gridssfield",configInfo:"JE_CORE_FONTICON,APP_FONTICON,FONTICON_CLS,S,"},{fieldLabel:"字体图标颜色",columnWidth:.25,xtype:"colorfield",name:"APP_FONTICON_COLOR"},{fieldLabel:"字体图标原图",xtype:"yesnofield",name:"APP_FONTICON_SVG",columnWidth:.25}]},{xtype:"hidden",name:"JE_PHONE_APP_ID"}].concat(n.items),0!=n.appNum&&(n.items=n.items.concat([{fieldLabel:"数字提醒",xtype:"rgroup",name:"APP_NUM",configInfo:"JE_PHONE_BADGE",listeners:{change:function(e,t){var i=n.form.findField("APP_NUM_SQL"),a=n.form.findField("APP_NUM_FN");i.setVisible("sql"==t),a.setVisible("fn"==t)}}},{fieldLabel:"SQL",name:"APP_NUM_SQL",hidden:!0,emptyText:"以  SELECT COUNT(*) FROM ... 返回数字",xtype:"textarea"},{fieldLabel:"后台方法",name:"APP_NUM_FN",hidden:!0,xtype:"textarea",emptyText:"bean名称,方法(无参数,返回值为long)",height:200}])),n.items=n.items.concat([{fieldLabel:"软件数字提醒",xtype:"yesnofield",name:"APP_APK_NUM",boxLabel:'<span style="color:#0000FF;">启用后，可将本功能的数字提醒加到软件上.</span>'},{fieldLabel:"软件角标提醒",xtype:"yesnofield",name:"APP_APK_BADGE",boxLabel:'<span style="color:#0000FF;">启用后，可将本功能的数字加到应用角标上.</span>'}]),n.callParent(arguments),0!=n.versionBtn&&(n.getDockedCmp("buttonBar").add({text:"发布新版本",itemId:"version",iconCls:"jeicon jeicon-history-o"}),n.getDockedCmp("buttonBar").add({text:"升级标记",itemId:"upTagVersion",iconCls:"jeicon jeicon-upgrade"}))},afterRender:function(){this.callParent(arguments)}}),Ext.define("JE.sys.phone.view.chart.CfgView",{extend:"JE.sys.phone.view.app.CfgView",alias:"widget.phone.chartcfg",initComponent:function(){this.items=[{fieldLabel:"图表",xtype:"jsonarrayfield",height:200,name:"APP_CHART_LIST",insertFn:function(){var n=this.grid;JE.selectWin({title:"图表",type:"tree",configInfo:"JE_CORE_CHARTS,MENU_NODEINFO~MENU_MENUNAME,code~text,M",okButtonClick:function(e,t){var a=[];Ext.each(e,function(t){var i=!0;n.store.each(function(e){if(t.get("code")==e.get("code"))return i=!1}),i&&a.push({text:t.get("text"),code:t.get("code")})}),n.store.add(a)}})},columns:[{dataIndex:"text",text:"标题",flex:1},{dataIndex:"code",editable:!1,text:"编码",flex:1},{dataIndex:"height",text:"高",field:{xtype:"numberfield"},width:100},{dataIndex:"search",xtype:"uxcheckcolumn",text:"启用查询",width:100}]}],this.callParent(arguments)}}),Ext.define("JE.sys.phone.util.ApkUtil",{getLicenseKey:function(i,a){var n=this;Ext.data.JsonP.request({url:"http://jesaas.com/JEAPP/jeAppAction!getLicenseKey.action",params:{appName:i,phone:1,spm:JE.APK_SPM||""},callback:function(e,t){e&&("error"==t.type?n.doSaasLogin(a,i):a&&a(t))}})},doSaasLogin:function(i,a){var n=this;if(JE.isNotEmpty(JE.systemConfig.JE_DEFAULT_SAASUSER))n.doSaasIdentity({userName:JE.systemConfig.JE_DEFAULT_SAASUSER,userPass:JE.systemConfig.JE_DEFAULT_SAASPW,apk:a,callback:i});else var o=JE.win({title:"身份验证",width:"plus"==JE.getTheme()?500:400,height:"plus"==JE.getTheme()?250:200,layout:"column",autoShow:!0,bodyStyle:"background-color:#ffffff;",bodyPadding:10,defaults:{columnWidth:.9,labelAlign:"right",labelWidth:80,margin:2},items:[{xtype:"box",columnWidth:1,style:"text-align:center;padding:5px;",html:"未登录，请先用www.jesaas.com账户完成身份验证"},{fieldLabel:"用户名",itemId:"userName",allowBlank:!1,xtype:"textfield"},{fieldLabel:"密码",allowBlank:!1,itemId:"passWord",inputType:"password",xtype:"textfield"},{xtype:"box",columnWidth:1,itemId:"msgBox",style:"text-align:center;padding:2px 5px;color:red;"}],buttons:[{text:"验证",handler:function(){var e=o.getCmp("userName"),t=o.getCmp("passWord");e.isValid()&&t.isValid()&&n.doSaasIdentity({userName:e.getValue(),userPass:t.getValue(),apk:a,callback:i,win:o})}},{text:"注册用户",handler:function(){window.open("http://jesaas.com/login/account.jsp")}},{text:"关闭",handler:function(){o.close()}}],buttonAlign:"center"})},doSaasIdentity:function(i,e){var a=this;Ext.data.JsonP.request({url:"http://jesaas.com/JEAPP/jeAppAction!checkIdentity.action",params:{userName:i.userName,userPass:i.userPass,phone:1},callback:function(e,t){e&&("error"==t.type?i.win&&i.win.getCmp("msgBox").update(t.info):(JE.APK_SPM=t.info,JE.APK_SAAS_USERID=t.userId,i.win&&(JE.msg("验证成功！"),i.win.close()),JE.isEmpty(i.apk)?i.callback():a.getLicenseKey(i.apk,i.callback)))}})}}),Ext.define("JE.sys.phone.util.AppUtil",{doAppSave:function(n,o){JE.submit(n,{async:!1,url:JE.getUrlMaps("je.core.update"),params:{tableCode:"JE_PHONE_APP",jeFileType:"PLATFORM",uploadableFields:"APP_ICON,APP_PLUGIN_FILE"},success:function(e,t){var i=t.result.obj;e.setValues({APP_ICON:i.APP_ICON,APP_PLUGIN_FILE:i.APP_PLUGIN_FILE});var a=o.raw.bean;"phone.funccfg"==n.xtype?n.form.getFields().each(function(e){var t=e.name;a[t]=i[t]}):Ext.apply(a,i),o.set("bean",a),o.set("text",a.APP_TEXT),o.commit(),JE.msg("保存成功")}})}}),Ext.define("JE.sys.phone.util.FieldSetUtil",{buildFieldSet:function(i,e){var a=this,t=i.data,n={xtype:"panel",minHeight:50,margin:"5",bodyPadding:"5",fieldset:!0,record:i,layout:"column",ddPanel:!0,itemId:t.APPFIELD_CODE,columnWidth:1,dockedItems:{xtype:"toolbar",style:"background:#d3e1f1;cursor:move;",basicBgColor:"#d3e1f1",itemId:"configBar",items:[{xtype:"box",ref:"titleBox",html:i.get("APPFIELD_NAME"),style:"overflow:hidden;text-overflow:ellipsis;white-space: nowrap;color:blue;cursor:pointer;"},"->",{iconCls:"jeicon jeicon-error",handler:function(e){var t=e.ownerCt.ownerCt;a.removeItem(t),a.refreshFieldView(i)}}]},listeners:{afterrender:function(e){e.titleBox=e.down("box[ref=titleBox]"),a.buildDrop(e),a.buildDrag(e),a.buildEvent(e)}}};return i.set("APPFIELD_HIDDEN","0"),n}}),Ext.define("JE.sys.phone.util.FieldUtil",{buildFieldItem:function(i,e){var a=this,t=i.data,n={xtype:"panel",margin:"5",minHeight:25,itemId:t.APPFIELD_CODE,fieldPanel:!0,columnWidth:1,layout:{type:"hbox",align:"middle"},record:i,style:"cursor:move;",ddPanel:!0,basicBGColor:"#F7DD7D",bodyStyle:"border-color:transparent;border-width:2px;",bodyPadding:"2",border:1,items:[{xtype:"box",ref:"iconBox",html:a.getXTypeIcon(t.APPFIELD_XTYPE)},{xtype:"box",ref:"titleBox",style:"color:blue;cursor:pointer;padding-left:4px;font-family: 微软雅黑,黑体;overflow:hidden;text-overflow:ellipsis;white-space: nowrap;font-weight: bold;",html:t.APPFIELD_NAME},{xtype:"box",ref:"rLabel",style:"color:red;font-weight:bold;",html:"*"},{xtype:"box",itemId:"separators",flex:1,html:"&nbsp;",style:"padding: 0 5px;font-family: 微软雅黑,黑体;"},{xtype:"yesnofield",name:"readOnly",inputAttrTpl:'title="只读"',value:t.APPFIELD_READONLY},{xtype:"yesnofield",name:"allowBlank",inputAttrTpl:'title="允许为空"',value:t.APPFIELD_ALLOWBLANK},{xtype:"button",iconCls:"jeicon jeicon-error",ui:"default-toolbar",handler:function(e){e.ownerCt;i.set("APPFIELD_GROUPNAME",""),i.set("APPFIELD_HIDDEN","1");var t=i.data;a.removeField(t,"hide")}}],updateView:function(e){this.titleBox.update(e.APPFIELD_NAME);var t=Ext.decode(Ext.value(e.APPFIELD_SEPARATORS,"[]")),i=[];Ext.each(t,function(e){"1"==e.enable&&i.push(("top"==e.position?"上：":"下：")+Ext.value(e.text,""))}),this.separators.update(i.join("</br>"))},listeners:{afterrender:function(e){e.iconBox=e.down("box[ref=iconBox]"),e.titleBox=e.down("box[ref=titleBox]"),e.rLabel=e.down("box[ref=rLabel]"),e.readOnlyField=e.down("yesnofield[name=readOnly]"),e.allowBlankField=e.down("yesnofield[name=allowBlank]"),e.readOnlyField.fireEvent("change",e.readOnlyField,t.APPFIELD_READONLY),e.allowBlankField.fireEvent("change",e.allowBlankField,t.APPFIELD_ALLOWBLANK),e.separators=e.getCmp("separators"),-1!=["button","link","child","childfuncfield"].indexOf(t.APPFIELD_XTYPE)&&(e.readOnlyField.setValue(0),e.allowBlankField.setValue(1),e.readOnlyField.hide(),e.allowBlankField.hide()),e.updateView(t),a.buildDrag(e),a.buildEvent(e)}}};return"__child"==t.APPFIELD_CODE&&(n.childFunc=!0,n.bodyStyle="background:#cecece;",n.items.splice(4,2),i.set("APPFIELD_HIDDEN","0")),i.set("APPFIELD_HIDDEN","0"),n}}),Ext.define("JE.sys.phone.util.HomeUtil",{buildEvent:function(i){var e=this;"image"==i.itemData.type?(i.itemData.cfg=i.itemData.cfg||{height:200},i.insert(1,{xtype:"numberfield",fieldLabel:"高",labelWidth:30,width:100,cls:"je-field-basiccls",value:i.itemData.cfg.height,minValue:1,labelAlign:"right",listeners:{change:function(e,t){i.itemData.cfg.height=t}}}),i.titleBox.getEl().on("click",function(){JE.showFunc("JE_CORE_IMGNEW")})):i.titleBox.getEl().on("click",function(){e.getTitCfg(i)})},buildDrop:function(e){var r=this;e.dropTarget=new Ext.dd.DropTarget(e.body,{ddGroup:"DDGroup",notifyOver:function(e,n,o){var t=n.getTarget("div.x-panel-body",3);if(o.allowDD=!1,t){var i=Ext.getCmp(t.id.replace("-body",""));"phone.homeplan"==i.xtype&&(o.dropPanel=i,o.allowDD=!0),o.allowDD&&o.dragPanel&&o.dropPanel&&(o.allowDD=o.dragPanel.id!=o.dropPanel.ownerCt.id&&o.dragPanel.id!=o.dropPanel.id)}return o.insertIndex=-1,o.allowDD&&o.dropPanel&&0<o.dropPanel.items.getCount()?o.dropPanel.items.each(function(e,t){var i=o.dropPanel.items.get(t+1),a=r.getItemPosition(n,e,i);if("before"==a||"after"==a)return o.dragPanel&&o.dragPanel.id==e.id||"before"==a?o.insertIndex=t:o.insertIndex=t+1,r.positionIndicator(e.getEl(),a,n),!1;r.hidetIndicator()}):r.hidetIndicator(),o.allowDD?e.dropAllowed:e.dropNotAllowed},notifyDrop:function(e,t,i){return i.allowDD}})},getTitCfg:function(e){var t=this.mainview.getCmp("east"),i=t.getCmp("cfgview"),a=this.mainview.getActivePage();t.setWidth(400),t.getLayout().setActiveItem(i),i.loadData(e),a.items.each(function(e){e.setBodyStyle("border-color","transparent")}),e.setBodyStyle("border-color","#007AFF")},buildDrag:function(e){var a=this;e.dragSource=new Ext.dd.DragSource(e.getEl(),{ddGroup:"DDGroup",getDragData:function(e){var t=e.getTarget("div.x-panel",10);if(t){var i=Ext.getCmp(t.id);if(i)return{ddel:i.getEl(),dragPanel:i,draggedRecord:i.record}}},onInitDrag:function(e,t){var i;return this.dragData&&this.dragData.draggedRecord?i='<DIV STYLE="">'+this.dragData.draggedRecord.get("text")+"</DIV>":(i=this.el.dom.cloneNode(!0)).id=Ext.id(),this.proxy.update(i),this.onStartDrag(e,t),!0},afterValidDrop:function(e,t,i){a.doItemSort(this.dragData),a.hidetIndicator()},afterInvalidDrop:function(){a.hidetIndicator()},afterDragDrop:function(e,t,i){a.hidetIndicator()}})},doItemSort:function(e){if(e.allowDD){var t=!0;if(e.dragPanel)t=e.dropPanel.id!=e.dragPanel.ownerCt.id;else{var i=this.mainview.getActivePage().itemData.type,a=this.up("[xtype=phone.homeplanmain]").getCmp("plancenter").getCmp("pageBody").getLayout().getActiveItem().items.items.length;if("shortcut"==i&&1<=a)JE.alert("当前面板是快捷菜单，只能添加一个菜单");else if("plugin"==i)JE.alert("当前面板是插件菜单，不能添加菜单");else if(11==a)JE.alert("当前面板最多只能插入11个菜单");else{var n=Ext.clone(e.draggedRecord.data);n.id=JE.uuid(),e.dragPanel=this.addItem(n)}}-1<e.insertIndex?e.dragPanel=e.dropPanel.insert(e.insertIndex,e.dragPanel):t&&(e.dragPanel=e.dropPanel.add(e.dragPanel))}},indicatorHtml:'<div class="formfield-move-left"></div><div class="formfield-move-right"></div>',indicatorCls:"je-formfield-drop-indicator",getIndicator:function(){return this.indicator},getItemPosition:function(e,t,i){var a,n=e.getXY()[1],o=(e.getXY()[0],Ext.fly(t.getEl()).getRegion());return i&&Ext.fly(i.getEl()).getRegion().top!=o.top&&void 0,o.top-n<10&&0<o.top-n?a="before":-o.bottom+n<10&&0<-o.bottom+n?a="after":!i&&0<n-o.bottom&&(a="after"),a},positionIndicator:function(e,t,i){var a=Ext.fly(e),n=a.getX(),o=a.getY();"after"==t?o+=a.getHeight()+5:o-=5,this.getIndicator().setWidth(a.getWidth()).showAt(n,o)},hidetIndicator:function(){this.mainview.getActivePage().indicator.hide()},buildDataView:function(e){var t=this;Ext.each(e,function(e){t.add(t.addItem(e))})},addItem:function(t){var i=this,e=(i.formview,{xtype:"panel",minHeight:25,margin:"5",itemData:t,ddPanel:!0,itemId:JE.uuid(),columnWidth:1,layout:{type:"hbox",align:"middle"},bodyStyle:"border-color:transparent;background:#d3e1f1;cursor:move;border-width:2px;",bodyPadding:"2",border:1,items:[{xtype:"box",itemId:"titleBox",html:t.cfg&&t.cfg.text||t.text,style:"font-family: 微软雅黑,黑体;font-weight: bold;overflow:hidden;text-overflow:ellipsis;white-space: nowrap;color:blue;cursor:pointer;"},{xtype:"box",flex:1,html:"&nbsp;"},{iconCls:"jeicon jeicon-error",xtype:"button",ui:"default-toolbar",handler:function(e){var t=e.ownerCt;i.removeItem(t)}}],listeners:{afterrender:function(e){e.titleBox=e.getCmp("titleBox"),i.buildEvent(e),"footmenu"!=t.code&&i.buildDrag(e)}}});return i.mainview.itemview.buildView(t.code,!0),"footmenu"==t.code&&(e.style="position: absolute;bottom:0px;"),e},removeItem:function(e){this.mainview.itemview.buildView(e.itemData.code,!1),e.ownerCt.remove(e,!0),this.mainview.cfgview.doBack(!0)}}),Ext.define("JE.sys.phone.util.IconUtil",{xtypeIcon:{numberfield:'<div class = "x-trigger-cell"><div class="x-trigger-index-0 x-form-trigger x-form-spinner-up"></div><div class="x-trigger-index-1 x-form-trigger x-form-spinner-down"></div></div>',colorfield:{trigger:!0,iconCls:"x-form-color-trigger"},gridssfield:{trigger:!0,iconCls:"x-form-list-trigger"},datefield:{trigger:!0,iconCls:"x-form-date-trigger"},cbbfield:{trigger:!0,iconCls:"x-form-arrow-trigger"},uxfilefield:{trigger:!0,iconCls:"x-form-file-trigger"},treessfield:{trigger:!0,iconCls:"x-form-tree-trigger"},cgroup:{iconCls:"x-form-checkbox"},rgroup:{iconCls:"x-form-radio"},textfield:{iconCls:"jeicon jeicon-fills-up-the-topic"},displayfield:{iconCls:"jeicon jeicon-photo"},image:{iconCls:"jeicon jeicon-photo"},cbblistfield:{iconCls:"jeicon jeicon-collection-field"},childfuncfield:{iconCls:"jeicon jeicon-add-fields"},startfield:{iconCls:"jeicon jeicon-stars"},ckeditorfield:{iconCls:"jeicon jeicon-pencil"},searchfield:{iconCls:"jeicon jeicon-search"},graphfield:{iconCls:"jeicon jeicon-sitemap-three"},textcode:{iconCls:"jeicon jeicon-sorting"},textarea:{iconCls:"jeicon jeicon-text-field"},link:{iconCls:"jeicon jeicon-associated"},button:{iconCls:"jeicon jeicon-button"},child:{iconCls:"jeicon jeicon-work2-on"}},getXTypeIcon:function(e){var t=e;-1!=["gridssfield","gridssareafield","queryuserfield","queryuserareafield"].indexOf(e)?t="gridssfield":-1!=["treessfield","treessareafield"].indexOf(e)?t="treessfield":-1!=["datemonthfield","datetimefield","datefield"].indexOf(e)&&(t="datefield");var i=this.xtypeIcon[t],a="";return Ext.isEmpty(i)||(a=Ext.isString(i)?i:i.trigger?'<input type="button" class="'+i.iconCls+' je-trigger-icon" style="margin-top:1px;">':'<input type="button" class="'+i.iconCls+' je-button-icon" style="margin-top:4px;">'),a}}),Ext.define("JE.sys.phone.util.RecUtil",{buildDataView:function(r,l,s,d){var c=this,u=[];return s=Ext.value(s,""),r.each(function(e){var t=e.data;if((1==d?"1"==t.APPFIELD_HIDDEN:"1"!=t.APPFIELD_HIDDEN)&&t.APPFIELD_GROUPNAME==s)if("fieldset"==t.APPFIELD_XTYPE){var i=t.APPFIELD_CODE,a=c.buildFieldSet(e,l),n=c.buildDataView(r,a.columns,i);a.items=n,u.push(a)}else{var o=c.buildFieldItem(e,l);u.push(o)}}),u},addItem:function(e){return"fieldset"==e.get("APPFIELD_XTYPE")?(item=this.buildFieldSet(e,this.columns),item.items=this.buildDataView(this.fieldStore,item.columns,item.itemId,!0)):item=this.buildFieldItem(e,this.columns),item},removeItem:function(e,t){var i=e.record,a=this;t=Ext.value(t,0),i.set("APPFIELD_HIDDEN","1"),e.items.each(function(e){e.ddPanel&&a.removeItem(e,t+1)}),0==t&&e.ownerCt.remove(e,!0)},setFieldXtype:function(e,t){var i=e.record,a=t;-1!=["gridssfield","gridssareafield","queryuserfield","queryuserareafield"].indexOf(t)?a="gridssfield":-1!=["treessfield","treessareafield"].indexOf(t)?a="treessfield":-1!=["datemonthfield","datetimefield","datefield"].indexOf(t)&&(a="datefield"),e.iconBox.update(Ext.value(this.xtypeIcon[a],"")),i.set("APPFIELD_XTYPE",t)},setFieldReadOnly:function(e,t){e.rLabel&&(e.setBodyStyle("background-color",t?"gainsboro":e.basicBGColor),e.record.set("APPFIELD_READONLY",t?"1":"0"))},setFieldBlank:function(e,t){e.rLabel&&(e.rLabel.setVisible(!t),e.record.set("APPFIELD_ALLOWBLANK",t?"1":"0"))},setFieldSetBGColor:function(e,t){e.setBodyStyle("background-color",Ext.value(t,"none")),e.record.set("APPFIELD_BGCOLOR",t)},setOrderIndex:function(e,t){var i=this;return t=Ext.value(t,1),e.items.each(function(e){e.ddPanel&&(e.record.set("SY_ORDERINDEX",t),t=i.setOrderIndex(e,++t))}),t},setGroupName:function(e,t){var i="";(t=Ext.value(t,e.ownerCt))&&t.ddPanel&&(i=t.record.get("APPFIELD_CODE")),e.record.set("APPFIELD_GROUPNAME",i)}}),Ext.define("JE.sys.phone.util.Util",{mixins:["JE.sys.phone.util.FieldUtil","JE.sys.phone.util.FieldSetUtil","JE.sys.phone.util.RecUtil","JE.sys.phone.util.IconUtil"],buildEvent:function(a){a.titleBox.getEl().on("click",function(){var e=a.up("[xtype=phone.funcform]"),t=e.fieldStore.getById(a.itemId),i=e.fieldcfgview;e.doBeforeSave(a),t.data.APPFIELD_SEPARATORS=Ext.value(t.data.APPFIELD_SEPARATORS,"[{position:'top'},{position:'bottom'}]"),i.loadData(t.data),e.cardview.show()})},buildDrop:function(e){var s=this;e.dropTarget=new Ext.dd.DropTarget(e.body,{ddGroup:"formGroup",notifyOver:function(e,n,o){var t=n.getTarget("div.x-panel-body",3);if(o.allowDD=!1,t){var i=Ext.getCmp(t.id.replace("-body",""));i.fieldset&&(o.dropPanel=i,o.allowDD=!0),o.allowDD&&o.dragPanel&&o.dropPanel&&(o.allowDD=o.dragPanel.id!=o.dropPanel.ownerCt.id&&o.dragPanel.id!=o.dropPanel.id),o.dragPanel&&o.dragPanel.childFunc&&(o.allowDD=o.dropPanel&&"phone.formview"==o.dropPanel.xtype)}return o.insertIndex=-1,o.allowDD&&o.dropPanel&&0<o.dropPanel.items.getCount()?o.dropPanel.items.each(function(e,t){var i=o.dropPanel.items.get(t+1),a=s.getItemPosition(n,e,i);if("before"==a||"after"==a)return o.dragPanel&&o.dragPanel.id==e.id||"before"==a?o.insertIndex=t:o.insertIndex=t+1,s.positionIndicator(e.getEl(),a,n),!1;s.hidetIndicator()}):s.hidetIndicator(),o.allowDD?e.dropAllowed:e.dropNotAllowed},notifyDrop:function(e,t,i){if(i.allowDD){if(i.view&&"treeview"==i.view.xtype){var a=i.records[0],n=a.get("bean"),o=a.get("nodeType");if(JE.isEmpty(n)){if("formitem"==o){var r=s.up("panel[xtype=phone.funcmain]").record.getId();n={APPFIELD_CODE:JE.uuid(),APPFIELD_XTYPE:a.get("code"),APPFIELD_NAME:a.get("text"),APPFIELD_HIDDEN:"0",APPFIELD_TYPE:"form",APPFIELD_APP_ID:r},s.addField(n)}}else n.APPFIELD_HIDDEN="0",a.set("bean",n),a.commit();var l=s.fieldStore.getById(n.APPFIELD_CODE);i.draggedRecord=l,i.records=[l]}s.doItemSort(i)}return s.hidetIndicator(),i.allowDD},notifyOut:function(e,t,i){s.hidetIndicator()}})},buildDrag:function(e){var a=this;e.dragSource=new Ext.dd.DragSource(e.getEl(),{ddGroup:"formGroup",getDragData:function(e){var t=e.getTarget("div.x-panel",10);if(t){var i=Ext.getCmp(t.id);if(i)return{ddel:i.getEl(),dragPanel:i,draggedRecord:i.record}}},onInitDrag:function(e,t){var i;return this.dragData&&this.dragData.draggedRecord?i='<DIV STYLE="">'+this.dragData.draggedRecord.get("APPFIELD_NAME")+"</DIV>":(i=this.el.dom.cloneNode(!0)).id=Ext.id(),this.proxy.update(i),this.onStartDrag(e,t),!0},afterValidDrop:function(e,t,i){a.doItemSort(this.dragData)},afterInvalidDrop:function(){a.hidetIndicator()},afterDragDrop:function(e,t,i){a.hidetIndicator()}})},doItemSort:function(e){if(e.allowDD){var t=!0;if(e.dragPanel)t=e.dropPanel.id!=e.dragPanel.ownerCt.id;else{var i=e.draggedRecord||e.records[0];e.dragPanel=this.addItem(i)}-1<e.insertIndex?e.dragPanel=e.dropPanel.insert(e.insertIndex,e.dragPanel):t&&(e.dragPanel=e.dropPanel.add(e.dragPanel)),t&&(!e.newFieldSet&&e.dragPanel.colsField&&e.dragPanel.colsField.setValue(1),this.setGroupName(e.dragPanel,e.dropPanel))}},indicatorHtml:'<div class="formfield-move-left"></div><div class="formfield-move-right"></div>',indicatorCls:"je-formfield-drop-indicator",getIndicator:function(){return this.indicator},getItemPosition:function(e,t,i){var a,n=e.getXY()[1],o=(e.getXY()[0],Ext.fly(t.getEl()).getRegion());return i&&Ext.fly(i.getEl()).getRegion().top!=o.top&&void 0,o.top-n<10&&0<o.top-n?a="before":-o.bottom+n<10&&0<-o.bottom+n?a="after":!i&&0<n-o.bottom&&(a="after"),a},positionIndicator:function(e,t,i){var a=Ext.fly(e),n=a.getX(),o=a.getY();"after"==t?o+=a.getHeight()+5:o-=5,this.getIndicator().setWidth(a.getWidth()).showAt(n,o)},hidetIndicator:function(){this.getIndicator().hide()}}),Ext.define("JE.sys.phone.view.AddApk",{extend:"Ext.form.Panel",alias:"widget.phone.addapk",mixins:["JE.sys.phone.util.ApkUtil"],autoScroll:!0,layout:"vbox",bodyPadding:"10",initComponent:function(){var n=this;n.packageName="com.je.JEAPP00000000",n.defaults={width:"100%",margin:"2 0",labelAlign:"right"},n.items=[{fieldLabel:"应用名",xtype:"textfield",allowBlank:!1,name:"APK_TEXT"},{fieldLabel:"APPID",xtype:"uxdisplayfield",submitValue:!0,name:"APK_CODE",fieldStyle:"padding-left:4px;"},{fieldLabel:"图标",xtype:"uxfilefield",name:"APK_ICON"},{xtype:"hidden",name:"JE_PHONE_APK_ID"}],n.buttons=[{text:"确定",iconCls:"jeicon jeicon-check",handler:function(a){JE.submit(n,{async:!1,url:JE.getUrlMaps("je.core.phone.phone","doAddApk"),params:{tableCode:"JE_PHONE_APK",uploadableFields:"APK_ICON"},success:function(e,t){JE.msg("保存成功"),a.up("window").close();var i=t.result.obj;n.callback&&n.callback(i)}})}},{text:"取消",iconCls:"jeicon jeicon-error",handler:function(e){e.up("window").close()}}],n.buttonAlign="center",n.callParent(arguments)},afterRender:function(){if(this.callParent(arguments),this.record)this.loadRecord(this.record);else{var e=Ext.Date.format(new Date,"Y-md-Hi-su");e=e.substring(0,e.length-1),this.form.setValues({APK_CODE:e})}}}),Ext.define("JE.sys.phone.view.ApkView",{extend:"Ext.panel.Panel",alias:"widget.phone.apkview",initComponent:function(){this.items=Ext.create("Ext.view.View",{store:JE.getStore({tableName:"JE_PHONE_APK",id:"JE_PHONE_APK_ID",pageSize:-1,autoLoad:!0,params:{whereSql:"",orderSql:" order by SY_CREATETIME"}}),tpl:['<tpl for=".">','<div class="page" style="padding:5px;position: relative;float:left;border: 1px solid transparent;height:105px;width:85px;margin:10px 20px;text-align:center;cursor: pointer;">','<img width="64" height="64" src="{[this.getIcon(values)]}" />','<div style="text-align:center;word-break: break-all;">{APK_TEXT}</div>','<span data-id="{JE_PHONE_APK_ID}" data-type="delete" class="delete" style="display:none;width: 18px;text-align: center;height: 18px;border-radius: 10px;background-color: red;color: #ffffff;position: absolute;top: -5px;right:-10px;">x</span>','<i data-id="{JE_PHONE_APK_ID}" data-type="edit" title="编辑" class="edit jeicon jeicon-form-editing" style="display:none;position: absolute;bottom: -5px;right:-10px;cursor: pointer;"></i>',"</div>","</tpl>",'<div title="新建APP" class="addApp" style="float:left;display:table;line-height: 60px;height:60px;width:60px;border-radius: 4px;text-align:center;margin:17px 20px;border: 1px solid #cecece;cursor: pointer;">','<i style="color: #cecece;font-size:20px;" class="jeicon jeicon-plus"></i>',"</div>",{getIcon:function(e){var t=e.APK_ICON.split("*")[1];return t?JE.getFileUrl(t):JE.getStaticUrl("JE.app.app")}}],itemSelector:"div.page",draggable:{delegate:"div.page"},emptyText:"",overItemCls:"x-dataview-item-over",selectedItemCls:"x-dataview-item-selected"}),this.callParent(arguments)},afterRender:function(){this.callParent(arguments)}}),Ext.define("JE.sys.phone.view.app.AddModel",{extend:"Ext.form.Panel",alias:"widget.phone.addmodel",mixins:["JE.sys.phone.util.ApkUtil"],autoScroll:!0,layout:"column",bodyPadding:"4",initComponent:function(){var s=this;s.defaults={labelAlign:"right",labelWidth:80,columnWidth:.9,margin:"1",xtype:"textfield"};JE.isEmpty(JE.systemConfig.JE_DEFAULT_SAASUSER),s.items=[{fieldLabel:"名称",xtype:"textfield",name:"APP_TEXT",columnWidth:.7,allowBlank:!1},{xtype:"yesnofield",name:"folder",columnWidth:.3,boxLabel:"文件夹",listeners:{change:function(e,t,i){var a=s.form.findField("APP_TYPE"),n=s.form.findField("APP_ICON"),o=s.form.findField("APP_FUNC_NAME");a.reset(),a.setVisible(!t),n.setVisible(!t),o.setVisible(!t)}}},{fieldLabel:"编码",xtype:"textfield",name:"APP_CODE",allowBlank:!1},{fieldLabel:"图标",xtype:"uxfilefield",name:"APP_ICON"},{fieldLabel:"SAAS图标(不持久)",hidden:!0,xtype:"textfield",name:"saasIcon"},{fieldLabel:"类型",xtype:"cbbfield",name:"APP_TYPE",value:"func",dataArray:[{code:"func",text:"功能"},{code:"chart",text:"图表"},{code:"report",text:"报表"},{code:"link",text:"链接"},{code:"plugin",text:"本地插件"}],listeners:{change:function(e,t,i){var a={func:"APP_FUNC_NAME",plugin_cloud:"APP_PLUGIN_CLOUD_CODE",plugin:"APP_BDCJ_CODE",chart:"__chartcode",report:"APP_REPORT_CODE",link:"APP_LINK_URL"};for(var n in a){var o=a[n],r=t==n,l=s.form.findField(o);l.setVisible(r),l.setDisabled(!r)}s.form.getFields().each(function(e){-1!=e.name.indexOf("APP_FUNC_")?e.setDisabled("func"!=t):"__chartname"==e.name&&e.setDisabled("chart"!=t)}),s.form.findField("APP_CODE").setReadOnly("plugin_cloud"==t)}}},{fieldLabel:"图表",hidden:!0,xtype:"treessfield",name:"__chartcode",configInfo:"JE_CORE_CHARTS,__chartcode~__charttext,code~text,M"},{xtype:"hidden",name:"__charttext"},{fieldLabel:"报表",hidden:!0,xtype:"treessfield",name:"APP_REPORT_CODE",configInfo:"JE_CORE_REPORT,APP_REPORT_CODE,code,S"},{fieldLabel:"云插件编码",hidden:!0,xtype:"uxtrigger",editable:!1,name:"APP_PLUGIN_CLOUD_CODE",handler:function(){var e=s.tree.getApkModel(),a=e.get("APK_TEXT"),n=e.get("APK_CODE"),o=e.get("JE_PHONE_APK_ID");s.getLicenseKey(a,function(e){var t=s.tree.getRootNode(),i=[];t.findChildBy(function(e){var t=e.get("bean");"plugin_cloud"==t.APP_TYPE&&JE.isNotEmpty(t.APP_PLUGIN_CLOUD_ID)&&i.push(t.APP_PLUGIN_CLOUD_ID)},t,!0),JE.win({autoShow:!0,useButton:!0,title:"选择已购买插件",items:[{xtype:"phone.cpbuyselview",useIds:i.join(","),apkConfig:{userId:JE.APK_SAAS_USERID,apkKey:n,apkId:o,apkName:a}}],fn:function(e){var t=e.down("dataview").getSelectionModel().getSelection()[0];if(t){if("1"==t.get("nodeInfoType"))return JE.alert("该插件已经使用!"),!1;var i=t.get("bean"),a={APP_TEXT:i.CP_MC,APP_CODE:i.CP_DM,APP_ICON:i.CP_LOGO,saasIcon:i.CP_LOGO,APP_PLUGIN_CLOUD_ID:i.JE_SAAS_CP_ID,APP_PLUGIN_CLOUD_CODE:i.CP_DM};s.form.setValues(a),e.close()}}})})}},{xtype:"hidden",name:"APP_PLUGIN_CLOUD_ID"},{fieldLabel:"插件",hidden:!0,xtype:"uxfilefield",name:"APP_PLUGIN_FILE"},{fieldLabel:"链接",hidden:!0,xtype:"textfield",name:"APP_LINK_URL",emptyText:"以 http:// 开头"},{fieldLabel:"插件",xtype:"gridssfield",hidden:!0,name:"APP_BDCJ_CODE",whereSql:"and PLUGIN_VERSION !=''",configInfo:"JE_PHONE_PLUGIN,APP_BDCJ_CODE~APP_BDCJ_ID~APP_CODE~APP_TEXT~APP_ICON~APP_VERSION,PLUGIN_CODE~JE_PHONE_PLUGIN_ID~PLUGIN_CODE~PLUGIN_TEXT~PLUGIN_ICON~PLUGIN_VERSION,S"},{name:"APP_VERSION",xtype:"hidden"},{fieldLabel:"功能",xtype:"gridssfield",name:"APP_FUNC_NAME",configInfo:"JE_CORE_FUNCINFO,APP_FUNC_LISTTITLE~APP_FUNC_FORMTITLE~APP_FUNC_NAME~APP_FUNC_CODE~APP_FUNC_ID~APP_FUNC_TABLENAME~APP_FUNC_PKNAME~APP_FUNC_ACTION~APP_FUNC_ORDERSQL~APP_FUNC_WHERESQL~APP_CODE~APP_TEXT,FUNCINFO_FUNCNAME~FUNCINFO_FUNCNAME~FUNCINFO_FUNCNAME~FUNCINFO_FUNCCODE~JE_CORE_FUNCINFO_ID~FUNCINFO_TABLENAME~FUNCINFO_PKNAME~FUNCINFO_FUNCACTION~FUNCINFO_ORDERSQL~FUNCINFO_WHERESQL~FUNCINFO_FUNCCODE~FUNCINFO_FUNCNAME,S"},{xtype:"hidden",name:"APP_BDCJ_ID"},{xtype:"hidden",name:"APP_FUNC_ID"},{xtype:"hidden",name:"APP_FUNC_TABLENAME"},{xtype:"hidden",name:"APP_FUNC_PKNAME"},{xtype:"hidden",name:"APP_FUNC_ACTION"},{xtype:"hidden",name:"APP_FUNC_ORDERSQL"},{xtype:"hidden",name:"APP_FUNC_WHERESQL"},{xtype:"hidden",name:"APP_FUNC_CODE"},{xtype:"hidden",name:"APP_FUNC_LISTTITLE"},{xtype:"hidden",name:"APP_FUNC_FORMTITLE"},{xtype:"hidden",name:"APP_FUNC_PAGESIZE",value:10},{xtype:"hidden",name:"APP_FUNC_BUTTONS",value:JE.encode([{id:JE.uuid(),text:"添加",code:"gridInsertBtn",cls:"",disable:"0",type:"GRID"},{id:JE.uuid(),text:"删除",code:"gridRemoveBtn",cls:"mui-btn-red",disable:"0",type:"GRIDITEM"},{id:JE.uuid(),text:"保存",code:"formSaveBtn",cls:"",disable:"0",type:"FORM"}])},{xtype:"hidden",name:"tableCode",value:"JE_PHONE_APP"},{xtype:"hidden",name:"uploadableFields",value:"APP_PLUGIN_FILE,APP_ICON"}],s.buttons=[{text:"确定",iconCls:"jeicon jeicon-check",handler:function(){s.doSave()}},{text:"取消",iconCls:"jeicon jeicon-error",handler:function(){s.ownerCt.close()}}],s.buttonAlign="center",s.callParent(arguments)},afterRender:function(){this.callParent(arguments)},doSave:function(e){var n=this,o=n.tree,t=n.form.findField("APP_TYPE").getValue(),i=n.form.findField("APP_CODE").getValue();if(o.getRootNode().findChild("code",i,!0))JE.alert("编码已存在，请重新填写！");else{var a={},r=o.getSelectionModel().getSelection()[0]||o.getRootNode();if((a={SY_LAYER:r.getDepth()+1,SY_PARENT:r.get("id"),SY_PATH:r.getPath(),SY_NODETYPE:"LEAF",SY_STATUS:"1",SY_ORDERINDEX:0}).APP_APK_ID=o.apkId,"1"==n.form.findField("folder").getValue()&&(a.SY_NODETYPE="GENERAL",n.form.setValues({APP_TYPE:"folder"})),"chart"==t){var l=n.form.findField("__chartcode").getValue(),s=n.form.findField("__charttext").getValue();if(JE.isNotEmpty(l)){l=l.split(","),s=s.split(",");var d=[];Ext.each(l,function(e,t){var i={text:s[t],code:e};d.push(i)}),a.APP_CHART_LIST=JE.encode(d)}}else"func"==t?a.SY_NODETYPE="GENERAL":"plugin_cloud"==t&&(a.saasIcon=n.form.findField("APP_ICON").getValue());a=Ext.apply(a,{jeFileType:"PLATFORM"}),JE.submit(n,{async:!1,url:JE.getUrlMaps("je.core.phone.phone","doAddModel"),params:a,success:function(e,t){var i=t.result.obj;n.ownerCt.close(),JE.msg("添加成功");var a={id:i.JE_PHONE_APP_ID,text:i.APP_TEXT,code:i.APP_CODE,nodeType:i.SY_NODETYPE,iconCls:"",expandable:!1,leaf:!0,children:[],bean:i};"GENERAL"==a.nodeType&&(a.expandable=!0,a.leaf=!1),a=r.insertChild(0,a),r.expand(),o.getSelectionModel().select(a)}})}}}),Ext.define("JE.sys.phone.view.app.AddVersion",{extend:"Ext.form.Panel",alias:"widget.phone.addversion",autoScroll:!0,layout:"column",bodyPadding:"4",initComponent:function(){var e=this;e.appRecord=e.cfgview.mainview.record,e.defaults={labelAlign:"right",labelWidth:80,columnWidth:.9,margin:"1"};var t=JE.toNum(e.appRecord.get("bean").APP_VERSION);t++,e.items=[{fieldLabel:"版本号",xtype:"textfield",name:"APPVERSION_VERSION",value:t,readOnly:!0},{fieldLabel:"说明",xtype:"textarea",height:150,name:"APPVERSION_REMARK"}],e.buttons=[{text:"发布",iconCls:"jeicon jeicon-check",handler:function(){e.doSave()}},{text:"取消",iconCls:"jeicon jeicon-error",handler:function(){e.ownerCt.close()}}],e.buttonAlign="center",e.callParent(arguments)},afterRender:function(){this.callParent(arguments)},doSave:function(e){var a=this,n=a.appRecord.get("bean");JE.submit(a,{async:!1,url:JE.getUrlMaps("je.core.phone.phone","doVersion"),params:{tableCode:"JE_PHONE_APPVERSION",appType:n.APP_TYPE,appId:n.JE_PHONE_APP_ID,version:a.form.findField("APPVERSION_VERSION").getValue(),APPVERSION_APP_ID:n.JE_PHONE_APP_ID},success:function(e,t){var i=t.result.obj;a.ownerCt.close(),JE.msg("发布成功！"),a.cfgview.form.setValues({APP_VERSION:i.APPVERSION_VERSION}),a.cfgview.mainview.versionview.store.load(),n.APP_VERSION=i.APPVERSION_VERSION,a.appRecord.set("bean",n),a.appRecord.commit()}})}}),Ext.define("JE.sys.phone.view.app.AppView",{extend:"JE.core.view.TreeView",alias:"widget.phone.appview",mixins:["JE.sys.phone.util.ApkUtil"],initComponent:function(){var d=this,e=d.apkId;d.type="func",d.codeSearch=!0,d.url=JE.getUrlMaps("je.core.getTree"),d.funcData={info:{funcType:"tree"}},d.params={tableCode:"JE_PHONE_APP",parentSql:" and APP_APK_ID = '"+e+"' ",moreRoot:!0},d.whereSql&&(d.params.whereSql=d.params.parentSql+d.whereSql,delete d.whereSql),d.hideHeaders=!0;d.nodeRenderer=function(e,t,i){var a=i.data,n=a.bean.APP_TYPE;-1!=["login","home","chart","report","plugin","plugin_cloud","func","link"].indexOf(n)&&(n=n.split("_")[0],a.iconCls="link"==n?"jeicon jeicon-lightning-on":"JE_APP_"+n.toUpperCase());var o=a.bean.APP_VERSION;return e+(o=JE.isNotEmpty(o)?'<span style="padding-left:10px;color:#ccc;">'+o+"</span>":"")},d.useSSWin||(d.tools=[{type:"collapse",callback:function(e,t,i){var a=t.type;e[a+"All"](),t.setType("expand"==a?"collapse":"expand")}}],d.columns=[{xtype:"treecolumn",flex:1,dataIndex:"text"},{text:"升级",xtype:"actioncolumn",width:20,items:[{tooltip:"快速发布",tooltipType:"title",handler:function(e,t,i){e.panel;var a=e.getStore().getAt(t),n=a.get("bean"),o=JE.toNum(n.APP_VERSION);o++,JE.ajax({url:JE.getUrlMaps("je.core.phone.phone","doVersion"),params:{tableCode:"JE_PHONE_APPVERSION",appType:n.APP_TYPE,appId:n.JE_PHONE_APP_ID,version:o,APPVERSION_VERSION:o,APPVERSION_APP_ID:n.JE_PHONE_APP_ID}}),JE.msg("发布成功！");var r=d.mainview.getCmp("center").getCmp(n.APP_TYPE),l=r.getCmp("cfgview"),s=r.getCmp("versionview");n.APP_VERSION=o,a.set("bean",n),a.commit(),r.record==a&&(r.record=a,l&&l.form.findField("APP_VERSION").setValue(o),s&&s.store.reload())},getClass:function(e,t,i){return-1==["chart","report","func","link"].indexOf(i.get("bean").APP_TYPE)?"je-grid-actioncolumn-itemhidden":"jeicon jeicon-arrow-up"}}]}],d.rbar={xtype:"toolbar",itemId:"buttonBar",defaults:{disabled:!0,tooltipType:"title"},items:[{tooltip:"添加",disabled:!1,iconCls:"jeicon jeicon-new-fine-plus-circle",itemId:"add"},{tooltip:"复制",iconCls:"jeicon jeicon-chart-copy",itemId:"copy"},{tooltip:"预览",iconCls:"jeicon jeicon-form-adjustment",itemId:"preview"},{tooltip:"删除",iconCls:"jeicon jeicon-error-circle",itemId:"remove"},"-",{tooltip:"导出升级包",iconCls:"jeicon jeicon-compress-static",disabled:!1,apkId:e,itemId:"export"},{tooltip:"导入升级包",iconCls:"jeicon jeicon-import",disabled:!1,apkId:e,itemId:"import"},{tooltip:"刷新",iconCls:"fa fa-refresh",disabled:!1,apkId:e,itemId:"refresh"}]},d.buildDD()),d.callParent(arguments)},buildDD:function(){this.viewConfig={plugins:[{ptype:"treeviewdragdrop",allowParentInserts:!0}],getRowClass:function(e){return"login"==e.get("bean").APP_TYPE?"je-display-none":""},listeners:{beforedrop:function(e,t,i,a,n){t.append=!1,t.order=!1,"append"==a?t.records[0].parentNode.getId()==i.getId()?n.cancelDrop():t.append=!0:(t.records[0].parentNode.getId()==i.parentNode.getId()||(t.append=!0),t.order=!0)},drop:function(e,t,i,a,n){var o=this.panel,r="JE_PHONE_APP_ID",l="JE_PHONE_APP",s={success:!0},d=t.records[0];if(t.append){var c=t.order?i.parentNode:i,u={tableCode:l,SY_PARENT:c.getId(),oldParentId:d.get("parent"),SY_PATH:c.getPath(),SY_LAYER:c.getDepth()+1};if(u[r]=d.getId(),(s=JE.ajax({url:JE.getUrlMaps("je.core.phone.phone","doTreeNodeMove"),params:u})).success){var p=s.obj;d.set("nodePath",p.SY_PATH),d.set("parent",p.SY_PARENT),d.commit()}else JE.alert(s.obj)}if(t.order&&s.success){var f=[];i.parentNode.eachChild(function(e){var t={};t[r]=e.get("id"),t.SY_ORDERINDEX=e.get("index")+1,e.set("orderIndex",t.SY_ORDERINDEX),f.push(t)}),s=JE.ajax({url:JE.getUrlMaps("je.core.updateList"),params:{strData:Ext.encode(f),tableCode:l}})}s.success?(o.getSelectionModel().deselectAll(),o.fireEvent("selectionchange",o.getSelectionModel(),[]),JE.msg("操作完成")):JE.alert(s.obj)}}}},getApkModel:function(){return this.ownerCt.record}}),Ext.define("JE.sys.phone.view.app.CenterView",{extend:"Ext.panel.Panel",alias:"widget.phone.centerview",layout:"card",initComponent:function(){this.items=[{xtype:"box",itemId:"temp",style:"border:1px solid #99bce8;"},{xtype:"phone.funcmain",itemId:"func"},{xtype:"phone.pluginmain",itemId:"plugin"},{xtype:"phone.chartmain",itemId:"chart"},{xtype:"phone.homemain",itemId:"home"},{xtype:"phone.reportmain",itemId:"report"},{xtype:"phone.loginmain",itemId:"login"},{xtype:"phone.linkmain",itemId:"link"},{xtype:"phone.cloudmain",itemId:"plugin_cloud"},{xtype:"phone.pluginmain",itemId:"plugin"}],this.callParent(arguments)}}),Ext.define("JE.sys.phone.view.app.MainView",{extend:"Ext.panel.Panel",border:0,layout:"border",alias:"widget.phone.mainview",initComponent:function(){this.items=[{xtype:"phone.appview",region:"west",mainview:this,itemId:"appview",apkId:this.record.get("JE_PHONE_APK_ID"),split:!0,title:"功能",collapsible:!0,width:240},{xtype:"phone.centerview",region:"center",mainview:this,border:0,margin:"0 0 0 2",itemId:"center"}],this.callParent(arguments)}}),Ext.define("JE.sys.phone.view.app.VersionView",{extend:"Ext.grid.Panel",alias:"widget.phone.version",border:0,iconCls:"jeicon jeicon-history-o",itemId:"versionview",title:"版本",columnLines:!0,initComponent:function(){var e=this;e.tbar=[],e.store=JE.getStore({tableName:"JE_PHONE_APPVERSION",id:"JE_PHONE_APPVERSION_ID",autoLoad:!1,params:{whereSql:" and 1 != 1",orderSql:" order by SY_CREATETIME DESC "}}),(e.store.gridObj=e).relayEvents(e.store,["beforeload","load"]),e.bbar={xtype:"pagingtoolbar",itemId:"pagingtoolbar",store:e.store,displayInfo:!0,defaults:{clearButton:!1}},e.columns=[{text:"版本",dataIndex:"APPVERSION_VERSION",width:80},{text:"发布人",dataIndex:"SY_CREATEUSER",width:100},{text:"说明",dataIndex:"APPVERSION_REMARK",flex:1},{text:"发布时间",dataIndex:"SY_CREATETIME",width:200}],e.callParent(arguments)},loadData:function(e){if(JE.isEmpty(e))JE.msg("APP不存在！");else{var t=this.store,i=" AND APPVERSION_APP_ID = '"+e+"'";this.appId=e,t.proxy.extraParams.whereSql=i,t.load()}}}),Ext.define("JE.sys.phone.view.chart.MainView",{extend:"Ext.tab.Panel",alias:"widget.phone.chartmain",initComponent:function(){this.defaults={bodyStyle:"background-color:#ffffff;",mainview:this,tbar:{xtype:"toolbar",itemId:"buttonBar",items:[{text:"保存",iconCls:"jeicon jeicon-save",itemId:"update"}]}},this.items=[{xtype:"phone.chartcfg",title:"图表"},{xtype:"phone.version"}],this.callParent(arguments),this.cfgview=this.getCmp("cfgview"),this.versionview=this.getCmp("versionview")},afterRender:function(){this.callParent(arguments)},loadData:function(e){var t=e.get("bean");this.record=e,this.cfgview.form.setValues(t),this.versionview.loadData(t.JE_PHONE_APP_ID)}}),Ext.define("JE.sys.phone.view.cloud.CfgView",{extend:"JE.sys.phone.view.app.CfgView",alias:"widget.phone.cloudcfg",initComponent:function(){this.versionBtn=!1,this.appNum=!1,this.items=[{fieldLabel:"云插件",xtype:"uxdisplayfield",name:"APP_PLUGIN_CLOUD_CODE",columnWidth:.45},{xtype:"hidden",name:"APP_PLUGIN_CLOUD_ID"}],this.callParent(arguments)}}),Ext.define("JE.sys.phone.view.cloud.MainView",{extend:"Ext.tab.Panel",alias:"widget.phone.cloudmain",initComponent:function(){this.defaults={bodyStyle:"background-color:#ffffff;",mainview:this,tbar:{xtype:"toolbar",itemId:"buttonBar",items:[{text:"保存",iconCls:"jeicon jeicon-save",itemId:"update"}]}},this.items=[{xtype:"phone.cloudcfg",title:"云插件"}],this.callParent(arguments),this.cfgview=this.getCmp("cfgview")},afterRender:function(){this.callParent(arguments)},loadData:function(e){var t=e.get("bean");this.record=e,this.cfgview.form.setValues(t)}}),Ext.define("JE.sys.phone.view.func.ButtonView",{extend:"Ext.form.Panel",alias:"widget.phone.funcbutton",layout:"fit",border:0,initComponent:function(){this.items=[{actionColumnIndex:0,xtype:"jsonarrayfield",itemId:"buttons",insertFn:function(e){e.store.add({id:JE.uuid()})},columns:[{dataIndex:"text",text:"名称",width:200},{dataIndex:"code",text:"编码",width:200},{dataIndex:"type",text:"类型",width:100,value:"GRID",field:{xtype:"cbbfield",dataArray:[{code:"FORM",text:"表单"},{code:"FORMITEM",text:"表单内部"},{code:"GRID",text:"列表"},{code:"GRIDITEM",text:"列表内部"}]},renderer:function(e){return Ext.value({FORM:"表单",FORMITEM:"表单内部",GRID:"列表",GRIDITEM:"列表内部"}[e],"")}},{dataIndex:"disable",text:"禁用",width:40,xtype:"uxcheckcolumn"},{dataIndex:"noReadOnly",text:"不受控",width:50,xtype:"uxcheckcolumn"},{dataIndex:"id",hidden:!0}]}],this.callParent(arguments)},afterRender:function(){this.callParent(arguments),this.getCmp("buttons").grid.setBorder(0)}}),Ext.define("JE.sys.phone.view.func.CfgView",{extend:"JE.sys.phone.view.app.CfgView",alias:"widget.phone.funccfg",initComponent:function(){this.items=[{fieldLabel:"功能Action",name:"APP_FUNC_ACTION"},{fieldLabel:"启用工作流",name:"APP_FUNC_USEWF",xtype:"yesnofield"},{fieldLabel:"禁止编辑",name:"APP_FUNC_DISABLEEDIT",xtype:"yesnofield"},{fieldLabel:"无菜单功能",name:"APP_NOMENU",xtype:"yesnofield"},{fieldLabel:"功能首页",name:"APP_FUNC_HOMEPAGE",xtype:"rgroup",value:"LIST",dataArray:[{text:"列表",code:"LIST"},{text:"表单",code:"FORM"}]},{fieldLabel:"表单标题",name:"APP_FUNC_FORMTITLE"},{fieldLabel:"列表标题",name:"APP_FUNC_LISTTITLE"},{fieldLabel:"每页条数",name:"APP_FUNC_PAGESIZE",xtype:"numberfield",value:10,minValue:1,maxValue:50},{fieldLabel:"数据源URL",name:"APP_LIST_LOADACTION"},{fieldLabel:"过滤条件",name:"APP_FUNC_WHERESQL",xtype:"textarea"},{fieldLabel:"排序条件",name:"APP_FUNC_ORDERSQL",xtype:"textarea"},{fieldLabel:"依赖字典",name:"APP_FUNC_DICS",xtype:"gridssareafield",height:65,configInfo:"JE_CORE_DICTIONARY,APP_FUNC_DICS,DICTIONARY_DDCODE,M",whereSql:" AND DICTIONARY_DDTYPE='LIST'"}],this.callParent(arguments)}}),Ext.define("JE.sys.phone.view.func.FieldCfgView",{extend:"Ext.form.Panel",alias:"widget.phone.funcfieldcfg",autoScroll:!0,layout:"column",bodyPadding:"4",margin:"1 0 0 0",initComponent:function(){var r=this;r.defaults={columnWidth:.9,labelAlign:"right",margin:"0 0 2 0",labelWidth:80};var e=Ext.clone(r.defaults);e.isFormField=!1,e.columnWidth=1,r.xtypes=[{code:"textfield",text:"文本框"},{code:"textarea",text:"文本域"},{code:"numberfield",text:"数字"},{code:"rgroup",text:"单选"},{code:"cgroup",text:"多选"},{code:"datetimefield",text:"日期时间"},{code:"datefield",text:"日期"},{code:"datemonthfield",text:"月份"},{code:"timefield",text:"时间"},{code:"treessfield",text:"树形选择"},{code:"gridssfield",text:"查询选择"},{code:"queryuserfield",text:"人员构造器"},{code:"textcode",text:"编号"},{code:"ckeditor",text:"HTML编辑器"},{code:"displayfield",text:"展示字段"},{code:"imagefile",text:"单图片"},{code:"image",text:"多图片"},{code:"range",text:"滑块"},{code:"switch",text:"开关"},{code:"password",text:"密码"},{code:"button",text:"按钮"},{code:"link",text:"超链接"},{code:"childfuncfield",text:"子功能集合"},{code:"child",text:"子功能"}],r.items=[{xtype:"textfield",fieldLabel:"编码",allowBlank:!1,readOnly:!0,name:"APPFIELD_CODE"},{xtype:"textfield",fieldLabel:"名称",allowBlank:!1,name:"APPFIELD_NAME"},{xtype:"cbbfield",configInfo:"JE_FUNC_XTYPE",fieldLabel:"类型",allowBlank:!1,dataArray:r.xtypes,defaultListConfig:{loadingHeight:10},name:"APPFIELD_XTYPE",listeners:{change:function(e,t,i){var a=r.form.findField("APPFIELD_CODE");a.setVisible(-1==["button","link"].indexOf(t)),a.setReadOnly(-1==["button","link","child","childfuncfield"].indexOf(t))}}},{xtype:"panel",border:0,layout:"column",bodyStyle:r.bodyStyle,defaults:{columnWidth:1,labelAlign:"right",margin:"0 0 2 0",labelWidth:80},itemId:"basiccfg",items:[{xtype:"cbbfield",fieldLabel:"默认值",name:"APPFIELD_VALUE",editable:!0,configInfo:"JE_DEFAULEVALUE,value,code,S"},{xtype:"textfield",fieldLabel:"输入提示",name:"APPFIELD_EMPTYTEXT"},{xtype:"yesnofield",fieldLabel:"隐藏标签",name:"APPFIELD_HIDELABEL"},{xtype:"yesnofield",fieldLabel:"可选可编辑",name:"APPFIELD_EDITABLE",unitTpl:"查询选择可用"},{xtype:"numberfield",fieldLabel:"高度",minValue:0,step:5,name:"APPFIELD_HEIGHT"},{xtype:"colorfield",fieldLabel:"标签颜色",name:"APPFIELD_LABELCOLOR"},{xtype:"textfield",fieldLabel:"后缀",name:"APPFIELD_UNITTPL"},{xtype:"textfield",fieldLabel:"绑定表达式",name:"APPFIELD_BINDING"},{xtype:"textfield",fieldLabel:"显隐表达式",name:"APPFIELD_INTERPRETER"},{xtype:"textfield",fieldLabel:"只读表达式",name:"APPFIELD_READONLYEXP"},{xtype:"textfield",fieldLabel:"为空表达式",name:"APPFIELD_ALLOWBLANKEXP"},{xtype:"textarea",fieldLabel:'<span style="cursor: pointer;color:blue;" title="窗口编辑">配置信息</span>',height:150,name:"APPFIELD_CONFIGINFO"},{xtype:"textfield",useExpFunc:!0,fieldLabel:"可选表达式",name:"APPFIELD_ENABLEEXP"},{xtype:"textfield",fieldLabel:"可选提示语",name:"APPFIELD_ENABLETIP"},{xtype:"textarea",fieldLabel:"过滤条件",name:"APPFIELD_WHERESQL"},{xtype:"jsonfield",fieldLabel:"辅助配置",keyWidth:.5,valueWidth:.5,name:"APPFIELD_OTHERCONFIG"}]},{xtype:"panel",border:0,layout:"column",hidden:!0,defaults:e,itemId:"buttoncfg",bodyStyle:r.bodyStyle,items:[{xtype:"cbbfield",fieldLabel:"表单按钮",emptyText:"从按钮->表单内部中选择",name:"button",listConfig:{getInnerTpl:function(e){return"{code}({text})"}},displayField:"code",configInfo:",button~buttonId~APPFIELD_NAME,code~id~text,S",listeners:{beforequery:function(e){var t=r.up("panel[xtype=phone.funcmain]").record.get("bean"),i=e.combo;i.store.removeAll();var a=Ext.decode(Ext.value(t.APP_FUNC_BUTTONS,"[]")),n=[];if(Ext.each(a,function(e){"FORMITEM"==e.type&&n.push({code:e.code,text:e.text,id:e.id})}),0==n.length)return!1;i.store.add(n)},select:function(e,t){var i=t[0];i&&(r.getCmp("buttoncfg").getCmp("buttonId").setValue(i.data.id),r.form.findField("APPFIELD_NAME").setValue(i.data.text))},reset:function(){r.getCmp("buttoncfg").getCmp("buttonId").setValue("")}}},{xtype:"hidden",name:"buttonId",itemId:"buttonId"},{xtype:"colorfield",fieldLabel:"字体",name:"fontcolor"},{xtype:"colorfield",fieldLabel:"背景",name:"bgcolor"}]},{xtype:"panel",border:0,layout:"column",hidden:!0,defaults:e,bodyStyle:r.bodyStyle,itemId:"linkcfg",items:[{xtype:"jsonarrayfield",height:135,columnWidth:1,fieldLabel:"链接",name:"links",insertFn:function(e){5!=e.store.getCount()?e.store.add({open:"page"}):JE.alert("只能添加五个链接")},columns:[{dataIndex:"text",text:"文字",width:80},{dataIndex:"link",text:"链接",flex:1},{dataIndex:"fontcolor",text:"颜色",width:40,editor:{xtype:"colorfield"},renderer:function(e,t){return t.tdAttr=' style="background-color:'+e+';" ',""}},{dataIndex:"open",text:"打开方式",width:80,editor:{xtype:"cbbfield",value:"page",dataArray:[{text:"新页面",code:"page"},{text:"弹出层",code:"div"},{text:"第三方系统",code:"app"}]},renderer:function(e){return{page:"新页面",div:"弹出层",app:"第三方系统"}[e]||""}}]}]},{xtype:"panel",border:0,layout:"column",hidden:!0,defaults:e,bodyStyle:r.bodyStyle,itemId:"childfunccfg",items:[{xtype:"hidden",name:"funcId",itemId:"funcId"},{xtype:"uxtrigger",trigger2Cls:"x-form-tree-trigger",fieldLabel:"子功能",name:"funcCode",itemId:"funcCode",handler:function(a){var e=r.up("panel[xtype=phone.funcmain]").record.get("bean"),t=e.APP_APK_ID,o=e.APP_CODE;JE.win({title:"功能",width:300,height:600,border:0,autoShow:!0,useButton:!0,items:{xtype:"jetreeview",type:"func",url:JE.getUrlMaps("je.core.getTree"),funcData:{info:{funcType:"tree"}},nodeRenderer:function(e,t,i){var a=i.data,n=a.bean.APP_TYPE;return"func"==n&&(a.iconCls="JE_APP_"+n.toUpperCase(),a.bean.APP_CODE==o&&(e='<span style="color:#ccc;">'+e+"</span>")),e},params:{tableCode:"JE_PHONE_APP",parentSql:" and APP_APK_ID = '"+t+"'",whereSql:" and APP_APK_ID = '"+t+"' and APP_TYPE in('func','folder')",moreRoot:!0},listeners:{itemdblclick:function(e){var t=e.panel.ownerCt;0!=t.fn(t)&&t.close()}}},fn:function(e){var t=e.getCmp(0).getSelectionModel().getSelection()[0];if(t){if(o==t.get("code"))return JE.alert("本功能不能选择！"),!1;a.setValue(t.get("code")),r.getCmp("childfunccfg").getCmp("funcId").setValue(t.get("id")),r.form.findField("APPFIELD_NAME").setValue(t.get("text"))}},showFn:function(e){var t=e.getCmp(0),i=t.getRootNode().findChild("code",a.getValue(),!0);i&&t.selectPath(i.getPath())}})}},{fieldLabel:"字段配置",xtype:"jsonarrayfield",height:140,name:"fields",columns:[{dataIndex:"field",text:"字段",flex:1,field:{xtype:"uxtrigger",trigger2Cls:"x-form-tree-trigger",handler:function(e){var t=r.up("panel[xtype=phone.funcmain]").record.get("bean"),i=e.ownerCt.grid;JE.win({title:"字段",width:300,height:600,border:0,useButton:!0,items:{xtype:"phone.funcfield",dataType:"search",appBean:t},autoShow:!0,fn:function(e){var t=e.getCmp(0).getSelectionModel().getSelection()[0];t&&i.getSelectionModel().getSelection()[0].set("field",t.get("bean").APPFIELD_CODE)}})}}},{dataIndex:"childfield",text:"子功能字段",flex:1,field:{xtype:"uxtrigger",trigger2Cls:"x-form-tree-trigger",handler:function(e){var i=e.ownerCt.grid,t=r.getCmp("childfunccfg").getCmp("funcCode").getValue(),a=r.up("panel[xtype=phone.mainview]").getCmp("appview").getRootNode().findChild("code",t,!0);if(JE.isEmpty(t)||JE.isEmpty(a))JE.alert("子功能不存在，请检查！");else{var n=a.get("bean");JE.win({title:"子功能字段",width:300,height:600,border:0,useButton:!0,items:{xtype:"phone.funcfield",dataType:"search",appBean:n},autoShow:!0,fn:function(e){var t=e.getCmp(0).getSelectionModel().getSelection()[0];t&&i.getSelectionModel().getSelection()[0].set("childfield",t.get("bean").APPFIELD_CODE)}})}}}},{text:"传值",dataIndex:"value",width:40,xtype:"uxcheckcolumn"},{dataIndex:"whereSql",text:"关联关系",width:80,tactics:[{bgCss:!0,type:"dic",dicCode:"JE_ASSOCIATION"}],renderer:JE.renderer,field:{xtype:"cbbfield",configInfo:"JE_ASSOCIATION",value:"="}}]},{xtype:"yesnofield",fieldLabel:"禁用",name:"disable"},{xtype:"yesnofield",fieldLabel:"不受控",name:"nocontrol"},{xtype:"colorfield",fieldLabel:"字体",name:"fontcolor"},{xtype:"colorfield",fieldLabel:"背景",name:"bgcolor"}]},{xtype:"rgroup",fieldLabel:"内容位置",value:"left",name:"APPFIELD_TEXTALIGN",configInfo:"JE_CORE_ALIGN"},{fieldLabel:"分隔符",xtype:"jsonarrayfield",height:80,actionColumn:!1,name:"APPFIELD_SEPARATORS",columns:[{dataIndex:"position",text:"位置",width:40,editable:!1,renderer:function(e){return"top"==e?"上":"下"}},{dataIndex:"text",text:"内容",flex:1},{dataIndex:"enable",xtype:"uxcheckcolumn",text:"启用",width:40}]}],r.callParent(arguments)},afterRender:function(){this.callParent(arguments)},loadData:function(e){var i=this,t=e.APPFIELD_XTYPE;t=-1!=["child","childfuncfield"].indexOf(t)?"childfunc":t;var a=i.getCmp(t+"cfg")||i.getCmp("basiccfg"),n=i.form.findField("APPFIELD_XTYPE");if(Ext.each(["buttoncfg","linkcfg","childfunccfg","basiccfg"],function(e){var t=i.getCmp(e);t.setVisible(t.itemId==a.itemId),n.setReadOnly("basiccfg"!=a.itemId)}),i.form.setValues(e),"basiccfg"!=a.itemId){var o=Ext.decode(Ext.value(e.APPFIELD_CONFIGINFO,"{}"));a.items.each(function(e){e.setValue(o[e.name])})}},getData:function(){var e=this.form.findField("APPFIELD_XTYPE").getValue();if(-1!=["button","link","child","childfuncfield"].indexOf(e)){-1!=["child","childfuncfield"].indexOf(e)&&(e="childfunc");var t=this.getCmp(e+"cfg"),i={};t.items.each(function(e){i[e.name]=e.getValue()}),this.form.findField("APPFIELD_CONFIGINFO").setValue(Ext.encode(i))}return this.form.getValues()}}),Ext.define("JE.sys.phone.view.func.FieldSSConfig",{extend:"Ext.form.Panel",frame:!1,alias:"widget.phone.funcfieldssconfig",autoScroll:!0,layout:"column",bodyPadding:"2",initComponent:function(){var n=this,e=n.userQuery,t=[{xtype:"uxtrigger",trigger2Cls:"x-form-tree-trigger",name:"funcName",columnWidth:.3,editable:!1,readOnly:e,fieldLabel:"目标功能",handler:function(e){JE.win({title:"功能",width:300,height:600,border:0,items:{xtype:"phone.appview",useSSWin:!0,apkId:n.apkId,whereSql:"and APP_TYPE not in('home','login')",listeners:{itemdblclick:function(e){var t=e.panel.ownerCt;t.fn(t),t.close()}}},useButton:!0,autoShow:!0,fn:function(e){var t=e.getCmp(0).getSelectionModel().getSelection()[0],i={funcId:"",funcName:"",funcCode:""};t&&(i={funcId:t.get("id"),funcName:t.get("text"),funcCode:t.get("code")}),n.form.setValues(i)},showFn:function(e){var t=n.form.findField("funcCode").getValue();if(!JE.isEmpty(t)){var i=e.getCmp(0),a=i.getRootNode().findChild("code",t,!0);a&&i.getSelectionModel().select(a,!0,!0)}}})},configInfo:"JE_CORE_FUNCINFO,funcName~funcCode~funcId,FUNCINFO_FUNCNAME~FUNCINFO_FUNCCODE~JE_CORE_FUNCINFO_ID,S",whereSql:" AND SY_JESYS='1'"},{xtype:"textfield",name:"funcCode",columnWidth:.3,hidden:e,fieldLabel:"功能编码",readOnly:!0},{xtype:"cbbfield",name:"selModel",columnWidth:.3,fieldLabel:"选择模式",dataArray:[{code:"S",text:"单选"},{code:"M",text:"多选"}]}];t.push({xtype:"textarea",name:"whereSql",columnWidth:1,fieldLabel:"过滤条件"}),n.items=[{xtype:"fieldset",columnWidth:1,title:"基本信息",layout:"column",defaults:{labelAlign:"right",labelWidth:60,margin:"0 0 2 0"},items:t},{xtype:"jsonarrayfield",title:"目标功能字段",columnAlign:"left",name:"codes",height:300,defaultEditor:{xtype:"textfield",readOnly:!0},columns:[{dataIndex:"name",flex:.5,text:"目标功能字段"},{dataIndex:"code",flex:.5,text:"字段编码"},{dataIndex:"pkName",width:40,xtype:"uxcheckcolumn",align:"center",text:"唯一"}],columnWidth:.5,insertFn:n.selectCols},{xtype:"jsonarrayfield",name:"selfCodes",columnAlign:"left",title:"本功能字段",height:300,defaultEditor:{xtype:"textfield",readOnly:!0},columns:[{dataIndex:"name",flex:.5,text:"本功能字段"},{dataIndex:"code",flex:.5,text:"字段编码"}],columnWidth:.49,margin:"0 0 2 2",insertFn:n.selectCols},{xtype:"hidden",name:"funcId"},{xtype:"hidden",name:"selfFuncId"}],n.callParent(arguments)},loadConfigInfo:function(e){var t=Ext.value(e.configInfo,"").replaceAll("\n","").split(",");this.fieldXtype=e.xtype;Ext.decode(Ext.value(e.otherConfig,"{}"));var i={funcCode:"",funcName:"",funcId:"",selfFuncId:e.funcId,selfCodes:Ext.isEmpty(t[1])?[]:t[1].split("~"),codes:Ext.isEmpty(t[2])?[]:t[2].split("~"),selModel:Ext.value(t[3],"S"),whereSql:Ext.value(e.whereSql,"")},a=t[0];if(JE.isNotEmpty(a)){var n=this.appview.getRootNode().findChild("code",a,!0);n&&(i.funcId=n.get("id"),i.funcName=n.get("text"),i.funcCode=n.get("code"))}Ext.isEmpty(i.selfCodes)||(i.selfCodes=this.getFuncCols(i.selfFuncId,i.selfCodes)),Ext.isEmpty(i.codes)||(i.codes=this.getFuncCols(i.funcId,i.codes)),this.form.setValues(i)},getConfigInfo:function(){if(!this.isValid())return!1;var e,t,i={},a=this.getValues(),n=[a.funcCode,[],[],a.selModel];Ext.each(Ext.decode(a.selfCodes),function(e){n[1].push(e.code)}),e=n[1].length,n[1]=n[1].join("~");var o=[];return Ext.each(Ext.decode(a.codes),function(e){n[2].push(e.code),JE.toBool(e.pkName)&&o.push(e.code)}),t=n[2].length,n[2]=n[2].join("~"),n=n.join(","),e!=t?(JE.alert("两组字段对应的条数不相同，请重新选择！"),!1):1<o.length?(JE.alert("字段唯一标识只能选择一个！"),!1):(i.pkName=o[0],{configInfo:n,otherConfig:Ext.encode(i),whereSql:a.whereSql})},selectCols:function(n){var e=this.ownerCt.form.getValues(),t="codes"==this.name?e.funcId:e.selfFuncId;Ext.isEmpty(t)?JE.alert("请先选择目标功能在进行字段添加！"):JE.win({title:"字段",width:300,height:600,border:0,useButton:!0,items:{xtype:"phone.funcfield",dataType:"list",multiSelect:!0,appBean:{JE_PHONE_APP_ID:t}},autoShow:!0,fn:function(e){var t=e.getCmp(0).getSelectionModel().getSelection(),i=[];Ext.each(t,function(e){!n.store.findRecord("code",e.get("code"))&&e.isLeaf()&&i.push({name:e.get("text"),code:e.get("code")})}),n.getStore().add(i)},showFn:function(e){var t=e.getCmp(0),i=t.getRootNode(),a=[];n.store.each(function(e){var t=i.findChild("code",e.get("code"),!0);t&&a.push(t)}),0<a.length&&t.getSelectionModel().select(a,!0,!0)}})},getFuncCols:function(e,t){var i=" and APPFIELD_APP_ID = '"+e+"' and APPFIELD_XTYPE not in ('fieldset','child','childfuncfield')",a=JE.ajax({url:JE.getUrlMaps("je.core.load"),params:{tableCode:"JE_PHONE_APPFIELD",whereSql:i,orderSql:" order by SY_ORDERINDEX ASC ",limit:-1}}).rows,n={};Ext.each(a,function(e){n[e.APPFIELD_CODE]={code:e.APPFIELD_CODE,name:e.APPFIELD_NAME}});var o=[];return Ext.each(t,function(e,t){Ext.isEmpty(n[e])||o.push(n[e])}),o}}),Ext.define("JE.sys.phone.view.func.FieldView",{extend:"JE.core.view.TreeView",alias:"widget.phone.funcfield",type:"func",codeSearch:!0,hideHeaders:!0,initComponent:function(){var l=this;l.appID=l.appBean.JE_PHONE_APP_ID,l.dockedItems=[{xtype:"toolbar",itemId:"buttonBar",items:[{text:"添加虚拟字段",iconCls:"jeicon jeicon-new-form",itemId:"addField"},{text:"同步数据",iconCls:"jeicon jeicon-table-column-synchronization",itemId:"loadData"},{text:"刷新",iconCls:"jeicon jeicon-refresh",itemId:"refresh"}]}],"search"==l.dataType&&delete l.dockedItems,l.columns=[{xtype:"treecolumn",flex:1,dataIndex:"text",renderer:function(e,t,i){if("formitem"==i.get("nodeType"))return e;"0"==(i.get("bean")||{}).APPFIELD_ALLOWBLANK&&(e='<span style="color:red;">*</span>'+e);var a=i.get("code");return e+'<span style="color:#ccc;" title="'+a+'">'+a+"</span>"}},{xtype:"actioncolumn",width:20,items:[{handler:function(e,t,i,a,n,o,r){l.removeIditNode(o)},getClass:function(e,t,i,a,n,o){var r="jeicon jeicon-error";return"idit"!=i.get("nodeType")&&(r="je-grid-actioncolumn-itemhidden"),r}}]}],"search"!=l.dataType&&(l.viewConfig={plugins:[{ptype:"treeviewdragdrop",enableDrop:!1,allowParentInserts:!0,ddGroup:l.dataType+"Group"}]}),"form"==l.dataType&&(l.viewConfig.getRowClass=function(e,t,i,a){var n="";return e.isLeaf()&&"formitem"!=e.get("nodeType")&&"1"!=e.get("bean").APPFIELD_HIDDEN&&(n="je-display-none"),n}),l.callParent(arguments),"search"==l.dataType&&l.on("itemdblclick",function(e){var t=l.ownerCt;t.isWindow&&t.fn&&0!=t.fn(t)&&t.close()})},afterRender:function(){this.callParent(arguments),"form"==this.dataType?this.mainview.formview.refreshFieldView():this.loadData(this.buildData())},removeIditNode:function(e){if(JE.ajax({url:JE.getUrlMaps("je.core","remove"),params:{ids:e.getId(),tableCode:"JE_PHONE_APPFIELD"}}).success){JE.msg("删除成功！");var t=e.get("bean");e.remove(),"form"==this.dataType&&(t.JE_PHONE_APPFIELD_ID="",this.mainview.formview.removeField(t))}},buildData:function(e){var t=" APPFIELD_TYPE"+("ORACLE"==JE.systemConfig.JE_SYS_DB?" IS NULL":" = '' "),i={form:" AND ("+t+" or APPFIELD_TYPE = 'form') and APPFIELD_XTYPE not in ('fieldset')",list:" AND ("+t+" or APPFIELD_TYPE = 'list') and APPFIELD_XTYPE not in ('fieldset','child','childfuncfield')",search:" AND APPFIELD_XTYPE not in ('fieldset','child','childfuncfield','displayfield','image')"}[this.dataType];e=e||[];JE.isEmpty(e)&&(i+=" and APPFIELD_APP_ID = '"+this.appID+"'",e=JE.ajax({url:JE.getUrlMaps("je.core.load"),params:{tableCode:"JE_PHONE_APPFIELD",whereSql:i,orderSql:" order by SY_ORDERINDEX ASC ",limit:-1}}).rows);var r=this.multiSelect,l={basic:[],sy:[],idit:[]};Ext.each(e,function(e){var t=e.APPFIELD_TYPE,i=e.JE_PHONE_APPFIELD_ID,a=e.APPFIELD_NAME,n=e.APPFIELD_CODE;if(-1==["button","link","childfuncfield","child"].indexOf(e.APPFIELD_XTYPE)){t=JE.isEmpty(t)?0==n.indexOf("SY_")?"sy":"basic":"idit";var o={id:i,text:a,code:n,leaf:!0,nodeType:t,bean:e};r&&(o.checked=!1),l[t].push(o)}});var a=[{text:"业务字段",id:"basic",expanded:!0,expandable:!0,leaf:!1,children:l.basic},{text:"系统字段",id:"sy",expandable:!0,leaf:!1,children:l.sy},{text:"自定义",id:"idit",expandable:!0,leaf:!1,children:l.idit}];return Ext.each(a,function(e){r&&(e.checked=!1)}),"form"==this.dataType&&a.unshift({text:"表单组件",expanded:!0,expandable:!0,leaf:!1,id:"formitem",children:[{id:JE.uuid(),text:"按钮",code:"button",leaf:!0,nodeType:"formitem"},{id:JE.uuid(),text:"超链接",code:"link",leaf:!0,nodeType:"formitem"},{id:JE.uuid(),text:"子功能",code:"child",leaf:!0,nodeType:"formitem"},{id:JE.uuid(),text:"子功能集合",code:"childfuncfield",leaf:!0,nodeType:"formitem"}]}),a}}),Ext.define("JE.sys.phone.view.func.FormMainView",{extend:"Ext.panel.Panel",alias:"widget.phone.funcformmain",layout:"border",padding:"1",border:0,initComponent:function(){this.items=[{xtype:"panel",bodyStyle:"border-width:0px;",layout:{type:"table",tableAttrs:{align:"center",height:"100%"},tdAttrs:{valign:"middle"},columns:1},region:"center",bodyPadding:10,border:0,itemId:"formcenter",autoScroll:!0,items:{xtype:"phone.funcform",itemId:"formview",mainview:this.mainview,width:300,height:700}},{xtype:"panel",layout:"card",border:0,region:"east",split:!0,width:300,itemId:"card",hidden:!0,items:[{xtype:"phone.funcfieldcfg",itemId:"fieldcfgview"}]}],this.callParent(arguments),this.getDockedCmp("buttonBar").add([{text:"资源库",iconCls:"jeicon jeicon-database",itemId:"fieldview"}]),this.formview=this.getCmp("formcenter").getCmp("formview")},afterRender:function(){this.callParent(arguments)},loadData:function(e){e.get("bean");var t=e.getId();this.formview.fieldStore.proxy.extraParams.whereSql=" and APPFIELD_XTYPE not in ('fieldset') and APPFIELD_APP_ID = '"+t+"'",this.formview.fieldStore.load()}}),Ext.define("JE.sys.phone.view.func.FormView",{extend:"Ext.panel.Panel",alias:"widget.phone.funcform",mixins:["JE.sys.phone.util.Util"],autoScroll:!0,layout:"column",bodyPadding:"5 0",initComponent:function(){var i=this;i.fieldset=!0,i.bodyStyle="border:1px solid #cecece;",i.dockedItems=[{dock:"top",xtype:"box",height:30,itemId:"titleBox",style:"line-height:25px;cursor:pointer;text-align:center;border:1px solid #cecece;border-width:1px 1px 0px 1px;background-color:#007aff;color:#ffffff;",html:"表单规划"}],i.fieldStore=JE.getStore({tableName:"JE_PHONE_APPFIELD",id:"APPFIELD_CODE",autoLoad:!1,params:{limit:-1,whereSql:" and 1!= 1",orderSql:" order by SY_ORDERINDEX ASC "}}),i.fieldStore.on("load",function(e){i.removeAll(!0);var t=i.buildDataView(e);i.add(t)}),i.callParent(arguments)},afterRender:function(){var e=this;e.callParent(arguments),e.titleEl=e.getDockedCmp("titleBox").getEl(),e.titleEl.on("click",function(){e.cardview.hide()}),e.indicator=new Ext.Component({html:e.indicatorHtml,cls:e.indicatorCls,style:"height:1px;",floating:!0,shadow:!1}),e.buildDrop(e)},refreshFieldView:function(e){var t=Ext.getCmp("__formfield");if(t)if(e){t.getSelectionModel().deselectAll();var i=t.getRootNode().findChild("code",e.APPFIELD_CODE,!0);if(i)(e=i.get("bean")).APPFIELD_HIDDEN="1",i.set("bean",e),i.commit()}else{var a=[];this.fieldStore.each(function(e){a.push(Ext.clone(e.data))}),t.loadData(t.buildData(a))}e&&this.cardview.hide()},addField:function(e){this.fieldStore.add(e)},removeField:function(e,t){var i=this.fieldStore,a=e.APPFIELD_CODE,n=this.fieldStore.getById(a),o=this.down("[itemId="+a+"]");o&&o.ownerCt.remove(o,!0),"hide"==(t=-1!=["button","link","childfuncfield","child"].indexOf(e.APPFIELD_XTYPE)?"remove":t)?this.refreshFieldView(e):i.remove(n)},doBeforeSave:function(e){var t=this.fieldcfgview,i=t.getData();if(JE.isNotEmpty(i.APPFIELD_CODE)){var a=this.fieldStore.getById(i.APPFIELD_CODE);if(a){a.set(i),t.currentField.updateView(i);var n=t.query("jsonarrayfield");Ext.each(n,function(e){e.commitValue()})}}e&&(t.currentField&&t.currentField.setBodyStyle("border-color","transparent"),(t.currentField=e).setBodyStyle("border-color","#007AFF"))},updateView:function(e,t){}}),Ext.define("JE.sys.phone.view.func.ListMainView",{extend:"Ext.panel.Panel",alias:"widget.phone.funclistmain",layout:"border",border:0,padding:"1",initComponent:function(){var t=this;t.items=[{xtype:"panel",layout:{type:"table",tableAttrs:{align:"center",height:"100%"},tdAttrs:{valign:"middle"},columns:1},border:0,itemId:"listcenter",width:340,region:"west",autoScroll:!0,items:{xtype:"phone.funclist",itemId:"listview",mainview:t.mainview,width:320,height:550}},{xtype:"jecodeeditor",itemId:"jsview",useHelp:!1,region:"center",border:0,saveFn:function(){var e=t.getDockedCmp("buttonBar").getCmp("update");e.fireEvent("click",e)}}],t.callParent(arguments),t.getDockedCmp("buttonBar").add([{text:"资源库",iconCls:"jeicon jeicon-database",itemId:"fieldview"}])},afterRender:function(){var l=this;l.callParent(arguments);var e=l.getCmp("jsview").getCmp("editorBox");e.dropTarget=new Ext.dd.DropTarget(e.getEl(),{ddGroup:"listGroup",notifyOver:function(e,t,i){var a=t.getTarget("div.monaco-editor",10);if(i.allowDD=!1,a){var n=i.records[0];n&&n.isLeaf()&&(i.allowDD=!0)}return i.allowDD?e.dropAllowed:e.dropNotAllowed},notifyDrop:function(e,t,i){var a=i.records[0];if(i.allowDD&&a){var n=a.get("bean").APPFIELD_CODE,o=l.getCmp("jsview").editor,r=o.getPosition();o.executeEdits("",[{range:{startLineNumber:r.lineNumber,startColumn:r.column,endLineNumber:r.lineNumber,endColumn:r.column},text:"{"+n+"}"}])}return i.allowDD}})},loadData:function(e){var t=e.get("bean");this.getCmp("listcenter").getCmp("listview").updateView(t);this.getCmp("jsview").setValue(Ext.value(t.APP_FUNC_RENDERER,"//根据列表数据，返回列表模板\nfunction(data){\n\t return '';\n}"))}}),Ext.define("JE.sys.phone.view.func.ListView",{extend:"Ext.panel.Panel",alias:"widget.phone.funclist",layout:"fit",autoScroll:!0,cls:"je-phone-list",initComponent:function(){this.tbar={xtype:"box",html:"数据模板展示",cls:"je-phone-list-header"},this.callParent(arguments)},afterRender:function(){this.callParent(arguments)},updateView:function(e,t){e.JE_PHONE_APP_ID,e.APP_CODE,e.APP_APK_ID;var i=[];if(JE.isNotEmpty(e.APP_FUNC_RENDERER)){var a=JE.eval(e.APP_FUNC_RENDERER);if(a){var n=Ext.value(e.APP_FUNC_ACTION,JE.getUrlMaps("je.core")),o=(n=JE.replaceOldUrl(n))+JE.getUrlMaps("method.load"),r=JE.ajax({url:o,params:{whereSql:JE.toXT(e.APP_FUNC_WHERESQL),orderSql:e.APP_FUNC_ORDERSQL,tableCode:e.APP_FUNC_TABLENAME,limit:5}}).rows;Ext.each(r,function(e){var t=JE.toXT(a(e),e);i.push('<div class="je-phone-list-item">'+t+"</div>")})}}i=0<i.length?i:['<div class="je-phone-list-emptytext">请在右侧维护数据模板</div>'],this.update(i.join(""))}}),Ext.define("JE.sys.phone.view.func.MainView",{extend:"Ext.tab.Panel",alias:"widget.phone.funcmain",initComponent:function(){var a=this;a.defaults={bodyStyle:"background-color:#ffffff;",mainview:a,tbar:{xtype:"toolbar",itemId:"buttonBar",items:[{text:"保存",iconCls:"jeicon jeicon-save",itemId:"update",formBind:!0}]}},a.tabBar={defaults:{listeners:{afterrender:function(i){i.getEl().on("dblclick",function(){var e=i.up("window");e.toggleMaximize();var t="expand";"list"==i.card.itemId&&(t=e.maximized?"collapse":"expand"),a.up("panel[xtype=phone.mainview]").getCmp("appview")[t]()})}}}};a.items=[{xtype:"phone.funccfg",title:"功能"},{xtype:"phone.funclistmain",title:"列表",iconCls:"jeicon jeicon-grid-configuration",itemId:"list"},{xtype:"phone.funcformmain",title:"表单",iconCls:"jeicon jeicon-form-configuration",itemId:"form"},{xtype:"phone.funcbutton",itemId:"buttonview",iconCls:"jeicon jeicon-button",title:"按钮"},{xtype:"phone.funcsearch",itemId:"searchview",iconCls:"jeicon jeicon-search",title:"查询项"},{xtype:"jecodeeditor",itemId:"jsview",iconCls:"jeicon jeicon-js",title:"JavaScript",helpType:"APP",saveFn:function(){var e=this.getDockedCmp("buttonBar").getCmp("update");e.fireEvent("click",e)}},{xtype:"jecodeeditor",itemId:"cssview",title:"CSS",useHelp:!1,iconCls:"jeicon jeicon-css",editorMode:"css",saveFn:function(){var e=this.getDockedCmp("buttonBar").getCmp("update");e.fireEvent("click",e)}},{xtype:"phone.version"}],a.callParent(arguments),a.formview=a.getCmp("form").getCmp("formcenter").getCmp("formview"),a.formview.cardview=a.getCmp("form").getCmp("card"),a.formview.fieldview=a.formview.cardview.getCmp("fieldview"),a.formview.fieldcfgview=a.formview.cardview.getCmp("fieldcfgview"),(a.formview.mainview=a).listview=a.getCmp("list").getCmp("listcenter").getCmp("listview"),a.listview.jsview=a.getCmp("list").getCmp("jsview"),a.listview.fieldview=a.getCmp("list").getCmp("fieldview"),(a.listview.mainview=a).buttonview=a.getCmp("buttonview"),a.searchview=a.getCmp("searchview"),a.jsview=a.getCmp("jsview"),a.cssview=a.getCmp("cssview"),a.cfgview=a.getCmp("cfgview"),a.versionview=a.getCmp("versionview")},afterRender:function(){this.callParent(arguments)},loadData:function(e){var t=e.get("bean");this.record=e,this.getCmp("list").loadData(e),this.getCmp("form").loadData(e),this.cfgview.form.setValues(t),this.buttonview.getCmp("buttons").setValue(t.APP_FUNC_BUTTONS),this.searchview.getCmp("searchs").setValue(t.APP_FUNC_SEARCHS);this.jsview.setValue(Ext.value(t.APP_FUNC_JS,"/**\n\t列表和表单共用，所声明的方法为全局方法，可以直接通过 方法名 或者 window.方法名 来调用\n\t事件注册：APP.listeners = {按钮编码:{},字段编码:{},list:{},form:{}};以下是事件名：\n\t\t按钮：beforeclick,click\n\t\t字段：reset(全部),beforequery,query(单选，多选，查询选择，树形选择，日期),beforeclick,afteredit(子功能)\n\t\t列表：itemclick,load,renderer\n\t\t表单：submit,activate,beforeactivate(参数是model，可以修改model值)\n*/\nAPP.listeners = {};\n")),this.cssview.setValue(Ext.value(t.APP_FUNC_CSS,"/*\n\t列表和表单共用\n*/\n")),this.versionview.loadData(t.JE_PHONE_APP_ID)}}),Ext.define("JE.sys.phone.view.func.SearchView",{extend:"Ext.form.Panel",alias:"widget.phone.funcsearch",layout:"fit",border:0,initComponent:function(){var t=this;t.items=[{actionColumnIndex:0,xtype:"jsonarrayfield",itemId:"searchs",insertFn:function(e){t.doAdd(this)},columns:[{dataIndex:"text",text:"查询项",width:200},{dataIndex:"code",text:"编码",width:200},{dataIndex:"show",text:"展示方式",width:100,field:{xtype:"cbbfield",value:"def",dataArray:[{code:"def",text:"原生"},{code:"tile",text:"平铺"}]},renderer:function(e){return Ext.value({def:"原生",tile:"平铺"}[e],"")}},{dataIndex:"search",text:"查询类型",width:100,field:{xtype:"cbbfield",value:"no",configInfo:"JE_CORE_COLUMNQUERYTYPE",dicItemCodes:["like","like%","=","no"]},tactics:[{type:"dic",dicCode:"JE_CORE_COLUMNQUERYTYPE"}],renderer:JE.renderer},{dataIndex:"visible",text:"展示",width:40,xtype:"uxcheckcolumn"},{dataIndex:"defHide",text:"默认收起",width:100,xtype:"uxcheckcolumn"}]}],t.callParent(arguments)},doAdd:function(o){JE.win({title:"资源库",width:300,height:600,border:0,useButton:!0,items:{xtype:"phone.funcfield",dataType:"search",multiSelect:!0,appBean:this.ownerCt.record.get("bean")},autoShow:!0,fn:function(e){var t=e.getCmp(0),i=o.grid.store,a=t.getSelectionModel().getSelection(),n=[];Ext.each(a,function(e){e.isLeaf()&&(i.findRecord("code",e.get("code"))||n.push({text:e.get("text"),code:e.get("code"),show:"def",search:"no",visible:"1"}))}),o.grid.store.add(n)}})},afterRender:function(){this.callParent(arguments),this.getCmp("searchs").grid.setBorder(0)}}),Ext.define("JE.sys.phone.view.func.TemplateView",{extend:"Ext.panel.Panel",alias:"widget.phone.functpl",mixins:["JE.sys.phone.util.ApkUtil"],autoScroll:!0,initComponent:function(){var t=this;t.store=Ext.create("Ext.data.Store",{fields:JE.appTpls.list_model,data:JE.appTpls.list}),t.items=Ext.create("Ext.view.View",{store:t.store,tpl:['<tpl for=".">','<div class="page" style="padding:5px;position: relative;float:left;border: 1px solid transparent;height:150px;width:85px;margin:10px 20px;text-align:center;cursor: pointer;">','<img width="64" height="110" src="http://jesaas.com/{[values.GRIDTEM_XGT.split(\'*\')[1]]}" />','<div style="text-align:center;word-break: break-all;">{GRIDTEM_MBM}</div>',"</div>","</tpl>"],itemSelector:"div.page",draggable:{delegate:"div.page"},emptyText:"",overItemCls:"x-dataview-item-over",selectedItemCls:"x-dataview-item-selected",listeners:{itemclick:function(e,t,i){JE.win({title:"模板（可根据需要自行拷贝代码）",items:{xtype:"phone.functplinfo",record:t},autoShow:!0})}}}),t.callParent(arguments),t.on("beforeexpand",function(){if(JE.isEmpty(JE.APK_SPM)){var e=t.up("panel[xtype=phone.mainview]").getCmp("appview").getApkModel().get("APK_TEXT");return t.getLicenseKey(e,function(){t.expand()}),!1}})},afterRender:function(){this.callParent(arguments)}}),Ext.define("JE.sys.phone.view.func.TplInfoView",{extend:"Ext.panel.Panel",alias:"widget.phone.functplinfo",layout:"border",border:0,initComponent:function(){var e=this.record,t=e.get("GRIDTEM_MBM"),i=e.get("GRIDTEM_HTML"),a=e.get("GRIDTEM_JS"),n=e.get("GRIDTEM_CSS"),o="http://jesaas.com/"+e.get("GRIDTEM_XGT").split("*")[1];this.defaults={border:0},this.items=[{xtype:"panel",region:"west",width:300,bodyStyle:"text-align:center;padding:20px 10px;",html:'<img src="'+o+'" width="100%">',title:t},{xtype:"tabpanel",region:"center",defaults:this.defaults,items:[{xtype:"jecodeeditor",itemId:"htmlview",iconCls:"jeicon jeicon-js",title:"核心代码html",value:i,useHelp:!1},{xtype:"jecodeeditor",itemId:"jsview",iconCls:"jeicon jeicon-js",title:"依赖脚本js",value:a,useHelp:!1},{xtype:"jecodeeditor",itemId:"cssview",title:"依赖样式css",useHelp:!1,iconCls:"jeicon jeicon-css",value:n,editorMode:"css"}]}],this.callParent(arguments)}}),Ext.define("JE.sys.phone.view.home.BasicCfgView",{extend:"Ext.form.Panel",alias:"widget.phone.homebasiccfg",autoScroll:!0,layout:"column",bodyPadding:"4",border:0,initComponent:function(){var t=this;t.tbar={itemId:"buttonBar",items:[{text:"返回",iconCls:"return",itemId:"back",handler:function(){t.ownerCt.doBack()}}]},t.defaults={labelAlign:"right",labelWidth:120,columnWidth:.9,margin:"1",xtype:"textfield"},t.items=[{fieldLabel:"【顶部】标题",name:"title"},{fieldLabel:"标题背景色",xtype:"colorfield",name:"titleBGColor"},{fieldLabel:"标题隐藏",xtype:"yesnofield",name:"hideTitle",columnWidth:.5},{fieldLabel:"【顶部右侧】图标",name:"rightupBtniconfont",xtype:"gridssfield",configInfo:"JE_CORE_FONTICON,rightupBtniconfont,FONTICON_CLS,S,"},{fieldLabel:"图标颜色",xtype:"colorfield",name:"rightupBtncolor"},{fieldLabel:"图标功能",itemId:"rightupBtn",name:"rightupBtn",xtype:"cbbfield",configInfo:",rightupBtn,text,S",buildQueryData:function(){this.store.loadData([{text:"退出",code:"exit"},{text:"新页",code:"_blank"}])}},{fieldLabel:"图标原图",xtype:"yesnofield",name:"rightupiconSVG"},{fieldLabel:"首页类型",name:"type",readOnly:"true",value:"home",dataArray:[{code:"home",text:"首页"},{code:"shortcut",text:"快捷菜单"},{code:"plugin",text:"插件"}]},{fieldLabel:"【顶部左侧】图标",name:"leftupBtniconfont",xtype:"gridssfield",configInfo:"JE_CORE_FONTICON,leftupBtniconfont,FONTICON_CLS,S,"},{fieldLabel:"图标颜色",xtype:"colorfield",name:"leftupBtncolor"},{fieldLabel:"图标功能",itemId:"leftupBtn",name:"leftupBtn",xtype:"cbbfield",configInfo:",leftupBtn,text,S",buildQueryData:function(){this.store.loadData([{text:"退出",code:"exit"},{text:"新页",code:"_blank"}])}},{fieldLabel:"图标原图",xtype:"yesnofield",name:"leftupiconSVG"},{fieldLabel:"【底部】标题",name:"footerTitle"},{fieldLabel:"图标",name:"footerBtniconfont",xtype:"gridssfield",configInfo:"JE_CORE_FONTICON,footerBtniconfont,FONTICON_CLS,S,"},{fieldLabel:"图标颜色",xtype:"colorfield",name:"footerBtncolor"},{fieldLabel:"图标原图",xtype:"yesnofield",name:"footericonSVG"},{fieldLabel:"【首页】隐藏",xtype:"yesnofield",name:"hidePage",columnWidth:.5},{fieldLabel:"依赖首页",itemId:"relyOn",name:"relyOn",xtype:"cbbfield",configInfo:",relyOn,text,S",buildQueryData:function(){var i=[],e=t.up("[xtype=phone.homemain]").getCmp("center").pageBody.items.items;Ext.each(e,function(e){var t=e.itemData;"home"==t.type&&i.push({code:t.code,text:t.cfg?t.cfg.title:t.title})}),this.store.loadData(i)}},{fieldLabel:"插件",name:"plugin",itemId:"pluginText",xtype:"uxtrigger",value:"",trigger2Cls:"x-form-tree-trigger",handler:function(){t.addFunc()}},{fieldLabel:"插件code",name:"pluginCode",itemId:"pluginCode",value:"",xtype:"hidden"},{fieldLabel:"插件",name:"pluginid",itemId:"pluginid",value:"",xtype:"hidden"},{text:"删除",xtype:"button",itemId:"deletePanel",cls:"btn JEPLUS_B_C02",margin:"10 0 10 107",style:"width: 244px;",handler:function(){t.deletePanel()}}],t.callParent(arguments)},getData:function(){var e=this.form.getValues();return this.ownerCt.mainview.getActivePage().setTitleText(e.title),e},setData:function(e){this.form.setValues(e),this.ownerCt.mainview.getActivePage().setTitleText(e.title)},deletePanel:function(e){var t=this;JE.confirm("确定删除此首页面板吗？",function(e){"ok"==e&&t.ownerCt.deletePanel()})},addFunc:function(e){var i=this,t=(i.up("[xtype=phone.homeplanmain]").getActivePage().itemData.type,i.up("[xtype=phone.homeplanmain]").getCmp("plancenter").getCmp("pageBody").getLayout().getActiveItem(),i.buildFuncData()),a=i.up("panel[xtype=phone.homemain]").record.get("bean").APP_APK_ID;JE.win({title:"插件",width:300,height:600,border:0,items:{xtype:"phone.appview",useSSWin:!0,apkId:a,whereSql:"and APP_TYPE not in('home','login')",funcs:t,multiSelect:!1,viewConfig:{getRowClass:function(e,t,i,a){return-1==this.panel.funcs.indexOf(e.get("code"))?"":"je-display-none"}}},useButton:!0,autoShow:!0,fn:function(e){var t=e.getCmp(0).getSelectionModel().getSelection();Ext.each(t,function(e){var t=e.get("bean").APP_TYPE;if(-1==["plugin","plugin_cloud"].indexOf(t))return JE.alert("请选择插件");i.getCmp("pluginid").setValue(e.data.id),i.getCmp("pluginText").setValue(e.data.text),i.getCmp("pluginCode").setValue(e.data.bean.APP_CODE)})}})},buildFuncData:function(){var t=this,i=[];return t.ownerCt.mainview.getActivePage().items.each(function(e){e!=t.ownerCt.itemPanel&&"menu"==e.itemData.type&&e.itemData.cfg&&Ext.each(e.itemData.cfg.funcs,function(e){"menu"==e.type?Ext.each(e.funcs,function(e){i.push(e.code)}):i.push(e.code)})}),t.basicFuncs&&(t.getCmp("menu").store.each(function(e){i.push(e.get("code"))}),Ext.each(t.basicFuncs,function(e){"menu"==e.type?e.code!=t.currentFolder&&Ext.each(e.funcs,function(e){i.push(e.code)}):i.push(e.code)})),i}}),Ext.define("JE.sys.phone.view.home.CfgView",{extend:"Ext.panel.Panel",alias:"widget.phone.homecfg",layout:"card",initComponent:function(){this.items=[{xtype:"phone.homemenucfg",itemId:"menu"},{xtype:"phone.homebasiccfg",itemId:"home"},{xtype:"phone.tplbasiccfg",itemId:"tpl"}],this.callParent(arguments)},doBack:function(e){var t=this.ownerCt;e&&delete this.itemPanel,this.saveCfg(e),t.getLayout().setActiveItem("itemview"),t.setWidth(110)},saveCfg:function(e){var t=this.itemPanel;if(t){var i=t.itemData.type,a=-1!=["home","shortcut","plugin"].indexOf(i);if(a)var n="home";else n="plugin"==i?"menu":i;var o=t.itemData.cfg=this.getCmp(n).getData(this.getDatatype());if(t.itemData.cfg.code=t.itemData.code,t.itemData.relyOn=t.itemData.cfg.relyOn,"home"==n)(r=this.up("[xtype=phone.homeplanmain]").getCmp("plancenter").getCmp("pageBar").getCmp(t.itemId)).setText(o.title),r.setIconCls(o.pageIcon),a||t.titleBox.update(o.text);else if("tpl"==i)t.titleBox.update("页面模板");else if("plugin"==i){var r;(r=this.up("[xtype=phone.homeplanmain]").getCmp("plancenter").getCmp("pageBar").getCmp(t.itemId)).setText(o.title),t.titleBox.update(o.title)}else t.titleBox.update(o.text)}},loadData:function(e){var t=Ext.apply(e.itemData,e.itemData.cfg?e.itemData.cfg:e.itemData),i=t.type,a=t||{menuType:t.type,title:t.title,colCount:4,rowCount:4};if(-1!=["home","shortcut","plugin"].indexOf(i))var n="home";else n="plugin"==i?"menu":i;this.saveCfg(),this.itemPanel=e,this.getLayout().setActiveItem(n),"plugin"==i&&(a.text=a.title),this.getCmp(n).setData(a)},deletePanel:function(){var e=this.up("[xtype=phone.homeplanmain]"),t=e.getCmp("plancenter").getCmp("pageBar"),i=e.getCmp("plancenter").getCmp("pageBody"),a=this.itemPanel.itemId;if(1==i.items.items.length)return JE.alert("需要保留一个首页！");Ext.each([t,i],function(e){var t=e.getCmp(a);e.remove(t)}),this.doBack(1)},getDatatype:function(){return"listmenu"==this.itemPanel.itemData.code?"listmenu":"plugin"==this.itemPanel.itemData.code?"plugin":""}}),Ext.define("JE.sys.phone.view.home.ItemView",{extend:"Ext.panel.Panel",alias:"widget.phone.homeitem",mixins:["JE.sys.phone.util.HomeUtil"],layout:"fit",border:0,bodyStyle:"background-color:#ffffff;",initComponent:function(){this.items=Ext.create("Ext.view.View",{itemId:"view",store:Ext.create("Ext.data.Store",{fields:["text","code","type","cls"],data:[]}),tpl:['<tpl for=".">','<div data-code="{code}" class="page" style="position: relative;float:left;display:table;height:70px;width:60px;margin:10px 20px;border: 1px solid #fff;cursor: pointer;">','<div class="{cls}"></div>','<div style="text-align:center;padding-bottom:5px;">{text}</div>',"</div>","</tpl>"],itemSelector:"div.page",emptyText:"",overItemCls:"x-dataview-item-over",selectedItemCls:"x-dataview-item-selected",trackOver:!0}),this.store=this.items.store,this.store.loadData([{text:"交换图",code:"image",type:"image",cls:"JE_APP_HOME_IMAGE"},{text:"菜单",code:"gridmenu",type:"menu",cls:"JE_APP_HOME_MENU"},{text:"大菜单",code:"bigmenu",type:"menu",cls:"JE_APP_HOME_MENU"},{text:"页面模板",code:"htmltpl",type:"tpl",cls:"JE_APP_HOME_MENU"},{text:"底部菜单",code:"footmenu",type:"menu",cls:"JE_APP_HOME_FOOT"},{text:"列表菜单",code:"listmenu",type:"menu",cls:"JE_APP_HOME_MENU"}]),this.callParent(arguments)},afterRender:function(){var a=this;a.callParent(arguments),a.dragZone=new Ext.view.DragZone({view:a.getCmp("view"),ddGroup:"DDGroup",getDragText:function(){this.dragData.records.length;return Ext.isEmpty(this.dragData.records)?"选中一条数据":this.dragData.records[0].get("text")},getDragData:function(e){var t=this.view,i=e.getTarget(t.getItemSelector());if(i){var a=t.getRecord(i);return{copy:t.copy||t.allowCopy&&e.ctrlKey,event:new Ext.EventObjectImpl(e),view:t,ddel:this.ddel,item:i,records:[a],draggedRecord:a,fromPosition:Ext.fly(i).getXY()}}},afterValidDrop:function(e,t,i){a.doItemSort(this.dragData),a.mainview.getActivePage().indicator.hide()}})},buildView:function(e,t){-1==["gridmenu","bigmenu","htmltpl"].indexOf(e)&&(this.getCmp("view").getEl().down("div[data-code="+e+"]",!0).style.display=t?"none":"table")}}),Ext.define("JE.sys.phone.view.home.MainView",{extend:"Ext.tab.Panel",alias:"widget.phone.homemain",initComponent:function(){this.tabBar={hidden:!0},this.items=[{xtype:"phone.homeplanmain",title:"首页规划",itemId:"center"}],this.callParent(arguments)},afterRender:function(){this.callParent(arguments)},loadData:function(e){var l=this,t=e.get("bean");l.record=e;var i=JE.decode(t.APP_HOME_CFG||"[]");if(JE.isNotEmpty(i)&&JE.isNotEmpty(i[0].title))i=i;else{var a=[],n={code:JE.uuid(),hideTitle:"",homeStyle:"",logoutColor:"",pageIcon:"",title:"首页",titleBGColor:"",type:"home",pageIcon:"",iconfontcolor:"",iconSVG:0,relyOn:""};a.push(n),a.data=i,i=a}var s=l.getCmp("center").pageBar,d=l.getCmp("center").pageBody;Ext.each(i,function(e,t){var i=[];Ext.each(e.data,function(e){i.push(e)});var a=e.title,n=e.pageIcon||"",o=e.code;s.add({text:a,itemId:o,ddPanel:!0,iconCls:n,style:"position:absolute;",toggleGroup:"homePageBar",handler:function(e){d.getCmp(e.itemId).getEl().show(),d.getLayout().setActiveItem(e.itemId);var t=d.getLayout().getActiveItem(),i=t.mainview.getCmp("east"),a=i.getCmp("cfgview");i.setWidth(400),i.getLayout().setActiveItem(a),a.loadData(t);var n=t.itemData.type;l.down("[xtype=phone.homebasiccfg]").getCmp("pluginText").setVisible("plugin"==n),l.down("[xtype=phone.homebasiccfg]").getCmp("relyOn").setVisible("shortcut"==n)},listeners:{afterrender:function(){this.getEl().dom.setAttribute("data-index",t),this.getEl().dom.setAttribute("data-itemid",o)}}});var r=d.add({xtype:"phone.homeplan",itemId:o});r.itemData=e,r.titleBox=r.titleEl,r.buildDataView(i),r.setTitleText(a)});var o=l.down("[xtype=phone.homebasiccfg]").getCmp("relyOn"),r=[],c=l.down("[xtype=phone.homebasiccfg]").getCmp("leftupBtn"),u=[],p=l.down("[xtype=phone.homebasiccfg]").getCmp("rightupBtn"),f=[];Ext.each(i,function(e){"shortcut"!=e.type&&r.push({code:e.code,text:e.title}),u.push({code:e.leftupBtn,text:l.getBtntext(e.leftupBtn)}),f.push({code:e.rightupBtn,text:l.getBtntext(e.rightupBtn)})}),o.store.loadData(r),c.store.loadData(u),p.store.loadData(f)},getBtntext:function(e){var t="";return e&&("exit"==e&&(t="退出"),"_blank"==e&&(t="新页")),t}}),Ext.define("JE.sys.phone.view.home.MenuCfgView",{extend:"Ext.panel.Panel",alias:"widget.phone.homemenucfg",layout:"border",border:0,initComponent:function(){var a=this;a.defaults={border:0},a.tbar={itemId:"buttonBar",items:[{text:"返回",iconCls:"return",itemId:"back",handler:function(){a.currentFolder?a.doFolder("out"):a.ownerCt.doBack()}},{fieldLabel:"文件夹",xtype:"textfield",itemId:"folder",labelWidth:50,width:130,hidden:!0,labelAlign:"right"},{fieldLabel:"图标",itemId:"icon",labelWidth:40,width:130,hidden:!0,labelAlign:"right",xtype:"uxtrigger",trigger2Cls:"x-form-file-trigger",handler:function(i){JE.uploadFile({params:{funcCode:"JE_PHONE_APP",tableCode:"JE_PHONE_APP",jeFileType:"PROJECT",beanTableCode:"JE_PHONE_APP",returnType:"all"},callback:function(e){var t=e.privateUrl||JE.getFileUrl(e.url,"PUBLIC","","","JE_PHONE_APP");i.setValue(t)}})}},"->",{text:"功能",iconCls:"jeicon jeicon-resource-table-addition",itemId:"addFunc",handler:function(){a.addFunc()}},{text:"文件夹",iconCls:"jeicon jeicon-resource-table-addition",itemId:"addFolder",handler:function(){a.addFolder()}}]},a.items=[{xtype:"form",layout:"column",bodyPadding:4,region:"north",height:100,itemId:"cfg",defaults:{labelAlign:"right",labelWidth:80,columnWidth:.9,margin:"1",xtype:"textfield",cls:"je-field-basiccls"},items:[{fieldLabel:"标题",name:"text",columnWidth:.7},{xtype:"yesnofield",boxLabel:"隐藏标题",name:"hideTitle",columnWidth:.3},{fieldLabel:"每行功能数",itemId:"colCount",name:"colCount",columnWidth:.7,xtype:"numberfield",maxValue:4,minValue:2},{xtype:"button",text:"刷新视图",itemId:"refreshBtn",cls:"btn btn-small",columnWidth:"none",width:80,margin:"0 0 0 2",iconCls:"jeicon jeicon-refresh",handler:function(e){var t=e.previousSibling().getValue();a.getCmp("menu").refreshView(t)}},{fieldLabel:"每页行数",itemId:"rowCount",name:"rowCount",columnWidth:.7,readOnly:!0,xtype:"numberfield",maxValue:5,minValue:1},{xtype:"yesnofield",itemId:"page",boxLabel:"启用分页",name:"page",columnWidth:.3,listeners:{change:function(e,t,i){e.previousSibling().setReadOnly(!(t||"1"==t))}}},{xtype:"hidden",name:"menuType",listeners:{change:function(e,t,i){Ext.each(["colCount","refreshBtn","rowCount","page"],function(e){a.getCmp("cfg").getCmp(e).setVisible("gridmenu"==t)})}}}]},{xtype:"form",layout:"column",bodyPadding:4,region:"north",height:100,itemId:"listinfo",defaults:{labelAlign:"right",labelWidth:80,columnWidth:.9,margin:"1",xtype:"textfield",cls:"je-field-basiccls"},items:[{fieldLabel:"标题",name:"text",columnWidth:.7},{xtype:"yesnofield",boxLabel:"隐藏标题",name:"hideTitle",columnWidth:.3},{xtype:"hidden",name:"menuType",listeners:{change:function(e,t,i){Ext.each(["colCount","refreshBtn","rowCount","page"],function(e){a.getCmp("cfg").getCmp(e).setVisible("listinfo"==t)})}}}]},{xtype:"box",itemId:"footinfo",region:"north",height:40,style:"padding:10px;text-align:center;background:#ffffff;",html:"<h3>底部菜单只允许添加四个功能</h3>",hidden:!0},{xtype:"phone.homemenu",itemId:"menu",region:"center"},{xtype:"form",height:130,region:"south",layout:"column",itemId:"appCfg",padding:"10",hidden:!0,defaults:{labelAlign:"right",labelWidth:80,columnWidth:.9,margin:"1",cls:"je-field-basiccls",listeners:{change:function(e,t,i){var a=e.ownerCt.getRecord();a&&a.set(e.name,t)}}},items:[{xtype:"displayfield",name:"text",fieldLabel:"功能"},{xtype:"numberfield",name:"cols",minValue:1,maxValue:2,fieldLabel:"所占列数"},{xtype:"colorfield",name:"bgcolor",fieldLabel:"背景色"},{xtype:"colorfield",name:"fontcolor",fieldLabel:"字体色"}]}],a.callParent(arguments)},afterRender:function(){this.callParent(arguments)},getData:function(e){if(this.doFolder("out"),"listmenu"==e)var t=this.getCmp("listinfo").form.getValues();else if("plugin"==e)t=this.getCmp("plugininfo").form.getValues();else t=this.getCmp("cfg").form.getValues();return t.funcs=[],this.getCmp("menu").store.each(function(e){t.funcs.push(e.data)}),t},setData:function(e){var t=this;"footmenu"==e.code?e.colCount=4:"bigmenu"==e.code&&(e.colCount=2),"listmenu"==(t.funcCfg=e).code?t.getCmp("listinfo").form.setValues(e):t.getCmp("cfg").form.setValues(e),t.getCmp("cfg").setVisible(-1!=["gridmenu","bigmenu"].indexOf(e.code)),t.getCmp("appCfg").setVisible("bigmenu"==e.code),t.getCmp("footinfo").setVisible("footmenu"==e.code),t.getCmp("listinfo").setVisible("listmenu"==e.code),e.funcs=e.funcs||[],Ext.each(e.funcs,function(e){"menu"==e.type&&Ext.isString(e.funcs)&&(e.funcs=Ext.decode(e.funcs))}),t.getCmp("menu")["bigmenu"==e.code?"addCls":"removeCls"]("je-app-bigmenu"),t.getCmp("menu").store.loadData((e.cfg?e.cfg.funcs:e.funcs)||[]),t.getCmp("menu").refreshView(e.colCount?e.colCount:4)},doFolder:function(e,t){var i=this,a=i.getDockedCmp("buttonBar").getCmp("folder"),n=i.getDockedCmp("buttonBar").getCmp("icon");if("in"==e){i.basicFuncs=[],i.currentFolder=t.get("code"),i.getCmp("menu").store.each(function(e){i.basicFuncs.push(e.data)});var o=t.get("funcs")||[];a.setValue(t.get("text")),a.setVisible(!0),n.setValue(t.get("icon")||""),n.setVisible(!0),i.getCmp("cfg").setVisible(!1),i.getCmp("footinfo").setVisible(!1),i.getCmp("menu").store.loadData(o),i.getCmp("menu").refreshView(3),i.getDockedCmp("buttonBar").getCmp("addFolder").setVisible(!1)}else if(i.currentFolder){o=i.basicFuncs||[];var r=i.funcCfg,l=i.currentFolder;delete i.basicFuncs,delete i.currentFolder,Ext.each(o,function(e){if(e.code==l){var t=[];return i.getCmp("menu").store.each(function(e){t.push(e.data)}),e.funcs=t,e.text=a.getValue(),e.icon=n.getValue(),!1}}),a.setValue(""),a.setVisible(!1),n.setValue(""),n.setVisible(!1),i.getCmp("cfg").setVisible("gridmenu"==r.menuType),i.getCmp("footinfo").setVisible("gridmenu"!=r.menuType),i.getCmp("menu").store.loadData(o),i.getCmp("menu").refreshView(r.colCount),i.getDockedCmp("buttonBar").getCmp("addFolder").setVisible(!0)}},addFunc:function(e){var n=this,o=n.up("[xtype=phone.homeplanmain]"),r=o.getActivePage().itemData.type,l=o.getActivePage().itemData.relyOn,t=o.getActivePage().itemData.oldrelyon||"",s=n.buildFuncData(),d=n.getCmp("menu").store,c=n.getCmp("cfg").form.findField("menuType").getValue();JE.isNotEmpty(t)&&l!=t&&d.removeAll(),"shortcut"==r&&JE.isEmpty(l)?JE.alert("依赖菜单不能为空！"):n.currentFolder||"footmenu"!=c||4!=d.getCount()?JE.win({title:"功能",width:300,height:600,border:0,items:n.buildNewtree(),useButton:!0,autoShow:!0,fn:function(e){var t=e.getCmp(0).getSelectionModel().getSelection(),i=[];if(1<=(d.data.items||"[]").length&&"plugin"==r)return JE.alert("当前插件页面只能选入一个插件");Ext.each(t,function(e){var t=e.get("bean");t&&"folder"!=t.APP_TYPE&&-1==s.indexOf(t.APP_CODE)&&("plugin"==r?"PLUGIN"==e.parentNode.get("code")?i.push({id:t.JE_PHONE_APP_ID,text:t.APP_TEXT,code:t.APP_CODE,icon:t.APP_ICON.split("*")[1]||"",type:"func",iconfont:t.APP_FONTICON,iconfontcolor:t.APP_FONTICON_COLOR,svg:t.APP_FONTICON_SVG}):JE.alert("当前插件页面只能选入插件"):i.push({id:t.JE_PHONE_APP_ID,text:t.APP_TEXT,code:t.APP_CODE,icon:t.APP_ICON?t.APP_ICON.split("*")[1]:"",type:"func",iconfont:t.APP_FONTICON,iconfontcolor:t.APP_FONTICON_COLOR,svg:t.APP_FONTICON_SVG}))});var a=[];if(Ext.each(i,function(e){d.findRecord("code",e.code)||a.push(e)}),!n.currentFolder&&"footmenu"==c&&4<d.getCount()+a.length)return JE.alert("底部菜单只能放四个功能！"),!1;o.getActivePage().itemData.oldrelyonId=o.getActivePage().itemData.cfg.oldrelyonId=l,d.add(a)}}):JE.alert("底部菜单只能放四个功能！")},addFolder:function(){var i=this;JE.formWin({title:"文件夹",width:400,height:130,useButton:!0,items:[{fieldLabel:"名称",name:"text",allowBlank:!1},{fieldLabel:"图标",name:"icon",xtype:"uxtrigger",trigger2Cls:"x-form-file-trigger",handler:function(i){JE.uploadFile({params:{funcCode:"JE_PHONE_APP",tableCode:"JE_PHONE_APP",jeFileType:"PROJECT",beanTableCode:"JE_PHONE_APP",returnType:"all"},callback:function(e){var t=e.privateUrl||JE.getFileUrl(e.url,"PUBLIC","","","JE_PHONE_APP");i.setValue(t)}})}}],fn:function(e,t){e.type="menu",e.code=JE.uuid(),e.id=e.code,i.getCmp("menu").store.add(e)}})},buildFuncData:function(){var t=this,i=[];return t.ownerCt.mainview.getActivePage().items.each(function(e){e!=t.ownerCt.itemPanel&&"menu"==e.itemData.type&&e.itemData.cfg&&Ext.each(e.itemData.cfg.funcs,function(e){"menu"==e.type?Ext.each(e.funcs,function(e){i.push(e.code)}):i.push(e.code)})}),t.basicFuncs?(t.getCmp("menu").store.each(function(e){i.push(e.get("code"))}),Ext.each(t.basicFuncs,function(e){"menu"==e.type?e.code!=t.currentFolder&&Ext.each(e.funcs,function(e){i.push(e.code)}):i.push(e.code)})):t.getCmp("menu").store.each(function(e){var t=e.data;"menu"==t.type?Ext.each(t.funcs,function(e){i.push(e.code)}):i.push(t.code)}),i},deletePanel:function(e){var t=this;Ext.MessageBox.alert({title:"提示",msg:"确定删除此首页面板吗？",buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.INFO,fn:function(){t.ownerCt.deletePanel()}})},buildNewtree:function(){var e=this.up("panel[xtype=phone.homemain]"),t=(i=this.up("[xtype=phone.homeplanmain]")).getActivePage().itemData.relyOn,a=this.up("panel[xtype=phone.mainview]").getCmp("appview"),i=this.up("[xtype=phone.homeplanmain]"),n=(e=this.up("panel[xtype=phone.homemain]"),i.getActivePage().itemData.type,i.getCmp("plancenter").getCmp("pageBody").getLayout().getActiveItem(),this.buildFuncData()),o=(this.getCmp("menu").store,this.getCmp("cfg").form.findField("menuType").getValue(),e.record.get("bean").APP_APK_ID),r=[],l=[],s=e.getCmp("center").pageBody.items.items;Ext.each(s,function(e){e.itemData.code==t&&e.items.each(function(e){l.push(e.itemData)})}),Ext.each(l,function(e){var t=e.cfg?e.cfg.funcs:e,i={text:e.cfg?e.cfg.text:e.text,expanded:"true",children:[],checked:!1};JE.isNotEmpty(t)&&(1<=t.length&&Ext.each(t,function(e){var t=a.getStore().getNodeById(e.id);i.children.push({text:e.text,leaf:"true",checked:!1,bean:t?t.data.bean:"",iconCls:"JE_APP_"+e.type.toUpperCase(),code:e.code})}),r.push(i))});var d={xtype:"jetreeview",rootData:{id:"ROOT",text:"ROOT",children:r},multiSelect:!0,type:"func",funcs:n,searchBar:!1,viewConfig:{getRowClass:function(e,t,i,a){var n=this.panel;["FUNC","PLUGIN","REPORTCHART"].includes(e.get("code"));return-1==n.funcs.indexOf(e.get("code"))?"":"je-display-none"}}},c={xtype:"phone.appview",useSSWin:!0,apkId:o,whereSql:"and APP_TYPE not in('home','login')",funcs:n,multiSelect:!0,viewConfig:{getRowClass:function(e,t,i,a){var n=this.panel;["FUNC","PLUGIN","REPORTCHART"].includes(e.get("code"));return-1==n.funcs.indexOf(e.get("code"))?"":"je-display-none"}}};return JE.isNotEmpty(t)?d:c}}),Ext.define("JE.sys.phone.view.home.MenuView",{extend:"Ext.panel.Panel",alias:"widget.phone.homemenu",initComponent:function(){var d=this;d.layout="fit",d.bodyPadding="5px 20px",d.items=Ext.create("Ext.view.View",{itemId:"view",store:Ext.create("Ext.data.Store",{fields:["id","code","text","icon","type","cols","bgcolor","fontcolor","iconCls","iconfont","iconfontcolor","svg",{name:"funcs",type:"auto"}],data:[]}),cls:"mui-table-view mui-grid-view mui-grid-9 je-liststyle",tpl:['<tpl for=".">','<li class="mui-table-view-cell mui-media {[this.setListstyle()]} mui-col-xs-{[this.getCols(values)]} {[Ext.value(values.type,"func")]}" data-text="{text}" data-code="{code}" data-index="{#}">','<div class="menu-body" style="{[this.getBigMenuStyle(values)]}">',"{[this.getFuncimg(values)]}",'<div class="mui-media-body">{text}</div>','<span class="delete">x</span>','<input type="button" title="同步功能数据" class="jeicon jeicon-refresh je-button-icon" style="display:none;position: absolute;bottom: 5px;right: 7px;cursor: pointer;" />',"</div>","</li>","</tpl>",{folderImg:JE.getStaticUrl("JE.app.folder"),appImg:JE.getStaticUrl("JE.app.app"),getCols:function(e){var t=d.getCmp("view").cols||4;return"bigmenu"==d.ownerCt.funcCfg.code&&(t=2==(t=e.cols||1)?1:2),"plugin"==d.ownerCt.funcCfg.code&&(t=2==(t=e.cols||2)?4:2),"listmenu"==d.ownerCt.funcCfg.code&&(t=1),t},setListstyle:function(){var e="";return"listmenu"==d.ownerCt.funcCfg.code&&(e="je-listmenu-style"),e},getIcon:function(e){var t=Ext.value(e.type,"func");return(e.icon.indexOf(".")<0?JE.getFileUrl(e.icon):e.icon)||("menu"==t?this.folderImg:this.appImg)},getBigMenuStyle:function(e){var t=[];return JE.isNotEmpty(e.bgcolor)&&t.push("background-color:"+e.bgcolor),JE.isNotEmpty(e.fontcolor)&&t.push("color:"+e.fontcolor),t.join(";")},getIconcolor:function(e){if("listmenu"==d.ownerCt.funcCfg.code)var t="";return t},getFuncimg:function(e){if("listmenu"==d.ownerCt.funcCfg.code||"gridmenu"==d.ownerCt.funcCfg.code)var t=e.iconfontcolor||"#eee";if("bigmenu"==d.ownerCt.funcCfg.code)var i=80,a=80;else if("listmenu"==d.ownerCt.funcCfg.code)i=20,a=40;else i=40,a=40;var n='<img width="40" height="40" src="'+this.getIcon(e)+'"/>',o='<span class="'+e.iconfont+'" style="font-size:'+i+"px;line-height:"+a+"px;height:"+i+"px;display:inline-block;color:"+t+'"></span>';return JE.isNotEmpty(e.iconfont)?o:n}}],itemSelector:"li.mui-table-view-cell",emptyText:"",overItemCls:"",selectedItemCls:"",listeners:{itemclick:function(e,t,i,a,n){var o=d.ownerCt,r=o.funcCfg.menuType;if("delete"==n.target.getAttribute("class")&&(e.store.remove(t),d.doSort(),"bigmenu"==r&&o.getCmp("appCfg").reset(!0)),n.target.hasAttribute("class")&&-1!=n.target.getAttribute("class").indexOf("jeicon-refresh")){var l=d.up("panel[xtype=phone.homemain]").record.get("bean").APP_APK_ID,s=JE.ajax({url:JE.getUrlMaps("je.core.load"),params:{limit:1,tableCode:"JE_PHONE_APP",whereSql:" and APP_APK_ID='"+l+"' AND APP_CODE='"+t.get("code")+"'"}}).rows[0];s&&(t.set({text:s.APP_TEXT,icon:s.APP_ICON.split("*")[1],iconfont:s.APP_FONTICON,iconfontcolor:s.APP_FONTICON_COLOR}),t.commit(),JE.msg("同步成功！"))}else"menu"==t.get("type")&&"IMG"==n.target.nodeName?d.ownerCt.doFolder("in",t):"bigmenu"==r&&o.getCmp("appCfg").loadRecord(t)},itemmouseenter:function(e,t,i,a){"menu"!=t.get("type")&&(i.querySelector(".jeicon-refresh").style.display="")},itemmouseleave:function(e,t,i,a){i.querySelector(".jeicon-refresh").style.display="none"}}}),d.store=d.items.store,console.log(d.items.store),d.callParent(arguments)},afterRender:function(){var o=this;o.callParent(arguments);var r=o.getCmp("view");r.dragZone=new Ext.dd.DragZone(r.getEl(),{ddGroup:"menuGroup",getDragData:function(e){var t=e.getTarget(r.itemSelector,10);if(t){var i=document.createElement("div");return i.innerHTML=t.getAttribute("data-text"),{ddel:i,sourceEl:t,repairXY:Ext.fly(t).getXY(),dragRecord:r.getRecord(t),sourceDataView:r}}},getRepairXY:function(){return this.dragData.repairXY}}),r.dropZone=new Ext.dd.DropZone(r.getEl(),{ddGroup:"menuGroup",notifyOver:function(e,t,i){var a=t.getTarget(r.itemSelector,10);if(i.allowDD=!1,i.insertIndex=-1,a){var n=o.getItemPosition(t,a);"before"!=n&&"after"!=n||(o.positionIndicator(a,n,t),i.insertIndex=JE.toNum(a.getAttribute("data-index")),"before"==n&&i.insertIndex--,i.allowDD=!0)}return i.allowDD||o.hidetIndicator(),i.allowDD?e.dropAllowed:e.dropNotAllowed},notifyDrop:function(e,t,i){if(o.hidetIndicator(),-1<i.insertIndex){var a=[],n=[];a.push(Ext.clone(i.dragRecord.data)),i.dragRecord.set("id",JE.uuid()),n.push(i.dragRecord),o.store.insert(i.insertIndex,a),o.store.remove(n),o.doSort()}return i.allowDD}}),o.indicator=new Ext.Component({html:o.indicatorHtml,cls:o.indicatorCls,style:"width:1px;",floating:!0,shadow:!1})},indicatorHtml:'<div class="formfield-move-top"></div><div class="formfield-move-bottom"></div>',indicatorCls:"je-formfield-drop-indicator",getIndicator:function(){return this.indicator},positionIndicator:function(e,t,i){var a=Ext.fly(e),n=a.getX(),o=a.getY()+5;"after"==t&&(n+=a.getWidth()),this.getIndicator().setHeight(a.getHeight()-10).showAt(n,o)},hidetIndicator:function(){this.getIndicator().hide()},getItemPosition:function(e,t,i){var a,n=e.getXY()[1],o=e.getXY()[0],r=Ext.fly(t).getRegion();if(n<=r.bottom&&n>=r.top){var l=r.left+(r.right-r.left)/2;o<l?a="before":l<o&&(a="after")}return a},doSort:function(){var i=this.getCmp("view");this.store.each(function(e,t){i.getNode(e).setAttribute("data-index",t+1)})},refreshView:function(e){var t=this.getCmp("view");t.cols=e||4,t.refresh()}}),Ext.define("JE.sys.phone.view.home.PlanMainView",{extend:"Ext.panel.Panel",alias:"widget.phone.homeplanmain",layout:"border",border:0,initComponent:function(){var e=this;e.tbar={style:"border-top:1px solid #d5d5d5 !important",items:[{text:"保存",iconCls:"jeicon jeicon-save",itemId:"update"},{text:"添加首页",iconCls:"jeicon jeicon-resource-table-addition",itemId:"addHome"}]},e.items=[{xtype:"panel",layout:{type:"table",tableAttrs:{align:"center",height:"100%"},tdAttrs:{valign:"middle"},columns:1},region:"center",bodyPadding:10,bodyStyle:"border-width:0 1px 0 0",itemId:"plancenter",tbar:{itemId:"pageBar",style:{"border-width":0,"border-right":"1px solid #d5d5d5","border-bottom":"1px solid #d5d5d5 !important"}},items:{xtype:"container",itemId:"pageBody",layout:"card",mainview:e,defaults:{mainview:e},width:300,height:500}},{xtype:"panel",region:"east",bodyStyle:"border-width:0 0 0 1px",width:110,split:!0,itemId:"east",layout:"card",defaults:{border:0,mainview:e},items:[{xtype:"phone.homeitem",itemId:"itemview"},{xtype:"phone.homecfg",itemId:"cfgview"}]}],e.callParent(arguments),e.itemview=e.getCmp("east").getCmp("itemview"),e.cfgview=e.getCmp("east").getCmp("cfgview"),e.pageBody=e.getCmp("plancenter").getCmp("pageBody"),e.pageBar=e.getCmp("plancenter").getDockedCmp("pageBar")},afterRender:function(){this.callParent(arguments);var e=this.getCmp("plancenter").getCmp("pageBar"),t=this.getCmp("plancenter").getCmp("pageBody");this.up("[xtype=phone.homeplanmain]");e.dragZone=this.dragTbar(e),e.dropZone=this.dropTbar(e,t),this.indicator=new Ext.Component({html:this.indicatorHtml,cls:this.indicatorCls,style:"width:1px;",floating:!0,shadow:!1})},getActivePage:function(){return this.pageBody.getLayout().getActiveItem()},getItemPosition:function(e,t,i){var a,n=e.getXY()[1],o=e.getXY()[0],r=Ext.fly(t).getRegion();if(n<=r.bottom&&n>=r.top){var l=r.left+(r.right-r.left)/2;o<l?a="before":l<o&&(a="after")}return a},positionIndicator:function(e,t,i){var a=Ext.fly(e),n=a.getX(),o=a.getY()+5;"after"==t&&(n+=a.getWidth()),this.getIndicator().setHeight(a.getHeight()-10).showAt(n,o)},getIndicator:function(){return this.indicator},indicatorHtml:'<div class="formfield-move-top"></div><div class="formfield-move-bottom"></div>',indicatorCls:"je-formfield-drop-indicator",hidetIndicator:function(){this.getIndicator().hide()},dragTbar:function(n){new Ext.dd.DragZone(n.getEl(),{ddGroup:"tbarGroup",getDragData:function(e){var t=e.getTarget("a.x-btn",4,!0);if(t){var i=t.getAttribute("data-itemid"),a=n.getCmp(i);return{ddel:document.createElement("a"),dragBtn:a,repairXY:Ext.fly(t).getXY()}}},getRepairXY:function(){return this.dragData.repairXY}})},dropTbar:function(r,l){var s=this;new Ext.dd.DropZone(r.getEl(),{ddGroup:"tbarGroup",notifyOver:function(e,t,i){var a=t.getTarget("a.x-btn",4);if(i.allowDD=!1,i.insertIndex=-1,a){var n=s.getItemPosition(t,a);"before"!=n&&"after"!=n||(s.positionIndicator(a,n,t),i.insertIndex=JE.toNum(a.getAttribute("data-index")),i.allowDD=!0)}return i.allowDD||s.hidetIndicator(),i.allowDD?e.dropAllowed:e.dropNotAllowed},notifyDrop:function(e,t,i){if(s.hidetIndicator(),-1<i.insertIndex){var a=i.dragBtn,n=i.dragBtn.itemId,o=l.getCmp(n);r.insert(i.insertIndex,a),l.insert(i.insertIndex,o),r.items.each(function(e,t){e.getEl().dom.setAttribute("data-index",t)})}return i.allowDD}})}}),Ext.define("JE.sys.phone.view.home.PlanView",{extend:"Ext.panel.Panel",mixins:["JE.sys.phone.util.HomeUtil"],alias:"widget.phone.homeplan",autoScroll:!0,layout:"column",bodyPadding:"5 0",initComponent:function(){this.bodyStyle="border:1px solid #cecece;",this.dockedItems=[{dock:"top",xtype:"box",height:30,itemId:"titleBox",style:"cursor: pointer;padding: 5px;text-align:center;border:1px solid #cecece;border-width:1px 1px 0px 1px;background-color:#007aff;color:#ffffff;",html:'<div title="单击编辑" style="height:100%;"></div>'}],this.callParent(arguments)},afterRender:function(){var i=this;i.callParent(arguments),i.titleEditor=new Ext.Editor({updateEl:!0,field:{xtype:"textfield"}}),i.titleEl=i.getDockedCmp("titleBox").getEl().down("div"),i.titleEl.on("click",function(){var e=i.mainview.getCmp("east"),t=e.getCmp("cfgview");e.setWidth(400),e.getLayout().setActiveItem(t),t.loadData(i)}),i.indicator=i.mainview.itemview.indicator=new Ext.Component({html:i.indicatorHtml,cls:i.indicatorCls,style:"height:1px;",floating:!0,shadow:!1}),i.buildDrop(i)},setTitleText:function(e){e=Ext.value(e,"首页");this.titleEl.dom.innerHTML=e},getTitleText:function(){return this.titleEl.dom.innerHTML}}),Ext.define("JE.sys.phone.view.home.TplCfgView",{extend:"Ext.form.Panel",alias:"widget.phone.tplbasiccfg",autoScroll:!0,layout:"fit",bodyPadding:"4",border:0,initComponent:function(){var e=this;e.tbar={itemId:"buttonBar",items:[{text:"返回",iconCls:"return",itemId:"back",handler:function(){e.ownerCt.doBack()}}]},e.defaults={labelAlign:"right",labelWidth:100,columnWidth:.9,margin:"1",xtype:"textfield"},e.items=[{xtype:"jecodeeditor",itemId:"jsview"},{xtype:"hidden",name:"menuType"},{xtype:"hidden",name:"title"}],e.buttonAlign="center",e.callParent(arguments)},getData:function(){var e=this.form.getValues(),t=this.getCmp("jsview").getValue();return e.tplFn=t,e.type="tpl",e},setData:function(e){this.form.setValues(e);this.getCmp("jsview").setValue(Ext.value(e.tplFn,"function(){var html = '';return {html:html,css:''}}"))}}),Ext.define("JE.sys.phone.view.link.CfgView",{extend:"JE.sys.phone.view.app.CfgView",alias:"widget.phone.linkcfg",initComponent:function(){this.items=[{fieldLabel:"链接地址",xtype:"textarea",name:"APP_LINK_URL",allowBlank:!1,emptyText:"以 http:// 开头",columnWidth:.9},{xtype:"box",padding:"5",margin:"2 2 2 85",cls:"x-view-emtpytext",itemId:"helpMsg",columnWidth:.8,html:"以 http:// 开头的链接为外部链接;</br>不带 http:// 的为系统内部链接,前面自动加上服务器地址;"}],this.callParent(arguments)}}),Ext.define("JE.sys.phone.view.link.MainView",{extend:"Ext.tab.Panel",alias:"widget.phone.linkmain",initComponent:function(){this.defaults={bodyStyle:"background-color:#ffffff;",mainview:this,tbar:{xtype:"toolbar",itemId:"buttonBar",items:[{text:"保存",iconCls:"jeicon jeicon-save",itemId:"update"}]}},this.items=[{xtype:"phone.linkcfg",title:"链接"},{xtype:"phone.version"}],this.callParent(arguments),this.cfgview=this.getCmp("cfgview"),this.versionview=this.getCmp("versionview")},afterRender:function(){this.callParent(arguments)},loadData:function(e){var t=e.get("bean");this.record=e,this.cfgview.form.setValues(t),this.versionview.loadData(t.JE_PHONE_APP_ID)}}),Ext.define("JE.sys.phone.view.login.CfgView",{extend:"Ext.form.Panel",alias:"widget.phone.logincfg",autoScroll:!0,layout:"column",bodyPadding:"4 0",border:0,initComponent:function(){var t=this;t.defaults={labelAlign:"right",labelWidth:100,columnWidth:.9,margin:"1",xtype:"textfield"};function e(i){JE.uploadFile({params:{beanTableCode:"JE_PHONE_APP",tableCode:"JE_PHONE_APP",funcCode:"JE_PHONE_APP",jeFileType:"PROJECT",returnType:"all"},callback:function(e){var t=e.privateUrl||JE.getFileUrl(e.url,"PUBLIC","","","JE_PHONE_APP");i.setValue(t)}})}t.items=[{fieldLabel:"LOGO",xtype:"uxtrigger",emptyText:"最大宽*高：300*200",trigger2Cls:"x-form-file-trigger",name:"logo",handler:e},{fieldLabel:"【背景】颜色",name:"bgColor",xtype:"colorfield"},{fieldLabel:"图片",xtype:"uxtrigger",trigger2Cls:"x-form-file-trigger",name:"bgImage",handler:e},{fieldLabel:"【输入框】文字",name:"fontColor",xtype:"colorfield"},{fieldLabel:"图标",name:"fontIconColor",xtype:"colorfield"},{fieldLabel:"上边距",emptyText:"默认50px",name:"loginInputMarginTop",xtype:"numberfield",minValue:0},{fieldLabel:"【按钮】文字",name:"buttonText"},{fieldLabel:"颜色",name:"buttonFontColor",xtype:"colorfield"},{fieldLabel:"背景",name:"buttonBGColor",xtype:"colorfield"},{fieldLabel:"上边距",emptyText:"默认30px",name:"loginBtnMarginTop",xtype:"numberfield",minValue:0},{fieldLabel:"【底部】文字",name:"footText"},{fieldLabel:"颜色",name:"footFontColor",xtype:"colorfield"}],t.buttons=[{xtype:"button",text:"保存",iconCls:"jeicon jeicon-save",itemId:"update"},{xtype:"button",text:"重置",iconCls:"jeicon jeicon-turn-left",itemId:"reset"},{xtype:"button",text:"共享模板",itemId:"share",hidden:JE.isNotEmpty(JE.systemConfig.JE_DEFAULT_SAASUSER),handler:function(){var e=t.form.getValues();JE.win({title:"配置信息",autoScroll:!0,autoShow:!0,html:Ext.encode(e)})}}],t.buttonAlign="center",t.callParent(arguments)},afterRender:function(){this.callParent(arguments),this.saveBtn=this.down("button[itemId=update]")},getData:function(){var e={logo:JE.getStaticUrl("JE.app.logo"),buttonText:"登录",footText:"北京中加诚信技术管道有限公司",fontColor:"#aaaaaa",fontIconColor:"#000000",buttonFontColor:"#ffffff",buttonBGColor:"#1D5FAD",footFontColor:"#aaaaaa",bgColor:"#efeff4",bgImage:"none",bgRepeat:"no-repeat",bgSize:"cover",loginInputMarginTop:50,loginBtnMarginTop:30},t=this.form.getValues();for(var i in t)JE.isNotEmpty(t[i])&&(e[i]=t[i]);return e},setData:function(e){var t=Ext.decode(e||"{}");this.form.setValues(t)}}),Ext.define("JE.sys.phone.view.login.MainView",{extend:"Ext.panel.Panel",alias:"widget.phone.loginmain",layout:"border",initComponent:function(){this.items=[{xtype:"panel",layout:{type:"table",tableAttrs:{align:"center",height:"100%"},tdAttrs:{valign:"middle"},columns:1},region:"center",bodyPadding:10,bodyStyle:"border-width:0 1px 0 0",itemId:"plancenter",items:{xtype:"phone.loginplan",itemId:"planview",mainview:this,width:320,height:600}},{xtype:"panel",split:!0,width:390,region:"east",itemId:"east",bodyStyle:"border-width:0 0 0 1px;",layout:{type:"accordion",animate:!0,activeOnTop:!0},items:[{xtype:"phone.logincfg",itemId:"cfgview",title:"基础设置",mainview:this},{xtype:"phone.logintpl",itemId:"template",hidden:JE.isNotEmpty(JE.systemConfig.JE_DEFAULT_SAASUSER),title:"模板库",mainview:this}]}],this.callParent(arguments),this.planview=this.getCmp("plancenter").getCmp("planview"),this.cfgview=this.getCmp("east").getCmp("cfgview")},afterRender:function(){this.callParent(arguments)},loadData:function(e){var t=e.get("bean");this.record=e,this.cfgview.setData(t.APP_LOGIN_CFG),this.planview.update(this.cfgview.getData())}}),Ext.define("JE.sys.phone.view.login.PlanView",{extend:"Ext.panel.Panel",alias:"widget.phone.loginplan",layout:"fit",initComponent:function(){this.bodyStyle="border:1px solid #cecece;position: relative;",this.tpl=['<div style="height:100%;padding-top:15%;background-color:{bgColor};background-image:url({bgImage});background-size: {bgSize}; background-repeat: {bgRepeat};">','<div style="text-align: center;margin: 10px;">','<img src="{logo}" style="max-height: 200px;max-width: 300px;"/> ',"</div>",'<div style="margin:{loginInputMarginTop}px 5% 0 5%;text-align: center;">','<p style="color:{fontColor};text-align:left;padding:2px 2px 2px 10px;border-bottom:1px solid #aaa;height:36px;line-height:36px;position: relative;margin-bottom:20px;">','<i class="fa fa-user" style="font-size: 16px;color: {fontIconColor};margin-right:20px;"></i>请输入账号',"</p>",'<p style="color:{fontColor};text-align:left;padding:2px 2px 2px 10px;border-bottom:1px solid #aaa;height:36px;line-height:36px;position: relative;margin-bottom:20px;">','<i class="fa fa-lock" style="font-size: 16px;color: {fontIconColor};margin-right:20px;"></i>请输入密码',"</p>",'<button name = "login" style="color: {buttonFontColor};border-width: 0px;background-color: {buttonBGColor};padding: 10px 0;width: 80%;margin-top: {loginBtnMarginTop}px;">{buttonText}</button>',"</div> ",'<div style="position: absolute;bottom: 20px;width: 100%;font-size: 12px;color: {footFontColor};text-align: center;margin-top: 50px;">','{footText}<i class="fa fa-cog" style="font-size: 20px;color: {buttonBGColor};position: absolute;right: 10px;"></i>',"</div>","</div>"],this.callParent(arguments)},afterRender:function(){this.callParent(arguments)}}),Ext.define("JE.sys.phone.view.login.TemplateView",{extend:"Ext.panel.Panel",alias:"widget.phone.logintpl",mixins:["JE.sys.phone.util.ApkUtil"],autoScroll:!0,initComponent:function(){var t=this;t.store=Ext.create("Ext.data.Store",{fields:JE.appTpls.login_model,data:JE.appTpls.login}),t.items=Ext.create("Ext.view.View",{store:t.store,tpl:['<tpl for=".">','<div class="page" style="padding:5px;position: relative;float:left;border: 1px solid transparent;height:150px;width:85px;margin:10px 20px;text-align:center;cursor: pointer;">','<img width="64" height="110" src="http://jesaas.com/{[values.LOGTEP_XGT.split(\'*\')[1]]}" />','<div style="text-align:center;word-break: break-all;">{LOGTEP_MBM}</div>','<input data-type="ok" title="应用" type="button" class="ok jeicon jeicon-check-circle je-button-icon" style="display:none;position: absolute;bottom: -10px;right:-10px;cursor: pointer;" />',"</div>","</tpl>"],itemSelector:"div.page",draggable:{delegate:"div.page"},emptyText:"",overItemCls:"x-dataview-item-over",selectedItemCls:"x-dataview-item-selected"}),t.callParent(arguments),t.on("beforeexpand",function(){if(JE.isEmpty(JE.APK_SPM)){var e=t.up("panel[xtype=phone.mainview]").getCmp("appview").getApkModel().get("APK_TEXT");return t.getLicenseKey(e,function(){t.expand()}),!1}})},updateLoginCfg:function(e){var t=e.data,i=this.ownerCt.getCmp("cfgview"),a=t.LOGTEP_BJT,n=t.LOGTEP_LOGO,o=Ext.value(t.LOGTEP_JSON,{});if(o.bgImage="",o.logo="",JE.isNotEmpty(a)||JE.isNotEmpty(n)){var r=JE.ajax({url:JE.getUrlMaps("je.core.phone.phone","downLoginFile"),params:{tableCode:"JE_PHONE_APP",bgImage:a,logo:n,uploadField:"bgImage,logo"}});o.bgImage=r.obj.bgImage,o.logo=r.obj.logo}i.form.setValues(o),this.mainview.planview.update(i.getData()),this.collapse(),JE.msg("应用成功，操作后请保存！")},afterRender:function(){this.callParent(arguments)}}),Ext.define("JE.sys.phone.view.plugin.CfgView",{extend:"JE.sys.phone.view.app.CfgView",alias:"widget.phone.plugincfg",initComponent:function(){this.versionBtn=!1,this.appNum=!1,this.items=[{fieldLabel:"插件",xtype:"uxdisplayfield",name:"APP_BDCJ_CODE",columnWidth:.45},{xtype:"hidden",name:"APP_BDCJ_ID"}],this.callParent(arguments)}}),Ext.define("JE.sys.phone.view.plugin.MainView",{extend:"Ext.tab.Panel",alias:"widget.phone.pluginmain",initComponent:function(){this.defaults={bodyStyle:"background-color:#ffffff;",mainview:this,tbar:{xtype:"toolbar",itemId:"buttonBar",items:[{text:"保存",iconCls:"jeicon jeicon-save",itemId:"update"}]}},this.items=[{xtype:"phone.plugincfg",title:"插件"},{xtype:"phone.version"}],this.callParent(arguments),this.cfgview=this.getCmp("cfgview"),this.versionview=this.getCmp("versionview")},afterRender:function(){this.callParent(arguments)},loadData:function(e){var t=e.get("bean");this.record=e,this.cfgview.form.setValues(t),this.versionview.loadData(t.JE_PHONE_APP_ID)}}),Ext.define("JE.sys.phone.view.pluginfile.EditorView",{extend:"Ext.panel.Panel",alias:"widget.phone.pluginfileeditor",layout:"card",initComponent:function(){var e=this;e.border=0,e.items=[{xtype:"jecodeeditor",itemId:"HTML",editorMode:"htmlmixed",helpType:"APP",saveFn:function(){e.ownerCt.updateFile()}},{xtype:"jecodeeditor",itemId:"JS",helpType:"APP",saveFn:function(){e.ownerCt.updateFile()}},{xtype:"jecodeeditor",itemId:"CSS",editorMode:"css",useHelp:!1,saveFn:function(){e.ownerCt.updateFile()}},{xtype:"uxfilesfield",itemId:"FOLDER"}],e.callParent(arguments)},afterRender:function(){this.callParent(arguments)},loadData:function(e){e.get("bean")}}),Ext.define("JE.sys.phone.view.pluginfile.FilesView",{extend:"JE.core.view.TreeView",alias:"widget.phone.pluginfiles",initComponent:function(){var e=this,t=e.pluginId;e.type="func",e.url=JE.getUrlMaps("je.core.getTree"),e.funcData={info:{funcType:"tree"}},e.onlyItem=!1,e.params={tableCode:"JE_PHONE_PLUGIN_FILE",parentSql:" and FILE_PLUGIN_ID = '"+t+"' ",moreRoot:!0},e.hideHeaders=!0,e.columns=[{xtype:"treecolumn",flex:1,dataIndex:"text",editor:{xtype:"textfield"}}],e.rbar={xtype:"toolbar",itemId:"buttonBar",defaults:{tooltipType:"title"},items:[{tooltip:"添加",iconCls:"jeicon jeicon-new-fine-plus-circle",itemId:"add",handler:function(){e.ownerCt.addFile()}},{tooltip:"删除",iconCls:"jeicon jeicon-error-circle",itemId:"remove",handler:function(){e.ownerCt.removeFile()}},{tooltip:"保存",iconCls:"jeicon jeicon-save",itemId:"update",handler:function(){e.ownerCt.updateFile()}},{tooltip:"预览",iconCls:"jeicon jeicon-form-adjustment",itemId:"preview",handler:function(){return JE.alert("暂不支持预览")}}]},e.plugins=[Ext.create("Ext.grid.plugin.CellEditing",{clicksToEdit:2,pluginId:"cellEdit"})],e.buildDD(),e.callParent(arguments),e.on({load:function(){e.getSelectionModel().select(e.getRootNode().getChildAt(0))},edit:function(e,t){var i=t.record;JE.ajax({url:JE.getUrlMaps("je.core.update"),params:{tableCode:"JE_PHONE_PLUGIN_FILE",FILE_TEXT:i.get("text"),JE_PHONE_PLUGIN_FILE_ID:i.getId()}}),i.commit(),JE.msg("重命名成功！")},beforeedit:function(e,t){var i=t.record;return!("ROOT"==i.parentNode.get("nodeType")&&"index.html"==i.get("text"))}})},buildDD:function(){this.viewConfig={plugins:[{ptype:"treeviewdragdrop",allowParentInserts:!0}],listeners:{beforedrop:function(e,t,i,a,n){t.append=!1,t.order=!1,"append"==a?t.records[0].parentNode.getId()==i.getId()?n.cancelDrop():t.append=!0:(t.records[0].parentNode.getId()==i.parentNode.getId()||(t.append=!0),t.order=!0)},drop:function(e,t,i,a,n){var o=this.panel,r="JE_PHONE_PLUGIN_FILE_ID",l="JE_PHONE_PLUGIN_FILE",s={success:!0},d=t.records[0];if(t.append){var c=t.order?i.parentNode:i,u={tableCode:l,SY_PARENT:c.getId(),oldParentId:d.get("parent"),SY_PATH:c.getPath(),SY_LAYER:c.getDepth()+1};if(u[r]=d.getId(),(s=JE.ajax({url:JE.getUrlMaps("je.core.phone.phone","doTreeNodeMove"),params:u})).success){var p=s.obj;d.set("nodePath",p.SY_PATH),d.set("parent",p.SY_PARENT),d.commit()}else JE.alert(s.obj)}if(t.order&&s.success){var f=[];i.parentNode.eachChild(function(e){var t={};t[r]=e.get("id"),t.SY_ORDERINDEX=e.get("index")+1,e.set("orderIndex",t.SY_ORDERINDEX),f.push(t)}),s=JE.ajax({url:JE.getUrlMaps("je.core.updateList"),params:{strData:Ext.encode(f),tableCode:l}})}s.success?(o.getSelectionModel().deselectAll(),o.fireEvent("selectionchange",o.getSelectionModel(),[]),JE.msg("操作完成")):JE.alert(s.obj)}}}}}),Ext.define("JE.sys.phone.view.pluginfile.MainView",{extend:"Ext.panel.Panel",alias:"widget.phone.pluginfilemain",layout:"border",initComponent:function(){var e=this.pluginId;this.items=[{xtype:"phone.pluginfiles",region:"west",pluginId:e,width:200,itemId:"files",split:!0},{xtype:"phone.pluginfileeditor",region:"center",itemId:"editor",pluginId:e}],this.callParent(arguments)},afterRender:function(){this.callParent(arguments)},loadData:function(e){e.get("bean")},updateFile:function(e,t){var i=this.getCmp("editor"),a=this.getCmp("files");if(e=e||a.getSelectionModel().getSelection()[0]){var n=e.get("bean"),o=i.getCmp(n.FILE_TYPE).getValue();if(JE.ajax({url:JE.getUrlMaps("je.core.update"),params:{tableCode:"JE_PHONE_PLUGIN_FILE",FILE_CONTENT:o,JE_PHONE_PLUGIN_FILE_ID:n.JE_PHONE_PLUGIN_FILE_ID}}).success){JE.msg(Ext.value(t,"保存成功！")),n.FILE_CONTENT=o,e.set("bean",n);var r=i.getLayout().getActiveItem();r&&r.doChange&&r.doChange(!1)}}else JE.msg("请选择要保存的文件！")},addFile:function(){var t=this,e=t.getCmp("files"),i=e.getSelectionModel().getSelection()[0];i&&"FOLDER"!=i.get("nodeInfo")&&e.getSelectionModel().deselectAll(),JE.formWin({title:"文件",width:400,height:130,items:[{fieldLabel:"文件名",xtype:"textfield",name:"FILE_TEXT",allowBlank:!1},{fieldLabel:"文件类型",xtype:"cbbfield",name:"FILE_TYPE",configInfo:"JE_PHONE_FILETYPE",value:"JS",allowBlank:!1},{xtype:"hidden",name:"FILE_CONTENT"},{xtype:"hidden",name:"FILE_PLUGIN_ID",value:t.pluginId},{xtype:"hidden",name:"tableCode",value:"JE_PHONE_PLUGIN_FILE"}],fn:function(e){return t.saveFile(e)}})},saveFile:function(e){var t=this.getCmp("files"),i=t.getSelectionModel().getSelection()[0];if(o=(i=i||t.getRootNode()).findChild("text",e.text))return JE.alert("文件名已存在，请重新填写！"),!1;var a,n=i;a={SY_LAYER:n.getDepth()+1,SY_PARENT:n.get("id"),SY_PATH:n.getPath(),SY_NODETYPE:"FOLDER"==e.type?"GENERAL":"LEAF",SY_STATUS:"1",SY_ORDERINDEX:n.childNodes.length+1},Ext.apply(a,e);var o,r=JE.ajax({url:JE.getUrlMaps("je.core.save"),params:a});r.success?("GENERAL"==(o={id:(r=r.obj).JE_PHONE_PLUGIN_FILE_ID,text:r.FILE_TEXT,nodeType:r.SY_NODETYPE,nodeInfo:r.FILE_TYPE,expandable:!1,leaf:!0,children:[],bean:r}).nodeType&&(o.expandable=!0,o.leaf=!1),o=n.appendChild(o),n.expand(),t.getSelectionModel().select(o)):JE.alert(r.obj)},removeFile:function(e){var i=this.getCmp("files").getSelectionModel().getSelection()[0];i&&JE.confirm("确定删除吗？",function(e){if("ok"==e){var t=JE.ajax({url:JE.getUrlMaps("je.core","remove"),params:{tableCode:"JE_PHONE_PLUGIN_FILE",ids:i.get("id")}});t.success?(JE.msg("删除成功！"),i.remove()):JE.alert(t.obj)}})}}),Ext.define("JE.sys.phone.view.report.CfgView",{extend:"JE.sys.phone.view.app.CfgView",alias:"widget.phone.reportcfg",initComponent:function(){this.items=[{fieldLabel:"报表",xtype:"treessfield",name:"APP_REPORT_CODE",allowBlank:!1,columnWidth:.45,configInfo:"JE_CORE_REPORT,APP_REPORT_CODE,code,S"}],this.callParent(arguments)}}),Ext.define("JE.sys.phone.view.report.MainView",{extend:"Ext.tab.Panel",alias:"widget.phone.reportmain",initComponent:function(){this.defaults={bodyStyle:"background-color:#ffffff;",mainview:this,tbar:{xtype:"toolbar",itemId:"buttonBar",items:[{text:"保存",iconCls:"jeicon jeicon-save",itemId:"update"}]}},this.items=[{xtype:"phone.reportcfg",title:"报表"},{xtype:"phone.version"}],this.callParent(arguments),this.cfgview=this.getCmp("cfgview"),this.versionview=this.getCmp("versionview")},afterRender:function(){this.callParent(arguments)},loadData:function(e){var t=e.get("bean");this.record=e,this.cfgview.form.setValues(t),this.versionview.loadData(t.JE_PHONE_APP_ID)}}),Ext.define("JE.sys.phone.view.saas.CpBuySelView",{extend:"Ext.panel.Panel",border:0,frame:!1,alias:"widget.phone.cpbuyselview",layout:"fit",initComponent:function(){var e=Ext.value(this.useIds,""),t=Ext.value(this.apkConfig,{}),i=Ext.create("Ext.data.Store",{pageSize:30,remoteSort:!0,actUrls:"",autoLoad:!0,sqls:{},model:JE.getTreeModel(!1),proxy:{type:"jsonp",method:"POST",async:!0,url:"http://www.jesaas.com/saas/saasSellAction!loadBuyCps.action",extraParams:{userId:t.userId,apkId:t.apkId,apkKey:t.apkKey,phone:"1",useIds:e},reader:{type:"json",root:"rows",totalProperty:"totalCount"},writer:{type:"json"}}});this.items=[{xtype:"dataview",autoScroll:!0,tpl:['<tpl for=".">','<DIV class=table-files style="cursor:pointer;border: 1px solid #fff;table-layout:fixed;word-wrap:break-word;float:left;margin:9px;width:85px;height:133px;">','<div style="text-align:center;position: relative;">','<img width=64 height=64 src="{icon}" style="margin-top: 5px;"/>',"<tpl if=\"nodeInfoType != '0'\">",'<div style="width: 64px;height: 64px;position: absolute;top: 5px;left: 10px;">','<div style="height: 16px;line-height: 14px;margin-top: 23px;background-color: rgba(0, 119, 160, 0.78);color: #fff;">',"已使用","</div>","</div>","</tpl>","</div>",'<div class="x-editable" style="height:51px;padding-top:4px;text-align:center;overflow:hidden;text-overflow:ellipsis;" title="{text}">{text}<br/><span style="color:#999999;">{nodeType}</span></div>',"</div>","</tpl>"],multiSelect:!1,overItemCls:"x-dataview-item-over",trackOver:!0,selectedItemCls:"x-dataview-item-selected",itemSelector:"div.table-files",emptyText:"",store:i}],this.callParent()}}),Ext.define("JE.sys.phone.view.saas.CpBuyView",{extend:"Ext.panel.Panel",border:0,frame:!1,alias:"widget.phone.cpbuyview",layout:"fit",initComponent:function(){var e=Ext.value(this.apkConfig,{}),t=Ext.create("Ext.data.Store",{pageSize:30,remoteSort:!0,actUrls:"",autoLoad:!0,sqls:{},model:JE.getTreeModel(!1),proxy:{type:"jsonp",method:"POST",async:!0,url:"http://www.jesaas.com/saas/saasSellAction!loadBuyCps.action",extraParams:{userId:e.userId,apkId:e.apkId,apkKey:e.apkKey,phone:"1",useIds:""},reader:{type:"json",root:"rows",totalProperty:"totalCount"},writer:{type:"json"}}});this.items=[{xtype:"dataview",autoScroll:!0,tpl:['<tpl for=".">','<DIV class=table-files style="cursor:pointer;border: 1px solid #fff;table-layout:fixed;word-wrap:break-word;float:left;margin:9px;width:85px;height:133px;">','<div style="text-align:center;position: relative;">','<img width=64 height=64 src="{icon}" style="margin-top: 5px;"/>',"</div>",'<div class="x-editable" style="height:51px;padding-top:4px;text-align:center;overflow:hidden;text-overflow:ellipsis;" title="{text}">{text}<br/><span style="color:#999999;">￥{nodeInfo}</span></div>',"</div>","</tpl>"],multiSelect:!0,overItemCls:"x-dataview-item-over",trackOver:!0,itemSelector:"div.table-files",emptyText:"",store:t}],this.callParent()}}),Ext.define("JE.sys.phone.view.saas.CpDataView",{extend:"Ext.panel.Panel",border:0,frame:!1,alias:"widget.phone.cpdataview",layout:"fit",initComponent:function(){var e=Ext.value(this.apkConfig,{}),t=Ext.create("Ext.data.Store",{pageSize:30,remoteSort:!0,actUrls:"",autoLoad:!0,sqls:{},model:JE.getTreeModel(!1),proxy:{type:"jsonp",method:"POST",async:!0,url:"http://www.jesaas.com/saas/saasSellAction!loadAppCps.action",extraParams:{userId:e.userId,apkId:e.apkId,apkKey:e.apkKey,phone:"1"},reader:{type:"json",root:"rows",totalProperty:"totalCount"},writer:{type:"json"}}});this.items=[{xtype:"dataview",autoScroll:!0,tpl:['<tpl for=".">','<DIV class=table-files style="cursor:pointer;border: 1px solid #fff;table-layout:fixed;word-wrap:break-word;float:left;margin:9px;width:85px;height:133px;">','<div style="text-align:center;position: relative;">','<img width=64 height=64 src="{icon}" style="margin-top: 5px;"/>',"<tpl if=\"nodeInfoType != '0'\">",'<div style="width: 64px;height: 64px;position: absolute;top: 5px;left: 10px;">','<div style="height: 16px;line-height: 14px;margin-top: 23px;background-color: rgba(0, 119, 160, 0.78);color: #fff;">',"已购买","</div>","</div>","<tpl else>","<tpl if=\"CP_ZDYWZ != ''\">",'<div style="width: 64px;height: 64px;position: absolute;top: 5px;left: 10px;">','<div style="height: 16px;line-height: 14px;margin-top: 23px;{hrefTarget}">',"{href}","</div>","</div>","</tpl>","</tpl>","</div>",'<div class="x-editable" style="height:51px;padding-top:4px;text-align:center;overflow:hidden;text-overflow:ellipsis;" title="{text}">{text}<br/><span style="color:#999999;">￥{nodeInfo}</span></div>',"</div>","</tpl>"],multiSelect:!0,overItemCls:"x-dataview-item-over",trackOver:!0,itemSelector:"div.table-files",emptyText:"",store:t}],this.callParent()}}),Ext.define("JE.sys.phone.view.saas.CpPlView",{extend:"Ext.panel.Panel",alias:"widget.phone.cpplview",layout:"border",initComponent:function(){var t=this;t.listeners={afterrender:function(e){t.loadData()}},t.items=[{xtype:"box",flex:1,data:[],autoScroll:!0,tpl:['<tpl for=".">','<table width=100% border=0 style="text-align:center;border-collapse:collapse;border-spacing:0;">','<tr><td align=left width=80 valign = middle><b>{SY_CREATEUSERNAME}</b></td><td align=left valign = middle><div id="PX_{JE_SAAS_CPPL_ID}"></td></tr>',"<tr><td colspan=2 align=left valign = middle>{CPPL_NR}</td></tr>",'<tr><td colspan=2 align=left valign = middle style="color:#908B8B;">{SY_CREATETIME}</td></tr>',"</table>","</tpl>"],region:"center",border:0},{xtype:"form",layout:"column",border:0,frame:!0,autoScroll:!1,region:"south",height:140,defaults:{labelAlign:"right",xtype:"textfield",columnWidth:.9,labelWidth:50,padding:"1 0 1 0"},items:[{fieldLabel:"评价",unitListTpl:"[]",allowBlank:!1,name:"CPPL_PX",configInfo:"",editable:!1,hidden:!1,readOnly:!1,selectOnFocus:!1,xtype:"starfield",removed:!1,labelAlign:"right",padding:"1 0",margin:"0 0 3 0",columnWidth:.5},{xtype:"textarea",name:"CPPL_NR",labelAlign:"right",padding:"1 0",allowBlank:!1,margin:"0 0 3 0",fieldLabel:"内容",columnWidth:1},{xtype:"hidden",name:"JE_SAAS_CP_ID",value:t.cpId}],buttons:[{xtype:"button",text:"提交",ref:"okBtn",formBind:!0,iconCls:"jeicon jeicon-check"}],buttonAlign:"right"}],t.callParent(arguments)},loadData:function(){var o=this,e=o.cpId;Ext.data.JsonP.request({url:"http://jesaas.com/saas/saasSellAction!loadCppl.action",params:{cpId:e,phone:"1"},callback:function(e,t){if(e){var i=t.rows;o.down("box").update(i);for(var a=0;a<i.length;a++){var n=i[a];Ext.widget("starfield",{unitListTpl:"[]",allowBlank:!0,name:"CP_PX",configInfo:"",editable:!1,hidden:!1,readOnly:!0,selectOnFocus:!1,xtype:"starfield",removed:!1,labelAlign:"right",padding:"1 0",renderTo:"PX_"+n.JE_SAAS_CPPL_ID,margin:"0 0 3 0"}).setValue(n.CPPL_PX)}}}})}}),Ext.define("JE.sys.phone.view.saas.CpStepMainView",{extend:"Ext.panel.Panel",border:0,frame:!1,alias:"widget.phone.cpstepmainview",layout:"border",id:"saas_cpstepmainview_id",initComponent:function(){var t=this.values,e="",i=!0,a=Ext.htmlDecode(t.description);JE.isNotEmpty(a)&&-1!=a.indexOf("/JE/data/upload")&&(a=a.replaceAll("/JE/data/upload","http://www.jesaas.com/JE/data/upload")),e="1"==t.nodeInfoType?(i=!1,'<font color="#909090">已购买</font>'):'<font color="#909090">￥'+t.nodeInfo+"(未购买)</font>",this.items=[{xtype:"panel",ref:"cpInfo",region:"north",border:0,html:'<table width="100%" height="100%" name="__body"><tbody><tr><td rowspan="3" width="100" align="center" valign="middle"><img src="'+t.icon+'" name="image" style="width:64px;height:64px;"></td><td style="font-size:24px;font-family:黑体;" name="__text">'+t.text+'</td></tr><tr><td><div id="step_star_id"></div></td></tr><tr><td name="__text" id="step_href_id">'+e+'</td></tr><tr><td colspan="2" width="100" align="left" valign="middle"><div id="step_button_id"></div></td></tr></tbody></table>'},{xtype:"panel",bodyStyle:"border-top:1px solid #99bce8 !important;padding:10px;",autoScroll:!0,html:a,border:0,region:"center",code:"detail"},{xtype:"phone.cpplview",cpId:t.id,bodyStyle:"border-top:1px solid #99bce8 !important;padding:10px;background-color:#fff;",style:"background-color:#fff;",hidden:!0,border:0,autoScroll:!0,frame:!1,region:"center",code:"pinglun"},{xtype:"phone.cpuseview",bodyStyle:"border-top:1px solid #99bce8 !important;padding:10px;background:#fff;",autoScroll:!0,cpId:t.id,hidden:!0,html:"",border:0,region:"center",code:"usepanel"}],this.listeners={afterrender:function(e){Ext.widget("starfield",{unitListTpl:"[]",allowBlank:!0,name:"CP_PX",configInfo:"",editable:!1,hidden:!1,readOnly:!0,selectOnFocus:!1,xtype:"starfield",removed:!1,labelAlign:"right",padding:"1 0",renderTo:"step_star_id",margin:"0 0 3 0"}).setValue(t.enField),Ext.create("Ext.Container",{renderTo:"step_button_id",items:[{xtype:"button",text:"详情",toggleGroup:"showContext",pressed:!0,allowDepress:!1,toggleHandler:function(e,t){var i=Ext.getCmp("saas_cpstepmainview_id"),a=i.down("panel[code=detail]"),n=i.down("panel[code=pinglun]"),o=i.down("panel[code=usepanel]");a.show(),n.hide(),o.hide()}},{xtype:"button",text:"评论",margin:"0 0 0 1",allowDepress:!1,toggleGroup:"showContext",toggleHandler:function(e,t){var i=Ext.getCmp("saas_cpstepmainview_id"),a=i.down("panel[code=detail]"),n=i.down("panel[code=pinglun]"),o=i.down("panel[code=usepanel]");a.hide(),n.show(),o.hide()}},{xtype:"button",text:"谁在用",margin:"0 0 0 1",allowDepress:!1,toggleGroup:"showContext",toggleHandler:function(e,t){var i=Ext.getCmp("saas_cpstepmainview_id"),a=i.down("panel[code=detail]"),n=i.down("panel[code=pinglun]");i.down("panel[code=usepanel]").show(),a.hide(),n.hide()}},{xtype:"button",text:"立即购买",ref:"buyBtn",hidden:!i,margin:"0 0 0 1",menu:[{text:"微信支付",ref:"wxPay",iconCls:"jeicon jeicon-wechatpay",handler:function(e){JE.sys.phone.controller.AppController.doPay(e)}},{text:"支付宝支付",ref:"zfbPay",iconCls:"jeicon jeicon-alipay",handler:function(e){JE.sys.phone.controller.AppController.doPay(e)}}]}]})}},this.callParent()},refreshData:function(){var e=this.values,t=(this.down("panel[ref=cpInfo]"),"");t="1"==e.nodeInfoType?'<font color="#909090">已购买</font>':'<font color="#909090">￥'+e.nodeInfo+"(未购买)</font>";var i=Ext.get("step_href_id");i&&i.setHTML(t)}}),Ext.define("JE.sys.phone.view.saas.CpUseView",{extend:"Ext.panel.Panel",alias:"widget.phone.cpuseview",layout:"border",initComponent:function(){var t=this;t.listeners={afterrender:function(e){t.loadData()}},t.items=[{xtype:"box",flex:1,data:[],autoScroll:!0,tpl:['<tpl for=".">','<table width=100% border=0 style="text-align:center;border-collapse:collapse;border-spacing:0;">','<tr><td align=left width=200 valign = middle><b>{CPYH_GSMC}</b>&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#908B8B;">已使用: {SY_CREATETIME}</span></td></tr>',"<tr height=10><td colspan=2></td></tr>","</table>","</tpl>"],region:"center",border:0}],t.callParent(arguments)},loadData:function(){var a=this,e=a.cpId;Ext.data.JsonP.request({url:"http://jesaas.com/saas/saasSellAction!loadCpUse.action",params:{cpId:e,phone:"1"},callback:function(e,t){if(e){var i=t.rows;a.down("box").update(i)}}})}}),Ext.define("JE.sys.phone.view.saas.MainView",{extend:"Ext.tab.Panel",border:0,layout:"border",alias:"widget.phone.saasmain",initComponent:function(){var e=Ext.value(this.apkConfig,{});this.items=[{iconCls:"jeicon jeicon-mall",xtype:"phone.cpdataview",title:"市场",apkConfig:e},{iconCls:"jeicon jeicon-buildingblocks",xtype:"phone.cpbuyview",title:"已购",apkConfig:e},{iconCls:"jeicon jeicon-form",xtype:"phone.ordergridview",title:"订单",apkConfig:e}],this.bbar={xtype:"panel",layout:"fit",border:0,padding:4,items:{xtype:"button",style:"background: #FFFFCD;border: 1px solid rgb(247, 175, 97) !important;",scale:"large",text:"已购插件使用范围：购买插件时使用的jesaas.com账户为指定APP选购的插件可用。"}},this.callParent(arguments)},refreshData:function(){this.down("panel[xtype=phone.cpdataview]").down("dataview").getStore().load(),this.down("panel[xtype=phone.cpbuyview]").down("dataview").getStore().load(),this.down("panel[xtype=phone.ordergridview]").getStore().load()}}),Ext.define("JE.sys.phone.view.saas.OrderGridView",{extend:"Ext.grid.Panel",border:0,frame:!1,alias:"widget.phone.ordergridview",layout:"fit",columnLines:!0,multiSelect:!0,enableKeyNav:!0,initComponent:function(){var e=Ext.value(this.apkConfig,{}),t=Ext.create("Ext.data.Store",{pageSize:30,remoteSort:!0,actUrls:"",autoLoad:!0,sqls:{},model:JE.getTreeModel(!1),proxy:{type:"jsonp",method:"POST",async:!0,url:"http://www.jesaas.com/saas/saasSellAction!loadOrders.action",extraParams:{userId:e.userId,apkId:e.apkId,apkKey:e.apkKey,phone:"1"},reader:{type:"json",root:"rows",totalProperty:"totalCount"},writer:{type:"json"}}});this.store=t,this.columns=[{text:"No.",xtype:"rownumberer",widht:45},{text:"主键",dataIndex:"id",hidden:!0},{text:"订单号",dataIndex:"href",width:150},{text:"插件",dataIndex:"text",width:110},{text:"APP",dataIndex:"code",width:140},{text:"金额",dataIndex:"nodeInfoType",align:"right",width:80},{text:"付款时间",dataIndex:"description",width:130}],this.callParent()}}),Ext.define("JE.sys.phone.controller.AppController",{extend:"Ext.app.Controller",init:function(){var a=this,e={"[xtype=phone.appview] button[itemId=copy]":{click:function(e){var n=e.ownerCt.ownerCt,o=n.getSelectionModel().getSelection()[0],t=o.get("bean");JE.formWin({title:"复制功能",width:400,height:200,border:0,defaults:{labelWidth:80},items:[{fieldLabel:"原功能名称",xtype:"textfield",value:t.APP_TEXT,readOnly:!0},{fieldLabel:"编码",xtype:"textfield",value:t.APP_CODE,readOnly:!0},{fieldLabel:"新功能名称",xtype:"textfield",name:"APP_TEXT",value:t.APP_TEXT+"_copy",allowBlank:!1},{fieldLabel:"编码",xtype:"textfield",name:"APP_CODE",value:t.APP_CODE+"_copy",allowBlank:!1},{name:"JE_PHONE_APP_ID",value:t.JE_PHONE_APP_ID,xtype:"hidden"},{name:"SY_ORDERINDEX",value:JE.toNum(t.SY_ORDERINDEX)+1,xtype:"hidden"}],fn:function(e,t){var i=JE.ajax({url:JE.getUrlMaps("je.core.phone.phone","doCopyApp"),params:e});if(i.success){JE.msg("复制成功");var a={id:(e=i.obj).JE_PHONE_APP_ID,text:e.APP_TEXT,code:e.APP_CODE,nodeType:e.SY_NODETYPE,iconCls:"",expandable:!1,leaf:!0,children:[],bean:e};a=o.parentNode.insertChild(o.get("index")+1,a),o.parentNode.expand(),n.getSelectionModel().select(a)}else JE.alert(i.obj)}})}},"[xtype=phone.centerview] button[itemId=version]":{click:function(e){var t=e.ownerCt.ownerCt;JE.win({title:"版本发布",width:700,height:280,border:0,autoShow:!0,items:{xtype:"phone.addversion",cfgview:t}})}},"[xtype=phone.centerview] button[itemId=upTagVersion]":{click:function(e){var t=e.ownerCt.ownerCt.down("field[name=JE_PHONE_APP_ID]").getValue();if(JE.isEmpty(t))JE.alert("APP功能ID为空!");else{var i=new Array;i.push(t);var a=JE.ajax({url:"/je/upgrade/doAddUpTag",params:{type:"APPFUNC",ids:i.join(",")}});a.success?JE.msg(a.obj):JE.alert(a.obj)}}},"[xtype=phone.appview] button[itemId=import]":{click:function(i){JE.uploadFile({fileTypes:"zip",params:{funcCode:"JE_PHONE_APP",tableCode:"JE_PHONE_APP",jeFileType:"PLATFORM",beanTableCode:"JE_PHONE_APP",returnType:"all"},callback:function(e){JE.ajax({url:JE.getUrlMaps("je.core.phone.phone","importApps"),params:{file:e.url,apkId:i.apkId,docId:e.docInfo.JE_CORE_DOCUMENT_ID},async:!0,success:function(e){var t=Ext.decode(Ext.value(e.responseText,"{}"));t.success?(JE.alert("请对升级的功能重新授权，并重新发布！","升级成功"),i.up("[xtype=phone.appview]").load()):JE.alert(t.obj)}})}})}},"[xtype=phone.appview] button[itemId=export]":{click:function(a){JE.win({title:"功能",width:300,height:600,border:0,items:{xtype:"phone.appview",useSSWin:!0,apkId:a.apkId,whereSql:" and APP_TYPE not in('home') ",multiSelect:!0},useButton:!0,autoShow:!0,fn:function(e){var t=e.getCmp(0).getSelectionModel().getSelection(),i=[];Ext.each(t,function(e){i.push(e.getId())}),0<i.length&&JE.ajax({url:JE.getUrlMaps("je.core.phone.phone","exportApps"),params:{ids:i.join(","),apkId:a.apkId},async:!0,mask:!0,maskMsg:"升级包导出中，请稍等...",success:function(e){var t=Ext.decode(Ext.value(e.responseText,"{}"));t.success?(JE.msg("导出成功！"),window.open(t.obj)):JE.alert(t.obj)}})}})}},"[xtype=phone.appview] button[itemId=refresh]":{click:function(e){var t=JE.ajax({url:"/je/phone/clearApkCache"});t.success?JE.msg("刷新成功!"):JE.msg(t.obj)}},"[xtype=phone.appview] button[itemId=add]":{click:function(e){var t=e.ownerCt.ownerCt,i=t.getSelectionModel().getSelection()[0];i&&"LEAF"==i.get("nodeType")&&t.getSelectionModel().deselectAll(),JE.win({title:"模块添加",width:550,height:300,border:0,autoShow:!0,items:{xtype:"phone.addmodel",tree:t}})}},"[xtype=phone.appview] button[itemId=remove]":{click:function(e){var t=e.ownerCt.ownerCt.getSelectionModel().getSelection()[0],i=t.get("bean").APP_TYPE;"home"!=i?"login"!=i?t.hasChildNodes()?JE.alert("请删除子项！"):a.removeApp(t):JE.alert("登录页不可删除！"):JE.alert("首页不可删除！")}},"[xtype=phone.appview] button[itemId=preview]":{click:function(e){return JE.alert("暂不支持预览")}},"[xtype=phone.appview]":{selectionchange:function(e,t){var i=e.view.panel;if(!i.useSSWin){var a=i.mainview.getCmp("center"),n=t[0],o="folder",r={remove:!0,preview:!0,copy:!0,add:!1};if(n&&("home"==(o=n.get("bean").APP_TYPE)||"login"==o||("folder"==o?r.remove=n.hasChildNodes():(r.copy=!1,r.remove=!1,r.preview=-1==["func","chart","link"].indexOf(o)))),i.getDockedCmp("buttonBar").items.each(function(e){e.setDisabled(r[e.itemId])}),n){if("folder"!=o){a.getLayout().setActiveItem(o);var l=a.getLayout().getActiveItem();if(l.setActiveTab&&l.setActiveTab(0),Ext.each(["__formfield","__listfield"],function(e){var t=Ext.getCmp(e);t&&t.ownerCt.close()}),l.record!=n){var s=l.getCmp("cfgview");s&&s.form&&s.form.reset();var d=n.get("bean");d.APP_NUM=Ext.value(d.APP_NUM,"sql"),l.loadData(n)}}}else a.getLayout().setActiveItem("temp")}}},"panel[xtype=phone.cpdataview] dataview":{itemclick:function(e,t,i,a,n,o){var r=e.up("panel[xtype=phone.cpdataview]"),l=r.up("panel[xtype=phone.saasmain]"),s=Ext.clone(t.data);JE.win({title:t.get("text"),width:800,height:641,maximizable:!0,items:{xtype:"phone.cpstepmainview",border:0,mainview:l,values:s,apkConfig:r.apkConfig},autoShow:!0,useButton:!1,buttonAlign:"right",buttons:[{text:"关闭",iconCls:"jeicon jeicon-error",handler:function(e){e.up("window").close()}}]})}},"panel[xtype=phone.cpbuyview] dataview":{itemclick:function(e,t,i,a,n,o){var r=e.up("panel[xtype=phone.cpbuyview]"),l=r.up("panel[xtype=phone.saasmain]"),s=Ext.clone(t.data);JE.win({title:t.get("text"),width:800,height:641,maximizable:!0,items:{xtype:"phone.cpstepmainview",border:0,mainview:l,values:s,apkConfig:r.apkConfig},autoShow:!0,useButton:!1,buttonAlign:"right",buttons:[{text:"关闭",iconCls:"jeicon jeicon-error",handler:function(e){e.up("window").close()}}]})}},"panel[xtype=phone.cpplview] button[ref=okBtn]":{click:function(i){var e=i.up("form"),t=e.form.findField("CPPL_PX").getValue(),a=e.form.findField("CPPL_NR").getValue(),n=e.form.findField("JE_SAAS_CP_ID").getValue(),o=e.up("panel[xtype=phone.cpstepmainview]"),r=Ext.value(o.apkConfig,{});Ext.data.JsonP.request({url:"http://jesaas.com/saas/saasSellAction!doCppl.action",params:{tableCode:"JE_SAAS_CPPL",CPPL_PX:t,CPPL_NR:a,JE_SAAS_CP_ID:n,userId:r.userId,phone:"1"},callback:function(e,t){e&&t.success&&(JE.msg("评价成功!"),i.up("panel[xtype=phone.cpplview]").loadData(n))}})}}};a.control(e)},removeApp:function(i){i&&JE.confirm("确定删除吗？",function(e){if("ok"==e){var t=JE.ajax({url:JE.getUrlMaps("je.core","remove"),params:{tableCode:"JE_PHONE_APP",ids:i.get("id")}});t.success?(JE.msg("删除成功！"),i.remove()):JE.alert(t.obj)}})},statics:{doPay:function(r){var l=Ext.getCmp("saas_cpstepmainview_id"),s=l.values;if("1"!=s.nodeInfoType){var e=l.apkConfig,d={userId:e.userId,apkKey:e.apkKey,apkId:e.apkId,apkName:e.apkName,cpId:s.id,phone:"1"};"wxPay"==r.ref?d.payType="WX":"zfbPay"==r.ref&&(d.payType="ZFB"),Ext.data.JsonP.request({url:"http://jesaas.com/saas/saasSellAction!doPayOrder.action",params:d,callback:function(e,t){if(e)if(t.success){var i=t.obj.orderId,a="http://jesaas.com/saas/doWxOrderPay.action";"ZFB"==d.payType&&(a="http://jesaas.com/saas/doZfbOrderPay.action");var n=setInterval(function(){Ext.data.JsonP.request({url:"http://jesaas.com/saas/saasSellAction!jcOrder.action",params:{orderId:i,phone:"1"},callback:function(e,t){if(e&&t.success){if(l.values.nodeInfoType="1",l.refreshData(),l.mainview&&l.mainview.refreshData(),"ZFB"!=d.payType){var i=Ext.getCmp("saasplusbuywin_id");i&&i.close()}clearInterval(n)}}})},3e3),o=a+"?orderId="+i;"ZFB"==d.payType?window.open(o):JE.win({title:s.text,autoShow:!0,iconCls:r.iconCls,id:"saasplusbuywin_id",items:[{xtype:"panel",html:'<iframe scrolling="auto" frameborder="0" width="100%" height="100%" src='+o+"></iframe>"}]})}else JE.alert(t.obj);else JE.alert("请求失败，请稍后重试!")}})}else JE.alert("已经购买，无须重复购买!")}},views:["JE.sys.phone.view.app.AddVersion","JE.sys.phone.view.app.AddModel","JE.sys.phone.view.app.CenterView","JE.sys.phone.view.app.VersionView","JE.sys.phone.view.app.CfgView","JE.sys.phone.view.app.MainView","JE.sys.phone.view.app.AppView","JE.sys.phone.view.saas.MainView","JE.sys.phone.view.saas.CpBuyView","JE.sys.phone.view.saas.CpBuySelView","JE.sys.phone.view.saas.CpDataView","JE.sys.phone.view.saas.OrderGridView","JE.sys.phone.view.saas.CpStepMainView","JE.sys.phone.view.saas.CpPlView","JE.sys.phone.view.saas.CpUseView"]}),Ext.define("JE.sys.phone.controller.ChartController",{extend:"Ext.app.Controller",mixins:["JE.sys.phone.util.AppUtil"],init:function(){var a=this,e={"[xtype=phone.chartmain] button[itemId=update]":{click:function(e){var t=e.ownerCt.ownerCt,i=t.up("[xtype=phone.chartmain]").record;a.doAppSave(t,i)}}};a.control(e)},views:["JE.sys.phone.view.chart.MainView","JE.sys.phone.view.chart.CfgView"]}),Ext.define("JE.sys.phone.controller.CloudController",{extend:"Ext.app.Controller",mixins:["JE.sys.phone.util.AppUtil"],init:function(){var a=this,e={"[xtype=phone.cloudmain] button[itemId=update]":{click:function(e){var t=e.ownerCt.ownerCt,i=t.up("[xtype=phone.cloudmain]").record;a.doAppSave(t,i)}}};a.control(e)},views:["JE.sys.phone.view.cloud.MainView","JE.sys.phone.view.cloud.CfgView"]}),Ext.define("JE.sys.phone.controller.FuncController",{extend:"Ext.app.Controller",mixins:["JE.sys.phone.util.AppUtil"],init:function(){var b=this,e={"panel[xtype=phone.funcform] yesnofield":{change:function(e,t,i){var a=e.up("panel[ddPanel]"),n=e.up("panel[xtype=phone.funcform]");"readOnly"==e.name?n.setFieldReadOnly(a,JE.toBool(t)):"allowBlank"==e.name&&n.setFieldBlank(a,JE.toBool(t))}},"[xtype=phone.funcmain] button[itemId=update]":{click:function(e){var t=e.ownerCt.ownerCt,i=t.up("[xtype=phone.funcmain]"),a=i.record,n=a.get("bean"),o=t.itemId,r={tableCode:"JE_PHONE_APP",JE_PHONE_APP_ID:n.JE_PHONE_APP_ID};if("form"==o){var l=i.formview,s="JE_PHONE_APPFIELD",d="JE_PHONE_APPFIELD_ID",c=l.fieldStore,u={};l.doBeforeSave();var p=l.setOrderIndex(l);c.each(function(e){"1"==e.get("RESOURCEFIELD_HIDDEN")&&e.set("SY_ORDERINDEX",p++)});var f=[],E=[],m=c.getUpdatedRecords().concat(c.getNewRecords());if(Ext.Array.each(m,function(e){var t=e.getChanges();t[d]=e.data[d],JE.isEmpty(t[d])&&(t=e.data,E.push(e.get("APPFIELD_CODE"))),f.push(t)}),JE.isNotEmpty(f)&&(u=JE.ajax({url:JE.getUrlMaps("je.core.updateList"),params:{tableCode:s,strData:Ext.encode(f)}}),0<E.length)){var g=JE.ajax({url:JE.getUrlMaps("je.core.load"),params:{tableCode:s,limit:-1,whereSql:" AND APPFIELD_CODE IN('"+E.join("','")+"') and APPFIELD_APP_ID='"+n.JE_PHONE_APP_ID+"'"}}).rows;Ext.each(g,function(e){var t=c.findRecord("APPFIELD_CODE",e.APPFIELD_CODE);t&&t.set("JE_PHONE_APPFIELD_ID",e.JE_PHONE_APPFIELD_ID)})}var h=c.getRemovedRecords(),x=[];return Ext.each(h,function(e){var t=e.get("JE_PHONE_APPFIELD_ID");JE.isNotEmpty(t)&&x.push(t)}),JE.isNotEmpty(x)&&(u=JE.ajax({url:JE.getUrlMaps("je.core","remove"),params:{ids:x.join(","),tableCode:"JE_PHONE_APPFIELD"}})),void(u.success&&(JE.msg("保存成功"),c.commitChanges()))}if("list"==o)r.APP_FUNC_RENDERER=t.getCmp("jsview").getValue();else{if("cfgview"==o)return void b.doAppSave(t,a);if("buttonview"==o){var v=t.getCmp("buttons").getData();t.getCmp("buttons").commitValue(),Ext.each(v,function(e){e.id=Ext.value(e.id,JE.uuid())}),r.APP_FUNC_BUTTONS=Ext.encode(v)}else if("searchview"==o)r.APP_FUNC_SEARCHS=t.getCmp("searchs").getValue(),t.getCmp("searchs").commitValue();else if("jsview"==o)r.APP_FUNC_JS=t.getValue();else if("cssview"==o)r.APP_FUNC_CSS=t.getValue();else if("fieldcfgview"==o){r=t.form.getValues();if(i.formview.fieldStore.getById(r.APPFIELD_CODE).set(r),r.tableCode="JE_PHONE_APPFIELD",(u=JE.ajax({url:JE.getUrlMaps("je.core.update"),params:r})).success){JE.msg("保存成功");var y=t.query("jsonarrayfield");Ext.each(y,function(e){e.commitValue()}),t.currentField.titleBox.update(r.APPFIELD_NAME)}return}}(u=JE.ajax({url:JE.getUrlMaps("je.core.update"),params:r})).success&&(JE.msg("保存成功"),delete r.tableCode,a.raw.bean=Ext.apply(n,u.obj),a.set("bean",n),a.set("text",n.APP_TEXT),a.commit(),"list"==o&&i.listview.updateView(n,!0))}},"[xtype=phone.funcfield] button[itemId=addField]":{click:function(e){var n=e.ownerCt.ownerCt,o=n.dataType,t=n.appID;JE.formWin({title:"字段添加",width:400,height:150,items:[{xtype:"textfield",fieldLabel:"名称",name:"APPFIELD_NAME",allowBlank:!1},{xtype:"textfield",fieldLabel:"编码",name:"APPFIELD_CODE",allowBlank:!1},{xtype:"hidden",value:"textfield",name:"APPFIELD_XTYPE"},{xtype:"hidden",name:"tableCode",value:"JE_PHONE_APPFIELD"},{xtype:"hidden",name:"APPFIELD_TYPE",value:o},{xtype:"hidden",name:"APPFIELD_APP_ID",value:t},{xtype:"hidden",name:"APPFIELD_HIDDEN",value:"1"},{xtype:"hidden",name:"APPFIELD_ALLOWBLANK",value:"1"}],fn:function(e){var t=n.getRootNode();if(t.findChild("code",e.APPFIELD_CODE,!0))return JE.alert("字段编码已存在，请修改！"),!1;if((e=JE.ajax({url:JE.getUrlMaps("je.core","save"),params:e})).success){JE.msg("添加成功...");var i=e.obj,a={id:i.JE_PHONE_APPFIELD_ID,text:i.APPFIELD_NAME,code:i.APPFIELD_CODE,bean:i,leaf:!0,nodeType:"idit"};t.getChildAt(2).appendChild(a),"form"==o&&n.mainview.formview.addField(i)}}})}},"[xtype=phone.funcfield] button[itemId=loadData]":{click:function(e){var t=e.ownerCt.ownerCt,i=t.appBean,a=i.APP_FUNC_ID,n=i.JE_PHONE_APP_ID;JE.ajax({url:"/je/phone/doSyncFuncField",async:!0,mask:!0,maskMsg:"正在同步，请稍等...",params:{funcId:a,appId:n},success:function(e){t.loadData(t.buildData()),t.mainview.formview.fieldStore.reload(),JE.msg("同步成功!")}})}},"[xtype=phone.funcfield] button[itemId=refresh]":{click:function(e){var t=e.ownerCt.ownerCt;t.loadData(t.buildData()),JE.msg("刷新成功!")}},"[xtype=phone.funcmain] button[itemId=fieldview]":{click:function(e){var t=e.ownerCt.ownerCt,i=t.ownerCt.record.get("bean"),a=t.itemId,n=t.title;y=70,height=t.getEl().getHeight()-40,width=300,id="__"+a+"field",Ext.get(id)||e.up("[xtype=phone.mainview]").add({title:n+"资源库",width:width,minWidth:width,height:height,x:0,y:y,border:0,tbar:null,modal:!1,constrain:!0,xtype:"window",layout:"fit",items:{xtype:"phone.funcfield",id:id,dataType:a,appBean:i,mainview:t.ownerCt}}).show()}},"[xtype=phone.funcfieldcfg] textarea[name=APPFIELD_CONFIGINFO]":{afterrender:function(p){var f=p.up("form");p.labelEl.on("click",function(){bean=f.up("panel[xtype=phone.funcmain]").record.get("bean"),funcId=bean.JE_PHONE_APP_ID;var u=f.form.findField("APPFIELD_XTYPE").getValue();if("gridssfield"==u){var t=f.form.getValues(),e=f.up("panel[xtype=phone.mainview]").getCmp("appview");JE.win({title:"查询选择构造器",width:800,height:520,border:0,items:{xtype:"phone.funcfieldssconfig",appview:e,apkId:bean.APP_APK_ID},useButton:!0,autoShow:!0,fn:function(e){var t=e.getCmp(0).getConfigInfo();if(0==t)return!1;f.form.setValues({APPFIELD_CONFIGINFO:t.configInfo,APPFIELD_WHERESQL:t.whereSql,APPFIELD_OTHERCONFIG:t.otherConfig})},showFn:function(e){e.getCmp(0).loadConfigInfo({configInfo:t.APPFIELD_CONFIGINFO,otherConfig:t.APPFIELD_OTHERCONFIG,whereSql:t.APPFIELD_WHERESQL,funcId:funcId})}})}else-1!=["treessfield","rgroup","cgroup"].indexOf(u)&&JE.selectWin({title:"字典",configInfo:"JE_CORE_DICTIONARY",type:"grid",whereSql:" AND SY_JESYS='1'",callback:function(e){if(0<e.length){var t=JE.getFuncData(bean.APP_FUNC_CODE),i=e[0].get("DICTIONARY_DDCODE");e[0].get("DICTIONARY_DDTYPE");if(JE.isNotEmpty(t.basicFields)){var a=t.basicFields,n=f.form.findField("APPFIELD_CODE").getValue(),o="",r=["ID","CODE","NAME"],l=["id","code","text"];Ext.each(r,function(e){if(n.substring(n.length-e.length)==e)return o=n.substring(0,n.length-e.length),!1});var s=-1==["cgroup"].indexOf(u)?"S":"M";if(Ext.isEmpty(o))i+=","+n+",code,"+s;else{var d=[],c=[];Ext.each(r,function(e,t){a[o+e]&&(d.push(o+e),c.push(l[t]))}),i+=","+d.join("~")+","+c.join("~")+","+s}}p.setValue(i)}}})})}},"[xtype=phone.funcfield] button[itemId=winEdit]":{click:function(e){var i=e.ownerCt.ownerCt;JE.win({title:"数据模板(Ctrl+S保存)",items:{xtype:"jecodeeditor",itemId:"js",useHelp:!1,value:i.jsField.getValue(),saveFn:function(e){i.jsField.setValue(e);var t=i.getDockedCmp("buttonBar").getCmp("update");t.fireEvent("click",t)}},autoShow:!0})}},"[xtype=phone.funcmain]":{tabchange:function(e,t,i,a){var n=t;"jecodeeditor"!=n.xtype&&(n=t.down("jecodeeditor")),n&&n.editor}}};b.control(e)},views:["JE.sys.phone.view.func.ButtonView","JE.sys.phone.view.func.SearchView","JE.sys.phone.view.func.FormView","JE.sys.phone.view.func.ListView","JE.sys.phone.view.func.FieldView","JE.sys.phone.view.func.CfgView","JE.sys.phone.view.func.MainView","JE.sys.phone.view.func.FieldCfgView","JE.sys.phone.view.func.ListMainView","JE.sys.phone.view.func.FormMainView","JE.sys.phone.view.func.FieldSSConfig","JE.sys.phone.view.func.TemplateView","JE.sys.phone.view.func.TplInfoView"]}),Ext.define("JE.sys.phone.controller.HomeController",{extend:"Ext.app.Controller",init:function(){var e={"[xtype=phone.homeplanmain] button[itemId=update]":{click:function(e){var t=e.ownerCt.ownerCt,i=t.up("[xtype=phone.homemain]"),a=i.record,n=a.get("bean"),o=i.ownerCt.mainview.getCmp("appview").getRootNode();t.cfgview.saveCfg();var r=[],l=(t.pageBar.items.items,t.pageBody.items.items);Ext.each(l,function(e,t){var i=[];e.items.each(function(e){_data=e.itemData,_data.id=Ext.value(_data.id,JE.uuid()),"image"!=_data.type&&(_data.cfg=_data.cfg||{funcs:[]},Ext.each(_data.cfg.funcs,function(e){if("func"==e.type){if(JE.isEmpty(e.id)){var t=o.findChild("code",e.code,!0);t&&(e.id=t.get("bean").JE_PHONE_APP_ID)}}else JE.isEmpty(e.id)&&(e.id=JE.uuid()),e.funcs=Ext.value(e.funcs,[]),e.funcs=Ext.isString(e.funcs)?Ext.decode(e.funcs):e.funcs,Ext.each(e.funcs,function(e){if(JE.isEmpty(e.id)){var t=o.findChild("code",e.code,!0);t&&(e.id=t.get("bean").JE_PHONE_APP_ID)}})}),Ext.apply(_data,_data.cfg)),i.push(_data)});var a={data:i},n=Ext.clone(e.itemData);delete n.data,Ext.apply(a,n.cfg||n),r.push(a)});var s=JE.ajax({url:JE.getUrlMaps("je.core.update"),params:{tableCode:"JE_PHONE_APP",JE_PHONE_APP_ID:n.JE_PHONE_APP_ID,APP_HOME_CFG:JE.encode(r),APP_TEXT:"首页"}});s.success&&(JE.msg("保存成功"),a.raw.bean=Ext.apply(n,s.obj),a.set("bean",n),a.set("text",n.APP_TEXT),a.commit())}},"[xtype=phone.homeplanmain] button[itemId=addHome]":{click:function(e){var s=e.ownerCt.ownerCt,t=s.up("[xtype=phone.homemain]"),d=(t.record.get("bean"),t.ownerCt.mainview.getCmp("appview").getRootNode(),e.ownerCt.getCmp("update")),i=s.getCmp("plancenter"),c=i.getCmp("pageBar").items.length,u=i.getCmp("pageBody");if(6==c)return JE.alert("最多只能添加6个首页");Ext.create("Ext.window.Window",{title:"首页类型",height:250,width:400,layout:"column",modal:!0,bodyPadding:"0 10",defaults:{labelAlign:"right",margin:"2",columnWidth:1,labelWidth:60},items:[{xtype:"textfield",fieldLabel:"标题",name:"title",itemId:"pageTitle",value:"首页"},{xtype:"textfield",fieldLabel:"编码",name:"code",itemId:"pageCode",value:JE.uuid()},{xtype:"rgroup",fieldLabel:"类型",name:"type",itemId:"pageType",value:"home",dataArray:[{code:"home",text:"首页"},{code:"shortcut",text:"快捷菜单"},{code:"plugin",text:"插件"}]}],fbar:[{type:"button",text:"确定",handler:function(e){var t=this.up("window").getCmp("pageTitle").getValue()||"首页",i=this.up("window").getCmp("pageCode").getValue(),a=this.up("window").getCmp("pageType").getValue(),n="page"+(c+1),o=JE.uuid();s.getCmp("plancenter").getCmp("pageBar").add({text:t,itemId:o,toggleGroup:"homePageBar",handler:function(){u.getLayout().setActiveItem(o),u.getCmp(o).getEl().show();var e=u.getLayout().getActiveItem(),t=e.mainview.getCmp("east"),i=t.getCmp("cfgview");t.setWidth(400),t.getLayout().setActiveItem(i),i.loadData(e);var a=e.itemData.type;s.down("[xtype=phone.homebasiccfg]").getCmp("pluginText").setVisible("plugin"==a),s.down("[xtype=phone.homebasiccfg]").getCmp("relyOn").setVisible("shortcut"==a)},listeners:{afterrender:function(){this.getEl().dom.setAttribute("data-index",c),this.getEl().dom.setAttribute("data-itemid",o)}}});var r=u.add({xtype:"phone.homeplan",itemId:o,width:300,height:500}),l={title:t,type:a,code:i,cfg:{hideTitle:"",homeStyle:"",type:a,logoutColor:"",pageIcon:"",title:t,titleBGColor:"",relyOn:"",code:i,footerBtncolor:"",footerBtniconfont:"",footerTitle:"",footericonSVG:"",hidePage:"",leftupBtn:"",leftupBtncolor:"",leftupBtniconfont:"",leftupiconSVG:"",plugin:"",pluginid:"",rightupBtn:"",rightupBtncolor:"",rightupBtniconfont:"",rightupiconSVG:""},data:[]};r.itemData=l.cfg,r.titleBox=r.titleEl,r.setTitleText(n),d.fireEvent("click",d),this.up("window").close()}}]}).show()}}};this.control(e)},views:["JE.sys.phone.view.home.MainView","JE.sys.phone.view.home.PlanView","JE.sys.phone.view.home.ItemView","JE.sys.phone.view.home.PlanMainView","JE.sys.phone.view.home.CfgView","JE.sys.phone.view.home.MenuView","JE.sys.phone.view.home.MenuCfgView","JE.sys.phone.view.home.BasicCfgView","JE.sys.phone.view.home.TplCfgView"]}),Ext.define("JE.sys.phone.controller.LinkController",{extend:"Ext.app.Controller",mixins:["JE.sys.phone.util.AppUtil"],init:function(){var a=this,e={"[xtype=phone.linkmain] button[itemId=update]":{click:function(e){var t=e.ownerCt.ownerCt,i=t.up("[xtype=phone.linkmain]").record;a.doAppSave(t,i)}}};a.control(e)},views:["JE.sys.phone.view.link.MainView","JE.sys.phone.view.link.CfgView"]}),Ext.define("JE.sys.phone.controller.LoginController",{extend:"Ext.app.Controller",init:function(){var e={"[xtype=phone.logincfg] button[itemId=reset]":{click:function(e){var t=e.up("[xtype=phone.logincfg]"),i=t.mainview;i.record.get("bean").APP_LOGIN_CFG;i.planview.update(t.getData())}},"[xtype=phone.logincfg] button[itemId=update]":{click:function(e){var t=e.up("[xtype=phone.logincfg]"),i=t.mainview,a=i.record,n=a.get("bean"),o=Ext.encode(t.form.getValues()),r={tableCode:"JE_PHONE_APP",JE_PHONE_APP_ID:n.JE_PHONE_APP_ID,APP_LOGIN_CFG:o};JE.ajax({url:JE.getUrlMaps("je.core.update"),params:r}).success&&(JE.msg("保存成功"),n.APP_LOGIN_CFG=r.APP_LOGIN_CFG,a.set("bean",n),a.commit(),i.planview.update(t.getData()))}},"[xtype=phone.logintpl] dataview":{itemclick:function(t,i,e,a,n){if("ok"!=n.target.getAttribute("data-type")){var o="http://jesaas.com/"+i.get("LOGTEP_XGT").split("*")[1];JE.win({title:"图片预览",width:400,height:730,html:'<img src="'+o+'" height="100%">',bodyStyle:"background-color:#ffffff;text-align:center;",autoShow:!0,useButton:!0})}else JE.confirm("使用后将覆盖原有配置，确定吗？",function(e){"ok"==e&&t.ownerCt.updateLoginCfg(i)})},itemmouseenter:function(e,t,i,a){i.querySelector(".ok").style.display=""},itemmouseleave:function(e,t,i,a){i.querySelector(".ok").style.display="none"}}};this.control(e)},views:["JE.sys.phone.view.login.MainView","JE.sys.phone.view.login.PlanView","JE.sys.phone.view.login.CfgView","JE.sys.phone.view.login.TemplateView"]}),Ext.define("JE.sys.phone.controller.MainController",{extend:"Ext.app.Controller",init:function(){JE.loadScript("/static/js/je.pc.min.js"),JE.initCtr("JE.sys.phone.controller.FuncController"),JE.initCtr("JE.sys.phone.controller.PluginController"),JE.initCtr("JE.sys.phone.controller.ChartController"),JE.initCtr("JE.sys.phone.controller.HomeController"),JE.initCtr("JE.sys.phone.controller.ReportController"),JE.initCtr("JE.sys.phone.controller.AppController"),JE.initCtr("JE.sys.phone.controller.LoginController"),JE.initCtr("JE.sys.phone.controller.LinkController"),JE.initCtr("JE.sys.phone.controller.CloudController");var r=this,e={"[xtype=phone.apkview] dataview":{itemclick:function(e,t,i,a,n){if("delete"!=n.target.getAttribute("data-type"))if("edit"!=n.target.getAttribute("data-type")){var o=t.get("APK_CODE");if(JE.isEmpty(o))JE.alert("请先为该APP申请唯一性的APPID！");else JE.win({title:"功能规划",border:0,autoShow:!0,width:JE.getBodyWidth()-40,height:JE.getBodyHeight()-40,items:{xtype:"phone.mainview",record:t},showFn:function(e){var t=e.getCmp(0).getCmp("appview");t.getRootNode().eachChild(function(e){if("home"==e.get("bean").APP_TYPE)return t.getSelectionModel().select(e),!0})}})}else r.addApk(e.store,t);else r.removeApk(t)},refresh:function(e){e.getEl().down(".addApp").on("click",function(){r.addApk(e.store)})},itemmouseenter:function(e,t,i,a){var n=i.querySelector(".delete"),o=i.querySelector(".edit");n.style.display="",o.style.display=""},itemmouseleave:function(e,t,i,a){var n=i.querySelector(".delete"),o=i.querySelector(".edit");n.style.display="none",o.style.display="none"}}};r.initTpl(),r.control(e)},addApk:function(t,i){JE.win({title:(i?"编辑":"添加")+"APP应用",border:0,autoShow:!0,width:600,height:300,items:{xtype:"phone.addapk",record:i,border:0,callback:function(e){i?(i.set(e),i.commit()):t.add(e)}}})},removeApk:function(i){i&&JE.confirm("确定删除吗？",function(e){if("ok"==e){var t=JE.ajax({url:JE.getUrlMaps("je.core","remove"),params:{tableCode:"JE_PHONE_APK",ids:i.get("JE_PHONE_APK_ID")}});t.success?(JE.msg("删除成功！"),i.store.remove(i)):JE.alert(t.obj)}})},initTpl:function(){Ext.data.JsonP.request({url:"http://jesaas.com/saas/saasSellAction!loadTemplate.action?phone=1",callback:function(e,t){t=Ext.value(t,{JE_APP_GRIDTEM:[],JE_APP_GRIDTEM_MODEL:[],JE_APP_LOGTEP:[],JE_APP_LOGTEP_MODEL:[]});JE.appTpls={list:t.JE_APP_GRIDTEM,list_model:t.JE_APP_GRIDTEM_MODEL,login:t.JE_APP_LOGTEP,login_model:t.JE_APP_LOGTEP_MODEL},JE.appTpls.login_model.push({name:"LOGTEP_JSON"})}})},views:["JE.sys.phone.view.ApkView","JE.sys.phone.view.AddApk"]}),Ext.define("JE.sys.phone.controller.PluginController",{extend:"Ext.app.Controller",mixins:["JE.sys.phone.util.AppUtil"],init:function(){var a=this,e={"[xtype=phone.pluginmain] button[itemId=update]":{click:function(e){var t=e.ownerCt.ownerCt,i=t.up("[xtype=phone.pluginmain]").record;a.doAppSave(t,i)}}};a.control(e)},views:["JE.sys.phone.view.plugin.MainView","JE.sys.phone.view.plugin.CfgView"]}),Ext.define("JE.sys.phone.controller.PluginFileController",{extend:"Ext.app.Controller",mixins:["JE.sys.phone.util.ApkUtil"],init:function(){this.control({"#JE_PHONE_PLUGIN_jegridview actioncolumn[funcColumn]":{},"[xtype=phone.pluginfiles]":{selectionchange:function(e,t){var i=t[0];if(i){var a=e.view.panel,n=a.ownerCt.getCmp("editor");if(a.getDockedCmp("buttonBar").getCmp("remove").setDisabled("ROOT"==i.parentNode.get("nodeType")&&"index.html"==i.get("text")),n.fileRecord){var o=n.getLayout().getActiveItem().getValue();n.fileRecord.get("bean").FILE_CONTENT!=o&&a.ownerCt.updateFile(n.fileRecord,"自动保存完成！")}var r=(n.fileRecord=i).get("bean"),l=r.FILE_TYPE,s=r.FILE_CONTENT,d=n.getCmp(l);n.getLayout().setActiveItem(l),d.setValue(s)}}}})},doActionAct:function(e,t,i){var a=this;if("actionEditFiels"==i){var n=t.get("JE_PHONE_PLUGIN_ID");JE.win({title:"文件",border:0,autoShow:!0,showFn:function(e){e.add({xtype:"phone.pluginfilemain",border:0,pluginId:n})}})}else"actionVersion"==i&&(JE.APK_SAAS_USERID?a.toSaas(t):a.doSaasLogin(function(){a.toSaas(t)}))},toSaas:function(e){var t=JE.ajax({url:JE.getUrlMaps("je.core.phone.phone","buildPlugin"),params:{pluginId:e.get("JE_PHONE_PLUGIN_ID"),saasUserId:JE.APK_SAAS_USERID}});e.set("PLUGIN_VERSION",t.version),e.commit(),t.success?JE.msg("发布成功！"):JE.alert(t.obj)},views:["JE.sys.phone.view.pluginfile.MainView","JE.sys.phone.view.pluginfile.FilesView","JE.sys.phone.view.pluginfile.EditorView"]}),Ext.define("JE.sys.phone.controller.ReportController",{extend:"Ext.app.Controller",mixins:["JE.sys.phone.util.AppUtil"],init:function(){var a=this,e={"[xtype=phone.reportmain] button[itemId=update]":{click:function(e){var t=e.ownerCt.ownerCt,i=t.up("[xtype=phone.reportmain]").record;a.doAppSave(t,i)}}};a.control(e)},views:["JE.sys.phone.view.report.MainView","JE.sys.phone.view.report.CfgView"]}),Ext.define("JE.sys.saas.view.CpAppPermView",{extend:"Ext.tree.Panel",alias:"widget.saas.cpapppermview",useArrows:!0,rootVisible:!1,animate:!1,multiSelect:!0,title:"产品手机APK资源规划",funcTree:!0,selectType:"A",selModel:{selType:"treemodel",allowDeselect:!0,mode:"SIMPLE"},root:{text:"ROOT",id:"ROOT",expanded:!0,children:[]},buttonAlign:"left",buttons:[{text:"保存",ref:"okBtn",iconCls:"jeicon jeicon-check"},{text:"全选",iconCls:"jeicon jeicon-check-circle",ref:"selectAll"},{text:"全部展开",iconCls:"jeicon jeicon-arrow-down",ref:"expandAll"},{text:"全部收缩",iconCls:"jeicon jeicon-arrow-up",ref:"collapseAll"}]}),Ext.define("JE.sys.saas.view.CpFuncPermView",{extend:"Ext.tree.Panel",alias:"widget.saas.cpfuncpermview",useArrows:!0,rootVisible:!1,animate:!1,multiSelect:!0,funcTree:!0,selectType:"A",selModel:{selType:"treemodel",allowDeselect:!0,mode:"SIMPLE"},root:{text:"ROOT",id:"ROOT",expanded:!0,children:[]},buttonAlign:"left",buttons:[{text:"保存",ref:"okBtn",iconCls:"jeicon jeicon-check"},{text:"全选",iconCls:"jeicon jeicon-check-circle",ref:"selectAll"},{text:"全部展开",iconCls:"jeicon jeicon-arrow-down",ref:"expandAll"},{text:"全部收缩",iconCls:"jeicon jeicon-arrow-up",ref:"collapseAll"}]}),Ext.define("JE.sys.saas.view.CpMainView",{extend:"Ext.panel.Panel",border:0,frame:!1,alias:"widget.saas.cpmainview",layout:"border",items:[{region:"west",width:450,split:!0,title:"菜单权限资源",header:{height:30},xtype:"saas.cppermview",border:1},{xtype:"saas.cpfuncpermview",border:1,title:"无菜单功能权限资源",split:!0,header:{height:30},region:"center"}],load:function(e){var t=this.down("panel[xtype=saas.cppermview]"),i=this.down("panel[xtype=saas.cpfuncpermview]"),a=e.mainID,n=JE.ajax({url:JE.getUrlMaps("je.core.saas","loadCpPermTree"),params:{pkValue:a}});t.getRootNode().removeAll(),0<n.length&&t.getRootNode().appendChild(n);var o=JE.ajax({url:JE.getUrlMaps("je.core.saas","loadCpFuncPermTree"),params:{pkValue:a}});i.getRootNode().removeAll(),0<o.length&&i.getRootNode().appendChild(o);var r=JE.ajax({url:JE.getUrlMaps("je.core.saas","load"),params:{tableCode:"JE_SAAS_CPYHZY",whereSql:" AND CPYHZY_CPID='"+a+"' AND CPYHZY_TYPE IN ('CP','CPFUNC')",limit:-1}}).rows,l=t.getStore(),s=i.getStore(),d=new Array,c=new Array,u=new Array;Ext.each(r,function(e){var t,i=e.CPYHZY_ZYID;"CP"==e.CPYHZY_TYPE?(t=l.getNodeById(i))?(t.set("checked",!0),t.commit(),c.push(Ext.clone(t))):u.push(i):(t=s.getNodeById(i))&&(t.set("checked",!0),t.commit(),d.push(Ext.clone(t)))}),t.oldCheckedRecord=c,t.pkValue=a,i.oldCheckedRecord=d,i.pkValue=a,0<u.length&&JE.ajax({url:JE.getUrlMaps("je.core.saas","updateCpPerm"),params:{pkValue:a,addPermIds:"",delPermIds:u.join(",")}}).success},initComponent:function(){this.callParent(arguments)}}),Ext.define("JE.sys.saas.view.CpMenuMainView",{extend:"Ext.panel.Panel",border:0,frame:!1,alias:"widget.saas.cpmenumainview",layout:"fit",initComponent:function(){var e=JE.getStore({tableName:"JE_SAAS_CP",pageSize:-1,url:JE.getUrlMaps("je.core.saas","loadCps"),id:"JE_SAAS_CP_ID",params:{whereSql:" AND JE_SAAS_CP_ID!='"+JE.systemConfig.SYSTEM_ID+"' AND CP_YESORNO_CODE='1'",orderSql:" ORDER BY SY_ORDERINDEX"},autoLoad:!0});this.items=[{xtype:"dataview",autoScroll:!0,tpl:['<tpl for=".">','<DIV class=table-files style="cursor:pointer;border: 1px solid #fff;table-layout:fixed;word-wrap:break-word;float:left;margin:9px;width:85px;height:133px;">','<div style="text-align:center;position: relative;">','<img width=64 height=64 src="{CP_LOGO}" style="margin-top: 5px;"/>',"<tpl if=\"SY_CREATEUSER != '0'\">",'<div style="width: 64px;height: 64px;position: absolute;top: 5px;left: 10px;">','<div style="height: 16px;line-height: 14px;margin-top: 23px;background-color: rgba(0, 119, 160, 0.78);color: #fff;">',"已安装","</div>","</div>","<tpl else>","<tpl if=\"CP_ZDYWZ != ''\">",'<div style="width: 64px;height: 64px;position: absolute;top: 5px;left: 10px;">','<div style="height: 16px;line-height: 14px;margin-top: 23px;{CP_ZDYYS}">',"{CP_ZDYWZ}","</div>","</div>","</tpl>","</tpl>","</div>",'<div class="x-editable" style="height:51px;padding-top:4px;text-align:center;overflow:hidden;text-overflow:ellipsis;" title="{CP_MC}">{CP_MC}<br/><span style="color:{SY_CREATEORGNAME};">{CP_JG}</span></div>',"</div>","</tpl>"],multiSelect:!0,overItemCls:"x-dataview-item-over",trackOver:!0,itemSelector:"div.table-files",emptyText:"",store:e}],this.callParent()}}),Ext.define("JE.sys.saas.view.CpPermView",{extend:"Ext.tree.Panel",alias:"widget.saas.cppermview",useArrows:!0,rootVisible:!1,animate:!1,multiSelect:!0,funcTree:!0,selectType:"A",selModel:{selType:"treemodel",allowDeselect:!0,mode:"SIMPLE"},root:{text:"ROOT",id:"ROOT",expanded:!0,children:[]},buttonAlign:"left",buttons:[{text:"保存",ref:"okBtn",iconCls:"jeicon jeicon-check"},{text:"全选",iconCls:"jeicon jeicon-check-circle",ref:"selectAll"},{text:"全部展开",iconCls:"jeicon jeicon-arrow-down",ref:"expandAll"},{text:"全部收缩",iconCls:"jeicon jeicon-arrow-up",ref:"collapseAll"}]}),Ext.define("JE.sys.saas.view.CpPlView",{extend:"Ext.panel.Panel",alias:"widget.saas.cpplview",layout:"border",initComponent:function(){var t=this;t.listeners={afterrender:function(e){t.loadData()}},t.items=[{xtype:"box",flex:1,data:[],autoScroll:!0,tpl:['<tpl for=".">','<table width=100% border=0 style="text-align:center;border-collapse:collapse;border-spacing:0;">','<tr><td align=left width=80 valign = middle><b>{SY_CREATEUSERNAME}</b></td><td align=left valign = middle><div id="PX_{JE_SAAS_CPPL_ID}"></td></tr>',"<tr><td colspan=2 align=left valign = middle>{CPPL_NR}</td></tr>",'<tr><td colspan=2 align=left valign = middle style="color:#908B8B;">{SY_CREATETIME}</td></tr>',"</table>","</tpl>"],region:"center",border:0},{xtype:"form",layout:"column",border:0,frame:!0,autoScroll:!1,region:"south",height:140,defaults:{labelAlign:"right",xtype:"textfield",columnWidth:.9,labelWidth:50,padding:"1 0 1 0"},items:[{fieldLabel:"评价",unitListTpl:"[]",allowBlank:!1,name:"CPPL_PX",configInfo:"",editable:!1,hidden:!1,readOnly:!1,selectOnFocus:!1,xtype:"starfield",removed:!1,labelAlign:"right",padding:"1 0",margin:"0 0 3 0",columnWidth:.5},{xtype:"textarea",name:"CPPL_NR",labelAlign:"right",padding:"1 0",allowBlank:!1,margin:"0 0 3 0",fieldLabel:"内容",columnWidth:1},{xtype:"hidden",name:"JE_SAAS_CP_ID",value:t.cpId}],buttons:[{xtype:"button",text:"提交",ref:"okBtn",formBind:!0,iconCls:"jeicon jeicon-check"}],buttonAlign:"right"}],t.callParent(arguments)},loadData:function(){var e=this.cpId,t=JE.ajax({url:JE.getUrlMaps("je.core.load"),params:{tableCode:"JE_SAAS_CPPL",whereSql:" AND JE_SAAS_CP_ID='"+e+"'",orderSql:" ORDER BY SY_CREATETIME DESC",limit:-1}}).rows;this.down("box").update(t);for(var i=0;i<t.length;i++){var a=t[i];Ext.widget("starfield",{unitListTpl:"[]",allowBlank:!0,name:"CP_PX",configInfo:"",editable:!1,hidden:!1,readOnly:!0,selectOnFocus:!1,xtype:"starfield",removed:!1,labelAlign:"right",padding:"1 0",renderTo:"PX_"+a.JE_SAAS_CPPL_ID,margin:"0 0 3 0"}).setValue(a.CPPL_PX)}}}),Ext.define("JE.sys.saas.view.CpStepMainView",{extend:"Ext.panel.Panel",border:0,frame:!1,alias:"widget.saas.cpstepmainview",id:"saas_cpstepmainview_id",layout:"border",initComponent:function(){var t=this.values;this.listeners={afterrender:function(e){Ext.widget("starfield",{unitListTpl:"[]",allowBlank:!0,name:"CP_PX",configInfo:"",editable:!1,hidden:!1,readOnly:!0,selectOnFocus:!1,xtype:"starfield",removed:!1,labelAlign:"right",padding:"1 0",renderTo:"step_star_id",margin:"0 0 3 0"}).setValue(t.SY_CREATEUSERID),Ext.create("Ext.Container",{renderTo:"step_button_id",items:[{xtype:"button",text:"详情",toggleGroup:"showContext",pressed:!0,allowDepress:!1,toggleHandler:function(e,t){var i=Ext.getCmp("saas_cpstepmainview_id"),a=i.down("panel[code=detail]"),n=i.down("panel[code=pinglun]"),o=i.down("panel[code=usepanel]");a.show(),n.hide(),o.hide()}},{xtype:"button",text:"评论",margin:"0 0 0 1",allowDepress:!1,toggleGroup:"showContext",toggleHandler:function(e,t){var i=Ext.getCmp("saas_cpstepmainview_id"),a=i.down("panel[code=detail]"),n=i.down("panel[code=pinglun]"),o=i.down("panel[code=usepanel]");a.hide(),n.show(),o.hide()}},{xtype:"button",text:"谁在用",margin:"0 0 0 1",allowDepress:!1,toggleGroup:"showContext",toggleHandler:function(e,t){var i=Ext.getCmp("saas_cpstepmainview_id"),a=i.down("panel[code=detail]"),n=i.down("panel[code=pinglun]");i.down("panel[code=usepanel]").show(),a.hide(),n.hide()}}]})}};var e='<a style="color:blue;text-decoration:none;" href="javascript:void(0)" onclick="javascript:JE.sys.saas.controller.CpPermController.step(\''+t.JE_SAAS_CP_ID+"')\">直接安装</a>";if("1"==t.CP_CPXZ_CODE){if(e+='<font color="#909090">(试用30天)</font>&nbsp;&nbsp;&nbsp;&nbsp;<a style="color:blue;text-decoration:none;" href="javascript:void(0)" onclick="javascript:JE.sys.saas.controller.CpPermController.stepNum(\''+t.JE_SAAS_CP_ID+"')\">序列号安装</a>","1"==t.SY_CREATEUSER)if(e='<font color="#909090">已安装</font>',"1"==t.SY_CREATEORG){var i=t.SY_CREATEORGID,a=JE.DATE.parseDate(i),n=new Date;n=Ext.Date.clearTime(n),e+='<font color="#909090">(剩余'+(a.getTime()-n.getTime())/864e5+"天)</font>",e+='&nbsp;&nbsp;&nbsp;&nbsp;<a style="color:blue;text-decoration:none;" href="javascript:void(0)" onclick="javascript:JE.sys.saas.controller.CpPermController.stepNum(\''+t.JE_SAAS_CP_ID+"')\">序列号安装</a>"}else"2"==t.SY_CREATEORG&&(e+='<font color="#909090">(已购买)</font>')}else"1"==t.SY_CREATEUSER&&(e='<font color="#909090">已安装</font>');this.items=[{xtype:"panel",region:"north",border:0,html:'<table width="100%" height="100%" name="__body"><tbody><tr><td rowspan="3" width="100" align="center" valign="middle"><img src="'+t.CP_LOGO+'" name="image" style="width:64px;height:64px;"></td><td style="font-size:24px;font-family:黑体;" name="__text">'+t.CP_MC+'</td></tr><tr><td><div id="step_star_id"></div></td></tr><tr><td name="__text" id="step_href_id">'+e+'</td></tr><tr><td colspan="2" width="100" align="left" valign="middle"><div id="step_button_id"></div></td></tr></tbody></table>'},{xtype:"panel",bodyStyle:"border-top:1px solid #99bce8 !important;padding:10px;",autoScroll:!0,html:Ext.htmlDecode(t.CP_MS),border:0,region:"center",code:"detail"},{xtype:"saas.cpplview",cpId:t.JE_SAAS_CP_ID,bodyStyle:"border-top:1px solid #99bce8 !important;padding:10px;background-color:#fff;",style:"background-color:#fff;",hidden:!0,border:0,autoScroll:!0,frame:!1,region:"center",code:"pinglun"},{xtype:"saas.cpuseview",bodyStyle:"border-top:1px solid #99bce8 !important;padding:10px;",autoScroll:!0,cpId:t.JE_SAAS_CP_ID,hidden:!0,html:"",border:0,region:"center",code:"usepanel"}],this.callParent()}}),Ext.define("JE.sys.saas.view.CpUseView",{extend:"Ext.panel.Panel",alias:"widget.saas.cpuseview",layout:"border",initComponent:function(){var t=this;t.listeners={afterrender:function(e){t.loadData()}},t.items=[{xtype:"box",flex:1,data:[],autoScroll:!0,tpl:['<tpl for=".">','<table width=100% border=0 style="text-align:center;border-collapse:collapse;border-spacing:0;">','<tr><td align=left width=200 valign = middle><b>{CPYH_GSMC}</b>&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#908B8B;">已使用: {SY_CREATETIME}</span></td></tr>',"<tr height=10><td colspan=2></td></tr>","</table>","</tpl>"],region:"center",border:0}],t.callParent(arguments)},loadData:function(){var e=this.cpId,t=JE.ajax({url:JE.getUrlMaps("je.core.saas","loadCpUse"),params:{tableCode:"JE_SAAS_CPYH",pkValue:e,limit:-1}}).rows;this.down("box").update(t)}}),Ext.define("JE.sys.saas.view.CpYhAppPermView",{extend:"Ext.panel.Panel",layout:"fit",alias:"widget.saas.cpyhapppermview",initComponent:function(){this.items={xtype:"dataview",store:JE.getStore({tableName:"JE_PHONE_APK",id:"JE_PHONE_APK_ID",params:{whereSql:""},autoLoad:!0}),tpl:['<tpl for=".">','<div class="thumb-wrap" name="{APK_CODE}">','<div class="thumb">',"{APK_TEXT}({APK_CODE})","</div>","</div>","</tpl>"],multiSelect:!0,trackOver:!0,overItemCls:"x-dataview-item-over",selectedItemCls:"x-dataview-item-selected",itemSelector:"div.thumb-wrap",emptyText:""},this.callParent(arguments)}}),Ext.define("JE.sys.saas.view.CpYhDicPermView",{extend:"Ext.panel.Panel",layout:"fit",alias:"widget.saas.cpyhdicpermview",initComponent:function(){this.items={xtype:"dataview",store:JE.getStore({url:"/je/saas/cpYhDic/load",tableName:"JE_CORE_DICTIONARY",id:"JE_CORE_DICTIONARY_ID",params:{limit:-1},autoLoad:!1}),tpl:['<tpl for=".">','<div class="thumb-wrap" name="{DICTIONARY_DDCODE}">','<div class="thumb">',"{DICTIONARY_DDNAME}({DICTIONARY_DDCODE})","</div>","</div>","</tpl>"],multiSelect:!0,trackOver:!0,overItemCls:"x-dataview-item-over",selectedItemCls:"x-dataview-item-selected",itemSelector:"div.thumb-wrap",emptyText:""},this.tbar=[{text:"导入",iconCls:"jeicon jeicon-import",ref:"add"},{text:"删除",iconCls:"jeicon jeicon-error",ref:"remove"},{text:"删除全部",iconCls:"jeicon jeicon-cancel",ref:"removeAll"}],this.callParent(arguments)}}),Ext.define("JE.sys.saas.view.CpYhFuncPermView",{extend:"Ext.tree.Panel",alias:"widget.saas.cpyhfuncpermview",useArrows:!0,rootVisible:!1,title:"无菜单功能",header:{height:30},animate:!1,multiSelect:!1,funcTree:!0,selectType:"A",selModel:{selType:"treemodel",allowDeselect:!0,mode:"SIMPLE"},root:{text:"ROOT",id:"ROOT",expanded:!0,children:[]},buttonAlign:"left",tbar:[{text:"保存",ref:"okBtn",iconCls:"jeicon jeicon-save"},{text:"导入",iconCls:"jeicon jeicon-arrow-down",ref:"impFunc"},{text:"全选",iconCls:"jeicon jeicon-check-circle",ref:"selectAll"},{text:"刷新",iconCls:"jeicon jeicon-refresh",ref:"refreshBtn"}],initComponent:function(){this.dockedItems=[{xtype:"panel",layout:"fit",border:0,items:{xtype:"saas.cpyhapppermview"},title:"手机APK",header:{height:30},dock:"bottom",height:300}],this.callParent()}}),Ext.define("JE.sys.saas.view.CpYhGhPermView",{extend:"Ext.tree.Panel",alias:"widget.saas.cpyhghpermview",useArrows:!0,rootVisible:!1,animate:!1,multiSelect:!1,funcTree:!0,selectType:"N",selModel:{selType:"treemodel",allowDeselect:!0,mode:"SIMPLE"},root:{text:"ROOT",id:"ROOT",expanded:!0,children:[]}}),Ext.define("JE.sys.saas.view.CpYhMainView",{extend:"Ext.panel.Panel",border:0,frame:!1,alias:"widget.saas.cpyhmainview",layout:"border",items:[{region:"west",width:350,split:!0,xtype:"saas.cpyhpermview",border:1},{xtype:"saas.cpyhfuncpermview",border:1,split:!0,region:"center"}],initComponent:function(){this.callParent(arguments)}}),Ext.define("JE.sys.saas.view.CpYhPermView",{extend:"Ext.tree.Panel",alias:"widget.saas.cpyhpermview",useArrows:!0,rootVisible:!1,title:"产品资源",header:{height:30},animate:!1,multiSelect:!1,funcTree:!0,selectType:"A",selModel:{selType:"treemodel",allowDeselect:!0,mode:"SIMPLE"},root:{text:"ROOT",id:"ROOT",expanded:!0,children:[]},buttonAlign:"left",tbar:[{text:"规划",ref:"okBtn",iconCls:"jeicon jeicon-wrench-right"},{text:"展开",iconCls:"jeicon jeicon-arrow-down",ref:"expandAll"},{text:"收缩",iconCls:"jeicon jeicon-arrow-up",ref:"collapseAll"},{text:"刷新",iconCls:"jeicon jeicon-refresh",ref:"refreshBtn"}],initComponent:function(){this.dockedItems=[{xtype:"panel",layout:"fit",border:0,header:{height:30},items:{xtype:"saas.cpyhdicpermview"},title:"自维护字典",dock:"bottom",height:300}],this.callParent()}}),Ext.define("JE.sys.saas.view.DesktopView",{extend:"Ext.panel.Panel",border:0,frame:!1,alias:"widget.saas.desktopview",id:"_jesaas_dekstopview",layout:"fit",initComponent:function(){var e=JE.getUrlMaps("je.core.saas","loadDesktop");JE.isNotEmpty(JE.userStaticData.DESKTOP)&&(e=JE.userStaticData.DESKTOP);var t=JE.getStore({tableName:"JE_SAAS_CP",pageSize:-1,url:e,id:"JE_SAAS_CP_ID",params:{whereSql:" AND JE_SAAS_CP_ID!='"+JE.systemConfig.SYSTEM_ID+"' AND CP_YESORNO_CODE='1'",orderSql:" ORDER BY SY_CREATETIME DESC"},autoLoad:!0});t.on("load",function(e,t,i,a){var n=new Array;Ext.each(t,function(e){if("1"==e.get("CP_CPXZ_CODE")&&"0"==e.get("SY_CREATEORG")&&"MT"==e.get("CP_CPDKFS_CODE")&&Ext.each(Ext.value(e.get("CP_SYCDID"),"").split(","),function(e){JE.isNotEmpty(e)&&n.push(e)}),e.get("JE_SAAS_CP_ID")==JE.systemConfig.SYSTEM_WF_ID){var t=JE.ajax({url:JE.getUrlMaps("je.core.saas","loadWfCount")});t.success&&0<1*t.obj&&(e.set("CP_CSZH",1*t.obj),e.commit())}}),JE.systemConfig.CPDISABLEDMENU=n}),this.items=[{xtype:"dataview",autoScroll:!0,tpl:['<tpl for=".">','<DIV class=table-files style="cursor:pointer;border: 1px solid #fff;table-layout:fixed;word-wrap:break-word;float:left;margin:9px;width:85px;height:118px;">','<div style="text-align:center;position: relative;">','<img width=64 height=64 src="{CP_LOGO}" style="margin-top: 5px;"/>',"<tpl if=\"CP_CSZH != ''\">",'<div style="position: absolute;top: 0px;right: 0px;background: red;color: white;width: 20px;height: 20px;line-height: 20px;border-radius: 10px; -moz-border-radius: 10px; -webkit-border-radius: 10px;">',"{CP_CSZH}","</div>","</tpl>","</div>",'<div class="x-editable" style="height:36px;padding-top:4px;text-align:center;overflow:hidden;text-overflow:ellipsis;" title="{CP_MC}">{CP_MC}</div>',"</div>","</tpl>"],disableSelection:!0,multiSelect:!0,overItemCls:"x-dataview-item-over",trackOver:!0,itemSelector:"div.table-files",emptyText:"",store:t}],this.callParent()}}),Ext.define("JE.sys.saas.view.market.CenterView",{extend:"Ext.panel.Panel",border:0,alias:"widget.saas.centerview",layout:"card",initComponent:function(){var me=this;me.items=[{xtype:"saas.menuview",itemId:"ITEM"},{xtype:"saas.orderview",itemId:"BUY",type:"BUY"},{xtype:"saas.noteview",itemId:"NOTE",type:"NOTE"}];var items=[],itemStr=Ext.value(JE.systemConfig.JE_SYS_SAASJS,"[]");JE.isEmpty(itemStr)&&(itemStr="[]"),Ext.each(Ext.decode(itemStr),function(item){var obj={iconCls:item.icon,text:item.text,jsdm:item.jsdm};JE.isNotEmpty(item.jsdm)&&(obj.handler=function(btn){eval(btn.jsdm)}),items.push(obj)}),0<items.length&&(me.bbar={xtype:"toolbar",style:"background-color: #F2F2F2;",items:items}),me.bodyStyle="border-color: #cecece;",me.callParent()}}),Ext.define("JE.sys.saas.view.market.MainView",{extend:"Ext.panel.Panel",border:0,alias:"widget.saas.mainview",layout:"border",initComponent:function(){this.items=[{xtype:"saas.typeview",region:"west",itemId:"typeview",mainview:this,width:88},{xtype:"saas.centerview",mainview:this,itemId:"centerview",region:"center"}],this.callParent()}}),Ext.define("JE.sys.saas.view.market.MenuView",{extend:"Ext.panel.Panel",border:0,alias:"widget.saas.menuview",layout:"border",initComponent:function(){var e=Ext.value(JE.systemConfig.JE_SYS_SAASHTML,""),t=null;JE.isNotEmpty(e)&&(t={xtype:"box",region:"north",height:130,html:e});var i={xtype:"dataview",autoScroll:!0,region:"center",cls:"je-saas-menuview",tpl:['{% var typeName = "",itemIndex = 0;%}','<tpl for=".">',"{% ","if(typeName != values.CP_CPFL_NAME){typeName=values.CP_CPFL_NAME;","if(xindex>0){%}","</div>","{%}%}",'<div class="title">{CP_CPFL_NAME}</div>','<div class="typebody">',"{%}%}",'{% if(values.SY_CREATEUSER=="1"){values.CP_ZDYWZ="已安装";}if(values.SY_CREATEUSER=="2"){values.CP_ZDYWZ="已到期";}else if(JE.isEmpty(values.CP_ZDYWZ)){values.CP_ZDYYS = "display:none;"} %}','<div class="item">','<div class="icon">','<img width=64 height=64 src="{CP_TB}"/>','<div class="mask" style="{CP_ZDYYS}">',"{CP_ZDYWZ}","</div>","</div>",'<div class="text">{CP_MC}<br/><span style="color:{SY_JTGSMC};">{SY_CREATEORG}</span></div>',"</div>","{% if(xindex == xcount){%}","</div>","{%}%}","</tpl>"],overItemCls:"item-over",selectedItemCls:"item-selected",itemSelector:"div.item",store:JE.getStore({tableName:"JE_SAAS_CP",pageSize:-1,url:JE.getUrlMaps("je.core.saas.cpInfo","loadCps"),id:"JE_SAAS_CP_ID",params:{loadYaz:"0",whereSql:" ",orderSql:" ORDER BY SY_ORDERINDEX"},autoLoad:!0})};this.items=null!=t?[t,i]:[i],this.callParent()}}),Ext.define("JE.sys.saas.view.market.NoteView",{extend:"Ext.panel.Panel",border:0,alias:"widget.saas.noteview",layout:"vbox",bodyStyle:"background-color:#ffffff;",id:"saas_note_view",cls:"je-saas-noteview",initComponent:function(){this.items=[{xtype:"box",region:"north",itemId:"topview",width:"100%",cls:"infobox",html:"您未开通短信私有化服务<div class='button add'>立即开通</div>",listeners:{afterrender:function(e){var n=e.up("panel[xtype=saas.noteview]");e.getEl().on("click",function(e){var t=Ext.get(e.getTarget());if(t.hasCls("add")){var a=n.yhInfos;1*Ext.value(a.YH_SYDXTS,0)<100?JE.alert("开通短信私有化服务必须保证未使用短信条数在100条以上!"):JE.prompt("请输入您的签名，该签名会使用到用户接受短信息的头部",function(e,t){if("ok"==e){if(JE.isEmpty(t))return JE.alert("短信签名不能为空!"),!1;var i=JE.ajax({url:JE.getUrlMaps("je.core.saas.saasNote","sqDx"),params:{dxqm:t,yhId:a.JE_SAAS_YH_ID}});i.success?(JE.msg("申请成功!"),n.refreshInfo()):JE.alert(i.obj)}},"开通短信私有化服务")}else t.hasCls("update")&&JE.prompt("请输入您的签名，该签名会使用到用户接受短信息的头部",function(e,t){if("ok"==e){if(JE.isEmpty(t))return JE.alert("短信签名不能为空!"),!1;var i=JE.ajax({url:JE.getUrlMaps("je.core.saas.saasNote","updateDx"),params:{dxqm:t,yhId:a.JE_SAAS_YH_ID}});i.success?(JE.msg("申请成功!"),n.refreshInfo()):JE.alert(i.obj)}},"修改短信签名服务")})}}},{xtype:"box",width:"100%",cls:"pricebox",itemId:"centerview",tpl:['<div class="title green">未开通“私有化”服务的租户由系统统一提供短信服务</div>',"<table>","<tr>","<th>对比项</th>","<th>共有服务</th>","<th>私有服务</th>","</tr>","<tr>","<td>标签</td>","<td>固定标签：【一号员工】</td>",'<td class="green">可定制</td>',"</tr>","<tr>","<td>通道</td>","<td>功能通道</td>",'<td class="green">专有通道</td>',"</tr>","<tr>","<td>范畴</td>","<td>仅工作流、事务交办功能使用</td>",'<td class="green">所有用到短信的功能均可使用</td>',"</tr>","<tr>",'<td class="red" colspan="3">注意：由中国运营商限制70个字符为单条短信最大发送数量</td>',"</tr>","</table>",'<div class="title green">您当前未使用的短信数为<span class="red">{unuseCount}</span>条，已用<span class="red">{useCount}</span>条。<div class="button history">查询历史订单</div></div>',"<table>","<tr>","<th>套餐</th>","<th>套餐短信</th>","<th>价格（约）</th>","<th>充值</th>","</tr>",'<tpl for="sms">',"<tr>","<td>{name}</td>","<td>{count}</td>","<td>{price}</td>",'<td class="green"><span class="pay zfb" payType="zfb" data-code="{code}">支付宝</span>、<span class="pay weixin" payType="WX" data-code="{code}">微信</span></td>',"</tr>","</tpl>","</table>"],data:{useCount:1200,unuseCount:300,sms:[{code:"200",name:"200元套餐",count:"2000条",price:"0.09元/条"},{code:"500",name:"500元套餐",count:"6200条",price:"0.08元/条"},{code:"2000",name:"2000元套餐",count:"28000条",price:"0.07元/条"},{code:"10000",name:"10000元套餐",count:"200000条",price:"0.05元/条"}]},listeners:{afterrender:function(e){var a=e.up("panel[xtype=saas.noteview]");e.getEl().on("click",function(e){var t=Ext.get(e.getTarget());if(t.hasCls("zfb")){t.getAttribute("data-code");a.pay(t)}else if(t.hasCls("weixin")){t.getAttribute("data-code");a.pay(t)}else if(t.hasCls("history")){var i=a.yhInfos;if(!i)return void JE.alert("无用户信息，无法购买!");JE.showFunc("JE_SAAS_ORDER",{funcCode:"JE_SAAS_ORDER",readOnly:!0,whereSql:" AND ORDER_KH_ID='"+i.JE_SAAS_YH_ID+"' AND ORDER_PAYFL_CODE='note'",values:{},useChild:!1,type:"grid",id:""})}})}}}],this.callParent()},refreshInfo:function(){var e=this.down("box[itemId=topview]"),t=this.down("box[itemId=centerview]"),i=JE.ajax({url:JE.getUrlMaps("je.core.saas.saasNote","loadInfo"),params:{}});if(i.success){var a=i.obj,n={useCount:(this.yhInfos=a).YH_YFDXTS,unuseCount:a.YH_SYDXTS,sms:[{code:"200",name:"200元套餐",count:"2000条",price:"0.09元/条"},{code:"500",name:"500元套餐",count:"6200条",price:"0.08元/条"},{code:"2000",name:"2000元套餐",count:"28000条",price:"0.07元/条"},{code:"10000",name:"10000元套餐",count:"200000条",price:"0.05元/条"}]};t.update(n),"NOSTATUS"==a.NOTE_STATUS?e.update(a.NOTE_MSG+"<div class='button add'>立即申请</div>"):"WAIT"==a.NOTE_STATUS?e.update('<span style="color:red;">'+a.NOTE_MSG+"</span>"):"ENDED"==a.NOTE_STATUS&&e.update(a.NOTE_MSG+"<div class='button update'>申请修改</div>")}else{this.yhInfos=null;n={useCount:0,unuseCount:0,sms:[{code:"200",name:"200元套餐",count:"2000条",price:"0.09元/条"},{code:"500",name:"500元套餐",count:"6200条",price:"0.08元/条"},{code:"2000",name:"2000元套餐",count:"28000条",price:"0.07元/条"},{code:"10000",name:"10000元套餐",count:"200000条",price:"0.05元/条"}]};t.update(n),e.update("<h3>未找到该用户信息</h3>")}},pay:function(e){var t=this.yhInfos;if(t){var i=e.getAttribute("payType"),a=e.getAttribute("data-code");this.yhqInfo&&this.yhqInfo.code;var n=JE.ajax({url:JE.getUrlMaps("je.core.saas.saasNote","doPayOrder"),params:{payType:"PC",type:i,jtgsId:JE.currentUser.jtgsId,cpId:"NOTE_"+a,money:a,yhInfos:t.JE_SAAS_YH_ID}});if(n.success){var o=n.obj.JE_CORE_ORDER_ID,r="/sys/doOrderPay.action";"zfb"==i?(window.open(r+"?orderId="+o),Ext.getBody().mask("正在支付...")):(r+="?orderId="+o,JE.win({title:cpVals.CP_MC,iconCls:"jeicon jeicon-wechatpay",autoShow:!0,id:"menu_saascpwxpay_id",items:[{xtype:"panel",html:'<iframe scrolling="auto" frameborder="0" width="100%" height="100%" src='+r+"></iframe>"}]}))}else JE.alert("下订单失败，请稍后再试!")}else JE.alert("无用户信息，无法购买!")}}),Ext.define("JE.sys.saas.view.market.OrderView",{extend:"Ext.panel.Panel",border:0,alias:"widget.saas.orderview",layout:"border",bodyStyle:"background-color:#ffffff;",initComponent:function(){var e=Ext.create("Ext.data.Store",{fields:["text","code","icon","id","SY_CREATEORGID","SY_CREATEUSER","SY_CREATEORGNAME","beans"],data:this.getData()});this.items=[{xtype:"dataview",autoScroll:!0,region:"west",width:150,itemId:"view",mainview:this.mainview,cls:"je-saas-orderview",tpl:['<tpl for=".">','<div class="item">','<div class="icon"><img src="{icon}"></div>','<div class="text">{text}</div>',"</div>","</tpl>"],overItemCls:"item-over",selectedItemCls:"item-selected",itemSelector:"div.item",store:e,selModel:{deselectOnContainerClick:!1},listeners:{refresh:function(e){e.getSelectionModel().select(0)}}},{xtype:"box",region:"center",itemId:"info",cls:"je-saas-orderview-info",style:"padding:10px"}],this.callParent()},getInfoTpl:function(){return'<div>运行状况</div><table><tr><th width="100">状态</th><th width="100">安装日期</th><th width="100">到期类型</th><th width="100">到期日期</th><th width="100">剩余/过期天数</th><th>操作</th></tr><tr><td>{state}</td><td>{azTime}</td><td>{type}</td><td>{dqTime}</td><td>{syDate}</td><td><a href="javascript:void(0)" cpId="{cpId}" class="delay">{btnText}</a></td></tr></table><div>订单历史</div><table><tr><th width="150">订单号</th><th width="150">下单日期</th><th width="150">实付金额</th><th width="150">购买人</th><th>操作</th></tr><tpl for="items"><tr><td>{code}</td><td>{time}</td><td>{money}</td><td>{user}</td><td><a href="javascript:void(0);" cpId="{cpId}" orderId="{id}" class="buy">查看订单</a></td></tr></tpl></table>'},updateView:function(e){var t=e.data.id,i=(e.data.SY_CREATEORGID,e.data.SY_CREATEUSER),a=Ext.decode(e.data.SY_CREATEORGNAME),n=(JE.currentUser,[]),o=JE.ajax({url:JE.getUrlMaps("je.core.saas.cpInfo","loadSaasOrders"),params:{whereSql:"",cpId:t}});Ext.each(o,function(e){n.push({id:e.JE_CORE_ORDER_ID,code:e.ORDER_CODE,time:e.ORDER_FKSJ,user:e.SY_CREATEUSERNAME,company:e.SY_JTGSMC,money:e.ORDER_MONEY,cpId:e.ORDER_CP_ID})});var r={state:"未开通服务",azTime:"",type:"",dqTime:"",syDate:"",items:n,cpId:t,btnText:"购买"};if(JE.isEmpty(t)&&(r.btnText=""),"1"==i)r.state="在服务期",r.btnText="延期",r.azTime=a.CPYH_AZSJ,r.type=a.CPYH_DQLX_NAME,r.dqTime=a.CPYH_DQSJ,"01"==a.CPYH_DQLX_CODE?r.syDate=a.CPYH_SYTS+"天":(r.syDate="",r.btnText="查看");else if("2"==i){var l=new Date;if(l=Ext.Date.clearTime(l),r.syDate="","01"==a.CPYH_DQLX_CODE&&JE.isNotEmpty(a.CPYH_DQSJ)){var s=JE.DATE.parseDate(a.CPYH_DQSJ);r.syDate=(s.getTime()-l.getTime())/864e5+"天"}r.state="已到期",r.btnText="续费",r.azTime=a.CPYH_AZSJ,r.type=a.CPYH_DQLX_NAME,r.dqTime=a.CPYH_DQSJ}var d=this.getInfoTpl(),c=r,u=JE.toXT(d,c);this.getCmp("info").update(u)},getData:function(){var e=JE.ajax({url:JE.getUrlMaps("je.core.saas.cpInfo","loadCps"),params:{loadYaz:"1",whereSql:" ",orderSql:" ORDER BY SY_ORDERINDEX ASC"}}).rows;return this.buildBuy(e)},buildBuy:function(e){var t=[];return Ext.each(e,function(e){t.push({id:e.JE_SAAS_CP_ID,code:e.CP_DM,text:e.CP_MC,icon:e.CP_TB,SY_CREATEORGID:e.SY_CREATEORGID,SY_CREATEUSER:e.SY_CREATEUSER,SY_CREATEORGNAME:e.SY_CREATEORGNAME,beans:e})}),t.length<=0&&t.push({id:"",code:"",text:"",icon:JE.getStaticUrl("JE.sys.saas.view.market.OrderView.nocp"),SY_CREATEORGID:"",SY_CREATEUSER:"",SY_CREATEORGNAME:"{}",beans:"{}"}),t},buildPlugin:function(e){var t=[];return Ext.each(e,function(e){t.push({id:e.JE_SAAS_CP_ID,code:e.CP_DM,text:e.CP_MC,icon:e.CP_TB})}),t}}),Ext.define("JE.sys.saas.view.market.PriceView",{extend:"Ext.panel.Panel",border:0,alias:"widget.saas.priceview",initComponent:function(){this.buildTpl(),this.callParent()},afterRender:function(){var u=this;u.callParent(arguments);var p=u.values;u.update(p),u.body.on("click",function(e){var t=Ext.get(e.getTarget());if(t.hasCls("btn")){u.body.select(".btn").removeCls(["selected","active"]),Ext.each(u.body.query(".btn"),function(e){e.innerHTML=e.innerHTML.replace("个月","")}),t.addCls("selected"),-1==t.dom.innerHTML.indexOf("年")&&(t.dom.innerHTML+="个月"),u.calculatePrice(t);for(var i=t.prev();i;)i.addCls("active"),i=i.prev()}else if(t.hasCls("mfaz"))u.setupCp("mfaz");else if(t.hasCls("xf"))u.pay(t.parent());else if(t.hasCls("sy"))u.setupCp("sy");else if(t.hasCls("zfb")||t.hasCls("wx"))u.pay(t);else if(t.hasCls("yhm-btn")){var a=f.parent(".price").down(".price-num",!0),n=t.prev(".text").dom.value,o=t.prev(".msg"),r=t.prev(".msg2");if(JE.isNotEmpty(n)){var l=JE.ajax({url:JE.getUrlMaps("je.core.saas.cpYhq","checkYhq"),params:{j_code:n,cpId:p.JE_SAAS_CP_ID}});if(l.success){var s=l.obj;o.update(""),r.update(""),u.yhqInfo=s,u.yhqJs(a)}else r.update(""),o.update(l.obj),u.yhqInfo=null,u.yhqJs(a)}}else if(t.hasCls("callYhq")){a=f.parent(".price").down(".price-num",!0);var d=u.getEl().down(".yhm"),c=d.down(".text");o=d.down(".msg"),r=d.down(".msg2");c.dom.value="",o.update(""),r.update(""),u.yhqInfo=null,u.yhqJs(a)}});var f=u.body.down(".price .btn-group .btn");f.addCls("selected"),f.dom.innerHTML+="个月",u.calculatePrice(f)},buildTpl:function(){var e=this.values;JE.isNotEmpty(e.CP_MS)&&(e.CP_MS=Ext.htmlDecode(e.CP_MS)),this.cls="je-saas-priceview",this.tpl=['<div class="title" style="border-width:0px;">{CP_MC}<div class="sy"  style="display:{[this.getInfo(values,\'sy\')]};"><i class="fa fa-gift"></i> 免费试用({CP_KSYTS}天)</div></div>','<div class="price">','<div class="btn-group">','<div class="btn">1</div>','<div class="btn">2</div>','<div class="btn">3</div>','<div class="btn">4</div>','<div class="btn">5</div>','<div class="btn">6</div>','<div class="btn">7</div>','<div class="btn">8</div>','<div class="btn">9</div>','<div class="btn">10</div>','<div class="btn">11</div>','<div class="btn">1年 <i class="fa fa-gift"></i></div>','<div class="btn">2年 <i class="fa fa-gift"></i></div>','<div class="btn">3年 <i class="fa fa-gift"></i></div>',"</div>","<div style=\"padding-right:10px;\">{[this.getInfo(values,'fyxx')]}<div style=\"float:right;color:green;\">{[this.getInfo(values,'yhxx')]}</div></div>","<div>",'<div class="price-num" style="position: absolute;bottom:30px;">{[this.getInfo(values,\'moneyxx\')]}</div>','<div class="pay" style="bottom:0px;">','<div class="yhm" style="display:{[this.getInfo(values,\'zf\')]};"><span class="msg"></span><span class="msg2"></span><i class="fa fa-ticket"></i><input type="text" class="text" /><input type="button" value="使用" class="button yhm-btn"/></div>','<div class="mfaz" style="display:{[this.getInfo(values,\'mfaz\')]};"><input type="button" class="jeicon jeicon-arrow-down je-button-icon"/> 免费产品安装使用</div>','<div class="zfb" style="display:{[this.getInfo(values,\'zf\')]};"><input type="button" class="jeicon jeicon-alipay je-button-icon"/> 支付宝付款</div>','<div class="wx"  style="display:{[this.getInfo(values,\'zf\')]};"><input type="button" class="jeicon jeicon-wechatpay je-button-icon"/> 微信付款</div>','<div class="xf"  style="display:{[this.getInfo(values,\'xf\')]};"><input type="button" class="JE_COMM_MOANY1201 je-button-icon"/> 立即续费</div>',"</div>","</div>","</div>","<div class=\"title\">服务介绍  {[this.getInfo(values,'urlStr')]}</div>",'<div class="context">{CP_MS}</div>',{getInfo:function(e,t){var i="none",a="none",n="none",o=e.CP_URLJS,r='<a style="color:blue;text-decoration:none;" href="javascript:void(0)" onclick="javascript:window.open(\''+o+"');\">详细了解产品</a>";JE.isEmpty(o)&&(r=""),JE.currentUser.saas||("0"==e.SY_CREATEUSER?"1"==e.SY_CREATEUSERNAME?i="":(a="",n="1"==e.SY_CREATEUSERID?"none":""):"1"==e.SY_CREATEUSER?"1"==e.SY_CREATEUSERNAME||(a=""):"2"==e.SY_CREATEUSER&&("1"==e.SY_CREATEUSERNAME?i="":a=""));var l="每月"+e.CP_MONEY+"元，一次性购买满12个月折扣"+e.CP_MYNZK+"折。",s="",d="0元";return"1"==e.SY_CREATEUSERNAME&&(l="该产品为免费产品，可以直接安装使用.",s="",d="免费"),"fyxx"==t?l:"mfaz"==t?i:"zf"==t?a:"sy"==t?n:"xf"==t?"none":"urlStr"==t?r:"moneyxx"==t?d:"yhxx"==t?s:""}}]},calculatePrice:function(e){var t=this.values,i=e.parent(".price").down(".price-num",!0);if("1"==t.CP_SFLX_CODE){var a=1*Ext.value(t.CP_MONEY,"0"),n=1*Ext.value(t.CP_MYNZK,"0"),o=e.dom.innerText;JE.isNotEmpty(o)&&-1!=o.indexOf("个月")&&(o=o.replace("个月","")),JE.isNotEmpty(o)&&-1!=o.indexOf("年")&&(-1!=o.indexOf("1年")?o="1年":-1!=o.indexOf("2年")?o="2年":-1!=o.indexOf("3年")&&(o="3年")),"2年"==o?o="24":"3年"==o?o="36":"1年"==o&&(o="12");var r=JE.toNum(o),l=r*a,s=0;12<=r&&0<n&&n<100&&(s=1*Ext.Number.toFixed(l-l*(n/10),2),l=1*Ext.Number.toFixed(l*(n/10),2));var d="";0<s&&(d='<span style="color:#390;font-size:14px;line-height:1;">整年购买,已为您节省'+s+"元</span>"),this.moneyInfo={month:r,price:l,jsxx:d},this.yhqInfo?this.yhqJs(i):i.innerHTML=l+"元"+d}else i.innerHTML="免费"},yhqJs:function(e){var t=this.yhqInfo;if((i=this.moneyInfo)||(e.innerHTML=""),t&&0<1*Ext.value(t.price,"0")){var i=this.moneyInfo,a=1*Ext.value(t.price,"0"),n="",o="、",r=i.price;if(JE.isEmpty(i.jsxx)&&(o=""),"1"==t.type)r=1*r<=1*a?(a=Ext.Number.toFixed(r-1,2),1):Ext.Number.toFixed(r-a,2),n='<span style="color:#390;font-size:14px;line-height:1;">'+o+"【返现优惠券】为您节省"+this.formatMoneyVal(a)+'元</span><span class="callYhq" style="color: red;font-size: 14px;line-height: 1;margin-left: 10px;cursor: pointer;">取消使用</span>';else if("2"==t.type){var l=1*Ext.Number.toFixed(r-r*(a/10),2);n='<span style="color:#390;font-size:14px;line-height:1;">'+o+"【折扣优惠券】为您节省"+this.formatMoneyVal(l)+'元</span><span class="callYhq" style="color: red;font-size: 14px;line-height: 1;margin-left: 10px;cursor: pointer;">取消使用</span>',r=Ext.Number.toFixed(r*(a/10),2)}else"3"==t.type&&(n='<span style="color:#390;font-size:14px;line-height:1;">'+o+"【延长优惠券】延长了"+this.formatMoneyVal(a)+'天</span><span class="callYhq" style="color: red;font-size: 14px;line-height: 1;margin-left: 10px;cursor: pointer;">取消使用</span>');e.innerHTML=this.formatMoneyVal(r)+"元"+i.jsxx+n}else e.innerHTML=this.formatMoneyVal(i.price)+"元"+i.jsxx},setupCp:function(n){var o=this,r=o.values,e="是否安装该产品";"sy"==n&&(e="是否免费试用并安装该产品"),JE.confirm(e+"?",function(e){if("ok"==e){var t=JE.ajax({url:JE.getUrlMaps("je.core.saas","setupSaasCp"),params:{cpId:r.JE_SAAS_CP_ID,type:n}});if(t.success){if(JE.confirm("产品安装成功,重新刷新获取新产品功能，是否刷新?",function(e){"ok"==e&&location.reload(!0)}),o.orderView){var i=o.orderView.getData();o.orderView.down("dataview").store.loadData(i);var a={};Ext.each(i,function(e){e.id==r.JE_SAAS_CP_ID&&(a=e)}),o.orderView.updateView({data:a})}o.menuview&&o.menuview.down("dataview").store.load(function(e,t,i){var a=null;Ext.each(e,function(e){e.get("JE_SAAS_CP_ID")==r.JE_SAAS_CP_ID&&(a=e)}),a&&(o.values=Ext.clone(a.data),o.update(o.values))})}else JE.alert(t.obj)}})},pay:function(e){var t=this.values,i=e.getAttribute("class"),a=this.moneyInfo;if(a){var n=a.month,o="";this.yhqInfo&&(o=this.yhqInfo.code);var r=JE.ajax({url:JE.getUrlMaps("je.core.saas","doPayCpOrder"),params:{payType:"PC",type:i,jtgsId:JE.currentUser.zhId,jtgsId:JE.currentUser.jtgsId,cpId:t.JE_SAAS_CP_ID,months:n,yhqCode:o}});if(r.success){var l=r.obj.JE_CORE_ORDER_ID,s="/sys/doOrderPay.action";if("zfb"==i){var d=this.up("window");d&&d.getEl().mask("正在支付..."),window.open(s+"?orderId="+l)}else s+="?orderId="+l,JE.win({title:t.CP_MC,iconCls:"jeicon jeicon-wechatpay",autoShow:!0,id:"menu_saascpwxpay_id",items:[{xtype:"panel",html:'<iframe scrolling="auto" frameborder="0" width="100%" height="100%" src='+s+"></iframe>"}]})}else JE.alert("下订单失败，请稍后再试!")}else JE.alert("请选择月份!")},formatMoneyVal:function(e){var t=e+"";return JE.isEmpty(t)?0:-1!=t.indexOf(".00")?t=t.substring(0,t.length-3):t}}),Ext.define("JE.sys.saas.view.market.TypeView",{extend:"Ext.panel.Panel",border:0,alias:"widget.saas.typeview",layout:"fit",initComponent:function(){var e=Ext.create("Ext.data.Store",{fields:["text","code","icon"],data:[{code:"ITEM",text:"精选",icon:"star"},{code:"BUY",text:"已购",icon:"buy"},{code:"NOTE",text:"短信",icon:"plugin"}]});this.items=[{xtype:"dataview",autoScroll:!0,mainview:this.mainview,cls:"je-saas-typeview",tpl:['<tpl for=".">','<div class="item">','<div class="icon"><img src="{[this.getIcon(values.icon)]}">','<img class="selected" src="{[this.getIcon(values.icon,true)]}">',"</div>",'<div class="text">{text}</div>',"</div>","</tpl>",{getIcon:function(e,t){return JE.getStaticUrl("JE.sys.saas.view.market.TypeView."+e+(t?"-selected":""))}}],overItemCls:"item-over",selectedItemCls:"item-selected",itemSelector:"div.item",store:e,selModel:{deselectOnContainerClick:!1},listeners:{refresh:function(e){e.getSelectionModel().select(0)}}}],this.callParent()}}),Ext.define("JE.sys.saas.controller.CpPermController",{extend:"Ext.app.Controller",init:function(){var e={"panel[xtype=saas.cppermview] button[ref=okBtn]":{click:function(e){var t=e.up("panel[xtype=saas.cpmainview]").down("panel[xtype=saas.cppermview]"),n=new Array,i=new Array,a=t.getChecked(),o=t.oldCheckedRecord;Ext.each(a,function(t){var i=!1;if(Ext.each(o,function(e){t.get("id")==e.get("id")&&(i=!0,e.isHave=!0)}),!i){var e=t.getPath(),a=e.indexOf("/",6);-1!=a?e.substring(6,a):e.substring(6);t.raw.nodeInfoType;n.push(t.get("id"))}}),Ext.each(o,function(e){e.isHave||i.push(e.get("id")),delete e.isHave});var r=JE.ajax({url:JE.getUrlMaps("je.core.saas","updateCpPerm"),params:{permType:"CP",pkValue:t.pkValue,addPermIds:n.join(","),delPermIds:i.join(",")}});r.success&&(t.oldCheckedRecord=a,JE.msg(r.obj))}},"panel[xtype=saas.cppermview] button[ref=selectAll]":{click:function(e){e.up("panel[xtype=saas.cpmainview]").down("panel[xtype=saas.cppermview]").getRootNode().cascadeBy(function(e){e.set("checked",!0),e.commit()})}},"panel[xtype=saas.cppermview] button[ref=expandAll]":{click:function(e){e.up("panel[xtype=saas.cpmainview]").down("panel[xtype=saas.cppermview]").expandAll()}},"panel[xtype=saas.cppermview] button[ref=collapseAll]":{click:function(e){e.up("panel[xtype=saas.cpmainview]").down("panel[xtype=saas.cppermview]").collapseAll()}},"panel[xtype=saas.cpapppermview] button[ref=okBtn]":{click:function(e){var t=e.up("panel[xtype=saas.cpapppermview]"),n=new Array,i=new Array,a=t.getChecked(),o=t.oldCheckedRecord;Ext.each(a,function(t){var i=!1;if(Ext.each(o,function(e){t.get("id")==e.get("id")&&(i=!0,e.isHave=!0)}),!i){var e=t.getPath(),a=e.indexOf("/",6);-1!=a?e.substring(6,a):e.substring(6);t.raw.nodeInfoType;n.push(t.get("id"))}}),Ext.each(o,function(e){e.isHave||i.push(e.get("id")),delete e.isHave});var r=JE.ajax({url:JE.getUrlMaps("je.core.saas","updateCpPerm"),params:{permType:"APP",pkValue:t.cpId,apkId:t.apkId,addPermIds:n.join(","),delPermIds:i.join(",")}});r.success&&(t.oldCheckedRecord=a,JE.msg(r.obj))}},"panel[xtype=saas.cpapppermview] button[ref=selectAll]":{click:function(e){e.up("panel[xtype=saas.cpapppermview]").getRootNode().cascadeBy(function(e){e.set("checked",!0),e.commit()})}},"panel[xtype=saas.cpapppermview] button[ref=expandAll]":{click:function(e){e.up("panel[xtype=saas.cpapppermview]").expandAll()}},"panel[xtype=saas.cpapppermview] button[ref=collapseAll]":{click:function(e){e.up("panel[xtype=saas.cpapppermview]").collapseAll()}},"panel[xtype=saas.cpfuncpermview] button[ref=okBtn]":{click:function(e){var t=e.up("panel[xtype=saas.cpmainview]").down("panel[xtype=saas.cpfuncpermview]"),a=new Array,i=new Array,n=t.getChecked(),o=t.oldCheckedRecord;Ext.each(n,function(t){var i=!1;if(Ext.each(o,function(e){t.get("id")==e.get("id")&&(i=!0,e.isHave=!0)}),!i){t.raw.nodeInfoType;a.push(t.get("id"))}}),Ext.each(o,function(e){e.isHave||i.push(e.get("id")),delete e.isHave});var r=JE.ajax({url:JE.getUrlMaps("je.core.saas","updateCpPerm"),params:{permType:"CPFUNC",pkValue:t.pkValue,addPermIds:a.join(","),delPermIds:i.join(",")}});r.success&&(t.oldCheckedRecord=n,JE.msg(r.obj))}},"panel[xtype=saas.cpfuncpermview] button[ref=selectAll]":{click:function(e){e.up("panel[xtype=saas.cpmainview]").down("panel[xtype=saas.cpfuncpermview]").getRootNode().cascadeBy(function(e){e.set("checked",!0),e.commit()})}},"panel[xtype=saas.cpfuncpermview] button[ref=expandAll]":{click:function(e){e.up("panel[xtype=saas.cpmainview]").down("panel[xtype=saas.cpfuncpermview]").expandAll()}},"panel[xtype=saas.cpfuncpermview] button[ref=collapseAll]":{click:function(e){e.up("panel[xtype=saas.cpmainview]").down("panel[xtype=saas.cpfuncpermview]").collapseAll()}},"panel[xtype=saas.cpyhpermview] button[ref=expandAll]":{click:function(e){e.up("jemainview").down("panel[xtype=saas.cpyhpermview]").expandAll()}},"panel[xtype=saas.cpyhpermview] button[ref=collapseAll]":{click:function(e){e.up("jemainview").down("panel[xtype=saas.cpyhpermview]").collapseAll()}},"panel[xtype=saas.cpyhpermview] button[ref=refreshBtn]":{click:function(e){var t=e.up("jemainview").down("jegridview");t.fireEvent("selectionchange",t.getSelectionModel(),t.getSelectionModel().getSelection())}},"panel[xtype=saas.cpyhpermview] button[ref=refreshBtn]":{click:function(e){var t=e.up("jemainview").down("jegridview");t.fireEvent("selectionchange",t.getSelectionModel(),t.getSelectionModel().getSelection())}},"panel[xtype=saas.cpyhfuncpermview] button[ref=okBtn]":{click:function(e){var t=e.up("jemainview").down("panel[xtype=saas.cpyhfuncpermview]"),a=new Array,i=new Array,n=t.getChecked(),o=t.oldCheckedRecord;Ext.each(n,function(t){var i=!1;if(Ext.each(o,function(e){t.get("id")==e.get("id")&&(i=!0,e.isHave=!0)}),!i){var e=t.raw.nodeInfoType;a.push(" #"+e+"#"+t.get("id"))}}),Ext.each(o,function(e){e.isHave||i.push(e.get("id")),delete e.isHave});var r=JE.ajax({url:JE.getUrlMaps("je.core.saas","updateCpYhPerm"),params:{permType:"YHFUNC",yhId:t.yhId,cpId:t.cpId,pkValue:t.cpYhId,addPermIds:a.join(","),delPermIds:i.join(",")}});r.success&&(t.oldCheckedRecord=n,JE.msg(r.obj))}},"panel[xtype=saas.cpyhfuncpermview] button[ref=impFunc]":{click:function(e){var t=e.up("panel[xtype=saas.cpyhfuncpermview]"),a=t.getRootNode(),i=JE.ajax({url:JE.getUrlMaps("je.core.saas.cpInfo.loadCpZy"),params:{cpId:t.cpId,zhId:t.yhId,type:"YHFUNC"}}),n=[];for(var o in i)n.add(i[o].CPYHZY_ZYID);var r="'"+(n?n.join("','"):"")+"'";JE.selectWin({title:"功能导入",configInfo:"JE_CORE_FUNCINFO,,,M",type:"grid",orderSql:" order by SY_CREATETIME DESC",whereSql:" AND JE_CORE_FUNCINFO_ID NOT IN ("+r+")",okButtonClick:function(e,t){if(!e)return!1},callback:function(e){if(e&&0<e.length){var t=new Array;Ext.each(e,function(e){t.push(e.get("JE_CORE_FUNCINFO_ID"))});var i=JE.ajax({url:JE.getUrlMaps("je.core.saas","impCpYhFuncPerm"),params:{ids:t.join(",")}});0<i.length&&(a.appendChild(i),JE.msg("导入成功!"))}else JE.alert("请选中功能数据!")}})}},"panel[xtype=saas.cpyhfuncpermview] button[ref=selectAll]":{click:function(e){e.up("panel[xtype=saas.cpyhfuncpermview]").getRootNode().cascadeBy(function(e){e.set("checked",!0),e.commit()})}},"panel[xtype=saas.cpyhfuncpermview] button[ref=refreshBtn]":{click:function(e){var t=e.up("jemainview").down("jegridview");t.fireEvent("selectionchange",t.getSelectionModel(),t.getSelectionModel().getSelection())}},"panel[xtype=saas.cpyhpermview] button[ref=okBtn]":{click:function(e){var t=e.up("panel[xtype=saas.cpyhpermview]"),i=e.up("jemainview").down("jegridview"),a=i.getSelectionModel().getSelection();a&&a[0]?JE.win({title:"资源规划",width:400,height:700,maximizable:!1,items:{xtype:"saas.cpyhghpermview",jegridview:i,border:0,cpId:t.cpId,yhId:t.yhId},autoShow:!0,useButton:!0,tools:[{type:"expand",callback:function(e,t,i){e.down("treepanel").expandAll()}},{type:"collapse",callback:function(e,t,i){e.down("treepanel").collapseAll()}}],showFn:function(e){var t=e.down("panel[xtype=saas.cpyhghpermview]"),i=JE.ajax({url:JE.getUrlMaps("je.core.saas","loadCpYhGhPermTree"),params:{cpId:t.cpId}});t.getRootNode().removeAll(),0<i.length&&t.getRootNode().appendChild(i);var a=JE.ajax({url:JE.getUrlMaps("je.core.saas","load"),params:{tableCode:"JE_SAAS_CPYHZY",whereSql:" AND CPYHZY_ZHID='"+t.yhId+"' AND CPYHZY_CPID='"+t.cpId+"' AND CPYHZY_TYPE='YH'",limit:-1}}).rows,n=t.getStore(),o=new Array,r=new Array;Ext.each(a,function(e){var t=e.CPYHZY_ZYID,i=n.getNodeById(t);i?(i.set("checked",!0),i.commit(),o.push(Ext.clone(i))):r.push(t)}),t.oldCheckedRecord=o},fn:function(e){var t=e.down("panel[xtype=saas.cpyhghpermview]"),r=new Array,i=new Array,a=t.getChecked(),l=t.oldCheckedRecord;Ext.each(a,function(t){var i=!1;if(Ext.each(l,function(e){t.get("id")==e.get("id")&&(i=!0,e.isHave=!0)}),!i){var e=t.getPath(),a=e.indexOf("/",6),n="";n=-1!=a?e.substring(6,a):e.substring(6);var o=t.raw.nodeInfoType;r.push(n+"#"+o+"#"+t.get("id"))}}),Ext.each(l,function(e){e.isHave||i.push(e.get("id")),delete e.isHave});var n=JE.ajax({url:JE.getUrlMaps("je.core.saas","updateCpYhPerm"),params:{permType:"YH",yhId:t.yhId,cpId:t.cpId,addPermIds:r.join(","),delPermIds:i.join(",")}});if(n.success){t.oldCheckedRecord=a;var o=t.jegridview;o.fireEvent("selectionchange",o.getSelectionModel(),o.getSelectionModel().getSelection()),JE.msg(n.obj)}}}):JE.alert("请选择租户信息!")}},"panel[xtype=saas.cpmenumainview] dataview":{itemclick:function(e,t,i,a,n,o){var r=Ext.clone(t.data);if("SCVIEW"==r.CP_CPDKFS_CODE){var l="__imagebox",s=Ext.getCmp(l);(s=s||Ext.create("Ext.Component",{floating:!0,id:l,width:600,html:'<span style="position: absolute;right: 4px;top:4px;padding: 10px;background-color: rgba(45, 9, 9, 0.41);color: #ffffff;border-radius: 50%;cursor: pointer;">&nbsp;x&nbsp;</span><img width="100%" height="100%" src="'+JE.getStaticUrl("JE.sys.saas.controller.CpPermController.CustomDevelop")+'" />',height:360,listeners:{afterrender:function(){s.getEl().down("span").on("click",function(){s.hide()})}}})).show()}else"pxl"==r.CP_CPFL_CODE?JE.win({title:t.get("CP_MC"),width:483,height:580,maximizable:!0,items:{xtype:"saas.priceview",border:0,values:r},autoShow:!0,useButton:!1,buttonAlign:"right",buttons:[{text:"关闭",iconCls:"jeicon jeicon-error",handler:function(e){e.up("window").close()}}]}):JE.win({title:t.get("CP_MC"),width:800,height:641,maximizable:!0,items:{xtype:"saas.cpstepmainview",border:0,values:r},autoShow:!0,useButton:!1,buttonAlign:"right",buttons:[{text:"关闭",iconCls:"jeicon jeicon-error",handler:function(e){e.up("window").close()}}]})}},"panel[xtype=saas.cpplview] button[ref=okBtn]":{click:function(e){var t=e.up("form"),i=t.form.findField("CPPL_PX").getValue(),a=t.form.findField("CPPL_NR").getValue(),n=t.form.findField("JE_SAAS_CP_ID").getValue();JE.ajax({url:JE.getUrlMaps("je.core.save"),params:{tableCode:"JE_SAAS_CPPL",CPPL_PX:i,CPPL_NR:a,JE_SAAS_CP_ID:n,SY_JTGSID:JE.currentUser.jtgsId,SY_JTGSMC:JE.currentUser.jtgsMc}}).success&&(JE.msg("评价成功!"),e.up("panel[xtype=saas.cpplview]").loadData(n))}},"panel[xtype=saas.cpyhdicpermview] button[ref=add]":{click:function(e){var a=e.up("panel[xtype=saas.cpyhdicpermview]").down("dataview"),n=a.getStore(),t=new Array;n.each(function(e){t.push(e.get("JE_CORE_DICTIONARY_ID"))}),JE.selectWin({parent:null,parentType:"self",title:"字典",configInfo:"JE_CORE_DICTIONARY,,,M",whereSql:" AND SY_JESYS='1' AND JE_CORE_DICTIONARY_ID NOT IN ('"+t.join("','")+"') AND DICTIONARY_DDTYPE IN ('LIST','TREE')",type:"grid",callback:function(e,t){if(e&&0<e.length){var i=new Array;Ext.each(e,function(e){i.push(e.get("JE_CORE_DICTIONARY_ID"))}),JE.ajax({url:JE.getUrlMaps("je.core.saas","addYhDic"),params:{pkValue:a.cpYhId,dicIds:i.join(",")}}).success&&Ext.each(e,function(e){n.add(e)})}}})}},"panel[xtype=saas.cpyhdicpermview] button[ref=remove]":{click:function(e){var i=e.up("panel[xtype=saas.cpyhdicpermview]").down("dataview"),t=i.getSelectionModel().getSelection();if(t&&t.length){var a=new Array;Ext.each(t,function(e){a.push(e.get("JE_CORE_DICTIONARY_ID"))}),JE.confirm("是否删除选中自维护字典...",function(e,t){"ok"==e&&JE.ajax({url:JE.getUrlMaps("je.core.saas","delYhDic"),params:{pkValue:i.cpYhId,dicIds:a.join(",")}}).success&&(i.store.load(),JE.msg("删除成功!"))})}else JE.alert("请选中字典数据!")}},"panel[xtype=saas.cpyhdicpermview] button[ref=removeAll]":{click:function(e){var i=e.up("panel[xtype=saas.cpyhdicpermview]").down("dataview"),t=i.store,a=new Array;t.each(function(e){a.push(e.get("JE_CORE_DICTIONARY_ID"))}),0<a.length&&JE.confirm("是否删除全部自维护字典...",function(e,t){"ok"==e&&JE.ajax({url:JE.getUrlMaps("je.core.saas","delYhDic"),params:{pkValue:i.cpYhId,dicIds:a.join(",")}}).success&&(i.store.load(),JE.msg("清空成功!"))})}},"panel[xtype=saas.typeview] dataview":{selectionchange:function(e,t){var i=t[0].get("code"),a=e.view.mainview.getCmp("centerview");if(a.getLayout().setActiveItem(i),"NOTE"==i){var n=a.down("panel[xtype=saas.noteview]");n&&n.refreshInfo()}}},"panel[xtype=saas.menuview] dataview":{itemclick:function(e,t){var i=e.up("panel[xtype=saas.menuview]"),a=Ext.clone(t.data);JE.win({title:t.get("CP_MC"),width:800,height:641,maximizable:!0,id:"saas_price_win",items:{xtype:"saas.priceview",border:0,values:a,menuview:i},autoShow:!0,useButton:!1,buttonAlign:"right",buttons:[{text:"关闭",iconCls:"jeicon jeicon-error",handler:function(e){e.up("window").close()}}]})}},"panel[xtype=saas.orderview] dataview":{selectionchange:function(e,t){var i=e.view.ownerCt,a=t[0];a.get("code");i.updateView(a)}},"panel[xtype=saas.orderview] box[itemId=info]":{afterrender:function(e){var o=e.up("panel[xtype=saas.orderview]"),r=o.down("dataview").getStore();e.getEl().on("click",function(e){var t=Ext.get(e.getTarget());if(t.hasCls("buy")){var i=t.getAttribute("orderId");JE.showFuncForm("JE_SAAS_ORDER",i,!1,function(){})}else if(t.hasCls("delay")){var a=t.getAttribute("cpId"),n=r.findRecord("id",a).get("beans");n&&JE.isNotEmpty(n.JE_SAAS_CP_ID)?JE.win({title:n.CP_MC,width:800,height:641,maximizable:!0,id:"saas_price_win",items:{xtype:"saas.priceview",border:0,values:n,orderView:o},autoShow:!0,useButton:!1,buttonAlign:"right",buttons:[{text:"关闭",iconCls:"jeicon jeicon-error",handler:function(e){e.up("window").close()}}]}):JE.alert("未找到该产品，请稍微再试!")}})}}};this.control(e)},statics:{step:function(n){JE.confirm("是否安装此产品?",function(e,t){if("ok"==e){var i=JE.ajax({url:JE.getUrlMaps("je.core.saas","setupCp"),params:{pkValue:n,type:"1"}});if(i.success){var a=Ext.getDom("step_href_id");Ext.get(a).setHTML('<font color="#909090">已安装(剩余30天)</font>'),JE.msg("产品安装成功!"),Ext.defer(function(){JE.confirm("重新刷新获取新产品功能，是否刷新?",function(e,t){"ok"==e&&location.reload(!0)})},100)}else JE.alert(i.obj)}})},stepNum:function(n){JE.prompt("请输入序列号...",function(e,t){if("cancel"!=e&&!Ext.isEmpty(t)){var i=JE.ajax({url:JE.getUrlMaps("je.core.saas","setupCp"),params:{pkValue:n,type:"2",CPID_XLH:t}});if(i.success){var a=Ext.getDom("step_href_id");Ext.get(a).setHTML('<font color="#909090">已安装</font>'),JE.msg("产品安装成功!"),Ext.defer(function(){JE.confirm("重新刷新获取新产品功能，是否刷新?",function(e,t){"ok"==e&&location.reload(!0)})},100)}else JE.alert(i.obj)}})},refreshInfo:function(e){var t=Ext.getCmp("saas_price_win"),i=Ext.getCmp("menu_saascpwxpay_id");i&&i.close();var a=JE.toObj(e),n=JE.toObj(a.context);if("note"==n.yw){var o=JE.getCmp("saas_note_view");o&&(Ext.getBody().unmask(),o.refreshInfo(),"WX"==n.type?JE.msg("支付成功!"):(t.getEl().unmask(),JE.alert("支付成功!")))}else{if(!t)return;var r=n.cpId,l=t.down("panel[xtype=saas.priceview]");if(l.orderView){var s=l.orderView.getData();l.orderView.down("dataview").store.loadData(s);var d={};Ext.each(s,function(e){e.id==r&&(d=e)}),l.orderView.updateView({data:d})}l.menuview&&l.menuview.down("dataview").store.load(function(e,t,i){var a=null;if(Ext.each(e,function(e){e.get("JE_SAAS_CP_ID")==r&&(a=e)}),a){l.values=Ext.clone(a.data),l.update(l.values);var n=l.body.down(".price .btn-group .btn");n.addCls("selected"),n.dom.innerHTML+="个月",l.calculatePrice(n)}});var c=JE.ajax({url:JE.getUrlMaps("je.core.saas.cpInfo","loadCps"),params:{whereSql:" AND JE_SAAS_CP_ID='"+r+"'"}}).rows;if(c&&1==c.length){var u=c[0];l.values=Ext.clone(u),l.update(u);var p=l.body.down(".price .btn-group .btn");p.addCls("selected"),p.dom.innerHTML+="个月",l.calculatePrice(p)}"WX"==n.type?JE.msg("支付成功，请在已购中查看订单详情!"):(t.getEl().unmask(),JE.alert("支付成功，请在已购中查看订单详情!"))}},showPrice:function(e){var t=JE.ajax({url:JE.getUrlMaps("je.core.saas.cpInfo","loadCps"),params:{whereSql:" AND JE_SAAS_CP_ID='"+e+"'"}}).rows;if(t&&"1"==t.length){var i=t[0];JE.win({title:i.CP_MC,width:800,height:641,maximizable:!0,id:"saas_price_win",items:{xtype:"saas.priceview",border:0,values:i,menuview:null},autoShow:!0,useButton:!1,buttonAlign:"right",buttons:[{text:"关闭",iconCls:"jeicon jeicon-error",handler:function(e){e.up("window").close()}}]})}}},views:["JE.sys.saas.view.CpPermView","JE.sys.saas.view.CpFuncPermView","JE.sys.saas.view.CpAppPermView","JE.sys.saas.view.CpMainView","JE.sys.saas.view.CpYhPermView","JE.sys.saas.view.CpYhGhPermView","JE.sys.saas.view.CpMenuMainView","JE.sys.saas.view.CpStepMainView","JE.sys.saas.view.CpYhDicPermView","JE.sys.saas.view.CpYhAppPermView","JE.sys.saas.view.CpPlView","JE.sys.saas.view.CpUseView","JE.sys.saas.view.CpYhFuncPermView","JE.sys.saas.view.CpYhMainView","JE.sys.saas.view.market.MainView","JE.sys.saas.view.market.MenuView","JE.sys.saas.view.market.OrderView","JE.sys.saas.view.market.CenterView","JE.sys.saas.view.market.PriceView","JE.sys.saas.view.market.TypeView","JE.sys.saas.view.market.NoteView"]}),Ext.define("JE.sys.saas.controller.DesktopController",{extend:"Ext.app.Controller",init:function(){var e={"panel[xtype=saas.desktopview] dataview":{itemclick:function(e,t,i,a,n,o){var r=Ext.clone(t.data),l=r.CP_CPDKFS_CODE,s=r.CP_CONFIGINFO;if("MT"==l)Ext.getCmp("_jewestview").items.each(function(e){if("treepanel"==e.xtype){var t=e.store.tree.nodeHash[s];t&&(t.parentNode.eachChild(function(e){e.collapse()}),t.expand())}else if("card"==e.menuType){var i=e.getLayout().getCmp(s);e.getLayout().setActiveItem(s)}else if("accordion"==e.menuType)e.getCmp(s).expand();else if("LEFTMENU"==e.menuType){(i=e.getCmp(s))&&i.expand()}});else if("IDDT"==l)"1"==r.SY_CREATEORG?JE.openFunc({type:"IDDT",info:s,title:r.CP_MC,iconCls:r.CP_CJTB}):JE.alert("产品试用已过期!");else if("FUNC"==l)"1"==r.SY_CREATEORG?JE.openFunc({type:"MT",info:s,title:r.CP_MC,iconCls:r.CP_CJTB}):JE.alert("产品试用已过期!");else if("ADD"==l){var d=Ext.getCmp("_appcenterview"),c=d.down("panel[itemId=B2twR6JrNnlr5QqNaug]");c&&(c.tab.show(),d.setActiveTab(c))}}}};this.control(e)},views:["JE.sys.saas.view.DesktopView"]}),Ext.define("JE.sys.qrcode.view.common.BasicView",{extend:"Ext.panel.Panel",alias:"widget.qrcode.basicview",autoScroll:!0,constructor:function(e){this.callParent(arguments)},initComponent:function(){this.callParent(arguments),this.qrcodeview=this.getCmp("qrcode"),this.remarkview=this.down("[xtype=qrcode.editorview][itemId=remark]"),this.buttonbar=this.down("[xtype=qrcode.buttonbar]")},afterRender:function(){this.callParent(arguments)},getData:function(){var e="";return this.remarkview&&(e=this.remarkview.getData().text),{type:this.type,remark:e,qrcodeCfg:this.qrcodeview.getData()}},setData:function(e){this.qrcodeview.setData(e),this.buttonbar.setData(e)},reset:function(){this.qrcodeview.reset(),this.buttonbar.reset()}}),Ext.define("JE.sys.qrcode.view.AppView",{extend:"JE.sys.qrcode.view.common.BasicView",alias:"widget.qrcode.appview",layout:"hbox",cls:"je-qrcode-appview",initComponent:function(){var a=this;a.defaults={border:0,bodyPadding:"10 20"},a.items=[{xtype:"panel",flex:1,itemId:"center",layout:"column",defaults:{columnWidth:1,margin:"5 0",labelAlign:"right"},items:[{xtype:"fieldcontainer",fieldLabel:"APP图标",items:[{xtype:"box",itemId:"imagebox",width:80,height:80,cls:"image-box",listeners:{afterrender:function(e){e.getEl().on("click",function(){JE.uploadFile({params:{funcCode:"JE_SYS_MK",tableCode:"JE_SYS_MK",jeFileType:"PROJECT",beanTableCode:"JE_SYS_MK",returnType:"all"},callback:function(e){var t=e.privateUrl||JE.getFileUrl(e.url,"PUBLIC","","","JE_SYS_MK");a.getCmp("center").getCmp("icon").setValue(t)}})})}}}]},{xtype:"hidden",itemId:"icon",listeners:{change:function(e,t,i){a.down("box[itemId=imagebox]").update('<img src="'+t+'" style="width:100%;height:100%;">')}}},{xtype:"textfield",fieldLabel:"APP名称",itemId:"name"},{xtype:"textfield",fieldLabel:"IOS地址",itemId:"ios"},{xtype:"textfield",fieldLabel:"Android地址",itemId:"android"},{xtype:"qrcode.editorview",itemId:"remark",remarkText:"APP描述",border:0}]},{xtype:"qrcode.qrcodeview",mainview:a}],a.callParent(arguments)},itemNames:["icon","name","ios","android","remark"],getData:function(){var i=this,e=i.callParent(arguments),a={};return Ext.each(i.itemNames,function(e){var t=i.getCmp("center").getCmp(e);a[e]=t.getData?t.getData():t.getValue()}),e.viewCfg=a,e},setData:function(e){var i=this,a=Ext.decode(e.MK_PZXX);Ext.each(i.itemNames,function(e){var t=i.getCmp("center").getCmp(e);t[t.setData?"setData":"setValue"](a[e])}),i.callParent(arguments)},reset:function(){var t=this;Ext.each(t.itemNames,function(e){t.getCmp("center").getCmp(e).reset()}),t.callParent(arguments)}}),Ext.define("JE.sys.qrcode.view.CardView",{extend:"JE.sys.qrcode.view.common.BasicView",alias:"widget.qrcode.cardview",layout:"absolute",cls:"je-qrcode-cardview",autoScroll:!0,_X:40,_Y:20,headerTpl:['<div class="vcard_head" style="<tpl if="bgType==\'bgColor\'">background-color:{bgColor};<tpl else>background-image: url({bgImg});</tpl>">','<div class="vcard_face_wrap">','<div class="vcard_face_bg"></div>','<tpl if="JE.isNotEmpty(headImg)">','<img class="vcard_face" src="{headImg}"></img>',"<tpl else>",'<div class="vcard_face_lang lang_fake lang" data-lang-key="Avatar">头像</div>',"</tpl>","</div>",'<div class="vcard_career_wrap">','<p data-lang-key="Name" class="vcard_data_fullname lang_fake">{name}</p>','<p class="vcard_data_appointment vcard_career lang_fake" data-lang-key="Position">{job}</p>','<p class="vcard_data_company vcard_career lang_fake" data-lang-key="Company">{company}</p>',"</div>","</div>"].join(""),dataTpl:['<tpl for=".">','<div class="vcard-data" name="{name}">','<div class="vcard-data-title">{fieldLabel}</div>','<div class="vcard-data-value">{value}</div>',"</div>","</tpl>"].join(""),itemsInfo:[{title:"基础信息",type:"header",data:{headImg:"",bgColor:"",job:"职位",name:"姓名",company:"公司",depts:[],bgImg:JE.getStaticUrl("JE.qrcode.vcardbg7")}},{title:"联系信息",type:"phone",data:[{fieldLabel:"固定电话",name:"telphone",value:""},{fieldLabel:"移动电话",name:"phone",value:"",editField:"add"},{fieldLabel:"传真",name:"fax",value:"",editField:"add"},{fieldLabel:"邮箱",name:"email",value:"",editField:"add"}]},{title:"社交信息",type:"internet",data:[{fieldLabel:"微信",name:"weixin",value:"",editField:"add"},{fieldLabel:"主页网址",name:"website",value:"",editField:"add"},{fieldLabel:"微博",name:"blog",value:""},{fieldLabel:"QQ",name:"qq",value:""}]},{title:"地址",type:"address",data:[{fieldLabel:"地址",name:"",value:"",editField:"add"}]},{title:"个人说明",type:"intro",data:[{fieldLabel:"个人说明",name:"",value:"",xtype:"textarea"}]}],itemsData:{},initComponent:function(){var l=this;l.items=[{xtype:"panel",border:0,width:300,height:"auto",cls:"cardview",itemId:"cardview",x:l._X,y:l._Y,margin:"0 20 0 0",tpl:['<tpl for=".">','<div class="box {type}" data-type="{type}">','<div class="box-wrap"><div class="box-wrap-text">{title}</div></div>','<div class="box-body">{boxTpl}</div>',"</div>","</tpl>"],renderTo:l.body,listeners:{afterrender:function(r){r.getEl().on("click",function(e){var t=e.getTarget(".box",5,!0);if(t){var i=Ext.get(t),a=i.dom.offsetTop,n=i.getAttribute("data-type");l.activeView&&l.activeView.hide(),l.activeView=l.getCmp(n),l.activeView.setLocalXY([370,a+l._Y]),l.activeView.show(),l.qrcodeview.hide();var o=r.getEl().down(".box.active");o&&o.removeCls("active"),i.addCls("active")}}),r.getEl().on("mouseover",function(e){var t=e.getTarget(".box",5,!0);if(t){var i=Ext.get(t),a=r.getEl().down(".box.over");a&&a.removeCls("over"),i.addCls("over")}}),r.getEl().on("mouseout",function(e){var t=r.getEl().down(".box.over");t&&t.removeCls("over")})}}},{xtype:"qrcode.qrcodeview",mainview:l,height:"auto",x:550,y:l._Y+60,border:0}],l.callParent(arguments),l.cardview=l.getCmp("cardview")},afterRender:function(){this.callParent(arguments),"window"!=this.ownerCt.xtype&&this.reset()},getData:function(){var i=this,e=i.callParent(arguments),a=[];Ext.each(i.itemsInfo,function(e){var t=i.itemsData[e.type];t&&a.push({type:e.type,title:e.title,data:t})});var t="";return i.itemsData.header&&(t=i.itemsData.header.name),e.viewCfg={info:a,remark:t},e.remark=t,e},setData:function(e){this.buildCfgItems(e),this.callParent(arguments)},reset:function(){this.buildCfgItems(),this.itemsData={},this.callParent(arguments)},buildCfgView:function(e){var t=this,i={xtype:"panel",cls:"cardview-info",hidden:!0,height:"auto",width:650,layout:"column",padding:"0 0 0 20",tbar:{xtype:"box",cls:"cardview-arrow",itemId:"tbar",html:['<i class="arrow arrow_out"></i>','<i class="arrow arrow_in"></i>','<i class="fa fa-close close"></i>'].join("")},fbar:{xtype:"toolbar",ui:"footbar",style:"margin:0px;border:1px solid #e6e6e6;padding:0 0 10px 0;",items:[{width:120,text:"应用",cls:"JEPLUS_B_L10",handler:function(e){t.updateInfo(e.ownerCt.ownerCt)}}],layout:{pack:"center"}},listeners:{afterrender:function(e){e.getDockedCmp("tbar").getEl().down("i.close").on("click",function(){e.hide(),t.qrcodeview.show()})}},defaults:{labelAlign:"right",width:470,margin:"4",labelSeparator:""}};return Ext.apply(i,e),i},buildCfgItems:function(e){var a=this,t=Ext.clone(a.itemsInfo),i=[];if(JE.isNotEmpty(e)&&(i=Ext.value(Ext.decode(e.MK_PZXX).info,[])),JE.isNotEmpty(i)){var n={};Ext.each(i,function(e){a.itemsData[e.type]=n[e.type]=e.data}),Ext.each(t,function(e){n[e.type]&&(e.data=Ext.apply(e.data,n[e.type]))})}var o=[],r=[];Ext.each(t,function(e){a.getCmp(e.type)&&a.getCmp(e.type).remove();var t={itemId:e.type,items:[]},i="";"header"==e.type?(t.items=a.getHeaderItems(e),i=JE.toXT(a.headerTpl,e.data),JE.isNotEmpty(e.data.depts)&&(i+=JE.toXT(a.dataTpl,e.data.depts))):(t.items=a.getDefItems(e),i=JE.toXT(a.dataTpl,e.data)),t=a.buildCfgView(t),o.push(t),r.push({title:e.title,type:e.type,boxTpl:i})}),a.qrcodeview.show(),a.cardview.update(r),a.add(o)},updateInfo:function(e){var i=[];e.items.each(function(e){var t={};"editfield"==e.type?(t.name=e.name,t.editField=e.fieldType,t.fieldLabel=e.getCmp("fieldLabel").getValue(),t.value=e.getCmp("value").getValue()):-1!=["textfield","hidden","textarea"].indexOf(e.xtype)?(t.fieldLabel=e.fieldLabel,t.value=e.getValue(),t.name=e.name):"fieldcontainer"==e.xtype&&e.items.each(function(e){-1!=["colorfield","rgroup"].indexOf(e.xtype)&&(t.fieldLabel=e.fieldLabel,t.value=e.getValue(),t.name=e.name)}),JE.isNotEmpty(t)&&i.push(t)});var t=this.activeView.itemId,a=this.cardview.getEl().down(".box."+t+" .box-body"),n=this.dataTpl;if("header"==t){var o={},r=!1,l=this.itemsInfo[0].data;Ext.each(i,function(e){JE.isNotEmpty(e.value)&&("company"==e.name?r?(o.depts=o.depts||[],o.depts.push(e)):(r=!0,o[e.name]=e.value):o[e.name]=e.value)}),i=Ext.applyIf(o,l),"bgColor"==o.bgType&&JE.isEmpty(o.bgColor)&&(o.bgType="bgImg"),n=this.headerTpl,JE.isNotEmpty(i.depts)&&(n+=JE.toXT(this.dataTpl,i.depts))}a.update(JE.toXT(n,i)),this.cardview.doLayout(),this.itemsData[t]=i},getDefItems:function(e){var i=this,a=[];return Ext.each(e.data,function(e){var t;t=JE.isEmpty(e.editField)?i.getDefField(e):i.getEditField(e,e.editField),a.push(t)}),a},getHeaderItems:function(e){var n=this,t=e.data,o='<img style="width:100%;height:100%" src="{headImg}">',r='<img style="width:100%;height:100%" src="{bgImg}">',i='<div style="width:100%;height:100%;background-color:{bgColor};">',a="";JE.isNotEmpty(t.headImg)&&(a=JE.toXT(o,{headImg:t.headImg}));var l="";JE.isNotEmpty(t[t.bgType])&&(l=JE.toXT("bgImg"==t.bgType?r:i,t));var s=[{xtype:"fieldcontainer",fieldLabel:"头像",items:[{xtype:"box",width:80,height:80,html:a,cls:"image-box",listeners:{afterrender:function(a){a.getEl().on("click",function(){JE.uploadFile({params:{funcCode:"JE_SYS_MK",tableCode:"JE_SYS_MK",jeFileType:"PROJECT",beanTableCode:"JE_SYS_MK",returnType:"all"},callback:function(e){var t=n.activeView.down("[name=headImg]"),i=e.privateUrl||JE.getFileUrl(e.url,"PUBLIC","","","JE_SYS_MK");t.setValue(i),a.update(JE.toXT(o,{headImg:i}))}})})}}}]},{xtype:"fieldcontainer",fieldLabel:"封面图",items:[{xtype:"box",width:120,height:80,html:l,cls:"image-box",listeners:{afterrender:function(a){a.getEl().on("click",function(){if("bgImg"==n.activeView.down("[name=bgType]").getValue())JE.uploadFile({params:{funcCode:"JE_SYS_MK",tableCode:"JE_SYS_MK",jeFileType:"PROJECT",beanTableCode:"JE_SYS_MK"},callback:function(e){var t=n.activeView.down("[name=bgImg]"),i=e.privateUrl||JE.getFileUrl(e.url,"PUBLIC","","","JE_SYS_MK");t.setValue(i),a.update(JE.toXT(r,{bgImg:i}))}});else{var t=n.activeView.down("[name=bgColor]"),e=t.getValue();JE.showColor({dom:a.getEl().dom,colors:["#777777","#fbcc91","#f68f8e","#f5a3c9","#d4a4c5","#80c3e9","#91d881","#fdab85"],value:e,callback:function(e){a.update(JE.toXT(i,{bgColor:e})),t.setValue(e)}})}})}}},{xtype:"rgroup",width:200,name:"bgType",value:t.bgType||"bgImg",dataArray:[{text:"背景图",code:"bgImg"},{text:"纯色背景",code:"bgColor"}]}]},{xtype:"hidden",name:"bgColor",value:t.bgColor},{xtype:"hidden",name:"bgImg",value:t.bgImg},{xtype:"hidden",name:"headImg",value:t.headImg},{xtype:"textfield",fieldLabel:"姓名",name:"name",allowBlank:!1,value:t.name},{xtype:"textfield",name:"job",fieldLabel:"职位",value:t.job},n.getEditField({fieldLabel:"公司",name:"company",value:t.company,defaultLabel:"部门"})];return Ext.each(t.depts,function(e){s.push(n.getEditField(e,"remove"))}),s},getDefField:function(e){var t={xtype:Ext.value(e.xtype,"textfield"),name:e.name,fieldLabel:e.fieldLabel,value:e.value||""};return 0<e.height&&(t.height=e.height),t},getEditField:function(n,e){var t=500,i="jeicon jeicon-new-fine-plus-circle",a="jeicon jeicon-error-circle";"plus"==JE.getTheme()&&(t=520,i="fa fa-plus",a="fa fa-times");var o={xtype:"fieldcontainer",layout:"hbox",type:"editfield",fieldType:"add",width:t,name:n.name,fieldLabel:n.fieldLabel,items:[{xtype:"hidden",itemId:"fieldLabel",value:n.fieldLabel},{xtype:"textfield",itemId:"value",margin:"0 8 0 0",value:n.value||"",flex:1},{xtype:"button",iconCls:i,cls:"btn btn-form JEPLUS_B_C01",handler:function(e){var t=e.ownerCt.ownerCt,i=-1,a=!1;t.items.each(function(e,t){if(e.name==n.name&&(a=!0),a&&e.name!=n.name)return i=t,!1}),t.insert(i,r)}}]},r={xtype:"fieldcontainer",layout:"hbox",type:"editfield",fieldType:"remove",width:t,cls:"editfield",name:n.name,items:[{xtype:"textfield",cls:"editfield-label",value:n.defaultLabel||n.fieldLabel,width:105,itemId:"fieldLabel",clearButton:!1},{xtype:"textfield",itemId:"value",margin:"0 8 0 0",value:"remove"==e?n.value:"",flex:1},{xtype:"button",iconCls:a,cls:"btn btn-form JEPLUS_B_C02",handler:function(e){e.ownerCt.ownerCt.remove(e.ownerCt)}}]};return"remove"==e?r:o}}),Ext.define("JE.sys.qrcode.view.common.ButtonBar",{extend:"Ext.toolbar.Toolbar",alias:"widget.qrcode.buttonbar",ui:"footer",margin:"10 0 0 0",buttonAlign:"center",initComponent:function(){var i=this;JE.isNotEmpty(i.buttonAlign)&&(i.layout={pack:{left:"start",center:"center"}[i.buttonAlign]||"end"}),i.defaults={width:80},i.items=[{text:"生成活码",cls:"JEPLUS_B_L10",handler:function(){i.createQRCode()}},{text:"预览",cls:"JEPLUS_B_C03",handler:function(){i.preview()}},{text:"新建码",cls:"JEPLUS_B_C01",hidden:JE.isNotEmpty(i.mainview.record),handler:function(){i.mainview.reset&&i.mainview.reset()}},{text:"复制地址",cls:"JEPLUS_B_C01",hidden:JE.isEmpty(i.mainview.record),handler:function(){var e=i.formview.form.findField("JE_SYS_MK_ID").getValue(),t=JE.buildCdnUrl("/static/ux/phone/view/template/qrcode/index.html?id="+e);JE.win({title:"二维码访问地址",width:600,height:100,html:t,bodyPadding:10,autoShow:!0})}}],i.callParent(arguments)},afterRender:function(){this.callParent(arguments),this.qrcodeview=this.mainview.qrcodeview,this.buldFormView()},createQRCode:function(){if(this.formview.isValid()){var e=this.formview.form.getValues(),t=this.mainview.getData();t.viewCfg.bgsound=e.bgsound,e=Ext.apply(e,{MK_ZY:Ext.value(t.remark,""),MK_PZXX:Ext.encode(t.viewCfg),MK_MYPZXX:Ext.encode(t.qrcodeCfg)});var i=JE.ajax({url:JE.getUrlMaps("je.core.mk","createOrUpdate"),params:e});if(i.success){var a=i.obj.id;this.formview.form.setValues({JE_SYS_MK_ID:a}),this.qrcodeview.updateQRCode(a),JE.msg("二维码生成成功！"),this.mainview.record&&(this.mainview.record.set(e),this.mainview.record.commit())}else JE.alert(i.obj)}},preview:function(){var e=this.formview.form.findField("JE_SYS_MK_ID").getValue();if(JE.isEmpty(e))JE.alert("请先生成二维码！");else{var t=JE.buildCdnUrl("/static/ux/phone/view/template/qrcode/index.html?id="+e);JE.win({title:"预览",height:700,width:400,maximizable:!1,resizable:!1,html:'<iframe scrolling="auto" frameborder="0" width="100%" height="100%" src='+t+"></iframe>",autoShow:!0})}},setData:function(e){var t=Ext.decode(e.MK_PZXX);e.bgsound=t.bgsound||"",this.formview.form.setValues(e)},reset:function(){this.formview.form.reset()},buldFormView:function(){var i=this,e={xtype:"form",layout:"column",border:0,defaults:{labelAlign:"right",labelWidth:70,allowBlank:!1,columnWidth:1,margin:4},items:[{fieldLabel:"码称",name:"MK_MM",xtype:"textfield",value:"未命名码"},{fieldLabel:"业务分类",name:"MK_MKYEWFL_NAME",xtype:"treessfield",configInfo:"JE_SYS_MKYEWFL,MK_MKYEWFL_NAME~MK_MKYEWFL_CODE,text~code,S"},{xtype:"uxtrigger",name:"bgsound",trigger2Cls:"x-form-file-trigger",allowBlank:!0,fieldLabel:"背景音乐",handler:function(i){JE.win({title:"背景音乐",width:600,height:250,useButton:!0,border:0,items:{xtype:"uxfilesfield"},autoShow:!0,fn:function(e){var t=e.getCmp(0).getData();if(1!=t.length)return JE.alert("请选择一个背景音乐！"),!1;i.setValue(t[0].path)}})}},{xtype:"hidden",name:"MK_MKYEWFL_CODE"},{xtype:"hidden",name:"MK_QY_CODE",value:"1"},{xtype:"hidden",name:"JE_SYS_MK_ID"},{xtype:"hidden",name:"tableCode",value:"JE_SYS_MK"},{xtype:"hidden",name:"MK_MKLX_CODE",value:i.mainview.type}]},a=-1;i.ownerCt.items.each(function(e,t){if(e==i)return a=t,!1}),i.formview=i.ownerCt.insert(a,e),i.mainview.formview=i.formview}}),Ext.define("JE.sys.qrcode.view.common.EditorView",{extend:"Ext.panel.Panel",alias:"widget.qrcode.editorview",layout:"card",border:0,cls:"je-qrcode-editorview",remarkText:"请输入文字内容",height:300,initComponent:function(){var a=this;a.tbar={xtype:"box",cls:"editormodel",html:'<i class="fa fa-angle-down"></i>',listeners:{afterrender:function(e){e.getEl().down("i").on("click",function(){a.getLayout().setActiveItem("html")})}}},a.items=[{xtype:"textarea",itemId:"text",emptyText:a.remarkText,clearButton:!1,_cls:"fa-angle-down",listeners:{change:function(e,t,i){"text"==a.getLayout().getActiveItem().itemId&&(t=t.replaceAll("\n","<br/>"),a.getCmp("html").setValue(t))}}},{xtype:"ueditor",itemId:"html",_cls:"fa-angle-up",showFullScreenBtn:!0,simpleToolbar:!0,fullscreenToolbars:[["undo","redo","|","bold","italic","underline","fontborder","strikethrough","superscript","subscript","removeformat","formatmatch","autotypeset","pasteplain","|","forecolor","backcolor","insertorderedlist","insertunorderedlist","|","rowspacingtop","rowspacingbottom","lineheight","|","paragraph","fontfamily","fontsize","|","directionalityltr","directionalityrtl","indent","|","justifyleft","justifycenter","justifyright","justifyjustify","|","touppercase","tolowercase","|","link","unlink","anchor","|","imagenone","imageleft","imageright","imagecenter","|","simpleupload","insertimage","emotion","scrawl","insertvideo","music","attachment","map","insertframe","insertcode","pagebreak","background","inserttable","|","horizontal","date","time","spechars","snapscreen","|","selectall","cleardoc","_template","_files","source"]],simpleToolbars:[["undo","redo","|","bold","italic","underline","fontborder","strikethrough","superscript","subscript","removeformat","formatmatch","autotypeset","pasteplain","|","forecolor","backcolor","insertorderedlist","insertunorderedlist","|","rowspacingtop","rowspacingbottom","lineheight","|","paragraph","fontfamily","fontsize","|","directionalityltr","directionalityrtl","indent","|","justifyleft","justifycenter","justifyright","justifyjustify","|","touppercase","tolowercase","|","link","unlink","anchor","|","imagenone","imageleft","imageright","imagecenter","|","simpleupload","insertimage","emotion","scrawl","insertvideo","music","attachment","map","insertframe","insertcode","pagebreak","background","inserttable","|","horizontal","date","time","spechars","snapscreen","|","selectall","cleardoc","_template","_files","source","|","_back"]],buttons:{_back:{label:"文本模式",onclick:function(){a.getLayout().setActiveItem("text")}}},toolleipi:!1,listeners:{change:function(e,t,i){"html"==a.getLayout().getActiveItem().itemId&&(t=Ext.util.Format.stripTags(Ext.htmlDecode(t)),a.getCmp("text").setValue(t))}}}],a.callParent(arguments)},getData:function(){return{text:this.getCmp("text").getValue(),html:JE.encodeURI(this.getCmp("html").getHtml()),type:this.getLayout().getActiveItem().itemId}},setData:function(e){e=Ext.value(e,{type:"text"});this.getLayout().setActiveItem(e.type);var t=this.getCmp(e.type);if("text"==e.type)t.setValue(e.text);else{var i=JE.decodeURI(e.html);t.editor?t.setHtml(i):t.value=Ext.htmlEncode(i)}},reset:function(){this.items.each(function(e){e.reset()}),this.getLayout().setActiveItem(0)},afterRender:function(){this.callParent(arguments)}}),Ext.define("JE.sys.qrcode.view.common.LogoView",{extend:"Ext.panel.Panel",alias:"widget.qrcode.logoview",layout:"fit",cls:"je-qrcode-logoview",constructor:function(e){var i=this;i.store=Ext.create("Ext.data.Store",{fields:["name","url"],data:[]}),i.items=[{xtype:"dataview",autoScroll:!0,itemSelector:"img",store:i.store,cls:"logoview",tpl:['<tpl for=".">','<img src="{url}">',"</tpl>"],listeners:{itemclick:function(e,t){i.callback&&i.callback(t.data,i)}}}],i.buttons=[{text:"取消",handler:function(e){i.ownerCt.close()}},{text:"上传",handler:function(){JE.uploadFile({uploadFilePath:"/mk",params:{funcCode:"JE_SYS_MK",tableCode:"JE_SYS_MK",jeFileType:"PLATFORM",beanTableCode:"JE_SYS_MK",returnType:"all"},callback:function(e){JE.ajax({url:JE.getUrlMaps("je.core.mk","saveLogo"),params:{url:e.url,name:e.name,docId:e.docInfo.JE_CORE_DOCUMENT_ID}}),i.loadFiles()}})}}],i.callParent(arguments)},initComponent:function(){this.callParent(arguments),this.qrcodeview=this.getCmp("qrcode"),this.remarkview=this.down("[xtype=qrcode.editorview][itemId=remark]")},afterRender:function(){this.callParent(arguments),this.loadFiles()},loadFiles:function(){var e=JE.ajax({url:JE.getUrlMaps("je.core.mk","loadLogo")});this.store.loadData(e)}}),Ext.define("JE.sys.qrcode.view.common.QRCodeView",{extend:"Ext.panel.Panel",alias:"widget.qrcode.qrcodeview",layout:"column",cls:"je-qrcode-codeview",itemId:"qrcode",basicPath:"JE/data/mk/qr/",width:300,initComponent:function(){var n=this;n.defaults={columnWidth:1},n.items=[{xtype:"box",height:300,emptyHeight:300,qrcodeHeight:260,cls:"codeview",itemId:"codeview",html:['<div class="codeview-empty">',"<div>","左侧输入内容<br/>点击生成二维码","</div>","</div>",'<img src="" class="codeview-img">'].join(""),listeners:{afterrender:function(e){e.getEl().down(".codeview-img").hide("display")}}},{xtype:"button",cls:"btn JEPLUS_B_C01",itemId:"download",margin:"10 0 0 0",hidden:!0,text:"下载",handler:function(e){var t=n.getCmp("codeview").getEl().down(".codeview-img").dom.getAttribute("data_url");if(JE.isEmpty(t))JE.alert("请先生成二维码！");else{var i=n.mainview.formview.form.findField("MK_MM").getValue(),a=JE.getUrlMaps("je.core.doc.documenta","download")+"?fileName={name}&path={url}";a=JE.toXT(a,{name:i+".png",url:t}),window.open(a)}}},{xtype:"box",height:40,cls:"codeview-config",html:'<div class="item" name="basic">基本</div><div class="item" name="color">颜色</div><div class="item on" name="logo">LOGO</div>',listeners:{afterrender:function(e){e.getEl().on("click",function(e){var t=Ext.get(e.getTarget());t.hasCls("item")&&(t.parent().select(".item").each(function(e){e.removeCls("on")}),t.addCls("on"),n.getCmp("config").getLayout().setActiveItem(t.getAttribute("name")))})}}},{xtype:"form",layout:"card",itemId:"config",height:50,border:0,activeItem:"logo",defaults:{xtype:"panel",border:0,layout:"column",bodyPadding:10,defaults:{columnWidth:.5,clearButton:!1,labelAlign:"right",labelWidth:40,cls:"je-field-basiccls"}},items:[{itemId:"basic",items:[{xtype:"cbbfield",fieldLabel:"大小",name:"width",dataArray:[{code:"175",text:"175px"},{code:"240",text:"240px"},{code:"300",text:"300px"},{code:"415",text:"415px"},{code:"535",text:"535px"}],value:"240",listeners:{change:function(e,t,i){e.next("[name=rc]").setValue({115:"5",175:"10",240:"15",300:"20",415:"30",535:"40"}[t])}}},{xtype:"textfield",readOnly:!0,fieldLabel:"容错",name:"rc",value:"15",unitTpl:"%"}]},{itemId:"color",items:[{xtype:"colorfield",fieldLabel:"前景",name:"color",clearButton:!0,columnWidth:.5,value:"#000000",enableClick:!0,hideTrigger:!0},{xtype:"colorfield",fieldLabel:"背景",name:"bgcolor",columnWidth:.5,value:"#ffffff",clearButton:!0,enableClick:!0,hideTrigger:!0}]},{itemId:"logo",layout:"hbox",defaults:{width:100},items:[{xtype:"button",text:"添加 LOGO",cls:"btn",margin:"0 5",handler:function(i){JE.win({title:"常用LOGO",width:500,height:300,border:0,items:{xtype:"qrcode.logoview",callback:function(e,t){i.next("hidden[name=logo]").setValue(e.url),t.ownerCt.close()}},autoShow:!0})}},{xtype:"box",width:20,height:20,itemId:"logobox"},{xtype:"button",text:"取消 LOGO",cls:"btn",margin:"0 5",handler:function(e){e.next("hidden[name=logo]").reset()}},{xtype:"hidden",name:"logo",listeners:{change:function(e,t,i){var a="";JE.isNotEmpty(t)&&(a='<img src="'+t+'" style="width:100%;height:100%;">'),e.prev("box[itemId=logobox]").update(a)}}}]}]},{xtype:"qrcode.buttonbar",mainview:n.mainview}],n.callParent(arguments)},getData:function(){return this.getCmp("config").form.getValues()},setData:function(e){if(JE.isEmpty(e))this.reset();else{var t=Ext.decode(e.MK_MYPZXX);this.getCmp("config").form.setValues(t),this.updateQRCode(e.JE_SYS_MK_ID)}},reset:function(){this.getCmp("config").form.reset(),this.updateQRCode()},updateQRCode:function(e){var t=JE.isEmpty(e)?"":this.basicPath+e+".png",i=this.getCmp("codeview"),a=i.getEl().down(".codeview-empty"),n=i.getEl().down(".codeview-img");a.setVisible(JE.isEmpty(t),"display"),n.setVisible(!JE.isEmpty(t),"display"),this.getCmp("download").setVisible(!JE.isEmpty(t)),i.setHeight(JE.isEmpty(t)?i.emptyHeight:i.qrcodeHeight),n.dom.setAttribute("data_url",t),n.dom.src=JE.isEmpty(t)?"":t+"?_dt="+(new Date).getTime()},afterRender:function(){this.callParent(arguments)}}),Ext.define("JE.sys.qrcode.view.CompanyView",{extend:"JE.sys.qrcode.view.common.BasicView",alias:"widget.qrcode.companyview",layout:"absolute",cls:"je-qrcode-cardview je-qrcode-companyview",autoScroll:!0,_X:40,_Y:20,headerTpl:['<div class="company_head">','<div class="imgdiv">','<div class="bgimg" style="<tpl if="JE.isNotEmpty(bgImg)">background-image:url({bgImg});</tpl>"></div>','<div class="triangle-white"></div>','<div class="title_wrap">','<div class="logo" style="<tpl if="JE.isNotEmpty(headImg)">background-image:url({headImg});</tpl>"><tpl if="JE.isEmpty(headImg)"><div class="logo_bg">LOGO</div></tpl>',"</div>",'<div class="title">',"<div>{name}</div>","</div>","</div>","</div>",'<div class="head_desc">{desc}</div>',"</div>"].join(""),dataTpl:['<tpl for=".">','<div class="vcard-data" name="{name}">','<div class="vcard-data-title">{fieldLabel}</div>','<div class="vcard-data-value">{value}</div>',"</div>","</tpl>"].join(""),imageTpl:['<div class="company_image">','<div class="title">{title}</div>','<div class="image" style="<tpl if="JE.isNotEmpty(image)">background-image:url({image});</tpl>"></div>','<div class="desc">{[Ext.htmlDecode(values.content)]}</div>','<div class="files"><tpl for="JE.decode(files)"><div class="file">{name}</div></tpl></div>',"</div>"].join(""),itemsInfo:{header:{title:"基础信息",type:"header",data:{name:"公司名称",desc:"公司简介",headImg:"",bgImg:JE.getStaticUrl("JE.qrcode.vcardbg7")}},phone:{title:"联系信息",type:"phone",data:[{fieldLabel:"QQ",name:"qq",value:""},{fieldLabel:"微信",name:"weixin",value:""},{fieldLabel:"电话",name:"phone",value:"",editField:"add"},{fieldLabel:"微博",name:"blog",value:""},{fieldLabel:"网站",name:"website",value:"",editField:"add"},{fieldLabel:"地址",name:"address",value:"",xtype:"textarea"}]},image:{title:"图文",type:"image",data:{title:"",image:"",content:"",files:""}}},submitData:[],initComponent:function(){var p=this;p.items=[{xtype:"panel",border:0,width:300,height:"auto",cls:"cardview",itemId:"cardview",x:p._X,y:p._Y,margin:"0 20 0 0",tpl:['<tpl for=".">','<div class="box {type} {id}" data-type="{type}" data-id="{id}">','<div class="box-wrap"><div class="box-wrap-text">{title}</div><tpl if="type==\'image\'"><i class="box-wrap-icon fa fa-plus" data-act="add"></i></tpl>',"</div>",'<div class="box-body">{boxTpl}</div>',"</div>","</tpl>"],renderTo:p.body,listeners:{afterrender:function(u){u.getEl().on("click",function(e){var t=e.getTarget(".box",7,!0);if(t){var i=Ext.get(t),a=i.dom.offsetTop,n=i.getAttribute("data-type"),o=i.getAttribute("data-id");p.activeView&&p.activeView.hide(),p.activeView=p.getCmp("image"==n?o:n),p.activeView.setLocalXY([370,a+p._Y]),p.activeView.show(),p.qrcodeview.hide();var r=u.getEl().down(".box.active");if(r&&r.removeCls("active"),i.addCls("active"),Ext.get(e.target).hasCls("box-wrap-icon")){var l=p.getActiveBox(),s=Ext.clone(p.itemsInfo.image);s.id=JE.uuid();var d={itemId:s.id,items:p.getImageItems(s)};d=p.buildCfgView(d),p.add(d),p.itemIds.push(s.id);var c=JE.toXT(p.imageTpl,s.data);c=['<div class="box {type} {id}" data-type="{type}" data-id="{id}">','<div class="box-wrap"><div class="box-wrap-text">{title}</div><tpl if="type==\'image\'"><i class="box-wrap-icon fa fa-plus" data-act="add"></i></tpl>',"</div>",'<div class="box-body">'+c+"</div>","</div>"].join(""),c=JE.toXT(c,s),l.box.insertHtml("afterEnd",c),p.cardview.doLayout(),p.submitData.splice(l.index+1,0,s)}}}),u.getEl().on("mouseover",function(e){var t=e.getTarget(".box",7,!0);if(t){var i=Ext.get(t),a=u.getEl().down(".box.over");a&&a.removeCls("over"),i.addCls("over")}}),u.getEl().on("mouseout",function(e){var t=u.getEl().down(".box.over");t&&t.removeCls("over")})}}},{xtype:"qrcode.qrcodeview",mainview:p,height:"auto",x:550,y:p._Y+60,border:0}],p.callParent(arguments),p.cardview=p.getCmp("cardview")},afterRender:function(){this.callParent(arguments),"window"!=this.ownerCt.xtype&&this.reset()},getData:function(){var e=this.callParent(arguments),t=this.submitData,i=this.submitData[0].data.name;return e.viewCfg={info:t,remark:i},e.remark=i,e},setData:function(e){this.buildCfgItems(e),this.callParent(arguments)},reset:function(){var t=this;t.submitData=[],Ext.each(t.itemIds,function(e){t.remove(e)}),t.buildCfgItems(),t.callParent(arguments)},buildCfgView:function(e){var t=this,i={xtype:"panel",cls:"cardview-info",hidden:!0,height:"auto",width:650,layout:"column",padding:"0 0 0 20",tbar:{xtype:"box",cls:"cardview-arrow",itemId:"tbar",html:['<i class="arrow arrow_out"></i>','<i class="arrow arrow_in"></i>','<i class="fa fa-close close"></i>'].join("")},fbar:{xtype:"toolbar",ui:"footbar",style:"margin:0px;border:1px solid #e6e6e6;padding:0 0 10px 0;",items:[{width:120,text:"应用",cls:"JEPLUS_B_L10",handler:function(e){t.updateInfo(e.ownerCt.ownerCt)}}],layout:{pack:"center"}},listeners:{afterrender:function(e){e.getDockedCmp("tbar").getEl().down("i.close").on("click",function(){e.hide(),t.qrcodeview.show()})}},defaults:{labelAlign:"right",width:470,margin:"4",labelSeparator:""}};return Ext.apply(i,e),-1==["header","phone"].indexOf(e.itemId)&&i.fbar.items.push({width:120,text:"删除模块",cls:"JEPLUS_B_C02",itemId:e.itemId,handler:function(e){1!=t.cardview.body.query(".box.image").length?(t.remove(e.itemId),t.getActiveBox().box.remove(),t.cardview.doLayout(),t.qrcodeview.show()):JE.alert("必须留一个图文模块进行编辑！")}}),i},buildCfgItems:function(e){var a=this,i=Ext.clone(a.itemsInfo),t=[];JE.isNotEmpty(e)&&(t=Ext.value(Ext.decode(e.MK_PZXX).info,[])),JE.isNotEmpty(t)?Ext.each(t,function(e){if(i[e.type]){var t=Ext.clone(i[e.type].data);e.data=Ext.apply(t,e.data)}}):t=[i.header,i.phone,i.image],a.submitData=t;var n=[],o=[];a.itemIds=[],Ext.each(a.submitData,function(e){var t={itemId:e.type,items:[]},i="";"header"==e.type?(t.items=a.getHeaderItems(e),i=JE.toXT(a.headerTpl,e.data),JE.isNotEmpty(e.data.depts)&&(i+=JE.toXT(a.dataTpl,e.data.depts))):i="image"==e.type?(t.items=a.getImageItems(e),t.itemId=e.id=Ext.value(e.id,JE.uuid()),JE.toXT(a.imageTpl,e.data)):(t.items=a.getDefItems(e),JE.toXT(a.dataTpl,e.data)),t=a.buildCfgView(t),n.push(t),o.push({title:e.title,type:e.type,id:e.id,boxTpl:i}),a.itemIds.push(t.itemId)}),a.qrcodeview.show(),a.cardview.update(o),a.add(n)},updateInfo:function(e){var t=this,i=[];e.items.each(function(e){var t={};"editfield"==e.type?(t.name=e.name,t.editField=e.fieldType,t.fieldLabel=e.getCmp("fieldLabel").getValue(),t.value=e.getCmp("value").getValue()):-1!=["textfield","hidden","textarea","ueditor","uxfilesfield"].indexOf(e.xtype)?(t.fieldLabel=e.fieldLabel,t.value=e.getValue(),t.name=e.name):"fieldcontainer"==e.xtype&&e.items.each(function(e){-1!=["colorfield","rgroup"].indexOf(e.xtype)&&(t.fieldLabel=e.fieldLabel,t.value=e.getValue(),t.name=e.name)}),JE.isNotEmpty(t)&&i.push(t)});var a=t.activeView.itemId,n=t.cardview.getEl().down(".box."+a+" .box-body"),o=t.dataTpl;if("header"==a){var r={},l=!1,s=t.itemsInfo.header.data;Ext.each(i,function(e){JE.isNotEmpty(e.value)&&("company"==e.name?l?(r.depts=r.depts||[],r.depts.push(e)):(l=!0,r[e.name]=e.value):r[e.name]=e.value)}),i=Ext.applyIf(r,s),"bgColor"==r.bgType&&JE.isEmpty(r.bgColor)&&(r.bgType="bgImg"),o=t.headerTpl,JE.isNotEmpty(i.depts)&&(o+=JE.toXT(t.dataTpl,i.depts))}else if("phone"==a);else{r={},s=t.itemsInfo.image.data;Ext.each(i,function(e){JE.isNotEmpty(e.value)&&(r[e.name]=e.value)}),o=t.imageTpl,i=Ext.applyIf(r,s)}n.update(JE.toXT(o,i)),t.cardview.doLayout();var d=t.getActiveBox();-1<d.index&&(t.submitData[d.index].data=i)},getDefItems:function(e){var i=this,a=[];return Ext.each(e.data,function(e){var t;t=JE.isEmpty(e.editField)?i.getDefField(e):i.getEditField(e,e.editField),a.push(t)}),a},getActiveBox:function(){var a,n=-1;return this.cardview.body.select(".box",!0).each(function(e,t,i){if(e.hasCls("active"))return a=e,n=i,!1}),{box:a,index:n}},getImageItems:function(e){var a=this,t=e.data,n='<img style="width:100%;height:100%" src="{image}">',i="";return JE.isNotEmpty(t.image)&&(i=JE.toXT(n,{image:t.image})),[{xtype:"textfield",fieldLabel:"模块标题",name:"title",allowBlank:!1,value:t.title},{xtype:"fieldcontainer",fieldLabel:"图片",items:[{xtype:"box",width:80,height:60,html:i,cls:"image-box",listeners:{afterrender:function(i){i.getEl().on("click",function(){JE.uploadFile({params:{funcCode:"JE_SYS_MK",jeFileType:"PROJECT",tableCode:"JE_SYS_MK",beanTableCode:"JE_SYS_MK",returnType:"all"},callback:function(e){var t=e.privateUrl||JE.getFileUrl(t,"PUBLIC","","","JE_SYS_MK");a.activeView.down("[name=image]").setValue(t),i.update(JE.toXT(n,{image:t}))}})})}}}]},{xtype:"hidden",name:"image",value:t.image},{xtype:"ueditor",name:"content",fieldLabel:"正文内容",showFullScreenBtn:!0,simpleToolbar:!0,fullscreenToolbars:[["undo","redo","|","bold","italic","underline","fontborder","strikethrough","superscript","subscript","removeformat","formatmatch","autotypeset","pasteplain","|","forecolor","backcolor","insertorderedlist","insertunorderedlist","|","rowspacingtop","rowspacingbottom","lineheight","|","paragraph","fontfamily","fontsize","|","directionalityltr","directionalityrtl","indent","|","justifyleft","justifycenter","justifyright","justifyjustify","|","touppercase","tolowercase","|","link","unlink","anchor","|","imagenone","imageleft","imageright","imagecenter","|","simpleupload","insertimage","emotion","scrawl","insertvideo","music","attachment","map","insertframe","insertcode","pagebreak","background","inserttable","|","horizontal","date","time","spechars","snapscreen","|","selectall","cleardoc","_template","_files","source"]],simpleToolbars:[["undo","redo","|","bold","italic","underline","fontborder","strikethrough","superscript","subscript","removeformat","formatmatch","autotypeset","pasteplain","|","forecolor","backcolor","insertorderedlist","insertunorderedlist","|","rowspacingtop","rowspacingbottom","lineheight","|","paragraph","fontfamily","fontsize","|","directionalityltr","directionalityrtl","indent","|","justifyleft","justifycenter","justifyright","justifyjustify","|","touppercase","tolowercase","|","link","unlink","anchor","|","imagenone","imageleft","imageright","imagecenter","|","simpleupload","insertimage","emotion","scrawl","insertvideo","music","attachment","map","insertframe","insertcode","pagebreak","background","inserttable","|","horizontal","date","time","spechars","snapscreen","|","selectall","cleardoc","_template","_files","source"]],toolleipi:!1,width:550,height:350,value:t.desc},{xtype:"uxfilesfield",fieldLabel:"附件",width:550,height:200,name:"files"}]},getHeaderItems:function(e){var n=this,t=e.data,o='<img style="width:100%;height:100%" src="{headImg}">',r='<img style="width:100%;height:100%" src="{bgImg}">',i="";JE.isNotEmpty(t.headImg)&&(i=JE.toXT(o,{headImg:t.headImg}));var a="";return JE.isNotEmpty(t[t.bgType])&&(a=JE.toXT("bgImg"==t.bgType?r:'<div style="width:100%;height:100%;background-color:{bgColor};">',t)),[{xtype:"textfield",fieldLabel:"公司名称",name:"name",allowBlank:!1,value:t.name},{xtype:"textarea",name:"desc",fieldLabel:"公司简介",value:t.desc},{xtype:"fieldcontainer",fieldLabel:"LOGO",items:[{xtype:"box",width:80,height:80,html:i,cls:"image-box",listeners:{afterrender:function(a){a.getEl().on("click",function(){JE.uploadFile({params:{beanTableCode:"JE_SYS_MK",funcCode:"JE_SYS_MK",tableCode:"JE_SYS_MK",jeFileType:"PROJECT",returnType:"all"},callback:function(e){var t=n.activeView.down("[name=headImg]"),i=e.privateUrl||JE.getFileUrl(e.url,"PUBLIC","","","JE_SYS_MK");t.setValue(i),a.update(JE.toXT(o,{headImg:i}))}})})}}}]},{xtype:"fieldcontainer",fieldLabel:"封面图",items:[{xtype:"box",width:120,height:80,html:a,cls:"image-box",listeners:{afterrender:function(a){a.getEl().on("click",function(){JE.uploadFile({params:{beanTableCode:"JE_SYS_MK",funcCode:"JE_SYS_MK",tableCode:"JE_SYS_MK",jeFileType:"PROJECT",returnType:"all"},callback:function(e){var t=n.activeView.down("[name=bgImg]"),i=e.privateUrl||JE.getFileUrl(e.url,"PUBLIC","","","JE_SYS_MK");t.setValue(i),a.update(JE.toXT(r,{bgImg:i}))}})})}}}]},{xtype:"hidden",name:"bgImg",value:t.bgImg},{xtype:"hidden",name:"headImg",value:t.headImg}]},getDefField:function(e){var t={xtype:Ext.value(e.xtype,"textfield"),name:e.name,fieldLabel:e.fieldLabel,value:e.value||""};return 0<e.height&&(t.height=e.height),t},getEditField:function(n,e){var t=500,i="jeicon jeicon-new-fine-plus-circle",a="jeicon jeicon-error-circle";"plus"==JE.getTheme()&&(t=520,i="fa fa-plus",a="fa fa-times");var o={xtype:"fieldcontainer",layout:"hbox",type:"editfield",fieldType:"add",width:t,name:n.name,fieldLabel:n.fieldLabel,items:[{xtype:"hidden",itemId:"fieldLabel",value:n.fieldLabel},{xtype:"textfield",itemId:"value",margin:"0 8 0 0",value:n.value||"",flex:1},{xtype:"button",iconCls:i,cls:"btn btn-form JEPLUS_B_C01",handler:function(e){var t=e.ownerCt.ownerCt,i=-1,a=!1;t.items.each(function(e,t){if(e.name==n.name&&(a=!0),a&&e.name!=n.name)return i=t,!1}),t.insert(i,r)}}]},r={xtype:"fieldcontainer",layout:"hbox",type:"editfield",fieldType:"remove",width:t,cls:"editfield",name:n.name,items:[{xtype:"textfield",cls:"editfield-label",value:n.defaultLabel||n.fieldLabel,width:105,itemId:"fieldLabel",clearButton:!1},{xtype:"textfield",itemId:"value",margin:"0 8 0 0",value:"remove"==e?n.value:"",flex:1},{xtype:"button",iconCls:a,cls:"btn btn-form JEPLUS_B_C02",handler:function(e){e.ownerCt.ownerCt.remove(e.ownerCt)}}]};return"remove"==e?r:o}}),Ext.define("JE.sys.qrcode.view.FileView",{extend:"JE.sys.qrcode.view.common.BasicView",alias:"widget.qrcode.fileview",fileType:"file",layout:"hbox",cls:"je-qrcode-fileview",initComponent:function(){var o=this;"TP"==o.type&&(o.fileType="image"),o.defaults={border:0,bodyPadding:"10 20"};var e="file",t="文件";o.fileTpl='<div class="file"><img class="file-image" src="'+JE.getStaticUrl("JE.qrcode.file")+'"><div class="file-name">{name}</div><div class="file-size">{size}</div><button class="btn">替换文件</button></div>',"image"==o.fileType&&(e="image",t="图片",o.fileTpl='<div class="file"><img src="{url}" title="{name}*{size}" /><button class="btn">替换图片</button>'),o.uploadTpl='<div class="upload"><img class="upload-image" src="'+JE.getStaticUrl("JE.qrcode.upload-"+e)+'"><div class="upload-text">上传'+t+"</div></div>",o.items=[{xtype:"panel",flex:1,itemId:"center",layout:"column",defaults:{columnWidth:1},items:[{xtype:"box",cls:"fileview",itemId:"fileview",html:o.uploadTpl,height:220,margin:"0 0 10 0",listeners:{afterrender:function(a){a.getEl().on("click",function(e){var t=Ext.get(e.getTarget());(t.hasCls("btn")||t.hasCls("upload")||t.parent().hasCls("upload"))&&JE.uploadFile({uploadFilePath:"/mk",params:{funcCode:"JE_SYS_MK",tableCode:"JE_SYS_MK",jeFileType:"PROJECT",beanTableCode:"JE_SYS_MK"},callback:function(e){var t=e.privateUrl||JE.getFileUrl(e.url,"PROJECT","","","JE_SYS_MK"),i=a.ownerCt.getCmp("file");e.size=JE.bytesToSize(e.size),i.setValue({name:e.name,url:t,size:size})}})})}}},{xtype:"hidden",itemId:"file",listeners:{change:function(e,t,i){var a=JE.toObj(t),n=e.ownerCt.getCmp("fileview");JE.isEmpty(a)?n.update(o.uploadTpl):n.update(JE.toXT(o.fileTpl,a))}}},{xtype:"qrcode.editorview",itemId:"remark",remarkText:"给"+t+"加点描述",border:0}]},{xtype:"qrcode.qrcodeview",mainview:o}],o.callParent(arguments)},getData:function(){var e=this.callParent(arguments),t=this.getCmp("center").getCmp("file").getValue(),i=this.getCmp("center").getCmp("remark").getData();return e.viewCfg={file:t,remark:i},e},setData:function(e){var t=Ext.decode(e.MK_PZXX),i=this.getCmp("center").getCmp("file"),a=this.getCmp("center").getCmp("remark");i.setValue(t.file),a.setData(t.remark),this.callParent(arguments)},reset:function(){var e=this.getCmp("center").getCmp("file"),t=this.getCmp("center").getCmp("remark");e.reset(),t.reset(),this.callParent(arguments)}}),Ext.define("JE.sys.qrcode.view.ImageView",{extend:"JE.sys.qrcode.view.common.BasicView",alias:"widget.qrcode.imageview",layout:"hbox",cls:"je-qrcode-imageview",initComponent:function(){this.defaults={border:0,bodyPadding:"10 20"},this.items=[{xtype:"panel",flex:1,itemId:"center",layout:"column",defaults:{columnWidth:1,margin:"4 0",labelAlign:"right",labelWidth:80},items:[{xtype:"qrcode.editorview",itemId:"title",remarkText:"标题",title:"标题",collapsible:!0,collapsed:!0,height:300,border:0},{xtype:"panel",height:200,itemId:"images",layout:"fit",border:0,collapsible:!0,collapsed:!0,title:"交换图",getData:function(){return this.getCmp(0).getValue()},setData:function(e){this.getCmp(0).setValue(e)},reset:function(){this.getCmp(0).reset()},items:{xtype:"uxfilesfield",updateBtnText:"上传图片",fileTypes:"jpg;gif;png;bmp"}},{xtype:"qrcode.editorview",itemId:"remark",title:"描述",collapsible:!0,collapsed:!0,remarkText:"描述",border:0},{xtype:"form",layout:"column",itemId:"addInfo",border:0,defaults:{columnWidth:1,margin:"4 0",labelAlign:"right",labelWidth:80},getData:function(){return this.form.getValues()},setData:function(e){this.form.setValues(e)},reset:function(){this.form.reset()},items:[{xtype:"fieldcontainer",fieldLabel:"添加记录",layout:"hbox",defaults:{margin:"0 2"},items:[{xtype:"yesnofield",boxLabel:"启用",name:"enableAdd",margin:"0 2 0 0"},{xtype:"yesnofield",name:"enablePwd",boxLabel:"加密"},{xtype:"textfield",name:"pwd",emptyText:"密码"},{xtype:"yesnofield",name:"login",boxLabel:"绑定系统用户(加密后，绑定系统用户，默认用系统用户登录)"}]},{xtype:"jsonarrayfield",fieldLabel:"记录类型",name:"type",columns:[{dataIndex:"title",text:"名称",width:150},{dataIndex:"url",text:"URL",flex:1}]}]}]},{xtype:"qrcode.qrcodeview",mainview:this}],this.callParent(arguments)},itemIds:["title","images","remark","addInfo"],getData:function(){var i=this,e=i.callParent(arguments),a={};return Ext.each(i.itemIds,function(e){var t=i.getCmp("center").getCmp(e);a[e]=t.getData()}),e.viewCfg=a,e},setData:function(e){var a=this,n=Ext.decode(e.MK_PZXX);Ext.each(a.itemIds,function(e){var t=a.getCmp("center").getCmp(e),i=n[e];t.setData(i)}),a.callParent(arguments)},reset:function(){var t=this;Ext.each(t.itemIds,function(e){t.getCmp("center").getCmp(e).reset()}),t.callParent(arguments)}}),Ext.define("JE.sys.qrcode.view.MainView",{extend:"Ext.panel.Panel",alias:"widget.qrcode.mainview",layout:"border",initComponent:function(){this.items=[{xtype:"box",height:50,region:"north",html:'<div style="position: relative;height:100%;background-color:#fff;padding-left:10px;"><img src="'+JE.getStaticUrl("JE.qrcode.maku")+'" style="height:100%;width:auto;"><span style="position: absolute;right:50px;bottom:10px;">规划您专有的二维码</span></div>'},{xtype:"box",height:30,region:"south",style:"background-color:#ECF0F5;padding:0 20px;line-height:30px;color: #195B82;cursor: pointer;",html:"该二维码已保存至未命名的目录中，可以随时查看扫描统计",listeners:{afterrender:function(e){e.getEl().on("click",function(){JE.openFuncByCode("JE_SYS_MK")})}}},{xtype:"tabpanel",region:"center",defaults:{bodyPadding:"20 40",bodyStyle:"background-color:#fff;"},items:[{title:"文本",type:"WZ",xtype:"qrcode.textview"},{title:"网址",type:"WWW",xtype:"qrcode.urlview"},{title:"名片",type:"MP",xtype:"qrcode.cardview"},{title:"文件",type:"WJ",xtype:"qrcode.fileview"},{title:"图片",type:"TP",xtype:"qrcode.imageview"},{title:"APP",type:"APP",xtype:"qrcode.appview"},{title:"企业宣传",type:"QYXC",xtype:"qrcode.companyview"}]}],this.callParent(arguments)},afterRender:function(){this.callParent(arguments)},load:function(){JE.msg("load")}}),Ext.define("JE.sys.qrcode.view.TextView",{extend:"JE.sys.qrcode.view.common.BasicView",alias:"widget.qrcode.textview",layout:"hbox",cls:"je-qrcode-textview",initComponent:function(){this.defaults={border:0,bodyPadding:"10 20"},this.items=[{xtype:"panel",flex:1,layout:"column",autoScroll:!0,itemId:"center",defaults:{columnWidth:1},items:[{xtype:"qrcode.editorview",itemId:"remark",border:0}]},{xtype:"qrcode.qrcodeview",mainview:this}],this.callParent(arguments),this.qrcodeview=this.getCmp("qrcode")},getData:function(){var e=this.callParent(arguments);return e.viewCfg=this.remarkview.getData(),e},setData:function(e){var t=Ext.decode(e.MK_PZXX);this.remarkview.setData(t),this.callParent(arguments)},reset:function(){this.remarkview.reset(),this.callParent(arguments)}}),Ext.define("JE.sys.qrcode.view.UrlView",{extend:"JE.sys.qrcode.view.common.BasicView",alias:"widget.qrcode.urlview",layout:"hbox",initComponent:function(){var e=this;e.defaults={border:0,bodyPadding:"10 20"},e.items=[{xtype:"panel",flex:1,layout:"column",autoScroll:!0,defaults:{columnWidth:1,border:0,xtype:"panel"},itemId:"center",items:[{layout:"card",itemId:"urlview",defaults:{border:0,xtype:"panel",layout:"column",autoScroll:!0,defaults:{columnWidth:1,border:0}},items:[{itemId:"single",items:[{xtype:"textfield",emptyText:"http://",height:60,itemId:"url",inputAttrTpl:'style="padding:10px;font-size:20px;color:#666;"',margin:"40 0 0 0"},{xtype:"container",margin:"20 0",items:{xtype:"button",width:150,cls:"btn",iconCls:"fa fa-plus",text:"添加多个网址",handler:function(){e.getCmp("center").getCmp("urlview").getLayout().setActiveItem("more")}}}]},{itemId:"more",items:[{xtype:"cbblistfield",itemId:"urls",typeConfig:{xtype:"textfield",emptyText:"描述",width:150},valueConfig:{emptyText:"http://"},margin:"20 0"},{xtype:"qrcode.editorview",itemId:"remark",remarkText:"请输入描述信息"},{xtype:"container",margin:"20 0",items:{xtype:"button",width:150,cls:"btn",iconCls:"fa fa-plus",text:"添加单个网址",handler:function(){e.getCmp("center").getCmp("urlview").getLayout().setActiveItem("single")}}}]}]}]},{xtype:"qrcode.qrcodeview",mainview:e}],e.callParent(arguments)},getData:function(){var e=this.callParent(arguments),t={},i=this.getCmp("center").getCmp("urlview").getLayout().getActiveItem();return t="single"==i.itemId?{url:i.getCmp("url").getValue()}:{urls:i.getCmp("urls").getValue(),remark:i.getCmp("remark").getData()},e.viewCfg=t,e},setData:function(e){var t=Ext.decode(e.MK_PZXX),i=this.getCmp("center").getCmp("urlview");i.getLayout().setActiveItem(JE.isEmpty(t.url)?"more":"single");var a=i.getLayout().getActiveItem();JE.isNotEmpty(t.url)?a.getCmp("url").setValue(t.url):(a.getCmp("urls").setValue(t.urls),a.getCmp("remark").setData(t.remark)),this.callParent(arguments)},reset:function(){var e=this.getCmp("center").getCmp("urlview");e.getLayout().setActiveItem("single"),e.getCmp("single").getCmp("url").reset();var t=e.getCmp("more");t.getCmp("urls").reset(),t.getCmp("remark").reset(),this.callParent(arguments)}}),Ext.define("JE.sys.qrcode.view.WeiXinView",{extend:"Ext.panel.Panel",alias:"widget.qrcode.weixinview",initComponent:function(){this.callParent(arguments)},afterRender:function(){this.callParent(arguments)}}),Ext.define("JE.sys.qrcode.controller.MainController",{extend:"Ext.app.Controller",init:function(){this.control({})},views:["JE.sys.qrcode.view.common.BasicView","JE.sys.qrcode.view.AppView","JE.sys.qrcode.view.CardView","JE.sys.qrcode.view.FileView","JE.sys.qrcode.view.ImageView","JE.sys.qrcode.view.TextView","JE.sys.qrcode.view.UrlView","JE.sys.qrcode.view.WeiXinView","JE.sys.qrcode.view.CompanyView","JE.sys.qrcode.view.common.LogoView","JE.sys.qrcode.view.common.EditorView","JE.sys.qrcode.view.common.QRCodeView","JE.sys.qrcode.view.common.ButtonBar","JE.sys.qrcode.view.MainView"]}),Ext.define("JE.sys.transaction.view.MainView",{extend:"Ext.panel.Panel",alias:"widget.transaction.mainview",layout:"card",cls:"je-tp-tpview",initComponent:function(){var o=this;o.bodyStyle="border-top-color:#ddd;",o.tbar={height:40,itemId:"tbar",style:"background-color:#fff;",items:[{xtype:"container",layout:"hbox",cls:"tplistview-buttons",itemId:"buttons",defaults:{allowDepress:!1,cls:"btn JEPLUS_B_L10",enableToggle:!0,toggleGroup:"tpBtns",width:140,margin:"0 5",xtype:"button",handler:function(e){o.getLayout().setActiveItem(e.itemId),o.getDockedCmp("tbar").getCmp("searchField").setValue(e.keyword)}},items:[{text:"待处理的事务",basicText:"待处理的事务",itemId:"do",pressed:!0},{text:"我安排的事务",basicText:"我安排的事务",itemId:"send"},{text:"历史事务",basicText:"历史事务",itemId:"history"}]},{xtype:"button",cls:"btn JEPLUS_B_L10",text:"返回",itemId:"back",hidden:!0,iconCls:JE.getIconCls({iconCls:"return",fontIconCls:"fa fa-mail-reply"}),handler:function(){o.getLayout().setActiveItem("send");var i=o.getDockedCmp("tbar");Ext.iterate({new:!0,back:!1,buttons:!0},function(e,t){i.getCmp(e).setVisible(t)})}},"->",{xtype:"uxtrigger",emptyText:"Search...",itemId:"searchField",handler:function(e){var t=e.getValue(),i=JE.isEmpty(t)?"":" AND TASK_BT LIKE '%"+t+"%'",a=o.getLayout().getActiveItem(),n=a.store.proxy.extraParams;n.whereSql=n.basicSql+i,a.store.loadPage(1),o.buttons.getCmp(a.itemId).keyword=t},width:200},{xtype:"button",cls:"btn JEPLUS_B_C01",text:"新建任务",itemId:"new",iconCls:JE.getIconCls({iconCls:"jeicon jeicon-resource-table-addition",fontIconCls:"fa fa-plus"}),handler:function(){JE.sendTransaction({callback:function(){o.getCmp("send").store.load(),o.getCmp("do").store.load()}})}}]},o.items=[{xtype:"transaction.tplistview",itemId:"do"},{xtype:"transaction.tplistview",itemId:"send"},{xtype:"transaction.tplistview",itemId:"sendchild"},{xtype:"transaction.tplistview",itemId:"history"}],o.callParent(arguments),o.buttons=o.getDockedCmp("tbar").getCmp("buttons")}}),Ext.define("JE.sys.transaction.view.TPListView",{extend:"Ext.grid.Panel",alias:"widget.transaction.tplistview",cls:"je-grid je-tp-tplistview",hideHeaders:!0,viewConfig:{stripeRows:!1,tableFocusedFirstCls:"",tableSelectedFirstCls:"",tableOverFirstCls:"",beforeOverItemCls:"",beforeSelectedItemCls:""},border:0,bodyStyle:"border-top-width:0px;",initComponent:function(){var s=this,e=s.itemId;s.infoTpl={once:'从 {[values.TASK_RWKSSJ.substring(0,13)]}点 开始<tpl if="TASK_YQWCSJ">，到 {[values.TASK_YQWCSJ.substring(0,13)]}点 截止</tpl>',repeat:"从 {[values.TASK_RWKSSJ.substring(0,10)]} 开始，{TASK_CFFS_NAME} {info} 天执行一次，执行时间为当天 {time} ，限期 {TASK_YQJTHWC} 天内完成，到 {TASK_XHSXRQ} 截止"},s.listTpl=new Ext.XTemplate(['<div class="tplistview-item {[this.type]} task-{TASK_TASKFS_CODE} <tpl if="TASK_QY_CODE==\'0\'">task-stop</tpl>">','<div class="first">','<span class="title">{rowNum}. {TASK_BT}</span>','<span class="user"><tpl if="this.type != \'send\'">{JOB_RWFQR}，</tpl>{[values.SY_CREATETIME.substring(0,16)]}</span>','<tpl if="this.type == \'send\'"><i class="fa fa-remove removeTask" data-qtip="取消任务"></i></tpl>',"</div>",'<div class="info">','<i class="fa fa-italic once"></i>','<i class="fa fa-refresh repeat"></i>',"{TASK_TASKFS_NAME}：{[this.getTimeInfo(values)]}","</div>",'<div class="done">{[this.getItems(values)]}</div>','<div class="buttons">',"<tpl if=\"this.type=='send'\">","<tpl if=\"TASK_TASKFS_CODE == 'once'\">",'<div class="button pz">批注({[values.SY__POSTIL || 0]})</div>',"<tpl else>",'<div class="button enable" data-value="{TASK_QY_CODE}"><tpl if="TASK_QY_CODE==\'0\'">启动<tpl else>暂停</tpl></div>',"</tpl>",'<div class="button edit">编辑</div>',"<tpl elseif=\"this.type=='sendchild'\">",'<div class="button pz">批注({[values.SY__POSTIL || 0]})</div>',"<tpl else>",'<tpl if="JOBMX_SFLQRW != 1">','<div class="button lqrw">领取任务</div>','<tpl elseif="JOBMX_SFWCRW != 1">','<div class="button wcrw">完成任务</div>',"</tpl>",'<div class="button pz">批注({[values.SY__POSTIL || 0]})</div>','<div class="button star"><i class="fa <tpl if="JOBMX_JX==\'1\'">fa-star<tpl else>fa-star-o</tpl>"></i>加星</div>',"</tpl>","</div>","</div>",{type:e,getItems:function(e){var t=e.TASK_ZPRID.split(","),i=[];if("sendchild"==this.type||"once"==e.TASK_TASKFS_CODE&&"send"==this.type)for(var a=t.length,n=JE.toNum(e.JOB_YWCRS),o=JE.toNum(e.JOB_YLQRWS),r=0;r<a;r++){var l="";r<n?l="wc":r<o&&(l="lq"),i.push('<div class="'+l+'"></div>')}return i.join("")},getTimeInfo:function(e){var t="";if("send"==this.type)if("once"==e.TASK_TASKFS_CODE)t=s.infoTpl.once;else{t=s.infoTpl.repeat;var i=e.TASK_CFFS_CODE;"day"==i?e.info=e.TASK_JGTS:"week"==i?e.info=e.TASK_WEEK_NAME:"month"==i?e.info=e.TASK_RY_NAME:"year"==i&&(e.info=e.TASK_Y_NAME+e.TASK_RY_NAME),e.time=e.TASK_SF.split(":")[0]+" 点"}else{t=s.infoTpl.once;var a=new Date,n=Ext.Date.parse(e.TASK_YQWCSJ,"Y-m-d H:i:s");JE.isNotEmpty(n)&&a.getTime()>n.getTime()&&(t+='<span style="margin-left:10px;color:red;font-weight: bold;">已延期</span>')}return JE.toXT(t,e)}}]);var t={};(t="send"==e?{tableName:"JE_SYS_TASK",autoLoad:!0,params:{whereSql:" AND SY_CREATEUSERID='"+JE.USER.userId+"'",orderSql:" order by SY_CREATETIME desc"}}:"sendchild"==e?{tableName:"JE_SYS_JOB",autoLoad:!1,params:{whereSql:" AND 1!=1",orderSql:" order by SY_CREATETIME desc"}}:{tableName:"JE_SYS_JOB_V",autoLoad:!0,params:{whereSql:" AND SY_CREATEUSERID='"+JE.USER.userId+"' AND JOBMX_SFBJLS "+("history"==e?"='1'":"!='1'"),orderSql:" order by JOBMX_JX desc,SY_CREATETIME desc"}}).params.basicSql=t.params.whereSql,s.store=JE.getStore(t),s.store.on("load",function(e){var t=s.ownerCt.buttons.getCmp(s.itemId),i=e.totalCount;if(t&&t.setText(t.basicText+(0<i?"("+i+")":"")),"do"==s.itemId){var a=s.ownerCt.id.replace("_mainview","");JE.loadBadge(a)}}),s.columns=[{dataIndex:"text",flex:1,renderer:function(e,t,i,a){var n=i.data,o=s.store.currentPage||1,r=s.store.pageSize;return rowNum=(o-1)*r+a+1,n.rowNum=rowNum,s.listTpl.apply(n)}}],s.bbar={xtype:"uxpagingtoolbar",itemId:"pagingtoolbar",useTheme:!0,store:s.store},s.callParent(arguments),s.on({itemdblclick:function(e,t,i,a,n,o){s.showInfo(t)},itemclick:function(e,t,i,a,n,o){n.stopPropagation();var r=n.getTarget(".button",2,!0),l=n.getTarget(".removeTask");r?r.hasCls("edit")?s.editInfo(t):r.hasCls("pz")?s.pz(t):r.hasCls("enable")?s.enableTask(t):r.hasCls("lqrw")?s.rw(t,"receiveTask","JOBMX_SFLQRW","领取"):r.hasCls("wcrw")?s.rw(t,"finishTask","JOBMX_SFWCRW","完成"):r.hasCls("star")?s.star(t):r.hasCls("history")&&s.history(t):l&&s.removeTask(t)}})},editInfo:function(a){var e=this;JE.sendTransaction({type:"edit",callback:function(){e.store.load(),e.ownerCt.getCmp("do").store.load()},showFn:function(e){var i=e.getCmp(0),t=a.data;t.TASK_RWKSSJ2=t.TASK_RWKSSJ,t.TASK_YQJTHWC=t.TASK_YQJTHWC<1?1:t.TASK_YQJTHWC,t.TASK_JGTS=t.TASK_JGTS<1?1:t.TASK_JGTS,i.form.findField("TASK_TASKFS_CODE").setReadOnly(!0),Ext.each(["once","repeat"],function(e){var t=i.getCmp(e);Ext.each(t.query("[isFormField]"),function(e){e.setReadOnly(!0)})}),i.form.setValues(t),"repeat"==t.TASK_TASKFS_CODE&&i.getDockedCmp("buttons").getCmp("again").show()}})},showInfo:function(e){var t=e.data;if("send"==this.itemId&&"repeat"==t.TASK_TASKFS_CODE){var i=this.ownerCt.getCmp("sendchild");this.ownerCt.getLayout().setActiveItem(i);var a=this.ownerCt.getDockedCmp("tbar");Ext.iterate({new:!1,back:!0,buttons:!1},function(e,t){a.getCmp(e).setVisible(t)}),i.store.proxy.extraParams.basicSql=i.store.proxy.extraParams.whereSql=" AND JE_SYS_TASK_ID = '"+t.JE_SYS_TASK_ID+"'",i.store.loadPage(1)}else JE.showTransaction(e,this.itemId)},enableTask:function(e){var t=e.get("TASK_QY_CODE");t="0"==t?"1":"0",e.set("TASK_QY_CODE",t),JE.ajax({url:JE.getUrlMaps("je.core.job","1"==t?"startTask":"stopTask"),params:{JE_SYS_TASK_ID:e.get("JE_SYS_TASK_ID")}}),JE.msg("1"==t?"任务已启动！":"任务已暂停！")},removeTask:function(t){var i=this;JE.confirm("确定取消该任务吗？",function(e){"ok"==e&&JE.ajax({url:JE.getUrlMaps("je.core.job","deleteTask"),params:{JE_SYS_TASK_ID:t.get("JE_SYS_TASK_ID"),TASK_TASKFS_CODE:t.get("TASK_TASKFS_CODE")}}).success&&(JE.msg("取消成功！"),i.loadStore(["do","history","send"]))})},star:function(e){var t=e.get("JOBMX_JX");t="1"==t?"0":"1",JE.ajax({url:JE.getUrlMaps("je.core.job","1"==t?"addStar":"cancelStar"),params:{JE_SYS_JOB_ID:e.get("JE_SYS_JOB_ID")}}).success&&this.store.load()},history:function(e,t){JE.ajax({url:JE.getUrlMaps("je.core.job","setHistory"),params:{JE_SYS_JOB_ID:e.get("JE_SYS_JOB_ID")}}).success&&(0!=t&&JE.msg("标记历史成功！"),this.loadStore(["do","history"]))},rw:function(t,e,i,a){var n={};Ext.each(["JE_SYS_JOB_ID","JOB_RWFQRID","TASK_TASKFS_CODE","JE_SYS_TASK_ID"],function(e){n[e]=t.get(e)}),JE.ajax({url:JE.getUrlMaps("je.core.job",e),params:n}).success&&(JE.msg(a+"任务成功！"),t.set(i,"1"),"finishTask"==e&&this.history(t,!1))},pz:function(i){var a,n=this,e=i.get("JE_SYS_JOB_ID"),t=i.get("JE_SYS_TASK_ID");if("send"==n.itemId){var o=JE.ajax({url:JE.getUrlMaps("je.core.selectOne"),params:{tableCode:"JE_SYS_JOB",whereSql:" AND JE_SYS_TASK_ID = '"+t+"'"}});if(!o.success)return void JE.alert(o.obj);a=o.obj}else a=JE.ajax({url:JE.getUrlMaps("je.core.getInfoById"),params:{tableCode:"JE_SYS_JOB",pkValue:e}});JE.CoreUtil.showPostil({funcCode:"JE_SYS_TASK",pkValue:a.JE_SYS_TASK_ID,userId:a.SY_CREATEUSERID,userName:a.SY_CREATEUSERNAME,callback:function(e){if(i.set("SY__POSTIL",e),"send"==n.itemId){var t={tableCode:"JE_SYS_TASK",JE_SYS_TASK_ID:a.JE_SYS_TASK_ID,SY__POSTIL:e};JE.ajax({url:JE.getUrlMaps("je.core.update"),params:t,async:!0})}}})},loadStore:function(e){var t=this;JE.isEmpty(e)||Ext.each(e,function(e){t.ownerCt.getCmp(e).store.load()})}}),Ext.define("JE.sys.transaction.controller.MainController",{extend:"Ext.app.Controller",init:function(){this.control({})},views:["JE.sys.transaction.view.MainView","JE.sys.transaction.view.TPListView"]}),Ext.define("JE.sys.plantform.view.MainView",{extend:"Ext.panel.Panel",alias:"widget.plantform.mainview",layout:"column",autoScroll:!0,initComponent:function(){var e=this;e.defaults={columnWidth:1},e.plantformType=JE.getPlusInfo()[0];var t={0:"学习版",1:"社区版",2:"商业版",3:"标准版",4:"专业版",5:"SAAS版"}[e.plantformType];e.bodyPadding="20 40",e.items=[{xtype:"box",ref:"bbinfo",style:"font-size:20px;position: relative;padding-left:70px;padding-top:5px;",tpl:'<img src="'+JE.getStaticUrl("JE.sys.plantform.view.MainView.plantform-logo")+'" style="width:70px;position: absolute;top:-15px;left:0px;">您正在使用的是JEPLUS{text} {version}。',data:{text:t,version:JE.systemConfig.JE_JEPF_VERSION}},{xtype:"container",layout:"vbox",defaults:{margin:"5 0",style:"border-radius: 4px;padding: 10px !important;"},items:[{xtype:"button",cls:"btn JEPLUS_B_C01",width:200,text:"购买标准版/专业版",handler:function(){window.open("http://jeplus.cn/about.html")}},{xtype:"button",cls:"btn JEPLUS_B_L10",width:200,text:"激活授权码",handler:function(){e.auth("激活授权码")}},{xtype:"button",cls:"btn JEPLUS_B_C03",width:200,text:"修改双显",handler:function(){e.auth("双显授权")}}]},{xtype:"box",padding:"20 0",html:['<img src="'+JE.getStaticUrl("JE.sys.plantform.view.MainView.product")+'" width="100%">'].join("")},{xtype:"box",style:"line-height:30px;",html:['<div style="font-size:20px;padding-top:20px;">什么是双显？</div>',"<div>双显是JEPLUS产品用于展示产品信息的特有名词，显示一：控制系统右上角的版权展示区；显示二：控制功能加载过程中的过场信息区域.</div>",'<a style="color:blue;text-decoration: none;" href="http://jeplus.cn/JEPLUS_Business_Book.pdf" target="_blank;">下载平台商业授权机制告知书.pdf</a>',"<div>显示一</div>",'<img height="50" src="'+JE.getStaticUrl("JE.sys.plantform.view.MainView.plantform-show1")+'">',"<div>显示二</div>",'<img height="300" src="'+JE.getStaticUrl("JE.sys.plantform.view.MainView.plantform-show2")+'">'].join("")}],e.callParent(arguments)},auth:function(e){var l=this;JE.win({title:e,height:280,width:500,useButton:!0,okButtonText:"认证",autoShow:!0,items:{xtype:"form",border:0,frame:!1,bodyPadding:"5",layout:"column",defaults:{labelAlign:"top",allowBlank:!1,columnWidth:1,xtype:"textfield"},items:[{fieldLabel:"授权码",emptyText:"0000-0000-0000-0000",name:"code"},{fieldLabel:"授权密码",name:"pwd"}]},fn:function(e){var t=e.getCmp(0);if(!t.form.isValid())return!1;var i=t.form.findField("code").getValue(),a=t.form.findField("pwd").getValue(),n=JE.ajax({url:"/je/app/cache/setConfig",params:{key:i,pw:a}});if(n.success){var o=l.down("box[ref=bbinfo]"),r={0:"学习版",1:"社区版",2:"商业版"}[n.msg];o&&o.update({text:r,version:JE.systemConfig.JE_JEPF_VERSION}),JE.confirm("认证成功，当前版本为【"+r+"】,是否立即刷新界面？",function(e,t){"ok"==e&&location.reload(!0)})}else JE.alert(n.msg)}})}}),Ext.define("JE.sys.plantform.controller.MainController",{extend:"Ext.app.Controller",init:function(){this.control({})},views:["JE.sys.plantform.view.MainView"]}),Ext.define("JE.sys.companyinfo.view.companyEditor",{extend:"Ext.panel.Panel",border:0,layout:"card",alias:"widget.companyinfo.companyeditor",ref:"companyeditor",initComponent:function(){this.actType="show";var n=this.cardType,e=this.getEditor();if("false"==e.success||JE.isEmpty(e[n]))var t="";else if("YH_CYWJ"==n)t=e[n];else t=Ext.htmlDecode(e[n]);this.updata?this.items=[{xtype:"panel",layout:"fit",border:0,itemId:"uxfilesfieldbox",bodyStyle:"border:0;",margin:"10px",buttonAlign:"center",items:[{xtype:"uxfilesfield",itemId:"uxfilesfield",margin:"10px 0 0 0",value:t}],buttons:[{xtype:"button",text:"保存",cls:"btn JEPLUS_B_L10",iconCls:"fe icon-edit-3",border:0,handler:function(e){var t=this.up("[itemId=uxfilesfieldbox]").getCmp("uxfilesfield"),i=this.up("[ref=companyeditor]"),a=t.getValue();i.saveEditor(n,a)}}]}]:this.items=[{xtype:"panel",itemId:"ueditorfieldId",layout:"fit",border:0,bodyStyle:"border:0;",margin:"10px",cls:"ueditorfieldId je-form-plus",buttonAlign:"center",items:[{xtype:"ueditorfield",name:"HELP_QZNR",simpleToolbar:!0,toolleipi:!1,labelAlign:"top",value:t,itemId:"ueditorfield",hidden:!0,margin:"10px 0 0 0",cls:"je-field-tablestyle"},{xtype:"panel",html:t,itemId:"uevaluefield",border:0,padding:"20px"}],buttons:[{xtype:"button",text:"编辑",cls:"btn JEPLUS_B_L10",iconCls:"fe icon-edit-3",ref:"editBtn",border:0,handler:function(e){var t=e.up("panel");t.down("button[ref=saveBtn]").show(),t.down("button[ref=backBtn]").show(),e.hide(),t.getCmp("ueditorfield").show(),t.getCmp("uevaluefield").hide()}},{xtype:"button",text:"保存",border:0,iconCls:"fa fa-save",cls:"btn JEPLUS_B_L10",hidden:!0,ref:"saveBtn",handler:function(e){var t=this.up("[itemId=ueditorfieldId]").getCmp("ueditorfield"),i=this.up("[ref=companyeditor]"),a=t.getValue();i.saveEditor(n,a)}},{xtype:"button",text:"返回",border:0,ref:"backBtn",cls:"btn",iconCls:"fe icon-back",hidden:!0,handler:function(e){var t=e.up("panel");t.down("button[ref=saveBtn]").hide(),t.down("button[ref=editBtn]").show(),e.hide();var i=t.getCmp("ueditorfield"),a=t.getCmp("uevaluefield");a.update(Ext.htmlDecode(i.getValue())),i.hide(),a.show()}}]}],this.callParent(arguments)},saveEditor:function(e,t){var i={tableCode:"JE_SAAS_YH",funcCode:"JE_SAAS_YH",JE_SAAS_YH_ID:JE.currentUser.zhId,batchFilesFields:"YH_CYWJ"==e?"YH_CYWJ":""};i[e]=t,JE.ajax({url:"/je/doUpdate",params:i,success:function(e){var t=Ext.decode(e.responseText);t.success?JE.msg("保存成功"):JE.msg(t.message)}})},getEditor:function(){return JE.ajax({url:"/je/getInfoById",params:{pkValue:JE.currentUser.zhId,tableCode:"JE_SAAS_YH"}})}}),Ext.define("JE.sys.companyinfo.view.CompanyInFoView",{extend:"Ext.panel.Panel",border:0,layout:"fit",alias:"widget.companyinfo.companyinfoview",bodyPadding:2,defaults:{border:0},margin:"-10px 0 0 0",requires:["JE.sys.companyinfo.view.companyEditor"],initComponent:function(){this.items={xtype:"tabpanel",margin:"-2px 0 0 0",items:[{title:"公司概况",xtype:"companyinfo.companyeditor",cardType:"YH_GSGK"},{title:"开票信息",xtype:"companyinfo.companyeditor",cardType:"YH_FPXX"},{title:"付款信息",xtype:"companyinfo.companyeditor",cardType:"YH_FKXX"},{title:"常用文件",xtype:"companyinfo.companyeditor",updata:!0,cardType:"YH_CYWJ"},{title:"产品概况",xtype:"companyinfo.companyeditor",cardType:"YH_CPGK"}]},this.callParent(arguments)}}),window.ExtJsPath="/static/ux/tool",Ext.Loader.setPath("PRO","pro"),Ext.Loader.setPath("PLUGIN","plugin"),Ext.Loader.setPath("Ext.ux",ExtJsPath+"/ux"),Ext.application({name:"JE",scope:this,appFolder:"JE",init:function(){JE.initCommon(),Ext.BLANK_IMAGE_URL=JE.buildCdnUrl(ExtJsPath+"/resources/css/images/tree/s.gif"),Ext.QuickTips.init(!0,{className:"JE.core.ux.QuickTip"});var e=JE.systemConfig.REGEXP,t=JE.systemConfig.PROMPT,i=JE.systemConfig.INITPASSWORD,a=JE.USER.initPassWord;"1"==i&&"1"==a&&JE.win({width:390,height:400,autoShow:!0,items:{xtype:"appinfo.updateinfo",infoType:"password",passwordConfig:{closeType:!0,passwordRegular:e,passwordMsg:t}},showFn:function(e){e.header.hide()},listeners:{show:function(){var e=document.getElementsByClassName("el-input__inner");JE.isNotEmpty(e)&&Ext.each(e,function(e){e.disabled=!0})},close:function(){var e=document.getElementsByClassName("el-input__inner");JE.isNotEmpty(e)&&Ext.each(e,function(e){e.disabled=!1})}}}),Ext.getBody().on("click",function(e){var t=window.__active_form_errormenu,i=Ext.getCmp(t);if(t){var a=e.getTarget();if(-1!=a.id.indexOf("button"))return;var n=e.getTarget("[id="+t+"]"),o=a.textContent;if(n&&"关闭提示"!=o)return;i.close()}})},launch:function(){Ext.get("skeleton-dom")&&(Ext.get("skeleton-dom").destroy(),Ext.get("skeleton-style").destroy()),Ext.create("Ext.container.Viewport",{layout:"card",border:0,id:"je-app-viewport",activeItem:JE.toNum(JE.USER.locked),items:[{xtype:"appmainview",itemId:"appmainview"},{xtype:"applockview",itemId:"applockview"}]}),JE.initIM()},controllers:["JE.app.controller.MainController"]});
//# sourceMappingURL=maps/je-all-min.js.map
