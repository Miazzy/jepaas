/*
  * ===========================================================
  *  je-tool-min.js Form JEPAAS 
  *  version:V7.0.0 (2019-9-5) 
  *  This file using the AGPL3.0, if need to revise this file, please use the same agreement.
  * =========================================================== 
*/
Ext.define("JE.sys.funccfg.util.singleton",{singleton:!0,createIndex:function(e,t,i){var n=Ext.getCmp("funccfg.columngrid"),a=JE.ajax({url:JE.getUrlMaps("je.core.tableIndex","createIndexByColumn"),params:{tableCode:"JE_CORE_TABLEINDEX",funcId:e,TABLEINDEX_FIELDCODE:t,columnId:i}});if(a.success){var l=n.getStore().getById(t);l.set("RESOURCECOLUMN_INDEX","1"),l.commit(),JE.msg("索引已创建!")}else JE.alert(a.obj)},removeIndex:function(e,t,i){var n=Ext.getCmp("funccfg.columngrid"),a=JE.ajax({url:JE.getUrlMaps("je.core.tableIndex","removeIndexByColumn"),params:{tableCode:"JE_CORE_TABLEINDEX",funcId:e,TABLEINDEX_FIELDCODE:t,columnId:i}});if(a.success){var l=n.getStore().getById(t);l.set("RESOURCECOLUMN_INDEX","0"),l.commit(),JE.msg("索引已删除!")}else JE.alert(a.obj)},editTestCase:function(e){var t=Ext.getCmp("funccfg.testcasegrid"),n=t.down("button[ref=listupdate]"),a=t.getStore().getById(e);if(a){var i=JE.win({title:"测试用例",buttons:[],width:JE.getBodyWidth()-500,height:JE.getBodyHeight()-200,items:[{xtype:"funccfg.testcaseform",useButton:!0}],fn:function(e){var t=Ext.getCmp("funccfg.testcaseform").form.getValues();for(var i in t)a.set(i,t[i]);n.fireEvent("click",n)}});Ext.getCmp("funccfg.testcaseform").form.setValues(a.data),i.show()}else JE.alert("未找到主键值！")},remove:function(e,t,i){var n=e.panel,a=e.getStore().getAt(t);if(a.hasChildNodes())JE.alert("只能删除子节点!");else{var l=a.get("id");JE.confirm("确定删除吗?",function(e){if("ok"==e){var t=JE.ajax({url:JE.getUrlMaps("je.core.develop.funcInfo","remove"),params:{ids:l,tableCode:"JE_CORE_FUNCINFO",doTree:!0}});if(t.success){var i=a.parentNode;a.remove(),i.set("leaf",!i.hasChildNodes()),i.commit(),JE.msg("删除成功..."),n.refreshQuery()}else JE.error(t.msg,t)}})}},copy:function(e,t,i){var n=e.getStore().getAt(t);e.panel.copyObj=Ext.clone(n.data),e.panel.copyInfo.update("剪切板内容：功能名【<font color=red>"+n.data.text+"</font>】功能编码【<font color=red>"+n.data.code+"</font>】"),e.panel.down("button[ref=paste]").setDisabled(!1),JE.msg("已成功将【<font color=red>"+n.data.text+"</font>】功能放入剪切板!")},edit:function(i,e,t){var n=i.panel,a=i.getStore().getAt(e);JE.formWin({title:"修改："+a.get("text")+"【"+a.get("code")+"】",height:200,defaults:{enableKeyEvents:!0,listeners:{keypress:function(e,t,i){if(t.getKey()==t.ENTER){var n=e.up("window").down("button[text=确定]");n.handler(n)}}}},items:[{xtype:"textfield",fieldLabel:"编码",name:"code",allowBlank:!1,value:a.get("code")},{xtype:"textfield",fieldLabel:"名称",name:"name",allowBlank:!1,value:a.get("text")},{xtype:"textarea",fieldLabel:"功能描述",name:"remark",allowBlank:!0,value:a.get("FUNCINFO_FUNCREMARK")}],fn:function(e){if(e.name==a.get("text")&&e.code==a.get("code")&&e.remark==a.get("FUNCINFO_FUNCREMARK"))JE.msg("修改成功...");else{if(e.code!=a.get("code")&&i.panel.getRootNode().findChild("code",e.code,!0))return JE.alert("编码重复，请重新填写!"),!1;if(JE.ajax({url:JE.getUrlMaps("je.core.develop.funcInfo","update"),params:{tableCode:"JE_CORE_FUNCINFO",FUNCINFO_FUNCNAME:e.name,FUNCINFO_FUNCCODE:e.code,FUNCINFO_FUNCREMARK:e.remark,JE_CORE_FUNCINFO_ID:a.get("id")}}).success){JE.msg("修改成功...");var t=a.get("text");a.set("code",e.code),a.set("text",e.name),a.set("FUNCINFO_FUNCREMARK",e.remark),a.commit(),e.name!=t&&n.refreshQuery()}}}})},removeData:function(e,t,i){var a=e.getStore().getAt(t);JE.confirm("是否清空【<font color=red>"+a.get("text")+"</font>】功能？",function(e,t){if("ok"==e){var i=Ext.clone(a.data);i.tableCode="JE_CORE_FUNCINFO";var n=JE.ajax({url:JE.getUrlMaps("je.core.develop.funcInfo","clearFuncInfo"),params:i});n.success?JE.msg("功能清空成功!"):JE.alert(n.obj)}})},refresh:function(e,t,i){var n=e.getStore().getAt(t).get("FUNCINFO_FUNCCODE");JE.isNotEmpty(n)&&(JE.getFuncData(n,{refresh:!0}),JE.msg("功能数据刷新成功！"))},testYL:function(e){alert("测试用例")},testZY:function(e){alert("自由测试")},testZC:function(e){alert("自测评分")}}),Ext.define("JE.sys.funccfg.view.jseditor.Util",{showFuncJSEditor:function(e){JE.win({title:"功能对象事件编写",border:0,disableKeyEvent4Tab:!0,items:{xtype:"funccfg.jscodeeditor",funcId:e.funcId,saveFn:function(e,t){var i=Ext.encode(e),n=t.getDockedComponent("eventObjBar").down("button[pressed=true]");if(n){var a=Ext.clone(n.dataInfo);a[n.eventField]=i,n.eventInfo=i;var l=JE.ajax({url:JE.getUrlMaps("je.core","update"),params:a});return l.success?void 0:(JE.error(l.obj,l),!1)}},dockedItems:[{xtype:"toolbar",dock:"top",itemId:"eventTypeBar",defaults:{toggleGroup:"eventType",enableToggle:!0,funcInfo:e},items:[{text:"功能",type:"func",iconCls:"jeicon jeicon-set-up"},{text:"列",type:"column",iconCls:"jeicon jeicon-grid-configuration"},{text:"字段",type:"field",iconCls:"jeicon jeicon-form-configuration"},{text:"按钮",type:"button",iconCls:"jeicon jeicon-button"},{text:"Action列",type:"actioncolumn",iconCls:"jeicon jeicon-button"}]},{xtype:"toolbar",dock:"top",itemId:"eventObjBar",height:27,defaults:{toggleGroup:"eventObj",enableToggle:!0},items:[]}]}}).show()},showJSEditor:function(a){var e,t=a.type,l=a.parent,o=a.fieldName,d=a.record,i={};i=l.form?l.form.getValues():d.data,e=Ext.decode(Ext.value(i[o],"[]"));var n="事件",r="";switch(t){case"form":n="表单事件";break;case"grid":n="列表事件";break;case"column":n="列事件";break;case"field":n="字段事件",r=i.RESOURCEFIELD_XTYPE;break;case"button":n="按钮事件";break;case"actioncolumn":n="action按钮事件"}JE.win({title:n,border:0,disableKeyEvent4Tab:!0,items:{xtype:"funccfg.jscodeeditor",type:t,childType:r,value:e,funcId:l.funcId,saveFn:function(e){var t="save",i=Ext.encode(e);if(l.form?l.form.findField(o).setValue(i):(t="listupdate",(d=l.store.getById(d.getId())).set(o,i)),0!=a.fireOwnerAction){var n=l.down("button[ref="+t+"]");return n.fireEvent("click",n,!1),!1}}}}).show()},isFireListener:function(e){return JE.CoreUtil.isFireListener(e)}}),Ext.define("JE.sys.funccfg.view.power.PowerWriteSQLView",{alias:"widget.funccfg.powerwriteSQLview",title:"SQL授权",extend:"Ext.panel.Panel",layout:"border",autoScroll:!0,initComponent:function(){this.items=[{xtype:"panel",region:"center",layout:"fit",border:0,padding:50,items:[{xtype:"textarea",itemId:"textarea"}]}],this.callParent(arguments)},getConfigData:function(){return this.down("panel[xtype=panel]").down("[xtype=textarea]").getValue()},setConfigData:function(e){this.down("panel[xtype=panel]").down("[xtype=textarea]").setValue(e)},doReset:function(){this.down("panel[xtype=panel]").down("[xtype=textarea]").setValue("")},doState:function(){return"0"}}),Ext.define("JE.sys.funccfg.view.Func",{extend:"Ext.form.Panel",alias:"widget.funccfg.func",id:"funccfg.func",autoScroll:!0,bodyPadding:4,layout:"column",initComponent:function(){var a=this;a.dataZY={func:[{key:"quickQueryTitle",value:""},{key:"formLabelColor",value:""},{key:"rowColor",value:"1,0"},{key:"treerefresh",value:"1,0"},{key:"gridQueryBtnHide",value:"1,0"},{key:"columnCtrBtnHide",value:"1,0"}]};var e={columnWidth:.45,labelAlign:"right",labelWidth:145,padding:"1 2 1 0",xtype:"textfield"},t={title:"功能基础配置项",defaults:e,items:[{fieldLabel:"功能编码",readOnly:!0,name:"FUNCINFO_FUNCCODE"},{fieldLabel:"功能名称",readOnly:!0,name:"FUNCINFO_FUNCNAME"},{xtype:"gridssfield",configInfo:"JE_CORE_RESOURCETABLE,FUNCINFO_TABLENAME~FUNCINFO_PKNAME,RESOURCETABLE_TABLECODE~RESOURCETABLE_PKCODE,S",whereSql:" AND SY_JESYS='1' ",fieldLabel:"表名",allowBlank:!(a.defaults={xtype:"fieldset",columnWidth:1,collapsible:!0,layout:"column"}),editable:!0,name:"FUNCINFO_TABLENAME"},{fieldLabel:"主键名称",allowBlank:!1,name:"FUNCINFO_PKNAME"},{fieldLabel:"Action",name:"FUNCINFO_FUNCACTION"},{xtype:"cbbfield",fieldLabel:"功能类型",configInfo:"JE_CORE_FUNCTYPE",name:"FUNCINFO_FUNCTYPE",dicItemCodes:"func,tree,view,procedure,iditprocedure,sql",value:"func"},{xtype:"gridssfield",fieldLabel:"标题图标",configInfo:"JE_CORE_FONTICON,FUNCINFO_ICONCLS,FONTICON_CLS,S",name:"FUNCINFO_ICONCLS"},{xtype:"gridssfield",configInfo:"JE_CORE_RESOURCETABLE,FUNCINFO_CRUDTABLENAME~FUNCINFO_CRUDPKNAME,RESOURCETABLE_TABLECODE~RESOURCETABLE_PKCODE,S",whereSql:" AND SY_JESYS='1' ",fieldLabel:"操作表名",editable:!0,hidden:!0,name:"FUNCINFO_CRUDTABLENAME"},{fieldLabel:"功能英文名称",name:"FUNCINFO_FUNCNAME_EN"},{xtype:"textfield",fieldLabel:"JavaScript",name:"FUNCINFO_EXPANDJS"},{xtype:"jsonfield",columnWidth:.9,fieldLabel:"树形功能配置项",hidden:!0,name:"FUNCINFO_FUNCDICCONFIG",value:"{id:'',code:'code',text:'',parent:'',orderIndex:''}"},{xtype:"cbbfield",fieldLabel:"数据源名称",configInfo:"JE_CORE_DSDATA,,S",hidden:!0,name:"FUNCINFO_DBNAME",listeners:{afterrender:function(e){e.getStore().insert(0,[{text:"本地",code:"local",id:"local"}])}}},{xtype:"textfield",fieldLabel:"存储过程",hidden:!0,name:"FUNCINFO_PROCEDURE"},{xtype:"textarea",fieldLabel:"SQL",hidden:!0,columnWidth:.9,name:"FUNCINFO_SQL"},{xtype:"jsonarrayfield",fieldLabel:"视图操作表信息",hidden:!0,name:"FUNCINFO_VIEWCONFIGINFO",columnWidth:.9,height:200,defaultRecordValue:{tableCode:"",fieldCode:"",viewFieldCode:"",updateData:"1",insertData:"1",deleteData:"1"},columns:[{text:"表名",flex:1,dataIndex:"tableCode",field:{xtype:"gridssfield",editable:!0,configInfo:"JE_CORE_RESOURCETABLE,tableCode~pkCode~viewFieldCode,RESOURCETABLE_TABLECODE~RESOURCETABLE_PKCODE~RESOURCETABLE_PKCODE,S",whereSql:" AND SY_JESYS='1' "}},{text:"主键字段名",flex:1,dataIndex:"pkCode"},{text:"主键对应本视图字段",flex:1,dataIndex:"viewFieldCode"},{text:"包含字段",flex:3,dataIndex:"fieldCodes",field:{xtype:"gridssfield",editable:!0,configInfo:"JE_CORE_TABLECOLUMN,fieldCodes,TABLECOLUMN_CODE,M",whereSql:" AND TABLECOLUMN_TABLECODE='{tableCode}' "}},{text:"特殊字段带值配置",flex:2,dataIndex:"dofieldCodes",field:{xtype:"textfield",emptyText:"本视图字段1~本视图字段2,目标表字段1~目标表字段2"}},{text:"需添加",flex:1,hidden:!0,xtype:"uxcheckcolumn",dataIndex:"insertData"},{text:"需更新",flex:1,xtype:"uxcheckcolumn",dataIndex:"updateData"},{text:"需添加",flex:1,xtype:"uxcheckcolumn",dataIndex:"insertData"},{text:"需删除",flex:1,xtype:"uxcheckcolumn",dataIndex:"deleteData"}]},{xtype:"jsonarrayfield",fieldLabel:"查询参数",hidden:!0,name:"FUNCINFO_QUERYPARAM",columnWidth:.9,height:200,defaultRecordValue:{name:"",fieldType:"VARCHAR",paramType:"0"},columns:[{text:"参数名",flex:1,dataIndex:"name"},{text:"参数类型",flex:1,dataIndex:"fieldType",field:{xtype:"cbbfield",configInfo:"JE_CORE_DBFIELDTYPE"},renderer:function(e){return JE.toDicText("JE_CORE_DBFIELDTYPE",e)}},{text:"输出参数",flex:1,xtype:"uxcheckcolumn",dataIndex:"paramType"},{text:"缺省值",flex:1,dataIndex:"defaultValue"}]},{xtype:"rgroup",fieldLabel:"子功能显示方式",margin:"5 0 0 0",configInfo:"JE_CHILDREN_LAYOUT",name:"FUNCINFO_CHILDSHOWTYPE",iconLayout:"icon-text",dicItemCodes:"0,1,2,3,4",columnWidth:.9,value:"0"},{xtype:"rgroup",fieldLabel:"数据录入方式",cls:"je-func-rgroup",margin:"5 0 5 0",configInfo:"JE_CORE_INSERTTYPE",name:"FUNCINFO_INSERTTYPE",iconLayout:"icon-text",columnWidth:.9,value:"FORM"},{fieldLabel:"一对一卡片",columnWidth:.9,name:"FUNCINFO_OCFORM",xtype:"yesnofield",boxLabelAlign:"before",boxLabel:'<table style="border: 1px solid #b5b8c8;" border="0" cellspacing="0" cellpadding="0"><tr><td width=250 style="border-right: 1px solid #b5b8c8;height:62px;"><div style="height:62px;width:237px;background-image:url('+JE.getStaticUrl("JE.sys.funccfg.view.Func.FUNCINFO_OCFORM")+');"/></td><td width=200 style="color:#0000FF;">主功能下的所有子功能最多且只有一条数据,配置此选项的功能的所有子功能将无法展示出列表页面.</td></tr></table>'},{xtype:"yesnofield",columnWidth:.9,fieldLabel:"单条进卡片",boxLabelAlign:"before",name:"FUNCINFO_ONETOFORM",boxLabel:'<table style="border: 1px solid #b5b8c8;" border="0" cellspacing="0" cellpadding="0"><tr><td width=250 style="border-right: 1px solid #b5b8c8;height:62px;"><div style="height:50px;width:206px;background-image:url('+JE.getStaticUrl("JE.sys.funccfg.view.Func.FUNCINFO_ONETOFORM")+');"/></td><td width=200 style="color:#0000FF;">当列表有且只有一条数据时,平台会自动打开其对应的表单页面.</td></tr></table>'},{xtype:"yesnofield",fieldLabel:"启用列表表单",name:"FUNCINFO_LISTFORM",columnWidth:.9,boxLabel:'<span style="color:#0000FF;">启用列表表单后，可以单击列表数据，在列表下方表单查看详细信息.</span>'},{xtype:"yesnofield",fieldLabel:"启用功能附件 ",columnWidth:.9,boxLabel:'<span style="color:#0000FF;">启动该项功能在表单界面时允许批量上传附件,该附件是功能级别不绑定字段.</span>',name:"FUNCINFO_USEFILES"},{xtype:"yesnofield",fieldLabel:"启用数据留痕 ",columnWidth:.9,boxLabel:'<span style="color:#0000FF;">启动该项功能将记录用户每次修改数据的痕迹,并在表单中展示.【需配配合表单字段的留痕选项】</span>',name:"FUNCINFO_USEDATALOG"},{xtype:"yesnofield",fieldLabel:"启用工作流 ",columnWidth:.9,boxLabel:'<span style="color:#0000FF;">启动该项功能就启动了工作流引擎【需要事先先要完成工作流到功能的挂接】</span>',name:"FUNCINFO_USEWF"},{xtype:"yesnofield",fieldLabel:"只读流程 ",columnWidth:.9,boxLabel:'<span style="color:#0000FF;">只能查看流程跟踪与启动，不能进行审批操作【适用一个表多功能的流程跟踪查看】</span>',name:"FUNCINFO_READONLYWF"},{xtype:"yesnofield",fieldLabel:"启用审核功能 ",columnWidth:.9,boxLabel:'<span style="color:#0000FF;">启动该项功能就启动了审核功能【按钮、字段会自动添加】</span>',name:"FUNCINFO_ENABLEDSH"},{xtype:"yesnofield",fieldLabel:"启用SAAS模式过滤 ",columnWidth:.9,boxLabel:'<span style="color:#0000FF;">启动该项功能系统模式为行业云自动会按照字段SY_ZHID进行租户数据过滤</span>',name:"FUNCINFO_USESAAS"},{xtype:"yesnofield",fieldLabel:"查询策略单选 ",columnWidth:.9,boxLabel:'<span style="color:#0000FF;">查询策略默认是多选，勾中可单选</span>',name:"FUNCINFO_CXCLSELMODEL"},{xtype:"yesnofield",fieldLabel:"启用大按钮",columnWidth:.9,boxLabel:'<span style="color:#0000FF;">启用该项grid和form会使用系统内置的32*32像素的按钮.</span>',name:"FUNCINFO_BIGBUTTON"},{xtype:"yesnofield",fieldLabel:"子功能数据分步加载",columnWidth:.9,boxLabel:'<span style="color:#0000FF;">启用该项子功能只有被激活时才会加载数据.</span>',name:"FUNCINFO_CHILDREFRESH"},{xtype:"yesnofield",fieldLabel:"启用数据按需加载策略",columnWidth:.9,boxLabel:'<span style="color:#0000FF;">启用该项功能列表数据分布加载【在列表字段分布加载打勾的会加载，其余不加载】</span>',name:"FUNCINFO_COLUMNLAZY"},{xtype:"yesnofield",fieldLabel:"列表子功能平级显示",columnWidth:.9,boxLabel:'<span style="color:#0000FF;">子功能与列表主功能上下平级显示,取消则在列表下显示.【只有列表子功能起效，有快速查询可看效果.】</span>',name:"FUNCINFO_GRIDCHILDSS"},{xtype:"yesnofield",fieldLabel:"快速查询分步加载",columnWidth:.9,boxLabel:'<span style="color:#0000FF;">启用该项快速查询不会展开，只有展开时才会加载数据.</span>',name:"FUNCINFO_TREEREFRESH"},{xtype:"yesnofield",fieldLabel:"高级查询默认展开",columnWidth:.9,boxLabel:'<span style="color:#0000FF;">启用该项高级查询面板初始化时将会展开，默认收起</span>',name:"FUNCINFO_GROUPFORMOPEN"},{xtype:"cbblistfield",columnWidth:.6,fieldLabel:"子功能高度",name:"FUNCINFO_CHILDHEIGHT",typeConfig:{value:"default",editable:!1,width:90},valueConfig:{xtype:"numberfield",minValue:0},configInfo:"JE_CORE_RESOLUTION",width:200,unitTpl:"设置每个子功能高度",unitTplStyle:"color:#0000FF;border-width: 0px;"},{xtype:"textfield",fieldLabel:"附件路径",name:"FUNCINFO_ATTACHMENTPATH",columnWidth:.6,unitTpl:"控制附件字段上传附件的路径",unitTplStyle:"color:#0000FF;border-width: 0px;"},{xtype:"yesnofield",fieldLabel:"启用树形列表视图",columnWidth:.9,boxLabel:'<span style="color:#0000FF;">启用可切换视图，只有树形功能有效</span>',name:"FUNCINFO_USETREEGRID"},{xtype:"yesnofield",fieldLabel:"启用数据标记",columnWidth:.9,boxLabel:'<span style="color:#0000FF;">启用后在列表上自行添加标记列，便可对数据进行标记分类了</span>',name:"FUNCINFO_USEMARK"},{xtype:"yesnofield",fieldLabel:"启用修改标记",columnWidth:.9,boxLabel:'<span style="color:#0000FF;">启用后在列表上自行修改标记列，用于提示数据已经被修改了</span>',name:"FUNCINFO_USEEDIT"},{xtype:"yesnofield",fieldLabel:"启用简洁按钮条",columnWidth:.9,boxLabel:'<span style="color:#0000FF;">启用后列表和表单的按钮条将变成精简模式，同时依附按钮将不再起效</span>',name:"FUNCINFO_SIMPLEBAR"},{xtype:"cgroup",fieldLabel:"禁用功能查询SQL",columnWidth:.9,name:"FUNCINFO_DISABLEQUERYSQL",dataArray:[{code:"ALL",text:"全部"},{code:"group",text:"高级查询"},{code:"quick",text:"关键字查询"},{code:"tree",text:"快速查询"},{code:"column",text:"快速查询(列)"},{code:"mark",text:"标记列查询"},{code:"order",text:"排序"}]},{xtype:"box",columnWidth:.9,padding:"5 20 5 145",html:'<span style="color:#0000FF;">禁用后，查询whereSql不再拼接对应的类型sql，将以参数：queryFields,将查询项传入后台自行处理</span>'},{xtype:"fieldcontainer",fieldLabel:"启用简易表单",layout:"hbox",hidden:!0,columnWidth:.9,items:[{xtype:"yesnofield",name:"FUNCINFO_TABLEFORM",listeners:{change:function(e,t){e.nextSibling().setDisabled(!t)}}},{xtype:"yesnofield",name:"FUNCINFO_ENABLEFORMPRINT",fieldLabel:"启用表单打印按钮"},{xtype:"button",text:"表单设计",disabled:!0,padding:"0 4px",width:100,handler:function(){var e=a.getValues(),t={funcId:e.JE_CORE_FUNCINFO_ID,funcCode:e.FUNCINFO_FUNCCODE,funcName:e.FUNCINFO_FUNCNAME,tableName:e.FUNCINFO_TABLENAME,pkName:e.FUNCINFO_PKNAME,useTableForm:e.FUNCINFO_TABLEFORM,tableFormTpl:e.FUNCINFO_TABLEFORMTPL,tableFormHeight:JE.toNum(e.FUNCINFO_TABLEFORMHEIGHT),tableFormWidth:JE.toNum(e.FUNCINFO_TABLEFORMWIDTH)};JE.win({title:"简易表单设计",border:0,modal:!1,items:{xtype:"funccfg.form",funcInfo:t,funcFormObj:a}}).show()}},{xtype:"displayfield",padding:"0 4px",flex:1,value:'<span style="color:#0000FF;">可以自己画一个表单，表单内容只能在表格内展示</span>'},{xtype:"hidden",name:"FUNCINFO_TABLEFORMTPL"},{xtype:"hidden",name:"FUNCINFO_TABLEFORMWIDTH"},{xtype:"hidden",name:"FUNCINFO_TABLEFORMHEIGHT"}]},{xtype:"hidden",name:"JE_CORE_FUNCINFO_ID"},{xtype:"hidden",name:"FUNCINFO_ISCOMPLETE"},{xtype:"hidden",name:"FUNCINFO_NEWFUNCID"},{xtype:"hidden",name:"FUNCINFO_NODEINFOTYPE"}]},i={title:"列表、表单配置项",defaults:e,items:[{xtype:"numberfield",fieldLabel:"【列表】每页展示条数",name:"FUNCINFO_PAGESIZE",allowBlank:!1,value:30,hideTrigger:!0},{xtype:"numberfield",fieldLabel:"【列表】树形查询宽度",name:"FUNCINFO_QUERYWIDTH",hideTrigger:!0},{fieldLabel:"【列表】分组字段",name:"FUNCINFO_GROUPFIELD",emptyText:"字段编码~ASC 或 字段编码~DESC",fieldStyle:{"background-image":"none","background-color":"rgb(224, 251, 255)"}},{fieldLabel:"【列表】分组展示模版",name:"FUNCINFO_GROUPFIELDTPL",emptyText:"字段名: {name} ({rows.length} 条)",fieldStyle:{"background-image":"none","background-color":"rgb(224, 251, 255)"}},{fieldLabel:"【列表】操作说明",emptyText:"列表无数据时展示的说明文字.",name:"FUNCINFO_GRIDTIP"},{fieldLabel:"【快速查询】操作说明",emptyText:"快速查询项版块展示的提示文字.",name:"FUNCINFO_TREETIP"},{fieldLabel:"【列表】操作说明",emptyText:"英文说明.",name:"FUNCINFO_GRIDTIP_EN"},{fieldLabel:"【快速查询】操作说明",emptyText:"英文说明.",name:"FUNCINFO_TREETIP_NE"},{xtype:"yesnofield",fieldLabel:"【列表】多选",boxLabel:'<span style="color:#0000FF;">列表会出现多选框，用于批量选择</span>',name:"FUNCINFO_MULTISELECT"},{xtype:"yesnofield",fieldLabel:"【列表】拖动排序",boxLabel:'<span style="color:#0000FF;">列表分页将会去掉，数据可以进行拖动排序</span>',name:"FUNCINFO_DDORDER"},{xtype:"yesnofield",fieldLabel:"【列表】多条过滤",boxLabel:'<span style="color:#0000FF;">选择多条时，列表上的子功能会根据选中的多条数据进行过滤</span>',name:"FUNCINFO_CHILDFILTER"},{xtype:"yesnofield",fieldLabel:"【列表】隐藏工具条",name:"FUNCINFO_HIDEGRIDTBAR"},{xtype:"yesnofield",fieldLabel:"【列表】无限滚动",boxLabel:'<span style="color:#0000FF;">无限滚动时，将隐藏分页条</span>',name:"FUNCINFO_GRIDBUFFERED"},{xtype:"numberfield",fieldLabel:"【列表】数据请求超时",emptyText:"默认30秒",name:"FUNCINFO_GRIDTIMEOUT",allowDecimals:!1,hideTrigger:!0,minValue:0,unitTpl:"秒"},{xtype:"cgroup",fieldLabel:"【列表】隐藏元素",name:"FUNCINFO_GRIDHIDES",dataArray:[{text:"高级查询",code:"groupQuery"},{text:"查询策略",code:"cxcl"},{text:"列头查询",code:"columnQuery"},{text:"关键字查询",code:"keywordQuery"}]},{xtype:"yesnofield",fieldLabel:"【列表】简化查询",boxLabel:'<span style="color:#0000FF;">列表所有查询按钮简化为一个查询菜单</span>',name:"FUNCINFO_SIMPLESEARCH"},{xtype:"yesnofield",fieldLabel:"【列表】行综合展示模板",boxLabel:'<span style="color:#0000FF;">总是展开</span>',name:"FUNCINFO_GRIDROWTIPSHOW"},{xtype:"cgroup",fieldLabel:"【列表】隐藏表格线",name:"FUNCINFO_GRIDHIDELINES",dataArray:[{text:"竖线",code:"right"},{text:"横线",code:"bottom"}]},{xtype:"rgroup",fieldLabel:"【列表】分页信息位置",name:"FUNCINFO_PAGEINFOALIGN",value:"right",dataArray:[{text:"左",code:"left"},{text:"右",code:"right"},{text:"隐藏",code:"hidden"}]},{xtype:"textarea",fieldLabel:"【列表】行综合展示模板",columnWidth:.9,height:120,name:"FUNCINFO_GRIDROWTIP"},{xtype:"box",columnWidth:.9,padding:"5",margin:"3 3 3 "+(e.labelWidth+3),cls:"x-view-emtpytext",html:'行内信息展示方法编写说明：</br>@param {Ext.data.Model} record:当前行数据模型</br>@return 显示的html</br>@example ：</br>function(record){<br>&nbsp;&nbsp;&nbsp;&nbsp;var html = "JE" + record.get("COLUMN_NAME");</br>&nbsp;&nbsp;&nbsp;&nbsp;return html;</br>}</br>当然你可以把方法写到扩展JS类中在这直接调用即可.'},{xtype:"textarea",fieldLabel:"【列表】过滤条件",emptyText:" and ...",columnWidth:.9,name:"FUNCINFO_WHERESQL"},{xtype:"fieldset",title:"【列表】过滤条件描述",columnWidth:.9,layout:"fit",checkboxToggle:!0,margin:"0 0 0 "+(e.labelWidth+3),padding:"0 10 5 10",collapsed:!0,items:{xtype:"textarea",name:"FUNCINFO_WHERESQL_DES"}},{xtype:"box",columnWidth:.9,padding:"5",margin:"3 3 3 "+(e.labelWidth+3),cls:"x-view-emtpytext",html:"标准的SQL语句用于本功能数据过滤,切记该过滤条件为功能最基础条件其他一起附加条件全是依托本条件基础之上的.</br>例:如果你想筛选成年用户你可以这样写.</br> and user_age > 18 </br>例:如果你想筛选当前登录人录入的数据,你就要引用系统公有变量.</br> and create_usercode = {@USER_CODE@} </br>系统提供大量的公有变量,当前登录人编码{@USER_CODE@}、当前登录人名字{@USER_NAME@}等,如果用户信息不能满足,可以通过{@USER.userId@},{@USER.userCode@}这种形式来取当前用户的信息,USER是当前用户对象,具体信息可以查看api;其他的系统变量,用 {@系统变量名@} 取就可以了。"},{xtype:"textarea",columnWidth:.9,fieldLabel:"【列表】排序条件",emptyText:" order by ...",name:"FUNCINFO_ORDERSQL"},{xtype:"fieldset",title:"【列表】排序条件描述",columnWidth:.9,checkboxToggle:!0,layout:"fit",collapsed:!0,margin:"0 0 0 "+(e.labelWidth+3),padding:"0 10 5 10",items:{xtype:"textarea",name:"FUNCINFO_ORDERSQL_DES"}},{xtype:"box",columnWidth:.9,padding:"5",margin:"3 3 3 "+(e.labelWidth+3),cls:"x-view-emtpytext",html:"标准的SQL语句用于本功能的数据排序</br>例:你先按照时间倒序排序</br> order by SY_CREATETIME desc </br>注意:当数据量过大的时候要事先对排序字段创建索引"},{fieldLabel:"【表单】表单标题",name:"FUNCINFO_FORMTITLE4FUNC"},{xtype:"numberfield",fieldLabel:"【表单】表单列数",allowBlank:!1,name:"FUNCINFO_FORMCOLS",value:1,hideTrigger:!0},{xtype:"yesnofield",fieldLabel:"【表单】隐藏工具条",name:"FUNCINFO_HIDEFORMTBAR"},{xtype:"yesnofield",fieldLabel:"【表单】懒加载",boxLabel:'<span style="color:#0000FF;">当进入表单时才加载表单</span>',name:"FUNCINFO_FORMLAZY"},{xtype:"yesnofield",fieldLabel:"【表单】字段懒加载",boxLabel:'<span style="color:#0000FF;">启用轻量级隐藏组件</span>',name:"FUNCINFO_FIELDLAZY"},{xtype:"yesnofield",fieldLabel:"【表单】启用分页",name:"FUNCINFO_FORMPAGING"},{fieldLabel:"【表单】分页配置信息",emptyText:"{rownum}.{字段编码}~~width(列表宽度)",name:"FUNCINFO_FORMPAGINGCONFIG"},{xtype:"numberfield",fieldLabel:"【表单】字段宽度",name:"FUNCINFO_FORMDEFWIDTH",value:0,hideTrigger:!0},{xtype:"numberfield",fieldLabel:"【表单】label宽度",name:"FUNCINFO_FORMLABELWIDTH",hideTrigger:!0},{xtype:"numberfield",fieldLabel:"【表单】label英文宽度",name:"FUNCINFO_FORMLABELWIDTH_EN",hideTrigger:!0},{xtype:"colorfield",fieldLabel:"【表单】背景色",name:"FUNCINFO_FORMBGCOLOR"},{xtype:"numberfield",fieldLabel:"【表单】最小宽度",name:"FUNCINFO_FORMMINWIDTH",value:0,hideTrigger:!0},{xtype:"yesnofield",fieldLabel:"【表单】启用表格样式",boxLabel:'<span style="color:#0000FF;">科技灰皮肤专用</span>',name:"FUNCINFO_TABLESTYLE"},{xtype:"colorfield",fieldLabel:"【表单】字段边框色",name:"FUNCINFO_FIELDBORDERCOLOR"},{xtype:"colorfield",fieldLabel:"【表单】标签背景色",name:"FUNCINFO_LABELBGCOLOR"},{xtype:"textfield",fieldLabel:"【表单】弹出表单宽高",name:"FUNCINFO_WINFORMWH",unitTpl:"(宽高以逗号隔开)"},{xtype:"yesnofield",fieldLabel:"【表单】启用审批记录",name:"FUNCINFO_USEWFLOG"},{xtype:"textfield",fieldLabel:"【表单】表单宽度",minValue:0,name:"FUNCINFO_FORMWIDTH",unitTpl:"(支持%)"},{xtype:"rgroup",fieldLabel:"【表单】快速定位位置",name:"FUNCINFO_FORMNAVIGATE",dataArray:[{text:"表单左侧",code:"left"},{text:"表单顶部",code:"top"}]},{xtype:"hidden",name:"FUNCINFO_FORMJSLISTENER"},{xtype:"hidden",name:"FUNCINFO_GRIDJSLISTENER"}]},n={title:"其他",defaults:e,items:[{xtype:"jsonfield",columnWidth:.9,height:150,fieldLabel:"辅助配置",keyWidth:.5,valueWidth:.5,itemId:"helpConfig",name:"FUNCINFO_OTHERCONFIG",columns:[{text:"键",dataIndex:"key",flex:.5,field:{xtype:"cbbfield",editable:!0,buildQueryData:function(){var t=[],e=a.dataZY;Ext.each(e.func,function(e){t.push({code:e.key,text:e.key})}),this.store.loadData(t)},listeners:{change:function(){this.up("[xtype=jsonfield]").grid.getSelectionModel().getSelection()[0].set("value","")}}}},{text:"值",dataIndex:"value",flex:.5,field:{xtype:"cbbfield",editable:!0,buildQueryData:function(){var t=[],i=[],n=this.up("[xtype=jsonfield]").grid.getSelectionModel().getSelection()[0].get("key"),e=a.dataZY;Ext.each(e.func,function(e){JE.isNotEmpty(n)&&n==e.key&&(i=e.value.split(","))}),JE.isNotEmpty(i)&&Ext.each(i,function(e){t.push({code:e,text:e})}),this.store.loadData(t)}}}]},{xtype:"box",columnWidth:.9,padding:"5",margin:"3 3 3 "+(e.labelWidth+3),cls:"x-view-emtpytext",itemId:"otherHelpMsg",html:["<b>辅助配置说明：</b><br/>","quickQueryTitle:快速查询标题<br/>","formLabelColor:表单字段Label的颜色<br/>","rowColor:0(禁用列表隔行变色)/1(启用列表隔行变色)<br/>","treerefresh:1(启用)/0(禁用) 快速查询刷新</br>","gridQueryBtnHide:1 隐藏列头查询按钮</br>","columnCtrBtnHide:1 隐藏个性化列按钮"].join("")},{xtype:"textarea",columnWidth:.9,fieldLabel:"功能描述",name:"FUNCINFO_FUNCREMARK"},{xtype:"hidden",fieldLabel:"功能帮助",name:"FUNCINFO_HELP"},{xtype:"textarea",columnWidth:.9,hidden:!0,fieldLabel:"扩展panel",name:"FUNCINFO_EXPANDPANELS"}]};a.items=[t,i,n],a.tbar=[{ref:"save",text:"保存",formBind:!0,iconCls:"jeicon jeicon-save"},{xtype:"button",ref:"formJS",text:"表单js事件",iconCls:"jeicon jeicon-lightning-off"},{xtype:"button",ref:"gridJS",text:"列表js事件",iconCls:"jeicon jeicon-lightning-off"},{xtype:"button",ref:"extendPanel",text:"扩展面板",iconCls:"jeicon jeicon-layout"},{xtype:"button",ref:"upTag",text:"升级标记",iconCls:"jeicon jeicon-upgrade"},"->",{text:'<span style="text-decoration:underline;color:blue;" >功能基础配置项</span>',fsIndex:0,handler:a.locateFS},{text:'<span style="text-decoration:underline;color:blue;" >表单、列表配置项</span>',style:"color:blue;",fsIndex:1,handler:a.locateFS},{text:'<span style="text-decoration:underline;color:blue;" >功能描述</span>',style:"color:blue;",fsIndex:2,handler:a.locateFS}],a.callParent(arguments)},locateFS:function(e){var t=Ext.getCmp("funccfg.func"),i=t.body,n=t.items.get(e.fsIndex);i.scrollBy(0,n.getOffsetsTo(i)[1],!0),n.getEl().highlight()},setFormReadOnly:function(t,e,i,n){var a=Ext.getCmp("funccfg.func"),l=a.query("fieldset");Ext.each(l,function(e){e.setDisabled(t)});var o=a.down("toolbar");o.down("button[ref=save]").setVisible(!t),o.down("button[ref=staticizeBtn]").setDisabled(t),o.down("button[ref=staticizeDelBtn]").setDisabled(t),o.down("button[ref=formJS]").setDisabled(t),o.down("button[ref=gridJS]").setDisabled(t),o.down("button[ref=extendPanel]").setDisabled(t);var d=o.down("button[ref=developVersion]"),r=o.down("button[ref=itemVersion]");if("DEVELOP"==e){r.hide();var c=d.down("menuitem[ref=developCheckOut]"),s=d.down("menuitem[ref=developCheckIn]");n!=JE.currentUser.userId?"DEVELOPOUT"==i?JE.isNotEmpty(n)?(c.setDisabled(!0),s.setDisabled(!0)):(c.setDisabled(!0),s.setDisabled(!1)):(c.setDisabled(!1),s.setDisabled(!0)):"DEVELOPOUT"==i?(c.setDisabled(!0),s.setDisabled(!1)):(c.setDisabled(!1),s.setDisabled(!0))}else{d.hide();var E=r.query("menuitem");n!=JE.currentUser.userId?"ITEMOUT"==i?JE.isNotEmpty(n)?Ext.each(E,function(e){e.setDisabled(!0)}):Ext.each(E,function(e){"checkOut"==e.ref?e.setDisabled(!0):e.setDisabled(!1)}):Ext.each(E,function(e){"checkOut"==e.ref?e.setDisabled(!1):e.setDisabled(!0)}):"ITEMOUT"==i?Ext.each(E,function(e){"checkOut"==e.ref?e.setDisabled(!0):e.setDisabled(!1)}):Ext.each(E,function(e){"checkOut"==e.ref?e.setDisabled(!1):e.setDisabled(!0)})}var f=Ext.getCmp("funccfg.column");f&&f.setViewReadOnly(t);var u=Ext.getCmp("funccfg.field");u&&u.setViewReadOnly(t);var p=Ext.getCmp("funccfg.child");p&&p.setViewReadOnly(t);var m=Ext.getCmp("funccfg.button");m&&m.setViewReadOnly(t);var x=Ext.getCmp("funccfg.permview");x&&x.setViewReadOnly(t);var g=Ext.getCmp("funccfg.funchelp");g&&g.down("button[ref=formSaveBtn]").setDisabled(t);var C=Ext.getCmp("funccfg.funcrelyon");C&&C.setViewReadOnly(t)},loadAllFunc:function(i){this.loadFunc(i);Ext.each(["column","field","child","button","permview","funchelp","funcrelyon","listview"],function(e){var t=Ext.getCmp("funccfg."+e);t&&t.loadFunc(i)})},loadFunc:function(e){this.funcId=e;var t=JE.ajax({url:JE.getUrlMaps("je.core.getInfoById"),params:{tableCode:"JE_CORE_FUNCINFO",pkValue:e}});this.form.reset();t.FUNCINFO_FUNCCODE;Ext.isNumeric(t.FUNCINFO_CHILDHEIGHT)&&(t.FUNCINFO_CHILDHEIGHT='[{code:"default",value:'+t.FUNCINFO_CHILDHEIGHT+"}]"),t.FUNCINFO_SIMPLEBAR=JE.isNotEmpty(t.FUNCINFO_SIMPLEBAR)?t.FUNCINFO_SIMPLEBAR:"1",t.FUNCINFO_PAGEINFOALIGN=JE.isNotEmpty(t.FUNCINFO_PAGEINFOALIGN)?t.FUNCINFO_PAGEINFOALIGN:"left",this.form.setValues(t),this.oldValues=t}}),Ext.define("JE.sys.funccfg.view.Main",{extend:"Ext.tab.Panel",alias:"widget.funccfg.main",id:"funccfg.main",plain:!0,initComponent:function(){var a=this;a.defaults={border:0},a.items=[{xtype:"funccfg.func",title:"功能",iconCls:"jeicon jeicon-function-configuration"},{xtype:"funccfg.column",title:"列表",iconCls:"jeicon jeicon-grid-configuration"},{xtype:"funccfg.field",title:"表单",iconCls:"jeicon jeicon-form-configuration"},{xtype:"funccfg.button",title:"按钮",iconCls:"jeicon jeicon-button"},{xtype:"funccfg.child",title:"子功能",iconCls:"jeicon jeicon-subfunction-configuration"},{xtype:"funccfg.listview",title:"自定义表格",iconCls:"jeicon jeicon-atom"},{xtype:"funccfg.dataflow",title:"数据流转策略",iconCls:"jeicon jeicon-chart-data"},{xtype:"funccfg.testcase",title:"测试用例",hidden:!0,iconCls:"jeicon jeicon-resource-table-application"},{xtype:"funccfg.funcrelyon",title:"功能依赖",iconCls:"jeicon jeicon-associated"},{xtype:"funccfg.permview",title:"数据权限",iconCls:"jeicon jeicon-data-authorization",hidden:!0},{xtype:"funccfg.funchelp",title:"帮助",iconCls:"jeicon jeicon-question-circle"}],Ext.each(a.items,function(e){e.type=e.xtype,delete e.xtype}),a.defaults={xtype:"panel",layout:"fit",border:0,listeners:{activate:function(e){var t=e.type,i=e.getCmp(t);if(!i){var n=-1==["funccfg.column","funccfg.field","funccfg.child","funccfg.permview"].indexOf(t)?1:0;(i=e.add({xtype:t,itemId:t,border:n})).loadFunc&&a.funcId&&i.loadFunc(a.funcId)}}}},a.callParent(arguments)},loadFunc:function(i){this.funcId=i,this.setActiveTab(0),this.items.each(function(e){var t=e.getCmp(e.type);t&&t.loadFunc&&t.loadFunc(i)})}}),Ext.define("JE.sys.funccfg.view.SimpleFunc",{extend:"Ext.form.Panel",alias:"widget.funccfg.simplefunc",id:"funccfg.simplefunc",autoScroll:!0,bodyPadding:4,cls:"je-mainview-bg",hideEditColBtn:!1,initComponent:function(){var e=this;e.layout="anchor",e.defaults={anchor:"95%",xtype:"textfield",labelAlign:"right",margin:"0 0 2 0",labelWidth:85},e.dockedItems=[{xtype:"toolbar",dock:"top",itemId:"saveBar",items:[{text:"保存关闭",ref:"save",iconCls:"jeicon jeicon-save"}]}],e.items=[{xtype:"hidden",name:"JE_CORE_FUNCINFO_ID"},{fieldLabel:"功能编码",readOnly:!0,name:"FUNCINFO_FUNCCODE"},{fieldLabel:"功能名称",readOnly:!0,name:"FUNCINFO_FUNCNAME"},{fieldLabel:"表名",readOnly:!0,name:"FUNCINFO_TABLENAME"},{fieldLabel:"主键名称",readOnly:!0,name:"FUNCINFO_PKNAME"},{xtype:"yesnofield",fieldLabel:"数据按需加载",name:"FUNCINFO_COLUMNLAZY"},{xtype:"yesnofield",fieldLabel:"快查分步加载",name:"FUNCINFO_TREEREFRESH"},{xtype:"box",margin:"10 0 0 0",html:"【子功能】"},{xtype:"yesnofield",fieldLabel:"数据分步加载",name:"FUNCINFO_CHILDREFRESH"},{xtype:"cbbfield",fieldLabel:"显示方式",configInfo:"JE_CHILDREN_LAYOUT",name:"FUNCINFO_CHILDSHOWTYPE",dicItemCodes:"0,1,2,3,4",value:"0"},{xtype:"cbblistfield",fieldLabel:"子功能高度",name:"FUNCINFO_CHILDHEIGHT",typeConfig:{value:"default",editable:!1,width:90},valueConfig:{xtype:"numberfield",minValue:0},configInfo:"JE_CORE_RESOLUTION"},{xtype:"box",margin:"10 0 0 0",html:"【列表】"},{xtype:"yesnofield",fieldLabel:"多选",name:"FUNCINFO_MULTISELECT"},{xtype:"numberfield",fieldLabel:"每页展示条数",name:"FUNCINFO_PAGESIZE",allowBlank:!1,value:30,hideTrigger:!0},{xtype:"textarea",fieldLabel:"过滤条件",emptyText:" and ...",height:120,name:"FUNCINFO_WHERESQL"},{xtype:"textarea",fieldLabel:"排序条件",height:120,emptyText:" order by ...",name:"FUNCINFO_ORDERSQL"},{xtype:"box",margin:"10 0 0 0",html:"【表单】"},{xtype:"yesnofield",fieldLabel:"懒加载",name:"FUNCINFO_FORMLAZY"},{xtype:"hidden",fieldLabel:"是否对比",name:"FUNCINFO_SFXDB"}],e.callParent(arguments)},loadFunc:function(e,t){this.funcId=e;var i=JE.ajax({url:JE.getUrlMaps("je.core.getInfoById"),params:{tableCode:"JE_CORE_FUNCINFO",pkValue:e}});this.form.reset(),Ext.isNumeric(i.FUNCINFO_CHILDHEIGHT)&&(i.FUNCINFO_CHILDHEIGHT='[{code:"default",value:"'+i.FUNCINFO_CHILDHEIGHT+'"}]'),this.oldValues=i,this.form.setValues(i)}}),Ext.define("JE.sys.funccfg.view.button.Button",{extend:"Ext.grid.Panel",alias:"widget.funccfg.button",id:"funccfg.button",mixins:["JE.sys.funccfg.view.jseditor.Util"],selModel:{selType:"checkboxmodel"},columnLines:!0,multiSelect:!0,enableKeyNav:!0,frame:!1,border:0,cls:"je-buttonFunc-config",initComponent:function(){var a=this;Ext.apply(a,{tbar:[{xtype:"button",ref:"insert",text:"添加",iconCls:"jeicon jeicon-new-form"},{xtype:"button",ref:"listupdate",text:"保存",iconCls:"jeicon jeicon-form-editing"},{xtype:"button",ref:"remove",text:"删除",iconCls:"jeicon jeicon-delete-form"},"->",{xtype:"uxtrigger",width:200,ref:"querytext"}],columns:[{text:"序号",dataIndex:"SY_ORDERINDEX",width:40,align:"center"},{text:"编码",dataIndex:"RESOURCEBUTTON_CODE",width:110,field:{xtype:"textfield",selectOnFocus:!0,allowBlank:!1}},{text:"名称",dataIndex:"RESOURCEBUTTON_NAME",width:110,field:{xtype:"textfield",selectOnFocus:!0,allowBlank:!1}},{text:"英文名称",dataIndex:"RESOURCEBUTTON_NAME_EN",width:110,field:{xtype:"textfield",selectOnFocus:!0}},{text:"类型",dataIndex:"RESOURCEBUTTON_TYPE",width:80,field:{xtype:"cbbfield",configInfo:"JE_FUNC_BUTTONTYPE"},tactics:[{type:"dic",dicCode:"JE_FUNC_BUTTONTYPE"}],renderer:JE.renderer},{text:"事件",xtype:"actioncolumn",width:40,align:"center",items:[{tooltip:"编辑",handler:function(e,t,i,n,a,l){var o=e.panel;o.showJSEditor({parent:o,record:l,fieldName:"RESOURCEBUTTON_JSLISTENER",type:"ACTION"==l.get("RESOURCEBUTTON_TYPE")?"actioncolumn":"button"})},getClass:function(e,t,i){return this.ownerCt.grid.isFireListener(i.get("RESOURCEBUTTON_JSLISTENER"))?"jeicon jeicon-lightning-on":"jeicon jeicon-lightning-off"}}]},{text:"隐藏",dataIndex:"RESOURCEBUTTON_HIDDEN",width:50,xtype:"uxcheckcolumn"},{text:"禁用",dataIndex:"RESOURCEBUTTON_DISABLED",width:50,xtype:"uxcheckcolumn"},{text:"授权",xtype:"actioncolumn",width:40,align:"center",items:[{iconCls:"jeicon jeicon-workflow-activation",tooltip:"授权给开发人员",handler:function(e,t,i,n,a,l){var o=e.panel.funcId,d=l.get("JE_CORE_RESOURCEBUTTON_ID");JE.ajax({url:JE.getUrlMaps("je.core.rbac.perm","doButtonPerm"),params:{pkValue:d,funcId:o}}).success?JE.msg("授权成功"):JE.alert("失败，请联系管理员!")}}]},{text:"样式",hidden:!0,dataIndex:"RESOURCEBUTTON_ICONCLS",width:130,field:{xtype:"gridssfield",selectOnFocus:!0,editable:!0,configInfo:"JE_CORE_FONTICON,RESOURCEBUTTON_ICONCLS,FONTICON_CLS,S,"}},{text:"大按钮样式",hidden:!0,dataIndex:"RESOURCEBUTTON_BIGICONCLS",width:130,field:{xtype:"gridssfield",selectOnFocus:!0,editable:!0,configInfo:"JE_CORE_FONTICON,RESOURCEBUTTON_BIGICONCLS,FONTICON_CLS,S,"}},{text:"字体图标",dataIndex:"RESOURCEBUTTON_FONTICONCLS",width:130,field:{xtype:"gridssfield",editable:!0,configInfo:"JE_CORE_FONTICON,RESOURCEBUTTON_FONTICONCLS,FONTICON_CLS,S,"}},{text:"样式",dataIndex:"RESOURCEBUTTON_CLS",width:130,field:{xtype:"uxtrigger",editable:!0,trigger2Cls:"x-form-color-trigger",handler:function(t){t.menu||(t.menu=Ext.create("Ext.menu.Menu",{width:600,height:300,plain:!0,layout:"fit",items:{xtype:"panel",layout:"column",cls:"je-button-bar",border:0,defaults:{xtype:"button",columnWidth:.25,margin:10,handler:function(e){a.getSelectionModel().getSelection()[0].set("RESOURCEBUTTON_CLS",e.getText()),t.menu.hide()}},items:[{text:"JEPLUS_B_H01",cls:"JEPLUS_B_H01"},{text:"JEPLUS_B_H02",cls:"JEPLUS_B_H02"},{xtype:"box",columnWidth:1,margin:0},{text:"JEPLUS_B_C01",cls:"JEPLUS_B_C01"},{text:"JEPLUS_B_C02",cls:"JEPLUS_B_C02"},{text:"JEPLUS_B_C03",cls:"JEPLUS_B_C03"},{text:"JEPLUS_B_C04",cls:"JEPLUS_B_C04"},{text:"JEPLUS_B_C05",cls:"JEPLUS_B_C05"},{text:"JEPLUS_B_C06",cls:"JEPLUS_B_C06"},{text:"JEPLUS_B_C07",cls:"JEPLUS_B_C07"},{text:"JEPLUS_B_C08",cls:"JEPLUS_B_C08"},{xtype:"box",columnWidth:1,margin:0},{text:"JEPLUS_B_L01",cls:"JEPLUS_B_L01"},{text:"JEPLUS_B_L02",cls:"JEPLUS_B_L02"},{text:"JEPLUS_B_L03",cls:"JEPLUS_B_L03"},{text:"JEPLUS_B_L04",cls:"JEPLUS_B_L04"},{text:"JEPLUS_B_L05",cls:"JEPLUS_B_L05"},{text:"JEPLUS_B_L06",cls:"JEPLUS_B_L06"},{text:"JEPLUS_B_L07",cls:"JEPLUS_B_L07"},{text:"JEPLUS_B_L08",cls:"JEPLUS_B_L08"},{text:"JEPLUS_B_L09",cls:"JEPLUS_B_L09"},{text:"JEPLUS_B_L10",cls:"JEPLUS_B_L10"}]}})),t.menu.showBy(t,"tr-br")}}},{text:"图标颜色",dataIndex:"RESOURCEBUTTON_FONTICONCOLOR",width:130,field:{editable:!0,xtype:"colorfield"}},{text:"简洁按钮条位置",dataIndex:"RESOURCEBUTTON_POSITION",width:150,field:{xtype:"cbbfield",multiSelect:!0,dataArray:[{code:"BAR",text:"按钮条"},{code:"MORE",text:"更多按钮"},{code:"MULTI",text:"多选按钮条"}]},renderer:function(e){var t={BAR:"按钮条",MORE:"更多按钮",MULTI:"多选按钮条"},i=[];return Ext.each(JE.split(e,","),function(e){i.push(t[e])}),i.join(",")}},{text:"依附按钮",dataIndex:"RESOURCEBUTTON_YFAN",width:130,field:{xtype:"textfield"}},{text:"不受控",dataIndex:"RESOURCEBUTTON_NOREADONLY",width:60,xtype:"uxcheckcolumn",tooltip:"不受功能和工作流只读控制"},{text:"显隐表达式",dataIndex:"RESOURCEBUTTON_INTERPRETER",width:200,field:{xtype:"uxtrigger",handler:function(e){var t=a.getSelectionModel().getSelection()[0];Ext.create("JE.sys.funccfg.view.other.VisibleCfgView",{autoShow:!0,funcId:a.funcId,initValue:{exp:t.get("RESOURCEBUTTON_INTERPRETER"),noReadOnly:t.get("RESOURCEBUTTON_NOREADONLY")},fn:function(e){t.set("RESOURCEBUTTON_NOREADONLY",e.noReadOnly),t.set("RESOURCEBUTTON_INTERPRETER",e.exp)}})}}},{text:"提示信息",dataIndex:"RESOURCEBUTTON_MSG",width:150,field:{xtype:"textfield",selectOnFocus:!0}},{text:"绑定表单",dataIndex:"RESOURCEBUTTON_FORMBIND",width:80,xtype:"uxcheckcolumn"}],info:{pkName:"JE_CORE_RESOURCEBUTTON_ID",tableName:"JE_CORE_RESOURCEBUTTON"}}),a.store=JE.getStore({tableName:"JE_CORE_RESOURCEBUTTON",id:"RESOURCEBUTTON_CODE",url:JE.getUrlMaps("je.core.develop.funcInfo","loadFunc")}),a.viewConfig={listeners:{drop:function(e,t,i,n){JE.Action.doDrop(a,a.info)}},plugins:{ptype:"gridviewdragdrop",dragText:"拖动排序",pluginId:"ddOrder"}},a.plugins=[Ext.create("Ext.grid.plugin.CellEditing",{clicksToEdit:1,pluginId:"cellEdit"})],a.callParent(arguments)},setViewReadOnly:function(t){var e=this.down("toolbar[dock=top]");if(e){var i=e.query("button");Ext.each(i,function(e){e.setDisabled(t)}),this.viewReadOnly=t}},loadFunc:function(e){var t=this,i=" and RESOURCEBUTTON_FUNCINFO_ID = '"+(t.funcId=e)+"'";t.store.proxy.extraParams.baseSql=i,t.store.proxy.extraParams.funcId=e,t.store.proxy.extraParams.tableCode="JE_CORE_RESOURCEBUTTON",t.store.proxy.extraParams.whereSql=i,t.getStore().proxy.extraParams.orderSql=" order by SY_ORDERINDEX ASC ",t.store.load()}}),Ext.define("JE.sys.funccfg.view.child.Child",{extend:"Ext.panel.Panel",alias:"widget.funccfg.child",id:"funccfg.child",layout:"border",initComponent:function(){this.items=[{xtype:"funccfg.childgrid",region:"center",border:1},{xtype:"funccfg.childfieldgrid",region:"south",split:!0,height:300,border:1}],this.callParent(arguments)},setViewReadOnly:function(t){var e=this.down("panel[xtype=funccfg.childgrid]");if(e){var i=e.query("button");Ext.each(i,function(e){e.setDisabled(t)}),e.viewReadOnly=t}var n=this.down("panel[xtype=funccfg.childfieldgrid]");if(n){i=n.query("button");Ext.each(i,function(e){e.setDisabled(t)}),n.viewReadOnly=t}},loadFunc:function(e){var t=Ext.getCmp("funccfg.childgrid");t.funcId=e;var i=Ext.getCmp("funccfg.childfieldgrid"),n=" and FUNCRELATION_FUNCINFO_ID = '"+e+"'";t.getStore().proxy.extraParams.baseSql=n,t.getStore().proxy.extraParams.funcId=e,t.getStore().proxy.extraParams.tableCode="JE_CORE_FUNCRELATION",t.getStore().proxy.extraParams.whereSql=n,t.getStore().proxy.extraParams.orderSql=" order by SY_ORDERINDEX ASC ",t.getStore().load(),i.getStore().proxy.extraParams.orderSql=" order by SY_ORDERINDEX ASC ",i.getStore().proxy.extraParams.funcId=e,i.getStore().proxy.extraParams.whereSql=" AND 1!=1 ",i.getStore().proxy.extraParams.tableCode="JE_CORE_ASSOCIATIONFIELD",i.getStore().removeAll()}}),Ext.define("JE.sys.funccfg.view.child.ChildFieldGrid",{extend:"Ext.grid.Panel",border:0,alias:"widget.funccfg.childfieldgrid",id:"funccfg.childfieldgrid",tbar:[{xtype:"button",ref:"insert",text:"添加",iconCls:"jeicon jeicon-new-form"},{xtype:"button",ref:"listupdate",text:"保存",iconCls:"jeicon jeicon-form-editing"},{xtype:"button",ref:"remove",text:"删除",iconCls:"jeicon jeicon-delete-form"}],selModel:{selType:"checkboxmodel"},multiSelect:!0,enableKeyNav:!0,columnLines:!0,frame:!1,columns:[{text:"字段名称",dataIndex:"ASSOCIATIONFIELD_PRIFIELDNAME",width:150,field:{xtype:"gridssfield",editable:!0,configInfo:"JE_CORE_RESOURCECOLUMN,ASSOCIATIONFIELD_PRIFIELDNAME~ASSOCIATIONFIELD_PRIFIELDCODE,RESOURCECOLUMN_NAME~RESOURCECOLUMN_CODE,S,",whereSql:" and RESOURCECOLUMN_FUNCINFO_ID='{ASSOCIATIONFIELD_FID}'"}},{text:"字段编码",dataIndex:"ASSOCIATIONFIELD_PRIFIELDCODE",width:150,field:{xtype:"textfield"}},{text:"(子功能)字段名称",dataIndex:"ASSOCIATIONFIELD_CHIFIELDNAME",width:150,field:{xtype:"gridssfield",editable:!0,configInfo:"JE_CORE_RESOURCECOLUMN,ASSOCIATIONFIELD_CHIFIELDNAME~ASSOCIATIONFIELD_CHIFIELDCODE,RESOURCECOLUMN_NAME~RESOURCECOLUMN_CODE,S,",whereSql:" and RESOURCECOLUMN_FUNCINFO_ID='{ASSOCIATIONFIELD_PID}'"}},{text:"(子功能)字段编码",dataIndex:"ASSOCIATIONFIELD_CHIFIELDCODE",width:150,field:{xtype:"textfield"}},{text:"自定义sql",dataIndex:"ASSOCIATIONFIELD_SQL",width:150,field:{xtype:"textfield"}},{text:"传值",dataIndex:"ASSOCIATIONFIELD_TRANSMIT",width:80,xtype:"uxcheckcolumn"},{text:"where条件",dataIndex:"ASSOCIATIONFIELD_WHERECON",width:80,xtype:"uxcheckcolumn"},{text:"关联关系",dataIndex:"ASSOCIATIONFIELD_ASSOCIATION",width:80,tactics:[{bgCss:!0,type:"dic",dicCode:"JE_ASSOCIATION"}],renderer:JE.renderer,field:{xtype:"cbbfield",configInfo:"JE_ASSOCIATION",value:"no"}},{text:"级联更新(一对一卡片时起效)",dataIndex:"ASSOCIATIONFIELD_CASCADEUPDATE",width:180,xtype:"uxcheckcolumn"},{text:"级联删除(非主外键关联起效)",dataIndex:"ASSOCIATIONFIELD_DELCHILD",width:180,xtype:"uxcheckcolumn"}],initComponent:function(){this.store=JE.getStore({tableName:"JE_CORE_ASSOCIATIONFIELD",url:JE.getUrlMaps("je.core.develop.funcInfo","loadFunc")}),this.plugins=[Ext.create("Ext.grid.plugin.CellEditing",{clicksToEdit:1,pluginId:"cellEdit"})],this.callParent(arguments)}}),Ext.define("JE.sys.funccfg.view.child.ChildGrid",{extend:"Ext.grid.Panel",alias:"widget.funccfg.childgrid",id:"funccfg.childgrid",border:0,cls:"je-childgridFunc-config",tbar:[{xtype:"button",ref:"impl",text:"导入",iconCls:"jeicon jeicon-import"},{xtype:"splitbutton",ref:"insert",text:"添加",iconCls:"jeicon jeicon-new-form",menu:{items:[{ref:"idit",text:"自定义",iconCls:"jeicon jeicon-new-form"}]}},{xtype:"button",ref:"listupdate",text:"保存",iconCls:"jeicon jeicon-form-save"},{xtype:"button",ref:"remove",text:"删除",iconCls:"jeicon jeicon-delete-form"},{xtype:"button",ref:"seeFunc",text:"查看功能配置",iconCls:"jeicon jeicon-set-up"},{xtype:"button",ref:"help",text:"帮助",iconCls:"jeicon jeicon-question-circle",handler:function(){JE.win({title:"子功能帮助信息",html:"<h3>子功能配置（除1类功能外，其余功能自己写功能名称，编码（唯一））</h3>1.\t普通功能，树形功能，首页portal</br> 直接选择功能就可以</br> 字段关联：根据提示选择，首页portal不需要配置</br>2.\t自定义功能</br> 配置主面板，js控制器。自定义功能的主面板要有load函数，否则，不会刷新功能。</br> 字段关联：主功能字段，参数名（子功能字段），通过配置的参数可以在load方法里获得主功能传过来的数据</br>3.\t统计表，报表，工业图</br> 配置项为型图的编码。</br> 字段关联：主功能字段，参数名（子功能字段），通过配置的参数可以传递给图表中参数值</br>4.\t甘特图</br> 字段关联：主键~开始时间~结束时间（主功能），modelId~startDate~endDate（甘特图）</br>5.\t附件：</br> 配置 附件字典编码，主要用于文件分类，可作为目录</br> 字段关联：主功能字段  主键（主功能），FILE_FOREIGN_ID（附件功能）",width:660,height:380,iconCls:"jeicon jeicon-question-circle",bodyStyle:"padding:10px;line-height:20px;background-color:#ffffff;",autoShow:!0})}},"->",{xtype:"uxtrigger",width:200,ref:"querytext"}],selModel:{selType:"checkboxmodel"},columnLines:!0,frame:!1,multiSelect:!0,enableKeyNav:!0,initComponent:function(){var a=this;a.columns=[{text:"名称",dataIndex:"FUNCRELATION_NAME",width:160,field:{xtype:"gridssfield",configInfo:"JE_CORE_FUNCINFO,FUNCRELATION_NAME~FUNCRELATION_NAME_EN~FUNCRELATION_CODE~FUNCRELATION_FUNCID~FUNCRELATION_TABLENAME~FUNCRELATION_FUNCICONCLS,FUNCINFO_FUNCNAME~FUNCINFO_FUNCNAME_EN~FUNCINFO_FUNCCODE~JE_CORE_FUNCINFO_ID~FUNCINFO_TABLENAME~FUNCINFO_ICONCLS,S,",whereSql:" AND SY_JESYS='1'",selectOnFocus:!0,editable:!0,allowBlank:!1,listeners:{beforequery:function(e){var t=a.getSelectionModel().getSelection()[0];t&&("portal"==t.get("SY_STATUS")?(e.configInfo="JE_CORE_PROTAL,FUNCRELATION_TABLENAME~FUNCRELATION_NAME~FUNCRELATION_FUNCICONCLS~FUNCRELATION_NAME_EN,JE_CORE_PROTAL_ID~PROTAL_BT~PROTAL_CLS~PROTAL_BT_EN,S,",e.whereSql=" and PROTAL_JHFS_CODE = 'func' and PROTAL_QY_CODE = '1' "):(e.configInfo="JE_CORE_FUNCINFO,FUNCRELATION_NAME~FUNCRELATION_NAME_EN~FUNCRELATION_CODE~FUNCRELATION_FUNCID~FUNCRELATION_TABLENAME~FUNCRELATION_FUNCICONCLS,FUNCINFO_FUNCNAME~FUNCINFO_FUNCNAME_EN~FUNCINFO_FUNCCODE~JE_CORE_FUNCINFO_ID~FUNCINFO_TABLENAME~FUNCINFO_ICONCLS,S,",e.whereSql=" AND SY_JESYS='1'"))}}}},{text:"英文名称",dataIndex:"FUNCRELATION_NAME_EN",width:160,field:{xtype:"textfield",selectOnFocus:!0}},{text:"编码",dataIndex:"FUNCRELATION_CODE",width:160,field:{xtype:"textfield",selectOnFocus:!0,allowBlank:!1,regex:"^[A-Z]{1}[A-Z_0-9]{1,29}$",regexText:"子功能编码由大写字母、下划线组成!"}},{text:"授权",xtype:"actioncolumn",width:40,align:"center",items:[{iconCls:"jeicon jeicon-workflow-activation",tooltip:"授权给开发人员",handler:function(e,t,i,n,a,l){var o=e.panel.funcId,d=l.get("JE_CORE_FUNCRELATION_ID");JE.ajax({url:JE.getUrlMaps("je.core.rbac.perm","doFuncchildPerm"),params:{pkValue:d,funcId:o}}).success?JE.msg("授权成功"):JE.alert("失败，请联系管理员!")}}]},{text:"顺序",dataIndex:"SY_ORDERINDEX",width:50,field:{xtype:"numberfield",selectOnFocus:!0,allowBlank:!1}},{text:"标题图标",dataIndex:"FUNCRELATION_FUNCICONCLS",width:100,align:"center",field:{xtype:"gridssfield",editable:!0,configInfo:"JE_CORE_FONTICON,FUNCRELATION_FUNCICONCLS,FONTICON_CLS,S",selectOnFocus:!0},renderer:function(e,t){return Ext.isEmpty(e)||(e=JE.getIconTpl(e)),e}},{text:"启用",dataIndex:"FUNCRELATION_ENABLED",width:50,xtype:"uxcheckcolumn"},{text:"显示标题(纵向展示)",dataIndex:"FUNCRELATION_SHOWTITLE",width:120,xtype:"uxcheckcolumn"},{text:"类型",dataIndex:"SY_STATUS",width:100,field:{xtype:"cbbfield",configInfo:"JE_CORE_FUNCTYPE",value:"func",dicItemCodes:"func,tree,idit,chart,report,industry,file,gantt,portal,childfuncfield,history",selectOnFocus:!0},renderer:function(e,t,i){var n="";return"gantt"==e?n="关联字段包括：startDate,endDate,modelId":-1!=["chart","report","industry"].indexOf(e)?n="配置项：规划信息的编码":"portal"==e&&(n="请从名称选择portal信息"),t.tdAttr=' title="'+n+'" ',JE.toDicText("JE_CORE_FUNCTYPE",e)}},{text:"表名|主面板|配置项|附件字典编码",dataIndex:"FUNCRELATION_TABLENAME",width:200,field:{xtype:"textfield",selectOnFocus:!0}},{text:"js控制器",dataIndex:"FUNCRELATION_ENTITYNAME",width:200,field:{xtype:"textfield",selectOnFocus:!0}},{text:"级联复制",xtype:"uxcheckcolumn",dataIndex:"FUNCRELATION_COPY",width:60},{text:"定位(表单有效)",xtype:"uxcheckcolumn",dataIndex:"FUNCRELATION_LOCATE",width:60},{text:"显示方式",dataIndex:"FUNCRELATION_SHOWTYPE",width:150,field:{xtype:"cbbfield",configInfo:"JE_CHILDREN_LAYOUT",selectOnFocus:!0},tactics:[{type:"dic",dicCode:"JE_CHILDREN_LAYOUT"}],renderer:JE.renderer},{text:"高度",dataIndex:"FUNCRELATION_HEIGHT",width:80,field:{xtype:"numberfield"}},{text:"依赖类型",dataIndex:"FUNCRELATION_RELYONTYPE",width:80,hidden:!0},{text:"显隐控制表达式",dataIndex:"FUNCRELATION_INTERPRETER",width:250,field:{xtype:"uxtrigger",handler:function(e){var t=a.getSelectionModel().getSelection()[0];Ext.create("JE.sys.funccfg.view.other.VisibleCfgView",{autoShow:!0,funcId:a.funcId,initValue:{exp:t.get("FUNCRELATION_INTERPRETER")},fn:function(e){t.set("FUNCRELATION_INTERPRETER",e.exp)}})}}}],a.viewConfig={listeners:{drop:function(e,t,i,n){JE.Action.doDrop(a)}},plugins:{ptype:"gridviewdragdrop",dragText:"拖动排序",pluginId:"ddOrder"}},a.store=JE.getStore({tableName:"JE_CORE_FUNCRELATION",url:JE.getUrlMaps("je.core.develop.funcInfo","loadFunc")}),a.plugins=[Ext.create("Ext.grid.plugin.CellEditing",{clicksToEdit:1,pluginId:"cellEdit"})],a.callParent(arguments)}}),Ext.define("JE.sys.funccfg.view.column.AddFieldForm",{extend:"Ext.form.Panel",alias:"widget.funccfg.addfieldform",id:"funccfg.addfieldform",mixins:["JE.util.PinYinUtil"],layout:"column",border:0,autoScroll:!0,frame:!1,bodyStyle:{background:"rgb(241, 241, 241)"},defaults:{labelAlign:"right",xtype:"textfield",columnWidth:.9,margin:"5 0 4 0",padding:"1 0 1 0"},buttons:[{text:"确定",formBind:!0,iconCls:"jeicon jeicon-check",handler:function(e){var t=e.up("window");t.fn?0!=t.fn(t)&&t.close():t.close()}},{text:"取消",iconCls:"jeicon jeicon-error",handler:function(e){e.up("window").close()}}],buttonAlign:"center",initComponent:function(){var o=this;o.items=[{name:"JE_CORE_TABLECOLUMN_ID",fieldLabel:"主键ID",hidden:!0},{name:"TABLECOLUMN_RESOURCETABLE_ID",fieldLabel:"外键",hidden:!0},{name:"TABLECOLUMN_NAME",fieldLabel:"名称",allowBlank:!1,listeners:{change:function(e,t,i){if(!Ext.isEmpty(t)){var n="";if(-1!=o.tableCode.indexOf("_")){var a=o.tableCode.lastIndexOf("_");n=o.tableCode.substring(a+1,o.tableCode.length)+"_"}var l=n+o.toPinYin(t,"PY");e.up("form[xtype=funccfg.addfieldform]").form.findField("TABLECOLUMN_CODE").setValue(l)}}}},{name:"TABLECOLUMN_CODE",fieldLabel:"编码",allowBlank:!1},{xtype:"cbbfield",configInfo:"JE_FIELDTYPE",name:"TABLECOLUMN_TYPE",fieldLabel:"类型"},{name:"TABLECOLUMN_LENGTH",fieldLabel:"长度/自定义"},{xtype:"yesnofield",name:"TABLECOLUMN_ISNULL",columnWidth:.45,fieldLabel:"允许为空"},{xtype:"yesnofield",name:"TABLECOLUMN_UNIQUE",columnWidth:.45,fieldLabel:"唯一"},{xtype:"cbbfield",configInfo:"JE_CLASSIFY",name:"TABLECOLUMN_CLASSIFY",columnWidth:.45,fieldLabel:"分类",readOnly:!0},{name:"SY_ORDERINDEX",xtype:"numberfield",columnWidth:.45,fieldLabel:"排序"},{name:"TABLECOLUMN_TABLECODE",fieldLabel:"表名",hidden:!0},{xtype:"cbbfield",configInfo:"JE_TREETYPE",name:"TABLECOLUMN_TREETYPE",fieldLabel:"树形类型",readOnly:!0},{name:"TABLECOLUMN_ISCREATE",fieldLabel:"是否已创建",hidden:!0}],o.callParent(arguments)}}),Ext.define("JE.sys.funccfg.view.column.Column",{extend:"Ext.panel.Panel",alias:"widget.funccfg.column",id:"funccfg.column",layout:"border",initComponent:function(){this.items=[{xtype:"panel",region:"north",split:!0,height:60,layout:"card",border:0,itemId:"columncols",padding:4,defaults:{xtype:"funccfg.columncols",bodyStyle:"background-color:#FEFECE;"},items:[{lang:"zh_CN",itemId:"zhCols"},{lang:"en",itemId:"enCols"}]},{xtype:"funccfg.columngrid",region:"center"},{xtype:"funccfg.columnform",width:300,title:"详细信息",split:!0,collapsible:!0,collapsed:!0,region:"east"}],this.callParent(arguments)},setViewReadOnly:function(t){var e=this.down("panel[xtype=funccfg.columngrid]");if(e){var i=e.query("button");Ext.each(i,function(e){e.setDisabled(t)}),e.viewReadOnly=t}},loadFunc:function(e,t){this.funcId=e;var i=Ext.getCmp("funccfg.columnform"),n=Ext.getCmp("funccfg.columngrid");i.getForm().reset(),i.collapse(),i.funcId=e,i.getDockedComponent("saveBar").hide();var a=" and  RESOURCECOLUMN_FUNCINFO_ID = '"+e+"'";n.getStore().proxy.extraParams.baseSql=a,n.getStore().proxy.extraParams.whereSql=a,n.getStore().proxy.extraParams.tableCode="JE_CORE_RESOURCECOLUMN",n.getStore().proxy.extraParams.orderSql=" order by SY_ORDERINDEX ASC ",n.getStore().proxy.extraParams.funcId=e,n.getStore().load({callback:function(){if(!Ext.isEmpty(t)){var e=n.getStore().findRecord("RESOURCECOLUMN_CODE",t);e&&(n.getSelectionModel().select(e),n.fireEvent("itemdblclick",n.view,e))}}}),n.funcId=e}}),Ext.define("JE.sys.funccfg.view.column.ColumnCols",{extend:"Ext.grid.Panel",alias:"widget.funccfg.columncols",frame:!1,border:1,columns:[],cls:"je-field-grid",initComponent:function(){var a=this;a.listeners={columnresize:function(e,t,i){var n="RESOURCECOLUMN_WIDTH";"en"==a.lang&&(n+="_EN"),a.updateRec(n,t.dataIndex,i)}},"en"!=a.lang&&Ext.apply(a.listeners,{columnhide:function(e,t){a.updateRec("RESOURCECOLUMN_HIDDEN",t.dataIndex,"1")},columnshow:function(e,t){a.updateRec("RESOURCECOLUMN_HIDDEN",t.dataIndex,"0")},columnmove:function(e,t,i,n){e.items.each(function(e,t){a.updateRec("SY_ORDERINDEX",e.dataIndex,t+1)})}}),a.callParent(arguments)},loadCols:function(e){var t=this.dgColumns(e);this.headerCt.removeAll(),this.headerCt.add(t),this.view.refresh()},dgColumns:function(a,l){var o=this,d=[],r="en"==o.lang?"_EN":"";return Ext.each(a,function(e){var t=e.data.RESOURCECOLUMN_XTYPE,i={dataIndex:e.data.RESOURCECOLUMN_CODE,text:e.data["RESOURCECOLUMN_NAME"+r],hidden:JE.toBool(e.data.RESOURCECOLUMN_HIDDEN),width:JE.toNum(e.data["RESOURCECOLUMN_WIDTH"+r]||e.data.RESOURCECOLUMN_WIDTH),moreColumnName:e.data.RESOURCECOLUMN_MORECOLUMNNAME,sortable:!1};if("en"==o.lang&&Ext.apply(i,{draggable:!1,menuDisabled:!0}),Ext.value(l,"")==Ext.value(i.moreColumnName,"")){if("morecolumn"==t){var n=o.dgColumns(a,i.dataIndex);i.columns=n}d.push(i)}}),d},updateRec:function(e,t,i){var n=Ext.getCmp("funccfg.columngrid").store.getById(t);n&&n.set(e,i)}}),Ext.define("JE.sys.funccfg.view.column.ColumnForm",{extend:"Ext.form.Panel",alias:"widget.funccfg.columnform",id:"funccfg.columnform",autoScroll:!0,bodyPadding:4,cls:"je-mainview-bg",defaults:{},initComponent:function(){var a=this;a.dataZY={grid:[{key:"queryLabel",value:""},{key:"queryLabelWidth",value:""},{key:"queryType",value:""},{key:"queryTypes",value:""},{key:"queryTypeHidden",value:"1,0"},{key:"querySortDisabled",value:"1,0"},{key:"flex",value:"1,0"},{key:"keyword",value:"1,0"},{key:"headerAlign",value:"left,center,right"},{key:"float",value:"1,0"}]},a.layout="anchor",a.defaults=Ext.applyIf(a.defaults,{anchor:"95%",labelAlign:"right",margin:"0 0 2 0",labelWidth:85}),a.dockedItems=[{xtype:"toolbar",dock:"top",itemId:"saveBar",items:[{text:"事件",ref:"jslistener",iconCls:"jeicon jeicon-lightning-off"},"->",{text:"保存",ref:"save",iconCls:"jeicon jeicon-save"}]}],a.items=[{xtype:"textfield",fieldLabel:"编码",readOnly:!0,name:"RESOURCECOLUMN_CODE"},{xtype:"textfield",fieldLabel:"名称",allowBlank:!1,name:"RESOURCECOLUMN_NAME"},{xtype:"textfield",fieldLabel:"英文名称",name:"RESOURCECOLUMN_NAME_EN"},{xtype:"cbbfield",fieldLabel:"类型",configInfo:"JE_FUNC_COLUMNXTYPE",name:"RESOURCECOLUMN_XTYPE"},{xtype:"numberfield",fieldLabel:"高级查询排序",name:"RESOURCECOLUMN_QUERYINDEX"},{xtype:"multiitem",idProperty:"",editable:!1,displayTpl:"<b>{text}</b>",fieldLabel:"统计类型",configInfo:"JE_CORE_STATISTICS",name:"RESOURCECOLUMN_STATISTICSTYPE"},{xtype:"multiitem",idProperty:"",displayTpl:"<b>{text}</b>",fieldLabel:"统计描述",name:"RESOURCECOLUMN_STATISTICSMSG"},{xtype:"multiitem",idProperty:"",displayTpl:"<b>{text}</b>",fieldLabel:"总统计描述",name:"RESOURCECOLUMN_STATISTALLMSG"},{xtype:"multiitem",idProperty:"",fieldLabel:"统计数字格式",displayTpl:"<b>{text}</b>",name:"RESOURCECOLUMN_SUMMARYFORMAT",emptyText:"0,000.00展示效果为1,234.56"},{xtype:"cgroup",fieldLabel:"字典颜色",name:"RESOURCECOLUMN_COLOR2",configInfo:"JE_CORE_COLORTYPE"},{xtype:"yesnofield",fieldLabel:"启用图标",name:"RESOURCECOLUMN_ENABLEICON"},{xtype:"rgroup",fieldLabel:"对齐方式",name:"RESOURCECOLUMN_ALIGN",configInfo:"JE_CORE_ALIGN",value:"left"},{xtype:"textarea",fieldLabel:"描述",columnWidth:.9,name:"RESOURCECOLUMN_DESCRIPTION"},{xtype:"gridssfield",fieldLabel:"选中样式",editable:!0,emptyText:"只对0,1字典项起效",configInfo:"JE_CORE_FONTICON,RESOURCECOLUMN_CHECKEDCLS,FONTICON_CLS,S",name:"RESOURCECOLUMN_CHECKEDCLS"},{xtype:"gridssfield",fieldLabel:"不选中样式",emptyText:"只对0,1字典项起效",editable:!0,configInfo:"JE_CORE_FONTICON,RESOURCECOLUMN_UNCHECKEDCLS,FONTICON_CLS,S",name:"RESOURCECOLUMN_UNCHECKEDCLS"},{xtype:"colorfield",fieldLabel:"右边框颜色",name:"RESOURCECOLUMN_RBORDERCOLOR"},{xtype:"colorfield",fieldLabel:"标题颜色",name:"RESOURCECOLUMN_TITLECOLOR"},{xtype:"numberfield",fieldLabel:"列宽",allowBlank:!1,minValue:5,step:5,name:"RESOURCECOLUMN_WIDTH"},{xtype:"numberfield",fieldLabel:"英文列宽",minValue:5,step:5,name:"RESOURCECOLUMN_WIDTH_EN"},{xtype:"yesnofield",fieldLabel:"隐藏",name:"RESOURCECOLUMN_HIDDEN"},{xtype:"yesnofield",fieldLabel:"编辑",name:"RESOURCECOLUMN_ALLOWEDIT"},{xtype:"yesnofield",fieldLabel:"隐藏编辑提示",name:"RESOURCECOLUMN_HIDETITLECLS"},{xtype:"yesnofield",fieldLabel:"分步加载",name:"RESOURCECOLUMN_LAZYLOAD"},{xtype:"cbbfield",fieldLabel:"查询类型",configInfo:"JE_QUERYTYPE",name:"RESOURCECOLUMN_QUERYTYPE"},{xtype:"cbbfield",fieldLabel:"列查询类型",value:"no",configInfo:"JE_CORE_COLUMNQUERYTYPE",name:"RESOURCECOLUMN_COLUMNQUERYTYPE",dicItemCodes:["like","like%","=","no"]},,{xtype:"yesnofield",fieldLabel:"提示",name:"RESOURCECOLUMN_COLUMNTIP"},{xtype:"yesnofield",fieldLabel:"锁定列",name:"RESOURCECOLUMN_LOCKED"},{xtype:"yesnofield",fieldLabel:"快速查询",name:"RESOURCECOLUMN_QUICKQUERY"},{xtype:"cbbfield",fieldLabel:"快查类型",configInfo:"JE_QUERYTYPE",name:"RESOURCECOLUMN_QUICKQUERYTYPE"},{xtype:"yesnofield",fieldLabel:"多行显示",name:"RESOURCECOLUMN_MULTIROWS"},{xtype:"yesnofield",fieldLabel:"合并单元格",name:"RESOURCECOLUMN_MERGE"},{xtype:"yesnofield",fieldLabel:"排序",name:"RESOURCECOLUMN_ORDER"},{xtype:"yesnofield",fieldLabel:"分组",hidden:!0,name:"RESOURCECOLUMN_GROUP"},{xtype:"cbbfield",dataArray:[],fieldLabel:"所属多表头",name:"RESOURCECOLUMN_MORECOLUMNNAME"},{xtype:"jsonfield",fieldLabel:"辅助配置",keyWidth:.5,valueWidth:.5,height:150,itemId:"helpConfig",name:"RESOURCECOLUMN_OTHERCONFIG",columns:[{text:"键",dataIndex:"key",flex:.5,field:{xtype:"cbbfield",editable:!0,buildQueryData:function(){var t=[],e=a.dataZY;Ext.each(e.grid,function(e){t.push({code:e.key,text:e.key})}),this.store.loadData(t)},listeners:{change:function(){a.getCmp("helpConfig").grid.getSelectionModel().getSelection()[0].set("value","")}}}},{text:"值",dataIndex:"value",flex:.5,field:{xtype:"cbbfield",editable:!0,buildQueryData:function(){var t=[],i=[],n=a.getCmp("helpConfig").grid.getSelectionModel().getSelection()[0].get("key"),e=a.dataZY;Ext.each(e.grid,function(e){JE.isNotEmpty(n)&&n==e.key&&(i=e.value.split(","))}),JE.isNotEmpty(i)&&Ext.each(i,function(e){t.push({code:e,text:e})}),this.store.loadData(t)}}}]},{xtype:"box",padding:"5",margin:"2",anchor:"100%",cls:"x-view-emtpytext",data:{},itemId:"otherHelpMsg",tpl:["<b>辅助配置说明：</b><br/>","queryLabel:高级查询标签<br/>","queryXtype:列头查询标签类型<br/>","queryLabelWidth:高级查询标签宽度<br/>",'queryType:<span class="queryType" style="color:blue;cursor: pointer;">高级查询类型</span><br/>','queryTypes:<span class="queryType" style="color:blue;cursor: pointer;">高级查询包含的查询类型</span><br/>',"queryTypeHidden:高级查询类型隐藏1|0<br/>","querySortDisabled:高级查询排序禁用1|0<br/>","flex:填充列 1|0<br/>","keyword:查询关键字高亮 1|0<br/>","headerAlign:列头文字位置 left|center|right<br/>","float: 悬浮action按钮 1|0<br/>"],listeners:{afterrender:function(e){e.getEl().on("click",function(e){if(e.getTarget(".queryType",1)){var t=JE.getDicItems("JE_CORE_COLUMNQUERYTYPE");JE.win({title:"查询类型",width:300,height:400,autoShow:!0,data:t,autoScroll:!0,tpl:['<tpl for=".">','<div style="line-height:2;font-size:14px;text-align:center;"><div style="width:50%;display:inline-block;">{text}</div><div style="width:50%;display:inline-block;font-weight: bold;">{code}</div></div>',"</tpl>"]})}})}}},{xtype:"hidden",fieldLabel:"主键",name:"JE_CORE_RESOURCECOLUMN_ID"},{xtype:"hidden",fieldLabel:"主键",name:"RESOURCECOLUMN_FUNCINFO_ID"},{xtype:"hidden",fieldLabel:"排序",name:"SY_ORDERINDEX"},{xtype:"hidden",fieldLabel:"是否主键",name:"RESOURCECOLUMN_ISPK"},{xtype:"hidden",fieldLabel:"是否导入",name:"RESOURCECOLUMN_IFIMPL"},{xtype:"hidden",name:"RESOURCECOLUMN_JSLISTENER"}],a.callParent(arguments)},loadFunc:function(e,t){var i=this,n=JE.ajax({url:JE.getUrlMaps("je.core.load"),params:{tableCode:"JE_CORE_RESOURCECOLUMN",whereSql:"and RESOURCECOLUMN_FUNCINFO_ID = '"+e+"' and RESOURCECOLUMN_CODE = '"+t+"'"}});if(0<n.rows.length){i.form.setValues(n.rows[0]),i.funcId=e,i.funcInfo={funcId:e,code:t},i.ownerCt.setTitle("【列】配置信息");var a=JE.cacheFunc[e];if(a){var l=[];Ext.iterate(a.basicColumns,function(e,t){"morecolumn"==t.xtype&&l.push({code:e,text:e})}),i.form.findField("RESOURCECOLUMN_MORECOLUMNNAME").store.loadData(l)}}}}),Ext.define("JE.sys.funccfg.view.column.ColumnGrid",{extend:"Ext.grid.Panel",alias:"widget.funccfg.columngrid",id:"funccfg.columngrid",mixins:["JE.sys.funccfg.view.jseditor.Util"],selModel:{selType:"checkboxmodel"},cls:"je-gridFunc-config",columnLines:!0,multiSelect:!0,enableKeyNav:!0,frame:!1,tbar:[{xtype:"button",ref:"impl",text:"导入",iconCls:"jeicon jeicon-import"},{ref:"add",text:"添加",iconCls:"jeicon jeicon-new-form",menu:[{text:"查询数据列",ref:"uxcolumn",iconCls:"jeicon jeicon-add-header"},{text:"多表头",ref:"morecolumn",iconCls:"jeicon jeicon-add-header"},{text:"标记列",ref:"markcolumn",iconCls:"jeicon jeicon-add-header"},{text:"批注列",ref:"postilcolumn",iconCls:"jeicon jeicon-add-header"},{text:"编辑列",ref:"funceditcolumn",iconCls:"jeicon jeicon-add-header"},{text:"字段【普通】",ref:"addfield",iconCls:"jeicon jeicon-field-text-o"},{text:"字段【字典辅助】",ref:"adddicfield",iconCls:"jeicon jeicon-dictionary"},{text:"字段【级联字典辅助】",ref:"addcascadefield",iconCls:"jeicon jeicon-dictionary"},{text:"字段【表辅助】",ref:"addtablefield",iconCls:"jeicon jeicon-resource-form"},{text:"字段【原子辅助】",ref:"addatomfield",iconCls:"jeicon jeicon-atom",hidden:!0}]},{xtype:"button",ref:"listupdate",text:"保存",iconCls:"jeicon jeicon-form-editing"},{xtype:"button",ref:"remove",text:"删除",iconCls:"jeicon jeicon-delete-form"},{xtype:"button",ref:"sync",text:"与表单同步",iconCls:"jeicon jeicon-table-column-synchronization"},{xtype:"button",ref:"sort",text:"排序整理",iconCls:"jeicon jeicon-sorting _16"},{xtype:"button",ref:"print",text:"打印设置",iconCls:"jeicon jeicon-print"},{xtype:"button",ref:"lang",text:"中英切换",iconCls:"jeicon jeicon-language-switching",handler:function(){var e=Ext.getCmp("funccfg.column").getCmp("columncols"),t="zhCols"==e.getLayout().getActiveItem().itemId?"enCols":"zhCols";e.getLayout().setActiveItem(t)}},{xtype:"button",ref:"tableInfoBtn",text:"表结构",iconCls:"jeicon jeicon-data-base"},{xtype:"button",ref:"viewTableInfoBtn",text:"操作表结构",iconCls:"jeicon jeicon-data-base"},"->",{xtype:"uxtrigger",width:200,ref:"querytext"}],columns:[{text:"序号",dataIndex:"SY_ORDERINDEX",width:40,align:"center",locked:!0},{text:"编码",dataIndex:"RESOURCECOLUMN_CODE",width:150,locked:!0},{text:"名称",dataIndex:"RESOURCECOLUMN_NAME",width:110,locked:!0,field:{xtype:"textfield",selectOnFocus:!0,allowBlank:!1}},{text:"隐藏",dataIndex:"RESOURCECOLUMN_HIDDEN",width:50,xtype:"uxcheckcolumn",locked:!0},{text:"允许展示",dataIndex:"RESOURCECOLUMN_IDIT",width:85,xtype:"uxcheckcolumn",locked:!0,listeners:{checkChange:function(e,t,i){this.up("panel[xtype=grid]").getStore().getAt(t).set("RESOURCECOLUMN_LAZYLOAD","1")}}},{text:"列宽",dataIndex:"RESOURCECOLUMN_WIDTH",width:50,locked:!0,field:{xtype:"numberfield",selectOnFocus:!0,value:50,minValue:5,step:5,allowBlank:!1}},{text:"查询类型",dataIndex:"RESOURCECOLUMN_QUERYTYPE",width:90,locked:!0,field:{xtype:"cbbfield",configInfo:"JE_QUERYTYPE"},tactics:[{type:"dic",dicCode:"JE_QUERYTYPE"}],renderer:JE.renderer},{text:"列查询类型",dataIndex:"RESOURCECOLUMN_COLUMNQUERYTYPE",width:90,locked:!0,field:{xtype:"cbbfield",value:"no",configInfo:"JE_CORE_COLUMNQUERYTYPE",dicItemCodes:["like","like%","=","no"]},tactics:[{type:"dic",dicCode:"JE_CORE_COLUMNQUERYTYPE"}],renderer:JE.renderer},{text:"编辑",dataIndex:"RESOURCECOLUMN_ALLOWEDIT",width:50,xtype:"uxcheckcolumn",locked:!0},{text:"加载项",dataIndex:"RESOURCECOLUMN_LAZYLOAD",width:80,xtype:"uxcheckcolumn"},{text:"快速查询",dataIndex:"RESOURCECOLUMN_QUICKQUERY",width:70,xtype:"uxcheckcolumn"},{text:"快查类型",dataIndex:"RESOURCECOLUMN_QUICKQUERYTYPE",width:90,field:{xtype:"cbbfield",configInfo:"JE_QUERYTYPE"},tactics:[{type:"dic",dicCode:"JE_QUERYTYPE"}],renderer:JE.renderer},{text:"事件",xtype:"actioncolumn",width:40,align:"center",items:[{tooltip:"编辑",handler:function(e,t,i){var n=e.panel,a=(n=e.lockingPartner?n.ownerLockable:n).getStore().getAt(t);n.showJSEditor({parent:n,record:a,fieldName:"RESOURCECOLUMN_JSLISTENER",type:"column"})},getClass:function(e,t,i){var n=this.ownerCt.grid;return(n=Ext.value(n.ownerLockable,n)).isFireListener(i.get("RESOURCECOLUMN_JSLISTENER"))?"jeicon jeicon-lightning-on":"jeicon jeicon-lightning-off"}}]},{text:"英文名称",dataIndex:"RESOURCECOLUMN_NAME_EN",width:110,field:{xtype:"textfield",selectOnFocus:!0}},{text:"英文列宽",dataIndex:"RESOURCECOLUMN_WIDTH_EN",width:80,field:{xtype:"numberfield",selectOnFocus:!0,value:50,minValue:5,step:5}},{text:"所属多表头",dataIndex:"RESOURCECOLUMN_MORECOLUMNNAME",width:121,field:{xtype:"cbbfield",dataArray:[],editable:!0,selectOnFocus:!0}},{text:"提示",dataIndex:"RESOURCECOLUMN_COLUMNTIP",width:50,xtype:"uxcheckcolumn"},{text:"锁定列",dataIndex:"RESOURCECOLUMN_LOCKED",width:60,xtype:"uxcheckcolumn"},{text:"隐藏编辑提示",dataIndex:"RESOURCECOLUMN_HIDETITLECLS",width:80,xtype:"uxcheckcolumn"},{text:"多行显示",dataIndex:"RESOURCECOLUMN_MULTIROWS",width:70,xtype:"uxcheckcolumn"},{text:"合并单元格",dataIndex:"RESOURCECOLUMN_MERGE",width:80,xtype:"uxcheckcolumn"},{text:"排序",dataIndex:"RESOURCECOLUMN_ORDER",width:80,xtype:"uxcheckcolumn"},{text:"分组",dataIndex:"RESOURCECOLUMN_GROUP",width:80,xtype:"uxcheckcolumn"},{text:"类型",dataIndex:"RESOURCECOLUMN_XTYPE",width:100,field:{xtype:"cbbfield",configInfo:"JE_FUNC_COLUMNXTYPE"},tactics:[{type:"dic",dicCode:"JE_FUNC_COLUMNXTYPE"}],renderer:JE.renderer},{text:"索引",dataIndex:"RESOURCECOLUMN_INDEX",width:80,renderer:function(e,t,i,n,a,l,o){if("uxcolumn"!=i.get("RESOURCECOLUMN_XTYPE"))return"";var d=o.panel.up("panel[xtype=funccfg.column]");return"1"==e?'已索引,<a href="javascript:void(0)" onclick="JE.sys.funccfg.util.singleton.removeIndex(\''+d.funcId+"','"+i.get("RESOURCECOLUMN_CODE")+"','"+i.get("JE_CORE_RESOURCECOLUMN_ID")+"')\">删除</a>":'未索引,<a href="javascript:void(0)" onclick="JE.sys.funccfg.util.singleton.createIndex(\''+d.funcId+"','"+i.get("RESOURCECOLUMN_CODE")+"','"+i.get("JE_CORE_RESOURCECOLUMN_ID")+"')\">创建</a>"}}],info:{tableName:"JE_CORE_RESOURCECOLUMN",pkName:"JE_CORE_RESOURCECOLUMN_ID"},initComponent:function(){var a=this;a.store=JE.getStore({tableName:"JE_CORE_RESOURCECOLUMN",id:"RESOURCECOLUMN_CODE",params:{limit:-1},url:JE.getUrlMaps("je.core.develop.funcInfo","loadFunc")}),(a.store.gridObj=a).relayEvents(a.store,["beforeload","load"]),a.viewConfig={enableTextSelection:!0,listeners:{drop:function(e,t,i,n){JE.Action.doDrop(a,a.info)}},plugins:{ptype:"gridviewdragdrop",dragText:"拖动排序",pluginId:"ddOrder"},getRowClass:function(e,t,i,n){return-1!=e.get("RESOURCECOLUMN_CODE").indexOf("_ID")?"func-id-cls":"SY_"==e.get("RESOURCECOLUMN_CODE").substring(0,3)?"func-row-sys-cls":void 0}},a.plugins=[Ext.create("Ext.grid.plugin.CellEditing",{clicksToEdit:1,pluginId:"cellEdit"})],a.callParent(arguments)}}),Ext.define("JE.sys.funccfg.view.column.DBField",{extend:"Ext.form.Panel",frame:!1,alias:"widget.funccfg.dbfield",id:"funccfg.dbfield",autoScroll:!0,initComponent:function(){this.layout="column",this.defaults={columnWidth:.3,labelAlign:"right",labelWidth:80},this.items=[{xtype:"textfield",fieldLabel:"编码",readOnly:!0,name:"RESOURCECOLUMN_CODE"},{xtype:"textfield",fieldLabel:"名称",allowBlank:!1,name:"RESOURCECOLUMN_NAME"}],this.callParent(arguments)}}),Ext.define("JE.sys.funccfg.view.column.ListView",{extend:"Ext.form.Panel",alias:"widget.funccfg.listview",id:"funccfg.listview",layout:"border",initComponent:function(){var e=this;e.tbar=[{xtype:"yesnofield",fieldLabel:"自定义表格",itemId:"FUNCINFO_TABLEVIEW",labelAlign:"right",cls:"je-field-basiccls",boxLabel:"启用"},{xtype:"numberfield",fieldLabel:"表格列数",editable:!1,minValue:0,maxValue:10,itemId:"FUNCINFO_TABLEVIEW_COLS",labelAlign:"right",labelWidth:60,cls:"je-field-basiccls"},{xtype:"hidden",itemId:"JE_CORE_FUNCINFO_ID"},{itemId:"saveBtn",text:"保存",iconCls:"jeicon jeicon-save",handler:function(){e.saveInfo()}}],e.items=[{xtype:"box",region:"west",padding:"2",margin:0,itemId:"fieldsBox",cls:"x-view-emtpytext",width:250,autoScroll:!0,data:{},tpl:['<table width=100% border=1 style="border-collapse:collapse;border-spacing:0;">','<tpl for=".">',"<tr>","<td>{RESOURCEFIELD_NAME}</td>","<td>{RESOURCEFIELD_CODE}</td>","</tr>","</tpl>","</table>"]},{region:"center",xtype:"jecodeeditor",itemId:"FUNCINFO_TABLEVIEW_TPL",border:0,saveFn:function(){e.down("button[itemId=saveBtn]").handler()}}],e.callParent(arguments)},loadFunc:function(e){var t=this;t.funcId=e;var i=JE.ajax({url:JE.getUrlMaps("je.core.develop.funcInfo","getInfoById"),params:{tableCode:"JE_CORE_FUNCINFO",pkValue:e,queryColumns:"JE_CORE_FUNCINFO_ID,FUNCINFO_TABLEVIEW,FUNCINFO_TABLEVIEW_COLS,FUNCINFO_TABLEVIEW_TPL"}}),n={FUNCINFO_TABLEVIEW_COLS:"1",FUNCINFO_TABLEVIEW_TPL:'/**\n\t* 数据项renderder方法\n\t* data 单条数据\n\t* config 数据项配置{itemStyle:"",itemCls:""}\n*/\nfunction(data,config){\n\treturn "";\n}'};Ext.each(["JE_CORE_FUNCINFO_ID","FUNCINFO_TABLEVIEW","FUNCINFO_TABLEVIEW_COLS","FUNCINFO_TABLEVIEW_TPL"],function(e){t.down("[itemId="+e+"]").setValue(Ext.value(i[e],n[e]))}),t.buildFuncInfo()},saveInfo:function(){var i=this,n={tableCode:"JE_CORE_FUNCINFO"};Ext.each(["JE_CORE_FUNCINFO_ID","FUNCINFO_TABLEVIEW","FUNCINFO_TABLEVIEW_COLS","FUNCINFO_TABLEVIEW_TPL"],function(e){var t=i.down("[itemId="+e+"]");n[e]=t.getValue()}),n.FUNCINFO_TABLEVIEW=n.FUNCINFO_TABLEVIEW?"1":"0",JE.ajax({url:JE.getUrlMaps("je.core.update"),params:n}).success?JE.msg("修改成功!"):JE.alert("修改失败!")},buildFuncInfo:function(){var e=" and RESOURCEFIELD_FUNCINFO_ID = '"+this.funcId+"' and RESOURCEFIELD_XTYPE not in('child','fieldset','displayfield','childfuncfield')",t=JE.ajax({url:JE.getUrlMaps("je.core.load"),params:{whereSql:e,orderSql:" order by SY_ORDERINDEX ASC ",limit:-1,tableCode:"JE_CORE_RESOURCEFIELD"}}).rows;this.getCmp("fieldsBox").update(t)}}),Ext.define("JE.sys.funccfg.view.cxcl.CxclGrid",{extend:"Ext.grid.Panel",alias:"widget.funccfg.cxclgrid",border:0,autoScroll:!0,columnLines:!0,viewConfig:{getRowClass:function(e,t,i,n){if("1"==e.get("QUERYSTRATEGY_DEF"))return"row-sys-cls"},listeners:{drop:function(e,t,i,n){var a=this.panel;JE.Action.doDrop(a,a.info),JE.Action.doUpdateList(a,a.info)}},plugins:{ptype:"gridviewdragdrop",dragText:"拖动排序",pluginId:"ddOrder"}},plugins:[Ext.create("Ext.grid.plugin.CellEditing",{clicksToEdit:1,pluginId:"cellEdit"})],columns:[{text:'<div class="jeicon jeicon-resource-table-addition" style="width:16px;height:16px;"></div>',menuDisabled:!0,align:"center",xtype:"actioncolumn",width:100,tooltip:"添加",items:[{iconCls:"jeicon jeicon-save",tooltip:"保存",style:"margin-right:5px;",handler:function(e,t,i){var n=e.panel;n.doUpdateList(n,n.info,[n.getStore().getAt(t)])}},{iconCls:"jeicon jeicon-trash-o",tooltip:"删除",style:"margin-right:5px;",handler:function(e,t,i){var n=e.panel,a=Ext.clone(n.info);a.url=JE.getUrlMaps("je.core.develop.queryStrategy","remove"),JE.Action.doRemove(n,a,[n.getStore().getAt(t)])}},{iconCls:"jeicon jeicon-calendar",tooltip:"设为默认策略",style:"margin-right:5px;",handler:function(e,t,i){var n=e.panel;n.getStore().getAt(t).set("QUERYSTRATEGY_DEF","1"),n.doUpdateList(n,n.info)}},{iconCls:"jeicon jeicon-cancel",tooltip:"取消默认策略",style:"margin-right:5px;",handler:function(e,t,i){var n=e.panel;n.getStore().getAt(t).set("QUERYSTRATEGY_DEF","0"),n.doUpdateList(n,n.info)}}],listeners:{headerclick:function(e,t){var i=e.grid;JE.formWin({title:"添加策略",width:300,height:100,items:{xtype:"textfield",labelWidth:60,fieldLabel:"名称",name:"name",allowBlank:!1,maxLength:"20"},fn:function(e){if(Ext.isEmpty(e.name))return!1;i.mainData.QUERYSTRATEGY_NAME=e.name;var t=Ext.clone(i.info);t.url=JE.getUrlMaps("je.core.develop.queryStrategy","save"),JE.Action.doSave(i,t),delete i.mainData.QUERYSTRATEGY_NAME}})}}},{dataIndex:"SY_ORDERINDEX",text:"排序",width:50,align:"center"},{dataIndex:"QUERYSTRATEGY_NAME",text:"名称",width:100,field:{xtype:"textfield",maxLength:"20"}},{dataIndex:"QUERYSTRATEGY_NAME_EN",text:"英文名称",width:100,field:{xtype:"textfield"}},{dataIndex:"QUERYSTRATEGY_SQL",text:"SQL",width:360,field:{xtype:"textfield"}},{text:"方法",align:"center",xtype:"actioncolumn",width:40,items:[{iconCls:"jeicon jeicon-pencil",handler:function(e,t,i){var n=e.panel,a=n.getStore().getAt(t),l=Ext.value(a.get("QUERYSTRATEGY_FN"),"/*返回 sql*/\n function(){\n\treturn '';\n}");JE.win({title:"方法(Ctrl+S保存)",items:{border:0,xtype:"jecodeeditor",value:l,saveFn:function(e){a.set("QUERYSTRATEGY_FN",e),n.doUpdateList(n,n.info,[a])}}}).show()}}]},{dataIndex:"QUERYSTRATEGY_FGGNSQL",text:"覆盖功能SQL",width:100,xtype:"uxcheckcolumn"}],doUpdateList:function(e,a,t,i){var n=e.getPlugin("cellEdit");e.localLang||(e.localLang=JE.getLocalLang("core.jegridview")),n&&n.completeEdit(),JE.Action.doChildSave(a,"data");var l=e.getStore(),o=a.pkName,d=a.tableName,r=Ext.value(t,l.getUpdatedRecords().concat(l.getNewRecords()));if(Ext.isEmpty(r))JE.msg(e.localLang.alert.editNoEdit);else{var c=[];Ext.Array.each(r,function(t){var i=t.getChanges();if(!Ext.Object.isEmpty(i)){var e=new Array;for(var n in i)e.push(n);i[o]=t.data[o],i._updatefields_=e.join(","),Ext.isEmpty(a.updateFields)||Ext.each(a.updateFields,function(e){i[e]=Ext.value(t.data[e],"")}),c.push(i)}});var s=JE.ajax({url:Ext.value(a.url,l.actUrls.updateList),params:{strData:Ext.encode(c),funcId:this.funcInfo.funcId,tableCode:d}}),E=s.obj;if(i&&JE.isNotEmpty(i.msg)&&(E=i.msg),1==s.success){JE.msg(E);var f=[];Ext.each(r,function(e){e.commit(),f.push(e.data)}),JE.Action.doTreeUpdate(f,a),JE.Action.doListForm(null,a)}else JE.alert(E)}},initComponent:function(){var e=this,t=e.funcInfo,i=(t.funcId,"JE_CORE_QUERYSTRATEGY");e.info={pkName:"JE_CORE_QUERYSTRATEGY_ID",url:JE.getUrlMaps("je.core.develop.queryStrategy","updateList"),tableName:i,insertType:"LIST",updateFields:["QUERYSTRATEGY_FUNCINFO_ID","QUERYSTRATEGY_NAME"]},e.mainData={QUERYSTRATEGY_FUNCCODE:t.funcCode,QUERYSTRATEGY_FUNCINFO_ID:t.funcId},e.store=JE.getStore({tableName:i,autoLoad:!0,params:{limit:-1,whereSql:" and QUERYSTRATEGY_FUNCCODE = '"+t.funcCode+"' and (QUERYSTRATEGY_USERID IS NULL OR QUERYSTRATEGY_USERID = '')",orderSql:" order by SY_ORDERINDEX"}}),e.callParent(arguments)}}),Ext.define("JE.sys.funccfg.view.data.DataFlowView",{extend:"Ext.grid.Panel",alias:"widget.funccfg.dataflow",id:"funccfg.dataflow",selModel:{selType:"checkboxmodel"},columnLines:!0,multiSelect:!0,enableKeyNav:!0,border:0,cls:"je-dataflowFunc-config",initComponent:function(){var c=this,e=[{code:"more",text:"逐条操作"},{code:"one",text:"全表操作"},{code:"idit",text:"自定义"}],n=[{code:"gridInsertBtn",text:"添加【列表】"},{code:"gridUpdateBtn",text:"保存【列表】"},{code:"gridRemoveBtn",text:"删除【列表】"},{code:"formSaveBtn",text:"保存【表单】"}];Ext.apply(c,{tbar:[{xtype:"button",ref:"insert",text:"添加",iconCls:"jeicon jeicon-new-form"},{xtype:"button",ref:"listupdate",text:"保存",iconCls:"jeicon jeicon-form-editing"},{xtype:"button",ref:"remove",text:"删除",iconCls:"jeicon jeicon-delete-form"},"->",{xtype:"uxtrigger",width:200,ref:"querytext"}],columns:[{text:"序号",dataIndex:"SY_ORDERINDEX",width:40,align:"center"},{text:"启用条件",xtype:"actioncolumn",width:80,align:"center",items:[{tooltip:"编辑",handler:function(e,t,i,n,a,l){e.panel;var o=l.get("DATAFLOW_QYTJ"),d="/*返回false可终止操作*/\nfunction(datas,beforeDatas,btnCode){\n\t return true;\n}",r=Ext.value(o,d);JE.win({title:"启用条件(Ctrl+S保存)",width:800,height:600,border:0,items:{xtype:"jecodeeditor",itemId:"editorview",value:r,saveFn:function(e){l.set("DATAFLOW_QYTJ",d==e?"":e);var t=c.down("button[ref=listupdate]");t.fireEvent("click",t)},border:0}}).show()},getClass:function(e,t,i){return JE.isNotEmpty(i.get("DATAFLOW_QYTJ"))?"jeicon jeicon-lightning-on":"jeicon jeicon-lightning-off"}}]},{text:"动作",dataIndex:"DATAFLOW_DZ",width:150,field:{xtype:"cbbfield",multiSelect:!0,dataArray:n},renderer:function(e){if(JE.isNotEmpty(e)){var t=e.split(","),i=[];Ext.each(t,function(t){Ext.each(n,function(e){if(e.code==t)return i.push(e.text),!1})}),e=i.join(",")}return e}},{text:"备注",dataIndex:"DATAFLOW_BZ",width:150,field:{xtype:"textarea",height:100}},{text:"操作方式",dataIndex:"DATAFLOW_CZFS",width:100,field:{xtype:"cbbfield",dataArray:e},renderer:function(t){return JE.isNotEmpty(t)&&Ext.each(e,function(e){if(e.code==t)return t=e.text,!1}),t}},{text:"操作",dataIndex:"DATAFLOW_CZ",width:80,field:{xtype:"cbbfield",dataArray:["update","delete","insert"]}},{text:"SQL",dataIndex:"DATAFLOW_SQL",flex:1,field:{xtype:"textarea",height:100}},{text:"回调",xtype:"actioncolumn",width:80,align:"center",items:[{tooltip:"编辑",handler:function(e,t,i,n,a,l){e.panel;var o=l.get("DATAFLOW_HD"),d="function(datas,beforeDatas,btnCode){\n\t \n}",r=Ext.value(o,d);JE.win({title:"回调(Ctrl+S保存)",width:800,height:600,border:0,items:{xtype:"jecodeeditor",itemId:"editorview",value:r,saveFn:function(e){l.set("DATAFLOW_HD",d==e?"":e);var t=c.down("button[ref=listupdate]");t.fireEvent("click",t)},border:0}}).show()},getClass:function(e,t,i){return JE.isNotEmpty(i.get("DATAFLOW_HD"))?"jeicon jeicon-lightning-on":"jeicon jeicon-lightning-off"}}]}],info:{pkName:"JE_CORE_DATAFLOW_ID",tableName:"JE_CORE_DATAFLOW"}}),c.viewConfig={listeners:{drop:function(e,t,i,n){JE.Action.doDrop(c,c.info)}},plugins:{ptype:"gridviewdragdrop",dragText:"拖动排序",pluginId:"ddOrder"}},c.store=JE.getStore({tableName:"JE_CORE_DATAFLOW",id:"JE_CORE_DATAFLOW_ID"}),c.plugins=[Ext.create("Ext.grid.plugin.CellEditing",{clicksToEdit:1,pluginId:"cellEdit"})],c.callParent(arguments)},setViewReadOnly:function(t){var e=this.down("toolbar[dock=top]");if(e){var i=e.query("button");Ext.each(i,function(e){e.setDisabled(t)}),this.viewReadOnly=t}},loadFunc:function(e){var t=this,i=" and DATAFLOW_FUNCINFO_ID = '"+(t.funcId=e)+"'";t.store.proxy.extraParams.baseSql=i,t.store.proxy.extraParams.funcId=e,t.store.proxy.extraParams.tableCode="JE_CORE_DATAFLOW",t.store.proxy.extraParams.whereSql=i,t.getStore().proxy.extraParams.orderSql=" order by SY_ORDERINDEX ASC ",t.store.load()}}),Ext.define("JE.sys.funccfg.view.field.Field",{extend:"Ext.panel.Panel",alias:"widget.funccfg.field",id:"funccfg.field",layout:"border",initComponent:function(){this.items=[{xtype:"funccfg.fieldgrid",region:"center"},{xtype:"funccfg.fieldformtitle",region:"north",height:100,border:0,split:!0},{xtype:"funccfg.fieldform",width:300,title:"详细信息",split:!0,collapsible:!0,collapsed:!0,region:"east"}],this.callParent(arguments)},setViewReadOnly:function(t){var e=this.down("panel[xtype=funccfg.fieldgrid]");if(e){var i=e.query("button");Ext.each(i,function(e){e.setDisabled(t)}),e.viewReadOnly=t}var n=this.down("cbbfield[name=formType]");n&&n.setReadOnly(t)},loadFunc:function(t,i){var n=Ext.getCmp("funccfg.fieldform");n.getForm().reset(),n.collapse(),n.getDockedComponent("saveBar").hide();var a=Ext.getCmp("funccfg.fieldgrid"),e=" and RESOURCEFIELD_FUNCINFO_ID = '"+t+"'",l=JE.ajax({url:JE.getUrlMaps("je.core.develop.funcInfo","getInfoById"),params:{tableCode:"JE_CORE_FUNCINFO",pkValue:t,queryColumns:"JE_CORE_FUNCINFO_ID,FUNCINFO_FORMTITLETYPE,FUNCINFO_FORMTITLE,FUNCINFO_FUNCCODE"}});a.getStore().proxy.extraParams.baseSql=e,a.getStore().proxy.extraParams.whereSql=e,a.getStore().proxy.extraParams.funcId=t,a.getStore().proxy.extraParams.tableCode="JE_CORE_RESOURCEFIELD",a.getStore().proxy.extraParams.orderSql=" order by SY_ORDERINDEX ASC ",a.getStore().load({callback:function(){if(!Ext.isEmpty(i)){var e=a.getStore().findRecord("RESOURCEFIELD_CODE",i);e&&(a.getSelectionModel().select(e),a.fireEvent("itemclick",a.view,e),a.fireEvent("itemdblclick",a.view,e),n.setWidth(500))}}});var o=Ext.getCmp("funccfg.fieldformtitle");if(!Ext.isEmpty(l.FUNCINFO_FORMTITLETYPE)&&"none"!=l.FUNCINFO_FORMTITLETYPE){var d=o.form.findField("formType"),r=Ext.value(l.FUNCINFO_FORMTITLETYPE,"none");if(d.setValue(r),d.basicValue=r,!Ext.isEmpty(l.FUNCINFO_FORMTITLE)){var c=l.FUNCINFO_FORMTITLE;if("zdy"==r)try{Ext.isArray(Ext.decode(c))&&(c='<div style="width:100%;height:100%;padding:4px;" name=__body><div style="width:100%;height:100%" name=__text>'+c+"</div></div>")}catch(e){}o.getComponent("titleBox").update(c)}}Ext.each([o,a,n],function(e){Ext.apply(e,{funcId:t,funcCode:l.FUNCINFO_FUNCCODE})})}}),Ext.define("JE.sys.funccfg.view.field.FieldAnalyze",{extend:"Ext.panel.Panel",alias:"widget.funccfg.fieldanalyze",layout:"border",border:0,bodyStyle:"background-color:#fff;",initComponent:function(){var o=this,d=Ext.value(o.fieldInfo,{code:"",text:""}),e=JE.getFields({tableName:"JE_CORE_VFIELDINFO"}),t=Ext.create("Ext.data.Store",{fields:e,pageSize:10,autoLoad:!1,proxy:{type:"ajax",url:JE.getUrlMaps("je.core.load"),extraParams:{tableCode:"JE_CORE_VFIELDINFO"},reader:{type:"json",root:"rows",totalProperty:"totalCount"}}});o.items=[{xtype:"grid",region:"center",itemId:"fieldGrid",tbar:{itemId:"buttonId",defaults:{labelAlign:"right",margin:"0 0 0 5",labelWidth:80},items:[{xtype:"label",html:"字段名称 : <b>"+d.text+"</b>"},{xtype:"label",html:"字段编码 : <b>"+d.code+"</b>"},"->",{xtype:"cbbfield",fieldLabel:"查询类型",labelWidth:80,labelAlign:"right",dataArray:[{text:"%模糊",code:"%like"},{text:"模糊%",code:"like%"},{text:"%模糊%",code:"like"},{text:"精确",code:"="}],width:160,hideTrigger1:!0,value:"%like"},{xtype:"uxtrigger",itemId:"search",width:200,value:d.code,handler:function(e){var t=Ext.value(e.getValue(),d.code);e.setValue(t);var i=" and RESOURCEFIELD_CODE like '%"+t.replaceAll("_","[_]")+"'",n=e.previousSibling().getValue();"="==n?i=" and RESOURCEFIELD_CODE = '"+t+"'":"like%"==n?i=" and RESOURCEFIELD_CODE like '"+t.replaceAll("_","[_]")+"%'":"like"==n&&(i=" and RESOURCEFIELD_CODE like '%"+t.replaceAll("_","[_]")+"%'");var a=o.getCmp("fieldGrid"),l=a.store;a.keyword=t,l.proxy.extraParams.whereSql=i,l.loadPage(1)}}]},listeners:{itemdblclick:function(e,t){var i=t.get("JE_CORE_FUNCINFO_ID"),n=t.get("RESOURCEFIELD_CODE");o.getCmp("southpanel").getCmp("remarkform").form.setValues(t.data),JE.doMask(o.getCmp("southpanel").getCmp("viewpanel"),"正在生成分析数据，请稍等...",function(){o.analyzeField(n,i)})},afterrender:function(e){var t=e.getDockedCmp("buttonId").getCmp("search");t.handler(t)}},viewConfig:{getRowClass:function(e,t,i,n){if(e.get("JE_CORE_FUNCINFO_ID")==o.funcId)return"func-row-sys-cls"}},store:t,columnLines:!0,columns:{items:[{text:"功能编码",dataIndex:"FUNCINFO_FUNCCODE",width:200},{text:"功能名称",dataIndex:"FUNCINFO_FUNCNAME"},{text:"功能字段编码",dataIndex:"RESOURCEFIELD_CODE",width:200,renderer:function(e,t){var i=o.getCmp("fieldGrid").keyword;if(!Ext.isEmpty(i)){var n=e.replaceAll(i,"<span style='color:red'>"+i+"</span>");e==n&&(n=n.replaceAll(i.toUpperCase(),"<span style='color:red'>"+i.toUpperCase()+"</span>")),e==n&&(n=n.replaceAll(i.toLowerCase(),"<span style='color:red'>"+qqValue.toLowerCase()+"</span>")),e=n}return e}},{text:"功能字段名称",dataIndex:"RESOURCEFIELD_NAME"},{text:"表编码",dataIndex:"RESOURCETABLE_TABLECODE",width:200},{text:"表名称",dataIndex:"RESOURCETABLE_TABLENAME"},{text:"字段编码",dataIndex:"TABLECOLUMN_CODE",width:200},{text:"字段名称",dataIndex:"TABLECOLUMN_NAME"}]},bbar:{xtype:"pagingtoolbar",itemId:"pagingtoolbar",store:t,displayInfo:!0}},{xtype:"panel",region:"south",itemId:"southpanel",margin:"2 0 0 0",border:0,height:200,layout:{type:"hbox",align:"stretch"},items:[{xtype:"form",width:300,itemId:"remarkform",layout:"column",bodyPadding:"0 5 0 0",defaults:{xtype:"textarea",labelAlign:"right",labelWidth:40,height:"50%",columnWidth:1},title:"字段备注信息",items:[{fieldLabel:"表",name:"TABLECOLUMN_REMARK"},{fieldLabel:"功能",name:"RESOURCEFIELD_DESCRIPTION"},{xtype:"hidden",name:"JE_CORE_RESOURCEFIELD_ID"},{xtype:"hidden",name:"JE_CORE_TABLECOLUMN_ID"}],bbar:["->",{text:"保存备注信息",handler:function(){var t=o.getCmp("southpanel").getCmp("remarkform").form.getValues(),e={success:"empty"};JE.isNotEmpty(t.JE_CORE_RESOURCEFIELD_ID)&&(e=JE.ajax({url:JE.getUrlMaps("je.core.update"),params:{tableCode:"JE_CORE_RESOURCEFIELD",JE_CORE_RESOURCEFIELD_ID:t.JE_CORE_RESOURCEFIELD_ID,RESOURCEFIELD_DESCRIPTION:t.RESOURCEFIELD_DESCRIPTION}})),e.success&&JE.isNotEmpty(t.JE_CORE_TABLECOLUMN_ID)&&(e=JE.ajax({url:JE.getUrlMaps("je.core.update"),params:{tableCode:"JE_CORE_TABLECOLUMN",JE_CORE_TABLECOLUMN_ID:t.JE_CORE_TABLECOLUMN_ID,TABLECOLUMN_REMARK:t.TABLECOLUMN_REMARK}})),"empty"==e.success?JE.alert("请选择字段！"):e.success?(JE.msg("修改成功..."),o.getCmp("fieldGrid").store.each(function(e){if(e.get("JE_CORE_RESOURCEFIELD_ID")==t.JE_CORE_RESOURCEFIELD_ID||e.get("JE_CORE_TABLECOLUMN_ID")==t.JE_CORE_TABLECOLUMN_ID)return e.set(t),e.commit(),!1})):JE.error(e.obj,e)}}]},{xtype:"panel",margin:"0 0 0 2",flex:1,autoScroll:!0,title:"来源分析",itemId:"viewpanel",bodyPadding:"5",tpl:["<p>主子功能:</p>","<ol>",'<tpl for="zzgnData">',"<li>","由主功能 <b>{funcName}</b>({funcCode}) 的字段 <b>{fieldName}</b>({fieldCode}) 带入","</li>","</tpl>","</ol>","<p>配置项:</p>","<ol>",'<tpl for="configData">',"<li>","由字段 <b>{fieldName}</b>({fieldCode}) 的 <b>{xtypeName}</b>(功能/字典编码：{configFunc}) 的 <b>{colField}</b> 带入","</li>","</tpl>","</ol>","<p>表达式:</p>","<ol>",'<tpl for="expData">',"<li>",'<b>{fieldName}</b>({fieldCode}) 的 {type}：<font color="blue">{exp}</font>',"</li>","</tpl>","</ol>"]}]}],o.callParent(arguments)},afterRender:function(){this.callParent(arguments)},analyzeField:function(c,e){var t=JE.toXT(" and ASSOCIATIONFIELD_PID='{funcId}' and ASSOCIATIONFIELD_CHIFIELDCODE='{fieldName}' and ASSOCIATIONFIELD_TRANSMIT='1'",{funcId:e,fieldName:c}),i=JE.ajax({url:JE.getUrlMaps("je.core.load"),params:{tableCode:"JE_CORE_ASSOCIATIONFIELD",whereSql:t,limit:-1}}).rows,n=(t=JE.toXT(" and (RESOURCEFIELD_BINDING like '%{fieldName}%' or RESOURCEFIELD_CONFIGINFO like '%{fieldName}%') and RESOURCEFIELD_FUNCINFO_ID='{funcId}'",{funcId:e,fieldName:c.replaceAll("_","[_]")}),JE.ajax({url:JE.getUrlMaps("je.core.load"),params:{tableCode:"JE_CORE_RESOURCEFIELD",whereSql:t,limit:-1}}).rows),a=[],l=["ASSOCIATIONFIELD_FID","RESOURCEFIELD_FUNCINFO_ID"];Ext.each([i,n],function(e,i){Ext.each(e,function(e){var t=e[l[i]];-1==a.indexOf(t)&&a.push(t)})});var o=JE.ajax({url:JE.getUrlMaps("je.core.load"),params:{tableCode:"JE_CORE_FUNCINFO",whereSql:" and JE_CORE_FUNCINFO_ID in ('"+a.join("','")+"')",limit:-1}}).rows,s={};Ext.each(o,function(e){s[e.JE_CORE_FUNCINFO_ID]=e});var d=[];Ext.each(i,function(e){var t=s[e.ASSOCIATIONFIELD_FID];d.push({funcCode:t.FUNCINFO_FUNCCODE,funcName:t.FUNCINFO_FUNCNAME,fieldCode:e.ASSOCIATIONFIELD_PRIFIELDCODE,fieldName:e.ASSOCIATIONFIELD_PRIFIELDNAME,type:"child"})});var E=[],f=[];Ext.each(n,function(e){var t=s[e.RESOURCEFIELD_FUNCINFO_ID],i={fieldName:e.RESOURCEFIELD_NAME,fieldCode:e.RESOURCEFIELD_CODE,xtype:e.RESOURCEFIELD_XTYPE,funcName:t.FUNCINFO_FUNCNAME,funcCode:t.FUNCINFO_FUNCCODE};if(-1!=e.RESOURCEFIELD_BINDING.indexOf(c)&&E.push(Ext.apply(Ext.clone(i),{type:"绑定表达式",exp:e.RESOURCEFIELD_BINDING})),-1!=e.RESOURCEFIELD_CONFIGINFO.indexOf(c)){var n=JE.toDicText("JE_FUNC_XTYPE",i.xtype);n=n.substring(n.indexOf(".")+1);var a=e.RESOURCEFIELD_CONFIGINFO.split(","),l=a[0],o=a[1].split("~"),d=a[2].split("~"),r=o.indexOf(c);-1!=r&&f.push(Ext.apply(Ext.clone(i),{type:"配置项",config:e.RESOURCEFIELD_CONFIGINFO,colField:d[r],configFunc:l,xtypeName:n}))}}),this.getCmp("southpanel").getCmp("viewpanel").update({zzgnData:d,expData:E,configData:f})}}),Ext.define("JE.sys.funccfg.view.field.FieldDicAdd",{extend:"Ext.panel.Panel",alias:"widget.funccfg.fielddicadd",layout:"border",bodyPadding:"2",initComponent:function(){var e={xtype:"treepanel",region:"center",useArrows:!0,itemId:"dicTree",store:Ext.create("Ext.data.TreeStore",{fields:[{name:"text",type:"string"},{name:"code",type:"string"}],defaultRootId:JE.uuid()}),lbar:[{iconCls:"jeicon jeicon-resource-table-addition",tooltip:"添加字典项",handler:function(e){var t=e.up("panel[xtype=funccfg.fielddicadd]"),i=t.getCmp("dicTree");"LIST"==t.getCmp("dicForm").form.getValues().DICTIONARY_DDTYPE&&i.getSelectionModel().deselectAll();var n=i.getSelectionModel().getSelection(),a=i.getRootNode();0<n.length&&(a=n[0]);var l={id:JE.uuid(),expandable:!0,leaf:!0,children:[]};a.isLeaf()&&(a.set("leaf",!1),a.commit()),l=a.appendChild(l),a.expand()}}],columns:{defaults:{sortable:!1,menuDisabled:!0},items:[{xtype:"treecolumn",text:"名称",width:180,dataIndex:"text",editor:{xtype:"textfield"}},{text:"编码",width:180,dataIndex:"code",editor:{xtype:"textfield"}},{xtype:"actioncolumn",width:40,align:"center",iconCls:"jeicon jeicon-error",tooltip:"删除",handler:function(e,t,i){e.panel;e.getStore().getAt(t).remove()}}]},selModel:{selType:"treemodel",allowDeselect:!0},rootVisible:!1,viewConfig:{plugins:{ptype:"treeviewdragdrop"}},plugins:[{ptype:"cellediting",clicksToEdit:1,pluginId:"cellEdit"}]},t={xtype:"form",region:"west",layout:"anchor",width:320,margin:"0 2 0 0",bodyPadding:"10",itemId:"dicForm",bodyStyle:{background:"#FFFEDB"},defaults:{xtype:"textfield",labelAlign:"right",labelWidth:100,anchor:"100%",allowBlank:!1},items:[{fieldLabel:"字典名称",name:"DICTIONARY_DDNAME"},{fieldLabel:"字典编码",name:"DICTIONARY_DDCODE"},{xtype:"cbbfield",fieldLabel:"字典类型",configInfo:"DDTYPE",name:"DICTIONARY_DDTYPE",dicItemCodes:"TREE,LIST",value:"LIST"},{xtype:"treessfield",fieldLabel:"所属子系统",configInfo:"JE_SYSTEM,DICTIONARY_BELONGSTONAME~DICTIONARY_BELONGSTO,text~code,S",name:"DICTIONARY_BELONGSTONAME"},{xtype:"textarea",fieldLabel:"表名(实体名/URL)",allowBlank:!0,name:"DICTIONARY_CLASSNAME"},{xtype:"hidden",name:"DICTIONARY_BELONGSTO"},{xtype:"hidden",name:"JE_CORE_DICTIONARY_ID",value:JE.uuid()}]};this.items=[t,e],this.callParent(arguments)},setConfigInfo:function(){var e=this.down("form"),t=this.down("treepanel");if(!e.isValid())return!1;var i=e.form.getValues(),n=this.eachChild(t.getRootNode(),i.JE_CORE_DICTIONARY_ID),a=0,l=[],o={};if(Ext.each(n,function(e){var t=e.DICTIONARYITEM_ITEMCODE;if(Ext.isEmpty(t))return a++,!1;o[t]?l.push(t):o[t]=t}),0<a)return JE.alert("有空的字典项编码，请填写！"),!1;if(0<l.length)return JE.alert("有重复的字典项编码，请检查！</br>重复编码有："+l.join(",")),!1;var d=JE.ajax({url:JE.getUrlMaps("je.core.dd.dd","doSaveDic"),params:{dicStr:"["+Ext.encode(i)+"]",strData:Ext.encode(n)}});return d.success?(JE.msg(d.obj),this.formObj.form.setValues({RESOURCEFIELD_CONFIGINFO:i.DICTIONARY_DDCODE}),!0):(JE.alert(d.obj),!1)},eachChild:function(e,t){var i=this,n=[],a=e.data,l="",o="",d="";e.isRoot()?(l="ROOT",a.code="__ROOT"):(o=a.parentId,d=e.getPath("id"),l=e.hasChildNodes()?"GENERAL":"LEAF");var r={SY_ORDERINDEX:a.index,JE_CORE_DICTIONARYITEM_ID:a.id,SY_PARENT:o,SY_NODETYPE:l,DICTIONARYITEM_ITEMNAME:a.text,DICTIONARYITEM_ITEMCODE:a.code,SY_LAYER:a.depth,DICTIONARYITEM_DICTIONARY_ID:t,SY_PATH:d,SY_FLAG:"1"};return n.push(r),e.eachChild(function(e){n=n.concat(i.eachChild(e,t))}),n}}),Ext.define("JE.sys.funccfg.view.field.FieldForm",{extend:"Ext.form.Panel",alias:"widget.funccfg.fieldform",id:"funccfg.fieldform",autoScroll:!0,bodyPadding:4,cls:"je-mainview-bg",hideEditColBtn:!1,initComponent:function(){var l=this;l.dataZY=JE.helpMsg.otherconfigData,l.layout="anchor",l.defaults={anchor:"95%",labelAlign:"right",margin:"0 0 2 0",labelWidth:85},l.dockedItems=[{xtype:"toolbar",dock:"top",itemId:"saveBar",items:[{text:"编辑列信息",ref:"editColumn",iconCls:"jeicon jeicon-grid-configuration",hidden:l.hideEditColBtn},{text:"事件",ref:"jslistener",iconCls:"jeicon jeicon-lightning-off"},{text:"分析",iconCls:"jeicon jeicon-filter-o",handler:function(){var e={text:l.form.findField("RESOURCEFIELD_NAME").getValue(),code:l.form.findField("RESOURCEFIELD_CODE").getValue()};JE.win({title:"字段分析",height:800,iconCls:"jeicon jeicon-filter-o",border:0,items:{xtype:"funccfg.fieldanalyze",fieldInfo:e,funcId:l.funcId},autoShow:!0})}},"->",{text:"保存关闭",ref:"save",iconCls:"jeicon jeicon-save"}]}],l.items=[{xtype:"textfield",fieldLabel:"编码",labelStyle:"cursor: pointer;color:blue;",labelAttrTpl:' data-qtip="配置信息" ',readOnly:!0,name:"RESOURCEFIELD_CODE"},{xtype:"textfield",fieldLabel:"名称",allowBlank:!1,name:"RESOURCEFIELD_NAME"},{xtype:"textfield",fieldLabel:"英文名称",name:"RESOURCEFIELD_NAME_EN"},{xtype:"cbbfield",configInfo:"JE_FUNC_XTYPE",fieldLabel:"类型",allowBlank:!1,defaultListConfig:{loadingHeight:10},name:"RESOURCEFIELD_XTYPE"},{xtype:"cbbfield",fieldLabel:'<span valueTxt style="cursor: pointer;color:blue;" title="方法体编写">默认值</span><span dicBtn class="jeicon jeicon-dictionary" style="cursor: pointer;padding: 1px 8px;" title="选择字典值"></span>',name:"RESOURCEFIELD_VALUE",editable:!0,configInfo:"JE_DEFAULEVALUE,value,code,S"},{xtype:"numberfield",fieldLabel:"宽度",minValue:0,step:5,name:"RESOURCEFIELD_WIDTH"},{xtype:"numberfield",fieldLabel:"高度",minValue:0,step:5,name:"RESOURCEFIELD_HEIGHT"},{xtype:"numberfield",fieldLabel:"所占列数",minValue:1,name:"RESOURCEFIELD_COLSPAN"},{xtype:"textfield",fieldLabel:"依附字段",minValue:1,name:"RESOURCEFIELD_ROWFIELD"},{xtype:"cbbfield",dataArray:[],fieldLabel:"所属组",name:"RESOURCEFIELD_GROUPNAME"},{xtype:"cbbfield",fieldLabel:"正则表达式",configInfo:"JE_FUNC_JSREGEX",editable:!0,name:"RESOURCEFIELD_REGEX"},{xtype:"textfield",fieldLabel:"正则提示信息",name:"RESOURCEFIELD_REGEXTEXT"},{xtype:"cbbfield",fieldLabel:"自定义验证",useExpFunc:!0,configInfo:"JE_FUNC_VTYPES",name:"RESOURCEFIELD_VTYPE"},{xtype:"cbbfield",fieldLabel:"标签位置",name:"RESOURCEFIELD_LABELALIGN",value:"right",dataArray:[{code:"right",text:"左"},{code:"top",text:"上"}]},{xtype:"hidden",fieldLabel:"自定义验证方法",name:"RESOURCEFIELD_VTYPEFN"},{xtype:"hiddenfield",fieldLabel:"验证配置",name:"RESOURCEFIELD_VTYPECONFIG"},{xtype:"yesnofield",fieldLabel:"标签隐藏",name:"RESOURCEFIELD_HIDELABEL"},{xtype:"yesnofield",fieldLabel:"隐藏",boxLabel:'<span style="color:#0000FF;">启动则隐藏该字段</span>',name:"RESOURCEFIELD_HIDDEN"},{xtype:"yesnofield",fieldLabel:"加载项",boxLabel:'<span style="color:#0000FF;">禁用时使用轻量级隐藏组件</span>',name:"RESOURCEFIELD_FIELDLAZY"},{xtype:"yesnofield",fieldLabel:"允许为空",boxLabel:'<span style="color:#0000FF;">启动则可不填任何数值</span>',name:"RESOURCEFIELD_ALLOWBLANK"},{xtype:"yesnofield",fieldLabel:"只读",boxLabel:'<span style="color:#0000FF;">启动则字段不能编辑</span>',name:"RESOURCEFIELD_READONLY"},{xtype:"yesnofield",fieldLabel:"可选可编辑",boxLabel:'<span style="color:#0000FF;">启动则可选可编辑</span>',name:"RESOURCEFIELD_EDITABLE"},{xtype:"yesnofield",fieldLabel:"历史留痕",boxLabel:'<span style="color:#0000FF;">启动可保留字段修改痕迹</span>',name:"RESOURCEFIELD_HISTORY"},{xtype:"yesnofield",fieldLabel:"快速定位",boxLabel:'<span style="color:#0000FF;">启动可快速定位到该字段</span>',name:"RESOURCEFIELD_LOCATE"},{xtype:"yesnofield",fieldLabel:"禁用",boxLabel:'<span style="color:#0000FF;">启动则不在表单加载组件</span>',name:"RESOURCEFIELD_REMOVED"},{xtype:"cbbfield",configInfo:"JE_CORE_FIELDCLS",editable:!0,fieldLabel:"字段样式",name:"RESOURCEFIELD_FIELDCLS"},{xtype:"colorfield",fieldLabel:"组件文字颜色",name:"RESOURCEFIELD_FIELDCOLOR"},{xtype:"colorfield",fieldLabel:"标签颜色",name:"RESOURCEFIELD_LABELCOLOR"},{xtype:"colorfield",fieldLabel:"分组框背景色",name:"RESOURCEFIELD_BGCOLOR"},{xtype:"textfield",useExpFunc:!0,fieldLabel:"绑定表达式",name:"RESOURCEFIELD_BINDING"},{xtype:"uxtrigger",fieldLabel:"显隐表达式",useExpFunc:!0,name:"RESOURCEFIELD_INTERPRETER",handler:function(t){Ext.create("JE.sys.funccfg.view.other.VisibleCfgView",{autoShow:!0,funcId:l.funcId,initValue:{exp:t.getValue()},fn:function(e){t.setValue(e.exp)}})}},{xtype:"textfield",useExpFunc:!0,fieldLabel:"只读表达式",name:"RESOURCEFIELD_READONLYEXP"},{xtype:"textfield",useExpFunc:!0,fieldLabel:"为空表达式",name:"RESOURCEFIELD_ALLOWBLANKEXP"},{xtype:"textarea",fieldLabel:'<span style="cursor: pointer;color:blue;" title="窗口编辑">配置信息</span>',height:150,name:"RESOURCEFIELD_CONFIGINFO"},{xtype:"box",padding:"5",margin:"2",anchor:"100%",cls:"x-view-emtpytext",data:{},itemId:"helpMsg",tpl:["<b>配置信息说明：</b>",'<tpl if="text">',"</br>{text}","<tpl else>","无","</tpl>"]},{xtype:"textfield",useExpFunc:!0,fieldLabel:"可选表达式",name:"RESOURCEFIELD_ENABLEEXP"},{xtype:"textfield",fieldLabel:"可选提示语",name:"RESOURCEFIELD_ENABLETIP"},{xtype:"textfield",fieldLabel:"后缀",name:"RESOURCEFIELD_UNITTPL"},{fieldLabel:"高级后缀",name:"RESOURCEFIELD_UNITLISTTPL",actionColumnIndex:0,xtype:"jsonarrayfield",insertFn:function(e){e.store.add({id:JE.uuid(),bold:"1"})},columns:[{dataIndex:"text",text:"文字"},{text:"方法",align:"center",xtype:"actioncolumn",width:40,editable:!1,items:[{iconCls:"jeicon jeicon-pencil",handler:function(e,t,i){var n=e.panel.getStore().getAt(t),a="function(field){\n}",l=Ext.value(n.get("handler"),a);JE.win({title:"方法(Ctrl+S保存)",autoShow:!0,items:{border:0,xtype:"jecodeeditor",value:l,saveFn:function(e){e==a&&(e=""),n.set("handler",e),JE.msg("编写完成...")}}})}}]},{dataIndex:"color",text:"颜色",width:80,field:{xtype:"colorfield"}},{dataIndex:"bold",text:"加粗",width:40,xtype:"uxcheckcolumn"},{dataIndex:"handler",hidden:!0},{dataIndex:"id",hidden:!0}]},{xtype:"textarea",fieldLabel:"过滤条件",name:"RESOURCEFIELD_WHERESQL"},{xtype:"jsonfield",fieldLabel:"辅助配置",itemId:"helpConfig",columns:[{text:"键",dataIndex:"key",flex:.5,field:{xtype:"cbbfield",editable:!0,buildQueryData:function(){var t=[],e=l.dataZY,i=l.form.findField("RESOURCEFIELD_XTYPE").getValue();Ext.each(e[i],function(e){t.push({code:e.key,text:e.key})}),t.push({code:"hideLabelText",text:"hideLabelText"}),this.store.loadData(t)},listeners:{change:function(){l.getCmp("helpConfig").grid.getSelectionModel().getSelection()[0].set("value","")}}}},{text:"值",dataIndex:"value",flex:.5,field:{xtype:"cbbfield",editable:!0,buildQueryData:function(){var t=[],i=[],n=l.getCmp("helpConfig").grid.getSelectionModel().getSelection()[0].get("key"),e=l.form.findField("RESOURCEFIELD_XTYPE").getValue(),a=l.dataZY;Ext.each(a[e],function(e){JE.isNotEmpty(n)&&n==e.key&&(i=e.value.split(","))}),JE.isNotEmpty(i)&&Ext.each(i,function(e){t.push({code:e,text:e})}),"hideLabelText"==n&&t.push({code:"1",text:"1"}),this.store.loadData(t)}}}],name:"RESOURCEFIELD_OTHERCONFIG"},{xtype:"box",padding:"5",margin:"2",anchor:"100%",cls:"x-view-emtpytext",data:{},itemId:"otherHelpMsg",tpl:["<b>辅助配置说明：</b>",'<tpl if="text">',"</br>{text}","</br>hideLabelText:1(隐藏标签label)","<tpl else>","hideLabelText:1(隐藏标签label)","</tpl>"]},{xtype:"numberfield",minValue:0,fieldLabel:"内容最大长度",name:"RESOURCEFIELD_MAXLENGTH"},{xtype:"textarea",fieldLabel:"输入提示",name:"RESOURCEFIELD_EMPTYTEXT"},{xtype:"textarea",labelStyle:"cursor: pointer;color:blue;",fieldLabel:"帮助提示",name:"RESOURCEFIELD_HELP",listeners:{afterrender:function(i){i.labelEl.on("click",function(){JE.win({title:"帮助提示",width:800,height:600,useButton:!0,autoShow:!0,items:{xtype:"ueditor",value:i.getValue()},fn:function(e){var t=e.getCmp(0).getHtml();i.setValue(t)}})})}}},{xtype:"textarea",fieldLabel:"描述",name:"RESOURCEFIELD_DESCRIPTION"},{xtype:"hidden",fieldLabel:"主键",name:"JE_CORE_RESOURCEFIELD_ID"},{xtype:"hidden",fieldLabel:"主键",name:"RESOURCEFIELD_FUNCINFO_ID"},{xtype:"hidden",fieldLabel:"是否主键",name:"RESOURCEFIELD_ISPK"},{xtype:"hidden",fieldLabel:"是否导入",name:"RESOURCEFIELD_IFIMPL"},{xtype:"hidden",fieldLabel:"排序",name:"SY_ORDERINDEX"},{xtype:"hidden",name:"RESOURCEFIELD_JSLISTENER"},{xtype:"hidden",expFunc:!0,name:"RESOURCEFIELD_BINDINGFN"},{xtype:"hidden",expFunc:!0,name:"RESOURCEFIELD_INTERPRETERFN"},{xtype:"hidden",expFunc:!0,name:"RESOURCEFIELD_READONLYEXPFN"},{xtype:"hidden",expFunc:!0,name:"RESOURCEFIELD_ALLOWBLANKEXPFN"},{xtype:"hidden",expFunc:!0,name:"RESOURCEFIELD_ENABLEEXPFN"},{xtype:"hidden",name:"RESOURCEFIELD_VALUEFN"}],l.callParent(arguments)},loadFunc:function(e,t){var i=this,n={};if(n=Ext.isString(t)?JE.ajax({url:JE.getUrlMaps("je.core.load"),params:{tableCode:"JE_CORE_RESOURCEFIELD",whereSql:"and RESOURCEFIELD_FUNCINFO_ID = '"+e+"' and RESOURCEFIELD_CODE = '"+t+"'"}}).rows[0]:t.data){t=n.RESOURCEFIELD_CODE,i.form.setValues(n),i.oldValues=n,i.funcId=e,i.fieldCode=t,i.ownerCt.setTitle("【字段】配置信息");var a=JE.cacheFunc[e];if(a){i.funcCode=a.info.funcCode;var l=[];Ext.iterate(a.basicFields,function(e,t){"fieldset"==t.xtype&&l.push({code:e,text:e})}),i.form.findField("RESOURCEFIELD_GROUPNAME").store.loadData(l)}}}}),Ext.define("JE.sys.funccfg.view.field.FieldFormTitle",{extend:"Ext.form.Panel",alias:"widget.funccfg.fieldformtitle",id:"funccfg.fieldformtitle",layout:"column",autoScroll:!0,initComponent:function(){var l=this;l.defaults={minHeight:l.height-10},l.bodyPadding=4,l.bodyStyle="background:none;";function o(e){Ext.apply(e,{JE_CORE_FUNCINFO_ID:l.funcId,tableCode:"JE_CORE_FUNCINFO"}),JE.ajax({url:JE.getUrlMaps("je.core.update"),params:e}),JE.msg("修改成功！")}var d={none:'<div style="width:100%;height:100%" name=__body>&nbsp;</div>',jd:'<div style="width:100%;height:100%;padding:2px;" name=__body><div align = center style="font-size:24px;font-family:微软雅黑;margin:0 0 10px 0;" name = __text>主标题</div></div>',fz:'<table width="100%" height="100%" name = __body style="" ><tr><td rowspan=2 width="100" align=center valign=middle ><img src="'+JE.getStaticUrl("JE.sys.funccfg.view.field.FieldFormTitle.formedit")+'" style="height:70px;width:70px;" name="image"></td><td style="font-size:24px;font-family:微软雅黑;" name =__text  >主标题</td></tr><tr><td name =__text  >副标题</td></tr></table>',zdy:'<div style="width:100%;height:100%;padding:2px;" name=__body><div style="width:100%;height:100%" name=__text></div></div>'},t=function(e){if(!Ext.isEmpty(e)&&"__body"!=e.getAttribute("name"))return"__text"==e.getAttribute("name")?e:t(e.parentNode)},e={xtype:"box",html:d.none,itemId:"titleBox",cls:"x-panel-body-default",style:"background-color:#FFFFFF;border-width:1px;border-style:solid;",columnWidth:1,listeners:{afterrender:function(n){n.el.on("dblclick",function(e,i){"image"==i.getAttribute("name")?JE.uploadFile({fileTypes:"jpg;png",params:{filePath:"/funcTitle",tableCode:"JE_CORE_FUNCINFO",funcCode:"JE_CORE_FUNCINFO",beanTableCode:"JE_CORE_FUNCINFO",jeFileType:"PROJECT",pkValue:l.funcId,returnType:"all"},callback:function(e){var t=e.privateUrl||JE.getFileUrl(e.url,"PUBLIC","","","JE_CORE_FUNCINFO");i.setAttribute("src",t),o({FUNCINFO_FORMTITLE:n.getEl().dom.innerHTML})}}):(i=t(i),JE.isNotEmpty(i)&&JE.win({title:"编辑",width:900,height:400,useButton:!0,autoShow:!0,items:{xtype:"ueditor",simpleToolbar:!0},fn:function(e){var t=e.getCmp(0).getHtml();i.innerHTML=t,o({FUNCINFO_FORMTITLE:n.getEl().dom.innerHTML})},showFn:function(e){e.getCmp(0).setValue(i.innerHTML)}}))})}}},i={width:300,margin:"0 0 0 4",bodyPadding:2,xtype:"panel",layout:"column",defaults:{columnWidth:1,labelWidth:60,labelAlign:"right"},items:[{xtype:"cbbfield",fieldLabel:"标题类型",name:"formType",cls:"je-field-basiccls",hideTrigger1:!0,value:"none",dataArray:[{code:"none",text:"无"},{code:"jd",text:"简单标题"},{code:"fz",text:"复杂标题"},{code:"zdy",text:"自定义标题"}],listeners:{select:function(n,a){JE.confirm("更改类型后，模版将会修改，确定修改吗？",function(e){if("ok"==e){var t=l.getComponent("titleBox"),i=a[0].get("code");t.update(d[i]),o({FUNCINFO_FORMTITLETYPE:i,FUNCINFO_FORMTITLE:d[i]}),n.basicValue=i}else n.setValue(n.basicValue)})}}},{xtype:"box",padding:"5",margin:"5",html:"操作说明：先选择标题类型，然后双击标题预览区需要修改的地方进行编辑",cls:"x-view-emtpytext"}]};l.items=[e,i],l.callParent(arguments)}}),Ext.define("JE.sys.funccfg.view.field.FieldGrid",{extend:"Ext.grid.Panel",alias:"widget.funccfg.fieldgrid",id:"funccfg.fieldgrid",mixins:["JE.sys.funccfg.view.jseditor.Util"],selModel:{selType:"checkboxmodel"},cls:"je-formFunc-config",columnLines:!0,multiSelect:!0,enableKeyNav:!0,frame:!1,tbar:[{ref:"add",text:"添加",iconCls:"jeicon jeicon-new-form",menu:[{text:"分组框",ref:"fieldset",iconCls:"jeicon jeicon-form-grouping-increase"},{text:"分组框(字段域)",ref:"fieldset",iconCls:"jeicon jeicon-form-grouping-increase",info:"fieldArea"},{text:"展示字段",ref:"displayfield",iconCls:"jeicon jeicon-bar-chart-three"},{text:"子功能集合",ref:"childfuncfield",iconCls:"jeicon jeicon-add-fields"}]},{xtype:"button",ref:"listupdate",text:"保存",iconCls:"jeicon jeicon-form-save"},{xtype:"button",ref:"remove",text:"删除",iconCls:"jeicon jeicon-delete-form"},{xtype:"button",ref:"sync",text:"与列表同步",iconCls:"jeicon jeicon-table-column-synchronization"},{xtype:"button",ref:"sort",text:"排序整理",iconCls:"jeicon jeicon-sorting _16"},{xtype:"button",ref:"designer",text:"表单设计",iconCls:"jeicon jeicon-planning"},{xtype:"button",ref:"print",text:"打印设置",iconCls:"jeicon jeicon-print"},"->",{xtype:"uxtrigger",width:200,ref:"querytext"}],columns:[{text:"序号",dataIndex:"SY_ORDERINDEX",width:40,align:"center"},{text:"编码",dataIndex:"RESOURCEFIELD_CODE",width:150},{text:"名称",dataIndex:"RESOURCEFIELD_NAME",width:110,field:{xtype:"textfield",selectOnFocus:!0,allowBlank:!1}},{text:"类型",dataIndex:"RESOURCEFIELD_XTYPE",width:100,field:{xtype:"cbbfield",configInfo:"JE_FUNC_XTYPE"},tactics:[{type:"dic",dicCode:"JE_FUNC_XTYPE"}],renderer:JE.renderer},{text:"隐藏",dataIndex:"RESOURCEFIELD_HIDDEN",width:50,xtype:"uxcheckcolumn"},{text:"所属组",dataIndex:"RESOURCEFIELD_GROUPNAME",width:121,field:{xtype:"cbbfield",dataArray:[],editable:!0,selectOnFocus:!0}},{text:"加载项",dataIndex:"RESOURCEFIELD_FIELDLAZY",width:60,xtype:"uxcheckcolumn"},{text:"允许为空",dataIndex:"RESOURCEFIELD_ALLOWBLANK",width:70,xtype:"uxcheckcolumn"},{text:"只读",dataIndex:"RESOURCEFIELD_READONLY",width:50,xtype:"uxcheckcolumn"},{text:"可选可编辑",dataIndex:"RESOURCEFIELD_EDITABLE",width:90,xtype:"uxcheckcolumn"},{text:"禁用",dataIndex:"RESOURCEFIELD_REMOVED",width:50,xtype:"uxcheckcolumn"},{text:"默认值",dataIndex:"RESOURCEFIELD_VALUE",width:121,field:{xtype:"cbbfield",name:"RESOURCEFIELD_VALUE",editable:!0,configInfo:"JE_DEFAULEVALUE,value,code,S"},tactics:[{type:"dic",dicCode:"JE_DEFAULEVALUE"}],renderer:JE.renderer},{text:"英文名称",dataIndex:"RESOURCEFIELD_NAME_EN",width:110,field:{xtype:"textfield",selectOnFocus:!0}},{text:"分析",xtype:"actioncolumn",width:40,align:"center",items:[{iconCls:"jeicon jeicon-filter-o",handler:function(e,t,i){var n=e.panel,a=(n=e.lockingPartner?n.ownerLockable:n).getStore().getAt(t),l={text:a.get("RESOURCEFIELD_NAME"),code:a.get("RESOURCEFIELD_CODE")};JE.win({title:"字段分析",height:800,iconCls:"jeicon jeicon-filter-o",border:0,items:{xtype:"funccfg.fieldanalyze",fieldInfo:l,funcId:n.funcId},autoShow:!0})}}]},{text:"事件",xtype:"actioncolumn",width:40,align:"center",items:[{tooltip:"事件",handler:function(e,t,i){var n=e.panel,a=(n=e.lockingPartner?n.ownerLockable:n).getStore().getAt(t);n.showJSEditor({parent:n,record:a,fieldName:"RESOURCEFIELD_JSLISTENER",type:"field"})},getClass:function(e,t,i){var n=this.ownerCt.grid;return(n=Ext.value(n.ownerLockable,n)).isFireListener(i.get("RESOURCEFIELD_JSLISTENER"))?"jeicon jeicon-lightning-on":"jeicon jeicon-lightning-off"}}]}],info:{tableName:"JE_CORE_RESOURCEFIELD",pkName:"JE_CORE_RESOURCEFIELD_ID"},initComponent:function(){var a=this;a.store=JE.getStore({tableName:"JE_CORE_RESOURCEFIELD",id:"RESOURCEFIELD_CODE",params:{limit:-1},url:JE.getUrlMaps("je.core.develop.funcInfo","loadFunc")}),(a.store.gridObj=a).relayEvents(a.store,["beforeload","load"]),a.viewConfig={enableTextSelection:!0,listeners:{drop:function(e,t,i,n){JE.Action.doDrop(a,a.info)}},plugins:{ptype:"gridviewdragdrop",dragText:"拖动排序",pluginId:"ddOrder"},getRowClass:function(e,t,i,n){return-1!=e.get("RESOURCEFIELD_CODE").indexOf("_ID")?"func-id-cls":"__child"==e.get("RESOURCEFIELD_CODE")?"func-child-cls":"SY_"==e.get("RESOURCEFIELD_CODE").substring(0,3)?"func-row-sys-cls":void 0}},a.plugins=[Ext.create("Ext.grid.plugin.CellEditing",{clicksToEdit:1,pluginId:"cellEdit"})],a.callParent(arguments)}}),Ext.define("JE.sys.funccfg.view.field.FieldSSConfig",{extend:"Ext.form.Panel",frame:!1,alias:"widget.funccfg.fieldssconfig",autoScroll:!0,layout:"column",bodyPadding:"2",initComponent:function(){var e=this,t=e.userQuery,i=[{xtype:"gridssfield",name:"funcName",columnWidth:.3,readOnly:t,fieldLabel:"目标功能",configInfo:"JE_CORE_FUNCINFO,funcName~funcCode~funcId,FUNCINFO_FUNCNAME~FUNCINFO_FUNCCODE~JE_CORE_FUNCINFO_ID,S",whereSql:" AND SY_JESYS='1'"},{xtype:"textfield",name:"funcCode",columnWidth:.3,hidden:t,fieldLabel:"功能编码",readOnly:!0},{xtype:"cbbfield",name:"selModel",columnWidth:.2,fieldLabel:"选择模式",dataArray:[{code:"S",text:"单选"},{code:"M",text:"多选"}]},{xtype:"yesnofield",name:"showForm",columnWidth:.2,fieldLabel:"穿透"}];t&&(i.push({xtype:"cgroup",fieldLabel:"查询类型",name:"queryType",columnWidth:.5,value:"DEPT,SENTRY,ROLE,WORKGROUP",configInfo:"JE_USER_QUERYTYPE"}),i.push({xtype:"cbbfield",fieldLabel:"快速查询",name:"quickQueryType",columnWidth:.5,value:"NONE",configInfo:"JE_USER_QUICKQUERY"}),i.push({xtype:"cgroup",fieldLabel:"权限设置",name:"queryPermType",columnWidth:.5,value:"",configInfo:"JE_USER_PERMTYPE"}),i.push({xtype:"hidden",fieldLabel:"其他配置",name:"otherParam",columnWidth:.5,value:"{}"})),i.push({xtype:"textarea",name:"whereSql",columnWidth:1,fieldLabel:"过滤条件"},{xtype:"textfield",name:"sqlRemark",columnWidth:1,fieldLabel:"条件说明"},{xtype:"textfield",name:"gridTip",columnWidth:1,emptyText:"列表无数据时展示的说明文字,覆盖功能操作说明",fieldLabel:"操作说明"}),e.items=[{xtype:"fieldset",columnWidth:1,title:"基本信息",layout:"column",defaults:{labelAlign:"right",labelWidth:60,margin:"0 0 2 0"},items:i},{xtype:"jsonarrayfield",title:"目标功能字段",columnAlign:"left",name:"codes",height:300,defaultEditor:{xtype:"textfield",readOnly:!0},columns:[{dataIndex:"name",flex:.5,text:"目标功能字段"},{dataIndex:"code",flex:.5,text:"字段编码"},{dataIndex:"pkName",width:40,xtype:"uxcheckcolumn",align:"center",text:"唯一"}],columnWidth:.5,insertFn:e.selectCols},{xtype:"jsonarrayfield",name:"selfCodes",columnAlign:"left",title:"本功能字段",height:300,defaultEditor:{xtype:"textfield",readOnly:!0},columns:[{dataIndex:"name",flex:.5,text:"本功能字段"},{dataIndex:"code",flex:.5,text:"字段编码"}],columnWidth:.49,margin:"0 0 2 2",insertFn:e.selectCols},{xtype:"fieldset",columnWidth:1,title:"辅助配置信息",name:"otherCfgSet",layout:"column",padding:"2",hidden:!0,defaults:{labelAlign:"right",columnWidth:1,xtype:"gridssfield",margin:"0 0 2 0",labelWidth:60,editable:!0},items:[{name:"queryField",fieldLabel:"查询字段",whereSql:" and RESOURCEFIELD_FUNCINFO_ID = '{funcId}'",configInfo:"JE_CORE_RESOURCEFIELD,queryField,RESOURCEFIELD_CODE,M",resultColumn:"RESOURCEFIELD_NAME"},{name:"showField",fieldLabel:"展示字段",whereSql:" and RESOURCEFIELD_FUNCINFO_ID = '{funcId}'",configInfo:"JE_CORE_RESOURCEFIELD,showField,RESOURCEFIELD_CODE,M",resultColumn:"RESOURCEFIELD_NAME"}]},{xtype:"fieldset",columnWidth:1,title:"辅助配置信息",name:"otherCfgSet1",layout:"column",padding:"2",hidden:!0,defaults:{labelAlign:"right",columnWidth:1,xtype:"gridssfield",margin:"0 0 2 0",labelWidth:60},items:[{name:"parentFunc",fieldLabel:"主功能",columnWidth:.4,configInfo:"JE_CORE_FUNCINFO,parentFunc,FUNCINFO_FUNCCODE,S",whereSql:" AND SY_JESYS='1'"},{name:"parentFuncSql",columnWidth:.6,xtype:"textfield",fieldLabel:"Sql"},{name:"childFunc",fieldLabel:"子功能",whereSql:" AND SY_JESYS='1' and JE_CORE_FUNCINFO_ID = '{funcId}'",configInfo:"JE_CORE_FUNCINFO,childFunc,FUNCINFO_FUNCCODE,M"},{xtype:"container",layout:"hbox",columnWidth:1,defaults:{labelAlign:"right",columnWidth:1,margin:"0 2 2 0",labelWidth:60},items:[{xtype:"yesnofield",name:"enableAdd",fieldLabel:"可添加"},{name:"addText",xtype:"textfield",fieldLabel:"链接名",value:"添加"},{xtype:"yesnofield",name:"addCommon",boxLabel:"公用"},{name:"addPermText",xtype:"treessfield",configInfo:"JE_RBAC_ROLE,addPerm~addPermText,id~text,M",whereSql:" AND ROLERANK='SYS'",width:400,fieldLabel:"可用角色"},{name:"addPerm",xtype:"hidden"}]}]},{xtype:"hidden",name:"funcId"},{xtype:"hidden",name:"selfFuncId"}],e.callParent(arguments)},loadConfigInfo:function(e){var t=this,i=Ext.value(e.configInfo,"").replaceAll("\n","").split(","),n=e.funcId;t.fieldXtype=e.xtype;var a=Ext.decode(Ext.value(e.otherConfig,"{}")),l={funcCode:Ext.value(i[0],""),funcName:"",funcId:"",selfFuncId:n,selfCodes:Ext.isEmpty(i[1])?[]:i[1].split("~"),codes:Ext.isEmpty(i[2])?[]:i[2].split("~"),selModel:Ext.value(i[3],"S"),whereSql:Ext.value(e.whereSql,"")};if(!Ext.isEmpty(l.funcCode)){var o=JE.ajax({url:JE.getUrlMaps("je.core.load"),params:{tableCode:"JE_CORE_FUNCINFO",limit:1,whereSql:" and FUNCINFO_FUNCCODE = '"+l.funcCode+"'"}}).rows[0];o?(l.funcName=o.FUNCINFO_FUNCNAME,l.funcId=o.JE_CORE_FUNCINFO_ID,Ext.isEmpty(l.codes)||(l.codes=t.getFuncCols(o.JE_CORE_FUNCINFO_ID,l.codes),Ext.each(l.codes,function(e){e.pkName=e.code==a.pkName?"1":"0"}))):(JE.alert("功能编码："+l.funcCode+"不存在！"),l.codes=[])}if(Ext.isEmpty(l.selfCodes)||(l.selfCodes=t.getFuncCols(n,l.selfCodes)),t.userQuery){var d=new Array,r="NONE",c="",s={};for(var E in a)-1!=["DEPT","ROLE","SENTRY","WORKGROUP"].indexOf(E)&&"1"==a[E]?d.push(E):"QUICKQUERY"==E?r=a[E]:"QUERYPERM"==E?c=a[E]:s[E]=a[E];l.quickQueryType=r,l.queryType=d.join(","),l.otherParam=Ext.encode(s),l.queryPermType=c,Ext.isEmpty(l.funcCode)&&(l.funcCode="JE_CORE_QUERYUSER",l.funcName="人员查询",l.codes=[{name:"用户名",code:"USERNAME"},{name:"用户主键",code:"USERID"},{name:"用户编码",code:"USERCODE"}],l.queryType="DEPT,SENTRY,ROLE,WORKGROUP",l.quickQueryType="NONE",l.funcId="498551a4-08af-437b-a852-bf339de1c0b8")}else"searchfield"==t.fieldXtype?(t.down("fieldset[name=otherCfgSet]").show(),l.queryField=Ext.value(a.queryField,""),l.showField=Ext.value(a.showField,"")):(t.down("fieldset[name=otherCfgSet1]").show(),l.parentFunc=Ext.value(a.parentFunc,""),l.parentFuncSql=Ext.value(a.parentFuncSql,""),l.childFunc=Ext.value(a.childFunc,""),l.showForm=Ext.value(a.showForm,"0"),l.enableAdd=Ext.value(a.enableAdd,"0"),l.addText=Ext.value(a.addText,"添加"),l.addCommon=Ext.value(a.addCommon,"1"),l.addPerm=Ext.value(a.addPerm,""),l.addPermText=Ext.value(a.addPermText,""));Ext.each(["sqlRemark","gridTip"],function(e){l[e]=Ext.value(a[e],"")}),t.form.setValues(l)},getConfigInfo:function(){if(!this.isValid())return!1;var e,t,i={},n=this.getValues(),a=[n.funcCode,[],[],n.selModel];Ext.each(Ext.decode(n.selfCodes),function(e){a[1].push(e.code)}),e=a[1].length,a[1]=a[1].join("~");var l=[];if(Ext.each(Ext.decode(n.codes),function(e){a[2].push(e.code),JE.toBool(e.pkName)&&l.push(e.code)}),t=a[2].length,a[2]=a[2].join("~"),a=a.join(","),e!=t)return JE.alert("两组字段对应的条数不相同，请重新选择！"),!1;if(1<l.length)return JE.alert("字段唯一标识只能选择一个！"),!1;if(i.pkName=l[0],this.userQuery){var o=n.queryType,d=n.queryPermType,r=n.quickQueryType;Ext.isEmpty(o)||Ext.each(o.split(","),function(e){i[e]="1"}),i.QUICKQUERY=r,i.QUERYPERM=d;var c=Ext.decode(n.otherParam);for(var s in c)i[s]=c[s]}else"searchfield"==this.fieldXtype?(i.queryField=Ext.value(n.queryField,""),i.showField=Ext.value(n.showField,"")):(JE.isNotEmpty(n.parentFunc)?(i.parentFunc=n.parentFunc,JE.isNotEmpty(n.parentFuncSql)&&(i.parentFuncSql=n.parentFuncSql),i.parentFunc=n.parentFunc):JE.isNotEmpty(n.childFunc)&&(i.childFunc=n.childFunc),"1"==n.showForm&&(i.showForm="1"),"1"==n.enableAdd&&(i.enableAdd="1",i.addText=Ext.value(n.addText,"添加"),"1"==n.addCommon&&(i.addCommon="1"),JE.isNotEmpty(n.addPerm)&&(i.addPerm=n.addPerm,i.addPermText=n.addPermText)));return Ext.each(["sqlRemark","gridTip"],function(e){JE.isNotEmpty(n[e])&&(i[e]=n[e])}),{configInfo:a,otherConfig:Ext.encode(i),whereSql:n.whereSql}},selectCols:function(i){var e=this.ownerCt.form.getValues(),t="codes"==this.name?e.funcId:e.selfFuncId;Ext.isEmpty(t)?JE.alert("请先选择目标功能在进行字段添加！"):JE.selectWin({title:this.title,configInfo:"JE_CORE_RESOURCECOLUMN,,,M",type:"grid",whereSql:" and RESOURCECOLUMN_FUNCINFO_ID = '"+t+"'",callback:function(e){var t=[];Ext.each(e,function(e){t.push({name:e.get("RESOURCECOLUMN_NAME"),code:e.get("RESOURCECOLUMN_CODE")})}),i.getStore().add(t)}})},getFuncCols:function(e,t){var i=JE.ajax({url:JE.getUrlMaps("je.core.develop.funcInfo","loadFunc"),params:{tableCode:"JE_CORE_RESOURCECOLUMN",limit:-1,funcId:e,whereSql:" and  RESOURCECOLUMN_FUNCINFO_ID = '"+e+"'"}}).rows,n={};Ext.each(i,function(e){n[e.RESOURCECOLUMN_CODE]={code:e.RESOURCECOLUMN_CODE,name:e.RESOURCECOLUMN_NAME}});var a=[];return Ext.each(t,function(e,t){Ext.isEmpty(n[e])||a.push(n[e])}),a}}),Ext.define("JE.sys.funccfg.view.field.FieldTextCode",{extend:"Ext.form.Panel",frame:!1,bodyPadding:"2",alias:"widget.funccfg.fieldtextcode",autoScroll:!0,layout:"fit",initComponent:function(){var a=this,e=a.formObj.form.getValues();a.loadConfigInfo(e),a.items={xtype:"jsonarrayfield",value:Ext.value(e.RESOURCEFIELD_CONFIGINFO,""),name:"textcodes",columnAlign:"left",columns:[{dataIndex:"qzfs",text:"取值方式",field:{xtype:"cbbfield",configInfo:"JE_FUNC_TEXTCODETYPE"},tactics:[{type:"dic",dicCode:"JE_FUNC_TEXTCODETYPE"}],renderer:JE.renderer},{dataIndex:"dyz",text:"对应[值]",width:200,field:{xtype:"cbbfield",editable:!0,dataArray:[]},dicData:a.dicData,tactics:[{type:"dic"}],renderer:JE.renderer},{dataIndex:"gs",text:"格式[日期用]",field:{xtype:"cbbfield",editable:!0,configInfo:"JE_CORE_DATAFORMAT"},tactics:[{type:"dic",dicCode:"JE_CORE_DATAFORMAT"}],renderer:function(e,t,i){var n=i.get("qzfs");return"LSH"!=n&&"CL"!=n||(t.style+="background-color:#7eadd9;"),e}},{dataIndex:"jq",text:"截取",renderer:function(e,t,i){var n=i.get("qzfs");return"LSH"!=n&&"CL"!=n||(t.style+="background-color:#7eadd9;"),e}},{dataIndex:"cd",text:"长度",width:40,field:{xtype:"numberfield",hideTrigger:!0},renderer:function(e,t,i){var n=i.get("qzfs");return"BDZD"!=n&&"QJBL"!=n&&"CL"!=n||(t.style+="background-color:#7eadd9;"),e}},{dataIndex:"qsh",text:"起始号",renderer:function(e,t,i){var n=i.get("qzfs");return"BDZD"!=n&&"QJBL"!=n&&"CL"!=n||(t.style+="background-color:#7eadd9;"),e}},{dataIndex:"bc",text:"步长",width:40,field:{xtype:"numberfield",hideTrigger:!0},renderer:function(e,t,i){var n=i.get("qzfs");return"BDZD"!=n&&"QJBL"!=n&&"CL"!=n||(t.style+="background-color:#7eadd9;"),e}},{dataIndex:"zq",text:"周期",width:60,field:{xtype:"cbbfield",configInfo:"JE_FUNC_ZQ"},tactics:[{type:"dic",dicCode:"JE_FUNC_ZQ"}],renderer:function(t,e,i){var n=i.get("qzfs");"BDZD"!=n&&"QJBL"!=n&&"CL"!=n||(e.style+="background-color:#7eadd9;");var a=JE.getDicItems("JE_FUNC_ZQ");return Ext.each(a,function(e){e.code!=t||(t=e.text)}),t}}],listeners:{afterrender:function(e){e.grid.on("beforeedit",function(e,t){var i=t.record.get("qzfs");if("LSH"==i&&-1!=["gs","jq"].indexOf(t.field))return!1;if("LSH"!=i&&-1!=["cd","qsh","bc","zq"].indexOf(t.field))return!1;if("CL"==i&&-1!=["gs","jq"].indexOf(t.field))return!1;if("dyz"==t.field){var n=[];"BDZD"==i?n=a.fieldData:"QJBL"==i?n=a.defsData:"LSH"==i&&(n=a.codeTypeData),t.column.getEditor().store.loadData(n)}})}}},a.callParent(arguments)},afterRender:function(){this.callParent(arguments)},loadConfigInfo:function(e){var t=this,i=e.RESOURCEFIELD_FUNCINFO_ID,n=JE.ajax({url:JE.getUrlMaps("je.core.develop.funcInfo","loadFunc"),params:{tableCode:"JE_CORE_RESOURCEFIELD",limit:-1,funcId:i,whereSql:" and  RESOURCEFIELD_FUNCINFO_ID = '"+i+"'"}}).rows;t.fieldData=[],Ext.each(n,function(e){t.fieldData.push({text:e.RESOURCEFIELD_NAME,code:e.RESOURCEFIELD_CODE})}),t.defsData=JE.getDicItems("JE_DEFAULEVALUE"),t.dicData={},Ext.each(t.fieldData.concat(t.defsData),function(e){t.dicData[e.code]=e}),t.codeTypeData=JE.getDicItems("JE_CORE_CODETYPE"),Ext.each(t.codeTypeData,function(e){t.dicData[e.code]=e})},setConfigInfo:function(){var e=this.getValues(),t=Ext.decode(Ext.value(e.textcodes,"[]"));Ext.each(t,function(e){if("LSH"==e.qzfs&&Ext.value(e.qsh,"0").length>1*Ext.value(e.cd,1))throw"编号规则不合法,起始号【"+e.qsh+"】大于了规定长度!"}),this.formObj.form.setValues({RESOURCEFIELD_CONFIGINFO:e.textcodes})}}),Ext.define("JE.sys.funccfg.view.form.FieldGrid",{extend:"Ext.grid.Panel",alias:"widget.funccfg.formfieldgrid",columnLines:!0,columns:[{text:"编码",dataIndex:"RESOURCEFIELD_CODE",width:120},{text:"名称",dataIndex:"RESOURCEFIELD_NAME",width:120},{text:"类型",dataIndex:"RESOURCEFIELD_XTYPE",width:70,tactics:[{type:"dic",dicCode:"JE_FUNC_XTYPE"}],renderer:JE.renderer}],info:{tableName:"JE_CORE_RESOURCEFIELD",pkName:"JE_CORE_RESOURCEFIELD_ID"},initComponent:function(){var E=this,e=E.funcInfo;E.store=JE.getStore({tableName:"JE_CORE_RESOURCEFIELD",autoLoad:!0,params:{limit:-1,whereSql:"and RESOURCEFIELD_FUNCINFO_ID = '"+e.funcId+"' and RESOURCEFIELD_XTYPE NOT IN('fieldset')",funcId:e.funcId,orderSql:"order by SY_ORDERINDEX ASC"},url:JE.getUrlMaps("je.core.develop.funcInfo","loadFunc")}),(E.store.gridObj=E).relayEvents(E.store,["beforeload","load"]),E.dockedItems=[{xtype:"toolbar",dock:"top",items:[{xtype:"yesnofield",fieldLabel:"启用",labelWidth:40,name:"useTableForm"},{xtype:"cbbfield",fieldLabel:"纸张",labelWidth:40,width:120,name:"pageType",hideTrigger1:!0,configInfo:"JE_CORE_PAGESIZE",inputAttrTpl:'title="可编辑纸张(cm)：宽*长"',editable:!0,listeners:{change:function(e,t){if(!Ext.isEmpty(t)){var i=Number(t.split("*")[0]),n=Number(t.split("*")[1]);Ext.isNumeric(i)&&Ext.isNumeric(n)&&E.ownerCt.changePageSize(i,n)}}}},{xtype:"yesnofield",boxLabel:"直接打印",name:"print"},"->",{iconCls:"jeicon jeicon-save",handler:function(){E.ownerCt.saveTableTpl()}},{iconCls:"jeicon jeicon-form-adjustment",handler:function(){E.ownerCt.previewForm()}}]}],E.dockedItems.push({xtype:"toolbar",dock:"top",items:[{xtype:"yesnofield",fieldLabel:"打印按钮",labelWidth:60,boxLabel:"启用",name:"enableFormPrint"},{xtype:"textfield",labelWidth:110,width:160,fieldLabel:"功能表单纸张宽度",name:"tableFormWidth2",listeners:{blur:function(e){var t=Number(e.getValue(),0);0<t&&(E.ownerCt.pageBox.getEl().setStyle({width:t+"px"}),E.ownerCt.ckPanel.editor.setWidth(t-40+16+4))}}},"px"]}),E.viewConfig={getRowClass:function(e,t,i,n){return"1"==e.get("SY_FLAG")?"je-display-none":""}},E.callParent(arguments),E.on("cellclick",function(e,t,i,n,a,l,o,d){var r=e.panel.columnManager.getHeaderAtIndex(i),c=n.get(r.dataIndex);if(E.ckPanel||(E.ckPanel=E.ownerCt.ckPanel),"RESOURCEFIELD_CODE"==r.dataIndex){var s=Ext.get(E.ckPanel.editor.editor.body).query("input[type=button][name="+n.get("RESOURCEFIELD_CODE")+"]");Ext.isEmpty(s)&&E.ckPanel.editor.setHtml('<input type="button" name="'+n.get("RESOURCEFIELD_CODE")+'" value="【'+n.get("RESOURCEFIELD_NAME")+'】" style="height: 18px;padding: 0px;margin: 0px;" />',"insert"),n.set("SY_FLAG","1")}else"RESOURCEFIELD_NAME"==r.dataIndex&&E.ckPanel.editor.setHtml(c,"insert")}),E.on("load",function(e){if(!JE.isEmpty(E.funcInfo.tableFormTpl)){var t=document.createElement("DIV");t.innerHTML=E.funcInfo.tableFormTpl;var i=Ext.DomQuery.select("input[type=button]",t),n=[];Ext.each(i,function(e){var t=e.getAttribute("name");n.push(t)}),Ext.get(t).remove(),e.each(function(e){-1!=n.indexOf(e.get("RESOURCEFIELD_CODE"))&&e.set("SY_FLAG","1")})}})},afterRender:function(){this.funcInfo;this.ckPanel=this.ownerCt.ckPanel,this.callParent(arguments)}}),Ext.define("JE.sys.funccfg.view.form.Form",{extend:"Ext.panel.Panel",alias:"widget.funccfg.form",layout:"border",initComponent:function(){var i=this;if(!i.funcInfo&&i.funcCode){var e=JE.getFuncData(i.funcCode);i.funcInfo=Ext.clone(e.info)}i.items=[{xtype:"panel",region:"center",autoScroll:!0,itemId:"editorPanel",bodyStyle:"background-color:#dfe8f6;",layout:{type:"table",tableAttrs:{align:"center"},columns:1},margin:"2 2 2 0",items:[{xtype:"ueditor",value:i.funcInfo.tableFormTpl,listeners:{editorready:function(e){e.ownerCt.editor=e;var t=Ext.value(i.funcInfo.tableFormWidth,"210")+"*"+Ext.value(i.funcInfo.tableFormHeight,"297");t="0*0"==t?"210*297":t,i.pageType.setValue(t),0<i.funcInfo.tableFormWidth2&&(i.tableFormWidth2.setValue(i.funcInfo.tableFormWidth2),i.tableFormWidth2.fireEvent("blur",i.tableFormWidth2));var a=new baidu.editor.ui.Popup({editor:e.editor,content:"",className:"edui-bubble",_edittext:function(){JE.formWin({title:"字段属性",width:400,height:300,useButton:!0,items:i.getFieldAttr(),showFn:function(e){e.getCmp("form").form.getFields().each(function(e){var t=Ext.value(a.anchorEl.getAttribute("data-"+e.name),"");"btnText"==e.name?t=Ext.value(t,a.anchorEl.getAttribute("value")):"fieldCode"==e.name&&(t=a.anchorEl.getAttribute("name")),e.setValue(t)})},fn:function(e,t){Ext.iterate(e,function(e,t){a.anchorEl.setAttribute("data-"+e,t)}),JE.isNotEmpty(e.btnText)&&a.anchorEl.setAttribute("value",e.btnText),a.hide()}})},_delete:function(){var e=this.anchorEl.getAttribute("name");baidu.editor.dom.domUtils.remove(this.anchorEl,!1),this.hide();var t=i.fieldGrid.store.findRecord("RESOURCEFIELD_CODE",e,0,!1,!1,!0);t&&t.set("SY_FLAG","")},_editField:function(){var e=a.anchorEl.getAttribute("name");JE.showFuncCfg(i.funcInfo.funcId,"fieldform",e,{onlyField:!0})}});a.render(),e.editor.addListener("mouseover",function(e,t){var i=(t=t||window.event).target||t.srcElement;if("button"==i.getAttribute("type")){var n=a.formatHtml('<nobr><span onclick=$$._edittext() class="edui-clickable">编辑</span>&nbsp;&nbsp;<span onclick=$$._delete() class="edui-clickable">删除</span>&nbsp;&nbsp;<span onclick=$$._editField() class="edui-clickable">编辑字段</span></nobr>');n?(a.getDom("content").innerHTML=n,a.anchorEl=i,a.showAnchor(a.anchorEl)):a.hide()}})}}},{xtype:"box",itemId:"pageBox"}]},{xtype:"funccfg.formfieldgrid",width:320,margin:"2 0 2 2",split:!0,itemId:"fieldGrid",funcInfo:i.funcInfo,minWidth:200,region:"west"}],i.callParent(arguments)},afterRender:function(){var e=this,t=e.funcInfo;e.callParent(arguments),e.ckPanel=e.getComponent("editorPanel"),e.pageBox=e.ckPanel.getComponent("pageBox"),e.fieldGrid=e.getComponent("fieldGrid"),e.tfField=e.fieldGrid.down("yesnofield[name=useTableForm]"),e.printField=e.fieldGrid.down("yesnofield[name=print]"),e.fpField=e.fieldGrid.down("yesnofield[name=enableFormPrint]"),e.pageType=e.fieldGrid.down("cbbfield[name=pageType]"),e.tableFormWidth2=e.fieldGrid.down("textfield[name=tableFormWidth2]"),e.tfField.setValue(t.useTableForm),e.fpField.setValue(t.enableFormPrint),e.printField.setValue(t.tableFormPrint)},changePageSize:function(e,t){var i=this;i.pageBox.getEl().setStyle({width:e+"mm",height:t+"mm"}),i.ckPanel.editor.setSize(i.pageBox.getSize().width-40+16+4,i.pageBox.getSize().height),i.pageBox.getEl().setStyle({height:"0px"}),i.tableFormWidth2.setValue(i.pageBox.getSize().width)},previewForm:function(e){var t=this,i=t.funcInfo,n=t.ckPanel.editor,a=JE.getFuncData(i.funcCode),l=t.tableFormWidth2.getValue(),o=t.pageType.getValue(),d=o.split("*")[0],r=o.split("*")[1];t.fieldGrid.store.each(function(e){a.basicFields[e.get("RESOURCEFIELD_CODE")]||(a=JE.getFuncData(i.funcCode,{refresh:!0}))}),a.info.tableFormTpl=n.getHtml(),a.info.useTableForm=!0,a.info.tableFormWidth2=l,a.info.tableFormWidth=d,a.info.tableFormHeight=r,a.info.tableFormPrint=JE.toBool(t.printField.getValue()),a.info.idSuffix="_preview",1!=e&&JE.win({title:"表格表单",border:0,items:{xtype:"jeformview",useTBar:!1,funcData:a}}).show()},saveTableTpl:function(){var e=this,t=e.getComponent("editorPanel").editor.getHtml(),i=e.tfField.getSubmitValue(),n=e.fpField.getSubmitValue(),a=e.tableFormWidth2.getValue(),l=e.pageType.getValue(),o=l.split("*")[0],d=l.split("*")[1],r=e.printField.getSubmitValue(),c=JE.ajax({url:JE.getUrlMaps("je.core.develop.funcInfo","doUpdateInfo"),params:{JE_CORE_FUNCINFO_ID:e.funcInfo.funcId,tableCode:"JE_CORE_FUNCINFO",_updatefields_:"FUNCINFO_TABLEFORMTPL,FUNCINFO_TABLEFORM,FUNCINFO_TABLEFORMWIDTH2,FUNCINFO_TABLEFORMWIDTH,FUNCINFO_TABLEFORMHEIGHT,FUNCINFO_ENABLEFORMPRINT,FUNCINFO_TABLEFORMPRINT",FUNCINFO_TABLEFORMTPL:t,FUNCINFO_TABLEFORM:i,FUNCINFO_TABLEFORMWIDTH2:a,FUNCINFO_TABLEFORMWIDTH:o,FUNCINFO_TABLEFORMHEIGHT:d,FUNCINFO_ENABLEFORMPRINT:n,FUNCINFO_TABLEFORMPRINT:r}});if(c.success){JE.msg("保存成功！");var s=e.funcInfo;s.tableFormTpl=t,s.useTableForm=JE.toBool(i),s.enableFormPrint=JE.toBool(n),s.tableFormWidth2=a,s.tableFormWidth=o,s.tableFormHeight=d,s.tableFormPrint=JE.toBool(r),Ext.apply(JE.cacheFunc[s.funcCode].info,s)}else JE.alert(c.obj);e.funcFormObj&&e.funcFormObj.form.setValues({FUNCINFO_TABLEFORMTPL:t,FUNCINFO_TABLEFORM:i,FUNCINFO_TABLEFORMWIDTH2:a,FUNCINFO_TABLEFORMWIDTH:o,FUNCINFO_TABLEFORMHEIGHT:d,FUNCINFO_ENABLEFORMPRINT:n,FUNCINFO_TABLEFORMPRINT:r})},getFieldAttr:function(){return[{fieldLabel:"按钮文字",name:"btnText"},{fieldLabel:"宽",name:"width"},{fieldLabel:"高",name:"height"},{fieldLabel:"不换行",xtype:"yesnofield",name:"nobar",boxLabel:"启用后,请给字段设置宽;若宽为空,默认父容器的宽度"},{fieldLabel:"字体颜色",xtype:"colorfield",name:"fontcolor"},{fieldLabel:"字体样式",xtype:"cbbfield",name:"fontfamily",editable:!0,dataArray:[{code:"宋体",text:"宋体"},{code:"黑体",text:"黑体"},{code:"楷体",text:"楷体"},{code:"隶书",text:"隶书"},{code:"微软雅黑",text:"微软雅黑"}]},{fieldLabel:"字体大小",unitTpl:"px",name:"fontsize"},{fieldLabel:"字段编码",name:"fieldCode",xtype:"displayfield"}]}}),Ext.define("JE.sys.funccfg.view.funcrelyon.FuncRelyon",{extend:"Ext.panel.Panel",alias:"widget.funccfg.funcrelyon",id:"funccfg.funcrelyon",layout:"fit",initComponent:function(){this.items=[{xtype:"funccfg.funcrelyongrid"}],this.callParent(arguments)},setViewReadOnly:function(e){var t=this.down("panel[xtype=funccfg.funcrelyongrid]");t&&t.setDisabled(e)},loadFunc:function(e){var t=Ext.getCmp("funccfg.funcrelyongrid"),i=" and FUNCRELYON_FUNCINFO_ID = '"+(t.funcId=e)+"'";t.getStore().proxy.extraParams.baseSql=i,t.getStore().proxy.extraParams.whereSql=i,t.getStore().proxy.extraParams.orderSql=" order by SY_ORDERINDEX ASC ",t.getStore().load()}}),Ext.define("JE.sys.funccfg.view.funcrelyon.FuncRelyonGrid",{extend:"Ext.grid.Panel",alias:"widget.funccfg.funcrelyongrid",id:"funccfg.funcrelyongrid",border:0,selModel:{selType:"checkboxmodel"},columnLines:!0,frame:!1,multiSelect:!0,enableKeyNav:!0,cls:"je-funcrelyongridFunc-config",columns:[{text:"功能名称",dataIndex:"FUNCRELYON_FUNCNAME",width:160},{text:"功能编码",dataIndex:"FUNCRELYON_FUNCCODE",width:160},{text:"依赖关系",dataIndex:"FUNCRELYON_REGARD",width:150,tactics:[{type:"dic",dicCode:"JE_FUNC_REGARD"}],renderer:JE.renderer},{text:"依赖类型",dataIndex:"FUNCRELYON_RELYTYPE",width:150,tactics:[{type:"dic",dicCode:"JE_FUNC_RELYTYPE"}],renderer:JE.renderer},{text:"顺序",dataIndex:"SY_ORDERINDEX",width:50,hidden:!0},{text:"解除关系",xtype:"actioncolumn",align:"center",width:60,items:[{iconCls:"jeicon jeicon-error",tooltip:"解除关系",handler:function(e,t,i){var n=e.panel,a=n.getStore().getAt(t);JE.confirm("是否解除与【"+a.get("FUNCRELYON_FUNCNAME")+"】功能的软连接关系？",function(e,t){if("ok"==e){var i=JE.ajax({url:JE.getUrlMaps("je.core.develop.funcInfo","removeFunRelyon"),params:{tableCode:"JE_CORE_FUNCRELYON",ids:a.get("JE_CORE_FUNCRELYON_ID")}});i.success?(n.getStore().remove(a),JE.msg("关系已成功解除!")):JE.alert(i.obj)}})}}]}],initComponent:function(){this.store=JE.getStore({tableName:"JE_CORE_FUNCRELYON",action:JE.getUrlMaps("je.core")}),this.plugins=[Ext.create("Ext.grid.plugin.CellEditing",{clicksToEdit:1,pluginId:"cellEdit"})],this.callParent(arguments)}}),Ext.define("JE.sys.funccfg.view.groupquery.GroupQueryGrid",{extend:"Ext.grid.Panel",alias:"widget.funccfg.groupquerygrid",selModel:{selType:"checkboxmodel"},mixins:["JE.sys.funccfg.view.jseditor.Util"],columnLines:!0,multiSelect:!0,enableKeyNav:!0,frame:!1,plugins:[Ext.create("Ext.grid.plugin.CellEditing",{clicksToEdit:1,pluginId:"cellEdit"})],viewConfig:{plugins:{ptype:"gridviewdragdrop",dragText:"拖动排序",pluginId:"ddOrder"},listeners:{drop:function(e,t,i,n){var a=Ext.value(1,1);me.store.each(function(e,t){e.get("GROUPQUERY_PX")!=a&&e.set("GROUPQUERY_PX",a),a++})}}},initComponent:function(){me=this,me.tbar=[{xtype:"button",ref:"impl",text:"导入",iconCls:"jeicon jeicon-import",handler:function(){me.doLead()}},{xtype:"button",ref:"listupdate",text:"保存",iconCls:"jeicon jeicon-form-editing",handler:function(){me.doSave("update")}},{xtype:"button",ref:"remove",text:"删除",iconCls:"jeicon jeicon-delete-form",handler:function(){me.doDel()}}],me.columns=[{text:"序号",dataIndex:"GROUPQUERY_PX",width:40,align:"center"},{text:"编码",dataIndex:"GROUPQUERY_BM",width:150},{text:"名称",dataIndex:"GROUPQUERY_MC",width:110,field:{xtype:"textfield",selectOnFocus:!0,editor:!0,allowBlank:!1}},{text:"英文名称",dataIndex:"GROUPQUERY_YWMC",width:110,field:{xtype:"textfield",selectOnFocus:!0,editor:!0,allowBlank:!1}},{text:"查询类型",dataIndex:"GROUPQUERY_CXLX",width:100,field:{xtype:"cbbfield",editor:!0,value:"no",configInfo:"JE_CORE_COLUMNQUERYTYPE",dicItemCodes:["like","like%","=","no"]},tactics:[{type:"dic",dicCode:"JE_CORE_COLUMNQUERYTYPE"}],renderer:JE.renderer},{text:"所占列数",dataIndex:"GROUPQUERY_SZLS",width:85,field:{xtype:"numberfield",selectOnFocus:!0,value:50,minValue:1,step:1}},{text:"宽度",dataIndex:"GROUPQUERY_KD",width:110,field:{xtype:"numberfield",selectOnFocus:!0,value:50,minValue:5,step:5}},{text:"标签宽度",dataIndex:"GROUPQUERY_BQKD",width:110,field:{xtype:"numberfield",selectOnFocus:!0,value:50,minValue:5,step:5}},{text:"排序类型",dataIndex:"GROUPQUERY_PXLX",width:110,field:{xtype:"cbbfield",editor:!0,value:"no",dataArray:[{text:"正序",code:"ASC"},{text:"倒序",code:"DESC"},{text:"无",code:"no"}]},renderer:function(e){return"ASC"==e?"正序":"DESC"==e?"倒序":"无"}},{text:"标签隐藏",dataIndex:"GROUPQUERY_BQYC",width:110,xtype:"uxcheckcolumn"},{text:"常用查询",dataIndex:"GROUPQUERY_CYCX",width:110,xtype:"uxcheckcolumn"}],me.store=JE.getStore({id:"JE_CORE_GROUPQUERY_ID",tableName:"JE_CORE_GROUPQUERY",params:{whereSql:"AND GROUPQUERY_GNID='"+me.funcInfo.funcId+"'",orderSql:"order by GROUPQUERY_PX ASC"},autoLoad:!0}),me.callParent(arguments)},doLead:function(){var i=this,e=i.funcInfo.funcId;JE.selectWin({title:"列",configInfo:"JE_CORE_RESOURCECOLUMN,,,M",type:"grid",whereSql:"AND RESOURCECOLUMN_FUNCINFO_ID='"+e+"'",okButtonClick:function(e,t){i.doSave("save",e)}})},doSave:function(e,t){var n=this;if("save"==e){var a=[],l=n.getStore().data.items;1<=l.length?i=l.length:i=0;var o=JE.toNum(i);if(Ext.each(t,function(e){n.getStore().findRecord("GROUPQUERY_BM",e.get("RESOURCECOLUMN_CODE"))||(++o,a.push({GROUPQUERY_PX:o,GROUPQUERY_BM:e.data.RESOURCECOLUMN_CODE,GROUPQUERY_MC:e.data.RESOURCECOLUMN_NAME,GROUPQUERY_YWMC:e.data.RESOURCECOLUMN_NAME_EN,GROUPQUERY_GNID:n.funcInfo.funcId,GROUPQUERY_CXLX:"no",GROUPQUERY_SZLS:"1",GROUPQUERY_KD:"150",GROUPQUERY_BQKD:"80",GROUPQUERY_PXLX:"no"}))}),JE.isNotEmpty(a))(d=JE.ajax({url:JE.getUrlMaps("je.core.develop.gantt","doInsertUpdateList"),params:{tableCode:"JE_CORE_GROUPQUERY",strData:Ext.encode(a)}})).success?(JE.msg("导入成功!"),Ext.each(d.obj,function(e){n.store.add(e)})):JE.msg(d.obj);else JE.msg("该字段已存在!")}else if("update"==e||"del"==e){a=[];var d,r=n.store.getUpdatedRecords();if(Ext.each(r,function(e){var t=e.getChanges();Ext.Object.isEmpty(t)||(t.JE_CORE_GROUPQUERY_ID=e.data.JE_CORE_GROUPQUERY_ID),a.push(t)}),JE.isNotEmpty(a))(d=JE.ajax({url:JE.getUrlMaps("je.core.develop.gantt","doInsertUpdateList"),params:{tableCode:"JE_CORE_GROUPQUERY",strData:Ext.encode(a)}})).success?("update"==e&&JE.msg("保存成功!"),n.store.reload()):JE.msg(d.obj);else"del"!=e&&JE.msg("没有数据修改!")}},doDel:function(){var a=this,l=[];JE.confirm("确定删除吗？",function(e){if("ok"==e){var t=a.getSelectionModel().getSelection();Ext.each(t,function(e){l.push(e.data.JE_CORE_GROUPQUERY_ID)});var i=JE.ajax({url:JE.getUrlMaps("je.core","doRemove"),params:{tableCode:"JE_CORE_GROUPQUERY",ids:l.join(",")}});if(i.success){JE.msg("删除成功!"),a.store.remove(t);var n=Ext.value(1,1);a.store.each(function(e,t){e.get("GROUPQUERY_PX")!=n&&e.set("GROUPQUERY_PX",n),n++,a.doSave("del")})}else JE.msg(i.obj)}})}}),Ext.define("JE.sys.funccfg.view.groupquery.GroupQueryView",{extend:"Ext.panel.Panel",border:0,alias:"widget.funccfg.groupqeryview",id:"funccfg.groupqeryview",layout:"border",requires:["JE.sys.funccfg.view.groupquery.GroupQueryGrid"],initComponent:function(){me=this;var e=me.funcInfo;me.items=[{region:"center",xtype:"funccfg.groupquerygrid",funcInfo:e}],me.callParent(arguments)}}),Ext.define("JE.sys.funccfg.view.help.FuncHelp",{extend:"Ext.panel.Panel",alias:"widget.funccfg.funchelp",id:"funccfg.funchelp",layout:"fit",initComponent:function(){this.bodyStyle="border-width:0px;",this.tbar={itemId:"tbar",items:[{xtype:"button",text:"保存",ref:"formSaveBtn",iconCls:"jeicon jeicon-save"},{xtype:"gridssfield",fieldLabel:"参数数据源",labelAlign:"right",itemId:"FUNCINFO_HELPSOURCE_TEXT",configInfo:"JE_CORE_DATASOURCE,,,S",whereSql:" AND DATASOURCE_TYPE IN('js','action')",width:300,listeners:{query:function(e,t){var i=t[0];i&&(e.ownerCt.getCmp("FUNCINFO_HELPSOURCE_TEXT").setValue(i.get("DATASOURCE_TEXT")),e.ownerCt.getCmp("FUNCINFO_HELPSOURCE").setValue(i.get("DATASOURCE_CODE")))}}},{xtype:"hidden",itemId:"FUNCINFO_HELPSOURCE"},{xtype:"box",style:"color:#444;",html:'<span style="color:red;margin-left: 10px;font-weight: bold;">注：</span>只支持公共数据源的JS和Action数据源，返回数据格式为{fields:"empty",data:{参数名1:"参数值",参数名2:"参数值"}}'}]},this.items=[{xtype:"ckeditor",jeFileType:"PLATFORM",itemId:"FUNCINFO_HELP",name:"FUNCINFO_HELP"}],this.callParent(arguments)},loadFunc:function(e){var t=this;t.funcId=e;Ext.getCmp("funccfg.func");var i,n=JE.ajax({url:JE.getUrlMaps("je.core.develop.funcInfo","getInfoById"),params:{tableCode:"JE_CORE_FUNCINFO",pkValue:e,queryColumns:"JE_CORE_FUNCINFO_ID,FUNCINFO_HELP,FUNCINFO_HELPSOURCE_TEXT,FUNCINFO_HELPSOURCE"}});t.tableCode="JE_CORE_FUNCINFO",i=n.FUNCINFO_HELP,t.oldValue=i,t.getCmp("FUNCINFO_HELP").setValue(i),t.getDockedCmp("tbar").getCmp("FUNCINFO_HELPSOURCE").setValue(n.FUNCINFO_HELPSOURCE),t.getDockedCmp("tbar").getCmp("FUNCINFO_HELPSOURCE_TEXT").setValue(n.FUNCINFO_HELPSOURCE_TEXT)}}),Ext.define("JE.sys.funccfg.view.jseditor.JSCodeEditor",{extend:"JE.core.view.ListenerEditor",alias:"widget.funccfg.jscodeeditor",initComponent:function(){this.callParent(arguments)}}),Ext.define("JE.sys.funccfg.view.lodop.FieldGrid",{extend:"Ext.grid.Panel",alias:"widget.funccfg.lodopfieldgrid",columnLines:!0,columns:[{text:"编码",dataIndex:"RESOURCEFIELD_CODE",flex:1},{text:"名称",dataIndex:"RESOURCEFIELD_NAME",flex:1}],info:{tableName:"JE_CORE_RESOURCEFIELD",pkName:"JE_CORE_RESOURCEFIELD_ID"},initComponent:function(){var E=this,e=E.funcInfo;E.store=JE.getStore({tableName:"JE_CORE_RESOURCEFIELD",autoLoad:!0,params:{limit:-1,whereSql:"and RESOURCEFIELD_FUNCINFO_ID = '"+e.funcId+"' and RESOURCEFIELD_XTYPE NOT IN ('fieldset')",orderSql:"order by SY_ORDERINDEX ASC",funcId:e.funcId},url:JE.getUrlMaps("je.core.develop.funcInfo","loadFunc")}),(E.store.gridObj=E).relayEvents(E.store,["beforeload","load"]),E.viewConfig={getRowClass:function(e,t,i,n){return"1"==e.get("SY_FLAG")?"je-display-none":""}},E.callParent(arguments),E.on("cellclick",function(e,t,i,n,a,l,o,d){var r=e.panel.columnManager.getHeaderAtIndex(i),c=n.get(r.dataIndex),s=E.ownerCt.LODOP;"RESOURCEFIELD_CODE"==r.dataIndex?s.GET_VALUE("ItemIsAdded",c)||s.ADD_PRINT_TEXTA(c,56,32,175,24,"{"+c+"}"):"RESOURCEFIELD_NAME"==r.dataIndex&&s.ADD_PRINT_TEXTA("",56,32,175,24,c)})},afterRender:function(){this.funcInfo;this.callParent(arguments)}}),Ext.define("JE.sys.funccfg.view.lodop.Form",{extend:"Ext.panel.Panel",alias:"widget.funccfg.lodopform",layout:"border",initComponent:function(){var me=this;if(!me.funcInfo&&me.funcCode){var func=JE.getFuncData(me.funcCode);me.funcInfo=Ext.clone(func.info)}me.items=[{xtype:"box",region:"center",margin:"2 2 2 0",itemId:"editorPanel",html:'<object  style="width:100%;height:100%;" '+(Ext.isIE?'classid="clsid:2105C259-1E0C-4534-8141-A753534CB4CA"':'type="application/x-print-lodop"')+" ></object>"},{xtype:"funccfg.lodopfieldgrid",width:300,margin:"2 0 2 2",split:!0,itemId:"fieldGrid",funcInfo:me.funcInfo,minWidth:200,region:"west"}],me.tbar={itemId:"btnBar",defaults:{labelAlign:"right"},items:[{xtype:"cbbfield",fieldLabel:"纸张",labelWidth:40,width:200,itemId:"pageType",name:"pageType",value:"A4",hideTrigger1:!0},{xtype:"yesnofield",fieldLabel:"横向打印",labelWidth:60,name:"hPrint",itemId:"hPrint"},{text:"应用",handler:function(e){var t=me.getDockedCmp("btnBar").getCmp("pageType").getValue(),i=me.getDockedCmp("btnBar").getCmp("hPrint").getValue();me.changePageSize(i,t)}},"-",{text:"设置背景图片",iconCls:"jeicon jeicon-photo",handler:function(e){JE.uploadFile({fileTypes:"jpg;png;jpeg;bmp",uploadFilePath:"/lodopBG",params:{jeFileType:"PROJECT",funcCode:"JE_CORE_FUNCINFO",tableCode:"JE_CORE_FUNCINFO",beanTableCode:"JE_CORE_FUNCINFO",pkValue:me.funcInfo.funcId,returnType:"all"},x:0,y:0,callback:function(e){var t=e.privateUrl||JE.getFileUrl(e.url,"PUBLIC","","","JE_CORE_FUNCINFO");me.LODOP.ADD_PRINT_SETUP_BKIMG("<img border='0' src='"+t+"'>")}})}},"-",{xtype:"cgroup",itemId:"lodopPrint",name:"lodopPrint",width:230,dataArray:[{code:"FORM",text:"表单启用"},{code:"GRID",text:"列表启用"},{code:"PRINT",text:"直接打印"}]},{iconCls:"jeicon jeicon-save",xtype:"button",handler:function(e){var t=me.LODOP.GET_VALUE("ProgramCodes",0),i=e.previousSibling().getValue(),n=t.split(";");n.shift();var a=me.getDockedCmp("btnBar").getCmp("width").getValue(),l=me.getDockedCmp("btnBar").getCmp("height").getValue();if(0<a&&0<l){var o=me.getDockedCmp("btnBar").getCmp("hPrint").getValue();o=o?2:1,n.push("LODOP.SET_PRINT_PAGESIZE ("+o+","+10*a+","+10*l+',"")')}t=n.join(";");var d=JE.ajax({url:JE.getUrlMaps("je.core.develop.funcInfo","updateInfo"),params:{JE_CORE_FUNCINFO_ID:me.funcInfo.funcId,tableCode:"JE_CORE_FUNCINFO",_updatefields_:"FUNCINFO_LODOPPRINT,FUNCINFO_LODOPCONFIG",FUNCINFO_LODOPPRINT:i,FUNCINFO_LODOPCONFIG:JE.encodeURI(t)}});if(d.success){JE.msg("保存成功！");var r=me.funcInfo;r.lodopPrint=i,r.lodopConfig=JE.encodeURI(t)}else JE.alert(d.obj)}},{iconCls:"jeicon jeicon-form-adjustment",handler:function(btn){var LODOP=JE.getLodop(),code=me.LODOP.GET_VALUE("ProgramCodes",0);eval(code);var width=me.getDockedCmp("btnBar").getCmp("width").getValue(),height=me.getDockedCmp("btnBar").getCmp("height").getValue();if(0<width&&0<height){var hPrint=me.getDockedCmp("btnBar").getCmp("hPrint").getValue();hPrint=hPrint?2:1,width*=10,height*=10,LODOP.SET_PRINT_PAGESIZE(hPrint,width,height,"")}LODOP.PREVIEW()}},"-",{fieldLabel:"自定义纸张",labelWidth:80,xtype:"numberfield",unitTpl:"mm",emptyText:"宽",itemId:"width",width:180,minValue:0},{xtype:"numberfield",unitTpl:"mm",emptyText:"高",itemId:"height",width:100,minValue:0}]},me.callParent(arguments),me.editorPanel=me.getCmp("editorPanel")},afterRender:function(){var me=this,info=me.funcInfo;me.callParent(arguments);var obj=me.getCmp("editorPanel").getEl().first().dom,LODOP=me.LODOP=JE.getLodop(obj);LODOP.PRINT_INIT("打印维护"),LODOP.SET_SHOW_MODE("DESIGN_IN_BROWSE",1),LODOP.SET_SHOW_MODE("SETUP_ENABLESS","11111111000000"),LODOP.SET_SHOW_MODE("HIDE_GROUND_LOCK",!0),LODOP.SET_SHOW_MODE("HIDE_PBUTTIN_SETUP",!0),LODOP.SET_SHOW_MODE("HIDE_VBUTTIN_SETUP",!0),LODOP.SET_SHOW_MODE("HIDE_ABUTTIN_SETUP",!0),LODOP.SET_SHOW_MODE("HIDE_RBUTTIN_SETUP",!0),LODOP.PRINT_DESIGN();var btnBar=me.getDockedCmp("btnBar"),pageTypeField=btnBar.getCmp("pageType"),data=[];Ext.each(LODOP.GET_PAGESIZES_LIST(-1,",").split(","),function(e){data.push({code:e,text:e})}),pageTypeField.store.add(data),btnBar.getCmp("lodopPrint").setValue(Ext.value(info.lodopPrint,""));var pageType="A4",hPrint=1;JE.isNotEmpty(info.lodopConfig)&&(eval(JE.decodeURI(info.lodopConfig)),pageType=LODOP.GET_VALUE("PRINTSETUP_PAGESIZE_NAME",0),hPrint=1==LODOP.GET_VALUE("PRINTSETUP_ORIENT",0)?2:1),pageTypeField.setValue(pageType),btnBar.getCmp("hPrint").setValue(2==hPrint),me.changePageSize(2==hPrint,pageType)},changePageSize:function(e,t){var i=this,n="WIDTH",a="HEIGHT";2==(e=e?2:1)&&(n="HEIGHT",a="WIDTH"),i.LODOP.SET_PRINT_PAGESIZE(e,0,0,t);var l=i.LODOP.GET_VALUE("PRINTSETUP_PAGE_"+n,0),o=i.LODOP.GET_VALUE("PRINTSETUP_PAGE_"+a,0);i.LODOP.SET_PRINT_PAGESIZE(e,l,o,""),i.LODOP.SET_PRINT_PAGESIZE(e,0,0,t)}}),Ext.define("JE.sys.funccfg.view.other.ExJSView",{extend:"Ext.window.Window",alias:"widget.funccfg.exjsview",layout:"fit",modal:!0,closeOk:!1,title:"js生成器",width:900,height:550,maximizable:!0,initComponent:function(){var a=this,e={xtype:"form",autoScroll:!0,border:0,layout:"column",bodyPadding:"4",defaults:{labelWidth:80,labelAlign:"right",padding:"0 0 4 0"},items:[{xtype:"textfield",fieldLabel:"类名",allowBlank:!1,name:"className",columnWidth:.5,listeners:{change:function(e,t,i){var n=e.up("form").form,a="",l="";Ext.isEmpty(t)?l=a="":-1!=t.indexOf("PRO.")&&(-1==(t=t.replace("PRO.","PRO/")).indexOf(".")?l=a="":(a=t.substring(t.lastIndexOf(".")+1),Ext.isEmpty(a)?l=a="":(l=t.replace("."+a,"/").replaceAll("\\.","/"),a+=".js"))),n.findField("filePath").setValue(l),n.findField("fileName").setValue(a)}}},{xtype:"textfield",fieldLabel:"用途",allowBlank:!1,name:"use",columnWidth:.5},{xtype:"treepanel",height:400,useArrows:!0,columnWidth:.6,selModel:{selType:"treemodel",allowDeselect:!0,mode:"SINGLE"},viewConfig:{selectedItemCls:"x-tree-row-selected",focusedItemCls:"x-tree-row-focused",beforeFocusedItemCls:"x-tree-row-before-focused",tableFocusedFirstCls:"x-tree-table-focused-first"},fields:["info","type","text"],title:"方法事件",rootVisible:!1,listeners:{selectionchange:a.lobj.selectionchange},root:{text:"ROOT",expanded:!0}},{xtype:"form",border:0,ref:"eventForm",autoScroll:!0,columnWidth:.4,height:400,bodyPadding:"0 0 0 4",buttons:[{text:"删除",ref:"delete",handler:a.lobj.deleteBtn},{text:"保存",ref:"save",handler:a.lobj.saveBtn},{text:"添加方法",ref:"add",handler:a.lobj.addBtn}],buttonAlign:"center",items:[{xtype:"fieldset",title:"注册对象配置项",ref:"method",collapsible:!0,listeners:{expand:a.lobj.fsExpand},defaults:{labelWidth:60,anchor:"100%",labelAlign:"right"},layout:"anchor",items:[{xtype:"textfield",fieldLabel:"对象简述",name:"methodName"},{xtype:"textfield",fieldLabel:"用途",name:"methodUse"},{xtype:"textfield",fieldLabel:"功能编码",value:a.formValues.FUNCINFO_FUNCCODE,name:"funcCode",listeners:{change:function(e,t,i){var n=e.up("form").form;a.lobj.doRegister(n)}}},{xtype:"cbbfield",fieldLabel:"操作范围",name:"doScope",value:"grid",dataArray:[{text:"grid",code:"grid"},{text:"form",code:"form"}],listeners:{select:a.lobj.doScopeSelect,change:function(e,t,i){var n=e.up("form").form;a.lobj.doRegister(n)}}},{xtype:"cbbfield",fieldLabel:"操作类型",name:"doType",value:"self",dataArray:[{text:"本身",code:"self"},{text:"按钮",code:"button"},{text:"字段",code:"field"}],listeners:{select:a.lobj.doTypeSelect,change:function(e,t,i){var n=e.up("form").form;a.lobj.doRegister(n)}}},{xtype:"displayfield",submitValue:!0,fieldLabel:"对象类型",name:"objType",listeners:{change:function(e,t,i){var n=e.up("form").form;a.lobj.doRegister(n)}}},{xtype:"gridssfield",fieldLabel:"对象编码",editable:!0,readOnly:!0,configInfo:"JE_CORE_RESOURCEBUTTON,component,RESOURCEBUTTON_CODE,S",whereSql:"and RESOURCEBUTTON_FUNCINFO_ID='{funcId}' and RESOURCEBUTTON_TYPE='GRID'",name:"component",listeners:{change:function(e,t,i){var n=e.up("form").form;a.lobj.doRegister(n)}}},{xtype:"textfield",fieldLabel:"注册内容",readOnly:!0,name:"registerContext",value:"jegridview[id="+a.formValues.FUNCINFO_FUNCCODE+"_jegridview]"},{xtype:"hidden",name:"funcId",value:a.formValues.JE_CORE_FUNCINFO_ID}]},{xtype:"fieldset",ref:"event",hidden:!0,title:"方法对应的事件配置项",collapsible:!0,collapsed:!0,listeners:{expand:a.lobj.fsExpand},defaults:{labelWidth:60,anchor:"100%",labelAlign:"right"},layout:"anchor",items:[{xtype:"cbbfield",fieldLabel:"事件",name:"type",editable:!0,forceSelection:!1,dataArray:[],listeners:{change:function(e,t,i){var n="",a=e.up("form").form.findField("variable");if(!Ext.isEmpty(t))switch(t){case"beforesubmit":case"aftersubmit":n="form,act,type,obj";break;case"selfactivate":n="form";break;case"itemclick":case"itemdblclick":n="view,record";break;case"change":n="field,newValue,oldValue,eOpts";break;case"click":case"beforeclick":case"afterclick":n="btn,event,eOpts";break;case"afterrender":n="self,eOpts";break;case"render":n="self";break;case"activate":n="self,eOpts"}a.setValue(n)}}},{xtype:"textfield",fieldLabel:"参数",name:"variable"},{xtype:"rgroup",fieldLabel:"使用Ajax",configInfo:"YESORNO",value:"0",name:"needAjax"}]}]},{xtype:"textfield",fieldLabel:"文件目录",name:"filePath",readOnly:!0,columnWidth:.5},{xtype:"textfield",fieldLabel:"文件名",name:"fileName",readOnly:!0,columnWidth:.5},{xtype:"textfield",fieldLabel:"创建人",name:"author",value:JE.currentUser.username,columnWidth:.5},{xtype:"textfield",fieldLabel:"功能编码",name:"funcCode",readOnly:!0,value:a.formValues.FUNCINFO_FUNCCODE,columnWidth:.5}]};a.items=e,a.buttonAlign="center",a.buttons=[{text:"确定",ref:"ok",handler:a.lobj.okBtn},{text:"取消",ref:"cancle",handler:a.lobj.cancleBtn}],a.listeners={beforeclose:a.lobj.winBeforeClose},a.callParent(arguments)},lobj:{doScopeSelect:function(e,t){var i=e.up("form");if("button"==i.form.findField("objType").getValue()){var n=i.form.findField("component"),a=i.form.findField("doScope").getValue().toUpperCase();n.configInfo="JE_CORE_RESOURCEBUTTON,component,RESOURCEBUTTON_CODE,S",n.whereSql="and RESOURCEBUTTON_FUNCINFO_ID='{funcId}' and RESOURCEBUTTON_TYPE='"+a+"'"}},doTypeSelect:function(e,t){var i=e.up("form"),n=i.form.findField("component"),a=i.form.findField("objType"),l=i.form.findField("doScope").getValue().toUpperCase();n.configInfo="JE_CORE_RESOURCEBUTTON,component,RESOURCEBUTTON_CODE,S",n.whereSql="and RESOURCEBUTTON_FUNCINFO_ID='{funcId}' and RESOURCEBUTTON_TYPE='"+l+"'";var o=t[0].get("code");"self"!=o?a.setValue(o):a.setValue(""),n.setReadOnly("self"==o),n.setValue(""),"field"==o&&(a.setValue(""),n.configInfo="JE_CORE_RESOURCEFIELD,component~objType,RESOURCEFIELD_CODE~RESOURCEFIELD_XTYPE,S",n.whereSql="and RESOURCEFIELD_FUNCINFO_ID='{funcId}'")},fsExpand:function(e){var t="method",i=e.up("form"),n=i.up("window").down("treepanel").getSelectionModel().getSelection()[0],a=i.down("button[ref=add]");a.show(),"method"==e.ref&&(t="event",n&&"method"==n.get("type")&&a.hide()),a.setText("method"==e.ref?"添加方法":"添加事件"),t=i.down("fieldset[ref="+t+"]");var l=i.form.getValues(),o=i.form.findField("type"),d=new Array;"form"==l.doScope?"self"==l.doType?d=[{code:"beforesubmit",text:"数据提交前"},{code:"aftersubmit",text:"数据提交后"},{code:"selfactivate",text:"被激活"},{code:"afterrender",text:"在渲染之后"},{code:"render",text:"渲染"},{code:"activate",text:"激活"}]:"button"==l.doType?d=[{code:"click",text:"单击"},{code:"beforeclick",text:"单击前"},{code:"afterclick",text:"单击后"},{code:"render",text:"渲染"},{code:"activate",text:"激活"}]:"field"==l.doType&&(d=[{code:"change",text:"值改变"},{code:"render",text:"渲染"},{code:"activate",text:"激活"}]):"self"==l.doType?d=[{code:"itemclick",text:"单击"},{code:"itemdblclick",text:"双击"},{code:"render",text:"渲染"},{code:"activate",text:"激活"}]:"button"==l.doType?d=[{code:"click",text:"单击"},{code:"beforeclick",text:"单击前"},{code:"afterclick",text:"单击后"},{code:"render",text:"渲染"},{code:"activate",text:"激活"}]:"field"==l.doType&&(d=[{code:"itemclick",text:"单击"},{code:"itemdblclick",text:"双击"},{code:"render",text:"渲染"},{code:"activate",text:"激活"}]),o.getStore().loadData(d),o.setValue(d[0].code),t.collapse()},saveBtn:function(e){var t=e.up("window").down("treepanel"),i=e.up("form"),n=t.getSelectionModel().getSelection()[0];if(n){var a=i.form.getValues();if("event"==n.get("type")){var l=!1;if(n.parentNode.eachChild(function(e){e.get("text")==a.type&&(l=!0)}),l)return void JE.alert(a.type+"事件已经注册，无法重复注册!");n.set("info",a),n.set("text",a.type),n.set("id",a.registerContext+"-"+a.type)}else n.set("info",a),n.set("text",a.methodName),n.eachChild(function(e){var t=e.get("info");t.methodName=a.methodName,t.methodUse=a.methodUse,e.set("info",t),e.commit()});n.commit()}else JE.alert("请选中节点并修改!")},addBtn:function(e){var t=e.up("window").down("treepanel"),i=e.up("form"),n=Ext.clone(i.form.getValues());if(Ext.isEmpty(n.methodName))alert("对象简述不能为空！");else if("self"!=n.doType&&Ext.isEmpty(n.component))JE.alert("请设置"+("button"==n.doType?"按钮":"字段")+"对象编码!");else{var a={id:n.registerContext,text:n.methodName,type:"method",expandable:!0,leaf:!1,children:[]},l=t.getRootNode();if("添加事件"==e.text){if(!(l=t.getSelectionModel().getSelection()[0]))return void alert("请选择节点！");"event"==l.get("type")&&(l=l.parentNode),a={id:n.registerContext+"-"+n.type,text:n.type,type:"event",leaf:!0}}else n.variable="",n.needAjax="0",n.type="";a.info=n,t.getStore().getNodeById(a.id)?alert("节点已存在！"):(a=l.appendChild(a),t.expandPath(a.getPath()),selModel=t.getSelectionModel(),"event"!=a.get("type")&&selModel.select(a))}},deleteBtn:function(e){var t=e.up("window").down("treepanel"),i=e.up("form"),n=t.getSelectionModel().getSelection()[0];n&&JE.confirm("确定删除当前节点吗？",function(e){"ok"==e&&(n.remove(),i.getForm().reset())})},selectionchange:function(e,t){var i=e.view.panel.up("window").down("form[ref=eventForm]"),n=i.form.findField("funcCode"),a=i.form.findField("doScope"),l=i.form.findField("doType"),o=i.down("fieldset[ref=method]"),d=i.down("fieldset[ref=event]"),r=t[0];r?("event"==r.get("type")?(o.hide(),d.show(),d.expand(),i.getForm().setValues(r.get("info"))):(i.getForm().setValues(r.get("info")),d.show(),o.show(),o.collapse(),d.expand()),n.setReadOnly(!0),a.setReadOnly(!0),l.setReadOnly(!0)):(o.show(),d.hide(),o.expand(),i.form.reset(),n.setReadOnly(!1),a.setReadOnly(!1),l.setReadOnly(!1))},okBtn:function(e){var t=e.up("window"),i=t.down("form");if(i.form.isValid()){var n=i.form.getValues(),a={use:n.use,author:n.author,funcCode:n.funcCode,className:n.className,needUtil:n.needUtil,utilName:n.utilName,utilPath:n.utilPath,fileName:n.fileName,filePath:n.filePath},l=[];if(i.down("treepanel").getRootNode().eachChild(function(e){var t=e.get("info"),i={methodName:t.methodName,use:t.methodUse,registerContext:"'"+t.registerContext+"'",funcCode:t.funcCode,events:[]};e.eachChild(function(e){var t=e.get("info");i.events.push({type:t.type,variable:t.variable,needAjax:t.needAjax})}),i.eventCount=i.events.length,l.push(i)}),a.methods=l,a.methods=Ext.encode(l),Ext.isEmpty(a.fileName)||Ext.isEmpty(a.filePath))JE.alert("请输出正确的完整类名!");else{var o=JE.ajax({params:a,url:JE.getUrlMaps("je.core.vmt.createC4T")});o.success?t.fieldObj.setValue(o.obj):JE.alert(o.obj),t.close()}}else alert("请将信息填写完整！")},cancleBtn:function(e){e.up("window").close()},winBeforeClose:function(t){return t.closeOk||JE.confirm("关闭窗体后，所有信息将会丢失，确定关闭吗？",function(e){t.closeOk="ok"==e,t.closeOk&&t.close()}),t.closeOk},doRegister:function(e){var t=e.getValues(),i="";Ext.isEmpty(t.funcCode)||(i+="je"+t.doScope+"view[id="+t.funcCode+"_je"+t.doScope+"view]",Ext.isEmpty(t.objType)||"self"==t.doType||Ext.isEmpty(t.component)||(i+=" "+t.objType+"["+("button"==t.doType?"ref":"name")+"="+t.component+"]")),e.findField("registerContext").setValue(i)}}}),Ext.define("JE.sys.funccfg.view.other.ExPanelView",{extend:"Ext.panel.Panel",alias:"widget.funccfg.expanelview",layout:"border",border:0,initComponent:function(){var e=[{code:"idit",text:"自定义"},{code:"chart",text:"图表"},{code:"report",text:"报表"},{code:"portal",text:"导航"},{code:"home",text:"门户"}];this.items=[{itemId:"btnPanel",xtype:"panel",layout:"border",border:0,region:"west",width:200,configInfo:this.buildInfo(),defaults:{xtype:"button",toggleGroup:"regionBtn",enableToggle:!0,listeners:{click:function(e){var t=e.ownerCt,i=t.ownerCt.getCmp("formPanel"),n=i.form.getValues();JE.isNotEmpty(n.region)&&("center"==n.region?t.configInfo.add(n.region,{region:n.region,centerPanels:n.centerPanels}):t.configInfo.add(n.region,{region:n.region,height:n.height,width:n.width,type:n.type,configInfo:n.configInfo}));var a=Ext.value(t.configInfo.get(e.region),{region:e.region});i.form.reset(),i.form.setValues(a)}}},items:[{region:"south",text:"下",height:50},{region:"north",text:"上",height:50},{region:"east",text:"右",width:50},{region:"west",text:"左",width:50},{region:"center",text:"列表"}]},{itemId:"formPanel",region:"center",border:0,xtype:"form",layout:"column",bodyPadding:"4",defaults:{labelWidth:80,labelAlign:"right",margin:"2 0",columnWidth:1},items:[{fieldLabel:"位置",name:"region",xtype:"hidden",listeners:{change:function(e,t){var i=!1,n=!1,a=!1,l=!1,o=!1,d=e.ownerCt.form.findField("width"),r=e.ownerCt.form.findField("height"),c=e.ownerCt.form.findField("title"),s=e.ownerCt.form.findField("itemId"),E=e.ownerCt.form.findField("centerPanels");-1!=["south","north"].indexOf(t)?n=!0:-1!=["east","west"].indexOf(t)?i=!0:"center"==t&&(o=l=a=!0),d.setVisible(i),d.setDisabled(!i),r.setVisible(n),r.setDisabled(!n),c.setVisible(a),s.setVisible(l),E.setVisible(o)}}},{fieldLabel:"类型",xtype:"cbbfield",columnWidth:.4,value:"idit",name:"type",dataArray:e},{fieldLabel:"名称",columnWidth:.3,labelWidth:40,hidden:!0,allowBlank:!1,xtype:"textfield",name:"title"},{fieldLabel:"编码",columnWidth:.3,labelWidth:40,hidden:!0,allowBlank:!1,xtype:"textfield",name:"itemId"},{fieldLabel:"宽",columnWidth:.3,labelWidth:40,hidden:!0,disabled:!0,minValue:1,value:200,xtype:"numberfield",name:"width"},{fieldLabel:"高",columnWidth:.3,labelWidth:40,hidden:!0,disabled:!0,minValue:1,value:200,xtype:"numberfield",name:"height"},{fieldLabel:"配置信息",editable:!0,xtype:"treessareafield",allowBlank:!1,name:"configInfo",height:40,listeners:{beforequery:function(e){var t=e.ownerCt.form.findField("type");if("chart"==t.getValue())e.configInfo="JE_CORE_CHARTS,configInfo,code,S",e.whereSql="  AND SY_JESYS='1' ",e.trigger2Cls="x-form-tree-trigger";else if("report"==t.getValue())e.configInfo="JE_CORE_REPORT,configInfo,code,S",e.whereSql="  AND SY_JESYS='1' ",e.trigger2Cls="x-form-tree-trigger";else if("portal"==t.getValue())e.configInfo="JE_CORE_PROTAL,configInfo,JE_CORE_PROTAL_ID,S,",e.whereSql=" and PROTAL_TYPE = 'MENU' and PROTAL_QY_CODE = '1' ",e.trigger2Cls="x-form-list-trigger";else{if("home"!=t.getValue())return!1;e.configInfo="JE_CORE_PROTAL,configInfo,JE_CORE_PROTAL_ID,S,",e.whereSql=" and PROTAL_TYPE = 'PORTAL' and PROTAL_QY_CODE = '1' ",e.trigger2Cls="x-form-list-trigger"}}}},{height:110,hidden:!0,name:"centerPanels",xtype:"jsonarrayfield",insertFn:function(e){var t=this.ownerCt;if(t.isValid()){var i={};Ext.each(["title","itemId","configInfo","type"],function(e){i[e]=t.form.findField(e).getValue()}),e.store.add(i)}},columns:[{dataIndex:"title",width:80,text:"名称"},{dataIndex:"itemId",width:80,text:"编码"},{dataIndex:"type",width:60,field:{xtype:"cbbfield",dataArray:e},text:"类型"},{dataIndex:"configInfo",flex:1,text:"配置项"},{dataIndex:"beActive",text:"激活",width:40,xtype:"uxcheckcolumn"}]}]}],this.callParent(arguments)},saveInfo:function(){var e=this.funcForm,t=this.getCmp("btnPanel"),i=t.items.get(0);i.fireEvent("click",i),e.form.findField("FUNCINFO_EXPANDPANELS").setValue(Ext.encode(t.configInfo.items)),this.funcForm.down("button[ref=save]").fireEvent("click",i)},buildInfo:function(){var e=this.funcForm.down("textarea[name=FUNCINFO_EXPANDPANELS]"),t=Ext.decode(Ext.value(e.getValue(),"[]")),i=new Ext.util.MixedCollection;return Ext.each(t,function(e){i.add(e.region,e)}),i}}),Ext.define("JE.sys.funccfg.view.other.LocalLangView",{extend:"Ext.panel.Panel",alias:"widget.funccfg.locallangview",layout:"border",border:0,margin:2,initComponent:function(){var e=this;e.items=[e.buildFuncForm(),{xtype:"panel",layout:{type:"hbox",align:"stretch"},border:0,region:"center",defaults:{flex:1,margin:1},items:[e.buildColumnGrid(),e.buildFieldGrid(),e.buildButtonGrid(),{xtype:"panel",border:0,layout:{type:"vbox",align:"center"},defaults:{flex:1,margin:1,width:"100%"},items:[e.buildChildGrid(),e.buildCxclGrid()]}]}],e.callParent(arguments)},afterRender:function(){this.callParent(arguments);var e=JE.ajax({url:JE.getUrlMaps("je.core.develop.funcInfo","getInfoById"),params:{tableCode:"JE_CORE_FUNCINFO",pkValue:this.funcId,queryColumns:"JE_CORE_FUNCINFO_ID,FUNCINFO_FUNCNAME,FUNCINFO_FUNCCODE"}});this.getCmp("form").setTitle(e.FUNCINFO_FUNCNAME+"("+e.FUNCINFO_FUNCCODE+")"),this.getCmp("form").form.setValues(e)},buildFuncForm:function(){return{xtype:"form",itemId:"form",region:"north",tools:[{type:"save",callback:function(e){JE.submit(e,{url:JE.getUrlMaps("je.core.update"),params:{tableCode:"JE_CORE_FUNCINFO"},success:function(e,t){t.result.success&&JE.msg("修改成功!")}})}}],title:"功能",margin:1,height:100,bodyPadding:4,layout:"column",defaults:{labelAlign:"right",columnWidth:.3,margin:1,labelWidth:140,xtype:"textfield"},items:[{fieldLabel:"功能名称",readOnly:!0,submitValue:!1,name:"FUNCINFO_FUNCNAME"},{fieldLabel:"【列表】操作说明",readOnly:!0,submitValue:!1,name:"FUNCINFO_GRIDTIP"},{fieldLabel:"【快速查询】操作说明",readOnly:!0,submitValue:!1,name:"FUNCINFO_TREETIP"},{fieldLabel:"功能名称",emptyText:"英文",name:"FUNCINFO_FUNCNAME_EN"},{fieldLabel:"【列表】操作说明",emptyText:"英文",name:"FUNCINFO_GRIDTIP_EN"},{fieldLabel:"【快速查询】操作说明",emptyText:"英文",name:"FUNCINFO_TREETIP_NE"},{xtype:"hidden",name:"JE_CORE_FUNCINFO_ID"}]}},buildFieldGrid:function(){return this.buildGrid({title:"字段",tableName:"JE_CORE_RESOURCEFIELD",pkName:"JE_CORE_RESOURCEFIELD_ID",codeField:"RESOURCEFIELD_CODE",nameField:"RESOURCEFIELD_NAME",mainId:"RESOURCEFIELD_FUNCINFO_ID"})},buildColumnGrid:function(){return this.buildGrid({title:"列",tableName:"JE_CORE_RESOURCECOLUMN",pkName:"JE_CORE_RESOURCECOLUMN_ID",codeField:"RESOURCECOLUMN_CODE",nameField:"RESOURCECOLUMN_NAME",mainId:"RESOURCECOLUMN_FUNCINFO_ID"})},buildButtonGrid:function(){return this.buildGrid({title:"按钮",tableName:"JE_CORE_RESOURCEBUTTON",pkName:"JE_CORE_RESOURCEBUTTON_ID",nameField:"RESOURCEBUTTON_NAME",codeField:"RESOURCEBUTTON_CODE",mainId:"RESOURCEBUTTON_FUNCINFO_ID"})},buildChildGrid:function(){return this.buildGrid({title:"子功能",tableName:"JE_CORE_FUNCRELATION",pkName:"JE_CORE_FUNCRELATION_ID",nameField:"FUNCRELATION_NAME",codeField:"FUNCRELATION_CODE",mainId:"FUNCRELATION_FUNCINFO_ID"})},buildCxclGrid:function(){return this.buildGrid({title:"查询策略",tableName:"JE_CORE_QUERYSTRATEGY",pkName:"JE_CORE_QUERYSTRATEGY_ID",nameField:"QUERYSTRATEGY_NAME",mainId:"QUERYSTRATEGY_FUNCINFO_ID"})},buildGrid:function(a){var e={limit:-1,orderSql:" order by SY_ORDERINDEX ASC ",whereSql:" and "+a.mainId+" = '"+this.funcId+"'"},t={xtype:"grid",title:a.title,tools:[{type:"save",callback:function(e){JE.Action.doUpdateList(e,a)}}],columnLines:!0,store:JE.getStore({tableName:a.tableName,id:a.pkName,params:e,autoLoad:!0}),columns:[{text:"名称",dataIndex:a.nameField,flex:1,renderer:function(e,t,i){return a.codeField&&(t.tdAttr+='title="'+i.get(a.codeField)+'"'),e}},{text:"英文名称",dataIndex:a.nameField+"_EN",flex:1,field:{xtype:"textfield",selectOnFocus:!0}}],viewConfig:{enableTextSelection:!0},plugins:[Ext.create("Ext.grid.plugin.CellEditing",{clicksToEdit:1,pluginId:"cellEdit"})]};return-1!=["JE_CORE_RESOURCECOLUMN","JE_CORE_RESOURCEFIELD"].indexOf(a.tableName)&&(t.viewConfig.getRowClass=function(e,t,i,n){return-1!=e.get(a.codeField).indexOf("_ID")?"func-id-cls":"SY_"==e.get(a.codeField).substring(0,3)?"func-row-sys-cls":void 0}),t}}),Ext.define("JE.sys.funccfg.view.other.VisibleCfgView",{extend:"Ext.window.Window",alias:"widget.funccfg.visiblecfgview",layout:"fit",modal:!0,closeOk:!1,title:"显隐表达式",width:650,height:400,fn:void 0,funcId:void 0,initValue:void 0,initComponent:function(){var t=this,e=Ext.value(t.initValue,{exp:"",noReadOnly:""});t.funcInfo=JE.ajax({url:JE.getUrlMaps("je.core.getInfoById"),params:{tableCode:"JE_CORE_FUNCINFO",pkValue:t.funcId}}),t.items={layout:"column",itemId:"form",xtype:"form",defaults:{columnWidth:1},border:0,bodyPadding:5,items:[{xtype:"box",padding:"5",margin:"5 10",cls:"x-view-emtpytext",html:"如果符合以下条件，则表示条件成立，显示！"},{name:"visableExp",xtype:"jsonarrayfield",columns:[{dataIndex:"field",text:"字段/系统变量",flex:200,field:{xtype:"gridssfield",editable:!0,configInfo:"JE_CORE_RESOURCEFIELD,field,RESOURCEFIELD_CODE,S",whereSql:"  AND RESOURCEFIELD_XTYPE NOT IN ('child','fieldset','childfuncfield','uxdisplayfield') and RESOURCEFIELD_FUNCINFO_ID = '"+t.funcId+"' ",listeners:{okbuttonclick:function(e,t){Ext.each(t,function(e){e.set("RESOURCEFIELD_CODE","{"+e.get("RESOURCEFIELD_CODE")+"}")})}}}},{dataIndex:"exp",text:"表达式",width:100,field:{xtype:"cbbfield",dataArray:[{code:"==",text:"=="},{code:">",text:">"},{code:">=",text:">="},{code:"<",text:"<"},{code:"<=",text:"<="},{code:"!=",text:"!="},{code:"isEmpty",text:"isEmpty"},{code:"isNotEmpty",text:"isNotEmpty"},{code:"indexOf",text:"indexOf"}]}},{dataIndex:"value",text:"值",width:150,field:{xtype:"textfield"}},{dataIndex:"numberfield",text:"数值字段",width:80,xtype:"uxcheckcolumn"}]},{xtype:"fieldcontainer",layout:"column",defaults:{labelAlign:"right"},margin:"5 0 0 0",items:[{xtype:"yesnofield",fieldLabel:"使用",labelWidth:40,name:"useOkExp"},{xtype:"uxtrigger",trigger2Cls:"x-form-more-trigger",emptyText:"点击按钮查看生成好的表达式,可进行修改,并勾选使用",value:e.exp,name:"okExp",textarea:!0,height:60,columnWidth:1,handler:function(e){e.setValue(t.buildVisibleExp().exp)}}]},{xtype:"fieldcontainer",layout:"hbox",defaults:{labelAlign:"right"},items:[{xtype:"yesnofield",labelWidth:120,value:e.noReadOnly,fieldLabel:"不受主功能显隐控制",name:"noReadOnly",boxLabel:"(只有按钮配置有效)"},{xtype:"yesnofield",labelWidth:120,fieldLabel:"ID存在才展示",name:"IDNotEmpty",boxLabel:"(只有表单有效)"}]}]},t.buttons=[{text:"确定",iconCls:"jeicon jeicon-check",handler:function(e){t.fn&&t.fn(t.buildVisibleExp()),t.close()}},{text:"取消",iconCls:"jeicon jeicon-error",handler:function(e){t.close()}}],t.buttonAlign="center",t.callParent(arguments)},buildVisibleExp:function(){var e=this.getCmp("form"),t=e.form.findField("visableExp"),i=e.form.findField("noReadOnly").getSubmitValue(),n=e.form.findField("IDNotEmpty").getSubmitValue(),a=JE.toBool(e.form.findField("useOkExp").getValue()),l=e.form.findField("okExp").getValue(),o=[];Ext.each(t.getData(),function(e){if(JE.isNotEmpty(e.field)&&JE.isNotEmpty(e.exp)){var t=e.field,i=e.value,n=e.exp;JE.toBool(e.numberfield)||(t="'"+t+"'",i="'"+i+"'"),-1!=["isEmpty","isNotEmpty"].indexOf(n)?o.push("JE."+n+"("+t+")"):"indexOf"==n?o.push(t+"."+n+"("+i+") != -1"):o.push(t+" "+n+" "+i)}}),"1"==n&&o.push("JE.isNotEmpty('{"+this.funcInfo.FUNCINFO_PKNAME+"}')");var d=o.join(" && ");return l=Ext.value(l,d),{noReadOnly:i,exp:a?l:d}}}),Ext.define("JE.sys.funccfg.view.perm.PermData",{extend:"Ext.form.Panel",layout:"column",alias:"widget.funccfg.permdata",bodyStyle:"background:#fefece;",defaults:{xtype:"textfield",labelAlign:"right",margin:"10 5 0 0",columnWidth:.25},overflowX:"auto",items:[{fieldLabel:"使用关系",xtype:"treessfield",configInfo:"JE_CORE_YWCJ,FUNCINFO_USECJGLNAMES~FUNCINFO_USECJGLIDS,text~id,S",name:"FUNCINFO_USECJGLNAMES",columnWidth:.2},{fieldLabel:"使用关系IDID",xtype:"hidden",name:"FUNCINFO_USECJGLIDS",columnWidth:.2},{fieldLabel:"可见人员",xtype:"queryuserfield",configInfo:"JE_CORE_QUERYUSER,FUNCINFO_SEEUSERNAMES~FUNCINFO_SEEUSERIDS,USERNAME~USERID,M",name:"FUNCINFO_SEEUSERNAMES",otherConfig:'{"DEPT":"1","SENTRY":"1","ROLE":"1"}',columnWidth:.2},{fieldLabel:"人员ID",xtype:"hidden",name:"FUNCINFO_SEEUSERIDS",columnWidth:.2},{fieldLabel:"可见部门",xtype:"treessfield",configInfo:"JE_RBAC_DEPARTMENT,FUNCINFO_SEEDEPTNAMES~FUNCINFO_SEEDEPTIDS,text~id,M",name:"FUNCINFO_SEEDEPTNAMES",columnWidth:.2},{fieldLabel:"部门ID",xtype:"hidden",name:"FUNCINFO_SEEDEPTIDS",columnWidth:.25},{fieldLabel:"可见角色",xtype:"treessfield",configInfo:"JE_RBAC_ROLE,FUNCINFO_SEEROLENAMES~FUNCINFO_SEEROLEIDS,text~id,M",name:"FUNCINFO_SEEROLENAMES",whereSql:" AND ROLERANK='SYS'",columnWidth:.2},{fieldLabel:"角色ID",xtype:"hidden",name:"FUNCINFO_SEEROLEIDS",columnWidth:.25},{fieldLabel:"可见岗位",xtype:"treessfield",configInfo:"JE_RBAC_SENTRY,FUNCINFO_SEESENTRYNAMES~FUNCINFO_SEESENTRYIDS,text~id,M",name:"FUNCINFO_SEESENTRYNAMES",columnWidth:.2},{fieldLabel:"岗位ID",xtype:"hidden",name:"FUNCINFO_SEESENTRYIDS",columnWidth:.25},{xtype:"cgroup",configInfo:"JE_FUNC_PERMDATA,FUNCINFO_PERMCONFIG,code,,,6",name:"FUNCINFO_PERMCONFIG",columnWidth:1,defaults:{margin:"0 0 0 10"}},{xtype:"textarea",fieldLabel:"权限过滤条件",name:"FUNCINFO_PERMSQL",columnWidth:1,defaults:{margin:"0 0 0 10"}}],buttonAlign:"left",buttons:[{text:"保存",iconCls:"jeicon jeicon-save",ref:"save"},{text:"默认设置",iconCls:"jeicon jeicon-turn-left",ref:"reset"}]}),Ext.define("JE.sys.funccfg.view.perm.PermDeptTree",{extend:"Ext.tree.Panel",title:"部门",useArrows:!0,rootVisible:!1,autoScroll:!0,iconCls:"jeicon jeicon-user-department",padding:"2 2 1 1",multiSelect:!1,funcTree:!0,selectType:"N",selModel:{selType:"treemodel",allowDeselect:!0,mode:"SIMPLE"},multiSelect:!0,viewConfig:{selectedItemCls:"x-tree-row-selected",focusedItemCls:"x-tree-row-focused",beforeFocusedItemCls:"x-tree-row-before-focused",tableFocusedFirstCls:"x-tree-table-focused-first"},root:{text:"ROOT",id:"ROOT",expanded:!0,children:[]},alias:"widget.funccfg.permdepttree",initComponent:function(){this.callParent(arguments)}}),Ext.define("JE.sys.funccfg.view.perm.PermDic",{extend:"Ext.panel.Panel",layout:"fit",alias:"widget.funccfg.permdic",initComponent:function(){this.items={xtype:"dataview",store:JE.getStore({tableName:"JE_CORE_DICTIONARY",id:"JE_CORE_DICTIONARY_ID",params:{limit:-1},autoLoad:!1}),tpl:['<tpl for=".">','<div class="thumb-wrap" name="{DICTIONARY_DDCODE}">','<div class="thumb">',"{DICTIONARY_DDNAME}({DICTIONARY_DDCODE})","</div>","</div>","</tpl>"],multiSelect:!0,trackOver:!0,overItemCls:"x-dataview-item-over",selectedItemCls:"x-dataview-item-selected",itemSelector:"div.thumb-wrap",emptyText:""},this.tbar=[{text:"导入",disabled:!0,iconCls:"jeicon jeicon-import",ref:"add"},{text:"删除",disabled:!0,iconCls:"jeicon jeicon-error",ref:"remove"},{text:"删除全部",disabled:!0,iconCls:"jeicon jeicon-cancel",ref:"removeAll"}],this.callParent(arguments)}}),Ext.define("JE.sys.funccfg.view.perm.PermDicForm",{extend:"Ext.form.Panel",layout:"column",alias:"widget.funccfg.permdicform",defaults:{xtype:"textfield",labelAlign:"right",margin:"4"},items:[{fieldLabel:"SQL",name:"PERM_DICSQL",columnWidth:.5,labelWidth:33},{xtype:"yesnofield",fieldLabel:"覆盖",name:"PERM_DICSQLOVERR",columnWidth:.25,labelSeparator:"",labelWidth:33},{xtype:"yesnofield",fieldLabel:"过滤",name:"PERM_DICSQLQUERY",columnWidth:.25,labelSeparator:"",labelWidth:33}]}),Ext.define("JE.sys.funccfg.view.perm.PermDicItem",{extend:"Ext.tree.Panel",useArrows:!0,rootVisible:!1,autoScroll:!0,root:{text:"ROOT",id:"ROOT",expanded:!0,children:[]},alias:"widget.funccfg.permdicitem",initComponent:function(){this.callParent(arguments)}}),Ext.define("JE.sys.funccfg.view.perm.PermField",{extend:"Ext.panel.Panel",title:"字段授权",iconCls:"jeicon jeicon-add-fields",layout:"fit",padding:"2 1 1 1",alias:"widget.funccfg.permfield",initComponent:function(){var e=JE.getStore({tableName:"JE_CORE_RESOURCEFIELD",id:"JE_CORE_RESOURCEFIELD_ID",params:{limit:-1},autoLoad:!1});this.items={xtype:"dataview",store:e,tpl:['<tpl for=".">','<div class="thumb-wrap" name="{RESOURCEFIELD_NAME}">','<div class="thumb">',"{RESOURCEFIELD_NAME}({RESOURCEFIELD_CODE})","</div>","</div>","</tpl>"],multiSelect:!0,trackOver:!0,selectedItemCls:"x-dataview-item-selected",overItemCls:"x-dataview-item-over",itemSelector:"div.thumb-wrap",emptyText:""},this.tbar=[{xtype:"yesnofield",fieldLabel:"全部",ref:"FIELD_ALL",labelWidth:33,labelSeparator:"",value:"1"},{xtype:"yesnofield",fieldLabel:"取反",ref:"FIELD_OVERR",labelWidth:33,labelSeparator:"",value:"0",disabled:!0},{text:"导入",disabled:!0,iconCls:"jeicon jeicon-import",ref:"add"},{text:"删除",disabled:!0,iconCls:"jeicon jeicon-error",ref:"remove"},{text:"删除全部",disabled:!0,iconCls:"jeicon jeicon-cancel",ref:"removeAll"}],this.callParent(arguments)}}),Ext.define("JE.sys.funccfg.view.perm.PermFieldForm",{extend:"Ext.form.Panel",layout:"column",alias:"widget.funccfg.permfieldform",defaults:{xtype:"textfield",labelAlign:"right",margin:"4"},items:[{fieldLabel:"SQL",name:"PERM_FIELDSQL",readOnly:!0,columnWidth:.8,labelWidth:33},{xtype:"yesnofield",fieldLabel:"覆盖",name:"PERM_FIELDSQLOVERR",columnWidth:.2,labelSeparator:"",labelWidth:33}]}),Ext.define("JE.sys.funccfg.view.perm.PermFieldReadOnly",{extend:"Ext.panel.Panel",title:"字段只读控制",iconCls:"jeicon jeicon-add-fields",layout:"fit",padding:"2 1 1 1",alias:"widget.funccfg.permfieldreadonly",initComponent:function(){var e=JE.getStore({tableName:"JE_CORE_RESOURCEFIELD",id:"JE_CORE_RESOURCEFIELD_ID",params:{limit:-1},autoLoad:!1});this.items={xtype:"dataview",store:e,tpl:['<tpl for=".">','<div class="thumb-wrap" name="{RESOURCEFIELD_NAME}">','<div class="thumb">',"{RESOURCEFIELD_NAME}({RESOURCEFIELD_CODE})","</div>","</div>","</tpl>"],multiSelect:!0,trackOver:!0,selectedItemCls:"x-dataview-item-selected",overItemCls:"x-dataview-item-over",itemSelector:"div.thumb-wrap",emptyText:""},this.tbar=[{text:"导入",disabled:!0,iconCls:"jeicon jeicon-import",ref:"addReadOnly"},{text:"删除",disabled:!0,iconCls:"jeicon jeicon-error",ref:"removeReadOnly"},{text:"删除全部",disabled:!0,iconCls:"jeicon jeicon-cancel",ref:"removeAllReadOnly"}],this.callParent(arguments)}}),Ext.define("JE.sys.funccfg.view.perm.PermRoleTree",{extend:"Ext.tree.Panel",title:"角色",useArrows:!0,rootVisible:!1,autoScroll:!0,iconCls:"jeicon jeicon-role",padding:"2 2 1 1",root:{text:"ROOT",id:"ROOT",expanded:!0,children:[]},viewConfig:{selectedItemCls:"x-tree-row-selected",focusedItemCls:"x-tree-row-focused",beforeFocusedItemCls:"x-tree-row-before-focused",tableFocusedFirstCls:"x-tree-table-focused-first"},alias:"widget.funccfg.permroletree",initComponent:function(){this.callParent(arguments)}}),Ext.define("JE.sys.funccfg.view.perm.PermView",{extend:"Ext.panel.Panel",border:0,alias:"widget.funccfg.permview",id:"funccfg.permview",layout:"border",modeType:"ROLE",initComponent:function(){this.items=[{region:"west",width:200,xtype:"tabpanel",ref:"funcperm_group_tab",tabPosition:"left",border:1,items:[{xtype:"funccfg.permroletree",funcId:this.funcId},{xtype:"funccfg.permdepttree",funcId:this.funcId}]},{xtype:"panel",layout:"border",border:0,items:[{xtype:"funccfg.permfield",region:"north",height:290},{xtype:"funccfg.permfieldreadonly",region:"center"},{xtype:"funccfg.permfieldform",region:"south",frame:!0,margin:"1",padding:"0 0 1 0",height:35}],region:"center"},{xtype:"panel",title:"字典授权",width:260,iconCls:"jeicon jeicon-dictionary",padding:"2 1 1 2",region:"east",layout:"border",items:[{xtype:"funccfg.permdic",region:"north",bodyStyle:"background:aliceblue;",height:290,border:0},{xtype:"funccfg.permdicform",padding:"2 1 2 1",frame:!0,margin:"1",region:"south",height:35},{xtype:"funccfg.permdicitem",region:"center",border:0}]},{xtype:"funccfg.permdata",region:"south",split:!0,height:200}],this.callParent(arguments)},setViewReadOnly:function(e){var t=this.down("tabpanel[ref=funcperm_group_tab]"),i=this.down("panel[region=center]"),n=this.down("panel[region=east]"),a=this.down("panel[xtype=funccfg.permdata]");t&&t.setDisabled(e),i&&i.setDisabled(e),n&&n.setDisabled(e),a&&a.setDisabled(e)},loadFunc:function(e){var t=Ext.getCmp("funccfg.permview"),i=t.down("panel[xtype=funccfg.permroletree]"),n=t.down("panel[xtype=funccfg.permdepttree]"),a=JE.ajax({url:JE.getUrlMaps("je.core.develop.funcPerm","getFuncPerm"),params:{tableCode:"JE_CORE_FUNCINFO",JE_CORE_FUNCINFO_ID:e}});t.funcPerm=a.FUNCPERM,t.funcInfo={funcId:a.JE_CORE_FUNCINFO_ID,funcCode:a.FUNCINFO_FUNCCODE,funcName:a.FUNCINFO_FUNCNAME};var l=JE.ajax({url:JE.getUrlMaps("je.core.develop.funcPerm","getFuncRoleTree"),params:{tableCode:"JE_CORE_FUNCINFO",FUNCINFO_FUNCCODE:a.FUNCINFO_FUNCCODE,excludes:"checked"}});0<l.length&&i.getRootNode().appendChild(l),0<(l=JE.ajax({url:JE.getUrlMaps("je.core.rbac.dept","getTree"),params:{tableCode:"JE_CORE_DEPARTMENT",whereSql:" AND STATUS='1'",excludes:""}}).children).length&&n.getRootNode().appendChild(l),t.down("form[xtype=funccfg.permdata]").form.setValues(a);t.tableCode="JE_CORE_FUNCINFO"},resetPerm:function(){var e=this,t="1",i="0",n="",a="0",l=e.down("panel[xtype=funccfg.permfieldform]"),o=e.down("panel[xtype=funccfg.permfield]"),d=o.down("dataview"),r=" AND 1!=1";d.getStore().getProxy().extraParams.whereSql=r,d.getStore().load();var c=e.down("panel[xtype=funccfg.permfieldreadonly]"),s=c.down("dataview");r=" AND 1!=1",s.getStore().getProxy().extraParams.whereSql=r,s.getStore().load();var E=e.down("panel[xtype=funccfg.permdic]"),f=E.down("dataview");r=" AND 1!=1",f.getStore().getProxy().extraParams.whereSql=r,f.getStore().load(),e.dicInfos={},l.form.findField("PERM_FIELDSQL").setReadOnly(!1);var u=o.down("yesnofield[ref=FIELD_ALL]"),p=o.down("yesnofield[ref=FIELD_OVERR]");u.setValue(t),p.setValue(i),l.form.setValues({PERM_FIELDSQL:n,PERM_FIELDSQLOVERR:a}),E.down("button[ref=add]").setDisabled(!1),E.down("button[ref=remove]").setDisabled(!1),E.down("button[ref=removeAll]").setDisabled(!1),c.down("button[ref=addReadOnly]").setDisabled(!1),c.down("button[ref=removeReadOnly]").setDisabled(!1),c.down("button[ref=removeAllReadOnly]").setDisabled(!1)}}),Ext.define("JE.sys.funccfg.view.power.PowerControlFieldView",{alias:"widget.funccfg.powercontrolfieldview",title:"控制字段",extend:"Ext.panel.Panel",layout:"border",autoScroll:!0,initComponent:function(){this.items=[{xtype:"panel",region:"center",layout:"fit",border:0,items:[{xtype:"form",border:0,layout:{type:"vbox",align:"center",pack:"start"},margin:700<JE.getBodyHeight()?"100 0 0 0":"50 0 0 0",items:[{xtype:"textfield",name:"FUNCINFO_USERFIELD",width:350,fieldLabel:"控制人员ID字段"},{xtype:"textfield",width:350,margin:"20px 0 0 0",name:"FUNCINFO_DEPTFIELD",fieldLabel:"控制部门ID字段"}]}]}],this.callParent(arguments)},getConfigData:function(){return this.down("panel[xtype=form]").getValues()},setConfigData:function(e){this.down("panel[xtype=form]").form.setValues(e)},doReset:function(){this.down("panel[xtype=form]").getForm().reset()},doState:function(){return"0"}}),Ext.define("JE.sys.funccfg.view.power.PowerDictionariesView",{alias:"widget.funccfg.powerdictionariesview",title:"字典授权",extend:"Ext.panel.Panel",layout:"border",autoScroll:!0,allData:void 0,bodyStyle:"border-width:0px;background-color:#ECF0F5;",initComponent:function(){for(var p=this,e=JE.ajax({url:JE.getUrlMaps("je.core.rbac.dept","getTree"),params:{tableCode:"JE_CORE_DEPARTMENT",whereSql:" AND STATUS='1'",excludes:"",expanded:!0}}).children,t=0;t<e.length;t++)e[t].expanded=!0;p.items=[{xtype:"form",region:"north",layout:"column",border:0,defaults:{labelAlign:"center",labelWidth:70,border:0,style:"background-color:#ECF0F5;",columnWidth:.3},style:"border-width:0px;",bodyStyle:"background-color:#ECF0F5;",items:[{flex:1,xtype:"cbbfield",fieldLabel:"字典授权",name:"dicPower",dataArray:[{code:"1",text:"关闭字典授权"},{code:"0",text:"启用字典授权"}],listeners:{afterrender:function(e){e.setValue("1")},change:function(e,t,i){var n=e.ownerCt;"0"==t?n.getCmp("zditemsq").enable():n.getCmp("zditemsq").disable()}}},{flex:1,xtype:"cbbfield",itemId:"zditemsq",fieldLabel:"授权范围",style:"background-color:#ECF0F5;",name:"powertype",dataArray:[{code:"ROLE",text:"使用角色授权"},{code:"DEPT",text:"使用部门授权"}],listeners:{afterrender:function(e){e.setValue("ROLE")},change:function(e,t,i){"ROLE"==t?Ext.getCmp("zdcardtype").getLayout().setActiveItem("role"):Ext.getCmp("zdcardtype").getLayout().setActiveItem("dept")}}}]},{region:"center",layout:{type:"hbox",align:"stretch"},bodyStyle:"border-width:0px;background-color:#ECF0F5;",border:0,defaults:{border:0,style:"background-color:#ECF0F5;border-width:0px;",bodyStyle:"border-width:0px;"},itemId:"trees",items:[{width:245,layout:"card",id:"zdcardtype",margin:"10px 10px 0 0",style:"background-color:#ECF0F5;border-radius: 4px;",border:0,defaults:{border:0,bodyStyle:"border-width:0px;margin:10px 0 0 0;"},items:[{id:"role",tbar:{xtype:"box",height:35,style:"text-align:center;line-height:35px;",html:"角色"},xtype:"treepanel",border:0,rootVisible:!1,root:{id:"ROOT",expanded:!0,children:[]},listeners:{checkchange:function(e,t,i){p.resetDicData()},itemclick:function(e,t,i,n,a,l){t.data.checked?t.set("checked",!1):t.set("checked",!0),p.resetDicData()}}},{id:"dept",tbar:{xtype:"box",height:35,style:"text-align:center;line-height:35px;",html:"部门"},xtype:"treepanel",border:0,rootVisible:!1,root:{text:"ROOT",id:"ROOT",expanded:!0,children:e},listeners:{checkchange:function(e,t,i){p.resetDicData()},itemclick:function(e,t,i,n,a,l){t.data.checked?t.set("checked",!1):t.set("checked",!0),p.resetDicData()}}}]},{width:245,margin:"10px 10px 0 0",border:0,tbar:{xtype:"box",height:35,style:"text-align:center;line-height:35px;",html:"字典"},id:"dictionariesTree",xtype:"grid",style:"background-color:#FFFFFF;border-radius: 4px;",hideHeaders:!0,store:Ext.create("Ext.data.Store",{fields:["text","code","enable"]}),columns:[{dataIndex:"text",flex:1,renderer:function(e,t,i){return"1"==i.get("enable")?e+'<i class="fa fa-circle" style="margin-left:10px;font-size: 12px;color: #4093dc;"></i>':e}}],listeners:{itemclick:function(e,t,i,n,a,l){if("1"!=p.query("panel[xtype=form]")[0].form.findField("dicPower").getValue()){var o=t.get("code"),d=JE.getDicItems(o),r=Ext.getCmp("zdxgrid");r.getSelectionModel().deselectAll(!0),r.store.removeAll(),r.store.add(d);var c=p.getCmp("trees").getCmp("zdcardtype").getLayout().getActiveItem(),s=p.getCatchData(c.id),E=c.getChecked()[0];if(!JE.isEmpty(E)&&E){var f=s[E.get("id")],u=[];f&&Ext.each(f.dic[o],function(e){var t=r.store.getById(e);t&&u.push(t)}),JE.isEmpty(u)?r.getSelectionModel().selectAll(!0):r.getSelectionModel().select(u)}}}}},{flex:1,tbar:{xtype:"box",height:35,style:"text-align:center;line-height:35px;",html:"字典项"},id:"zdxgrid",xtype:"grid",store:Ext.create("Ext.data.Store",{fields:["text","code"]}),style:"background-color:#FFFFFF;border-radius: 4px;border:0;",bodyStyle:"margin-top:10px;border:0;",margin:"10px 0 0 0",selModel:{selType:"checkboxmodel"},border:0,hideHeaders:!0,columns:[{dataIndex:"text",flex:1,align:"center"}],listeners:{selectionchange:function(e,t,i){var n=p.getCmp("trees").getCmp("zdcardtype").getLayout().getActiveItem(),a=p.getCmp("trees").getCmp("dictionariesTree"),l=p.getCmp("trees").getCmp("zdxgrid"),o=n.getChecked(),d=a.getSelectionModel().getSelection()[0],r=e.getSelection(),c=p.getCatchData(n.itemId),s=r.length==l.getStore().getCount()?"1":"0",E=d.get("code"),f=n.id;Ext.each(o,function(e){var t=e.get("id"),i=c[f][t]||{all:"0",dic:{}};i.all=s,i.dic[E]=[],Ext.each(r,function(e){i.dic[E].push(e.get("id"))}),c[f][t]=i}),d.set("enable",0==r.length?"0":"1")}}}]}],p.callParent(arguments)},resetDicData:function(){var e=this.getCmp("trees").getCmp("zdcardtype").getLayout().getActiveItem(),t=this.getCmp("trees").getCmp("dictionariesTree"),i=this.getCmp("trees").getCmp("zdxgrid"),n=this.getCatchData(e.id),a=e.getChecked()[0];JE.isEmpty(a)||(t.getSelectionModel().deselectAll(!0),t.getStore().each(function(e){if(a){var t=n[a.get("id")],i=e.get("code");e.set("enable",t&&JE.isNotEmpty(t.dic[i])?"1":"0")}else e.set("enable","0")}),i.getSelectionModel().deselectAll(!0),i.getStore().removeAll())},getCatchData:function(e){return this._data=this._data||{role:{},dept:{}},JE.isEmpty(e)?this._data:this._data[e]},initConfigData:function(e,t){var i=e.funcId,n=e.funcCode,a=JE.ajax({url:JE.getUrlMaps("je.core.develop.funcPerm","getFuncRoleTree"),params:{tableCode:"JE_CORE_FUNCINFO",FUNCINFO_FUNCCODE:n,type:t}});Ext.getCmp("role").getRootNode().appendChild(a);var l=[],o=JE.ajax({url:JE.getUrlMaps("je.core.develop.funcPerm","getFuncFieldDic"),params:{tableCode:"JE_CORE_FUNCINFO",JE_CORE_FUNCINFO_ID:i}}).obj,d=JE.dicInfoData;this.dicCodes=[];for(var r=0;r<o.length;r++){var c=d[o[r]].DICTIONARY_DDNAME,s=d[o[r]].DICTIONARY_DDCODE;this.dicCodes.push(s),l.push({text:c,code:s,enable:"0"})}Ext.getCmp("dictionariesTree").getStore().removeAll(),Ext.getCmp("dictionariesTree").getStore().add(l)},setConfigData:function(e){var d=this.getCatchData();Ext.each(e,function(e){if(-1!=["DIC","DICITEM"].indexOf(e.PERM_TARGERTYPE)){var t=e.PERM_TARGERID,i=e.PERM_ROLE_ID,n=e.PERM_TYPE.toLowerCase(),a=e.PERM_TARGERVALUE,l=d[n]=d[n]||{},o=l[i]=l[i]||{all:"0",dic:{}};if("DIC"==e.PERM_TARGERTYPE)o.all="0";else(o.dic[t]=o.dic[t]||[]).push(a)}})},getConfigData:function(t,e){var i=this.getCmp("trees").getCmp("zdcardtype").getLayout().getActiveItem(),n=[],a=this.getCatchData(i.id),l=this.query("panel[xtype=form]")[0].form.findField("powertype").getValue();for(var o in a)for(dic in a[o].dic)n.push({PERM_TYPE:l,PERM_FUNCINFO_ID:t,PERM_ROLE_ID:o,PERM_TARGERTYPE:"DIC",PERM_TARGERID:dic,PERM_TARGERVALUE:"",PERM_TARGEROVERR:"",PERM_SQLOVERR:a[o].all,PERM_SQLQUERY:""}),Ext.each(a[o].dic[dic],function(e){n.push({PERM_TYPE:l,PERM_FUNCINFO_ID:t,PERM_ROLE_ID:o,PERM_TARGERTYPE:"DICITEM",PERM_TARGERID:dic,PERM_TARGERVALUE:e})});var d={};return d.strData=Ext.encode(n),d.tableCode=e,d.JE_CORE_FUNCINFO_ID=t,n},doReset:function(){var e=this.getCmp("trees").getCmp("zdcardtype").getLayout().getActiveItem(),t=this.getCatchData(e.id);for(var i in t)for(var n in t[i].dic)t[i].dic[n]=[]},doState:function(){return this.query("panel[xtype=form]")[0].form.findField("dicPower").getValue()}}),Ext.define("JE.sys.funccfg.view.power.PowerFastView",{alias:"widget.funccfg.powerfastview",title:"快速授权",extend:"Ext.panel.Panel",layout:"column",autoScroll:!0,initComponent:function(){var e=JE.getDicItems("JE_FUNC_PERMDATA"),t={SELF_CREATE:"(用户只能看到自己录入的数据)",SELF_UPDATE:"(只有数据录入者才能修改本条数据)",SELF_DELETE:"(只有数据录入者才能删除本条数据)",SELF_ZSDEPT:'(直属领导可见下属录入数据)<i class="fa fa-question-circle-o" style="margin-left:112px;color:#868686;"></i>',LEAD_DEPT:"(部门主管可见部门内所有数据)",SELF_DEPT:"(同属一个部门的用户数据相互可见)",MONITOR_DEPT:'(用户可看到自己监管部门的数据)<i class="fa fa-question-circle-o" style="margin-left:65px;color:#868686;"></i>',WF_PREAPPROV:"(数据通过流程流转到自己的时候才可见)",WF_APPROVED:"(用户审批过本条数据后一直可见)"},i=[],n=["MONITOR_COMPANY","MONITOR_COMPANY","SELF_FZRDEPT","SELF_COMPANY"];Ext.each(e,function(e){-1==n.indexOf(e.code)&&i.push({name:e.code,boxLabel:'<span style="color:#2F6BCF;">'+e.text+'</span><span style="color:#868686;margin-left:10px;">'+Ext.value(t[e.code],"")+"</span>"})}),this.items=[{layout:"column",itemId:"formview",columnWidth:.5,xtype:"form",border:0,bodyStyle:"background-color:#ECF0F5;",defaults:{labelAlign:"right",xtype:"yesnofield",margin:"5",style:"background-color:#FFFFFF;font-size:14px;border-radius: 4px;",labelWidth:70,columnWidth:1,fieldBodyStyle:"padding:15px;"},items:i},{layout:"column",xtype:"form",border:0,columnWidth:.5,bodyStyle:"background-color:#ECF0F5;",defaults:{xtype:"gridssareafield",margin:"5",style:"background-color:#FFFFFF;font-size:14px;border-radius: 4px;",labelWidth:70,height:99,columnWidth:1,fieldBodyStyle:"padding:0px 15px 15px 15px;",labelAlign:"top",labelStyle:"margin-left:15px;"},items:[{fieldLabel:'<span style="color:#2F6BCF;">可见人员</span><span style="color:#868686;margin-left:10px;">(选择公司内的任何人员可见本功能)</span>',configInfo:"JE_CORE_QUERYUSER,FUNCINFO_SEEUSERNAMES~FUNCINFO_SEEUSERIDS,USERNAME~USERID,M",name:"FUNCINFO_SEEUSERNAMES",otherConfig:'{"DEPT":"1","SENTRY":"1","ROLE":"1"}'},{fieldLabel:"人员ID",xtype:"hidden",name:"FUNCINFO_SEEUSERIDS"},{xtype:"treessareafield",fieldLabel:'<span style="color:#2F6BCF;">可见部门</span><span style="color:#868686;margin-left:10px;">(选择公司内的任何部门可见本功能)</span>',configInfo:"JE_RBAC_DEPARTMENT,FUNCINFO_SEEDEPTNAMES~FUNCINFO_SEEDEPTIDS,text~id,M",name:"FUNCINFO_SEEDEPTNAMES"},{fieldLabel:"部门ID",xtype:"hidden",name:"FUNCINFO_SEEDEPTIDS"},{xtype:"treessareafield",fieldLabel:'<span style="color:#2F6BCF;">可见角色</span><span style="color:#868686;margin-left:10px;">(选择公司内的任何角色可见本功能)</span>',configInfo:"JE_RBAC_ROLE,FUNCINFO_SEEROLENAMES~FUNCINFO_SEEROLEIDS,text~id,M",name:"FUNCINFO_SEEROLENAMES",whereSql:" AND ROLERANK='SYS'"},{fieldLabel:"角色ID",xtype:"hidden",name:"FUNCINFO_SEEROLEIDS"},{xtype:"treessareafield",fieldLabel:'<span style="color:#2F6BCF;">可见岗位</span><span style="color:#868686;margin-left:10px;">(选择公司内的任何岗位可见本功能)</span>',configInfo:"JE_RBAC_SENTRY,FUNCINFO_SEESENTRYNAMES~FUNCINFO_SEESENTRYIDS,text~id,M",name:"FUNCINFO_SEESENTRYNAMES"},{fieldLabel:"岗位ID",xtype:"hidden",name:"FUNCINFO_SEESENTRYIDS",columnWidth:.25}]}],this.callParent(arguments)},setConfigData:function(e){if(JE.isNotEmpty(e)){var t=this.query("panel[xtype=form]")[0].form;if(JE.isNotEmpty(e[0].FUNCINFO_PERMCONFIG))for(var i=e[0].FUNCINFO_PERMCONFIG.split(","),n=0;n<i.length;n++)t.findField(i[n]).setValue(!0);var a=this.query("panel[xtype=form]")[1].form;a.findField("FUNCINFO_SEEUSERNAMES").setValue(e[0].FUNCINFO_SEEUSERNAMES),a.findField("FUNCINFO_SEEUSERIDS").setValue(e[0].FUNCINFO_SEEUSERIDS),a.findField("FUNCINFO_SEEDEPTNAMES").setValue(e[0].FUNCINFO_SEEDEPTNAMES),a.findField("FUNCINFO_SEEDEPTIDS").setValue(e[0].FUNCINFO_SEEDEPTIDS),a.findField("FUNCINFO_SEEROLENAMES").setValue(e[0].FUNCINFO_SEEROLENAMES),a.findField("FUNCINFO_SEEROLEIDS").setValue(e[0].FUNCINFO_SEEROLEIDS),a.findField("FUNCINFO_SEESENTRYNAMES").setValue(e[0].FUNCINFO_SEESENTRYNAMES),a.findField("FUNCINFO_SEESENTRYIDS").setValue(e[0].FUNCINFO_SEESENTRYIDS)}},getConfigData:function(e,t){var i=this.query("panel[xtype=form]"),n=i[1].form.getChanges().keys.join(","),a=[],l=(new Array,i[0].form.getValues());for(var o in l)"1"==l[o]&&a.push(o);var d=a.join(","),r=i[1].form.getValues();return r.FUNCINFO_PERMCONFIG=d,r._updatefields_=n,r.tableCode=t,r.JE_CORE_FUNCINFO_ID=e,r},doReset:function(){this.query("panel[xtype=form]")[0].getForm().reset(),this.query("panel[xtype=form]")[1].getForm().reset()},doState:function(){return"0"}}),Ext.define("JE.sys.funccfg.view.power.PowerFieldView",{alias:"widget.funccfg.powerfieldview",title:"字段授权",extend:"Ext.panel.Panel",layout:"border",autoScroll:!0,border:0,bodyStyle:"border-width:0px;background-color:#ECF0F5;",initComponent:function(){this.items=[{xtype:"form",region:"north",itemId:"formViewField",layout:"hbox",border:0,defaults:{labelAlign:"center",labelWidth:70,border:0,style:"background-color:#ECF0F5;"},style:"border-width:0px;",items:[{flex:1,xtype:"cbbfield",fieldLabel:"字段授权",itemId:"zdsq",value:"1",name:"fieldpowertype",dataArray:[{code:"1",text:"关闭字段授权"},{code:"0",text:"启用字段授权"}],listeners:{afterrender:function(e){e.setValue("1")},change:function(e,t,i){var n=e.ownerCt;"0"==t?(n.getCmp("itemsq").enable(),n.getCmp("itemkz").enable(),n.getCmp("itemxz").enable()):(n.getCmp("itemsq").disable(),n.getCmp("itemkz").disable(),n.getCmp("itemxz").disable())}}},{flex:1,xtype:"cbbfield",itemId:"itemsq",fieldLabel:"授权范围",style:"background-color:#ECF0F5;",name:"powertype",value:"ROLE",dataArray:[{code:"ROLE",text:"使用角色授权"},{code:"DEPT",text:"使用部门授权"}],listeners:{change:function(e,t,i){"ROLE"==t?Ext.getCmp("cardtype").getLayout().setActiveItem("zdplays"):Ext.getCmp("cardtype").getLayout().setActiveItem("zdsectors")}}},{flex:1,xtype:"cbbfield",itemId:"itemkz",fieldLabel:"控制范围",name:"range",dataArray:[{code:"FIELD",text:"控制可见权限"},{code:"READONLY",text:"控制编辑权限"}],listeners:{afterrender:function(e){e.setValue("FIELD")}}},{flex:1,itemId:"itemxz",xtype:"cbbfield",fieldLabel:"选择控制",name:"command",dataArray:[{code:"0",text:"选择认为是启用"},{code:"1",text:"选择认为是禁用"}],listeners:{afterrender:function(e){e.setValue("1")}}}]},{layout:"card",region:"center",id:"cardtype",margin:"10 0 0 0",xtype:"container",autoScroll:!0,items:[this.getTreeGrid({itemId:"zdplays",title:"角色"}),this.getTreeGrid({itemId:"zdsectors",title:"部门"})]}],this.callParent(arguments)},getTreeGrid:function(e){var n=this;return{xtype:"treepanel",itemId:e.itemId,rootVisible:!1,useArrows:!0,cls:"je-grid je-grid-func",root:{id:"ROOT",expandable:!0,expanded:!0,children:[]},listeners:{checkchange:function(e,t){var i={};Ext.each(n.funcFields,function(e){i[e]=t?"1":"0"}),e.set(i)}},columns:{defaults:{sortable:!1,menuDisabled:!0,listeners:{headerclick:function(e,t,i){if(t.fieldColumn){var n=i.getTarget(".je-checkcolumn-checkbox",1,!0);if(n){var a=!n.hasCls("je-checkcolumn-checkbox-checked");a?(n.removeCls("fa-square-o"),n.addCls("fa-check-square-o je-checkcolumn-checkbox-checked")):(n.removeCls("fa-check-square-o je-checkcolumn-checkbox-checked"),n.addCls("fa-square-o")),e.ownerCt.getRootNode().cascadeBy(function(e){"ROOT"!=e.get("id")&&e.set(t.dataIndex,a?"1":"0")})}}}}},items:[{text:"No.",align:"center",xtype:"rownumberer",width:40},{dataIndex:"text",text:e.title,width:200,xtype:"treecolumn",align:"left"}]}}},funcFields:[],initConfigData:function(e,t){var l=this,i=e.funcId,n=e.funcCode,a=JE.ajax({url:JE.getUrlMaps("je.core.develop.funcPerm","getFuncRoleTree"),params:{tableCode:"JE_CORE_FUNCINFO",FUNCINFO_FUNCCODE:n,type:t}}),o=JE.ajax({url:JE.getUrlMaps("je.core.rbac.dept","getTree"),params:{tableCode:"JE_CORE_DEPARTMENT",whereSql:" AND STATUS='1'"}}),d=JE.ajax({url:JE.getUrlMaps("je.core.develop.funcInfo","loadFunc"),params:{tableCode:"JE_CORE_RESOURCEFIELD",whereSql:"and RESOURCEFIELD_FUNCINFO_ID = '"+i+"' and RESOURCEFIELD_HIDDEN !='1'"}}).rows,r={zdplays:a,zdsectors:o.children};Ext.getCmp("cardtype").items.each(function(e){var t=e.getStore().model,i=e.headerCt,n=Ext.clone(JE.modelFields.get("com.je.core.entity.extjs.JSONTreeNode")),a=[];l.funcFields=[],Ext.each(d,function(e){var t=e.RESOURCEFIELD_NAME,i=(e.RESOURCEFIELD_CODE,e.JE_CORE_RESOURCEFIELD_ID);a.push({dataIndex:i,text:'<div class="je-checkcolumn-checkbox fa fa-square-o"></div> '+t,align:"center",xtype:"uxcheckcolumn",fieldColumn:!0}),n.push({type:"string",name:i,defaultValue:"0"}),l.funcFields.push(i)}),t.setFields(n),i.add(a),e.setRootNode({id:"ROOT",expandable:!0,expanded:!0,children:r[e.itemId]}),e.getRootNode().expandChildren()})},setConfigData:function(e){if(JE.isNotEmpty(e)){var t=[],a=[],l=[],i=this.getCmp("formViewField").form;Ext.each(e,function(e){"FIELDCONFIG"==e.PERM_TARGERTYPE&&(t.push(e.PERM_ROLE_ID),i.findField("fieldpowertype").setValue(e.PERM_TARGERID),i.findField("powertype").setValue(e.PERM_TYPE),JE.isNotEmpty(e.PERM_TARGEROVERR)?i.findField("command").setValue(e.PERM_TARGEROVERR):i.findField("command").setValue("1")),"FIELD"!=e.PERM_TARGERTYPE&&"READONLY"!=e.PERM_TARGERTYPE||i.findField("range").setValue(e.PERM_TARGERTYPE)}),Ext.each(t,function(t){var i=[],n="";Ext.each(e,function(e){t==e.PERM_ROLE_ID&&"FIELDCONFIG"!=e.PERM_TARGERTYPE&&(i.push(e.PERM_TARGERID),n=e.PERM_TYPE)}),"ROLE"==n?a.push({id:t,fieldId:i}):"DEPT"==n&&l.push({id:t,fieldId:i})});var o={zdplays:a,zdsectors:l};this.getCmp("cardtype").items.each(function(e){var t=o[e.itemId];if(JE.isNotEmpty(t)){var n=e.getStore();Ext.each(t,function(e){var t=n.getNodeById(e.id),i={};Ext.each(e.fieldId,function(e){i[e]="1"}),t.set(i),t.commit()})}})}else;},getConfigData:function(l,e){var o=this,d=o.getCmp("formViewField").form.getValues(),r=new Array;Ext.getCmp("cardtype").items.each(function(e){var t=e.getStore().getUpdatedRecords(),a="zdplays"==e.itemId?"ROLE":"DEPT";Ext.each(t,function(t){var i=t.data,n=[];Ext.each(o.funcFields,function(e){"1"==i[e]&&n.push(e)}),r.push({PERM_TYPE:a,PERM_FUNCINFO_ID:l,PERM_ROLE_ID:t.get("id"),PERM_TARGERTYPE:"FIELDCONFIG",PERM_TARGERID:d.fieldpowertype,PERM_TARGEROVERR:d.command,PERM_TARGERVALUE:"",PERM_SQLOVERR:""}),JE.isNotEmpty(n)&&Ext.each(n,function(e){r.push({PERM_TYPE:a,PERM_FUNCINFO_ID:l,PERM_ROLE_ID:t.get("id"),PERM_TARGERTYPE:d.range,PERM_TARGERID:e})})})});var t={};return t.strData=Ext.encode(r),t.tableCode=e,t.JE_CORE_FUNCINFO_ID=l,r},doReset:function(){var i=this;Ext.getCmp("cardtype").items.each(function(e){e.getRootNode().cascadeBy(function(e){var t={};Ext.each(i.funcFields,function(e){t[e]=0}),e.set(t)})})},doState:function(){return this.query("panel[xtype=form]")[0].form.findField("fieldpowertype").getValue()}}),Ext.define("JE.sys.funccfg.view.power.PowerSQLView",{alias:"widget.funccfg.powersqlview",title:"角色SQL授权",extend:"Ext.panel.Panel",layout:"border",autoScroll:!0,initComponent:function(){for(var o=this,e=JE.ajax({url:JE.getUrlMaps("je.core.rbac.dept","getTree"),params:{tableCode:"JE_CORE_DEPARTMENT",whereSql:" AND STATUS='1'",excludes:"",expanded:!0}}).children,t=0;t<e.length;t++)e[t].expanded=!0;o.items=[{xtype:"form",region:"north",layout:"column",border:0,defaults:{labelAlign:"center",labelWidth:70,border:0,style:"background-color:#ECF0F5;",columnWidth:.3},style:"border-width:0px;",bodyStyle:"background-color:#ECF0F5;",items:[{xtype:"cbbfield",fieldLabel:"SQL授权",name:"SQLpower",dataArray:[{code:"1",text:"关闭SQL授权"},{code:"0",text:"启用SQL授权"}],listeners:{afterrender:function(e){e.setValue("1")},change:function(e,t,i){var n=e.ownerCt;"0"==t?n.getCmp("zditemsq").enable():n.getCmp("zditemsq").disable()}}},{xtype:"cbbfield",itemId:"zditemsq",fieldLabel:"授权范围",style:"background-color:#ECF0F5;",name:"powerSQLType",dataArray:[{code:"ROLE",text:"使用角色授权"},{code:"DEPT",text:"使用部门授权"}],listeners:{afterrender:function(e){e.setValue("ROLE")},change:function(e,t,i){var n=o.query("panel[xtype=form]")[1].form;n.findField("sql").setValue(""),n.findField("Sqlversa").setValue(""),"ROLE"==t?Ext.getCmp("sqlcardtype").getLayout().setActiveItem("sqlplay"):Ext.getCmp("sqlcardtype").getLayout().setActiveItem("sqlsector")}}}]},{region:"center",layout:{type:"hbox",align:"stretch"},bodyStyle:"border-width:0px;background-color:#ECF0F5;",border:0,defaults:{border:0,style:"background-color:#ECF0F5;border-width:0px;",bodyStyle:"border-width:0px;"},itemId:"trees",items:[{width:245,layout:"card",id:"sqlcardtype",margin:"10px 10px 0 0",style:"background-color:#ECF0F5;border-radius: 4px;",border:0,defaults:{border:0,bodyStyle:"border-width:0px;margin:10px 0 0 0;"},items:[{id:"sqlplay",tbar:{xtype:"box",height:35,style:"text-align:center;line-height:35px;",html:"角色"},xtype:"treepanel",border:0,rootVisible:!1,root:{id:"ROOT",expanded:!0,children:[]},listeners:{checkchange:function(e,t,i){o.resetSQLData()},itemclick:function(e,t,i,n,a,l){t.data.checked?t.set("checked",!1):t.set("checked",!0),o.resetSQLData()}}},{id:"sqlsector",tbar:{xtype:"box",height:35,style:"text-align:center;line-height:35px;",html:"部门"},xtype:"treepanel",border:0,rootVisible:!1,root:{text:"ROOT",id:"ROOT",expanded:!0,children:e},listeners:{checkchange:function(e,t,i){o.resetSQLData()},itemclick:function(e,t,i,n,a,l){t.data.checked?t.set("checked",!1):t.set("checked",!0),o.resetSQLData()}}}]},{flex:1,border:0,autoScroll:!0,bodyStyle:"border:0;border-radius: 4px;",margin:"10px 10px 0 0",tbar:{xtype:"box",height:35,style:"text-align:center;line-height:35px;background-color:#FFFFFF;",html:"标准SQL条件语句"},style:"background-color:#FFFFFF;border-radius: 4px;",xtype:"form",region:"center",layout:"vbox",border:0,columnWidth:1,defaults:{labelAlign:"center",labelWidth:70,border:0,style:"background-color:#FFFFFF;"},bodyStyle:"padding:10px;",items:[{xtype:"textarea",labelAlign:"top",name:"sql",height:300,width:"100%"},{xtype:"yesnofield",name:"Sqlversa",boxLabel:"覆盖原功能WhereSql"}]}]}],o.callParent(arguments)},initConfigData:function(e,t){e.funcId;var i=e.funcCode,n=JE.ajax({url:JE.getUrlMaps("je.core.develop.funcPerm","getFuncRoleTree"),params:{tableCode:"JE_CORE_FUNCINFO",FUNCINFO_FUNCCODE:i,type:t}});Ext.getCmp("sqlplay").getRootNode().appendChild(n)},setConfigData:function(e){this.sqlData=e},resetSQLData:function(){var t=this.getCmp("trees").getCmp("sqlcardtype").getLayout().getActiveItem().getChecked()[0],e=this.query("panel[xtype=form]")[0].form,i=this.query("panel[xtype=form]")[1].form,n=e.findField("powerSQLType").getValue();JE.isNotEmpty(t)&&Ext.each(this.sqlData,function(e){n==e.PERM_TYPE&&(e.PERM_ROLE_ID==t.get("id")?(i.findField("sql").setValue(e.PERM_TARGERVALUE),i.findField("Sqlversa").setValue(e.PERM_SQLOVERR)):(i.findField("sql").setValue(""),i.findField("Sqlversa").setValue("")))})},getConfigData:function(t,e){var i=new Array,n="",a="",l=this.query("panel[xtype=form]")[0],o=l.form.findField("SQLpower").getValue(),d=l.form.findField("powerSQLType").getValue();if("0"==o){if("ROLE"==d){if(!(0<(r=this.query("panel[xtype=treepanel]")[0].getChecked()).length))return void JE.alert("你选中角色节点");Ext.each(r,function(e){i.push(e.get("id"))})}else if("DEPT"==d){var r;if(!(0<(r=this.query("panel[xtype=treepanel]")[1].getChecked()).length))return void JE.alert("你选中角色节点");Ext.each(r,function(e){i.push(e.get("id"))})}if("ROLE"==d||"DEPT"==d){var c=this.query("panel[xtype=form]")[1];a=c.form.findField("sql").getValue(),n=c.form.findField("Sqlversa").getValue()}var s={};s.roleIds=i,s.sql=a,s.Sqlversa=n}var E=[];JE.isNotEmpty(s)&&Ext.each(s.roleIds,function(e){E.push({PERM_TYPE:d,PERM_FUNCINFO_ID:t,PERM_ROLE_ID:e,PERM_TARGERTYPE:"SQLCONFIG",PERM_TARGERID:"0",PERM_TARGEROVERR:"0",PERM_TARGERVALUE:s.sql,PERM_SQLOVERR:1==s.Sqlversa?"1":"0"})});var f={};return f.strData=Ext.encode(E),f.tableCode=e,f.JE_CORE_FUNCINFO_ID=t,E},doState:function(){return this.query("panel[xtype=form]")[0].form.findField("SQLpower").getValue()},doReset:function(){var e=this.query("panel[xtype=form]")[1].form;e.findField("sql").setValue(""),e.findField("Sqlversa").setValue("")}}),Ext.define("JE.sys.funccfg.view.power.PowerScriptSQLView",{alias:"widget.funccfg.powerscriptSQLview",title:"脚本SQL授权",extend:"Ext.panel.Panel",layout:"border",autoScroll:!0,initComponent:function(){this.items=[{xtype:"panel",region:"center",layout:"fit",border:0,items:[{xtype:"jecodeeditor"}]}],this.callParent(arguments)},getConfigData:function(){return this.down("panel[xtype=jecodeeditor]").getValue()},setConfigData:function(e){this.down("panel[xtype=jecodeeditor]").setValue(e)},doReset:function(){this.down("panel[xtype=jecodeeditor]").setValue('function(){\n\treturn "and 1=1";\n}')},doState:function(){return"0"}}),Ext.define("JE.sys.funccfg.view.power.PowerView",{extend:"Ext.tab.Panel",border:0,alias:"widget.funccfg.powerview",requires:["JE.sys.funccfg.view.power.PowerFieldView","JE.sys.funccfg.view.power.PowerDictionariesView","JE.sys.funccfg.view.power.PowerSQLView","JE.sys.funccfg.view.power.PowerFastView","JE.sys.funccfg.view.power.PowerScriptSQLView","JE.sys.funccfg.view.power.PowerControlFieldView","JE.sys.funccfg.view.power.PowerWriteSQLView"],id:"funccfg.powerview",initComponent:function(){var t=this;t.buttons=t.buildButton(),t.buttonAlign="left",t.defaults={border:0,bodyPadding:20,bodyStyle:"background-color:#ECF0F5;overflow:auto;"},t.items=[{xtype:"funccfg.powerfastview",itemId:"powerfastview"},{xtype:"funccfg.powerfieldview",itemId:"powerfieldview",listeners:{activate:{fn:function(e){e.initConfigData(t.funcInfo,t.powerTypes),e.setConfigData(t.powerFieldViewStore),e.activateType="1"},single:!0}}},{xtype:"funccfg.powerdictionariesview",itemId:"powerdictionariesview",listeners:{activate:{fn:function(e){e.initConfigData(t.funcInfo,t.powerTypes),e.setConfigData(t.powerDicViewStore),e.activateType="1"},single:!0}}},{xtype:"funccfg.powersqlview",itemId:"powersqlview",hidden:"ZH"==t.powerTypes,listeners:{activate:{fn:function(e){e.initConfigData(t.funcInfo,t.powerTypes),e.setConfigData(t.powerSQLViewStore),e.activateType="1"},single:!0}}},{bodyPadding:0,xtype:"funccfg.powerscriptSQLview",hidden:"ZH"==t.powerTypes,hidden:!0,itemId:"powerscriptSQLview",listeners:{activate:{fn:function(e){e.setConfigData(t.powerscriptSQLviewStore),e.activateType="1"},single:!0}}},{bodyPadding:0,xtype:"funccfg.powerwriteSQLview",hidden:"ZH"==t.powerTypes,itemId:"powerwriteSQLview",listeners:{activate:{fn:function(e){e.setConfigData(t.powerwriteSQLviewStore),e.activateType="1"},single:!0}}},{xtype:"funccfg.powercontrolfieldview",hidden:"ZH"==t.powerTypes,itemId:"powercontrolfieldview",listeners:{activate:{fn:function(e){e.setConfigData(t.powercontrolfieldviewStore),e.activateType="1"},single:!0}}}],t.callParent(arguments)},buildButton:function(){var e=this;return{style:"background-color:#ECF0F5;",bodyStyle:"border:0;background-color:#FFFFFF;",margin:0,defaults:{style:"border:0;background-color:#FFFFFF;",margin:"0 0 50px 20px"},items:[{xtype:"button",text:'<i class="fa fa-floppy-o" style="margin-right:5px;"></i>保存刷新',handler:function(){e.doSave()}},{xtype:"button",text:'<i class="fa fa-reply" style="margin-right:5px;"></i>默认设置',margin:"0 0 0 10px",handler:function(){e.doReset()}},{xtype:"button",text:"关闭",margin:"0 0 0 10px",handler:function(){e.up("window").close()}}]}},loadFunc:function(e){var t=this,n=JE.ajax({url:JE.getUrlMaps("je.core.develop.funcPerm","getFuncPerm"),params:{tableCode:"JE_CORE_FUNCINFO",JE_CORE_FUNCINFO_ID:e,type:t.powerTypes}});t.funcPerm=n.FUNCPERM,t.funcInfo={funcId:JE.isNotEmpty(n.JE_CORE_FUNCINFO_ID)?n.JE_CORE_FUNCINFO_ID:JE.isNotEmpty(t.funcInfo)?t.funcInfo.funcId:"",funcCode:JE.isNotEmpty(n.FUNCPERM_FUNCCODE)?n.FUNCPERM_FUNCCODE:JE.isNotEmpty(t.funcInfo)?t.funcInfo.funcCode:"",funcName:JE.isNotEmpty(n.FUNCPERM_FUNCNAME)?n.FUNCPERM_FUNCNAME:JE.isNotEmpty(t.funcInfo)?t.funcInfo.funcName:""};var a=n.FUNCPERM;t.powerscriptSQLviewStore=JE.isNotEmpty(n.FUNCINFO_PERMJS)?n.FUNCINFO_PERMJS:"",t.powerwriteSQLviewStore=JE.isNotEmpty(n.FUNCINFO_PERMSQL)?n.FUNCINFO_PERMSQL:"",t.powercontrolfieldviewStore={FUNCINFO_USERFIELD:n.FUNCINFO_USERFIELD,FUNCINFO_DEPTFIELD:n.FUNCINFO_DEPTFIELD},t.powerFastViewStore=[],t.powerFastViewStore.push({FUNCINFO_PERMCONFIG:n.FUNCINFO_PERMCONFIG,FUNCINFO_SEEUSERNAMES:n.FUNCINFO_SEEUSERNAMES,FUNCINFO_SEEUSERIDS:n.FUNCINFO_SEEUSERIDS,FUNCINFO_SEEDEPTNAMES:n.FUNCINFO_SEEDEPTNAMES,FUNCINFO_SEEDEPTIDS:n.FUNCINFO_SEEDEPTIDS,FUNCINFO_SEEROLENAMES:n.FUNCINFO_SEEROLENAMES,FUNCINFO_SEEROLEIDS:n.FUNCINFO_SEEROLEIDS,FUNCINFO_SEESENTRYNAMES:n.FUNCINFO_SEESENTRYNAMES,FUNCINFO_SEESENTRYIDS:n.FUNCINFO_SEESENTRYIDS});var l=t.down("panel[xtype=funccfg.powerfastview]");for(i in l.setConfigData(t.powerFastViewStore),t.powerFieldViewStore=[],a)Ext.each(a[i],function(e){"FIELDCONFIG"!=e.PERM_TARGERTYPE&&"FIELD"!=e.PERM_TARGERTYPE&&"READONLY"!=e.PERM_TARGERTYPE||t.powerFieldViewStore.push(e)});for(i in t.powerDicViewStore=[],a)Ext.each(a[i],function(e){"DIC"!=e.PERM_TARGERTYPE&&"DICITEM"!=e.PERM_TARGERTYPE||t.powerDicViewStore.push(e)});for(i in t.powerSQLViewStore=[],a)Ext.each(a[i],function(e){"SQLCONFIG"==e.PERM_TARGERTYPE&&t.powerSQLViewStore.push(e)})},doSave:function(){var e,i,n=this,a=(n.getActiveTab(),{}),l=[],o=[],d=[],t="",r="JE_CORE_FUNCINFO",c="",s="";if(n.items.each(function(e){if("funccfg.powerfastview"==e.xtype&&(a=e.getConfigData(n.funcInfo.funcId,r)),"funccfg.powerfieldview"==e.xtype){var t=e.activateType;l="1"==t?e.getConfigData(n.funcInfo.funcId,r):n.powerFieldViewStore}if("funccfg.powerdictionariesview"==e.xtype){t=e.activateType;o="1"==t?e.getConfigData(n.funcInfo.funcId,r):n.powerDicViewStore}if("funccfg.powersqlview"==e.xtype){t=e.activateType;d="1"==t?e.getConfigData(n.funcInfo.funcId,r):n.powerSQLViewStore}if("funccfg.powerscriptSQLview"==e.xtype){t=e.activateType;c="1"==t?e.getConfigData(n.funcInfo.funcId,r):n.powerscriptSQLviewStore}if("funccfg.powercontrolfieldview"==e.xtype){t=e.activateType;i="1"==t?e.getConfigData(n.funcInfo.funcId,r):n.powercontrolfieldviewStore}if("funccfg.powerwriteSQLview"==e.xtype){t=e.activateType;s="1"==t?e.getConfigData(n.funcInfo.funcId,r):n.powerwriteSQLviewStore}}),JE.isNotEmpty(l)&&(t+=",FIELD"),JE.isNotEmpty(o)&&(t+=",DIC"),JE.isNotEmpty(d)&&(t+=",SQL"),t=t.substring("1"),e=l.concat(o,d),a.saveType=t,a.strData=Ext.encode(e),a.FUNCINFO_PERMJS=c,a.FUNCINFO_PERMSQL=s,a.FUNCINFO_USERFIELD=i.FUNCINFO_USERFIELD,a.FUNCINFO_DEPTFIELD=i.FUNCINFO_DEPTFIELD,a.tableCode="JE_SAAS_FUNCPERM",a.JE_CORE_FUNCINFO_ID=n.funcInfo.funcId,a.FUNCPERM_FUNCNAME=n.funcInfo.funcName,a.FUNCPERM_FUNCCODE=n.funcInfo.funcCode,a.type=n.powerTypes,"1"==n.getActiveTab().doState())JE.msg("授权关闭,请开启后操作");else{var E=JE.ajax({url:JE.getUrlMaps("je.core.develop.funcPerm","doUpdatePerm"),params:a});if(E.success){JE.msg("授权成功!");var f=n.cmp.funcData.info,u=f.idSuffix,p=Ext.getCmp(f.funcCode+"_jemainview"+u);JE.doMask(p,"功能重建中，请稍等...",function(){p.removeAll(!0),p.buildItem(!0,!1)}),n.up("window").close()}else JE.msg(E.obj)}},doReset:function(){var i=this;"ZH"==i.powerTypes?JE.confirm("是否使用系统配置?",function(e){if("ok"==e){var t=JE.ajax({url:"/je/develop/funcPerm/removeFuncPerm",params:{tableCode:"JE_SAAS_FUNCPERM",JE_CORE_FUNCINFO_ID:i.funcInfo.funcId,type:"ZH"}});t.success?JE.msg("设置成功!"):JE.msg(t.obj),i.loadFunc(i.funcInfo.funcId),i.items.each(function(e){"funccfg.powerfastview"==e.xtype&&(e.doReset(),e.setConfigData(i.powerFastViewStore)),"funccfg.powerfieldview"==e.xtype&&(e.doReset(),e.setConfigData(i.powerFieldViewStore)),"funccfg.powerdictionariesview"==e.xtype&&(e.doReset(),e.setConfigData(i.powerDicViewStore)),"funccfg.powersqlview"==e.xtype&&(e.doReset(),e.setConfigData(i.powerSQLViewStore)),"funccfg.powerscriptSQLview"==e.xtype&&(e.doReset(),e.setConfigData(i.powerscriptSQLviewStore)),"funccfg.powercontrolfieldview"==e.xtype&&(e.doReset(),e.setConfigData(i.powercontrolfieldviewStore)),"funccfg.powerwriteSQLview"==e.xtype&&(e.doReset(),e.setConfigData(i.powerwriteSQLviewStore))})}}):(i.loadFunc(i.funcInfo.funcId),i.items.each(function(e){"funccfg.powerfastview"==e.xtype&&(e.doReset(),e.setConfigData(i.powerFastViewStore)),"funccfg.powerfieldview"==e.xtype&&(e.doReset(),e.setConfigData(i.powerFieldViewStore)),"funccfg.powerdictionariesview"==e.xtype&&(e.doReset(),e.setConfigData(i.powerDicViewStore)),"funccfg.powersqlview"==e.xtype&&(e.doReset(),e.setConfigData(i.powerSQLViewStore)),"funccfg.powerscriptSQLview"==e.xtype&&(e.doReset(),e.setConfigData(i.powerscriptSQLviewStore)),"funccfg.powercontrolfieldview"==e.xtype&&(e.doReset(),e.setConfigData(i.powercontrolfieldviewStore)),"funccfg.powerwriteSQLview"==e.xtype&&(e.doReset(),e.setConfigData(i.powerwriteSQLviewStore))}),JE.msg("恢复成功!点击保存生效!"))}}),Ext.define("JE.sys.funccfg.view.print.PrintList",{extend:"Ext.panel.Panel",alias:"widget.funccfg.printlist",frame:!1,border:1,bodyStyle:"background-color:#cccccc;",autoScroll:!0,initComponent:function(){var e=this;e.printUtil=Ext.create("JE.core.util.PrintUtil",{}),e.dockedItems=[],e.dockedItems.push({xtype:"toolbar",dock:"top",itemId:"pageCfg",defaults:{labelWidth:60,labelAlign:"right"},items:[{xtype:"cbbfield",name:"pageType",labelWidth:40,hideTrigger1:!0,inputAttrTpl:'title="可编辑纸张(cm)：宽*长"',editable:!0,fieldLabel:"纸张",configInfo:"JE_CORE_PAGESIZE"},"-",{xtype:"yesnofield",fieldLabel:"自动封头",value:"1",name:"autoHeader"},{xtype:"numberfield",name:"pageSize",hideTrigger:!0,width:100,value:30,fieldLabel:"每页条数"},{xtype:"numberfield",name:"rowHeight",hideTrigger:!0,width:100,value:30,fieldLabel:"单行高"},{xtype:"numberfield",name:"fontSize",hideTrigger:!0,width:100,minValue:0,fieldLabel:"字号"},{xtype:"yesnofield",labelWidth:80,fieldLabel:"表头不加粗",name:"noFontBold"},"-",{xtype:"button",text:"导入",ref:"import"},{xtype:"button",text:"自动填充纸张",ref:"autoResize"},"->",{xtype:"yesnofield",labelWidth:40,fieldLabel:"启用",name:"enablePrint"},{xtype:"yesnofield",labelWidth:80,fieldLabel:"直接打印",name:"print"},{xtype:"button",text:"保存",ref:"ok"},{xtype:"button",ref:"preview",text:"预览"}]}),e.dockedItems.push({xtype:"toolbar",dock:"top",defaults:{labelWidth:40,labelAlign:"right"},items:[{xtype:"textfield",name:"header",ref:"pageHFTpl",width:400,fieldLabel:"页眉"},{text:"高级",ref:"pageHFG"},{xtype:"rgroup",name:"headerAlign",type:"header",fieldLabel:"位置",ref:"pageAlign",value:"left",dataArray:[{code:"left",text:"左"},{code:"center",text:"中"},{code:"right",text:"右"}]}]}),e.dockedItems.push({xtype:"box",dock:"bottom",margin:"0",padding:"10",cls:"x-view-emtpytext",html:"页眉页脚的动态参数：pageNum(页码),totalNum(总页数)；用法：第{pageNum}页/共{totalNum}页"}),e.dockedItems.push({xtype:"toolbar",dock:"bottom",defaults:{labelWidth:40,labelAlign:"right"},items:[{xtype:"textfield",name:"fotter",ref:"pageHFTpl",width:400,fieldLabel:"页脚"},{text:"高级",ref:"pageHFG"},{xtype:"rgroup",name:"fotterAlign",fieldLabel:"位置",ref:"pageAlign",type:"fotter",value:"left",dataArray:[{code:"left",text:"左"},{code:"center",text:"中"},{code:"right",text:"右"}]}]}),e.layout={type:"table",columns:1,tableAttrs:{align:"center"}},e.items=[{xtype:"panel",itemId:"pagePanel",bodyPadding:"10 20",margin:"30",width:"210mm",cls:"tableform-shadow",border:0,layout:{type:"table",columns:1,tableAttrs:{width:"100%",height:"100%",align:"center",cls:"tableform-table"}},defaults:{width:"100%"},dockedItems:[{xtype:"box",dock:"top",itemId:"headerBox",padding:"20 20 10 20",html:"页眉"},{xtype:"box",dock:"bottom",itemId:"fotterBox",padding:"10 20 20 20",html:"页脚"}],items:{xtype:"grid",minHeight:32,columns:[]}},{xtype:"box",itemId:"pageBox"}],e.callParent(arguments)},afterRender:function(){var e=this;e.callParent(arguments),e.grid=e.down("grid"),e.pagePanel=e.getComponent("pagePanel"),e.pageBox=e.getComponent("pageBox")},loadCols:function(e){var t=this;if(Ext.isEmpty(e)){var i=JE.ajax({url:JE.getUrlMaps("je.core.develop.funcInfo","loadFunc"),params:{whereSql:"and  RESOURCECOLUMN_FUNCINFO_ID = '"+t.funcId+"'",orderSql:" order by SY_ORDERINDEX ASC ",funcId:t.funcId,tableCode:"JE_CORE_RESOURCECOLUMN",limit:-1}});t.grid||(t.grid=t.down("grid")),e=t.dgColumns(i.rows)}t.grid.headerCt.removeAll(),t.grid.headerCt.add(e),t.grid.view.refresh()},dgColumns:function(a,l){var o=this,d=[];return Ext.each(a,function(e){var t=e.RESOURCECOLUMN_XTYPE;if("actioncolumn"!=t){var i={dataIndex:e.RESOURCECOLUMN_CODE,text:e.RESOURCECOLUMN_NAME,hidden:JE.toBool(e.RESOURCECOLUMN_HIDDEN),width:JE.toNum(e.RESOURCECOLUMN_WIDTH),moreColumnName:e.RESOURCECOLUMN_MORECOLUMNNAME,sortable:!1};if(Ext.value(l,"")==Ext.value(i.moreColumnName,"")){if("morecolumn"==t){var n=o.dgColumns(a,i.dataIndex);i.columns=n}d.push(i)}}}),d},dgColumnTpls:function(l,e,o,d,r){var c=this,s=[],t={tag:"tr",deep:d=Ext.value(d,0),children:[]};if(s.push(t),e.each(function(e,t){if(!e.hidden&&Ext.value(o,"")==Ext.value(e.moreColumnName,"")){var i=1;if(0<e.items.getCount()){var n=c.dgColumnTpls(l,e.items,e.dataIndex,d+1,t);Ext.each(n,function(e){s[e.deep]?s[e.deep].children=s[e.deep].children.concat(e.children):s.push(e)}),i=e.items.getCount()}var a={tag:"td",colspan:i,rowspan:1,index:r,html:e.text,dataIndex:e.dataIndex,align:"center",valign:"middle",style:"border:1px solid #000;",height:30};l&&(a.style+="font-weight:bold;"),0<e.getWidth()&&(a.width=e.getWidth()),s[0].children.push(a)}}),0!=d)return s;var i=0,n="";Ext.each(s[0].children,function(e){i+=e.width,1==e.colspan&&(e.rowspan=s.length)}),s[0].cls="firstRow";var a=s[0].children.length-1;return Ext.each(s,function(e,i){delete e.deep,Ext.each(e.children,function(e,t){0==i&&0==t||0==e.index?e.cls="firstCol":(0==i&&t==a||e.index==a)&&(e.cls="lastCol")}),n+=Ext.DomHelper.createHtml(e)}),{tableWidth:i,columnsTpl:n}},dgRelColumns:function(e,n){var a=this,l=[];return e.each(function(e){var t={dataIndex:e.dataIndex,text:e.text,hidden:e.hidden,width:e.width,moreColumnName:e.moreColumnName,sortable:!1};if(Ext.value(n,"")==Ext.value(t.moreColumnName,"")){if(0<e.items.getCount()){var i=a.dgRelColumns(e.items,t.dataIndex);t.columns=i}l.push(t)}}),l},getCfgInfo:function(){var e=this,t={};e.dockedItems.each(function(e){e.items&&e.items.each(function(e){JE.isNotEmpty(e.name)&&e.getValue&&(t[e.name]=e.getValue())})});var i=e.grid.headerCt.items,n="1"!=t.noFontBold;Ext.apply(t,e.dgColumnTpls(n,i));var a=t.pageType.split("*")[0],l=t.pageType.split("*")[1];if(t.HPageType){var o=a;a=l,l=o}return t.pageWidth=Number(a),t.pageHeight=l,t.relColumns=e.dgRelColumns(i),t.tdDataIndex=[],Ext.each(e.grid.headerCt.columnManager.columns,function(e){t.tdDataIndex.push(e.dataIndex)}),t},previewPage:function(){var e=this.getCfgInfo(),t=e.tableWidth,i=e.tdDataIndex,n=e.columnsTpl,a=e.pageSize,l=e.rowHeight,o=e.header,d=e.headerAlign,r=e.fotter,c=e.fotterAlign,s=(e.pageType,e.pageWidth),E=e.pageHeight,f=(e.HPageType,e.autoHeader),u=e.fontSize,p="";0<u&&(p="font-size:"+u+"px;");for(var m=this.printUtil.blildPageTpl(),x="",g=0;g<a;g++){x+="<tr height="+l+" >";for(var C=0;C<i.length;C++){x+='<td align=center style="border:1px solid #000;font-weight:bold;">'+(0==C?g+1:"&nbsp;")+"</td>"}x+="</tr>"}var h=[];for(g=0;g<2;g++){var b=['<table align="center" width="'+t+'" style="'+p+'border-collapse: collapse;background-color: #fff;" cellspacing=0 cellpadding=0>',n,x,"</table>"];0<g&&!f&&b.splice(1,1),h.push({bodyTpl:b.join(""),headerTpl:o,headerAlign:d,fotterTpl:r,fotterAlign:c,pageWidth:s+"mm",pageHeight:E+"mm"})}var y=m.apply({pages:h});y=JE.encodeURI(y),JE.openWindow("/static/ux/page/print.jsp",{htmlTpl:y})},savePrintInfo:function(){var e=Ext.encode(this.getCfgInfo()),t=JE.ajax({url:JE.getUrlMaps("je.core.develop.funcInfo","doUpdateHelp"),params:{tableCode:"JE_CORE_FUNCINFO",_updatefields_:"FUNCINFO_GRIDPRINTINFO",JE_CORE_FUNCINFO_ID:this.funcId,FUNCINFO_GRIDPRINTINFO:e}});t.success?JE.msg("设置成功！"):JE.error(t.obj,t)},changePageSize:function(e,t){var i=this;Ext.isNumeric(e)&&(i.pageBox.getEl().setStyle({width:e+"mm"}),i.pagePanel.setWidth(i.pageBox.getSize().width),i.grid.setWidth(i.pageBox.getSize().width-40))},autoResizeGrid:function(){var t,e=this.grid.headerCt.items,i=0,n=this.pageBox.getSize().width-40,a=0;0!=e.getCount()&&(e.each(function(e){e.isHidden()||(a=e.getWidth(),t=e,i+=a)}),n<i&&i-n<=a?t.setWidth(a-(i-n)):i<n&&t.setWidth(a+(n-i)))},loadFunc:function(e){this.funcId=e;var t=JE.ajax({url:JE.getUrlMaps("je.core.develop.funcInfo","getInfoById"),params:{tableCode:"JE_CORE_FUNCINFO",pkValue:e,queryColumns:"JE_CORE_FUNCINFO_ID,FUNCINFO_GRIDPRINTINFO"}}),i=Ext.decode(Ext.value(t.FUNCINFO_GRIDPRINTINFO,"{}"));i.pageType=Ext.value(i.pageType,"210*297"),this.dockedItems.each(function(e){e.items&&e.items.each(function(e){JE.isNotEmpty(e.name)&&e.setValue&&JE.isNotEmpty(i[e.name])&&e.setValue(i[e.name])})}),JE.isNotEmpty(i.relColumns)&&this.loadCols(i.relColumns)}}),Ext.define("JE.sys.funccfg.view.subsystem.SubSystem",{extend:"Ext.panel.Panel",alias:"widget.funccfg.subsystem",layout:"border",initComponent:function(){this.items=[{xtype:"funccfg.subsystemgrid",region:"center"},{xtype:"funccfg.subsystemeast",width:300,title:"系统测试信息",hidden:!0,split:!0,iconCls:"jeicon jeicon-resource-table-application",region:"east"}],this.callParent(arguments)}}),Ext.define("JE.sys.funccfg.view.subsystem.SubSystemEast",{extend:"Ext.panel.Panel",alias:"widget.funccfg.subsystemeast",layout:"border",bodyPadding:"2",initComponent:function(){this.items=[{xtype:"textarea",height:200,padding:"0 0 0 0",region:"north",name:"FUNCINFO_FUNCREMARK",labelAlign:"top",readOnly:!0,configInfo:"hideTBar"},this.getTestGrid(),this.getFileGrid()],this.callParent(arguments)},getTestGrid:function(){return{region:"center",margin:"4 0",xtype:"grid",autoScroll:!0,columnLines:!0,columns:[{dataIndex:"QUERYSTRATEGY_NAME",text:"测试人",width:100},{dataIndex:"QUERYSTRATEGY_SQL",text:"教程项",width:50},{dataIndex:"SY_ORDERINDEX",text:"通过项",width:50},{dataIndex:"SY_ORDERINDEX",text:"日期",width:80}],store:Ext.create("Ext.data.Store",{fields:["SY_ORDERINDEX","QUERYSTRATEGY_NAME","QUERYSTRATEGY_SQL","QUERYSTRATEGY_USERID","QUERYSTRATEGY_FUNCCODE","JE_CORE_QUERYSTRATEGY_ID","QUERYSTRATEGY_DEF"],data:[]})}},getFileGrid:function(){return{region:"south",height:200,ref:"filesGrid",xtype:"grid",autoScroll:!0,columnLines:!0,columns:[{dataIndex:"DOCUMENT_DOCNAME",text:"附件",width:180,renderer:function(e,t,i){return'<a href="javascript:void(0)" onclick="javascript:window.open(\''+(JE.getUrlMaps("je.core.doc.document","download")+"?ieFlag="+(Ext.isIE?"1":"0")+"&enCode=1&fileName="+encodeURIComponent(e)+"&beanTableCode=JE_CORE_FUNCINFO&path="+i.get("DOCUMENT_ADDRESS"))+"');\">"+e+"</a>"}},{dataIndex:"SY_CREATETIME",text:"日期",width:80,xtype:"datecolumn",format:"Y-m-d"},{xtype:"actioncolumn",width:20,items:[{iconCls:"jeicon jeicon-error",tooltip:"删除",handler:function(e,t){var i=e.getStore().getAt(t),n=i.get("JE_CORE_DOCUMENT_ID"),a=JE.ajax({url:"/doc/removeFormFiles.action",params:{ids:n,tableCode:"JE_CORE_DOCUMENT",beanTableCode:"JE_CORE_FUNCINFO"}});a.success?e.getStore().remove(i):JE.error(a.obj,a)}}]}],store:Ext.create("Ext.data.Store",{fields:["SY_CREATETIME","DOCUMENT_DOCSIZE","JE_CORE_DOCUMENT_ID","DOCUMENT_PKVALUE","DOCUMENT_DOCNAME","DOCUMENT_ADDRESS"],data:[]}),bbar:["->",{text:"批量上传附件",ref:"uploadFiles",iconCls:"jeicon jeicon-resource-table-addition"}]}}}),Ext.define("JE.sys.funccfg.view.subsystem.SubSystemGrid",{extend:"Ext.tree.Panel",alias:"widget.funccfg.subsystemgrid",useArrows:!0,rootVisible:!1,animate:!1,codeSearch:!0,mixins:["JE.core.util.ViewUtil"],requires:["JE.sys.funccfg.util.singleton"],cls:"je-grid je-field-grid je-func-actioncolumn",initComponent:function(){var e=this,t=e.getTreeTbar(e),i=t.items[t.items.length-1];delete i.inputAttrTpl,delete i.cls,i.width=200,e.tbar={cls:"je-button-bar",items:[{ref:"addMenu",text:"添加",iconCls:"jeicon jeicon-resource-table-addition",menu:[{text:"子系统",ref:"SYSTEM",iconCls:"jeicon jeicon-subsystem"},{text:"模块",ref:"MODEL",iconCls:"jeicon jeicon-module"},{text:"功能",ref:"FUNC",iconCls:"jeicon jeicon-set-up"},{text:"集合",ref:"FUNCFIELD",iconCls:"jeicon jeicon-collection-field"}]},{text:"粘贴",disabled:!0,ref:"paste",iconCls:"jeicon jeicon-paste"},{xtype:"box",style:"font-weight: bold;color: #0852F0;",ref:"copyInfo"},{text:"功能重新静态化",ref:"doAllStaticizeFunc",hidden:!0,iconCls:"jeicon jeicon-compress-static"},{text:"清空缓存",ref:"doStaticizeFunc",iconCls:"jeicon jeicon-broom-o"},{text:"全部收起",ref:"doCloseAll",iconCls:"jeicon jeicon-shrink"},"->",i]},e.store=Ext.create("Ext.data.TreeStore",{defaultRootId:"ROOT",sorters:[{property:"orderIndex",direction:"ASC"}],model:JE.getModel({tableName:"JE_CORE_FUNCINFO",doTree:!0,excludes:"checked"}),proxy:{type:"ajax",extraParams:{tableCode:"JE_CORE_FUNCINFO",excludes:"checked",rootId:"ROOT",limit:-1},url:JE.getUrlMaps("je.core.develop.funcInfo","loadGridTree"),reader:"json"},listeners:{load:function(e){e.getRootNode().expandChildren()}}}),e.columns=[{xtype:"treecolumn",text:"名称",width:200,sortable:!0,dataIndex:"text"},{header:"国际化",width:80,hidden:!0,rendererText:!0,align:"center",listeners:{linkclick:function(e,t,i){-1==["FUNC","FUNCFIELD"].indexOf(i.get("nodeInfoType"))||JE.win({title:"国际化维护",items:{xtype:"funccfg.locallangview",funcId:i.get("id")},autoShow:!0})}},renderer:function(e,t,i){return-1!=["FUNC","FUNCFIELD"].indexOf(i.get("nodeInfoType"))?'<span style="color:blue;cursor: pointer;">国际化</span>':""}},{text:"编码",width:150,dataIndex:"code",sortable:!0},{header:"类型",dataIndex:"nodeInfoType",width:100,tactics:[{type:"dic",dicCode:"JE_SYS_FUNCTYPE"}],renderer:JE.renderer},{text:"操作",xtype:"actioncolumn",width:120,cls:"je-func-actioncolumn",items:[{iconCls:"jeicon jeicon-pencil",tooltip:"编辑",handler:JE.sys.funccfg.util.singleton.edit},{iconCls:"jeicon jeicon-chart-copy",tooltip:"复制功能",handler:JE.sys.funccfg.util.singleton.copy,isDisabled:function(e,t,i,n,a){return-1==["FUNC","FUNCFIELD"].indexOf(a.get("nodeInfoType"))}},{iconCls:"jeicon jeicon-trash-o",tooltip:"清空",handler:JE.sys.funccfg.util.singleton.removeData,isDisabled:function(e,t,i,n,a){return-1==["FUNC","FUNCFIELD"].indexOf(a.get("nodeInfoType"))}},{iconCls:"jeicon jeicon-error",tooltip:"删除",handler:JE.sys.funccfg.util.singleton.remove},{iconCls:"jeicon jeicon-refresh",tooltip:"刷新数据",handler:JE.sys.funccfg.util.singleton.refresh,isDisabled:function(e,t,i,n,a){return-1==["FUNC","FUNCFIELD"].indexOf(a.get("nodeInfoType"))}}]},{header:"功能描述",dataIndex:"FUNCINFO_FUNCREMARK",width:300,renderer:JE.renderer,flex:1},{header:"测试",hidden:!0,width:180,renderer:function(){return'<span style="color:blue;cursor: pointer;" onclick ="JE.sys.funccfg.util.singleton.testYL();" >用例测试</span>|<span style="color:red;cursor: pointer;" onclick ="JE.sys.funccfg.util.singleton.testZC();">自测评分</span>|<span style="color:green;cursor: pointer;" onclick ="JE.sys.funccfg.util.singleton.testZY();">自由测试</span>'}}],e.selModel={selType:"treemodel",allowDeselect:!0},e.viewConfig=Ext.value(e.viewConfig,{}),e.viewConfig.plugins=Ext.value(e.viewConfig.plugins,[]),e.viewConfig.listeners=Ext.value(e.viewConfig.listeners,{}),e.viewConfig.plugins.push({ptype:"treeviewdragdrop",allowParentInserts:!0}),e.viewConfig.listeners=Ext.apply(e.viewConfig.listeners,{beforedrop:function(e,t,i,n,a){if(t.append=!1,t.order=!1,"append"==n?t.records[0].parentNode.getId()==i.getId()?a.cancelDrop():t.append=!0:(t.records[0].parentNode.getId()==i.parentNode.getId()||(t.append=!0),t.order=!0),t.append){var l=t.order?i.parentNode:i;-1==["FUNCFIELD","SYSTEM"].indexOf(t.records[0].get("nodeInfoType"))&&"FUNC"!=t.records[0].parentNode.get("nodeInfoType")||(a.cancelDrop(),JE.alert("子系统,子功能和子功能集合不允许拖动!")),-1!=["FUNC","MODEL"].indexOf(t.records[0].get("nodeInfoType"))&&-1!=["FUNCFIELD","FUNC"].indexOf(l.get("nodeInfoType"))&&(a.cancelDrop(),JE.alert("功能和模块不能拖到功能和子功能集合下!")),"ROOT"==l.get("id")&&(a.cancelDrop(),JE.alert("节点不能拖到一级目录!"))}},drop:function(e,t,i,n,a){var l=this.panel,o="JE_CORE_FUNCINFO_ID",d="JE_CORE_FUNCINFO",r={success:!0},c=t.records[0];if(t.append){var s=t.order?i.parentNode:i,E={tableCode:d,SY_PARENT:s.getId(),SY_PATH:s.getPath(),SY_LAYER:s.getDepth()+1};if(E[o]=c.getId(),(r=JE.ajax({url:JE.getUrlMaps("je.core.develop.funcInfo","treeMove"),params:E})).success){var f=r.obj;c.set("layer",f.SY_LAYER),c.set("nodePath",f.SY_PATH),c.set("parent",f.SY_PARENT),c.set("parentPath",f.SY_PARENTPATH),c.set("SY_LAYER",f.SY_LAYER),c.set("SY_PATH",f.SY_PATH),c.set("SY_PARENT",f.SY_PARENT),c.set("SY_PARENTPATH",f.SY_PARENTPATH),c.commit(),l.getSelectionModel().deselectAll(),l.getSelectionModel().select(c)}else JE.alert(r.obj)}if(t.order&&r.success){var u=[];i.parentNode.eachChild(function(e){var t={};t[o]=e.get("id"),t.SY_ORDERINDEX=e.get("index")+1,e.set("orderIndex",t.SY_ORDERINDEX),e.set("SY_ORDERINDEX",t.SY_ORDERINDEX),u.push(t)}),r=JE.ajax({url:JE.getUrlMaps("je.core.develop.funcInfo","updateList"),params:{strData:Ext.encode(u),tableCode:d}})}r.success?(l.getSelectionModel().deselectAll(),l.fireEvent("selectionchange",l.getSelectionModel(),[]),JE.msg("操作完成")):JE.alert(r.obj)}}),e.callParent(arguments),e.copyInfo=e.down("box[ref=copyInfo]"),e.queryCBB=e.down("combobox[ref=queryTreeCBB]")},refreshQuery:function(){this.queryCBB.refreshStore(this.getStore())}}),Ext.define("JE.sys.funccfg.view.testcase.TestCase",{extend:"Ext.panel.Panel",alias:"widget.funccfg.testcase",id:"funccfg.testcase",layout:"fit",initComponent:function(){this.items=[{xtype:"funccfg.testcasegrid"}],this.callParent(arguments)},loadFunc:function(e){var t=Ext.getCmp("funccfg.testcasegrid");t.funcId=e;var i=JE.ajax({url:JE.getUrlMaps("je.core.getInfoById"),params:{tableCode:"JE_CORE_FUNCINFO",pkValue:e}});this.funcInfo=i;var n=" and TESTCASE_FUNCINFO_ID = '"+e+"'";t.getStore().proxy.extraParams.baseSql=n,t.getStore().proxy.extraParams.whereSql=n,t.getStore().proxy.extraParams.orderSql=" order by SY_ORDERINDEX ASC ",t.getStore().load()}}),Ext.define("JE.sys.funccfg.view.testcase.TestCaseForm",{extend:"Ext.form.Panel",alias:"widget.funccfg.testcaseform",id:"funccfg.testcaseform",layout:"column",border:0,autoScroll:!0,defaults:{labelAlign:"right",xtype:"textfield",columnWidth:.45,margin:"5 0 4 0",padding:"1 0 1 0"},items:[{name:"JE_CORE_TESTCASE_ID",fieldLabel:"主键ID",hidden:!0},{name:"TESTCASE_FUNCINFO_ID",fieldLabel:"外键",hidden:!0},{name:"TESTCASE_TITLE",fieldLabel:"标题",columnWidth:.9,allowBlank:!1},{xtype:"cbbfield",configInfo:"JE_TESTCASE_RANK,TESTCASE_RANK~TESTCASE_RANK_CODE,text~code",name:"TESTCASE_RANK_CODE",fieldLabel:"级别",value:"NORMAL"},{name:"TESTCASE_RANK",fieldLabel:"级别",value:"一般",hidden:!0},{xtype:"cbbfield",configInfo:"JE_TESTCASE_STATUS,TESTCASE_STATUS~TESTCASE_STATUS_CODE,text~code",name:"TESTCASE_STATUS_CODE",fieldLabel:"状态",readOnly:!0,value:"NOTEST"},{name:"TESTCASE_STATUS",fieldLabel:"状态",value:"未测试",hidden:!0},{name:"SY_CREATETIME",fieldLabel:"创建时间",value:Ext.Date.format(new Date,"Y-m-d H:i:s"),readOnly:!0},{name:"TESTCASE_LASTTESTTIME",fieldLabel:"最后测试时间",readOnly:!0},{name:"TESTCASE_FUNCNAME",fieldLabel:"功能名称",hidden:!0},{name:"TESTCASE_FUNCCODE",fieldLabel:"功能编码",hidden:!0},{name:"TESTCASE_TESTCONTEXT",xtype:"ckeditor",fieldLabel:"测试内容",columnWidth:.9}],buttonAlign:"center",initComponent:function(){this.useButton&&(this.buttons=[{text:"确定",formBind:!0,iconCls:"jeicon jeicon-check",handler:function(e){var t=e.up("window");t.fn?0!=t.fn(t)&&t.close():t.close()}},{text:"取消",iconCls:"jeicon jeicon-error",handler:function(e){e.up("window").close()}}]),this.callParent(arguments)}}),Ext.define("JE.sys.funccfg.view.testcase.TestCaseGrid",{extend:"Ext.grid.Panel",alias:"widget.funccfg.testcasegrid",id:"funccfg.testcasegrid",border:0,tbar:[{xtype:"button",ref:"insert",text:"添加",iconCls:"jeicon jeicon-new-form"},{xtype:"button",ref:"listupdate",text:"保存",iconCls:"jeicon jeicon-form-save"},{xtype:"button",ref:"remove",text:"删除",iconCls:"jeicon jeicon-delete-form"},"->",{xtype:"uxtrigger",width:200,ref:"querytext"}],selModel:{selType:"checkboxmodel"},columnLines:!0,frame:!1,multiSelect:!0,enableKeyNav:!0,columns:[{text:"主键ID",dataIndex:"JE_CORE_TESTCASE_ID",hidden:!0},{text:"级别",dataIndex:"TESTCASE_RANK_CODE",width:160,field:{xtype:"cbbfield",configInfo:"JE_TESTCASE_RANK,TESTCASE_RANK_CODE~TESTCASE_RANK,code~text",value:"func",selectOnFocus:!0},tactics:[{type:"dic",dicCode:"JE_TESTCASE_RANK"}],renderer:JE.renderer},{text:"状态",dataIndex:"TESTCASE_STATUS_CODE",width:160,tactics:[{type:"dic",dicCode:"JE_TESTCASE_STATUS"}],renderer:JE.renderer},{text:"标题",dataIndex:"TESTCASE_TITLE",width:200,renderer:function(e,t,i,n,a,l,o,d,r){return"<a href='javascript:void(0)' onclick=\"JE.sys.funccfg.util.singleton.editTestCase('"+i.get("JE_CORE_TESTCASE_ID")+"')\">"+e+"</a>"}},{text:"创建时间",dataIndex:"SY_CREATETIME",width:150},{text:"最后测试时间",dataIndex:"TESTCASE_LASTTESTTIME",width:150},{text:"最后测试人",dataIndex:"TESTCASE_TESTUSER",width:150},{text:"顺序",dataIndex:"SY_ORDERINDEX",width:50,hidden:!0},{text:"功能名称",dataIndex:"TESTCASE_FUNCNAME",width:50,hidden:!0},{text:"功能编码",dataIndex:"TESTCASE_FUNCCODE",width:50,hidden:!0},{text:"级别",dataIndex:"TESTCASE_RANK",hidden:!0}],initComponent:function(){this.store=JE.getStore({id:"JE_CORE_TESTCASE_ID",tableName:"JE_CORE_TESTCASE",action:JE.getUrlMaps("je.core")}),this.plugins=[Ext.create("Ext.grid.plugin.CellEditing",{clicksToEdit:1,pluginId:"cellEdit"})],this.callParent(arguments)}}),Ext.define("JE.sys.funccfg.controller.Button",{extend:"Ext.app.Controller",mixins:[],init:function(){var e={"[xtype=funccfg.button] button[ref=insert]":{click:function(e){JE.formWin({title:"添加按钮",width:300,height:100,items:{xtype:"textfield",labelWidth:60,fieldLabel:"编码",name:"name",allowBlank:!1},fn:function(e){if(Ext.isEmpty(e.name))return!1;var t=Ext.getCmp("funccfg.button");if((e=JE.ajax({url:JE.getUrlMaps("je.core.develop.resButton","save"),params:{tableCode:"JE_CORE_RESOURCEBUTTON",RESOURCEBUTTON_TYPE:"GRID",RESOURCEBUTTON_CODE:e.name,RESOURCEBUTTON_FUNCINFO_ID:t.funcId}})).success){var i=Ext.create(t.store.model.$className,e.obj);t.store.insert(0,i),JE.msg("数据添加成功...")}}})}},"[xtype=funccfg.button] button[ref=remove]":{click:function(e){var a=Ext.getCmp("funccfg.button"),l=a.getSelectionModel().getSelection();l.length<1||JE.confirm("确定删除选中的信息吗？",function(e,t){if("ok"==e){var i=[];Ext.each(l,function(e,t){i.push(e.get("JE_CORE_RESOURCEBUTTON_ID"))});var n=JE.ajax({url:JE.getUrlMaps("je.core.develop.resButton","remove"),params:{tableCode:"JE_CORE_RESOURCEBUTTON",ids:i.join(",")}});n.success&&(JE.msg(n.obj),a.getStore().load())}})}},"[xtype=funccfg.button] button[ref=listupdate]":{click:function(e){var t=Ext.getCmp("funccfg.button").getStore(),i=t.proxy.extraParams.funcId,n=t.getUpdatedRecords().concat(t.getNewRecords()),a=[],l="JE_CORE_RESOURCEBUTTON_ID";Ext.Array.each(n,function(e){var t=e.getChanges(),i=new Array;for(var n in t)i.push(n);t[l]=e.data[l],t._updatefields_=i.join(","),t.RESOURCEBUTTON_CODE=e.data.RESOURCEBUTTON_CODE,t.RESOURCEBUTTON_FUNCINFO_ID=e.data.RESOURCEBUTTON_FUNCINFO_ID,a.push(t)});var o=JE.ajax({url:JE.getUrlMaps("je.core.develop.resButton","updateList"),params:{tableCode:"JE_CORE_RESOURCEBUTTON",funcId:i,strData:Ext.encode(a)}});o.success&&(JE.msg(o.obj),t.load())}},"[xtype=funccfg.button] uxtrigger[ref=querytext]":{click:function(e){var t=e.getValue(),i=Ext.getCmp("funccfg.button"),n="";Ext.isEmpty(t)||(n=" and (RESOURCEBUTTON_CODE like '%"+t+"%' or RESOURCEBUTTON_NAME like '%"+t+"%') "),i.getStore().proxy.extraParams.whereSql=i.getStore().proxy.extraParams.baseSql+n,i.getStore().load()}}};this.control(e)},views:["JE.sys.funccfg.view.button.Button"],stores:[],models:[]}),Ext.define("JE.sys.funccfg.controller.Child",{extend:"Ext.app.Controller",mixins:[],init:function(){var e={"[xtype=funccfg.childgrid]":{selectionchange:function(e,t){var i=t[0];if(i){var n=" and ASSOCIATIONFIELD_FUNCRELAT_ID = '"+i.get("JE_CORE_FUNCRELATION_ID")+"'",a=Ext.getCmp("funccfg.childfieldgrid");a.getStore().proxy.extraParams.whereSql=n,a.getStore().load()}}},"[xtype=funccfg.childgrid] button[ref=impl]":{click:function(e){var a=Ext.getCmp("funccfg.childgrid");JE.selectWin({parent:null,parentType:"self",title:"选择子功能",configInfo:"JE_CORE_FUNCINFO,,,M",whereSql:" AND SY_JESYS='1' AND SY_PARENT='"+a.funcId+"' AND JE_CORE_FUNCINFO_ID NOT IN (SELECT FUNCRELATION_FUNCID FROM JE_CORE_FUNCRELATION WHERE FUNCRELATION_FUNCINFO_ID='"+a.funcId+"')",type:"grid",callback:function(e,t){var i=new Array;Ext.each(e,function(e){i.push(e.get("JE_CORE_FUNCINFO_ID"))});var n=JE.ajax({url:JE.getUrlMaps("je.core.develop.funRelation","doImpl"),params:{tableCode:"JE_CORE_FUNCRELATION",ids:i.join(","),FUNCRELATION_FUNCINFO_ID:a.funcId}});n.success?(a.getStore().load(),JE.msg("导入成功")):JE.alert(n.obj)}})}},"[xtype=funccfg.childgrid] splitbutton[ref=insert]":{click:function(e){var a=Ext.getCmp("funccfg.childgrid");JE.selectWin({parent:null,parentType:"self",title:"选择子功能",configInfo:"JE_CORE_FUNCINFO,,,M",whereSql:" AND SY_JESYS='1' AND JE_CORE_FUNCINFO_ID NOT IN (SELECT FUNCRELATION_FUNCID FROM JE_CORE_FUNCRELATION WHERE FUNCRELATION_FUNCINFO_ID='"+a.funcId+"')",type:"grid",callback:function(e,t){var i=new Array;Ext.each(e,function(e){i.push(e.get("JE_CORE_FUNCINFO_ID"))});var n=JE.ajax({url:JE.getUrlMaps("je.core.develop.funRelation","doImpl"),params:{tableCode:"JE_CORE_FUNCRELATION",ids:i.join(","),FUNCRELATION_FUNCINFO_ID:a.funcId}});n.success?(a.getStore().load(),JE.msg("添加成功")):JE.alert(n.obj)}})}},"[xtype=funccfg.childgrid] splitbutton menuitem":{click:function(n){var a=Ext.getCmp("funccfg.childgrid");JE.prompt("请输入子功能编码!",function(e,t){if("ok"==e){if(JE.isEmpty(t))return JE.alert("请输入子功能编码!"),!1;var i=JE.ajax({url:"/je/develop/funRelation/doSave",params:{tableCode:"JE_CORE_FUNCRELATION",FUNCRELATION_ENABLED:"1",FUNCRELATION_CODE:t,FUNCRELATION_FUNCINFO_ID:a.funcId,SY_STATUS:n.ref}});i.success?(a.store.add(i.obj),JE.msg("添加成功")):JE.alert(i.obj)}})}},"[xtype=funccfg.childgrid] button[ref=seeFunc]":{click:function(e){var t=Ext.getCmp("funccfg.childgrid"),i=t.getSelectionModel().getSelection();if(1==i.length){var n=i[0];if("idit"!=n.get("SY_STATUS")){var a=JE.ajax({url:JE.getUrlMaps("je.core.develop.funcInfo","load"),params:{tableCode:"JE_CORE_FUNCINFO",whereSql:" AND SY_JESYS='1' and FUNCINFO_FUNCCODE = '"+n.get("FUNCRELATION_CODE")+"'",limit:1}}).rows[0];a?(t.up("window").close(),JE.showFuncCfg(a.JE_CORE_FUNCINFO_ID)):JE.alert("功能不存在！")}else JE.alert("自定义功能没有配置信息可以查看！")}else JE.alert("请选择一条数据!")}},"[xtype=funccfg.childgrid] button[ref=listupdate]":{click:function(e){var t=Ext.getCmp("funccfg.childgrid").getStore(),i=t.proxy.extraParams.funcId,a="JE_CORE_FUNCRELATION_ID",l=new Array,n=t.getUpdatedRecords().concat(t.getNewRecords());Ext.Array.each(n,function(e){var t=e.getChanges(),i=new Array;for(var n in t)i.push(n);t[a]=e.data[a],t._updatefields_=i.join(","),l.push(t)});var o=JE.ajax({url:JE.getUrlMaps("je.core.develop.funRelation","updateList"),params:{tableCode:"JE_CORE_FUNCRELATION",funcId:i,strData:Ext.encode(l)}});o.success&&(JE.msg(o.obj),t.load())}},"[xtype=funccfg.childgrid] button[ref=remove]":{click:function(e){var t=Ext.getCmp("funccfg.childgrid");JE.Action.doRemove(t,{url:JE.getUrlMaps("je.core.develop.funRelation","remove"),tableName:"JE_CORE_FUNCRELATION",pkName:"JE_CORE_FUNCRELATION_ID"})}},"[xtype=funccfg.childfieldgrid] button[ref=insert]":{click:function(e){var t=Ext.getCmp("funccfg.childfieldgrid"),i=Ext.getCmp("funccfg.childgrid").getSelectionModel().getSelection()[0];i?(t.mainData={ASSOCIATIONFIELD_FUNCRELAT_ID:i.get("JE_CORE_FUNCRELATION_ID"),ASSOCIATIONFIELD_PID:i.get("FUNCRELATION_FUNCID"),ASSOCIATIONFIELD_FID:i.get("FUNCRELATION_FUNCINFO_ID")},JE.Action.doSave(t,{tableName:"JE_CORE_ASSOCIATIONFIELD",pkName:"JE_CORE_ASSOCIATIONFIELD_ID"})):JE.alert("请选择子功能信息，再进行关联字段添加...","warn")}},"[xtype=funccfg.childfieldgrid] button[ref=listupdate]":{click:function(e){var t=Ext.getCmp("funccfg.childfieldgrid").getStore(),i=t.proxy.extraParams.funcId,a="JE_CORE_ASSOCIATIONFIELD_ID",l=new Array,n=t.getUpdatedRecords().concat(t.getNewRecords());Ext.Array.each(n,function(e){var t=e.getChanges(),i=new Array;for(var n in t)i.push(n);t[a]=e.data[a],t._updatefields_=i.join(","),l.push(t)});var o=JE.ajax({url:JE.getUrlMaps("je.core.develop.associationField","updateList"),params:{tableCode:"JE_CORE_ASSOCIATIONFIELD",funcId:i,strData:Ext.encode(l)}});o.success&&(JE.msg(o.obj),t.load());var d=Ext.getCmp("funccfg.columngrid");d&&d.store&&d.store.load()}},"[xtype=funccfg.childfieldgrid] button[ref=remove]":{click:function(e){var t=Ext.getCmp("funccfg.childfieldgrid");JE.Action.doRemove(t,{tableName:"JE_CORE_ASSOCIATIONFIELD",pkName:"JE_CORE_ASSOCIATIONFIELD_ID"})}},"[xtype=funccfg.childgrid] uxtrigger[ref=querytext]":{click:function(e){var t=e.getValue(),i=Ext.getCmp("funccfg.childgrid"),n="";Ext.isEmpty(t)||(n=" and (FUNCRELATION_CODE like '%"+t+"%' or FUNCRELATION_NAME like '%"+t+"%') "),i.getStore().proxy.extraParams.whereSql=i.getStore().proxy.extraParams.baseSql+n,i.getStore().load(),Ext.getCmp("funccfg.childfieldgrid").getStore().removeAll()}}};this.control(e)},views:["JE.sys.funccfg.view.child.Child","JE.sys.funccfg.view.child.ChildGrid","JE.sys.funccfg.view.child.ChildFieldGrid"],stores:[],models:[]}),Ext.define("JE.sys.funccfg.controller.Column",{extend:"Ext.app.Controller",mixins:["JE.sys.funccfg.view.jseditor.Util"],init:function(){var g=this,e={"[xtype=funccfg.columngrid]":{itemclick:function(e,t){var i=Ext.getCmp("funccfg.columnform");i.isHidden()||i.loadRecord(t)},itemdblclick:function(e,t){var i=Ext.getCmp("funccfg.columnform");i.expand(!1),i.loadRecord(t)},load:function(e,t){var i=Ext.getCmp("funccfg.column").getCmp("columncols");Ext.each(["zhCols","enCols"],function(e){i.getCmp(e).loadCols(t)});var n=[];Ext.each(t,function(e){if("morecolumn"==e.get("RESOURCECOLUMN_XTYPE")){var t=e.get("RESOURCECOLUMN_CODE");n.push({code:t,text:t})}}),Ext.getCmp("funccfg.columnform").form.findField("RESOURCECOLUMN_MORECOLUMNNAME").store.loadData(n);var a=Ext.getCmp("funccfg.columngrid").down("gridcolumn[dataIndex=RESOURCECOLUMN_MORECOLUMNNAME]");a.getEditor?a.getEditor().store.loadData(n):a.field.dataArray=n},edit:function(e,t){var i=t.record,n=t.field,a=Ext.getCmp("funccfg.columnform"),l={};l[n]=i.get(n),a.form.setValues(l)}},"[xtype=funccfg.columnform]":{beforeexpand:function(e){var t=Ext.getCmp("funccfg.columngrid").getSelectionModel().getSelection();if(1!=t.length)return JE.alert("请选择一条数据！"),!1;e.loadRecord(t[0])}},"[xtype=funccfg.columngrid] menuitem":{click:function(e){var n=Ext.getCmp("funccfg.columngrid");if("uxcolumn"==e.ref){var t=JE.ajax({url:JE.getUrlMaps("je.core.getInfoById"),params:{tableCode:"JE_CORE_FUNCINFO",pkValue:n.funcId}});if(-1==["procedure","iditprocedure","sql"].indexOf(t.FUNCINFO_FUNCTYPE))return void JE.alert("只有功能类型为：存储过程，动态存储过程，SQL 的功能支持查询列！");JE.formWin({title:"数据列添加",width:300,height:300,defaults:{enableKeyEvents:!0,listeners:{keypress:function(e,t,i){if(t.getKey()==t.ENTER){var n=e.up("window").down("button[text=确定]");n.handler(n)}},allowBlank:!1}},items:[{fieldLabel:"列名称",name:"RESOURCECOLUMN_NAME"},{fieldLabel:"列编码",name:"RESOURCECOLUMN_CODE"}],fn:function(e){if(n.store.findRecord("RESOURCECOLUMN_CODE",e.RESOURCECOLUMN_CODE))return JE.msg("列编码已存在，请重新输入！"),!1;if((e=JE.ajax({url:JE.getUrlMaps("je.core.develop.resColumn","doQuerySave"),params:Ext.apply({tableCode:"JE_CORE_RESOURCECOLUMN",RESOURCECOLUMN_FUNCINFO_ID:n.funcId,RESOURCECOLUMN_XTYPE:"uxcolumn"},e)})).success){JE.msg("添加成功..."),n.store.load();var t=n.up("panel[xtype=funccfg.main]");if(t){var i=t.down("panel[xtype=funccfg.fieldgrid]");i&&i.store.load()}}}})}else if("morecolumn"==e.ref){(i=JE.ajax({url:JE.getUrlMaps("je.core.develop.resColumn","save"),params:{tableCode:"JE_CORE_RESOURCECOLUMN",RESOURCECOLUMN_FUNCINFO_ID:n.funcId,RESOURCECOLUMN_XTYPE:e.ref,RESOURCECOLUMN_NAME:e.text}})).success&&(JE.msg("添加成功..."),n.store.load())}else if("markcolumn"==e.ref){if(n.store.findRecord("RESOURCECOLUMN_CODE","SY__MARK"))JE.msg("只能添加一个标记列！");else(i=JE.ajax({url:JE.getUrlMaps("je.core.develop.resColumn","save"),params:{tableCode:"JE_CORE_RESOURCECOLUMN",RESOURCECOLUMN_FUNCINFO_ID:n.funcId,RESOURCECOLUMN_XTYPE:e.ref,RESOURCECOLUMN_NAME:"标记",RESOURCECOLUMN_CODE:"SY__MARK"}})).success&&(JE.msg("添加成功..."),n.store.load())}else if("postilcolumn"==e.ref){if(n.store.findRecord("RESOURCECOLUMN_CODE","SY__POSTIL"))JE.msg("只能添加一个批注列！");else(i=JE.ajax({url:JE.getUrlMaps("je.core.develop.resColumn","save"),params:{tableCode:"JE_CORE_RESOURCECOLUMN",RESOURCECOLUMN_FUNCINFO_ID:n.funcId,RESOURCECOLUMN_XTYPE:e.ref,RESOURCECOLUMN_NAME:"批注",RESOURCECOLUMN_CODE:"SY__POSTIL",RESOURCECOLUMN_LAZYLOAD:"1"}})).success?(JE.msg("添加成功..."),n.store.load()):JE.alert(i.obj)}else if("funceditcolumn"==e.ref){var i;if(n.store.findRecord("RESOURCECOLUMN_CODE","SY_FUNCEDIT"))JE.msg("只能添加一个修改标记列！");else(i=JE.ajax({url:JE.getUrlMaps("je.core.develop.resColumn","save"),params:{tableCode:"JE_CORE_RESOURCECOLUMN",RESOURCECOLUMN_FUNCINFO_ID:n.funcId,RESOURCECOLUMN_XTYPE:e.ref,RESOURCECOLUMN_NAME:"标记",RESOURCECOLUMN_CODE:"SY_FUNCEDIT",RESOURCECOLUMN_LAZYLOAD:"1"}})).success?(JE.msg("添加成功..."),n.store.load()):JE.alert(i.obj)}else{var a=JE.ajax({url:JE.getUrlMaps("je.core.resourceTable","getTableInfoByFunc"),params:{tableCode:"JE_CORE_FUNCINFO",pkValue:n.funcId}});if(!a.success)return void JE.alert("表信息获取失败!");var l=(a=a.obj).RESOURCETABLE_TABLECODE,o=a.JE_CORE_RESOURCETABLE_ID;if("addfield"==e.ref){var d=JE.win({title:"添加普通字段",buttons:[],width:400,height:330,items:[{xtype:"funccfg.addfieldform",tableCode:l,tablePk:o}],fn:function(e){var t=Ext.getCmp("funccfg.addfieldform").form.getValues();t.tableCode="JE_CORE_TABLECOLUMN";var i=JE.ajax({url:JE.getUrlMaps("je.core.tableColumn","addField"),params:t});i.success?(n.getStore().load(),JE.msg(i.obj)):JE.alert(i.obj)}});Ext.getCmp("funccfg.addfieldform").form.setValues({TABLECOLUMN_TYPE:"VARCHAR255",TABLECOLUMN_ISNULL:"1",TABLECOLUMN_CLASSIFY:"PRO",TABLECOLUMN_UNIQUE:"0",TABLECOLUMN_ISCREATE:"0",TABLECOLUMN_TREETYPE:"NORMAL",SY_ORDERINDEX:0,TABLECOLUMN_TABLECODE:l,TABLECOLUMN_RESOURCETABLE_ID:o}),d.show()}else"adddicfield"==e.ref?(0<=l.lastIndexOf("_")&&(l=l.substring(l.lastIndexOf("_")+1)),Ext.create("JE.sys.table.view.column.DictionaryFieldWin",{tableCode:l,tablePk:o,fn:function(e){g.applyTable(o)?n.getStore().load():JE.alert("表应用失败!")}})):"addcascadefield"==e.ref?(0<=l.lastIndexOf("_")&&(l=l.substring(l.lastIndexOf("_")+1)),JE.win({title:"级联字典辅助",autoShow:!0,width:607,height:500,items:{xtype:"tablecolumn.cascadefieldform",tableCode:l,pkValue:o,fn:function(e){g.applyTable(o)?n.getStore().load():JE.alert("表应用失败!")}}})):"addtablefield"==e.ref?Ext.create("JE.sys.table.view.column.TableFieldWin",{tableCode:l,tablePk:o,fn:function(e,t){g.applyTable(o)?n.getStore().load():JE.alert("表应用失败!")}}):"addatomfield"==e.ref&&Ext.create("JE.sys.table.view.column.AtomFieldWin",{tableCode:l,tablePk:o,fn:function(e){g.applyTable(o)?n.getStore().load():JE.alert("表应用失败!")}})}}},"[xtype=funccfg.columngrid] button[ref=remove]":{click:function(e){var n=Ext.getCmp("funccfg.columngrid"),a=n.getSelectionModel().getSelection();a.length<1||JE.confirm("确定删除选中的信息吗？",function(e){if("ok"==e){var i=[];Ext.each(a,function(e,t){i.push(e.get("JE_CORE_RESOURCECOLUMN_ID"))});var t=JE.ajax({url:JE.getUrlMaps("je.core.develop.resColumn","remove"),params:{tableCode:"JE_CORE_RESOURCECOLUMN",ids:i.join(",")}});t.success&&(JE.msg(t.obj),n.getStore().load())}})}},"[xtype=funccfg.columngrid] button[ref=impl]":{click:function(e){var t=Ext.getCmp("funccfg.columngrid"),i=Ext.getCmp("funccfg.fieldgrid"),n={tableCode:"JE_CORE_RESOURCECOLUMN",RESOURCECOLUMN_FUNCINFO_ID:t.funcId};JE.ajax({url:JE.getUrlMaps("je.core.develop.resColumn","impl"),params:n}).success&&(JE.msg("数据导入成功..."),t.getStore().load(),i&&i.getStore().load())}},"[xtype=funccfg.columngrid] button[ref=listupdate]":{click:function(e){var a=[],l="JE_CORE_RESOURCECOLUMN_ID",t=Ext.getCmp("funccfg.columnform");if(!t.isHidden()){var i=t.getValues(),n=g.comparVals(i,t.form.getValues());i._updatefields_=n.join(","),a.push(i)}var o=Ext.getCmp("funccfg.columngrid"),d=o.getStore(),r=o.funcId,c=JE.ajax({url:JE.getUrlMaps("je.core.load"),params:{tableCode:"JE_CORE_RESOURCEFIELD",whereSql:" AND RESOURCEFIELD_FUNCINFO_ID='"+r+"' AND RESOURCEFIELD_XTYPE IN ('rgroup','cgroup','cbbfield','treessfield','treessareafield','gridssfield','gridssareafield','searchfield','queryuserfield','queryuserareafield')",orderSql:"",queryFields:"RESOURCEFIELD_CODE,JE_CORE_RESOURCEFIELD_ID,RESOURCEFIELD_XTYPE,RESOURCEFIELD_CONFIGINFO",limit:-1}}),s=c&&c.rows?c.rows:JE.error("数据获取失败！"),E=JE.ajax({url:JE.getUrlMaps("je.core.develop.resColumn","getTreeTableCodes"),params:{tableCode:"JE_CORE_FUNCINFO",JE_CORE_FUNCINFO_ID:r}}),f=[],u=[],p={};Ext.each(s,function(e){p[e.RESOURCEFIELD_CODE]=e}),d.each(function(e){var t=e.get("RESOURCECOLUMN_CODE");if(-1!=["SY_CREATEUSER","SY_CREATEUSERNAME","SY_CREATEUSERID","SY_AUDFLAG","SY__POSTIL","SY_AUDFLAG","SY_PDID","SY_PIID"].indexOf(t)&&e.set("RESOURCECOLUMN_LAZYLOAD","1"),"1"==e.get("RESOURCECOLUMN_ISPK")&&e.set("RESOURCECOLUMN_LAZYLOAD","1"),-1!=E.indexOf(t)&&e.set("RESOURCECOLUMN_LAZYLOAD","1"),"0"==e.get("RESOURCECOLUMN_HIDDEN")&&-1!=["uxcheckcolumn","uxcolumn"].indexOf(e.get("RESOURCECOLUMN_XTYPE"))){e.set("RESOURCECOLUMN_LAZYLOAD","1");var i=p[t];if(i&&("1"==e.get("RESOURCECOLUMN_ALLOWEDIT")||"1"==e.get("RESOURCECOLUMN_ENABLEUPDATE"))){var n=i.RESOURCEFIELD_CONFIGINFO;if(!Ext.isEmpty(n)&&1<n.split(",").length){var a=n.split(",")[1];Ext.isEmpty(a)||Ext.each(a.split("~"),function(e){t!=e&&f.push(e)})}}}"1"!=e.get("RESOURCECOLUMN_LAZYLOAD")&&u.push(e),-1==["uxcheckcolumn","uxcolumn","postilcolumn"].indexOf(e.get("RESOURCECOLUMN_XTYPE"))&&e.set("RESOURCECOLUMN_LAZYLOAD","0")}),0<f.length&&Ext.each(u,function(e){var t=e.get("RESOURCECOLUMN_CODE");-1!=f.indexOf(t)&&e.set("RESOURCECOLUMN_LAZYLOAD","1")});var m=d.getUpdatedRecords().concat(d.getNewRecords());Ext.Array.each(m,function(e){var t=e.getChanges(),i=new Array;for(var n in t)i.push(n);t[l]=e.data[l],t._updatefields_=i.join(","),t.RESOURCECOLUMN_CODE=e.data.RESOURCECOLUMN_CODE,t.RESOURCECOLUMN_FUNCINFO_ID=e.data.RESOURCECOLUMN_FUNCINFO_ID,a.push(t)});var x=JE.ajax({url:JE.getUrlMaps("je.core.develop.resColumn","updateList"),params:{tableCode:"JE_CORE_RESOURCECOLUMN",funcId:r,strData:Ext.encode(a)}});x.success&&(JE.msg(x.obj),d.load())}},"[xtype=funccfg.columngrid] button[ref=tableInfoBtn]":{click:function(e){var t=e.up("panel[xtype=funccfg.columngrid]").funcId,i=JE.ajax({url:JE.getUrlMaps("je.core.getInfoById"),params:{tableCode:"JE_CORE_FUNCINFO",pkValue:t,queryColumns:"JE_CORE_FUNCINFO_ID,FUNCINFO_TABLENAME"}});if(0!=i.success){var S=Ext.value(i.FUNCINFO_TABLENAME,"");JE.initCtr("JE.sys.table.controller.ResourceTableController"),JE.win({title:"表结构",autoShow:!0,items:[{xtype:JE.getXTypeByClassName("JE.sys.table.view.CenterView")}],showFn:function(e){e.down("button[ref=displayMode]").hide();var t=(R=e.down("panel[xtype=table.centerview]")).down("panel[xtype=table.tablecolumngrid]"),i=R.down("panel[xtype=table.tablekeygrid]"),n=R.down("panel[xtype=table.tableindexgrid]"),a=R.down("panel[xtype=table.tabletracegrid]"),l=R.down("panel[xtype=table.tablayout]"),o=R.down("panel[xtype=table.tableform]"),d=o.down("button[ref=planView]"),r=o.down("button[ref=syncDbBtn]"),c=o.down("button[ref=tableCopy]");l.show(),o.down("displayfield[name=RESOURCETABLE_USEFUNC]").hide();var s=JE.ajax({url:JE.getUrlMaps("je.core.resourceTable","getInfoById"),params:{tableCode:"JE_CORE_RESOURCETABLE",whereSql:" AND SY_JESYS='1' AND RESOURCETABLE_TABLECODE='"+S+"'",userSql:"1"}});if(JE.isEmpty(s))return e.close(),void JE.alert("没有权限修改该表结构!");var E=Ext.value(s.JE_CORE_RESOURCETABLE_ID,""),f=s.RESOURCETABLE_TYPE,u=Ext.create(JE.getModel({tableName:"JE_CORE_RESOURCETABLE"}),s);d.setVisible("VIEW"==f),c.setVisible(!1),r.setVisible("VIEW"==f&&Ext.isEmpty(s.RESOURCETABLE_SQL)),o.getForm().loadRecord(u);var p=t.getStore();p.sqls.parent=" and TABLECOLUMN_RESOURCETABLE_ID='"+E+"'",p.getProxy().extraParams.whereSql=" and TABLECOLUMN_RESOURCETABLE_ID='"+E+"'",p.loadPage(1);var m=i.getStore();m.sqls.parent=" and TABLEKEY_RESOURCETABLE_ID='"+E+"'",m.getProxy().extraParams.whereSql=" and TABLEKEY_RESOURCETABLE_ID='"+E+"'",m.loadPage(1);var x=n.getStore();x.sqls.parent=" and TABLEINDEX_RESOURCETABLE_ID='"+E+"'",x.getProxy().extraParams.whereSql=" and TABLEINDEX_RESOURCETABLE_ID='"+E+"'",x.loadPage(1);var g=a.getStore();g.getProxy().extraParams.whereSql=" and TABLETRACE_RESOURCETABLE_ID='"+E+"'",g.loadPage(1);var C=o.down("dataview[xtype=table.tabledataview]"),h=C.up("fieldcontainer"),b=C.getStore();b.getProxy().extraParams.pkValue=E,b.load({callback:function(e,t,i){h&&(e&&0<e.length?h.show():h.hide())}});var y=o.getForm(),O=y.findField("RESOURCETABLE_ISCREATE"),I=y.findField("RESOURCETABLE_USEFUNC"),R=t.up("panel[xtype=table.tablayout]");I.hide(),"MODULE"==s.RESOURCETABLE_TYPE?(O.hide(),R.hide()):(O.show(),R.show())}})}else JE.alert("未找到功能信息!")}},"[xtype=funccfg.columngrid] button[ref=viewTableInfoBtn]":{click:function(e){var t=e.up("panel[xtype=funccfg.columngrid]").funcId,i=JE.ajax({url:JE.getUrlMaps("je.core.getInfoById"),params:{tableCode:"JE_CORE_FUNCINFO",pkValue:t}});if(0!=i.success){var S=Ext.value(i.FUNCINFO_CRUDTABLENAME,"");JE.isEmpty(S)?JE.alert("无法查看，操作表名为空。"):JE.win({title:"操作表结构",autoShow:!0,items:[{xtype:"table.centerview"}],showFn:function(e){e.down("button[ref=displayMode]").hide();var t=(R=e.down("panel[xtype=table.centerview]")).down("panel[xtype=table.tablecolumngrid]"),i=R.down("panel[xtype=table.tablekeygrid]"),n=R.down("panel[xtype=table.tableindexgrid]"),a=R.down("panel[xtype=table.tabletracegrid]"),l=R.down("panel[xtype=table.tablayout]"),o=R.down("panel[xtype=table.tableform]"),d=o.down("button[ref=planView]"),r=o.down("button[ref=syncDbBtn]"),c=o.down("button[ref=tableCopy]");l.show(),o.down("displayfield[name=RESOURCETABLE_USEFUNC]").hide();var s=JE.ajax({url:JE.getUrlMaps("je.core.resourceTable","getInfoById"),params:{tableCode:"JE_CORE_RESOURCETABLE",whereSql:" AND SY_JESYS='1' AND RESOURCETABLE_TABLECODE='"+S+"'",userSql:"1"}});if(JE.isEmpty(s))return e.close(),void JE.alert("没有权限修改该表结构!");var E=Ext.value(s.JE_CORE_RESOURCETABLE_ID,""),f=s.RESOURCETABLE_TYPE,u=Ext.create(JE.getModel({tableName:"JE_CORE_RESOURCETABLE"}),s);d.setVisible("VIEW"==f),c.setVisible(!1),r.setVisible(!0),o.getForm().loadRecord(u);var p=t.getStore();p.sqls.parent=" and TABLECOLUMN_RESOURCETABLE_ID='"+E+"'",p.getProxy().extraParams.whereSql=" and TABLECOLUMN_RESOURCETABLE_ID='"+E+"'",p.loadPage(1);var m=i.getStore();m.sqls.parent=" and TABLEKEY_RESOURCETABLE_ID='"+E+"'",m.getProxy().extraParams.whereSql=" and TABLEKEY_RESOURCETABLE_ID='"+E+"'",m.loadPage(1);var x=n.getStore();x.sqls.parent=" and TABLEINDEX_RESOURCETABLE_ID='"+E+"'",x.getProxy().extraParams.whereSql=" and TABLEINDEX_RESOURCETABLE_ID='"+E+"'",x.loadPage(1);var g=a.getStore();g.getProxy().extraParams.whereSql=" and TABLETRACE_RESOURCETABLE_ID='"+E+"'",g.loadPage(1);var C=o.down("dataview[xtype=table.tabledataview]"),h=C.up("fieldset"),b=C.getStore();b.getProxy().extraParams.pkValue=E,b.load({callback:function(e,t,i){h&&(e&&0<e.length?h.show():h.hide())}});var y=o.getForm(),O=y.findField("RESOURCETABLE_ISCREATE"),I=y.findField("RESOURCETABLE_USEFUNC"),R=t.up("panel[xtype=table.tablayout]");I.hide(),"MODULE"==s.RESOURCETABLE_TYPE?(O.hide(),R.hide()):(O.show(),R.show())}})}else JE.alert("未找到功能信息!")}},"[xtype=funccfg.columngrid] button[ref=setQueryBtn]":{click:function(e){var a=e.up("panel[xtype=funccfg.columngrid]"),l=a.funcId;JE.formWin({title:"批量设定高级查询属性",items:[{xtype:"textfield",fieldLabel:"字段标签",name:"queryLabel"},{xtype:"textfield",fieldLabel:"标签宽度",name:"queryLabelWidth"},{xtype:"cbbfield",configInfo:"JE_CORE_COLUMNQUERYTYPE",fieldLabel:"查询类型",name:"queryType"},{xtype:"cbbfield",multiSelect:!0,configInfo:"JE_CORE_COLUMNQUERYTYPE,queryTypes,code,M",fieldLabel:"可选范围",name:"queryTypes"},{xtype:"rgroup",configInfo:"YESORNO",value:"0",fieldLabel:"类型隐藏",name:"queryTypeHidden"},{xtype:"rgroup",configInfo:"YESORNO",fieldLabel:"排序禁用",value:"0",name:"querySortDisabled"}],fn:function(e,t){var i={};JE.isNotEmpty(e.queryLabel)&&(i.queryLabel=e.queryLabel),JE.isNotEmpty(e.queryLabelWidth)&&(i.queryLabelWidth=e.queryLabelWidth),JE.isNotEmpty(e.queryType)&&(i.queryType=e.queryType),JE.isNotEmpty(e.queryTypes)&&(i.queryTypes=e.queryTypes),JE.isNotEmpty(e.queryTypeHidden)&&"0"!=e.queryTypeHidden&&(i.queryTypeHidden=e.queryTypeHidden),JE.isNotEmpty(e.querySortDisabled)&&"0"!=e.querySortDisabled&&(i.querySortDisabled=e.querySortDisabled);var n=JE.ajax({url:JE.getUrlMaps("je.core.develop.funcInfo","listUpdate"),params:{tableCode:"JE_CORE_RESOURCECOLUMN",RESOURCECOLUMN_OTHERCONFIG:JE.encode(i),whereSql:" AND RESOURCECOLUMN_FUNCINFO_ID='"+l+"' AND RESOURCECOLUMN_QUERYTYPE in('group','group2','group3')"}});n.success?(JE.msg("修改成功"),a.store.load()):JE.alert(n.obj)}})}},"[xtype=funccfg.columnform] button[ref=jslistener]":{click:function(e){var t=Ext.getCmp("funccfg.columnform");g.showJSEditor({parent:t,fieldName:"RESOURCECOLUMN_JSLISTENER",type:"column"})}},"[xtype=funccfg.columnform] hidden[name=RESOURCECOLUMN_JSLISTENER]":{change:function(e,t,i){var n=e.ownerCt.down("button[ref=jslistener]");n&&n.setIconCls(g.isFireListener(t)?"jeicon jeicon-lightning-on":"jeicon jeicon-lightning-off")}},"[xtype=funccfg.columnform] button[ref=save]":{click:function(e){var i=Ext.getCmp("funccfg.columngrid"),t=Ext.getCmp("funccfg.columnform"),n=t.form.getChanges().keys.join(",");JE.submit(t,{url:JE.getUrlMaps("je.core.develop.resColumn","update"),params:{tableCode:"JE_CORE_RESOURCECOLUMN",_updatefields_:n},success:function(e,t){JE.msg("保存成功..."),i&&i.getStore().load()}})}},"[xtype=funccfg.columngrid] button[ref=sync]":{click:function(e){JE.confirm("确定同步吗？",function(e){if("ok"==e){var t=Ext.getCmp("funccfg.columngrid"),i=JE.ajax({url:JE.getUrlMaps("je.core.develop.resColumn","doSync"),params:{tableCode:"JE_CORE_RESOURCECOLUMN",RESOURCECOLUMN_FUNCINFO_ID:t.funcId}});i.success?(JE.msg("同步成功..."),t.getStore().load()):JE.alert(i.obj,"error")}})}},"[xtype=funccfg.columngrid] uxtrigger[ref=querytext]":{click:function(e){var t=e.getValue(),i=Ext.getCmp("funccfg.columngrid"),n="";Ext.isEmpty(t)||(n=" and (RESOURCECOLUMN_CODE like '%"+t+"%' or RESOURCECOLUMN_NAME like '%"+t+"%') "),i.getStore().proxy.extraParams.whereSql=i.getStore().proxy.extraParams.baseSql+n,i.getStore().load()}},"[xtype=funccfg.columngrid] button[ref=sort]":{click:function(e){var t=Ext.getCmp("funccfg.columngrid"),i={show:[],hide:[],sy:[]};t.getStore().each(function(e){var t=e.data;"1"!=t.RESOURCECOLUMN_HIDDEN?i.show.push(e):"SY_"==t.RESOURCECOLUMN_CODE.substring(0,3)?i.sy.push(e):i.hide.push(e)});var n=0;Ext.iterate(i,function(e,t){Ext.each(t,function(e){e.set("SY_ORDERINDEX",++n)})})}},"[xtype=funccfg.columngrid] button[ref=print]":{click:function(e){var t=Ext.getCmp("funccfg.columngrid");JE.showFuncCfg(t.funcId,"printlist")}}};g.control(e)},applyTable:function(e){return JE.ajax({url:JE.getUrlMaps("je.core.resourceTable","applyTable"),params:{tableCode:"JE_CORE_RESOURCETABLE",pkValue:e,RESOURCETABLE_ISCREATE:"1"}}).success},comparVals:function(e,t){var i=["SY_AUDFLAG","SY_CREATEORG","SY_CREATEORGID","SY_CREATEORGNAME","SY_CREATETIME","SY_CREATEUSER","SY_CREATEUSERID","SY_CREATEUSERNAME","SY_PIID","SY_PDID","SY_FLAG","SY_MODIFYORG","SY_MODIFYORGID","SY_MODIFYORGNAME","SY_MODIFYUSERNAME","SY_MODIFYUSERID","SY_MODIFYUSER","SY_MODIFYTIME","SY_PYJZ","SY_PYQC","SY_FORMUPLOADFILES"],n=new Array;for(var a in e){if(-1==i.indexOf(a))e[a]!=t[a]&&n.push(a)}return n},views:["JE.sys.funccfg.view.column.Column","JE.sys.funccfg.view.column.ColumnGrid","JE.sys.funccfg.view.column.ColumnForm","JE.sys.funccfg.view.column.DBField","JE.sys.funccfg.view.column.ColumnCols","JE.sys.funccfg.view.column.AddFieldForm","JE.sys.funccfg.view.column.ListView"],stores:[],models:[]}),Ext.define("JE.sys.funccfg.controller.Dataflow",{extend:"Ext.app.Controller",mixins:[],init:function(){var e={"[xtype=funccfg.dataflow] button[ref=insert]":{click:function(e){var t=Ext.getCmp("funccfg.dataflow"),i=JE.ajax({url:JE.getUrlMaps("je.core.save"),params:{tableCode:"JE_CORE_DATAFLOW",DATAFLOW_FUNCINFO_ID:t.funcId}});i.success&&(t.store.add(i.obj),JE.msg("数据添加成功..."))}},"[xtype=funccfg.dataflow] button[ref=remove]":{click:function(e){var a=Ext.getCmp("funccfg.dataflow"),l=a.getSelectionModel().getSelection();l.length<1||JE.confirm("确定删除选中的信息吗？",function(e,t){if("ok"==e){var i=[];Ext.each(l,function(e,t){i.push(e.get("JE_CORE_DATAFLOW_ID"))});var n=JE.ajax({url:JE.getUrlMaps("je.core.remove"),params:{tableCode:"JE_CORE_DATAFLOW",ids:i.join(",")}});n.success&&(JE.msg(n.obj),a.getStore().load())}})}},"[xtype=funccfg.dataflow] button[ref=listupdate]":{click:function(e){var t=Ext.getCmp("funccfg.dataflow").getStore(),i=t.proxy.extraParams.funcId,n=t.getUpdatedRecords().concat(t.getNewRecords()),a=[],l="JE_CORE_DATAFLOW_ID";Ext.Array.each(n,function(e){var t=e.getChanges(),i=new Array;for(var n in t)i.push(n);t[l]=e.data[l],t._updatefields_=i.join(","),a.push(t)});var o=JE.ajax({url:JE.getUrlMaps("je.core.updateList"),params:{tableCode:"JE_CORE_DATAFLOW",funcId:i,strData:Ext.encode(a)}});o.success&&(JE.msg(o.obj),t.commitChanges())}},"[xtype=funccfg.dataflow] uxtrigger[ref=querytext]":{click:function(e){var t=e.getValue();Ext.getCmp("funccfg.dataflow");Ext.isEmpty(t)}}};this.control(e)},views:["JE.sys.funccfg.view.data.DataFlowView"],stores:[],models:[]}),Ext.define("JE.sys.funccfg.controller.Field",{extend:"Ext.app.Controller",mixins:["JE.sys.funccfg.view.jseditor.Util"],init:function(){var s=this,e={"[xtype=funccfg.fieldgrid]":{itemclick:function(e,t){var i=Ext.getCmp("funccfg.fieldform");i.isHidden()||i.loadRecord(t)},itemdblclick:function(e,t){var i=Ext.getCmp("funccfg.fieldform");i.expand(!1),i.oldValues=t.data,i.loadRecord(t)},load:function(e,t){var i=[];Ext.each(t,function(e){if("fieldset"==e.get("RESOURCEFIELD_XTYPE")){var t=e.get("RESOURCEFIELD_CODE");i.push({code:t,text:t})}}),Ext.getCmp("funccfg.fieldform").form.findField("RESOURCEFIELD_GROUPNAME").store.loadData(i);var n=Ext.getCmp("funccfg.fieldgrid").down("gridcolumn[dataIndex=RESOURCEFIELD_GROUPNAME]");n.getEditor?n.getEditor().store.loadData(i):n.field.dataArray=i},edit:function(e,t){var i=t.record,n=t.field,a=Ext.getCmp("funccfg.fieldform"),l={};l[n]=i.get(n),a.form.setValues(l)}},"[xtype=funccfg.fieldform] [useExpFunc]":{beforerender:function(e){e.labelStyle="cursor: pointer;color:blue;",e.labelAttrTpl=' data-qtip="方法体编写" ',e.tempLabel=e.fieldLabel},afterrender:function(t){var i=t.ownerCt.form.findField(t.name+"FN");t.labelEl.on("click",function(){var e="/**\n * @param {Object} data 表单值\n * @param {Object} parentData 父功能表单值\n * @param {FormView} form 表单\n * @return {Boolean} \n **/\nfunction(data,parentData,form){\n}";if("RESOURCEFIELD_ENABLEEXP"==t.name)e="/**\n * @param {Object} node 树形节点\n * @return {Boolean} \n **/\nfunction(node){\n}";else if("RESOURCEFIELD_BINDING"==t.name)e="/**\n * @param {Object} data 表单值\n * @param {Object} parentData 父功能表单值\n * @param {FormView} form 表单\n * @return {Object} \n **/\nfunction(data,parentData,form){\n}";else if("RESOURCEFIELD_VTYPE"==t.name)e='/*自定义验证方法*/\n{\n//验证方法，返回true通过验证，false不通过\nfn:function(value, field){return true},\ntext:""//验证提示信息\n}';e=Ext.value(i.getValue(),e),JE.win({title:t.fieldLabel,width:800,height:600,frame:!1,layout:"fit",items:{border:0,xtype:"jecodeeditor",value:e,saveFn:function(e){i.setValue(e),JE.msg("保存成功！")}}}).show()})}},"[xtype=funccfg.fieldform] [expFunc]":{change:function(e,t){var i=e.ownerCt.form.findField(e.name.substring(0,e.name.length-2));i.setFieldLabel((Ext.isEmpty(t)?"":'<font color="red">！</font>')+i.tempLabel)}},"[xtype=funccfg.fieldform] textarea[name=RESOURCEFIELD_CONFIGINFO]":{afterrender:function(t){var e=t.up("[xtype=funccfg.fieldform]");if(t.labelEl){var i=t.labelEl.parent().appendChild({tag:"div",style:"cursor: pointer;color:green;margin:10px;text-align:right;",hidden:!0,html:"选择字典"});(t.sdicEl=i).on("click",function(){s.treeConfig(t,e)});var n=t.labelEl.parent().appendChild({tag:"div",style:"cursor: pointer;color:red;margin:10px;text-align:right;",hidden:!0,html:""});(t.tsEl=n).on("click",function(){Ext.isEmpty(t.actName)||s[t.actName](t,e)});var a=t.labelEl.parent().appendChild({tag:"div",style:"cursor: pointer;color:red;margin:10px;text-align:right;",hidden:!0,html:"查看字典"});(t.seedicEl=a).on("click",function(){s.seeDic(t)});var l=t.labelEl.parent().appendChild({tag:"div",style:"cursor: pointer;color:red;margin:10px;text-align:right;",hidden:!0,html:"字典项配置"});(t.editdicEl=l).on("click",function(){s.editDic(t,e)}),t.labelEl.on("click",function(){JE.formWin({title:"配置信息",width:800,height:600,frame:!1,layout:"fit",items:{xtype:"textarea",value:t.getValue(),name:"configInfo"},fn:function(e){t.setValue(e.configInfo)}})}).show()}}},"[xtype=funccfg.fieldform] hidden[name=RESOURCEFIELD_VALUEFN]":{change:function(e,t){var i=e.ownerCt.form.findField("RESOURCEFIELD_VALUE");i.txtEl&&i.txtEl.update((Ext.isEmpty(t)?"":'<font color="red">！</font>')+"默认值")}},"[xtype=funccfg.fieldform] cbbfield[name=RESOURCEFIELD_VALUE]":{afterrender:function(d){var r=d.up("[xtype=funccfg.fieldform]");if(d.labelEl){d.dicEl=d.labelEl.down("span[dicBtn]"),d.dicEl.on("click",function(e,t){var i=r.form.getValues();if(-1!=["childfuncfield","cbbfield","cbblistfield","rgroup","cgroup"].indexOf(i.RESOURCEFIELD_XTYPE))if(Ext.isEmpty(i.RESOURCEFIELD_CONFIGINFO))JE.alert("填写配置项里的字典信息再选择！");else{var n=i.RESOURCEFIELD_CONFIGINFO.split(",")[0];if("cbblistfield"==i.RESOURCEFIELD_XTYPE)JE.win({title:"默认值",width:600,height:400,bodyPadding:"5",bodyStyle:"background-color:#ffffff;",useButton:!0,items:{xtype:"cbblistfield",configInfo:n,allowBlank:!0,value:i.RESOURCEFIELD_VALUE},fn:function(e){d.setValue(e.items.get(0).getValue())}}).show();else if("childfuncfield"==i.RESOURCEFIELD_XTYPE){var a=JE.getFuncData(n),l=[];Ext.each(a.grid.columns,function(e){if("rownumberer"!=e.xtype&&-1==["SY_ORDERINDEX"].indexOf(e.dataIndex)){var t=Ext.clone(e);t.enableEdit=!1,t.menuDisabled=!0,t.sortable=!1,l.push(t)}}),JE.win({title:"默认值",width:800,height:400,bodyPadding:"5",bodyStyle:"background-color:#ffffff;",useButton:!0,items:{xtype:"jsonarrayfield",value:i.RESOURCEFIELD_VALUE,columns:l},fn:function(e){d.setValue(e.items.get(0).getValue())}}).show()}else{var o="cgroup"==i.RESOURCEFIELD_XTYPE?"M":"S";JE.selectWin({title:"字典项",configInfo:n+",,,"+o,type:"tree",callback:function(e,t){var i=[];Ext.each(e,function(e){i.push(e.get("code"))}),d.setValue(i.join(","))}})}}else JE.alert("只有下拉框，下拉框集合，单选，多选可以选择字典项默认值！")}),d.txtEl=d.labelEl.down("span[valueTxt]");var t=d.ownerCt.form.findField(d.name+"FN");d.txtEl.on("click",function(){var e="/**\n * @param {Object} parentData 父功能表单值\n * @param {Object} funcData 功能信息\n * @return {Object} \n **/\nfunction(parentData,funcData){\n}";e=Ext.value(t.getValue(),e),JE.win({title:"默认值",width:800,height:600,frame:!1,layout:"fit",items:{border:0,xtype:"jecodeeditor",value:e,saveFn:function(e){t.setValue(e),JE.msg("保存成功！")}}}).show()})}}},"[xtype=funccfg.fieldform] cbbfield[name=RESOURCEFIELD_XTYPE]":{change:function(e,t,i){var n=e.up("[xtype=funccfg.fieldform]"),a=n.form.findField("RESOURCEFIELD_CODE").getValue();if(JE.isNotEmpty(t)){if("childfuncfield"==t&&JE.isNotEmpty(a)&&-1==a.indexOf("childfuncfield"))return JE.alert("请使用表单配置中添加按钮添加子功能集合."),void e.setValue(i);if("displayfield"==t&&JE.isNotEmpty(a)&&-1==a.indexOf("displayfield"))return JE.alert("请使用表单配置中添加按钮添加展示字段."),void e.setValue(i);if("child"==t&&JE.isNotEmpty(a)&&"__child"!=a)return JE.alert("子功能在功能初始化已添加，无须手动添加."),void e.setValue(i)}n.getComponent("helpMsg").update({text:JE.helpMsg.configinfo[t]}),n.getComponent("otherHelpMsg").update({text:JE.helpMsg.otherconfig[t]});var l=n.form.findField("RESOURCEFIELD_CONFIGINFO");if(l.tsEl){var o="show",d="",r="",c="hide";"childfuncfield"==t?(d="调试",r="childfuncfield"):-1!=["gridssfield","gridssareafield","searchfield"].indexOf(t)?(d="构造器",r="gridssfield"):-1!=["cbbfield","rgroup","cgroup","treessfield","treessareafield","cbblistfield","multiitem"].indexOf(t)?(d="添加字典",r="adddic",c="show"):"textcode"==t?(d="设计器",r="textcodefield",n.form.findField("RESOURCEFIELD_VALUE").setValue("<系统自动生成>")):"queryuserfield"==t||"queryuserareafield"==t?(d="构造器",r="queryuserfield"):o="hide",l.actName=r,l.tsEl.setHTML(d),l.tsEl[o](),l.sdicEl[c](),l.seedicEl[c](),l.editdicEl[c]()}if(-1!=["cbbfield","rgroup","cgroup"].indexOf(t)){var s=l.getValue();if(!Ext.isEmpty(s)){var E=s.split(",")[0],f=JE.ajax({url:JE.getUrlMaps("je.core.dd.dd","getDicByCode"),params:{tableCode:"JE_CORE_DICTIONARY",ddCode:E}});Ext.isEmpty(f.JE_CORE_DICTIONARY_ID)||-1==["SQL_TREE"].indexOf(f.DICTIONARY_DDTYPE)||JE.alert("动态字典只能配置树形选择，请更改字段类型!")}}var u=n.form.findField("RESOURCEFIELD_HEIGHT"),p=u.getValue();JE.isEmpty(p)&&("textarea"==t?u.setValue("90"):"uxfilesfield"==t&&u.setValue("160"))}},"[xtype=funccfg.fieldform]":{beforeexpand:function(e){var t=Ext.getCmp("funccfg.fieldgrid");if(t){var i=t.getSelectionModel().getSelection();if(1!=i.length)return JE.alert("请选择一条数据！"),!1;var n=i[0];e.oldValues=n.data,e.loadRecord(n)}}},"[xtype=funccfg.fieldgrid] menuitem":{click:function(e){var t=Ext.getCmp("funccfg.fieldgrid"),i="",n=e.text;"fieldArea"==e.info&&(i='{fieldArea:"1"}',n="字段域"),JE.ajax({url:JE.getUrlMaps("je.core.develop.resField","save"),params:{tableCode:"JE_CORE_RESOURCEFIELD",RESOURCEFIELD_FUNCINFO_ID:t.funcId,RESOURCEFIELD_XTYPE:e.ref,RESOURCEFIELD_NAME:n,RESOURCEFIELD_OTHERCONFIG:i}}).success&&(JE.msg("添加成功..."),t.store.load())}},"[xtype=funccfg.fieldgrid] button[ref=remove]":{click:function(e){var n=Ext.getCmp("funccfg.fieldgrid"),a=n.getSelectionModel().getSelection();a.length<1||JE.confirm("确定删除选中的信息吗？",function(e){if("ok"==e){var i=[];Ext.each(a,function(e,t){i.push(e.get("JE_CORE_RESOURCEFIELD_ID"))});var t=JE.ajax({url:JE.getUrlMaps("je.core.develop.resField","remove"),params:{tableCode:"JE_CORE_RESOURCEFIELD",ids:i.join(",")}});t.success&&(JE.msg(t.obj),n.getStore().load())}})}},"[xtype=funccfg.fieldgrid] button[ref=listupdate]":{click:function(e){var a=[],l="JE_CORE_RESOURCEFIELD_ID",t=Ext.getCmp("funccfg.fieldform");if(!t.isHidden()){var i=t.getValues(),n=s.comparVals(i,t.oldValues);i._updatefields_=n.join(","),a.push(i)}var o=Ext.getCmp("funccfg.fieldgrid").getStore(),d=o.proxy.extraParams.funcId;o.each(function(e){"0"==e.get("RESOURCEFIELD_HIDDEN")&&e.set("RESOURCEFIELD_FIELDLAZY","1")});var r=o.getUpdatedRecords().concat(o.getNewRecords());Ext.Array.each(r,function(e){var i=e.getChanges(),t=new Array;for(var n in i)t.push(n);i[l]=e.data[l],i._updatefields_=t.join(","),i.RESOURCEFIELD_CODE=e.data.RESOURCEFIELD_CODE,i.RESOURCEFIELD_FUNCINFO_ID=e.data.RESOURCEFIELD_FUNCINFO_ID,Ext.iterate(i,function(e,t){i[e]=Ext.value(t,"")}),a.push(i)});var c=JE.ajax({url:JE.getUrlMaps("je.core.develop.resField","updateList"),params:{tableCode:"JE_CORE_RESOURCEFIELD",funcId:d,strData:Ext.encode(a)}});c.success&&(JE.msg(c.obj),o.load())}},"[xtype=funccfg.fieldform] textfield[name=RESOURCEFIELD_CODE]":{afterrender:function(e){var d=e.up("[xtype=funccfg.fieldform]");e.labelEl&&e.labelEl.on("click",function(){var e=d.form.findField("RESOURCEFIELD_CODE").getValue(),t=JE.getFuncData(Ext.value(d.funcCode,d.funcId));if(t){var i=t.basicFields[e],n=[],a=["cols","colspan","orderIndex","basicXtype","formCode","funcId","funcCode","tableName","pkName","fieldWidth","columnWidth","useDirty","groupName","locate","jsListener","listener","valueFn","bindingExp","visibleExp","readOnlyExp","allowBlankExp","enableExp","bindingExpFn","visibleExpFn","readOnlyExpFn","allowBlankExpFn","enableExpFn","bgColor","basicXtype","history","groupCols","field_id"];Ext.iterate(i,function(e,t){Ext.isEmpty(t)||-1!=a.indexOf(e)||(Ext.isString(t)&&(t="'"+t+"'"),n.push("\t"+e+" : "+t))});var l=Ext.value(JE.toDicText("JE_FUNC_XTYPE",i.basicXtype),i.xtype),o="{\n"+n.join(",\n")+"\n}";JE.win({title:"字段配置信息("+l+")",autoShow:!0,border:0,width:500,height:500,items:{xtype:"textarea",readOnly:!0,value:o}})}else alert("无功能缓存数据，无法显示字段结构！")})}},"[xtype=funccfg.fieldform] button[ref=jslistener]":{click:function(e){var t=Ext.getCmp("funccfg.fieldform");s.showJSEditor({parent:t,fieldName:"RESOURCEFIELD_JSLISTENER",type:"field"})}},"[xtype=funccfg.fieldform] hidden[name=RESOURCEFIELD_JSLISTENER]":{change:function(e,t,i){var n=e.ownerCt.down("button[ref=jslistener]");n&&n.setIconCls(s.isFireListener(t)?"jeicon jeicon-lightning-on":"jeicon jeicon-lightning-off")}},"[xtype=funccfg.fieldform] button[ref=save]":{click:function(e,i){var n=Ext.getCmp("funccfg.fieldform"),t=n.form.findField("RESOURCEFIELD_HIDDEN").getValue(),a=n.form.findField("RESOURCEFIELD_FIELDLAZY");if(0==t&&0==a.getValue()&&a.setValue("1"),n.saveAction)n.saveAction(n,i);else{var l=Ext.getCmp("funccfg.fieldgrid"),o=s.comparVals(n.form.getValues(),n.oldValues);JE.submit(n,{url:JE.getUrlMaps("je.core.develop.resField","update"),params:{tableCode:"JE_CORE_RESOURCEFIELD",_updatefields_:o.join(",")},success:function(e,t){JE.msg("保存成功..."),l&&l.getStore().load(),"window"==n.ownerCt.xtype&&0!=i&&n.ownerCt.close()}})}}},"[xtype=funccfg.fieldform] button[ref=editColumn]":{click:function(e){var t=Ext.getCmp("funccfg.fieldform");Ext.getCmp("funccfg.columnform")||JE.showFuncCfg(t.funcId,"columnform",t.fieldCode)}},"[xtype=funccfg.fieldgrid] button[ref=sync]":{click:function(e){JE.confirm("确定同步吗？",function(e){if("ok"==e){var t=Ext.getCmp("funccfg.fieldgrid"),i=JE.ajax({url:JE.getUrlMaps("je.core.develop.resField","doSync"),params:{tableCode:"JE_CORE_RESOURCEFIELD",RESOURCEFIELD_FUNCINFO_ID:t.funcId}});i.success?(JE.msg("同步成功..."),t.getStore().load()):JE.alert(i.obj,"error")}})}},"[xtype=funccfg.fieldgrid] uxtrigger[ref=querytext]":{click:function(e){var t=e.getValue(),i=Ext.getCmp("funccfg.fieldgrid"),n="";Ext.isEmpty(t)||(n=" and (RESOURCEFIELD_CODE like '%"+t+"%' or RESOURCEFIELD_NAME like '%"+t+"%') "),i.getStore().proxy.extraParams.whereSql=i.getStore().proxy.extraParams.baseSql+n,i.getStore().load()}},"[xtype=funccfg.fieldgrid] button[ref=sort]":{click:function(e){var t=Ext.getCmp("funccfg.fieldgrid"),i={show:[],hide:[],sy:[]};t.getStore().each(function(e){var t=e.data;"1"!=t.RESOURCEFIELD_HIDDEN?i.show.push(e):"SY_"==t.RESOURCEFIELD_CODE.substring(0,3)?i.sy.push(e):i.hide.push(e)});var n=0;Ext.iterate(i,function(e,t){Ext.each(t,function(e){e.set("SY_ORDERINDEX",++n)})})}},"[xtype=funccfg.fieldgrid] button[ref=designer]":{click:function(e){var t=Ext.getCmp("funccfg.fieldgrid");JE.win({title:"表单设计",border:0,items:{xtype:"formdesigner.mainview",funcId:t.funcId}}).show()}},"[xtype=funccfg.fieldgrid] button[ref=print]":{click:function(e){var t=Ext.getCmp("funccfg.fieldgrid");JE.win({title:"简易表单设计",border:0,items:{xtype:"funccfg.form",funcCode:t.funcCode}}).show()}}};s.control(e)},childfuncfield:function(e,t){var i=Ext.value(e.getValue(),"").split(",")[0];if(Ext.isEmpty(i))JE.alert("请先编写配置信息里的功能编码，再进行调试！");else{var n=JE.ajax({url:JE.getUrlMaps("je.core.load"),params:{tableCode:"JE_CORE_FUNCINFO",whereSql:" and FUNCINFO_FUNCCODE = '"+i+"'",limit:1}}).rows[0];n?(t.up("window").close(),JE.showFuncCfg(n.JE_CORE_FUNCINFO_ID)):JE.alert("功能不存在！")}},gridssfield:function(e,i){var t=JE.win({title:"查询选择构造器",width:.6*JE.getBodyWidth(),height:.6*JE.getBodyHeight(),border:0,items:{xtype:"funccfg.fieldssconfig",formObj:i},useButton:!0,fn:function(e){var t=e.getCmp(0).getConfigInfo();if(0==t)return!1;i.form.setValues({RESOURCEFIELD_CONFIGINFO:t.configInfo,RESOURCEFIELD_WHERESQL:t.whereSql,RESOURCEFIELD_OTHERCONFIG:t.otherConfig})}});t.show(null,function(){var e=i.form.getValues();t.getCmp(0).loadConfigInfo({xtype:e.RESOURCEFIELD_XTYPE,configInfo:e.RESOURCEFIELD_CONFIGINFO,otherConfig:e.RESOURCEFIELD_OTHERCONFIG,whereSql:e.RESOURCEFIELD_WHERESQL,funcId:e.RESOURCEFIELD_FUNCINFO_ID})})},queryuserfield:function(e,i){var t=JE.win({title:"人员构造器",width:.8*JE.getBodyWidth(),height:.8*JE.getBodyHeight(),border:0,resizable:!1,maximizable:!1,items:{xtype:"funccfg.fieldssconfig",formObj:i,userQuery:!0},useButton:!0,fn:function(e){var t=e.getCmp(0).getConfigInfo();if(0==t)return!1;i.form.setValues({RESOURCEFIELD_CONFIGINFO:t.configInfo,RESOURCEFIELD_WHERESQL:t.whereSql,RESOURCEFIELD_OTHERCONFIG:t.otherConfig})}});t.show(null,function(){var e=i.form.getValues();t.getCmp(0).loadConfigInfo({xtype:e.RESOURCEFIELD_XTYPE,configInfo:e.RESOURCEFIELD_CONFIGINFO,otherConfig:e.RESOURCEFIELD_OTHERCONFIG,whereSql:e.RESOURCEFIELD_WHERESQL,funcId:e.RESOURCEFIELD_FUNCINFO_ID})})},textcodefield:function(e,t){JE.win({title:"编号设计器",width:800,height:500,border:0,resizable:!1,maximizable:!1,items:{xtype:"funccfg.fieldtextcode",formObj:t},useButton:!0,fn:function(e){e.down("form").setConfigInfo()}}).show()},adddic:function(e,t){JE.win({title:"添加字典",width:800,height:500,border:0,resizable:!1,maximizable:!1,items:{xtype:"form",region:"west",layout:"anchor",width:320,margin:"0 2 0 0",bodyPadding:"10",bodyStyle:{background:"#FFFEDB"},defaults:{xtype:"textfield",labelAlign:"right",labelWidth:100,anchor:"100%",allowBlank:!1},items:[{fieldLabel:"字典名称",name:"DICTIONARY_DDNAME"},{fieldLabel:"字典编码",name:"DICTIONARY_DDCODE"},{xtype:"treessfield",fieldLabel:"所属子系统",configInfo:"JE_SYSTEM,DICTIONARY_BELONGSTONAME~DICTIONARY_BELONGSTO,text~code,S",name:"DICTIONARY_BELONGSTONAME"},{xtype:"textarea",fieldLabel:"表名(实体名/URL)",allowBlank:!0,name:"DICTIONARY_CLASSNAME"},{xtype:"hidden",name:"DICTIONARY_BELONGSTO"}]},useButton:!0,fn:function(e){var t=e.items.get(0);try{return t.setConfigInfo()}catch(e){return!1}}}).show()},treeConfig:function(p,m){JE.selectWin({title:"字典",configInfo:"JE_CORE_DICTIONARY",type:"grid",whereSql:" AND SY_JESYS='1'",callback:function(e){if(0<e.length){var t=JE.cacheFunc[m.funcId],i=e[0].get("DICTIONARY_DDCODE"),n=e[0].get("DICTIONARY_DDTYPE"),a=m.form.findField("RESOURCEFIELD_XTYPE").getValue(),l={};if("multiitem"!=a)if(t)l=t.basicFields;else{var o=Ext.getCmp("funccfg.fieldgrid");o&&o.store.each(function(e){l[e.RESOURCEFIELD_CODE]=e.RESOURCEFIELD_CODE})}if(JE.isNotEmpty(l)){var d=m.form.findField("RESOURCEFIELD_CODE").getValue(),r="",c=["ID","CODE","NAME"],s=["id","code","text"];Ext.each(c,function(e){if(d.substring(d.length-e.length)==e)return r=d.substring(0,d.length-e.length),!1});var E=-1==["cgroup"].indexOf(a)?"S":"M";if(Ext.isEmpty(r))i+=","+d+",code,"+E;else{var f=[],u=[];Ext.each(c,function(e,t){l[r+e]&&(f.push(r+e),u.push(s[t]))}),i+=","+f.join("~")+","+u.join("~")+","+E}}p.setValue(i),-1!=["SQL_TREE"].indexOf(n)&&-1==["treessfield","treessareafield"].indexOf(a)&&JE.alert("动态字典只能配置树形选择，请更改字段类型!")}}})},seeDic:function(e){var t=e.getValue().split(",")[0];Ext.isEmpty(t)||JE.showDicFunc(t)},editDic:function(e,t){var i=t.form.findField("RESOURCEFIELD_OTHERCONFIG"),n=Ext.decode(Ext.value(i.getValue(),"{}"));JE.formWin({title:"字典项配置",width:400,height:300,items:[{xtype:"yesnofield",name:"editDic",fieldLabel:"选项可编辑",boxLabel:"启用后用户可对字典项进行编辑"},{name:"editDicText",xtype:"textfield",fieldLabel:"链接名",allowBlank:!1,value:"编辑选项"},{name:"editDicIcon",fieldLabel:"链接图标",xtype:"gridssfield",value:"jeicon jeicon-pencil",configInfo:"JE_CORE_FONTICON,editDicIcon,FONTICON_CLS,S,"},{xtype:"yesnofield",fieldLabel:"公用",name:"editDicCommon"},{name:"editDicPermText",xtype:"treessareafield",configInfo:"JE_RBAC_ROLE,editDicPerm~editDicPermText,id~text,M",whereSql:" AND ROLERANK='SYS'",fieldLabel:"可用角色"},{name:"editDicPerm",xtype:"hidden"}],showFn:function(e){e.getCmp(0).form.setValues(n)},fn:function(e){n=Ext.apply(n,e),i.setValue(Ext.encode(n))}})},comparVals:function(e,t){var i=["SY_AUDFLAG","SY_CREATEORG","SY_CREATEORGID","SY_CREATEORGNAME","SY_CREATETIME","SY_CREATEUSER","SY_CREATEUSERID","SY_CREATEUSERNAME","SY_PIID","SY_PDID","SY_FLAG","SY_MODIFYORG","SY_MODIFYORGID","SY_MODIFYORGNAME","SY_MODIFYUSERNAME","SY_MODIFYUSERID","SY_MODIFYUSER","SY_MODIFYTIME","SY_PYJZ","SY_PYQC","SY_FORMUPLOADFILES"],n=new Array;for(var a in e){if(-1==i.indexOf(a))e[a]!=t[a]&&n.push(a)}return n},views:["JE.sys.funccfg.view.field.Field","JE.sys.funccfg.view.field.FieldGrid","JE.sys.funccfg.view.field.FieldForm","JE.sys.funccfg.view.field.FieldFormTitle","JE.sys.funccfg.view.field.FieldSSConfig","JE.sys.funccfg.view.field.FieldTextCode","JE.sys.funccfg.view.field.FieldDicAdd","JE.sys.funccfg.view.field.FieldAnalyze"],stores:[],models:[]}),Ext.define("JE.sys.funccfg.controller.Func",{extend:"Ext.app.Controller",mixins:["JE.sys.funccfg.view.jseditor.Util"],init:function(){var a=this,e={"[xtype=funccfg.func] button[ref=save]":{click:function(e){var t=Ext.getCmp("funccfg.func"),i=t.form.getValues(),n=a.comparVals(i,t.oldValues);JE.submit(t,{url:JE.getUrlMaps("je.core.develop.funcInfo","doUpdate"),params:{tableCode:"JE_CORE_FUNCINFO",_updatefields_:n.join(",")},success:function(e,t){var i=t.result,n=Ext.getCmp("funccfg.button");n&&n.store.load(),i.success?JE.msg("修改成功!"):JE.alert("修改失败!")}})}},"[xtype=funccfg.simplefunc] button[ref=save]":{click:function(e){var n=Ext.getCmp("funccfg.simplefunc"),t=n.form.getValues(),i=a.comparVals(t,n.oldValues);JE.submit(n,{url:JE.getUrlMaps("je.core.develop.funcInfo","doUpdate"),params:{tableCode:"JE_CORE_FUNCINFO",_updatefields_:i.join(",")},success:function(e,t){var i=t.result;n.oldValues=i.obj,i.success?JE.msg("修改成功!"):JE.alert("修改失败!"),"window"==n.ownerCt.xtype&&n.ownerCt.close()}})}},"[xtype=funccfg.func] button[ref=gridJS]":{click:function(e){var t=Ext.getCmp("funccfg.func");a.showJSEditor({parent:t,fieldName:"FUNCINFO_GRIDJSLISTENER",type:"grid"})}},"[xtype=funccfg.func] button[ref=extendPanel]":{click:function(e){var t=Ext.getCmp("funccfg.func");JE.win({title:"扩展面板",width:850,height:320,useButton:!0,items:Ext.create("JE.sys.funccfg.view.other.ExPanelView",{funcForm:t,itemId:"expanelview"}),fn:function(e){e.getCmp("expanelview").saveInfo()}}).show()}},"[xtype=funccfg.func] button[ref=upTag]":{click:function(e){var t=Ext.getCmp("funccfg.func").form.getValues().JE_CORE_FUNCINFO_ID;if(JE.isEmpty(t))JE.alert("功能主键为空!");else{var i=new Array;i.push(t);var n=JE.ajax({url:"/je/upgrade/doAddUpTag",params:{type:"FUNC",ids:i.join(",")}});n.success?JE.msg(n.obj):JE.alert(n.obj)}}},"[xtype=funccfg.func] hidden[name=FUNCINFO_GRIDJSLISTENER]":{change:function(e,t,i){var n=e.ownerCt.ownerCt.down("button[ref=gridJS]");n&&n.setIconCls(a.isFireListener(t)?"jeicon jeicon-lightning-on":"jeicon jeicon-lightning-off")}},"[xtype=funccfg.func] button[ref=formJS]":{click:function(e){var t=Ext.getCmp("funccfg.func");a.showJSEditor({parent:t,fieldName:"FUNCINFO_FORMJSLISTENER",type:"form"})}},"[xtype=funccfg.func] hidden[name=FUNCINFO_FORMJSLISTENER]":{change:function(e,t,i){var n=e.ownerCt.ownerCt.down("button[ref=formJS]");n&&n.setIconCls(a.isFireListener(t)?"jeicon jeicon-lightning-on":"jeicon jeicon-lightning-off")}},"[xtype=funccfg.func] cbbfield[name=FUNCINFO_FUNCTYPE]":{change:function(e,t,i){var n=Ext.getCmp("funccfg.func");n.form.findField("FUNCINFO_TABLENAME").setAllowBlank(-1==["func","tree","view"].indexOf(t)),n.form.findField("FUNCINFO_DBNAME").setVisible(-1==["func","tree","view"].indexOf(t)),n.form.findField("FUNCINFO_VIEWCONFIGINFO").setVisible(-1!=["view"].indexOf(t)),n.form.findField("FUNCINFO_PROCEDURE").setVisible(-1!=["procedure","iditprocedure"].indexOf(t)),n.form.findField("FUNCINFO_PROCEDURE").setAllowBlank(-1==["procedure","iditprocedure"].indexOf(t)),n.form.findField("FUNCINFO_SQL").setVisible("sql"==t),n.form.findField("FUNCINFO_SQL").setAllowBlank("sql"!=t),n.form.findField("FUNCINFO_QUERYPARAM").setVisible(-1!=["procedure","iditprocedure","sql"].indexOf(t)),n.form.findField("FUNCINFO_CRUDTABLENAME").setVisible("view"==t),n.form.findField("FUNCINFO_CRUDTABLENAME").setAllowBlank("view"!=t),n.form.findField("FUNCINFO_FUNCDICCONFIG").setVisible("tree"==t)}},"[xtype=funccfg.func] cbbfield[name=FUNCINFO_DBNAME]":{afterrender:function(e){e.getStore().insert(0,[{text:"本地",code:"local",id:"local"}])}},"[xtype=funccfg.simplefunc] textarea[name=FUNCINFO_ORDERSQL]":{afterrender:function(e){e.labelEl&&(e.labelEl.parent().appendChild({tag:"div",style:"cursor: pointer;color:blue;margin:10px 10px 3px 10px;text-align:right;",html:"序号正序"}).on("click",function(){e.setValue("ORDER BY SY_ORDERINDEX ASC")}),e.labelEl.parent().appendChild({tag:"div",style:"cursor: pointer;color:blue;margin:3px 10px 0px 10px;text-align:right;",html:"时间倒序"}).on("click",function(){e.setValue("ORDER BY SY_CREATETIME DESC")}))}},"[xtype=funccfg.func] textarea[name=FUNCINFO_ORDERSQL]":{afterrender:function(e){e.labelEl&&(e.labelEl.parent().appendChild({tag:"div",style:"cursor: pointer;color:blue;margin:10px 10px 3px 10px;text-align:right;",html:"序号正序"}).on("click",function(){e.setValue("ORDER BY SY_ORDERINDEX ASC")}),e.labelEl.parent().appendChild({tag:"div",style:"cursor: pointer;color:blue;margin:3px 10px 0px 10px;text-align:right;",html:"时间倒序"}).on("click",function(){e.setValue("ORDER BY SY_CREATETIME DESC")}))}},"[xtype=funccfg.func] uxtrigger[name=FUNCINFO_EXPANDJS]":{render:function(t){t.handler=function(){var e=t.up("form").getValues();Ext.isEmpty(e.FUNCINFO_FUNCCODE)?JE.alert("请先输入功能编码，再进行操作！"):Ext.create("JE.sys.funccfg.view.other.ExJSView",{fieldObj:t,formValues:e}).show()}}},"[xtype=funccfg.func] menuitem":{click:function(e){"developCheckOut"==e.ref?a.checkOut("DEVELOPOUT"):"developCheckIn"==e.ref?a.checkIn("DEVELOPIN"):"checkOut"==e.ref?a.checkOut("ITEMOUT"):"checkIn"==e.ref?a.checkIn("ITEMIN",null):"removeGxh"==e.ref?a.checkIn("ITEMIN","放弃个性化"):"defaultGxh"==e.ref?a.checkDefault():"syncFunc"==e.ref&&a.checkSync()}}};a.control(e)},checkOut:function(e){var i=Ext.getCmp("funccfg.func"),t="";"DEVELOP"==JE.systemConfig.JE_CORE_MODE&&(t="_DEV");var n=i.form.findField("FUNCINFO_CHECKSTATUS"+t).getValue(),a=i.form.findField("FUNCINFO_VERSION"+t).getValue(),l=i.form.findField("JE_CORE_FUNCINFO_ID").getValue(),o=i.form.findField("FUNCINFO_FUNCNAME").getValue();if(-1!=["ITEMOUT","DEVELOPOUT"].indexOf(Ext.value(n,"")))JE.alert("功能处理检出状态，无法检出!");else{var d=1*Ext.value(a,1),r={tableCode:"JE_CORE_FUNCINFO",FUNCINFO_FUNCNAME:o,JE_CORE_FUNCINFO_ID:l};r["FUNCINFO_VERSION"+t]=d,r["FUNCINFO_CHECKUSER"+t]=JE.currentUser.username,r["FUNCINFO_CHECKUSERID"+t]=JE.currentUser.userId,r["FUNCINFO_CHECKSTATUS"+t]=e,JE.confirm("确定要检出该功能..",function(e){if("ok"==e){var t=JE.ajax({url:JE.getUrlMaps("je.core.develop.funcInfo","checkOut"),params:r});t.success?(i.loadAllFunc(l),JE.msg("检出成功!")):JE.alert(t.obj)}})}},checkIn:function(e,t){var a=Ext.getCmp("funccfg.func"),i="";"DEVELOP"==JE.systemConfig.JE_CORE_MODE&&(i="_DEV");var n=a.form.findField("FUNCINFO_CHECKSTATUS"+i).getValue(),l=a.form.findField("FUNCINFO_VERSION"+i).getValue(),o=a.form.findField("JE_CORE_FUNCINFO_ID").getValue(),d=a.form.findField("FUNCINFO_FUNCNAME").getValue(),r=a.form.findField("FUNCINFO_FUNCCODE").getValue();if(-1!=["ITEMIN","DEVELOPIN"].indexOf(Ext.value(n,"")))JE.alert("功能已处于提交状态，无法提交!");else{var c=1*Ext.value(l,1);c++;var s={FUNCINFO_FUNCNAME:d,FUNCINFO_FUNCCODE:r,tableCode:"JE_CORE_FUNCINFO",JE_CORE_FUNCINFO_ID:o};s["FUNCINFO_VERSION"+i]=c,s["FUNCINFO_CHECKUSER"+i]=JE.currentUser.username,s["FUNCINFO_CHECKUSERID"+i]=JE.currentUser.userId,s["FUNCINFO_CHECKSTATUS"+i]=e,JE.isNotEmpty(t)?(s.FUNCVERSION_XGNR=t,s.fqgxh="1",JE.confirm("确定放弃个性化..",function(e){if("ok"==e){var t=JE.ajax({url:JE.getUrlMaps("je.core.develop.funcInfo","checkIn"),params:s});t.success?(a.loadAllFunc(o),JE.msg("操作成功!")):JE.alert(t.obj)}})):JE.formWin({title:"请输入修改内容",border:0,layout:"fit",width:750,height:500,frame:!1,items:[{allowBlank:!1,xtype:"ckeditor",simpleToolbar:!0,name:"FUNCVERSION_XGNR"}],useButton:!0,fn:function(e,t){var i=e.FUNCVERSION_XGNR;if(JE.isEmpty(i))return JE.alert("请输入修改内容!"),!1;s.FUNCVERSION_XGNR=i;var n=JE.ajax({url:JE.getUrlMaps("je.core.develop.funcInfo","checkIn"),params:s});n.success?(a.setFormReadOnly(!0,JE.systemConfig.JE_CORE_MODE,s.FUNCINFO_CHECKSTATUS),JE.msg("提交成功!"),a.form.setValues(s)):JE.alert(n.obj)}})}},checkDefault:function(){var a=Ext.getCmp("funccfg.func"),e="";"DEVELOP"==JE.systemConfig.JE_CORE_MODE&&(e="_DEV");var l=a.form.findField("FUNCINFO_CHECKSTATUS"+e).getValue(),o=a.form.findField("FUNCINFO_VERSION"+e).getValue(),d=a.form.findField("JE_CORE_FUNCINFO_ID").getValue(),r=a.form.findField("FUNCINFO_FUNCNAME").getValue(),c=a.form.findField("FUNCINFO_FUNCCODE").getValue();JE.confirm("确定恢复默认配置..",function(e){if("ok"==e)if(-1!=["ITEMIN","DEVELOPIN"].indexOf(Ext.value(l,"")))JE.alert("功能已处于提交状态，无法设置成默认!");else{var t=1*Ext.value(o,1);t++;var i={FUNCINFO_CHECKUSER:JE.currentUser.username,FUNCINFO_CHECKUSERID:JE.currentUser.userId,FUNCINFO_VERSION:t,tableCode:"JE_CORE_FUNCINFO",JE_CORE_FUNCINFO_ID:d,FUNCINFO_FUNCNAME:r,FUNCINFO_FUNCCODE:c},n=JE.ajax({url:JE.getUrlMaps("je.core.develop.funcInfo","checkDefault"),params:i});n.success?(a.loadAllFunc(d),JE.msg("成功恢复默认设置!")):JE.alert(n.obj)}})},checkSync:function(){var a=Ext.getCmp("funccfg.func"),l=a.form.findField("FUNCINFO_CHECKSTATUS").getValue(),o=a.form.findField("FUNCINFO_VERSION").getValue(),d=a.form.findField("JE_CORE_FUNCINFO_ID").getValue(),r=a.form.findField("FUNCINFO_FUNCNAME").getValue(),c=a.form.findField("FUNCINFO_FUNCCODE").getValue();JE.confirm("确定同步配置吗..",function(e){if("ok"==e)if(-1!=["ITEMIN","DEVELOPIN"].indexOf(Ext.value(l,"")))JE.alert("功能已处于提交状态，无法设置成默认!");else{var t=1*Ext.value(o,1);t++;var i={FUNCINFO_CHECKUSER:JE.currentUser.username,FUNCINFO_CHECKUSERID:JE.currentUser.userId,FUNCINFO_VERSION:t,tableCode:"JE_CORE_FUNCINFO",JE_CORE_FUNCINFO_ID:d,FUNCINFO_FUNCNAME:r,FUNCINFO_FUNCCODE:c},n=JE.ajax({url:JE.getUrlMaps("je.core.develop.funcInfo","checkSync"),params:i});n.success?(JE.msg("功能同步成功!"),a.loadAllFunc(d)):JE.alert(n.obj)}})},comparVals:function(e,t){var i=["FUNCINFO_CHECKUSER_DEV","FUNCINFO_CHECKUSERID_DEV","FUNCINFO_CHECKSTATUS_DEV","FUNCINFO_VERSION_DEV","FUNCINFO_CHECKUSER","FUNCINFO_CHECKUSERID","FUNCINFO_CHECKSTATUS","FUNCINFO_VERSION","FUNCINFO_TREETIP_NE","SY_AUDFLAG","SY_CREATEORG","SY_CREATEORGID","SY_CREATEORGNAME","SY_CREATETIME","SY_CREATEUSER","SY_CREATEUSERID","SY_CREATEUSERNAME","SY_PIID","SY_PDID","SY_FLAG","SY_MODIFYORG","SY_MODIFYORGID","SY_MODIFYORGNAME","SY_MODIFYUSERNAME","SY_MODIFYUSERID","SY_MODIFYUSER","SY_MODIFYTIME","SY_PYJZ","SY_PYQC","SY_FORMUPLOADFILES"],n=new Array;for(var a in e){if(-1==i.indexOf(a))e[a]!=t[a]&&n.push(a)}return n},views:["JE.sys.funccfg.view.Func"],stores:[],models:[]}),Ext.define("JE.sys.funccfg.controller.FuncHelp",{extend:"Ext.app.Controller",mixins:[],init:function(){var e={"panel[xtype=funccfg.funchelp] button[ref=formSaveBtn]":{click:function(e){var t=e.up("panel[xtype=funccfg.funchelp]"),i=t.getCmp("FUNCINFO_HELP").getValue(),n="";i!=i.oldValue&&(n="FUNCINFO_HELP");var a=t.getDockedCmp("tbar").getCmp("FUNCINFO_HELPSOURCE").getValue(),l=t.getDockedCmp("tbar").getCmp("FUNCINFO_HELPSOURCE_TEXT").getValue(),o=JE.ajax({url:JE.getUrlMaps("je.core.develop.funcInfo","doUpdateHelp"),params:{tableCode:"JE_CORE_FUNCINFO",JE_CORE_FUNCINFO_ID:t.funcId,FUNCINFO_HELP:i,FUNCINFO_HELPSOURCE_TEXT:l,FUNCINFO_HELPSOURCE:a,_updatefields_:n}});if(o.success){JE.msg("保存成功!"),t.oldValue=o.obj.FUNCINFO_HELP;var d=Ext.getCmp("funccfg.func");d&&d.form.findField("FUNCINFO_HELP").setValue(o.obj.FUNCINFO_HELP)}else JE.alert("更新失败!")}},"panel[xtype=funccfg.funchelp] button[ref=formClearBtn]":{click:function(e){var t=e.up("panel[xtype=funccfg.funchelp]");var i=JE.ajax({url:JE.getUrlMaps("je.core.develop.funcInfo","doUpdateHelp"),params:{tableCode:"JE_CORE_FUNCINFO",JE_CORE_FUNCINFO_ID:t.funcId,FUNCINFO_HELP:"",_updatefields_:"FUNCINFO_HELP"}});if(i.success){JE.msg("清空成功!"),t.oldValue=i.obj.FUNCINFO_HELP;var n=Ext.getCmp("funccfg.func");n&&n.form.findField("FUNCINFO_HELP").setValue(i.obj.FUNCINFO_HELP)}else JE.alert("更新失败!")}}};this.control(e)},views:["JE.sys.funccfg.view.help.FuncHelp"],stores:[],models:[]}),Ext.define("JE.sys.funccfg.controller.FuncRelyon",{extend:"Ext.app.Controller",mixins:[],init:function(){this.control({})},views:["JE.sys.funccfg.view.funcrelyon.FuncRelyon","JE.sys.funccfg.view.funcrelyon.FuncRelyonGrid"],stores:[],models:[]}),Ext.define("JE.sys.funccfg.controller.JSEditor",{extend:"Ext.app.Controller",mixins:["JE.sys.funccfg.view.jseditor.Util"],init:function(){var C=this,e={"panel[xtype=funccfg.jscodeeditor] toolbar[itemId=eventTypeBar] button":{toggle:function(n,e){var t=n.up("panel[xtype=funccfg.jscodeeditor]"),i=t.getDockedComponent("eventObjBar"),a=t.getComponent("eventview"),l=n.funcInfo,o=l.funcId;if(t.loadData(),i.removeAll(),a.down("toolbar").setDisabled(!0),e){var d="",r="",c=[],s="";switch(n.type){case"func":var E=JE.ajax({url:JE.getUrlMaps("je.core.getInfoById"),params:{tableCode:"JE_CORE_FUNCINFO",pkValue:l.funcId}});c.push({text:"表单",type:"form",JE_CORE_FUNCINFO_ID:l.funcId,eventField:"FUNCINFO_FORMJSLISTENER",eventInfo:E.FUNCINFO_FORMJSLISTENER}),c.push({text:"列表",type:"grid",JE_CORE_FUNCINFO_ID:l.funcId,eventField:"FUNCINFO_GRIDJSLISTENER",eventInfo:E.FUNCINFO_GRIDJSLISTENER});break;case"column":d="RESOURCECOLUMN";break;case"field":d="RESOURCEFIELD",s="RESOURCEFIELD_XTYPE";break;case"button":d="RESOURCEBUTTON",r=" and RESOURCEBUTTON_TYPE != 'ACTION'";break;case"actioncolumn":d="RESOURCEBUTTON",r=" and RESOURCEBUTTON_TYPE = 'ACTION'"}var f="JE_CORE_FUNCINFO",u=f+"_ID",p="code",m="text",x="eventInfo";Ext.isEmpty(d)||(u=(f="JE_CORE_"+d)+"_ID",p=d+"_CODE",m=d+"_NAME",x=d+"_JSLISTENER",c=JE.ajax({url:JE.getUrlMaps("je.core.load"),params:{tableCode:f,limit:-1,whereSql:" and  "+d+"_FUNCINFO_ID = '"+o+"' and "+d+"_JSLISTENER is not null "+r}}).rows);var g=[];Ext.each(c,function(e){if(C.isFireListener(e[x])){var t={tableCode:f},i=Ext.value(e.eventField,x);t[u]=e[u],t[i]=e[i],g.push({text:'<span style="color:blue;" >'+e[m]+"</span>",type:Ext.value(e.type,n.type),chType:e[s],eventInfo:e[x],eventField:i,tooltip:Ext.value(e[p],""),dataInfo:t})}}),i.add(g)}}},"panel[xtype=funccfg.jscodeeditor] toolbar[itemId=eventObjBar] button":{toggle:function(e,t){var i=e.up("panel[xtype=funccfg.jscodeeditor]");i.getComponent("eventview").down("toolbar").setDisabled(!t),i.loadData(e.type,t?Ext.decode(e.eventInfo):void 0,e.chType)}}};C.control(e)},views:["JE.sys.funccfg.view.jseditor.JSCodeEditor"],stores:[],models:[]}),Ext.define("JE.sys.funccfg.controller.Main",{extend:"Ext.app.Controller",mixins:[],init:function(){var i=this,e={"button[ref=JE_ConfigEdit] menuitem[ref=JE_SimpleFuncConfig]":{click:function(e){JE.showFuncCfg(e.funcInfo.funcId,"simplefunc",{funcInfo:e.funcInfo})}},"button[ref=JE_ConfigEdit] menuitem[ref=JE_FuncConfig]":{click:function(e){JE.showFuncCfg(e.funcInfo.funcId)}},"button[ref=JE_ConfigEdit] menuitem[ref=JE_FormConfig]":{click:function(e){JE.showFuncCfg(e.funcInfo.funcId,"field",{funcInfo:e.funcInfo})}},"button[ref=JE_ConfigEdit] menuitem[ref=JE_FormDesignerConfig]":{click:function(e){Ext.getBody().mask(),JE.win({title:"表单设计",border:0,modal:!1,listeners:{close:function(e){Ext.getBody().unmask()}},items:{xtype:"formdesigner.mainview",funcId:e.funcInfo.funcId}}).show()}},"button[ref=JE_ConfigEdit] menuitem[ref=JE_TableFormConfig]":{click:function(e){JE.win({title:"简易表单设计",border:0,items:{xtype:"funccfg.form",funcInfo:e.funcInfo}}).show()}},"button[ref=JE_ConfigEdit] menuitem[ref=JE_TableFormConfig2]":{click:function(e){LODOP=JE.getLodop(),JE.isEmpty(LODOP.VERSION)||JE.win({title:"LODOP打印设计",border:0,items:{xtype:"funccfg.lodopform",funcInfo:e.funcInfo}}).show()}},"button[ref=JE_ConfigEdit] menuitem[ref=JE_GridConfig]":{click:function(e){JE.showFuncCfg(e.funcInfo.funcId,"column",{funcInfo:e.funcInfo})}},"button[ref=JE_ConfigEdit] menuitem[ref=JE_ListConfig]":{click:function(e){JE.showFuncCfg(e.funcInfo.funcId,"listview",{funcInfo:e.funcInfo})}},"button[ref=JE_ConfigEdit] menuitem[ref=JE_GridPrintConfig]":{click:function(e){JE.showFuncCfg(e.funcInfo.funcId,"printlist",{funcInfo:e.funcInfo})}},"button[ref=JE_ConfigEdit] menuitem[ref=JE_ButtonConfig]":{click:function(e){JE.showFuncCfg(e.funcInfo.funcId,"button",{funcInfo:e.funcInfo})}},"button[ref=JE_ConfigEdit] menuitem[ref=JE_ChildConfig]":{click:function(e){JE.showFuncCfg(e.funcInfo.funcId,"child",{funcInfo:e.funcInfo})}},"button[ref=JE_ConfigEdit] menuitem[ref=JE_DataflowConfig]":{click:function(e){JE.showFuncCfg(e.funcInfo.funcId,"dataflow",{funcInfo:e.funcInfo})}},"button[ref=JE_ConfigEdit] menuitem[ref=JE_DataConfig]":{click:function(e){var t=e.ownerCt.ownerButton.ownerCt.ownerCt;JE.showFuncCfg(e.funcInfo.funcId,"powerview",e.funcInfo.funcCode,{type:"SYS",funcInfo:e.funcInfo,selfContr:i,cmp:t})}},"button[ref=JE_ConfigEdit] menuitem[ref=JE_QueryConfig]":{click:function(e){JE.win({title:"编辑查询策略",layout:"fit",width:870,height:300,items:{xtype:"funccfg.cxclgrid",funcInfo:e.funcInfo}}).show()}},"button[ref=JE_ConfigEdit] menuitem[ref=JE_FuncJs]":{click:function(e){Ext.create("JE.sys.funccfg.view.jseditor.Util").showFuncJSEditor(e.funcInfo)}},"button[ref=JE_ConfigEdit] menuitem[ref=JE_HelpConfig]":{click:function(e){JE.showFuncCfg(e.funcInfo.funcId,"funchelp")}},"button[ref=JE_ConfigEdit] menuitem[ref=JE_TestcaseConfig]":{click:function(e){JE.showFuncCfg(e.funcInfo.funcId,"testcase")}},"button[ref=JE_ConfigEdit] menuitem[ref=JE_LocalLang]":{click:function(e){JE.win({title:"国际化维护",items:{xtype:"funccfg.locallangview",funcId:e.funcInfo.funcId},autoShow:!0})}},"button[ref=JE_ConfigEdit] menuitem[ref=configRefresh]":{click:function(e){var t=e.ownerCt.ownerButton.ownerCt.ownerCt;i.refreshFunc(t)}},"button[ref=JE_ConfigEdit] menuitem[ref=configRefreshS]":{click:function(e){var t=e.ownerCt.ownerButton.ownerCt.ownerCt;i.refreshFunc(t)}},"button[ref=JE_ConfigEdit] menuitem[ref=JE_GroupQueryView]":{click:function(e){JE.win({title:"高级查询配置",border:0,width:1191,items:{xtype:"funccfg.groupqeryview",funcInfo:e.funcInfo}}).show()}}};JE.currentUser.funcConfig&&(i.initLabelDBLClick(),i.initConfigBtns()),i.control(e),i.initCatch(),i.initAll(),i.initRefResh()},refreshFunc:function(e,a){if(e.funcData){var l=e.funcData.info,o=l.idSuffix,d=Ext.getCmp(l.funcCode+"_jemainview"+o);if(-1!=["jelistview","jegridview","jetreegridview","jedgridview"].indexOf(e.xtype)||-1!=e.id.indexOf("_jeformlistview"))JE.doMask(d,"功能重建中，请稍等...",function(){d.removeAll(!0),d.buildItem(!0,a)});else if("jeformview"==e.xtype){var r=JE.getFuncView(l.funcCode,"form",o),c="window"==r.ownerCt.xtype?r.ownerCt:d;JE.doMask(c,"表单重建中，请稍等...",function(){var t=JE.getFuncData(l.funcCode,{refresh:!0,staticFunc:a});if(t.info.idSuffix=o,"window"==c.xtype){var e=c,i=r.id;e.remove(r,!0),e.add({xtype:"jeformview",id:i,funcData:t,useChild:!1})}var n=Ext.getCmp(l.funcCode+"_jeeditview"+o);if(n){i=l.funcCode+"_jeformview"+o;n.remove(Ext.getCmp(i),!0),n.insert(0,{xtype:"jeformview",funcData:t,title:"详细信息",id:i}),Ext.defer(function(){var e=Ext.getCmp(l.funcCode+"_jegridview"+o);e?(JE.refreshModel({tableName:l.tableName,id:l.pkName},e.store.model),e.fireEvent("itemdblclick",e.view,e.getSelectionModel().getSelection()[0])):t.info.oneToForm&&d.refreshFunc()},100)}else d&&(d.removeAll(!0),d.buildItem(!0))})}}},initCatch:function(){JE.ajax({url:JE.getUrlMaps("je.core.dd.dd","getDicItemByCodes"),async:!0,params:{tableCode:"JE_CORE_DICTIONARY",ddListCodes:"JE_CORE_FUNCTYPE,JE_CHILDREN_LAYOUT,JE_CORE_INSERTTYPE,JE_CORE_RESOLUTION,JE_CORE_VERSIONTYPE,JE_FUNC_COLUMNXTYPE,JE_CORE_COLORTYPE,JE_CORE_ALIGN,JE_QUERYTYPE,JE_FUNC_XTYPE,JE_DEFAULEVALUE,JE_FUNC_JSREGEX,JE_CORE_FIELDCLS,JE_FUNC_VTYPES,JE_FUNC_PERMDATA",zwhDDCodes:""},success:function(e){var t=Ext.decode(Ext.value(e.responseText,"{}"));Ext.iterate(t,function(e,t){JE.dicListData[e]=t})}}),JE.loadModelFields("JE_CORE_RESOURCECOLUMN,JE_CORE_RESOURCEFIELD,JE_CORE_RESOURCEBUTTON,JE_CORE_FUNCRELATION,JE_CORE_DATAFLOW,JE_CORE_TESTCASE,JE_CORE_FUNCRELYON,JE_CORE_DICTIONARY")},initLabelDBLClick:function(){var e={afterRender:function(){var i=this;if(i.callParent(),i.funcId){function t(){var e=JE.getFuncData(i.funcId);if(e&&!JE.CoreUtil.coreFuncPrem(e)){var t=i.name;"fieldcontainer"==i.xtype&&i.fieldName&&(t=i.fieldName),JE.showFuncCfg(i.funcId,"fieldform",t)}}"fieldset"==i.xtype?i.legend&&i.legend.on("afterrender",function(e){e.getEl().on("dblclick",t)}):i.labelEl&&i.labelEl.on("dblclick",t)}}};Ext.override(Ext.form.field.Base,e),Ext.override(Ext.form.FieldContainer,e),Ext.override(Ext.form.FieldSet,e)},initConfigBtns:function(){var e={constructor:function(e){if("query"!=e.type&&!JE.CoreUtil.coreFuncPrem(e.funcData)){var t=Ext.clone(e.funcData.info);this.configButtons={cls:"je-func-configBtn",xtype:"button",iconCls:"jeicon jeicon-set-up",smallIconCls:"jeicon jeicon-set-up",bigIconCls:"jeicon jeicon-set-up",ref:"JE_ConfigEdit",itemId:"JE_ConfigEdit",text:"开发选项",menu:{cls:"je-funconfig-menu",items:[{text:"功能配置",ref:"JE_FuncConfig",iconCls:"jeicon jeicon-set-up",funcInfo:t},{text:"简单配置",ref:"JE_SimpleFuncConfig",iconCls:"jeicon jeicon-set-up",funcInfo:t},{text:"功能脚本",ref:"JE_FuncJs",iconCls:"jeicon jeicon-lightning-on",funcInfo:t},{text:"功能帮助",ref:"JE_HelpConfig",iconCls:"jeicon jeicon-question-circle",funcInfo:t},"-",{text:"列表配置",ref:"JE_GridConfig",iconCls:"jeicon jeicon-grid-configuration",funcInfo:t},{text:"自定义表格",ref:"JE_ListConfig",iconCls:"jeicon jeicon-atom",funcInfo:t},{text:"打印配置",ref:"JE_GridPrintConfig",iconCls:"jeicon jeicon-print",funcInfo:t},{text:"高级查询配置",ref:"JE_GroupQueryView",iconCls:"fa fa-search-plus",funcInfo:t},"-",{text:"表单配置",ref:"JE_FormConfig",iconCls:"jeicon jeicon-form-configuration",funcInfo:t},{text:"表单设计",ref:"JE_FormDesignerConfig",iconCls:"jeicon jeicon-planning",funcInfo:t},{text:"打印配置",ref:"JE_TableFormConfig",iconCls:"jeicon jeicon-print",funcInfo:t},{text:"插件打印配置",ref:"JE_TableFormConfig2",iconCls:"jeicon jeicon-print",funcInfo:t},"-",{text:"按钮配置",ref:"JE_ButtonConfig",iconCls:"jeicon jeicon-button",funcInfo:t},{text:"子功能项",ref:"JE_ChildConfig",iconCls:"jeicon jeicon-subfunction-configuration",funcInfo:t},{text:"数据流转策略",ref:"JE_DataflowConfig",iconCls:"jeicon jeicon-chart-data",funcInfo:t},{text:"数据权限",ref:"JE_DataConfig",iconCls:"jeicon jeicon-data-authorization",funcInfo:t},{text:"查询策略",ref:"JE_QueryConfig",iconCls:"jeicon jeicon-form-query",funcInfo:t},"-",{text:"刷新",ref:"configRefresh",iconCls:"jeicon jeicon-refresh",funcInfo:t}]}},JE.toBigButton(this.configButtons,t.bigButton),"plus"==JE.getTheme()&&Ext.apply(this.configButtons,{iconCls:"fa fa-gear",tooltip:"开发选项",text:""})}this.callParent(arguments)}};Ext.override(JE.core.view.FormView,e),Ext.override(JE.core.view.GridView,e),Ext.override(JE.core.view.ListView,e),Ext.override(JE.core.view.TreeGridView,e)},initRefResh:function(){JE.defer(function(){var e=Ext.getCmp("_jewestview");if(e){var t=[{type:"refresh",tooltip:"刷新清除页面缓存",handler:function(e,t,i){JE.ajax({url:JE.getUrlMaps("je.core.cache","clearAll")}),window.location.reload()}}];return e.buildRefreshTool?e.buildRefreshTool(t[0]):e.addTool(t),!1}},100)},initAll:function(){Ext.require("JE.sys.funccfg.util.singleton");Ext.each(["JE.sys.funccfg.controller.Column","JE.sys.funccfg.controller.Field","JE.sys.funccfg.controller.Button","JE.sys.funccfg.controller.Func","JE.sys.funccfg.controller.SubSystem","JE.sys.funccfg.controller.Child","JE.sys.funccfg.controller.TestCase","JE.sys.funccfg.controller.JSEditor","JE.sys.funccfg.controller.FuncRelyon","JE.sys.funccfg.controller.Perm","JE.sys.funccfg.controller.Print","JE.sys.funccfg.controller.FuncHelp","JE.sys.funccfg.controller.Dataflow","JE.sys.formdesigner.controller.MainController"],function(e){JE.initCtr(e)})},views:["JE.sys.funccfg.view.Main","JE.sys.funccfg.view.cxcl.CxclGrid","JE.sys.funccfg.view.form.Form","JE.sys.funccfg.view.form.FieldGrid","JE.sys.funccfg.view.lodop.FieldGrid","JE.sys.funccfg.view.lodop.Form","JE.sys.funccfg.view.other.LocalLangView","JE.sys.funccfg.view.SimpleFunc","JE.sys.funccfg.view.data.DataFlowView","JE.sys.funccfg.view.groupquery.GroupQueryView","JE.sys.funccfg.view.groupquery.GroupQueryGrid"],stores:[],models:[]}),Ext.onReady(function(){var e=setInterval(function(){JE&&JE.getApplication&&(clearInterval(e),"RUNNING"!=JE.systemConfig.JE_CORE_MODE&&JE.USER.funcConfig&&JE.initCtr("JE.sys.funccfg.controller.Main"))},100)}),Ext.define("JE.sys.funccfg.controller.Perm",{extend:"Ext.app.Controller",init:function(){var E=this,e={"treepanel[xtype=funccfg.permroletree]":{selectionchange:function(e,t){e.view.panel;var i=t[0],n=Ext.getCmp("funccfg.permview");if(i){var a=i.get("id"),l=Ext.value(n.funcPerm[a],[]);n.roleId=a;var o=new Array,d=new Array,r=new Array,c={},s={all:"1",versa:"0",sql:"",Sqlversa:"0"};Ext.each(l,function(e){"FIELD"==e.PERM_TARGERTYPE?o.push(e.PERM_TARGERID):"READONLY"==e.PERM_TARGERTYPE?d.push(e.PERM_TARGERID):"DIC"==e.PERM_TARGERTYPE?(r.push(e.PERM_TARGERID),c[e.PERM_TARGERID]?(c[e.PERM_TARGERID].id=e.PERM_TARGERID,c[e.PERM_TARGERID].sql=e.PERM_TARGERVALUE,c[e.PERM_TARGERID].overr=e.PERM_TARGEROVERR,c[e.PERM_TARGERID].all=e.PERM_SQLOVERR,c[e.PERM_TARGERID].query=e.PERM_SQLQUERY):c[e.PERM_TARGERID]={id:e.PERM_TARGERID,sql:e.PERM_TARGERVALUE,overr:e.PERM_TARGEROVERR,items:[],all:e.PERM_SQLOVERR,query:e.PERM_SQLQUERY}):"DICITEM"==e.PERM_TARGERTYPE?c[e.PERM_TARGERID]?c[e.PERM_TARGERID].items.push(e.PERM_TARGERVALUE):c[e.PERM_TARGERID]={items:[e.PERM_TARGERVALUE]}:"FIELDCONFIG"==e.PERM_TARGERTYPE&&(s.all=e.PERM_TARGERID,s.versa=e.PERM_TARGEROVERR,s.sql=e.PERM_TARGERVALUE,s.Sqlversa=e.PERM_SQLOVERR)});var E=n.down("panel[xtype=funccfg.permfield]"),f=E.down("dataview"),u=" AND 1!=1";0<o.length&&(u="AND JE_CORE_RESOURCEFIELD_ID IN ('"+o.join("','")+"')"),f.getStore().getProxy().extraParams.whereSql=u,f.getStore().load();var p=n.down("panel[xtype=funccfg.permfieldreadonly]"),m=p.down("dataview");u=" AND 1!=1",0<d.length&&(u="AND JE_CORE_RESOURCEFIELD_ID IN ('"+d.join("','")+"')"),m.getStore().getProxy().extraParams.whereSql=u,m.getStore().load();var x=n.down("panel[xtype=funccfg.permdic]"),g=x.down("dataview");u=" AND 1!=1",0<r.length&&(u="AND DICTIONARY_DDCODE IN ('"+r.join("','")+"')"),g.getStore().getProxy().extraParams.whereSql=u,g.getStore().load(),n.dicInfos=c;var C=n.down("panel[xtype=funccfg.permfieldform]");C.form.findField("PERM_FIELDSQL").setReadOnly(!1);var h=E.down("yesnofield[ref=FIELD_ALL]"),b=E.down("yesnofield[ref=FIELD_OVERR]");h.setValue(s.all),b.setValue(s.versa),C.form.setValues({PERM_FIELDSQL:s.sql,PERM_FIELDSQLOVERR:s.Sqlversa}),x.down("button[ref=add]").setDisabled(!1),x.down("button[ref=remove]").setDisabled(!1),x.down("button[ref=removeAll]").setDisabled(!1),p.down("button[ref=addReadOnly]").setDisabled(!1),p.down("button[ref=removeReadOnly]").setDisabled(!1),p.down("button[ref=removeAllReadOnly]").setDisabled(!1)}else n.resetPerm()}},"treepanel[xtype=funccfg.permdepttree]":{selectionchange:function(e,t){e.view.panel;var i=Ext.getCmp("funccfg.permview");if(null==t)return i.resetPerm(),(m=i.down("panel[xtype=funccfg.permdic]")).down("button[ref=add]").setDisabled(!0),m.down("button[ref=remove]").setDisabled(!0),m.down("button[ref=removeAll]").setDisabled(!0),(p=i.down("panel[xtype=funccfg.permfieldreadonly]")).down("button[ref=addReadOnly]").setDisabled(!1),p.down("button[ref=removeReadOnly]").setDisabled(!1),void p.down("button[ref=removeAllReadOnly]").setDisabled(!1);if(0==t.length)return i.resetPerm(),(m=i.down("panel[xtype=funccfg.permdic]")).down("button[ref=add]").setDisabled(!0),m.down("button[ref=remove]").setDisabled(!0),m.down("button[ref=removeAll]").setDisabled(!0),(p=i.down("panel[xtype=funccfg.permfieldreadonly]")).down("button[ref=addReadOnly]").setDisabled(!1),p.down("button[ref=removeReadOnly]").setDisabled(!1),void p.down("button[ref=removeAllReadOnly]").setDisabled(!1);if(1<t.length)i.resetPerm();else{var n=t[0].get("id"),a=Ext.value(i.funcPerm[n],[]);i.roleId=n;var l=new Array,o=new Array,d=new Array,r={},c={all:"1",versa:"0",sql:"",Sqlversa:"0"};Ext.each(a,function(e){"FIELD"==e.PERM_TARGERTYPE?l.push(e.PERM_TARGERID):"READONLY"==e.PERM_TARGERTYPE?o.push(e.PERM_TARGERID):"DIC"==e.PERM_TARGERTYPE?(d.push(e.PERM_TARGERID),r[e.PERM_TARGERID]?(r[e.PERM_TARGERID].id=e.PERM_TARGERID,r[e.PERM_TARGERID].sql=e.PERM_TARGERVALUE,r[e.PERM_TARGERID].overr=e.PERM_TARGEROVERR,r[e.PERM_TARGERID].all=e.PERM_SQLOVERR,r[e.PERM_TARGERID].query=e.PERM_SQLQUERY):r[e.PERM_TARGERID]={id:e.PERM_TARGERID,sql:e.PERM_TARGERVALUE,overr:e.PERM_TARGEROVERR,items:[],all:e.PERM_SQLOVERR,query:e.PERM_SQLQUERY}):"DICITEM"==e.PERM_TARGERTYPE?r[e.PERM_TARGERID]?r[e.PERM_TARGERID].items.push(e.PERM_TARGERVALUE):r[e.PERM_TARGERID]={items:[e.PERM_TARGERVALUE]}:"FIELDCONFIG"==e.PERM_TARGERTYPE&&(c.all=e.PERM_TARGERID,c.versa=e.PERM_TARGEROVERR,c.sql=e.PERM_TARGERVALUE,c.Sqlversa=e.PERM_SQLOVERR)});var s=i.down("panel[xtype=funccfg.permfield]"),E=s.down("dataview"),f=" AND 1!=1";0<l.length&&(f="AND JE_CORE_RESOURCEFIELD_ID IN ('"+l.join("','")+"')"),E.getStore().getProxy().extraParams.whereSql=f,E.getStore().load();var u=i.down("panel[xtype=funccfg.permfieldreadonly]"),p=u.down("dataview");f=" AND 1!=1",0<o.length&&(f="AND JE_CORE_RESOURCEFIELD_ID IN ('"+o.join("','")+"')"),p.getStore().getProxy().extraParams.whereSql=f,p.getStore().load();var m,x=(m=i.down("panel[xtype=funccfg.permdic]")).down("dataview");f=" AND 1!=1",0<d.length&&(f="AND DICTIONARY_DDCODE IN ('"+d.join("','")+"')"),x.getStore().getProxy().extraParams.whereSql=f,x.getStore().load(),i.dicInfos=r;var g=i.down("panel[xtype=funccfg.permfieldform]");g.form.findField("PERM_FIELDSQL").setReadOnly(!1);var C=s.down("yesnofield[ref=FIELD_ALL]"),h=s.down("yesnofield[ref=FIELD_OVERR]");C.setValue(c.all),h.setValue(c.versa),g.form.setValues({PERM_FIELDSQL:c.sql,PERM_FIELDSQLOVERR:c.Sqlversa}),m.down("button[ref=add]").setDisabled(!1),m.down("button[ref=remove]").setDisabled(!1),m.down("button[ref=removeAll]").setDisabled(!1),u.down("button[ref=addReadOnly]").setDisabled(!1),u.down("button[ref=removeReadOnly]").setDisabled(!1),u.down("button[ref=removeAllReadOnly]").setDisabled(!1)}}},"panel[ref=funcperm_group_tab]":{tabchange:function(e,t,i,n){var a=Ext.getCmp("funccfg.permview"),l="ROLE";"funccfg.permdepttree"==t.xtype&&(l="DEPT"),a.roleId="",a.modeType=l;var o=t.getSelectionModel(),d=o.getSelection();t.fireEvent("selectionchange",o,d)}},"panel[xtype=funccfg.permfield] yesnofield[ref=FIELD_ALL]":{change:function(e,t,i){e.getSubmitValue();var n="1"==t,a=Ext.getCmp("funccfg.permview").down("panel[xtype=funccfg.permfield]");a.down("yesnofield[ref=FIELD_OVERR]").setDisabled(n),a.down("button[ref=add]").setDisabled(n),a.down("button[ref=remove]").setDisabled(n),a.down("button[ref=removeAll]").setDisabled(n)}},"panel[xtype=funccfg.permfield] yesnofield[ref=FIELD_OVERR]":{change:function(e,t,i){e.getSubmitValue();var n="1"==t;Ext.getCmp("funccfg.permview").down("panel[xtype=funccfg.permfield]").down("yesnofield[ref=FIELD_ALL]").setDisabled(n)}},"panel[xtype=funccfg.permfield] button[ref=add]":{click:function(e){var t=Ext.getCmp("funccfg.permview"),i=e.up("panel[xtype=funccfg.permfield]").down("dataview").getStore(),n=t.funcInfo.funcId;JE.selectWin({parent:null,parentType:"self",title:"功能字段",configInfo:"JE_CORE_RESOURCEFIELD,,,M",whereSql:" AND RESOURCEFIELD_FUNCINFO_ID='"+n+"'",type:"grid",callback:function(e,t){Ext.each(e,function(e){i.findRecord("JE_CORE_RESOURCEFIELD_ID",e.get("JE_CORE_RESOURCEFIELD_ID"))||i.add(e)})}})}},"panel[xtype=funccfg.permfieldreadonly] button[ref=addReadOnly]":{click:function(e){var t=Ext.getCmp("funccfg.permview"),i=e.up("panel[xtype=funccfg.permfieldreadonly]").down("dataview").getStore(),n=t.funcInfo.funcId;JE.selectWin({parent:null,parentType:"self",title:"功能字段",configInfo:"JE_CORE_RESOURCEFIELD,,,M",whereSql:" AND RESOURCEFIELD_FUNCINFO_ID='"+n+"'",type:"grid",callback:function(e,t){Ext.each(e,function(e){i.findRecord("JE_CORE_RESOURCEFIELD_ID",e.get("JE_CORE_RESOURCEFIELD_ID"))||i.add(e)})}})}},"panel[xtype=funccfg.permfieldreadonly] button[ref=removeReadOnly]":{click:function(e){var t=e.up("panel[xtype=funccfg.permfieldreadonly]").down("dataview"),i=t.getStore(),n=t.getSelectionModel().getSelection();i.remove(n)}},"panel[xtype=funccfg.permfieldreadonly] button[ref=remove]":{click:function(e){var t=e.up("panel[xtype=funccfg.permfield]").down("dataview"),i=t.getStore(),n=t.getSelectionModel().getSelection();i.remove(n)}},"panel[xtype=funccfg.permfield] button[ref=remove]":{click:function(e){var t=e.up("panel[xtype=funccfg.permfield]").down("dataview"),i=t.getStore(),n=t.getSelectionModel().getSelection();i.remove(n)}},"panel[xtype=funccfg.permfield] button[ref=removeAll]":{click:function(e){e.up("panel[xtype=funccfg.permfield]").down("dataview").getStore().removeAll()}},"panel[xtype=funccfg.permfieldreadonly] button[ref=removeAllReadOnly]":{click:function(e){e.up("panel[xtype=funccfg.permfieldreadonly]").down("dataview").getStore().removeAll()}},"panel[xtype=funccfg.permdic] button[ref=add]":{click:function(e){var t=Ext.getCmp("funccfg.permview"),i=e.up("panel[xtype=funccfg.permdic]").down("dataview").getStore(),n=t.funcInfo.funcId,a=t.dicInfos,l=new Array,o=JE.ajax({url:JE.getUrlMaps("je.core.develop.funcPerm","getFuncFieldDic"),params:{tableCode:"JE_CORE_FUNCINFO",JE_CORE_FUNCINFO_ID:n}});o.success&&(l=o.obj),JE.selectWin({parent:null,parentType:"self",title:"字典",configInfo:"JE_CORE_DICTIONARY,,,M",whereSql:" AND SY_JESYS='1' AND DICTIONARY_DDCODE IN ('"+l.join("','")+"') AND DICTIONARY_DDTYPE IN ('LIST','TREE')",type:"grid",callback:function(e,t){Ext.each(e,function(e){i.findRecord("JE_CORE_DICTIONARY_ID",e.get("JE_CORE_DICTIONARY_ID"))||(i.add(e),a[e.get("DICTIONARY_DDCODE")]={sql:"",overr:"0",query:"0",items:[],all:"1"})})}})}},"panel[xtype=funccfg.permdic] button[ref=remove]":{click:function(e){var t=Ext.getCmp("funccfg.permview"),i=e.up("panel[xtype=funccfg.permdic]").down("dataview"),n=i.getStore(),a=i.getSelectionModel().getSelection();n.remove(a);var l=t.dicInfos;Ext.each(a,function(e){delete l[e.get("DICTIONARY_DDCODE")]})}},"panel[xtype=funccfg.permdic] button[ref=removeAll]":{click:function(e){var t=Ext.getCmp("funccfg.permview");e.up("panel[xtype=funccfg.permdic]").down("dataview").getStore().removeAll(),t.dicInfos={}}},"panel[xtype=funccfg.permdic] dataview":{selectionchange:function(e,t){var i=Ext.getCmp("funccfg.permview"),n=(e.view.panel,i.dicInfos),a=t[0],l=i.down("treepanel[xtype=funccfg.permdicitem]"),o=i.down("panel[xtype=funccfg.permdicform]"),d={},r=(l=i.down("treepanel[xtype=funccfg.permdicitem]")).getRootNode();l.getStore();if(r.removeAll(),a&&(d=Ext.value(n[a.get("DICTIONARY_DDCODE")],{})),a&&-1!=["TREE","LIST"].indexOf(a.get("DICTIONARY_DDTYPE"))){var c=JE.ajax({url:JE.getUrlMaps("je.core.getTree"),params:{moreRoot:!0,tableCode:"JE_CORE_DICTIONARYITEM",parentSql:" AND DICTIONARYITEM_DICTIONARY_ID='"+a.get("JE_CORE_DICTIONARY_ID")+"'",whereSql:" AND SY_FLAG='1' AND DICTIONARYITEM_DICTIONARY_ID='"+a.get("JE_CORE_DICTIONARY_ID")+"'"}});c&&0<c.children.length&&r.appendChild(c.children),l.expandAll(),l.dicId=a.get("DICTIONARY_DDCODE"),o.dicId=a.get("DICTIONARY_DDCODE");var s=Ext.value(d.items,[]);E.eachAllChild(r,function(e){0<s.length?-1!=s.indexOf(e.get("id"))&&e.set("checked",!0):e.set("checked",!0)})}else a?(l.dicId=a.get("DICTIONARY_DDCODE"),o.dicId=a.get("DICTIONARY_DDCODE")):(l.dicId="",o.dicId="");o.form.setValues({PERM_DICSQL:Ext.value(d.sql,""),PERM_DICSQLOVERR:Ext.value(d.overr,"0"),PERM_DICSQLQUERY:Ext.value(d.query,"0")})}},"treepanel[xtype=funccfg.permdicitem]":{checkchange:function(e,t,i){var n=Ext.getCmp("funccfg.permview"),a=n.down("treepanel[xtype=funccfg.permdicitem]"),l=a.dicId,o=a.getChecked(),d=new Array;Ext.each(o,function(e){d.push(e.get("id"))});var r=n.dicInfos[l];r.all="0",r.items=d}},"panel[xtype=funccfg.permdicform] field[name=PERM_DICSQL]":{change:function(e,t,i){var n=Ext.getCmp("funccfg.permview").dicInfos,a=e.up("panel[xtype=funccfg.permdicform]").dicId;Ext.isEmpty(a)||(n[a].sql=t)}},"panel[xtype=funccfg.permdicform] field[name=PERM_DICSQLOVERR]":{change:function(e,t,i){var n=Ext.getCmp("funccfg.permview").dicInfos,a=e.up("panel[xtype=funccfg.permdicform]").dicId;Ext.isEmpty(a)||(n[a].overr=1==t?"1":"0")}},"panel[xtype=funccfg.permdicform] field[name=PERM_DICSQLQUERY]":{change:function(e,t,i){var n=Ext.getCmp("funccfg.permview").dicInfos,a=e.up("panel[xtype=funccfg.permdicform]").dicId;Ext.isEmpty(a)||(n[a].query=1==t?"1":"0")}},"panel[xtype=funccfg.permdata] button[ref=save]":{click:function(e){var n=Ext.getCmp("funccfg.permview"),t=n.down("treepanel[xtype=funccfg.permroletree]"),i=n.down("treepanel[xtype=funccfg.permdepttree]"),a=new Array,l="0",o="0",d="0",r="0";if("DEPT"==n.modeType){var c=i.getSelectionModel().getSelection(),s=i.getSelectionModel(),E=i.getRootNode();if(null==c)return void JE.alert("你选中部门节点");if(Ext.value(c,[]).length<=0)if(E.hasChildNodes())c=[E.getChildAt(0)],s.select(c),r="1";if(!(0<c.length))return void JE.alert("你选中部门节点");Ext.each(c,function(e){a.push(e.get("id"))})}else{E=t.getRootNode(),c=t.getSelectionModel().getSelection();if(s=t.getSelectionModel(),Ext.value(c,[]).length<=0)if(E.hasChildNodes())c=[E.getChildAt(0)],s.select(c);if(null==c)return void JE.alert("你选中角色节点");if(1!=c.length)return void JE.alert("你选中角色节点");a.push(c[0].get("id"))}var f=n.funcInfo.funcId,u=n.roleId,p=new Array,m=new Array,x=new Array,g=new Array,C={},h={all:"1",versa:"0",sql:"",Sqlversa:"0"},b=n.down("panel[xtype=funccfg.permfield]"),y=b.down("dataview"),O=n.down("panel[xtype=funccfg.permfieldreadonly]").down("dataview"),I=n.down("panel[xtype=funccfg.permfieldform]"),R=b.down("yesnofield[ref=FIELD_ALL]"),S=b.down("yesnofield[ref=FIELD_OVERR]"),_=n.down("panel[xtype=funccfg.permdic]").down("dataview"),N=I.form.getValues();h.all=1==R.getValue()?"1":"0",h.versa=1==S.getValue()?"1":"0",h.sql=N.PERM_FIELDSQL,h.Sqlversa=1==N.PERM_FIELDSQLOVERR?"1":"0";var w=n.dicInfos;"DEPT"==n.modeType&&1<a.length&&("1"==h.all&&"0"==h.versa&&""==h.sql&&"0"==h.Sqlversa&&(o="1"),_.getStore().getCount()<=0&&(l="1"),O.getStore().getCount()<=0&&(d="1")),Ext.each(a,function(i){"0"==o&&(p.push({PERM_TYPE:n.modeType,PERM_FUNCINFO_ID:f,PERM_ROLE_ID:i,PERM_TARGERTYPE:"FIELDCONFIG",PERM_TARGERID:h.all,PERM_TARGEROVERR:h.versa,PERM_TARGERVALUE:h.sql,PERM_SQLOVERR:h.Sqlversa}),y.getStore().each(function(e){m.push(e.get("JE_CORE_RESOURCEFIELD_ID")),p.push({PERM_TYPE:n.modeType,PERM_FUNCINFO_ID:f,PERM_ROLE_ID:i,PERM_TARGERTYPE:"FIELD",PERM_TARGERID:e.get("JE_CORE_RESOURCEFIELD_ID")})})),"0"==l&&_.getStore().each(function(t){g.push(t.get("DICTIONARY_DDCODE"));var e=w[t.get("DICTIONARY_DDCODE")];C[t.get("DICTIONARY_DDCODE")]=e,p.push({PERM_TYPE:n.modeType,PERM_FUNCINFO_ID:f,PERM_ROLE_ID:i,PERM_TARGERTYPE:"DIC",PERM_TARGERID:t.get("DICTIONARY_DDCODE"),PERM_TARGERVALUE:e.sql,PERM_TARGEROVERR:e.overr,PERM_SQLOVERR:e.all,PERM_SQLQUERY:e.query}),"0"==e.all&&Ext.each(e.items,function(e){p.push({PERM_TYPE:n.modeType,PERM_FUNCINFO_ID:f,PERM_ROLE_ID:i,PERM_TARGERTYPE:"DICITEM",PERM_TARGERID:t.get("DICTIONARY_DDCODE"),PERM_TARGERVALUE:e})})}),"0"==d&&O.getStore().each(function(e){x.push(e.get("JE_CORE_RESOURCEFIELD_ID")),p.push({PERM_TYPE:n.modeType,PERM_FUNCINFO_ID:f,PERM_ROLE_ID:i,PERM_TARGERTYPE:"READONLY",PERM_TARGERID:e.get("JE_CORE_RESOURCEFIELD_ID")})})});var v=n.down("panel[xtype=funccfg.permdata]"),L=v.form.getChanges().keys.join(","),F=v.form.getValues();F.tableCode=n.tableCode,F._updatefields_=L,F.JE_CORE_FUNCINFO_ID=f,F.roleId=u,F.roleIds=a.join(","),F.modeType=n.modeType,F.excludeDic=l,F.excludeField=o,F.strData=Ext.encode(p),F.noSelectDept=r;var T=JE.ajax({url:JE.getUrlMaps("je.core.develop.funcPerm","doUpdatePerm"),params:F});if(T.success){var A=JE.ajax({url:JE.getUrlMaps("je.core.develop.funcPerm","getFuncPerm"),params:{tableCode:"JE_CORE_FUNCINFO",JE_CORE_FUNCINFO_ID:f}});n.funcPerm=A.FUNCPERM,n.funcInfo={funcId:A.JE_CORE_FUNCINFO_ID,funcCode:A.FUNCINFO_FUNCCODE,funcName:A.FUNCINFO_FUNCNAME},JE.msg("保存成功")}else JE.alert(T.obj)}},"panel[xtype=funccfg.permdata] button[ref=reset]":{click:function(e){var t=Ext.getCmp("funccfg.permview"),i=t.down("panel[xtype=funccfg.permfield]"),n=i.down("dataview"),a=(t.down("panel[xtype=funccfg.permfieldreadonly]"),i.down("dataview")),l=t.down("panel[xtype=funccfg.permdic]").down("dataview"),o=t.down("panel[xtype=funccfg.permfieldform]"),d=i.down("yesnofield[ref=FIELD_ALL]"),r=i.down("yesnofield[ref=FIELD_OVERR]"),c=t.down("panel[xtype=funccfg.permdicform]");l.getStore().removeAll(),n.getStore().removeAll(),a.getStore().removeAll(),o.form.setValues({PERM_FIELDSQL:"",PERM_FIELDSQLOVERR:"0"}),c.form.setValues({PERM_DICSQL:"",PERM_DICSQLOVERR:"0",PERM_DICSQLQUERY:"1"}),d.setValue("1"),r.setValue("0"),t.dicInfos={}}}};E.control(e)},eachAllChild:function(e,t){var i=this;e.eachChild(function(e){t(e),e.hasChildNodes()&&i.eachAllChild(e,t)})},views:["JE.sys.funccfg.view.perm.PermView","JE.sys.funccfg.view.perm.PermRoleTree","JE.sys.funccfg.view.perm.PermDeptTree","JE.sys.funccfg.view.perm.PermField","JE.sys.funccfg.view.perm.PermDic","JE.sys.funccfg.view.perm.PermData","JE.sys.funccfg.view.perm.PermDicForm","JE.sys.funccfg.view.perm.PermDicItem","JE.sys.funccfg.view.perm.PermFieldForm","JE.sys.funccfg.view.perm.PermFieldReadOnly","JE.sys.funccfg.view.power.PowerView"],stores:[],models:[]}),Ext.define("JE.sys.funccfg.controller.Print",{extend:"Ext.app.Controller",mixins:[],init:function(){var e={"panel[xtype=funccfg.printlist] cbbfield[name=pageType]":{change:function(e,t){var i=Ext.value(t,"").split(",");e.up("[xtype=funccfg.printlist]").changePageSize(i[0].split("*")[0])}},"panel[xtype=funccfg.printlist] rgroup[ref=pageAlign]":{change:function(e,t){var i=Ext.value(t,"").split(",");if(!(1<i.length)){var n=i[0];e.up("[xtype=funccfg.printlist]").pagePanel.getDockedComponent(e.type+"Box").getEl().setStyle({textAlign:n})}}},"panel[xtype=funccfg.printlist] textfield[ref=pageHFTpl]":{change:function(e,t){e.hfBox||(e.hfBox=e.up("[xtype=funccfg.printlist]").pagePanel.getDockedComponent(e.name+"Box")),t=Ext.value(t,e.fieldLabel),e.hfBox.el.dom.innerHTML=t}},"panel[xtype=funccfg.printlist] button[ref=pageHFG]":{click:function(e){var t=e.previousSibling();JE.getUrlMaps("je.core"),t.name,JE.win({title:"编辑",useButton:!0,autoShow:!0,border:0,items:{xtype:"ueditor",itemId:"ueditor",simpleToolbar:!0,value:t.getValue()},fn:function(e){val=e.getCmp("ueditor").getHtml(),t.setValue(val)}})}},"panel[xtype=funccfg.printlist] button[ref=preview]":{click:function(e){e.up("[xtype=funccfg.printlist]").previewPage()}},"panel[xtype=funccfg.printlist] button[ref=import]":{click:function(e){e.up("[xtype=funccfg.printlist]").loadCols()}},"panel[xtype=funccfg.printlist] button[ref=ok]":{click:function(e){e.up("[xtype=funccfg.printlist]").savePrintInfo()}},"panel[xtype=funccfg.printlist] button[ref=autoResize]":{click:function(e){e.up("[xtype=funccfg.printlist]").autoResizeGrid()}}};this.control(e)},views:["JE.sys.funccfg.view.print.PrintList"],stores:[],models:[]}),Ext.define("JE.sys.funccfg.controller.SubSystem",{extend:"Ext.app.Controller",mixins:[],init:function(){var l=this,e={"[xtype=funccfg.subsystemgrid]":{itemclick:function(e,t){if(t){var i=e.panel,n=JE.ajax({url:JE.getUrlMaps("je.core.doc.document","loadFormFiles"),params:{whereSql:" and DOCUMENT_PKVALUE = '"+t.get("id")+"' and  DOCUMENT_FIELDCODE = 'formUploadFiles' AND DOCUMENT_TYPE='OTHER'",tableCode:"JE_CORE_DOCUMENT",orderSql:" order by SY_CREATETIME desc",limit:-1}});i.ownerCt.down("grid[ref=filesGrid]").getStore().loadData(n.rows),i.ownerCt.down("textarea[name=FUNCINFO_FUNCREMARK]").setValue(t.get("FUNCINFO_FUNCREMARK"))}},itemdblclick:function(e,t){t&&-1!=["FUNC","FUNCFIELD"].indexOf(t.get("nodeInfoType"))&&JE.showFuncCfg(t.get("id"))}},"[xtype=funccfg.subsystemgrid] button[ref=paste]":{click:function(e){var l=e.up("[xtype=funccfg.subsystemgrid]"),o=Ext.clone(l.copyObj),d=l.getSelectionModel().getSelection()[0];if(d){var t=d.get("nodeInfoType");"SYSTEM"!=t?JE.formWin({title:"粘贴功能",height:150,defaults:{labelWidth:100},items:[{xtype:"yesnofield",fieldLabel:"替换当前功能",name:"thgn",columnWidth:.5,readOnly:"MODEL"==t,listeners:{change:function(e,t){var i=e.ownerCt,n=i.form.findField("code"),a=i.form.findField("name");n.setReadOnly(t),a.setReadOnly(t),t?(n.setValue(d.get("code")),a.setValue(d.get("text"))):(n.setValue(o.code),a.setValue(o.text))}}},{xtype:"yesnofield",fieldLabel:"软连接",name:"rlj",columnWidth:.5},{xtype:"textfield",fieldLabel:"功能编码",name:"code",value:"copy from "+o.code,allowBlank:!1},{xtype:"textfield",fieldLabel:"功能名称",name:"name",value:o.text,allowBlank:!1}],fn:function(e){var t={rlj:e.rlj,id:o.id,code:o.code,text:o.text};if("1"==e.thgn){if(t.oldId=d.get("id"),t.oldCode=d.get("code"),!(i=JE.ajax({url:JE.getUrlMaps("je.core.develop.funcInfo","1"==e.rlj?"copySoftFun":"funcCopy"),params:{tableCode:"JE_CORE_FUNCINFO",JE_CORE_FUNCINFO_ID:t.oldId,oldFuncId:t.id}})).success)return JE.alert(i.obj),!1;"1"==e.rlj?JE.msg("成功将【"+t.text+"】功能软连接替换【"+d.get("text")+"】功能!"):JE.msg("成功将【"+t.text+"】功能替换【"+d.get("text")+"】功能!")}else{if(l.getRootNode().findChild("code",e.code,!0))return JE.alert("编码重复，请重新填写!"),!1;var i,n=d;if(!(i=JE.ajax({url:JE.getUrlMaps("je.core.develop.funcInfo","1"==e.rlj?"copySoftFun":"funcCopy"),params:{tableCode:"JE_CORE_FUNCINFO",oldFuncId:t.id,FUNCINFO_FUNCNAME:e.name,FUNCINFO_FUNCCODE:e.code,SY_PARENT:n.get("id"),SY_PATH:n.getPath(),SY_LAYER:1*Ext.value(n.get("SY_LAYER"),1)+1,FUNCINFO_NODEINFOTYPE:o.FUNCINFO_NODEINFOTYPE,createNew:"1"}})).success)return JE.alert(i.obj),!1;var a=i.obj;a.text=a.FUNCINFO_FUNCNAME,a.code=a.FUNCINFO_FUNCCODE,a.id=a.JE_CORE_FUNCINFO_ID,a.leaf=!0,a.iconCls=a.FUNCINFO_ICONCLS,a.nodeInfoType=a.FUNCINFO_NODEINFOTYPE,a.nodeInfo=a.FUNCINFO_NODEINFO,a.parent=a.SY_PARENT,a.parentId=a.SY_PARENT,a.children=[],"1"==e.rlj?JE.msg("成功将【"+t.text+"】功能软连接复制【"+e.name+"】功能!"):JE.msg("成功将【"+t.text+"】功能复制【"+e.name+"】功能!"),n.set("leaf",!1),n.set("nodeType","GENERAL"),n.commit(),n.appendChild(a)}}}):JE.alert("系统上不可以粘贴功能！")}}},"[xtype=funccfg.subsystemgrid] button[ref=doStaticizeFunc]":{click:function(e){var t=JE.ajax({url:JE.getUrlMaps("je.core.develop.funcInfo","clearStaticize")});t.success?JE.msg("功能缓存已清空!"):JE.alert(t.obj)}},"[xtype=funccfg.subsystemgrid] button[ref=doAllStaticizeFunc]":{click:function(e){JE.confirm("该操作会把所有功能重新静态化一遍，耗时较长，请勿关闭窗口，是否继续？",function(e,t){if("ok"==e){var i=JE.ajax({url:JE.getUrlMaps("je.core.develop.funcInfo","loadFuncs")});Ext.each(i,function(e){var t=e.FUNCINFO_FUNCCODE;JE.CoreUtil.staticFuncData(t,!1,!0)})}})}},"[xtype=funccfg.subsystemgrid] button[ref=doCloseAll]":{click:function(e){e.up("panel[xtype=funccfg.subsystemgrid]").collapseAll()}},"[xtype=funccfg.subsystemgrid] button[ref=addMenu] menuitem":{click:function(e){var a=e.up("[xtype=funccfg.subsystemgrid]"),t=e.ref,i=e.iconCls,n=[];-1!=["FUNCFIELD","FUNC"].indexOf(t)&&(n=[{xtype:"cbbfield",fieldLabel:"功能类型",configInfo:"JE_CORE_FUNCTYPE",name:"FUNCINFO_FUNCTYPE",dicItemCodes:"func,procedure,sql,iditprocedure",value:"func",listeners:{change:function(e,t,i){var n=e.ownerCt;n.form.findField("FUNCINFO_TABLENAME").setAllowBlank("func"!=t),n.form.findField("FUNCINFO_TABLENAME").setVisible("func"==t),n.form.findField("FUNCINFO_DBNAME").setVisible("func"!=t),n.form.findField("FUNCINFO_QUERYPARAM").setVisible("func"!=t),n.form.findField("FUNCINFO_PROCEDURE").setVisible(-1!=["procedure","iditprocedure"].indexOf(t)),n.form.findField("FUNCINFO_PROCEDURE").setAllowBlank(-1==["procedure","iditprocedure"].indexOf(t)),n.form.findField("FUNCINFO_SQL").setVisible("sql"==t),n.form.findField("FUNCINFO_SQL").setAllowBlank("sql"!=t),e.up("window").setHeight("func"==t?300:460)}}},{xtype:"gridssfield",fieldLabel:"表名",name:"FUNCINFO_TABLENAME",allowBlank:!1,whereSql:" AND SY_JESYS='1'",editable:!0,configInfo:"JE_CORE_RESOURCETABLE,FUNCINFO_FUNCNAME~FUNCINFO_FUNCCODE~FUNCINFO_TABLENAME~FUNCINFO_PKNAME,RESOURCETABLE_TABLENAME~RESOURCETABLE_TABLECODE~RESOURCETABLE_TABLECODE~RESOURCETABLE_PKCODE,S"},{xtype:"textfield",allowBlank:!1,fieldLabel:"主键名",name:"FUNCINFO_PKNAME"},{xtype:"cbbfield",fieldLabel:"数据源名称",configInfo:"JE_CORE_DSDATA,FUNCINFO_DBNAME~code,S",hidden:!0,name:"FUNCINFO_DBNAME",listeners:{afterrender:function(e){e.getStore().insert(0,[{text:"本地",code:"local",id:"local"}])}}},{xtype:"textfield",fieldLabel:"存储过程",hidden:!0,name:"FUNCINFO_PROCEDURE"},{xtype:"textarea",fieldLabel:"SQL",hidden:!0,name:"FUNCINFO_SQL"},{xtype:"jsonarrayfield",fieldLabel:"查询参数",hidden:!0,height:200,name:"FUNCINFO_QUERYPARAM",defaultRecordValue:{name:"",fieldType:"VARCHAR",paramType:"0"},columns:[{text:"参数名",flex:1,dataIndex:"name"},{text:"参数类型",flex:1,dataIndex:"fieldType",field:{xtype:"cbbfield",configInfo:"JE_CORE_DBFIELDTYPE"},renderer:function(e){return JE.toDicText("JE_CORE_DBFIELDTYPE",e)}},{text:"输出参数",flex:1,xtype:"uxcheckcolumn",dataIndex:"paramType"},{text:"缺省值",flex:1,dataIndex:"defaultValue"}]},{xtype:"textarea",fieldLabel:"功能描述",name:"FUNCINFO_FUNCREMARK",height:100}]),JE.win({title:e.text+"添加",height:JE.isEmpty(n)?300:400,width:JE.isEmpty(n)?550:700,items:{xtype:"form",border:0,layout:"column",autoScroll:!0,defaults:{labelAlign:"right",columnWidth:.9,margin:1,enableKeyEvents:!0,listeners:{keypress:function(e,t,i){if(t.getKey()==t.ENTER){var n=e.up("window").down("button[text=确定]");n.handler(n)}}}},items:[{xtype:"textfield",fieldLabel:"编码",name:"FUNCINFO_FUNCCODE",allowBlank:!1,regex:"^[A-Z]{1}[A-Z_0-9]{1,29}$",regexText:"功能编码由大写字母、下划线组成!"},{xtype:"textfield",fieldLabel:"名称",name:"FUNCINFO_FUNCNAME",allowBlank:!1},{xtype:"hidden",name:"FUNCINFO_ICONCLS",value:i},{xtype:"hidden",name:"FUNCINFO_NODEINFOTYPE",value:t}].concat(n)},useButton:!0,buttonAlign:"right",autoShow:!0,fn:function(e){var t=e.getCmp(0);if(!t.form.isValid())return!1;var i=t.form.getValues();i.FUNCINFO_FUNCCODE=i.FUNCINFO_FUNCCODE.trim();var n=JE.ajax({url:JE.getUrlMaps("je.core.load"),params:{tableCode:"JE_CORE_FUNCINFO",whereSql:" and FUNCINFO_FUNCCODE = '"+i.FUNCINFO_FUNCCODE+"'"}});if(JE.isNotEmpty(n.rows))return JE.alert("编码重复，请重新填写!"),!1;l.doAdd(i,a)}})}},"[xtype=funccfg.subsystemgrid] button[ref=addMenu]":{click:function(e){var t=e.up("treepanel").getSelectionModel().getSelection()[0],i=[];t?"SYSTEM"==t.get("nodeInfoType")?i=["MODEL"]:"MODEL"==t.get("nodeInfoType")?i=["MODEL","FUNC"]:"FUNC"==t.get("nodeInfoType")&&(i=["FUNCFIELD","FUNC"]):i=["SYSTEM"],e.menu.items.each(function(e){0<i.length&&-1!=i.indexOf(e.ref)?e.setDisabled(!1):e.setDisabled(!0)})}},"[xtype=funccfg.subsystemeast] button[ref=uploadFiles]":{click:function(e){var t=e.up("[xtype=funccfg.subsystem]").down("[xtype=funccfg.subsystemgrid]").getSelectionModel().getSelection()[0],a=e.up("grid[ref=filesGrid]");t?JE.win({title:"附件上传",width:800,height:600,items:{xtype:"uploadpanel",file_post_name:"formUploadFiles",upload_url:JE.getUrlMaps("je.core.develop.funcInfo","uploadFile")+"?login=TRUE",post_params:{JE_CORE_FUNCINFO_ID:t.get("id"),pkValue:t.get("id"),funcCode:"JE_CORE_FUNCINFO",tableCode:"JE_CORE_FUNCINFO",beanTableCode:"JE_CORE_FUNCINFO",jeFileType:"PROJECT"},failure:function(e,t,i){JE.error(t+"\n"+i)},success:function(e,t,i){var n=Ext.decode(Ext.value(t,"{}"));1==n.success?a.getStore().insert(0,n.obj):JE.error(t,t)}}}).show():JE.alert("请选择功能数据再进行上传！")}}};l.control(e)},doAdd:function(e,t){var i=t.getSelectionModel().getSelection()[0],n="ROOT",a="ROOT",l=1;i?(i.set("leaf",!1),i.commit(),n=i.get("id"),a=i.getPath(),l=i.getDepth()+1):i=t.getRootNode(),Ext.apply(e,{tableCode:"JE_CORE_FUNCINFO",SY_PARENT:n,SY_PATH:a,SY_NODETYPE:"GENERAL",SY_LAYER:l,SY_STATUS:"1"});var o=JE.ajax({url:JE.getUrlMaps("je.core.develop.funcInfo","save"),params:e});if(o.success){var d={id:(o=o.obj).JE_CORE_FUNCINFO_ID,text:o.FUNCINFO_FUNCNAME,code:o.FUNCINFO_FUNCCODE,nodeInfoType:o.FUNCINFO_NODEINFOTYPE,iconCls:o.FUNCINFO_ICONCLS,expandable:!0,leaf:!1,children:[]};d=Ext.apply(d,o),d=i.appendChild(d),i.expand(),t.refreshQuery(),JE.msg("添加成功!")}else JE.alert(o.obj)},views:["JE.sys.funccfg.view.subsystem.SubSystem","JE.sys.funccfg.view.subsystem.SubSystemGrid","JE.sys.funccfg.view.subsystem.SubSystemEast"],stores:[],models:[]}),Ext.define("JE.sys.funccfg.controller.TestCase",{extend:"Ext.app.Controller",mixins:[],init:function(){var e={"[xtype=funccfg.testcasegrid] button[ref=insert]":{click:function(e){var i=Ext.getCmp("funccfg.testcasegrid"),t=i.up("panel[id=funccfg.testcase]"),n=JE.win({title:"测试用例",buttons:[],width:JE.getBodyWidth()-500,height:JE.getBodyHeight()-200,items:[{xtype:"funccfg.testcaseform",useButton:!0}],fn:function(e){var t=Ext.getCmp("funccfg.testcaseform").form.getValues();i.mainData=t,JE.Action.doSave(i,{tableName:"JE_CORE_TESTCASE",pkName:"JE_CORE_TESTCASE_ID"})}}),a=Ext.getCmp("funccfg.testcaseform"),l=t.funcInfo;a.form.setValues({TESTCASE_FUNCINFO_ID:i.funcId,TESTCASE_FUNCNAME:l.FUNCINFO_FUNCNAME,TESTCASE_FUNCCODE:l.FUNCINFO_FUNCCODE}),n.show()}},"[xtype=funccfg.testcasegrid] button[ref=listupdate]":{click:function(e){var t=Ext.getCmp("funccfg.testcasegrid");JE.Action.doUpdateList(t,{tableName:"JE_CORE_TESTCASE",pkName:"JE_CORE_TESTCASE_ID"})}},"[xtype=funccfg.testcasegrid] button[ref=remove]":{click:function(e){var t=Ext.getCmp("funccfg.testcasegrid");JE.Action.doRemove(t,{tableName:"JE_CORE_TESTCASE",pkName:"JE_CORE_TESTCASE_ID"})}},"[xtype=funccfg.testcasegrid] uxtrigger[ref=querytext]":{click:function(e){var t=e.getValue(),i=Ext.getCmp("funccfg.testcasegrid"),n="";Ext.isEmpty(t)||(n=" and TESTCASE_TITLE like '%"+t+"%' "),i.getStore().proxy.extraParams.whereSql=i.getStore().proxy.extraParams.baseSql+n,i.getStore().load()}}};this.control(e)},views:["JE.sys.funccfg.view.testcase.TestCase","JE.sys.funccfg.view.testcase.TestCaseForm","JE.sys.funccfg.view.testcase.TestCaseGrid"],stores:[],models:[]}),Ext.define("JE.sys.formdesigner.util.FieldSetUtil",{buildFieldSet:function(n,e){var a=this,t=n.data,i=Ext.decode(Ext.value(t.RESOURCEFIELD_OTHERCONFIG,"{}")),l={xtype:"panel",minHeight:50,margin:"1 5 4 5",bodyPadding:"4",fieldset:!0,record:n,layout:"column",ddPanel:!0,itemId:t.RESOURCEFIELD_CODE,hideItems:function(t){var e=this;t?(delete e.maxHeight,e.minHeight=50):(delete e.minHeight,e.maxHeight=26),e.items.each(function(e){e.setVisible(t)})},dockedItems:{xtype:"toolbar",style:"background:#d3e1f1;cursor:move;",basicBgColor:"#d3e1f1",itemId:"configBar",defaults:{cls:"je-field-basiccls"},items:[{xtype:"box",ref:"titleBox",html:n.get("RESOURCEFIELD_NAME"),style:"overflow:hidden;text-overflow:ellipsis;white-space: nowrap;color:blue;cursor:pointer;"},"->",{xtype:"yesnofield",boxLabel:"展开",name:"expand",listeners:{change:function(e,t,i){e.ownerCt.ownerCt.hideItems(JE.toBool(t))}}},{xtype:"yesnofield",boxLabel:"无样式",name:"readOnly",value:t.RESOURCEFIELD_READONLY,listeners:{change:function(e,t,i){n.set("RESOURCEFIELD_READONLY",JE.toBool(t)?"1":"0")}}},{text:"科技灰皮肤",itemId:"colors",menu:{plain:!0,layout:"column",width:200,defaults:{xtype:"colorfield",labelAlign:"right",labelWidth:70,columnWidth:1,margin:2,cls:"je-field-basiccls",firstValue:!0,listeners:{change:function(e,t,i){e.firstValue||(e.ownerCt.show(),a.setFieldSetColors(n,e.name,t))}}},items:[{fieldLabel:"基础色",name:"basicColor"},{fieldLabel:"标题色",name:"titleColor"},{fieldLabel:"标题背景色",name:"titleBgColor"},{fieldLabel:"边框色",name:"borderColor"},{fieldLabel:"上边框色",name:"borderTopColor"}]}},{xtype:"colorfield",width:100,name:"bgcolor"},{xtype:"numberfield",width:40,minValue:1,editable:!0,name:"columns"},{xtype:"numberfield",width:40,minValue:1,editable:!0,name:"columnWidth"},{iconCls:"jeicon jeicon-error",handler:function(e){var t=e.ownerCt.ownerCt;a.removeItem(t)}}]},listeners:{afterrender:function(e){e.titleBox=e.down("box[ref=titleBox]"),e.colsField=e.down("numberfield[name=columnWidth]"),e.columnsField=e.down("numberfield[name=columns]"),e.bgcolorField=e.down("colorfield[name=bgcolor]"),e.readOnlyField=e.down("yesnofield[name=readOnly]"),e.expandField=e.down("yesnofield[name=expand]"),e.bgcolorField.setValue(t.RESOURCEFIELD_BGCOLOR),e.colsField.inputEl.dom.value=l.cols,e.columnsField.inputEl.dom.value=l.columns,e.colors=e.down("button[itemId=colors]"),e.colors.menu.items.each(function(e){e.setValue(Ext.value(i[e.name],"")),e.firstValue=!1}),"1"==i.fieldArea?(e.bgcolorField.hide(),e.readOnlyField.hide(),e.colors.hide(),e.hideItems(!1)):e.expandField.hide(),a.buildDrop(e),a.buildDrag(e),a.buildEvent(e)}}};return a.setColumns(l,Ext.value(t.RESOURCEFIELD_CONFIGINFO,"").toString().split(",")[0]),a.setColumnWidth(l,t.RESOURCEFIELD_COLSPAN,e),n.set("RESOURCEFIELD_HIDDEN","0"),l}}),Ext.define("JE.sys.formdesigner.util.FieldUtil",{buildFieldItem:function(e,t){var i=this,n=e.data,a={xtype:"panel",margin:"1 5 4 5",minHeight:25,itemId:n.RESOURCEFIELD_CODE,fieldPanel:!0,layout:{type:"hbox",align:"stretch"},record:e,style:"cursor:move;",ddPanel:!0,basicBGColor:"#F7DD7D",bodyStyle:"background:#F7DD7D",bodyPadding:"2",border:0,defaults:{cls:"je-field-basiccls"},items:[{xtype:"box",ref:"iconBox",html:i.getXTypeIcon(n.RESOURCEFIELD_XTYPE)},{xtype:"box",ref:"titleBox",style:"color:blue;cursor:pointer;padding:4px 0 0 4px;font-family: 微软雅黑,黑体;overflow:hidden;text-overflow:ellipsis;white-space: nowrap;font-weight: bold;",html:n.RESOURCEFIELD_NAME},{xtype:"box",ref:"rLabel",style:"color:red;font-weight:bold;",html:"*"},{xtype:"box",flex:1,html:"&nbsp;"},{xtype:"yesnofield",name:"readOnly",value:n.RESOURCEFIELD_READONLY},{xtype:"yesnofield",name:"allowBlank",value:n.RESOURCEFIELD_ALLOWBLANK,margin:"0 2"},{xtype:"numberfield",width:40,minValue:1,editable:!0,name:"columnWidth",value:n.RESOURCEFIELD_COLSPAN},{xtype:"button",iconCls:"jeicon jeicon-error",ui:"default-toolbar",handler:function(e){var t=e.ownerCt;i.removeItem(t)}}],listeners:{afterrender:function(e){e.iconBox=e.down("box[ref=iconBox]"),e.titleBox=e.down("box[ref=titleBox]"),e.rLabel=e.down("box[ref=rLabel]"),e.colsField=e.down("numberfield[name=columnWidth]"),e.heightField=e.down("numberfield[name=height]"),e.readOnlyField=e.down("yesnofield[name=readOnly]"),e.allowBlankField=e.down("yesnofield[name=allowBlank]"),i.buildDrag(e),i.buildEvent(e)}}},l=e.get("RESOURCEFIELD_COLSPAN");return"__child"==n.RESOURCEFIELD_CODE&&(a.childFunc=!0,a.bodyStyle="background:#cecece;",a.items.splice(4,3),e.set("RESOURCEFIELD_HIDDEN","0"),l=t),a.items[2].hidden="1"==n.RESOURCEFIELD_ALLOWBLANK,"1"==n.RESOURCEFIELD_READONLY&&(a.bodyStyle="background:gainsboro;"),i.setColumnWidth(a,l,t),e.set("RESOURCEFIELD_HIDDEN","0"),a}}),Ext.define("JE.sys.formdesigner.util.IconUtil",{xtypeIcon:{numberfield:'<div class = "x-trigger-cell"><div class="x-trigger-index-0 x-form-trigger x-form-spinner-up"></div><div class="x-trigger-index-1 x-form-trigger x-form-spinner-down"></div></div>',colorfield:{trigger:!0,iconCls:"x-form-color-trigger"},gridssfield:{trigger:!0,iconCls:"x-form-list-trigger"},datefield:{trigger:!0,iconCls:"x-form-date-trigger"},cbbfield:{trigger:!0,iconCls:"x-form-arrow-trigger"},uxfilefield:{trigger:!0,iconCls:"x-form-file-trigger"},treessfield:{trigger:!0,iconCls:"x-form-tree-trigger"},cgroup:{iconCls:"x-form-checkbox"},rgroup:{iconCls:"x-form-radio"},textfield:{iconCls:"jeicon jeicon-fills-up-the-topic"},displayfield:{iconCls:"jeicon jeicon-photo"},cbblistfield:{iconCls:"jeicon jeicon-collection-field"},childfuncfield:{iconCls:"jeicon jeicon-add-fields"},startfield:{iconCls:"jeicon jeicon-stars"},ckeditorfield:{iconCls:"jeicon jeicon-pencil"},searchfield:{iconCls:"jeicon jeicon-search"},graphfield:{iconCls:"jeicon jeicon-sitemap-three"},textcode:{iconCls:"jeicon jeicon-sorting"},textarea:{iconCls:"jeicon jeicon-text-field"}},getXTypeIcon:function(e){var t=e;-1!=["gridssfield","gridssareafield","queryuserfield","queryuserareafield"].indexOf(e)?t="gridssfield":-1!=["treessfield","treessareafield"].indexOf(e)?t="treessfield":-1!=["datemonthfield","datetimefield","datefield"].indexOf(e)&&(t="datefield");var i=this.xtypeIcon[t],n="";return Ext.isEmpty(i)||(n=Ext.isString(i)?i:i.trigger?'<input type="button" class="'+i.iconCls+' je-trigger-icon" style="margin-top:1px;">':'<input type="button" class="'+i.iconCls+' je-button-icon" style="margin-top:4px;">'),n}}),Ext.define("JE.sys.formdesigner.util.RecUtil",{buildDataView:function(o,d,r,c){var s=this,E=[];return r=Ext.value(r,""),o.each(function(e){var t=e.data;if((1==c?"1"==t.RESOURCEFIELD_HIDDEN:"1"!=t.RESOURCEFIELD_HIDDEN)&&t.RESOURCEFIELD_GROUPNAME==r)if("fieldset"==t.RESOURCEFIELD_XTYPE){var i=t.RESOURCEFIELD_CODE,n=s.buildFieldSet(e,d),a=s.buildDataView(o,n.columns,i);n.items=a,E.push(n)}else{var l=s.buildFieldItem(e,d);E.push(l)}}),E},addItem:function(e){var t=this.up("panel[xtype=formdesigner.mainview]"),i=t.getCmp("fieldview"),n=t.getCmp("kjview");return"fieldset"==e.get("RESOURCEFIELD_XTYPE")?(item=this.buildFieldSet(e,n.columns),item.items=this.buildDataView(i.store,item.columns,item.itemId,!0)):item=this.buildFieldItem(e,n.columns),item},removeItem:function(e,t){var i=e.record,n=this;t=Ext.value(t,0),i.set("RESOURCEFIELD_HIDDEN","1"),e.items.each(function(e){e.ddPanel&&n.removeItem(e,t+1)}),0==t&&e.ownerCt.remove(e,!0)},setFieldXtype:function(e,t){var i=e.record,n=t;-1!=["gridssfield","gridssareafield","queryuserfield","queryuserareafield"].indexOf(t)?n="gridssfield":-1!=["treessfield","treessareafield"].indexOf(t)?n="treessfield":-1!=["datemonthfield","datetimefield","datefield"].indexOf(t)&&(n="datefield"),e.iconBox.update(Ext.value(this.xtypeIcon[n],"")),i.set("RESOURCEFIELD_XTYPE",t)},setFieldReadOnly:function(e,t){e.rLabel&&(e.setBodyStyle("background",t?"gainsboro":e.basicBGColor),e.record.set("RESOURCEFIELD_READONLY",t?"1":"0"))},setFieldBlank:function(e,t){e.rLabel&&(e.rLabel.setVisible(!t),e.record.set("RESOURCEFIELD_ALLOWBLANK",t?"1":"0"))},setFieldSetBGColor:function(e,t){e.setBodyStyle("background-color",Ext.value(t,"none")),e.record.set("RESOURCEFIELD_BGCOLOR",t)},setFieldSetColors:function(e,t,i){var n=e.data,a=Ext.decode(Ext.value(n.RESOURCEFIELD_OTHERCONFIG,"{}"));JE.isEmpty(i)?delete a[t]:a[t]=i,e.set("RESOURCEFIELD_OTHERCONFIG",Ext.encode(a))},setOrderIndex:function(e,t){var i=this;return t=Ext.value(t,1),e.items.each(function(e){e.ddPanel&&(e.record.set("SY_ORDERINDEX",t),t=i.setOrderIndex(e,++t))}),t},setColumns:function(e,t){var i=this;i.kjView||(i.kjView="formdesigner.mainview"==i.xtype?i:i.up("panel[xtype=formdesigner.mainview]").getCmp("kjview")),t=Number(Ext.value(t,i.kjView.columns));var n=e.record;e.columns=t;var a=n.get("RESOURCEFIELD_CONFIGINFO");if(Ext.isEmpty(a))a=t;else{var l=a.toString().split(",");l.splice(0,1,t),a=l.join(",")}n.set("RESOURCEFIELD_CONFIGINFO",a)},setColumnWidth:function(e,t,i){t=Number(Ext.value(t,"1"));var n,a=e.record;e.cols=t,i?n=i:e.ownerCt&&(n=e.ownerCt.columns),e.columnWidth=t/Ext.value(n,3),a.set("RESOURCEFIELD_COLSPAN",t)},setGroupName:function(e,t){var i="";(t=Ext.value(t,e.ownerCt))&&t.ddPanel&&(i=t.record.get("RESOURCEFIELD_CODE")),e.record.set("RESOURCEFIELD_GROUPNAME",i)}}),Ext.define("JE.sys.formdesigner.util.Util",{mixins:["JE.sys.formdesigner.util.FieldUtil","JE.sys.formdesigner.util.FieldSetUtil","JE.sys.formdesigner.util.RecUtil","JE.sys.formdesigner.util.IconUtil"],buildEvent:function(n){var a=this;n.funcId=a.funcId,n.titleBox.getEl().on("click",function(){var e=Ext.getCmp("funccfg.fieldform");e&&e.up("window").close();var t=JE.win({title:"配置信息",bodyPadding:1,width:310,minWidth:310,modal:!1,height:JE.getBodyHeight(),x:JE.getBodyWidth()-310,items:[{xtype:"funccfg.fieldform",hideEditColBtn:!0,saveAction:function(e,t){var i=e.form.getValues();0!=t&&e.up("window").close(),n.record.set(i),n.titleBox.update(i.RESOURCEFIELD_NAME),n.colsField&&n.colsField.setValue(i.RESOURCEFIELD_COLSPAN),n.columnsField&&n.columnsField.setValue(i.RESOURCEFIELD_CONFIGINFO.toString().split(",")[0]),n.heightField&&n.heightField.setValue(i.RESOURCEFIELD_HEIGHT),n.bgcolorField&&n.bgcolorField.setValue(i.RESOURCEFIELD_BGCOLOR),n.readOnlyField&&n.readOnlyField.setValue(i.RESOURCEFIELD_READONLY),n.allowBlankField&&n.allowBlankField.setValue(i.RESOURCEFIELD_ALLOWBLANK),n.iconBox&&a.setFieldXtype(n,i.RESOURCEFIELD_XTYPE),JE.msg("设置成功！")}}]});t.show(null,function(){t.items.get(0).loadFunc(n.funcId,n.record)})})},buildDrop:function(e){var o=this;e.dropTarget=new Ext.dd.DropTarget(e.body,{ddGroup:"DDGroup",notifyOver:function(e,a,l){var t=a.getTarget("div.x-panel-body",3);if(l.allowDD=!1,t){var i=Ext.getCmp(t.id.replace("-body",""));i.fieldset&&(l.dropPanel=i,l.allowDD=!0),l.allowDD&&l.dragPanel&&l.dropPanel&&(l.allowDD=l.dragPanel.id!=l.dropPanel.ownerCt.id&&l.dragPanel.id!=l.dropPanel.id),l.dragPanel&&l.dragPanel.childFunc&&(l.allowDD=l.dropPanel&&"formdesigner.kjview"==l.dropPanel.xtype)}return l.insertIndex=-1,l.allowDD&&l.dropPanel&&0<l.dropPanel.items.getCount()?l.dropPanel.items.each(function(e,t){var i=l.dropPanel.items.get(t+1),n=o.getItemPosition(a,e,i);if("before"==n||"after"==n)return l.dragPanel&&l.dragPanel.id==e.id||"before"==n?l.insertIndex=t:l.insertIndex=t+1,o.positionIndicator(e.getEl(),n,a),!1;o.hidetIndicator()}):o.hidetIndicator(),l.allowDD?e.dropAllowed:e.dropNotAllowed},notifyDrop:function(e,t,i){return i.allowDD}})},buildDrag:function(e){var n=this;e.dragSource=new Ext.dd.DragSource(e.getEl(),{ddGroup:"DDGroup",getDragData:function(e){var t=e.getTarget("div.x-panel",10);if(t){var i=Ext.getCmp(t.id);if(i)return{ddel:i.getEl(),dragPanel:i,draggedRecord:i.record}}},onInitDrag:function(e,t){var i;return this.dragData&&this.dragData.draggedRecord?i='<DIV STYLE="">'+this.dragData.draggedRecord.get("RESOURCEFIELD_NAME")+"</DIV>":(i=this.el.dom.cloneNode(!0)).id=Ext.id(),this.proxy.update(i),this.onStartDrag(e,t),!0},afterValidDrop:function(e,t,i){n.doItemSort(this.dragData)},afterInvalidDrop:function(){n.hidetIndicator()},afterDragDrop:function(e,t,i){n.hidetIndicator()}})},doItemSort:function(e){if(e.allowDD){var t=!0;e.dragPanel?t=e.dropPanel.id!=e.dragPanel.ownerCt.id:e.dragPanel=this.addItem(e.draggedRecord),-1<e.insertIndex?e.dragPanel=e.dropPanel.insert(e.insertIndex,e.dragPanel):t&&(e.dragPanel=e.dropPanel.add(e.dragPanel)),t&&(!e.newFieldSet&&e.dragPanel.colsField&&e.dragPanel.colsField.setValue(1),this.setGroupName(e.dragPanel,e.dropPanel))}},indicatorHtml:'<div class="formfield-move-top"></div><div class="formfield-move-bottom"></div>',indicatorCls:"je-formfield-drop-indicator",getIndicator:function(){var e=this;if(!e.indicator){var t="formdesigner.mainview"==e.xtype?e:e.up("[xtype=formdesigner.mainview]");e.indicator=t.getCmp("kjview").indicator}return e.indicator},getItemPosition:function(e,t,i){var n,a,l=e.getXY()[1],o=e.getXY()[0],d=Ext.fly(t.getEl()).getRegion();return i&&(n=Ext.fly(i.getEl()).getRegion()).top!=d.top&&(n=void 0),l<=d.bottom&&l>=d.top&&(o<d.left?a="before":o>d.right&&(n&&o<n.left?a="after":n||(a="after"))),a},positionIndicator:function(e,t,i){var n=Ext.fly(e),a=n.getX(),l=n.getY();"after"==t?a+=n.getWidth()+5:a-=5,this.getIndicator().setHeight(n.getHeight()).showAt(a,l)},hidetIndicator:function(){this.getIndicator().hide()}}),Ext.define("JE.sys.formdesigner.view.FieldView",{extend:"Ext.grid.Panel",alias:"widget.formdesigner.fieldview",mixins:["JE.sys.formdesigner.util.Util"],columnLines:!0,hideHeaders:!0,initComponent:function(){var e=this;e.store=JE.getStore({tableName:"JE_CORE_RESOURCEFIELD",id:"RESOURCEFIELD_CODE",autoLoad:!0,params:{limit:-1,whereSql:" and RESOURCEFIELD_FUNCINFO_ID = '"+e.funcId+"'",orderSql:" order by SY_ORDERINDEX ASC "}}),(e.store.gridObj=e).relayEvents(e.store,["beforeload","load"]),e.tbar=[{text:"添加分组框",iconCls:"jeicon jeicon-form-grouping-increase",ref:"addFieldset",disabled:!1},{text:"保存",iconCls:"jeicon jeicon-save",ref:"update"}],e.columns=[{text:"字段信息",dataIndex:"RESOURCEFIELD_NAME",flex:1,renderer:function(e,t,i){var n=i.get("RESOURCEFIELD_VALUE");JE.isNotEmpty(n)&&(e+="("+n+")");var a=i.get("RESOURCEFIELD_XTYPE"),l=(i.get("RESOURCEFIELD_READONLY"),i.get("RESOURCEFIELD_ALLOWBLANK"),i.get("RESOURCEFIELD_GROUPNAME"));return"fieldset"==a&&(t.tdAttr=' style="background-color:#d3e1f1;" '),JE.isNotEmpty(l)&&(e+='<font color="red">'+l+"</font>"),e}}],e.viewConfig={getRowClass:function(e,t,i,n){var a="";return"1"!=e.get("RESOURCEFIELD_HIDDEN")&&(a="je-display-none"),a}},e.callParent(arguments)},afterRender:function(){var n=this;n.callParent(arguments),n.dragZone=new Ext.view.DragZone({view:n.view,ddGroup:"DDGroup",getDragText:function(){this.dragData.records.length;return Ext.isEmpty(this.dragData.records)?"选中一条数据":this.dragData.records[0].get("RESOURCEFIELD_NAME")},getDragData:function(e){var t=this.view,i=e.getTarget(t.getItemSelector());if(i)return{copy:t.copy||t.allowCopy&&e.ctrlKey,event:new Ext.EventObjectImpl(e),view:t,ddel:this.ddel,item:i,records:t.getSelectionModel().getSelection(),draggedRecord:t.getSelectionModel().getSelection()[0],fromPosition:Ext.fly(i).getXY()}},afterValidDrop:function(e,t,i){n.doItemSort(this.dragData)},afterInvalidDrop:function(){n.hidetIndicator()},afterDragDrop:function(e,t,i){n.hidetIndicator()}})}}),Ext.define("JE.sys.formdesigner.view.KJView",{extend:"Ext.panel.Panel",alias:"widget.formdesigner.kjview",mixins:["JE.sys.formdesigner.util.Util"],layout:"column",fieldset:!0,bodyPadding:"4",autoScroll:!0,initComponent:function(){var e=this,t=JE.ajax({url:JE.getUrlMaps("je.core.getInfoById"),params:{tableCode:"JE_CORE_FUNCINFO",pkValue:e.funcId}});e.columns=Number(Ext.value(t.FUNCINFO_FORMCOLS,"3")),e.basicColumns=e.columns,e.tbar=[{xtype:"box",style:"color:blue;",html:"配置信息说明：分组框(1.背景颜色,2.摆放列数,3.所占列数)，字段(1.只读,2.为空,3.所占列数)"},"->",{xtype:"numberfield",cls:"je-field-basiccls",fieldLabel:"表单列数",width:100,labelWidth:60,labelAlign:"right",name:"formColumns",value:e.columns}],e.callParent(arguments)},afterRender:function(){var e=this;e.callParent(arguments),e.indicator=new Ext.Component({html:e.indicatorHtml,cls:e.indicatorCls,floating:!0,shadow:!1}),e.dropTarget=e.buildDrop(e)}}),Ext.define("JE.sys.formdesigner.view.MainView",{extend:"Ext.panel.Panel",alias:"widget.formdesigner.mainview",layout:"border",border:0,mixins:["JE.sys.formdesigner.util.Util"],initComponent:function(){var e=this,t=e.funcId,i=JE.ajax({url:JE.getUrlMaps("je.core.load"),params:{tableCode:"JE_CORE_FUNCINFO",whereSql:" and JE_CORE_FUNCINFO_ID='"+t+"'",orderSql:"",queryFields:"JE_CORE_FUNCINFO_ID,FUNCINFO_SFXDB,FUNCINFO_CHECKSTATUS,FUNCINFO_CHECKUSERID",limit:-1}});i&&i.rows&&1==i.rows.length?i.rows[0]:JE.error("数据获取失败！");e.items=[{xtype:"formdesigner.fieldview",funcId:e.funcId,disabled:!1,fieldStore:e.store,itemId:"fieldview",split:!0,region:"east",title:"字段信息",minWidth:200,width:200},{xtype:"formdesigner.kjview",region:"center",disabled:!1,funcId:e.funcId,itemId:"kjview"}],e.callParent(arguments)},afterRender:function(){this.callParent(arguments)}}),Ext.define("JE.sys.formdesigner.controller.MainController",{extend:"Ext.app.Controller",init:function(){var e={"panel[xtype=formdesigner.kjview] numberfield":{change:function(e,t,i){var n=e.up("panel[ddPanel]"),a=e.up("panel[xtype=formdesigner.kjview]");if("columns"==e.name)n.items.each(function(e){a.setColumnWidth(e,e.cols,t)}),a.setColumns(n,t),n.doLayout();else if("columnWidth"==e.name){if(t>n.ownerCt.columns)return void e.setValue(n.ownerCt.columns);a.setColumnWidth(n,t),n.doLayout()}else"formColumns"==e.name&&(a.columns=t,a.items.each(function(e){a.setColumnWidth(e,e.childFunc?t:e.cols,t)}),a.doLayout())}},"panel[xtype=formdesigner.kjview] yesnofield":{change:function(e,t,i){var n=e.up("panel[ddPanel]"),a=e.up("panel[xtype=formdesigner.kjview]");"readOnly"==e.name?a.setFieldReadOnly(n,JE.toBool(t)):"allowBlank"==e.name&&a.setFieldBlank(n,JE.toBool(t))}},"panel[xtype=formdesigner.kjview] colorfield":{change:function(e,t,i){var n=e.up("panel[ddPanel]"),a=e.up("panel[xtype=formdesigner.kjview]");"bgcolor"==e.name&&a.setFieldSetBGColor(n,t)}},"[xtype=formdesigner.fieldview] button[ref=update]":{click:function(e){var t=e.up("panel[xtype=formdesigner.fieldview]"),i=t.ownerCt.getCmp("kjview");if(i.basicColumns!=i.columns){JE.ajax({url:JE.getUrlMaps("je.core.develop.funcInfo","doUpdateInfo"),params:{tableCode:"JE_CORE_FUNCINFO",JE_CORE_FUNCINFO_ID:i.funcId,_updatefields_:"FUNCINFO_FORMCOLS",FUNCINFO_FORMCOLS:i.columns}}),i.basicColumns=i.columns;var n=Ext.getCmp("funccfg.func");n&&n.form.setValues({FUNCINFO_FORMCOLS:i.columns})}var a=t.setOrderIndex(i);t.store.each(function(e){"1"==e.get("RESOURCEFIELD_HIDDEN")?e.set("SY_ORDERINDEX",a++):e.set("RESOURCEFIELD_FIELDLAZY","1")});var l=[],o="JE_CORE_RESOURCEFIELD_ID",d=t.getStore(),r=d.getUpdatedRecords().concat(d.getNewRecords());Ext.Array.each(r,function(e){var t=e.getChanges();t[o]=e.data[o],t.RESOURCEFIELD_CODE=e.data.RESOURCEFIELD_CODE,t.RESOURCEFIELD_FUNCINFO_ID=e.data.RESOURCEFIELD_FUNCINFO_ID,l.push(t)}),JE.ajax({url:JE.getUrlMaps("je.core.develop.resField","updateList"),params:{tableCode:"JE_CORE_RESOURCEFIELD",strData:Ext.encode(l)}}).success&&(JE.msg("修改成功！"),d.load(),t.fieldStore&&t.fieldStore.load())}},"[xtype=formdesigner.fieldview] button[ref=addFieldset]":{click:function(e){var t=e.up("panel[xtype=formdesigner.fieldview]"),i=t.ownerCt.getCmp("kjview"),n=JE.ajax({url:JE.getUrlMaps("je.core.develop.resField","save"),params:{tableCode:"JE_CORE_RESOURCEFIELD",RESOURCEFIELD_FUNCINFO_ID:t.funcId,RESOURCEFIELD_XTYPE:"fieldset",RESOURCEFIELD_CONFIGINFO:i.columns,RESOURCEFIELD_COLSPAN:i.columns,RESOURCEFIELD_NAME:"分组框"}});if(n.success){JE.msg("添加成功...");var a=t.store.add(n.obj);t.doItemSort({newFieldSet:!0,dropPanel:i,draggedRecord:a[0],allowDD:!0})}}},"[xtype=formdesigner.fieldview]":{load:function(e){var t=e.gridObj,i=t.ownerCt.getCmp("kjview");i.removeAll(!0);var n=t.buildDataView(t.store,i.columns);JE.isNotEmpty(n)&&i.add(n)}}};this.control(e)},views:["JE.sys.formdesigner.view.MainView","JE.sys.formdesigner.view.KJView","JE.sys.formdesigner.view.FieldView"],stores:[],models:[]}),Ext.define("JE.sys.table.store.TableColumnStore",{extend:"Ext.data.Store",sqls:{},remoteSort:!0,listeners:{load:function(e){var t=e.gridObj;if(0<e.count()){var i=t.editing;i.startEditByPosition({row:0,column:3}),i.cancelEdit(),t.getSelectionModel().deselectAll()}}},constructor:function(e){this.model=JE.getModel({tableName:"JE_CORE_TABLECOLUMN"}),this.proxy=new Ext.data.proxy.Ajax({url:JE.getUrlMaps("je.core.load"),async:!1,extraParams:{tableCode:"JE_CORE_TABLECOLUMN",orderSql:" order by TABLECOLUMN_CLASSIFY ASC,SY_ORDERINDEX ASC"},actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},reader:{type:"json",root:"rows",totalProperty:"totalCount"}}),this.pageSize=30,this.callParent(arguments)}}),Ext.define("JE.sys.table.store.TableDataStore",{extend:"Ext.data.Store",constructor:function(e){this.model=JE.getModel({modelName:"com.je.table.vo.TableDataView"}),this.proxy=new Ext.data.proxy.Ajax({url:JE.getUrlMaps("je.core.resourceTable","loadTableData"),async:!1,extraParams:{tableCode:"JE_CORE_RESOURCETABLE"},actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},reader:{type:"json",root:"rows",totalProperty:"totalCount"}}),this.pageSize=30,this.callParent(arguments)}}),Ext.define("JE.sys.table.store.TableIndexStore",{extend:"Ext.data.Store",sqls:{},remoteSort:!0,constructor:function(e){this.model=JE.getModel({tableName:"JE_CORE_TABLEINDEX"}),this.proxy=new Ext.data.proxy.Ajax({url:JE.getUrlMaps("je.core.load"),async:!1,extraParams:{tableCode:"JE_CORE_TABLEINDEX",orderSql:" order by SY_ORDERINDEX"},actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},reader:{type:"json",root:"rows",totalProperty:"totalCount"}}),this.pageSize=30,this.callParent(arguments)}}),Ext.define("JE.sys.table.store.TableKeyStore",{extend:"Ext.data.Store",sqls:{},remoteSort:!0,constructor:function(e){this.model=JE.getModel({tableName:"JE_CORE_TABLEKEY"}),this.proxy=new Ext.data.proxy.Ajax({url:JE.getUrlMaps("je.core.load"),async:!1,extraParams:{tableCode:"JE_CORE_TABLEKEY",orderSql:" order by SY_ORDERINDEX"},actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},reader:{type:"json",root:"rows",totalProperty:"totalCount"}}),this.pageSize=30,this.callParent(arguments)}}),Ext.define("JE.sys.table.store.TableStore",{extend:"Ext.data.TreeStore",defaultRootId:"ROOT",sorters:[{property:"SY_ORDERINDEX",direction:"ASC"}],listeners:{load:function(e){e.getRootNode().expandChildren()}},constructor:function(e){this.model=JE.getTreeModel(),this.proxy={type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},method:"POST",extraParams:{tableCode:"JE_CORE_RESOURCETABLE",excludes:"checked"},url:JE.getUrlMaps("je.core.resourceTable","getTree"),reader:"json"},this.callParent(arguments)}}),Ext.define("JE.sys.table.store.TableTraceStore",{extend:"Ext.data.Store",remoteSort:!0,constructor:function(e){this.model=JE.getModel({tableName:"JE_CORE_TABLETRACE"}),this.proxy=new Ext.data.proxy.Ajax({url:JE.getUrlMaps("je.core.load"),async:!1,extraParams:{tableCode:"JE_CORE_TABLETRACE",orderSql:" order by SY_CREATETIME desc"},actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},reader:{type:"json",root:"rows",totalProperty:"totalCount"}}),this.pageSize=30,this.callParent(arguments)}}),Ext.define("JE.sys.table.view.CenterView",{extend:"Ext.panel.Panel",alias:"widget.table.centerview",frame:!1,bodyStyle:"background-color:#ffffff;",layout:"border",border:0,items:[{xtype:"table.tableform",region:"north",split:!0,border:1,height:160},{xtype:"table.tablayout",border:1,hidden:!0,split:!0,region:"center"}]}),Ext.define("JE.sys.table.view.DpColumnView",{extend:"Ext.panel.Panel",autoScroll:!0,alias:"widget.table.dpcolumnview",plain:!0,layout:"fit",tables:{},initComponent:function(){this.callParent(arguments)},addColumns:function(e,i,t,n){var a=this,l=i.text+"("+i.code+")",o="JE_CORE_TABLECOLUMN",d="TABLECOLUMN_CODE",r="TABLECOLUMN_NAME",c=" and TABLECOLUMN_RESOURCETABLE_ID = '"+i.id+"'",s=e+"."+i.code,E=i.iconCls,f={};if(n[i.id]){var u=n[i.id];f.x=u.x,f.y=u.y,f.width=u.width,f.height=u.height}var p={type:e,lines:[],code:i.code,text:i.text,id:i.id,iconCls:i.iconCls};if(p.tableName=o,p.codeName=d,p.textName=r,p.typeName="TABLECOLUMN_TYPE",!a.getComponent(s)){a.tables[p.code]=p;var m=null;if("module"==e)m=a.add(Ext.apply({xtype:"panel",title:l,iconCls:E,itemId:s,height:200,width:150,ref:"displaypanel",bodyStyle:"background-color:#fca111;",infoData:p,floating:!0,constrain:!0,draggable:!0,simpleDrag:!0,autoShow:!0,resizable:{transparent:!0},tools:[{type:"close",handler:function(){a.remove(s),delete a.tables[p.code]}}]},f));else if((m=a.add(Ext.apply({xtype:"grid",title:l,iconCls:E,itemId:s,multiSelect:!0,height:200,width:150,ref:"displaypanel",infoData:p,floating:!0,constrain:!0,draggable:!0,simpleDrag:!0,autoShow:!0,resizable:{transparent:!0},listeners:{resize:function(){a.mainView.cascadeView.drawLines()},dragend:function(){a.mainView.cascadeView.drawLines()}},columns:[{text:"名称",dataIndex:r,flex:1},{text:"编码",hidden:!0,dataIndex:d,flex:1}],selModel:{selType:"checkboxmodel"},store:JE.getStore({tableName:o,params:{whereSql:c,orderSql:"order by SY_ORDERINDEX asc",limit:-1},autoLoad:!0}),tools:[{type:"close",handler:function(){a.remove(s),a.mainView.cascadeView.removeTableLines(p.code),delete a.tables[p.code]}}]},f))).relayEvents(m.store,["beforeload","load","loadrecords"]),1!=t&&"table"==e){var x=JE.ajax({url:JE.getUrlMaps("je.core.load"),params:{tableCode:"JE_CORE_TABLEKEY",limit:-1,whereSql:" and TABLEKEY_TYPE = 'Foreign' and TABLEKEY_RESOURCETABLE_ID='"+i.id+"'"}}).rows;p.fks=[];var g=[];if(Ext.each(x,function(e){e={table1:i.code,code1:e.TABLEKEY_COLUMNCODE,conn:"=",table2:e.TABLEKEY_LINKTABLE,code2:e.TABLEKEY_LINECOLUMNCODE},p.fks.push(e),a.tables[e.table2]&&g.push({table1:e.table1,code1:e.code1,conn:e.conn,table2:e.table2,code2:e.code2})}),JE.isNotEmpty(i.bean&&i.bean.RESOURCETABLE_CHILDTABLECODES)){var C=i.bean.RESOURCETABLE_CHILDTABLECODES.split(",");Ext.each(C,function(t){var e=a.tables[t];e&&Ext.each(e.fks,function(e){e.table1==t&&e.table2==i.code&&g.push({table1:e.table1,code1:e.code1,conn:e.conn,table2:e.table2,code2:e.code2})})})}a.mainView.cascadeView.store.add(g)}return m}},buildAllColTree:function(){var e=this.query("grid"),t={id:"ROOT",code:"ROOT",text:"ROOT",children:[]};return Ext.each(e,function(e){var n=e.infoData,a={id:JE.uuid(),code:n.code,text:n.code,disabled:"1",expandable:!0,iconCls:e.iconCls,children:[]};e.store.each(function(e){var t=e.get(n.codeName),i=e.get(n.typeName);a.children.push({id:JE.uuid(),code:n.code+"."+t,text:t,leaf:!0,nodeInfo:i})}),t.children.push(a)}),t}}),Ext.define("JE.sys.table.view.FormWin",{define:"Ext.window.Window",closable:!0,alias:"widget.user.deptcreatewin",layout:"fit",modal:!0,bodyStyle:"padding: 2px;",constructor:function(e){var t=this;e=t.config;t.title=e.title;var i=e.items,n=e.callback;t.items=[{xtype:"form",frame:!0,layout:{type:"vbox",align:"center",padding:"10 0 0 0 "},align:"center",defaults:{width:.2*comm.get("clientWidth")},items:i,buttonAlign:"center",buttons:[{ref:"ok",text:"确定",formBind:!0,iconCls:"jeicon jeicon-save",handle:function(e){n(e)}},{ref:"cancel",text:"取消",iconCls:"form_saveback",handle:function(e){t.close()}}]}],this.callParent(arguments)}}),Ext.define("JE.sys.table.view.MainView",{extend:"Ext.panel.Panel",border:0,layout:"border",alias:"widget.table.mainview",bodyPadding:2,modeType:"TABLE",items:[{xtype:"table.westview",region:"west",split:!0,width:200,margins:"0 3 0 0"},{xtype:"table.centerview",hidden:!0,region:"center",split:!0},{xtype:"panel",bodyStyle:"background-color:#ffffff;",ref:"commentpanel",region:"center",layout:"fit",html:'<img src="'+JE.getStaticUrl("JE.sys.table.view.MainView.table")+'" style="position: absolute;top:50%;left:50%;margin-top:-127px;margin-left:-157px;"/>'},{layout:"border",region:"center",hidden:!0,split:!0,ref:"dptablepanel",tbar:[{ref:"savePlan",text:"保存规划",iconCls:"jeicon jeicon-form-save"},"->",{ref:"editMode",text:"编辑模式",iconCls:"jeicon jeicon-switch"}],border:1,items:[{xtype:"table.dpcolumnview",region:"center"},{xtype:"tabpanel",hidden:!0,region:"south",height:200,split:!0,items:[{xtype:"table.tvcascadeview",iconCls:"jeicon jeicon-associated",title:"级联"}]}]}],afterRender:function(){var e=this;e.callParent(arguments),e.columnView=e.down("[xtype=table.dpcolumnview]"),(e.columnView.mainView=e).cascadeView=e.down("[xtype=table.tvcascadeview]"),e.cascadeView.mainView=e}}),Ext.define("JE.sys.table.view.TabLayout",{extend:"Ext.tab.Panel",alias:"widget.table.tablayout",border:0,frame:!1,items:[{title:"表格列",border:0,iconCls:"jeicon jeicon-form-column",xtype:"table.tablecolumnview"},{title:"表格键",border:0,iconCls:"jeicon jeicon-table-key",xtype:"table.tablekeyview"},{title:"表格索引",border:0,xtype:"table.tableindexview",iconCls:"jeicon jeicon-index"},{title:"数据留痕",border:0,xtype:"table.tabletraceview",iconCls:"jeicon jeicon-little-feet"}]}),Ext.define("JE.sys.table.view.TableDataView",{extend:"Ext.view.View",alias:"widget.table.tabledataview",cls:"je-table-dataview",tpl:['<tpl for=".">','<div class="thumb-wrap {tableType} " name="{id}" title="<tpl if="tableType == \'PARENT\' ">父表<tpl else>子表</tpl>">',"{tableName}({tableCode})","</div>","</tpl>"],multiSelect:!0,trackOver:!0,overItemCls:"x-item-over",itemSelector:"div.thumb-wrap",emptyText:"",initComponent:function(){this.store=Ext.create("JE.sys.table.store.TableDataStore"),this.callParent(arguments)}}),Ext.define("JE.sys.table.view.TableForm",{extend:"Ext.form.Panel",alias:"widget.table.tableform",frame:!1,layout:"column",autoScroll:!0,bodyStyle:{background:"#f1f1f1"},bodyPadding:"10 20 0 20",defaults:{xtype:"textfield",labelAlign:"right",margin:"5 0 0 0",columnWidth:.5},items:[{fieldLabel:"主键",name:"JE_CORE_RESOURCETABLE_ID",hidden:!0},{fieldLabel:"表名称",allowBlank:!1,name:"RESOURCETABLE_TABLENAME",columnWidth:.3},{fieldLabel:"表编码",labelWidth:60,allowBlank:!1,name:"RESOURCETABLE_TABLECODE",columnWidth:.3,regex:"^[A-Z]{1}[A-Z_0-9]{1,29}$",regexText:"表编码由大写字母、下划线组成!"},{fieldLabel:"注解",labelWidth:40,name:"RESOURCETABLE_TABLENOTE",columnWidth:.4},{fieldLabel:"原表编码",hidden:!0,name:"RESOURCETABLE_OLDTABLECODE"},{xtype:"cbbfield",configInfo:"YESORNO",fieldLabel:"是否存在外键",name:"RESOURCETABLE_ISUSEFOREIGNKEY",readOnly:!0,hidden:!0},{xtype:"cbbfield",configInfo:"YESORNO",fieldLabel:"是否已创建",allowBlank:!1,name:"RESOURCETABLE_ISCREATE",readOnly:!0,hidden:!0},{fieldLabel:"类型",allowBlank:!1,readOnly:!0,hidden:!0,name:"RESOURCETABLE_TYPE",xtype:"cbbfield",configInfo:"JE_TABLE_TYPE"},{fieldLabel:"拥有子表",name:"RESOURCETABLE_CHILDTABLECODES",hidden:!0},{fieldLabel:"父表",name:"RESOURCETABLE_PARENTTABLECODES",hidden:!0},{fieldLabel:"图标",name:"RESOURCETABLE_ICONCLS",hidden:!0},{xtype:"displayfield",fieldLabel:"使用此表的功能",fieldBodyCls:"JE_FUNCINFO_DISPLAY",name:"RESOURCETABLE_USEFUNC",readOnly:!0,hidden:!0,columnWidth:1},{xtype:"hidden",fieldLabel:"是否叶子",name:"SY_NODETYPE"},{xtype:"hidden",fieldLabel:"视图SQL",name:"RESOURCETABLE_SQL"},{xtype:"fieldcontainer",fieldLabel:"父子表信息",hidden:!0,layout:"fit",items:[{xtype:"table.tabledataview",title:"关联表信息"}],columnWidth:1}],tbar:{xtype:"toolbar",itemId:"btnBar",items:[{ref:"save",text:"保存",formBind:!0,iconCls:"jeicon jeicon-save"},{ref:"apply",text:"应用",formBind:!0,iconCls:"jeicon jeicon-resource-table-application"},{ref:"tableCopy",text:"复制表",formBind:!0,iconCls:"jeicon jeicon-surface-copy"},{ref:"clearCache",text:"清空缓存",formBind:!0,iconCls:"jeicon jeicon-broom-o"},{ref:"planView",text:"规划",formBind:!0,iconCls:"jeicon jeicon-wrench-right"},{ref:"syncPathBtn",text:"更新树形路径",formBind:!0,iconCls:"jeicon jeicon-tree-table"},{ref:"syncDbBtn",text:"同步结构",formBind:!0,iconCls:"jeicon jeicon-table-column-synchronization"},{ref:"upTag",text:"升级标记",iconCls:"jeicon jeicon-upgrade"},{xtype:"box",itemId:"tableType",style:"color:blue;"},{xtype:"box",itemId:"isCreate",style:"color:blue;"},"->",{ref:"displayMode",text:"展示模式",formBind:!0,iconCls:"jeicon jeicon-switch"}]}}),Ext.define("JE.sys.table.view.WestView",{extend:"Ext.tree.Panel",mixins:["JE.core.util.ViewUtil"],alias:"widget.table.westview",useArrows:!0,rootVisible:!1,animate:!1,frame:!1,border:1,codeSearch:!0,selModel:{allowDeselect:!0,mode:"SINGLE"},copyTableInfo:null,rbar:[{xtype:"button",tooltip:"添加模块",ref:"moduleIns",iconCls:"jeicon jeicon-table-module-addition"},{xtype:"button",tooltip:"添加表",ref:"tableIns",iconCls:"jeicon jeicon-new-form"},{xtype:"button",tooltip:"添加树形表",ref:"tableTreeIns",iconCls:"jeicon jeicon-new-tree-diagram"},{xtype:"button",tooltip:"添加视图",ref:"tableViewIns",iconCls:"jeicon jeicon-new-view"},{xtype:"button",tooltip:"粘贴",ref:"tablePaste",iconCls:"jeicon jeicon-paste"},{xtype:"button",tooltip:"清空数据",ref:"delete",iconCls:"jeicon jeicon-trash-o"},{xtype:"button",tooltip:"物理删除",ref:"physicsRemove",iconCls:"jeicon jeicon-delete-form"},{xtype:"button",tooltip:"导入表",ref:"impTable",iconCls:"jeicon jeicon-form-import"},{xtype:"button",tooltip:"导入视图",ref:"impView",iconCls:"jeicon jeicon-import-view"},{xtype:"button",tooltip:"SQL表结构",ref:"sql",sqlType:"TABLE",iconCls:"jeicon jeicon-sql"},{xtype:"button",tooltip:"SQL数据",ref:"sql",sqlType:"DATA",iconCls:"jeicon jeicon-sql"},{xtype:"button",tooltip:"导出表结构",ref:"tableInfo",sqlType:"TABLE",iconCls:"jeicon jeicon-database-cycle"},{xtype:"button",tooltip:"清空缓存",ref:"doStaticize",sqlType:"STATICIZE",iconCls:"jeicon jeicon-broom-o"},{xtype:"button",tooltip:"全部收起",ref:"collapseAll",iconCls:"jeicon jeicon-shrink"}],initComponent:function(){var e=this;e.store=Ext.create("JE.sys.table.store.TableStore"),e.dockedItems=e.getTreeTbar(e),e.viewConfig=Ext.value(e.viewConfig,{}),e.viewConfig.plugins=Ext.value(e.viewConfig.plugins,[]),e.viewConfig.listeners=Ext.value(e.viewConfig.listeners,{}),e.viewConfig.plugins.push({ptype:"treeviewdragdrop",allowParentInserts:!0}),e.viewConfig.listeners=Ext.apply(e.viewConfig.listeners,{beforedrop:function(e,t,i,n,a){t.append=!1,t.order=!1,"append"==n?t.records[0].parentNode.getId()==i.getId()?a.cancelDrop():t.append=!0:(t.records[0].parentNode.getId()==i.parentNode.getId()||(t.append=!0),t.order=!0)},drop:function(e,t,i,n,a){var l=this.panel,o="JE_CORE_RESOURCETABLE_ID",d="JE_CORE_RESOURCETABLE",r={success:!0},c=t.records[0];if(t.append){var s=t.order?i.parentNode:i,E={tableCode:d,SY_PARENT:s.getId(),SY_PATH:s.getPath(),SY_LAYER:s.getDepth()+1};E[o]=c.getId(),(r=JE.ajax({url:JE.getUrlMaps("je.core.resourceTable","treeMove"),params:E})).success||JE.alert(r.obj)}if(t.order&&r.success){var f=[];i.parentNode.eachChild(function(e){var t={};t[o]=e.get("id"),t.SY_ORDERINDEX=e.get("index")+1,e.set("orderIndex",t.SY_ORDERINDEX),f.push(t)}),r=JE.ajax({url:JE.getUrlMaps("je.core.resourceTable","doUpdateList"),params:{strData:Ext.encode(f),tableCode:d}})}r.success?(l.getSelectionModel().deselectAll(),l.fireEvent("selectionchange",l.getSelectionModel(),[]),JE.msg("操作完成")):JE.alert(r.obj)}}),e.callParent(arguments)}}),Ext.define("JE.sys.table.view.column.AtomFieldForm",{extend:"Ext.form.Panel",alias:"widget.tablecolumn.atomfieldform",layout:"column",border:0,frame:!1,bodyStyle:{},defaults:{labelAlign:"right",xtype:"textfield",padding:"1 0 1 0",margin:"2 0 0 0 ",columnWidth:.4,labelWidth:60,cls:"je-field-basiccls"},bodyPadding:"2 20 0 0",initComponent:function(){var s=this;s.tbar={xtype:"box",data:{},itemId:"formTitleBox",style:"background-color:#f1f1f1;border-bottom:1px #BFBFBF solid;",columnWidth:1,tpl:'<table width="100%" height="100%" name="__body"><tbody><tr><td style="font-size:24px;font-family:黑体;" name="__text">原子辅助</td></tr><tr><td name="__text"><font color="#606060">通过其原子库辅助完成字段添加操作。</font><br><font color="blue">【查询选择入口、自动外键】按需选择</font></td></tr></tbody></table>'},s.items=[{fieldLabel:"原子",xtype:"treessfield",configInfo:"JE_CORE_ATOM,ATOM_TEXT~ATOM_CODE~JE_CORE_ATOM_ID,text~code~id,S,",whereSql:"",name:"ATOM_TEXT",codeSearch:!0,allowBlank:!1,listeners:{query:function(e,t){if(t){s.getForm();var i=t[0],n=e.up("window[xtype=tablecolumn.atomfieldwin]").down("panel[xtype=tablecolumn.atomfieldgrid]"),a=n.getStore();if(i){var l=JE.ajax({url:JE.getUrlMaps("je.core.tableColumn","load"),params:{tableCode:"JE_CORE_TABLECOLUMN",limit:-1,whereSql:" AND TABLECOLUMN_RESOURCETABLE_ID='"+s.tablePk+"'"}}).rows,o=new Array;Ext.each(l,function(e){o.push(e.TABLECOLUMN_CODE)}),n.columnCodes=o,n.targerTableCode=i.get("code")}else store.removeAll(!0),n.columnCodes=[],n.targerTableCode="";a.loadData([])}}}},{fieldLabel:"原子编码",xtype:"textfield",name:"ATOM_CODE",readOnly:!0},{fieldLabel:"原子主键",xtype:"textfield",name:"JE_CORE_ATOM_ID",hidden:!0},{xtype:"button",text:"导入字段",columnWidth:.1,margin:"2 0 0 10 ",iconCls:"jeicon jeicon-import",cls:"btn btn-small",handler:function(e){var l=e.up("window[xtype=tablecolumn.atomfieldwin]"),i=l.down("panel[xtype=tablecolumn.atomfieldgrid]"),t=s.getForm(),n=t.findField("JE_CORE_ATOM_ID").getValue();t.findField("ATOM_TEXT").getValue();if(Ext.isEmpty(n))JE.alert("请先选择原子!");else{t.findField("ATOM_CODE").getValue();var o=i.tableCode,d=[],r=i.getStore();Ext.isEmpty(o)||0<=o.lastIndexOf("_")&&(o=o.substring(o.lastIndexOf("_")+1));var a="";if(0<r.getCount()){var c=new Array;Ext.each(r.data.items,function(e){d.push(e.data),c.push("'"+e.get("JE_CORE_ATOMCOLUMN_ID")+"'")}),a=" AND JE_CORE_ATOMCOLUMN_ID NOT IN ("+c.join(",")+")"}JE.selectWin({parent:null,parentType:"self",title:"原子字段",width:600,height:420,configInfo:"JE_CORE_ATOMCOLUMN,,,M",whereSql:" AND ATOMCOLUMN_ATOM_ID='"+n+"' "+a,type:"grid",callback:function(e,t){var n=!1,a=i.columnCodes;Ext.each(e,function(e){var t=Ext.clone(e.data);t.ATOMCOLUMN_CONTEXT=o+"_"+t.ATOMCOLUMN_CODE,-1!=a.indexOf(t.ATOMCOLUMN_CONTEXT)&&(n=!0),d.push(t);var i=l.down("button[ref=ok]");n?i.disable():i.enable()}),r.loadData(d)}})}}}],this.callParent(arguments)}}),Ext.define("JE.sys.table.view.column.AtomFieldGrid",{extend:"Ext.grid.Panel",alias:"widget.tablecolumn.atomfieldgrid",border:1,multiSelect:!0,frame:!1,columns:[{xtype:"rownumberer",width:35,text:"No.",align:"center"},{text:"主键",dataIndex:"JE_CORE_ATOMCOLUMN_ID",hidden:!0},{text:"<font color='blue'>预添加列名称</font>",dataIndex:"ATOMCOLUMN_NAME",field:{xtype:"textfield"},width:126},{text:"原子编码",dataIndex:"ATOMCOLUMN_CODE",width:200},{text:"<font color='blue'>预添加列编码</font>",dataIndex:"ATOMCOLUMN_CONTEXT",width:200,field:{xtype:"textfield"}},{text:"检测",width:50,dataIndex:"SY_AUDFLAG",renderer:function(e,t,i,n,a,l,o,d,r){var c=o.panel.columnCodes,s=i.get("ATOMCOLUMN_CONTEXT");return-1!=c.indexOf(s)?"<div  style='height:14px;' class='je_verifyfailed'> </div>":"<div style='height:14px;' class='jeicon jeicon-resource-table-application'> </div>"}},{text:"操作",xtype:"actioncolumn",align:"center",width:60,items:[{iconCls:"jeicon jeicon-error",tooltip:"移除",handler:function(e,t,i){var n=e.panel;n.getStore().removeAt(t);n.checkColumnCode(n.getStore().gridObj)}}]}],enableKeyNav:!0,columnLines:!0,initComponent:function(){var a=this;this.editing=Ext.create("Ext.grid.plugin.CellEditing",{clicksToEdit:1}),this.plugins=[this.editing],this.store=JE.getStore({id:"JE_CORE_ATOMCOLUMN_ID",tableName:"JE_CORE_ATOMCOLUMN",autoLoad:!1,params:{limit:-1,whereSql:" and 1!=1",orderSql:" order by SY_ORDERINDEX"}}),a.listeners={afterrender:function(e){(e.store.gridObj=e).getStore().on("update",function(e,t,i,n){"edit"==i&&(t.modified.ATOMCOLUMN_CONTEXT&&a.checkColumnCode(e.gridObj),t.commit())}),e.getStore().removeAll()}},this.callParent(arguments)},checkColumnCode:function(e){for(var t=e.columnCodes,i=e.getStore().data.items,n=!0,a=0;a<i.length;a++)if(-1!=t.indexOf(i[a].get("ATOMCOLUMN_CONTEXT"))){n=!1;break}var l=e.up("window").down("button[ref=ok]");n&&0!=i.length?l.enable():l.disable()}}),Ext.define("JE.sys.table.view.column.AtomFieldWin",{extend:"Ext.window.Window",alias:"widget.tablecolumn.atomfieldwin",title:"原子辅助",bodyPadding:1,width:900,height:570,layout:"border",modal:!0,maximizable:!1,closeAction:"destroy",autoShow:!0,buttonAlign:"center",initComponent:function(){var d=this,r=d.fn;d.items=[{tableCode:d.tableCode,tablePk:d.tablePk,xtype:"tablecolumn.atomfieldform",region:"north",height:103},{tableCode:d.tableCode,xtype:"tablecolumn.atomfieldgrid",region:"center"}],d.buttons=[{text:"确定",ref:"ok",disabled:!0,iconCls:"jeicon jeicon-check",handler:function(e){var t=e.up("window");if(t.down("form").isValid()){var i=t.down("grid[xtype=tablecolumn.atomfieldgrid]"),n=(t.down("form[xtype=tablecolumn.atomfieldform]").getForm(),new Array),a=i.getStore().data.items;Ext.each(a,function(e){n.push(e.data)});var l={tableCode:d.tableCode,pkValue:d.tablePk,strData:Ext.encode(n),TARGERTABLECODE:i.targerTableCode},o=JE.ajax({url:JE.getUrlMaps("je.core.tableColumn","addColumnByAtom"),params:l});return o.success?(JE.msg(o.obj),r&&0!=r(t)&&t.close(),!0):(JE.alert(o.obj),!1)}}},{text:"取消",iconCls:"jeicon jeicon-cancel",handler:function(e){e.up("window").close()}}],this.callParent(arguments)}}),Ext.define("JE.sys.table.view.column.CascadeFieldForm",{extend:"Ext.form.Panel",alias:"widget.tablecolumn.cascadefieldform",layout:"column",border:0,frame:!1,autoScroll:!0,defaults:{labelAlign:"right",columnWidth:1,margin:"2 0",cls:"je-field-basiccls",labelWidth:60},bodyStyle:"border-width:0px !important;padding:10px;",initComponent:function(){var l=this;l.tbar={xtype:"box",data:{},padding:"10",itemId:"formTitleBox",style:"background-color:#FFFFFF;border-bottom:1px #BFBFBF solid;",tpl:'<table width="100%" height="100%" name="__body"><tbody><tr><td style="font-size:24px;font-family:黑体;" name="__text">级联字典辅助</td></tr><tr><td name="__text"><font color="#606060">通过选择数据字典快速的为表添加字段。</font><br><font color="blue">【CODE项编码、NAME项名称、ID项主键】按需选择</font></td></tr></tbody></table>'},l.items=[{fieldLabel:"字典",xtype:"gridssfield",configInfo:"JE_CORE_DICTIONARY,DDNAME~DDCODE,DICTIONARY_DDNAME~DICTIONARY_DDCODE,S,",name:"DDNAME",whereSql:" AND SY_JESYS='1' AND DICTIONARY_DDTYPE IN('TREE','DYNA_TREE','SQL_TREE')",allowBlank:!1,columnWidth:.5,listeners:{query:function(e,t){var i=t[0];if(i){var n=(n=i.get("DICTIONARY_DDCODE").split("_"))[n.length-1],a=i.get("DICTIONARY_DDNAME");l.items.each(function(e){"fieldcontainer"==e.xtype&&(e.getCmp("field").setValue(n+e.itemId),e.getCmp("text").setValue(a+e.itemId))})}}}},{xtype:"hidden",name:"DDCODE"},l.buildItems("第一层","1"),l.buildItems("第二层","2"),l.buildItems("第三层","3"),l.buildItems("第四层","4"),l.buildItems("第五层","5"),{xtype:"textarea",name:"whereSql",fieldLabel:"whereSql"}],l.buttons=[{text:"生成字段",cls:"btn JEPLUS_B_L10",handler:function(e){if(!l.form.isValid())return!1;var E=l.tableCode,f=l.form.findField("DDCODE").getValue(),t=l.form.findField("DDNAME").getValue(),i=l.form.findField("whereSql").getValue(),u=[],p=[],m=[];if(l.items.each(function(e,t){if("fieldcontainer"==e.xtype&&"1"==e.getCmp("enable").getValue()){var r=e.getCmp("text").getValue(),c=e.getCmp("field").getValue(),s=JE.split(e.getCmp("fields").getValue(),",");JE.isNotEmpty(c)&&JE.isNotEmpty(s)&&Ext.each(s,function(e){var t=E+"_"+c+"_"+e.toUpperCase(),i="",n="",a=r;if("code"==e){p.push(t);var l=[],o=[];Ext.each(s,function(e){var t=E+"_"+c+"_"+e.toUpperCase();l.push(t),o.push(e)}),i=f+","+l.join("~")+","+o.join("~")+",S";var d=p.indexOf(t);n='{cascadeField:"'+(0==d?t:p[d-1])+'"}'}else a=r+"_"+e.toUpperCase();m.push(t),u.push({text:a,type:e,name:t,configInfo:i,otherConfig:n})})}}),JE.isNotEmpty(u)){var n=JE.ajax({url:JE.getUrlMaps("je.core.tableColumn","checkColunmnCode"),params:{tableCode:"JE_CORE_TABLECOLUMN",pkValue:l.pkValue,ids:m.join(",")}});if(!n.success)return void JE.alert(n.obj,"以下字段重复，请修改！");var a=JE.ajax({url:JE.getUrlMaps("je.core.tableColumn","addColumnByDDList"),params:{tableCode:"JE_CORE_TABLECOLUMN",strData:JE.encode(u),whereSql:i,ddName:t,pkValue:l.pkValue}});a.success?JE.msg("添加成功"):JE.alert(a.obj),l.fn&&l.fn(u),e.ownerCt.getCmp("cancel").handler()}else JE.alert("没有启用的层级配置，将无法生成字段！")}},{text:"取消",cls:"btn",itemId:"cancel",handler:function(){"window"==l.ownerCt.xtype&&l.ownerCt.close()}}],l.buttonAlign="center",this.callParent(arguments)},buildItems:function(e,t){var i=this.tableCode+"_";return{xtype:"fieldcontainer",itemId:t,fieldLabel:e,layout:{type:"hbox",align:"middle"},margin:"5 0",items:[{xtype:"textfield",emptyText:"字段名"+t,itemId:"text",width:100,margin:"0 5 0 0"},{xtype:"box",itemId:"tableCode",width:8*i.strLen()+5,html:i,height:22,style:"border:1px solid #e6e6e6;border-right:0px;background-color:#ffffff;line-height:20px;text-align:right;"},{xtype:"textfield",emptyText:"字段编码"+t,itemId:"field",width:150,fieldStyle:"border-left:0px;border-color:#e6e6e6;"},{xtype:"cgroup",value:"text,code",checkAll:!1,width:150,itemId:"fields",name:"fields",margin:"0 0 0 5",dataArray:[{code:"text",text:"名称"},{code:"code",text:"编码"},{code:"id",text:"ID"}]},{xtype:"box",flex:1},{xtype:"yesnofield",itemId:"enable",boxLabel:'<span style="color:blue;">启用</span>'}]}}}),Ext.define("JE.sys.table.view.column.DictionaryFieldForm",{extend:"Ext.form.Panel",alias:"widget.tablecolumn.dictionaryform",layout:"column",border:0,frame:!1,bodyStyle:{background:"rgb(241, 241, 241)"},defaults:{labelAlign:"right",xtype:"textfield",columnWidth:.9,padding:"1 0 1 0",margin:"2 0 0 0 ",cls:"je-field-basiccls"},bodyPadding:"10 20 0 0",initComponent:function(){var r=this;r.tbar={xtype:"box",data:{},margin:"-10 -20 10 -20",padding:"10",itemId:"formTitleBox",style:"background-color:#FFFFFF;border-bottom:1px #BFBFBF solid;",columnWidth:1,tpl:'<table width="100%" height="100%" name="__body"><tbody><tr><td style="font-size:24px;font-family:黑体;" name="__text">字典辅助</td></tr><tr><td name="__text"><font color="#606060">通过选择数据字典快速的为表添加字段。</font><br><font color="blue">【CODE项编码、NAME项名称、ID项主键】按需选择</font></td></tr></tbody></table>'},r.items=[{fieldLabel:"字典",xtype:"gridssfield",configInfo:"JE_CORE_DICTIONARY,DDNAME~DDCODE~DDTYPE,DICTIONARY_DDNAME~DICTIONARY_DDCODE~DICTIONARY_DDTYPE,S,",name:"DDNAME",whereSql:" AND SY_JESYS='1'",allowBlank:!1,editable:!0,columnWidth:.9,listeners:{query:function(e,t){if(t){var i=r.getForm().findField("name_dd");if(0<t.length){var n=t[0].get("DICTIONARY_DDCODE");0<=n.lastIndexOf("_")&&(n=n.substring(n.lastIndexOf("_")+1)),i.setValue(n),i.setReadOnly(!1)}}}}},{fieldLabel:"字典编码",xtype:"textfield",hidden:!0,name:"DDCODE"},{fieldLabel:"字典类型",xtype:"textfield",hidden:!0,name:"DDTYPE"},{xtype:"fieldcontainer",fieldLabel:"名称",combineErrors:!0,msgTarget:"under",defaults:{hideLabel:!0,cls:"je-field-basiccls"},layout:{type:"hbox",defaultMargins:{top:0,right:5,bottom:0,left:0}},columnWidth:1,items:[{xtype:"textfield",name:"name_je",width:120,value:r.tableCode+"_",readOnly:!0},{xtype:"textfield",name:"name_dd",width:120,margins:"0 5 0 0",readOnly:!0,listeners:{change:function(e,t){var i=r.getForm();i.findField("code_dd").setValue(t),i.findField("id_dd").setValue(t);var n=r.tableCode+"_"+Ext.value(t,"")+"_NAME,"+r.tableCode+"_"+Ext.value(t,"")+"_CODE,"+r.tableCode+"_"+Ext.value(t,"")+"_ID",a=JE.ajax({url:JE.getUrlMaps("je.core.tableColumn","checkColunmnCode"),params:{tableCode:"JE_CORE_TABLECOLUMN",pkValue:r.tablePk,ids:n}}),l=!0;if(a.success)Ext.each(["name","code","id"],function(e){i.findField(e+"_unque").setValue("1"),i.findField(e+"_dis").setValue("<div class='jeicon jeicon-resource-table-application'> </div>")});else{var o=a.obj;if(Ext.isEmpty(o))return void JE.alert("传入信息错误!");Ext.each(o.split(","),function(e){i.findField(e+"_unque").setValue("0"),1==i.findField(e+"_check").getValue()&&(l=!1),i.findField(e+"_dis").setValue("<div class='je_verifyfailed'> </div>")})}var d=r.up("window").down("button[ref=ok]");l?d.enable():d.disable()}}},{xtype:"textfield",name:"name_info",width:48,value:"_NAME",readOnly:!0},{xtype:"checkbox",name:"name_check",checked:!0,width:20},{xtype:"textfield",hidden:!0,name:"name_unque",value:"1",width:20},{xtype:"displayfield",hidden:!0,name:"name_dis",value:"<div class='jeicon jeicon-resource-table-application'> </div>",width:10}]},{xtype:"fieldcontainer",fieldLabel:"编码",combineErrors:!0,msgTarget:"under",defaults:{hideLabel:!0},layout:{type:"hbox",defaultMargins:{top:0,right:5,bottom:0,left:0}},columnWidth:1,items:[{xtype:"textfield",name:"code_je",width:120,value:r.tableCode+"_",readOnly:!0},{xtype:"textfield",name:"code_dd",width:120,margins:"0 5 0 0",readOnly:!0},{xtype:"textfield",name:"code_info",width:48,value:"_CODE",readOnly:!0},{xtype:"checkbox",name:"code_check",checked:!0,width:20},{xtype:"textfield",hidden:!0,name:"code_unque",value:"1",width:20},{xtype:"displayfield",hidden:!0,name:"code_dis",value:"<div class='jeicon jeicon-resource-table-application'> </div>",width:10}]},{xtype:"fieldcontainer",fieldLabel:"主键",combineErrors:!0,msgTarget:"under",defaults:{hideLabel:!0},layout:{type:"hbox",defaultMargins:{top:0,right:5,bottom:0,left:0}},columnWidth:1,items:[{xtype:"textfield",name:"id_je",width:120,value:r.tableCode+"_",readOnly:!0},{xtype:"textfield",name:"id_dd",width:120,margins:"0 5 0 0",readOnly:!0},{xtype:"textfield",name:"id_info",width:48,value:"_ID",readOnly:!0},{xtype:"checkbox",name:"id_check",checked:!1,width:20},{xtype:"textfield",hidden:!0,name:"id_unque",value:"1",width:20},{xtype:"displayfield",hidden:!0,name:"id_dis",value:"<div class='jeicon jeicon-resource-table-application'> </div>",width:10}]}],this.callParent(arguments)}}),Ext.define("JE.sys.table.view.column.DictionaryFieldWin",{extend:"Ext.window.Window",alias:"widget.tablecolumn.dictionaryfieldwin",title:"字典辅助",bodyPadding:1,width:500,height:330,layout:"fit",modal:!0,maximizable:!1,autoShow:!0,resizable:!0,buttonAlign:"center",initComponent:function(){var o=this,d=o.fn;o.items=[{xtype:"tablecolumn.dictionaryform",tableCode:o.tableCode,tablePk:o.tablePk}],o.buttons=[{text:"确定",ref:"ok",disabled:!0,iconCls:"jeicon jeicon-check",handler:function(e){var t=e.up("window"),i=t.down("form");if(i.isValid()){var n=i.getForm().getValues(),a=new Array;if("on"==n.name_check){if("0"==n.name_unque)return void JE.alert("名称已经重复，无法添加!");a.push(n.name_je+Ext.value(n.name_dd,"")+n.name_info)}if("on"==n.code_check){if("0"==n.code_unque)return void JE.alert("编码已经重复，无法添加!");a.push(n.code_je+Ext.value(n.code_dd,"")+n.code_info)}if("on"==n.id_check){if("0"==n.id_unque)return void JE.alert("名称已经重复，无法添加!");a.push(n.id_je+Ext.value(n.id_dd,"")+n.id_info)}if(0<a.length){var l=JE.ajax({url:JE.getUrlMaps("je.core.tableColumn","addColumnByDD"),params:{tableCode:"JE_CORE_TABLECOLUMN",pkValue:o.tablePk,ids:a.join(","),ddName:n.DDNAME,ddCode:n.DDCODE,ddType:n.DDTYPE}});l.success?(d&&0!=d(n)&&t.close(),JE.msg(l.obj)):JE.alert(l.obj)}else JE.alert("请选中需要添加的字典字段!")}}},{text:"取消",iconCls:"jeicon jeicon-cancel",handler:function(e){e.up("window").close()}}],this.callParent(arguments)}}),Ext.define("JE.sys.table.view.column.SaveAtomFieldGrid",{extend:"Ext.grid.Panel",alias:"widget.column.saveatomfieldgrid",border:1,multiSelect:!0,frame:!1,columns:[{xtype:"rownumberer",width:35,text:"No.",align:"center"},{text:"主键",dataIndex:"JE_CORE_ATOMCOLUMN_ID",hidden:!0},{text:"<font color='blue'>预添加列名称</font>",dataIndex:"ATOMCOLUMN_NAME",field:{xtype:"textfield"},width:126},{text:"原子编码",dataIndex:"ATOMCOLUMN_CODE",width:200},{text:"<font color='blue'>预添加列编码</font>",dataIndex:"ATOMCOLUMN_CONTEXT",width:200,field:{xtype:"textfield"}},{text:"检测",width:50,dataIndex:"SY_AUDFLAG",renderer:function(e,t,i,n,a,l,o,d,r){var c=o.panel.columnCodes,s=i.get("ATOMCOLUMN_CONTEXT");return-1!=c.indexOf(s)?"<div  style='height:14px;' class='je_verifyfailed'> </div>":"<div style='height:14px;' class='jeicon jeicon-resource-table-application'> </div>"}},{text:"操作",xtype:"actioncolumn",align:"center",width:60,items:[{iconCls:"jeicon jeicon-error",tooltip:"移除",handler:function(e,t,i){var n=e.panel;n.getStore().removeAt(t);n.checkColumnCode(n.getStore().gridObj)}}]}],enableKeyNav:!0,columnLines:!0,initComponent:function(){var a=this;this.editing=Ext.create("Ext.grid.plugin.CellEditing",{clicksToEdit:1}),this.plugins=[this.editing],a.listeners={render:function(e){(e.store.gridObj=e).getStore().on("update",function(e,t,i,n){"edit"==i&&(t.modified.ATOMCOLUMN_CONTEXT&&a.checkColumnCode(e.gridObj),t.commit())})}};var e=Ext.create("Ext.data.Store",{fields:JE.getFields({tableName:"JE_CORE_ATOMCOLUMN"}),data:a.gridDatas});a.store=e,this.callParent(arguments)},checkColumnCode:function(e){var t=e.columnCodes,i=e.getStore().data.items;Ext.each(i,function(e){e.commit()});for(var n=!0,a=0;a<i.length;a++)if(-1!=t.indexOf(i[a].get("ATOMCOLUMN_CONTEXT"))){n=!1;break}var l=e.up("window"),o=l.down("panel[xtype=column.saveatomfieldtree]").getSelectionModel().getSelection(),d=l.down("button[ref=ok]");n&&0!=i.length&&0!=o.length?d.enable():d.disable()}}),Ext.define("JE.sys.table.view.column.SaveAtomFieldTree",{extend:"Ext.tree.Panel",alias:"widget.column.saveatomfieldtree",useArrows:!0,rootVisible:!1,animate:!1,multiSelect:!1,selModel:{selType:"treemodel",allowDeselect:!0,mode:"SIGNLE"},viewConfig:{selectedItemCls:"x-tree-row-selected",focusedItemCls:"x-tree-row-focused",beforeFocusedItemCls:"x-tree-row-before-focused",tableFocusedFirstCls:"x-tree-table-focused-first"},listeners:{selectionchange:function(e,t,i){var n=e.view.panel.up("window").down("panel[xtype=column.saveatomfieldgrid]"),a=e.getSelection(),l=[];if(0<a.length){var o=a[0],d=JE.ajax({url:JE.getUrlMaps("je.core.load"),params:{limit:-1,tableCode:"JE_CORE_ATOMCOLUMN",whereSql:" and ATOMCOLUMN_ATOM_ID='"+o.get("id")+"'"}});Ext.each(d.rows,function(e){l.push(e.ATOMCOLUMN_CODE)})}n.columnCodes=l,n.checkColumnCode(n)}},initComponent:function(){this.store=JE.getStore({type:"tree",tableName:"JE_CORE_ATOM",multi:!1,params:{whereSql:""}}),this.callParent(arguments)}}),Ext.define("JE.sys.table.view.column.SaveAtomFieldWin",{extend:"Ext.window.Window",alias:"widget.column.saveatomfieldwin",title:"原子辅助",bodyPadding:1,width:900,height:570,layout:"border",modal:!0,maximizable:!1,closeAction:"destroy",autoShow:!0,buttonAlign:"center",initComponent:function(){var i=this.fn;this.items=[{xtype:"column.saveatomfieldtree",region:"west",width:150},{columnCodes:[],gridDatas:this.gridDatas,xtype:"column.saveatomfieldgrid",region:"center"}],this.buttons=[{text:"确定",ref:"ok",disabled:!0,iconCls:"jeicon jeicon-check",handler:function(e){var t=e.up("window");0<t.down("panel[xtype=column.saveatomfieldtree]").getSelectionModel().getSelection().length?i&&0!=i(t)&&t.close():JE.alert("请选择原子！")}},{text:"取消",iconCls:"jeicon jeicon-cancel",handler:function(e){e.up("window").close()}}],this.callParent(arguments)}}),Ext.define("JE.sys.table.view.column.TableColumnGrid",{extend:"Ext.grid.Panel",alias:"widget.table.tablecolumngrid",border:0,multiSelect:!0,frame:!1,selModel:{selType:"checkboxmodel"},cls:"pcatgrid je-sys-table-column",tbar:[{xtype:"button",text:"添加",ref:"gridInsert",iconCls:"jeicon jeicon-new-form"},{xtype:"button",text:"删除",ref:"gridDelete",iconCls:"jeicon jeicon-physics-delete"},{xtype:"button",text:"保存",ref:"gridSave",iconCls:"jeicon jeicon-form-save"},{xtype:"button",ref:"addFieldSet",iconCls:"jeicon jeicon-new-form",text:"辅助字段添加",menu:{items:[{text:"字典辅助",ref:"addDDField",iconCls:"jeicon jeicon-dictionary"},{text:"级联字典辅助",ref:"addCascadeField",iconCls:"jeicon jeicon-dictionary"},{text:"表辅助",ref:"addTableField",iconCls:"jeicon jeicon-resource-form"},{text:"原子辅助",ref:"addAtomField",iconCls:"jeicon jeicon-atom",hidden:!0},{text:"存为原子",ref:"saveAtomField",iconCls:"jeicon jeicon-table-column-synchronization",hidden:!0}]}},{xtype:"button",ref:"sysFieldSet",iconCls:"jeicon jeicon-new-form",text:"系统字段添加",menu:{items:[{text:"使用更新字段",ref:"generateUpdateInfo",iconCls:"jeicon jeicon-t"},{text:"使用流程字段",ref:"generateWfInfo",iconCls:"jeicon jeicon-t"},{text:"使用SAAS字段",ref:"generateSaasInfo",iconCls:"jeicon jeicon-t"},{text:"使用扩展字段",ref:"generateExtendInfo",iconCls:"jeicon jeicon-t"}]}},{xtype:"button",text:"同步列名称",ref:"syncField",iconCls:"jeicon jeicon-rename-o"},{xtype:"button",text:"设定主键名",ref:"setPkCode",iconCls:"jeicon jeicon-editor-code"},{xtype:"button",text:"导出",ref:"gridExcel",iconCls:"jeicon jeicon-excel"},"->",{xtype:"qqfield",queryFields:[{name:"TABLECOLUMN_NAME"},{name:"TABLECOLUMN_CODE"}]}],viewConfig:{getRowClass:function(e,t,i,n){if("SYS"==e.get("TABLECOLUMN_CLASSIFY"))return"row-sys-cls"}},enableKeyNav:!0,columnLines:!0,initComponent:function(){var e=this;e.store=Ext.create("JE.sys.table.store.TableColumnStore",{gridObj:e}),e.dockedItems=[{cls:"je-sys-table-pagingtoolbar",xtype:"pagingtoolbar",store:e.store,dock:"bottom",displayInfo:!0}],this.editing=Ext.create("Ext.grid.plugin.CellEditing",{clicksToEdit:1}),this.plugins=[this.editing];var t={text:"允许为空",dataIndex:"TABLECOLUMN_ISNULL",tactics:[{bgCss:!0,type:"dic",dicCode:"YESORNO"}],renderer:JE.renderer,xtype:"uxcolumn",titleCls:"jeicon jeicon-pencil",titleStyle:"width:100%;height:16px;"};"ORACLE"!=JE.systemConfig.JE_SYS_DB&&(t.field={readOnly:!0,xtype:"cbbfield",configInfo:"YESORNO"}),e.columns=[{xtype:"rownumberer",width:35,text:"No.",align:"center"},{text:"创建",dataIndex:"TABLECOLUMN_ISCREATE",tactics:[{bgCss:!0,type:"dic",dicCode:"YESORNO"}],renderer:JE.renderer,align:"center",width:50},{text:"主键",dataIndex:"JE_CORE_TABLECOLUMN_ID",hidden:!0},{text:"列名称",dataIndex:"TABLECOLUMN_NAME",field:{xtype:"textfield"},width:190,xtype:"uxcolumn",titleCls:"jeicon jeicon-pencil",titleStyle:"width:100%;height:16px;"},{text:"列编码",dataIndex:"TABLECOLUMN_CODE",field:{xtype:"textfield",regex:"^[A-Z]{1}[A-Z_0-9]{1,29}$",regexText:"字段编码由大写字母、下划线组成!"},width:240,xtype:"uxcolumn",titleCls:"jeicon jeicon-pencil",titleStyle:"width:100%;height:16px;"},{text:"类型",dataIndex:"TABLECOLUMN_TYPE",field:{xtype:"cbbfield",configInfo:"JE_FIELDTYPE"},tactics:[{type:"dic",dicCode:"JE_FIELDTYPE"}],renderer:JE.renderer,xtype:"uxcolumn",titleCls:"jeicon jeicon-pencil",titleStyle:"width:100%;height:16px;"},{text:"长度/自定义",dataIndex:"TABLECOLUMN_LENGTH",field:{xtype:"textfield"},xtype:"uxcolumn",width:120,titleCls:"jeicon jeicon-pencil",titleStyle:"width:100%;height:16px;"},{text:"排序",dataIndex:"SY_ORDERINDEX",field:{xtype:"numberfield"},xtype:"uxcolumn",titleCls:"jeicon jeicon-pencil",titleStyle:"width:100%;height:16px;"},{text:"描述",dataIndex:"TABLECOLUMN_REMARK",field:{xtype:"textfield"},xtype:"uxcolumn",width:260,titleCls:"jeicon jeicon-pencil",titleStyle:"width:100%;height:16px;"},{text:"英文",dataIndex:"TABLECOLUMN_NAME_EN",field:{xtype:"textfield"},width:180,xtype:"uxcolumn",titleCls:"jeicon jeicon-pencil",titleStyle:"width:100%;height:16px;"},t,{text:"唯一",width:80,dataIndex:"TABLECOLUMN_UNIQUE",hidden:!0,field:{xtype:"cbbfield",configInfo:"YESORNO"},tactics:[{bgCss:!0,type:"dic",dicCode:"YESORNO"}],renderer:JE.renderer,xtype:"uxcolumn",titleCls:"jeicon jeicon-pencil",titleStyle:"width:100%;height:16px;"},{text:"树形类型",dataIndex:"TABLECOLUMN_TREETYPE",field:{xtype:"cbbfield",configInfo:"JE_TREETYPE"},tactics:[{type:"dic",dicCode:"JE_TREETYPE"}],renderer:JE.renderer,xtype:"uxcolumn",titleCls:"jeicon jeicon-pencil",titleStyle:"width:100%;height:16px;"},{text:"分类",dataIndex:"TABLECOLUMN_CLASSIFY",tactics:[{bgCss:!0,type:"dic",dicCode:"JE_CLASSIFY"}],renderer:JE.renderer},{text:"表主键",dataIndex:"TABLECOLUMN_RESOURCETABLE_ID",hidden:!0}],this.callParent(arguments)}}),Ext.define("JE.sys.table.view.column.TableColumnView",{extend:"Ext.panel.Panel",alias:"widget.table.tablecolumnview",layout:"fit",items:[{xtype:"table.tablecolumngrid"}]}),Ext.define("JE.sys.table.view.column.TableFieldForm",{extend:"Ext.form.Panel",alias:"widget.tablecolumn.tablefieldform",layout:"column",border:0,frame:!1,bodyStyle:{},defaults:{labelAlign:"right",xtype:"textfield",padding:"1 0 1 0",margin:"2 0 0 0 ",columnWidth:.225,labelWidth:60,cls:"je-field-basiccls"},bodyPadding:"2 20 0 0",initComponent:function(){var f=this;f.tbar={xtype:"box",data:{},itemId:"formTitleBox",style:"background-color:#f1f1f1;border-bottom:1px #BFBFBF solid;",columnWidth:1,tpl:'<table width="100%" height="100%" name="__body"><tbody><tr><td style="font-size:24px;font-family:黑体;" name="__text">表辅助</td></tr><tr><td name="__text"><font color="#606060">通过其他表资源辅助完成字段添加操作。</font><br><font color="blue">【查询选择入口、自动外键】按需选择</font></td></tr></tbody></table>'},f.items=[{fieldLabel:"表",xtype:"treessfield",configInfo:"JE_CORE_RESOURCETABLE,TABLENAME~TABLECODE~TABLEID,text~code~id,S,",whereSql:" AND SY_JESYS='1' AND RESOURCETABLE_TABLECODE!='"+f.tableCode+"'",name:"TABLENAME",codeSearch:!0,allowBlank:!1,listeners:{query:function(e,t){if(t){var i=f.getForm(),n=t[0],a=e.up("window[xtype=tablecolumn.tablefieldwin]").down("panel[xtype=tablecolumn.tablefieldgrid]"),l=a.getStore(),o=i.findField("FUNCNAME"),d=i.findField("FUNCCODE"),r=o.getStore();if(n){var c=JE.ajax({url:JE.getUrlMaps("je.core.tableColumn","load"),params:{tableCode:"JE_CORE_TABLECOLUMN",limit:-1,whereSql:" AND TABLECOLUMN_RESOURCETABLE_ID='"+f.tablePk+"'"}}).rows,s=new Array;if(Ext.each(c,function(e){s.push(e.TABLECOLUMN_CODE)}),a.columnCodes=s,a.targerTableCode=n.get("code"),r.removeAll(!0),!Ext.isEmpty(n.get("code"))){var E=JE.ajax({url:JE.getUrlMaps("je.core.resourceTable","getFuncInfoByTable"),params:{tableCode:"JE_CORE_FUNCINFO",strData:n.get("code")}});0<E.length?(r.loadData(E),d.setValue(E[0].code),o.setValue(E[0].text),o.setReadOnly(!1)):o.setReadOnly(!0)}}else r.removeAll(!0),a.columnCodes=[],a.targerTableCode="";l.loadData([])}}}},{fieldLabel:"表编码",xtype:"textfield",name:"TABLECODE",readOnly:!0},{fieldLabel:"表主键",xtype:"textfield",name:"TABLEID",hidden:!0},{fieldLabel:"功能",xtype:"cbbfield",name:"FUNCNAME",dataArray:[],readOnly:!0,configData:{fieldNames:["FUNCNAME","FUNCCODE"],valueNames:["text","code"]},configInfo:"YESORNO,FUNCNAME~FUNCCODE,text~code,S",displayField:"text",valueField:"text"},{fieldLabel:"功能编码",xtype:"textfield",name:"FUNCCODE",readOnly:!0},{xtype:"button",text:"导入字段",columnWidth:.1,margin:"2 0 0 10 ",cls:"btn btn-small",iconCls:"jeicon jeicon-import",handler:function(e){var l=e.up("window[xtype=tablecolumn.tablefieldwin]"),i=l.down("panel[xtype=tablecolumn.tablefieldgrid]"),t=f.getForm(),n=t.findField("TABLEID").getValue(),o=t.findField("TABLENAME").getValue();if(Ext.isEmpty(n))JE.alert("请先选择表!");else{var d=t.findField("TABLECODE").getValue(),r=i.tableCode,c=[],s=i.getStore();Ext.isEmpty(d)||(0<=r.lastIndexOf("_")&&(r=r.substring(r.lastIndexOf("_")+1)),0<=d.lastIndexOf("_")&&(d=d.substring(d.lastIndexOf("_")+1)));var a="";if(0<s.getCount()){var E=new Array;Ext.each(s.data.items,function(e){c.push(e.data),E.push("'"+e.get("JE_CORE_TABLECOLUMN_ID")+"'")}),a=" AND JE_CORE_TABLECOLUMN_ID NOT IN ("+E.join(",")+")"}JE.selectWin({parent:null,parentType:"self",title:"表字段",width:800,height:700,configInfo:"JE_CORE_TABLECOLUMN,,,M",whereSql:" AND TABLECOLUMN_RESOURCETABLE_ID='"+n+"' AND (TABLECOLUMN_CLASSIFY!='SYS' OR TABLECOLUMN_TYPE='ID' OR TABLECOLUMN_CODE IN ('SY_JTGSMC','SY_JTGSID') OR TABLECOLUMN_CODE LIKE 'SY_CREATE%')"+a,type:"grid",callback:function(e,t){var n=!1,a=i.columnCodes;Ext.each(e,function(e){var t=Ext.clone(e.data);"ID"==t.TABLECOLUMN_TYPE?(t.TABLECOLUMN_CLASSIFY=t.TABLECOLUMN_CODE,t.TABLECOLUMN_NAME=o+"_外键ID"):t.TABLECOLUMN_CLASSIFY=t.TABLECOLUMN_CODE.replace(d+"_",r+"_"),-1!=a.indexOf(t.TABLECOLUMN_CLASSIFY)&&(n=!0),t.TABLECOLUMN_ISCREATE="0",t.TABLECOLUMN_ISNULL="0",c.push(t);var i=l.down("button[ref=ok]");n?i.disable():i.enable()}),s.loadData(c)}})}}}],this.callParent(arguments)}}),Ext.define("JE.sys.table.view.column.TableFieldGrid",{extend:"Ext.grid.Panel",alias:"widget.tablecolumn.tablefieldgrid",border:1,multiSelect:!0,frame:!1,cls:"je-table-fieldgrid",columns:[{xtype:"rownumberer",width:35,text:"No.",align:"center"},{text:"主键",dataIndex:"JE_CORE_TABLECOLUMN_ID",hidden:!0},{text:"<font color='blue'>预添加列名称</font>",dataIndex:"TABLECOLUMN_NAME",field:{xtype:"textfield"},width:126},{text:"列编码",dataIndex:"TABLECOLUMN_CODE",width:200},{text:"<font color='blue'>预添加列编码</font>",dataIndex:"TABLECOLUMN_CLASSIFY",width:200,field:{xtype:"textfield"}},{text:"生成外键",dataIndex:"TABLECOLUMN_ISCREATE",align:"center",renderer:function(e,t,i,n,a,l,o,d,r){var c=!1;"ID"!=i.get("TABLECOLUMN_TYPE")&&(c=!0);var s=Ext.baseCSSPrefix,E=[];return c?t.tdCls+=" "+this.disabledCls:(E=[s+"grid-checkcolumn"],"1"==e&&E.push(s+"grid-checkcolumn-checked")),'<img class="'+E.join(" ")+'" src="'+Ext.BLANK_IMAGE_URL+'"/>'}},{text:"查询选择入口",dataIndex:"TABLECOLUMN_ISNULL",align:"center",renderer:function(e,t,i,n,a,l,o,d,r){var c=!1;l.findRecord("TABLECOLUMN_ISNULL","1")&&"1"!=e&&(c=!0);var s=Ext.baseCSSPrefix,E=[];return c?(t.tdCls+=" "+this.disabledCls,i.noSelect=!0):(E=[s+"grid-checkcolumn"],"1"==e&&E.push(s+"grid-checkcolumn-checked"),i.noSelect=!1),'<img class="'+E.join(" ")+'" src="'+Ext.BLANK_IMAGE_URL+'"/>'}},{text:"表主键",dataIndex:"TABLECOLUMN_RESOURCETABLE_ID",hidden:!0},{text:"视图配置",dataIndex:"TABLECOLUMN_VIEWCONFIG",hidden:!0},{text:"数据字典配置",dataIndex:"TABLECOLUMN_DICCONFIG",hidden:!0},{text:"数据字典查询字段",dataIndex:"TABLECOLUMN_DICQUERYFIELD",hidden:!0},{text:"查询选择配置",dataIndex:"TABLECOLUMN_QUERYCONFIG",hidden:!0},{text:"检测",width:50,dataIndex:"TABLECOLUMN_TREETYPE",renderer:function(e,t,i,n,a,l,o,d,r){var c=o.panel.columnCodes,s=i.get("TABLECOLUMN_CLASSIFY");return-1!=c.indexOf(s)?"<div  style='height:14px;' class='je_verifyfailed'> </div>":"<div style='height:14px;' class='jeicon jeicon-resource-table-application'> </div>"}},{text:"操作",xtype:"actioncolumn",align:"center",width:60,items:[{iconCls:"jeicon jeicon-error",tooltip:"移除",handler:function(e,t,i){var n=e.panel;n.getStore().removeAt(t);n.checkColumnCode(n.getStore().gridObj)}}]}],enableKeyNav:!0,columnLines:!0,initComponent:function(){var a=this;this.editing=Ext.create("Ext.grid.plugin.CellEditing",{clicksToEdit:1}),this.plugins=[this.editing],this.store=JE.getStore({id:"JE_CORE_TABLECOLUMN_ID",tableName:"JE_CORE_TABLECOLUMN",autoLoad:!1,params:{limit:-1,whereSql:" and 1!=1",orderSql:" order by TABLECOLUMN_CLASSIFY,TABLECOLUMN_CODE"}}),a.listeners={afterrender:function(e){(e.store.gridObj=e).getStore().on("update",function(e,t,i,n){"edit"==i&&(t.modified.TABLECOLUMN_CLASSIFY&&a.checkColumnCode(e.gridObj),t.commit())}),e.getStore().removeAll()},cellclick:function(e,t,i,n,a,l,o,d){var r=e.panel,c=(r=e.lockingPartner?r.ownerLockable:r).columnManager.getHeaderAtIndex(i),s=n.get(c.dataIndex);"TABLECOLUMN_ISCREATE"==c.dataIndex?"ID"==n.get("TABLECOLUMN_TYPE")&&("1"==s?n.set(c.dataIndex,"0"):n.set(c.dataIndex,"1")):"TABLECOLUMN_ISNULL"==c.dataIndex&&(n.noSelect||("1"==s?n.set(c.dataIndex,"0"):n.set(c.dataIndex,"1"),r.getStore().each(function(e){e.get("JE_CORE_TABLECOLUMN_ID")!=n.get("JE_CORE_TABLECOLUMN_ID")&&(e.set("TABLECOLUMN_ISNULL","1"),e.set("TABLECOLUMN_ISNULL","0"))})))}},this.callParent(arguments)},checkColumnCode:function(e){for(var t=e.columnCodes,i=e.getStore().data.items,n=!0,a=0;a<i.length;a++)if(-1!=t.indexOf(i[a].get("TABLECOLUMN_CLASSIFY"))){n=!1;break}var l=e.up("window");if(l){var o=l.down("button[ref=ok]");n&&0!=i.length?o.enable():o.disable()}}}),Ext.define("JE.sys.table.view.column.TableFieldWin",{extend:"Ext.window.Window",alias:"widget.tablecolumn.tablefieldwin",title:"表辅助",bodyPadding:1,width:900,height:570,layout:"border",modal:!0,maximizable:!1,closeAction:"destroy",autoShow:!0,buttonAlign:"center",initComponent:function(){var f=this,u=f.fn;f.items=[{tableCode:f.tableCode,tablePk:f.tablePk,xtype:"tablecolumn.tablefieldform",region:"north",height:103},{tableCode:f.tableCode,xtype:"tablecolumn.tablefieldgrid",region:"center"}],f.buttons=[{text:"确定",ref:"ok",disabled:!0,iconCls:"jeicon jeicon-check",handler:function(e){var t=e.up("window");if(t.down("form").isValid()){var i=t.down("grid[xtype=tablecolumn.tablefieldgrid]"),n=t.down("form[xtype=tablecolumn.tablefieldform]").getForm().findField("FUNCCODE").getValue(),a=new Array,l=i.getStore().data.items,o=new Array,d=new Array,r=!1,c="0";Ext.each(l,function(e){o.push(e.get("TABLECOLUMN_CLASSIFY")),d.push(e.get("TABLECOLUMN_CODE")),a.push(e.data),"1"==e.get("TABLECOLUMN_ISNULL")&&(r=!0),"1"==e.get("TABLECOLUMN_ISCREATE")&&(c="1")});var s={tableCode:f.tableCode,pkValue:f.tablePk,strData:Ext.encode(a),TARGERTABLECODE:i.targerTableCode,CREATECHILD:c};r&&(s.FUNCCODE=n,s.QUERYSTR=o.join("~")+","+d.join("~")+",S");var E=JE.ajax({url:JE.getUrlMaps("je.core.tableColumn","addColumnByTable"),params:s});return E.success?(JE.msg(E.obj),u&&0!=u(t,c)&&t.close(),!0):(JE.alert(E.obj),!1)}}},{text:"取消",iconCls:"jeicon jeicon-cancel",handler:function(e){e.up("window").close()}}],this.callParent(arguments)}}),Ext.define("JE.sys.table.view.index.TableIndexGrid",{extend:"Ext.grid.Panel",alias:"widget.table.tableindexgrid",border:0,multiSelect:!0,frame:!1,selModel:{selType:"checkboxmodel"},tbar:[{xtype:"button",text:"添加",ref:"gridInsert",iconCls:"jeicon jeicon-new-form"},{xtype:"button",text:"删除",ref:"gridDelete",iconCls:"jeicon jeicon-physics-delete"},{xtype:"button",text:"保存",ref:"gridSave",iconCls:"jeicon jeicon-form-save"},{xtype:"button",text:"导出Excel",ref:"gridExcel",iconCls:"jeicon jeicon-excel",hidden:!0},"->",{xtype:"qqfield",queryFields:[{name:"TABLEINDEX_CODE"},{name:"TABLEINDEX_FIELDNAME"}]}],cls:"pcatgrid",viewConfig:{getRowClass:function(e,t,i,n){if("SYS"==e.get("TABLEINDEX_CLASSIFY"))return"row-sys-cls"}},enableKeyNav:!0,columnLines:!0,initComponent:function(){this.store=Ext.create("JE.sys.table.store.TableIndexStore"),this.dockedItems=[{xtype:"pagingtoolbar",store:this.store,dock:"bottom",displayInfo:!0}],this.editing=Ext.create("Ext.grid.plugin.CellEditing",{clicksToEdit:1}),this.plugins=[this.editing],this.columns=[{text:"主键",dataIndex:"JE_CORE_TABLEINDEX_ID",hidden:!0},{xtype:"rownumberer",width:35,text:"No.",align:"center"},{text:"索引名称",dataIndex:"TABLEINDEX_NAME",width:185},{text:"字段名称",dataIndex:"TABLEINDEX_FIELDNAME",field:{xtype:"gridssfield",configInfo:"JE_CORE_TABLECOLUMN,TABLEINDEX_FIELDNAME~TABLEINDEX_FIELDCODE,TABLECOLUMN_NAME~TABLECOLUMN_CODE,S",whereSql:" AND TABLECOLUMN_RESOURCETABLE_ID='{TABLEINDEX_RESOURCETABLE_ID}'"},width:164,xtype:"uxcolumn",titleCls:"jeicon jeicon-pencil",titleStyle:"width:100%;height:16px;"},{text:"字段编码",dataIndex:"TABLEINDEX_FIELDCODE",hidden:!0},{text:"类型",dataIndex:"TABLEINDEX_TYPE",hidden:!0,width:149},{text:"唯一",dataIndex:"TABLEINDEX_UNIQUE",field:{xtype:"cbbfield",configInfo:"YESORNO"},tactics:[{bgCss:!0,type:"dic",dicCode:"YESORNO"}],renderer:JE.renderer,xtype:"uxcolumn",titleCls:"jeicon jeicon-pencil",titleStyle:"width:100%;height:16px;"},{text:"创建",dataIndex:"TABLEINDEX_ISCREATE",tactics:[{bgCss:!0,type:"dic",dicCode:"YESORNO"}],renderer:JE.renderer},{text:"分类",dataIndex:"TABLEINDEX_CLASSIFY",tactics:[{bgCss:!0,type:"dic",dicCode:"JE_CLASSIFY"}],renderer:JE.renderer},{text:"备注",dataIndex:"TABLEINDEX_REMARK",width:150,field:{xtype:"textarea"},xtype:"uxcolumn",titleCls:"jeicon jeicon-pencil",titleStyle:"width:100%;height:16px;"},{text:"排序",dataIndex:"SY_ORDERINDEX",field:{xtype:"numberfield"},xtype:"uxcolumn",titleCls:"jeicon jeicon-pencil",titleStyle:"width:100%;height:16px;"},{text:"资源表外键",dataIndex:"TABLEINDEX_RESOURCETABLE_ID",hidden:!0}],this.callParent(arguments)}}),Ext.define("JE.sys.table.view.index.TableIndexView",{extend:"Ext.panel.Panel",alias:"widget.table.tableindexview",layout:"fit",items:[{xtype:"table.tableindexgrid"}]}),Ext.define("JE.sys.table.view.key.TableKeyGrid",{extend:"Ext.grid.Panel",alias:"widget.table.tablekeygrid",border:0,multiSelect:!0,frame:!1,selModel:{selType:"checkboxmodel"},tbar:[{xtype:"button",text:"添加",ref:"gridInsert",iconCls:"jeicon jeicon-new-form"},{xtype:"button",text:"删除",ref:"gridDelete",iconCls:"jeicon jeicon-physics-delete"},{xtype:"button",text:"保存",ref:"gridSave",iconCls:"jeicon jeicon-form-save"},{xtype:"button",text:"选取主键",ref:"sekectPk",iconCls:"jeicon jeicon-form-save"},{xtype:"button",text:"导出",ref:"gridExcel",iconCls:"jeicon jeicon-excel",hidden:!0},"->",{xtype:"qqfield",queryFields:[{name:"TABLEKEY_CODE"},{name:"TABLEKEY_COLUMNCODE"}]}],cls:"pcatgrid",viewConfig:{getRowClass:function(e,t,i,n){if("SYS"==e.get("TABLEKEY_CLASSIFY"))return"row-sys-cls"}},enableKeyNav:!0,columnLines:!0,initComponent:function(){this.store=Ext.create("JE.sys.table.store.TableKeyStore"),this.dockedItems=[{xtype:"pagingtoolbar",store:this.store,dock:"bottom",displayInfo:!0}],this.editing=Ext.create("Ext.grid.plugin.CellEditing",{clicksToEdit:1}),this.plugins=[this.editing],this.columns=[{text:"主键",dataIndex:"JE_CORE_TABLEKEY_ID",hidden:!0},{xtype:"rownumberer",width:35,text:"No.",align:"center"},{text:"键编码",dataIndex:"TABLEKEY_CODE",width:185},{text:"字段编码",dataIndex:"TABLEKEY_COLUMNCODE",field:{title:"本表字段",xtype:"gridssfield",configInfo:"JE_CORE_TABLECOLUMN,TABLEKEY_COLUMNCODE,TABLECOLUMN_CODE,S",whereSql:" AND TABLECOLUMN_RESOURCETABLE_ID='{TABLEKEY_RESOURCETABLE_ID}'"},width:164,xtype:"uxcolumn",titleCls:"jeicon jeicon-pencil",titleStyle:"width:100%;height:16px;"},{text:"类型",dataIndex:"TABLEKEY_TYPE",field:{xtype:"cbbfield",configInfo:"JE_KEYTYPE"},tactics:[{type:"dic",dicCode:"JE_KEYTYPE"}],renderer:JE.renderer,xtype:"uxcolumn",titleCls:"jeicon jeicon-pencil",titleStyle:"width:100%;height:16px;"},{text:"关联表",dataIndex:"TABLEKEY_LINKTABLE",field:{xtype:"treessfield",codeSearch:!0,configInfo:"JE_CORE_RESOURCETABLE,TABLEKEY_LINKTABLE,code,S",whereSql:" AND SY_JESYS='1' AND JE_CORE_RESOURCETABLE_ID!='{TABLEKEY_RESOURCETABLE_ID}'"},width:149,xtype:"uxcolumn",titleCls:"jeicon jeicon-pencil",titleStyle:"width:100%;height:16px;"},{text:"关联字段",dataIndex:"TABLEKEY_LINECOLUMNCODE",field:{xtype:"gridssfield",configInfo:"JE_CORE_TABLECOLUMN,TABLEKEY_LINECOLUMNCODE,TABLECOLUMN_CODE,S",whereSql:" AND TABLECOLUMN_TABLECODE='{TABLEKEY_LINKTABLE}'"},width:164,xtype:"uxcolumn",titleCls:"jeicon jeicon-pencil",titleStyle:"width:100%;height:16px;"},{text:"关联类型",dataIndex:"TABLEKEY_LINETYLE",field:{xtype:"cbbfield",configInfo:"JE_LINKTYPE"},tactics:[{type:"dic",dicCode:"JE_LINKTYPE"}],renderer:JE.renderer,xtype:"uxcolumn",titleCls:"jeicon jeicon-pencil",titleStyle:"width:100%;height:16px;"},{hidden:!0,text:"是否检测",dataIndex:"TABLEKEY_CHECKED",field:{xtype:"cbbfield",configInfo:"JE_CHECK"},tactics:[{bgCss:!0,type:"dic",dicCode:"YESORNO"}],renderer:JE.renderer,xtype:"uxcolumn",titleCls:"jeicon jeicon-pencil",titleStyle:"width:100%;height:16px;"},{text:"强制性约束",dataIndex:"TABLEKEY_ISRESTRAINT",field:{xtype:"cbbfield",configInfo:"YESORNO"},tactics:[{bgCss:!0,type:"dic",dicCode:"YESORNO"}],renderer:JE.renderer,xtype:"uxcolumn",titleCls:"jeicon jeicon-pencil",titleStyle:"width:100%;height:16px;"},{text:"是否已创建",dataIndex:"TABLEKEY_ISCREATE",tactics:[{bgCss:!0,type:"dic",dicCode:"YESORNO"}],renderer:JE.renderer},{text:"分类",dataIndex:"TABLEKEY_CLASSIFY",tactics:[{bgCss:!0,type:"dic",dicCode:"JE_CLASSIFY"}],renderer:JE.renderer},{text:"排序",dataIndex:"SY_ORDERINDEX",field:{xtype:"numberfield"},xtype:"uxcolumn",titleCls:"jeicon jeicon-pencil",titleStyle:"width:100%;height:16px;"},{text:"资源表外键",dataIndex:"TABLEKEY_RESOURCETABLE_ID",hidden:!0}],this.callParent(arguments)}}),Ext.define("JE.sys.table.view.key.TableKeyView",{extend:"Ext.panel.Panel",alias:"widget.table.tablekeyview",layout:"fit",items:[{xtype:"table.tablekeygrid"}]}),Ext.define("JE.sys.table.view.tableview.TvCascadeView",{extend:"Ext.grid.Panel",alias:"widget.table.tvcascadeview",multiSelect:!0,columnLines:!0,initComponent:function(){var a=this;a.columns=[{text:"表1",dataIndex:"table1",flex:1,field:{xtype:"gridssfield",configInfo:"JE_CORE_RESOURCETABLE,table1,RESOURCETABLE_TABLECODE,S",whereSql:" AND SY_JESYS='1'",listeners:{beforequery:function(e){var t=a.mainView.columnView,i=new Array;for(var n in t.tables)i.push(n);e.whereSql=" AND RESOURCETABLE_TABLECODE IN ('"+i.join("','")+"')"}}}},{text:"字段1",dataIndex:"code1",flex:1,field:{xtype:"gridssfield",configInfo:"JE_CORE_TABLECOLUMN,code1,TABLECOLUMN_CODE,S",whereSql:" AND TABLECOLUMN_TABLECODE='{table1}'"}},{text:"操作符",dataIndex:"conn",width:100,align:"center",field:{xtype:"cbbfield",dataArray:[{code:"no",text:"无操作"},{code:"=",text:"等于"},{code:">",text:"大于"},{code:"<",text:"小于"},{code:">=",text:"大于等于"},{code:"<=",text:"小于等于"},{code:"!=",text:"不等于"}]}},{text:"表2",dataIndex:"table2",flex:1,field:{xtype:"gridssfield",configInfo:"JE_CORE_RESOURCETABLE,table2,RESOURCETABLE_TABLECODE,S",whereSql:" AND SY_JESYS='1' ",listeners:{beforequery:function(e){var t=a.mainView.columnView,i=new Array;for(var n in t.tables)i.push(n);e.whereSql=" AND RESOURCETABLE_TABLECODE IN ('"+i.join("','")+"')"}}}},{text:"字段2",dataIndex:"code2",flex:1,field:{xtype:"gridssfield",configInfo:"JE_CORE_TABLECOLUMN,code2,TABLECOLUMN_CODE,S",whereSql:" AND TABLECOLUMN_TABLECODE='{table2}'"}},{text:'<div class="jeicon jeicon-resource-table-addition" style="width:16px;height:16px;"></div>',resizable:!1,sortable:!1,menuDisabled:!0,xtype:"actioncolumn",width:30,tooltip:"添加",align:"center",items:[{iconCls:"jeicon jeicon-error",tooltip:"删除",handler:function(e,t,i){e.getStore().removeAt(t)}}],listeners:{headerclick:function(e,t){a.store.add({conn:"="})}}}],a.store=Ext.create("Ext.data.Store",{fields:["table1","code1","table2","code2","conn"],data:[]});function e(){a.drawLines()}a.store.on({add:e,update:e,remove:e}),a.plugins=[Ext.create("Ext.grid.plugin.CellEditing",{clicksToEdit:1,pluginId:"cellEdit"})],a.callParent(arguments)},removeTableLines:function(n){var a=[];this.store.each(function(e){var t=e.get("table1"),i=e.get("table2");t!=n&&i!=n||a.push(e)}),this.store.remove(a)},drawLines:function(){var l=this,o=l.mainView.columnView,e=o.down("draw");o.remove(e);var d=[];l.store.each(function(e){var t="table."+e.get("table1"),i="table."+e.get("table2");if(JE.isNotEmpty(t)&&JE.isNotEmpty(i)){var n=o.getComponent(t),a=o.getComponent(i);n&&a&&n.itemId!=a.itemId&&(d=d.concat(l.getLinePath(n,a)))}}),o.add({xtype:"draw",viewBox:!1,items:d})},getLinePath:function(e,t){var i,n,a=this.mainView.columnView,l={},o={};i=e.getOffsetsTo(a.body),n=e.getBox(),l={x:i[0],y:i[1],width:n.width,height:n.height},i=t.getOffsetsTo(a.body),n=t.getBox(),o={x:i[0],y:i[1],width:n.width,height:n.height};var d=3,r=20;l.x<o.x?o.width=0:(d=-d,r=-r,l.width=0);var c=l.x+l.width+d,s=l.y+l.height/2+d,E=o.x+o.width-d,f=o.y+o.height/2-d,u=E-c;r=Math.abs(u/4)>Math.abs(r)?r:u/4,d=Math.abs(d);var p=["M",c,s];return p.push("L",E,f),[{type:"path",path:p.join(" "),"stroke-width":1,stroke:"black"},{type:"circle",radius:d,x:c,y:s,fill:"black"},{type:"circle",radius:d,x:E,y:f,fill:"black"}]}}),Ext.define("JE.sys.table.view.tableview.TvColumnView",{extend:"Ext.panel.Panel",autoScroll:!0,alias:"widget.table.tvcolumnview",plain:!0,layout:"fit",tables:{},initComponent:function(){this.callParent(arguments)},addColumns:function(e,i,t){var n=this,a=i.text+"("+i.code+")",l="JE_CORE_TABLECOLUMN",o=i.code,d="TABLECOLUMN_CODE",r="TABLECOLUMN_NAME",c=" and TABLECOLUMN_RESOURCETABLE_ID = '"+i.id+"'",s=e+"."+i.code,E=i.iconCls,f={type:e,lines:[],code:i.code,text:i.text,id:i.id,iconCls:i.iconCls};if(f.tableName=l,f.tableCode=o,f.codeName=d,f.textName=r,f.typeName="TABLECOLUMN_TYPE",!n.getComponent(s)){n.tables[f.code]=f;var u=n.add({xtype:"grid",title:a,iconCls:E,itemId:s,multiSelect:!0,height:300,width:200,infoData:f,floating:!0,itemId:s,constrain:!0,draggable:!0,simpleDrag:!0,autoShow:!0,resizable:{transparent:!0},listeners:{resize:function(){n.mainView.cascadeView.drawLines()},dragend:function(){n.mainView.cascadeView.drawLines()}},columns:[{text:"名称",dataIndex:r,flex:1,renderer:function(e,t,i,n,a,l,o){return e+' <span style="color:#ababab;">('+i.get(d)+")</span>"}},{text:"编码",hidden:!0,dataIndex:d,flex:1}],selModel:{selType:"checkboxmodel",checkOnly:!0},store:JE.getStore({tableName:l,params:{whereSql:c,orderSql:"order by TABLECOLUMN_CLASSIFY ASC,SY_ORDERINDEX ASC",limit:-1},autoLoad:!0}),tools:[{type:"close",handler:function(){n.remove(s),n.mainView.outColumnsView.removeTableOutCol(f.code),n.mainView.cascadeView.removeTableLines(f.code),delete n.tables[f.code]}}]});if(u.relayEvents(u.store,["beforeload","load","loadrecords"]),1!=t&&"table"==e){var p=JE.ajax({url:JE.getUrlMaps("je.core.load"),params:{tableCode:"JE_CORE_TABLEKEY",limit:-1,whereSql:" and TABLEKEY_TYPE = 'Foreign' and TABLEKEY_RESOURCETABLE_ID='"+i.id+"'"}}).rows;f.fks=[];var m=[];if(Ext.each(p,function(e){e={table1:i.code,code1:e.TABLEKEY_COLUMNCODE,conn:"=",table2:e.TABLEKEY_LINKTABLE,code2:e.TABLEKEY_LINECOLUMNCODE},f.fks.push(e),n.tables[e.table2]&&m.push({table1:e.table1,code1:e.code1,conn:e.conn,table2:e.table2,code2:e.code2})}),JE.isNotEmpty(i.bean&&i.bean.RESOURCETABLE_CHILDTABLECODES)){var x=i.bean.RESOURCETABLE_CHILDTABLECODES.split(",");Ext.each(x,function(t){var e=n.tables[t];e&&Ext.each(e.fks,function(e){e.table1==t&&e.table2==i.code&&m.push({table1:e.table1,code1:e.code1,conn:e.conn,table2:e.table2,code2:e.code2})})})}var g=[];Ext.each(m,function(t){var i=!1;n.mainView.cascadeView.store.each(function(e){e.get("table1")==t.table1&&e.get("code1")==t.code1&&e.get("table2")==t.table2&&e.get("code2")==t.code2&&(i=!0)}),i||g.push(t)}),n.mainView.cascadeView.store.add(g)}return u}}}),Ext.define("JE.sys.table.view.tableview.TvMainView",{extend:"Ext.panel.Panel",autoScroll:!1,alias:"widget.table.tvmainview",layout:"border",initComponent:function(){this.tbar=[{xtype:"hidden",name:"tableId",fieldLabel:"主键"},{xtype:"textfield",name:"tableName",fieldLabel:"名称",labelWidth:80,labelAlign:"right",allowBlank:!1,emptyText:"请输入表名..",width:300},{xtype:"textfield",name:"tableCode",fieldLabel:"编码",labelWidth:80,labelAlign:"right",allowBlank:!1,emptyText:"",width:300,regex:"^[A-Z]{1}[A-Z_0-9]{1,29}$",regexText:"视图编码由大写字母、下划线组成!"},{text:"生成SQL",iconCls:"jeicon jeicon-sql",ref:"generateSql"},{text:"执行SQL",iconCls:"jeicon jeicon-lightning-on",ref:"seeSql"}],this.items=[{region:"west",width:200,padding:"0 2 0 0",xtype:"table.tvtableview"},{layout:"border",region:"center",border:0,items:[{xtype:"table.tvcolumnview",region:"center"},{xtype:"panel",region:"south",layout:"border",height:400,border:0,split:!0,items:[{xtype:"tabpanel",region:"center",items:[{xtype:"table.tvoutcolumnsview",iconCls:"jeicon jeicon-form-column",title:"输出列"},{xtype:"table.tvcascadeview",iconCls:"jeicon jeicon-associated",title:"级联"}]},{region:"south",height:200,split:!0,xtype:"table.tvsqlview"}]}]}],this.callParent(arguments)},afterRender:function(){var e=this;e.callParent(arguments),e.columnView=e.down("[xtype=table.tvcolumnview]"),(e.columnView.mainView=e).outColumnsView=e.down("[xtype=table.tvoutcolumnsview]"),(e.outColumnsView.mainView=e).cascadeView=e.down("[xtype=table.tvcascadeview]"),(e.cascadeView.mainView=e).sqlView=e.down("[xtype=table.tvsqlview]")},getValues:function(){var e=this.down("textfield[name=tableName]").getValue(),t=this.down("textfield[name=tableCode]").getValue(),i=this.down("hidden[name=tableId]").getValue(),n=[];this.outColumnsView.store.each(function(e){Ext.isEmpty(e.get("code"))||n.push({name:e.get("name"),code:e.get("code"),dataType:e.get("dataType"),value:e.get("value"),table:e.get("table"),length:e.get("length"),formula:e.get("formula"),group:e.get("group"),order:e.get("order"),whereValue:e.get("whereValue")})});var a=this.sqlView.getSql();return{tableName:e,tableCode:t,tableId:i,fields:n,sql:a}},setValues:function(e){var t=this.down("textfield[name=tableName]"),i=this.down("textfield[name=tableCode]"),n=this.down("hidden[name=tableId]");t.setValue(e.tableName),i.setValue(e.tableCode),n.setValue(e.tableId),this.outColumnsView.store.loadData(e.fields),this.sqlView.setSql(e.sql)},buildSql:function(){var e=this.outColumnsView,t=this.cascadeView,i=e.getStore(),n=t.getStore(),a=[],l=[],o=[],d=[],r=[];if(i.each(function(e){var t=e.get("value");if(Ext.isEmpty(t)&&(t="''"),Ext.isEmpty(e.get("formula"))||(t=e.get("formula")+"("+t+")"),Ext.isEmpty(e.get("code"))){if("''"==t)return}else t+=" AS "+e.get("code");a.push(t),Ext.isEmpty(e.get("order"))||Ext.isEmpty(e.get("value"))||d.push(e.get("value")+" "+e.get("order")),1!=e.get("group")||Ext.isEmpty(e.get("value"))||r.push(e.get("value")),Ext.isEmpty(e.get("table"))||-1!=l.indexOf(e.get("table"))||l.push(e.get("table"))}),n.each(function(e){Ext.isEmpty(e.get("conn"))||"no"==e.get("conn")||o.push("AND "+e.get("table1")+"."+e.get("code1")+e.get("conn")+e.get("table2")+"."+e.get("code2"))}),a.length<=0)return JE.msg("无查询字段!"),"";var c=" SELECT \n\t"+a.join(",\n\t")+" \nFROM "+l.join(",")+"\n WHERE 1=1 \t"+o.join(" ");return 0<r.length&&(c+=" \n GROUP BY "+r.join(",")),0<d.length&&(c+=" \n ORDER BY "+d.join(",")),JE.msg("SQL已生成!"),c}}),Ext.define("JE.sys.table.view.tableview.TvOutColumnsView",{extend:"Ext.grid.Panel",alias:"widget.table.tvoutcolumnsview",multiSelect:!0,columnLines:!0,initComponent:function(){var o=this;o.columns=[{text:'<div class="jeicon jeicon-resource-table-addition" style="width:16px;height:16px;"></div>',resizable:!1,sortable:!1,menuDisabled:!0,xtype:"actioncolumn",width:30,tooltip:"添加",align:"center",items:[{iconCls:"jeicon jeicon-error",tooltip:"删除",handler:function(e,t,i){var n=e.getStore().getAt(t),a=o.mainView.columnView.getComponent("table."+n.get("table"));if(a){var l=a.store.findRecord(a.infoData.codeName,n.get("code"),0,!1,!1,!0);l?a.getSelectionModel().deselect(l):e.getStore().remove(n)}else e.getStore().remove(n)}}],listeners:{headerclick:function(e,t){o.store.add({id:JE.uuid()})}}},{text:"值",dataIndex:"value",width:200,field:{xtype:"textfield"}},{text:"编码",dataIndex:"code",width:200,field:{xtype:"textfield"}},{text:"名称",dataIndex:"name",width:120,field:{xtype:"textfield"}},{text:"表",dataIndex:"table",width:200},{text:"类型",dataIndex:"dataType",width:100,field:{xtype:"cbbfield",configInfo:"JE_FIELDTYPE"},tactics:[{type:"dic",dicCode:"JE_FIELDTYPE"}],renderer:JE.renderer},{text:"长度",dataIndex:"length",width:100,field:{xtype:"textfield"}},{text:"公式",dataIndex:"formula",width:80,field:{xtype:"cbbfield",dataArray:[{code:"Sum",text:"Sum"},{code:"Avg",text:"Avg"},{code:"Min",text:"Min"},{code:"Max",text:"Max"},{code:"Count",text:"Count"}]}},{text:"分组",dataIndex:"group",xtype:"checkcolumn",width:40},{text:"排序",dataIndex:"order",width:70,field:{xtype:"cbbfield",dataArray:[{code:"ASC",text:"升序"},{code:"DESC",text:"降序"}]}},{text:"条件值",dataIndex:"whereValue",flex:1,field:{xtype:"textfield"}}],o.store=Ext.create("Ext.data.Store",{fields:["id","value","code","name","table","formula","group","dataType","length","order","whereValue"],data:[]}),o.plugins=[Ext.create("Ext.grid.plugin.CellEditing",{clicksToEdit:1,pluginId:"cellEdit"})],o.viewConfig={plugins:{ptype:"gridviewdragdrop",dragText:"拖动排序",pluginId:"ddOrder"}},o.callParent(arguments)},removeTableOutCol:function(t){var i=[];this.store.each(function(e){e.get("table")==t&&i.push(e)}),this.store.remove(i)}}),Ext.define("JE.sys.table.view.tableview.TvSqlGridView",{extend:"Ext.grid.Panel",alias:"widget.table.tvsqlgridview",columnLines:!0,sql:"",mixins:["JE.core.util.ViewUtil"],initComponent:function(){var e=this,t=e.sql,i=JE.ajax({url:JE.getUrlMaps("je.core.dbsql","getSelectModel"),params:{sql:t}}),n=[{xtype:"rownumberer",text:"No.",width:50,align:"center"}];0==i.success?(e.store=Ext.create("Ext.data.Store",{fields:[],data:[]}),e.columns={defaults:{flex:1},items:n},JE.error(i.obj,i)):(Ext.each(i,function(e){n.push({dataIndex:e.name,text:e.name})}),e.columns={defaults:{flex:1},items:n},e.store=Ext.create("Ext.data.Store",{fields:i,pageSize:30,proxy:{type:"ajax",url:JE.getUrlMaps("je.core.dbsql.select"),extraParams:{sql:t},reader:{type:"json",root:"rows",totalProperty:"totalCount"}},autoLoad:!0}),e.bbar={xtype:"pagingtoolbar",store:e.store,displayInfo:!0,items:e.getPageitems(e.store)}),e.callParent(arguments)}}),Ext.define("JE.sys.table.view.tableview.TvSqlView",{alias:"widget.table.tvsqlview",extend:"Ext.panel.Panel",title:"查询SQL语句",initComponent:function(){this.layout="fit",this.items={xtype:"textarea",emptyText:"",itemId:"whereSql"},this.callParent(arguments)},getSql:function(){return this.getCmp("whereSql").getValue()},setSql:function(e){this.getCmp("whereSql").setValue(Ext.value(e,""))}}),Ext.define("JE.sys.table.view.tableview.TvTableView",{extend:"Ext.tree.Panel",autoScroll:!0,alias:"widget.table.tvtableview",useArrows:!0,rootVisible:!1,animate:!1,codeSearch:!0,showTitle:!1,mixins:["JE.core.util.ViewUtil"],initComponent:function(){var e=this.getTreeTbar(this);this.dockedItems=[e],this.store=JE.getStore({tableName:"JE_CORE_RESOURCETABLE",type:"tree",url:JE.getUrlMaps("je.core.resourceTable","getTree"),params:{whereSql:" AND SY_JESYS='1'"}}),this.selModel={selType:"treemodel",allowDeselect:!0},this.callParent(arguments)}}),Ext.define("JE.sys.table.view.trace.TableTraceGrid",{extend:"Ext.grid.Panel",alias:"widget.table.tabletracegrid",border:0,multiSelect:!0,frame:!1,cls:"pcatgrid",selModel:{injectCheckbox:1,selType:"checkboxmodel"},plugins:[{ptype:"rowexpander",rowBodyTpl:["<p>{TABLETRACE_XGNR}</p>"]}],enableKeyNav:!0,columnLines:!0,initComponent:function(){this.store=Ext.create("JE.sys.table.store.TableTraceStore"),this.dockedItems=[{xtype:"pagingtoolbar",store:this.store,dock:"bottom",displayInfo:!0}],this.columns=[{text:"主键",dataIndex:"JE_CORE_TABLETRACE_ID",hidden:!0},{xtype:"rownumberer",width:35,text:"No.",align:"center"},{text:"操作类型",dataIndex:"TABLETRACE_OPER"},{text:"操作对象",dataIndex:"TABLETRACE_TABLENAME"},{text:"表编码",dataIndex:"TABLETRACE_TABLECODE",width:200},{text:"操作人",dataIndex:"TABLETRACE_CZRNAME"},{text:"操作人编码",dataIndex:"TABLETRACE_CZRCODE"},{text:"操作时间",dataIndex:"TABLETRACE_CZSJ",width:150},{text:"是否应用",dataIndex:"TABLETRACE_SFYY",tactics:[{bgCss:!0,type:"dic",dicCode:"YESORNO"}],renderer:JE.renderer},{text:"资源表外键",dataIndex:"TABLETRACE_RESOURCEETABLE_ID",hidden:!0}],this.callParent(arguments)}}),Ext.define("JE.sys.table.view.trace.TableTraceView",{extend:"Ext.panel.Panel",alias:"widget.table.tabletraceview",layout:"fit",items:[{xtype:"table.tabletracegrid"}]}),Ext.define("JE.sys.table.controller.ResourceTableController",{extend:"Ext.app.Controller",init:function(){var b=this;b.copyTableInfo=null,b.displayTableInfo=null;var e={"[xtype=table.westview]":{selectionchange:function(e,t,i){var n=e.view.panel,a=t[0],l=n.up("panel[xtype=table.mainview]");if("DISPLAY"==l.modeType)return l.columnView.removeAll(),l.columnView.tables={},void(a?a.eachChild(function(e){"MODULE"==e.get("nodeInfo")?l.columnView.addColumns("module",e.data,!0,b.displayTableInfo):l.columnView.addColumns("table",e.data,!1,b.displayTableInfo)}):n.getRootNode().eachChild(function(e){"MODULE"==e.get("nodeInfo")?l.columnView.addColumns("module",e.data,!0,b.displayTableInfo):l.columnView.addColumns("table",e.data,!1,b.displayTableInfo)}));var o=l.down("panel[xtype=table.centerview]"),d=l.down("panel[ref=commentpanel]"),r=o.down("panel[xtype=table.tableform]"),c=o.down("panel[xtype=table.tablecolumngrid]"),s=o.down("panel[xtype=table.tablekeygrid]"),E=o.down("panel[xtype=table.tableindexgrid]"),f=o.down("panel[xtype=table.tabletracegrid]"),u=r.down("button[ref=planView]");r.down("button[ref=syncDbBtn]");if(a){var p,m=a.get("id"),x=a.get("nodeInfo"),g=JE.ajax({url:JE.getUrlMaps("je.core.resourceTable","getInfoById"),params:{tableCode:"JE_CORE_RESOURCETABLE",pkValue:m}});if(u.setVisible("VIEW"==x),b.setDisabled(c,s,E,"VIEW"==x,!Ext.isEmpty(g.RESOURCETABLE_SQL)),g.obj&&0==g.success)return void JE.alert("获取表信息失败!");if(o.isVisible()||(d.hide(),o.show()),"MODULE"==x)return void b.loadTableInfo(r,c,s,f,E,g);if("TREE"==x)(p=r.down("button[ref=syncPathBtn]"))&&p.show();else(p=r.down("button[ref=syncPathBtn]"))&&p.hide();g.RESOURCETABLE_ICONCLS!==a.get("iconCls")&&(a.set("iconCls",g.RESOURCETABLE_ICONCLS),a.commit()),b.loadTableInfo(r,c,s,f,E,g)}else d.show(),o.hide()}},"[xtype=table.westview] button[ref=tableIns] ":{click:function(e){var l=e.up("panel[xtype=table.westview]"),o=l.getSelectionModel().getSelection()[0];if("MODULE"==(o=o||l.getStore().getRootNode()).get("nodeInfo")||"ROOT"==o.get("id")){JE.formWin({title:"表添加",iconCls:"jeicon jeicon-general-table",defaults:{padding:"8 0 0 0"},items:[{xtype:"textfield",fieldLabel:"表名称",name:"tableName",EmptyText:"请输入表名称..",allowBlank:!1,columnWidth:1},{xtype:"textfield",fieldLabel:"表编码",name:"tableCode",allowBlank:!1,columnWidth:1,regex:"^[A-Z]{1}[A-Z_0-9]{1,29}$",regexText:"表编码由大写字母、下划线组成!"}],minWidth:330,minHeight:150,width:330,height:150,fn:function(e,t){var i=e.tableCode,n=JE.ajax({url:JE.getUrlMaps("je.core.resourceTable","checkTableCode"),params:{tableCode:"JE_CORE_RESOURCETABLE",RESOURCETABLE_TABLECODE:i}});if(!n.success)return JE.alert(n.obj),!1;var a={RESOURCETABLE_ICONCLS:"jeicon jeicon-general-table",RESOURCETABLE_TABLENAME:e.tableName,RESOURCETABLE_TABLECODE:i,RESOURCETABLE_ISCREATE:"0",RESOURCETABLE_TYPE:"PT",RESOURCETABLE_ISUSEFOREIGNKEY:"0",RESOURCETABLE_MOREROOT:"0",SY_LAYER:o.getDepth()+1,SY_PARENT:o.get("id"),SY_NODETYPE:"LEAF",SY_DISABLED:"0"};b.addNode({tree:l,parentNode:o,nodeObj:a,url:JE.getUrlMaps("je.core.resourceTable","doSave")})?JE.msg("表添加成功!"):JE.alert("表添加失败！")}})}else JE.alert("请为模块添加表！")}},"[xtype=table.westview] button[ref=tableTreeIns] ":{click:function(e){var l=e.up("panel[xtype=table.westview]"),o=l.getSelectionModel().getSelection()[0];if("MODULE"==(o=o||l.getStore().getRootNode()).get("nodeInfo")||"ROOT"==o.get("id")){JE.formWin({title:"树形表添加",iconCls:"jeicon jeicon-tree-table",defaults:{padding:"8 0 0 0"},items:[{xtype:"textfield",fieldLabel:"表名称",name:"tableName",EmptyText:"请输入表名称..",allowBlank:!1,columnWidth:1},{xtype:"textfield",fieldLabel:"表编码",name:"tableCode",allowBlank:!1,columnWidth:1,regex:"^[A-Z]{1}[A-Z_0-9]{1,29}$",regexText:"表编码由大写字母、下划线组成!"},{xtype:"rgroup",fieldLabel:"类型",name:"moreRoot",configInfo:"JE_TABLE_TREETYPE",value:"0",allowBlank:!1,columnWidth:1},{xtype:"displayfield",name:"remark",fieldStyle:{textAlign:"center"},value:"当功能为子功能使用的时候多为多根树形",columnWidth:1}],minWidth:330,minHeight:190,width:330,height:200,fn:function(e,t){var i=e.tableCode,n=JE.ajax({url:JE.getUrlMaps("je.core.resourceTable","checkTableCode"),params:{tableCode:"JE_CORE_RESOURCETABLE",RESOURCETABLE_TABLECODE:i}});if(!n.success)return JE.alert(n.obj),!1;var a={RESOURCETABLE_ICONCLS:"jeicon jeicon-tree-table",RESOURCETABLE_TABLENAME:e.tableName,RESOURCETABLE_TABLECODE:i,RESOURCETABLE_ISCREATE:"0",RESOURCETABLE_TYPE:"TREE",RESOURCETABLE_ISUSEFOREIGNKEY:"0",RESOURCETABLE_MOREROOT:e.moreRoot,SY_LAYER:o.getDepth()+1,SY_PARENT:o.get("id"),SY_NODETYPE:"LEAF",SY_DISABLED:"0"};b.addNode({tree:l,parentNode:o,nodeObj:a,url:JE.getUrlMaps("je.core.resourceTable","doSave")})?JE.msg("树形表添加成功!"):JE.alert("树形表添加失败！")}})}else JE.alert("请为模块添加表！")}},"panel[xtype=table.westview] button[ref=tablePaste]":{click:function(e){var a=e.up("panel[xtype=table.westview]"),l=a.getSelectionModel().getSelection()[0];"MODULE"==(l=l||a.getStore().getRootNode()).get("nodeInfo")||"ROOT"==l.get("id")?b.copyTableInfo?JE.prompt("请输入表编码",function(e,n){if("cancel"!=e&&!Ext.isEmpty(n)){var t=JE.ajax({url:JE.getUrlMaps("je.core.resourceTable","checkTableCode"),params:{tableCode:"JE_CORE_RESOURCETABLE",RESOURCETABLE_TABLECODE:n}});t.success?JE.confirm("是否使用新表前缀...",function(e,t){var i=b.copyTableInfo;i.newTableCode=n,i.SY_PARENT=l.get("id"),i.SY_LAYER=l.getDepth()+1,i.SY_NODETYPE="LEAF",i.SY_DISABLED="0","ok"==e&&(i.useNewName="1"),b.addNode({tree:a,parentNode:l,nodeObj:i,url:JE.getUrlMaps("je.core.resourceTable","pasteTable")})?JE.msg("表粘贴成功!"):JE.alert("表粘贴失败！"),b.copyTableInfo=null},"消息","使用","不使用"):JE.alert(t.obj)}},"将"+b.copyTableInfo.RESOURCETABLE_TABLENAME+"("+b.copyTableInfo.RESOURCETABLE_TABLECODE+")进行粘贴操作"):JE.alert("剪切板为空，请复制表!"):JE.alert("请为模块粘贴表！")}},"[xtype=table.westview] button[ref=moduleIns]":{click:function(o){JE.prompt("请输入模块名称",function(e,t){if("cancel"!=e&&!Ext.isEmpty(t)){var i=JE.toPinYin(t,"PY"),n=o.up("panel[xtype=table.westview]"),a=n.getSelectionModel().getSelection()[0],l={RESOURCETABLE_TABLENAME:t,RESOURCETABLE_TABLECODE:i,RESOURCETABLE_ISCREATE:"0",RESOURCETABLE_TYPE:"MODULE",RESOURCETABLE_ISUSEFOREIGNKEY:"0",RESOURCETABLE_MOREROOT:"0",SY_LAYER:(a=a||n.getStore().getRootNode()).getDepth()+1,SY_PARENT:a.get("id"),SY_NODETYPE:"GENERAL",SY_DISABLED:"1",SY_JESYS:"1",SY_JECORE:"0"};b.addNode({tree:n,parentNode:a,nodeObj:l,url:JE.getUrlMaps("je.core.save")})?JE.msg("模块添加成功!"):JE.alert("模块添加失败！")}})}},"[xtype=table.westview] button[ref=tableViewIns]":{click:function(e){var o=e.up("panel[xtype=table.westview]"),d=o.getSelectionModel().getSelection()[0];"MODULE"==(d=d||o.getStore().getRootNode()).get("nodeInfo")||"ROOT"==d.get("id")?JE.win({title:"视图添加",autoShow:!0,useButton:!0,items:[{xtype:"table.tvmainview",border:0}],fn:function(n){function a(e,t,i){var n=JE.ajax({url:JE.getUrlMaps("je.core.resourceTable","checkTableCode"),params:{tableCode:"JE_CORE_RESOURCETABLE",RESOURCETABLE_TABLECODE:e.tableCode}});if(!n.success)return JE.alert(n.obj),!1;var a={tableCode:"JE_CORE_RESOURCETABLE",RESOURCETABLE_TABLENAME:e.tableName,RESOURCETABLE_TABLECODE:e.tableCode,RESOURCETABLE_SQL:e.sql,RESOURCETABLE_ICONCLS:"jeicon jeicon-view",RESOURCETABLE_ISCREATE:"1",RESOURCETABLE_TYPE:"VIEW",RESOURCETABLE_ISUSEFOREIGNKEY:"0",RESOURCETABLE_MOREROOT:"0",SY_LAYER:t.getDepth()+1,SY_PARENT:t.get("id"),SY_NODETYPE:"LEAF",SY_DISABLED:"0",fields:Ext.encode(e.fields)};return null!=b.addNode({tree:i,url:JE.getUrlMaps("je.core.resourceTable","createView"),nodeObj:a,parentNode:t})||(JE.alert("视图创建失败!"),!1)}var l=n.down("panel[xtype=table.tvmainview]").getValues();if(Ext.isEmpty(l.tableCode))return JE.alert("视图名称不能为空!"),!1;if(Ext.isEmpty(l.tableCode))return JE.alert("视图编码不能为空!"),!1;if(Ext.isEmpty(l.sql))return JE.alert("查询SQL不能为空!"),!1;var t=[];return Ext.each(l.fields,function(e){"ID"==e.dataType&&t.push({id:e.code,code:e.code,text:e.code})}),0==t.length?(JE.alert("请设置一个值唯一字段为主键！"),!1):1<t.length?(JE.formWin({title:"选择主键",width:400,height:150,autoShow:!0,items:[{xtype:"rgroup",columns:2,name:"idField",dataArray:t,value:t[0].code}],fn:function(e,t){var i=e.idField;Ext.each(l.fields,function(e){"ID"==e.dataType&&(e.code!=i?(e.dataType="VARCHAR",e.length="50"):e.length="")}),0!=a(l,d,o)&&n.close()}}),!1):a(l,d,o)}}):JE.alert("请为模块添加视图！")}},"[xtype=table.westview] button[ref=delete]":{click:function(e){var a=e.up("panel[xtype=table.westview]"),l=a.getSelectionModel().getSelection()[0],t=a.up("panel[xtype=table.mainview]"),o=t.down("panel[xtype=table.centerview]"),d=t.down("panel[ref=commentpanel]"),r=o.down("panel[xtype=table.tableform]"),c=o.down("panel[xtype=table.tablecolumngrid]"),s=o.down("panel[xtype=table.tablekeygrid]"),E=o.down("panel[xtype=table.tableindexgrid]"),f=o.down("panel[xtype=table.tabletracegrid]");if(l){var i=l.get("nodeInfo"),n="是否删除模块...";"VIEW"==i&&(n="该操作不会删除视图结构,是否继续...."),"PT"!=i&&"TREE"!=i||(n="该操作不会删除表结构，是否继续...."),JE.confirm(n,function(e,t){if("ok"==e){if(l.hasChildNodes())return void JE.alert("请删除该模块的表信息!");var i=l.get("id"),n=JE.ajax({url:JE.getUrlMaps("je.core.resourceTable","doRemove"),params:{tableCode:"JE_CORE_RESOURCETABLE",ids:i}});n.success?(JE.msg(n.obj),o.hide(),d.show(),a.getStore().getNodeById(i).remove(),b.loadTableInfo(r,c,s,f,E,{})):alert(n.obj)}})}else JE.alert("请选中要删除的节点！")}},"[xtype=table.westview] button[ref=physicsRemove]":{click:function(e){var a=e.up("panel[xtype=table.westview]"),l=a.getSelectionModel().getSelection()[0],t=a.up("panel[xtype=table.mainview]"),o=t.down("panel[xtype=table.centerview]"),d=t.down("panel[ref=commentpanel]"),r=o.down("panel[xtype=table.tableform]"),c=o.down("panel[xtype=table.tablecolumngrid]"),s=o.down("panel[xtype=table.tablekeygrid]"),E=o.down("panel[xtype=table.tableindexgrid]"),f=o.down("panel[xtype=table.tabletracegrid]");if(l){var i=l.get("nodeInfo");if("MODULE"!=i){var n="该操作会删除视图结构,是否继续...";"PT"!=i&&"TREE"!=i||(n="该操作会删除表结构，是否继续...."),JE.confirm(n,function(e,t){if("ok"==e){if(l.hasChildNodes())return void JE.alert("请删除该模块的表信息!");var i=l.get("id"),n=JE.ajax({url:JE.getUrlMaps("je.core.resourceTable","physicsRemove"),params:{tableCode:"JE_CORE_RESOURCETABLE",ids:i}});n.success?(JE.msg(n.obj),o.hide(),d.show(),a.getStore().getNodeById(i).remove(),b.loadTableInfo(r,c,s,f,E,{})):alert(n.obj)}})}else JE.alert("无法物理删除模块!")}else JE.alert("请选中要删除的节点！")}},"[xtype=table.westview] button[ref=impTable]":{click:function(e){var t=e.up("panel[xtype=table.westview]"),i=t.getSelectionModel().getSelection()[0];"MODULE"==(i=i||t.getStore().getRootNode()).get("nodeInfo")?b.imp(t,i,{iconCls:"jeicon jeicon-general-table",tableType:"PT",msg:"请输入表编码"}):JE.alert("请选择模块！")}},"[xtype=table.westview] button[ref=impView]":{click:function(e){var t=e.up("panel[xtype=table.westview]"),i=t.getSelectionModel().getSelection()[0];"MODULE"==(i=i||t.getStore().getRootNode()).get("nodeInfo")?b.imp(t,i,{iconCls:"jeicon jeicon-view",tableType:"VIEW",msg:"请输入视图编码"}):JE.alert("请选择模块！")}},"[xtype=table.westview] button[ref=sql]":{click:function(e){var t=e.up("panel[xtype=table.westview]").getSelectionModel().getSelection()[0];if(t){var i=t.get("nodeInfo");if("MODULE"!=i)if("PT"==i||"TREE"==i){var n=t.get("id"),a=JE.ajax({url:JE.getUrlMaps("je.core.resourceTable","sql"),params:{tableCode:"JE_CORE_RESOURCETABLE",pkValue:n,type:e.sqlType}});a.success?(JE.win({title:"SQL语句",width:JE.getBodyWidth()-100,height:JE.getBodyHeight()-100,layout:"fit",items:[{xtype:"textarea",autoScroll:!0,value:a.obj.sql}]}).show(),JE.msg("SQL生成成功")):alert(a.obj)}else JE.alert("视图无法生成SQL!");else JE.alert("模块无法生成SQL!")}else JE.alert("请选中表数据！")}},"[xtype=table.westview] button[ref=tableInfo]":{click:function(e){JE.formWin({title:"导出表结构",width:600,height:310,border:0,frame:!0,autoShow:!0,formConfig:{bodyPadding:"10 10 0 10"},formDefaults:{},items:[{xtype:"textfield",name:"title",allowBlank:!1,fieldLabel:"标题"},{xtype:"textfield",name:"fileName",allowBlank:!1,fieldLabel:"文件名称"},{xtype:"rgroup",name:"type",fieldLabel:"类型",value:"TABLES",dataArray:[{id:"TABLES",text:"指定表",code:"TABLES"}]},{xtype:"gridssareafield",name:"tableName",fieldLabel:"表信息",configInfo:"JE_CORE_RESOURCETABLE,tableName~whereSql,RESOURCETABLE_TABLENAME~RESOURCETABLE_TABLECODE,M",whereSql:" "},{xtype:"hidden",name:"whereSql",fieldLabel:"表编码"}],fn:function(e,t){var i={title:e.title,fileName:e.fileName,whereSql:e.whereSql,type:e.type},n=JE.ajax({url:JE.getUrlMaps("je.core.db","expDbExcel"),params:i});n.success?window.open(n.obj):JE.alert(n.obj)},showFn:function(e){var t=e.down("form"),i={title:"系统表结构信息",fileName:"系统表结构信息_"+JE.DATE.formatDate(new Date)+".xls"};t.form.setValues(i)}})}},"[xtype=table.westview] button[ref=collapseAll]":{click:function(e){e.up("panel[xtype=table.westview]").collapseAll()}},"[xtype=table.westview] button[ref=doStaticize]":{click:function(e){var t=JE.ajax({url:JE.getUrlMaps("je.core.resourceTable","clearTableAllCache")});t.success?JE.msg("表结构已重新静态化!"):JE.alert(t.obj)}},"panel[xtype=table.tableform] button[ref=save]":{click:function(e){var t=e.up("panel[xtype=table.mainview]");t=t||e.up("window");var i=e.up("panel[xtype=table.tableform]"),n=t.down("panel[xtype=table.centerview]"),l=n.down("panel[xtype=table.tablecolumngrid]"),o=n.down("panel[xtype=table.tablekeygrid]"),d=n.down("panel[xtype=table.tabletracegrid]"),r=t.down("panel[xtype=table.westview]"),a=i.getForm(),c=a.findField("JE_CORE_RESOURCETABLE_ID").getValue(),s=Ext.isEmpty(c)?"doSave":"doUpdate",E=l.down("button[ref=gridSave]");if(E){var f=!1;l.store.each(function(e){JE.isNotEmpty(e.getChanges())&&(f=!0)}),f&&E.fireHandler()}a.submit({url:JE.getUrlMaps("je.core.resourceTable",s),params:{tableCode:"JE_CORE_RESOURCETABLE"},submitEmptyText:!0,success:function(e,t){var i=t.result.obj;if(t.result.success){var n=i.JE_CORE_RESOURCETABLE_ID;if(r){var a=r.getStore().getNodeById(n);a.set("text",i.RESOURCETABLE_TABLENAME),a.set("code",i.RESOURCETABLE_TABLECODE),a.set("iconCls",i.RESOURCETABLE_ICONCLS),a.set("leaf","LEAF"==i.SY_NODETYPE),a.set("nodePath",i.SY_PATH),a.set("nodeInfo",i.RESOURCETABLE_TYPE),a.set("nodeInfoType",i.RESOURCETABLE_NODEINFOTYPE),a.commit()}l.getStore().loadPage(1),o.getStore().loadPage(1),d.getStore().loadPage(1),JE.msg("数据保存成功!")}else JE.alert(i)}})}},"panel[xtype=table.tableform] button[ref=apply]":{click:function(e){var t=e.up("panel[xtype=table.mainview]");t=t||e.up("window");var i=e.up("panel[xtype=table.tableform]").getForm(),n=i.findField("JE_CORE_RESOURCETABLE_ID").getValue(),a=i.findField("RESOURCETABLE_ISCREATE").getValue(),l=i.findField("RESOURCETABLE_TYPE").getValue(),o=i.findField("RESOURCETABLE_TABLECODE").getValue(),d=i.findField("RESOURCETABLE_OLDTABLECODE").getValue();if("MODULE"!=l)if("VIEW"!=l){if(o!=d)if(!JE.ajax({url:JE.getUrlMaps("je.core.resourceTable","checkTableCode"),params:{tableCode:"JE_CORE_RESOURCETABLE",RESOURCETABLE_TABLECODE:o}}).success)return void JE.alert("该表编码已经被使用，请更换表编码！");var r=JE.ajax({url:JE.getUrlMaps("je.core.resourceTable","applyTable"),params:{tableCode:"JE_CORE_RESOURCETABLE",pkValue:n,RESOURCETABLE_ISCREATE:a}});if(r.success){var c=t.down("panel[xtype=table.westview]");if(c){var s=c.getSelectionModel().getSelection()[0];c.fireEvent("selectionchange",c.getSelectionModel(),[s])}JE.alert(r.obj)}else JE.alert(r.obj)}else JE.alert("视图无法应用!");else JE.alert("模块无法应用!")}},"panel[xtype=table.tableform] button[ref=clearCache]":{click:function(e){e.up("panel[xtype=table.mainview]");var t=e.up("panel[xtype=table.tableform]").getForm(),i=t.findField("RESOURCETABLE_TABLECODE").getValue();if("MODULE"!=t.findField("RESOURCETABLE_TYPE").getValue()){var n=JE.ajax({url:JE.getUrlMaps("je.core.resourceTable","clearTableCache"),params:{tableCode:"JE_CORE_RESOURCETABLE",RESOURCETABLE_TABLECODE:i}});n.success?JE.msg("缓存清除成功"):JE.alert(n.obj)}else JE.alert("模块无法清除!")}},"panel[xtype=table.tableform] button[ref=planView]":{click:function(e){var t=e.up("panel[xtype=table.mainview]");t=t||e.up("window");var i=e.up("panel[xtype=table.tableform]"),o=t.down("panel[xtype=table.westview]"),d=null,n=i.form.getValues(),s={};s.tableCode=n.RESOURCETABLE_TABLECODE,s.tableName=n.RESOURCETABLE_TABLENAME,s.sql=n.RESOURCETABLE_SQL,s.tableId=n.JE_CORE_RESOURCETABLE_ID,s.fields=[],o&&(d=o.getStore().getNodeById(s.tableId)),Ext.isEmpty(s.sql)?JE.alert("导入的视图无法规划!"):JE.win({title:"视图修改",autoShow:!0,useButton:!0,items:[{xtype:"table.tvmainview"}],fn:function(n){function a(e,t,i){var n={tableCode:"JE_CORE_RESOURCETABLE",JE_CORE_RESOURCETABLE_ID:e.tableId,RESOURCETABLE_TABLENAME:e.tableName,RESOURCETABLE_TABLECODE:e.tableCode,RESOURCETABLE_SQL:e.sql,fields:Ext.encode(e.fields)},a=JE.ajax({url:JE.getUrlMaps("je.core.resourceTable","updateView"),params:n});if(a.success){var l=a.obj;return o&&t&&(t.set("text",l.RESOURCETABLE_TABLENAME),t.set("code",l.RESOURCETABLE_TABLECODE),o.fireEvent("selectionchange",i.getSelectionModel(),[t])),JE.msg("视图更新成功!"),!0}return JE.alert("视图更新失败!"),!1}var l=n.down("panel[xtype=table.tvmainview]").getValues();if(!l)return!1;if(Ext.isEmpty(l.tableCode))return JE.alert("视图名称不能为空!"),!1;if(Ext.isEmpty(l.sql))return JE.alert("查询SQL不能为空!"),!1;var t=[];return Ext.each(l.fields,function(e){"ID"==e.dataType&&t.push({id:e.code,code:e.code,text:e.code})}),0==t.length?(JE.alert("请设置一个值唯一字段为主键！"),!1):1<t.length?(JE.formWin({title:"选择主键",width:400,height:150,autoShow:!0,formConfig:{bodyStyle:{background:"#f1f1f1"},bodyPadding:"4 8 0 8",frame:!1},items:[{xtype:"rgroup",name:"idField",columns:2,dataArray:t,value:t[0].code}],fn:function(e,t){var i=e.idField;Ext.each(l.fields,function(e){"ID"==e.dataType&&(e.code!=i?(e.dataType="VARCHAR",e.length="50"):e.length="")}),0!=a(l,d,o)&&n.close()}}),!1):a(l,d,o)},showFn:function(e){var d=e.down("panel[xtype=table.tvmainview]"),r=e.down("panel[xtype=table.tvtableview]");d.down("textfield[name=tableCode]").setReadOnly(!0);var t=JE.ajax({url:JE.getUrlMaps("je.core.tableColumn","load"),params:{tableCode:"JE_CORE_TABLECOLUMN",whereSql:" AND TABLECOLUMN_RESOURCETABLE_ID='"+s.tableId+"'",limit:-1}}),c=new Array;Ext.each(t.rows,function(e){var t=e.TABLECOLUMN_VIEWCONFIG,i={id:e.JE_CORE_TABLECOLUMN_ID,code:e.TABLECOLUMN_CODE,name:e.TABLECOLUMN_NAME,dataType:e.TABLECOLUMN_TYPE,length:e.TABLECOLUMN_LENGTH};if(!Ext.isEmpty(t)){var n=JE.toObj(t);i.value=n.value,i.table=n.table,i.formula=n.formula,i.group=n.group,i.order=n.order,i.whereValue=n.whereValue,-1==c.indexOf(i.table)&&c.push(i.table)}s.fields.push(i)}),r.on("load",function(e,t,i,n,a){var l=e.getRootNode();Ext.each(c,function(e){var t=l.findChild("code",e,!0);t&&r.fireEvent("itemdblclick",r.getView(),t)});var o=d.columnView.query("grid");Ext.each(o,function(n){n.getStore().on("load",function(e,t){var i=[];Ext.each(s.fields,function(t){Ext.isEmpty(t.table)||n.itemId=="table."+t.table&&e.each(function(e){e.get("TABLECOLUMN_CODE")==t.code&&(t.dataType=e.get("TABLECOLUMN_TYPE"),t.length=e.get("TABLECOLUMN_LENGTH"),t.name=e.get("TABLECOLUMN_NAME"),i.push(e))})}),0<i.length&&n.getSelectionModel().select(i,!1,!0)})})}),d.setValues(s)}})}},"panel[xtype=table.tableform] button[ref=syncDbBtn]":{click:function(d){JE.confirm("<font color='red'>此次同步会将资源表的列类型按照数据库类型同步!<br/>一般使用场景是在用于导入表/视图</font>!<br/>同步后类型要做简单的调整!【慎重操作】<br> ",function(e,t){if("ok"==e){var i=d.up("panel[xtype=table.mainview]"),n=d.up("panel[xtype=table.tableform]"),a=null;i&&(a=i.down("panel[xtype=table.westview]"));var l=n.form.getValues();l.tableCode="JE_CORE_RESOURCETABLE";if(("VIEW"==l.RESOURCETABLE_TYPE?JE.ajax({url:JE.getUrlMaps("je.core.resourceTable","syncView"),params:l}):JE.ajax({url:JE.getUrlMaps("je.core.resourceTable","syncTable"),params:l})).success){if(a){var o=a.getStore().getNodeById(l.JE_CORE_RESOURCETABLE_ID);a.fireEvent("selectionchange",a.getSelectionModel(),[o])}JE.msg("同步成功，列名请手工修改！")}else JE.alert("同步失败，请联系管理员!")}})}},"panel[xtype=table.tableform] button[ref=upTag]":{click:function(e){var t=e.up("panel[xtype=table.tableform]").form.getValues().JE_CORE_RESOURCETABLE_ID;if(JE.isEmpty(t))JE.alert("资源表ID为空!");else{var i=new Array;i.push(t);var n=JE.ajax({url:"/je/upgrade/doAddUpTag",params:{type:"TABLE",ids:i.join(",")}});n.success?JE.msg(n.obj):JE.alert(n.obj)}}},"panel[xtype=table.tableform] button[ref=displayMode]":{click:function(e){var t=e.up("panel[xtype=table.mainview]");t.modeType="DISPLAY",b.displayTableInfo||b.initDisplayInfo();var i=t.down("panel[xtype=table.westview]"),n=i.getDockedItems("toolbar[dock=right]")[0],a=t.down("panel[xtype=table.centerview]"),l=t.down("panel[ref=commentpanel]"),o=t.down("panel[ref=dptablepanel]"),d=i.getSelectionModel(),r=d.getSelection();d.allowDeselect=!1,a.hide(),l.hide(),n.hide(),o.show(),i.fireEvent("selectionchange",d,r)}},"panel[xtype=table.tableform] button[ref=syncPathBtn]":{click:function(e){e.up("panel[xtype=table.mainview]");var i=e.up("panel[xtype=table.tableform]").form.findField("RESOURCETABLE_TABLECODE").getValue();JE.confirm("<font color='red'>该操作会从树形结构表从根节点ROOT开始递归，<br/>将层次，路径，父节点路径，节点类型，排序字段更新为正确值!</font>",function(e,t){"ok"==e&&JE.formWin({title:"更新树形数据准确性",height:151,items:[{xtype:"textfield",fieldLabel:"表名",allowBlank:!1,name:"tableCode",value:i},{xtype:"textfield",fieldLabel:"主键名",allowBlank:!1,name:"pkCode",value:i+"_ID"},{xtype:"textfield",fieldLabel:"字段前缀",name:"preFix",value:"SY_"}],fn:function(e,t){if(JE.isEmpty(e.tableCode))return JE.alert("请输入表名!"),!1;if(JE.isEmpty(e.tableCode))return JE.alert("请输入主键名!"),!1;var i=JE.ajax({url:JE.getUrlMaps("je.core.resourceTable","syncTreePath"),params:e});i.success?JE.msg("树形数据的路径，层次，排序字段都已更新！"):JE.alert(i.obj)}})})}},"panel[xtype=table.mainview] panel[ref=dptablepanel] button[ref=editMode]":{click:function(e){var t=e.up("panel[xtype=table.mainview]");t.modeType="TABLE";var i=t.down("panel[xtype=table.westview]"),n=i.getDockedItems("toolbar[dock=right]")[0],a=t.down("panel[xtype=table.centerview]"),l=(t.down("panel[ref=commentpanel]"),t.down("panel[ref=dptablepanel]"));a.show();var o=i.getSelectionModel(),d=o.getSelection();o.allowDeselect=!0,i.fireEvent("selectionchange",o,d),n.show(),l.hide()}},"panel[xtype=table.mainview] panel[ref=dptablepanel] button[ref=savePlan]":{click:function(e){var t=e.up("panel[xtype=table.mainview]"),n=new Array;if(Ext.each(t.columnView.query("panel[ref=displaypanel]"),function(e){var t=e.infoData,i={TABLEDISPLAY_TABLECODE:t.code,TABLEDISPLAY_TABLENAME:t.text,TABLEDISPLAY_TABLE_ID:t.id,TABLEDISPLAY_TYPE:t.type,TABLEDISPLAY_X:e.x,TABLEDISPLAY_Y:e.y,TABLEDISPLAY_WIDTH:e.width,TABLEDISPLAY_HEIGHT:e.height};b.displayTableInfo[t.id]&&(i.JE_CORE_TABLEDISPLAY_ID=b.displayTableInfo[t.id].id),n.push(i)}),0<n.length){var i=JE.ajax({url:JE.getUrlMaps("je.core.insertUpdateList"),params:{tableCode:"JE_CORE_TABLEDISPLAY",strData:Ext.encode(n)}});i.success?(Ext.each(i.obj,function(e){b.displayTableInfo[e.TABLEDISPLAY_TABLE_ID]={id:e.JE_CORE_TABLEDISPLAY_ID,x:e.TABLEDISPLAY_X,y:e.TABLEDISPLAY_Y,width:e.TABLEDISPLAY_WIDTH,height:e.TABLEDISPLAY_HEIGHT}}),JE.msg("保存成功")):JE.alert(i.obj)}else JE.msg("保存成功")}},"panel[xtype=table.tableform] button[ref=tableCopy]":{click:function(e){e.up("panel[xtype=table.mainview]"),e.up("panel[xtype=table.westview]");var t=e.up("panel[xtype=table.tableform]").getForm(),i=t.findField("JE_CORE_RESOURCETABLE_ID").getValue(),n=t.findField("RESOURCETABLE_TABLECODE").getValue(),a=t.findField("RESOURCETABLE_TABLENAME").getValue(),l=t.findField("RESOURCETABLE_TYPE").getValue();"MODULE"!=l?"VIEW"!=l?(b.copyTableInfo={JE_CORE_RESOURCETABLE_ID:i,RESOURCETABLE_TABLECODE:n,RESOURCETABLE_TABLENAME:a},JE.msg(a+"("+n+")已放入剪切板!")):JE.alert("视图无法复制!"):JE.alert("模块无法复制!")}},"panel[xtype=table.tableform] field[name=RESOURCETABLE_TABLECODE]":{blur:function(e,t,i){var n=e.getValue(),a=e.up("panel[xtype=table.tableform]").getForm();if("1"==a.findField("RESOURCETABLE_ISCREATE").getValue()){var l=a.findField("RESOURCETABLE_OLDTABLECODE").getValue();if(!Ext.isEmpty(l)&&l!=n)JE.ajax({url:JE.getUrlMaps("je.core.resourceTable","checkTableCode"),params:{tableCode:"JE_CORE_RESOURCETABLE",RESOURCETABLE_TABLECODE:n}}).success||(alert(n+"已经存在，请更换表编码！"),e.focus())}}},"panel[xtype=table.tableform] cbbfield[name=RESOURCETABLE_ISCREATE]":{change:function(e,t,i){var n=e.up("panel[xtype=table.tableform]");n.form.findField("RESOURCETABLE_TABLECODE").setReadOnly("1"==t),n.getDockedCmp("btnBar").getCmp("isCreate").update("1"==t?",已创建":"")}},"panel[xtype=table.tableform] field[name=RESOURCETABLE_TYPE]":{change:function(e,t,i){var n=e.up("panel[xtype=table.tableform]"),a=n.form;Ext.isEmpty(t)||(a.findField("SY_NODETYPE").setValue("MODULE"==t?"GENERAL":"LEAF"),n.getDockedCmp("btnBar").getCmp("tableType").update(" 类型："+e.getText(t)))}},"panel[xtype=table.tableform] field[name=RESOURCETABLE_USEFUNC]":{change:function(e,t,i){if(!Ext.isEmpty(t)&&-1==t.indexOf("<a")){var n=new Array;Ext.each(t.split(","),function(e){var t=e.split("~");n.push("<a href=\"javascript:void(0)\" class='je_funcinfo_click' onclick=\"javascript:JE.showFuncCfg('"+t[0]+"','main','"+t[1]+"');\">"+t[2]+"("+t[1]+")</a>")}),e.setValue(n.join(","))}}},"panel[xtype=table.tablecolumngrid] button[ref=gridInsert]":{click:function(e){var t=e.up("panel[xtype=table.tablecolumngrid]"),i=e.up("panel[xtype=table.centerview]"),n=i.down("panel[xtype=table.tableform]"),a=i.down("panel[xtype=table.tabletracegrid]"),l=n.getForm(),o=l.findField("JE_CORE_RESOURCETABLE_ID").getValue(),d=l.findField("RESOURCETABLE_TABLECODE").getValue(),r=t.getStore(),c=t.editing,s=1;(E=JE.ajax({url:JE.getUrlMaps("je.core.tableColumn","findColumnCount"),params:{tableCode:"JE_CORE_TABLECOLUMN",TABLECOLUMN_RESOURCETABLE_ID:o}})).success&&(s=1*E.obj);var E,f=r.model,u={tableCode:"JE_CORE_TABLECOLUMN",TABLECOLUMN_TYPE:"VARCHAR255",TABLECOLUMN_ISNULL:"1",TABLECOLUMN_CLASSIFY:"PRO",TABLECOLUMN_UNIQUE:"0",TABLECOLUMN_ISCREATE:"0",TABLECOLUMN_TREETYPE:"NORMAL",SY_ORDERINDEX:s,TABLECOLUMN_TABLECODE:d,TABLECOLUMN_RESOURCETABLE_ID:o};if((E=JE.ajax({url:JE.getUrlMaps("je.core.tableColumn","doSave"),params:u})).success){a.getStore().load();var p=new f(E.obj);c.cancelEdit(),r.insert(0,p),p.commit(),c.startEditByPosition({row:0,column:3});var m="";if(-1!=d.indexOf("_")){var x=d.lastIndexOf("_");m=x==d.length-1?"":d.substring(x+1,d.length)+"_"}else m=d+"_";p.set("TABLECOLUMN_CODE",m),JE.msg("添加成功!")}else alert(E.obj)}},"panel[xtype=table.tablecolumngrid] button[ref=gridDelete]":{click:function(e){var n=e.up("panel[xtype=table.tablecolumngrid]"),t=e.up("panel[xtype=table.centerview]"),i=t.down("panel[xtype=table.tableform]"),a=t.down("panel[xtype=table.tabletracegrid]"),l=i.getForm().findField("RESOURCETABLE_TABLECODE").getValue(),o=n.getSelectionModel().getSelection();0<o.length?JE.confirm("是否删除数据?",function(e){if("ok"==e){var i=new Array;Ext.each(o,function(e){var t=e.get("JE_CORE_TABLECOLUMN_ID");i.push(t),e.get("TABLECOLUMN_CLASSIFY")});var t=JE.ajax({url:JE.getUrlMaps("je.core.tableColumn","removeColumn"),params:{ids:i.join(","),tableCode:"JE_CORE_TABLECOLUMN",TABLECOLUMN_TABLECODE:l}});t.success?(n.getStore().load(),a.getStore().load(),JE.msg(t.obj)):alert(t.obj)}}):JE.alert("请选择要删除的数据!")}},"panel[xtype=table.tablecolumngrid]":{render:function(e){e.getStore().on("update",function(e,t,i,n){if("edit"==i&&!Ext.isEmpty(t.modified.TABLECOLUMN_UNIQUE)){t.get("TABLECOLUMN_TABLECODE");var a=t.get("TABLECOLUMN_TYPE");if("1"!=t.get("TABLECOLUMN_UNIQUE"))return;"CLOB"==a?(JE.alert("大文本类型不允许添加唯一性约束!"),t.set("TABLECOLUMN_UNIQUE","0")):"YESORNO"==a&&(JE.alert("是否类型不允许唯一性约束!"),t.set("TABLECOLUMN_UNIQUE","0"))}})},beforeedit:function(e,t,i){e.context.record.get("TABLECOLUMN_CLASSIFY")},edit:function(r,e,t){if("TABLECOLUMN_NAME"==r.context.column.dataIndex){var i=r.editors.items[0].field;if(!i.oned){i.on("change",function(e,t,i){var n=r.context.record,a=n.get("TABLECOLUMN_TABLECODE"),l=n.get("TABLECOLUMN_ISCREATE");if(!Ext.isEmpty(t)&&!Ext.isEmpty(a)&&"1"!=l){var o="";if(-1!=a.indexOf("_")){var d=a.lastIndexOf("_");o=d==a.length-1?"":a.substring(d+1,a.length)+"_"}else o=a+"_";n.set("TABLECOLUMN_CODE",o+JE.toPinYin(t,"PY"))}});var n=i.getValue();i.fireEvent("change",i,n,""),i.oned=!0}}}},"panel[xtype=table.tablecolumngrid] button[ref=gridSave]":{click:function(e){var t=e.up("panel[xtype=table.tablecolumngrid]"),i=e.up("panel[xtype=table.centerview]").down("panel[xtype=table.tabletracegrid]"),n=t.getStore().getUpdatedRecords();if(0<n.length){var a=new Array;Ext.each(n,function(e){var t=e.getChanges();t.JE_CORE_TABLECOLUMN_ID=e.get("JE_CORE_TABLECOLUMN_ID"),a.push(t)});var l=Ext.encode(a),o=JE.ajax({url:JE.getUrlMaps("je.core.tableColumn","doUpdateList"),params:{tableCode:"JE_CORE_TABLECOLUMN",strData:l}});o.success?(JE.msg(o.obj),i.getStore().load(),Ext.each(n,function(e){e.commit()})):alert(o.obj)}else JE.msg("0条记录已更新！")}},"panel[xtype=table.tablecolumngrid] button[ref=addFieldSet] menuitem[ref=addCascadeField]":{click:function(e){var t=e.up("panel[xtype=table.tablecolumngrid]"),i=e.up("panel[xtype=table.centerview]").down("panel[xtype=table.tableform]").getForm(),n=i.findField("JE_CORE_RESOURCETABLE_ID").getValue(),a=i.findField("RESOURCETABLE_TYPE").getValue();if(Ext.isEmpty(n))JE.alert("请选保存表的数据");else if("MODULE"!=a&&"VIEW"!=a){var l=i.findField("RESOURCETABLE_TABLECODE").getValue();0<=l.lastIndexOf("_")&&(l=l.substring(l.lastIndexOf("_")+1)),JE.win({title:"级联字典辅助",autoShow:!0,width:607,height:500,items:{xtype:"tablecolumn.cascadefieldform",tableCode:l,pkValue:n,fn:function(e){t.getStore().loadPage(1)}}})}else JE.alert("该类型不可以添加字段!")}},"panel[xtype=table.tablecolumngrid] button[ref=addFieldSet] menuitem[ref=addDDField]":{click:function(e){var t=e.up("panel[xtype=table.tablecolumngrid]"),i=e.up("panel[xtype=table.centerview]").down("panel[xtype=table.tableform]").getForm(),n=i.findField("JE_CORE_RESOURCETABLE_ID").getValue(),a=i.findField("RESOURCETABLE_TYPE").getValue();if(Ext.isEmpty(n))JE.alert("请选保存表的数据");else if("MODULE"!=a&&"VIEW"!=a){var l=i.findField("RESOURCETABLE_TABLECODE").getValue();0<=l.lastIndexOf("_")&&(l=l.substring(l.lastIndexOf("_")+1)),Ext.create("JE.sys.table.view.column.DictionaryFieldWin",{tableCode:l,tablePk:n,fn:function(e){t.getStore().loadPage(1)}})}else JE.alert("该类型不可以添加字段!")}},"panel[xtype=table.tablecolumngrid] button[ref=addFieldSet] menuitem[ref=addTableField]":{click:function(e){var i=e.up("panel[xtype=table.tablecolumngrid]"),t=e.up("panel[xtype=table.centerview]"),n=t.down("panel[xtype=table.tablekeygrid]"),a=t.down("panel[xtype=table.tableform]").getForm(),l=a.findField("JE_CORE_RESOURCETABLE_ID").getValue(),o=a.findField("RESOURCETABLE_TYPE").getValue();if(Ext.isEmpty(l))JE.alert("请选保存表的数据");else if("MODULE"!=o&&"VIEW"!=o){var d=a.findField("RESOURCETABLE_TABLECODE").getValue();Ext.create("JE.sys.table.view.column.TableFieldWin",{tableCode:d,tablePk:l,fn:function(e,t){"1"==t&&n.getStore().loadPage(1),i.getStore().loadPage(1)}})}else JE.alert("该类型不可以添加字段!")}},"panel[xtype=table.tablecolumngrid] button[ref=addFieldSet] menuitem[ref=addAtomField]":{click:function(e){var t=e.up("panel[xtype=table.tablecolumngrid]"),i=e.up("panel[xtype=table.centerview]").down("panel[xtype=table.tableform]").getForm(),n=i.findField("JE_CORE_RESOURCETABLE_ID").getValue(),a=i.findField("RESOURCETABLE_TYPE").getValue();if(Ext.isEmpty(n))JE.alert("请选保存表的数据");else if("MODULE"!=a&&"VIEW"!=a){var l=i.findField("RESOURCETABLE_TABLECODE").getValue();Ext.create("JE.sys.table.view.column.AtomFieldWin",{tableCode:l,tablePk:n,fn:function(e){t.getStore().loadPage(1)}})}else JE.alert("该类型不可以添加字段!")}},"panel[xtype=table.tablecolumngrid] button[ref=addFieldSet] menuitem[ref=saveAtomField]":{click:function(e){var t=e.up("panel[xtype=table.tablecolumngrid]").getSelectionModel().getSelection();if(t.length<=0)JE.alert("请选择需添加的列!");else{var a=new Array;Ext.each(t,function(e){if("ID"!=e.get("TABLECOLUMN_TYPE")&&"SYS"!=e.get("TABLECOLUMN_CLASSIFY")){var t=e.get("TABLECOLUMN_TABLECODE"),i=e.get("TABLECOLUMN_CODE"),n=e.get("TABLECOLUMN_CODE");!Ext.isEmpty(t)&&0<=t.lastIndexOf("_")&&(t=t.substring(t.lastIndexOf("_")+1),n=i.replace(t+"_","")),a.push({JE_CORE_ATOMCOLUMN_ID:e.get("JE_CORE_TABLECOLUMN_ID"),ATOMCOLUMN_NAME:e.get("TABLECOLUMN_NAME"),ATOMCOLUMN_CODE:i,ATOMCOLUMN_CONTEXT:n,ATOMCOLUMN_TYPE:e.get("TABLECOLUMN_TYPE"),ATOMCOLUMN_LENGTH:e.get("TABLECOLUMN_LENGTH"),ATOMCOLUMN_ISNULL:e.get("TABLECOLUMN_ISNULL")})}}),a.length<=0?JE.alert("请选择业务字段进行处理!"):Ext.create("JE.sys.table.view.column.SaveAtomFieldWin",{gridDatas:a,fn:function(e){var t=e.down("grid[xtype=column.saveatomfieldgrid]"),i=e.down("panel[xtype=column.saveatomfieldtree]").getSelectionModel().getSelection()[0],n=new Array,a=t.getStore().data.items;Ext.each(a,function(e){n.push(e.data)});var l={tableCode:"JE_CORE_ATOMCOLUMN",strData:Ext.encode(n),ATOMCOLUMN_ATOM_ID:i.get("id")},o=JE.ajax({url:JE.getUrlMaps("je.core.tableColumn","addAtomByColumn"),params:l});return o.success?(JE.msg(o.obj),!0):(JE.alert(o.obj),!1)}})}}},"panel[xtype=table.tablecolumngrid] button[ref=sysFieldSet] menuitem[ref=generateUpdateInfo]":{click:function(e){var t=e.up("panel[xtype=table.tablecolumngrid]"),i=e.up("panel[xtype=table.centerview]").down("panel[xtype=table.tableform]").getForm(),n=i.findField("JE_CORE_RESOURCETABLE_ID").getValue();i.findField("RESOURCETABLE_TYPE").getValue();if(Ext.isEmpty(n))JE.alert("请选保存表的数据");else{var a=JE.ajax({url:JE.getUrlMaps("je.core.tableColumn","generateUpdateInfo"),params:{tableCode:"JE_CORE_TABLECOLUMN",TABLECOLUMN_RESOURCETABLE_ID:n}});a.success?(t.getStore().loadPage(1),JE.msg("修改信息已成功生成。")):JE.alert(a.obj)}}},"panel[xtype=table.tablecolumngrid] button[ref=sysFieldSet] menuitem[ref=generateSaasInfo]":{click:function(e){var t=e.up("panel[xtype=table.tablecolumngrid]"),i=e.up("panel[xtype=table.centerview]").down("panel[xtype=table.tableform]").getForm(),n=i.findField("JE_CORE_RESOURCETABLE_ID").getValue();i.findField("RESOURCETABLE_TYPE").getValue();if(Ext.isEmpty(n))JE.alert("请选保存表的数据");else{var a=JE.ajax({url:JE.getUrlMaps("je.core.resourceTable","initSaasColumn"),params:{tableCode:"JE_CORE_RESOURCETABLE",pkValue:n}});a.success?(t.getStore().loadPage(1),JE.msg("saas信息已成功生成。")):JE.alert(a.obj)}}},"panel[xtype=table.tablecolumngrid] button[ref=sysFieldSet] menuitem[ref=generateExtendInfo]":{click:function(e){var t=e.up("panel[xtype=table.tablecolumngrid]"),i=e.up("panel[xtype=table.centerview]").down("panel[xtype=table.tableform]").getForm(),n=i.findField("JE_CORE_RESOURCETABLE_ID").getValue();i.findField("RESOURCETABLE_TYPE").getValue();if(Ext.isEmpty(n))JE.alert("请选保存表的数据");else{var a=JE.ajax({url:JE.getUrlMaps("je.core.resourceTable","initExtendColumns"),params:{tableCode:"JE_CORE_RESOURCETABLE",pkValue:n}});a.success?(t.getStore().loadPage(1),JE.msg("扩展字段已成功生成。")):JE.alert(a.obj)}}},"panel[xtype=table.tablecolumngrid] button[ref=sysFieldSet] menuitem[ref=generateWfInfo]":{click:function(e){var t=e.up("panel[xtype=table.tablecolumngrid]"),i=e.up("panel[xtype=table.centerview]").down("panel[xtype=table.tableform]").getForm(),n=i.findField("JE_CORE_RESOURCETABLE_ID").getValue();i.findField("RESOURCETABLE_TYPE").getValue();if(Ext.isEmpty(n))JE.alert("请选保存表的数据");else{var a=JE.ajax({url:"/je/resourceTableAction!initWfColumn.action",params:{tableCode:"JE_CORE_RESOURCETABLE",pkValue:n}});a.success?(t.getStore().loadPage(1),JE.msg("流程信息已成功生成。")):JE.alert(a.obj)}}},"panel[xtype=table.tablecolumngrid] button[ref=sysFieldSet] menuitem[ref=generateShInfo]":{click:function(e){var t=e.up("panel[xtype=table.tablecolumngrid]"),i=e.up("panel[xtype=table.centerview]").down("panel[xtype=table.tableform]").getForm(),n=i.findField("JE_CORE_RESOURCETABLE_ID").getValue();i.findField("RESOURCETABLE_TYPE").getValue();if(Ext.isEmpty(n))JE.alert("请选保存表的数据");else{var a=JE.ajax({url:JE.getUrlMaps("je.core.tableColumn","generateShInfo"),params:{tableCode:"JE_CORE_TABLECOLUMN",TABLECOLUMN_RESOURCETABLE_ID:n}});a.success?(t.getStore().loadPage(1),JE.msg("修改信息已成功生成。")):JE.alert(a.obj)}}},"panel[xtype=table.tablecolumngrid] button[ref=gridExcel]":{click:function(e){var d=e.up("panel[xtype=table.tablecolumngrid]"),t=e.up("panel[xtype=table.centerview]").down("panel[xtype=table.tableform]").getForm(),i=t.findField("JE_CORE_RESOURCETABLE_ID").getValue(),n=t.findField("RESOURCETABLE_TABLENAME").getValue();t.findField("RESOURCETABLE_TYPE").getValue();if(Ext.isEmpty(i))JE.alert("请选保存表的数据");else{d.localLang||(d.localLang=JE.getLocalLang("core.jegridview"));var r=d.localLang.expExcel;JE.formWin({title:r.title,width:450,height:230,border:0,frame:!0,autoShow:!0,formConfig:{bodyPadding:"10 10 0 10"},formDefaults:{},items:[{xtype:"textfield",name:"title",allowBlank:!1,fieldLabel:r.titleLabel},{xtype:"textfield",name:"fileName",allowBlank:!1,fieldLabel:r.fileNameLabel},{xtype:"rgroup",name:"expType",fieldLabel:r.expTypeLabel,value:"NOWPAGE",dataArray:[{id:"NOWPAGE",text:r.expTypeData.NOWPAGE,code:"NOWPAGE"},{id:"SELECTION",text:r.expTypeData.SELECTION,code:"SELECTION"},{id:"ALL",text:r.expTypeData.ALL,code:"ALL"}]},{xtype:"treessfield",name:"docFolderName",hidden:!0,fieldLabel:r.docFolderNameLabel,configInfo:"JE_SYS_DOCUMENTATION,docFolderName~docFolderId,text~id,S",whereSql:" AND SY_CREATEUSER='"+JE.currentUser.userCode+"'"},{xtype:"hidden",name:"docFolderId",fieldLabel:r.docFolderIdLabel}],fn:function(e,t){var i=d.getStore(),n=i.proxy.extraParams,a={title:e.title,fileName:e.fileName,tableCode:"JE_CORE_TABLECOLUMN",funcId:"296fabef-573a-4953-bfbe-aca2f1864a20",orderSql:n.orderSql,docFolderId:e.docFolderId};if("ALL"==e.expType)a.whereSql=n.whereSql;else if("NOWPAGE"==e.expType){var l=new Array;i.each(function(e){l.push(e.get("JE_CORE_TABLECOLUMN_ID"))}),a.whereSql=" AND JE_CORE_TABLECOLUMN_ID IN ('"+l.join("','")+"')"}else if("SELECTION"==e.expType){l=new Array;Ext.each(d.getSelectionModel().getSelection(),function(e){l.push(e.get("JE_CORE_TABLECOLUMN_ID"))}),a.whereSql=" AND JE_CORE_TABLECOLUMN_ID IN ('"+l.join("','")+"')"}if(a.styleType=e.styleType,"REPORT"==e.styleType)return JE.alert(r.styleTypeAlert),!1;var o=JE.ajax({url:JE.getUrlMaps("je.core.develop.excel","exp"),params:a});o.success?window.open(JE.getFileUrl(o.obj)):JE.alert(o.obj)},showFn:function(e){var t=e.down("form"),i={title:n+"表字段信息",fileName:n+"表字段信息_"+JE.DATE.formatDate(new Date)+".xls"};t.form.setValues(i)}})}}},"panel[xtype=table.tableform] dataview[xtype=table.tabledataview]":{itemclick:function(e,t,i,n,a,l){var o=e.up("panel[xtype=table.mainview]"),d=t.get("id");if(!o){var r=e.up("window").down("panel[xtype=table.centerview]"),c=r.down("panel[xtype=table.tablecolumngrid]"),s=r.down("panel[xtype=table.tablekeygrid]"),E=r.down("panel[xtype=table.tableindexgrid]"),f=r.down("panel[xtype=table.tabletracegrid]"),u=(r.down("panel[xtype=table.tablayout]"),r.down("panel[xtype=table.tableform]")),p=u.down("button[ref=planView]"),m=(u.down("button[ref=syncDbBtn]"),JE.ajax({url:JE.getUrlMaps("je.core.resourceTable","getInfoById"),params:{tableCode:"JE_CORE_RESOURCETABLE",pkValue:d}}));if(m.obj&&0==m.success)return void JE.alert("获取表信息失败!");var x=m.RESOURCETABLE_TYPE,g=Ext.create(JE.getModel({tableName:"JE_CORE_RESOURCETABLE"}),m);return p.setVisible("VIEW"==x),b.setDisabled(c,s,E,"VIEW"==x,!Ext.isEmpty(m.RESOURCETABLE_SQL)),u.getForm().loadRecord(g),void b.loadTableInfo(u,c,s,f,E,m)}var C=o.down("panel[xtype=table.westview]"),h=C.getStore().getNodeById(d);C.selectPath(h.getPath())}},"panel[xtype=table.tablekeygrid]":{beforeedit:function(e,t,i){var n=e.context.record;"SYS"==n.get("TABLEKEY_CLASSIFY")||n.get("TABLEKEY_ISCREATE")}},"panel[xtype=table.tablecolumngrid] button[ref=syncField]":{click:function(l){JE.confirm("<font color='red'>此次同步会按照选中的表的字段信息按照编码对比本表字段信息!<br/>将本表的字段名称更新为选中表的字段名称!</font>",function(e,t){if("ok"==e){var n=l.up("panel[xtype=table.tablecolumngrid]"),i=l.up("panel[xtype=table.centerview]").down("panel[xtype=table.tableform]").getForm(),a=i.findField("JE_CORE_RESOURCETABLE_ID").getValue();i.findField("RESOURCETABLE_TABLENAME").getValue(),i.findField("RESOURCETABLE_TYPE").getValue();if(Ext.isEmpty(a))return void JE.alert("请选保存表的数据");JE.selectWin({title:"请选择参考表",type:"grid",multiSelect:!1,configInfo:"JE_CORE_RESOURCETABLE,,",callback:function(e){var t=new Array;if(Ext.each(e,function(e){t.push(e.get("JE_CORE_RESOURCETABLE_ID"))}),0<t.length){var i=JE.ajax({url:JE.getUrlMaps("je.core.resourceTable","syncTableField"),params:{ckPkValue:t.join(","),pkValue:a}});i.success?(JE.msg("操作成功!"),n.store.load()):JE.alert(i.obj)}else JE.alert("请选择参考表!")}})}})}},"panel[xtype=table.tablecolumngrid] button[ref=setPkCode]":{click:function(e){var l=e.up("panel[xtype=table.tablecolumngrid]"),o=e.up("panel[xtype=table.centerview]"),t=o.down("panel[xtype=table.tableform]").getForm(),d=t.findField("JE_CORE_RESOURCETABLE_ID").getValue();t.findField("RESOURCETABLE_TABLENAME").getValue(),t.findField("RESOURCETABLE_TYPE").getValue();Ext.isEmpty(d)?JE.alert("请选保存表的数据"):JE.prompt("请输入表主键的新编码..",function(e,t){if("cancel"!=e&&!Ext.isEmpty(t)){var i=JE.ajax({url:JE.getUrlMaps("je.core.resourceTable","doSetPkName"),params:{tableCode:"JE_CORE_RESOURCETABLE",pkValue:d,newCode:t}});if(i.success){JE.msg("设定成功！"),l.store.load();var n=o.down("panel[xtype=table.tablekeygrid]");n&&n.store.load();var a=o.down("panel[xtype=table.tableindexgrid]");a&&a.store.load()}else JE.alert(i.obj)}})}},"panel[xtype=table.tablekeygrid] button[ref=gridInsert]":{click:function(e){var t=e.up("panel[xtype=table.tablekeygrid]"),i=e.up("panel[xtype=table.centerview]"),n=i.down("panel[xtype=table.tabletracegrid]"),a=i.down("panel[xtype=table.tableform]").getForm(),l=a.findField("JE_CORE_RESOURCETABLE_ID").getValue(),o=a.findField("RESOURCETABLE_TABLECODE").getValue(),d=t.getStore(),r=t.editing,c=d.model,s={tableCode:"JE_CORE_TABLEKEY",TABLEKEY_TYPE:"Foreign",TABLEKEY_LINETYLE:"Cascade",TABLEKEY_CHECKED:"1",TABLEKEY_ISRESTRAINT:"1",TABLEKEY_ISCREATE:"0",TABLEKEY_CLASSIFY:"PRO",TABLEKEY_TABLECODE:o,TABLEKEY_RESOURCETABLE_ID:l,SY_ORDERINDEX:d.count()},E=JE.ajax({url:JE.getUrlMaps("je.core.tableKey","doSave"),params:s});if(E.success){var f=new c(E.obj);r.cancelEdit(),d.insert(0,f),f.commit(),r.startEditByPosition({row:0,column:2}),n.getStore().load(),JE.msg("添加成功!")}else alert(E.obj)}},"panel[xtype=table.tablekeygrid] button[ref=gridDelete]":{click:function(e){var l=e.up("panel[xtype=table.tablekeygrid]"),t=e.up("panel[xtype=table.centerview]"),i=t.down("panel[xtype=table.tableform]"),o=t.down("panel[xtype=table.tabletracegrid]"),d=i.getForm().findField("RESOURCETABLE_TABLECODE").getValue(),r=l.getSelectionModel().getSelection();0<r.length?JE.dialog("是否删除表格键？",function(e){var t="0",i="1";if("deleteAll"==e?t="1":"delNo"==e&&(t="1",i="0"),"1"==t){var n=new Array;Ext.each(r,function(e){var t=e.get("JE_CORE_TABLEKEY_ID");n.push(t),"SYS"==e.get("TABLEKEY_CLASSIFY")&&!1});var a=JE.ajax({url:JE.getUrlMaps("je.core.tableKey","removeKey"),params:{ids:n.join(","),tableCode:"JE_CORE_TABLEKEY",TABLEKEY_TABLECODE:d,deleteDdl:i}});a.success?(l.getStore().load(),o.getStore().load(),JE.msg(a.obj)):alert(a.obj)}},{buttons:{deleteAll:"删除并执行DDL",delNo:"仅删除结构",cancel:"取消"}}):JE.alert("请选择要删除的数据!")}},"panel[xtype=table.tablekeygrid] button[ref=gridSave]":{click:function(e){var t=e.up("panel[xtype=table.tablekeygrid]"),i=e.up("panel[xtype=table.centerview]").down("panel[xtype=table.tabletracegrid]"),n=t.getStore().getUpdatedRecords();if(0<n.length){var a=new Array;Ext.each(n,function(e){var t=e.getChanges();t.JE_CORE_TABLEKEY_ID=e.get("JE_CORE_TABLEKEY_ID"),a.push(t)});var l=Ext.encode(a),o=JE.ajax({url:JE.getUrlMaps("je.core.tableKey","doUpdateList"),params:{tableCode:"JE_CORE_TABLEKEY",strData:l}});o.success?(JE.msg(o.obj),i.getStore().load(),Ext.each(n,function(e){e.commit()})):alert(o.obj)}else JE.msg("0条记录已更新！")}},"panel[xtype=table.tablekeygrid] button[ref=sekectPk]":{click:function(n){JE.confirm("该操作会选中表中一个值唯一的字段作为主键,使用场景为视图或自己创建的表信息!",function(e,t){if("ok"==e){var a=n.up("panel[xtype=table.tablekeygrid]"),i=n.up("panel[xtype=table.centerview]").down("panel[xtype=table.tableform]").getForm(),l=i.findField("JE_CORE_RESOURCETABLE_ID").getValue(),o=i.findField("RESOURCETABLE_TABLECODE").getValue();JE.selectWin({parent:null,parentType:"self",title:"选取主键(确保这个字段值不重复)",configInfo:"JE_CORE_TABLECOLUMN,,,S",whereSql:" AND TABLECOLUMN_RESOURCETABLE_ID='"+l+"' ",type:"grid",callback:function(e,t){if(e&&0<e.length){var i={tableCode:"JE_CORE_TABLEKEY",TABLEKEY_TYPE:"Primary",TABLEKEY_COLUMNCODE:e[0].get("TABLECOLUMN_CODE"),TABLEKEY_LINETYLE:"",TABLEKEY_CHECKED:"1",TABLEKEY_ISRESTRAINT:"1",TABLEKEY_ISCREATE:"1",TABLEKEY_CLASSIFY:"PRO",TABLEKEY_TABLECODE:o,TABLEKEY_RESOURCETABLE_ID:l,SY_ORDERINDEX:0},n=JE.ajax({url:JE.getUrlMaps("je.core.tableKey","doAddPk"),params:i});n.success?(a.getStore().load(),JE.msg("主键添加成功!")):JE.alert(n.obj)}else JE.alert("请选取指定字段为主键!")}})}})}},"panel[xtype=table.tableindexgrid]":{beforeedit:function(e,t,i){var n=e.context.record;"SYS"==n.get("TABLEINDEX_CLASSIFY")||n.get("TABLEINDEX_ISCREATE")}},"panel[xtype=table.tableindexgrid] button[ref=gridInsert]":{click:function(e){var t=e.up("panel[xtype=table.tableindexgrid]"),i=e.up("panel[xtype=table.centerview]"),n=i.down("panel[xtype=table.tabletracegrid]"),a=i.down("panel[xtype=table.tableform]").getForm(),l=a.findField("JE_CORE_RESOURCETABLE_ID").getValue(),o=a.findField("RESOURCETABLE_TABLECODE").getValue(),d=t.getStore(),r=t.editing,c=d.model,s={tableCode:"JE_CORE_TABLEINDEX",TABLEINDEX_TYPE:"NORMAL",TABLEINDEX_ISCREATE:"0",TABLEINDEX_UNIQUE:"0",TABLEINDEX_CLASSIFY:"PRO",TABLEINDEX_TABLECODE:o,TABLEINDEX_RESOURCETABLE_ID:l,SY_ORDERINDEX:d.count()},E=JE.ajax({url:JE.getUrlMaps("je.core.tableIndex","doSave"),params:s});if(E.success){var f=new c(E.obj);r.cancelEdit(),d.insert(0,f),f.commit(),r.startEditByPosition({row:0,column:2}),n.getStore().load(),JE.msg("添加成功!")}else alert(E.obj)}},"panel[xtype=table.tableindexgrid] button[ref=gridDelete]":{click:function(e){var n=e.up("panel[xtype=table.tableindexgrid]"),t=e.up("panel[xtype=table.centerview]"),i=t.down("panel[xtype=table.tableform]"),a=t.down("panel[xtype=table.tabletracegrid]"),l=i.getForm().findField("RESOURCETABLE_TABLECODE").getValue(),o=n.getSelectionModel().getSelection();0<o.length?JE.confirm("是否删除数据?",function(e){if("ok"==e){var i=new Array;Ext.each(o,function(e){var t=e.get("JE_CORE_TABLEINDEX_ID");i.push(t),"SYS"==e.get("TABLEINDEX_CLASSIFY")&&!1});var t=JE.ajax({url:JE.getUrlMaps("je.core.tableIndex","removeIndex"),params:{ids:i.join(","),tableCode:"JE_CORE_TABLEINDEX",TABLEINDEX_TABLECODE:l}});t.success?(n.getStore().load(),a.getStore().load(),JE.msg(t.obj)):alert(t.obj)}}):JE.alert("请选择要删除的数据!")}},"panel[xtype=table.tableindexgrid] button[ref=gridSave]":{click:function(e){var t=e.up("panel[xtype=table.tableindexgrid]"),i=e.up("panel[xtype=table.centerview]").down("panel[xtype=table.tabletracegrid]"),n=t.getStore().getUpdatedRecords();if(0<n.length){var a=new Array;Ext.each(n,function(e){var t=e.getChanges();t.JE_CORE_TABLEINDEX_ID=e.get("JE_CORE_TABLEINDEX_ID"),a.push(t)});var l=Ext.encode(a),o=JE.ajax({url:JE.getUrlMaps("je.core.tableIndex","doUpdateList"),params:{tableCode:"JE_CORE_TABLEINDEX",strData:l}});o.success?(JE.msg(o.obj),i.getStore().load(),Ext.each(n,function(e){e.commit()})):alert(o.obj)}else JE.msg("0条记录已更新！")}},"panel[xtype=table.tvmainview] treepanel[xtype=table.tvtableview]":{itemdblclick:function(e,t){var i=t.data;"MODULE"!=i.nodeInfo&&(i.childTableCodes=t.raw.bean.RESOURCETABLE_CHILDTABLECODES,e.panel.ownerCt.columnView.addColumns("table",i))}},"panel[xtype=table.tvmainview] panel[xtype=table.tvcolumnview] gridpanel":{selectionchange:function(e,t){var i=e.view.panel,n=i.floatParent.mainView.outColumnsView.getStore(),a=i.infoData,l=[],o=[],d=[],r=a.tableCode;Ext.each(t,function(e){d.push(e.get("JE_CORE_TABLECOLUMN_ID")),n.findRecord("id",e.get("JE_CORE_TABLECOLUMN_ID"))||l.push({id:e.get("JE_CORE_TABLECOLUMN_ID"),value:r+"."+e.get("TABLECOLUMN_CODE"),code:e.get("TABLECOLUMN_CODE"),name:e.get("TABLECOLUMN_NAME"),table:r,order:"",group:!1,formula:"",dataType:e.get("TABLECOLUMN_TYPE"),length:e.get("TABLECOLUMN_LENGTH"),whereValue:""})}),n.each(function(e){e.get("table")==r&&-1==d.indexOf(e.get("id"))&&o.push(e)}),n.add(l),n.remove(o)}},"panel[xtype=table.tvmainview] button[ref=seeSql]":{click:function(e){var t=e.up("panel[xtype=table.tvmainview]").sqlView.getSql();Ext.isEmpty(t)?JE.alert("请先生成SQL再执行!"):JE.win({title:"查询结果",autoShow:!0,width:JE.getBodyWidth()-300,height:JE.getBodyHeight()-300,items:{xtype:"table.tvsqlgridview",border:0,sql:t}})}},"panel[xtype=table.tvmainview] button[ref=generateSql]":{click:function(e){var n=e.up("panel[xtype=table.tvmainview]");JE.confirm("生成SQL会将覆盖原有SQL,是否继续...",function(e,t){if("ok"==e){var i=n.buildSql();n.sqlView.setSql(i)}})}}};b.control(e)},addNode:function(e){var t=e.tree,i=e.parentNode.getPath(),n=e.nodeObj;n.SY_PATH=i,n.tableCode="JE_CORE_RESOURCETABLE";var a=JE.ajax({url:e.url,params:n});if(a.success){var l=a.obj,o={id:l.JE_CORE_RESOURCETABLE_ID,text:l.RESOURCETABLE_TABLENAME,code:l.RESOURCETABLE_TABLECODE,leaf:"LEAF"==l.SY_NODETYPE,nodePath:l.SY_PATH,nodeInfo:l.RESOURCETABLE_TYPE,nodeInfoType:l.RESOURCETABLE_NODEINFOTYPE,iconCls:l.RESOURCETABLE_ICONCLS,children:[],expandable:!0};return e.parentNode.data.leaf&&(e.parentNode.set("leaf",!1),e.parentNode.commit()),o=e.parentNode.appendChild(o),t.selectPath(o.getPath()),o}return null},loadTableInfo:function(e,t,i,n,a,l){var o=Ext.value(l.JE_CORE_RESOURCETABLE_ID,""),d=Ext.create(JE.getModel({tableName:"JE_CORE_RESOURCETABLE"}),l);e.getForm().loadRecord(d);var r=t.getStore();r.sqls.parent=" and TABLECOLUMN_RESOURCETABLE_ID='"+o+"'",r.getProxy().extraParams.whereSql=" and TABLECOLUMN_RESOURCETABLE_ID='"+o+"'",r.loadPage(1);var c=i.getStore();c.sqls.parent=" and TABLEKEY_RESOURCETABLE_ID='"+o+"'",c.getProxy().extraParams.whereSql=" and TABLEKEY_RESOURCETABLE_ID='"+o+"'",c.loadPage(1);var s=a.getStore();s.sqls.parent=" and TABLEINDEX_RESOURCETABLE_ID='"+o+"'",s.getProxy().extraParams.whereSql=" and TABLEINDEX_RESOURCETABLE_ID='"+o+"'",s.loadPage(1);var E=n.getStore();E.getProxy().extraParams.whereSql=" and TABLETRACE_RESOURCETABLE_ID='"+o+"'",E.loadPage(1);var f=e.down("dataview[xtype=table.tabledataview]"),u=f.up("fieldcontainer"),p=f.getStore();p.getProxy().extraParams.pkValue=o,p.load({callback:function(e,t,i){e&&0<e.length?u.show():u.hide()}});var m=e.getForm(),x=(m.findField("RESOURCETABLE_ISCREATE"),m.findField("RESOURCETABLE_USEFUNC")),g=t.up("panel[xtype=table.tablayout]");"MODULE"==l.RESOURCETABLE_TYPE?(x.hide(),g.hide()):(e.up("window")?x.hide():x.show(),g.show())},imp:function(n,a,l){var o=this;JE.prompt(l.msg,function(e,t){if("cancel"!=e&&!Ext.isEmpty(t)){var i={RESOURCETABLE_ICONCLS:l.iconCls,RESOURCETABLE_TABLECODE:t,RESOURCETABLE_ISCREATE:"0",RESOURCETABLE_TYPE:l.tableType,RESOURCETABLE_ISUSEFOREIGNKEY:"0",SY_LAYER:a.getDepth()+1,SY_PARENT:a.get("id"),SY_NODETYPE:"LEAF",SY_DISABLED:"0"};o.addNode({tree:n,parentNode:a,nodeObj:i,url:JE.getUrlMaps("je.core.resourceTable","imp")})?JE.msg("导入成功!"):JE.alert("导入失败!")}})},initDisplayInfo:function(){var t=this,e=JE.ajax({url:JE.getUrlMaps("je.core.load"),params:{limit:-1,tableCode:"JE_CORE_TABLEDISPLAY"}});t.displayTableInfo={},Ext.each(e.rows,function(e){t.displayTableInfo[e.TABLEDISPLAY_TABLE_ID]={id:e.JE_CORE_TABLEDISPLAY_ID,x:e.TABLEDISPLAY_X,y:e.TABLEDISPLAY_Y,width:e.TABLEDISPLAY_WIDTH,height:e.TABLEDISPLAY_HEIGHT}})},setDisabled:function(e,t,i,n,a){var l=e.getDockedItems('toolbar[dock="top"]')[0];Ext.each(l.items.items,function(e){"button"==e.xtype&&-1==["gridExcel","gridSave","syncField","setPkCode"].indexOf(e.ref)&&e.setDisabled(n)});var o=t.down("button[ref=sekectPk]"),d=!1;t.store.each(function(e){"Primary"==e.get("TABLEKEY_TYPE")&&"1"==e.get("TABLEKEY_ISCREATE")&&(d=!0)}),o&&(1==n?o.show():o.hide(),d||o.show()),e.down("gridcolumn[dataIndex=TABLECOLUMN_CODE]").getEditor().setReadOnly(n);var r=e.down("gridcolumn[dataIndex=TABLECOLUMN_ISNULL]").getEditor();r&&r.setReadOnly(n),l=i.getDockedItems('toolbar[dock="top"]')[0],Ext.each(l.items.items,function(e){-1==["gridExcel"].indexOf(e.ref)&&e.setDisabled(n)})},views:["JE.sys.table.view.MainView","JE.sys.table.view.CenterView","JE.sys.table.view.TableForm","JE.sys.table.view.WestView","JE.sys.table.view.TabLayout","JE.sys.table.view.column.TableColumnView","JE.sys.table.view.column.TableColumnGrid","JE.sys.table.view.key.TableKeyView","JE.sys.table.view.key.TableKeyGrid","JE.sys.table.view.index.TableIndexView","JE.sys.table.view.index.TableIndexGrid","JE.sys.table.view.trace.TableTraceView","JE.sys.table.view.trace.TableTraceGrid","JE.sys.table.view.FormWin","JE.sys.table.view.TableDataView","JE.sys.table.view.column.DictionaryFieldForm","JE.sys.table.view.column.DictionaryFieldWin","JE.sys.table.view.column.TableFieldWin","JE.sys.table.view.column.TableFieldForm","JE.sys.table.view.column.TableFieldGrid","JE.sys.table.view.column.AtomFieldWin","JE.sys.table.view.column.AtomFieldForm","JE.sys.table.view.column.AtomFieldGrid","JE.sys.table.view.column.SaveAtomFieldWin","JE.sys.table.view.column.SaveAtomFieldTree","JE.sys.table.view.column.SaveAtomFieldGrid","JE.sys.table.view.tableview.TvMainView","JE.sys.table.view.tableview.TvColumnView","JE.sys.table.view.tableview.TvTableView","JE.sys.table.view.tableview.TvCascadeView","JE.sys.table.view.tableview.TvOutColumnsView","JE.sys.table.view.tableview.TvSqlView","JE.sys.table.view.tableview.TvSqlGridView","JE.sys.table.view.DpColumnView","JE.sys.table.view.column.CascadeFieldForm"],stores:[],models:[]}),Ext.define("JE.sys.portal.util.BKUtil",{showConfigWin:function(l){var o=this,e=l.configData.type,t="portal.bk"+e.toLowerCase()+"view";-1==["DATA","APP","HTML","LINK","WEATHER","NEWS","CLOCK","CALENDAR","CHART","DAOHANG","CODE","REPORT","ICON"].indexOf(e)&&(t="form");var a=JE.win({width:440,height:550,useButton:!0,title:"配置信息",border:0,maximized:"CODE"==e,fn:function(e){var t=e.items.get(0),i=t.items.get(0).getValues();Ext.apply(l.styleData,i),o.updateStyle(l,l.styleData),l.styleData.height=i.height;var n=t.items.get(1);Ext.apply(l.configData,n.getValues());var a=t.items.get(2);Ext.apply(l.extendData,a.getValues())},items:{xtype:"tabpanel",defaults:{border:0,autoScroll:!0},activeTab:"CODE"==e?1:0,ownerPanel:l,items:[{xtype:"portal.styleview",type:"bk",title:"样式"},{xtype:t,title:"配置"},{xtype:"portal.exview",title:"扩展"}]}});a.show(null,function(){var e=a.items.get(0),t=e.items.get(0),i=e.items.get(1),n=e.items.get(2);Ext.isNumeric(l.styleData.height)&&(l.styleData.height='[{code:"default",value:'+l.styleData.height+"}]"),t.form.setValues(l.styleData),(i.form?i.form:i).setValues(l.configData),n.form.setValues(l.extendData)})},buildBKItem:function(e){var n=this,t=e.configData.type,i={xtype:"panel",margin:"5",bkPanel:!0,configData:{type:t},styleData:{margin:"5"},extendData:{},minHeight:200,html:'<center><div style="margin:2px;" class = JE_PORTAL_BK_'+t+" ></div></center>",dockedItems:{xtype:"toolbar",style:"background:#fefece;",basicBgColor:"#fefece",items:[{xtype:"box",ref:"titleBox"},"->",{iconCls:"jeicon jeicon-set-up",handler:function(e){var t=e.ownerCt.ownerCt;n.showConfigWin(t)}},{iconCls:"jeicon jeicon-error",handler:function(e){var t=e.ownerCt.ownerCt;JE.confirm("确定删除吗？",function(e){"ok"==e&&t.ownerCt.remove(t,!0)})}}]},listeners:{afterrender:function(e){e.titleBox=e.down("box[ref=titleBox]"),e.dragSource=new Ext.dd.DragSource(e.getEl(),{ddGroup:"DDGroup",getDragData:function(e){var t=e.getTarget("div.x-panel",10);if(t){var i,n=Ext.getCmp(t.id);if(n.bkPanel&&(i=n),i)return{ddel:i.getEl(),dragPanel:i}}},afterValidDrop:function(e,t,i){n.doItemSort(this.dragData)},afterInvalidDrop:function(){n.hidetIndicator()},afterDragDrop:function(e,t,i){n.hidetIndicator()}})}}};Ext.apply(i.configData,e.configData),Ext.apply(i.styleData,Ext.value(e.styleData,{})),Ext.apply(i.extendData,Ext.value(e.extendData,{}));var a=i.styleData.height,l=n.formatStyleData(i.styleData);i.styleData.height=a;var o=i.dockedItems;return o.style="background:"+Ext.value(l.bgColor,o.basicBgColor)+";",o.items[0].html=l.icon+l.title,i.minHeight=0<l.height?l.height:i.minHeight,i}}),Ext.define("JE.sys.portal.util.KJUtil",{showStyleWin:function(i){var n=this,e=JE.win({width:420,height:480,useButton:!0,title:"配置信息",fn:function(e){var t=e.items.get(0).getValues();Ext.apply(i.styleData,t),n.updateStyle(i,i.styleData)},items:{xtype:"portal.styleview",type:"kj",border:0}});e.show(null,function(){e.items.get(0).form.setValues(i.styleData)})},buildKJItem:function(e){var a=this,l={xtype:"panel",minHeight:200,margin:"5",kjPanel:!0,styleData:{layout:e.styleData.layout,margin:"5"},layout:{type:"hbox",align:"stretch"},items:[],dockedItems:{xtype:"toolbar",style:"background:#d3e1f1;",basicBgColor:"#d3e1f1",items:[{xtype:"box",ref:"titleBox"},"->",{iconCls:"jeicon jeicon-set-up",handler:function(e){var t=e.ownerCt.ownerCt;a.showStyleWin(t)}},{iconCls:"jeicon jeicon-error",handler:function(e){var t=e.ownerCt.ownerCt;JE.confirm("确定删除吗？",function(e){"ok"==e&&t.ownerCt.remove(t,!0)})}}]},listeners:{afterrender:function(e){e.titleBox=e.down("box[ref=titleBox]"),"portal.mainview"!=e.ownerCt.xtype&&(e.dragSource=new Ext.dd.DragSource(e.getEl(),{ddGroup:"DDGroup",getDragData:function(e){var t=e.getTarget("div.x-panel",10);if(t){var i,n=Ext.getCmp(t.id);if(n.kjItemPanel?i=n.ownerCt:n.kjPanel&&(i=n),i)return{ddel:i.getEl(),dragPanel:i}}},afterValidDrop:function(e,t,i){a.doItemSort(this.dragData)},afterDragDrop:function(e,t,i){a.hidetIndicator()}}))}}};Ext.apply(l.styleData,e.styleData);var t=a.formatStyleData(l.styleData),i=l.dockedItems;i.style="background:"+Ext.value(t.bgColor,i.basicBgColor)+";",i.items[0].html=t.icon+t.title,l.minHeight=0<t.height?t.height:l.minHeight;var o=t.layoutWidth,d=t.layout,r=Ext.value(e.items,[]);return Ext.each(d,function(e,t){var i=a.buildKJItems(r[t]),n=0<o.length?Number(o[t]):0;i.tabLayout="TAB"==e,0<n?i.width=n:i.flex="TAB"==e?1:Number(e),t==d.length-1&&delete i.bodyStyle,l.items.push(i)}),l},buildKJItems:function(e){var l=this,i={xtype:"panel",layout:"column",border:0,bodyStyle:"border-right:1px dashed #99bce8 !important;",defaults:{columnWidth:1},kjItemPanel:!0,listeners:{add:function(e){var t=e.items.getCount();e.tabLayout&&0<t&&(t+=1,e.items.each(function(e){e.columnWidth=1/t}),e.doLayout())},remove:function(e){var t=e.items.getCount();e.tabLayout&&0<t&&(t+=1,e.items.each(function(e){e.columnWidth=1/t}),e.doLayout())},afterrender:function(e){e.ddTarget=new Ext.dd.DropTarget(e.body,{ddGroup:"DDGroup",notifyOver:function(e,n,a){var t=n.getTarget("div.x-panel-body",3);if(a.allowDD=!1,t){var i=Ext.getCmp(t.id.replace("-body",""));i.kjItemPanel&&(a.dropPanel=i,a.allowDD=!0),a.allowDD&&a.dragPanel&&a.dropPanel&&(a.allowDD=a.dragPanel.id!=a.dropPanel.ownerCt.id)}return a.insertIndex=-1,a.allowDD&&a.dropPanel&&0<a.dropPanel.items.getCount()&&!a.dropPanel.tabLayout&&a.dropPanel.items.each(function(e,t){var i=l.getItemPosition(n,e.getEl());if("before"==i||a.dropPanel.items.getCount()-1==t)return"before"==i&&(a.insertIndex=t),l.positionIndicator(e.getEl(),i,n),!1}),a.allowDD?e.dropAllowed:e.dropNotAllowed},notifyDrop:function(e,t,i){return i.allowDD}})}}};return e&&(i.items=[],Ext.each(e.items,function(e){var t;t="bk"==e.type?l.buildBKItem(e):l.buildKJItem(e),i.items.push(t)})),i}}),Ext.define("JE.sys.portal.util.Util",{mixins:["JE.sys.portal.util.KJUtil","JE.sys.portal.util.BKUtil","JE.core.util.PortalUtil"],statics:{buildPortal:function(n,a){JE.initCtr("JE.sys.portal.controller.MainController"),"PORTAL"==a.get("PROTAL_TYPE")?JE.win({title:"首页规划",border:0,items:{xtype:"portal.mainview",mainGrid:n,mainRecord:a}}).show():"MENU"==a.get("PROTAL_TYPE")?JE.win({title:"菜单规划",autoScroll:!0,items:{xtype:"portal.menumainview",mainGrid:n,mainRecord:a}}).show():"IDDT"==a.get("PROTAL_TYPE")&&JE.win({title:"插件规划",width:600,height:350,items:{border:0,xtype:"portal.bkappview",useFuncCode:!0,itemId:"appview"},useButton:!0,fn:function(e){var t=e.getCmp("appview").form.getValues();a.set("PROTAL_DATA",Ext.encode(t));var i=n.getButton("gridUpdateBtn");i&&i.fireEvent("click",i)},showFn:function(e){var t=Ext.decode(Ext.value(a.get("PROTAL_DATA"),"{}"));e.getCmp("appview").form.setValues(t)}}).show()}},getPortalData:function(e){var a=this,t={};if(e.kjPanel){t.type="kj",t.styleData=e.styleData,t.items=[];var l=[];e.items.each(function(i){var n={type:"kjItems",flex:i.flex,items:[]};i.items.each(function(e){var t=a.getPortalData(e);"bk"==t.type&&"DATA"==t.configData.type&&-1==l.indexOf(t.configData.tableName)?l.push(t.configData.tableName):"kj"==t.type&&JE.isNotEmpty(t.tables)&&Ext.each(t.tables,function(e){-1==l.indexOf(e)&&l.push(e)}),t.tabLayout=i.tabLayout,n.items.push(t)}),t.items.push(n)}),t.tables=l}else t.type="bk",t.styleData=e.styleData,t.configData=e.configData,t.extendData=e.extendData;return t},buildEditPortal:function(e){e=Ext.isEmpty(e)?{type:"kj",styleData:{layout:"1"},items:[{flex:1,type:"kjItems"}]}:Ext.decode(e);var t=this.buildKJItem(e);return t.items[0].autoScroll=!0,t.border=0,delete t.dockedItems,delete t.margin,t},updateStyle:function(e,t){var i=e.dockedItems.get(0),n=this.formatStyleData(t);if(i.getEl().setStyle({background:Ext.value(n.bgColor,i.basicBgColor)}),0<n.height&&(e.minHeight=n.height,e.setHeight(n.height)),e.titleBox.update(n.icon+n.title),e.kjPanel&&!Ext.isEmpty(n.layoutWidth)){var a=n.layoutWidth,l=n.layout;e.items.each(function(e,t){0<Number(a[t])?(delete e.flex,e.width=Number(a[t])):(delete e.width,e.flex=Number(l[t]))}),e.doLayout()}},doItemSort:function(e){e.allowDD&&(-(e.dragPanel.columnWidth=1)<e.insertIndex?e.dragPanel=e.dropPanel.insert(e.insertIndex,e.dragPanel):e.dragPanel=e.dropPanel.add(e.dragPanel))},indicatorHtml:'<div class="'+Ext.baseCSSPrefix+'grid-drop-indicator-left"></div><div class="'+Ext.baseCSSPrefix+'grid-drop-indicator-right"></div>',indicatorCls:Ext.baseCSSPrefix+"grid-drop-indicator",getIndicator:function(){return this.indicator||(this.indicator=this.up("[xtype=portal.mainview]").indicator),this.indicator},getItemPosition:function(e,t){var i=e.getXY()[1],n=Ext.fly(t).getRegion();return n.bottom-i>=(n.bottom-n.top)/2?"before":"after"},positionIndicator:function(e,t,i){var n=Ext.fly(e),a=n.getX(),l=n.getY()-5;"after"==t&&(l+=n.getHeight()+10),this.getIndicator().setWidth(n.getWidth()).showAt(a,l)},hidetIndicator:function(){this.getIndicator().hide()}}),Ext.define("JE.sys.portal.view.BKView",{extend:"Ext.panel.Panel",alias:"widget.portal.bkview",mixins:["JE.sys.portal.util.Util"],initComponent:function(){this.items={xtype:"dataview",autoScroll:!0,style:"height:100%;",store:new Ext.data.Store({fields:["text","type"],data:[{text:"功能数据",type:"DATA"},{text:"统计图",type:"CHART"},{text:"报表",type:"REPORT"},{text:"App",type:"APP"},{text:"Html",type:"HTML"},{text:"展板",type:"ICON"},{text:"图片新闻",type:"NEWS"},{text:"日历",type:"CALENDAR"},{text:"天气",type:"WEATHER"},{text:"时钟",type:"CLOCK"},{text:"链接",type:"LINK"},{text:"导航",type:"DAOHANG"},{text:"自定义",type:"CODE"}]}),tpl:['<tpl for=".">','<div style="float:left;margin:5px;" class = "portal-bk JE_PORTAL_BK_{type}" title="{text}"></div>',"</tpl>"],itemSelector:"div.portal-bk"},this.callParent(arguments)},afterRender:function(){var o=this;o.callParent(arguments);var i=o.items.get(0);o.dragZone=new Ext.dd.DragZone(o.body,{ddGroup:"DDGroup",getDragData:function(e){var t=e.getTarget(i.itemSelector,10);if(t)return d=t.cloneNode(!0),d.id=Ext.id(),{ddel:d,allowDD:!1,sourceEl:t,repairXY:Ext.fly(t).getXY(),sourceStore:i.store,draggedRecord:i.getRecord(t)}},getRepairXY:function(){return this.dragData.repairXY},afterDragDrop:function(){o.hidetIndicator()},afterInvalidDrop:function(){o.hidetIndicator()},afterValidDrop:function(e,t,i){var n=this.dragData;if(!n.dragPanel){var a=n.draggedRecord.get("type"),l=o.buildBKItem({configData:{type:a}});n.dragPanel=l}o.doItemSort(n)}})}}),Ext.define("JE.sys.portal.view.EXView",{extend:"Ext.form.Panel",alias:"widget.portal.exview",layout:"column",initComponent:function(){var n=this;n.bodyPadding="5",n.defaults={labelWidth:90,labelAlign:"right",columnWidth:1,margin:"2 0"},n.items=[{labelAlign:"top",xtype:"jsonarrayfield",name:"buttons",height:200,labelBodyStyle:"margin:0 0 4px 0;",fieldLabel:"按钮",actionColumnIndex:0,columns:[{dataIndex:"name",width:60,text:"名称",field:{xtype:"cbbfield",dataArray:[{text:"更多",code:"更多"},{text:"刷新",code:"刷新"}],editable:!0,hideTrigger1:!0}},{dataIndex:"name_en",width:60,text:"英文名",field:{xtype:"cbbfield",dataArray:[{text:"More",code:"More"},{text:"Refresh",code:"Refresh"}],editable:!0,hideTrigger1:!0}},{dataIndex:"defEvent",width:60,text:"默认单击",tooltip:"选择版块默认的单击事件</br>自己编写的单击事件将不可用，但其他事件不影响",field:{xtype:"cbbfield",dataArray:[{text:"更多",code:"更多"},{text:"刷新",code:"刷新"}],hideTrigger2:!0}},{xtype:"actioncolumn",width:40,text:"事件",items:[{tooltip:"编辑",getClass:function(e,t,i){return JE.CoreUtil.isFireListener(i.get("events"))?"jeicon jeicon-lightning-on":"jeicon jeicon-lightning-off"},handler:function(e,t,i,n,a,l){Ext.isEmpty(l.get("name"))?JE.alert("请先填写名称，再注册事件"):JE.win({title:"事件",border:0,items:{xtype:"jelistenereditor",type:"button",value:l.get("events"),saveFn:function(e){l.set("events",JE.encode(e))}}}).show()}}]},{dataIndex:"disabled",width:50,text:"不启用",xtype:"uxcheckcolumn"},{dataIndex:"iconCls",width:80,text:"图标",field:{xtype:"gridssfield",editable:!0,configInfo:"JE_CORE_FONTICON,iconCls,FONTICON_CLS,S"}},{dataIndex:"fontIconCls",width:80,text:"字体图标",field:{xtype:"gridssfield",editable:!0,configInfo:"JE_CORE_FONTICON,fontIconCls,FONTICON_CLS,S"}},{dataIndex:"color",width:80,text:"字体颜色",field:{xtype:"colorfield"}},{dataIndex:"events",hidden:!0}]},{fieldLabel:"版块的监听事件",labelWidth:100,xtype:"fieldcontainer",itemId:"jsFC",items:[{xtype:"button",itemId:"addBtn",text:"添加",iconCls:"jeicon jeicon-lightning-off",handler:function(){var t=n.form.findField("listeners"),e=t.getValue();e=Ext.value(e,"/*添加监听事件*/\n{\n\n}"),JE.win({title:"添加监听事件",autoShow:!0,items:{xtype:"jecodeeditor",value:e,saveFn:function(e){t.setValue(e),JE.msg("保存成功！")}}})}}]},{xtype:"hidden",name:"listeners",listeners:{change:function(e,t){var i=JE.eval(Ext.value(t,"{}"));n.getCmp("jsFC").getCmp("addBtn").setIconCls(JE.isEmpty(i)?"jeicon jeicon-lightning-off":"jeicon jeicon-lightning-on")}}}],n.callParent(arguments)}}),Ext.define("JE.sys.portal.view.KJView",{extend:"Ext.panel.Panel",alias:"widget.portal.kjview",mixins:["JE.sys.portal.util.Util"],initComponent:function(){this.items={xtype:"dataview",autoScroll:!0,style:"height:100%;",store:new Ext.data.Store({fields:["text"],data:[{text:"1"},{text:"1:1"},{text:"1:2"},{text:"2:1"},{text:"1:3"},{text:"3:1"},{text:"1:1:1"},{text:"TAB"}]}),tpl:['<tpl for=".">','<div  style="float:left;margin:5px;" class = "portal-layout JE_PORTAL_LAYOUT_{[values.text.replaceAll(":","")]}">',"</div>","</tpl>"],itemSelector:"div.portal-layout"},this.callParent(arguments)},afterRender:function(){var o=this;o.callParent(arguments);var i=o.items.get(0);o.dragZone=new Ext.dd.DragZone(o.body,{ddGroup:"DDGroup",getDragData:function(e){var t=e.getTarget(i.itemSelector,10);if(t)return d=t.cloneNode(!0),d.id=Ext.id(),{ddel:d,allowDD:!0,sourceEl:t,repairXY:Ext.fly(t).getXY(),sourceStore:i.store,draggedRecord:i.getRecord(t)}},getRepairXY:function(){return this.dragData.repairXY},afterDragDrop:function(){o.hidetIndicator()},afterInvalidDrop:function(){o.hidetIndicator()},afterValidDrop:function(e,t,i){var n=this.dragData;if(!n.dragPanel){var a=n.draggedRecord.get("text"),l=o.buildKJItem({styleData:{layout:a}});n.dragPanel=l}o.doItemSort(n)}})}}),Ext.define("JE.sys.portal.view.MainView",{extend:"Ext.panel.Panel",alias:"widget.portal.mainview",layout:"fit",mixins:["JE.sys.portal.util.Util"],initComponent:function(){var a=this;a.dockedItems=[{xtype:"toolbar",dock:"top",items:[{text:"保存",iconCls:"jeicon jeicon-save",handler:function(){var e=a.getPortalData(a.items.get(0));a.mainRecord.set("PROTAL_DATA",Ext.encode(e));var t=a.mainGrid.getButton("gridUpdateBtn");t&&t.fireEvent("click",t)}},{text:"预览",iconCls:"jeicon jeicon-form-adjustment",handler:function(){var e=a.items.get(0),t=a.getPortalData(e),i=Ext.clone(a.mainRecord.data);i.PROTAL_DATA=t;var n=a.buildPortal(i);JE.win({title:"预览",items:n}).show()}}]},{xtype:"tabpanel",dock:"top",height:100,defaults:{border:0},items:[{xtype:"portal.kjview",title:"框架"},{xtype:"portal.bkview",title:"版块"}]}],a.callParent(arguments)},afterRender:function(){if(this.callParent(arguments),this.indicator=new Ext.Component({html:this.indicatorHtml,cls:this.indicatorCls,floating:!0,shadow:!1}),this.mainGrid&&this.mainRecord){var e=this.mainRecord.get("PROTAL_DATA"),t=this.buildEditPortal(e);this.add(t)}}}),Ext.define("JE.sys.portal.view.StyleView",{extend:"Ext.form.Panel",alias:"widget.portal.styleview",layout:"column",autoScroll:!0,initComponent:function(){this.bodyPadding="5",this.defaults={labelWidth:90,labelAlign:"right",columnWidth:.95,margin:"2 0"},this.items=[{xtype:"textfield",name:"title",fieldLabel:"标题"},{xtype:"textfield",name:"title_en",fieldLabel:"英文标题"},{xtype:"textfield",name:"code",unitTpl:"唯一",fieldLabel:"编码"},{xtype:"displayfield",fieldStyle:"text-align:right;",value:"<font color=blue>通过版块的getPortalBK(编码)方法,获得当前容器内的别的版块</font>"},{xtype:"colorfield",name:"titleColor",fieldLabel:"标题字体颜色"},{xtype:"colorfield",name:"titleBgColor",fieldLabel:"标题背景颜色"},{xtype:"colorfield",name:"bodyBgColor",fieldLabel:"面板背景颜色"},{xtype:"colorfield",name:"borderColor",fieldLabel:"边框颜色"},{xtype:"colorfield",name:"topBorderColor",fieldLabel:"上边框颜色"},{xtype:"gridssfield",name:"iconCls",whereSql:" and ICON_SIZE_CODE = '16*16' ",configInfo:"JE_CORE_FONTICON,iconCls,FONTICON_CLS,S",fieldLabel:"图标"},{xtype:"gridssfield",name:"fontIconCls",whereSql:" and ICON_SIZE_CODE = '16*16' ",configInfo:"JE_CORE_FONTICON,fontIconCls,FONTICON_CLS,S",fieldLabel:"字体图标"},{xtype:"textfield",name:"padding",fieldLabel:"内边距"},{xtype:"textfield",name:"margin",fieldLabel:"外边距"},{fieldLabel:"边框",name:"border",xtype:"yesnofield",boxLabel:"隐藏"},{xtype:"displayfield",fieldLabel:"<font color=blue>边距格式说明</font>",value:"<font color=blue>上 右 下 左(0 0 0 0)</br>上下 左右(0 0)</br>上下左右(0)</font>"},{xtype:"cbblistfield",fieldLabel:"高",name:"height",hidden:"kj"==this.type,typeConfig:{value:"default",editable:!1,width:90},valueConfig:{xtype:"numberfield",minValue:0,unitTpl:"px"},configInfo:"JE_CORE_RESOLUTION"},{xtype:"textfield",name:"layoutWidth",fieldLabel:"宽度比例"},{xtype:"displayfield",fieldLabel:"<font color=blue>宽度比例说明</font>",value:"<font color=blue>根据框架,用空格分隔,来设定布局每列的单独宽度,如果自适应,则宽度为0。如1:1:1布局，可以设定为200 0 200</font>"}],this.callParent(arguments)}}),Ext.define("JE.sys.portal.view.bk.AppView",{extend:"Ext.form.Panel",layout:"column",alias:"widget.portal.bkappview",initComponent:function(){this.bodyPadding="5",this.defaults={labelWidth:80,labelAlign:"right",columnWidth:.95,margin:"2 0"},this.items=[{xtype:"textfield",fieldLabel:"主面板",name:"mainview"},{xtype:"textarea",fieldLabel:"控制器",height:200,name:"ctr"},{xtype:"displayfield",fieldLabel:"<font color=blue>说明</font>",value:"<font color=blue>主面板填的是ClassName；如果有多个控制器，以逗号隔开</font>"}],this.useFuncCode&&this.items.unshift({xtype:"textfield",fieldLabel:"功能编码",name:"funcCode",unitTpl:'Ext.getCmp(功能编码+"_mainview") 可获得面板'}),this.callParent(arguments)}}),Ext.define("JE.sys.portal.view.bk.CalendarView",{extend:"Ext.form.Panel",layout:"column",alias:"widget.portal.bkcalendarview",initComponent:function(){this.bodyPadding="5",this.defaults={labelWidth:100,labelAlign:"right",columnWidth:.95,margin:"2 0"},this.items=[{xtype:"yesnofield",fieldLabel:"不显示农历",name:"minCalendar"},{xtype:"yesnofield",fieldLabel:"启用详细提示",name:"useDayinfo"},{xtype:"yesnofield",fieldLabel:"新版日历",name:"useNew",boxLabel:"启用后，上面参数将不起效"}],this.callParent(arguments)}}),Ext.define("JE.sys.portal.view.bk.ChartView",{extend:"Ext.form.Panel",layout:"column",alias:"widget.portal.bkchartview",initComponent:function(){var n=this;n.bodyPadding="5",n.defaults={labelWidth:80,labelAlign:"right",columnWidth:.95,margin:"2 0"},n.items=[{fieldLabel:"统计图",xtype:"treessfield",name:"text",whereSql:" AND SY_JESYS='1'",configInfo:"JE_CORE_CHARTS,code~text~dsCfg,code~text~bean.CHARTS_DSCONFIG,S"},{fieldLabel:"编码",xtype:"textfield",name:"code"},{fieldLabel:"查询信息",xtype:"yesnofield",boxLabel:"隐藏",columnWidth:.5,name:"hideSearchBar"},{fieldLabel:"边框",xtype:"yesnofield",columnWidth:.5,boxLabel:"隐藏",name:"hideBorder"},{fieldLabel:"数据源配置",xtype:"textfield",hidden:!0,name:"dsCfg"},{fieldLabel:"属性覆盖",xtype:"jsonarrayfield",labelAlign:"top",name:"attrs",columnWidth:1,insertFn:function(a){JE.selectWin({title:"图表属性",type:"tree",rootData:{id:"ROOT",children:[{id:"caption",text:"标题",leaf:!0},{id:"subcaption",text:"子标题",leaf:!0},{id:"xaxisname",text:"X轴标题",leaf:!0},{id:"yaxisname",text:"Y轴标题",leaf:!0},{id:"showvalues",text:"显示数值",leaf:!0},{id:"showlabels",text:"显示标签",leaf:!0},{id:"showtooltip",text:"显示提示信息",leaf:!0},{id:"showlegend",text:"显示图例",leaf:!0},{id:"legendposition",text:"图例位置",leaf:!0},{id:"palettecolors",text:"配色",leaf:!0}]},multiSelect:!0,callback:function(e){var n=[];Ext.each(e,function(t){var i=!0;a.store.each(function(e){if(e.get("code")==t.get("id"))return i=!1}),i&&n.push({code:t.get("id"),name:t.get("text")})}),0<n.length&&a.store.add(n)}})},columns:[{dataIndex:"code",flex:1,editable:!1,text:"编码"},{dataIndex:"name",flex:1,editable:!1,text:"名称"},{dataIndex:"value",flex:1,text:"配置项"}]},{fieldLabel:"默认参数值",xtype:"jsonarrayfield",labelAlign:"top",name:"params",columnWidth:1,insertFn:function(a){var e=Ext.decode(Ext.value(n.form.findField("dsCfg").getValue(),"{}")),t=Ext.decode(Ext.value(e.params,"[]")),i={id:"ROOT",children:[]};Ext.each(t,function(e){i.children.push({code:e.code,text:e.name,hidden:e.hidden,value:e.value,leaf:!0,checked:!1})}),JE.selectWin({title:"参数",type:"tree",rootData:i,multiSelect:!0,callback:function(e){var n=[];Ext.each(e,function(e){var t=!0,i=e.raw;a.store.each(function(e){if(e.get("code")==i.code)return t=!1}),t&&n.push({code:i.code,name:i.text,value:i.value})}),0<n.length&&a.store.add(n)}})},columns:[{dataIndex:"code",flex:1,editable:!1,text:"编码"},{dataIndex:"name",flex:1,editable:!1,text:"名称"},{dataIndex:"value",flex:1,text:"值"}]}],n.callParent(arguments)}}),Ext.define("JE.sys.portal.view.bk.ClockView",{extend:"Ext.form.Panel",layout:"column",alias:"widget.portal.bkclockview",initComponent:function(){var a=this;a.bodyPadding="5",a.defaults={labelWidth:80,labelAlign:"right",columnWidth:.95,margin:"2 0",listeners:{change:function(e,t){var i=a.getValues(),n='<embed src="'+JE.getStaticUrl("JE.core.util.PortalUtil."+i.theam.replace(".swf",""),"swf")+'" width="100%" height="100%"></embed>';a.getComponent("clockBox").update(n)}}},a.items=[{name:"theam",xtype:"cbbfield",fieldLabel:"时钟样式",value:"时钟9.swf",dataArray:[{code:"时钟1.swf",text:"时钟1.swf"},{code:"时钟2.swf",text:"时钟2.swf"},{code:"时钟3.swf",text:"时钟3.swf"},{code:"时钟4.swf",text:"时钟4.swf"},{code:"时钟5.swf",text:"时钟5.swf"},{code:"时钟6.swf",text:"时钟6.swf"},{code:"时钟7.swf",text:"时钟7.swf"},{code:"时钟8.swf",text:"时钟8.swf"},{code:"时钟9.swf",text:"时钟9.swf"},{code:"时钟10.swf",text:"时钟10.swf"},{code:"时钟11.swf",text:"时钟11.swf"}]},{xtype:"box",height:260,style:"border:1px #99bce8 solid;",columnWidth:1,itemId:"clockBox"}],a.callParent(arguments)},afterRender:function(){this.callParent(arguments);var e=this.form.findField("theam");e.fireEvent("change",e,"")}}),Ext.define("JE.sys.portal.view.bk.CodeView",{extend:"Ext.panel.Panel",alias:"widget.portal.bkcodeview",border:0,defValue:'/*\n 自定义组件\n 返回Ext组件或者组件配置项,如:Ext.create("Ext.form.Panel",{})或者{xtype:"form"}\n*/\nfunction(){\n\treturn {}\n}',editorValue:"",initComponent:function(){var t=this;t.layout="fit",t.items={xtype:"jecodeeditor",border:0,itemId:"editor",saveFn:function(e){t.ownerCt.ownerPanel.configData.code=e,JE.msg("保存成功！")}},t.callParent(arguments),t.editor=t.getCmp("editor")},setValues:function(e){this.editorValue=Ext.value(e.code,""),this.editor.setValue(this.editorValue)},getValues:function(){return{code:Ext.value(this.editor.getValue(),this.editorValue)}}}),Ext.define("JE.sys.portal.view.bk.DaoHangView",{extend:"Ext.form.Panel",layout:"column",alias:"widget.portal.bkdaohangview",initComponent:function(){this.bodyPadding="5",this.defaults={labelWidth:80,labelAlign:"right",columnWidth:.95,margin:"2 0"},this.items=[{fieldLabel:"名称",xtype:"gridssfield",configInfo:"JE_CORE_PROTAL,id~name,JE_CORE_PROTAL_ID~PROTAL_BT,S,",whereSql:" and PROTAL_TYPE = 'MENU' and PROTAL_QY_CODE = '1' ",name:"name"},{xtype:"textarea",fieldLabel:"配置项",height:200,name:"id"}],this.callParent(arguments)}}),Ext.define("JE.sys.portal.view.bk.DataView",{extend:"Ext.form.Panel",layout:"column",alias:"widget.portal.bkdataview",initComponent:function(){var d=this;d.bodyPadding="5",d.defaults={labelWidth:80,labelAlign:"right",columnWidth:.95,margin:"2 0"},d.items=[{xtype:"gridssfield",name:"funcName",configInfo:"JE_CORE_FUNCINFO,funcId~funcCode~funcName~whereSql~orderSql~tableName~pkName,JE_CORE_FUNCINFO_ID~FUNCINFO_FUNCCODE~FUNCINFO_FUNCNAME~FUNCINFO_WHERESQL~FUNCINFO_ORDERSQL~FUNCINFO_TABLENAME~FUNCINFO_PKNAME,S",fieldLabel:"功能",whereSql:" AND SY_JESYS='1' ",listeners:{query:function(e,t){if(JE.isNotEmpty(t)){Ext.value(t[0].get("FUNCINFO_FUNCACTION"),JE.getUrlMaps("je.core"));d.form.setValues({dataUrl:JE.getUrlMaps("je.core","load")})}}}},{xtype:"fieldcontainer",fieldLabel:"字段",items:{xtype:"button",text:"选择字段",handler:function(e){var t=d.form.findField("funcId").getValue();if(Ext.isEmpty(t))JE.alert("请选择功能后再选择字段！");else{var i=" and RESOURCECOLUMN_FUNCINFO_ID = '"+t+"' and RESOURCECOLUMN_XTYPE in('uxcolumn','uxcheckcolumn')";JE.selectWin({title:"字段",configInfo:"JE_CORE_VCOLUMNANDFIELD,,,M",type:"grid",whereSql:i,okButtonClick:function(e,t){},callback:function(e){var t=d.form.findField("fields"),n=t.getData(),a=[].concat(n);Ext.each(e,function(t){var i=!0;Ext.each(n,function(e){if(e.code==t.get("RESOURCECOLUMN_CODE"))return i=!1,e.modelData=t.data,!1}),i&&a.push({code:t.get("RESOURCECOLUMN_CODE"),name:t.get("RESOURCECOLUMN_NAME"),width:t.get("RESOURCECOLUMN_WIDTH"),name_en:Ext.value(t.get("RESOURCECOLUMN_NAME_EN"),""),width_en:Ext.value(t.get("RESOURCECOLUMN_WIDTH_EN"),""),modelData:t.data})}),t.setValue(a)}})}},width:100}},{xtype:"jsonarrayfield",name:"fields",height:120,columnWidth:1,insertFn:function(e){var t=d.form.findField("funcId").getValue();Ext.isEmpty(t)?JE.alert("请选择功能后再编辑事件！"):e.store.add({})},columns:[{dataIndex:"code",width:120,text:"编码"},{dataIndex:"name",width:120,text:"名称"},{dataIndex:"name_en",width:120,text:"英文名"},{dataIndex:"width",width:50,text:"宽度",field:{xtype:"numberfield"}},{dataIndex:"width_en",width:60,text:"英文宽度",field:{xtype:"numberfield"}},{dataIndex:"events",hidden:!0},{dataIndex:"modelData",hidden:!0},{dataIndex:"hidden",text:"隐藏",width:40,xtype:"uxcheckcolumn"},{xtype:"actioncolumn",width:40,text:"事件",items:[{tooltip:"编辑",getClass:function(e,t,i){return JE.CoreUtil.isFireListener(i.get("events"))?"jeicon jeicon-lightning-on":"jeicon jeicon-lightning-off"},handler:function(e,t,i,n,a,l){e.panel;var o=d.form.findField("funcId").getValue();JE.win({title:"事件",border:0,items:{xtype:"jelistenereditor",type:"column",value:l.get("events"),funcId:o,saveFn:function(e){l.set("events",JE.encode(e))}}}).show()}}]}]},{xtype:"gridssfield",configInfo:"JE_CORE_VCOLUMNANDFIELD,treeQuery~treeQueryCfg,RESOURCECOLUMN_CODE~RESOURCEFIELD_CONFIGINFO,S",whereSql:" and RESOURCECOLUMN_FUNCINFO_ID = '{funcId}' and RESOURCECOLUMN_XTYPE in('uxcolumn','uxcheckcolumn') and RESOURCEFIELD_XTYPE IN('cbbfield','rgroup','cgroup','treessfield','treessareafield')",name:"treeQuery",columnWidth:.7,fieldLabel:"快速查询"},{xtype:"numberfield",columnWidth:.3,name:"treeQueryWidth",value:150,editable:!0,labelWidth:40,fieldLabel:"宽度"},{xtype:"hidden",name:"treeQueryCfg",fieldLabel:"配置项"},{xtype:"textfield",name:"whereSql",fieldLabel:"whereSql"},{xtype:"textfield",name:"orderSql",fieldLabel:"orderSql"},{xtype:"textfield",name:"dataUrl",fieldLabel:"数据URL"},{xtype:"yesnofield",name:"hideHeader",labelWidth:60,columnWidth:.2,fieldLabel:"隐藏表头"},{xtype:"yesnofield",name:"useRowNum",labelWidth:60,columnWidth:.2,fieldLabel:"启用序号"},{xtype:"yesnofield",name:"usePage",labelWidth:60,columnWidth:.2,fieldLabel:"启用分页"},{xtype:"numberfield",name:"pageSize",labelWidth:60,columnWidth:.3,fieldLabel:"每页条数"},{xtype:"rgroup",name:"dblclick",dataArray:[{code:"no",text:"无"},{code:"form",text:"双击详细信息"},{code:"idit",text:"自定义"}],columnWidth:.7,labelWidth:40,fieldLabel:"事件"},{xtype:"button",text:"编辑事件",handler:function(){if("idit"==d.form.findField("dblclick").getValue()){var e=d.form.findField("funcId").getValue(),t=d.form.findField("listeners");JE.win({title:"事件",border:0,items:{xtype:"jelistenereditor",type:"grid",value:t.getValue(),funcId:e,saveFn:function(e){t.setValue(JE.encode(e))}}}).show()}else JE.alert("只有自定义才可以编辑事件")},columnWidth:.25},{xtype:"colorfield",name:"rightBorderColor",labelWidth:60,columnWidth:.5,fieldLabel:"表格竖线"},{xtype:"colorfield",name:"bottomBorderColor",labelWidth:60,columnWidth:.5,fieldLabel:"表格横线"},{xtype:"yesnofield",name:"stripeRows",labelWidth:60,columnWidth:.2,fieldLabel:"隔行变色"},{xtype:"yesnofield",name:"editableFunc",labelWidth:90,columnWidth:.2,fieldLabel:"编辑功能"},{xtype:"hidden",name:"listeners"},{xtype:"hidden",name:"funcCode"},{xtype:"hidden",name:"funcId"},{xtype:"hidden",name:"tableName"},{xtype:"hidden",name:"pkName"}],d.callParent(arguments)}}),Ext.define("JE.sys.portal.view.bk.HtmlView",{extend:"Ext.form.Panel",layout:"column",alias:"widget.portal.bkhtmlview",initComponent:function(){this.bodyPadding="5",this.defaults={labelWidth:80,labelAlign:"right",columnWidth:.95,margin:"2 0"},this.items=[{xtype:"textfield",name:"action",fieldLabel:"数据Action"},{xtype:"jsonfield",name:"params",height:100,fieldLabel:"请求参数"},{xtype:"textarea",name:"htmlTpl",height:180,fieldLabel:"HTML模版"}],this.callParent(arguments)}}),Ext.define("JE.sys.portal.view.bk.IconView",{extend:"Ext.form.Panel",layout:"column",alias:"widget.portal.bkiconview",initComponent:function(){var i=this;i.bodyPadding="5",i.defaults={labelWidth:80,labelAlign:"right",columnWidth:.95,margin:"2 0"},i.items=[{xtype:"colorfield",name:"bgColor",fieldLabel:"展板颜色"},{xtype:"gridssfield",configInfo:"JE_CORE_FONTICON,iconCls,FONTICON_CLS,S",name:"iconCls",fieldLabel:"背景图标"},{xtype:"numberfield",name:"iconSize",fieldLabel:"图标大小",columnWidth:.5},{xtype:"colorfield",name:"iconColor",fieldLabel:"图标颜色",columnWidth:.45},{xtype:"rgroup",name:"iconVAlign",value:"top",dataArray:[{code:"top",text:"上"},{code:"middle",text:"中"},{code:"bottom",text:"下"}],fieldLabel:"上下位置"},{xtype:"rgroup",name:"iconAlign",value:"right",dataArray:[{code:"left",text:"左"},{code:"center",text:"中"},{code:"right",text:"右"}],fieldLabel:"左右位置"},{xtype:"numberfield",name:"innerPadding",fieldLabel:"内边距"},{xtype:"gridssfield",configInfo:"JE_CORE_DATASOURCE,dsName~dsCode,DATASOURCE_TEXT~DATASOURCE_CODE,S",name:"dsName",fieldLabel:"数据源"},{xtype:"hidden",name:"dsCode"},{fieldLabel:"正文",xtype:"fieldcontainer",itemId:"jsFC",items:[{xtype:"button",itemId:"addBtn",text:"添加",iconCls:"jeicon jeicon-lightning-off",handler:function(){var t=i.form.findField("tplFn"),e=t.getValue();e=Ext.value(e,"/*\n\t*data 数据源数据\n\t*return html 标准的html字符串\n\t*html中常用样式：text,text-small\n*/\nfunction(data){\n\n}"),JE.win({title:"模板方法",autoShow:!0,items:{xtype:"jecodeeditor",value:e,saveFn:function(e){t.setValue(e),JE.msg("保存成功！")}}})}}]},{xtype:"hidden",name:"tplFn",listeners:{change:function(e,t){i.getCmp("jsFC").getCmp("addBtn").setIconCls(JE.isEmpty(t)?"jeicon jeicon-lightning-off":"jeicon jeicon-lightning-on")}}}],i.callParent(arguments)}}),Ext.define("JE.sys.portal.view.bk.LinkView",{extend:"Ext.form.Panel",layout:"column",alias:"widget.portal.bklinkview",initComponent:function(){this.bodyPadding="5",this.defaults={labelWidth:80,labelAlign:"right",columnWidth:.95,margin:"2 0"},this.items=[{xtype:"textfield",name:"name",fieldLabel:"编码"},{xtype:"textarea",name:"iframe",fieldLabel:"iframe地址"},{xtype:"jsonfield",name:"params",fieldLabel:"请求参数"}],this.callParent(arguments)}}),Ext.define("JE.sys.portal.view.bk.NewsView",{extend:"Ext.form.Panel",layout:"column",alias:"widget.portal.bknewsview",initComponent:function(){this.bodyPadding="5",this.defaults={labelWidth:80,labelAlign:"right",columnWidth:.95,margin:"2 0"},this.callParent(arguments)}}),Ext.define("JE.sys.portal.view.bk.ReportView",{extend:"Ext.form.Panel",layout:"column",alias:"widget.portal.bkreportview",initComponent:function(){var n=this;n.bodyPadding="5",n.defaults={labelWidth:80,labelAlign:"right",columnWidth:.95,margin:"2 0"},n.items=[{fieldLabel:"报表",xtype:"treessfield",name:"text",whereSql:" AND SY_JESYS='1'",configInfo:"JE_CORE_REPORT,code~text~dsCfg,code~text~bean.REPORT_DSCONFIG,S"},{fieldLabel:"编码",xtype:"textfield",name:"code"},{fieldLabel:"查询信息",xtype:"yesnofield",boxLabel:"隐藏",columnWidth:.5,name:"hideSearchBar"},{fieldLabel:"边框",xtype:"yesnofield",columnWidth:.5,boxLabel:"隐藏",name:"hideBorder"},{fieldLabel:"数据源配置",xtype:"textfield",hidden:!0,name:"dsCfg"},{fieldLabel:"默认参数值",xtype:"jsonarrayfield",labelAlign:"top",name:"params",columnWidth:1,insertFn:function(a){var e=Ext.decode(Ext.value(n.form.findField("dsCfg").getValue(),"{}")),t=Ext.decode(Ext.value(e.params,"[]")),i={id:"ROOT",children:[]};Ext.each(t,function(e){i.children.push({code:e.code,text:e.name,hidden:e.hidden,value:e.value,leaf:!0,checked:!1})}),JE.selectWin({title:"参数",type:"tree",rootData:i,multiSelect:!0,callback:function(e){var n=[];Ext.each(e,function(e){var t=!0,i=e.raw;a.store.each(function(e){if(e.get("code")==i.code)return t=!1}),t&&n.push({code:i.code,name:i.text,value:i.value})}),0<n.length&&a.store.add(n)}})},columns:[{dataIndex:"code",flex:1,editable:!1,text:"编码"},{dataIndex:"name",flex:1,editable:!1,text:"名称"},{dataIndex:"value",flex:1,text:"值"}]}],n.callParent(arguments)}}),Ext.define("JE.sys.portal.view.bk.WeatherView",{extend:"Ext.form.Panel",layout:"column",alias:"widget.portal.bkweatherview",initComponent:function(){var o=this;o.bodyPadding="5",o.defaults={labelWidth:90,labelAlign:"right",columnWidth:.95,margin:"2 0",listeners:{change:function(e){var t="http://tianqi.2345.com/plugin/widget/index.htm?s=2&z=1&t=1&v=0&d=3&bd=0&k=&f=&ltf=009944&htf=cc0000&q=1&e=1&a=1&c=54511&w=565&h=98&align=center",i='<iframe allowtransparency="true" frameborder="0" width="100%" height="100%" scrolling="auto" src="{src}"></iframe>',n=Ext.apply(o.form.getValues(),{q:1,e:1,a:1}),a="";Ext.iterate(n,function(e,t){a+="&"+e+"="+t}),t+=a="?"+a.substring(1),i=i.replace("{src}",t);var l=!1;"3"==n.s&&(l=!0),Ext.each(["z","t","v","d"],function(e,t){var i=o.form.findField(e);0==t?i[l?"show":"hide"]():i[l?"hide":"show"]()}),o.getComponent("weatherBox").update(i)}}},o.items=[{xtype:"rgroup",name:"s",value:"2",dataArray:[{code:"1",text:"经典风格"},{code:"2",text:"3D渲染"},{code:"3",text:"简约风格"}],fieldLabel:"风格"},{xtype:"rgroup",name:"z",value:"2",dataArray:[{code:"1",text:"纯文字"},{code:"2",text:"3D小图"},{code:"3",text:"经典小图"}],fieldLabel:"样式"},{xtype:"rgroup",name:"t",value:"1",dataArray:[{code:"1",text:"大"},{code:"0",text:"小"}],fieldLabel:"图标大小"},{xtype:"rgroup",name:"v",value:"0",dataArray:[{code:"0",text:"横版"},{code:"1",text:"竖版"}],fieldLabel:"板式"},{xtype:"rgroup",name:"d",value:"1",dataArray:[{code:"1",text:"1天"},{code:"2",text:"2天"},{code:"3",text:"3天"},{code:"4",text:"4天"},{code:"5",text:"5天"}],fieldLabel:"显示几天天气"},{xtype:"box",height:180,style:"border:1px #99bce8 solid;",columnWidth:1,itemId:"weatherBox"}],o.callParent(arguments)},afterRender:function(){this.callParent(arguments);var e=this.form.findField("s");e.fireEvent("change",e,"")}}),Ext.define("JE.sys.portal.view.menu.Attrs",{extend:"Ext.form.Panel",alias:"widget.portal.menuattrs",bodyPadding:4,bodyStyle:{"background-color":"#f1f1f1"},initComponent:function(){var d=this;d.defaults={anchor:"100%",labelAlign:"right",labelWidth:60,listeners:{change:function(e,t,i){var n=d.editor.editor.graph,a=n.getSelectionCell();if(a){if("label"==e.name){n.cellLabelChanged(a,t);var l=t;d.form.setValues({label:l})}else if("iconPath"==e.name){var o=Ext.value(a.getStyle(),"");o=mxUtils[Ext.isEmpty(t)?"removeStylename":"addStylename"](o,"image"),o=mxUtils.setStyle(o,"image",t),n.getModel().setStyle(a,o)}a.setAttribute(e.name,t)}}}},d.tbar=[{text:"选择菜单",iconCls:"jeicon jeicon-menu",handler:function(){JE.selectWin({title:"菜单",type:"tree",configInfo:"JE_CORE_MENU",expandRootChild:!1,okButtonClick:function(e,t){if(Ext.isEmpty(e))return!1;var i=e[0].data;if("MENU"==i.nodeInfoType)return JE.alert("请选择功能菜单！"),!1;var n={menuId:i.id,label:i.text,title:i.text,iconCls:i.iconCls,info:i.nodeInfo,type:i.nodeInfoType,funcType:Ext.value(i.hrefTarget,"grid"),enable:"1"};d.form.setValues(n)}})}},{text:"修改图标",iconCls:"jeicon jeicon-photo",handler:function(){var e=d.up("panel[xtype=portal.menumainview]"),t=e.mainGrid.funcData;JE.win({title:"图标上传",width:650,height:350,items:{xtype:"uploadpanel",upload_url:JE.getUrlMaps("je.core.uploadFile")+"?login=TRUE",file_post_name:"formUploadFiles",post_params:{funcCode:t.info.funcCode,tableCode:t.info.tableName,pkValue:e.mainRecord.get(t.info.pkName),filePath:"/portalImg",beanTableCode:t.info.tableName},failure:function(e,t,i){JE.error(t+"\n"+i)},success:function(e,t,i){var n=Ext.decode(Ext.value(t,"{}"));1==n.success?(JE.msg("修改成功"),d.form.setValues({iconPath:n.obj})):JE.error(t,t)}}}).show()}},{text:"清除图标",iconCls:"jeicon jeicon-trash-o",handler:function(){d.form.setValues({iconPath:""})}}],d.items=[{xtype:"textarea",height:50,fieldLabel:"标签",name:"label"},{xtype:"textfield",fieldLabel:"标题",name:"title"},{xtype:"gridssfield",fieldLabel:"标题图标",configInfo:"JE_CORE_FONTICON,iconCls,FONTICON_CLS,S",name:"iconCls"},{xtype:"rgroup",fieldLabel:"启用",configInfo:"YESORNO",value:"1",name:"enable"},{xtype:"rgroup",fieldLabel:"单击操作",value:"func",name:"clickType",dataArray:[{code:"func",text:"打开功能"},{code:"idit",text:"自定义事件"}]},{xtype:"button",anchor:"80%",style:"float:right;",hidden:!0,itemId:"editEvent",margin:"0 0 4 4",text:"编辑单击事件"},{fieldLabel:"类型",xtype:"cbbfield",configInfo:"JE_MENUTYPE",name:"type"},{xtype:"button",anchor:"50%",style:"float:right;",hidden:!0,itemId:"selectFunc",margin:"0 0 4 4",text:"选择功能"},{xtype:"cbbfield",fieldLabel:"功能类型",configInfo:"JE_MENU_FUNCTYPE",name:"funcType",value:"grid"},{xtype:"textarea",fieldLabel:"信息",name:"info",height:200},{xtype:"box",padding:"5",margin:"2",cls:"x-view-emtpytext",data:{},itemId:"helpMsg",tpl:["<b>配置信息说明：</b>",'<tpl if="text">',"</br>{text}","<tpl else>","无","</tpl>"]},{xtype:"hidden",name:"menuId"},{xtype:"hidden",fieldLabel:"图标路径",name:"iconPath"},{xtype:"hidden",fieldLabel:"单击事件",name:"clickEvent"}],d.callParent(arguments)},afterRender:function(){this.callParent(arguments)}}),Ext.define("JE.sys.portal.view.menu.Editor",{extend:"JE.sys.flowchart.util.Editor",initAction:function(){this.callParent(arguments)},initEvent:function(){var d=this,r=d.editor;r.graph.addListener(mxEvent.LABEL_CHANGED,function(e,t){var i=t.getProperty("cell"),n=t.getProperty("value");if(n!=t.getProperty("old").getAttribute("label")&&!i.isEdge()){var a=n;d.ownerCt.ownerCt.getCmp("menuattrs").getCmp("cellAttrs").form.setValues({label:a})}}),r.graph.getSelectionModel().addListener(mxEvent.CHANGE,function(e,t){var i=r.graph.getSelectionCell(),n=d.ownerCt.ownerCt.getCmp("menuattrs"),a="graphAttrs";if(i&&!i.isEdge()){a="cellAttrs";var l=n.getCmp(a),o={};Ext.iterate(l.getValues(),function(e,t){o[e]=Ext.value(i.getAttribute(e),""),"menuId"==e&&Ext.isEmpty(o.menuId)&&(o.menuId=JE.uuid()),"basicStyle"==e&&Ext.isEmpty(o.basicStyle)&&(o.basicStyle=i.getStyle())}),l.form.setValues(o)}else{(l=n.getCmp(a)).form.setValues(l.infoData)}n.getLayout().setActiveItem(a)})}}),Ext.define("JE.sys.portal.view.menu.GraphAttrs",{extend:"Ext.form.Panel",alias:"widget.portal.menugraphattrs",bodyPadding:4,bodyStyle:{"background-color":"#f1f1f1"},initComponent:function(){var l=this;l.defaults={anchor:"100%",labelAlign:"right",labelWidth:60,listeners:{change:function(e,t,i){l.editor.editor.graph;var n=l.ownerCt.ownerCt.getCmp("flowchart.graph").getGraphEl();if("bgImage"==e.name){var a="";Ext.isEmpty(t)||(a=t),n.setStyle("background-image","url("+a+")")}else"bgImageRepeat"==e.name?n.setStyle("background-repeat",Ext.value(t,"no-repeat")):"bgColor"==e.name&&n.setStyle("background-color",Ext.value(t,"#FFFFFF"));l.infoData[e.name]=t}}},l.infoData=Ext.value(l.infoData,{});var e=l.mainGrid.funcData;l.tbar=[{text:"修改背景图片",iconCls:"jeicon jeicon-photo",handler:function(){JE.win({title:"图片上传",width:650,height:350,items:{xtype:"uploadpanel",upload_url:JE.getUrlMaps("je.core.uploadFile")+"?login=TRUE",file_post_name:"formUploadFiles",post_params:{funcCode:e.info.funcCode,tableCode:e.info.tableName,pkValue:l.mainRecord.get(e.info.pkName),filePath:"/portalImg",beanTableCode:e.info.tableName},failure:function(e,t,i){JE.error(t+"\n"+i)},success:function(e,t,i){var n=Ext.decode(Ext.value(t,"{}"));1==n.success?l.form.setValues({bgImage:n.obj}):JE.error(t,t)}}}).show()}},{text:"清除背景图片",iconCls:"jeicon jeicon-trash-o",handler:function(){l.form.setValues({bgImage:""})}}],l.items=[{xtype:"hidden",fieldLabel:"背景图片",name:"bgImage"},{xtype:"cbbfield",fieldLabel:"背景图片",name:"bgImageRepeat",value:"no-repeat",dataArray:[{code:"no-repeat",text:"不平铺"},{code:"repeat",text:"平铺"},{code:"repeat-x",text:"纵向平铺"},{code:"repeat-y",text:"横向平铺"}]},{xtype:"colorfield",fieldLabel:"背景颜色",name:"bgColor"},{xtype:"yesnofield",fieldLabel:"画布居中",name:"graphCenter"},{xtype:"textfield",fieldLabel:"画布范围",name:"graphWH",unitTpl:"(宽*高)"}],l.callParent(arguments)},afterRender:function(){this.callParent(arguments)},loadAttrs:function(e){delete(e=Ext.value(e,{})).xmlCode,this.infoData=e,this.form.setValues(e)}}),Ext.define("JE.sys.portal.view.menu.MainView",{extend:"JE.sys.flowchart.view.MainView",alias:"widget.portal.menumainview",initComponent:function(){var n=this;n.editor=Ext.create("JE.sys.portal.view.menu.Editor",{saveAction:function(e){var t=n.getCmp("menuattrs").getCmp("graphAttrs").infoData;t.xmlCode=e,n.mainRecord.set("PROTAL_DATA",Ext.encode(t));var i=n.mainGrid.getButton("gridUpdateBtn");i.fireEvent("click",i)}}),n.editor.editor.graph.defaultGraphBackground="transparent",n.defaults={collapsible:!0,split:!0,editor:n.editor},n.items=[{xtype:"panel",itemId:"menuattrs",region:"east",layout:"card",title:"属性",maxWidth:350,minWidth:200,width:250,defaults:{border:0},items:[{xtype:"portal.menugraphattrs",editor:n.editor,mainRecord:n.mainRecord,mainGrid:n.mainGrid,itemId:"graphAttrs"},{xtype:"portal.menuattrs",editor:n.editor,itemId:"cellAttrs"}]}],n.callParent(arguments)},afterRender:function(){this.callParent(arguments),this.getCmp("flowchart.graph").setBodyStyle("background-image","none");var e=Ext.decode(Ext.value(this.mainRecord.get("PROTAL_DATA"),"{}"));this.editor.loadData(e.xmlCode),this.getCmp("menuattrs").getCmp("graphAttrs").loadAttrs(e);var t=this.editor.editor.graph;t.setGridEnabled(!1),t.view.validateBackground()}}),Ext.define("JE.sys.portal.controller.MainController",{extend:"Ext.app.Controller",init:function(){var e={"[xtype=portal.menuattrs] cbbfield[name=type]":{change:function(e,t,i,n){var a=e.up("form"),l=!1;"MT"!=t&&"PORTAL"!=t||(l=!0),a.getCmp("selectFunc").setVisible(l),a.form.findField("funcType").setVisible("MT"==t),a.getComponent("helpMsg").update({text:JE.helpMsg.menu[t]})}},"[xtype=portal.menuattrs] button[itemId=selectFunc]":{click:function(e){var t=e.up("form"),i="",n="",a="grid",l="",o=t.form.findField("type").getValue();"MT"==o?(l="功能",a="tree",n="JE_CORE_FUNCINFO,info~title,code~text,S,",i=" AND SY_JESYS='1' AND FUNCINFO_NODEINFOTYPE!='FUNCFIELD'"):"PORTAL"==o&&(l="首页portal",a="grid",n="JE_CORE_PROTAL,info~title~iconCls,JE_CORE_PROTAL_ID~PROTAL_BT~PROTAL_CLS,S,",i=" and PROTAL_JHFS_CODE = 'func' and PROTAL_QY_CODE = '1' "),JE.selectWin({title:l,configInfo:n,type:a,parent:t,parentType:"form",whereSql:i})}},"[xtype=portal.menuattrs] rgroup[name=clickType]":{change:function(e,t,i,n){var a=e.up("form"),l=a.form.findField("type"),o=a.form.findField("info"),d=a.getCmp("helpMsg"),r=a.getCmp("editEvent"),c=!1,s=!1,E="";"func"==t?(c=!0,E=l.getValue()):"idit"==t&&(s=!0),l.fireEvent("change",l,E),l.setVisible(c),o.setVisible(c),d.setVisible(c),r.setVisible(s)}},"[xtype=portal.menuattrs] button[itemId=editEvent]":{click:function(e){var t=e.up("form").form.findField("clickEvent"),i=Ext.value(t.getValue(),"function(mainview){\n\n}");JE.win({title:"单击事件(Ctrl+S保存)",width:800,height:600,items:{xtype:"jecodeeditor",value:i,itemId:"editorview",saveFn:function(e){t.setValue(e),JE.msg("保存成功...")},border:0}}).show()}}};this.control(e)},views:["JE.sys.portal.view.MainView","JE.sys.portal.view.KJView","JE.sys.portal.view.BKView","JE.sys.portal.view.StyleView","JE.sys.portal.view.EXView","JE.sys.portal.view.bk.DataView","JE.sys.portal.view.bk.AppView","JE.sys.portal.view.bk.HtmlView","JE.sys.portal.view.bk.LinkView","JE.sys.portal.view.bk.WeatherView","JE.sys.portal.view.bk.NewsView","JE.sys.portal.view.bk.ClockView","JE.sys.portal.view.bk.CalendarView","JE.sys.portal.view.bk.ChartView","JE.sys.portal.view.bk.DaoHangView","JE.sys.portal.view.bk.IconView","JE.sys.portal.view.menu.MainView","JE.sys.portal.view.menu.Attrs","JE.sys.portal.view.menu.GraphAttrs","JE.sys.portal.view.bk.CodeView","JE.sys.portal.view.bk.ReportView"],stores:[],models:[]}),Ext.define("JE.sys.workflow.util.Util",{taskNodeEvent:function(a,e,t,i,n){var l=this;if(!Ext.isEmpty(i)){if(!l.funcFields){var o=Ext.create("Ext.util.MixedCollection"),d=JE.ajax({url:JE.getUrlMaps("je.core.load"),params:{tableCode:"JE_CORE_RESOURCEFIELD",whereSql:" AND RESOURCEFIELD_FUNCINFO_ID='"+i+"' AND RESOURCEFIELD_XTYPE!='child'",orderSql:" ORDER BY SY_ORDERINDEX",limit:-1}}).rows;Ext.each(d,function(e){o.add(e.RESOURCEFIELD_CODE,{text:e.RESOURCEFIELD_NAME,code:e.RESOURCEFIELD_CODE,edit:"0",hide:"0",show:"0",readOnly:"0"})}),l.funcFields=o}if(!l.funcButtons){var r=Ext.create("Ext.util.MixedCollection"),c=JE.ajax({url:JE.getUrlMaps("je.core.load"),params:{tableCode:"JE_CORE_RESOURCEBUTTON",whereSql:" AND RESOURCEBUTTON_FUNCINFO_ID='"+i+"'  AND RESOURCEBUTTON_TYPE IN ('FORM','form')",orderSql:" ORDER BY SY_ORDERINDEX",limit:-1}}).rows;Ext.each(c,function(e){r.add(e.RESOURCEBUTTON_CODE,{text:e.RESOURCEBUTTON_NAME,code:e.RESOURCEBUTTON_CODE,value:"0"})}),l.funcButtons=r}if(!l.funcChildren){var s=Ext.create("Ext.util.MixedCollection"),E=JE.ajax({url:JE.getUrlMaps("je.core.load"),params:{tableCode:"JE_CORE_FUNCRELATION",whereSql:" AND FUNCRELATION_FUNCINFO_ID='"+i+"'",orderSql:" ORDER BY SY_ORDERINDEX",limit:-1}}).rows;Ext.each(E,function(e){s.add(e.FUNCRELATION_CODE,{text:e.FUNCRELATION_NAME,code:e.FUNCRELATION_CODE,edit:"0",hide:"0",show:"0"})}),l.funcChildren=s}}e.processVals=n,e.form.setValues(t);var f=JE.toObj(t.editFields);if(!Ext.isEmpty(i)&&(Ext.isEmpty(f)||!(0<f.length))){var u=Ext.value(t.editFields,"").split(","),p=Ext.value(t.hideFields,"").split(","),m=Ext.value(t.showFields,"").split(","),x=Ext.value(t.readOnlyFields,"").split(","),g=Ext.value(t.notNullFields,"").split(","),C=Ext.value(t.changeFields,"").split(","),h=new Array;Ext.each(Ext.clone(l.funcFields.items),function(e){-1!=u.indexOf(e.code)?e.edit="1":e.edit="0",-1!=p.indexOf(e.code)?e.hide="1":e.hide="0",-1!=m.indexOf(e.code)?e.show="1":e.show="0",-1!=x.indexOf(e.code)?e.readOnly="1":e.readOnly="0",-1!=g.indexOf(e.code)?e.notNull="1":e.notNull="0",-1!=C.indexOf(e.code)?e.change="1":e.change="0",h.push(e)}),e.form.findField("editFields").setValue(h)}var b=JE.toObj(t.editChildren);if(!Ext.isEmpty(i)&&(Ext.isEmpty(b)||!(0<b.length))){var y=Ext.value(t.editChildren,"").split(","),O=Ext.value(t.hideChildren,"").split(","),I=Ext.value(t.showChildren,"").split(",");h=new Array;Ext.each(Ext.clone(l.funcChildren.items),function(e){-1!=y.indexOf(e.code)?e.edit="1":e.edit="0",-1!=O.indexOf(e.code)?e.hide="1":e.hide="0",-1!=I.indexOf(e.code)?e.show="1":e.show="0",h.push(e)}),e.form.findField("editChildren").setValue(h)}var R=JE.toObj(t.enabledButtons);if(!Ext.isEmpty(i)&&(Ext.isEmpty(R)||!(0<R.length))){var S=Ext.value(t.enabledButtons,"").split(",");h=new Array;Ext.each(Ext.clone(l.funcButtons.items),function(e){-1!=S.indexOf(e.code)?e.value="1":e.value="0",h.push(e)}),e.form.findField("enabledButtons").setValue(h)}var _=JE.toObj(t.fieldsConfig);if(!Ext.isEmpty(i)&&(Ext.isEmpty(_)||!(0<_.length))){var N=Ext.value(Ext.value(t.fieldsConfig,"").split(",")[0],"").split("~"),w=Ext.value(Ext.value(t.fieldsConfig,"").split(",")[1],"").split("~");h=new Array;Ext.each(Ext.clone(l.funcFields.items),function(e){var t=w.indexOf(e.code);e.value=-1!=t?N[t]:"",h.push(e)}),e.form.findField("fieldsConfig").setValue(h)}["end","start"].indexOf(t.type),Ext.each(a.edges,function(e,t){e.target&&e.target.getAttribute("name")==a.getAttribute("name")&&e.source&&e.source.getAttribute("type")});var v=e.form.findField("assgineConfig");v.items.each(function(e){e.items.items[0].getStore().loadData(JE.getDicItems("JE_WF_TARGERTYPE")),e.items.items[7].show()});var L=-1!=["task","circular","decision","joint","to_assignee"].indexOf(a.getAttribute("type")),F=-1!=["task","circular","decision","joint","to_assignee"].indexOf(a.getAttribute("type")),T=-1!=["task","circular","decision","joint","to_assignee"].indexOf(a.getAttribute("type")),A=-1!=["task","circular","decision","joint","to_assignee"].indexOf(a.getAttribute("type")),D=-1!=["task","circular","decision","joint","to_assignee"].indexOf(a.getAttribute("type"));if(e.form.findField("transmitAble").setVisible(L),e.form.findField("entrustAble").setVisible(F),e.form.findField("returnBackAble").setVisible(T),e.form.findField("suspendAble").setVisible(A),e.form.findField("rejectAble").setVisible(D),"countersign"==a.getAttribute("type")){var U=new Array,J=!1;Ext.each(a.edges,function(e,t){if(e.source.getAttribute("name")==a.getAttribute("name")){var i="",n="";e.target&&(i=e.target.getAttribute("name"),n=e.target.getAttribute("label")),"to_submit"==e.getAttribute("name")?J?(e.setAttribute("name","to_"+JE.toPinYin(Ext.value(i),"pinyin")),U.push({id:e.getAttribute("name"),text:Ext.value(e.getAttribute("label"),"流转--\x3e"+Ext.value(n,i)),code:e.getAttribute("name")})):(U.push({id:e.getAttribute("name"),text:Ext.value(e.getAttribute("label"),"流转--\x3e"+Ext.value(n,i)),code:e.getAttribute("name")}),J=!0):U.push({id:e.getAttribute("name"),text:Ext.value(e.getAttribute("label"),"流转--\x3e"+Ext.value(n,i)),code:e.getAttribute("name")})}}),U.length<=0&&U.push({id:"to_submit",text:"流转后置节点",code:"to_submit"}),U.push({id:"to_rollback",text:"回退前置节点",code:"to_rollback"}),e.form.findField("countersignConfigs").items.each(function(e){e.items.each(function(e,t){1==t&&(e.getStore().loadData(U),e.setValue(e.getValue()))})})}else"to_assignee"==a.getAttribute("type")&&v.items.each(function(e){var t=e.items.items[0];t.getStore().loadData([{id:"USER",text:"按人员处理",code:"USER"},{id:"SPECIAL",text:"特殊处理",code:"SPECIAL"},{id:"DIY",text:"自定义",code:"DIY"}]);var i=e.items.items[1],n=e.items.items[2],a=e.items.items[3];-1==["USER","SPECIAL","DIY"].indexOf(t.getValue())&&(t.setValue("USER"),i.setValue(""),n.setValue(""),a.setValue("")),e.items.items[8].hide()});var P=e.form.findField("forkName");if(P.setVisible("join"==a.getAttribute("type")),"join"==a.getAttribute("type")){var M=l.getAllCells(!0,!1),j=[];Ext.each(M,function(e){var t=e.getAttribute("type");if(!Ext.isEmpty(t)&&"fork"==t){var i=e.getAttribute("name");j.push({id:i,text:i,code:i})}}),P.getStore().loadData(j),Ext.isEmpty(P.getValue)&&(1==j.length?P.setValue(j[0].code):1<j.length&&P.setValue(j[0].code))}},editEvents:function(a){var e=Ext.decode(Ext.value(a.getValue(),"[]")),t=Ext.id(),i=a.up("panel[xtype=workflow.mainview]").down("form[xtype=workflow.graphattr]").form.findField("PROCESSINFO_TABLECODE").getValue(),n={xtype:"grid",border:0,autoScroll:!0,columnLines:!0,id:t,plugins:[Ext.create("Ext.grid.plugin.CellEditing",{clicksToEdit:1,pluginId:"cellEdit"})],viewConfig:{plugins:{ptype:"gridviewdragdrop",dragText:"拖动排序",pluginId:"ddOrder"}},columns:{defaults:{menuDisabled:!0,align:"center",sortable:!1},items:[{xtype:"actioncolumn",width:40,tooltip:"添加",text:'<div class="jeicon jeicon-resource-table-addition" style="width:16px;height:16px;"></div>',items:[{iconCls:"jeicon jeicon-error",tooltip:"删除",handler:function(e,t,i){e.panel.store.removeAt(t)}}],listeners:{headerclick:function(e,t){e.grid.store.add({eventName:"PROCESSINFO_EVENTJSON"==a.name?"流程启动":"提交之前",eventType:"PROCESSINFO_EVENTJSON"==a.name?"WF_STARTED":"SUBMIT_BEFORE",executeStratey:"SET_ASSIGNEE",methodParam:"EVENT_PARAM"})}}},{dataIndex:"eventType",text:"类型",width:80,field:{xtype:"cbbfield",configInfo:("PROCESSINFO_EVENTJSON"==a.name?"JE_WF_PROCESSEVENT":"JE_WF_TASKEVENT")+",eventType~eventName,code~text"},tactics:[{type:"dic",dicCode:"PROCESSINFO_EVENTJSON"==a.name?"JE_WF_PROCESSEVENT":"JE_WF_TASKEVENT"}],renderer:JE.renderer},{dataIndex:"executeStratey",text:"执行策略",width:100,field:{xtype:"cbbfield",configInfo:"JE_WF_EXECUTESTRATEY"},tactics:[{type:"dic",dicCode:"JE_WF_EXECUTESTRATEY"}],renderer:JE.renderer},{dataIndex:"fieldsConfig",text:'<a href="javascript:void(0)" onclick="JE.Action.setFieldsConfig(\''+t+"','"+i+"')\">赋值字段配置</a>",width:200,field:{xtype:"textarea",height:60}},{dataIndex:"serviceBean",text:"业务Bean",width:200,field:{xtype:"textfield"}},{dataIndex:"serviceMethod",text:"业务方法",width:100,field:{xtype:"textfield"}},{dataIndex:"methodParam",text:"方法参数",width:100,field:{xtype:"cbbfield",configInfo:"JE_WF_PARAMTYPE,methodParam,code"},tactics:[{type:"dic",dicCode:"JE_WF_PARAMTYPE"}],renderer:JE.renderer},{dataIndex:"eventName",text:"类型名称",hidden:!0}]},store:Ext.create("Ext.data.Store",{fields:["eventType","eventName","executeStratey","fieldsConfig","serviceBean","serviceMethod","methodParam"],data:e})};JE.win({title:"事件",items:n,width:850,height:400,buttons:[{text:"确定",iconCls:"jeicon jeicon-check",handler:function(e){var t=e.up("window"),i=t.down("grid"),n=[];i.getStore().each(function(e){n.push(e.data)}),a.setValue(Ext.encode(n)),t.close()}},{text:"取消",iconCls:"jeicon jeicon-error",handler:function(e){e.up("window").close()}}],buttonAlign:"center"}).show()},editProcess:function(a){var e=Ext.decode(Ext.value(a.getValue(),"[]")),t=Ext.id(),i=a.up("panel[xtype=workflow.mainview]").down("form[xtype=workflow.graphattr]"),n=(i.form.findField("PROCESSINFO_TABLECODE").getValue(),i.form.findField("PROCESSINFO_FUNCID").getValue(),i.form.findField("PROCESSINFO_FSFUNCIDS").getValue(),{xtype:"grid",border:0,autoScroll:!0,columnLines:!0,id:t,plugins:[Ext.create("Ext.grid.plugin.CellEditing",{clicksToEdit:1,pluginId:"cellEdit"})],viewConfig:{plugins:{ptype:"gridviewdragdrop",dragText:"拖动排序",pluginId:"ddOrder"}},columns:{defaults:{menuDisabled:!0,align:"center",sortable:!1},items:[{xtype:"actioncolumn",width:40,tooltip:"添加",text:'<div class="jeicon jeicon-resource-table-addition" style="width:16px;height:16px;"></div>',items:[{iconCls:"jeicon jeicon-error",tooltip:"删除",handler:function(e,t,i){e.panel.store.removeAt(t)}}],listeners:{headerclick:function(e,t){e.grid.store.add({})}}},{dataIndex:"processName",text:"流程",width:130,field:{xtype:"gridssfield",configInfo:"JE_CORE_PROCESSINFO,processName~processKey~tableCode~pkCode,PROCESSINFO_PROCESSNAME~PROCESSINFO_PROCESSKEY~PROCESSINFO_TABLECODE~PROCESSINFO_PKNAME,S"}},{dataIndex:"processKey",text:"流程Key",width:120},{dataIndex:"tableCode",text:"表名",width:120,field:{xtype:"gridssfield",editable:!0,configInfo:"JE_CORE_RESOURCETABLE,tableCode~pkCode,RESOURCETABLE_TABLECODE~RESOURCETABLE_PKCODE,S"}},{dataIndex:"pkCode",text:"主键名",width:120,field:{xtype:"textfield"}},{dataIndex:"whereSql",text:"过滤条件{主表字段}",width:300,field:{xtype:"textarea",height:60}}]},store:Ext.create("Ext.data.Store",{fields:["processName","processKey","tableCode","pkCode","whereSql"],data:e})});JE.win({title:"事件",items:n,width:850,height:400,buttons:[{text:"确定",iconCls:"jeicon jeicon-check",handler:function(e){var t=e.up("window"),i=t.down("grid"),n=[];i.getStore().each(function(e){n.push(e.data)}),a.setValue(Ext.encode(n)),t.close()}},{text:"取消",iconCls:"jeicon jeicon-error",handler:function(e){e.up("window").close()}}],buttonAlign:"center"}).show()},editDiyEvents:function(a){var l=this,e=Ext.decode(Ext.value(a.getValue(),"[]")),o=a.up("panel[xtype=workflow.mainview]").down("form[xtype=workflow.graphattr]").form.findField("PROCESSINFO_TABLECODE").getValue(),t={xtype:"grid",border:0,autoScroll:!0,columnLines:!0,viewConfig:{plugins:{ptype:"gridviewdragdrop",dragText:"拖动排序",pluginId:"ddOrder"}},columns:{defaults:{menuDisabled:!0,align:"center",sortable:!1},items:[{xtype:"actioncolumn",width:40,tooltip:"添加",text:'<div class="jeicon jeicon-resource-table-addition" style="width:16px;height:16px;"></div>',items:[{iconCls:"jeicon jeicon-error",tooltip:"删除",handler:function(e,t,i){e.panel.store.removeAt(t)}}],listeners:{headerclick:function(e,t){e.grid.store.add({AUDFLAG:"ENDED"})}}},{dataIndex:"TABLENAME",text:"目标表",width:200},{dataIndex:"TABLECODE",text:"目标表编码",hidden:!0},{dataIndex:"AUDFLAG",text:"流程修改状态",width:100,renderer:JE.renderer,tactics:[{type:"dic",dicCode:"JE_AUDFLAG"}]},{dataIndex:"WHERESQL",text:"条件",width:300},{dataIndex:"FIELDCONFIG",text:"赋值配置",hidden:!0},{xtype:"actioncolumn",width:40,tooltip:"添加",text:"设置",items:[{iconCls:"jeicon jeicon-set-up",tooltip:"设置",handler:function(e,t,i){var n=e.panel.getStore().getAt(t);l.doDiyEventConfig(n,o)}}]}]},store:Ext.create("Ext.data.Store",{fields:["TABLENAME","TABLECODE","AUDFLAG","WHERESQL","FIELDCONFIG"],data:e})};JE.win({title:"结束业务处理",items:t,width:850,height:400,buttons:[{text:"确定",iconCls:"jeicon jeicon-check",handler:function(e){var t=e.up("window"),i=t.down("grid"),n=[];i.getStore().each(function(e){n.push(e.data)}),a.setValue(Ext.encode(n)),t.close()}},{text:"取消",iconCls:"jeicon jeicon-error",handler:function(e){e.up("window").close()}}],buttonAlign:"center"}).show()},doDiyEventConfig:function(n,a){JE.formWin({title:"流程结束业务处理",width:750,height:600,border:0,maximizable:!0,frame:!1,bodyPadding:"10 10 0 10",autoShow:!0,formDefaults:{padding:"1 2 1 0"},items:[{xtype:"gridssfield",name:"TABLENAME",fieldLabel:"目标表",allowBlank:!1,whereSql:" AND SY_JESYS='1' ",configInfo:"JE_CORE_RESOURCETABLE,TABLENAME~TABLECODE,RESOURCETABLE_TABLENAME~RESOURCETABLE_TABLECODE,S",whereSql:""},{xtype:"hidden",name:"TABLECODE",fieldLabel:"表编码"},{name:"WHERESQL",fieldLabel:"条件"},{name:"AUDFLAG",xtype:"rgroup",configInfo:"JE_AUDFLAG",value:"ENDED",dataArray:[{id:"NOSTATUS",text:"未启动",code:"NOSTATUS"},{id:"SUSPEND",text:"已作废",code:"SUSPEND"},{id:"ENDED",text:"已结束",code:"ENDED"}],fieldLabel:"流程状态修改"},{xtype:"jsonarrayfield",labelAlign:"top",actionColumn:!0,defaultRecordValue:{TYPE:"field"},border:0,name:"FIELDCONFIG",columnAlign:"left",height:void 0,columnWidth:1,columns:[{dataIndex:"FIELDID",flex:1,text:"字段主键",hidden:!0},{dataIndex:"FIELDNAME",flex:1,text:"字段名",field:{xtype:"gridssfield",configInfo:"JE_CORE_TABLECOLUMN,FIELDID~FIELDNAME~FIELD,JE_CORE_TABLECOLUMN_ID~TABLECOLUMN_NAME~TABLECOLUMN_CODE,S",whereSql:"",listeners:{beforequery:function(e){var t=e.ownerCt.floatParent.up("window").down("hidden[name=TABLECODE]").getValue();e.whereSql=" AND TABLECOLUMN_TABLECODE='"+t+"' AND TABLECOLUMN_CODE NOT IN ('SY_PDID','SY_PIID','SY_AUDFLAG','SY_PREAPPROVUSERS','SY_APPROVEDUSERS','SY_STARTEDUSER','SY_STARTEDUSERNAME','SY_APPROVEDUSERNAMES','SY_PREAPPROVUSERNAMES')"}}}},{dataIndex:"FIELD",flex:1,text:"字段编码"},{dataIndex:"TYPE",flex:1,text:"类型",tactics:[{type:"dic",dicCode:"JE_FIELDVALUETYPE"}],renderer:JE.renderer,field:{xtype:"cbbfield",configInfo:"JE_FIELDVALUETYPE"}},{dataIndex:"VALUE",editable:!0,flex:1,text:"值",field:{xtype:"gridssfield",editable:!0,configInfo:"JE_CORE_TABLECOLUMN,VALUENAME~VALUE,TABLECOLUMN_NAME~TABLECOLUMN_CODE,S",whereSql:" AND TABLECOLUMN_TABLECODE='"+a+"' AND TABLECOLUMN_CODE NOT IN ('SY_PDID','SY_PIID','SY_AUDFLAG','SY_PREAPPROVUSERS','SY_APPROVEDUSERS','SY_STARTEDUSER','SY_STARTEDUSERNAME','SY_APPROVEDUSERNAMES','SY_PREAPPROVUSERNAMES')"}},{dataIndex:"VALUENAME",editable:!0,flex:1,text:"提示"}],insertFn:function(e){var t=e.up("window").down("hidden[name=TABLECODE]").getValue(),i=e.getStore();Ext.isEmpty(t)?JE.alert("请选择目标表!"):JE.selectWin({parent:null,parentType:"self",title:"导入字段",configInfo:"JE_CORE_TABLECOLUMN,,,M",whereSql:" AND TABLECOLUMN_TABLECODE='"+t+"' AND TABLECOLUMN_CODE NOT IN ('SY_PDID','SY_PIID','SY_AUDFLAG','SY_PREAPPROVUSERS','SY_APPROVEDUSERS','SY_STARTEDUSER','SY_STARTEDUSERNAME','SY_APPROVEDUSERNAMES','SY_PREAPPROVUSERNAMES')",type:"grid",callback:function(e,t){new Array;Ext.each(e,function(e){i.findRecord("FIELDID",e.get("TABLECOLUMN_CODE"))||i.add({FIELDID:e.get("JE_CORE_TABLECOLUMN_ID"),FIELDNAME:e.get("TABLECOLUMN_NAME"),FIELD:e.get("TABLECOLUMN_CODE"),TYPE:"field"})})}})},listeners:{afterrender:function(e){var t=e.down("grid"),n=t.down("gridcolumn[dataIndex=VALUE]");n.editorType="field",t.on("beforeedit",function(e,t){if("VALUE"==e.context.field){var i=e.context.record;n.editorType!=i.get("TYPE")&&("field"==i.get("TYPE")?n.setEditor({xtype:"gridssfield",editable:!0,configInfo:"JE_CORE_TABLECOLUMN,VALUENAME~VALUE,TABLECOLUMN_NAME~TABLECOLUMN_CODE,S",whereSql:" AND TABLECOLUMN_TABLECODE='"+a+"' AND TABLECOLUMN_CODE NOT IN ('SY_PDID','SY_PIID','SY_AUDFLAG','SY_PREAPPROVUSERS','SY_APPROVEDUSERS','SY_STARTEDUSER','SY_STARTEDUSERNAME','SY_APPROVEDUSERNAMES','SY_PREAPPROVUSERNAMES')"}):"variable"==i.get("TYPE")?n.setEditor({xtype:"cbbfield",editable:!0,configInfo:"JE_DEFAULEVALUE,VALUE~VALUENAME,code~text"}):n.setEditor({xtype:"textfield"}),n.editorType=i.get("TYPE"))}}),t.getStore().on("add",function(){n.setEditor({xtype:"gridssfield",configInfo:"JE_CORE_TABLECOLUMN,VALUENAME~VALUE,TABLECOLUMN_NAME~TABLECOLUMN_CODE,S",whereSql:" AND TABLECOLUMN_TABLECODE='"+a+"' AND TABLECOLUMN_CODE NOT IN ('SY_PDID','SY_PIID','SY_AUDFLAG','SY_PREAPPROVUSERS','SY_APPROVEDUSERS','SY_STARTEDUSER','SY_STARTEDUSERNAME','SY_APPROVEDUSERNAMES','SY_PREAPPROVUSERNAMES')"})})}}}],formConfig:{dockedItems:[{xtype:"box",dock:"bottom",padding:"5",margin:"5",minHeight:30,html:"<font color='#333333'>赋值配置，如果是模版变量，则可以写字符串   {字段名}   {@系统变量@}</font>",cls:"x-view-emtpytext"}]},fn:function(e,t){if(Ext.isEmpty(e.TABLECODE))return JE.alert("请选择目标表!"),!1;for(var i in e)n.set(i,e[i])},showFn:function(e){e.down("form").form.setValues(n.data)}})},toJBPLXml:function(e){this.editor;var t={info:this.graphAttr,variable:[],start:{},end:[],task:[],auto:[],fork:[],join:[],decision:[],text:[]};return e=Ext.value(e,this.getAllCells(!0,!1)),Ext.each(e,function(n){var e=Ext.util.Format.number(n.geometry.x,"0")+","+Ext.util.Format.number(n.geometry.y,"0")+","+Ext.util.Format.number(n.geometry.width,"0")+","+Ext.util.Format.number(n.geometry.height,"0"),a={name:n.getAttribute("name"),label:n.getAttribute("label"),type:n.getAttribute("type"),g:e,transition:[],rejectTrans:[]};switch(Ext.each(n.edges,function(e,t){if(e.source==n){var i={name:e.getAttribute("name",""),label:e.getAttribute("label",""),info:e.getAttribute("info",""),to:e.target?e.target.getAttribute("name"):""};if(!Ext.isEmpty(e.target))"join"==e.target.getAttribute("type")&&(i.to=i.to+"_join");"fork"!=a.type&&"decision"!=a.type||(i.name="to_"+a.type+(t+1)),a.transition.push(i)}}),n.getAttribute("rejectAble")&&1==n.getAttribute("rejectAble")&&JE.isNotEmpty(n.getAttribute("rejectNodes"))&&Ext.each(n.getAttribute("rejectNodes").split(","),function(e){}),a.type){case"join":t.join.push({name:a.name+"_join",g:"0,0,48,48",PI_JOIN_SIZE:"#{"+n.getAttribute("forkName")+"_JOIN_SIZE}",transition:[{name:"to_submit",to:a.name}]});break;case"fork":t.fork.push({name:a.name+"_fork",g:"0,0,48,48",transition:a.transition}),a.transition=[{name:"to_submit",to:a.name+"_fork"}];break;case"decision":t.decision.push({name:a.name+"_decision",g:"0,0,48,48",transition:a.transition}),a.transition=[{name:"to_submit",to:a.name+"_decision"}]}-1!=["join","fork","decision","joint","batchtask","to_assignee","countersign","auto","circular"].indexOf(a.type)&&(a.type="task"),-1!=["start"].indexOf(a.type)?t[a.type]=a:t[a.type].push(a)}),new Ext.XTemplate(this.jbpmXMLtpl).apply(t)},jbpmXMLtpl:['<?xml version="1.0" encoding="UTF-8"?>\n','<process xmlns="http://jbpm.org/4.4/jpdl" name="{info.PROCESSINFO_PROCESSKEY}" key="{info.PROCESSINFO_PROCESSKEY}">\n',"<description>{info.PROCESSINFO_DESCRIPION}</description>\n",'<start name="{start.name}" g="{start.g}">\n','<tpl for="start.transition">','<transition name="{name}" to="{to}" />\n',"</tpl>","</start>\n",'<tpl for="end">','<end name="{name}" g="{g}"/>\n',"</tpl>",'<tpl for="task">','<task name="{name}" g="{g}">\n','<tpl for="transition">','<transition name="{name}" to="{to}" />\n',"</tpl>",'<tpl for="rejectTrans">','<transition name="{name}" to="{to}" />\n',"</tpl>",'<transition name="to_reject" to="ENTRUST_TRANSMIT_TASK" />\n','<transition name="to_entrust" to="ENTRUST_TRANSMIT_TASK" />\n','<transition name="to_userdiy" to="USERDIY_TASK" />\n','<transition name="to_jump" to="JUMP_TASK" />\n','<transition name="to_allot" to="ALLOT_TASK" />\n','<transition name="to_callentrust" to="ENTRUST_TRANSMIT_TASK" />\n','<transition name="to_transmit" to="ENTRUST_TRANSMIT_TASK" />\n','<transition name="to_circular" to="ENTRUST_TRANSMIT_TASK" />\n','<transition name="to_returnback" to="ENTRUST_TRANSMIT_TASK" />\n','<transition name="to_returnsubmit" to="ENTRUST_TRANSMIT_TASK" />\n',"</task>\n","</tpl>",'<tpl for="auto">','<task name="{name}" g="{g}">\n','<tpl for="transition">','<transition name="{name}" to="{to}" />\n',"</tpl>","</task>\n","</tpl>",'<tpl for="fork">','<fork name="{name}" g="{g}">\n','<tpl for="transition">','<transition name="{name}" to="{to}" >\n',"</transition>\n","</tpl>","</fork>\n","</tpl>",'<tpl for="join">','<join name="{name}" g="{g}" multiplicity="{PI_JOIN_SIZE}" >\n','<tpl for="transition">','<transition name="{name}" to="{to}" />\n',"</tpl>","</join>","</tpl>",'<tpl for="decision">','<decision name="{name}" g="{g}">\n','<handler class="com.je.wf.handler.WfDecisionHandler" />\n','<tpl for="transition">','<transition name="{name}" to="{to}" />\n',"</tpl>","</decision>\n","</tpl>",'<task name="USERDIY_TASK" g="0,0,0,0">\n','<tpl for="task">','<transition name="to_{name}" to="{name}" />\n',"</tpl>","</task>\n",'<task name="JUMP_TASK" g="0,0,0,0">\n','<tpl for="task">','<transition name="to_{name}" to="{name}" />\n',"</tpl>","</task>\n",'<task name="ALLOT_TASK" g="0,0,0,0">\n','<tpl for="task">','<transition name="to_{name}" to="{name}" />\n',"</tpl>","</task>\n",'<task name="ENTRUST_TRANSMIT_TASK" g="0,0,0,0">\n','<tpl for="task">','<transition name="to_{name}" to="{name}" />\n',"</tpl>","</task>\n","</process>"]}),Ext.define("JE.sys.workflow.util.Editor",{extend:"JE.core.ux.mxgraph.util.Editor",mixins:["JE.sys.workflow.util.Util"],thumbWidth:40,thumbHeight:40,thumbStyle:"margin:10px;text-align:center;",graphAttr:{},initEditor:function(){var n=this;n.callParent(arguments);var e=n.editor.graph;e.errorAlert=!1,e.setMultigraph(!1),e.multiplicities.push(new mxMultiplicity(!1,"start",null,null,0,0,null,"源必须没有传入的边缘",null)),e.multiplicities.push(new mxMultiplicity(!0,"end",null,null,0,0,null,"源必须没有传入的边缘",null)),e.connectionHandler.createEdgeState=function(){var e=n.getDefaultEdge(),t=new mxCellState(this.graph.view,e,this.graph.getCellStyle(e));for(var i in this.graph.currentEdgeStyle)t.style[i]=this.graph.currentEdgeStyle[i];return t}},getDefaultEdge:function(){if(!this._defaultEdge){var e=this.editor.graph,t=mxUtils.createXmlDocument().createElement("transition");t.setAttribute("name","to_submit"),t.setAttribute("label",""),t.setAttribute("type","transition"),this._defaultEdge=e.createEdge(null,null,t,null,null,e.createCurrentEdgeStyle())}return this._defaultEdge.clone()},loadData:function(e){var t=JE.ajax({url:JE.getUrlMaps("je.core.load"),params:{tableCode:"JE_PHONE_APK",whereSql:"",orderSql:" ORDER BY SY_CREATETIME",queryFields:"APK_TEXT,APK_CODE,JE_PHONE_APK_ID",limit:-1}}),i=t&&t.rows?t.rows:JE.error("数据获取失败！");if(JE.isEmpty(e.PROCESSINFO_APPFUNCINFOS)){var a=new Array;Ext.each(i,function(e){a.push({apkName:e.APK_TEXT,apkKey:e.APK_CODE,apkId:e.JE_PHONE_APK_ID,appName:"",appId:""})}),e.PROCESSINFO_APPFUNCINFOS=Ext.encode(a)}else{a=new Array;var l=Ext.decode(Ext.value(e.PROCESSINFO_APPFUNCINFOS,"[]"));Ext.each(i,function(e){for(var t=!1,i=0;i<l.length;i++){var n=l[i];n.apkId==e.JE_PHONE_APK_ID&&(n.apkKey=e.APK_CODE,n.apkName=e.APK_TEXT,a.push(n),t=!0)}t||a.push({apkName:e.APK_TEXT,apkKey:e.APK_CODE,apkId:e.JE_PHONE_APK_ID,appName:"",appId:""})}),e.PROCESSINFO_APPFUNCINFOS=Ext.encode(a)}var n=this.ownerCt.ownerCt.down("[xtype=workflow.graphattr]");e.PROCESSINFO_BUTTONJSON=Ext.value(e.PROCESSINFO_BUTTONJSON,Ext.encode(JE.getDicItems("JE_WF_BTNS"))),n.form.findField("JE_CORE_PROCESSINFO_ID").setValue(e.JE_CORE_PROCESSINFO_ID),n.form.setValues(e),n.form.findField("PROCESSINFO_SYSWFNAME").setVisible("SYS"!=Ext.value(e.PROCESSINFO_PROCESSTYPE_CODE,"SYS")),n.form.findField("PROCESSINFO_JTGSMC").setVisible("SYS"!=Ext.value(e.PROCESSINFO_PROCESSTYPE_CODE,"SYS")),n.form.findField("PROCESSINFO_ZHMC").setVisible("SYS"!=Ext.value(e.PROCESSINFO_PROCESSTYPE_CODE,"SYS")),this.graphAttr=n.form.getValues();var o=decodeURIComponent(Ext.value(e.PROCESSINFO_EDITORCONTEXT,""));this.callParent([o])},cellDrop:function(i){var e=Ext.value(this.cellNames,{}),t=i.value,n=t.getAttribute("name"),a=t.getAttribute("type"),l=Ext.value(e[a],0);if(!Ext.isEmpty(a)){l++,e[a]=l,t.setAttribute("name",n+l),t.setAttribute("basicName",n+l);var o=this.ownerCt.ownerCt.getComponent("workflow.attrs"),d="taskAttr";"child"==a&&(d="childAttr");var r=Ext.value(o.getComponent(d).defValues,{});Ext.iterate(r,function(e,t){i.setAttribute(e,t)}),this.cellNames=e}},initAction:function(){var n=this;n.callParent(arguments);n.editor;n.addAction("importWF",function(){var i=n.ownerCt.ownerCt.down("[xtype=workflow.graphattr]").form.getValues();JE.selectWin({title:"工作流",configInfo:"JE_CORE_PROCESSINFO",type:"grid",callback:function(e){if(!Ext.isEmpty(e)){var t=e[0].data;Ext.each(["PROCESSINFO_PROCESSNAME","JE_CORE_PROCESSINFO_ID","PROCESSINFO_FUNCNAME","PROCESSINFO_FUNCCODE","PROCESSINFO_FSFUNCCODES","PROCESSINFO_FSFUNCIDS","PROCESSINFO_FSFUNCNAMES","PROCESSINFO_PKNAME","PROCESSINFO_FUNCID","PROCESSINFO_TABLECODE","PROCESSINFO_FILENAME","PROCESSINFO_PROCESSKEY","PROCESSINFO_PROCESSTYPE_CODE","PROCESSINFO_PROCESSTYPE_NAME","PROCESSINFO_TABLECODE","PROCESSINFO_SYSWFKEY","PROCESSINFO_SYSWFNAME","PROCESSINFO_DEPLOYMENT_ID","PROCESSINFO_PDVERSION","PROCESSINFO_DEPLOYSTATUS","PROCESSINFO_CLASSIFYCODE","PROCESSINFO_CLASSIFYNAME","PROCESSINFO_LASTVERSION","PROCESSINFO_ENABLED","PROCESSINFO_DEVELOPSTATUS"],function(e){t[e]=i[e]}),n.loadData(t)}}})}),n.addAction("save",function(){n.saveAction(!1)}),n.addAction("saveDeploy",function(){n.saveAction(!0)})},initEvent:function(){var c=this,s=c.editor;s.graph.addListener(mxEvent.REMOVE_CELLS,function(e,t){}),s.graph.addListener(mxEvent.LABEL_CHANGED,function(e,t){var i=t.getProperty("cell"),n=t.getProperty("value");if(n!=t.getProperty("old").getAttribute("label")){var a={label:n};if(!i.isEdge()){var l=n.replaceAll("#","").replaceAll(" ","").replaceAll("\n","");l=Ext.value(l,i.getAttribute("basicName")),a.name=l}c.ownerCt.ownerCt.getComponent("workflow.attrs").getLayout().getActiveItem().form.setValues(a)}}),s.graph.getSelectionModel().addListener(mxEvent.CHANGE,function(e,t){var i=s.graph.getSelectionCell(),n=c.ownerCt.ownerCt.getComponent("workflow.attrs"),a=n.getComponent("graphAttr"),l=a.form.getValues().PROCESSINFO_FUNCID,o=a.form.getValues();if(i&&!Ext.isEmpty(i.getAttribute("type"))){var d="taskAttr",r={};i.isEdge()?(d="lineAttr",i.source&&i.setAttribute("hideinfo",-1==["fork","decision"].indexOf(i.source.getAttribute("type"))?"hide":"show"),Ext.isEmpty(i.getAttribute("info"))&&i.setAttribute("info","1==1")):"child"==i.getAttribute("type")&&(d="childAttr"),a=n.getComponent(d),Ext.iterate(a.getValues(),function(e,t){r[e]=i.getAttribute(e)}),a.notChange=!0,"taskAttr"==d?c.taskNodeEvent(i,a,r,l,o):a.form.setValues(r),a.notChange=!1}n.getLayout().setActiveItem(a)})},saveAction:function(e){var S=this,_=S.editor,t=S.getAllCells(!0,!1),N=[],w={},v=[],L=[],F=[],T=[],A=[],D=[],U=[],J=[],P=[],M=[],j=[],B=[].errorSameTrans=[],k=[];if(Ext.each(t,function(n){var e=n.getAttribute("type");if(!Ext.isEmpty(e)){A.push(n);var a={},l=[],o=[],d=[],r=[];Ext.each(S.attrs.taskAttr,function(e){a[e]=Ext.value(n.getAttribute(e),"")}),Ext.each(n.edges,function(e,t){if(e.source==n&&!Ext.isEmpty(e.target)){r.push(e.target),l.push(e.target.getAttribute("name"));var i={name:e.getAttribute("name",""),label:e.getAttribute("label",""),info:e.getAttribute("info",""),to:e.target?e.target.getAttribute("name",""):""};if("fork"==a.type||"decision"==a.type)i.name="to_"+a.type+(t+1),_.graph.getModel().getCell(e.id).setAttribute("name",i.name);JE.isNotEmpty(i.info)&&(i.info=" "+i.info+" "),d.push(i)}e.target!=n||Ext.isEmpty(e.source)||o.push(e.source.getAttribute("name"))}),a.transitions=d,a.afterTaskNames=l.join(","),a.beforeTaskNames=o.join(","),a.roundInfo=Ext.value(a.roundInfo,"[]"),a.eventInfos=Ext.value(a.eventInfos,"[]"),a.processInfos=Ext.value(a.processInfos,"[]"),a.assgineConfig=Ext.value(a.assgineConfig,"[]"),a.warnConfig=Ext.value(a.warnConfig,"[]"),a.taskBtnConfig=Ext.value(a.taskBtnConfig,"[]");var t=JE.toObj(a.editFields);if(!Ext.isEmpty(t)){var i=new Array,c=new Array,s=new Array,E=new Array,f=new Array,u=new Array;Ext.each(t,function(e){"1"==e.edit&&i.push(e.code),"1"==e.hide&&c.push(e.code),"1"==e.show&&s.push(e.code),"1"==e.readOnly&&E.push(e.code),"1"==e.notNull&&f.push(e.code),"1"==e.change&&u.push(e.code)}),a.editFields=i.join(","),a.hideFields=c.join(","),a.showFields=s.join(","),a.readOnlyFields=E.join(","),a.notNullFields=f.join(","),a.changeFields=u.join(",")}n.setAttribute("editFields",a.editFields),n.setAttribute("hideFields",a.hideFields),n.setAttribute("showFields",a.showFields),n.setAttribute("readOnlyFields",a.readOnlyFields),n.setAttribute("notNullFields",a.notNullFields),n.setAttribute("changeFields",a.changeFields);var p=JE.toObj(a.editChildren);if(!Ext.isEmpty(p)){var m=new Array,x=new Array,g=new Array;Ext.each(p,function(e){"1"==e.edit&&m.push(e.code),"1"==e.hide&&x.push(e.code),"1"==e.show&&g.push(e.code)}),a.editChildren=m.join(","),a.hideChildren=x.join(","),a.showChildren=g.join(","),n.setAttribute("editChildren",a.editChildren),n.setAttribute("hideChildren",a.hideChildren),n.setAttribute("showChildren",a.showChildren)}var C=JE.toObj(a.enabledButtons);if(!Ext.isEmpty(C)){var h=new Array;Ext.each(C,function(e){"1"==e.value&&h.push(e.code)}),a.enabledButtons=h.join(",")}n.setAttribute("enabledButtons",a.enabledButtons);var b=JE.toObj(a.fieldsConfig);if(!Ext.isEmpty(b)){var y=new Array,O=new Array;Ext.each(b,function(e){Ext.isEmpty(e.value)||(y.push(e.value),O.push(e.code))}),0<O.length?a.fieldsConfig=y.join("~")+","+O.join("~"):a.fieldsConfig=""}n.setAttribute("fieldsConfig",a.fieldsConfig),a.x=n.geometry.x,a.y=n.geometry.y,a.width=n.geometry.width,a.height=n.geometry.height,D.push(a);var I=a.name,R=!1;switch(e){case"start":Ext.each(r,function(e){-1!=["countersign","fork","join","joint","to_assignee","end","auto"].indexOf(e.getAttribute("type"))&&(R=!0)}),R&&J.push(I),1<r.length&&B.push(I);break;case"task":case"circular":1<r.length&&B.push(I);break;case"decision":break;case"end":F.push(I);break;case"fork":Ext.each(r,function(e){-1!=["end"].indexOf(e.getAttribute("type"))&&(R=!0)}),R&&P.push(I);break;case"join":Ext.isEmpty(n.getAttribute("forkName"))&&T.push(I),Ext.each(r,function(e){-1==["to_assignee","joint","auto","countersign","end"].indexOf(e.getAttribute("type"))&&(R=!0)}),R&&M.push(I),1<r.length&&B.push(I);break;case"countersign":Ext.each(r,function(e){-1!=["fork","task","circular"].indexOf(e.getAttribute("type"))&&(R=!0)}),R&&U.push(I),"ONE_ASSGINE"==a.countersignType&&"0"==a.selectUser&&Ext.isEmpty(a.countersignAssgineId)&&k.push(I);break;case"joint":case"to_assignee":1<r.length&&B.push(I);break;case"auto":Ext.each(r,function(e){-1==["to_assignee","joint","auto","countersign","end"].indexOf(e.getAttribute("type"))&&(R=!0)}),R&&j.push(I),1<r.length&&B.push(I)}if("start"==e&&L.push(I),Ext.isEmpty(I))switch(e){case"start":v.push("开始");break;case"task":v.push("任务");break;case"circular":v.push("循环");break;case"decision":v.push("判断");break;case"end":v.push("结束");break;case"fork":v.push("分支");break;case"join":v.push("聚合");break;case"countersign":v.push("会签");break;case"joint":v.push("候选");break;case"to_assignee":v.push("固定人");case"auto":v.push("自动节点")}else w[I]?N.push(I):w[I]=I}}),0!=L.length)if(1<L.length)JE.alert("流程只能有一个开始节点，请重新设计...");else if(0<v.length)JE.alert("有名称为空的节点，请修改后保存，节点类型如下：\n"+v.join(","));else if(F.length<=0)JE.alert("流程必须有结束节点，请修改后保存,请重新设计...");else if(0<T.length)JE.alert("聚合节点必须设置来源分支,请修改后保存,节点如下：\n"+T.join(","));else if(0<N.length)JE.alert("有名称重复的节点，请修改后保存，节点名称如下：\n"+N.join(","));else if(0<B.length)JE.alert("除判断、会签、分支节点除外其他节点不能有两个流转路径，请修改后保存，节点名称如下：\n"+B.join(","));else if(0<U.length)JE.alert("会签节点不能流转到普通节点和分支节点，请修改后保存，节点名称如下：\n"+U.join(","));else if(0<J.length)JE.alert("开始节点只能流转到任务、判断节点，请修改后保存，节点名称如下：\n"+J.join(","));else if(0<P.length)JE.alert("分支节点不能流转到结束，请修改后保存，节点名称如下：\n"+P.join(","));else if(0<M.length)JE.alert("聚合节点只能流转到固定人、候选、自动、会签、结束节点，请修改后保存，节点名称如下：\n"+M.join(","));else if(0<j.length)JE.alert("自动节点只能流转到固定人、候选、自动、会签、结束节点，请修改后保存，节点名称如下：\n"+j.join(","));else if(0<k.length)JE.alert("会签节点类型为负责人制度并且不可以自定义人员需指定负责人，请修改后保存，节点名称如下：\n"+k.join(","));else{var i=S.ownerCt.ownerCt.down("[xtype=workflow.graphattr]");if(S.graphAttr=i.form.getValues(),Ext.isEmpty(S.graphAttr.PROCESSINFO_PROCESSNAME))alert("请输入流程名称!");else if(Ext.isEmpty(S.graphAttr.PROCESSINFO_FUNCID))alert("请选择功能!");else{S.graphAttr.PROCESSINFO_STARTNODENAME=L[0];var n=new mxCodec(mxUtils.createXmlDocument()).encode(_.graph.getModel());Ext.iterate(S.graphAttr,function(e,t){n.setAttribute(e,t)});var a=mxUtils.getPrettyXml(n),l=S.toJBPLXml(A),o=S.buildImageInfo(),d=encodeURIComponent(o.xml),r=S.graphAttr.JE_CORE_PROCESSINFO_ID,c={tableCode:"JE_CORE_PROCESSINFO",jpdlXmlInfo:encodeURIComponent(l),PROCESSINFO_EDITORCONTEXT:encodeURIComponent(a),PROCESSINFO_JBPMCONTEXT:encodeURIComponent(l),imgXmlInfo:d,imgWidth:o.width,imgHeight:o.height,PROCESSINFO_IMAGEXML:d,PROCESSINFO_NODEINFO:JE.encode(o.nodeInfos),PROCESSINFO_IMGWIDTH:o.width,PROCESSINFO_IMGHEIGHT:o.height,deployFlag:e,PROCESSINFO_LASTVERSION:"none",PROCESSINFO_TASKJSON:Ext.encode(D)},s=(c=Ext.apply(c,S.graphAttr)).PROCESSINFO_FUNCCODE;c.PROCESSINFO_EVENTJSON=Ext.value(c.PROCESSINFO_EVENTJSON,"[]"),c.PROCESSINFO_DIYEVENTJSON=Ext.value(c.PROCESSINFO_DIYEVENTJSON,"[]"),JE.isEmpty(r)&&(c.PROCESSINFO_SAASDIY="0");var E=JE.ajax({url:JE.getUrlMaps("je.core.wf.processInfo",Ext.isEmpty(r)?"doSave":"doUpdate"),params:c});E.success?(i.form.setValues({JE_CORE_PROCESSINFO_ID:E.obj.JE_CORE_PROCESSINFO_ID}),e?(JE.msg("发布成功..."),"1"==JE.systemConfig.JE_SYS_STATICIZE&&("DEVELOP"==JE.systemConfig.JE_CORE_MODE||("IMPLEMENT"==JE.systemConfig.JE_CORE_MODE?JE.userStaticData.FUNC[s]&&(JE.CoreUtil.staticFuncData(s,!1),JE.CoreUtil.initUSInfo()):"RUNNING"==JE.systemConfig.JE_CORE_MODE&&(JE.CoreUtil.staticFuncData(s,!1),JE.CoreUtil.initUSInfo())))):JE.msg("保存成功...")):JE.alert(E.obj),Ext.getCmp("JE_CORE_PROCESSINFO_jegridview").getStore().load()}}else JE.alert("流程没有开始节点，请重新设计...")}}),Ext.define("JE.sys.workflow.view.Attrs",{extend:"Ext.panel.Panel",alias:"widget.workflow.attrs",layout:"card",defaults:{border:0},initComponent:function(){this.defaults={border:0,editor:this.editor,autoScroll:!0},this.items=[{xtype:"workflow.graphattr",itemId:"graphAttr"},{xtype:"workflow.taskattr",itemId:"taskAttr"},{xtype:"workflow.lineattr",itemId:"lineAttr"},{xtype:"workflow.childattr",itemId:"childAttr"}],this.callParent(arguments)},afterRender:function(){var n=this;n.callParent(arguments),n.editor.attrs={},n.items.each(function(e){var i=[];Ext.iterate(e.form.getValues(),function(e,t){i.push(e)}),n.editor.attrs[e.itemId]=i});new Ext.util.KeyMap({target:n.getEl(),binding:[{key:Ext.EventObject.S,ctrl:!0,fn:function(e,t){t.stopEvent(),n.editor.doAction("save")}}]})}}),Ext.define("JE.sys.workflow.view.Cells",{extend:"Ext.panel.Panel",alias:"widget.workflow.cells",layout:{type:"accordion",animate:!0},defaults:{border:1,autoScroll:!0,layout:"fit",bodyPadding:5,xtype:"panel"},initComponent:function(e){items=[{title:"【核心】",itemId:"workflowcells",fn:"addWorkflowPalette",iconCls:"jeicon jeicon-user-department"},{title:"【常用】",itemId:"generalcells",fn:"addGeneralPalette",iconCls:"jeicon jeicon-circular-o"},{title:"【元素】",itemId:"basiccells",fn:"addBasicPalette",iconCls:"jeicon jeicon-pie-chart"},{title:"【流程】",itemId:"flowchartcells",fn:"addFlowchartPalette",iconCls:"jeicon jeicon-sitemap-three"},{title:"【箭头】",itemId:"arrowcells",fn:"addArrowsPalette",iconCls:"jeicon jeicon-arrow"}],this.items=items,this.callParent(arguments)},afterRender:function(){var t=this;t.callParent(arguments),t.editor.editorUI.sidebar.container=t.body.dom,t.items.each(function(e){e.body&&t.editor.editorUI.sidebar[e.fn](e.body.dom)})}}),Ext.define("JE.sys.workflow.view.Graph",{extend:"JE.core.ux.mxgraph.Graph",alias:"widget.workflow.graph",initComponent:function(){var t=this,e=[{iconCls:"jeicon jeicon-save-storage",ref:"save",hidden:1==t.readOnly,tooltip:"保存"},{iconCls:"jeicon jeicon-save-release",ref:"saveDeploy",hidden:1==t.readOnly,tooltip:"保存发布"},"-",{iconCls:"jeicon jeicon-import",ref:"importWF",tooltip:"导入"},"-"];Ext.each(e,function(e){Ext.isString(e)||(e.handler=function(){t.editor.doAction(e.ref)})}),e=e.concat(t.buildTbar()),t.dockedItems=[{xtype:"toolbar",dock:"top",defaults:{scale:"medium"},items:e}],t.callParent(arguments)},afterRender:function(){var i=this;i.callParent(arguments);new Ext.util.KeyMap({target:i.getEl(),binding:[{key:Ext.EventObject.S,ctrl:!0,fn:function(e,t){t.stopEvent(),i.editor.doAction("save")}}]})}}),Ext.define("JE.sys.workflow.view.MainView",{extend:"Ext.panel.Panel",alias:"widget.workflow.mainview",layout:"border",border:0,bodyPadding:"2",initComponent:function(){this.editor=Ext.create("JE.sys.workflow.util.Editor",{}),this.defaults={collapsible:!0,split:!0,editor:this.editor},this.items=[{xtype:"workflow.graph",itemId:"workflow.graph",collapsible:!1,region:"center"},{xtype:"mxgraph.cells",itemId:"workflow.cells",cells:["workflow","general","basic","flowchart","arrow"],workflowTitle:"【核心】",region:"west"},{xtype:"workflow.attrs",itemId:"workflow.attrs",region:"east",title:"属性",maxWidth:600,minWidth:200,width:420}],this.callParent(arguments)}}),Ext.define("JE.sys.workflow.view.attr.ChildAttr",{extend:"Ext.form.Panel",alias:"widget.workflow.childattr",layout:"anchor",bodyPadding:"2 4",initComponent:function(){var o=this;o.defaults={labelWidth:50,anchor:"100%",labelAlign:"right",listeners:{change:function(e,t,i){var n=o.editor.editor.graph,a=n.getSelectionCell();if(a)if("formUploadFiles"==e.name)o.form.submit({url:JE.getUrlMaps("je.core","uploadFile"),success:function(e,t){var i=t.result.obj;n.setCellStyles(mxConstants.STYLE_IMAGE,i)}});else if("label"==e.name){n.cellLabelChanged(a,t);var l=t.replaceAll("#","").replaceAll(" ","").replaceAll("\n","");o.form.setValues({name:l})}else a.setAttribute(e.name,t)}}},o.items=[{xtype:"textfield",fieldLabel:"名称",name:"name",hidden:!0},{xtype:"textarea",height:50,fieldLabel:"标签",name:"label"},{xtype:"textfield",fieldLabel:"子流程",name:"childFlow"},{xtype:"textfield",fieldLabel:"子流程CODE",name:"childFlowCode"},{xtype:"textfield",fieldLabel:"子流程ID",name:"childFlowId"},{xtype:"hidden",fieldLabel:"类型",name:"type"}],o.callParent(arguments)}}),Ext.define("JE.sys.workflow.view.attr.GraphAttr",{extend:"Ext.form.Panel",alias:"widget.workflow.graphattr",layout:"anchor",bodyPadding:"2 4",initComponent:function(){var n=this;n.defaults={xtype:"fieldset",anchor:"100%",defaults:{labelWidth:65,labelAlign:"right",anchor:"100%",listeners:{change:function(e,t,i){n.editor.graphAttr[e.getName()]=t}}}};var e="rgb(254, 254, 206)";n.items=[{title:"流程信息",layout:"anchor",style:{background:e},items:[{xtype:"hidden",fieldLabel:"流程主键",name:"JE_CORE_PROCESSINFO_ID"},{xtype:"textfield",fieldLabel:"流程名称",name:"PROCESSINFO_PROCESSNAME",allowBlank:!1},{xtype:"textfield",fieldLabel:"流程分类CODE",name:"PROCESSINFO_CLASSIFYCODE",hidden:!0},{xtype:"gridssfield",fieldLabel:"功能",allowBlank:!1,whereSql:" AND SY_JESYS='1' ",configInfo:"JE_CORE_FUNCINFO,PROCESSINFO_FUNCNAME~PROCESSINFO_FUNCCODE~PROCESSINFO_PKNAME~PROCESSINFO_FUNCID~PROCESSINFO_TABLECODE,FUNCINFO_FUNCNAME~FUNCINFO_FUNCCODE~FUNCINFO_PKNAME~JE_CORE_FUNCINFO_ID~FUNCINFO_TABLENAME,S",name:"PROCESSINFO_FUNCNAME",listeners:{query:function(e,t){var i=e.up("panel[xtype=workflow.graphattr]").getForm(),n=t[0];if(n&&"view"==n.get("FUNCINFO_FUNCTYPE")){i.findField("PROCESSINFO_TABLECODE").setValue(n.get("FUNCINFO_CRUDTABLENAME")),i.findField("PROCESSINFO_VIEWTABLECODE").setValue(n.get("FUNCINFO_TABLENAME"));var a=JE.ajax({url:"/je/resourceTableAction!getPkCode4Table.action",params:{tableCode:n.get("FUNCINFO_CRUDTABLENAME")}});a.success&&i.findField("PROCESSINFO_PKNAME").setValue(a.obj)}else i.findField("PROCESSINFO_VIEWTABLECODE").setValue("")}}},{xtype:"textfield",fieldLabel:"流程英文名称",name:"PROCESSINFO_PROCESSNAME_EN"},{xtype:"treessfield",fieldLabel:"流程分类",name:"PROCESSINFO_CLASSIFYNAME",configInfo:"JE_WF_CLASSIFY,PROCESSINFO_CLASSIFYNAME~PROCESSINFO_CLASSIFYCODE,text_~code,S"},{xtype:"gridssfield",fieldLabel:"附属功能",whereSql:" AND SY_JESYS='1' ",configInfo:"JE_CORE_FUNCINFO,PROCESSINFO_FSFUNCNAMES~PROCESSINFO_FSFUNCCODES~PROCESSINFO_FSFUNCIDS,FUNCINFO_FUNCNAME~FUNCINFO_FUNCCODE~JE_CORE_FUNCINFO_ID,M",name:"PROCESSINFO_FSFUNCNAMES",listeners:{beforequery:function(e){var t=e.up("panel[xtype=workflow.graphattr]").getForm(),i=t.findField("PROCESSINFO_TABLECODE").getValue(),n=t.findField("PROCESSINFO_VIEWTABLECODE").getValue(),a=t.findField("PROCESSINFO_FUNCID").getValue();if(!JE.isNotEmpty(i))return JE.alert("请先选择功能!"),!1;e.whereSql=" AND SY_JESYS='1' AND (FUNCINFO_TABLENAME='"+i+"' OR FUNCINFO_TABLENAME='"+n+"') AND JE_CORE_FUNCINFO_ID!='"+a+"'"}}},{xtype:"jsonarrayfield",labelAlign:"top",actionColumn:!1,name:"PROCESSINFO_APPFUNCINFOS",columnAlign:"left",hidden:"1"!=JE.systemConfig.JE_SYS_APPPERM,height:void 0,columns:[{dataIndex:"apkName",editable:!1,flex:1,text:"APK名称"},{dataIndex:"appName",flex:1,text:"功能",field:{xtype:"gridssfield",whereSql:" AND APP_TYPE='func' AND APP_APK_ID='{apkId}' ",orderSql:" ORDER BY SY_CREATETIME ASC",configInfo:"JE_PHONE_APPFUNC,appName~appCode~appId,APP_TEXT~APP_CODE~JE_PHONE_APP_ID,S",listeners:{beforequery:function(e){var t=e.up("form").form.findField("PROCESSINFO_TABLECODE").getValue();e.whereSql=" AND APP_TYPE='func' AND APP_APK_ID='{apkId}' AND APP_FUNC_TABLENAME='"+t+"'"}}}},{dataIndex:"apkId",hidden:!0,text:"APK主键ID"},{dataIndex:"apkKey",hidden:!0,text:"APK的KEY"},{dataIndex:"appId",hidden:!0,text:"APP主键ID"},{dataIndex:"appCode",hidden:!0,text:"功能编码"}]},{xtype:"rgroup",fieldLabel:"生产环境",name:"PROCESSINFO_DEVELOPSTATUS",configInfo:"JE_WF_DEVELOPSTATUS",value:"YF"},{xtype:"hidden",fieldLabel:"文件名",name:"PROCESSINFO_FILENAME"},{xtype:"hidden",fieldLabel:"流程编码",name:"PROCESSINFO_PROCESSKEY"},{xtype:"yesnofield",margin:"0 0 0 10",fieldLabel:"可发起",name:"PROCESSINFO_SPONSOR",value:"1",inputValue:"1",uncheckedValue:"0"},{xtype:"yesnofield",margin:"0 0 0 10",fieldLabel:"可取回",name:"PROCESSINFO_WITHDRAWABLE",value:"1",inputValue:"1",uncheckedValue:"0"},{xtype:"yesnofield",margin:"0 0 0 10",fieldLabel:"可回退",name:"PROCESSINFO_ROLLBACKABLE",value:"1",inputValue:"1",uncheckedValue:"0"},{xtype:"yesnofield",margin:"0 0 0 10",fieldLabel:"可转办",name:"PROCESSINFO_TRANSMITABLE",value:"0",inputValue:"1",uncheckedValue:"0"},{xtype:"yesnofield",margin:"0 0 0 10",fieldLabel:"可委托",name:"PROCESSINFO_ENTRUSTABLE",value:"0",inputValue:"1",uncheckedValue:"0"},{xtype:"yesnofield",margin:"0 0 0 10",fieldLabel:"可催办",name:"PROCESSINFO_WARNABLE",value:"1",inputValue:"1",uncheckedValue:"0"},{xtype:"yesnofield",margin:"0 0 0 10",fieldLabel:"可撤销",name:"PROCESSINFO_CALLABLE",value:"1",inputValue:"1",uncheckedValue:"0"},{xtype:"yesnofield",margin:"0 0 0 10",fieldLabel:"可作废",name:"PROCESSINFO_SUSPEND",value:"1",inputValue:"1",uncheckedValue:"0"},{xtype:"yesnofield",margin:"0 0 0 10",fieldLabel:"多表单",name:"PROCESSINFO_MOREFORM",value:"0",inputValue:"1",uncheckedValue:"0"},{xtype:"yesnofield",labelWidth:75,fieldLabel:"任何人启动",name:"PROCESSINFO_ANYONESTARTABLE",value:"0",inputValue:"1",uncheckedValue:"0"},{xtype:"yesnofield",labelWidth:75,fieldLabel:"简易审批",name:"PROCESSINFO_JYSP",value:"0",inputValue:"1",uncheckedValue:"0"},{xtype:"yesnofield",labelWidth:75,fieldLabel:"简易发起",name:"SY_FORMUPLOADFILES",value:"0",inputValue:"1",uncheckedValue:"0"},{xtype:"yesnofield",labelWidth:75,fieldLabel:"人员预定义",name:"PROCESSINFO_USERDIY",value:"0",inputValue:"1",uncheckedValue:"0"},{xtype:"cgroup",labelWidth:120,fieldLabel:"审批记录隐藏",name:"PROCESSINFO_HISTORYDIABLED",configInfo:"JE_WF_HISTORYTYPE",value:""},{xtype:"cgroup",fieldLabel:'<a href="javascript:void(0)" onclick="JE.Action.setMessageConfig(\''+n.getId()+"')\">提醒</a>",name:"PROCESSINFO_MESSAGETYPE",configInfo:"JE_WF_MESSAGETYPE",value:"DWR"},{xtype:"rgroup",fieldLabel:"类型",name:"PROCESSINFO_PROCESSTYPE_CODE",configInfo:"JE_WF_PROCESSTYPE,PROCESSINFO_PROCESSTYPE_NAME~PROCESSINFO_PROCESSTYPE_CODE,text~code,S",value:"SYS",hidden:!("1"==JE.systemConfig.JE_SYSMODE),listeners:{change:function(e,t,i){var n=e.up("panel[xtype=workflow.graphattr]");n.form.findField("PROCESSINFO_SYSWFNAME").setVisible("SYS"!=t),n.form.findField("PROCESSINFO_ZHMC").setVisible("SYS"!=t)}}},{xtype:"textfield",fieldLabel:"类型NAME",name:"PROCESSINFO_PROCESSTYPE_NAME",hidden:!0,value:"系统"},{xtype:"queryuserfield",fieldLabel:"流程管理员",labelWidth:85,editable:!0,columnWidth:1,configInfo:"JE_CORE_QUERYUSER,PROCESSINFO_ADMINNAME~PROCESSINFO_ADMINID,USERNAME~USERID,S",otherConfig:JE.toStr({DEPT:"1",SENTRY:"0",ROLE:"0",WORKGROUP:"0",QUICKQUERY:"NONE"}),whereSql:" and STATUS='1' AND VALID='1'",name:"PROCESSINFO_ADMINNAME"},{xtype:"textfield",fieldLabel:"管理员ID",name:"PROCESSINFO_ADMINID",hidden:!0},{xtype:"gridssfield",fieldLabel:"系统流程",labelWidth:85,whereSql:" AND PROCESSINFO_PROCESSTYPE_CODE='SYS'",configInfo:"JE_CORE_PROCESSINFO,PROCESSINFO_SYSWFNAME~PROCESSINFO_SYSWFKEY,PROCESSINFO_PROCESSNAME~PROCESSINFO_PROCESSKEY,S",name:"PROCESSINFO_SYSWFNAME"},{xtype:"textfield",fieldLabel:"系统流程ID",name:"PROCESSINFO_SYSWFKEY",hidden:!0,value:""},{xtype:"gridssfield",labelWidth:85,fieldLabel:"定制租户",name:"PROCESSINFO_ZHMC",hidden:!0,configInfo:"JE_SAAS_YH,PROCESSINFO_ZHMC~PROCESSINFO_ZHID,YH_GSMC~JE_SAAS_YH_ID,S",value:""},{xtype:"textfield",fieldLabel:"定制租户ID",name:"PROCESSINFO_ZHID",hidden:!0,value:""},{xtype:"gridssfield",labelWidth:85,fieldLabel:"分公司",name:"PROCESSINFO_JTGSMC",configInfo:"JE_CORE_JDGSINFO,PROCESSINFO_JTGSMC~PROCESSINFO_JTGSID,JDGSINFO_GSMC~JE_CORE_JDGSINFO_ID,S",whereSql:"  AND JDGSINFO_TYPE_CODE='CASCADE'",value:""},{xtype:"textfield",fieldLabel:"分公司ID",name:"PROCESSINFO_JTGSID",hidden:!0,value:""},{xtype:"treessfield",labelWidth:85,fieldLabel:"可启动角色",name:"PROCESSINFO_STARTROLENAMES",configInfo:"JE_RBAC_ROLE,PROCESSINFO_STARTROLENAMES~PROCESSINFO_STARTROLES,text~id,M",whereSql:" AND STATUS='1' AND ROLETYPE='ROLE'",listeners:{beforequery:function(e){var t="";if("1"==JE.systemConfig.JE_SYSMODE){var i=e.up("panel[xtype=workflow.graphattr]"),n=i.form.findField("PROCESSINFO_PROCESSTYPE_CODE").getValue(),a=i.form.findField("PROCESSINFO_JTGSID").getValue();t="SYS"!=n?" AND JTGSID='"+a+"'":" AND ROLERANK='SYS' ",e.whereSql=" AND STATUS='1' AND ROLETYPE='ROLE' "+t}}}},{xtype:"textfield",fieldLabel:"可启动角色CODE",name:"PROCESSINFO_STARTROLES",hidden:!0},{xtype:"textfield",labelWidth:85,fieldLabel:"启动表达式",name:"PROCESSINFO_STARTEXP",labelStyle:"cursor: pointer;color:blue;"},{name:"displayfield_1",value:"系统默认判定启动表达式，表达式失败则直接不展示，表达式成功按照单据创建人启动.如果勾选任何人启动则不判定创建人。如果选择启动角色，则判断当前登录所在角色，在则可启动，不在则不能启动。",fieldCls:"je-fieldcls-mask",hideLabel:!0,fieldLazy:!1,xtype:"uxdisplayfield",removed:!1,margin:"3"},{xtype:"textfield",fieldLabel:"表名",name:"PROCESSINFO_TABLECODE",hidden:!0},{xtype:"textfield",fieldLabel:"视图表编码",name:"PROCESSINFO_VIEWTABLECODE",hidden:!0},{xtype:"textfield",fieldLabel:"主键名称",name:"PROCESSINFO_PKNAME",hidden:!0},{xtype:"textfield",fieldLabel:"附属功能编码",name:"PROCESSINFO_FSFUNCCODES",hidden:!0},{xtype:"textfield",fieldLabel:"附属功能主键",name:"PROCESSINFO_FSFUNCIDS",hidden:!0},{xtype:"textfield",fieldLabel:"功能编码",name:"PROCESSINFO_FUNCCODE",hidden:!0},{xtype:"hidden",fieldLabel:"功能ID",name:"PROCESSINFO_FUNCID",hidden:!0},{xtype:"hidden",fieldLabel:"流程结束事件",name:"PROCESSINFO_DIYEVENTJSON"},{xtype:"hidden",fieldLabel:"流程事件",name:"PROCESSINFO_EVENTJSON"},{xtype:"hidden",fieldLabel:"流程版本",name:"PROCESSINFO_PDVERSION",value:"0"},{xtype:"hidden",fieldLabel:"流程部署状态",name:"PROCESSINFO_DEPLOYSTATUS",values:"0"},{xtype:"hidden",fieldLabel:"消息提醒模版",name:"PROCESSINFO_MESSAGEJSON"},{xtype:"hidden",fieldLabel:"启动",name:"PROCESSINFO_ENABLED",value:"1"},{xtype:"hidden",fieldLabel:"启动表达式",name:"PROCESSINFO_STARTEXPFN"}]},{title:"展示模版配置",layout:"fit",bodyPadding:"2",padding:"4",style:{background:e},items:[{xtype:"textarea",height:100,name:"PROCESSINFO_DISPLAYCONFIGINFO",emptyText:"编写自定义的HTML模版展示,流程名称：{proccessName},功能名称:{funcName},任务节点：{taskName},创建时间：{createTime},业务字段引用：{bean.}",fieldStyle:{background:e,borderColor:e}}]},{title:"描述",layout:"fit",bodyPadding:"2",padding:"4",style:{background:e},items:[{xtype:"textarea",height:170,name:"PROCESSINFO_DESCRIPION",emptyText:"流程描述",fieldStyle:{background:e,borderColor:e}}]},{title:'<span style="cursor: pointer;" id="'+n.getId()+'_titleEl" title="单击编辑事件">事件(单击编辑)</span>',ref:"eventInfos",style:{background:e},layout:"anchor",listeners:{afterrender:function(e){Ext.get(n.getId()+"_titleEl").on("click",function(){var e=n.form.findField("PROCESSINFO_EVENTJSON");n.editor.editEvents(e)})}}},{title:'<span style="cursor: pointer;" id="'+n.getId()+'_diyEventEl" title="单击编辑结束业务处理">结束业务处理(单击编辑)</span>',ref:"diyEventInfos",style:{background:e},layout:"anchor",listeners:{afterrender:function(e){Ext.get(n.getId()+"_diyEventEl").on("click",function(){var e=n.form.findField("PROCESSINFO_DIYEVENTJSON");n.editor.editDiyEvents(e)})}}},{xtype:"jsonarrayfield",labelAlign:"top",actionColumn:!1,name:"PROCESSINFO_BUTTONJSON",columnAlign:"left",height:void 0,columns:[{dataIndex:"text",editable:!1,flex:1,text:"按钮名称"},{dataIndex:"zdyText",flex:1,text:"自定义名称"},{dataIndex:"comment",flex:1,text:"审批意见"},{dataIndex:"code",hidden:!0,text:"编码"},{dataIndex:"listeners",hidden:!0},{text:"事件",xtype:"actioncolumn",width:40,align:"center",items:[{tooltip:"编辑",handler:function(e,t,i){var n=e.panel.getStore().getAt(t),a="/*单击前，单击后事件*/\n{\n\tbeforeclick:function(form,wfInfo,btnCode){return true;},\n\tafterclick:function(form,wfInfo,btnCode){}\n}",l=Ext.value(n.get("listeners"),a);JE.win({title:"方法(Ctrl+S保存)",autoShow:!0,items:{border:0,xtype:"jecodeeditor",value:l,saveFn:function(e){e==a&&(e=""),n.set("listeners",e),JE.msg("编写完成...")}}})},getClass:function(e,t,i){return JE.isNotEmpty(i.get("listeners"))?"jeicon jeicon-lightning-on":"jeicon jeicon-lightning-off"}}]}]}],n.callParent(arguments)}}),Ext.define("JE.sys.workflow.view.attr.LineAttr",{extend:"Ext.form.Panel",alias:"widget.workflow.lineattr",layout:"anchor",bodyPadding:"2 4",initComponent:function(){var l=this;l.defaults={xtype:"fieldset",anchor:"100%",style:{backgroundColor:"rgb(254, 254, 206)",paddingBottom:"4px"},defaults:{labelWidth:65,anchor:"100%",labelAlign:"right",margin:"1 0",listeners:{change:function(e,t,i){var n=l.editor.editor.graph,a=n.getSelectionCell();"label"==e.name?n.cellLabelChanged(a,t):("style"==e.ownerCt.name&&("dashed"==e.name&&(t=t?1:0),l.editor.doStyleAction([e.name],[t])),a.setAttribute(e.name,t))}}}},l.items=[{title:"基础信息",items:[{xtype:"textarea",height:50,fieldLabel:"标签",labelWidth:40,name:"label"},{xtype:"textarea",fieldLabel:"条件",labelWidth:40,name:"info"},{xtype:"textfield",fieldLabel:"名称",name:"name",hidden:!0},{xtype:"hidden",fieldLabel:"隐藏条件",name:"hideinfo"}]},{title:"样式",name:"style",items:[{xtype:"yesnofield",fieldLabel:"虚线",name:"dashed"},{xtype:"colorfield",fieldLabel:"颜色",name:"strokeColor"},{xtype:"numberfield",fieldLabel:"文字大小",name:"fontSize"},{xtype:"cbbfield",fieldLabel:"文字样式",name:"fontFamily",dataArray:[{code:"黑体",text:"黑体"},{code:"宋体",text:"宋体"},{code:"楷体",text:"楷体"},{code:"幼圆",text:"幼圆"}]},{xtype:"colorfield",fieldLabel:"文字颜色",name:"fontColor"}]}],l.callParent(arguments)}}),Ext.define("JE.sys.workflow.view.attr.TaskAttr",{extend:"Ext.form.Panel",alias:"widget.workflow.taskattr",layout:"anchor",bodyPadding:"2 4",initComponent:function(){var m=this;m.defaults={xtype:"fieldset",anchor:"100%",style:{backgroundColor:"rgb(254, 254, 206)",paddingBottom:"4px"},defaults:{labelWidth:65,anchor:"100%",labelAlign:"right",margin:"1 0",listeners:{change:function(e,t,i){if(!m.notChange){var n=m.editor.editor.graph,a=n.getSelectionCell();if(Ext.isBoolean(t)&&(t=t?"1":"0"),a)if("label"==e.name){n.cellLabelChanged(a,t);var l=t.replaceAll("#","").replaceAll(" ","").replaceAll("\n","");m.form.setValues({name:l})}else{if("iconPath"==e.name){var o=m.editor.taskStyles,d=style=o[a.getAttribute("type")];style=Ext.value(a.getStyle(),style),Ext.isEmpty(t)&&-1!=mxUtils.indexOfStylename(d,"image")&&(t=d.split(";")[1].replace("=","*"));var r=t.split("*")[1]||t;style=mxUtils[Ext.isEmpty(t)?"removeStylename":"addStylename"](style,"image"),style=mxUtils.setStyle(style,"image",r),n.getModel().setStyle(a,style)}a.setAttribute(e.name,t)}}}}}},m.defValues={countersignConfigs:'[{"result":"SUCCESS","transition":"to_submit"},{"result":"FAILURE","transition":"to_rollback"}]',countersignType:"ONE_ASSGINE",countersignProportion:"0.1",countersignAll:"1",countersignOrder:"0",assgineConfig:'[{"type":"ROLE","id":"","name":"","code":""}]',warnConfig:"[]",taskBtnConfig:"[]",noWithdrawable:"0",transmitAble:"0",entrustAble:"0",warnAble:"0",rejectAble:"0",rejectNodes:"",rollbackDisable:"0",noEasy:"0",selectUser:"0",editFields:"",enabledButtons:"",hideFields:"",formEditAble:"0",submitAble:"0",reutrnSubmit:"0",doAssgineType:"user",jumpAble:"0",rejectSubmit:"0",autoRound:"0",jumpDiyUserAble:"0"},m.items=[{title:"基础信息",ref:"jc",layout:"column",items:[{xtype:"textarea",height:50,columnWidth:1,fieldLabel:"标签",name:"label"},{xtype:"textfield",columnWidth:1,fieldLabel:"名称",name:"name",allowBlank:!1},{xtype:"cbbfield",columnWidth:1,fieldLabel:"类型",name:"type",configInfo:"JE_WF_TASKTYPE",readOnly:!0},{xtype:"uxtrigger",columnWidth:1,fieldLabel:"图标",name:"icon",trigger2Cls:"x-form-file-trigger",editable:!1,clearButton:!0,handler:function(t){var e=t.up("panel[xtype=workflow.mainview]").down("panel[xtype=workflow.graphattr]").form.findField("JE_CORE_PROCESSINFO_ID").getValue();JE.uploadFile({params:{beanTableCode:"JE_CORE_PROCESSINFO",funcCode:"JE_CORE_PROCESSINFO",tableCode:"JE_CORE_PROCESSINFO",pkValue:e,jeFileType:"PROJECT",returnType:"all"},callback:function(e){t.setValue(e.name),m.form.findField("iconPath").setValue(e.name+"*"+e.url)}})},listeners:{reset:function(){m.form.findField("iconPath").reset()}}},{xtype:"hidden",columnWidth:1,fieldLabel:"图标路径",name:"iconPath"},{xtype:"cbbfield",columnWidth:1,fieldLabel:"来源分支",name:"forkName",dataArray:[],hidden:!0},{xtype:"yesnofield",columnWidth:.5,width:"40%",fieldLabel:"不可取回",name:"noWithdrawable",value:"0",labelWidth:110},{xtype:"yesnofield",columnWidth:.5,width:"40%",fieldLabel:"可转办",name:"transmitAble",value:"0",labelWidth:110},{xtype:"yesnofield",columnWidth:.5,width:"40%",fieldLabel:"可委托",name:"entrustAble",value:"0",labelWidth:110},{xtype:"yesnofield",columnWidth:.5,width:"40%",fieldLabel:"可作废",name:"suspendAble",value:"0",labelWidth:110},{xtype:"yesnofield",columnWidth:.5,width:"40%",fieldLabel:"可退回至根节点",hidden:!0,name:"returnBackAble",value:"0",labelWidth:110},{xtype:"yesnofield",columnWidth:.5,width:"40%",fieldLabel:"禁用简易审批",name:"noEasy",value:"0",labelWidth:110},{xtype:"yesnofield",columnWidth:.5,width:"40%",fieldLabel:"可驳回",name:"rejectAble",value:"0",labelWidth:110},{xtype:"yesnofield",columnWidth:.5,width:"40%",fieldLabel:"可直接提交驳回人",name:"rejectSubmit",value:"0",labelWidth:110},{xtype:"yesnofield",columnWidth:.5,width:"40%",fieldLabel:"不可退回",name:"rollbackDisable",value:"0",labelWidth:110},{xtype:"yesnofield",columnWidth:.5,width:"40%",fieldLabel:"可直接提交退回人",name:"reutrnSubmit",value:"0",labelWidth:110},{xtype:"yesnofield",columnWidth:.5,width:"40%",fieldLabel:"表单可编辑",name:"formEditAble",value:"0",labelWidth:110},{xtype:"yesnofield",columnWidth:.5,width:"40%",fieldLabel:"消息不提醒",name:"warnAble",value:"0",labelWidth:110},{xtype:"yesnofield",columnWidth:.5,width:"40%",fieldLabel:"禁用领取任务",name:"noTakeTask",value:"0",labelWidth:110},{xtype:"yesnofield",columnWidth:.5,width:"40%",fieldLabel:"自动传阅",name:"autoRound",value:"0",labelWidth:110},{xtype:"yesnofield",columnWidth:.5,width:"40%",fieldLabel:"启动预定义",name:"diyAble",value:"0",labelWidth:110},{xtype:"yesnofield",columnWidth:.5,width:"40%",fieldLabel:"启动人员预定义",name:"userDiyAble",value:"0",labelWidth:110},{xtype:"yesnofield",columnWidth:.5,width:"40%",fieldLabel:"强制预定义",name:"mustDiyUser",value:"0",labelWidth:110},{xtype:"yesnofield",columnWidth:.5,width:"40%",fieldLabel:"转交下一步",name:"nextDiyUser",value:"0",labelWidth:110},{xtype:"yesnofield",columnWidth:.4,width:"40%",fieldLabel:"异步树",name:"asyncTree",value:"0",labelWidth:110},{xtype:"yesnofield",columnWidth:.55,width:"40%",fieldLabel:"直接提交并禁用送交",name:"submitAble",value:"0",labelWidth:150},{xtype:"yesnofield",columnWidth:.4,width:"40%",fieldLabel:"顺序审批",name:"doUserSort",value:"0",labelWidth:110},{xtype:"yesnofield",columnWidth:.4,width:"40%",fieldLabel:"启用子流程",name:"doWfChild",value:"0",labelWidth:110},{xtype:"yesnofield",columnWidth:.55,width:"40%",fieldLabel:"候选自动全选",name:"autoSelectAll",value:"0",labelWidth:110},{xtype:"hidden",fieldLabel:"节点事件",name:"eventInfos"},{xtype:"hidden",fieldLabel:"子流程信息",name:"processInfos"},{xtype:"yesnofield",columnWidth:.4,width:"60%",fieldLabel:"使用组织架构调拨",name:"allotDeptUser",value:"0",labelWidth:110}]},{title:"可处理人配置",ref:"clpz",items:[{xtype:"rgroup",columnWidth:1,fieldLabel:"人员参照(默认当前登录人)",name:"doAssgineType",value:"user",configInfo:"JE_WF_ASSGINETYPE",labelWidth:160},{xtype:"cbblistfield",name:"assgineConfig",enterAdd:!1,allowBlank:!0,assgineData:!1,valueName:"name",codeName:"type",textName:"text",items:[{xtype:"hidden",name:"id"},{xtype:"hidden",name:"text"},{xtype:"hidden",name:"code"},{xtype:"textfield",name:"source",emptyText:"节点来源,多个以逗号分开.."},{xtype:"hiddenfield",name:"allIds"},{xtype:"hiddenfield",name:"showType"},{xtype:"hiddenfield",name:"permType"},{xtype:"hiddenfield",name:"jtgsMc"},{xtype:"hiddenfield",name:"jtgsId"},{xtype:"hiddenfield",name:"userWhere"},{xtype:"hiddenfield",name:"userPerm"},{xtype:"hiddenfield",name:"userWhereSql"}],typeConfig:{configInfo:"JE_WF_TARGERTYPE",hideTrigger2:!0,width:85},valueConfig:{fieldStyle:"cursor: pointer;",listeners:{afterrender:function(F){F.inputEl.on("click",function(){var e=F.up("panel[xtype=workflow.mainview]").down("panel[xtype=workflow.graphattr]"),t=(e.form.findField("PROCESSINFO_JTGSID").getValue(),e.form.findField("PROCESSINFO_ZHID").getValue()),i=e.form.findField("PROCESSINFO_PROCESSTYPE_CODE").getValue(),n="",a=" AND ROLERANK='SYS'";"1"==JE.systemConfig.JE_SYSMODE&&(n=" AND 1!=1 ","PRO"==i&&(a="  AND ROLERANK='YH' AND ZHID='"+t+"'",n="  AND ZHID='"+t+"'"));var l=F.previousSibling().getValue();if(!Ext.isEmpty(l)){var o,d,r,c,y=F.nextSibling(),O=y.nextSibling().nextSibling(),I=O.nextSibling().nextSibling(),R=I.nextSibling(),S=R.nextSibling(),_=S.nextSibling(),N=_.nextSibling(),w=N.nextSibling(),v=w.nextSibling(),L=v.nextSibling(),s=m.form.findField("type").getValue(),E="id",f="text",u="code",p={};switch(l){case"ROLE":p={title:"按角色处理",configInfo:"JE_CORE_ROLE,,,S_",ddCode:"JE_CORE_ROLE",ddName:"角色",iconCls:"jeicon jeicon-role",ids:y.getValue(),showType:R.getValue(),permType:S.getValue(),jtgsMc:_.getValue(),jtgsId:N.getValue(),userWhere:w.getValue(),userPerm:v.getValue(),userWhereSql:L.getValue(),whereSql:" and STATUS='1' AND ROLETYPE='ROLE' "+a,orderSql:" ORDER BY PARENT ASC,ORDERINDEX ASC"};break;case"DEPT":p={title:"按部门处理",configInfo:"JE_CORE_ROLE,,,S_",ddCode:"JE_CORE_ROLE",ddName:"部门",iconCls:"jeicon jeicon-user-department",ids:y.getValue(),showType:R.getValue(),permType:S.getValue(),jtgsMc:_.getValue(),jtgsId:N.getValue(),userWhere:w.getValue(),userPerm:v.getValue(),userWhereSql:L.getValue(),whereSql:" and STATUS='1' AND ROLETYPE='DEPT'"+n,orderSql:" ORDER BY TREEORDERINDEX ASC"};break;case"SENTRY":p={title:"按岗位处理",configInfo:"JE_CORE_ROLE,,,S_",ddCode:"JE_CORE_ROLE",ddName:"岗位",iconCls:"jeicon jeicon-user-department",ids:y.getValue(),showType:R.getValue(),permType:S.getValue(),jtgsMc:_.getValue(),jtgsId:N.getValue(),userWhere:w.getValue(),userPerm:v.getValue(),userWhereSql:L.getValue(),whereSql:"and STATUS='1' AND ROLETYPE='SENTRY'"+n,orderSql:" ORDER BY TREEORDERINDEX ASC"};break;case"SPECIAL":o="特殊",d="JE_WF_SPECIALASSGINE,,,"+(-1==["join","to_assignee"].indexOf(s)?"M":"S");break;case"USER":o="人员",d="JE_CORE_QUERYUSER,,,"+(-1==["join","to_assignee"].indexOf(s)?"M":"S"),c="and STATUS='1'"+n,r="grid",E="USERID",f="USERNAME",u="USERCODE";break;case"FIELD":o="表单字段",d="JE_CORE_RESOURCEFIELD,,,M",c=" AND RESOURCEFIELD_FUNCINFO_ID='"+e.form.findField("PROCESSINFO_FUNCID").getValue()+"' AND RESOURCEFIELD_XTYPE NOT IN ('fieldset','child','childfuncfield','displayfield') ",r="grid";break;case"DIY":o="自定义",c=d="",r="DIY"}if(-1!=["ROLE","DEPT","SENTRY"].indexOf(l))Ext.create("JE.sys.workflow.view.attr.imp.UserInsWinView",{vals:p,fn:function(e){var t=e.up("window[xtype=workflow.userinswinview]"),i=(t.down("treepanel[ref=deptusertree]").getStore(),t.down("[ref=multiselect]")),n=t.down("treepanel[ref=oktree]").getRootNode(),a=t.down("cgroup[name=showType]"),l=t.down("cgroup[name=permType]"),o=t.down("field[name=jtgsMc]"),d=(t.down("field[name=jtgsId]"),t.down("field[name=userWhere]")),r=t.down("cgroup[name=userPerm]"),c=t.down("textarea[name=userWhereSql]"),s=new Array,E=new Array,f=new Array,u=new Array,p=a.getValue(),m=l.getValue(),x=o.getValue(),g=o.getValue(),C=d.getValue(),h=r.getValue(),b=c.getValue();C=1==C?"1":"0",i.store.each(function(e){"ROOT"!=e.get("id")&&(s.push(e.get("id")),E.push(e.get("code")),f.push(e.get("text")))}),n.cascadeBy(function(e){u.push(e.get("id"))}),y.setValue(s.join(",")),O.setValue(E.join(",")),F.setValue(f.join(",")),I.setValue(u.join(",")),R.setValue(p),S.setValue(m),_.setValue(x),N.setValue(g),w.setValue(C),v.setValue(h),L.setValue(b)},showFn:function(e){var t=e.down("treepanel[ref=deptusertree]"),l=t.getStore(),i=e.down("[ref=multiselect]"),n=e.down("treepanel[ref=oktree]"),a=y.getValue(),o=R.getValue(),d=S.getValue(),r=e.down("cgroup[name=showType]"),c=e.down("cgroup[name=permType]"),s=e.down("field[name=jtgsMc]"),E=e.down("field[name=jtgsId]"),f=e.down("field[name=userWhere]"),u=e.down("cgroup[name=userPerm]"),p=e.down("textarea[name=userWhereSql]");if(r.setValue(o),c.setValue(d),s.setValue(_.getValue()),E.setValue(N.getValue()),f.setValue(w.getValue()),u.setValue(v.getValue()),p.setValue(L.getValue()),JE.isNotEmpty(a)){var m=new Array,x=new Array;Ext.each(a.split(","),function(e){var t=l.getNodeById(e);if(t){var i=t.parentNode;if(i){var n=i.get("text"),a=Ext.clone(t);a.set("parentText",n),x.push(a),m.push(a.data)}}}),i.store.loadData(m),n.loadUsers({recs:x,tree:t})}}}).show();else"FIELD"==l?JE.selectWin({title:o,configInfo:d,type:r,whereSql:c,value:O.getValue(),valueType:"code",callback:function(e){var t=[],i=[],n=[];t=[],i=[],n=[];e&&0<e.length&&Ext.each(e,function(e){t.push(e.get("RESOURCEFIELD_CODE")),i.push(e.get("RESOURCEFIELD_CODE")),n.push(e.get("RESOURCEFIELD_CODE"))}),F.setValue(n.join(",")),y.setValue(t.join(",")),O.setValue(i.join(","))}}):"USERSQL"==l||"DEPTUSER"==l||("DIY"!=l?JE.selectWin({title:o,configInfo:d,type:r,whereSql:c,value:O.getValue(),valueType:"code",okButtonClick:function(t,e){var i=e.down("grid[xtype=query.selectedusergrid]");i&&(t.splice(0,t.length),i.getStore().each(function(e){t.push(e)}))},callback:function(e){var t=[],i=[],n=[];Ext.each(e,function(e){"ROOT"!=e.get("id")&&(t.push(e.get(E)),i.push(e.get(u)),n.push(e.get(f)))}),F.setValue(n.join(",")),y.setValue(t.join(",")),O.setValue(i.join(","))}}):JE.formWin({title:"自定义人员",width:300,height:200,border:0,layout:"column",frame:!1,items:[{xtype:"textfield",allowBlank:!1,margin:"10 0 0 0",fieldLabel:"业务Bean",name:"beanName"},{xtype:"textfield",allowBlank:!1,margin:"10 0 0 0",fieldLabel:"业务方法",name:"beanMethod"}],fn:function(e,t){if(Ext.isEmpty(e.beanName))return JE.alert("业务Bean不能为空!"),!1;if(Ext.isEmpty(e.beanMethod))return JE.alert("业务方法不能为空!"),!1;var i=e.beanName+","+e.beanMethod;F.setValue(i),y.setValue(i),O.setValue(i)},showFn:function(e){var t=O.getValue();Ext.isEmpty(t)||e.down("form").form.setValues({beanName:t.split(",")[0],beanMethod:t.split(",")[1]})}}))}})},reset:function(e){var t=e.nextSibling(),i=t.nextSibling();t.reset(),i.reset()}}}}]},{title:"会签信息",ref:"hq",layout:"column",items:[{xtype:"cbbfield",fieldLabel:"类型",name:"countersignType",configInfo:"JE_WF_COUNTERSIGNTYPE",columnWidth:1},{xtype:"cbbfield",fieldLabel:"比例",name:"countersignProportion",configInfo:"JE_PERCENTAGE",columnWidth:1},{xtype:"queryuserfield",fieldLabel:"负责人",columnWidth:1,configInfo:"JE_CORE_QUERYUSER,countersignAssgineName~countersignAssgineId,USERNAME~USERID,S",otherConfig:JE.toStr({DEPT:"1",SENTRY:"1",ROLE:"1",WORKGROUP:"0",QUICKQUERY:"NONE"}),whereSql:" and STATUS='1'",name:"countersignAssgineName",listeners:{beforequery:function(e){var t=e.up("form[xtype=workflow.taskattr]").form.findField("assgineConfig").getValue(),i=JE.toObj(t),n=e.up("panel[xtype=workflow.mainview]").down("panel[xtype=workflow.graphattr]"),a=(n.form.findField("PROCESSINFO_JTGSID").getValue(),n.form.findField("PROCESSINFO_ZHID").getValue()),l=n.form.findField("PROCESSINFO_PROCESSTYPE_CODE").getValue(),o="";"1"==JE.systemConfig.JE_SYSMODE&&"PRO"==l&&(o="  AND ZHID='"+a+"'"),e.whereSql=" AND STATUS='1' "+o;var d=[],r=[],c=[],s=[],E=[];if(Ext.each(i,function(t){if(!Ext.isEmpty(t.id)){var e=t.id.split(",");Ext.each(e,function(e){"ROLE"==t.type?d.push(e):"DEPT"==t.type?r.push(e):"SENTRY"==t.type?c.push(e):"USER"==t.type&&s.push(e)})}}),0<d.length&&E.push(" USERID IN (SELECT USERID FROM JE_CORE_ROLE_USER WHERE ROLEID IN ('"+d.join("','")+"'))"),0<c.length&&E.push(" USERID IN (SELECT USERID FROM JE_CORE_ROLE_USER WHERE ROLEID IN ('"+c.join("','")+"'))"),0<r.length&&E.push(" USERID IN (SELECT USERID FROM JE_CORE_ROLE_USER WHERE ROLEID IN ('"+r.join("','")+"'))"),0<s.length&&E.push(" USERID IN ('"+s.join("','")+"')"),!(0<E.length))return JE.alert("请先配置可处理人配置，如果负责人为不确定人，则需设定自定义参与人员即可!"),!1;e.whereSql=" AND STATUS='1' AND ("+E.join(" OR ")+")"},change:function(e,t,i){var n=m.editor.editor.graph,a=n.getSelectionCell();if(a)if("label"==e.name){n.cellLabelChanged(a,t);var l=t.replaceAll("#","").replaceAll(" ","").replaceAll("\n","");m.form.setValues({name:l})}else{if("iconPath"==e.name){var o=m.editor.taskStyles,d=style=o[a.getAttribute("type")];style=Ext.value(a.getStyle(),style),Ext.isEmpty(t)&&-1!=mxUtils.indexOfStylename(d,"image")&&(t=d.split(";")[1].replace("=","*")),style=mxUtils[Ext.isEmpty(t)?"removeStylename":"addStylename"](style,"image"),style=mxUtils.setStyle(style,"image",t.split("*")[1]),n.getModel().setStyle(a,style)}a.setAttribute(e.name,t)}}}},{xtype:"yesnofield",fieldLabel:"人员自定义",name:"selectUser",value:"0",columnWidth:1,inputValue:"1",uncheckedValue:"0",columnWidth:.3,labelWidth:80},{xtype:"yesnofield",fieldLabel:"全部处理",name:"countersignAll",value:"1",columnWidth:1,inputValue:"1",uncheckedValue:"0",labelWidth:80,columnWidth:.3},{xtype:"yesnofield",fieldLabel:"按顺序审批",name:"countersignOrder",value:"1",columnWidth:1,inputValue:"1",uncheckedValue:"0",labelWidth:80,columnWidth:.3},{xtype:"textfield",fieldLabel:"负责人ID",name:"countersignAssgineId",hidden:!0,columnWidth:1},{xtype:"cbblistfield",fieldLabel:"配置",name:"countersignConfigs",configInfo:"JE_WF_COUNTERSIGNRESULT,hideButton",columnWidth:1,readOnlyInit:!0,codeName:"result",valueName:"transition",typeConfig:{width:45},valueConfig:{xtype:"cbbfield",configInfo:"JE_WF_COUNTERSIGNTRANSITION"}}]},{title:"流转按钮自定义",ref:"taskBtnConfig",items:{xtype:"cbblistfield",name:"taskBtnConfig",enterAdd:!1,allowBlank:!1,assgineData:!1,valueName:"btnName",codeName:"code",textName:"text",items:[{xtype:"cbbfield",name:"tranCode",hidden:!0,configInfo:"JE_WF_TRANTYPE",width:40},{xtype:"textfield",name:"taskName",width:180,emptyText:"流转节点名称"}],typeConfig:{configInfo:"JE_WF_BTNS",dicItemCodes:"wfSubmitBtn,wfReturnSubmitBtn,wfReturnBtn,wfRejectBtn,wfRoundBtn,wfBackBtn,wfTransmitBtn,wfEntrustBtn,wfCallEntrustBtn",hideTrigger2:!0,width:85},valueConfig:{xtype:"textfield",hideTrigger:!0,width:80,emptyText:"自定义名称",listeners:{afterrender:function(e){},reset:function(e){var t=e.nextSibling(),i=t.nextSibling();t.reset(),i.reset()}}}}},{title:"预警与延期",ref:"warnConfig",items:{xtype:"cbblistfield",name:"warnConfig",enterAdd:!1,allowBlank:!0,assgineData:!1,valueName:"id",codeName:"code",textName:"text",items:[{xtype:"cbbfield",name:"timeType",configInfo:"JE_WF_LCTXSJLX",width:40},{xtype:"textfield",name:"config",width:180,emptyText:"类型,方法名"}],typeConfig:{configInfo:"JE_WF_LCTXLX",hideTrigger2:!0,width:85},valueConfig:{xtype:"numberfield",hideTrigger:!0,width:20,emptyText:"周期",listeners:{afterrender:function(e){},reset:function(e){var t=e.nextSibling(),i=t.nextSibling();t.reset(),i.reset()}}}}},{title:"驳回配置",ref:"rejectConfig",items:[{xtype:"textfield",fieldLabel:"驳回节点",name:"rejectNodes",emptyText:"请指定可驳回的节点名称,多个用逗号隔开..."}]},{title:"跳跃配置",ref:"jumpConfig",items:[{xtype:"yesnofield",fieldLabel:"可跳跃",name:"jumpAble",value:"0"},{xtype:"yesnofield",fieldLabel:"启用顺序预定义",name:"jumpDiyUserAble",value:"0"},{xtype:"textfield",fieldLabel:"跳跃节点",name:"jumpNodes",emptyText:"请指定可跳跃的节点名称,多个用逗号隔开..."}]},{title:"可传阅人配置",ref:"cyxx",items:{xtype:"cbblistfield",name:"roundInfo",enterAdd:!1,allowBlank:!0,items:[{xtype:"hidden",name:"roundId"},{xtype:"hidden",name:"roundCode"}],typeConfig:{configInfo:"JE_ROUNDTYPE",hideTrigger2:!0,listeners:{change:function(e,t,i){e.nextSibling().setReadOnly(-1!=["STARTUSER","SELFDEPT","SELFSENTRY"].indexOf(t))}},width:85},valueConfig:{xtype:"treessfield",configInfo:"YESORNO",valueType:"text",hideTrigger:!0,fieldStyle:"cursor: pointer;",listeners:{beforeQuery:function(l){var e=l.up("panel[xtype=workflow.mainview]").down("panel[xtype=workflow.graphattr]"),t=(e.form.findField("PROCESSINFO_JTGSID").getValue(),e.form.findField("PROCESSINFO_ZHID").getValue()),i=e.form.findField("PROCESSINFO_PROCESSTYPE_CODE").getValue(),n="",a="";"1"==JE.systemConfig.JE_SYSMODE&&(n=" AND 1!=1 ","PRO"==i&&(n=a="  AND ZHID='"+t+"'"));var o=l.nextSibling(),d=o.nextSibling(),r=l.previousSibling().getValue(),c="",s="";if(Ext.isEmpty(r))return JE.alert("请选择传阅类型!"),!1;if("ROLE"==r)c="JE_RBAC_ROLE",s=a,"角色";else if("DEPT"==r)c="JE_RBAC_DEPARTMENT",s=n,"部门";else if("SENTRY"==r)c="JE_RBAC_SENTRY",s=n,"岗位";else if("USER"==r)c="JE_CORE_DEPTUSER",s=n,"人员";else if("FIELD"==r)c="JE_CORE_RESOURCEFIELD","表单字段";else{if("DIY"!=r)return!1;"自定义"}return"FIELD"==r?JE.selectWin({title:"表单字段",configInfo:"JE_CORE_RESOURCEFIELD,,,M",type:"grid",whereSql:" AND RESOURCEFIELD_FUNCINFO_ID='"+e.form.findField("PROCESSINFO_FUNCID").getValue()+"' AND RESOURCEFIELD_XTYPE NOT IN ('fieldset','child','childfuncfield','displayfield') ",valueType:"code",callback:function(e){var t=[],i=[],n=[];if(e&&1==e.length){var a=e[0];t.push(a.get("RESOURCEFIELD_CODE")),i.push(a.get("RESOURCEFIELD_CODE")),n.push(a.get("RESOURCEFIELD_CODE"))}l.setValue(n.join(",")),o.setValue(t.join(",")),d.setValue(i.join(","))}}):"DIY"==r?JE.formWin({title:"自定义人员",width:300,height:200,border:0,layout:"column",frame:!1,items:[{xtype:"textfield",allowBlank:!1,margin:"10 0 0 0",fieldLabel:"业务Bean",name:"beanName"},{xtype:"textfield",allowBlank:!1,margin:"10 0 0 0",fieldLabel:"业务方法",name:"beanMethod"}],fn:function(e,t){if(Ext.isEmpty(e.beanName))return JE.alert("业务Bean不能为空!"),!1;if(Ext.isEmpty(e.beanMethod))return JE.alert("业务方法不能为空!"),!1;var i=e.beanName+","+e.beanMethod;l.setValue(i),o.setValue(i),d.setValue(i)},showFn:function(e){var t=d.getValue();Ext.isEmpty(t)||e.down("form").form.setValues({beanName:t.split(",")[0],beanMethod:t.split(",")[1]})}}):JE.selectWin({title:l.fieldLabel,configInfo:c+",,,M",type:"tree",whereSql:""+s,valueType:"text",callback:function(e){var t=[],i=[],n=[];e&&0<e.length&&Ext.each(e,function(e){t.push(e.get("id")),i.push(e.get("code")),n.push(e.get("text"))}),l.setValue(n.join(",")),o.setValue(t.join(",")),d.setValue(i.join(","))}}),!1},reset:function(e){var t=e.nextSibling(),i=t.nextSibling();t.reset(),i.reset()}}}}},{title:"执行配置",ref:"execuConfig",items:[{xtype:"textfield",fieldLabel:"业务Bean",name:"beanName"},{xtype:"textfield",fieldLabel:"业务方法",name:"beanMethod"}]},{title:"自动候选配置",ref:"jointConfig",items:[{labelWidth:90,xtype:"yesnofield",fieldLabel:"自动候选",name:"autoJoint",value:"0",inputValue:"1",uncheckedValue:"0"},{labelWidth:90,xtype:"textfield",fieldLabel:"自动候选来源",name:"jointSource",emptyText:"节点来源,多个以逗号分开.."},{xtype:"hiddenfield",fieldLabel:"业务Bean",name:"jointBeanName"},{xtype:"hiddenfield",fieldLabel:"业务方法",name:"jointBeanMethod"}]},{title:"自定义流程按钮名称",ref:"zdyButton",items:{xtype:"cbblistfield",name:"buttonConfig",enterAdd:!1,allowBlank:!0,assgineData:!1,valueName:"zdyText",codeName:"code",typeConfig:{configInfo:"JE_WF_BTNS",hideTrigger2:!0,width:85},valueConfig:{fieldStyle:"cursor: pointer;",emptyText:"请输入自定义名称..."}}},{title:"审批意见默认",ref:"comments",items:{xtype:"cbblistfield",name:"taskComments",enterAdd:!1,allowBlank:!0,assgineData:!1,valueName:"value",codeName:"code",typeConfig:{configInfo:"JE_WF_BTNS",includeItems:!1,dicItemCodes:"wfTakeBtn,wfSuspendLabel,wfEndLabel,wfHandUpLabel,wfChangeFormBtn,wfChagenTaskBtn,wfPromptBtn,wfRejectBtn",hideTrigger2:!0,width:85},valueConfig:{fieldStyle:"cursor: pointer;",emptyText:"请输入审批意见..."}}},{title:'<span style="cursor: pointer;" id="'+m.getId()+'_processEl" title="单击编辑事件">子流程(单击编辑)</span>',ref:"processInfos",margin:"10 0 0 0",listeners:{afterrender:function(e){Ext.get(m.getId()+"_processEl").on("click",function(){var e=m.form.findField("processInfos");m.editor.editProcess(e)})}}},{title:'<span style="cursor: pointer;" id="'+m.getId()+'_titleEl" title="单击编辑事件">事件(单击编辑)</span>',margin:"10 0 0 0",ref:"eventInfos",listeners:{afterrender:function(e){Ext.get(m.getId()+"_titleEl").on("click",function(){var e=m.form.findField("eventInfos");m.editor.editEvents(e)})}}},{margin:"10 0 0 0",xtype:"tabpanel",ref:"bdpz",frame:!1,items:[{title:"表单字段",xtype:"jsonarrayfield",labelAlign:"top",actionColumn:!1,columnAlign:"left",height:void 0,name:"editFields",columns:[{dataIndex:"text",editable:!1,flex:2.2,text:"名称"},{dataIndex:"code",flex:1,hidden:!0,text:"编码"},{xtype:"uxcheckcolumn",dataIndex:"edit",editable:!1,sortable:!0,align:"center",text:"可编辑",flex:1.3},{xtype:"uxcheckcolumn",dataIndex:"readOnly",editable:!1,sortable:!0,align:"center",text:"只读",flex:1},{xtype:"uxcheckcolumn",dataIndex:"hide",editable:!1,sortable:!0,align:"center",text:"隐藏",flex:1},{xtype:"uxcheckcolumn",dataIndex:"show",editable:!1,sortable:!0,align:"center",text:"显示",flex:1},{xtype:"uxcheckcolumn",dataIndex:"notNull",editable:!1,sortable:!0,align:"center",text:"必填",flex:1},{xtype:"uxcheckcolumn",dataIndex:"change",editable:!1,sortable:!0,align:"center",text:"列表同步",flex:1.8}]},{fieldLabel:"隐藏字段",xtype:"hidden",name:"hideFields"},{fieldLabel:"显示字段",xtype:"hidden",name:"showFields"},{fieldLabel:"只读字段",xtype:"hidden",name:"readOnlyFields"},{fieldLabel:"必填字段",xtype:"hidden",name:"notNullFields"},{fieldLabel:"列表同步",xtype:"hidden",name:"changeFields"},{title:"子功能",xtype:"jsonarrayfield",labelAlign:"top",actionColumn:!1,columnAlign:"left",height:void 0,name:"editChildren",columns:[{dataIndex:"text",editable:!1,flex:2,text:"名称"},{dataIndex:"code",flex:1,hidden:!0,text:"编码"},{xtype:"uxcheckcolumn",dataIndex:"edit",editable:!1,sortable:!0,align:"center",text:"可编辑",flex:1},{xtype:"uxcheckcolumn",dataIndex:"hide",editable:!1,sortable:!0,align:"center",text:"隐藏",flex:1},{xtype:"uxcheckcolumn",dataIndex:"show",editable:!1,sortable:!0,align:"center",text:"显示",flex:1}]},{fieldLabel:"隐藏子功能",xtype:"hidden",name:"hideChildren"},{fieldLabel:"显示子功能",xtype:"hidden",name:"showChildren"},{title:"可用按钮",xtype:"jsonarrayfield",labelAlign:"top",actionColumn:!1,columnAlign:"left",height:void 0,name:"enabledButtons",columns:[{dataIndex:"text",editable:!1,flex:1,text:"名称"},{dataIndex:"code",flex:1,editable:!1,text:"编码"},{xtype:"uxcheckcolumn",dataIndex:"value",editable:!1,sortable:!0,align:"center",text:"可用"}]},{title:"赋值字段",xtype:"jsonarrayfield",labelAlign:"top",actionColumn:!1,columnAlign:"left",height:void 0,name:"fieldsConfig",columns:[{dataIndex:"value",align:"center",text:"赋值",flex:2,sortable:!0,field:{xtype:"cbbfield",configInfo:"JE_WF_DEFAULTVALUE",editable:!0,displayField:"code",listeners:{change:function(e,t,i){var n=e.ownerCt.grid.getSelectionModel().getSelection()[0];n&&n.set("value",t)}}}},{dataIndex:"text",editable:!1,flex:3,text:"名称"},{dataIndex:"code",hidden:!0,text:"编码"}]}]}],m.callParent(arguments)},commitValue:function(){var e=this.form;e.findField("editFields").commitValue(),e.findField("enabledButtons").commitValue(),e.findField("editChildren").commitValue(),e.findField("fieldsConfig").commitValue()}}),Ext.define("JE.sys.workflow.view.attr.imp.RoleDUTView",{extend:"Ext.tree.Panel",frame:!0,margins:"0 0 0 9",ref:"oktree",useArrows:!0,rootVisible:!1,animate:!1,buttonAlign:"center",buttons:[{xtype:"cgroup",name:"showType",dataArray:[{id:"1",code:"1",text:"使用此方式展示"}]}],initComponent:function(){var e=this,t=e.vals;e.title=t.ddName,e.root={text:"ROOT",id:"ROOT",expanded:!0,children:[]},e.tools=[{type:"expand",tooltip:"展开",handler:function(){e.expandAll()}},{type:"collapse",tooltip:"收起",handler:function(){e.collapseAll()}}];var i=Ext.create("Ext.form.field.ComboBox",{queryMode:"local",store:new Ext.data.Store({fields:["id","text","parentText"]}),hideTrigger:!0,valueField:"id",displayField:"text",ref:"queryTreeCBB",emptyText:"输入查询信息..."});e.tbar={dock:"top",xtype:"panel",layout:"column",defaults:{columnWidth:1},bodyStyle:"background:none;",border:0,items:[i]},e.callParent(arguments)},loadUsers:function(e){var t=e.recs,i=e.tree,n=this;n.getRootNode().removeAll();var a=[];Ext.each(t,function(e){a.push(e.data),n.searchParnet(i,e)}),n.expandAll();var l=n.down("combobox[ref=queryTreeCBB]");l.store.loadData(a),l.reset()},searchParnet:function(e,t){var i,n=e.getStore().getNodeById(t.get("id"));if(!n)return i;i=null;for(var a=n.getPath().replace("/ROOT/","").split("/"),l=(n.getDepth(),a.length-1);0<=l;l--){var o=a[l],d=this.getStore().getNodeById(o);if(d){i&&d.appendChild(i),o==t.get("id")&&(d.set("iconCls","jeicon jeicon-khgl-pc"),d.commit()),d.expand(!0),i=void 0;break}d=e.getStore().getNodeById(o);var r=Ext.clone(d.raw);r.id==t.get("id")?r.iconCls="jeicon jeicon-khgl-pc":r.iconCls="",i&&(r.children=[i]),i=r}i&&(this.getRootNode().appendChild(i),this.getRootNode().expand(!0))}}),Ext.define("JE.sys.workflow.view.attr.imp.RoleInsDeptUserTreeView",{extend:"JE.core.view.TreeView",margins:"0 9 0 0",ref:"deptusertree",frame:!0,buttonAlign:"center",buttons:[{xtype:"cgroup",name:"cascade",dataArray:[{id:"1",code:"1",text:"级联拖拽"}]}],initComponent:function(){var e=this.vals;this.title=e.ddName+"树",this.viewConfig={plugins:{ptype:"treeviewdragdrop",enableDrop:!1,ddGroup:"treeSelect"}},this.url=JE.getUrlMaps("je.core.dd.tree","loadTree"),this.queryItems=[{configInfo:e.configInfo,whereSql:" and STATUS='1'  AND VALID='1'"}],this.multiSelect=!1,this.showTitle=!1,this.type="query";var t=[{ddCode:e.ddCode,ddName:e.ddName,async:!1,whereSql:e.whereSql,orderSql:e.orderSql,parentSql:"",rootId:"ROOT",nodeInfo:"",moreRoot:!1}];this.params={excludes:"checked",onlyItem:!0,strData:Ext.encode(t)},this.on("load",function(e,t){var i=e.treeObj,n=i.up("window[xtype=workflow.userinswinview]"),a=n.down("multiselect[ref=multiselect]");n.down("treepanel[ref=oktree]").loadUsers({tree:i,recs:a.store.data.items})}),this.callParent(arguments)}}),Ext.define("JE.sys.workflow.view.attr.imp.UserInsWinView",{extend:"Ext.window.Window",width:850,height:600,alias:"widget.workflow.userinswinview",maximizable:!0,layout:{type:"hbox",pack:"start",align:"stretch",padding:1},defaults:{flex:5},modal:!0,buttonAlign:"center",afterRender:function(){this.callParent(arguments);this.showFn&&this.showFn(this)},constructor:function(e){var i=this,t=e.vals;i.iconCls=t.iconCls;var o=Ext.create("JE.sys.workflow.view.attr.imp.RoleInsDeptUserTreeView",{vals:t}),d=Ext.create("JE.sys.workflow.view.attr.imp.RoleDUTView",{vals:t});i.title=t.title,i.dockedItems=[{xtype:"toolbar",layout:{pack:"center"},dock:"bottom",items:[{text:"确定",ref:"okBtn",iconCls:"jeicon jeicon-check",handler:function(e){var t=!0;i.fn&&(t=i.fn(e)),0!=t&&e.up("window[xtype=workflow.userinswinview]").close()}},{text:"取消",ref:"cancleBtn",iconCls:"jeicon jeicon-cancel",handler:function(e){e.up("window[xtype=workflow.userinswinview]").close()}}]},{dock:"bottom",xtype:"form",layout:"column",hidden:"1"==JE.systemConfig.JE_SYSMODE,items:[{xtype:"treessfield",fieldLabel:"使用关系",labelWidth:60,name:"jtgsMc",padding:"10 5 1 5",columnWidth:.4,configInfo:"JE_CORE_YWCJ,jtgsMc~jtgsId,text~id,S"},{xtype:"rgroup",fieldLabel:"人员过滤",labelWidth:60,name:"userWhere",padding:"10 5 1 5",configInfo:"YESORNO,userWhere,CODE,S",columnWidth:.6,value:"0",unitTpl:"是否通过公司过滤角色、部门、岗位内人员"},{xtype:"cgroup",fieldLabel:"公司权限",padding:"1 5 10 0",labelWidth:75,columnWidth:.9,dataArray:[{id:"company",code:"company",text:"公司内可见"},{id:"companymanager",code:"companymanager",text:"公司监管可见(公司级)"},{id:"companymanagerdept",code:"companymanagerdept",text:"公司监管可见(部门级)"}],name:"permType"},{xtype:"cgroup",fieldLabel:"人员过滤",name:"userPerm",padding:"1 5 10 0",labelWidth:75,columnWidth:.9,dataArray:[{id:"dept",code:"dept",text:"本部门"},{id:"deptall",code:"deptall",text:"本部门含子部门"},{id:"zsld",code:"zsld",text:"直属领导"},{id:"head",code:"head",text:"本部门领导"},{id:"jghead",code:"jghead",text:"监管部门领导"},{id:"fzr",code:"fzr",text:"部门负责人"}]},{xtype:"textarea",fieldLabel:"人员过滤SQL",name:"userWhereSql",columnWidth:.9},{xtype:"hiddenfield",name:"jtgsId"}]}];var n=Ext.create("JE.core.ux.form.MultiSelect",{ref:"multiselect",dropGroup:"treeSelect",sourceCopy:!0,onlyChildren:!1,multiSelect:!0,displayField:"text",valueField:"id",store:{fields:["id","text","parentText","parentId","nodeInfoType"]},listConfig:{getInnerTpl:function(e){return"{text}<tpl if='parentText'><span style='color:#C0C0C0;'>({parentText})</span></tpl>"},listeners:{itemclick:function(e,t,i){var n=t.get("id"),a=d.getStore().getNodeById(n);a&&d.selectPath(a.getPath());var l=o.getStore().getNodeById(n);l&&o.selectPath(l.getPath())}}},listeners:{beforedrop:function(e,t){var i=e.up("window[xtype=workflow.userinswinview]").down("treepanel[ref=deptusertree]").down("cgroup[name=cascade]").getValue();e.cascadeChildren="1"==i},drop:function(e,t){if(0<t.length){var i=e.up("window[xtype=workflow.userinswinview]"),n=i.down("treepanel[ref=deptusertree]"),a=i.down("treepanel[ref=oktree]");Ext.each(t,function(e){a.searchParnet(n,e)})}}}}),r=function(e){if("jeicon jeicon-khgl-pc"!=e.get("iconCls")&&!e.hasChildNodes()&&!e.isRoot()){var t=e.parentNode;e.remove(),r(t)}};this.items=[o,{layout:"fit",frame:!0,title:"选中"+t.ddName,ref:"roleuser",buttonAlign:"center",buttons:[{text:"移除选中",iconCls:"jeicon jeicon-minus-circle",ref:"delete",handler:function(e){var t=e.up("window[xtype=workflow.userinswinview]"),i=t.down("[ref=multiselect]"),n=t.down("treepanel[ref=oktree]"),a=i.getSelected();if(a&&0<a.length){i.store.remove(a);var l=n.getStore();Ext.each(a,function(e){e.get("id");var t=l.getNodeById(e.get("id"));if(t.hasChildNodes())t.set("iconCls",""),t.commit();else{var i=t.parentNode;t.remove(),r(i)}})}}},{text:"一键清除",iconCls:"jeicon jeicon-trash-o",ref:"deleteAll",handler:function(e){var t=e.up("window[xtype=workflow.userinswinview]"),i=t.down("[ref=multiselect]");t.down("treepanel[ref=oktree]").getRootNode().removeAll(),i.store.removeAll()}}],items:n},d],this.callParent(arguments)}}),Ext.define("JE.sys.workflow.controller.WorkflowCtr",{extend:"Ext.app.Controller",init:function(){var e={"form[xtype=workflow.graphattr] textfield[name=PROCESSINFO_STARTEXP]":{afterrender:function(i){var n=i.up("form[xtype=workflow.graphattr]").form.findField(i.name+"FN");i.labelEl.on("click",function(){var e="/**\n * @param {Object} data 表单值\n * @param {Object} parentData 父功能表单值\n * @param {FormView} form 表单\n * @return {Boolean} \n **/\nfunction(data,parentData,form){\n}",t=n.getValue();Ext.isEmpty(t)||(e=JE.decodeURI(t)),JE.win({title:i.fieldLabel,width:800,height:600,frame:!1,layout:"fit",items:{border:0,xtype:"jecodeeditor",value:e,saveFn:function(e){n.setValue(JE.encodeURI(e)),JE.msg("保存成功！")}}}).show()})}},"form[xtype=workflow.graphattr] hidden[name=PROCESSINFO_EVENTJSON]":{change:this.updateEventInfos},"form[xtype=workflow.graphattr] hidden[name=PROCESSINFO_DIYEVENTJSON]":{change:this.updateDiyEventInfos},"form[xtype=workflow.lineattr] hidden[name=hideinfo]":{change:function(e,t){e.up("form").form.findField("info").setVisible("hide"!=t)}},"form[xtype=workflow.graphattr] textfield[name=PROCESSINFO_PROCESSNAME]":{change:function(e,t,i){if(!Ext.isEmpty(t)){var n=e.up("form[xtype=workflow.graphattr]").getForm(),a=n.findField("JE_CORE_PROCESSINFO_ID").getValue();if(Ext.isEmpty(a)){var l=JE.toPinYin(t,"pinyin");l+="_"+Ext.Date.format(new Date,"ymdH"),n.findField("PROCESSINFO_PROCESSKEY").setValue(l),n.findField("PROCESSINFO_FILENAME").setValue(l)}}}},"form[xtype=workflow.graphattr] yesnofield[name=PROCESSINFO_ANYONESTARTABLE]":{change:function(e,t,i){if(!Ext.isEmpty(t)){var n=e.up("form[xtype=workflow.graphattr]").getForm().findField("PROCESSINFO_STARTROLENAMES");"1"==t?n.setReadOnly(!0):n.setReadOnly(!1)}}},"form[xtype=workflow.taskattr] field[name=type]":{change:function(e,t,i){var n=["hq","clpz","cyxx","bdpz","eventInfos","zdyButton","execuConfig","jointConfig","comments","rejectConfig"],a=[];a="start"==t?n:"end"==t?["hq","clpz","cyxx","eventInfos","zdyButton","execuConfig","jointConfig","comments","rejectConfig","rollbackDisable"]:-1!=["countersign"].indexOf(t)?["execuConfig","jointConfig","rejectConfig","rollbackDisable","warnConfig"]:"auto"==t?["hq","clpz","cyxx","eventInfos","zdyButton","jointConfig","rejectConfig","rollbackDisable","warnConfig"]:"joint"==t?["hq","execuConfig"]:"fork"==t||"join"==t?["hq","clpz","cyxx","eventInfos","zdyButton","jointConfig","execuConfig","comments","rejectConfig","rollbackDisable","warnConfig"]:["hq","execuConfig","jointConfig"],e.ownerCt.ownerCt.items.each(function(e){var t=e.ref;-1!=n.indexOf(t)&&e.setVisible(-1==a.indexOf(t))})}},"form[xtype=workflow.taskattr] hidden[name=eventInfos]":{change:this.updateEventInfos},"form[xtype=workflow.taskattr] hidden[name=processInfos]":{change:this.updateProcessInfos},"form[xtype=workflow.taskattr] hidden[name=assigeeName]":{beforequery:function(e){}},"form[xtype=workflow.taskattr] gridssfield[name=editFieldNames]":{beforequery:function(e){var t=e.up("form[xtype=workflow.taskattr]").editor.graphAttr.PROCESSINFO_FUNCID;if(Ext.isEmpty(t))return JE.alert("请选择功能"),!1;e.whereSql=" AND RESOURCEFIELD_FUNCINFO_ID='"+t+"'"}},"form[xtype=workflow.taskattr] gridssfield[name=enableBtnNames]":{beforequery:function(e){var t=e.up("form[xtype=workflow.taskattr]").editor.graphAttr.PROCESSINFO_FUNCID;if(Ext.isEmpty(t))return JE.alert("请选择功能"),!1;e.whereSql=" AND RESOURCEBUTTON_FUNCINFO_ID='"+t+"'"}}};this.control(e)},updateEventInfos:function(e){var t=e.up("form").down("fieldset[ref=eventInfos]"),i=Ext.decode(Ext.value(e.getValue(),"[]")),n=new Ext.XTemplate('<tpl for=".">','<div style="margin:3px 0;">{#}. {eventName}</div>',"</tpl>");t.update(n.apply(i))},updateProcessInfos:function(e){var t=e.up("form").down("fieldset[ref=processInfos]"),i=Ext.decode(Ext.value(e.getValue(),"[]")),n=new Ext.XTemplate('<tpl for=".">','<div style="margin:3px 0;">{#}. {processName}</div>',"</tpl>");t.update(n.apply(i))},updateDiyEventInfos:function(e){var t=e.up("form").down("fieldset[ref=diyEventInfos]"),i=Ext.decode(Ext.value(e.getValue(),"[]")),n=new Ext.XTemplate('<tpl for=".">','<div style="margin:3px 0;">{#}. {TABLENAME}</div>',"</tpl>");t.update(n.apply(i))},views:["JE.sys.workflow.view.MainView","JE.sys.workflow.view.Graph","JE.sys.workflow.view.Attrs","JE.sys.workflow.view.Cells","JE.sys.workflow.view.attr.TaskAttr","JE.sys.workflow.view.attr.LineAttr","JE.sys.workflow.view.attr.ChildAttr","JE.sys.workflow.view.attr.GraphAttr","JE.sys.workflow.view.attr.imp.RoleDUTView","JE.sys.workflow.view.attr.imp.RoleInsDeptUserTreeView","JE.sys.workflow.view.attr.imp.UserInsWinView"],stores:[],models:[]}),Ext.define("JE.sys.chart.view.MainView",{extend:"Ext.panel.Panel",alias:"widget.chart.mainview",layout:"border",border:0,initComponent:function(){this.items=[{region:"west",width:170,split:!0,margins:"1",itemId:"westview",xtype:"chart.westview"},{region:"center",layout:"card",xtype:"panel",itemId:"centerview",border:0,items:[{itemId:"charthelp",xtype:"box",bodyStyle:"background-color:#ffffff;",html:'<img src="'+JE.getStaticUrl("JE.sys.chart.view.MainView.chart")+'" style="position: absolute;top:50%;left:50%;margin-top:-127px;margin-left:-157px;"/>'},{itemId:"chartmainview",xtype:"chart.chartmainview"},{itemId:"reportmainview",xtype:"report.reportmainview"}]}],this.callParent(arguments),this.getCmp("centerview").getCmp("chartmainview").chartsTree=this.getCmp("westview").getCmp("chartstree")}}),Ext.define("JE.sys.chart.view.WestView",{extend:"Ext.tab.Panel",autoScroll:!0,alias:"widget.chart.westview",initComponent:function(){this.tabPosition="left",this.items=[{xtype:"report.reporttree",itemId:"reporttree",title:"报表",border:0,iconCls:"jeicon jeicon-chart"},{xtype:"chart.chartstree",itemId:"chartstree",title:"图表",border:0,iconCls:"jeicon jeicon-pie-chart"},{xtype:"chart.datasourceview",itemId:"datasourceview",title:"数据源",border:0,iconCls:"jeicon jeicon-database-two"}],this.callParent(arguments)}}),Ext.define("JE.sys.chart.view.chart.AttrsView",{extend:"Ext.tab.Panel",alias:"widget.chart.attrsview",initComponent:function(){this.plain=!0,this.items=[{title:"基本",iconCls:"jeicon jeicon-basic-chart",itemId:"basicview",xtype:"chart.chartsedit"},{title:"样式",itemId:"chartsstyle",iconCls:"jeicon jeicon-style-color",xtype:"panel",layout:"card",defaults:{border:0,autoScroll:!0,margin:2},items:[{xtype:"chart.chartsstyle",itemId:"chartsstyle"},{xtype:"chart.chartsstyle4A",itemId:"chartsstyle4A"},{xtype:"chart.chartsstyle4PR",itemId:"chartsstyle4PR"}],getChartData:function(){return this.getLayout().getActiveItem().getChartData()},setChartData:function(t){this.items.each(function(e){e.setChartData(t)})}},{title:"查询",itemId:"searchview",iconCls:"jeicon jeicon-search",xtype:"chart.chartssearch"},{title:"高级",itemId:"chartsother",iconCls:"jeicon jeicon-chart-engine",xtype:"chart.chartsother"},{title:"EChart",itemId:"echartsstyle",iconCls:"jeicon jeicon-style-color",xtype:"chart.chartsstyle4EC"}],this.buttonAlign="left",this.buttons=[{text:"保存",iconCls:"jeicon jeicon-save",ref:"saveBtn"},{text:"执行预览",iconCls:"jeicon jeicon-lightning-on",ref:"previewBtn"},{text:"复制样式",iconCls:"jeicon jeicon-chart-copy",ref:"copyStyleBtn",disabled:!0},{text:"粘贴样式",iconCls:"jeicon jeicon-paste",ref:"pasteStyleBtn",disabled:!0},{text:"FChart预览",hidden:!0,iconCls:"jeicon jeicon-lightning-on",ref:"echartBtn"}],this.callParent(arguments)}}),Ext.define("JE.sys.chart.view.chart.ChartsBasic",{extend:"Ext.form.Panel",alias:"widget.chart.chartsbasic",layout:"column",tableCode:"JE_CORE_CHARTS",initComponent:function(){this.defaults={labelWidth:60,labelAlign:"right",margin:"1"};var e={id:"ROOT",expanded:!0,children:JE.ChartUtil.getChartsTypes()};this.items=[{xtype:"treessfield",columnWidth:.33,configInfo:",CHARTS_TYPECODE~CHARTS_TYPENAME,code~text_,S",rootData:e,name:"CHARTS_TYPENAME",allowBlank:!1,fieldLabel:"图表"},{xtype:"hidden",name:"CHARTS_TYPECODE",allowBlank:!1,fieldLabel:"图表编码"},{xtype:"textfield",columnWidth:.33,allowBlank:!1,name:"CHARTS_TEXT",fieldLabel:"名称"},{xtype:"textfield",name:"CHARTS_CODE",columnWidth:.33,allowBlank:!1,fieldLabel:"编码"},{xtype:"textfield",name:"CHARTS_REMARK",columnWidth:1,fieldLabel:"说明"},{xtype:"hidden",name:"CHARTS_DSIDS",allowBlank:!1,fieldLabel:"图表数据源"},{xtype:"hidden",name:"CHARTS_DSNAMES",allowBlank:!1,fieldLabel:"图表数据源名称"},{xtype:"hidden",name:"CHARTS_MS",columnWidth:1,fieldLabel:"多数据源"},{xtype:"hidden",name:"CHARTS_ICONCLS",columnWidth:1,fieldLabel:"图标"},{xtype:"hidden",name:"JE_CORE_CHARTS_ID",listeners:{change:function(e,t){e.codeField||(e.codeField=e.ownerCt.form.findField("CHARTS_CODE")),e.codeField.setReadOnly(!Ext.isEmpty(t))}}}],this.callParent(arguments)}}),Ext.define("JE.sys.chart.view.chart.ChartsDS",{extend:"Ext.tree.Panel",alias:"widget.chart.chartsds",useArrows:!0,rootVisible:!1,animate:!1,initComponent:function(){var d=this;d.root={expanded:!0,id:"ROOT",children:[]},d.viewConfig={plugins:{ptype:"treeviewdragdrop",ddGroup:"ChartsDSGroup",appendOnly:!0,dragText:"{1}"}},d.bulidMenu(),d.callParent(arguments),d.on({containercontextmenu:function(e,t,i){t.stopEvent(),d.getSelectionModel().deselectAll(),d.contextMenu.getCmp("add").setDisabled(!1),d.contextMenu.getCmp("edit").setDisabled(!0),d.contextMenu.getCmp("remove").setDisabled(!0),d.contextMenu.showAt(t.getXY())},itemcontextmenu:function(e,t,i,n,a,l){a.stopEvent();var o="DS"==t.raw.type;d.contextMenu.getCmp("add").setDisabled(!1),d.contextMenu.getCmp("edit").setDisabled(!o),d.contextMenu.getCmp("remove").setDisabled(!o),d.contextMenu.showAt(a.getXY())}})},afterRender:function(){this.callParent(arguments),this.basicForm=this.ownerCt.down("form[xtype=chart.chartsbasic]"),this.dscfgView=this.ownerCt.down("form[xtype=chart.chartsdscfg]"),this.searchView=this.ownerCt.down("form[xtype=chart.chartssearch]")},loadDSData:function(e,t){var o=this,i=[],d=[];JE.isNotEmpty(e)&&(i=JE.ajax({url:JE.getUrlMaps("je.core.sys.chart","load"),params:{tableCode:"JE_CORE_DATASOURCE",whereSql:"and JE_CORE_DATASOURCE_ID in('"+e.replaceAll(",","','")+"')",limit:-1}}).rows),o.fields=new Ext.util.MixedCollection;var r=new Ext.util.MixedCollection,c=new Ext.util.MixedCollection,s={};if(Ext.each(i,function(e){var t=Ext.decode(e.DATASOURCE_CONFIG),i=e.JE_CORE_DATASOURCE_ID,n=e.DATASOURCE_TEXT,a=e.DATASOURCE_CODE;s[a]=["columns"];var l={id:i,text:n+"("+a+")",code:a,expandable:!0,expanded:!0,leaf:!1,iconCls:e.DATASOURCE_ICONCLS,type:"DS",children:[{id:i+"_data",text:"数据轴",expandable:!1,leaf:!0,type:"ds",children:[]},{id:i+"_columns",text:"字段",expandable:!0,leaf:!1,type:"columns",children:[]},{id:i+"_params",text:"参数",expandable:!0,leaf:!1,children:[]},{id:i+"_defvals",text:"系统变量",expandable:!0,leaf:!1,children:[]}]};Ext.each(t.fields,function(e){var t=Ext.isString(e)?e:e.name;s[a].push(t),o.fields.add(t,{code:t,text:t}),l.children[1].children.push({id:l.children[0].id+"_"+t,text:t,type:"dsfield",leaf:!0})}),Ext.each(t.params,function(e){var t=Ext.isObject(e)?e.name:e;r.add(t,{code:t,name:t}),l.children[2].children.push({id:l.children[1].id+"_"+t,text:t,leaf:!0})}),Ext.each(t.defvals,function(e){c.add(e,e),l.children[3].children.push({id:l.children[2]+"_"+e,text:e,leaf:!0})}),d.push(l)}),0!=t){var n,a=o.searchView,l=a.form.findField("params"),E=l.getData(),f=[];JE.isNotEmpty(E)&&Ext.each(E,function(e){r.get(e.code)&&(f.push(e),r.removeAtKey(e.code))}),n=f.concat(r.items),l.setValue(n),a.form.findField("defvals").setValue(c.items.join(","));var u=o.ownerCt.getCmp("attrsview").getCmp("basicview"),p=u.getCmp("chartsdscfg"),m=u.getCmp("chartsdscfg4a");if(!p.isHidden()){var x=p.form.getValues();Ext.each(["label","data","series"],function(e){var t=Ext.value(x[e+"Field"],x[e]);if(JE.isNotEmpty(t)){var i=t.split(".")[0],n=t.split(".")[1],a=s[i];if(!s.hasOwnProperty(i)||JE.isNotEmpty(n)&&-1==a.indexOf(n)){var l={};l[e]="",l[e+"Field"]="",l[e+"Cfg"]="",p.form.setValues(l)}}})}if(!m.isHidden()){var g=m.form.findField("data").getValue();JE.isNotEmpty(g)&&m.form.reset()}}o.setRootNode({id:"ROOT",children:d}),o.basicForm.form.findField("CHARTS_DSIDS").setValue(e)},bulidMenu:function(){var t=this;t.contextMenu=Ext.create("Ext.menu.Menu",{width:100,margin:"0 0 10 0",items:[{text:"载入数据源",itemId:"add",iconCls:"jeicon jeicon-chart-histogram-new",handler:function(e){t.addDS()}},{text:"移除数据源",itemId:"remove",iconCls:"jeicon jeicon-data-deletion",handler:function(e){t.removeDS()}},{text:"同步数据源",itemId:"refresh",iconCls:"jeicon jeicon-table-column-synchronization",handler:function(e){t.refreshDS()}},"-",{text:"编辑数据源",iconCls:"jeicon jeicon-document-attribute",itemId:"edit",handler:function(){t.editDS()}}]})},addDS:function(){var n=this,a=n.basicForm.form.findField("CHARTS_DSIDS"),e=JE.ajax({url:JE.getUrlMaps("je.core.sys.chart","getTree"),params:{tableCode:"JE_CORE_DATASOURCE",excludes:"",sort:[{property:"SY_ORDERINDEX",direction:"ASC"}]}});JE.selectWin({title:"数据源",type:"tree",multiSelect:!0,rootData:e,valueType:"id",okButtonClick:function(e,t){var i=a.getValue().split(",");Ext.each(e,function(e){var t=e.get("id");-1==i.indexOf(t)&&i.push(t)}),JE.isNotEmpty(e)&&n.loadDSData(i.join(","))}})},removeDS:function(){var e=this.getSelectionModel().getSelection()[0],t=this.basicForm.form.findField("CHARTS_DSIDS").getValue().split(",");t=Ext.Array.remove(t,e.get("id")),this.loadDSData(t.join(",")),JE.msg("删除完成，请保存数据！")},editDS:function(){var e=this.up("panel[xtype=chart.mainview]");if(e){var t=this.getSelectionModel().getSelection()[0],i=e.down("treepanel[xtype=chart.datasourceview]");(t=i.store.getById(t.get("id")))?(i.ownerCt.setActiveTab(i),i.selectPath(t.getPath()),i.fireEvent("itemdblclick",i.view,t)):JE.alert("该数据源已经不存在，请同步数据源信息！")}},refreshDS:function(){var e=this.basicForm.form.findField("CHARTS_DSIDS");this.loadDSData(e.getValue()),JE.msg("同步完成，请保存数据！")}}),Ext.define("JE.sys.chart.view.chart.ChartsDSCfg",{extend:"Ext.form.Panel",alias:"widget.chart.chartsdscfg",layout:"column",initComponent:function(){var l=this;l.defaults=Ext.value(l.defaults,{});l.defaults=Ext.apply({xtype:"textfield",labelWidth:80,margin:"1",labelAlign:"right"},l.defaults),l.items=[{fieldLabel:"标签(X)轴",inputAttrTpl:"dsfield",allowBlank:!1,columnWidth:.7,editable:!0,xtype:"gridssfield",configInfo:"JE_CORE_DICTIONARY,label,DICTIONARY_DDCODE,S",whereSql:" AND SY_JESYS='1'",listeners:{query:function(e){e.setValue("DIC."+e.getValue())}},name:"label"},{fieldLabel:"对应字段",inputAttrTpl:"dsfield",columnWidth:.3,xtype:"trigger",triggerCls:"x-form-clear-trigger",onTriggerClick:function(){this.reset()},name:"labelField"},{fieldLabel:"数据(Y)轴",xtype:"trigger",triggerCls:"x-form-clear-trigger",onTriggerClick:function(){this.reset()},inputAttrTpl:"dsfield",columnWidth:.7,allowBlank:!1,name:"data"},{fieldLabel:"排序",columnWidth:.3,name:"labelOrder",xtype:"cbbfield",dataArray:[{code:"ASC",text:"升序"},{code:"DESC",text:"降序"}]},{fieldLabel:"系列",name:"series",xtype:"gridssfield",inputAttrTpl:"dsfield",allowBlank:!1,disabled:!0,columnWidth:.7,editable:!0,configInfo:"JE_CORE_DICTIONARY,series,DICTIONARY_DDCODE,S",whereSql:" AND SY_JESYS='1'",listeners:{query:function(e){e.setValue("DIC."+e.getValue())}}},{fieldLabel:"对应字段",columnWidth:.3,inputAttrTpl:"dsfield",disabled:!0,xtype:"trigger",triggerCls:"x-form-clear-trigger",onTriggerClick:function(){this.reset()},name:"seriesField"},{fieldLabel:"系列配置项",disabled:!0,columnWidth:1,name:"seriesCfg",xtype:"jsonarrayfield",cellEditListeners:{beforeedit:function(e,t){if("name"==t.field){var i=t.column.getEditor(),n=l.up("panel[itemId=chartsCfg]").getCmp("chartsds"),a=n.fields?n.fields.items:[];i.store.loadData(a)}}},columns:[{dataIndex:"name",text:"系列项",flex:1,field:{xtype:"cbbfield",dataArray:[]}},{dataIndex:"color",text:"颜色",width:80,field:{xtype:"colorfield"}},{dataIndex:"type",text:"组合图类型",width:100,field:{xtype:"cbbfield",dataArray:[{code:"Column",text:"Column"},{code:"Line",text:"Line"},{code:"Area",text:"Area"}]}},{dataIndex:"rightY",text:"属于右侧Y轴",width:80,xtype:"uxcheckcolumn"},{dataIndex:"showValues",text:"显示数值",width:80,xtype:"uxcheckcolumn"}]}],l.callParent(arguments)},afterRender:function(){this.dropTarget=new Ext.dd.DropTarget(this.body,{ddGroup:"ChartsDSGroup",notifyOver:function(e,t,i){var n=i.records[0];if(i.allowDD=!1,n&&-1!=["ds","dsfield","columns"].indexOf(n.raw.type)){var a=t.getTarget("input[type=text]");if(a){var l=Ext.getCmp(a.id.replace("-inputEl",""));-1!=["data","label","seriesField","labelField"].indexOf(l.name)&&"columns"==n.raw.type?i.allowDD=!1:-1!=["seriesField","labelField"].indexOf(l.name)&&"ds"==n.raw.type?i.allowDD=!1:i.allowDD=!(!a||!a.hasAttribute("dsfield")||a.disabled),i.dropTextField=l}}return i.allowDD?e.dropAllowed:e.dropNotAllowed},notifyDrop:function(e,t,i){if(i.allowDD){var n=i.dropTextField,a=i.records[0];if(n&&a){var l="";if("dsfield"==a.raw.type){if(l=a.parentNode.parentNode.raw.code+"."+a.get("text"),"series"==n.name){var o=n.getValue();Ext.isEmpty(o)||(-1==(o=o.split(",")).indexOf(l)&&o.push(l),l=o.join(","))}}else"columns"==a.raw.type?l=a.parentNode.raw.code+".columns":"ds"==a.raw.type&&(l=a.parentNode.raw.code);n.setValue(l)}}return i.allowDD}}),this.callParent(arguments)}}),Ext.define("JE.sys.chart.view.chart.ChartsDSCfg4A",{extend:"Ext.form.Panel",alias:"widget.chart.chartsdscfg4a",layout:"column",autoScroll:!1,initComponent:function(){this.defaults=Ext.value(this.defaults,{});this.defaults=Ext.apply({xtype:"textfield",labelWidth:80,margin:"1",labelAlign:"right"},this.defaults),this.items=[{fieldLabel:"指针数据",xtype:"trigger",triggerCls:"x-form-clear-trigger",onTriggerClick:function(){this.reset()},inputAttrTpl:"dsfield",columnWidth:.7,allowBlank:!1,name:"data"},{fieldLabel:"指针配置项",columnWidth:1,name:"dialsCfg",xtype:"jsonarrayfield",columns:[{dataIndex:"id",text:"指针项",flex:1},{dataIndex:"bgcolor",text:"背景色",width:80,field:{xtype:"colorfield"}},{dataIndex:"bordercolor",text:"边框色",width:80,field:{xtype:"colorfield"}},{dataIndex:"alpha",text:"透明度",width:80,field:{xtype:"numberfield"}},{dataIndex:"radius",text:"指针长度",width:80,field:{xtype:"numberfield"}},{dataIndex:"showvalue",text:"显示数值",width:80,xtype:"uxcheckcolumn"}]}],this.callParent(arguments)},afterRender:function(){this.dropTarget=new Ext.dd.DropTarget(this.body,{ddGroup:"ChartsDSGroup",notifyOver:function(e,t,i){var n=i.records[0];if(i.allowDD=!1,n&&-1!=["dsfield"].indexOf(n.raw.type)){var a=t.getTarget("input[type=text]");if(a){var l=Ext.getCmp(a.id.replace("-inputEl",""));i.dropTextField=l,i.allowDD=!(!a||!a.hasAttribute("dsfield")||a.disabled)}}return i.allowDD?e.dropAllowed:e.dropNotAllowed},notifyDrop:function(e,t,i){if(i.allowDD){var n=i.dropTextField,a=i.records[0];if(n&&a){var l="";if("dsfield"==a.raw.type&&(l=a.parentNode.parentNode.raw.code+"."+a.get("text"),"data"==n.name)){var o=n.getValue();Ext.isEmpty(o)||(-1==(o=o.split(",")).indexOf(l)&&o.push(l),l=o.join(","))}n.setValue(l)}}return i.allowDD}}),this.callParent(arguments)}}),Ext.define("JE.sys.chart.view.chart.ChartsEdit",{extend:"Ext.panel.Panel",alias:"widget.chart.chartsedit",border:0,bodyPadding:2,layout:"column",autoScroll:!0,initComponent:function(){this.defaults={columnWidth:1,border:0},this.items=[{xtype:"box",html:"基础",margin:4,padding:"3 20",style:"font-weight: bold;color: #0852F0;background-color: #E4E4E4;",width:"100%"},{itemId:"basic",xtype:"chart.chartsbasic"},{xtype:"box",html:"规划信息",margin:4,padding:"3 20",style:"font-weight: bold;color: #0852F0;background-color: #E4E4E4;",width:"100%"},{itemId:"chartsdscfg",xtype:"chart.chartsdscfg"},{itemId:"chartsdscfg4a",xtype:"chart.chartsdscfg4a",hidden:!0}],this.callParent(arguments),this.basicForm=this.getCmp("basic"),this.discfgForm=this.getCmp("chartsdscfg"),this.discfgForm4A=this.getCmp("chartsdscfg4a")},afterRender:function(){this.callParent(arguments)},isValid:function(){var e=this.basicForm.form.findField("CHARTS_DSIDS").getValue();if(Ext.isEmpty(e))return JE.alert("请选择数据源！"),!1;var t=this.discfgForm.isHidden()?this.discfgForm4A:this.discfgForm;if(!this.basicForm.isValid()||!t.isValid())return JE.alert("请将必填项填写完整！"),!1;var i=t.form.getValues(),n=this.up("[xtype=chart.chartmainview]").down("[xtype=chart.chartsds]").getRootNode(),a=!1;return n.eachChild(function(e){i.data.startsWith(e.raw.code)&&(a=!0)}),!!a||(JE.alert("请从数据源中选择【数据(Y)轴】！"),!1)},getChartData:function(){var e=this.discfgForm.isHidden()?this.discfgForm4A:this.discfgForm;return{basic:this.basicForm.form.getValues(),dsCfg:e.form.getValues(),chart:{}}},setChartData:function(e){var t=this.basicForm,i=this.discfgForm,n=this.discfgForm4A;t.form.reset(),t.form.setValues(e.basic),i.form.reset(),i.form.setValues(e.dsCfg),n.form.reset(),n.form.setValues(e.dsCfg)}}),Ext.define("JE.sys.chart.view.chart.ChartsOther",{extend:"Ext.form.Panel",alias:"widget.chart.chartsother",layout:"column",bodyPadding:5,initComponent:function(){this.defaults={labelAlign:"right",margin:"1"},this.items=[{fieldLabel:"图表穿透事件",xtype:"fieldcontainer",layout:"hbox",columnWidth:1,items:[{xtype:"yesnofield",labelAlign:"right",boxLabel:"启用",margin:"1 5 1 1",name:"enableEvent",listeners:{change:function(e,t){e.nextSibling().setDisabled(!t)}}},{xtype:"button",cls:"btn",itemId:"editEvent",disabled:!0,fieldName:"labelclick",text:"编辑事件"},{xtype:"hidden",name:"labelclick"}]},{fieldLabel:"图表加载前事件",xtype:"fieldcontainer",layout:"hbox",columnWidth:1,items:[{xtype:"yesnofield",labelAlign:"right",boxLabel:"启用",margin:"1 5 1 1",name:"enableLoadEvent",listeners:{change:function(e,t){e.nextSibling().setDisabled(!t)}}},{xtype:"button",cls:"btn",itemId:"editEvent",fieldName:"beforeload",disabled:!0,text:"编辑事件"},{xtype:"hidden",name:"beforeload"}]},{xtype:"box",padding:"5",margin:"2 30",columnWidth:1,cls:"x-view-emtpytext",html:"说明:当单击图表每一部分的时候会触发此处程序,我们可以根据自己的实际业务来编写代码.<br>JE.showChart('CHART_CODE',{<br>title:'图表',<br>width:800,<br>height:500,<br>params:{}})<br>此方法可以调用另外一个图形报表。"}],this.callParent(arguments)},getChartData:function(){return{otherCfg:this.form.getValues()}},setChartData:function(e){this.form.reset(),this.form.setValues(e.otherCfg)}}),Ext.define("JE.sys.chart.view.chart.ChartsPreview",{extend:"JE.core.view.ChartView",alias:"widget.chart.chartspreview",initComponent:function(){this.EChart=!0,this.callParent(arguments)},loadCharts:function(e,t){var i=this;delete i.chartCfg,i.buildChartCfg(e),i.buildParamsForm(),i.clearListeners(),"1"==i.chartCfg.otherCfg.enableEvent&&i.on("labelclick",JE.eval(i.chartCfg.otherCfg.labelclick)),i.destroyChart();var n=Ext.apply(Ext.clone(i.searchDefVals),Ext.value(t,{}));return i.load(n,"1"==i.chartCfg.dsCfg.initParams)},updateCharts:function(e){var t=this.body.id,i=new FusionCharts({swfUrl:JE.ChartUtil.loadSwf(e.code,!0),width:"100%",height:"100%"});return i.setJSONData(this.buildData(e)),i.render(t),this.chart=i},buildData:function(e){var l=this,o=l.hasListener("labelclick"),t={},i={caption:"示例",xaxisname:"月份",pyaxisname:"数量",bgalpha:"0",canvasbgalpha:"0",showvalues:"0",showborder:"0",canvasborderalpha:"0",showalternatehgridcolor:"0",plotgradientcolor:"",showplotborder:"0",divlinealpha:"10",use3dlighting:"0",palettecolors:"#008ee4,#f8bd19,#6baa01,#9b59b6,#e44a00,#d35400,#bdc3c7,#95a5a6,#34495e,#1abc9c"};t.chart=i;var d,r=[{label:"一月"},{label:"二月"},{label:"三月"},{label:"四月"},{label:"五月"},{label:"六月"},{label:"七月"},{label:"八月"},{label:"九月"},{label:"十月"},{label:"十一月"},{label:"十二月"}],c=[];if(e.MS||e.Stacked||e.Scroll||e.DY){t.categories=[{category:r}];var s=[{name:"2006",type:"Column"},{name:"2007",type:"Area"},{name:"2008",type:"Line"}],E=[];Ext.each(s,function(n,e){var a=[];Ext.each(r,function(e){var t={value:Math.floor(10*Math.random()+1)},i={id:JE.uuid("_"),label:e.label,value:t.value,seriesname:n.name,renderas:n.type};o&&(t.link="j-JE.ChartUtil.labelClick-"+l.id+","+i.id),a.push(t),c.push(i),Ext.isEmpty(d)&&(d=[],Ext.iterate(i,function(e,t){d.push(e)}))});var t={seriesname:n.name,renderas:n.type,data:a};e==s.length-1&&(t.parentyaxis="S",i.syaxisname=n.name),E.push(t)}),t.dataset=E}else Ext.each(r,function(e){e.value=Math.floor(10*Math.random()+1);var t={id:JE.uuid("_"),label:e.label,value:e.value};o&&(e.link="j-JE.ChartUtil.labelClick-"+l.id+","+t.id),c.push(t),Ext.isEmpty(d)&&(d=[],Ext.iterate(t,function(e,t){d.push(e)}))}),t.data=r;return l.store=Ext.create("Ext.data.Store",{fields:d,data:c}),t}}),Ext.define("JE.sys.chart.view.chart.ChartsSearch",{extend:"Ext.form.Panel",alias:"widget.chart.chartssearch",layout:"column",autoScroll:!0,bodyPadding:5,cls:"je-chartFunc-config",initComponent:function(){var t=this;t.defaults=Ext.value(t.defaults,{});function n(e){t.getCmp("helpMsg").update({text:JE.helpMsg.configinfo[e]})}t.defaults=Ext.apply({xtype:"textfield",labelWidth:80,margin:"1",labelAlign:"right"},t.defaults),t.items=[{fieldLabel:"查询面板",xtype:"fieldcontainer",layout:"hbox",items:[{xtype:"yesnofield",boxLabel:"不启用",name:"hideSearch"},{xtype:"yesnofield",boxLabel:"默认收起",name:"collapsed"},{xtype:"yesnofield",boxLabel:"初始化查询",name:"initParams"},{xtype:"yesnofield",boxLabel:"菜单查询",name:"menuSearch"},{xtype:"yesnofield",boxLabel:"树形查询",name:"treeSearch"}],columnWidth:.6},{fieldLabel:"背景颜色",xtype:"colorfield",labelWidth:60,columnWidth:.2,name:"bgcolor"},{fieldLabel:"高/宽",xtype:"numberfield",name:"hw",minValue:1,columnWidth:.2},{fieldLabel:"面板位置",xtype:"rgroup",name:"region",value:"north",dataArray:[{code:"north",text:"上"},{code:"south",text:"下"},{code:"west",text:"左"},{code:"east",text:"右"}],columnWidth:.4},{fieldLabel:"查询按钮",xtype:"rgroup",name:"btnRegion",value:"north",dataArray:[{code:"top",text:"上"},{code:"bottom",text:"下"},{code:"left",text:"左"},{code:"right",text:"右"}],columnWidth:.4},{fieldLabel:"查询窗体宽",xtype:"numberfield",name:"winWidth",minValue:1,columnWidth:.2},{fieldLabel:"查询参数",xtype:"jsonarrayfield",name:"params",columnWidth:1,actionColumn:!0,listeners:{afterrender:function(e){e.grid.on("selectionchange",function(e,t){var i="";JE.isNotEmpty(t)&&(i=t[0].get("xtype")),n(i)})}},columns:[{dataIndex:"code",width:50,text:"编码"},{dataIndex:"name",width:50,text:"名称"},{dataIndex:"xtype",text:"类型",width:100,tactics:[{type:"dic",dicCode:"JE_FUNC_XTYPE"}],renderer:JE.renderer,field:{xtype:"cbbfield",dicItemCodes:"textfield,rgroup,cgroup,cbbfield,datefield,datetimefield,datemonthfield,rangedatefield,treessfield,gridssfield,queryuserfield,colorfield",configInfo:"JE_FUNC_XTYPE",listeners:{change:function(e,t){n(t)}}}},{dataIndex:"field",text:"依附字段",width:100,field:{xtype:"cbbfield",dataArray:[]}},{dataIndex:"configInfo",width:300,text:"配置信息"},{dataIndex:"hidden",width:50,text:"隐藏",align:"center",xtype:"uxcheckcolumn"},{width:50,text:"事件",align:"center",xtype:"actioncolumn",items:[{tooltip:"编辑",handler:function(e,t,i){var n=e.panel.getStore().getAt(t),a="/**\n * 编码格式：{render:function(field){},change:function(field){}} \n **/\n{\n\n}";a=Ext.value(n.get("listeners"),a),JE.win({title:"字段事件",width:800,height:600,frame:!1,layout:"fit",items:{border:0,xtype:"jecodeeditor",value:a,saveFn:function(e){n.set("listeners",e==a?"":e),JE.msg("保存成功！")}}}).show()},getClass:function(e,t,i){return JE.isNotEmpty(i.get("listeners"))?"jeicon jeicon-lightning-on":"jeicon jeicon-lightning-off"}}]},{dataIndex:"listeners",hidden:!0},{dataIndex:"useText",text:"启用展示字段",xtype:"uxcheckcolumn"},{dataIndex:"value",width:100,text:"默认值",field:{xtype:"cbbfield",name:"RESOURCEFIELD_VALUE",editable:!0,configInfo:"JE_DEFAULEVALUE,value,code,S"},tactics:[{type:"dic",dicCode:"JE_DEFAULEVALUE"}],renderer:JE.renderer},{dataIndex:"valueFn",hidden:!0},{text:"默认值方法",xtype:"actioncolumn",width:100,align:"center",items:[{tooltip:"编辑",handler:function(e,t,i){var n=e.panel.getStore().getAt(t),a="/**\n * @return {Object} \n **/\nfunction(){\n}";a=Ext.value(n.get("valueFn"),a),JE.win({title:"默认值",width:800,height:600,frame:!1,layout:"fit",items:{border:0,xtype:"jecodeeditor",value:a,saveFn:function(e){n.set("valueFn",e==a?"":e),JE.msg("保存成功！")}}}).show()},getClass:function(e,t,i){return JE.isNotEmpty(i.get("valueFn"))?"jeicon jeicon-lightning-on":"jeicon jeicon-lightning-off"}}]},{dataIndex:"width",text:"宽",width:50,field:{xtype:"numberfield",hideTrigger:!0,value:200}},{dataIndex:"changeS",text:"即时查询",xtype:"uxcheckcolumn"},{dataIndex:"format",text:"格式化结果",width:80,field:{xtype:"cbbfield",dataArray:["in"]}}]},{xtype:"box",padding:"5",margin:"2 2 2 86",columnWidth:1,cls:"x-view-emtpytext",data:{},itemId:"helpMsg",tpl:["<b>配置信息说明：</b>",'<tpl if="text">',"</br>{text}","<tpl else>","无","</tpl>"]},{fieldLabel:"系统变量",xtype:"textarea",readOnly:!0,columnWidth:1,name:"defvals"}],t.callParent(arguments)},getChartData:function(){return{dsCfg:this.form.getValues()}},setChartData:function(i){this.form.reset(),this.form.setValues(i.dsCfg);var e=this.form.findField("params"),t=e.grid.down("gridcolumn[dataIndex=field]");i=[];e.grid.store.each(function(e){var t=e.get("code");i.push({text:t,code:t})}),t.getEditor?t.getEditor().store.loadData(i):t.field.dataArray=i}}),Ext.define("JE.sys.chart.view.chart.ChartsStyle",{extend:"Ext.form.Panel",alias:"widget.chart.chartsstyle",layout:"column",initComponent:function(){var e=this;e.defaults={labelAlign:"right",margin:1,labelWidth:80,minValue:0},e.items=[e.getTitleBox("画布"),{fieldLabel:"标题",name:"caption",xtype:"textfield"},{fieldLabel:"X轴标题",name:"xaxisname",xtype:"textfield"},{fieldLabel:"Y轴标题",name:"yaxisname",xtype:"textfield"},{xtype:"box",width:"99%"},{fieldLabel:"子标题",name:"subcaption",xtype:"textfield"},{fieldLabel:"右Y轴标题",name:"syaxisname",xtype:"textfield"},{xtype:"box",width:"99%"},{fieldLabel:"背景颜色",name:"canvasbgcolor",xtype:"colorfield"},{fieldLabel:"透明度",name:"canvasbgalpha",xtype:"numberfield"},{xtype:"box",width:"99%"},{fieldLabel:"边框颜色",name:"canvasbordercolor",xtype:"colorfield"},{fieldLabel:"边框宽度",name:"canvasborderthickness",xtype:"numberfield"},{fieldLabel:"边框透明度",name:"canvasborderalpha",xtype:"numberfield"},e.getTitleBox("X轴设置"),{fieldLabel:"显示标签",name:"showlabels",value:1,xtype:"yesnofield"},{fieldLabel:"标签数值",value:1,name:"showvalues",xtype:"yesnofield",boxLabel:"显示"},{value:1,name:"rotatevalues",xtype:"yesnofield",boxLabel:"旋转"},{value:1,name:"placevaluesinside",xtype:"yesnofield",boxLabel:"内部显示(柱图)"},{fieldLabel:"提示信息",value:1,name:"showtooltip",xtype:"yesnofield",boxLabel:"开启"},{fieldLabel:"动画",value:1,name:"animation",labelWidth:40,xtype:"yesnofield",boxLabel:"开启"},{fieldLabel:"标签位置",name:"labeldisplay",xtype:"rgroup",dataArray:[{code:"AUTO",text:"自动"},{code:"WRAP",text:"换行"},{code:"STAGGER",text:"交错"},{code:"ROTATE",text:"旋转"},{code:"NONE",text:"正常"}]},{fieldLabel:"倾斜(旋转时可用)",name:"slantlabels",labelWidth:120,xtype:"yesnofield"},{fieldLabel:"标签间隔数",name:"labelstep",xtype:"numberfield"},{xtype:"fieldcontainer",fieldLabel:"标签配色库",layout:"hbox",items:[{xtype:"yesnofield",name:"enablecolors",boxLabel:"启用"},{xtype:"textfield",name:"palettecolors",width:550,value:"#008ee4,#f8bd19,#6baa01,#9b59b6,#e44a00,#d35400,#bdc3c7,#95a5a6,#34495e,#1abc9c"}]},{xtype:"box",width:"99%"},e.getTitleBox("Y轴设置"),{fieldLabel:"Y轴数据",value:1,name:"showyaxisvalues",xtype:"yesnofield",boxLabel:"显示"},{xtype:"box",width:"99%"},{fieldLabel:"左Y轴最大值",width:150,name:"pyaxismaxvalue",xtype:"numberfield"},{fieldLabel:"最小值",name:"pyaxisminvalue",width:150,xtype:"numberfield"},{fieldLabel:"前缀",name:"numberprefix",width:150,xtype:"textfield"},{fieldLabel:"后缀",name:"numbersuffix",width:150,xtype:"textfield"},{width:"99%",xtype:"box"},{fieldLabel:"右Y轴最大值",name:"syaxismaxvalue",width:150,xtype:"numberfield"},{fieldLabel:"最小值",name:"syaxisminvalue",width:150,xtype:"numberfield"},{fieldLabel:"前缀",name:"snumberprefix",width:150,xtype:"textfield"},{fieldLabel:"后缀",name:"snumbersuffix",width:150,xtype:"textfield"},e.getTitleBox("图例"),{fieldLabel:"图例",name:"showlegend",xtype:"yesnofield",boxLabel:"显示"},{fieldLabel:"图例位置",name:"legendposition",xtype:"rgroup",dataArray:[{text:"下",code:"BOTTOM"},{text:"右",code:"RIGHT"}]},e.getTitleBox("字体"),{fieldLabel:"基础字体",name:"basefont",configInfo:"JE_OFFICE_FONTFAMILY",xtype:"cbbfield",editable:!0},{fieldLabel:"大小",name:"basefontsize",minValue:0,maxValue:72,xtype:"numberfield"},{fieldLabel:"颜色",name:"basefontcolor",xtype:"colorfield"},{xtype:"box",width:"99%"},{fieldLabel:"画布外字体",name:"outcnvbasefont",configInfo:"JE_OFFICE_FONTFAMILY",xtype:"cbbfield",editable:!0},{fieldLabel:"大小",name:"outcnvbasefontsize",minValue:0,maxValue:72,xtype:"numberfield"},{fieldLabel:"颜色",name:"outcnvbasefontcolor",xtype:"colorfield"},e.getTitleBox("背景"),{fieldLabel:"背景色",name:"bgcolor",xtype:"colorfield"},{fieldLabel:"透明度",name:"bgalpha",xtype:"numberfield"},{width:"99%",xtype:"box"},{fieldLabel:"背景图片",name:"bgimage",trigger2Cls:"x-form-file-trigger",xtype:"uxtrigger",handler:function(){var i=this;JE.uploadFile({params:{pkValue:vals.JE_CORE_CHARTS_ID,funcCode:"JE_CORE_CHARTS",tableCode:"JE_CORE_CHARTS",beanTableCode:"JE_CORE_CHARTS",jeFileType:"PROJECT",returnType:"all"},callback:function(e){var t=e.privateUrl||JE.getFileUrl(t,"PUBLIC","","","JE_CORE_CHARTS");i.setValue(e.url)}})}},{fieldLabel:"透明度",name:"bgimagealpha",xtype:"numberfield"},{fieldLabel:"显示模式",name:"bgimagedisplaymode",xtype:"rgroup",dataArray:[{code:"none",text:"原图"},{code:"fit",text:"适应"},{code:"fill",text:"填充"},{code:"stretch",text:"拉伸"},{code:"tile",text:"平铺"},{code:"center",text:"居中"}]},{xtype:"box",width:"99%"},{fieldLabel:"水平位置",name:"bgimagehalign",xtype:"rgroup",dataArray:[{code:"left",text:"左"},{code:"middle",text:"中"},{code:"right",text:"右"}]},{fieldLabel:"竖直位置",name:"bgimagevalign",xtype:"rgroup",dataArray:[{code:"top",text:"上"},{code:"middle",text:"中"},{code:"bottom",text:"下"}]},e.getTitleBox("水平区分线"),{fieldLabel:"跨度",name:"numdivlines",xtype:"numberfield",width:150},{fieldLabel:"颜色",name:"divlinecolor",width:150,xtype:"colorfield"},{fieldLabel:"宽度",name:"divlinethickness",width:150,xtype:"numberfield"},{fieldLabel:"透明度",name:"divlinealpha",width:150,xtype:"numberfield"},{fieldLabel:"虚线",name:"divlineisdashed",labelWidth:40,xtype:"yesnofield"},{xtype:"box",width:"99%"},{fieldLabel:"启用区间色",name:"showalternatehgridcolor",xtype:"yesnofield"},{fieldLabel:"区间色",name:"alternatehgridcolor",xtype:"colorfield"},{fieldLabel:"透明度",name:"alternatehgridalpha",xtype:"numberfield"},e.getTitleBox("垂直区分线(折线图或面积图有效)"),{fieldLabel:"跨度",width:150,name:"numvdivlines",xtype:"numberfield"},{fieldLabel:"颜色",width:150,name:"vdivlinecolor",xtype:"colorfield"},{fieldLabel:"宽度",width:150,name:"vdivlinethickness",xtype:"numberfield"},{fieldLabel:"透明度",width:150,name:"vdivlinealpha",xtype:"numberfield"},{fieldLabel:"虚线",name:"vdivlineisdashed",labelWidth:40,xtype:"yesnofield"},{xtype:"box",width:"99%"},{fieldLabel:"启用区间色",name:"showalternatevgridcolor",xtype:"yesnofield"},{fieldLabel:"区间色",name:"alternatevgridcolor",xtype:"colorfield"},{fieldLabel:"透明度",name:"alternatevgridalpha",xtype:"numberfield"},e.getTitleBox("基准线"),{xtype:"jsonarrayfield",height:100,width:660,margin:"1 1 1 20",actionColumnIndex:0,name:"trendLines",columns:[{text:"名称",dataIndex:"displayvalue"},{text:"开始值",dataIndex:"startvalue",field:{xtype:"textfield"}},{text:"公式",dataIndex:"startGS",field:{xtype:"cbbfield",hideTrigger2:!0,dataArray:[{code:"mean",text:"平均"},{code:"sum",text:"求和"},{code:"max",text:"最大值"},{code:"min",text:"最小值"},{code:"count",text:"计数"}]}},{text:"格式",dataIndex:"startFormat",field:{xtype:"textfield"}},{text:"描述",dataIndex:"tooltext"},{text:"颜色",dataIndex:"color",field:{xtype:"colorfield"}},{text:"宽度",dataIndex:"thickness",width:60,field:{xtype:"numberfield",hideTrigger:!0}},{text:"透明度",dataIndex:"alpha",width:60,field:{xtype:"numberfield",hideTrigger:!0}},{text:"虚线",dataIndex:"dashed",xtype:"uxcheckcolumn",width:40},{text:"区域",dataIndex:"istrendzone",xtype:"uxcheckcolumn",width:40},{text:"结束值",dataIndex:"endvalue",field:{xtype:"textfield"}},{text:"公式",dataIndex:"endGS",field:{xtype:"cbbfield",hideTrigger2:!0,dataArray:[{code:"mean",text:"平均"},{code:"sum",text:"求和"},{code:"max",text:"最大值"},{code:"min",text:"最小值"},{code:"count",text:"计数"}]}},{text:"格式",dataIndex:"endFormat",field:{xtype:"textfield"}},{text:"右侧显示",dataIndex:"valueonright",xtype:"uxcheckcolumn",width:60},{text:"右Y轴",dataIndex:"parentYAxis",xtype:"uxcheckcolumn",width:60},{text:"垂直",dataIndex:"vline",xtype:"uxcheckcolumn",width:40,hidden:!0}]},{xtype:"box",padding:"5",margin:"2 2 2 20",width:660,cls:"x-view-emtpytext",html:"说明：</br>1、开始值，结束值：如果没有配置公式，按照配置的值显示，如果配置了公式，那么就以动态值展示。</br>动态展示规则是：当值为空，表示统计的全部数据，如果值为 L.标签值 ，则统计标签等于“标签值”的数据如果值为 L.系列值 ，则统计系列等于“系列值”的数据</br>2、名称，描述：提供了两个动态参数 startvalue,endvalue,如：平均值{startvalue}</br>3、格式：</br>0 - (123456)只显示数字,没有精度</br>0,000 - (123,456) 显示逗号和数字,没有精度</br>0.00 - (123456.78)只显示数字,2位小数;小数点后N个0，表示N位小数</br>0.#### - (123456789)允许最多4位小数,但不要用零填充"},e.getTitleBox("其他配置"),{xtype:"jsonfield",width:660,margin:"1 1 1 20",actionColumnIndex:0,name:"otherCfg"}],e.callParent(arguments)},getChartData:function(){return{chart:this.form.getValues()}},setChartData:function(e){this.form.reset(),this.form.setValues(e.chart)},getTitleBox:function(e){return{xtype:"box",html:e,margin:4,padding:"3 20",style:"font-weight: bold;color: #0852F0;background-color: #E4E4E4;",width:"99%"}}}),Ext.define("JE.sys.chart.view.chart.ChartsStyle4A",{extend:"Ext.form.Panel",alias:"widget.chart.chartsstyle4A",layout:"column",initComponent:function(){var t=this;t.defaults={labelAlign:"right",margin:1,labelWidth:80,minValue:0},t.items=[t.getTitleBox("画布"),{fieldLabel:"标题",name:"caption",xtype:"textfield"},{fieldLabel:"子标题",name:"subcaption",xtype:"textfield"},{xtype:"box",width:"99%"},t.getTitleBox("表盘信息"),{fieldLabel:"显示数值",name:"showvalue",xtype:"yesnofield"},{fieldLabel:"数值位置",name:"valueBelowPivot",xtype:"yesnofield",boxLabel:"中心轴下"},{fieldLabel:"后缀",name:"numbersuffix",xtype:"textfield",width:150},{fieldLabel:"前缀",name:"numberprefix",xtype:"textfield",width:150},{fieldLabel:"最小值",name:"lowerLimit",xtype:"numberfield",width:200,allowBlank:!1},{fieldLabel:"最小值文字",hideLabel:!0,name:"lowerlimitdisplay",xtype:"textfield",width:100,emptyText:"描述"},{fieldLabel:"最大值",name:"upperLimit",xtype:"numberfield",width:200,allowBlank:!1},{fieldLabel:"最大值文字",hideLabel:!0,name:"upperlimitdisplay",xtype:"textfield",width:100,emptyText:"描述"},{xtype:"box",width:"99%"},{fieldLabel:"显示刻度",name:"showtickvalues",xtype:"yesnofield"},{fieldLabel:"内部显示",name:"placevaluesinside",xtype:"yesnofield"},{fieldLabel:"主刻度个数",name:"majorTMNumber",xtype:"numberfield",width:150},{fieldLabel:"次刻度个数",name:"minorTMNumber",xtype:"numberfield",width:150},{fieldLabel:"刻度距离",name:"tickvaluedistance",xtype:"numberfield",width:150},{xtype:"box",width:"99%"},{fieldLabel:"半径",name:"gaugeouterradius",xtype:"numberfield",width:150},{fieldLabel:"内半径",name:"gaugeinnerradius",xtype:"textfield",unitTpl:"(数字/百分比)",width:250},{fieldLabel:"开始角度",name:"gaugestartangle",xtype:"numberfield",width:150,minValue:-360},{fieldLabel:"结束角度",name:"gaugeendangle",xtype:"numberfield",width:150,minValue:-360},{fieldLabel:"实时数据",name:"realTime",xtype:"yesnofield"},{fieldLabel:"间隔时间",name:"times",xtype:"numberfield",unitTpl:"毫秒"},{xtype:"box",width:"99%"},{fieldLabel:"中心坐标X",name:"gaugeOriginX",xtype:"textfield",unitTpl:"(数字/百分比)"},{fieldLabel:"中心坐标Y",name:"gaugeOriginY",xtype:"textfield",unitTpl:"(数字/百分比)"},t.getTitleBox("范围值颜色"),{xtype:"jsonarrayfield",height:100,width:700,margin:"1 1 1 20",actionColumnIndex:0,name:"colorrange",columns:[{text:"开始值",dataIndex:"minvalue",field:{xtype:"textfield"}},{text:"结束值",dataIndex:"maxvalue",field:{xtype:"textfield"}},{text:"颜色",dataIndex:"code",field:{xtype:"colorfield"}}]},t.getTitleBox("字体"),{fieldLabel:"基础字体",name:"basefont",configInfo:"JE_OFFICE_FONTFAMILY",xtype:"cbbfield",editable:!0},{fieldLabel:"大小",name:"basefontsize",minValue:0,maxValue:72,xtype:"numberfield"},{fieldLabel:"颜色",name:"basefontcolor",xtype:"colorfield"},{xtype:"box",width:"99%"},{fieldLabel:"画布外字体",name:"outcnvbasefont",configInfo:"JE_OFFICE_FONTFAMILY",xtype:"cbbfield",editable:!0},{fieldLabel:"大小",name:"outcnvbasefontsize",minValue:0,maxValue:72,xtype:"numberfield"},{fieldLabel:"颜色",name:"outcnvbasefontcolor",xtype:"colorfield"},t.getTitleBox("背景"),{fieldLabel:"背景色",name:"bgcolor",xtype:"colorfield"},{fieldLabel:"透明度",name:"bgalpha",xtype:"numberfield"},{width:"99%",xtype:"box"},{fieldLabel:"背景图片",name:"bgimage",trigger2Cls:"x-form-file-trigger",xtype:"uxtrigger",onTriggerClick:function(){var i=this,e=t.getChartData();JE.uploadFile({params:{pkValue:e.JE_CORE_CHARTS_ID,funcCode:"JE_CORE_CHARTS",tableCode:"JE_CORE_CHARTS",beanTableCode:"JE_CORE_CHARTS",jeFileType:"PROJECT",returnType:"all"},callback:function(e){var t=e.privateUrl||JE.getFileUrl(t,"PUBLIC","","","JE_CORE_CHARTS");i.setValue(t)}})}},{fieldLabel:"透明度",name:"bgimagealpha",xtype:"numberfield"},{fieldLabel:"显示模式",name:"bgimagedisplaymode",xtype:"rgroup",dataArray:[{code:"none",text:"原图"},{code:"fit",text:"适应"},{code:"fill",text:"填充"},{code:"stretch",text:"拉伸"},{code:"tile",text:"平铺"},{code:"center",text:"居中"}]},{xtype:"box",width:"99%"},{fieldLabel:"水平位置",name:"bgimagehalign",xtype:"rgroup",dataArray:[{code:"left",text:"左"},{code:"middle",text:"中"},{code:"right",text:"右"}]},{fieldLabel:"竖直位置",name:"bgimagevalign",xtype:"rgroup",dataArray:[{code:"top",text:"上"},{code:"middle",text:"中"},{code:"bottom",text:"下"}]},t.getTitleBox("基准线"),{xtype:"jsonarrayfield",height:100,width:700,margin:"1 1 1 20",actionColumnIndex:0,name:"trendpoints",columns:[{text:"名称",dataIndex:"displayvalue"},{text:"开始值",dataIndex:"startvalue",field:{xtype:"textfield"}},{text:"结束值",dataIndex:"endvalue",field:{xtype:"textfield"}},{text:"使用指向标",dataIndex:"usemarker",xtype:"uxcheckcolumn"},{text:"半径",dataIndex:"radius",field:{xtype:"numberfield",hideTrigger:!0}},{text:"内半径",dataIndex:"innerradius",field:{xtype:"numberfield",hideTrigger:!0}},{text:"颜色",dataIndex:"color",field:{xtype:"colorfield"}},{text:"边框色",dataIndex:"bordercolor",field:{xtype:"colorfield"}},{text:"透明度",dataIndex:"alpha",width:60,field:{xtype:"numberfield",hideTrigger:!0}}]},t.getTitleBox("其他配置"),{xtype:"jsonfield",width:700,margin:"1 1 1 20",actionColumnIndex:0,name:"otherCfg"}],t.callParent(arguments)},getChartData:function(){return{chart:this.form.getValues()}},setChartData:function(e){this.form.reset(),this.form.setValues(e.chart)},getTitleBox:function(e){return{xtype:"box",html:e,margin:4,padding:"3 20",style:"font-weight: bold;color: #0852F0;background-color: #E4E4E4;",width:"99%"}}}),Ext.define("JE.sys.chart.view.chart.ChartsStyle4EC",{extend:"Ext.form.Panel",alias:"widget.chart.chartsstyle4EC",layout:"column",autoScroll:!0,initComponent:function(){var l=this;l.items=[l.getTitleBox("基础",[{fieldLabel:"启用EChart图表",name:"enableEChart",columnWidth:.5,labelWidth:120,readOnly:!0,xtype:"yesnofield",labelStyle:"font-weight: bold;color: #0852F0;",boxLabel:"启用EChart图表作为图表引擎",value:"1"},{fieldLabel:"主题",name:"theme",columnWidth:.2,labelWidth:50,xtype:"cbbfield",value:"macarons",dataArray:[{code:"macarons",text:"马卡龙"},{code:"infographic",text:"信息图"},{code:"vintage",text:"复古"},{code:"shine",text:"亮色"},{code:"dark",text:"暗色"}]},{fieldLabel:"自定义配置项",xtype:"fieldcontainer",layout:"hbox",columnWidth:.3,items:[{xtype:"yesnofield",labelAlign:"right",boxLabel:"启用",margin:"1 5 1 1",name:"enableIDIT",listeners:{change:function(e,t){e.nextSibling().setDisabled(!t)}}},{xtype:"button",cls:"btn",disabled:!0,text:"配置项",handler:function(e){var t=e.nextSibling(),i=Ext.value(t.getValue(),"/*\n\t option 处理好的EChart配置项，可以自行修改\n\t panel 图表panel\n\t cfg 图表的原始配置\n*/\nfunction(option,panel,cfg){\n\t return option;\n}");JE.win({title:"单击事件(Ctrl+S保存)",width:800,height:600,border:0,items:{xtype:"jecodeeditor",itemId:"editorview",value:i,saveFn:function(e){t.setValue(e),JE.msg("保存成功...")},border:0}}).show()}},{xtype:"hidden",name:"iditOption"}]},{fieldLabel:"x轴标签旋转角度",labelWidth:120,name:"rotate_x",columnWidth:.3,xtype:"numberfield",minValue:-90,maxValue:90},{fieldLabel:"数据项位置",name:"labelPosition",columnWidth:.3,configInfo:"JE_CHART_LABELPOSITION",xtype:"cbbfield"},{xtype:"fieldcontainer",fieldLabel:"画布间距",layout:"column",columnWidth:.4,defaults:{labelAlign:"right",xtype:"textfield",columnWidth:.25,margin:"0"},items:[{emptyText:"上",name:"grid_top"},{emptyText:"右",name:"grid_right"},{emptyText:"下",name:"grid_bottom"},{emptyText:"左",name:"grid_left"}]}]),l.getTitleBox("标题",[{fieldLabel:"水平位置",name:"titleX",value:"center",xtype:"cbbfield",columnWidth:.4,hideTrigger1:!0,dataArray:[{code:"left",text:"左"},{code:"center",text:"中"},{code:"right",text:"右"}]},{fieldLabel:"垂直位置",name:"titleY",value:"top",columnWidth:.4,xtype:"cbbfield",hideTrigger1:!0,dataArray:[{code:"top",text:"上"},{code:"center",text:"中"},{code:"bottom",text:"下"}]},{fieldLabel:"隐藏",name:"hideTitle",columnWidth:.2,xtype:"yesnofield"}]),l.getTitleBox("图表",[{xtype:"fieldcontainer",fieldLabel:JE.getIconTpl("jeicon jeicon-line-graph")+"折线图",layout:"hbox",columnWidth:1,items:[{xtype:"yesnofield",name:"lineSmooth",boxLabel:"平滑曲线"},{name:"lineType",value:"solid",xtype:"cbbfield",hideTrigger1:!0,width:100,margin:"0 5",dataArray:[{code:"solid",text:"实线"},{code:"dashed",text:"虚线"},{code:"dotted",text:"点线"}]}]},{xtype:"fieldcontainer",fieldLabel:JE.getIconTpl("jeicon jeicon-dashboard")+"仪表盘",layout:"hbox",columnWidth:1,defaults:{labelAlign:"right",labelWidth:80,margin:1},items:[{xtype:"yesnofield",name:"gaugeHideTitle",boxLabel:"隐藏内部标题"},{xtype:"yesnofield",name:"gaugeHideSL",boxLabel:"隐藏主刻度"},{xtype:"yesnofield",name:"gaugeHideAT",boxLabel:"隐藏副刻度"},{xtype:"numberfield",name:"gaugeSL",minValue:0,width:150,fieldLabel:"主刻度长度"},{xtype:"numberfield",name:"gaugeAT",minValue:0,width:150,fieldLabel:"副刻度长度"}]}]),{xtype:"fieldcontainer",fieldLabel:JE.getIconTpl("jeicon jeicon-pie-chart")+"饼图，环形，"+JE.getIconTpl("jeicon jeicon-dashboard")+"仪表盘(内半径为仪表盘宽度)，"+JE.getIconTpl("jeicon jeicon-radar-chart")+"雷达图",labelStyle:"font-weight: bold;color: #0852F0;margin-left:24px;margin-bottom:4px;",labelAlign:"top",layout:"column",columnWidth:1,defaults:{labelAlign:"right",columnWidth:.25,labelWidth:70,margin:1},items:[{xtype:"textfield",name:"ERadius",fieldLabel:"半径",emptyText:"数字/百分比",columnWidth:.2},{xtype:"textfield",name:"ERadius2",columnWidth:.3,labelWidth:120,fieldLabel:"内半径/仪表盘宽度",emptyText:"数字/百分比"},{xtype:"textfield",name:"ECenterX",fieldLabel:"圆心位置X",emptyText:"数字/百分比"},{xtype:"textfield",name:"ECenterY",fieldLabel:"圆心位置Y",emptyText:"数字/百分比"},{xtype:"yesnofield",name:"EPieLabelPosition",fieldLabel:"饼图标签",boxLabel:"内部显示",columnWidth:.2},{xtype:"textfield",name:"EPieLabelFormatter",labelWidth:120,columnWidth:.8,fieldLabel:"饼图标签格式化",emptyText:"{name} : {value} ({percent}%)"}]},l.getTitleBox("数据提示",[{fieldLabel:"触发类型",name:"tooltipTrigger",xtype:"cbbfield",columnWidth:.3,hideTrigger1:!0,value:"item",dataArray:[{code:"item",text:"数据"},{code:"axis",text:"坐标轴"}]},{fieldLabel:"坐标轴指示器",name:"tooltipPointer",xtype:"cbbfield",labelWidth:90,hideTrigger1:!0,value:"none",columnWidth:.3,dataArray:[{code:"none",text:"无"},{code:"line",text:"线"},{code:"cross",text:"十字"},{code:"shadow",text:"阴影"}]},{fieldLabel:"内容格式",name:"tooltipFormatter",xtype:"textfield",hidden:!0,columnWidth:.3}]),l.getTitleBox("图例",[{fieldLabel:"水平位置",name:"legendX",value:"center",xtype:"cbbfield",columnWidth:.3,hideTrigger1:!0,dataArray:[{code:"left",text:"左"},{code:"center",text:"中"},{code:"right",text:"右"}]},{fieldLabel:"垂直位置",name:"legendY",value:"bottom",columnWidth:.3,xtype:"cbbfield",hideTrigger1:!0,dataArray:[{code:"top",text:"上"},{code:"center",text:"中"},{code:"bottom",text:"下"}]},{fieldLabel:"布局方式",name:"legendOrient",value:"horizontal",columnWidth:.4,xtype:"cbbfield",hideTrigger1:!0,dataArray:[{code:"horizontal",text:"水平"},{code:"vertical",text:"垂直"}]}]),l.getTitleBox("字体",[{fieldLabel:"主标题字体",xtype:"fontstylefield",columnWidth:1,name:"textStyle"},{fieldLabel:"副标题字体",xtype:"fontstylefield",columnWidth:1,name:"subtextStyle"},{fieldLabel:"数据项字体",xtype:"fontstylefield",columnWidth:1,name:"itemtextStyle"},{fieldLabel:"XY轴标题字体",xtype:"fontstylefield",columnWidth:1,name:"xyTitletextStyle"},{fieldLabel:"XY轴标签字体",xtype:"fontstylefield",columnWidth:1,name:"xyLabeltextStyle"}]),l.getTitleBox("标注",[{xtype:"jsonarrayfield",height:100,columnWidth:1,margin:"0 20",actionColumnIndex:0,name:"mark",cellEditListeners:{beforeedit:function(e,t){if("serie"==t.field){var i=t.column.getEditor(),n=l.up("panel[itemId=chartsCfg]").getCmp("chartsds"),a=n.fields?n.fields.items:[];i.store.loadData(a)}}},columns:[{text:"系列",dataIndex:"serie",flex:1,field:{xtype:"cbbfield",dataArray:[]}},{text:"标注类型",dataIndex:"type",field:{xtype:"cbbfield",value:"line",hideTrigger1:!0,dataArray:[{code:"line",text:"线"},{code:"point",text:"点"}]}},{text:"标注值",dataIndex:"value",field:{xtype:"cbbfield",value:"max",hideTrigger1:!0,editable:!0,dataArray:[{code:"max",text:"最大值"},{code:"min",text:"最小值"},{code:"average",text:"平均值"}]}},{text:"描述",dataIndex:"name"},{text:"标签格式化",dataIndex:"label",field:{xtype:"textfield",emptyText:"{name}:{value}"}},{text:"颜色",dataIndex:"color",field:{xtype:"colorfield"}}]}])],l.callParent(arguments)},getChartData:function(){return{echart:this.form.getValues()}},setChartData:function(e){this.form.reset(),this.form.setValues(e.echart)},getTitleBox:function(e,t){return{xtype:"fieldset",title:e,legendStyle:"width:99.7%;background-color: #E4E4E4;padding:3px 20px;",titleStyle:"font-weight: bold;color: #0852F0;",border:0,columnWidth:1,minWidth:700,margin:4,padding:"4 0 0 0",layout:"column",defaults:{labelAlign:"right",margin:1,labelWidth:90,minValue:0},items:t}}}),Ext.define("JE.sys.chart.view.chart.ChartsStyle4PR",{extend:"Ext.form.Panel",alias:"widget.chart.chartsstyle4PR",layout:"column",initComponent:function(){var t=this;t.defaults={labelAlign:"right",margin:1,labelWidth:80,minValue:0},t.items=[t.getTitleBox("画布"),{fieldLabel:"标题",name:"caption",xtype:"textfield"},{fieldLabel:"子标题",name:"subcaption",xtype:"textfield"},{xtype:"box",width:"99%"},{fieldLabel:"显示标签",name:"showlabels",value:1,xtype:"yesnofield"},{fieldLabel:"标签数值",value:1,name:"showvalues",xtype:"yesnofield",boxLabel:"显示"},{fieldLabel:"提示信息",value:1,name:"showtooltip",xtype:"yesnofield",boxLabel:"开启"},{fieldLabel:"动画",value:1,name:"animation",labelWidth:40,xtype:"yesnofield",boxLabel:"开启"},{xtype:"box",width:"99%"},t.getTitleBox("字体"),{fieldLabel:"基础字体",name:"basefont",configInfo:"JE_OFFICE_FONTFAMILY",xtype:"cbbfield",editable:!0},{fieldLabel:"大小",name:"basefontsize",minValue:0,maxValue:72,xtype:"numberfield"},{fieldLabel:"颜色",name:"basefontcolor",xtype:"colorfield"},{xtype:"box",width:"99%"},{fieldLabel:"画布外字体",name:"outcnvbasefont",configInfo:"JE_OFFICE_FONTFAMILY",xtype:"cbbfield",editable:!0},{fieldLabel:"大小",name:"outcnvbasefontsize",minValue:0,maxValue:72,xtype:"numberfield"},{fieldLabel:"颜色",name:"outcnvbasefontcolor",xtype:"colorfield"},t.getTitleBox("背景"),{fieldLabel:"背景色",name:"bgcolor",xtype:"colorfield"},{fieldLabel:"透明度",name:"bgalpha",xtype:"numberfield"},{width:"99%",xtype:"box"},{fieldLabel:"背景图片",name:"bgimage",trigger2Cls:"x-form-file-trigger",xtype:"uxtrigger",onTriggerClick:function(){var i=this,e=t.getChartData();JE.uploadFile({params:{pkValue:e.JE_CORE_CHARTS_ID,funcCode:"JE_CORE_CHARTS",tableCode:"JE_CORE_CHARTS",beanTableCode:"JE_CORE_CHARTS",jeFileType:"PROJECT",returnType:"all"},callback:function(e){var t=e.privateUrl||JE.getFileUrl(t,"PUBLIC","","","JE_CORE_CHARTS");i.setValue(t)}})}},{fieldLabel:"透明度",name:"bgimagealpha",xtype:"numberfield"},{fieldLabel:"显示模式",name:"bgimagedisplaymode",xtype:"rgroup",dataArray:[{code:"none",text:"原图"},{code:"fit",text:"适应"},{code:"fill",text:"填充"},{code:"stretch",text:"拉伸"},{code:"tile",text:"平铺"},{code:"center",text:"居中"}]},{xtype:"box",width:"99%"},{fieldLabel:"水平位置",name:"bgimagehalign",xtype:"rgroup",dataArray:[{code:"left",text:"左"},{code:"middle",text:"中"},{code:"right",text:"右"}]},{fieldLabel:"竖直位置",name:"bgimagevalign",xtype:"rgroup",dataArray:[{code:"top",text:"上"},{code:"middle",text:"中"},{code:"bottom",text:"下"}]},t.getTitleBox("饼图，锥形图"),{fieldLabel:"图例",name:"showlegend",xtype:"yesnofield",boxLabel:"显示"},{fieldLabel:"图例位置",name:"legendposition",xtype:"rgroup",dataArray:[{text:"下",code:"BOTTOM"},{text:"右",code:"RIGHT"}]},{fieldLabel:"百分比数值",value:0,name:"showpercentvalues",xtype:"yesnofield",boxLabel:"显示"},{fieldLabel:"百分比数值提示",labelWidth:100,value:1,name:"showpercentintooltip",xtype:"yesnofield",boxLabel:"显示"},{xtype:"fieldcontainer",fieldLabel:"标签配色库",layout:"hbox",items:[{xtype:"yesnofield",name:"enablecolors",boxLabel:"启用"},{xtype:"textfield",name:"palettecolors",width:550,value:"#008ee4,#f8bd19,#6baa01,#9b59b6,#e44a00,#d35400,#bdc3c7,#95a5a6,#34495e,#1abc9c"}]},t.getTitleBox("雷达图"),{fieldLabel:"Y轴数据",value:1,name:"showyaxisvalues",xtype:"yesnofield",boxLabel:"显示"},{xtype:"box",width:"99%"},{fieldLabel:"区域线跨度",name:"numdivlines",xtype:"numberfield",width:150},{fieldLabel:"颜色",name:"divlinecolor",xtype:"colorfield"},{fieldLabel:"宽度",name:"divlinethickness",width:150,xtype:"numberfield"},{fieldLabel:"透明度",name:"divlinealpha",width:150,xtype:"numberfield"},{xtype:"box",width:"99%"},{fieldLabel:"边框色",name:"radarbordercolor",xtype:"colorfield"},{fieldLabel:"透明度",name:"radarborderalpha",xtype:"numberfield"},{fieldLabel:"宽度",name:"radarborderthickness",xtype:"numberfield"},{fieldLabel:"背景色",name:"radarfillcolor",xtype:"colorfield"},{fieldLabel:"透明度",name:"radarfillalpha",xtype:"numberfield"},t.getTitleBox("其他配置"),{xtype:"jsonfield",width:700,margin:"1 1 1 20",actionColumnIndex:0,name:"otherCfg"}],t.callParent(arguments)},getChartData:function(){return{chart:this.form.getValues()}},setChartData:function(e){this.form.reset(),this.form.setValues(e.chart)},getTitleBox:function(e){return{xtype:"box",html:e,margin:4,padding:"3 20",style:"font-weight: bold;color: #0852F0;background-color: #E4E4E4;",width:"99%"}}}),Ext.define("JE.sys.chart.view.chart.ChartsTree",{extend:"Ext.tree.Panel",alias:"widget.chart.chartstree",border:1,useArrows:!0,rootVisible:!1,animate:!1,codeSearch:!0,showTitle:!1,mixins:["JE.core.util.ViewUtil","JE.core.util.func.Tree"],initComponent:function(){var e=this,t=e.getTreeTbar(e);e.dockedItems=[t],e.funcData={info:{tableName:"JE_CORE_CHARTS",pkName:"JE_CORE_CHARTS_ID"}},e.store=JE.getStore({tableName:"JE_CORE_CHARTS",url:JE.getUrlMaps("je.core.sys.chart","getTree"),type:"tree"}),e.store.on("load",function(){e.getRootNode().expandChildren()}),e.setTreeDDPlugin(e),e.bulidMenu(),e.callParent(arguments)},bulidMenu:function(){var t=this;t.contextMenu=Ext.create("Ext.menu.Menu",{width:100,margin:"0 0 10 0",items:[{text:"新建图表",itemId:"chart",iconCls:"jeicon jeicon-chart-histogram-new",handler:function(e){t.addNode(e)}},"-",{text:"新建目录",itemId:"folder",iconCls:"jeicon jeicon-folder-add",handler:function(e){t.updateNode("doSave")}},{text:"删除",iconCls:"jeicon jeicon-data-deletion",itemId:"remove",handler:function(){t.removeNode()}}]})},removeNode:function(){var t=this.getSelectionModel().getSelection()[0];if(!Ext.isEmpty(t)){var e=t.get("text"),i=t.get("id");JE.confirm("确定删除："+e+" ?",function(e){"ok"==e&&(JE.ajax({url:JE.getUrlMaps("je.core.remove"),params:{ids:i,tableCode:"JE_CORE_CHARTS",doTree:!0}}),t.remove(),JE.msg("删除成功..."))})}},updateNode:function(l){var o=this,d=o.getSelectionModel().getSelection()[0],r=Ext.value(d,o.getRootNode()),e="",t="";"doUpdate"==l&&(e=d.data.bean.CHARTS_TEXT,t=d.data.bean.CHARTS_REMARK),JE.formWin({title:"目录",width:380,height:200,items:[{xtype:"textfield",fieldLabel:"名称",allowBlank:!1,value:e,name:"text"},{xtype:"textarea",fieldLabel:"说明",value:t,name:"remark"}],fn:function(e,t){var i={tableCode:"JE_CORE_CHARTS",CHARTS_TEXT:e.text,CHARTS_REMARK:e.remark,SY_NODETYPE:"GENERAL",SY_DISABLED:"1"};"doUpdate"==l?i.JE_CORE_CHARTS_ID=d.get("id"):Ext.apply(i,{SY_LAYER:r.getDepth()+1,SY_PATH:r.getPath(),SY_PARENT:r.get("id")});var n=JE.ajax({url:JE.getUrlMaps("je.core.sys.chart",l),params:i});if(n.success)if(JE.msg("操作成功！"),"doUpdate"==l)d.set("text",e.text),d.data.bean.CHARTS_REMARK=e.remark,d.data.bean.CHARTS_TEXT=e.text,d.commit();else{var a={id:n.obj.JE_CORE_CHARTS_ID,text:e.text,disabled:"1",expandable:!0,leaf:!1,bean:n.obj,children:[]};a=r.appendChild(a),o.selectPath(a.getPath())}else JE.error(n.obj,n)}})},addNode:function(e){e.itemId;var t=e.iconCls,i=e.text;JE.win({iconCls:t,title:i,items:[{xtype:"chart.chartmainview",chartsTree:this,chartsDisabled:!1,border:0}]}).show()}}),Ext.define("JE.sys.chart.view.chart.ChartsType",{extend:"Ext.tree.Panel",alias:"widget.chart.chartstype",useArrows:!0,rootVisible:!1,animate:!1,initComponent:function(){var r=this,e=JE.ChartUtil.getChartsTypes();r.store=Ext.create("Ext.data.TreeStore",{fields:["TD","MS","Stacked","Scroll","code","text","id"],root:{expanded:!0,id:"ROOT",children:e}}),r.callParent(arguments),r.on("selectionchange",function(e,t){var i=t[0];if(i&&i.isLeaf()){r.ownerCt.getCmp("chartspreview").updateCharts(i.data);var n=r.up("panel[xtype=chart.chartsedit]").getCmp("ds").getCmp("chartsdscfg"),a=n.form.findField("series"),l=n.form.findField("seriesField"),o=n.form.findField("seriesType"),d=i.get("MS")||i.get("Stacked")||i.get("Scroll");a.setDisabled(!d),l.setDisabled(!d),o.setDisabled(!d),r.ownerCt.ownerCt.getCmp("basic").form.setValues({CHARTS_TYPECODE:i.get("code"),CHARTS_TYPENAME:i.get("text")})}})}}),Ext.define("JE.sys.chart.view.chart.FontStyleField",{extend:"Ext.form.FieldContainer",alias:"widget.fontstylefield",mixins:{field:"Ext.form.field.Field"},layout:"column",dirtyCls:"",allowBlank:!0,blankText:"该项为必选项",isFormField:!0,initComponent:function(){var i=this;i.defaults={isFormField:!1,readOnly:i.readOnly,columnWidth:.2,margin:1},i.items=[{name:"fontFamily",configInfo:"JE_OFFICE_FONTFAMILY",xtype:"cbbfield",emptyText:"字体",editable:!0},{name:"color",xtype:"colorfield",emptyText:"颜色"},{name:"fontSize",xtype:"cbbfield",emptyText:"大小",minValue:0,maxValue:72,xtype:"numberfield"},{name:"fontStyle",xtype:"cbbfield",emptyText:"样式",dataArray:[{code:"normal",text:"正常"},{code:"italic",text:"斜体"},{code:"oblique",text:"倾斜"}]},{name:"fontWeight",xtype:"cbbfield",emptyText:"粗体",dataArray:[{code:100,text:"1"},{code:200,text:"2"},{code:300,text:"3"},{code:400,text:"正常"},{code:500,text:"5"},{code:600,text:"6"},{code:700,text:"7"},{code:800,text:"8"},{code:900,text:"9"}]}],i.callParent(arguments),i.on("change",function(e,t){i.validate()}),i.initField()},setValue:function(t){t=Ext.decode(Ext.value(t,"{}")),this.items.each(function(e){e.setValue(Ext.value(t[e.name],""))})},getValue:function(){var t={};return this.items.each(function(e){t[e.name]=e.getValue(),JE.isEmpty(t[e.name])&&delete t[e.name]}),Ext.encode(t)},setReadOnly:function(t){t=Ext.value(t,!1);this.readOnly=t,this.items.each(function(e){e.setReadOnly(t)})},updateLabel:function(){}}),Ext.define("JE.sys.chart.view.chart.MainView",{extend:"Ext.panel.Panel",alias:"widget.chart.chartmainview",layout:"border",border:0,initComponent:function(){this.items=[{margins:"1",region:"north",itemId:"chartspreview",height:300,collapsible:!0,hideCollapseTool:!0,titleCollapse:!0,collapseMode:"mini",split:!0,xtype:"chart.chartspreview"},{region:"center",margins:"1",itemId:"chartsCfg",xtype:"panel",layout:"border",border:0,items:[{itemId:"chartsds",xtype:"chart.chartsds",region:"west",width:130,split:!0,title:"数据源",iconCls:"jeicon jeicon-database"},{itemId:"attrsview",xtype:"chart.attrsview",region:"center"}]}],this.callParent(arguments)},afterRender:function(){this.callParent(arguments)},getChartData:function(){var i={};this.down("tabpanel[xtype=chart.attrsview]").items.each(function(e){if(e.getChartData){var t=e.getChartData();Ext.iterate(t,function(e,t){i[e]?Ext.apply(i[e],t):i[e]=t})}});var e=i.basic;return i.dsCfg=Ext.value(i.dsCfg,{}),i.dsCfg.otherCfg=Ext.value(i.otherCfg,{}),e.CHARTS_DSCONFIG=Ext.encode(i.dsCfg),e.CHARTS_ATTRCONFIG=Ext.encode({chart:Ext.value(i.chart,{}),echart:Ext.value(i.echart,{})}),e.tableCode="JE_CORE_CHARTS",e},setChartData:function(e){var t=this.down("tabpanel[xtype=chart.attrsview]"),i=this.getCmp("chartspreview"),n=this.getCmp("chartsCfg").getCmp("chartsds");i.loadCharts(e),n.loadDSData(e.CHARTS_DSIDS,!1);var a={basic:e};a.dsCfg=Ext.decode(Ext.value(e.CHARTS_DSCONFIG,"{}")),a.otherCfg=Ext.value(a.dsCfg.otherCfg,{}),Ext.applyIf(a,Ext.decode(Ext.value(e.CHARTS_ATTRCONFIG,"{}"))),t.items.each(function(e){e.setChartData&&e.setChartData(a)})}}),Ext.define("JE.sys.chart.view.datasource.ActionView",{extend:"Ext.form.Panel",alias:"widget.chart.dsactionview",initComponent:function(){this.layout="column",this.bodyPadding="5",this.defaults={columnWidth:.9,margin:"1 0",labelAlign:"right"},this.items=[{xtype:"textfield",fieldLabel:"业务Bean",name:"className",allowBlank:!1},{xtype:"textfield",fieldLabel:"业务方法",name:"methedName",allowBlank:!1},{xtype:"textarea",fieldLabel:"字段名",name:"fields"},{xtype:"box",style:"padding-left:110px;color:#B5B5B5;",html:"*  用于图表报表规划使用，以 逗号 分隔"},{xtype:"textarea",name:"params",fieldLabel:"参数名"},{xtype:"box",style:"padding-left:110px;color:#B5B5B5;",html:"*  用于图表报表规划和后台接收参数使用，以 逗号 分隔"},{xtype:"fieldcontainer",fieldLabel:"后台方法说明",html:'public String func(DsInfoVo vo){ String jsonStr = ""; return jsonStr; }'}],this.callParent(arguments)},afterRender:function(){this.callParent()},initData:function(e){e.fields=(e.fields||[]).join(","),e.params=(e.params||[]).join(","),this.form.setValues(e)}}),Ext.define("JE.sys.chart.view.datasource.CascadeView",{extend:"Ext.grid.Panel",alias:"widget.chart.dscascadeview",multiSelect:!0,columnLines:!0,initComponent:function(){function e(e){var t=e.up("panel[xtype=chart.dsmainview]").columnView.buildAllColTree();e.rootData=t}var i=this;i.columns=[{text:"字段1",dataIndex:"code1",flex:1,field:{xtype:"treessfield",ref:"allColTree",configInfo:",code1,code,S",listeners:{beforequery:Ext.clone(e)}}},{text:"操作符",dataIndex:"conn",width:60,align:"center"},{text:"字段2",dataIndex:"code2",flex:1,field:{xtype:"treessfield",ref:"allColTree",configInfo:",code2,code,S",listeners:{beforequery:Ext.clone(e)}}},{text:'<div class="jeicon jeicon-resource-table-addition" style="width:16px;height:16px;"></div>',resizable:!1,sortable:!1,menuDisabled:!0,xtype:"actioncolumn",width:30,tooltip:"添加",align:"center",items:[{iconCls:"jeicon jeicon-error",tooltip:"删除",handler:function(e,t,i){e.getStore().removeAt(t)}}],listeners:{headerclick:function(e,t){i.store.add({conn:"="})}}}],i.store=Ext.create("Ext.data.Store",{fields:["code1","code2","conn"],data:[]});function t(){i.drawLines()}i.store.on({add:t,update:t,remove:t}),i.plugins=[Ext.create("Ext.grid.plugin.CellEditing",{clicksToEdit:1,pluginId:"cellEdit"})],i.callParent(arguments)},removeTableLines:function(n){var a=[];this.store.each(function(e){var t=e.get("code1").split(".")[0],i=e.get("code2").split(".")[0];t!=n&&i!=n||a.push(e)}),this.store.remove(a)},drawLines:function(){var l=this,o=l.mainView.columnView,e=o.down("draw");o.remove(e);var d=[];l.store.each(function(e){var t=e.get("code1"),i=e.get("code2");if(JE.isNotEmpty(t)&&JE.isNotEmpty(i)){t="table."+t.split(".")[0],i="table."+i.split(".")[0];var n=o.getComponent(t),a=o.getComponent(i);n&&a&&n.itemId!=a.itemId&&(d=d.concat(l.getLinePath(n,a)))}}),o.add({xtype:"draw",viewBox:!1,items:d})},getLinePath:function(e,t){var i,n,a=this.mainView.columnView,l={},o={};i=e.getOffsetsTo(a.body),n=e.getBox(),l={x:i[0],y:i[1],width:n.width,height:n.height},i=t.getOffsetsTo(a.body),n=t.getBox(),o={x:i[0],y:i[1],width:n.width,height:n.height};var d=3,r=20;l.x<o.x?o.width=0:(d=-d,r=-r,l.width=0);var c=l.x+l.width+d,s=l.y+l.height/2+d,E=o.x+o.width-d,f=o.y+o.height/2-d,u=E-c;r=Math.abs(u/4)>Math.abs(r)?r:u/4,d=Math.abs(d);var p=["M",c,s];return p.push("L",E,f),[{type:"path",path:p.join(" "),"stroke-width":1,stroke:"black"},{type:"circle",radius:d,x:c,y:s,fill:"black"},{type:"circle",radius:d,x:E,y:f,fill:"black"}]}}),Ext.define("JE.sys.chart.view.datasource.ColumnView",{extend:"Ext.panel.Panel",autoScroll:!0,alias:"widget.chart.dscolumnview",plain:!0,layout:"fit",tables:{},initComponent:function(){this.callParent(arguments)},addColumns:function(e,i,t){var n=this,a=i.text+"("+i.code+")",l="JE_CORE_TABLECOLUMN",o="TABLECOLUMN_CODE",d="TABLECOLUMN_NAME",r="TABLECOLUMN_TYPE",c=" and TABLECOLUMN_RESOURCETABLE_ID = '"+i.id+"'",s=e+"."+i.code,E=i.iconCls,f={type:e,lines:[],code:i.code,text:i.text,id:i.id,iconCls:i.iconCls};if("func"==e&&(l="JE_CORE_RESOURCECOLUMN",o="RESOURCECOLUMN_CODE",d="RESOURCECOLUMN_NAME",r="",c=" and  RESOURCECOLUMN_FUNCINFO_ID = '"+i.id+"' and RESOURCECOLUMN_XTYPE in('uxcheckcolumn','uxcolumn')"),f.tableName=l,f.codeName=o,f.textName=d,f.typeName=r,!n.getComponent(s)){n.tables[f.code]=f;var u=n.add({title:a,iconCls:E,itemId:s,multiSelect:!0,height:200,width:150,infoData:f,floating:!0,constrain:!0,draggable:!0,simpleDrag:!0,autoShow:!0,resizable:{transparent:!0},listeners:{resize:function(){n.mainView.cascadeView.drawLines()},dragend:function(){n.mainView.cascadeView.drawLines()}},tools:[{type:"close",handler:function(){n.remove(s),n.mainView.outColumnsView.removeTableOutCol(f.code),n.mainView.cascadeView.removeTableLines(f.code),delete n.tables[f.code]}}],xtype:"jetreeview",type:"func",hideNodeIcon:!0,hideNodeElbow:!0,nodeRenderer:function(e,t,i){return e},codeSearch:!0,bodyPadding:"0 0 0 4",onlyItem:!0,url:JE.getUrlMaps("je.core.dd.tree","loadTreeData"),params:{tableCode:l,whereSql:c,orderSql:"order by SY_ORDERINDEX asc",limit:-1}});if(u.on("selectionchange",function(e,t){var i=e.view.panel,r=i.floatParent.mainView.outColumnsView,c=i.infoData,s=[],n=[],E=[];Ext.each(t,function(e){var t=e.get("bean"),i=t[c.codeName],n=c.code+"."+i,a=t[c.textName],l=c.type,o=Ext.value(t[c.typeName],""),d=c.code;E.push(n),r.store.getById(n)||s.push({id:n,code:i,name:a,remark:a,table:d,type:l,dataType:o})}),r.store.each(function(e){var t=e.get("id"),i=e.get("table");c.code==i&&-1==E.indexOf(t)&&n.push(e)}),r.store.remove(n),r.store.add(s)}),1!=t&&"table"==e){var p=JE.ajax({url:JE.getUrlMaps("je.core.load"),params:{tableCode:"JE_CORE_TABLEKEY",limit:-1,whereSql:" and TABLEKEY_TYPE = 'Foreign' and TABLEKEY_RESOURCETABLE_ID='"+i.id+"'"}}).rows;f.fks=[];var m=[];if(Ext.each(p,function(e){e={table1:i.code,code1:e.TABLEKEY_COLUMNCODE,conn:"=",table2:e.TABLEKEY_LINKTABLE,code2:e.TABLEKEY_LINECOLUMNCODE},f.fks.push(e),n.tables[e.table2]&&m.push({code1:e.table1+"."+e.code1,conn:e.conn,code2:e.table2+"."+e.code2})}),JE.isNotEmpty(i.childTableCodes)){var x=i.childTableCodes.split(",");Ext.each(x,function(t){var e=n.tables[t];e&&Ext.each(e.fks,function(e){e.table1==t&&e.table2==i.code&&m.push({code1:e.table1+"."+e.code1,conn:e.conn,code2:e.table2+"."+e.code2})})})}n.mainView.cascadeView.store.add(m)}return u}},buildAllColTree:function(){var e=this.query("jetreeview"),t={id:"ROOT",code:"ROOT",text:"ROOT",children:[]};return Ext.each(e,function(e){var a=e.infoData,l={id:JE.uuid(),code:a.code,text:a.code,disabled:"1",expandable:!0,iconCls:e.iconCls,children:[]};e.getRootNode().eachChild(function(e){var t=e.raw.bean,i=t[a.codeName],n=t[a.typeName];l.children.push({id:JE.uuid(),code:a.code+"."+i,text:i,leaf:!0,nodeInfo:n})}),t.children.push(l)}),t}}),Ext.define("JE.sys.chart.view.datasource.DataSourceView",{extend:"Ext.tree.Panel",alias:"widget.chart.datasourceview",border:1,useArrows:!0,rootVisible:!1,animate:!1,codeSearch:!0,showTitle:!1,mixins:["JE.core.util.ViewUtil","JE.core.util.func.Tree"],initComponent:function(){var d=this;d.typeIconCls={table:"jeicon jeicon-graphic-mode",js:"jeicon jeicon-function",sql:"jeicon jeicon-sql",idit:""};var e=d.getTreeTbar(d);d.funcData={info:{tableName:"JE_CORE_DATASOURCE",pkName:"JE_CORE_DATASOURCE_ID"}},d.dockedItems=[e],d.store=JE.getStore({tableName:"JE_CORE_DATASOURCE",url:JE.getUrlMaps("je.core.sys.chart","getTree"),type:"tree",params:{whereSql:" and DATASOURCE_FOR='chart'"}}),d.store.on("load",function(){d.getRootNode().expandChildren()}),d.bulidMenu(),d.setTreeDDPlugin(d),d.callParent(arguments),d.on({containercontextmenu:function(e,t,i){t.stopEvent(),d.getSelectionModel().deselectAll(),d.contextMenu.getCmp("folder").setDisabled(!1),d.contextMenu.getCmp("datasource").setDisabled(!1),d.contextMenu.getCmp("attr").setDisabled(!0),d.contextMenu.getCmp("remove").setDisabled(!0),d.contextMenu.showAt(t.getXY())},itemcontextmenu:function(e,t,i,n,a,l){a.stopEvent();t.raw;var o=!t.isLeaf();d.contextMenu.getCmp("folder").setDisabled(!o),d.contextMenu.getCmp("datasource").setDisabled(!o),d.contextMenu.getCmp("remove").setDisabled(!1),d.contextMenu.getCmp("attr").setDisabled(!1),d.contextMenu.showAt(a.getXY())},itemdblclick:function(e,t){var i=t.data.nodeInfoType;if(t.isLeaf()){var n=JE.ajax({url:JE.getUrlMaps("je.core.getInfoById"),params:{tableCode:"JE_CORE_DATASOURCE",pkValue:t.get("id")}});JE.win({title:"编辑",border:0,autoShow:!0,items:[{xtype:"chart.dsmainview",viewType:i,callback:function(e){d.updateNode(e)}}],showFn:function(e){e.getCmp(0).initData(n)}})}}})},bulidMenu:function(){var e=this;e.contextMenu=Ext.create("Ext.menu.Menu",{width:100,margin:"0 0 10 0",items:[{text:"新建数据源",itemId:"datasource",iconCls:"jeicon jeicon-database-two",handler:function(){e.editDS("save","datasource")}},"-",{text:"新建目录",itemId:"folder",iconCls:"jeicon jeicon-folder-add",handler:function(){e.editDS("save","folder")}},{text:"删除",iconCls:"jeicon jeicon-data-deletion",itemId:"remove",handler:function(){e.removeNode()}},"-",{iconCls:"jeicon jeicon-document-attribute",text:"属性",itemId:"attr",handler:function(){e.editDS("update")}}]})},removeNode:function(){var t=this.getSelectionModel().getSelection()[0];if(!Ext.isEmpty(t)){var e=t.get("text"),i=t.get("id");JE.confirm("确定删除："+e+" ?",function(e){"ok"==e&&(JE.ajax({url:JE.getUrlMaps("je.core.remove"),params:{ids:i,tableCode:"JE_CORE_DATASOURCE",doTree:!0}}),t.remove(),JE.msg("删除成功..."))})}},updateNode:function(e){var t=this.getSelectionModel().getSelection()[0],i={tableCode:"JE_CORE_DATASOURCE",JE_CORE_DATASOURCE_ID:t.get("id"),DATASOURCE_DATA:e.data,DATASOURCE_CONFIG:e.config},n=JE.ajax({url:JE.getUrlMaps("je.core.update"),params:i});n.success?(t.data.nodeInfo=e.data,t.data.bean.DATASOURCE_CONFIG=e.config,t.commit(),JE.msg("保存成功！")):JE.error(n.obj,n)},editDS:function(o,i){var d=this,r=d.getSelectionModel().getSelection()[0];r=Ext.value(r,d.getRootNode());var e={},t="",n=550,a="";"save"==o?(a="数据源",e={SY_LAYER:r.getDepth()+1,SY_PATH:r.getPath(),SY_PARENT:r.get("id"),DATASOURCE_FOR:"chart"},"folder"==i&&(e.DATASOURCE_TYPE="folder",e.SY_NODETYPE="GENERAL",n=330,a="目录")):"update"==o&&(t=r.get("id"),n=330,a="属性"),JE.showFunc("JE_CORE_DATASOURCE",{title:a,type:"form",useForm:!0,values:e,id:t,winConfig:{width:700,height:n,buttonAlign:"center",useButton:!0,fn:function(e){return e.getCmp(0).getButton("formSaveBtn").fireHandler(),!1}},callback:function(e){var l=e.ownerCt;e.getFields("DATASOURCE_CODE").setReadOnly("update"==o);var t=e.getFields("DATASOURCE_TYPE");t.setVisible("save"==o&&"folder"!=i),"save"==o&&"folder"!=i&&t.items.each(function(e){e.setVisible("folder"!=e.inputValue)}),e.getDockedCmp("buttonBar").hide(),e.on("endsubmit",function(e,t,i,n){if("save"==o){var a=r.appendChild({id:n.JE_CORE_DATASOURCE_ID,text:n.DATASOURCE_TEXT,code:n.DATASOURCE_CODE,expandable:!0,leaf:"folder"!=n.DATASOURCE_TYPE,iconCls:n.DATASOURCE_ICONCLS,nodeInfoType:n.DATASOURCE_TYPE,children:[],bean:n});d.selectPath(a.getPath()),d.fireEvent("itemdblclick",d.view,a)}else"update"==o&&(r.set({text:n.DATASOURCE_TEXT,code:n.DATASOURCE_CODE,description:n.DATASOURCE_REMARK}),r.commit());setTimeout(function(){l.close()},100)})}})},editAttr:function(){var a=this.getSelectionModel().getSelection()[0],e=a.data.text,t=a.data.code,i=a.data.description,l=a.data.id;JE.formWin({title:"属性",width:400,height:200,defaults:{labelWidth:60},items:[{xtype:"textfield",fieldLabel:"名称",value:e,allowBlank:!1,name:"text"},{xtype:"textfield",fieldLabel:"编码",readOnly:!Ext.isEmpty(t),value:t,name:"code"},{xtype:"textarea",fieldLabel:"备注",value:i,name:"remark"}],fn:function(e,t){var i={tableCode:"JE_CORE_DATASOURCE",DATASOURCE_TEXT:e.text,DATASOURCE_CODE:e.code,DATASOURCE_REMARK:e.remark,JE_CORE_DATASOURCE_ID:l},n=JE.ajax({url:JE.getUrlMaps("je.core.update"),params:i});n.success?(JE.msg("修改成功！"),a.set("text",e.text),a.set("code",e.code),a.set("description",e.remark),a.commit()):JE.error(n.obj,n)}})}}),Ext.define("JE.sys.chart.view.datasource.FuncView",{extend:"Ext.tree.Panel",autoScroll:!0,alias:"widget.chart.dsfuncview",useArrows:!0,rootVisible:!1,animate:!1,codeSearch:!0,showTitle:!1,mixins:["JE.core.util.ViewUtil"],initComponent:function(){var e=this.getTreeTbar(this);this.dockedItems=[e],this.store=JE.getStore({tableName:"JE_CORE_FUNCINFO",type:"tree",url:JE.getUrlMaps("je.core.resourceTable","getTree"),params:{whereSql:" AND SY_JESYS='1' "}}),this.selModel={selType:"treemodel",allowDeselect:!0},this.callParent(arguments),this.on("itemdblclick",function(e,t){var i=t.data;-1!=["FUNC","FUNCFIELD"].indexOf(i.nodeInfoType)&&e.panel.ownerCt.ownerCt.columnView.addColumns("func",i)})}}),Ext.define("JE.sys.chart.view.datasource.IDITDataView",{extend:"Ext.panel.Panel",alias:"widget.chart.dsiditdataview",layout:"fit",initComponent:function(){var a=this;a.tbar=[{text:"字段定义",handler:function(){JE.win({title:"字段定义",border:0,width:400,height:300,items:{xtype:"jsonarrayfield",value:Ext.value(a.fields,""),columns:[{dataIndex:"name",text:"字段编码",flex:1,field:{xtype:"textfield"}},{dataIndex:"type",text:"类型",flex:1,field:{xtype:"cbbfield",dataArray:[{code:"string",text:"字符串"},{code:"int",text:"整型"},{code:"float",text:"浮点型"}]}}]},useButton:!0,fn:function(e){var t,i=a.getComponent(0),n=[];i&&(i.store.each(function(e){n.push(e.data)}),a.remove(i)),a.fields=e.items.get(0).getValue(),t=Ext.decode(a.fields),a.add(a.buildGrid(t,n))}}).show()}},"-",{xtype:"form",layout:"column",bodyStyle:"background:none;",defaults:{labelAlign:"right",labelWidth:80},border:0,items:[{fieldLabel:"自定义集合",xtype:"cbbfield",name:"type",value:"number",allowBlank:!1,width:150,hideTrigger1:!0,dataArray:[{code:"number",text:"数字"},{code:"y",text:"年"},{code:"mo",text:"月"},{code:"d",text:"日"},{code:"h",text:"小时"}]},{fieldLabel:"开始",labelWidth:40,allowBlank:!1,name:"start",xtype:"textfield"},{fieldLabel:"结束",labelWidth:40,allowBlank:!1,name:"end",xtype:"textfield"},{fieldLabel:"时间格式化",emptyText:"Y-m-d h:i:s",xtype:"textfield",name:"format"},{xtype:"button",cls:"btn",text:"生成集合",handler:function(){a.buildIDITList()}}]}],a.callParent(arguments)},initData:function(e,t){this.fields=Ext.value(e,"[]"),e=Ext.decode(this.fields),t=Ext.decode(Ext.value(t,"[]"));var i=this.buildGrid(e,t);i&&this.add(i)},buildGrid:function(e,t){if(!Ext.isEmpty(e)){t=Ext.value(t,[]);var i=[{xtype:"actioncolumn",text:'<div class="jeicon jeicon-resource-table-addition" style="width:16px;height:16px;"></div>',resizable:!1,sortable:!1,menuDisabled:!0,width:30,align:"center",items:[{iconCls:"jeicon jeicon-error",handler:function(e,t,i){e.store.removeAt(t)}}],listeners:{headerclick:function(e,t){e.grid.store.add({})}}},{xtype:"rownumberer",text:"序号",width:50,align:"center"}];return Ext.each(e,function(e){i.push({text:e.name,dataIndex:e.name,field:{xtype:"textfield"}})}),{xtype:"grid",border:0,columnLines:!0,columns:i,store:Ext.create("Ext.data.Store",{fields:e,data:t}),plugins:[Ext.create("Ext.grid.plugin.CellEditing",{clicksToEdit:1,pluginId:"cellEdit"})],viewConfig:{plugins:{ptype:"gridviewdragdrop",dragText:"拖动排序",pluginId:"ddOrder"}}}}},buildIDITList:function(){var e=this.down("form");if(e.isValid()){var t=e.form.getValues(),i=t.start,n=t.end,a=t.format,l=[];if("number"==t.type)for(var o=Number(i);o<=Number(n);o++)l.push({name:o});else{if(Ext.isEmpty(t.format))return void JE.alert("请填写格式化字符串！");for(var d=!0,r=Ext.Date.parse(i,a);d;)i=Ext.Date.format(r,a),l.push({name:i}),i==n?d=!1:r=Ext.Date.add(r,t.type,1)}this.remove(this.getComponent(0)),this.add(this.buildGrid([{name:"name",type:"string"}],l))}}}),Ext.define("JE.sys.chart.view.datasource.MainView",{extend:"Ext.panel.Panel",alias:"widget.chart.dsmainview",layout:"border",initComponent:function(){var i=this;i.buttons=[],i.bodyStyle="border-width:0px;",i.tbar=[{xtype:"textfield",name:"testParams",fieldLabel:"参数",labelWidth:40,labelAlign:"right",emptyText:"json格式化字符串,如   param1:查询值1,param2:查询值2",width:500},{text:"调试",iconCls:"jeicon jeicon-startup-process",name:"testBtn"}],"table"==i.viewType?(i.items=[{region:"west",width:200,padding:"0 2 0 0",xtype:"chart.dstableview"},{layout:"border",region:"center",border:0,items:[{xtype:"chart.dscolumnview",region:"center"},{xtype:"tabpanel",region:"south",height:200,split:!0,items:[{xtype:"chart.dsoutcolumnsview",iconCls:"jeicon jeicon-form-column",title:"输出列"},{xtype:"chart.dscascadeview",iconCls:"jeicon jeicon-associated",title:"级联"},{xtype:"chart.dsotherview",iconCls:"jeicon jeicon-filter-o",title:"配置项"}]}]}],i.tbar.push({text:"查看sql",iconCls:"jeicon jeicon-sql",name:"seeSql",ref:"seeSql"},{text:"执行...",name:"query",iconCls:"jeicon jeicon-lightning-on",ref:"seeSql"})):"sql"==i.viewType?(i.items=[{region:"west",width:200,xtype:"chart.dstableview"},{region:"center",xtype:"chart.dssqlview",saveFn:function(e){var t=i.down("button[name=save]");Ext.defer(function(){t.fireEvent("click",t)},100)}}],i.tbar.push({text:"执行...",name:"query",iconCls:"jeicon jeicon-lightning-on",ref:"seeSql"})):"action"==i.viewType?(i.items=[{region:"center",xtype:"chart.dsactionview"}],delete i.tbar):"procedure"==i.viewType?(i.items=[{region:"center",xtype:"chart.dsprocview"}],delete i.tbar):"js"==i.viewType&&(i.items=[{region:"center",xtype:"jecodeeditor",itemId:"editorview",saveFn:function(e){var t=i.down("button[name=save]");Ext.defer(function(){t.fireEvent("click",t)},100)},border:0}]),i.buttonAlign="center",i.buttons.push({text:"保存",cls:"JEPLUS_B_L10",name:"save",handler:function(e){i.doSave(e)}},{text:"关闭 ",name:"close",handler:function(e){e.up("window").close()}}),Ext.each(i.tbar,function(e){"seeSql"==e.ref?e.handler=function(e){i.seeSql(e)}:"testBtn"==e.name&&(e.handler=function(e){i.debug(e)})}),i.callParent(arguments)},afterRender:function(){var e=this;e.callParent(arguments),"table"==e.viewType?(e.columnView=e.down("[xtype=chart.dscolumnview]"),(e.columnView.mainView=e).outColumnsView=e.down("[xtype=chart.dsoutcolumnsview]"),(e.outColumnsView.mainView=e).cascadeView=e.down("[xtype=chart.dscascadeview]"),(e.cascadeView.mainView=e).otherView=e.down("[xtype=chart.dsotherview]"),e.otherView.mainView=e):"sql"==e.viewType?(e.sqlView=e.down("[xtype=chart.dssqlview]"),e.sqlView.mainView=e):"action"==e.viewType?(e.actionView=e.down("[xtype=chart.dsactionview]"),(e.actionView.mainView=e).ownerCt.setSize(600,450)):"procedure"==e.viewType?(e.procView=e.down("[xtype=chart.dsprocview]"),(e.procView.mainView=e).ownerCt.setSize(600,450)):"js"==e.viewType&&(e.editorView=e.getCmp("editorview"),e.editorView.mainView=e)},initData:function(e){var t=this,i=e.DATASOURCE_DATA,n=e.DATASOURCE_CONFIG;if("table"==t.viewType){var l=Ext.decode(Ext.value(n,"{columns:[],tables:[],whereSqls:[],cascades:[]}")),o=t,a=o.outColumnsView,d=o.cascadeView,r=o.otherView;Ext.each(l.tables,function(e){var t=e.infoData,i=e.xy,n=o.columnView.addColumns(t.type,t,!0);if(n){n.setPosition(i),JE.isNotEmpty(e.size)&&n.setSize(e.size);var a=[];n.getRootNode().eachChild(function(t){Ext.each(l.columns,function(e){t.get("bean")[n.infoData.codeName]==e.code&&a.push(t)})}),n.getSelectionModel().select(a,!1,!0)}}),Ext.defer(function(){a.store.add(l.columns),r.setOtherCfg(l),d.store.add(l.cascades)},100)}else if("sql"==t.viewType){var c=i;t.sqlView.setValue(c)}else if("action"==t.viewType)t.actionView.initData(Ext.decode(Ext.value(n,"{}")));else if("procedure"==t.viewType)t.procView.initData(Ext.decode(Ext.value(n,"{}")));else if("js"==t.viewType){t.editorView.setValue(Ext.value(i,'/*必须按照如下格式返回数据，否则数据出错,params(过滤条件)可以省略*/\nfunction(params){\n return {fields:["字段名1","字段名2"],data:[{字段名1:"A",字段名2:"1"},{字段名1:"B",字段名2:"2"}],params:["字段名"|{name:"字段名",fieldLabel:"字段描述",xtype:"textfield"}]};\n}'))}},buildSql:function(e){var t=this.outColumnsView,i=this.cascadeView,n=this.otherView,a={};if("sql"==this.viewType)a={sql:this.sqlView.getValue()};else{var l=[],o=[],d=[],r=[],c=this.columnView.query("jetreeview");if(Ext.each(c,function(e){d.push(e.infoData.code)}),0==d.length)return"";t.store.each(function(e){var t=Ext.clone(e.data);t.hidde||(Ext.isEmpty(t.table)&&(t.id=t.code),t.group&&l.push(t.id),t.name=Ext.value(t.name,t.code),Ext.isEmpty(t.formula)?(r.push(t.id+" AS "+t.name),JE.isNotEmpty(t.order)&&o.push(t.code+" "+t.order)):(r.push(t.formula+"("+t.id+") AS "+t.name),JE.isNotEmpty(t.order)&&o.push(t.formula+"("+t.id+") "+t.order)))});var s=[];i.store.each(function(e){var t=e.data;s.push("AND "+t.code1+" "+t.conn+" "+t.code2)});var E=n.getOtherCfg();if(JE.isNotEmpty(y)&&s.push(y),0<E.topTimeNum){var f=new Date,u=E.topTimeNum,p=E.timeType,m=E.timeField,x=E.timeFieldType,g=" AND ("+m+">='"+JE.DATE.getDate(f,"-"+u+p,x)+"' AND "+m+"<='"+JE.DATE.getDate("0","0"+p,x)+"')";s.push(g)}var C=["SELECT","\t"+r.join(",\n\t"),"FROM","\t"+d.join(","),"WHERE 1=1","\t"+s.join(" ")].join(" \n"),h="";0<l.length&&(h="GROUP BY "+l.join(","));var b="";0<o.length&&(b="ORDER BY "+o.join(","));var y=E.whereSql;JE.isNotEmpty(E.whereSqlFn)&&(y=JE.eval(E.whereSqlFn)(e||{})||""),a={sql:C,orderSql:b,groupSql:h,whereSql:y}}var O=[];return Ext.each(["sql","whereSql","groupSql","orderSql"],function(e){a[e]&&O.push(a[e])}),a.formatSql=O.join(" \n"),e&&(a.formatSql=JE.toXT(a.formatSql,e)),a},seeSql:function(e){if("seeSql"==e.name){var t=this.buildSql().formatSql;JE.win({title:"sql语句",html:'<textarea readonly = "readonly" style="width:100%;height:100%;">'+t+"</textarea>"}).show()}else{var i=Ext.decode("{"+this.down("textfield[name=testParams]").getValue()+"}");t=(t=this.buildSql(i).formatSql).replaceAll("\n","").replaceAll("\t","");var n=JE.ajax({url:JE.getUrlMaps("je.core.dbsql","getSelectModel"),params:{sql:t}});if(0==n.success)JE.error(n.obj,n);else{var a={};this.otherView&&(a=this.otherView.getOtherCfg()),JE.win({title:"查询结果",items:{xtype:"chart.dssqlgridview",border:0,otherCfg:a,fields:n,sql:t}}).show()}}},debug:function(e){var t=Ext.decode("{"+e.previousSibling().getValue()+"}");if("js"==this.viewType){var i=this.getCmp("editorview").getValue();(i=JE.eval(i))&&i(t)}else{var n=this.buildSql(t).formatSql;JE.win({title:"格式化后的sql语句",html:'<textarea readonly = "readonly" style="width:100%;height:100%;">'+n+"</textarea>"}).show()}},doSave:function(e){var i=this,t="",n="";if("table"==i.viewType){var a=i.outColumnsView,l=i.cascadeView,o=i.otherView,d={columns:[],whereSql:"",cascades:[],sql:"",tables:[],fields:[]};a.store.each(function(e){d.columns.push(e.data),d.fields.push({name:e.data.name})}),l.store.each(function(e){d.cascades.push(e.data)});var r=o.getOtherCfg();Ext.apply(d,r);var c=i.columnView.query("jetreeview");Ext.each(c,function(e){var t=e.getOffsetsTo(i.columnView.body);d.tables.push({xy:t,infoData:e.infoData,size:e.getSize()})});var s=i.buildSql();t=s.sql,d.orderSql=s.orderSql,d.groupSql=s.groupSql,d=Ext.apply(d,i.parseParams(t)),n=Ext.encode(d)}else if("sql"==i.viewType){t=i.sqlView.getValue();d=i.parseParams(t);var E={};Ext.each(d.params,function(e){E[e]=""});var f=JE.toXT(t,E);if(JE.isEmpty(f))return void JE.alert("请输入SQL语句！");if(0==(p=JE.ajax({url:JE.getUrlMaps("je.core.dbsql","getSelectModel"),params:{sql:f}})).success)return void JE.error(fileds.obj,p);d.fields=p,n=Ext.encode(d)}else if("action"==i.viewType){if(!i.actionView.form.isValid())return;var u=i.actionView.form.getValues(),p=(E=JE.isEmpty(u.params)?[]:u.params.split(","),JE.isEmpty(u.fields)?[]:u.fields.split(","));n=Ext.encode(Ext.applyIf({fields:p,params:E},u))}else if("procedure"==i.viewType){if(!i.procView.form.isValid())return;n=i.procView.getConfig()}else if("js"==i.viewType){t=i.editorView.getValue();var m=JE.eval(t);if(Ext.isEmpty(m))return;var x=m({});if(Ext.isEmpty(x)||!x.fields||!x.data)return void JE.alert("数据返回格式错误!应该返回:{fields:[],data:[]}");E=[];Ext.each(x.params,function(e){var t=e;Ext.isString(e)&&(t={fieldLabel:e,name:e,xtype:"textfield"}),E.push(t)}),x.params=E,n=Ext.encode(x)}i.callback&&i.callback({data:t,config:n})},parseParams:function(e){var t=(e||"").match(/\{.*?\}/g),i=[],n=[];return Ext.each(t,function(e){e=e.replace("{","").replace("}","");var t=Ext.isEmpty(e.match(/\@.*?\@/g))?i:n;-1==t.indexOf(e)&&t.push(e)}),{params:i,defvals:n}}}),Ext.define("JE.sys.chart.view.datasource.OtherView",{alias:"widget.chart.dsotherview",extend:"Ext.form.Panel",layout:"column",bodyPadding:"5",autoScroll:!0,initComponent:function(){this.defaults={labelAlign:"right",labelWidth:60},this.items=[{fieldLabel:"过滤条件",xtype:"textarea",columnWidth:1,emptyText:"以 AND开头，如：and 1=1 ...;sql中可以用系统变量，如当前用户{@USER_CODE@}；也可以用动态参数，如：{param}",name:"whereSql"},{xtype:"fieldcontainer",fieldLabel:"过滤条件",layout:"column",columnWidth:1,hideLabelText:!0,items:[{xtype:"button",cls:"btn",itemId:"editEvent",iconCls:"jeicon jeicon-lightning-off",text:"编辑动态SQL，覆盖过滤条件",handler:function(e){var t=e.next(),i='function(params){\n\t return "";\n}',n=Ext.value(t.getValue(),i);JE.win({title:"动态SQL(Ctrl+S保存)",width:800,height:600,border:0,autoShow:!0,items:{xtype:"jecodeeditor",itemId:"editorview",useHelp:!1,value:n,saveFn:function(e){t.setValue(i==e?"":e),JE.msg("保存成功...")},border:0}})}},{xtype:"hidden",name:"whereSqlFn",listeners:{change:function(e,t){e.ownerCt.getCmp("editEvent").setIconCls(Ext.isEmpty(t)?"jeicon jeicon-lightning-off":"jeicon jeicon-lightning-on")}}}]},{fieldLabel:"取前",unitTpl:"条数据",xtype:"numberfield",margin:"3 0 0 0",minValue:0,columnWidth:.3,name:"topNum"},{xtype:"fieldcontainer",columnWidth:1,layout:"hbox",defaults:{labelAlign:"right",labelWidth:60,margin:"3 3 0 0"},items:[{fieldLabel:"取前",xtype:"numberfield",minValue:0,name:"topTimeNum"},{xtype:"cbbfield",value:"d",width:60,name:"timeType",dataArray:[{text:"天",code:"d"},{text:"周",code:"w"},{text:"月",code:"m"},{text:"年",code:"y"},{text:"小时",code:"h"}]},{xtype:"textfield",value:"SYS_CREATETIME",fieldLabel:"基准字段",name:"timeField"},{xtype:"cbbfield",fieldLabel:"字段类型",name:"timeFieldType",value:"date",dataArray:[{text:"日期",code:"date"},{text:"日期时间",code:"datetime"},{text:"日期月份",code:"datemonth"}]}]}],this.callParent(arguments)},getOtherCfg:function(){return this.form.getValues()},setOtherCfg:function(e){this.form.setValues(e)}}),Ext.define("JE.sys.chart.view.datasource.OutColumnsView",{extend:"Ext.grid.Panel",alias:"widget.chart.dsoutcolumnsview",multiSelect:!0,columnLines:!0,initComponent:function(){var o=this;o.columns=[{resizable:!1,sortable:!1,menuDisabled:!0,xtype:"actioncolumn",width:30,tooltip:"添加",align:"center",items:[{iconCls:"jeicon jeicon-error",handler:function(e,t,i){var n=e.getStore().getAt(t),a=o.mainView.columnView.getComponent(n.get("type")+"."+n.get("table")),l=a.getRootNode().findChild("code",n.get("code"));a.getSelectionModel().deselect(l)}}]},{text:"表",dataIndex:"table",width:200},{text:"字段编码",dataIndex:"code",width:200,field:{xtype:"textfield"}},{text:"名称",dataIndex:"name",width:120,field:{xtype:"textfield"}},{text:"公式",dataIndex:"formula",width:80,field:{xtype:"cbbfield",dataArray:[{code:"Sum",text:"Sum"},{code:"Avg",text:"Avg"},{code:"Min",text:"Min"},{code:"Max",text:"Max"},{code:"Count",text:"Count"}]}},{text:"分组",dataIndex:"group",xtype:"checkcolumn",width:40},{text:"升降序",dataIndex:"order",width:70,field:{xtype:"cbbfield",dataArray:[{code:"ASC",text:"ASC"},{code:"DESC",text:"DESC"}]}},{text:"隐藏",dataIndex:"hidden",xtype:"checkcolumn",width:40},{text:"类型",dataIndex:"dataType",width:100},{text:"备注",dataIndex:"remark",flex:1,field:{xtype:"textfield"}}],o.store=Ext.create("Ext.data.Store",{fields:["id","code","name","remark","type","formula","table","dataType","order","hidden","group"],data:[]}),o.plugins=[Ext.create("Ext.grid.plugin.CellEditing",{clicksToEdit:1,pluginId:"cellEdit"})],o.viewConfig={plugins:{ptype:"gridviewdragdrop",dragText:"拖动排序",pluginId:"ddOrder"}},o.callParent(arguments),o.on("beforeedit",function(e,t){if("code"==t.field)return Ext.isEmpty(t.record.get("table"))})},removeTableOutCol:function(t){var i=[];this.store.each(function(e){e.get("table")==t&&i.push(e)}),this.store.remove(i)}}),Ext.define("JE.sys.chart.view.datasource.ParamsView",{extend:"Ext.grid.Panel",alias:"widget.chart.dsparamsview",multiSelect:!0,columnLines:!0,initComponent:function(){var i=this;i.columns={defaults:{align:"center"},items:[{text:"参数",dataIndex:"name",width:100,field:{xtype:"textfield"}},{text:"说明",dataIndex:"fieldLabel",width:120,field:{xtype:"textfield"}},{text:"类型",dataIndex:"xtype",width:120,field:{xtype:"cbbfield",configInfo:"JE_FUNC_XTYPE"}},{text:"必填",dataIndex:"notAllowBlank",width:60,xtype:"checkcolumn"},{text:"配置",dataIndex:"configInfo",flex:1,field:{xtype:"textfield"}},{text:'<div class="jeicon jeicon-resource-table-addition" style="width:16px;height:16px;"></div>',resizable:!1,sortable:!1,menuDisabled:!0,xtype:"actioncolumn",width:30,tooltip:"添加",align:"center",items:[{iconCls:"jeicon jeicon-error",tooltip:"删除",handler:function(e,t,i){e.getStore().removeAt(t)}}],listeners:{headerclick:function(e,t){i.store.add({})}}}]},i.store=Ext.create("Ext.data.Store",{fields:["name","xtype","notAllowBlank","configInfo","fieldLabel"],data:[]}),i.plugins=[Ext.create("Ext.grid.plugin.CellEditing",{clicksToEdit:1,pluginId:"cellEdit"})],i.viewConfig={plugins:{ptype:"gridviewdragdrop",dragText:"拖动排序",pluginId:"ddOrder"}},i.callParent(arguments)}}),Ext.define("JE.sys.chart.view.datasource.ProcView",{extend:"Ext.form.Panel",alias:"widget.chart.dsprocview",autoScroll:!0,initComponent:function(){this.layout="column",this.bodyPadding="5",this.defaults={columnWidth:.9,margin:"1 0",labelAlign:"right"},this.items=[{xtype:"cbbfield",fieldLabel:"数据源",configInfo:"JE_CORE_DSDATA,FUNCINFO_DBNAME~code,S",name:"dbName",listeners:{afterrender:function(e){e.getStore().insert(0,[{text:"本地",code:"local",id:"local"}])}}},{xtype:"textfield",allowBlank:!1,fieldLabel:"存储过程",name:"procedureName"},{xtype:"textarea",fieldLabel:"字段名",name:"fields"},{xtype:"box",style:"padding-left:110px;color:#B5B5B5;",html:"*  用于图表报表规划使用，以 逗号 分隔"},{xtype:"jsonarrayfield",fieldLabel:"查询参数",name:"dbQueryParams",height:200,defaultRecordValue:{name:"",fieldType:"VARCHAR",paramType:"0"},columns:[{text:"参数名",flex:1,dataIndex:"name"},{text:"参数类型",flex:1,dataIndex:"fieldType",field:{xtype:"cbbfield",configInfo:"JE_CORE_DBFIELDTYPE"},renderer:function(e){return JE.toDicText("JE_CORE_DBFIELDTYPE",e)}},{text:"输出参数",flex:1,xtype:"uxcheckcolumn",dataIndex:"paramType"},{text:"缺省值",flex:1,dataIndex:"defaultValue"}]},{xtype:"box",style:"padding-left:110px;color:#B5B5B5;",html:"*  用于图表报表规划和后台接收参数使用，以 逗号 分隔"}],this.callParent(arguments)},afterRender:function(){this.callParent()},initData:function(e){e.fields=(e.fields||[]).join(","),e.params=(e.params||[]).join(","),this.form.setValues(e)},getConfig:function(){var e=this.form.getValues(),t=JE.isEmpty(e.fields)?[]:e.fields.split(","),i=[];return Ext.each(Ext.decode(e.dbQueryParams),function(e){1!=e.paramType&&-1==["ORDER","TOTALCOUNT","LIMIT","NOWPAGE","CODE","MSG","CURSOR"].indexOf(e.fieldType)&&i.push(e.name)}),config=Ext.encode(Ext.applyIf({fields:t,params:i},e)),config}}),Ext.define("JE.sys.chart.view.datasource.SqlGridView",{extend:"Ext.grid.Panel",alias:"widget.chart.dssqlgridview",columnLines:!0,sql:"",fields:void 0,mixins:["JE.core.util.ViewUtil"],initComponent:function(){var e=this.sql,t=[{xtype:"rownumberer",text:"No.",width:50,align:"center"}],i=this.fields;Ext.each(i,function(e){t.push({dataIndex:e.name,text:e.name})});var n=Ext.value(this.otherCfg,{});this.columns={defaults:{flex:1},items:t},this.store=Ext.create("Ext.data.Store",{fields:i,pageSize:0<n.topNum?n.topNum:300,proxy:{type:"ajax",url:JE.getUrlMaps("je.core.dbsql.select"),extraParams:{sql:e},reader:{type:"json",root:"rows",totalProperty:"totalCount"}},autoLoad:!0}),this.bbar={xtype:"uxpagingtoolbar",store:this.store,pageNum:!0},0<n.topNum&&delete this.bbar,this.callParent(arguments)}}),Ext.define("JE.sys.chart.view.datasource.SqlView",{extend:"JE.core.view.CodeEditor",alias:"widget.chart.dssqlview",useHelp:!1,editorMode:"text/x-sql",initComponent:function(){this.callParent(arguments)},afterRender:function(){this.callParent()},addSql:function(e){var t=e.code,i=[],n=JE.ajax({url:JE.getUrlMaps("je.core.load"),params:{tableCode:"JE_CORE_TABLECOLUMN",whereSql:" and TABLECOLUMN_RESOURCETABLE_ID = '"+e.id+"'",orderSql:"order by SY_ORDERINDEX asc",limit:-1}}).rows;Ext.each(n,function(e){i.push(t+"."+e.TABLECOLUMN_CODE+" AS "+e.TABLECOLUMN_NAME)});var a="SELECT \n\t"+i.join(",\n\t")+" \nFROM "+t,l=this.editor,o=l.getPosition();l.executeEdits("",[{range:{startLineNumber:o.lineNumber,startColumn:o.column,endLineNumber:o.lineNumber,endColumn:o.column},text:a}])}}),Ext.define("JE.sys.chart.view.datasource.TableView",{extend:"Ext.tree.Panel",autoScroll:!0,alias:"widget.chart.dstableview",useArrows:!0,rootVisible:!1,animate:!1,codeSearch:!0,showTitle:!1,mixins:["JE.core.util.ViewUtil"],initComponent:function(){var e=this.getTreeTbar(this);this.dockedItems=[e],this.store=JE.getStore({tableName:"JE_CORE_RESOURCETABLE",type:"tree",url:JE.getUrlMaps("je.core.resourceTable","getTree"),params:{whereSql:" AND SY_JESYS='1' "}}),this.selModel={selType:"treemodel",allowDeselect:!0},this.callParent(arguments),this.on("itemdblclick",function(e,t){var i=t.data;if("MODULE"!=i.nodeInfo){i.childTableCodes=t.raw.bean.RESOURCETABLE_CHILDTABLECODES;var n=e.panel.ownerCt;if("sql"==n.viewType)n.sqlView.addSql(i);else n.columnView.addColumns("table",i)}})}}),Ext.define("JE.sys.chart.view.datasource.WestView",{extend:"Ext.tab.Panel",alias:"widget.chart.dswestview",tabPosition:"bottom",border:0,initComponent:function(){this.items=[{xtype:"chart.dstableview",title:"资源表"},{xtype:"chart.dsfuncview",title:"功能"}],this.callParent(arguments)}}),Ext.define("JE.sys.chart.view.datasource.WhereSqlView",{alias:"widget.chart.dswheresqlview",extend:"Ext.panel.Panel",initComponent:function(){this.layout="fit",this.items={xtype:"textarea",emptyText:"以 AND开头，如：and 1=1 ...;sql中可以用系统变量，如当前用户{@USER_CODE@}；也可以用动态参数，如：{param}",itemId:"whereSql",inputAttrTpl:' style="border-width:0px;"'},this.callParent(arguments)},getWhereSql:function(){return this.getCmp("whereSql").getValue()},setWhereSql:function(e){this.getCmp("whereSql").setValue(Ext.value(e,""))}}),Ext.define("JE.sys.chart.view.report.FieldForm",{extend:"Ext.form.Panel",alias:"widget.report.fieldform",autoScroll:!0,border:0,initComponent:function(){this.layout="column",this.bodyPadding="10 10 0 0",this.defaults={columnWidth:.5,labelAlign:"right",margin:"0 0 2 0",labelWidth:75},this.items=[{xtype:"cbbfield",configInfo:"JE_FUNC_XTYPE",fieldLabel:"类型",allowBlank:!1,defaultListConfig:{loadingHeight:10},dicItemCodes:"textfield,numberfield,rgroup,cgroup,cbbfield,textarea,datefield,datetimefield,datemonthfield,rangedatefield,treessfield,treessareafield,gridssfield,gridssareafield,searchfield,colorfield,pinyinfield,queryuserfield,queryuserareafield",name:"xtype"},{xtype:"cbbfield",fieldLabel:"默认值",name:"value",editable:!0,configInfo:"JE_DEFAULEVALUE,value,code,S"},{xtype:"numberfield",fieldLabel:"宽度",allowBlank:!1,minValue:0,step:5,name:"width"},{xtype:"numberfield",fieldLabel:"高度",minValue:0,step:5,name:"height"},{xtype:"textfield",fieldLabel:"后缀",name:"unitTpl"},{xtype:"yesnofield",fieldLabel:"允许为空",value:"1",name:"allowBlank"},{xtype:"yesnofield",fieldLabel:"只读",name:"readOnly"},{xtype:"yesnofield",fieldLabel:"可选可编辑",name:"editable"},{xtype:"textfield",fieldLabel:"过滤条件",columnWidth:1,name:"whereSql"},{xtype:"textfield",fieldLabel:"输入提示",columnWidth:1,name:"emptyText"},{xtype:"textarea",fieldLabel:"配置信息",columnWidth:1,height:80,name:"configInfo"},{xtype:"box",padding:"5",margin:"2 2 2 10",columnWidth:1,cls:"x-view-emtpytext",data:{},itemId:"helpMsg",tpl:["<b>配置信息说明：</b>",'<tpl if="text">',"</br>{text}","<tpl else>","无","</tpl>"]},{xtype:"jsonfield",fieldLabel:"辅助配置",columnWidth:1,keyWidth:.5,valueWidth:.5,height:100,name:"otherConfig"},{xtype:"box",padding:"5",margin:"2 2 2 10",columnWidth:1,cls:"x-view-emtpytext",data:{},itemId:"otherHelpMsg",tpl:["<b>辅助配置说明：</b>",'<tpl if="text">',"</br>{text}","<tpl else>","无","</tpl>"]}],this.callParent(arguments)}}),Ext.define("JE.sys.chart.view.report.MainView",{extend:"Ext.panel.Panel",alias:"widget.report.reportmainview",layout:"border",border:0,initComponent:function(){var t=this;t.items=[{xtype:"panel",region:"center",autoScroll:!0,itemId:"editorPanel",bodyStyle:"background-color:#dfe8f6;",layout:{type:"table",tableAttrs:{align:"center"},columns:1},margin:"1",items:[{region:"center",xtype:"ueditor",itemId:"editor",toolleipi:!1,tableAttrs:[{fieldLabel:"绑定数据源",name:"bindingDS",xtype:"uxtrigger",trigger2Cls:"x-form-tree-trigger",editable:!1,handler:function(i){var e=t.getCmp("center").getCmp("reportDS").getRootNode(),n={id:"ROOT",expandable:!0,expanded:!0,children:[]};e.eachChild(function(e){if(-1!=["sql","table"].indexOf(e.raw.dsType)){var t=Ext.clone(e.raw);t.leaf=!0,n.children.push(t)}}),JE.selectWin({title:"数据源",type:"tree",value:i.getValue(),valueType:"code",rootData:n,callback:function(e){var t=e[0];t&&i.setValue(t.get("code"))}})}},{text:"当前表格中，任意一个单元格绑定了list数据源，那么，整个表格将根据数据源循环展示",columnWidth:1,xtype:"label"}]},{xtype:"box",itemId:"pageBox"}]},{xtype:"panel",region:"south",layout:"border",split:!0,collapsible:!0,hideCollapseTool:!0,titleCollapse:!0,collapseMode:"mini",height:350,itemId:"center",border:0,items:[{region:"center",margins:"1",itemId:"reportbasic",xtype:"report.reportbasic"},{region:"west",itemId:"reportDS",width:130,split:!0,xtype:"report.reportds",title:"数据源",iconCls:"jeicon jeicon-database"}]}],t.callParent(arguments)},afterRender:function(){this.callParent(arguments),this.getCmp("center").getCmp("reportDS").editor=this.editor=this.getCmp("editorPanel").getCmp("editor"),this.pageBox=this.getCmp("editorPanel").getCmp("pageBox")},getReportData:function(){var i=this.getCmp("center").getCmp("reportbasic").form.getValues(),n={},e=Ext.clone(i);Ext.iterate(e,function(e,t){e.replace("REPORT_","")==e&&(n[e]=t,delete i[e])}),n.printInfo={printPageSize:Ext.value(n.printPageSize,"210*297")},i.REPORT_DSCONFIG=Ext.encode(n);var t=this.editor,a=Ext.DomQuery.select("table",t.editor.document.body);return Ext.each(a,function(e){e.removeAttribute("width"),Ext.each(e.rows[0].cells,function(e){e.width=e.offsetWidth})}),i.REPORT_HTML=t.getValue(),i.REPORT_ICONCLS="jeicon jeicon-chart",i.tableCode="JE_CORE_REPORT",i},setReportData:function(e){var t=this.getCmp("center").getCmp("reportbasic");this.getCmp("center").getCmp("reportDS").loadDSData(e.REPORT_DSIDS,!1),this.editor.setValue(e.REPORT_HTML);var i=Ext.decode(Ext.value(e.REPORT_DSCONFIG,"{}"));Ext.apply(e,i),t.form.reset(),t.form.setValues(e);var n=t.form.findField("params"),a=n.grid.down("gridcolumn[dataIndex=field]"),l=[];n.grid.store.each(function(e){var t=e.get("code");l.push({text:t,code:t})}),a.getEditor?a.getEditor().store.loadData(l):a.field.dataArray=l;var o=Ext.value(e.printPageSize,"210*297");this.changePageSize(o)},changePageSize:function(e){if(!Ext.isEmpty(e)){var t=Number(e.split("*")[0]),i=Number(e.split("*")[1]);Ext.isNumeric(t)&&Ext.isNumeric(i)&&(this.pageBox.getEl().setStyle({width:t+"mm",height:i+"mm"}),this.editor.setSize(this.pageBox.getSize().width,this.pageBox.getSize().height),this.pageBox.getEl().setStyle({height:"0px"}))}},getFieldAttr:function(){var n=this,e=n.getCmp("center").getCmp("reportbasic").form.findField("REPORT_TYPE").getValue(),t=(n.getCmp("center").getCmp("reportDS"),[{fieldLabel:"编码",allowBlank:!1,name:"code"},{fieldLabel:"文字",name:"text"},{fieldLabel:"公式",name:"formula",xtype:"textarea",labelStyle:"cursor: pointer;color:blue;",labelAttrTpl:' data-qtip="帮助" ',listeners:{afterrender:function(t){t.labelEl&&t.labelEl.on("click",function(){var e=n.getCmp("center").getCmp("reportDS").getRootNode(),i=[];e.eachChild(function(e){var t={text:e.raw.dsText,code:e.raw.code,child:[]};e.eachChild(function(e){"dsfield"==e.raw.type&&t.child.push({text:e.raw.text,code:e.raw.code})}),i.push(t)}),JE.win({title:"公式编写帮助",border:0,width:800,height:600,items:{xtype:"report.reporthelpview",fieldData:i,formulaText:t.getValue()},useButton:!0,fn:function(e){t.setValue(e.items.get(0).getCmp("center").getCmp("gsText").getValue())}}).show()})}}},{fieldLabel:"默认值",xtype:"textfield",name:"defaultValue"},{xtype:"fieldcontainer",fieldLabel:"字体",layout:"hbox",defaults:{flex:1},items:[{xtype:"textfield",name:"fontSize",emptyText:"字号"},{xtype:"textfield",name:"fontFamily",emptyText:"样式"},{xtype:"cbbfield",name:"fontWeight",value:"normal",hideTrigger1:!0,dataArray:[{code:"",text:"正常"},{code:"bold",text:"粗体"}]},{xtype:"colorfield",name:"color",hideTrigger1:!0,emptyText:"颜色"}]},{fieldLabel:"导航",xtype:"rgroup",name:"to",dataArray:[{code:"",text:"无"},{code:"H",text:"横向"},{code:"V",text:"纵向"},{code:"DATA",text:"数据"},{code:"NUM",text:"序号"}],listeners:{change:function(t,i,e){Ext.each(["groupField","groupFieldTpl"],function(e){t.ownerCt.getCmp(e).setVisible("DATA"==i)}),t.ownerCt.getCmp("group").setVisible(-1!=["DATA","V",""].indexOf(i)),t.ownerCt.getCmp("groupSummary").setVisible(-1!=["DATA",""].indexOf(i))}}},{fieldLabel:"合并单元格",xtype:"yesnofield",itemId:"group",name:"group"},{fieldLabel:"分组字段",xtype:"textfield",hidden:!0,name:"groupField",itemId:"groupField"},{fieldLabel:"展示模板",xtype:"textfield",hidden:!0,emptyText:"名称：{name}({count}条)",name:"groupFieldTpl",itemId:"groupFieldTpl"},{fieldLabel:"分组统计",xtype:"cbbfield",editable:!0,emptyText:"有分组字段起效：填写描述或选择统计类型",dataArray:[{code:"count",text:"计数"},{code:"sum",text:"合计"},{code:"min",text:"最小"},{code:"max",text:"最大"},{code:"avg",text:"平均"}],name:"groupSummary",itemId:"groupSummary"}]);return"EDIT"==e&&t.push({xtype:"fieldcontainer",fieldLabel:"填报控件",layout:"hbox",items:[{xtype:"checkbox",name:"editable",inputValue:"1",boxLabel:"启用",listeners:{change:function(e,t){e.nextSibling().setDisabled(!("1"==t||1==t))}}},{xtype:"button",cls:"btn",margin:"0 0 0 10",disabled:!0,width:100,text:"编辑字段",handler:function(e){var i=e.nextSibling();JE.win({title:"配置信息",height:500,width:650,autoShow:!0,useButton:!0,showFn:function(e){var t=JE.toObj(Ext.value(JE.decodeURI(i.getValue()),"{}"));e.getCmp("form").form.setValues(t)},fn:function(e){var t=e.getCmp("form").form.getValues();i.setValue(JE.encodeURI(Ext.encode(t)))},items:{xtype:"report.fieldform",itemId:"form"}})}},{xtype:"hidden",name:"field"}]}),t}}),Ext.define("JE.sys.chart.view.report.ReportBasic",{extend:"Ext.form.Panel",alias:"widget.report.reportbasic",tableCode:"JE_CORE_REPORT",bodyPadding:"5",layout:"column",autoScroll:!0,cls:"je-chartFunc-config",initComponent:function(){function n(e){t.getCmp("helpMsg").update({text:JE.helpMsg.configinfo[e]})}var t=this;t.defaults={labelWidth:80,labelAlign:"right",margin:"1"},t.buttonAlign="left",t.buttons=[{text:"保存",iconCls:"jeicon jeicon-save",ref:"saveBtn"},{text:"执行预览",iconCls:"jeicon jeicon-lightning-on",ref:"preview"}],t.items=[{xtype:"box",html:"基础",margin:4,padding:"3 20",style:"font-weight: bold;color: #0852F0;background-color: #E4E4E4;",columnWidth:1},{xtype:"hidden",name:"REPORT_HTML"},{xtype:"textfield",name:"REPORT_TEXT",columnWidth:.3,allowBlank:!1,fieldLabel:"名称"},{xtype:"textfield",name:"REPORT_CODE",columnWidth:.3,allowBlank:!1,fieldLabel:"编码",readOnly:!0},{xtype:"textfield",name:"REPORT_REMARK",columnWidth:.4,fieldLabel:"说明"},{xtype:"hidden",name:"REPORT_DSIDS",fieldLabel:"图表数据源"},{xtype:"hidden",name:"REPORT_ICONCLS",fieldLabel:"图标"},{xtype:"hidden",name:"JE_CORE_REPORT_ID"},{xtype:"hidden",name:"REPORT_TYPE"},{xtype:"box",html:"查询信息",margin:4,padding:"3 20",style:"font-weight: bold;color: #0852F0;background-color: #E4E4E4;",columnWidth:1},{fieldLabel:"查询面板",xtype:"fieldcontainer",layout:"hbox",items:[{xtype:"yesnofield",boxLabel:"不启用",name:"hideSearch"},{xtype:"yesnofield",boxLabel:"默认收起",name:"collapsed"},{xtype:"yesnofield",boxLabel:"初始化查询",name:"initParams"},{xtype:"yesnofield",boxLabel:"菜单查询",name:"menuSearch"},{xtype:"yesnofield",boxLabel:"树形查询",name:"treeSearch"}],columnWidth:1},{fieldLabel:"背景颜色",xtype:"colorfield",columnWidth:.3,name:"bgcolor"},{fieldLabel:"查询按钮",xtype:"rgroup",name:"btnRegion",value:"north",dataArray:[{code:"top",text:"上"},{code:"bottom",text:"下"},{code:"left",text:"左"},{code:"right",text:"右"}],columnWidth:.4},{fieldLabel:"查询窗体宽",xtype:"numberfield",name:"winWidth",minValue:1,columnWidth:.3},{fieldLabel:"查询参数",xtype:"jsonarrayfield",name:"params",columnWidth:1,actionColumn:!0,listeners:{afterrender:function(e){e.grid.on("selectionchange",function(e,t){var i="";JE.isNotEmpty(t)&&(i=t[0].get("xtype")),n(i)})}},columns:[{dataIndex:"code",width:50,text:"编码"},{dataIndex:"name",width:50,text:"名称"},{dataIndex:"xtype",text:"类型",width:100,tactics:[{type:"dic",dicCode:"JE_FUNC_XTYPE"}],renderer:JE.renderer,field:{xtype:"cbbfield",dicItemCodes:"textfield,rgroup,cgroup,cbbfield,datefield,datetimefield,datemonthfield,rangedatefield,treessfield,gridssfield,queryuserfield,colorfield",configInfo:"JE_FUNC_XTYPE",listeners:{change:function(e,t){n(t)}}}},{dataIndex:"field",text:"依附字段",width:100,field:{xtype:"cbbfield",dataArray:[]}},{dataIndex:"configInfo",width:300,text:"配置项"},{dataIndex:"hidden",width:50,text:"隐藏",align:"center",xtype:"uxcheckcolumn"},{width:50,text:"事件",align:"center",xtype:"actioncolumn",items:[{tooltip:"编辑",handler:function(e,t,i){var n=e.panel.getStore().getAt(t),a="/**\n * 编码格式：{render:function(field){},change:function(field){}} \n **/\n{\n\n}";a=Ext.value(n.get("listeners"),a),JE.win({title:"字段事件",width:800,height:600,frame:!1,layout:"fit",items:{border:0,xtype:"jecodeeditor",value:a,saveFn:function(e){n.set("listeners",e==a?"":e),JE.msg("保存成功！")}}}).show()},getClass:function(e,t,i){return JE.isNotEmpty(i.get("listeners"))?"jeicon jeicon-lightning-on":"jeicon jeicon-lightning-off"}}]},{dataIndex:"listeners",hidden:!0},{dataIndex:"useText",text:"启用展示字段",xtype:"uxcheckcolumn"},{dataIndex:"value",width:100,text:"默认值",field:{xtype:"cbbfield",name:"RESOURCEFIELD_VALUE",editable:!0,configInfo:"JE_DEFAULEVALUE,value,code,S"},tactics:[{type:"dic",dicCode:"JE_DEFAULEVALUE"}],renderer:JE.renderer},{dataIndex:"valueFn",hidden:!0},{text:"默认值方法",xtype:"actioncolumn",width:100,align:"center",items:[{tooltip:"编辑",handler:function(e,t,i){var n=e.panel.getStore().getAt(t),a="/**\n * @return {Object} \n **/\nfunction(){\n}";a=Ext.value(n.get("valueFn"),a),JE.win({title:"默认值",width:800,height:600,frame:!1,layout:"fit",items:{border:0,xtype:"jecodeeditor",value:a,saveFn:function(e){n.set("valueFn",e==a?"":e),JE.msg("保存成功！")}}}).show()},getClass:function(e,t,i){return JE.isNotEmpty(i.get("valueFn"))?"jeicon jeicon-lightning-on":"jeicon jeicon-lightning-off"}}]},{dataIndex:"width",text:"宽",width:50,field:{xtype:"numberfield",hideTrigger:!0,value:200}},{dataIndex:"changeS",text:"即时查询",xtype:"uxcheckcolumn"},{dataIndex:"format",text:"格式化结果",width:80,field:{xtype:"cbbfield",dataArray:["in"]}}]},{xtype:"box",padding:"5",margin:"2 2 2 86",columnWidth:1,cls:"x-view-emtpytext",data:{},itemId:"helpMsg",tpl:["<b>配置信息说明：</b>",'<tpl if="text">',"</br>{text}","<tpl else>","无","</tpl>"]},{fieldLabel:"系统变量",xtype:"hidden",readOnly:!0,columnWidth:1,name:"defvals"},{xtype:"box",html:"其他",margin:4,padding:"3 20",style:"font-weight: bold;color: #0852F0;background-color: #E4E4E4;",columnWidth:1},{fieldLabel:"打印纸张",xtype:"cbbfield",configInfo:"JE_CORE_PAGESIZE",name:"printPageSize",value:"210*297",inputAttrTpl:'title="可编辑纸张(cm)：宽*长"',editable:!0,columnWidth:.3},{fieldLabel:"纸张颜色",xtype:"colorfield",name:"pageColor",columnWidth:.3},{xtype:"fieldcontainer",fieldLabel:"renderer",layout:"column",columnWidth:.4,items:[{xtype:"button",cls:"btn",itemId:"editEvent",iconCls:"jeicon jeicon-lightning-off",text:"编辑事件"},{xtype:"hidden",name:"REPORT_RENDERER",listeners:{change:function(e,t){e.ownerCt.getCmp("editEvent").setIconCls(Ext.isEmpty(t)?"jeicon jeicon-lightning-off":"jeicon jeicon-lightning-on")}}}]},{fieldLabel:"分页组件",xtype:"yesnofield",boxLabel:"启用",name:"usePage",columnWidth:.2},{fieldLabel:"分页数据源",xtype:"uxtrigger",name:"pageDS",trigger2Cls:"x-form-tree-trigger",editable:!1,emptyText:"支持图形和SQL数据源",handler:function(i){var e=t.ownerCt.getCmp("reportDS").getRootNode(),n={id:"ROOT",expandable:!0,expanded:!0,children:[]};e.eachChild(function(e){if(-1!=["sql","table"].indexOf(e.raw.dsType)){var t=Ext.clone(e.raw);t.leaf=!0,n.children.push(t)}}),JE.selectWin({title:"数据源",type:"tree",value:i.getValue(),valueType:"code",rootData:n,callback:function(e){var t=e[0];t&&i.setValue(t.get("code"))}})},columnWidth:.4},{fieldLabel:"每页条数",xtype:"numberfield",name:"pageSize",minValue:0,value:30,columnWidth:.2},{fieldLabel:"分页信息",xtype:"yesnofield",boxLabel:"显示",name:"displayMsg",columnWidth:.2},{fieldLabel:"工具条",xtype:"yesnofield",boxLabel:"启用",name:"useTBar",columnWidth:.2},{fieldLabel:"显示按钮",xtype:"cgroup",boxLabel:"启用",name:"tbarCommBtns",columnWidth:.8,dataArray:[{code:"printBtn",text:"打印报表"},{code:"saveFile",text:"存到文件库"},{code:"sendFile",text:"发快递"},{code:"expWord",text:"导出word"},{code:"expExcel",text:"导出excel"}]},{fieldLabel:"扩展按钮",xtype:"jsonarrayfield",name:"tbarBtns",columnWidth:1,actionColumnIndex:0,columns:[{dataIndex:"itemId",width:120,text:"编码"},{dataIndex:"text",width:120,text:"名称"},{dataIndex:"iconCls",text:"样式",width:120,field:{xtype:"gridssfield",configInfo:"JE_CORE_FONTICON,iconCls,FONTICON_CLS,S"}},{dataIndex:"events",hidden:!0},{xtype:"actioncolumn",width:50,text:"事件",items:[{tooltip:"编辑",getClass:function(e,t,i){return JE.CoreUtil.isFireListener(i.get("events"))?"jeicon jeicon-lightning-on":"jeicon jeicon-lightning-off"},handler:function(e,t,i,n,a,l){e.panel;JE.win({title:"事件",border:0,items:{xtype:"jelistenereditor",type:"button",value:l.get("events"),funcInfoHide:!0,saveFn:function(e){l.set("events",JE.encode(e))}}}).show()}}]},{dataIndex:"hidden",flex:1,xtype:"uxcheckcolumn",text:"隐藏"}]}],t.callParent(arguments)}}),Ext.define("JE.sys.chart.view.report.ReportDS",{extend:"Ext.tree.Panel",alias:"widget.report.reportds",useArrows:!0,rootVisible:!1,animate:!1,initComponent:function(){var d=this;d.tools=[{type:"plus",tooltip:"添加空字段",handler:function(){var e=JE.uuid("_");d.editor.setHtml('<input type="button" reportBtn value="空字段" style="height: 20px;padding: 0px;margin: 0px;" data-code="'+e+'" data-text="空字段" data-formula="" data-to="" />',"insert")}}],d.root={expanded:!0,id:"ROOT",children:[]},d.bulidMenu(),d.callParent(arguments),d.on({containercontextmenu:function(e,t,i){t.stopEvent(),d.getSelectionModel().deselectAll(),d.contextMenu.getCmp("add").setDisabled(!1),d.contextMenu.getCmp("edit").setDisabled(!0),d.contextMenu.getCmp("remove").setDisabled(!0),d.contextMenu.showAt(t.getXY())},itemcontextmenu:function(e,t,i,n,a,l){a.stopEvent();var o="DS"==t.raw.type;d.contextMenu.getCmp("add").setDisabled(!1),d.contextMenu.getCmp("edit").setDisabled(!o),d.contextMenu.getCmp("remove").setDisabled(!o),d.contextMenu.showAt(a.getXY())}})},afterRender:function(){this.callParent(arguments),this.basicForm=this.ownerCt.getCmp("reportbasic")},loadDSData:function(e,t){var i=[],r=[];JE.isNotEmpty(e)&&(i=JE.ajax({url:JE.getUrlMaps("je.core.sys.chart","load"),params:{tableCode:"JE_CORE_DATASOURCE",whereSql:"and JE_CORE_DATASOURCE_ID in('"+e.replaceAll(",","','")+"')",limit:-1}}).rows);var c=new Ext.util.MixedCollection,s=new Ext.util.MixedCollection;if(Ext.each(i,function(e){var t=Ext.decode(e.DATASOURCE_CONFIG),i=e.JE_CORE_DATASOURCE_ID,n=e.DATASOURCE_TEXT,a=e.DATASOURCE_CODE,l={id:i,text:n+"("+a+")",code:a,dsText:n,dsType:e.DATASOURCE_TYPE,expandable:!0,expanded:!0,leaf:!1,iconCls:e.DATASOURCE_ICONCLS,type:"DS",children:[]};Ext.each(t.fields,function(e){var t=Ext.isString(e)?e:e.name;l.children.push({id:l.id+"_"+t,text:t,type:"dsfield",leaf:!0})});var o={id:i+"_params",text:"参数",expandable:!0,leaf:!1,children:[]};Ext.each(t.params,function(e){var t=Ext.isObject(e)?e.name:e;c.add(t,{code:t,name:t}),o.children.push({id:o.id+"_"+t,text:t,leaf:!0})}),l.children.push(o);var d={id:i+"_defvals",text:"系统变量",expandable:!0,leaf:!1,children:[]};Ext.each(t.defvals,function(e){s.add(e,e),d.children.push({id:d.id+"_"+e,text:e,leaf:!0})}),l.children.push(d),r.push(l)}),0!=t){var n,a=this.basicForm.form.findField("params"),l=a.getData(),o=[];JE.isNotEmpty(l)&&Ext.each(l,function(e){c.get(e.code)&&(o.push(e),c.removeAtKey(e.code))}),n=o.concat(c.items),a.setValue(n),this.basicForm.form.findField("defvals").setValue(s.items.join(","))}this.setRootNode({id:"ROOT",children:r}),this.basicForm.form.findField("REPORT_DSIDS").setValue(e)},bulidMenu:function(){var t=this;t.contextMenu=Ext.create("Ext.menu.Menu",{width:100,margin:"0 0 10 0",items:[{text:"载入数据源",itemId:"add",iconCls:"jeicon jeicon-chart-histogram-new",handler:function(e){t.addDS()}},{text:"移除数据源",itemId:"remove",iconCls:"jeicon jeicon-data-deletion",handler:function(e){t.removeDS()}},{text:"同步数据源",itemId:"refresh",iconCls:"jeicon jeicon-table-column-synchronization",handler:function(e){t.refreshDS()}},"-",{text:"编辑数据源",iconCls:"jeicon jeicon-document-attribute",itemId:"edit",handler:function(){t.editDS()}}]})},addDS:function(){var n=this,a=n.basicForm.form.findField("REPORT_DSIDS"),e=JE.ajax({url:JE.getUrlMaps("je.core.sys.chart","getTree"),params:{tableCode:"JE_CORE_DATASOURCE",whereSql:" AND SY_JESYS='1' ",excludes:"",sort:[{property:"SY_ORDERINDEX",direction:"ASC"}]}});JE.selectWin({title:"数据源",type:"tree",multiSelect:!0,rootData:e,valueType:"id",okButtonClick:function(e,t){var i=a.getValue().split(",");Ext.each(e,function(e){var t=e.get("id");-1==i.indexOf(t)&&i.push(t)}),JE.isNotEmpty(e)&&n.loadDSData(i.join(","))}})},removeDS:function(){var e=this.getSelectionModel().getSelection()[0],t=this.basicForm.form.findField("REPORT_DSIDS").getValue().split(",");t=Ext.Array.remove(t,e.get("id")),this.loadDSData(t.join(",")),JE.msg("删除完成，请保存数据！")},editDS:function(){var e=this.getSelectionModel().getSelection()[0],t=this.up("panel[xtype=chart.mainview]").down("treepanel[xtype=chart.datasourceview]");(e=t.store.getById(e.get("id")))?(t.ownerCt.setActiveTab(t),t.selectPath(e.getPath()),t.fireEvent("itemdblclick",t.view,e)):JE.alert("该数据源已经不存在，请同步数据源信息！")},refreshDS:function(){var e=this.basicForm.form.findField("REPORT_DSIDS");this.loadDSData(e.getValue()),JE.msg("同步完成，请保存数据！")}}),Ext.define("JE.sys.chart.view.report.ReportHelp",{extend:"Ext.panel.Panel",alias:"widget.report.reporthelpview",layout:"border",border:0,initComponent:function(){var e={xtype:"panel",region:"west",width:200,layout:"border",split:!0,border:0,items:[this.getHelpTree(),this.getFieldTree()]},t={xtype:"panel",region:"center",itemId:"center",layout:"border",border:0,items:[{itemId:"helpInfo",xtype:"panel",html:"公式说明",bodyPadding:"5",autoScroll:!0,region:"center"},{xtype:"textarea",height:200,split:!0,region:"south",emptyText:"公式编写",itemId:"gsText",value:Ext.value(this.formulaText,"")}]};this.items=[e,t],this.callParent(arguments)},afterRender:function(){this.callParent(arguments)},getHelpTree:function(){var a=this;return{xtype:"treepanel",title:"公式",region:"north",height:200,split:!0,root:{expanded:!0,children:[{text:"sum(求和)",nodeInfo:'<span insertText style="cursor: pointer;color:blue;">sum(数据源的字段名称|嵌套函数编码)</span></br>例子：</br>sum(数据源.字段名称)</br>sum(编码)',leaf:!0},{text:"min(最小值)",nodeInfo:'<span insertText style="cursor: pointer;color:blue;">min(数据源的字段名称|嵌套函数编码)</span></br>例子：</br>min(数据源.字段名称)</br>min(编码)',leaf:!0},{text:"max(最大值)",nodeInfo:'<span insertText style="cursor: pointer;color:blue;">max(数据源的字段名称|嵌套函数编码)</span></br>例子：</br>max(数据源.字段名称)</br>max(编码)',leaf:!0},{text:"count(计数)",nodeInfo:'<span insertText style="cursor: pointer;color:blue;">count(数据源的字段名称|嵌套函数编码)</span></br>例子：</br>count(数据源.字段名称)</br>count(编码)',leaf:!0},{text:"avg(平均值)",nodeInfo:'<span insertText style="cursor: pointer;color:blue;">avg(数据源的字段名称|嵌套函数编码)</span></br>例子：</br>avg(数据源.字段名称)</br>avg(编码)',leaf:!0},{text:"chart(图表)",nodeInfo:'<span insertText style="cursor: pointer;color:blue;">chart(图表编码,宽,高,参数1,参数2...)</span></br>例子：</br>chart(CHARTCODE,200,200,数据源.字段名称,数据源.字段名称2...),参数可以无限多',leaf:!0},{text:"header(斜线表头)",nodeInfo:'<span insertText style="cursor: pointer;color:blue;">header(表头1,表头2...)</span></br>例子：</br>header(表头1,表头2...),参数可以无限多',leaf:!0},{text:"dic(字典导航)",nodeInfo:'<span insertText style="cursor: pointer;color:blue;">dic(数据源的字段名称,字典编码,字典取值字段)</span></br>例子：</br>dic(数据源.字段名称,YESORNO,text)</br>字典取值字段：text,code,id</br>此函数只在导航时起作用',leaf:!0},{text:"params(参数)",nodeInfo:'<span insertText style="cursor: pointer;color:blue;">params(查询参数编码)</span></br>例子：</br>params(查询参数编码)</br>此函数可获得查询参数的值',leaf:!0}]},rootVisible:!1,listeners:{itemclick:function(e,t){var i=a.getCmp("center").getCmp("helpInfo"),n=a.getCmp("center").getCmp("gsText").inputEl.dom;i.update(t.raw.nodeInfo),i.body.down("span[insertText]").on("click",function(e,t){JE.insertAtCursor(n,t.innerText)})}}}},getFieldTree:function(){return{xtype:"panel",title:"字段",region:"center",autoScroll:!0,tpl:['<tpl for=".">','<div style="text-align:center;font-weight: bold;">{text}</div>','<tpl for="values.child">',"<div>{parent.code}.{text}</div>","</tpl>","</tpl>"],data:this.fieldData}}}),Ext.define("JE.sys.chart.view.report.ReportTree",{extend:"Ext.tree.Panel",alias:"widget.report.reporttree",border:1,useArrows:!0,rootVisible:!1,animate:!1,codeSearch:!0,showTitle:!1,mixins:["JE.core.util.ViewUtil","JE.core.util.func.Tree"],initComponent:function(){var e=this,t=e.getTreeTbar(e);e.dockedItems=[t],e.funcData={info:{tableName:"JE_CORE_REPORT",pkName:"JE_CORE_REPORT_ID"}},e.store=JE.getStore({tableName:"JE_CORE_REPORT",url:JE.getUrlMaps("je.core.sys.chart","getTree"),type:"tree"}),e.store.on("load",function(){e.getRootNode().expandChildren()}),e.setTreeDDPlugin(e),e.bulidMenu(),e.callParent(arguments)},bulidMenu:function(){var t=this;t.contextMenu=Ext.create("Ext.menu.Menu",{width:100,margin:"0 0 10 0",items:[{text:"新建报表",itemId:"report",iconCls:"jeicon jeicon-chart-histogram-new",handler:function(e){t.updateNode("doSave","report")}},{text:"新建填报报表",itemId:"editReport",iconCls:"jeicon jeicon-chart-histogram-new",handler:function(e){t.updateNode("doSave","report","EDIT")}},"-",{text:"新建目录",itemId:"folder",iconCls:"jeicon jeicon-folder-add",handler:function(e){t.updateNode("doSave","folder")}},{text:"删除",iconCls:"jeicon jeicon-data-deletion",itemId:"remove",handler:function(){t.removeNode()}}]})},removeNode:function(){var t=this.getSelectionModel().getSelection()[0];if(!Ext.isEmpty(t)){var e=t.get("text"),i=t.get("id");JE.confirm("确定删除："+e+" ?",function(e){"ok"==e&&(JE.ajax({url:JE.getUrlMaps("je.core.remove"),params:{ids:i,tableCode:"JE_CORE_REPORT",doTree:!0}}),t.remove(),JE.msg("删除成功..."))})}},updateNode:function(l,e,o){var d=this,r=d.getSelectionModel().getSelection()[0],c=Ext.value(r,d.getRootNode()),t="",i="",n=JE.uuid("_"),s="report"==e;o=Ext.value(o,"");"doUpdate"==l&&(t=r.data.bean.REPORT_TEXT,i=r.data.bean.REPORT_REMARK,n=r.data.bean.REPORT_CODE),JE.formWin({title:"目录",width:380,height:200,items:[{xtype:"textfield",fieldLabel:"名称",allowBlank:!1,value:t,name:"text"},{xtype:"textfield",fieldLabel:"编码",value:n,readOnly:s&&"doUpdate"==l,hidden:!s,name:"code"},{xtype:"textarea",fieldLabel:"说明",value:i,name:"remark"}],fn:function(e,t){var i={tableCode:"JE_CORE_REPORT",REPORT_TEXT:e.text,REPORT_REMARK:e.remark,REPORT_CODE:e.code};"doUpdate"==l?i.JE_CORE_REPORT_ID=r.get("id"):Ext.apply(i,{SY_LAYER:c.getDepth()+1,SY_PATH:c.getPath(),SY_PARENT:c.get("id"),SY_NODETYPE:s?"LEAF":"GENERAL",SY_DISABLED:s?"0":"1",REPORT_ICONCLS:s?"jeicon jeicon-chart":"",REPORT_TYPE:o});var n=JE.ajax({url:JE.getUrlMaps("je.core.sys.chart",l),params:i});if(n.success)if(JE.msg("操作成功！"),"doUpdate"==l)r.set("text",e.text),r.data.bean.REPORT_REMARK=e.remark,r.data.bean.REPORT_TEXT=e.text,r.commit();else{var a={id:n.obj.JE_CORE_REPORT_ID,text:e.text,code:e.code,disabled:n.obj.SY_DISABLED,expandable:!0,leaf:s,bean:n.obj,iconCls:s?"jeicon jeicon-chart":"",children:[]};a=c.appendChild(a),d.selectPath(a.getPath())}else JE.error(n.obj,n)}})}}),Ext.define("JE.sys.chart.controller.ChartController",{extend:"Ext.app.Controller",init:function(){var e={"form[xtype=chart.chartsbasic] treessfield[name=CHARTS_TYPENAME]":{okbuttonclick:function(e,t,i){var n=t[0];if(n&&n.isLeaf()){var a=n.raw;e.ownerCt.form.setValues({CHARTS_MS:a.MS?"1":"0",CHARTS_ICONCLS:a.iconClss})}}},"form[xtype=chart.chartsbasic] hidden[name=CHARTS_TYPECODE]":{change:function(e,t){var i=e.up("panel[xtype=chart.attrsview]"),n=i.getCmp("basicview"),a=i.getCmp("chartsstyle"),l=n.getCmp("chartsdscfg"),o="AngularGauge"==t,d="chartsstyle";"AngularGauge"==t?d="chartsstyle4A":-1!=["Radar","Pyramid","Pie2D","Pie3D","Doughnut2D","Doughnut3D"].indexOf(t)&&(d="chartsstyle4PR");var r=-1!=["MSCombi2D","MSCombiDY2D","ScrollCombi2D","ScrollCombiDY2D","MSCombi3D"].indexOf(t),c=l.form.findField("seriesCfg");c.reset(),c.setDisabled(!r),c.setVisible(r),n.getCmp("chartsdscfg4a").setVisible(o),n.getCmp("chartsdscfg").setVisible(!o),a.getLayout().setActiveItem(d)}},"form[xtype=chart.chartsbasic] hidden[name=CHARTS_MS]":{change:function(e,t){var i=e.up("panel[xtype=chart.chartmainview]").down("form[xtype=chart.chartsdscfg]"),n="1"==t;Ext.each(["series","seriesField"],function(e){var t=i.form.findField(e);t.reset(),t.setDisabled(!n),t.setVisible(n)})}},"tabpanel[xtype=chart.attrsview]":{tabchange:function(e,t,i,n){var a="chartsstyle"!=t.itemId;e.down("button[ref=copyStyleBtn]").setDisabled(a),e.down("button[ref=pasteStyleBtn]").setDisabled(a)}},"tabpanel[xtype=chart.attrsview] button[ref=echartBtn]":{click:function(e){var t=e.up("panel[xtype=chart.chartmainview]");if(t.down("panel[xtype=chart.chartsedit]").isValid()){var i=t.getChartData();JE.win({title:i.CHARTS_TYPENAME,border:0,items:{xtype:"jechartview",EChart:!1,chartBean:i},autoShow:!0})}}},"tabpanel[xtype=chart.attrsview] button[ref=copyStyleBtn]":{click:function(e){var t=e.up("tabpanel[xtype=chart.attrsview]").getActiveTab();t.styleObj=t.getChartData().chart,delete t.styleObj.caption,delete t.styleObj.subcaption,JE.msg("复制成功...")}},"tabpanel[xtype=chart.attrsview] button[ref=pasteStyleBtn]":{click:function(e){var t=e.up("tabpanel[xtype=chart.attrsview]").getActiveTab();JE.isNotEmpty(t.styleObj)&&(t.setChartData({chart:t.styleObj}),delete t.styleObj,JE.msg("粘贴成功..."))}},"tabpanel[xtype=chart.attrsview] button[ref=saveBtn]":{click:function(e){var t=e.up("panel[xtype=chart.chartmainview]");if(t.down("panel[xtype=chart.chartsedit]").isValid()){var i=t.getChartData(),n=t.chartsTree,a=n.getSelectionModel().getSelection()[0],l=Ext.value(a,n.getRootNode()),o="doUpdate";Ext.isEmpty(i.JE_CORE_CHARTS_ID)&&(o="doSave",i=Ext.apply(i,{SY_LAYER:l.getDepth()+1,SY_PATH:l.getPath(),SY_PARENT:l.get("id"),SY_NODETYPE:"LEAF",SY_DISABLED:"0"}));var d=JE.ajax({url:JE.getUrlMaps("je.core.sys.chart",o),params:i});if(d.success){if(JE.msg("操作成功！"),"doSave"==o){var r={id:d.obj.JE_CORE_CHARTS_ID,text:d.obj.CHARTS_TEXT,code:d.obj.CHARTS_CODE,iconCls:d.obj.CHARTS_ICONCLS,expandable:!0,leaf:!0,children:[],bean:d.obj};a=l.appendChild(r),n.selectPath(a.getPath())}else a.set("text",d.obj.CHARTS_TEXT),a.set("iconCls",d.obj.CHARTS_ICONCLS),a.raw.bean=Ext.apply(a.raw.bean,d.obj),a.raw.MS="1"==d.obj.CHARTS_MS,a.commit();n.fireEvent("selectionchange",n.getSelectionModel(),[a])}else JE.error(d.obj,d);"window"==t.ownerCt.xtype&&t.ownerCt.close()}}},"tabpanel[xtype=chart.attrsview] button[ref=previewBtn]":{click:function(e){var t=e.up("panel[xtype=chart.chartmainview]"),i=t.getCmp("chartspreview");if(t.down("panel[xtype=chart.chartsedit]").isValid()){var n=t.getChartData();i.loadCharts(n)}}},"treepanel[xtype=chart.chartstree]":{containercontextmenu:function(e,t,i){t.stopEvent();var n=e.panel;n.getSelectionModel().deselectAll(),n.contextMenu.getCmp("folder").setDisabled(!1),n.contextMenu.getCmp("chart").setDisabled(!1),n.contextMenu.getCmp("remove").setDisabled(!0),n.contextMenu.showAt(t.getXY())},itemcontextmenu:function(e,t,i,n,a,l){a.stopEvent();var o=e.panel,d=t.isLeaf();o.contextMenu.getCmp("folder").setDisabled(d),o.contextMenu.getCmp("chart").setDisabled(d),o.contextMenu.getCmp("remove").setDisabled(!1),o.contextMenu.showAt(a.getXY())},selectionchange:function(e,t){var i=t[0],n=!i||"1"==i.get("disabled"),a=e.view.panel.ownerCt.ownerCt.getCmp("centerview"),l=a.getCmp("chartmainview");if(a.getLayout().setActiveItem(n?"charthelp":"chartmainview"),!n){JE.ajax({url:JE.getUrlMaps("je.core.getInfoById"),params:{tableCode:"JE_CORE_CHARTS",pkValue:i.get("id")}});l.setChartData(i.raw.bean)}},itemdblclick:function(e,t){"1"==t.get("disabled")&&e.panel.updateNode("doUpdate")}},"form[xtype=chart.chartsother] button[itemId=editEvent]":{click:function(e){var t=e.up("form").form.findField(e.fieldName),i=Ext.value(t.getValue(),"function(chartview,data,chart){\n\n}");JE.win({title:"单击事件(Ctrl+S保存)",width:800,height:600,border:0,items:{xtype:"jecodeeditor",itemId:"editorview",value:i,saveFn:function(e){t.setValue(e),JE.msg("保存成功...")},border:0}}).show()}},"tabpanel[xtype=chart.westview]":{tabchange:function(e,t,i){"datasourceview"!=t.itemId&&"datasourceview"!=i.itemId&&t.getSelectionModel().deselectAll()}}};this.control(e),JE.initCtr("JE.sys.chart.controller.DataSourceCtr"),JE.initCtr("JE.sys.chart.controller.ReportController")},views:["JE.sys.chart.view.MainView","JE.sys.chart.view.WestView","JE.sys.chart.view.chart.ChartsPreview","JE.sys.chart.view.chart.ChartsType","JE.sys.chart.view.chart.MainView","JE.sys.chart.view.chart.ChartsTree","JE.sys.chart.view.chart.ChartsEdit","JE.sys.chart.view.chart.ChartsDSCfg","JE.sys.chart.view.chart.ChartsDS","JE.sys.chart.view.chart.ChartsBasic","JE.sys.chart.view.chart.AttrsView","JE.sys.chart.view.chart.ChartsSearch","JE.sys.chart.view.chart.ChartsOther","JE.sys.chart.view.chart.ChartsStyle","JE.sys.chart.view.chart.ChartsDSCfg4A","JE.sys.chart.view.chart.ChartsStyle4A","JE.sys.chart.view.chart.ChartsStyle4PR","JE.sys.chart.view.chart.ChartsStyle4EC","JE.sys.chart.view.chart.FontStyleField"]}),Ext.define("JE.sys.chart.controller.DataSourceCtr",{extend:"Ext.app.Controller",init:function(){var e;e={},this.control(e)},parseParams:function(e){var t=e.match(/\{.*?\}/g),i=[],n=[];return Ext.each(t,function(e){e=e.replace("{","").replace("}","");var t=Ext.isEmpty(e.match(/\@.*?\@/g))?i:n;-1==t.indexOf(e)&&t.push(e)}),{params:i,defvals:n}},views:["JE.sys.chart.view.datasource.MainView","JE.sys.chart.view.datasource.WestView","JE.sys.chart.view.datasource.FuncView","JE.sys.chart.view.datasource.TableView","JE.sys.chart.view.datasource.ColumnView","JE.sys.chart.view.datasource.OutColumnsView","JE.sys.chart.view.datasource.CascadeView","JE.sys.chart.view.datasource.ParamsView","JE.sys.chart.view.datasource.SqlView","JE.sys.chart.view.datasource.SqlGridView","JE.sys.chart.view.datasource.IDITDataView","JE.sys.chart.view.datasource.DataSourceView","JE.sys.chart.view.datasource.OtherView","JE.sys.chart.view.datasource.ActionView","JE.sys.chart.view.datasource.ProcView"]}),Ext.define("JE.sys.chart.controller.ReportController",{extend:"Ext.app.Controller",init:function(){var e={"form[xtype=report.reportbasic] cbbfield[name=printPageSize]":{change:function(e,t,i){e.mainview||(e.mainview=e.up("panel[xtype=report.reportmainview]")),e.mainview.changePageSize(t)}},"treepanel[xtype=report.reportds]":{itemdblclick:function(e,t){if("dsfield"==t.raw.type){var i=t.parentNode.raw.code+"."+t.get("text"),n=t.get("text"),a=JE.uuid("_");e.panel.editor.setHtml('<input type="button" reportBtn value="'+n+'" style="height: 20px;padding: 0px;margin: 0px;" data-code="'+a+'" data-text="'+n+'" data-formula="'+i+'" data-to="" />',"insert")}}},"form[xtype=report.reportbasic] button[ref=preview]":{click:function(e){var t=e.up("panel[xtype=report.reportmainview]").getReportData();JE.win({title:t.REPORT_TEXT,autoShow:!0,border:0,items:{xtype:"jereportview",reportBean:t}})}},"form[xtype=report.reportbasic] button[ref=saveBtn]":{click:function(e){var t=e.up("panel[xtype=report.reportmainview]");if(t.getCmp("center").getCmp("reportbasic").isValid()){var i=t.getReportData(),n=JE.ajax({url:JE.getUrlMaps("je.core.sys.chart","doUpdate"),params:i});if(n.success){JE.msg("保存成功！");var a=t.up("panel[xtype=chart.mainview]").down("treepanel[xtype=report.reporttree]").getSelectionModel().getSelection()[0];a&&(Ext.apply(a.raw.bean,i),a.set("text",i.REPORT_TEXT),a.commit())}else JE.error(n.obj,n)}}},"form[xtype=report.reportbasic] button[itemId=editEvent]":{click:function(e){var t=e.up("form").form.findField("REPORT_RENDERER"),i="function(value,metaData,objDS,objDSIndex){\n\t return value;\n}",n=Ext.value(t.getValue(),i);JE.win({title:"格式化数据(Ctrl+S保存)",width:800,height:600,border:0,items:{xtype:"jecodeeditor",itemId:"editorview",value:n,saveFn:function(e){t.setValue(i==e?"":e),JE.msg("保存成功...")},border:0}}).show()}},"panel[xtype=report.reportmainview] ueditor[itemId=editor]":{editorready:function(e){var t=e.ownerCt.ownerCt;t.editor=e;var a=new baidu.editor.ui.Popup({editor:e.editor,content:"",className:"edui-bubble",_edittext:function(){var e=t.getFieldAttr();JE.formWin({title:"统计格属性",width:400,height:340,useButton:!0,defaults:{labelWidth:80,columnWidth:1},items:e,showFn:function(e){e.getCmp("form").form.getFields().each(function(e){var t=Ext.value(a.anchorEl.getAttribute("data-"+e.name),"");e.setValue(t)})},fn:function(e,t){e.editable=Ext.value(e.editable,"0"),Ext.iterate(e,function(e,t){a.anchorEl.setAttribute("data-"+e,t)});var i=e.text;"H"==e.to?i+="→":"V"==e.to&&(i+="↓"),a.anchorEl.setAttribute("value",i),a.hide()}})},_delete:function(){baidu.editor.dom.domUtils.remove(this.anchorEl,!1),this.hide()}});a.render(),e.editor.addListener("mouseover",function(e,t){var i=(t=t||window.event).target||t.srcElement;if("button"==i.getAttribute("type")){var n=a.formatHtml('<nobr><span onclick=$$._edittext() class="edui-clickable">编辑</span>&nbsp;&nbsp;<span onclick=$$._delete() class="edui-clickable">删除</span></nobr>');n?(a.getDom("content").innerHTML=n,a.anchorEl=i,a.showAnchor(a.anchorEl)):a.hide()}})}},"treepanel[xtype=report.reporttree]":{containercontextmenu:function(e,t,i){t.stopEvent();var n=e.panel;n.getSelectionModel().deselectAll(),n.contextMenu.getCmp("folder").setDisabled(!1),n.contextMenu.getCmp("report").setDisabled(!1),n.contextMenu.getCmp("editReport").setDisabled(!1),n.contextMenu.getCmp("remove").setDisabled(!0),n.contextMenu.showAt(t.getXY())},itemcontextmenu:function(e,t,i,n,a,l){a.stopEvent();var o=e.panel,d=t.isLeaf();o.contextMenu.getCmp("folder").setDisabled(d),o.contextMenu.getCmp("report").setDisabled(d),o.contextMenu.getCmp("editReport").setDisabled(d),o.contextMenu.getCmp("remove").setDisabled(!1),o.contextMenu.showAt(a.getXY())},selectionchange:function(e,t){var i=t[0],n=!i||"1"==i.get("disabled"),a=e.view.panel.ownerCt.ownerCt.getCmp("centerview"),l=a.getCmp("reportmainview");if(a.getLayout().setActiveItem(n?"charthelp":"reportmainview"),!n){var o=JE.ajax({url:JE.getUrlMaps("je.core.getInfoById"),params:{tableCode:"JE_CORE_REPORT",pkValue:i.get("id")}});l.setReportData(o)}},itemdblclick:function(e,t){e.panel.updateNode("doUpdate","1"==t.get("disabled")?"folder":"report")}},"form[xtype=report.fieldform] cbbfield[name=xtype]":{change:function(e,t){var i=e.up("[xtype=report.fieldform]");i.getComponent("helpMsg").update({text:JE.helpMsg.configinfo[t]}),i.getComponent("otherHelpMsg").update({text:JE.helpMsg.otherconfig[t]})}},"form[xtype=report.fieldform] textarea[name=configInfo]":{afterrender:function(t){t.up("[xtype=report.fieldform]");t.labelEl&&t.labelEl.parent().appendChild({tag:"div",style:"cursor: pointer;color:green;margin:10px;text-align:right;",html:"选择字典"}).on("click",function(){JE.selectWin({title:"字典",configInfo:"JE_CORE_DICTIONARY",type:"grid",whereSql:" AND SY_JESYS='1'",callback:function(e){0<e.length&&t.setValue(e[0].get("DICTIONARY_DDCODE"))}})})}}};this.control(e),JE.initCtr("JE.sys.chart.controller.DataSourceCtr")},views:["JE.sys.chart.view.report.ReportTree","JE.sys.chart.view.report.MainView","JE.sys.chart.view.report.ReportBasic","JE.sys.chart.view.report.ReportDS","JE.sys.chart.view.report.ReportHelp","JE.sys.chart.view.report.FieldForm"]}),Ext.define("JE.sys.singleton.view.CSSEditorView",{extend:"JE.core.view.IDITEditor",alias:"widget.csseditorview",editorMode:"css"}),Ext.define("JE.sys.singleton.view.EditorView",{extend:"JE.core.view.IDITEditor",alias:"widget.classeditorview"}),Ext.define("JE.sys.singleton.controller.ClassController",{extend:"Ext.app.Controller",init:function(){this.control({})},views:["JE.sys.singleton.view.EditorView"]}),Ext.define("JE.sys.singleton.controller.CssMainController",{extend:"Ext.app.Controller",init:function(){this.control({})},views:["JE.sys.singleton.view.CSSEditorView"]}),Ext.define("JE.sys.svg.util.Util",{defaultColor:"#ffffff",imageFolder:"/static/images/industry/",defaultImage:"image.png",switchOnImage:"on.png",switchOffImage:"off.png",getDefaultValues:function(e){switch(e){case"light":return{defValue:"0",lightConfig:JE.encode([{value:"0",info:"#d9d9d9"},{value:"1",info:"#00ff00"},{value:"2",info:"#ff0000"}])};case"switch":return{defValue:"0",switchConfig:JE.encode([{value:"0",info:JE.getStatucUrl("JE.core.ux.mxgraph.cells.IndustryCells.off"),name:this.switchOffImage},{value:"1",info:JE.getStatucUrl("JE.core.ux.mxgraph.cells.IndustryCells.on"),name:this.switchOnImage}])};case"scale":return{scaleHV:"V",scaleConfig:JE.encode([{value:"0-20",info:"#ff0000"},{value:"20-60",info:"#ffff00"},{value:"60-100",info:"#00ff00"}])};case"custom":return{funcType:"DEFAULT"}}}}),Ext.define("JE.sys.svg.util.Editor",{extend:"JE.core.ux.mxgraph.util.Editor",mixins:["JE.sys.svg.util.Util"],thumbWidth:35,thumbHeight:35,thumbStyle:"margin:10px;text-align:center;",graphAttr:{},initEditor:function(){this.callParent(arguments);var e=this.editor.graph;e.errorAlert=!1,e.setMultigraph(!1),e.doPaste=function(e){Ext.each(e,function(e){e.setAttribute("name",e.getAttribute("type")+e.getId())})},e.isCellConnectable=function(e){return!1}},setArrowVisible:function(e){var t=this.editor.graph.getModel(),i=this.getAllCells(!1,!0);mxUtils.setCellStyles(t,i,"endArrow",e?"":"none")},loadData:function(e){this.callParent([e]),this.editor.graph.getSelectionModel().fireEvent(new mxEventObject(mxEvent.CHANGE));var t=this.editor.graph.getModel().getRoot().getAttribute("INDUSTRY_GROUPS");if(JE.isEmpty(t)){var i=this.ownerCt.ownerCt.getComponent("svg.attrs").getCmp("graphAttr");i.fireEvent("activate",i)}},cellDrop:function(i){var e=i.getAttribute("type"),t=i.value,n="";if("text"==t.nodeName&&(n=t.getAttribute("name"),t.removeAttribute("image")),t.setAttribute("label",n),i.setAttribute("name",e+i.getId()),!i.isEdge()){var a=i.geometry.clone();a.height=JE.toNum(i.getAttribute("defaultHeight")),a.width=JE.toNum(i.getAttribute("defaultWidth")),i.setGeometry(a),i.value.removeAttribute("defaultHeight"),i.value.removeAttribute("defaultWidth")}var l=i.getAttribute("defaultStyle");JE.isNotEmpty(l)&&i.setStyle(l),i.value.removeAttribute("defaultStyle"),this.editor.graph.refresh(i);var o=this.getDefaultValues(e);o&&Ext.iterate(o,function(e,t){i.setAttribute(e,t)})},endCellDrop:function(e){if("background"!=e.getAttribute("type")){var t=this.ownerCt.ownerCt.getComponent("svg.attrs").getLayout().getActiveItem().form.findField("defValue");t.fireEvent("change",t,t.getValue())}},initAction:function(){var e=this;e.callParent(arguments);e.editor;e.addAction("save",function(){e.saveAction(!1)}),e.addAction("saveDeploy",function(){e.saveAction(!0)})},initEvent:function(){var d=this,r=d.editor;r.graph.getSelectionModel().addListener(mxEvent.CHANGE,function(e,t){var i=r.graph.getSelectionCell(),n=d.ownerCt.ownerCt.getComponent("svg.attrs"),a="graphAttr";if(i&&!Ext.isEmpty(i.getAttribute("type"))){var l=i.getAttribute("type");a="nodeAttr";"background"==l?a="bgAttr":"custom"==l&&(a="customAttr")}else i=r.graph.getModel().getRoot();attr=n.getComponent(a);var o={};Ext.iterate(attr.getValues(),function(e,t){o[e]=i.getAttribute(e)}),attr.form.setValues(o),n.getLayout().setActiveItem(attr)})},saveAction:function(e){var t=this.editor,i=t.graph.getModel(),n=this.getAllCells(!0,!0,null,!0),a={},l=[],o=!1;if(Ext.each(n,function(e){var t=e.getAttribute("name");if(JE.isEmpty(t))return!(o=!0);a[t]=a[t]||0,a[t]++,1<a[t]&&l.push(t),e.isEdge()&&mxUtils.setCellStyles(i,[e],"endArrow","none")}),o)JE.alert("有空名称的节点，请检查!");else if(0<l.length)JE.alert("有重复的名称（"+l.join(",")+"），请检查!");else{var d=new mxCodec(mxUtils.createXmlDocument()).encode(t.graph.getModel()),r=mxUtils.getPrettyXml(d);this.ownerCt.ownerCt.saveAction(r)}},getGroups:function(){this.editor;var e=this.getAllCells(!0,!0,null,!0),i=[];return Ext.each(e,function(e){var t=e.getAttribute("group");JE.isNotEmpty(t)&&-1==i.indexOf(t)&&i.push(t)}),i},setVisibleGroup:function(e,t){var i=this.editor.graph,n=(i.getModel(),this.getAllCells(!0,!0,null,!0)),a=[];Ext.each(n,function(e){e.getAttribute("group")==t&&a.push(e)}),i.setCellsVisible(a,e)},getDataField:function(){var e=this.record.get("INDUSTRY_SJBDPZ"),t={xtype:"textfield",fieldLabel:"数据",name:"code"};if(JE.isNotEmpty(e)){var i=e.split("--")[0];t=Ext.apply(t,{xtype:"gridssfield",editable:!0,configInfo:i})}return t},getTypeField:function(){var e,t=this.record.get("INDUSTRY_SJBDPZ");if(JE.isNotEmpty(t)){var i=t.split("--")[1];JE.isNotEmpty(i)&&(e={xtype:"cbbfield",fieldLabel:"分类",name:"dataType",configInfo:i})}return e}}),Ext.define("JE.sys.svg.view.Attrs",{extend:"Ext.panel.Panel",alias:"widget.svg.attrs",layout:"card",defaults:{border:0},initComponent:function(){this.defaults={border:0,editor:this.editor,autoScroll:!0},this.items=[{xtype:"svg.graphattr",itemId:"graphAttr"},{xtype:"svg.bgattr",itemId:"bgAttr"},{xtype:"svg.nodeattr",itemId:"nodeAttr"},{xtype:"svg.customattr",itemId:"customAttr"}],this.callParent(arguments)},afterRender:function(){this.callParent(arguments)}}),Ext.define("JE.sys.svg.view.Cells",{extend:"Ext.panel.Panel",alias:"widget.svg.cells",layout:"fit",defaults:{border:1,autoScroll:!0,layout:"fit"},initComponent:function(e){items=[{xtype:"svg.generalcells",border:0,itemId:"generalcells"}],this.items=items,this.callParent(arguments)},afterRender:function(){var t=this;t.callParent(arguments),t.items.each(function(e){e.initCells&&e.initCells(t.editor)})}}),Ext.define("JE.sys.svg.view.Graph",{extend:"JE.core.ux.mxgraph.Graph",alias:"widget.svg.graph",initComponent:function(){this.dockedItems=[{xtype:"toolbar",dock:"top",defaults:{scale:"medium"},itemId:"buttonBar",items:this.buildTbar()}],this.callParent(arguments)},buildTbar:function(e){var t=this,i=t.editor;e=Ext.value(e,24);if(!i)return[];var n=t.callParent(arguments);return(n=[{iconCls:"jeicon jeicon-save-storage",ref:"save",itemId:"saveBtn",hidden:1==t.readOnly,tooltip:"保存"},"-"].concat(n)).push("->",{text:"显示箭头",arrowVisible:!1,handler:function(e){e.arrowVisible=!e.arrowVisible,e.setText(e.arrowVisible?"隐藏箭头":"显示箭头"),t.editor.setArrowVisible(e.arrowVisible)}},{text:"基础配置",handler:function(){t.editor.editor.graph.clearSelection()}},{text:"预览",handler:function(){t.showAnimat()}}),Ext.each(n,function(e){Ext.isString(e)||!e.ref||e.handler||(e.handler=function(){i.doAction(e.ref)})}),n},afterRender:function(){this.callParent(arguments)},showAnimat:function(){var e=this.ownerCt.record.get("INDUSTRY_BM");JE.win({title:"预览",autoShow:!0,border:0,items:{xtype:"jeindustryview",itemId:"graph",industryCode:e,type:"display"}})}}),Ext.define("JE.sys.svg.view.MainView",{extend:"Ext.panel.Panel",alias:"widget.svg.mainview",layout:"border",border:0,bodyPadding:"2",initComponent:function(){this.editor=Ext.create("JE.sys.svg.util.Editor",{record:this.record}),this.defaults={editor:this.editor},this.items=[{xtype:"svg.graph",itemId:"svg.graph",region:"center"},{xtype:"mxgraph.industrycells",region:"west",title:"节点",collapsible:!0,split:!0,width:100,autoScroll:!0,bodyPadding:"5 12",listeners:{afterrender:function(e){e.initCells()}}},{xtype:"svg.attrs",itemId:"svg.attrs",region:"east",collapsible:!0,split:!0,title:"属性",width:200}],this.callParent(arguments)},loadRecord:function(e){var t=e.get("INDUSTRY_NR");JE.isNotEmpty(t)&&(t=JE.decodeURI(t),this.editor.loadData(t)),this.getCmp("svg.attrs").getCmp("graphAttr").form.setValues(e.data)},saveAction:function(e){this.getCmp("svg.attrs").getCmp("graphAttr");var t={INDUSTRY_NR:JE.encodeURI(e)};this.record.set(t);var i=this.grid.getDockedCmp("buttonBar");if(i){var n=i.down("button[ref=gridUpdateBtn]");n&&n.fireHandler()}}}),Ext.define("JE.sys.svg.view.attr.BGAttr",{extend:"Ext.form.Panel",alias:"widget.svg.bgattr",layout:"column",bodyPadding:"2 4",initComponent:function(){var o=this;o.defaults={labelWidth:60,labelAlign:"right",columnWidth:1,margin:2,listeners:{change:function(e,t,i){var n=o.editor.editor.graph,a=n.getSelectionCell();if(a){if(t=Ext.isBoolean(t)?t?"1":"0":t,a.setAttribute(e.name,t),"imageUrl"==e.name)n.setCellStyles("image",Ext.value(t,a.getAttribute("image")),[a]);else if("top"==e.name&&"1"==t){var l=a.geometry.clone();l.x=0,l.y=0,a.setGeometry(l),n.refresh(a),n.setSelectionCell(a)}}else alert("请选择背景节点！")}}},o.items=[{xtype:"uxtrigger",fieldLabel:"背景",name:"imageName",trigger2Cls:"x-form-file-trigger",hideTrigger1:!0,handler:function(i){JE.uploadFile({params:{funcCode:"JE_CORE_SVG",jeFileType:"PROJECT",beanTableCode:"JE_CORE_SVG",returnType:"all"},fileTypes:"jpg;png;gif",callback:function(e){var t=e.privateUrl||JE.getFileUrl(e.url,"PUBLIC","","","JE_CORE_SVG");i.setValue(e.name),i.nextSibling().setValue(t)}})}},{xtype:"hidden",name:"imageUrl"},{xtype:"yesnofield",fieldLabel:"背景锁定",name:"moveDisable"},{xtype:"yesnofield",fieldLabel:"背景置顶",name:"top"}],o.callParent(arguments)}}),Ext.define("JE.sys.svg.view.attr.CustomAttr",{extend:"Ext.form.Panel",alias:"widget.svg.customattr",layout:"column",bodyPadding:"2 4",initComponent:function(){var o=this,e={labelWidth:48,labelAlign:"right",columnWidth:1,margin:"1",listeners:{change:function(t,i,e){var n=o.editor.editor.graph,a=n.getSelectionCells();Ext.each(a,function(e){"label"==t.name?n.cellLabelChanged(e,i):(t.styleField&&n.setCellStyles(Ext.value(t.styleName,t.name),i,[e]),e.setAttribute(t.name,Ext.value(i,"")),"code"==t.name&&e.setAttribute("group",Ext.value(i,"")))})}}};o.defaults=Ext.clone(e),o.items=[{xtype:"hidden",fieldLabel:"类型",name:"type"},{xtype:"textfield",fieldLabel:"名称",name:"name"},{xtype:"textarea",height:50,fieldLabel:"文本",name:"label"},{xtype:"textfield",fieldLabel:"默认值",name:"defValue"},{xtype:"cbbfield",fieldLabel:"类型",name:"funcType",value:"DEFAULT",margin:"5 1 1 1",dataArray:[{code:"DEFAULT",text:"普通"},{code:"APP",text:"插件"},{code:"HTML",text:"HTML模板"},{code:"CHART",text:"图表"},{code:"REPORT",text:"报表"}],listeners:{change:function(i,n,e){var a=o.editor.editor.graph,t=a.getSelectionCells(),l=Ext.value(n,"DEFAULT");Ext.each(t,function(e){e.setAttribute(i.name,l);var t=JE.getStaticUrl("JE.core.ux.mxgraph.cells.IndustryCells."+n);"DEFAULT"==n&&(t=Ext.value(e.getAttribute("customUrl"),JE.getStaticUrl("JE.core.ux.mxgraph.cells.IndustryCells.自定义"))),a.setCellStyles("image",t,[e])}),o.getCmp("card").getLayout().setActiveItem(l)}}},{xtype:"panel",border:0,layout:"card",margin:"0",itemId:"card",defaults:{xtype:"panel",border:0,layout:"column",defaults:e},items:[{itemId:"DEFAULT",items:[{xtype:"uxtrigger",fieldLabel:"图标",name:"customImage",editable:!1,trigger2Cls:"x-form-file-trigger",hideTrigger1:!0,handler:function(i){JE.uploadFile({params:{funcCode:"JE_CORE_SVG",jeFileType:"PROJECT",beanTableCode:"JE_CORE_SVG",returnType:"all"},fileTypes:"jpg;png;gif",callback:function(e){var t=e.privateUrl||JE.getFileUrl(e.url,"PUBLIC","","","JE_CORE_SVG");i.setValue(e.name),i.nextSibling().setValue(t)}})}},{xtype:"hidden",styleField:!0,styleName:"image",name:"customUrl"},{xtype:"hidden",fieldLabel:"单击事件",name:"clickFn"},{xtype:"fieldcontainer",fieldLabel:"单击",margin:"1 1 5 1",items:{xtype:"button",iconCls:"jeicon jeicon-lightning-off",itemId:"clickBtn",text:"编辑事件",handler:function(){var t="function(cell,graph){\n\n}",i=o.form.findField("clickFn"),e=i.getValue();e=Ext.value(e,t),JE.win({title:"单击事件(Ctrl+S保存)",autoShow:!0,items:{xtype:"jecodeeditor",value:e,saveFn:function(e){e==t&&(e=""),i.setValue(e),JE.msg("保存成功...")}}})}}}]},{itemId:"APP",items:[{xtype:"textfield",fieldLabel:"主面板",name:"customMainView"},{xtype:"textarea",fieldLabel:"控制器",name:"customMainCtr"}]},{itemId:"CHART",items:[{xtype:"treessfield",fieldLabel:"图表",configInfo:"JE_CORE_CHARTS,customChartCode~customChart,code~text,S",name:"customChart"},{xtype:"textfield",fieldLabel:"编码",readOnly:!0,name:"customChartCode"}]},{itemId:"REPORT",items:[{xtype:"treessfield",fieldLabel:"报表",configInfo:"JE_CORE_REPORT,customReportCode~customReport,code~text,S",name:"customReport"},{xtype:"textfield",fieldLabel:"编码",readOnly:!0,name:"customReportCode"}]},{itemId:"HTML",items:[{xtype:"textarea",fieldLabel:"HTML",height:300,name:"customHtml"}]}]},{xtype:"box",html:"数据绑定",margin:"5 0",style:"background-color:rgb(243, 209, 149);font-weight: bold;padding:5px 10px;"},o.editor.getDataField(),{xtype:"textarea",height:50,fieldLabel:"说明",name:"text"}],o.callParent(arguments)}}),Ext.define("JE.sys.svg.view.attr.GraphAttr",{extend:"Ext.form.Panel",alias:"widget.svg.graphattr",layout:"anchor",bodyPadding:"2 4",initComponent:function(){var l=this;l.defaults={labelWidth:60,labelAlign:"right",columnWidth:1,margin:2,width:"100%",listeners:{change:function(e,t,i){if(-1!=["timerFn","time"].indexOf(e.name)){var n=l.editor.editor.graph.getModel().getRoot();if(null==n.value){var a=mxUtils.createXmlDocument().createElement("root");n.setValue(a)}"timerFn"==e.name&&l.down("button[itemId=loadBtn]").setIconCls(Ext.isEmpty(t)?"jeicon jeicon-lightning-off":"jeicon jeicon-lightning-on"),n.setAttribute(e.name,t)}}}},l.items=[{xtype:"displayfield",fieldLabel:"名称",name:"INDUSTRY_MC"},{xtype:"displayfield",fieldLabel:"编码",name:"INDUSTRY_BM"},{xtype:"hidden",fieldLabel:"加载方法",name:"timerFn"},{xtype:"fieldcontainer",fieldLabel:"加载方法",items:{xtype:"button",iconCls:"jeicon jeicon-lightning-off",itemId:"loadBtn",text:"编辑事件",handler:function(){var i="function(panel){\n\n}",n=l.form.findField("timerFn"),e=n.getValue();e=Ext.value(e,i),JE.win({title:"加载事件(Ctrl+S保存)",autoShow:!0,items:{xtype:"jecodeeditor",value:e,saveFn:function(e){e==i&&(e=""),n.setValue(e);var t=l.up("panel[xtype=svg.mainview]").getCmp("svg.graph").getDockedCmp("buttonBar").getCmp("saveBtn");t.handler(t)}}})}}},{xtype:"numberfield",fieldLabel:"定时执行",name:"time",unitTpl:"秒"}],l.callParent(arguments)}}),Ext.define("JE.sys.svg.view.attr.NodeAttr",{extend:"Ext.form.Panel",alias:"widget.svg.nodeattr",layout:"column",bodyPadding:"2 4",initComponent:function(){var o=this;o.defaults={labelWidth:48,labelAlign:"right",columnWidth:1,margin:"1",listeners:{change:function(n,a,e){var l=o.editor.editor.graph,t=l.getSelectionCells();Ext.each(t,function(t){if("label"==n.name)l.cellLabelChanged(t,a);else{if("defValue"==n.name){var i=o.getCmp("type").getValue(),e=o.getCmp(i+"Config");e&&-1!=["light","switch"].indexOf(i)&&Ext.each(e.getData(),function(e){e.value!=a||("switch"==i?l.setCellStyles("image",Ext.value(e.info,t.getAttribute("image")),[t]):l.setCellStyles("fillColor",e.info,[t]))})}else n.styleField?(a=Ext.isBoolean(a)?a?"1":"0":a,l.setCellStyles(Ext.value(n.styleName,n.name),a,[t])):"clickFn"==n.name&&o.down("button[itemId=clickBtn]").setIconCls(Ext.isEmpty(a)?"jeicon jeicon-lightning-off":"jeicon jeicon-lightning-on");t.setAttribute(n.name,Ext.value(a,"")),"code"==n.name&&t.setAttribute("group",Ext.value(a,""))}})}}},o.items=[{xtype:"hidden",fieldLabel:"类型",name:"type",itemId:"type",listeners:{change:function(t,i,e){Ext.each(["switch","light","scale","text"],function(e){t.ownerCt.getCmp(e+"Config").setVisible(e==i)}),t.ownerCt.getCmp("scaleHV").setVisible("scale"==i),t.ownerCt.getCmp("customImage").setVisible("custom"==i)}}},{xtype:"textfield",fieldLabel:"名称",name:"name"},{xtype:"textarea",height:50,fieldLabel:"文本",name:"label"},{xtype:"textfield",fieldLabel:"默认值",name:"defValue"},{xtype:"hidden",fieldLabel:"单击事件",name:"clickFn"},{xtype:"fieldcontainer",fieldLabel:"单击",margin:"1 1 5 1",items:{xtype:"button",iconCls:"jeicon jeicon-lightning-on",itemId:"clickBtn",text:"编辑事件",handler:function(){var t="function(cell,panel){\n\n}",e=o.form.findField("clickFn").getValue();e=Ext.value(e,t),JE.win({title:"单击事件(Ctrl+S保存)",autoShow:!0,items:{xtype:"jecodeeditor",value:e,saveFn:function(e){e==t&&(e=""),o.form.setValues({clickFn:e}),JE.msg("保存成功...")}}})}}},{xtype:"uxtrigger",fieldLabel:"图标",name:"customImage",itemId:"customImage",editable:!1,trigger2Cls:"x-form-file-trigger",hideTrigger1:!0,hidden:!0,handler:function(i){JE.uploadFile({params:{funcCode:"JE_CORE_SVG",jeFileType:"PROJECT",beanTableCode:"JE_CORE_SVG",returnType:"all"},fileTypes:"jpg;png;gif",callback:function(e){var t=e.privateUrl||JE.getFileUrl(e.url,"PUBLIC","","","JE_CORE_SVG");i.setValue(e.name),i.nextSibling().setValue(t)}})}},{xtype:"hidden",fieldLabel:"url",styleField:!0,styleName:"image",name:"customUrl"},{fieldLabel:"开关配置",hideLabel:!0,hidden:!0,name:"switchConfig",itemId:"switchConfig",actionColumnIndex:0,xtype:"jsonarrayfield",columns:[{dataIndex:"value",text:"值",width:60},{dataIndex:"name",text:"图片",flex:1,editor:{xtype:"uxtrigger",trigger2Cls:"x-form-file-trigger",hideTrigger1:!0,editable:!1,handler:function(i){JE.uploadFile({params:{funcCode:"JE_CORE_SVG",jeFileType:"PROJECT",beanTableCode:"JE_CORE_SVG",returnType:"all"},fileTypes:"jpg;png;gif",callback:function(e){var t=e.privateUrl||JE.getFileUrl(e.url,"PUBLIC","","","JE_CORE_SVG");i.setValue(e.name),i.ownerCt.grid.getSelectionModel().getSelection()[0].set("info",t)}})}}},{dataIndex:"info",hidden:!0,text:"图片url"}]},{fieldLabel:"指示灯配置",hideLabel:!0,hidden:!0,name:"lightConfig",itemId:"lightConfig",actionColumnIndex:0,xtype:"jsonarrayfield",columns:[{dataIndex:"value",text:"值",width:60},{dataIndex:"info",text:"颜色",renderer:o.colorRenderer,flex:1,editor:{xtype:"colorfield",editable:!0,hideTrigger1:!0}}]},{fieldLabel:"方向",hidden:!0,name:"scaleHV",itemId:"scaleHV",xtype:"cbbfield",dataArray:[{text:"纵向",code:"V"},{text:"横向",code:"H"}],value:"V"},{fieldLabel:"刻度配置",hideLabel:!0,hidden:!0,name:"scaleConfig",itemId:"scaleConfig",actionColumnIndex:0,xtype:"jsonarrayfield",columns:[{dataIndex:"value",text:"范围",width:60},{dataIndex:"info",text:"颜色",renderer:o.colorRenderer,flex:1,editor:{xtype:"colorfield",editable:!0,hideTrigger1:!0}}]},{fieldLabel:"字体配置",hideLabel:!0,hidden:!0,name:"textConfig",itemId:"textConfig",actionColumnIndex:0,xtype:"jsonarrayfield",columns:[{dataIndex:"value",text:"范围/值",width:60},{dataIndex:"info",text:"颜色",flex:1,renderer:o.colorRenderer,editor:{xtype:"colorfield",editable:!0,hideTrigger1:!0}},{dataIndex:"bgColor",text:"背景色",flex:1,renderer:o.colorRenderer,editor:{xtype:"colorfield",editable:!0,hideTrigger1:!0}}]},{xtype:"box",html:"样式",style:"background-color:rgb(243, 209, 149);font-weight: bold;padding:5px 10px;"},{xtype:"yesnofield",fieldLabel:"虚线",name:"dashed",styleField:!0},{xtype:"numberfield",fieldLabel:"线宽",name:"strokeWidth",styleField:!0,minValue:1},{xtype:"colorfield",fieldLabel:"线色",name:"strokeColor",styleField:!0},{xtype:"colorfield",fieldLabel:"文字色",name:"fontColor",styleField:!0},{xtype:"colorfield",fieldLabel:"背景色",name:"fillColor",styleField:!0},{xtype:"box",html:"数据绑定",margin:"5 0",style:"background-color:rgb(243, 209, 149);font-weight: bold;padding:5px 10px;"},o.editor.getDataField(),{xtype:"textarea",height:50,fieldLabel:"说明",name:"text"}];var e=o.editor.getTypeField();e&&o.items.push(e),o.callParent(arguments)},colorRenderer:function(e,t){return Ext.isEmpty(e)||(t.tdAttr+=' style="background-color:'+e+';" '),e}}),Ext.define("JE.sys.svg.view.cells.GeneralCells",{extend:"Ext.panel.Panel",alias:"widget.svg.generalcells",initComponent:function(){this.callParent(arguments)},initCells:function(e){var n=this;if(n.editor=Ext.value(e,n.editor),n.editor){var a=n.editor.imageFolder,l=a+n.editor.defaultImage,t=[{node:"background",value:"背景",style:"image;image="+l,width:500,height:500},{node:"switch",value:"开关",style:"image;image="+l,width:40,height:40},{node:"scale",value:"刻度",style:"verticalLabelPosition=bottom;verticalAlign=top",width:10,height:100},{node:"light",value:"指示灯",style:"ellipse",width:40,height:40},{node:"light",value:"指示灯2",style:"rounded=0;whiteSpace=wrap;",width:40,height:40},{node:"text",value:"文字",style:"text"},{node:"text",value:"文本域",style:"rounded=0;whiteSpace=wrap;",width:120,height:60},{node:"path",value:"直线",style:"edgeStyle=none;",width:100,height:100,type:"edge"},{node:"path",value:"折线",style:"edgeStyle=segmentEdgeStyle",width:100,height:100,type:"edge"},{node:"custom",value:"自定义",style:"image;image="+a+"/自定义.png",width:40,height:40}],o=mxUtils.createXmlDocument();Ext.each(t,function(e){var t,i=o.createElement(Ext.value(e.node,"node"));i.setAttribute("name",Ext.value(e.value,"")),i.setAttribute("type",Ext.value(e.node,"")),t="edge"==e.type?n.editor.createEdgeTemplate(e.style,e.width,e.height,i):(i.setAttribute("image",l),JE.isNotEmpty(e.style)&&i.setAttribute("defaultStyle",e.style),i.setAttribute("defaultWidth",e.width),i.setAttribute("defaultHeight",e.height),n.editor.createVertexTemplate("image;image="+a+e.value+".png",35,35,i)),n.body.appendChild(t)})}}}),Ext.define("JE.sys.svg.controller.MainController",{extend:"Ext.app.Controller",init:function(){this.control({})},views:["JE.sys.svg.view.MainView","JE.sys.svg.view.Graph","JE.sys.svg.view.Cells","JE.sys.svg.view.cells.GeneralCells","JE.sys.svg.view.Attrs","JE.sys.svg.view.attr.BGAttr","JE.sys.svg.view.attr.NodeAttr","JE.sys.svg.view.attr.GraphAttr","JE.sys.svg.view.attr.CustomAttr"]});
//# sourceMappingURL=maps/je-tool-min.js.map
