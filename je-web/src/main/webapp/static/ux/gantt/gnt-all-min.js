Ext.define("Sch.locale.Locale",{l10n:null,legacyMode:true,localeName:null,namespaceId:null,constructor:function(){if(!Sch.locale.Active){Sch.locale.Active={};this.bindRequire()}var d=this.self.getName().split(".");var e=this.localeName=d.pop();this.namespaceId=d.join(".");var f=Sch.locale.Active[this.namespaceId];if(!(e=="En"&&f&&f.localeName!="En")){this.apply()}},bindRequire:function(){var b=Ext.ClassManager.triggerCreated;Ext.ClassManager.triggerCreated=function(e){b.apply(this,arguments);var f=Ext.ClassManager.get(e);for(var a in Sch.locale.Active){Sch.locale.Active[a].apply(f)}}},apply:function(r){if(this.l10n){var k=this,m,n;var l=this.self.getName();var o=function(b,c){c=c||Ext.ClassManager.get(b);if(c&&(c.activeLocaleId!==l)){var d=k.l10n[b];if(typeof d==="function"){d(b)}else{if(c.singleton){c.l10n=Ext.apply(c.l10n||{},d)}else{Ext.override(c,{l10n:d})}}if(k.legacyMode){var e;if(c.prototype){e=c.prototype}else{if(c.singleton){e=c}}if(e){if(e.legacyHolderProp){if(!e[e.legacyHolderProp]){e[e.legacyHolderProp]={}}e=e[e.legacyHolderProp]}for(var a in d){if(typeof e[a]!=="function"){e[a]=d[a]}}}}c.activeLocaleId=l;if(c.onLocalized){c.onLocalized()}}};if(r){if(!Ext.isArray(r)){r=[r]}var q,i;for(m=0,n=r.length;m<n;m++){if(Ext.isObject(r[m])){if(r[m].singleton){i=r[m];q=Ext.getClassName(Ext.getClass(i))}else{i=Ext.getClass(r[m]);q=Ext.getClassName(i)}}else{i=null;q="string"===typeof r[m]?r[m]:Ext.getClassName(r[m])}if(q&&q in this.l10n){o(q,i)}}}else{Sch.locale.Active[this.namespaceId]=this;for(var p in this.l10n){o(p)}}}}});Ext.define("Sch.locale.En",{extend:"Sch.locale.Locale",singleton:true,l10n:{"Sch.util.Date":{unitNames:{YEAR:{single:"year",plural:"years",abbrev:"yr"},QUARTER:{single:"quarter",plural:"quarters",abbrev:"q"},MONTH:{single:"month",plural:"months",abbrev:"mon"},WEEK:{single:"week",plural:"weeks",abbrev:"w"},DAY:{single:"day",plural:"days",abbrev:"d"},HOUR:{single:"hour",plural:"hours",abbrev:"h"},MINUTE:{single:"minute",plural:"minutes",abbrev:"min"},SECOND:{single:"second",plural:"seconds",abbrev:"s"},MILLI:{single:"ms",plural:"ms",abbrev:"ms"}}},"Sch.view.SchedulerGridView":{loadingText:"Loading events..."},"Sch.plugin.CurrentTimeLine":{tooltipText:"Current time"},"Sch.plugin.EventEditor":{saveText:"Save",deleteText:"Delete",cancelText:"Cancel"},"Sch.plugin.SimpleEditor":{newEventText:"New booking..."},"Sch.widget.ExportDialog":{generalError:"An error occured, try again.",title:"Export Settings",formatFieldLabel:"Paper format",orientationFieldLabel:"Orientation",rangeFieldLabel:"Export range",showHeaderLabel:"Add page number",orientationPortraitText:"Portrait",orientationLandscapeText:"Landscape",completeViewText:"Complete schedule",currentViewText:"Current view",dateRangeText:"Date range",dateRangeFromText:"Export from",pickerText:"Resize column/rows to desired value",dateRangeToText:"Export to",exportButtonText:"Export",cancelButtonText:"Cancel",progressBarText:"Exporting...",exportToSingleLabel:"Export as single page",adjustCols:"Adjust column width",adjustColsAndRows:"Adjust column width and row height",specifyDateRange:"Specify date range"},"Sch.preset.Manager":function(){var c=Sch.preset.Manager,d=c.getPreset("hourAndDay");if(d){d.displayDateFormat="G:i";d.headerConfig.middle.dateFormat="G:i";d.headerConfig.top.dateFormat="D d/m"}d=c.getPreset("secondAndMinute");if(d){d.displayDateFormat="g:i:s";d.headerConfig.top.dateFormat="D, d g:iA"}d=c.getPreset("dayAndWeek");if(d){d.displayDateFormat="m/d h:i A";d.headerConfig.middle.dateFormat="D d M"}d=c.getPreset("weekAndDay");if(d){d.displayDateFormat="m/d";d.headerConfig.bottom.dateFormat="d M";d.headerConfig.middle.dateFormat="Y F d"}d=c.getPreset("weekAndMonth");if(d){d.displayDateFormat="m/d/Y";d.headerConfig.middle.dateFormat="m/d";d.headerConfig.top.dateFormat="m/d/Y"}d=c.getPreset("weekAndDayLetter");if(d){d.displayDateFormat="m/d/Y";d.headerConfig.middle.dateFormat="D d M Y"}d=c.getPreset("weekDateAndMonth");if(d){d.displayDateFormat="m/d/Y";d.headerConfig.middle.dateFormat="d";d.headerConfig.top.dateFormat="Y F"}d=c.getPreset("monthAndYear");if(d){d.displayDateFormat="m/d/Y";d.headerConfig.middle.dateFormat="M Y";d.headerConfig.top.dateFormat="Y"}d=c.getPreset("year");if(d){d.displayDateFormat="m/d/Y";d.headerConfig.middle.dateFormat="Y"}d=c.getPreset("manyYears");if(d){d.displayDateFormat="m/d/Y";d.headerConfig.middle.dateFormat="Y"}}}});Ext.define("Sch.util.Patch",{target:null,minVersion:null,maxVersion:null,reportUrl:null,description:null,applyFn:null,ieOnly:false,overrides:null,onClassExtended:function(d,c){if(Sch.disableOverrides){return}if(c.ieOnly&&!Ext.isIE){return}if((!c.minVersion||Ext.versions.extjs.equals(c.minVersion)||Ext.versions.extjs.isGreaterThan(c.minVersion))&&(!c.maxVersion||Ext.versions.extjs.equals(c.maxVersion)||Ext.versions.extjs.isLessThan(c.maxVersion))){if(c.applyFn){c.applyFn()}else{Ext.ClassManager.get(c.target).override(c.overrides)}}}});Ext.define("Sch.patches.ColumnResize",{override:"Sch.panel.TimelineGridPanel",afterRender:function(){this.callParent(arguments);var b=this.lockedGrid.headerCt.findPlugin("gridheaderresizer");if(b){b.getConstrainRegion=function(){var e=this,a=e.dragHd.el,f;if(e.headerCt.forceFit){f=e.dragHd.nextNode("gridcolumn:not([hidden]):not([isGroupHeader])");if(!e.headerInSameGrid(f)){f=null}}return e.adjustConstrainRegion(Ext.util.Region.getRegion(a),0,e.headerCt.forceFit?(f?f.getWidth()-e.minColWidth:0):e.maxColWidth-a.getWidth(),0,e.minColWidth)}}}});Ext.define("Sch.patches.ColumnResizeTree",{override:"Sch.panel.TimelineTreePanel",afterRender:function(){this.callParent(arguments);var b=this.lockedGrid.headerCt.findPlugin("gridheaderresizer");if(b){b.getConstrainRegion=function(){var e=this,a=e.dragHd.el,f;if(e.headerCt.forceFit){f=e.dragHd.nextNode("gridcolumn:not([hidden]):not([isGroupHeader])");if(!e.headerInSameGrid(f)){f=null}}return e.adjustConstrainRegion(Ext.util.Region.getRegion(a),0,e.headerCt.forceFit?(f?f.getWidth()-e.minColWidth:0):e.maxColWidth-a.getWidth(),0,e.minColWidth)}}}});Ext.define("Sch.mixin.Localizable",{requires:["Sch.locale.En"],legacyMode:true,activeLocaleId:"",l10n:null,isLocaleApplied:function(){var c=(this.singleton&&this.activeLocaleId)||this.self.activeLocaleId;if(!c){return false}for(var d in Sch.locale.Active){if(c===Sch.locale.Active[d].self.getName()){return true}}return false},applyLocale:function(){for(var b in Sch.locale.Active){Sch.locale.Active[b].apply(this.singleton?this:this.self.getName())}},L:function(){return this.localize.apply(this,arguments)},localize:function(q,o,l){if(!this.isLocaleApplied()&&!l){this.applyLocale()}if(this.hasOwnProperty("l10n")&&this.l10n.hasOwnProperty(q)&&"function"!=typeof this.l10n[q]){return this.l10n[q]}var p=this.self&&this.self.prototype;if(this.legacyMode){var r=o||this.legacyHolderProp;var k=r?this[r]:this;if(k&&k.hasOwnProperty(q)&&"function"!=typeof k[q]){return k[q]}if(p){var n=r?p[r]:p;if(n&&n.hasOwnProperty(q)&&"function"!=typeof n[q]){return n[q]}}}var j=p.l10n[q];if(j===null||j===undefined){var m=p&&p.superclass;if(m&&m.localize){j=m.localize(q,o,l)}if(j===null||j===undefined){throw"Cannot find locale: "+q+" ["+this.self.getName()+"]"}}return j}});Ext.define("Sch.util.Date",{requires:"Ext.Date",mixins:["Sch.mixin.Localizable"],singleton:true,stripEscapeRe:/(\\.)/g,hourInfoRe:/([gGhHisucUOPZ]|MS)/,unitHash:null,unitsByName:{},constructor:function(){var e=Ext.Date;var f=this.unitHash={MILLI:e.MILLI,SECOND:e.SECOND,MINUTE:e.MINUTE,HOUR:e.HOUR,DAY:e.DAY,WEEK:"w",MONTH:e.MONTH,QUARTER:"q",YEAR:e.YEAR};Ext.apply(this,f);var d=this;this.units=[d.MILLI,d.SECOND,d.MINUTE,d.HOUR,d.DAY,d.WEEK,d.MONTH,d.QUARTER,d.YEAR]},onLocalized:function(){this.setUnitNames(this.L("unitNames"))},setUnitNames:function(i,g){var j=this.unitsByName={};this.l10n.unitNames=i;this._unitNames=Ext.apply({},i);var l=this.unitHash;for(var h in l){if(l.hasOwnProperty(h)){var k=l[h];this._unitNames[k]=this._unitNames[h];j[h]=k;j[k]=k}}},betweenLesser:function(e,g,f){var h=e.getTime();return g.getTime()<=h&&h<f.getTime()},constrain:function(d,f,e){return this.min(this.max(d,f),e)},compareUnits:function(h,e){var f=Ext.Array.indexOf(this.units,h),g=Ext.Array.indexOf(this.units,e);return f>g?1:(f<g?-1:0)},isUnitGreater:function(c,d){return this.compareUnits(c,d)>0},copyTimeValues:function(c,d){c.setHours(d.getHours());c.setMinutes(d.getMinutes());c.setSeconds(d.getSeconds());c.setMilliseconds(d.getMilliseconds())},add:function(d,j,i){var h=Ext.Date.clone(d);if(!j||i===0){return h}switch(j.toLowerCase()){case this.MILLI:h=new Date(d.getTime()+i);break;case this.SECOND:h=new Date(d.getTime()+(i*1000));break;case this.MINUTE:h=new Date(d.getTime()+(i*60000));break;case this.HOUR:h=new Date(d.getTime()+(i*3600000));break;case this.DAY:h.setDate(d.getDate()+i);break;case this.WEEK:h.setDate(d.getDate()+i*7);break;case this.MONTH:var g=d.getDate();if(g>28){g=Math.min(g,Ext.Date.getLastDateOfMonth(this.add(Ext.Date.getFirstDateOfMonth(d),this.MONTH,i)).getDate())}h.setDate(g);h.setMonth(h.getMonth()+i);break;case this.QUARTER:h=this.add(d,this.MONTH,i*3);break;case this.YEAR:h.setFullYear(d.getFullYear()+i);break}return h},getUnitDurationInMs:function(b){return this.add(new Date(1,0,1),b,1)-new Date(1,0,1)},getMeasuringUnit:function(b){if(b===this.WEEK){return this.DAY}return b},getDurationInUnit:function(h,g,j,i){var f;switch(j){case this.YEAR:f=this.getDurationInYears(h,g);break;case this.QUARTER:f=this.getDurationInMonths(h,g)/3;break;case this.MONTH:f=this.getDurationInMonths(h,g);break;case this.WEEK:f=this.getDurationInDays(h,g)/7;break;case this.DAY:f=this.getDurationInDays(h,g);break;case this.HOUR:f=this.getDurationInHours(h,g);break;case this.MINUTE:f=this.getDurationInMinutes(h,g);break;case this.SECOND:f=this.getDurationInSeconds(h,g);break;case this.MILLI:f=this.getDurationInMilliseconds(h,g);break}return i?f:Math.round(f)},getUnitToBaseUnitRatio:function(c,d){if(c===d){return 1}switch(c){case this.YEAR:switch(d){case this.QUARTER:return 1/4;case this.MONTH:return 1/12}break;case this.QUARTER:switch(d){case this.YEAR:return 4;case this.MONTH:return 1/3}break;case this.MONTH:switch(d){case this.YEAR:return 12;case this.QUARTER:return 3}break;case this.WEEK:switch(d){case this.DAY:return 1/7;case this.HOUR:return 1/168}break;case this.DAY:switch(d){case this.WEEK:return 7;case this.HOUR:return 1/24;case this.MINUTE:return 1/1440}break;case this.HOUR:switch(d){case this.DAY:return 24;case this.MINUTE:return 1/60}break;case this.MINUTE:switch(d){case this.HOUR:return 60;case this.SECOND:return 1/60;case this.MILLI:return 1/60000}break;case this.SECOND:switch(d){case this.MILLI:return 1/1000}break;case this.MILLI:switch(d){case this.SECOND:return 1000}break}return -1},getDurationInMilliseconds:function(c,d){return(d-c)},getDurationInSeconds:function(c,d){return(d-c)/1000},getDurationInMinutes:function(c,d){return(d-c)/60000},getDurationInHours:function(c,d){return(d-c)/3600000},getDurationInDays:function(f,d){var e=f.getTimezoneOffset()-d.getTimezoneOffset();return(d-f+e*60*1000)/86400000},getDurationInBusinessDays:function(i,d){var l=Math.round((d-i)/86400000),h=0,j;for(var k=0;k<l;k++){j=this.add(i,this.DAY,k).getDay();if(j!==6&&j!==0){h++}}return h},getDurationInMonths:function(c,d){return((d.getFullYear()-c.getFullYear())*12)+(d.getMonth()-c.getMonth())},getDurationInYears:function(c,d){return this.getDurationInMonths(c,d)/12},min:function(c,d){return c<d?c:d},max:function(c,d){return c>d?c:d},intersectSpans:function(h,g,e,f){return this.betweenLesser(h,e,f)||this.betweenLesser(e,h,g)},getNameOfUnit:function(b){b=this.getUnitByName(b);switch(b.toLowerCase()){case this.YEAR:return"YEAR";case this.QUARTER:return"QUARTER";case this.MONTH:return"MONTH";case this.WEEK:return"WEEK";case this.DAY:return"DAY";case this.HOUR:return"HOUR";case this.MINUTE:return"MINUTE";case this.SECOND:return"SECOND";case this.MILLI:return"MILLI"}throw"Incorrect UnitName"},getReadableNameOfUnit:function(c,d){if(!this.isLocaleApplied()){this.applyLocale()}return this._unitNames[c][d?"plural":"single"]},getShortNameOfUnit:function(b){if(!this.isLocaleApplied()){this.applyLocale()}return this._unitNames[b].abbrev},getUnitByName:function(b){if(!this.isLocaleApplied()){this.applyLocale()}if(!this.unitsByName[b]){Ext.Error.raise("Unknown unit name: "+b)}return this.unitsByName[b]},getNext:function(n,j,i,k){var l=Ext.Date.clone(n);k=arguments.length<4?1:k;i=i==null?1:i;switch(j){case this.MILLI:l=this.add(n,j,i);break;case this.SECOND:l=this.add(n,j,i);if(l.getMilliseconds()>0){l.setMilliseconds(0)}break;case this.MINUTE:l=this.add(n,j,i);if(l.getSeconds()>0){l.setSeconds(0)}if(l.getMilliseconds()>0){l.setMilliseconds(0)}break;case this.HOUR:l=this.add(n,j,i);if(l.getMinutes()>0){l.setMinutes(0)}if(l.getSeconds()>0){l.setSeconds(0)}if(l.getMilliseconds()>0){l.setMilliseconds(0)}break;case this.DAY:var m=n.getHours()===23&&this.add(l,this.HOUR,1).getHours()===1;if(m){l=this.add(l,this.DAY,2);Ext.Date.clearTime(l);return l}Ext.Date.clearTime(l);l=this.add(l,this.DAY,i);break;case this.WEEK:Ext.Date.clearTime(l);var h=l.getDay();l=this.add(l,this.DAY,k-h+7*(i-(k<=h?0:1)));if(l.getDay()!==k){l=this.add(l,this.HOUR,1)}else{Ext.Date.clearTime(l)}break;case this.MONTH:l=this.add(l,this.MONTH,i);l.setDate(1);Ext.Date.clearTime(l);break;case this.QUARTER:l=this.add(l,this.MONTH,((i-1)*3)+(3-(l.getMonth()%3)));Ext.Date.clearTime(l);l.setDate(1);break;case this.YEAR:l=new Date(l.getFullYear()+i,0,1);break;default:throw"Invalid date unit"}return l},getNumberOfMsFromTheStartOfDay:function(b){return b-Ext.Date.clearTime(b,true)||86400000},getNumberOfMsTillTheEndOfDay:function(b){return this.getStartOfNextDay(b,true)-b},getStartOfNextDay:function(g,i,j){var k=this.add(j?g:Ext.Date.clearTime(g,i),this.DAY,1);if(k.getDate()==g.getDate()){var l=this.add(Ext.Date.clearTime(g,i),this.DAY,2).getTimezoneOffset();var h=g.getTimezoneOffset();k=this.add(k,this.MINUTE,h-l)}return k},getEndOfPreviousDay:function(d,f){var e=f?d:Ext.Date.clearTime(d,true);if(e-d){return e}else{return this.add(e,this.DAY,-1)}},timeSpanContains:function(h,e,g,f){return(g-h)>=0&&(e-f)>=0}});Ext.define("Sch.util.DragTracker",{extend:"Ext.dd.DragTracker",xStep:1,yStep:1,constructor:function(){this.callParent(arguments);this.on("dragstart",function(){var b=this.el;b.on("scroll",this.onMouseMove,this);this.on("dragend",function(){b.un("scroll",this.onMouseMove,this)},this,{single:true})})},setXStep:function(b){this.xStep=b},startScroll:null,setYStep:function(b){this.yStep=b},getRegion:function(){var q=this.startXY,u=this.el.getScroll(),o=this.getXY(),x=o[0],y=o[1],s=u.left-this.startScroll.left,n=u.top-this.startScroll.top,r=q[0]-s,t=q[1]-n,v=Math.min(r,x),w=Math.min(t,y),z=Math.abs(r-x),p=Math.abs(t-y);return new Ext.util.Region(w,v+z,w+p,v)},onMouseDown:function(c,d){this.callParent(arguments);this.lastXY=this.startXY;this.startScroll=this.el.getScroll()},onMouseMove:function(k,l){if(this.active&&k.type==="mousemove"&&Ext.isIE9m&&!k.browserEvent.button){k.preventDefault();this.onMouseUp(k);return}k.preventDefault();var m=k.type==="scroll"?this.lastXY:k.getXY(),e=this.startXY;if(!this.active){if(Math.max(Math.abs(e[0]-m[0]),Math.abs(e[1]-m[1]))>this.tolerance){this.triggerStart(k)}else{return}}var i=m[0],j=m[1];if(this.xStep>1){i-=this.startXY[0];i=Math.round(i/this.xStep)*this.xStep;i+=this.startXY[0]}if(this.yStep>1){j-=this.startXY[1];j=Math.round(j/this.yStep)*this.yStep;j+=this.startXY[1]}var n=this.xStep>1||this.yStep>1;if(!n||i!==m[0]||j!==m[1]){this.lastXY=[i,j];if(this.fireEvent("mousemove",this,k)===false){this.onMouseUp(k)}else{this.onDrag(k);this.fireEvent("drag",this,k)}}}});Ext.define("Sch.util.ScrollManager",{singleton:true,vthresh:25,hthresh:25,increment:100,frequency:500,animate:true,animDuration:200,activeEl:null,scrollElRegion:null,scrollProcess:{},pt:null,scrollWidth:null,scrollHeight:null,direction:"both",constructor:function(){this.doScroll=Ext.Function.bind(this.doScroll,this)},triggerRefresh:function(){if(this.activeEl){this.refreshElRegion();this.clearScrollInterval();this.onMouseMove()}},doScroll:function(){var h=this.scrollProcess,g=h.el,e=h.dir[0],f=this.increment;if(e==="r"){f=Math.min(f,this.scrollWidth-this.activeEl.dom.scrollLeft-this.activeEl.dom.clientWidth)}else{if(e==="d"){f=Math.min(f,this.scrollHeight-this.activeEl.dom.scrollTop-this.activeEl.dom.clientHeight)}}g.scroll(e,Math.max(f,0),{duration:this.animDuration,callback:this.triggerRefresh,scope:this})},clearScrollInterval:function(){var b=this.scrollProcess;if(b.id){clearTimeout(b.id)}b.id=0;b.el=null;b.dir=""},isScrollAllowed:function(b){switch(this.direction){case"both":return true;case"horizontal":return b==="right"||b==="left";case"vertical":return b==="up"||b==="down";default:throw"Invalid direction: "+this.direction}},startScrollInterval:function(c,d){if(!this.isScrollAllowed(d)){return}if(Ext.versions.extjs.isLessThan("4.2.2")){if(d[0]==="r"){d="left"}else{if(d[0]==="l"){d="right"}}}this.clearScrollInterval();this.scrollProcess.el=c;this.scrollProcess.dir=d;this.scrollProcess.id=setTimeout(this.doScroll,this.frequency)},onMouseMove:function(q){var e=q?q.getPoint():this.pt,l=e.x,n=e.y,p=this.scrollProcess,t,s=this.activeEl,m=this.scrollElRegion,r=s.dom,o=this;this.pt=e;if(m&&m.contains(e)&&s.isScrollable()){if(m.bottom-n<=o.vthresh&&(this.scrollHeight-r.scrollTop-r.clientHeight>0)){if(p.el!=s){this.startScrollInterval(s,"down")}return}else{if(m.right-l<=o.hthresh&&(this.scrollWidth-r.scrollLeft-r.clientWidth>0)){if(p.el!=s){this.startScrollInterval(s,"right")}return}else{if(n-m.top<=o.vthresh&&s.dom.scrollTop>0){if(p.el!=s){this.startScrollInterval(s,"up")}return}else{if(l-m.left<=o.hthresh&&s.dom.scrollLeft>0){if(p.el!=s){this.startScrollInterval(s,"left")}return}}}}}this.clearScrollInterval()},refreshElRegion:function(){this.scrollElRegion=this.activeEl.getRegion()},activate:function(d,c){this.direction=c||"both";this.activeEl=Ext.get(d);this.scrollWidth=this.activeEl.dom.scrollWidth;this.scrollHeight=this.activeEl.dom.scrollHeight;this.refreshElRegion();this.activeEl.on("mousemove",this.onMouseMove,this)},deactivate:function(){this.clearScrollInterval();this.activeEl.un("mousemove",this.onMouseMove,this);this.activeEl=this.scrollElRegion=this.scrollWidth=this.scrollHeight=null;this.direction="both"}});if(!Ext.ClassManager.get("Sch.model.Customizable")){Ext.define("Sch.model.Customizable",{extend:"Ext.data.Model",idProperty:null,customizableFields:null,previous:null,constructor:function(){var b=this.callParent(arguments);this.modified=this.modified||{};return b},onClassExtended:function(e,g,f){var h=f.onBeforeCreated;f.onBeforeCreated=function(a,i){h.apply(this,arguments);var d=a.prototype;var b=Ext.versions.extjs&&Ext.versions.extjs.isGreaterThanOrEqual("5.0");if(!d.customizableFields){return}d.customizableFields=(a.superclass.customizableFields||[]).concat(d.customizableFields);var r=d.customizableFields;var q={};Ext.Array.each(r,function(j){if(typeof j=="string"){j={name:j}}q[j.name]=j});var c=d.fields;if(Ext.isArray(c)){var t=new Ext.util.MixedCollection();for(var p=0;p<c.length;p++){t.add(c[p].name,c[p])}c=t}var s=[];c.each(function(j){if(j.isCustomizableField){s.push(j)}});c.removeAll(s);Ext.Object.each(q,function(m,j){j.isCustomizableField=true;var B=j.name||j.getName();var n=B==="Id"?"idProperty":B.charAt(0).toLowerCase()+B.substr(1)+"Field";var A=d[n];var o=A||B;var y;if(c.containsKey(o)){y=Ext.applyIf({name:B,isCustomizableField:true},c.getByKey(o));c.getByKey(o).isCustomizableField=true;if(b){y=Ext.create("data.field."+(y.type||"auto"),y)}else{y=new Ext.data.Field(y)}r.push(y)}else{y=Ext.applyIf({name:o,isCustomizableField:true},j);if(b){y=Ext.create("data.field."+(y.type||"auto"),y)}else{y=new Ext.data.Field(y)}c.add(o,y)}var k=Ext.String.capitalize(B);if(k!="Id"){var z="get"+k;var l="set"+k;if(!d[z]||d[z].__getterFor__&&d[z].__getterFor__!=o){d[z]=function(){return this.data[o]};d[z].__getterFor__=o}if(!d[l]||d[l].__setterFor__&&d[l].__setterFor__!=o){d[l]=function(u){return this.set(o,u)};d[l].__setterFor__=o}}});if(b){d.fields.splice(0,d.fields.length);d.fields.push.apply(d.fields,c.items)}}},set:function(g,e){var f;this.previous=this.previous||{};if(arguments.length>1){f=this.get(g);if(f!==e){this.previous[g]=f}}else{for(var h in g){f=this.get(h);if(f!==g[h]){this.previous[h]=f}}}this.callParent(arguments);if(!this.__editing){delete this.previous}},beginEdit:function(){this.__editing=true;this.callParent(arguments)},cancelEdit:function(){this.callParent(arguments);this.__editing=false;delete this.previous},endEdit:function(){this.callParent(arguments);this.__editing=false;delete this.previous},reject:function(){var d=this,e=d.modified,f;d.previous=d.previous||{};for(f in e){if(e.hasOwnProperty(f)){if(typeof e[f]!="function"){d.previous[f]=d.get(f)}}}d.callParent(arguments);delete d.previous}})}Ext.define("Sch.data.mixin.EventStore",{model:"Sch.model.Event",config:{model:"Sch.model.Event"},requires:["Sch.util.Date"],isEventStore:true,setResourceStore:function(b){if(this.resourceStore){this.resourceStore.un({beforesync:this.onResourceStoreBeforeSync,write:this.onResourceStoreWrite,scope:this})}this.resourceStore=b;if(b){b.on({beforesync:this.onResourceStoreBeforeSync,write:this.onResourceStoreWrite,scope:this})}},onResourceStoreBeforeSync:function(f,j){var g=f.create;if(g){for(var h,i=g.length-1;i>=0;i--){h=g[i];h._phantomId=h.internalId}}},onResourceStoreWrite:function(h,e){if(e.wasSuccessful()){var g=this,f=e.getRecords();Ext.each(f,function(a){if(a._phantomId&&!a.phantom){g.each(function(b){if(b.getResourceId()===a._phantomId){b.assign(a)}})}})}},isDateRangeAvailable:function(i,h,g,k){var l=true,j=Sch.util.Date;this.forEachScheduledEvent(function(b,c,a){if(j.intersectSpans(i,h,c,a)&&k===b.getResource()&&(!g||g!==b)){l=false;return false}});return l},getEventsInTimeSpan:function(g,e,f){if(f!==false){var h=Sch.util.Date;return this.queryBy(function(a){var b=a.getStartDate(),c=a.getEndDate();return b&&c&&h.intersectSpans(b,c,g,e)})}else{return this.queryBy(function(a){var b=a.getStartDate(),c=a.getEndDate();return b&&c&&(b-g>=0)&&(e-c>=0)})}},forEachScheduledEvent:function(c,d){this.each(function(a){var b=a.getStartDate(),f=a.getEndDate();if(b&&f){return c.call(d||this,a,b,f)}},this)},getTotalTimeSpan:function(){var e=new Date(9999,0,1),d=new Date(0),f=Sch.util.Date;this.each(function(a){if(a.getStartDate()){e=f.min(a.getStartDate(),e)}if(a.getEndDate()){d=f.max(a.getEndDate(),d)}});e=e<new Date(9999,0,1)?e:null;d=d>new Date(0)?d:null;return{start:e||null,end:d||e||null}},getEventsForResource:function(j){var l=[],k,i=j.getId()||j.internalId;for(var g=0,h=this.getCount();g<h;g++){k=this.getAt(g);if(k.data[k.resourceIdField]==i){l.push(k)}}return l},append:function(b){throw"Must be implemented by consuming class"},getModel:function(){return this.model}});Ext.define("Sch.model.Range",{extend:"Sch.model.Customizable",requires:["Sch.util.Date"],idProperty:"Id",config:Ext.versions.touch?{idProperty:"Id"}:null,startDateField:"StartDate",endDateField:"EndDate",nameField:"Name",clsField:"Cls",customizableFields:[{name:"StartDate",type:"date",dateFormat:"c"},{name:"EndDate",type:"date",dateFormat:"c"},{name:"Cls",type:"string"},{name:"Name",type:"string"}],setStartDate:function(f,g){var h=this.getEndDate();var e=this.getStartDate();this.set(this.startDateField,f);if(g===true&&h&&e){this.setEndDate(Sch.util.Date.add(f,Sch.util.Date.MILLI,h-e))}},setEndDate:function(e,g){var f=this.getStartDate();var h=this.getEndDate();this.set(this.endDateField,e);if(g===true&&f&&h){this.setStartDate(Sch.util.Date.add(e,Sch.util.Date.MILLI,-(h-f)))}},setStartEndDate:function(f,e){var d=!this.editing;d&&this.beginEdit();this.set(this.startDateField,f);this.set(this.endDateField,e);d&&this.endEdit()},getDates:function(){var f=[],d=this.getEndDate();for(var e=Ext.Date.clearTime(this.getStartDate(),true);e<d;e=Sch.util.Date.add(e,Sch.util.Date.DAY,1)){f.push(e)}return f},forEachDate:function(c,d){return Ext.each(this.getDates(),c,d)},isValid:function(){var d=this.callParent(arguments);if(d){var f=this.getStartDate(),e=this.getEndDate();d=!f||!e||(e-f>=0)}return d},shift:function(c,d){this.setStartEndDate(Sch.util.Date.add(this.getStartDate(),c,d),Sch.util.Date.add(this.getEndDate(),c,d))}});Ext.define("Sch.model.TimeAxisTick",{extend:"Sch.model.Range",startDateField:"start",endDateField:"end"});if(!Ext.ClassManager.get("Sch.model.Resource")){Ext.define("Sch.model.Resource",{extend:"Sch.model.Customizable",idProperty:"Id",config:Ext.versions.touch?{idProperty:"Id"}:null,nameField:"Name",customizableFields:["Id",{name:"Name",type:"string"}],getEventStore:function(){return this.stores[0]&&this.stores[0].eventStore||this.parentNode&&this.parentNode.getEventStore()},getEvents:function(k){var l=[],j,i=this.getId()||this.internalId;k=k||this.getEventStore();for(var g=0,h=k.getCount();g<h;g++){j=k.getAt(g);if(j.data[j.resourceIdField]===i){l.push(j)}}return l}})}Ext.define("Sch.data.mixin.ResourceStore",{getModel:function(){return this.model}});Ext.define("Sch.data.FilterableNodeStore",{extend:"Ext.data.NodeStore",onNodeExpand:function(i,j,f){var h=this.treeStore;var g=h.isTreeFiltered(true);if(g&&i==this.node){h.reApplyFilter()}else{return this.callParent(arguments)}},handleNodeExpand:function(k,q,i){var m=[];var r=this.treeStore;var p=r.isTreeFiltered();var l=r.currentFilterGeneration;for(var o=0;o<q.length;o++){var n=q[o];if(!(p&&n.__filterGen!=l||n.hidden)){m[m.length]=n}}return this.callParent([k,m,i])},onNodeCollapse:function(p,u,n,o,m){var q=this;var s=this.data;var l=s.contains;var v=this.treeStore;var t=v.isTreeFiltered();var r=v.currentFilterGeneration;s.contains=function(){var e,f,c;var a=q.indexOf(p)+1;var d=false;for(var b=0;b<u.length;b++){if(!(u[b].hidden||t&&u[b].__filterGen!=r)&&l.call(this,u[b])){e=p;while(e.parentNode){f=e;do{f=f.nextSibling}while(f&&(f.hidden||t&&f.__filterGen!=r));if(f){d=true;c=q.indexOf(f);break}else{e=e.parentNode}}if(!d){c=q.getCount()}q.removeAt(a,c-a);break}}return false};this.callParent(arguments);s.contains=l},onNodeAppend:function(k,q,o){var l=this,n,j;var r=this.treeStore;var p=r.isTreeFiltered();var m=r.currentFilterGeneration;if(p){q.__filterGen=m}if(l.isVisible(q)){if(o===0){n=k}else{j=q;do{j=j.previousSibling}while(j&&(j.hidden||p&&j.__filterGen!=m));if(!j){n=k}else{while(j.isExpanded()&&j.lastChild){j=j.lastChild}n=j}}l.insert(l.indexOf(n)+1,q);if(!q.isLeaf()&&q.isExpanded()){if(q.isLoaded()){l.onNodeExpand(q,q.childNodes,true)}else{if(!l.treeStore.fillCount){q.set("expanded",false);q.expand()}}}}}});Ext.define("Sch.data.mixin.FilterableTreeStore",{requires:["Sch.data.FilterableNodeStore"],nodeStoreClassName:"Sch.data.FilterableNodeStore",nodeStore:null,isFilteredFlag:false,isHiddenFlag:false,lastTreeFilter:null,lastTreeHiding:null,allowExpandCollapseWhileFiltered:true,reApplyFilterOnDataChange:true,suspendIncrementalFilterRefresh:0,filterGeneration:0,currentFilterGeneration:null,dataChangeListeners:null,monitoringDataChange:false,initTreeFiltering:function(){if(!this.nodeStore){this.nodeStore=this.createNodeStore(this)}this.dataChangeListeners={append:this.onNeedToUpdateFilter,insert:this.onNeedToUpdateFilter,scope:this}},startDataChangeMonitoring:function(){if(this.monitoringDataChange){return}this.monitoringDataChange=true;this.on(this.dataChangeListeners)},stopDataChangeMonitoring:function(){if(!this.monitoringDataChange){return}this.monitoringDataChange=false;this.un(this.dataChangeListeners)},onNeedToUpdateFilter:function(){if(this.reApplyFilterOnDataChange&&!this.suspendIncrementalFilterRefresh){this.reApplyFilter()}},createNodeStore:function(b){return Ext.create(this.nodeStoreClassName,{treeStore:b,recursive:true,rootVisible:this.rootVisible})},clearTreeFilter:function(){if(!this.isTreeFiltered()){return}this.currentFilterGeneration=null;this.isFilteredFlag=false;this.lastTreeFilter=null;if(!this.isTreeFiltered(true)){this.stopDataChangeMonitoring()}this.refreshNodeStoreContent();this.fireEvent("filter-clear",this)},reApplyFilter:function(){if(this.isHiddenFlag){this.hideNodesBy.apply(this,this.lastTreeHiding.concat(this.isFilteredFlag))}if(this.isFilteredFlag){this.filterTreeBy(this.lastTreeFilter)}},refreshNodeStoreContent:function(r){var l=this.getRootNode(),j=[];var k=this.rootVisible;var q=this.isTreeFiltered();var n=this;var m=this.currentFilterGeneration;var o=function(a){if(q&&a.__filterGen!=m||a.hidden){return}if(k||a!=l){j[j.length]=a}if(!a.data.leaf&&a.isExpanded()){var d=a.childNodes,b=d.length;for(var c=0;c<b;c++){o(d[c])}}};o(l);this.fireEvent("nodestore-datachange-start",this);var p=this.nodeStore;if(!this.loadDataInNodeStore||!this.loadDataInNodeStore(j)){p.loadRecords(j)}if(!r){p.fireEvent("clear",p)}this.fireEvent("nodestore-datachange-end",this)},getIndexInTotalDataset:function(o){var p=this.getRootNode(),m=-1;var l=this.rootVisible;if(!l&&o==p){return -1}var i=this.isTreeFiltered();var k=this;var j=this.currentFilterGeneration;var n=function(b){if(i&&b.__filterGen!=j||b.hidden){if(b==o){return false}}if(l||b!=p){m++}if(b==o){return false}if(!b.data.leaf&&b.isExpanded()){var a=b.childNodes,c=a.length;for(var d=0;d<c;d++){if(n(a[d])===false){return false}}}};n(p);return m},isTreeFiltered:function(b){return this.isFilteredFlag||b&&this.isHiddenFlag},collectFilteredNodes:function(C,i){var u=this.currentFilterGeneration;var y={};var z=this.getRootNode(),H=this.rootVisible,I=[];var L=function(a){var b=a.parentNode;while(b&&!y[b.internalId]){y[b.internalId]=true;b=b.parentNode}};var F=i.filter;var K=i.scope||this;var D=i.shallow;var v=i.checkParents||D;var E=i.fullMathchingParents;var J=i.onlyParents||E;if(J&&v){throw new Error("Can't combine `onlyParents` and `checkParents` options")}var A=function(b){if(b.hidden){return}var d,a,c,e;if(b.data.leaf){if(F.call(K,b,y)){I[I.length]=b;L(b)}}else{if(H||b!=z){I[I.length]=b}if(J){d=F.call(K,b);a=b.childNodes;c=a.length;if(d){y[b.internalId]=true;L(b);if(E){b.cascadeBy(function(f){if(f!=b){I[I.length]=f;if(!f.data.leaf){y[f.internalId]=true}}});return}}for(e=0;e<c;e++){if(d&&a[e].data.leaf){I[I.length]=a[e]}else{if(!a[e].data.leaf){A(a[e])}}}}else{if(v){d=F.call(K,b,y);if(d){y[b.internalId]=true;L(b)}}if(!v||!D||D&&(d||b==z&&!H)){a=b.childNodes;c=a.length;for(e=0;e<c;e++){A(a[e])}}}}};A(C);var G=[];for(var x=0,w=I.length;x<w;x++){var B=I[x];if(B.data.leaf||y[B.internalId]){G[G.length]=B;B.__filterGen=u;if(this.allowExpandCollapseWhileFiltered&&!B.data.leaf){B.data.expanded=true}}}return G},filterTreeBy:function(h,j){this.currentFilterGeneration=this.filterGeneration++;var f;if(arguments.length==1&&Ext.isObject(arguments[0])){j=h.scope;f=h.filter}else{f=h;h={filter:f,scope:j}}this.fireEvent("nodestore-datachange-start",this);h=h||{};var g=this.collectFilteredNodes(this.getRootNode(),h);var i=this.nodeStore;if(!this.loadDataInNodeStore||!this.loadDataInNodeStore(g)){i.loadRecords(g,false);i.fireEvent("clear",i)}this.startDataChangeMonitoring();this.isFilteredFlag=true;this.lastTreeFilter=h;this.fireEvent("nodestore-datachange-end",this);this.fireEvent("filter-set",this)},hideNodesBy:function(e,f,g){if(this.isFiltered()){throw new Error("Can't hide nodes of the filtered tree store")}var h=this;f=f||this;this.getRootNode().cascadeBy(function(a){a.hidden=e.call(f,a,h)});this.startDataChangeMonitoring();this.isHiddenFlag=true;this.lastTreeHiding=[e,f];if(!g){this.refreshNodeStoreContent()}},showAllNodes:function(b){this.getRootNode().cascadeBy(function(a){a.hidden=false});this.isHiddenFlag=false;this.lastTreeHiding=null;if(!this.isTreeFiltered(true)){this.stopDataChangeMonitoring()}if(!b){this.refreshNodeStoreContent()}},inheritables:function(){return{load:function(m){var p=this.getRootNode();if(p){var t=this.nodeStore;var w=p.removeAll;p.removeAll=function(){w.apply(this,arguments);t&&t.fireEvent("clear",t);delete p.removeAll}}var x=Ext.getVersion("extjs").isLessThan("4.2.2.1144");if(x){m=m||{};var s=false;var v;this.on("beforeload",function(b,a){v=a.node;s=v.data.expanded;v.data.expanded=false},this,{single:true});var o=m.callback;var n=m.scope;m.callback=function(){if(s){v.expand()}Ext.callback(o,n,arguments)}}var r=this;m=m||{};var u=m.callback;var q=m.scope;m.callback=function(){r.suspendIncrementalFilterRefresh--;Ext.callback(u,q,arguments)};this.suspendIncrementalFilterRefresh++;this.callParent([m]);if(p){delete p.removeAll}}}}});Ext.define("Sch.data.ResourceStore",{extend:"Ext.data.Store",model:"Sch.model.Resource",config:{model:"Sch.model.Resource"},mixins:["Sch.data.mixin.ResourceStore"],constructor:function(){this.callParent(arguments);if(this.getModel()!==Sch.model.Resource&&!(this.getModel().prototype instanceof Sch.model.Resource)){throw"The model for the ResourceStore must subclass Sch.model.Resource"}}});Ext.define("Sch.data.TimeAxis",{extend:"Ext.data.JsonStore",requires:["Sch.util.Date","Sch.model.TimeAxisTick"],model:"Sch.model.TimeAxisTick",continuous:true,originalContinuous:null,autoAdjust:true,unit:null,increment:null,resolutionUnit:null,resolutionIncrement:null,weekStartDay:null,mainUnit:null,shiftUnit:null,shiftIncrement:1,defaultSpan:1,isConfigured:false,adjustedStart:null,adjustedEnd:null,visibleTickStart:null,visibleTickEnd:null,constructor:function(d){var c=this;if(c.setModel){c.setModel(c.model)}c.originalContinuous=c.continuous;c.callParent(arguments);c.on(Ext.versions.touch?"refresh":"datachanged",function(f,b,a){c.fireEvent("reconfigure",c,b,a)});if(d&&c.start){c.reconfigure(d)}},reconfigure:function(v,z){this.isConfigured=true;Ext.apply(this,v);var n=this.getAdjustedDates(v.start,v.end,true);var o=this.getAdjustedDates(v.start,v.end);var y=o.start;var u=o.end;if(this.fireEvent("beforereconfigure",this,y,u)!==false){this.fireEvent("beginreconfigure",this);var q=this.unit;var p=this.increment||1;var r=this.generateTicks(y,u,q,p,this.mainUnit);var w=Ext.Object.getKeys(v).length;var t=(w===1&&"start" in v)||(w===2&&"start" in v&&"end" in v);this.removeAll(true);this.suspendEvents();this.add(r);if(this.getCount()===0){Ext.Error.raise("Invalid time axis configuration or filter, please check your input data.")}this.resumeEvents();var x=Sch.util.Date;var s=r.length;if(this.isContinuous()){this.adjustedStart=n.start;this.adjustedEnd=this.getNext(s>1?r[s-1].start:n.start,q,p)}else{this.adjustedStart=this.getStart();this.adjustedEnd=this.getEnd()}do{this.visibleTickStart=(this.getStart()-this.adjustedStart)/(x.getUnitDurationInMs(q)*p);if(this.visibleTickStart>=1){this.adjustedStart=x.getNext(this.adjustedStart,q,1)}}while(this.visibleTickStart>=1);do{this.visibleTickEnd=s-(this.adjustedEnd-this.getEnd())/(x.getUnitDurationInMs(q)*p);if(s-this.visibleTickEnd>=1){this.adjustedEnd=x.getNext(this.adjustedEnd,q,-1)}}while(s-this.visibleTickEnd>=1);this.fireEvent("datachanged",this,!t,z);this.fireEvent("refresh",this,!t,z);this.fireEvent("endreconfigure",this)}},setTimeSpan:function(f,e){var d=this.getAdjustedDates(f,e);f=d.start;e=d.end;if(this.getStart()-f!==0||this.getEnd()-e!==0){this.reconfigure({start:f,end:e})}},filterBy:function(c,d){this.continuous=false;d=d||this;this.clearFilter(true);this.suspendEvents(true);this.filter([{filterFn:function(a,b){return c.call(d,a.data,b)}}]);if(this.getCount()===0){this.clearFilter();this.resumeEvents();Ext.Error.raise("Invalid time axis filter - no ticks passed through the filter. Please check your filter method.")}this.resumeEvents()},isContinuous:function(){return this.continuous&&!this.isFiltered()},clearFilter:function(){this.continuous=this.originalContinuous;this.callParent(arguments)},generateTicks:function(t,q,n,l){var m=[],o,s=Sch.util.Date,p=0;n=n||this.unit;l=l||this.increment;var k=this.getAdjustedDates(t,q);t=k.start;q=k.end;while(t<q){o=this.getNext(t,n,l);if(!this.autoAdjust&&o>q){o=q}if(n===s.HOUR&&l>1&&m.length>0&&p===0){var r=m[m.length-1];p=((r.start.getHours()+l)%24)-r.end.getHours();if(p!==0){o=s.add(o,s.HOUR,p)}}m.push({start:t,end:o});t=o}return m},getVisibleTickTimeSpan:function(){return this.isContinuous()?this.visibleTickEnd-this.visibleTickStart:this.getCount()},getAdjustedDates:function(f,d,e){f=f||this.getStart();d=d||Sch.util.Date.add(f,this.mainUnit,this.defaultSpan);return this.autoAdjust||e?{start:this.floorDate(f,false,this.mainUnit,1),end:this.ceilDate(d,false,this.mainUnit,1)}:{start:f,end:d}},getTickFromDate:function(q){var l=this.data.items;var m=l.length-1;if(q<l[0].data.start||q>l[m].data.end){return -1}var o,n,s;if(this.isContinuous()){if(q-l[0].data.start===0){return this.visibleTickStart}if(q-l[m].data.end===0){return this.visibleTickEnd}var i=this.adjustedStart;var t=this.adjustedEnd;var r=Math.floor(l.length*(q-i)/(t-i));if(r>m){r=m}n=r===0?i:l[r].data.start;s=r==m?t:l[r].data.end;o=r+(q-n)/(s-n);if(o<this.visibleTickStart||o>this.visibleTickEnd){return -1}return o}else{for(var p=0;p<=m;p++){s=l[p].data.end;if(q<=s){n=l[p].data.start;o=p+(q>n?(q-n)/(s-n):0);return o}}}return -1},getDateFromTick:function(n,j){if(n===this.visibleTickEnd){return this.getEnd()}var q=Math.floor(n),l=n-q,k=this.getAt(q);if(!k){return null}var m=k.data;var r=q===0?this.adjustedStart:m.start;var o=(q==this.getCount()-1)&&this.isContinuous()?this.adjustedEnd:m.end;var p=Sch.util.Date.add(r,Sch.util.Date.MILLI,l*(o-r));if(j){p=this[j+"Date"](p)}return p},getTicks:function(){var b=[];this.each(function(a){b.push(a.data)});return b},getStart:function(){var b=this.first();if(b){return new Date(b.data.start)}return null},getEnd:function(){var b=this.last();if(b){return new Date(b.data.end)}return null},floorDate:function(t,r,q,x){r=r!==false;var v=Ext.Date.clone(t),u=r?this.getStart():null,m=x||this.resolutionIncrement,n;if(q){n=q}else{n=r?this.resolutionUnit:this.mainUnit}var w=Sch.util.Date;var s=function(b,a){return Math.floor(b/a)*a};switch(n){case w.MILLI:if(r){v=w.add(u,w.MILLI,s(w.getDurationInMilliseconds(u,v),m))}break;case w.SECOND:if(r){v=w.add(u,w.MILLI,s(w.getDurationInSeconds(u,v),m)*1000)}else{v.setMilliseconds(0);v.setSeconds(s(v.getSeconds(),m))}break;case w.MINUTE:if(r){v=w.add(u,w.SECOND,s(w.getDurationInMinutes(u,v),m)*60)}else{v.setMinutes(s(v.getMinutes(),m));v.setSeconds(0);v.setMilliseconds(0)}break;case w.HOUR:if(r){v=w.add(u,w.MINUTE,s(w.getDurationInHours(this.getStart(),v),m)*60)}else{v.setMinutes(0);v.setSeconds(0);v.setMilliseconds(0);v.setHours(s(v.getHours(),m))}break;case w.DAY:if(r){v=w.add(u,w.DAY,s(w.getDurationInDays(u,v),m))}else{Ext.Date.clearTime(v);v.setDate(s(v.getDate()-1,m)+1)}break;case w.WEEK:var o=v.getDay()||7;var p=this.weekStartDay||7;Ext.Date.clearTime(v);v=w.add(v,w.DAY,o>=p?p-o:-(7-p+o));break;case w.MONTH:if(r){v=w.add(u,w.MONTH,s(w.getDurationInMonths(u,v),m))}else{Ext.Date.clearTime(v);v.setDate(1);v.setMonth(s(v.getMonth(),m))}break;case w.QUARTER:Ext.Date.clearTime(v);v.setDate(1);v=w.add(v,w.MONTH,-(v.getMonth()%3));break;case w.YEAR:if(r){v=w.add(u,w.YEAR,s(w.getDurationInYears(u,v),m))}else{v=new Date(s(t.getFullYear()-1,m)+1,0,1)}break}return v},roundDate:function(w,M){var C=Ext.Date.clone(w),v=this.resolutionIncrement;M=M||this.getStart();switch(this.resolutionUnit){case Sch.util.Date.MILLI:var J=Sch.util.Date.getDurationInMilliseconds(M,C),K=Math.round(J/v)*v;C=Sch.util.Date.add(M,Sch.util.Date.MILLI,K);break;case Sch.util.Date.SECOND:var F=Sch.util.Date.getDurationInSeconds(M,C),x=Math.round(F/v)*v;C=Sch.util.Date.add(M,Sch.util.Date.MILLI,x*1000);break;case Sch.util.Date.MINUTE:var A=Sch.util.Date.getDurationInMinutes(M,C),N=Math.round(A/v)*v;C=Sch.util.Date.add(M,Sch.util.Date.SECOND,N*60);break;case Sch.util.Date.HOUR:var B=Sch.util.Date.getDurationInHours(M,C),E=Math.round(B/v)*v;C=Sch.util.Date.add(M,Sch.util.Date.MINUTE,E*60);break;case Sch.util.Date.DAY:var L=Sch.util.Date.getDurationInDays(M,C),I=Math.round(L/v)*v;C=Sch.util.Date.add(M,Sch.util.Date.DAY,I);break;case Sch.util.Date.WEEK:Ext.Date.clearTime(C);var z=C.getDay()-this.weekStartDay,u;if(z<0){z=7+z}if(Math.round(z/7)===1){u=7-z}else{u=-z}C=Sch.util.Date.add(C,Sch.util.Date.DAY,u);break;case Sch.util.Date.MONTH:var y=Sch.util.Date.getDurationInMonths(M,C)+(C.getDate()/Ext.Date.getDaysInMonth(C)),G=Math.round(y/v)*v;C=Sch.util.Date.add(M,Sch.util.Date.MONTH,G);break;case Sch.util.Date.QUARTER:Ext.Date.clearTime(C);C.setDate(1);C=Sch.util.Date.add(C,Sch.util.Date.MONTH,3-(C.getMonth()%3));break;case Sch.util.Date.YEAR:var D=Sch.util.Date.getDurationInYears(M,C),H=Math.round(D/v)*v;C=Sch.util.Date.add(M,Sch.util.Date.YEAR,H);break}return C},ceilDate:function(n,h,k){var l=Ext.Date.clone(n);h=h!==false;var i=h?this.resolutionIncrement:1,j=false,m;if(k){m=k}else{m=h?this.resolutionUnit:this.mainUnit}switch(m){case Sch.util.Date.HOUR:if(l.getMinutes()>0||l.getSeconds()>0||l.getMilliseconds()>0){j=true}break;case Sch.util.Date.DAY:if(l.getHours()>0||l.getMinutes()>0||l.getSeconds()>0||l.getMilliseconds()>0){j=true}break;case Sch.util.Date.WEEK:Ext.Date.clearTime(l);if(l.getDay()!==this.weekStartDay){j=true}break;case Sch.util.Date.MONTH:Ext.Date.clearTime(l);if(l.getDate()!==1){j=true}break;case Sch.util.Date.QUARTER:Ext.Date.clearTime(l);if(l.getMonth()%3!==0||(l.getMonth()%3===0&&l.getDate()!==1)){j=true}break;case Sch.util.Date.YEAR:Ext.Date.clearTime(l);if(l.getMonth()!==0||l.getDate()!==1){j=true}break;default:break}if(j){return this.getNext(l,m,i)}else{return l}},getNext:function(d,f,e){return Sch.util.Date.getNext(d,f,e,this.weekStartDay)},getResolution:function(){return{unit:this.resolutionUnit,increment:this.resolutionIncrement}},setResolution:function(c,d){this.resolutionUnit=c;this.resolutionIncrement=d||1},shift:function(d,c){this.setTimeSpan(Sch.util.Date.add(this.getStart(),c,d),Sch.util.Date.add(this.getEnd(),c,d))},shiftNext:function(d){d=d||this.getShiftIncrement();var c=this.getShiftUnit();this.setTimeSpan(Sch.util.Date.add(this.getStart(),c,d),Sch.util.Date.add(this.getEnd(),c,d))},shiftPrevious:function(d){d=-(d||this.getShiftIncrement());var c=this.getShiftUnit();this.setTimeSpan(Sch.util.Date.add(this.getStart(),c,d),Sch.util.Date.add(this.getEnd(),c,d))},getShiftUnit:function(){return this.shiftUnit||this.mainUnit},getShiftIncrement:function(){return this.shiftIncrement||1},getUnit:function(){return this.unit},getIncrement:function(){return this.increment},dateInAxis:function(b){return Sch.util.Date.betweenLesser(b,this.getStart(),this.getEnd())},timeSpanInAxis:function(c,d){if(this.isContinuous()){return Sch.util.Date.intersectSpans(c,d,this.getStart(),this.getEnd())}else{return(c<this.getStart()&&d>this.getEnd())||this.getTickFromDate(c)!==this.getTickFromDate(d)}},forEachAuxInterval:function(k,i,j,m){m=m||this;var p=this.getEnd(),l=this.getStart(),n=0,o;if(l>p){throw"Invalid time axis configuration"}while(l<p){o=Sch.util.Date.min(this.getNext(l,k,i||1),p);j.call(m,l,o,n);l=o;n++}},consumeViewPreset:function(b){Ext.apply(this,{unit:b.getBottomHeader().unit,increment:b.getBottomHeader().increment||1,resolutionUnit:b.timeResolution.unit,resolutionIncrement:b.timeResolution.increment,mainUnit:b.getMainHeader().unit,shiftUnit:b.shiftUnit,shiftIncrement:b.shiftIncrement||1,defaultSpan:b.defaultSpan||1})}});Ext.define("Sch.preset.ViewPreset",{name:null,rowHeight:null,timeColumnWidth:50,timeRowHeight:null,timeAxisColumnWidth:null,displayDateFormat:"G:i",shiftUnit:"HOUR",shiftIncrement:1,defaultSpan:12,timeResolution:null,headerConfig:null,columnLinesFor:"middle",headers:null,mainHeader:0,constructor:function(b){Ext.apply(this,b)},getHeaders:function(){if(this.headers){return this.headers}var b=this.headerConfig;this.mainHeader=b.top?1:0;return this.headers=[].concat(b.top||[],b.middle||[],b.bottom||[])},getMainHeader:function(){return this.getHeaders()[this.mainHeader]},getBottomHeader:function(){var b=this.getHeaders();return b[b.length-1]},clone:function(){var d={};var c=this;Ext.each(["rowHeight","timeColumnWidth","timeRowHeight","timeAxisColumnWidth","displayDateFormat","shiftUnit","shiftIncrement","defaultSpan","timeResolution","headerConfig"],function(a){d[a]=c[a]});return new this.self(Ext.clone(d))}});Ext.define("Sch.preset.Manager",{extend:"Ext.util.MixedCollection",requires:["Sch.util.Date","Sch.preset.ViewPreset"],mixins:["Sch.mixin.Localizable"],singleton:true,constructor:function(){this.callParent(arguments);this.registerDefaults()},registerPreset:function(h,i){if(i){var n=i.headerConfig;var k=Sch.util.Date;for(var j in n){if(n.hasOwnProperty(j)){if(k[n[j].unit]){n[j].unit=k[n[j].unit.toUpperCase()]}}}if(!i.timeColumnWidth){i.timeColumnWidth=50}if(!i.rowHeight){i.rowHeight=24}var m=i.timeResolution;if(m&&k[m.unit]){m.unit=k[m.unit.toUpperCase()]}var l=i.shiftUnit;if(l&&k[l]){i.shiftUnit=k[l.toUpperCase()]}}if(this.isValidPreset(i)){if(this.containsKey(h)){this.removeAtKey(h)}i.name=h;this.add(h,new Sch.preset.ViewPreset(i))}else{throw"Invalid preset, please check your configuration"}},isValidPreset:function(h){var j=Sch.util.Date,l=true,k=Sch.util.Date.units,g={};for(var i in h.headerConfig){if(h.headerConfig.hasOwnProperty(i)){g[i]=true;l=l&&Ext.Array.indexOf(k,h.headerConfig[i].unit)>=0}}if(!(h.columnLinesFor in g)){h.columnLinesFor="middle"}if(h.timeResolution){l=l&&Ext.Array.indexOf(k,h.timeResolution.unit)>=0}if(h.shiftUnit){l=l&&Ext.Array.indexOf(k,h.shiftUnit)>=0}return l},getPreset:function(b){return this.get(b)},deletePreset:function(b){this.removeAtKey(b)},registerDefaults:function(){var d=this,e=this.defaultPresets;for(var f in e){d.registerPreset(f,e[f])}},defaultPresets:{secondAndMinute:{timeColumnWidth:30,rowHeight:24,resourceColumnWidth:100,displayDateFormat:"G:i:s",shiftIncrement:10,shiftUnit:"MINUTE",defaultSpan:24,timeResolution:{unit:"SECOND",increment:5},headerConfig:{middle:{unit:"SECOND",increment:10,align:"center",dateFormat:"s"},top:{unit:"MINUTE",align:"center",dateFormat:"D, d g:iA"}}},minuteAndHour:{timeColumnWidth:100,rowHeight:24,resourceColumnWidth:100,displayDateFormat:"G:i",shiftIncrement:1,shiftUnit:"HOUR",defaultSpan:24,timeResolution:{unit:"MINUTE",increment:30},headerConfig:{middle:{unit:"MINUTE",increment:"30",align:"center",dateFormat:"i"},top:{unit:"HOUR",align:"center",dateFormat:"D, gA/d"}}},hourAndDay:{timeColumnWidth:60,rowHeight:24,resourceColumnWidth:100,displayDateFormat:"G:i",shiftIncrement:1,shiftUnit:"DAY",defaultSpan:24,timeResolution:{unit:"MINUTE",increment:30},headerConfig:{middle:{unit:"HOUR",align:"center",dateFormat:"G:i"},top:{unit:"DAY",align:"center",dateFormat:"D d/m"}}},dayAndWeek:{timeColumnWidth:100,rowHeight:24,resourceColumnWidth:100,displayDateFormat:"Y-m-d G:i",shiftUnit:"DAY",shiftIncrement:1,defaultSpan:5,timeResolution:{unit:"HOUR",increment:1},headerConfig:{middle:{unit:"DAY",align:"center",dateFormat:"D d M"},top:{unit:"WEEK",align:"center",renderer:function(f,d,e){return Sch.util.Date.getShortNameOfUnit("WEEK")+"."+Ext.Date.format(f,"W M Y")}}}},weekAndDay:{timeColumnWidth:100,rowHeight:24,resourceColumnWidth:100,displayDateFormat:"Y-m-d",shiftUnit:"WEEK",shiftIncrement:1,defaultSpan:1,timeResolution:{unit:"DAY",increment:1},headerConfig:{bottom:{unit:"DAY",align:"center",increment:1,dateFormat:"d/m"},middle:{unit:"WEEK",dateFormat:"D d M"}}},weekAndMonth:{timeColumnWidth:100,rowHeight:24,resourceColumnWidth:100,displayDateFormat:"Y-m-d",shiftUnit:"WEEK",shiftIncrement:5,defaultSpan:6,timeResolution:{unit:"DAY",increment:1},headerConfig:{middle:{unit:"WEEK",renderer:function(f,d,e){return Ext.Date.format(f,"d M")}},top:{unit:"MONTH",align:"center",dateFormat:"M Y"}}},monthAndYear:{timeColumnWidth:110,rowHeight:24,resourceColumnWidth:100,displayDateFormat:"Y-m-d",shiftIncrement:3,shiftUnit:"MONTH",defaultSpan:12,timeResolution:{unit:"DAY",increment:1},headerConfig:{middle:{unit:"MONTH",align:"center",dateFormat:"M Y"},top:{unit:"YEAR",align:"center",dateFormat:"Y"}}},year:{timeColumnWidth:100,rowHeight:24,resourceColumnWidth:100,displayDateFormat:"Y-m-d",shiftUnit:"YEAR",shiftIncrement:1,defaultSpan:1,timeResolution:{unit:"MONTH",increment:1},headerConfig:{middle:{unit:"QUARTER",align:"center",renderer:function(f,d,e){return Ext.String.format(Sch.util.Date.getShortNameOfUnit("QUARTER").toUpperCase()+"{0}",Math.floor(f.getMonth()/3)+1)}},top:{unit:"YEAR",align:"center",dateFormat:"Y"}}},manyYears:{timeColumnWidth:50,rowHeight:24,resourceColumnWidth:100,displayDateFormat:"Y-m-d",shiftUnit:"YEAR",shiftIncrement:1,defaultSpan:1,timeResolution:{unit:"YEAR",increment:1},headerConfig:{middle:{unit:"YEAR",align:"center",dateFormat:"Y",increment:5},bottom:{unit:"YEAR",align:"center",increment:1,renderer:Ext.emptyFn}}},weekAndDayLetter:{timeColumnWidth:20,rowHeight:24,resourceColumnWidth:100,displayDateFormat:"Y-m-d",shiftUnit:"WEEK",shiftIncrement:1,defaultSpan:10,timeResolution:{unit:"DAY",increment:1},headerConfig:{bottom:{unit:"DAY",align:"center",renderer:function(b){return Ext.Date.dayNames[b.getDay()].substring(0,1)}},middle:{unit:"WEEK",dateFormat:"D d M Y"}}},weekDateAndMonth:{timeColumnWidth:30,rowHeight:24,resourceColumnWidth:100,displayDateFormat:"Y-m-d",shiftUnit:"WEEK",shiftIncrement:1,defaultSpan:10,timeResolution:{unit:"DAY",increment:1},headerConfig:{middle:{unit:"WEEK",align:"center",dateFormat:"d"},top:{unit:"MONTH",dateFormat:"Y F"}}}}});if(!Ext.ClassManager.get("Sch.feature.AbstractTimeSpan")){Ext.define("Sch.feature.AbstractTimeSpan",{extend:"Ext.AbstractPlugin",mixins:{observable:"Ext.util.Observable"},lockableScope:"top",schedulerView:null,timeAxis:null,containerEl:null,expandToFitView:false,disabled:false,cls:null,clsField:"Cls",template:null,store:null,renderElementsBuffered:false,renderDelay:15,refreshSizeOnItemUpdate:true,_resizeTimer:null,_renderTimer:null,showHeaderElements:false,headerTemplate:null,innerHeaderTpl:null,headerContainerCls:"sch-header-secondary-canvas",headerContainerEl:null,renderingDoneEvent:null,constructor:function(b){this.uniqueCls=this.uniqueCls||("sch-timespangroup-"+Ext.id());Ext.apply(this,b);this.mixins.observable.constructor.call(this);this.callParent(arguments)},setDisabled:function(b){if(b){this.removeElements()}this.disabled=b},removeElements:function(){this.removeBodyElements();if(this.showHeaderElements){this.removeHeaderElements()}},getBodyElements:function(){if(this.containerEl){return this.containerEl.select("."+this.uniqueCls)}return null},getHeaderContainerEl:function(){var f=this.headerContainerEl,d=Ext.baseCSSPrefix,e;if(!f||!f.dom){if(this.schedulerView.isHorizontal()){e=this.panel.getTimeAxisColumn().headerView.containerEl}else{e=this.panel.el.down("."+d+"grid-inner-locked ."+d+"panel-body ."+d+"grid-view")}if(e){f=e.down("."+this.headerContainerCls);if(!f){f=e.appendChild({cls:this.headerContainerCls})}this.headerContainerEl=f}}return f},getHeaderElements:function(){var b=this.getHeaderContainerEl();if(b){return b.select("."+this.uniqueCls)}return null},removeBodyElements:function(){var b=this.getBodyElements();if(b){b.each(function(a){a.destroy()})}},removeHeaderElements:function(){var b=this.getHeaderElements();if(b){b.each(function(a){a.destroy()})}},getElementId:function(b){return this.uniqueCls+"-"+b.internalId},getHeaderElementId:function(b){return this.uniqueCls+"-header-"+b.internalId},getTemplateData:function(b){return this.prepareTemplateData?this.prepareTemplateData(b):b.data},getElementCls:function(e,f){var d=e.clsField||this.clsField;if(!f){f=this.getTemplateData(e)}return this.cls+" "+this.uniqueCls+" "+(f[d]||"")},getHeaderElementCls:function(e,f){var d=e.clsField||this.clsField;if(!f){f=this.getTemplateData(e)}return"sch-header-indicator "+this.uniqueCls+" "+(f[d]||"")},init:function(d){if(Ext.versions.touch&&!d.isReady()){d.on("viewready",function(){this.init(d)},this);return}if(Ext.isString(this.innerHeaderTpl)){this.innerHeaderTpl=new Ext.XTemplate(this.innerHeaderTpl)}var c=this.innerHeaderTpl;if(!this.headerTemplate){this.headerTemplate=new Ext.XTemplate('<tpl for=".">','<div id="{id}" class="{cls}" style="{side}:{position}px;">'+(c?"{[this.renderInner(values)]}":"")+"</div>","</tpl>",{renderInner:function(a){return c.apply(a)}})}this.schedulerView=d.getSchedulingView();this.panel=d;this.timeAxis=d.getTimeAxis();this.store=Ext.StoreManager.lookup(this.store);if(!this.store){Ext.Error.raise("Error: You must define a store for this plugin")}if(!this.schedulerView.getEl()){this.schedulerView.on({afterrender:this.onAfterRender,scope:this})}else{this.onAfterRender()}this.schedulerView.on({destroy:this.onDestroy,scope:this})},onAfterRender:function(f){var e=this.schedulerView;this.containerEl=e.getSecondaryCanvasEl();this.storeListeners={load:this.renderElements,datachanged:this.renderElements,clear:this.renderElements,add:this.refreshSingle,remove:this.renderElements,update:this.refreshSingle,addrecords:this.refreshSingle,removerecords:this.renderElements,updaterecord:this.refreshSingle,scope:this};this.store.on(this.storeListeners);if(Ext.data.NodeStore&&e.store instanceof Ext.data.NodeStore){if(e.animate){}else{e.mon(e.store,{expand:this.renderElements,collapse:this.renderElements,scope:this})}}e.on({bufferedrefresh:this.renderElements,refresh:this.renderElements,itemadd:this.refreshSizeOnItemUpdate?this.refreshSizes:this.renderElements,itemremove:this.refreshSizeOnItemUpdate?this.refreshSizes:this.renderElements,itemupdate:this.refreshSizeOnItemUpdate?this.refreshSizes:this.renderElements,groupexpand:this.renderElements,groupcollapse:this.renderElements,columnwidthchange:this.renderElements,resize:this.renderElements,scope:this});if(e.headerCt){e.headerCt.on({add:this.renderElements,remove:this.renderElements,scope:this})}this.panel.on({viewchange:this.renderElements,show:this.refreshSizes,orientationchange:this.forceNewRenderingTimeout,scope:this});var d=e.getRowContainerEl();if(d&&d.down(".sch-timetd")){this.renderElements()}},forceNewRenderingTimeout:function(){this.renderElementsBuffered=false;clearTimeout(this._renderTimer);clearTimeout(this._resizeTimer);this.renderElements()},refreshSizesInternal:function(){if(!this.schedulerView.isDestroyed&&this.schedulerView.isHorizontal()){var b=this.schedulerView.getTimeSpanRegion(new Date(),null,this.expandToFitView);this.getBodyElements().setHeight(b.bottom-b.top)}},refreshSizes:function(){clearTimeout(this._resizeTimer);this._resizeTimer=Ext.Function.defer(this.refreshSizesInternal,this.renderDelay,this)},renderElements:function(){if(this.renderElementsBuffered||this.disabled){return}this.renderElementsBuffered=true;clearTimeout(this._renderTimer);this._renderTimer=Ext.Function.defer(this.renderElementsInternal,this.renderDelay,this)},setElementX:function(c,d){if(this.panel.rtl){c.setRight(d)}else{c.setLeft(d)}},getHeaderElementPosition:function(c){var d=this.schedulerView.getTimeAxisViewModel();return Math.round(d.getPositionFromDate(c))},renderBodyElementsInternal:function(b){Ext.DomHelper.append(this.containerEl,this.generateMarkup(false,b))},getHeaderElementData:function(d,c){throw"Abstract method call"},renderHeaderElementsInternal:function(d){var c=this.getHeaderContainerEl();if(c){Ext.DomHelper.append(c,this.generateHeaderMarkup(false,d))}},renderElementsInternal:function(){this.renderElementsBuffered=false;if(this.disabled||this.schedulerView.isDestroyed){return}if(Ext.versions.extjs&&!this.schedulerView.el.down("table")){return}this.removeElements();this.renderBodyElementsInternal();if(this.showHeaderElements){this.headerContainerEl=null;this.renderHeaderElementsInternal()}if(this.renderingDoneEvent){this.fireEvent(this.renderingDoneEvent,this)}},generateMarkup:function(j,f){var h=this.timeAxis.getStart(),g=this.timeAxis.getEnd(),i=this.getElementData(h,g,f,j);return this.template.apply(i)},generateHeaderMarkup:function(d,e){var f=this.getHeaderElementData(e,d);return this.headerTemplate.apply(f)},getElementData:function(g,h,f,e){throw"Abstract method call"},updateBodyElement:function(f){var j=Ext.get(this.getElementId(f));if(j){var h=this.timeAxis.getStart(),g=this.timeAxis.getEnd(),i=this.getElementData(h,g,[f])[0];if(i){j.dom.className=i.$cls;j.setTop(i.top);this.setElementX(j,i.left);j.setSize(i.width,i.height)}else{Ext.destroy(j)}}else{this.renderBodyElementsInternal([f])}},updateHeaderElement:function(e){var d=Ext.get(this.getHeaderElementId(e));if(d){var f=this.getHeaderElementData([e])[0];if(f){d.dom.className=f.cls;if(this.schedulerView.isHorizontal()){this.setElementX(d,f.position);d.setWidth(f.size)}else{d.setTop(f.position);d.setHeight(f.size)}}else{Ext.destroy(d)}}else{this.renderHeaderElementsInternal([e])}},onDestroy:function(){clearTimeout(this._renderTimer);clearTimeout(this._resizeTimer);if(this.store.autoDestroy){this.store.destroy()}this.store.un(this.storeListeners)},refreshSingle:function(c,d){Ext.each(d,this.updateBodyElement,this);if(this.showHeaderElements){Ext.each(d,this.updateHeaderElement,this)}}})}Ext.define("Sch.plugin.Lines",{extend:"Sch.feature.AbstractTimeSpan",alias:"plugin.scheduler_lines",cls:"sch-timeline",showTip:true,innerTpl:null,prepareTemplateData:null,side:null,init:function(d){if(Ext.isString(this.innerTpl)){this.innerTpl=new Ext.XTemplate(this.innerTpl)}this.side=d.rtl?"right":"left";var c=this.innerTpl;if(!this.template){this.template=new Ext.XTemplate('<tpl for=".">','<div id="{id}" '+(this.showTip?'title="{[this.getTipText(values)]}" ':"")+'class="{$cls}" style="'+this.side+':{left}px;top:{top}px;height:{height}px;width:{width}px">'+(c?"{[this.renderInner(values)]}":"")+"</div>","</tpl>",{getTipText:function(a){return d.getSchedulingView().getFormattedDate(a.Date)+" "+(a.Text||"")},renderInner:function(a){return c.apply(a)}})}this.callParent(arguments)},getElementData:function(w,l,E){var H=this.store,y=this.schedulerView,s=y.isHorizontal(),B=E||H.getRange(),z=[],i,G,u=y.getTimeSpanRegion(w,null,this.expandToFitView),x,F,C;if(Ext.versions.touch){i="100%"}else{i=s?u.bottom-u.top:1}G=s?1:u.right-u.left;for(var A=0,D=B.length;A<D;A++){x=B[A];F=x.get("Date");if(F&&Sch.util.Date.betweenLesser(F,w,l)){var v=y.getCoordinateFromDate(F);C=Ext.apply({},this.getTemplateData(x));C.id=this.getElementId(x);C.$cls=this.getElementCls(x,C);C.width=G;C.height=i;if(s){C.left=v}else{C.top=v}z.push(C)}}return z},getHeaderElementData:function(t){var v=this.timeAxis.getStart(),l=this.timeAxis.getEnd(),i=this.schedulerView.isHorizontal(),p=[],o,u,n,r;t=t||this.store.getRange();for(var q=0,s=t.length;q<s;q++){o=t[q];u=o.get("Date");if(u&&Sch.util.Date.betweenLesser(u,v,l)){n=this.getHeaderElementPosition(u);r=this.getTemplateData(o);p.push(Ext.apply({id:this.getHeaderElementId(o),side:i?this.side:"top",cls:this.getHeaderElementCls(o,r),position:n},r))}}return p}});Ext.define("Sch.plugin.Zones",{extend:"Sch.feature.AbstractTimeSpan",alias:"plugin.scheduler_zones",requires:["Sch.model.Range"],innerTpl:null,cls:"sch-zone",side:null,init:function(d){if(Ext.isString(this.innerTpl)){this.innerTpl=new Ext.XTemplate(this.innerTpl)}this.side=d.rtl?"right":"left";var c=this.innerTpl;if(!this.template){this.template=new Ext.XTemplate('<tpl for="."><div id="{id}" class="{$cls}" style="'+this.side+':{left}px;top:{top}px;height:{height}px;width:{width}px;{style}">'+(c?"{[this.renderInner(values)]}":"")+"</div></tpl>",{renderInner:function(a){return c.apply(a)}})}if(Ext.isString(this.innerHeaderTpl)){this.innerHeaderTpl=new Ext.XTemplate(this.innerHeaderTpl)}this.callParent(arguments)},getElementData:function(C,G,u,E){var D=this.schedulerView,l=[],H=D.getTimeSpanRegion(C,G,this.expandToFitView),A=this.schedulerView.isHorizontal(),I,z,J,B,y,F;u=u||this.store.getRange();for(var v=0,w=u.length;v<w;v++){I=u[v];z=I.getStartDate();J=I.getEndDate();F=this.getTemplateData(I);if(z&&J&&Sch.util.Date.intersectSpans(z,J,C,G)){var i=D.getCoordinateFromDate(Sch.util.Date.max(z,C));var x=D.getCoordinateFromDate(Sch.util.Date.min(J,G));B=Ext.apply({},F);B.id=this.getElementId(I);B.$cls=this.getElementCls(I,F);if(A){B.left=i;B.top=H.top;B.width=E?0:x-i;B.height=H.bottom-H.top;B.style=E?("border-left-width:"+(x-i)+"px"):""}else{B.left=H.left;B.top=i;B.height=E?0:x-i;B.width=H.right-H.left;B.style=E?("border-top-width:"+(x-i)+"px"):""}l.push(B)}}return l},getHeaderElementId:function(c,d){return this.callParent([c])+(d?"-start":"-end")},getHeaderElementCls:function(e,g,f){var h=e.clsField||this.clsField;if(!g){g=this.getTemplateData(e)}return"sch-header-indicator sch-header-indicator-"+(f?"start ":"end ")+this.uniqueCls+" "+(g[h]||"")},getZoneHeaderElementData:function(q,k,m,r){var p=r?m.getStartDate():m.getEndDate(),n=null,l,j,o;if(p&&Sch.util.Date.betweenLesser(p,q,k)){l=this.getHeaderElementPosition(p);j=this.schedulerView.isHorizontal();o=this.getTemplateData(m);n=Ext.apply({id:this.getHeaderElementId(m,r),cls:this.getHeaderElementCls(m,o,r),isStart:r,side:j?this.side:"top",position:l},o)}return n},getHeaderElementData:function(q){var r=this.timeAxis.getStart(),k=this.timeAxis.getEnd(),n=[],l,o,i;q=q||this.store.getRange();for(var m=0,p=q.length;m<p;m++){l=q[m];o=this.getZoneHeaderElementData(r,k,l,true);if(o){n.push(o)}i=this.getZoneHeaderElementData(r,k,l,false);if(i){n.push(i)}}return n},updateZoneHeaderElement:function(d,c){d.dom.className=c.cls;if(this.schedulerView.isHorizontal()){this.setElementX(d,c.position)}else{d.setTop(c.position)}},updateHeaderElement:function(n){var i=this.timeAxis.getStart(),j=this.timeAxis.getEnd(),k=Ext.get(this.getHeaderElementId(n,true)),l=Ext.get(this.getHeaderElementId(n,false)),m=this.getZoneHeaderElementData(i,j,n,true),h=this.getZoneHeaderElementData(i,j,n,false);if(!(k&&h)||!(l&&h)){Ext.destroy(k,l);this.renderHeaderElementsInternal([n])}else{if(k){if(!m){Ext.destroy(k)}else{this.updateZoneHeaderElement(k,m)}}if(l){if(!h){Ext.destroy(l)}else{this.updateZoneHeaderElement(l,h)}}}}});Ext.define("Sch.plugin.Pan",{extend:"Ext.AbstractPlugin",alias:"plugin.scheduler_pan",lockableScope:"top",enableVerticalPan:true,statics:{KEY_SHIFT:1,KEY_CTRL:2,KEY_ALT:4,KEY_ALL:7},disableOnKey:0,panel:null,constructor:function(b){Ext.apply(this,b)},init:function(b){this.panel=b.normalGrid||b;this.view=b.getSchedulingView();this.view.on("afterrender",this.onRender,this)},onRender:function(b){this.view.el.on("mousedown",this.onMouseDown,this)},onMouseDown:function(g,h){var e=this.self,f=this.disableOnKey;if((g.shiftKey&&(f&e.KEY_SHIFT))||(g.ctrlKey&&(f&e.KEY_CTRL))||(g.altKey&&(f&e.KEY_ALT))){return}if(g.getTarget("."+this.view.timeCellCls,10)&&!g.getTarget(this.view.eventSelector)){this.mouseX=g.getPageX();this.mouseY=g.getPageY();Ext.getBody().on("mousemove",this.onMouseMove,this);Ext.getDoc().on("mouseup",this.onMouseUp,this);if(Ext.isIE||Ext.isGecko){Ext.getBody().on("mouseenter",this.onMouseUp,this)}g.stopEvent()}},onMouseMove:function(i){i.stopEvent();var g=i.getPageX(),h=i.getPageY(),j=g-this.mouseX,e=h-this.mouseY;this.panel.scrollByDeltaX(-j);this.mouseX=g;this.mouseY=h;if(this.enableVerticalPan){this.panel.scrollByDeltaY(-e)}},onMouseUp:function(b){Ext.getBody().un("mousemove",this.onMouseMove,this);Ext.getDoc().un("mouseup",this.onMouseUp,this);if(Ext.isIE||Ext.isGecko){Ext.getBody().un("mouseenter",this.onMouseUp,this)}}});Ext.define("Sch.tooltip.ClockTemplate",{extend:"Ext.XTemplate",constructor:function(){var r=Math.PI/180,o=Math.cos,q=Math.sin,n=7,x=2,w=10,p=6,u=3,z=10,v=Ext.isIE&&(Ext.isIE8m||Ext.isIEQuirks);function y(e){var b=e*r,d=o(b),h=q(b),a=p*q((90-e)*r),i=p*o((90-e)*r),g=Math.min(p,p-a),c=e>180?i:0,f="progid:DXImageTransform.Microsoft.Matrix(sizingMethod='auto expand', M11 = "+d+", M12 = "+(-h)+", M21 = "+h+", M22 = "+d+")";return Ext.String.format("filter:{0};-ms-filter:{0};top:{1}px;left:{2}px;",f,g+u,c+z)}function s(e){var b=e*r,d=o(b),h=q(b),a=n*q((90-e)*r),i=n*o((90-e)*r),g=Math.min(n,n-a),c=e>180?i:0,f="progid:DXImageTransform.Microsoft.Matrix(sizingMethod='auto expand', M11 = "+d+", M12 = "+(-h)+", M21 = "+h+", M22 = "+d+")";return Ext.String.format("filter:{0};-ms-filter:{0};top:{1}px;left:{2}px;",f,g+x,c+w)}function t(a){return Ext.String.format("transform:rotate({0}deg);-ms-transform:rotate({0}deg);-moz-transform: rotate({0}deg);-webkit-transform: rotate({0}deg);-o-transform:rotate({0}deg);",a)}this.callParent(['<div class="sch-clockwrap {cls}"><div class="sch-clock"><div class="sch-hourIndicator" style="{[this.getHourStyle((values.date.getHours()%12) * 30)]}">{[Ext.Date.monthNames[values.date.getMonth()].substr(0,3)]}</div><div class="sch-minuteIndicator" style="{[this.getMinuteStyle(values.date.getMinutes() * 6)]}">{[values.date.getDate()]}</div></div><span class="sch-clock-text">{text}</span></div>',{compiled:true,disableFormats:true,getMinuteStyle:v?s:t,getHourStyle:v?y:t}])}});Ext.define("Sch.tooltip.Tooltip",{extend:"Ext.tip.ToolTip",requires:["Sch.tooltip.ClockTemplate"],autoHide:false,anchor:"b",padding:"0 3 0 0",showDelay:0,hideDelay:0,quickShowInterval:0,dismissDelay:0,trackMouse:false,valid:true,anchorOffset:5,shadow:false,frame:false,constructor:function(c){var d=new Sch.tooltip.ClockTemplate();this.renderTo=document.body;this.startDate=this.endDate=new Date();if(!this.template){this.template=Ext.create("Ext.XTemplate",'<div class="{[values.valid ? "sch-tip-ok" : "sch-tip-notok"]}">','{[this.renderClock(values.startDate, values.startText, "sch-tooltip-startdate")]}','{[this.renderClock(values.endDate, values.endText, "sch-tooltip-enddate")]}',"</div>",{compiled:true,disableFormats:true,renderClock:function(b,a,f){return d.apply({date:b,text:a,cls:f})}})}this.callParent(arguments)},update:function(h,j,k,i){if(this.startDate-h!==0||this.endDate-j!==0||this.valid!==k||i){this.startDate=h;this.endDate=j;this.valid=k;var l=this.schedulerView.getFormattedDate(h),g=this.schedulerView.getFormattedEndDate(j,h);if(this.mode==="calendar"&&j.getHours()===0&&j.getMinutes()===0&&!(j.getYear()===h.getYear()&&j.getMonth()===h.getMonth()&&j.getDate()===h.getDate())){j=Sch.util.Date.add(j,Sch.util.Date.DAY,-1)}this.callParent([this.template.apply({valid:k,startDate:h,endDate:j,startText:l,endText:g})])}},show:function(c,d){if(!c){return}d=d||18;if(Sch.util.Date.compareUnits(this.schedulerView.getTimeResolution().unit,Sch.util.Date.DAY)>=0){this.mode="calendar";this.addCls("sch-day-resolution")}else{this.mode="clock";this.removeCls("sch-day-resolution")}this.mouseOffsets=[d-18,-7];this.setTarget(c);this.callParent();this.alignTo(c,"bl-tl",this.mouseOffsets);this.mon(Ext.getDoc(),"mousemove",this.onMyMouseMove,this);this.mon(Ext.getDoc(),"mouseup",this.onMyMouseUp,this,{single:true})},onMyMouseMove:function(){this.el.alignTo(this.target,"bl-tl",this.mouseOffsets)},onMyMouseUp:function(){this.mun(Ext.getDoc(),"mousemove",this.onMyMouseMove,this)},afterRender:function(){this.callParent(arguments);this.el.on("mouseenter",this.onElMouseEnter,this)},onElMouseEnter:function(){this.alignTo(this.target,"bl-tl",this.mouseOffsets)}});if(!Ext.ClassManager.get("Sch.view.model.TimeAxis")){Ext.define("Sch.view.model.TimeAxis",{extend:"Ext.util.Observable",requires:["Ext.Date","Sch.util.Date","Sch.preset.Manager"],timeAxis:null,availableWidth:0,tickWidth:100,snapToIncrement:false,forceFit:false,headerConfig:null,headers:null,mainHeader:0,timeAxisColumnWidth:null,resourceColumnWidth:null,timeColumnWidth:null,rowHeightHorizontal:null,rowHeightVertical:null,orientation:"horizontal",suppressFit:false,refCount:0,columnConfig:{},viewPreset:null,columnLinesFor:"middle",eventStore:null,constructor:function(e){var f=this;Ext.apply(this,e);if(this.viewPreset){var d=Sch.preset.Manager.getPreset(this.viewPreset);d&&this.consumeViewPreset(d)}f.timeAxis.on("reconfigure",f.onTimeAxisReconfigure,f);this.callParent(arguments)},destroy:function(){this.timeAxis.un("reconfigure",this.onTimeAxisReconfigure,this)},onTimeAxisReconfigure:function(d,e,f){if(!f){this.update()}},reconfigure:function(b){this.headers=null;Ext.apply(this,b);if(this.orientation=="horizontal"){this.setTickWidth(this.timeColumnWidth)}else{this.setTickWidth(this.rowHeightVertical)}this.fireEvent("reconfigure",this)},getColumnConfig:function(){return this.columnConfig},update:function(k,g){var j=this.timeAxis,l=this.headerConfig;this.availableWidth=Math.max(k||this.availableWidth,0);if(!Ext.isNumber(this.availableWidth)){throw"Invalid available width provided to Sch.view.model.TimeAxis"}if(this.forceFit&&this.availableWidth<=0){return}this.columnConfig={};for(var i in l){if(l[i].cellGenerator){this.columnConfig[i]=l[i].cellGenerator.call(this,j.getStart(),j.getEnd())}else{this.columnConfig[i]=this.createHeaderRow(i,l[i])}}var h=this.calculateTickWidth(this.getTickWidth());if(!Ext.isNumber(h)||h<=0){throw"Invalid column width calculated in Sch.view.model.TimeAxis"}this.updateTickWidth(h);if(!g){this.fireEvent("update",this)}},createHeaderRow:function(h,k){var l=[],j=this,i=k.align,g=Ext.Date.clearTime(new Date());j.forEachInterval(h,function(a,d,c){var b={align:i,start:a,end:d,headerCls:""};if(k.renderer){b.header=k.renderer.call(k.scope||j,a,d,b,c,j.eventStore)}else{b.header=Ext.Date.format(a,k.dateFormat)}if(k.unit===Sch.util.Date.DAY&&(!k.increment||k.increment===1)){b.headerCls+=" sch-dayheadercell-"+a.getDay();if(Ext.Date.clearTime(a,true)-g===0){b.headerCls+=" sch-dayheadercell-today"}}l.push(b)});return l},getDistanceBetweenDates:function(c,d){return Math.round(this.getPositionFromDate(d)-this.getPositionFromDate(c))},getPositionFromDate:function(e){var f=-1,d=this.timeAxis.getTickFromDate(e);if(d>=0){f=Math.round(this.tickWidth*(d-this.timeAxis.visibleTickStart))}return f},getDateFromPosition:function(f,g){var h=f/this.getTickWidth()+this.timeAxis.visibleTickStart,e=this.timeAxis.getCount();if(h<0||h>e){return null}return this.timeAxis.getDateFromTick(h,g)},getSingleUnitInPixels:function(b){return Sch.util.Date.getUnitToBaseUnitRatio(this.timeAxis.getUnit(),b)*this.tickWidth/this.timeAxis.increment},getSnapPixelAmount:function(){if(this.snapToIncrement){var b=this.timeAxis.getResolution();return(b.increment||1)*this.getSingleUnitInPixels(b.unit)}else{return 1}},getTickWidth:function(){return this.tickWidth},setTickWidth:function(c,d){this.updateTickWidth(c);this.update(null,d)},updateTickWidth:function(b){this.tickWidth=b;if(this.orientation=="horizontal"){this.timeColumnWidth=b}else{this.rowHeightVertical=b}},getTotalWidth:function(){return Math.round(this.tickWidth*this.timeAxis.getVisibleTickTimeSpan())},calculateTickWidth:function(q){var k=this.forceFit;var n=this.timeAxis;var s=0,o=n.getUnit(),l=Number.MAX_VALUE,r=Sch.util.Date;if(this.snapToIncrement){var p=n.getResolution();l=r.getUnitToBaseUnitRatio(o,p.unit)*p.increment}else{var m=r.getMeasuringUnit(o);l=Math.min(l,r.getUnitToBaseUnitRatio(o,m))}var t=Math[k?"floor":"round"](this.getAvailableWidth()/n.getVisibleTickTimeSpan());if(!this.suppressFit){s=(k||q<t)?t:q;if(l>0&&(!k||l<1)){s=Math.round(Math.max(1,Math[k?"floor":"round"](l*s))/l)}}else{s=q}return s},getAvailableWidth:function(){return this.availableWidth},setAvailableWidth:function(d){this.availableWidth=Math.max(0,d);var c=this.calculateTickWidth(this.tickWidth);if(c!==this.tickWidth){this.setTickWidth(c)}},fitToAvailableWidth:function(d){var c=Math.floor(this.availableWidth/this.timeAxis.getVisibleTickTimeSpan());this.setTickWidth(c,d)},setForceFit:function(b){if(b!==this.forceFit){this.forceFit=b;this.update()}},setSnapToIncrement:function(b){if(b!==this.snapToIncrement){this.snapToIncrement=b;this.update()}},getViewRowHeight:function(){var b=this.orientation=="horizontal"?this.rowHeightHorizontal:this.rowHeightVertical;if(!b){throw"rowHeight info not available"}return b},setViewRowHeight:function(h,f){var g=this.orientation==="horizontal";var e="rowHeight"+Ext.String.capitalize(this.orientation);if(this[e]!=h){this[e]=h;if(g){if(!f){this.fireEvent("update",this)}}else{this.setTickWidth(h,f)}}},setViewColumnWidth:function(c,d){if(this.orientation==="horizontal"){this.setTickWidth(c,d)}else{this.resourceColumnWidth=c}if(!d){this.fireEvent("columnwidthchange",this,c)}},getHeaders:function(){if(this.headers){return this.headers}var b=this.headerConfig;this.mainHeader=b.top?1:0;return this.headers=[].concat(b.top||[],b.middle||[],b.bottom||[])},getMainHeader:function(){return this.getHeaders()[this.mainHeader]},getBottomHeader:function(){var b=this.getHeaders();return b[b.length-1]},forEachInterval:function(f,g,i){i=i||this;var j=this.headerConfig;if(!j){return}if(f==="top"||(f==="middle"&&j.bottom)){var h=j[f];this.timeAxis.forEachAuxInterval(h.unit,h.increment,g,i)}else{this.timeAxis.each(function(a,b){return g.call(i,a.data.start,a.data.end,b)})}},forEachMainInterval:function(d,c){this.forEachInterval("middle",d,c)},consumeViewPreset:function(d){this.headers=null;var c=this.orientation=="horizontal";Ext.apply(this,{headerConfig:d.headerConfig,columnLinesFor:d.columnLinesFor||"middle",rowHeightHorizontal:d.rowHeight,tickWidth:c?d.timeColumnWidth:d.timeRowHeight||d.timeColumnWidth||60,timeColumnWidth:d.timeColumnWidth,rowHeightVertical:d.timeRowHeight||d.timeColumnWidth||60,timeAxisColumnWidth:d.timeAxisColumnWidth,resourceColumnWidth:d.resourceColumnWidth||100})}})}Ext.define("Sch.view.HorizontalTimeAxis",{extend:"Ext.util.Observable",requires:["Ext.XTemplate"],trackHeaderOver:true,compactCellWidthThreshold:15,baseCls:"sch-column-header",tableCls:"sch-header-row",headerHtmlRowTpl:'<table border="0" cellspacing="0" cellpadding="0" style="width: {totalWidth}px; {tstyle}" class="{{tableCls}} sch-header-row-{position} {cls}"><thead><tr><tpl for="cells"><td class="{{baseCls}} {headerCls}" style="position : static; text-align: {align}; width: {width}px; {style}" tabIndex="0"headerPosition="{parent.position}" headerIndex="{[xindex-1]}"><div class="sch-simple-timeheader">{header}</div></td></tpl></tr></thead></table>',model:null,hoverCls:"",containerEl:null,height:null,constructor:function(i){var h=this;var f=!!Ext.versions.touch;var g=f?"tap":"click";Ext.apply(this,i);h.callParent(arguments);h.model.on("update",h.onModelUpdate,this,{priority:5});h.containerEl=Ext.get(h.containerEl);if(!(h.headerHtmlRowTpl instanceof Ext.Template)){h.headerHtmlRowTpl=h.headerHtmlRowTpl.replace("{{baseCls}}",this.baseCls).replace("{{tableCls}}",this.tableCls);h.headerHtmlRowTpl=new Ext.XTemplate(h.headerHtmlRowTpl)}if(h.trackHeaderOver&&h.hoverCls){h.containerEl.on({mousemove:h.highlightCell,delegate:".sch-column-header",scope:h});h.containerEl.on({mouseleave:h.clearHighlight,scope:h})}var j={scope:this,delegate:".sch-column-header"};if(f){j.tap=this.onElClick("tap");j.doubletap=this.onElClick("doubletap")}else{j.click=this.onElClick("click");j.dblclick=this.onElClick("dblclick");j.contextmenu=this.onElClick("contextmenu")}h._listenerCfg=j;if(h.containerEl){h.containerEl.on(j)}},destroy:function(){var b=this;if(b.containerEl){b.containerEl.un(b._listenerCfg);b.containerEl.un({mousemove:b.highlightCell,delegate:".sch-simple-timeheader",scope:b});b.containerEl.un({mouseleave:b.clearHighlight,scope:b})}b.model.un({update:b.onModelUpdate,scope:b})},onModelUpdate:function(){this.render()},getHTML:function(n,k,o){var j=this.model.getColumnConfig();var l=this.model.getTotalWidth();var p=Ext.Object.getKeys(j).length;var q=this.height?this.height/p:0;var m="";var r;if(j.top){this.embedCellWidths(j.top);m+=this.headerHtmlRowTpl.apply({totalWidth:l,cells:j.top,position:"top",tstyle:"border-top : 0;"+(q?"height:"+q+"px":"")})}if(j.middle){this.embedCellWidths(j.middle);m+=this.headerHtmlRowTpl.apply({totalWidth:l,cells:j.middle,position:"middle",tstyle:(j.top?"":"border-top : 0;")+(q?"height:"+q+"px":""),cls:!j.bottom&&this.model.getTickWidth()<=this.compactCellWidthThreshold?"sch-header-row-compact":""})}if(j.bottom){this.embedCellWidths(j.bottom);m+=this.headerHtmlRowTpl.apply({totalWidth:l,cells:j.bottom,position:"bottom",tstyle:(q?"height:"+q+"px":""),cls:this.model.getTickWidth()<=this.compactCellWidthThreshold?"sch-header-row-compact":""})}return m+'<div class="sch-header-secondary-canvas"></div>'},render:function(){if(!this.containerEl){return}var j=this.containerEl,i=j.dom,k=i.style.display,h=this.model.getColumnConfig(),g=i.parentNode;i.style.display="none";g.removeChild(i);var l=this.getHTML();i.innerHTML=l;if(!h.top&&!h.middle){this.containerEl.addCls("sch-header-single-row")}else{this.containerEl.removeCls("sch-header-single-row")}g&&g.appendChild(i);i.style.display=k;this.fireEvent("refresh",this)},embedCellWidths:function(f){var h=(Ext.isIE7||Ext.isSafari)?1:0;for(var j=0;j<f.length;j++){var g=f[j];var i=this.model.getDistanceBetweenDates(g.start,g.end);if(i){g.width=i-(j?h:0)}else{g.width=0;g.style="display: none"}}},onElClick:function(b){return function(h,g){g=h.delegatedTarget||g;var a=Ext.fly(g).getAttribute("headerPosition"),j=Ext.fly(g).getAttribute("headerIndex"),i=this.model.getColumnConfig()[a][j];this.fireEvent("timeheader"+b,this,i.start,i.end,h)}},highlightCell:function(f,e){var d=this;if(e!==d.highlightedCell){d.clearHighlight();d.highlightedCell=e;Ext.fly(e).addCls(d.hoverCls)}},clearHighlight:function(){var c=this,d=c.highlightedCell;if(d){Ext.fly(d).removeCls(c.hoverCls);delete c.highlightedCell}}});Ext.define("Sch.column.timeAxis.Horizontal",{extend:"Ext.grid.column.Column",alias:"widget.timeaxiscolumn",draggable:false,groupable:false,hideable:false,sortable:false,fixed:true,menuDisabled:true,cls:"sch-simple-timeaxis",tdCls:"sch-timetd",enableLocking:false,requires:["Sch.view.HorizontalTimeAxis"],timeAxisViewModel:null,headerView:null,hoverCls:"",ownHoverCls:"sch-column-header-over",trackHeaderOver:true,compactCellWidthThreshold:20,initComponent:function(){this.callParent(arguments)},afterRender:function(){var b=this;b.headerView=new Sch.view.HorizontalTimeAxis({model:b.timeAxisViewModel,containerEl:b.titleEl,hoverCls:b.ownHoverCls,trackHeaderOver:b.trackHeaderOver,compactCellWidthThreshold:b.compactCellWidthThreshold});b.headerView.on("refresh",b.onTimeAxisViewRefresh,b);b.ownerCt.on("afterlayout",function(){b.mon(b.ownerCt,"resize",b.onHeaderContainerResize,b);if(this.getWidth()>0){if(b.getAvailableWidthForSchedule()===b.timeAxisViewModel.getAvailableWidth()){b.headerView.render()}else{b.timeAxisViewModel.update(b.getAvailableWidthForSchedule())}b.setWidth(b.timeAxisViewModel.getTotalWidth())}},null,{single:true});this.enableBubble("timeheaderclick","timeheaderdblclick","timeheadercontextmenu");b.relayEvents(b.headerView,["timeheaderclick","timeheaderdblclick","timeheadercontextmenu"]);b.callParent(arguments)},initRenderData:function(){var b=this;b.renderData.headerCls=b.renderData.headerCls||b.headerCls;return b.callParent(arguments)},destroy:function(){if(this.headerView){this.headerView.destroy()}this.callParent(arguments)},onTimeAxisViewRefresh:function(){this.headerView.un("refresh",this.onTimeAxisViewRefresh,this);this.setWidth(this.timeAxisViewModel.getTotalWidth());this.headerView.on("refresh",this.onTimeAxisViewRefresh,this)},getAvailableWidthForSchedule:function(){var f=this.ownerCt.getWidth();var e=this.ownerCt.items;for(var d=1;d<e.length;d++){f-=e.get(d).getWidth()}return f-Ext.getScrollbarSize().width-1},onResize:function(){this.callParent(arguments);this.timeAxisViewModel.setAvailableWidth(this.getAvailableWidthForSchedule())},onHeaderContainerResize:function(){this.timeAxisViewModel.setAvailableWidth(this.getAvailableWidthForSchedule());this.headerView.render()},refresh:function(){this.timeAxisViewModel.update(null,true);this.headerView.render()}});Ext.define("Sch.mixin.Lockable",{extend:"Ext.grid.locking.Lockable",useSpacer:true,syncRowHeight:false,horizontalScrollForced:false,injectLockable:function(){var o=this;var q=Ext.data.TreeStore&&o.store instanceof Ext.data.TreeStore;var v=o.getEventSelectionModel?o.getEventSelectionModel():o.getSelectionModel();o.lockedGridConfig=Ext.apply({},o.lockedGridConfig||{});o.normalGridConfig=Ext.apply({},o.schedulerConfig||o.normalGridConfig||{});if(o.lockedXType){o.lockedGridConfig.xtype=o.lockedXType}if(o.normalXType){o.normalGridConfig.xtype=o.normalXType}var x=o.lockedGridConfig,p=o.normalGridConfig;Ext.applyIf(o.lockedGridConfig,{useArrows:true,trackMouseOver:false,split:true,animCollapse:false,collapseDirection:"left",region:"west"});Ext.applyIf(o.normalGridConfig,{viewType:o.viewType,layout:"fit",sortableColumns:false,enableColumnMove:false,enableColumnResize:false,enableColumnHide:false,getSchedulingView:function(){var a=typeof console!=="undefined"?console:false;if(a&&a.log){a.log('getSchedulingView is deprecated on the inner grid panel. Instead use getView on the "normal" subgrid.')}return this.getView()},selModel:v,collapseDirection:"right",animCollapse:false,region:"center"});if(o.orientation==="vertical"){x.store=p.store=o.timeAxis}if(x.width){o.syncLockedWidth=Ext.emptyFn;x.scroll="horizontal";x.scrollerOwner=true}var t=o.lockedViewConfig=o.lockedViewConfig||{};var n=o.normalViewConfig=o.normalViewConfig||{};if(q){var r=Ext.tree.View.prototype.onUpdate;t.onUpdate=function(){this.refreshSize=function(){var b=this,a=b.getBodySelector();if(a){b.body.attach(b.el.child(a,true))}};Ext.suspendLayouts();r.apply(this,arguments);Ext.resumeLayouts();this.refreshSize=Ext.tree.View.prototype.refreshSize};if(Ext.versions.extjs.isLessThan("5.0")){t.store=n.store=o.store.nodeStore}}var s=o.layout;var u=x.width;this.callParent(arguments);this.on("afterrender",function(){var a=this.lockedGrid.headerCt.showMenuBy;this.lockedGrid.headerCt.showMenuBy=function(){a.apply(this,arguments);o.showMenuBy.apply(this,arguments)}});var m=o.lockedGrid.getView();var w=o.normalGrid.getView();this.patchViews();if(u||s==="border"){if(u){o.lockedGrid.setWidth(u)}w.addCls("sch-timeline-horizontal-scroll");m.addCls("sch-locked-horizontal-scroll");o.horizontalScrollForced=true}if(o.normalGrid.collapsed){o.normalGrid.collapsed=false;w.on("boxready",function(){o.normalGrid.collapse()},o,{delay:10})}if(o.lockedGrid.collapsed){if(m.bufferedRenderer){m.bufferedRenderer.disabled=true}}if(Ext.getScrollbarSize().width===0){m.addCls("sch-ganttpanel-force-locked-scroll")}if(q){this.setupLockableTree()}if(o.useSpacer){w.on("refresh",o.updateSpacer,o);m.on("refresh",o.updateSpacer,o)}if(s!=="fit"){o.layout=s}if(w.bufferedRenderer){this.lockedGrid.on("expand",function(){m.el.dom.scrollTop=w.el.dom.scrollTop});this.patchSubGrid(this.lockedGrid,true);this.patchSubGrid(this.normalGrid,false);this.patchBufferedRenderingPlugin(w.bufferedRenderer);this.patchBufferedRenderingPlugin(m.bufferedRenderer)}this.patchSyncHorizontalScroll(this.lockedGrid);this.patchSyncHorizontalScroll(this.normalGrid);this.delayReordererPlugin(this.lockedGrid);this.delayReordererPlugin(this.normalGrid);this.fixHeaderResizer(this.lockedGrid);this.fixHeaderResizer(this.normalGrid)},setupLockableTree:function(){var f=this;var d=f.lockedGrid.getView();var e=Sch.mixin.FilterableTreeView.prototype;d.initTreeFiltering=e.initTreeFiltering;d.onFilterChangeStart=e.onFilterChangeStart;d.onFilterChangeEnd=e.onFilterChangeEnd;d.onFilterCleared=e.onFilterCleared;d.onFilterSet=e.onFilterSet;d.initTreeFiltering()},patchSyncHorizontalScroll:function(b){b.scrollTask=new Ext.util.DelayedTask(function(e,a){var f=this.getScrollTarget().el;if(f){this.syncHorizontalScroll(f.dom.scrollLeft,a)}},b)},delayReordererPlugin:function(d){var f=d.headerCt;var e=f.reorderer;if(e){f.un("render",e.onHeaderCtRender,e);f.on("render",function(){if(!f.isDestroyed){e.onHeaderCtRender()}},e,{single:true,delay:10})}},fixHeaderResizer:function(f){var h=f.headerCt;var g=h.resizer;if(g){var e=g.onBeforeStart;g.onBeforeStart=function(){if(this.activeHd&&this.activeHd.isDestroyed){return false}return e.apply(this,arguments)}}},updateSpacer:function(){var l=this.lockedGrid.getView();var n=this.normalGrid.getView();if(l.rendered&&n.rendered&&l.el.child("table")){var m=this,p=l.el,o=n.el.dom,i=p.dom.id+"-spacer",k=(o.offsetHeight-o.clientHeight)+"px";m.spacerEl=Ext.getDom(i);if(Ext.isIE6||Ext.isIE7||(Ext.isIEQuirks&&Ext.isIE8)&&m.spacerEl){Ext.removeNode(m.spacerEl);m.spacerEl=null}if(m.spacerEl){m.spacerEl.style.height=k}else{var j=p;Ext.core.DomHelper.append(j,{id:i,style:"height: "+k})}}},onLockedViewScroll:function(){this.callParent(arguments);var b=this.lockedGrid.getView().bufferedRenderer;if(b){b.onViewScroll()}},onNormalViewScroll:function(){this.callParent(arguments);var b=this.normalGrid.getView().bufferedRenderer;if(b){b.onViewScroll()}},patchSubGrid:function(m,k){var o=m.getView();var l=o.bufferedRenderer;m.on({collapse:function(){l.disabled=true},expand:function(){l.disabled=false}});var n=o.collectData;o.collectData=function(){var a=n.apply(this,arguments);var b=a.tableStyle;if(b&&b[b.length-1]!="x"){a.tableStyle+="px"}return a};var p=Ext.data.TreeStore&&this.store instanceof Ext.data.TreeStore;if(!k&&p){var i=o.onRemove;o.onRemove=function(){var a=this;if(a.rendered&&a.bufferedRenderer){a.refreshView()}else{i.apply(this,arguments)}}}var j=o.onAdd;o.onAdd=function(){var a=this;if(a.rendered&&a.bufferedRenderer){a.refreshView()}else{j.apply(this,arguments)}};o.bindStore(null);o.bindStore(p?this.store.nodeStore:this.resourceStore)},afterLockedViewLayout:function(){if(!this.horizontalScrollForced){return this.callParent(arguments)}},patchBufferedRenderingPlugin:function(f){f.variableRowHeight=true;if(Ext.getVersion("extjs").isLessThan("4.2.1.883")){f.view.on("afterrender",function(){f.view.el.un("scroll",f.onViewScroll,f)},this,{single:true,delay:1});var d=f.stretchView;f.stretchView=function(c,h){var a=this,b=(a.store.buffered?a.store.getTotalCount():a.store.getCount());if(b&&(a.view.all.endIndex===b-1)){h=a.bodyTop+c.body.dom.offsetHeight}d.apply(this,[c,h])}}else{var e=f.enable;f.enable=function(){if(f.grid.collapsed){return}return e.apply(this,arguments)}}},showMenuBy:function(g,i){var j=this.getMenu(),l=j.down("#unlockItem"),k=j.down("#lockItem"),h=l.prev();h.hide();l.hide();k.hide()},patchViews:function(){if(Ext.isIE){var n=this.getSelectionModel();var k=this;var l=k.lockedGrid.view;var m=k.normalGrid.view;var j=n.processSelection;var o=Ext.getVersion("extjs").isLessThan("4.2.2.1144")?"mousedown":"click";var p=l.doFocus?"doFocus":"focus";n.processSelection=function(c,d,a,b,f){var e,g;if(f.type==o){e=l.scrollRowIntoView;g=l[p];l.scrollRowIntoView=m.scrollRowIntoView=Ext.emptyFn;l[p]=m[p]=Ext.emptyFn}j.apply(this,arguments);if(f.type==o){l.scrollRowIntoView=m.scrollRowIntoView=e;l[p]=m[p]=g;l.el.focus()}};var i=m.onRowFocus;m.onRowFocus=function(b,c,a){i.call(this,b,c,true)};if(Ext.tree&&Ext.tree.plugin&&Ext.tree.plugin.TreeViewDragDrop){l.on("afterrender",function(){Ext.each(l.plugins,function(b){if(b instanceof Ext.tree.plugin.TreeViewDragDrop){var a=l[p];b.dragZone.view.un("itemmousedown",b.dragZone.onItemMouseDown,b.dragZone);b.dragZone.view.on("itemmousedown",function(){l[p]=Ext.emptyFn;if(l.editingPlugin){l.editingPlugin.completeEdit()}b.dragZone.onItemMouseDown.apply(b.dragZone,arguments);l[p]=a});return false}})},null,{delay:100})}}}});Ext.define("Sch.plugin.TreeCellEditing",{extend:"Ext.grid.plugin.CellEditing",alias:"plugin.scheduler_treecellediting",lockableScope:"locked",editorsStarted:0,init:function(b){this._grid=b;this.on("beforeedit",this.checkReadOnly,this);this.callParent(arguments)},bindPositionFixer:function(){Ext.on({afterlayout:this.fixEditorPosition,scope:this})},unbindPositionFixer:function(){Ext.un({afterlayout:this.fixEditorPosition,scope:this})},fixEditorPosition:function(){var e=this.getActiveEditor();if(e&&e.getEl()){var f=this.getEditingContext(this.context.record,this.context.column);if(f){this.context.row=f.row;this.context.rowIdx=f.rowIdx;e.boundEl=this.getCell(f.record,f.column);e.realign();this.scroll=this.view.el.getScroll();var d=this._grid.getView();d.focusedRow=d.getNode(f.rowIdx)}}},checkReadOnly:function(){var b=this._grid;if(!(b instanceof Sch.panel.TimelineTreePanel)){b=b.up("tablepanel")}return !b.isReadOnly()},startEdit:function(f,h,e){this._grid.suspendLayouts();var g=this.callParent(arguments);this._grid.resumeLayouts();return g},onEditComplete:function(l,i,g){var j=this,h,k;if(l.field.applyChanges){h=l.field.task||j.context.record;k=true;h.set=function(){delete h.set;k=false;l.field.applyChanges(h)}}this.callParent(arguments);if(k){delete h.set}this.unbindPositionFixer()},showEditor:function(o,r,j){var q=this.grid.getSelectionModel();var l;var m=this;this.editorsStarted++;if(!o.hideEditOverridden){var p=o.hideEdit;o.hideEdit=function(){m.editorsStarted--;if(!m.editorsStarted){p.apply(this,arguments)}};o.hideEditOverridden=true}if(Ext.isIE&&Ext.getVersion("extjs").isLessThan("4.2.2.1144")){l=q.selectByPosition;q.selectByPosition=Ext.emptyFn;this.view.focusedRow=this.view.getNode(r.record)}var k=o.field;if(k&&k.setSuppressTaskUpdate){k.setSuppressTaskUpdate(true);if(!o.startEditOverridden){o.startEditOverridden=true;var n=o.startEdit;o.startEdit=function(){n.apply(this,arguments);k.setSuppressTaskUpdate(false)}}}if(k){if(k.setTask){k.setTask(r.record);j=r.value=r.originalValue=k.getValue()}else{if(!r.column.dataIndex&&r.value===undefined){j=r.value=k.getDisplayValue(r.record)}}}if(Ext.isIE8m&&Ext.getVersion("extjs").toString()==="4.2.2.1144"){Ext.EventObject.type="click"}this.callParent([o,r,j]);if(l){q.selectByPosition=l}this.bindPositionFixer()},cancelEdit:function(){this.callParent(arguments);this.unbindPositionFixer()}});Ext.define("Sch.feature.ResizeZone",{extend:"Ext.util.Observable",requires:["Ext.resizer.Resizer","Sch.tooltip.Tooltip","Sch.util.ScrollManager"],showTooltip:true,showExactResizePosition:false,validatorFn:Ext.emptyFn,validatorFnScope:null,schedulerView:null,origEl:null,handlePos:null,eventRec:null,tip:null,startScroll:null,constructor:function(d){Ext.apply(this,d);var c=this.schedulerView;c.on({destroy:this.cleanUp,scope:this});c.mon(c.el,{mousedown:this.onMouseDown,mouseup:this.onMouseUp,scope:this,delegate:".sch-resizable-handle"});this.callParent(arguments)},onMouseDown:function(h,g){var e=this.schedulerView;var i=this.eventRec=e.resolveEventRecord(g);var j=i.isResizable();if(h.button!==0||(j===false||typeof j==="string"&&!g.className.match(j))){return}this.eventRec=i;this.handlePos=this.getHandlePosition(g);this.origEl=Ext.get(h.getTarget(".sch-event"));e.el.on({mousemove:this.onMouseMove,scope:this,single:true})},onMouseUp:function(f,e){var d=this.schedulerView;d.el.un({mousemove:this.onMouseMove,scope:this,single:true})},onMouseMove:function(i,h){var e=this.schedulerView;var j=this.eventRec;var k=this.handlePos;if(!j||e.fireEvent("beforeeventresize",e,j,i)===false){return}delete this.eventRec;i.stopEvent();this.resizer=this.createResizer(this.origEl,j,k,i,h);var l=this.resizer.resizeTracker;if(this.showTooltip){if(!this.tip){this.tip=Ext.create("Sch.tooltip.Tooltip",{rtl:this.rtl,schedulerView:e,renderTo:e.up("[lockable=true]").el,cls:"sch-resize-tip"})}this.tip.update(j.getStartDate(),j.getEndDate(),true);this.tip.show(this.origEl)}l.onMouseDown(i,this.resizer[k].dom);l.onMouseMove(i,this.resizer[k].dom);e.fireEvent("eventresizestart",e,j);e.el.on("scroll",this.onViewElScroll,this)},getHandlePosition:function(c){var d=c.className.match("start");if(this.schedulerView.getOrientation()==="horizontal"){if(this.schedulerView.rtl){return d?"east":"west"}return d?"west":"east"}else{return d?"north":"south"}},createResizer:function(J,G,w){var z=this.schedulerView,s=this,K=z.getElementFromEventRecord(G),F=z.resolveResource(J),u=z.getSnapPixelAmount(),x=z.getScheduleRegion(F,G),v=z.getDateConstraints(F,G),y=J.getHeight,E=(z.rtl&&w[0]==="e")||(!z.rtl&&w[0]==="w")||w[0]==="n",D=z.getOrientation()==="vertical",H={otherEdgeX:E?K.getRight():K.getLeft(),otherEdgeY:E?K.getBottom():K.getTop(),target:K,isStart:E,startYOffset:K.getY()-K.parent().getY(),startXOffset:K.getX()-K.parent().getX(),dateConstraints:v,resourceRecord:F,eventRecord:G,handles:w[0],minHeight:y,constrainTo:x,listeners:{resizedrag:this.partialResize,resize:this.afterResize,scope:this}};var I=J.id;var B="_"+I;J.id=J.dom.id=B;Ext.cache[B]=Ext.cache[I];if(D){if(u>0){var C=J.getWidth();Ext.apply(H,{minHeight:u,minWidth:C,maxWidth:C,heightIncrement:u})}}else{if(u>0){Ext.apply(H,{minWidth:u,maxHeight:y,widthIncrement:u})}}var A=new Ext.resizer.Resizer(H);if(A.resizeTracker){A.resizeTracker.tolerance=-1;var L=A.resizeTracker.updateDimensions;A.resizeTracker.updateDimensions=function(a){if(!Ext.isWebKit||a.getTarget(".sch-timelineview")){var b;if(D){b=z.el.getScroll().top-s.startScroll.top;A.resizeTracker.minHeight=H.minHeight-Math.abs(b)}else{b=z.el.getScroll().left-s.startScroll.left;A.resizeTracker.minWidth=H.minWidth-Math.abs(b)}L.apply(this,arguments)}};A.resizeTracker.resize=function(b){var a;if(D){a=z.el.getScroll().top-s.startScroll.top;if(w[0]==="s"){b.y-=a}b.height+=Math.abs(a)}else{a=z.el.getScroll().left-s.startScroll.left;if(w[0]==="e"){b.x-=a}b.width+=Math.abs(a)}Ext.resizer.ResizeTracker.prototype.resize.apply(this,arguments)}}J.setStyle("z-index",parseInt(J.getStyle("z-index"),10)+1);Sch.util.ScrollManager.activate(z.el,z.getOrientation());this.startScroll=z.el.getScroll();return A},getStartEndDates:function(){var l=this.resizer,n=l.el,m=this.schedulerView,h=l.isStart,j,i,k;if(h){k=[m.rtl?n.getRight():n.getLeft()+1,n.getTop()];i=l.eventRecord.getEndDate();if(m.snapRelativeToEventStartDate){j=m.getDateFromXY(k);j=m.timeAxis.roundDate(j,l.eventRecord.getStartDate())}else{j=m.getDateFromXY(k,"round")}}else{k=[m.rtl?n.getLeft():n.getRight(),n.getBottom()];j=l.eventRecord.getStartDate();if(m.snapRelativeToEventStartDate){i=m.getDateFromXY(k);i=m.timeAxis.roundDate(i,l.eventRecord.getEndDate())}else{i=m.getDateFromXY(k,"round")}}j=j||l.start;i=i||l.end;if(l.dateConstraints){j=Sch.util.Date.constrain(j,l.dateConstraints.start,l.dateConstraints.end);i=Sch.util.Date.constrain(i,l.dateConstraints.start,l.dateConstraints.end)}return{start:j,end:i}},partialResize:function(E,A,t,v){var e=this.schedulerView,r=v.type==="scroll"?this.resizer.resizeTracker.lastXY:v.getXY(),s=this.getStartEndDates(r),B=s.start,z=s.end,x=E.eventRecord,u=e.isHorizontal();if(u){E.target.el.setY(E.target.parent().getY()+E.startYOffset)}else{E.target.el.setX(E.target.parent().getX()+E.startXOffset)}if(this.showTooltip){var F=this.validatorFn.call(this.validatorFnScope||this,E.resourceRecord,x,B,z)!==false;this.tip.update(B,z,F)}if(this.showExactResizePosition){var w=E.target.el,C,D,y;if(E.isStart){C=e.timeAxisViewModel.getDistanceBetweenDates(B,x.getEndDate());if(u){D=e.getDateFromCoordinate(E.otherEdgeX-Math.min(A,E.maxWidth))||B;y=e.timeAxisViewModel.getDistanceBetweenDates(D,B);w.setWidth(C);w.setX(w.getX()+y)}else{D=e.getDateFromCoordinate(E.otherEdgeY-Math.min(A,E.maxHeight))||B;y=e.timeAxisViewModel.getDistanceBetweenDates(D,B);w.setHeight(C);w.setY(w.getY()+y)}}else{C=e.timeAxisViewModel.getDistanceBetweenDates(x.getStartDate(),z);if(u){w.setWidth(C)}else{w.setHeight(C)}}}else{if(!B||!z||((E.start-B===0)&&(E.end-z===0))){return}}E.end=z;E.start=B;e.fireEvent("eventpartialresize",e,x,B,z,E.el)},onViewElScroll:function(c,d){this.resizer.resizeTracker.onDrag.apply(this.resizer.resizeTracker,arguments);this.partialResize(this.resizer,0,0,c)},afterResize:function(B,r,x,w){var u=this,v=B.resourceRecord,t=B.eventRecord,y=t.getStartDate(),e=t.getEndDate(),A=B.start||y,z=B.end||e,h=u.schedulerView,q=false,s=true;Sch.util.ScrollManager.deactivate();h.el.un("scroll",this.onViewElScroll,this);if(this.showTooltip){this.tip.hide()}delete Ext.cache[B.el.id];B.el.id=B.el.dom.id=B.el.id.substr(1);u.resizeContext={resourceRecord:B.resourceRecord,eventRecord:t,start:A,end:z,finalize:function(){u.finalize.apply(u,arguments)}};if(A&&z&&(z-A>0)&&((A-y!==0)||(z-e!==0))&&u.validatorFn.call(u.validatorFnScope||u,v,t,A,z,w)!==false){s=h.fireEvent("beforeeventresizefinalize",u,u.resizeContext,w)!==false;q=true}else{h.repaintEventsForResource(v)}if(s){u.finalize(q)}},finalize:function(f){var e=this.schedulerView;var g=this.resizeContext;var h=false;g.eventRecord.store.on("update",function(){h=true},null,{single:true});if(f){if(this.resizer.isStart){g.eventRecord.setStartDate(g.start,false,e.eventStore.skipWeekendsDuringDragDrop)}else{g.eventRecord.setEndDate(g.end,false,e.eventStore.skipWeekendsDuringDragDrop)}if(!h){e.repaintEventsForResource(g.resourceRecord)}}else{e.repaintEventsForResource(g.resourceRecord)}this.resizer.destroy();e.fireEvent("eventresizeend",e,g.eventRecord);this.resizeContext=null},cleanUp:function(){if(this.tip){this.tip.destroy()}}});Ext.define("Sch.feature.ColumnLines",{extend:"Sch.plugin.Lines",requires:["Ext.data.JsonStore"],cls:"sch-column-line",showTip:false,timeAxisViewModel:null,renderingDoneEvent:"columnlinessynced",init:function(b){this.timeAxis=b.getTimeAxis();this.timeAxisViewModel=b.timeAxisViewModel;this.panel=b;this.store=new Ext.data.JsonStore({fields:["Date"]});this.store.loadData=this.store.loadData||this.store.setData;this.callParent(arguments);b.on({orientationchange:this.populate,destroy:this.onHostDestroy,scope:this});this.timeAxisViewModel.on("update",this.populate,this);this.populate()},onHostDestroy:function(){this.timeAxisViewModel.un("update",this.populate,this)},populate:function(){this.store.loadData(this.getData())},getElementData:function(){var b=this.schedulerView;if(b.isHorizontal()&&b.store.getCount()>0){return this.callParent(arguments)}return[]},getData:function(){var i=this.panel,l=[];if(i.isHorizontal()){var k=this.timeAxisViewModel;var n=k.columnLinesFor;var m=!!(k.headerConfig&&k.headerConfig[n].cellGenerator);if(m){var p=k.getColumnConfig()[n];for(var o=1,j=p.length;o<j;o++){l.push({Date:p[o].start})}}else{k.forEachInterval(n,function(a,c,b){if(b>0){l.push({Date:a})}})}}return l}});Ext.define("Sch.plugin.CurrentTimeLine",{extend:"Sch.plugin.Lines",alias:"plugin.scheduler_currenttimeline",mixins:["Sch.mixin.Localizable"],requires:["Ext.data.JsonStore"],updateInterval:60000,showHeaderElements:true,autoUpdate:true,expandToFitView:true,timer:null,init:function(f){if(Ext.getVersion("touch")){this.showHeaderElements=false}var d=new Ext.data.JsonStore({fields:["Date","Cls","Text"],data:[{Date:new Date(),Cls:"sch-todayLine",Text:this.L("tooltipText")}]});var e=d.first();if(this.autoUpdate){this.timer=setInterval(function(){e.set("Date",new Date())},this.updateInterval)}f.on("destroy",this.onHostDestroy,this);this.store=d;this.callParent(arguments)},onHostDestroy:function(){if(this.timer){clearInterval(this.timer);this.timer=null}if(this.store.autoDestroy){this.store.destroy()}}});Ext.define("Sch.view.Horizontal",{requires:["Ext.util.Region","Ext.Element","Sch.util.Date"],view:null,constructor:function(b){Ext.apply(this,b)},translateToScheduleCoordinate:function(d){var c=this.view;if(c.rtl){return c.getTimeAxisColumn().getEl().getRight()-d}return d-c.getEl().getX()+c.getScroll().left},translateToPageCoordinate:function(d){var c=this.view;return d+c.getEl().getX()-c.getScroll().left},getEventRenderData:function(x,w,v){var q=w||x.getStartDate(),r=v||x.getEndDate()||q,o=this.view,s=o.timeAxis.getStart(),n=o.timeAxis.getEnd(),p=Math,t=o.getXFromDate(Sch.util.Date.max(q,s)),m=o.getXFromDate(Sch.util.Date.min(r,n)),u={};if(this.view.rtl){u.right=p.min(t,m)}else{u.left=p.min(t,m)}u.width=p.max(1,p.abs(m-t))-o.eventBorderWidth;if(o.managedEventSizing){u.top=p.max(0,(o.barMargin-((Ext.isIE&&!Ext.isStrict)?0:o.eventBorderWidth-o.cellTopBorderWidth)));u.height=o.timeAxisViewModel.rowHeightHorizontal-(2*o.barMargin)-o.eventBorderWidth}u.start=q;u.end=r;u.startsOutsideView=q<s;u.endsOutsideView=r>n;return u},getScheduleRegion:function(t,r){var v=Ext.Element.prototype.getRegion?"getRegion":"getPageBox",o=this.view,p=t?Ext.fly(o.getRowNode(t))[v]():o.getTableRegion(),s=o.timeAxis.getStart(),m=o.timeAxis.getEnd(),w=o.getDateConstraints(t,r)||{start:s,end:m},u=this.translateToPageCoordinate(o.getXFromDate(Sch.util.Date.max(s,w.start))),n=this.translateToPageCoordinate(o.getXFromDate(Sch.util.Date.min(m,w.end))),q=p.top+o.barMargin,x=p.bottom-o.barMargin-o.eventBorderWidth;return new Ext.util.Region(q,Math.max(u,n),x,Math.min(u,n))},getResourceRegion:function(u,z,v){var r=this.view,A=r.getRowNode(u),y=Ext.fly(A).getOffsetsTo(r.getEl()),t=r.timeAxis.getStart(),p=r.timeAxis.getEnd(),B=z?Sch.util.Date.max(t,z):t,x=v?Sch.util.Date.min(p,v):p,w=r.getXFromDate(B),q=r.getXFromDate(x),s=y[1]+r.cellTopBorderWidth,D=y[1]+Ext.fly(A).getHeight()-r.cellBottomBorderWidth;if(!Ext.versions.touch){var C=r.getScroll();s+=C.top;D+=C.top}return new Ext.util.Region(s,Math.max(w,q),D,Math.min(w,q))},columnRenderer:function(A,i,u,s,l){var r=this.view;var C=r.eventStore.getEventsForResource(u);if(C.length===0){return}var w=r.timeAxis,t=[],x,z;for(x=0,z=C.length;x<z;x++){var D=C[x],B=D.getStartDate(),y=D.getEndDate();if(B&&y&&w.timeSpanInAxis(B,y)){t[t.length]=r.generateTplData(D,u,s)}}if(r.dynamicRowHeight){var v=r.eventLayout.horizontal;v.applyLayout(t,u);i.rowHeight=v.getRowHeight(u,C)}return r.eventTpl.apply(t)},resolveResource:function(d){var e=this.view;var f=e.findRowByChild(d);if(f){return e.getRecordForRowNode(f)}return null},getTimeSpanRegion:function(i,k,l){var o=this.view,p=o.getXFromDate(i),n=k?o.getXFromDate(k):p,j,m;m=o.getTableRegion();if(l){j=Math.max(m?m.bottom-m.top:0,o.getEl().dom.clientHeight)}else{j=m?m.bottom-m.top:0}return new Ext.util.Region(0,Math.max(p,n),j,Math.min(p,n))},getStartEndDatesFromRegion:function(j,m,n){var h=this.view;var k=h.rtl;var i=h.getDateFromCoordinate(k?j.right:j.left,m),l=h.getDateFromCoordinate(k?j.left:j.right,m);if(i&&l||n&&(i||l)){return{start:i,end:l}}return null},onEventAdd:function(i,j){var k=this.view;var p={};for(var l=0,r=j.length;l<r;l++){var t=j[l].getResources(k.eventStore);for(var o=0,q=t.length;o<q;o++){var s=t[o];p[s.getId()]=s}}Ext.Object.each(p,function(a,b){k.repaintEventsForResource(b)})},onEventRemove:function(i,p){var m=this.view;var l=this.resourceStore;var o=Ext.tree&&Ext.tree.View&&m instanceof Ext.tree.View;if(!Ext.isArray(p)){p=[p]}var n=function(a){if(m.store.indexOf(a)>=0){m.repaintEventsForResource(a)}};for(var q=0;q<p.length;q++){var t=p[q].getResources(m.eventStore);if(t.length>1){Ext.each(t,n,this)}else{var s=m.getEventNodeByRecord(p[q]);if(s){var r=m.resolveResource(s);if(Ext.Element.prototype.fadeOut){Ext.get(s).fadeOut({callback:function(){n(r)}})}else{Ext.Anim.run(Ext.get(s),"fade",{out:true,duration:500,after:function(){n(r)},autoClear:false})}}}}},onEventUpdate:function(n,m,h){var l=m.previous;var i=this.view;if(l&&l[m.resourceIdField]){var k=m.getResource(l[m.resourceIdField],i.eventStore);if(k){i.repaintEventsForResource(k,true)}}var j=m.getResources(i.eventStore);Ext.each(j,function(a){i.repaintEventsForResource(a,true)})},setColumnWidth:function(f,d){var e=this.view;e.getTimeAxisViewModel().setViewColumnWidth(f,d)},getVisibleDateRange:function(){var k=this.view;if(!k.getEl()){return null}var l=k.getTableRegion(),g=k.timeAxis.getStart(),i=k.timeAxis.getEnd(),j=k.getWidth();if((l.right-l.left)<j){return{startDate:g,endDate:i}}var h=k.getScroll();return{startDate:k.getDateFromCoordinate(h.left,null,true),endDate:k.getDateFromCoordinate(h.left+j,null,true)}}});Ext.define("Sch.mixin.AbstractTimelineView",{requires:["Sch.data.TimeAxis","Sch.view.Horizontal"],selectedEventCls:"sch-event-selected",readOnly:false,horizontalViewClass:"Sch.view.Horizontal",timeCellCls:"sch-timetd",timeCellSelector:".sch-timetd",eventBorderWidth:1,timeAxis:null,timeAxisViewModel:null,eventPrefix:null,rowHeight:null,orientation:"horizontal",horizontal:null,vertical:null,secondaryCanvasEl:null,panel:null,displayDateFormat:null,el:null,_initializeTimelineView:function(){if(this.horizontalViewClass){this.horizontal=Ext.create(this.horizontalViewClass,{view:this})}if(this.verticalViewClass){this.vertical=Ext.create(this.verticalViewClass,{view:this})}this.eventPrefix=(this.eventPrefix||this.getId())+"-"},getTimeAxisViewModel:function(){return this.timeAxisViewModel},getFormattedDate:function(b){return Ext.Date.format(b,this.getDisplayDateFormat())},getFormattedEndDate:function(f,e){var d=this.getDisplayDateFormat();if(f.getHours()===0&&f.getMinutes()===0&&!(f.getYear()===e.getYear()&&f.getMonth()===e.getMonth()&&f.getDate()===e.getDate())&&!Sch.util.Date.hourInfoRe.test(d.replace(Sch.util.Date.stripEscapeRe,""))){f=Sch.util.Date.add(f,Sch.util.Date.DAY,-1)}return Ext.Date.format(f,d)},getDisplayDateFormat:function(){return this.displayDateFormat},setDisplayDateFormat:function(b){this.displayDateFormat=b},fitColumns:function(c){if(this.orientation==="horizontal"){this.getTimeAxisViewModel().fitToAvailableWidth(c)}else{var d=Math.floor((this.panel.getWidth()-Ext.getScrollbarSize().width-1)/this.headerCt.getColumnCount());this.setColumnWidth(d,c)}},getElementFromEventRecord:function(b){return Ext.get(this.eventPrefix+b.internalId)},getEventNodeByRecord:function(b){return document.getElementById(this.eventPrefix+b.internalId)},getEventNodesByRecord:function(b){return this.el.select("[id="+this.eventPrefix+b.internalId+"]")},getStartEndDatesFromRegion:function(f,d,e){return this[this.orientation].getStartEndDatesFromRegion(f,d,e)},getTimeResolution:function(){return this.timeAxis.getResolution()},setTimeResolution:function(c,d){this.timeAxis.setResolution(c,d);if(this.getTimeAxisViewModel().snapToIncrement){this.refreshKeepingScroll()}},getEventIdFromDomNodeId:function(b){return b.substring(this.eventPrefix.length)},getDateFromDomEvent:function(c,d){return this.getDateFromXY(c.getXY(),d)},getSnapPixelAmount:function(){return this.getTimeAxisViewModel().getSnapPixelAmount()},getTimeColumnWidth:function(){return this.getTimeAxisViewModel().getTickWidth()},setSnapEnabled:function(b){this.getTimeAxisViewModel().setSnapToIncrement(b)},setReadOnly:function(b){this.readOnly=b;this[b?"addCls":"removeCls"](this._cmpCls+"-readonly")},isReadOnly:function(){return this.readOnly},setOrientation:function(b){this.orientation=b;this.timeAxisViewModel.orientation=b},getOrientation:function(){return this.orientation},isHorizontal:function(){return this.getOrientation()==="horizontal"},isVertical:function(){return !this.isHorizontal()},getDateFromXY:function(f,d,e){return this.getDateFromCoordinate(this.orientation==="horizontal"?f[0]:f[1],d,e)},getDateFromCoordinate:function(f,d,e){if(!e){f=this[this.orientation].translateToScheduleCoordinate(f)}return this.timeAxisViewModel.getDateFromPosition(f,d)},getDateFromX:function(d,c){return this.getDateFromCoordinate(d,c)},getDateFromY:function(c,d){return this.getDateFromCoordinate(c,d)},getCoordinateFromDate:function(e,d){var f=this.timeAxisViewModel.getPositionFromDate(e);if(d===false){f=this[this.orientation].translateToPageCoordinate(f)}return Math.round(f)},getXFromDate:function(d,c){return this.getCoordinateFromDate(d,c)},getYFromDate:function(d,c){return this.getCoordinateFromDate(d,c)},getTimeSpanDistance:function(d,c){return this.timeAxisViewModel.getDistanceBetweenDates(d,c)},getTimeSpanRegion:function(d,c){return this[this.orientation].getTimeSpanRegion(d,c)},getScheduleRegion:function(c,d){return this[this.orientation].getScheduleRegion(c,d)},getTableRegion:function(){throw"Abstract method call"},getRowNode:function(b){throw"Abstract method call"},getRecordForRowNode:function(b){throw"Abstract method call"},getVisibleDateRange:function(){return this[this.orientation].getVisibleDateRange()},setColumnWidth:function(c,d){this[this.orientation].setColumnWidth(c,d)},findRowByChild:function(b){throw"Abstract method call"},setBarMargin:function(c,d){this.barMargin=c;if(!d){this.refreshKeepingScroll()}},getRowHeight:function(){return this.timeAxisViewModel.getViewRowHeight()},setRowHeight:function(d,c){this.timeAxisViewModel.setViewRowHeight(d,c)},refreshKeepingScroll:function(){throw"Abstract method call"},scrollVerticallyTo:function(c,d){throw"Abstract method call"},scrollHorizontallyTo:function(d,c){throw"Abstract method call"},getVerticalScroll:function(){throw"Abstract method call"},getHorizontalScroll:function(){throw"Abstract method call"},getEl:Ext.emptyFn,getSecondaryCanvasEl:function(){if(!this.rendered){throw"Calling this method too early"}if(!this.secondaryCanvasEl){this.secondaryCanvasEl=this.getEl().createChild({cls:"sch-secondary-canvas"})}return this.secondaryCanvasEl},getScroll:function(){throw"Abstract method call"},getOuterEl:function(){return this.getEl()},getRowContainerEl:function(){return this.getEl()},getScheduleCell:function(c,d){return this.getCellByPosition({row:c,column:d})},getScrollEventSource:function(){return this.getEl()},getViewportHeight:function(){return this.getEl().getHeight()},getViewportWidth:function(){return this.getEl().getWidth()},getDateConstraints:Ext.emptyFn});Ext.apply(Sch,{VERSION:"2.2.21"});Ext.define("Sch.mixin.TimelineView",{extend:"Sch.mixin.AbstractTimelineView",requires:["Ext.tip.ToolTip"],overScheduledEventClass:"sch-event-hover",ScheduleEventMap:{click:"Click",mousedown:"MouseDown",mouseup:"MouseUp",dblclick:"DblClick",contextmenu:"ContextMenu",keydown:"KeyDown",keyup:"KeyUp"},preventOverCls:false,_initializeTimelineView:function(){this.callParent(arguments);this.on("destroy",this._onDestroy,this);this.on("afterrender",this._onAfterRender,this);this.setOrientation(this.orientation);this.enableBubble("columnwidthchange");this.addCls("sch-timelineview");if(this.readOnly){this.addCls(this._cmpCls+"-readonly")}this.addCls(this._cmpCls);if(this.eventAnimations){this.addCls("sch-animations-enabled")}},inheritables:function(){return{processUIEvent:function(i){var g=i.getTarget(this.eventSelector),j=this.ScheduleEventMap,e=i.type,h=false;if(g&&e in j){this.fireEvent(this.scheduledEventName+e,this,this.resolveEventRecord(g),i);h=!(this.getSelectionModel() instanceof Ext.selection.RowModel)}if(!h){return this.callParent(arguments)}}}},_onDestroy:function(){if(this.tip){this.tip.destroy()}},_onAfterRender:function(){if(this.overScheduledEventClass){this.setMouseOverEnabled(true)}if(this.tooltipTpl){this.el.on("mousemove",this.setupTooltip,this,{single:true})}var f=this.bufferedRenderer;if(f){this.patchBufferedRenderingPlugin(f);this.patchBufferedRenderingPlugin(this.lockingPartner.bufferedRenderer)}this.on("bufferedrefresh",this.onBufferedRefresh,this,{buffer:10});this.setupTimeCellEvents();var d=this.getSecondaryCanvasEl();if(d.getStyle("position").toLowerCase()!=="absolute"){var e=Ext.Msg||window}},patchBufferedRenderingPlugin:function(f){var d=this;var e=f.setBodyTop;f.setBodyTop=function(c,b){if(c<0){c=0}var a=e.apply(this,arguments);d.fireEvent("bufferedrefresh",this);return a}},onBufferedRefresh:function(){this.getSecondaryCanvasEl().dom.style.top=this.body.dom.style.top},setMouseOverEnabled:function(b){this[b?"mon":"mun"](this.el,{mouseover:this.onEventMouseOver,mouseout:this.onEventMouseOut,delegate:this.eventSelector,scope:this})},onEventMouseOver:function(f,e){if(e!==this.lastItem&&!this.preventOverCls){this.lastItem=e;Ext.fly(e).addCls(this.overScheduledEventClass);var d=this.resolveEventRecord(e);if(d){this.fireEvent("eventmouseenter",this,d,f)}}},onEventMouseOut:function(c,d){if(this.lastItem){if(!c.within(this.lastItem,true,true)){Ext.fly(this.lastItem).removeCls(this.overScheduledEventClass);this.fireEvent("eventmouseleave",this,this.resolveEventRecord(this.lastItem),c);delete this.lastItem}}},highlightItem:function(c){if(c){var d=this;d.clearHighlight();d.highlightedItem=c;Ext.fly(c).addCls(d.overItemCls)}},setupTooltip:function(){var c=this,d=Ext.apply({renderTo:Ext.getBody(),delegate:c.eventSelector,target:c.el,anchor:"b",rtl:c.rtl,show:function(){Ext.ToolTip.prototype.show.apply(this,arguments);if(this.triggerElement&&c.getOrientation()==="horizontal"){this.setX(this.targetXY[0]-10);this.setY(Ext.fly(this.triggerElement).getY()-this.getHeight()-10)}}},c.tipCfg);c.tip=new Ext.ToolTip(d);c.tip.on({beforeshow:function(a){if(!a.triggerElement||!a.triggerElement.id){return false}var b=this.resolveEventRecord(a.triggerElement);if(!b||this.fireEvent("beforetooltipshow",this,b)===false){return false}a.update(this.tooltipTpl.apply(this.getDataForTooltipTpl(b)))},scope:this})},getTimeAxisColumn:function(){if(!this.timeAxisColumn){this.timeAxisColumn=this.headerCt.down("timeaxiscolumn")}return this.timeAxisColumn},getDataForTooltipTpl:function(b){return Ext.apply({_record:b},b.data)},refreshKeepingScroll:function(){Ext.suspendLayouts();this.saveScrollState();this.refresh();if(this.up("tablepanel[lockable=true]").lockedGridDependsOnSchedule){this.lockingPartner.refresh()}Ext.resumeLayouts(true);if(this.scrollState.left!==0||this.scrollState.top!==0||this.infiniteScroll){this.restoreScrollState()}},setupTimeCellEvents:function(){this.mon(this.el,{click:this.handleScheduleEvent,dblclick:this.handleScheduleEvent,contextmenu:this.handleScheduleEvent,scope:this})},getTableRegion:function(){var b=this.el.down("."+Ext.baseCSSPrefix+(Ext.versions.extjs.isLessThan("5.0")?"grid-table":"grid-item-container"));return(b||this.el).getRegion()},getRowNode:function(b){return this.getNodeByRecord(b)},findRowByChild:function(b){return this.findItemByChild(b)},getRecordForRowNode:function(b){return this.getRecord(b)},refreshKeepingResourceScroll:function(){var b=this.getScroll();this.refresh();if(this.getOrientation()==="horizontal"){this.scrollVerticallyTo(b.top)}else{this.scrollHorizontallyTo(b.left)}},scrollHorizontallyTo:function(e,d){var f=this.getEl();if(f){f.scrollTo("left",Math.max(0,e),d)}},scrollVerticallyTo:function(f,e){var d=this.getEl();if(d){d.scrollTo("top",Math.max(0,f),e)}},getVerticalScroll:function(){var b=this.getEl();return b.getScroll().top},getHorizontalScroll:function(){var b=this.getEl();return b.getScroll().left},getScroll:function(){var b=this.getEl().getScroll();return{top:b.top,left:b.left}},getXYFromDate:function(){var b=this.getCoordinateFromDate.apply(this,arguments);return this.orientation==="horizontal"?[b,0]:[0,b]},handleScheduleEvent:function(b){},scrollElementIntoView:function(I,z,u,E,F){var J=20,v=I.dom,C=I.getOffsetsTo(z=Ext.getDom(z)||Ext.getBody().dom),G=C[0]+z.scrollLeft,y=C[1]+z.scrollTop,B=y+v.offsetHeight,t=G+v.offsetWidth,x=z.clientHeight,D=parseInt(z.scrollTop,10),s=parseInt(z.scrollLeft,10),w=D+x,A=s+z.clientWidth,H;if(F){if(E){E=Ext.apply({listeners:{afteranimate:function(){Ext.fly(v).highlight()}}},E)}else{Ext.fly(v).highlight()}}if(v.offsetHeight>x||y<D){H=y-J}else{if(B>w){H=B-x+J}}if(H!=null){Ext.fly(z).scrollTo("top",H,E)}if(u!==false){H=null;if(v.offsetWidth>z.clientWidth||G<s){H=G-J}else{if(t>A){H=t-z.clientWidth+J}}if(H!=null){Ext.fly(z).scrollTo("left",H,E)}}return I}});if(!Ext.ClassManager.get("Sch.patches.ElementScroll")){Ext.define("Sch.patches.ElementScroll",{override:"Sch.mixin.TimelineView",_onAfterRender:function(){this.callParent(arguments);if(Ext.versions.extjs.isLessThan("4.2.1")||Ext.versions.extjs.isGreaterThan("4.2.2")){return}this.el.scroll=function(j,r,p){if(!this.isScrollable()){return false}j=j.substr(0,1);var k=this,n=k.dom,l=j==="r"||j==="l"?"left":"top",q=false,o,m;if(j==="r"||j==="t"||j==="u"){r=-r}if(l==="left"){o=n.scrollLeft;m=k.constrainScrollLeft(o+r)}else{o=n.scrollTop;m=k.constrainScrollTop(o+r)}if(m!==o){this.scrollTo(l,m,p);q=true}return q}}})}Ext.define("Sch.view.TimelineGridView",{extend:"Ext.grid.View",mixins:["Sch.mixin.TimelineView"],infiniteScroll:false,bufferCoef:5,bufferThreshold:0.2,cachedScrollLeftDate:null,boxIsReady:false,ignoreNextHorizontalScroll:false,constructor:function(b){this.callParent(arguments);if(this.infiniteScroll){this.on("afterrender",this.setupInfiniteScroll,this,{single:true})}if(this.timeAxisViewModel){this.relayEvents(this.timeAxisViewModel,["columnwidthchange"])}},setupInfiniteScroll:function(){var c=this.panel.ownerCt;this.cachedScrollLeftDate=c.startDate||this.timeAxis.getStart();var d=this;c.calculateOptimalDateRange=function(i,j,a,h){if(h){return h}var b=Sch.preset.Manager.getPreset(a.preset);return d.calculateInfiniteScrollingDateRange(i,b.getBottomHeader().unit,a.increment,a.width)};this.el.on("scroll",this.onHorizontalScroll,this);this.on("resize",this.onSelfResize,this)},onHorizontalScroll:function(){if(this.ignoreNextHorizontalScroll||this.cachedScrollLeftDate){this.ignoreNextHorizontalScroll=false;return}var f=this.el.dom,d=this.getWidth(),e=d*this.bufferThreshold*this.bufferCoef;if((f.scrollWidth-f.scrollLeft-d<e)||f.scrollLeft<e){this.shiftToDate(this.getDateFromCoordinate(f.scrollLeft,null,true));this.el.stopAnimation()}},refresh:function(){this.callParent(arguments);if(this.infiniteScroll&&!this.scrollStateSaved&&this.boxIsReady){this.restoreScrollLeftDate()}},onSelfResize:function(j,i,g,f,h){this.boxIsReady=true;if(i!=f){this.shiftToDate(this.cachedScrollLeftDate||this.timeAxis.getStart(),this.cachedScrollCentered)}},restoreScrollLeftDate:function(){if(this.cachedScrollLeftDate&&this.boxIsReady){this.ignoreNextHorizontalScroll=true;this.scrollToDate(this.cachedScrollLeftDate);this.cachedScrollLeftDate=null}},scrollToDate:function(d){this.cachedScrollLeftDate=d;if(this.cachedScrollCentered){this.panel.ownerCt.scrollToDateCentered(d)}else{this.panel.ownerCt.scrollToDate(d)}var c=this.el.dom.scrollLeft;this.panel.scrollLeftPos=c;this.headerCt.el.dom.scrollLeft=c},saveScrollState:function(){this.scrollStateSaved=this.boxIsReady;this.callParent(arguments)},restoreScrollState:function(){this.scrollStateSaved=false;if(this.infiniteScroll&&this.cachedScrollLeftDate){this.restoreScrollLeftDate();this.el.dom.scrollTop=this.scrollState.top;return}this.callParent(arguments)},calculateInfiniteScrollingDateRange:function(n,m,i,j){var l=this.timeAxis;var o=this.getWidth();j=j||this.timeAxisViewModel.getTickWidth();i=i||l.increment||1;m=m||l.unit;var k=Sch.util.Date;var p=Math.ceil(o*this.bufferCoef/j);return{start:l.floorDate(k.add(n,m,-p*i),false,m,i),end:l.ceilDate(k.add(n,m,Math.ceil((o/j+p)*i)),false,m,i)}},shiftToDate:function(d,f){var e=this.calculateInfiniteScrollingDateRange(d);this.cachedScrollLeftDate=d;this.cachedScrollCentered=f;this.timeAxis.setTimeSpan(e.start,e.end)},destroy:function(){if(this.infiniteScroll&&this.rendered){this.el.un("scroll",this.onHorizontalScroll,this)}this.callParent(arguments)}},function(){this.override(Sch.mixin.TimelineView.prototype.inheritables()||{})});Ext.define("Sch.mixin.FilterableTreeView",{prevBlockRefresh:null,initTreeFiltering:function(){var b=function(){var a=this.store.treeStore;this.mon(a,"nodestore-datachange-start",this.onFilterChangeStart,this);this.mon(a,"nodestore-datachange-end",this.onFilterChangeEnd,this);if(!a.allowExpandCollapseWhileFiltered){this.mon(a,"filter-clear",this.onFilterCleared,this);this.mon(a,"filter-set",this.onFilterSet,this)}};if(this.rendered){b.call(this)}else{this.on("beforerender",b,this,{single:true})}},onFilterChangeStart:function(){this.prevBlockRefresh=this.blockRefresh;this.blockRefresh=true;Ext.suspendLayouts()},onFilterChangeEnd:function(){Ext.resumeLayouts(true);this.blockRefresh=this.prevBlockRefresh},onFilterCleared:function(){delete this.toggle;var b=this.getEl();if(b){b.removeCls("sch-tree-filtered")}},onFilterSet:function(){this.toggle=function(){};var b=this.getEl();if(b){b.addCls("sch-tree-filtered")}}});Ext.define("Sch.mixin.Zoomable",{zoomLevels:[{width:40,increment:1,resolution:1,preset:"manyYears",resolutionUnit:"YEAR"},{width:80,increment:1,resolution:1,preset:"manyYears",resolutionUnit:"YEAR"},{width:30,increment:1,resolution:1,preset:"year",resolutionUnit:"MONTH"},{width:50,increment:1,resolution:1,preset:"year",resolutionUnit:"MONTH"},{width:100,increment:1,resolution:1,preset:"year",resolutionUnit:"MONTH"},{width:200,increment:1,resolution:1,preset:"year",resolutionUnit:"MONTH"},{width:100,increment:1,resolution:7,preset:"monthAndYear",resolutionUnit:"DAY"},{width:30,increment:1,resolution:1,preset:"weekDateAndMonth",resolutionUnit:"DAY"},{width:35,increment:1,resolution:1,preset:"weekAndMonth",resolutionUnit:"DAY"},{width:50,increment:1,resolution:1,preset:"weekAndMonth",resolutionUnit:"DAY"},{width:20,increment:1,resolution:1,preset:"weekAndDayLetter"},{width:50,increment:1,resolution:1,preset:"weekAndDay",resolutionUnit:"HOUR"},{width:100,increment:1,resolution:1,preset:"weekAndDay",resolutionUnit:"HOUR"},{width:50,increment:6,resolution:30,preset:"hourAndDay",resolutionUnit:"MINUTE"},{width:100,increment:6,resolution:30,preset:"hourAndDay",resolutionUnit:"MINUTE"},{width:60,increment:2,resolution:30,preset:"hourAndDay",resolutionUnit:"MINUTE"},{width:60,increment:1,resolution:30,preset:"hourAndDay",resolutionUnit:"MINUTE"},{width:30,increment:15,resolution:5,preset:"minuteAndHour"},{width:60,increment:15,resolution:5,preset:"minuteAndHour"},{width:130,increment:15,resolution:5,preset:"minuteAndHour"},{width:60,increment:5,resolution:5,preset:"minuteAndHour"},{width:100,increment:5,resolution:5,preset:"minuteAndHour"},{width:50,increment:2,resolution:1,preset:"minuteAndHour"},{width:30,increment:10,resolution:5,preset:"secondAndMinute"},{width:60,increment:10,resolution:5,preset:"secondAndMinute"},{width:130,increment:5,resolution:5,preset:"secondAndMinute"}],minZoomLevel:null,maxZoomLevel:null,visibleZoomFactor:5,zoomKeepsOriginalTimespan:false,cachedCenterDate:null,isFirstZoom:true,isZooming:false,initializeZooming:function(){this.zoomLevels=this.zoomLevels.slice();this.setMinZoomLevel(this.minZoomLevel||0);this.setMaxZoomLevel(this.maxZoomLevel!==null?this.maxZoomLevel:this.zoomLevels.length-1);this.on("viewchange",this.clearCenterDateCache,this)},getZoomLevelUnit:function(b){return Sch.preset.Manager.getPreset(b.preset).getBottomHeader().unit},getMilliSecondsPerPixelForZoomLevel:function(f,e){var d=Sch.util.Date;return Math.round((d.add(new Date(1,0,1),this.getZoomLevelUnit(f),f.increment)-new Date(1,0,1))/(e?f.width:f.actualWidth||f.width))},presetToZoomLevel:function(c){var d=Sch.preset.Manager.getPreset(c);return{preset:c,increment:d.getBottomHeader().increment||1,resolution:d.timeResolution.increment,resolutionUnit:d.timeResolution.unit,width:d.timeColumnWidth}},zoomLevelToPreset:function(f){var d=Sch.preset.Manager.getPreset(f.preset).clone();var e=d.getBottomHeader();e.increment=f.increment;d.timeColumnWidth=f.width;if(f.resolutionUnit||f.resolution){d.timeResolution={unit:f.resolutionUnit||d.timeResolution.unit||e.unit,increment:f.resolution||d.timeResolution.increment||1}}return d},calculateCurrentZoomLevel:function(){var b=this.presetToZoomLevel(this.viewPreset);b.width=this.timeAxisViewModel.timeColumnWidth;b.increment=this.timeAxisViewModel.getBottomHeader().increment||1;return b},getCurrentZoomLevelIndex:function(){var i=this.calculateCurrentZoomLevel();var g=this.getMilliSecondsPerPixelForZoomLevel(i);var j=this.zoomLevels;for(var l=0;l<j.length;l++){var k=this.getMilliSecondsPerPixelForZoomLevel(j[l]);if(k==g){return l}if(l===0&&g>k){return -0.5}if(l==j.length-1&&g<k){return j.length-1+0.5}var h=this.getMilliSecondsPerPixelForZoomLevel(j[l+1]);if(k>g&&g>h){return l+0.5}}throw"Can't find current zoom level index"},setMaxZoomLevel:function(b){if(b<0||b>=this.zoomLevels.length){throw new Error("Invalid range for `setMinZoomLevel`")}this.maxZoomLevel=b},setMinZoomLevel:function(b){if(b<0||b>=this.zoomLevels.length){throw new Error("Invalid range for `setMinZoomLevel`")}this.minZoomLevel=b},getViewportCenterDateCached:function(){if(this.cachedCenterDate){return this.cachedCenterDate}return this.cachedCenterDate=this.getViewportCenterDate()},clearCenterDateCache:function(){this.cachedCenterDate=null},zoomToLevel:function(M,w,J){M=Ext.Number.constrain(M,this.minZoomLevel,this.maxZoomLevel);J=J||{};var x=this.calculateCurrentZoomLevel();var K=this.getMilliSecondsPerPixelForZoomLevel(x);var C=this.zoomLevels[M];var N=this.getMilliSecondsPerPixelForZoomLevel(C);if(K==N&&!w){return null}var u=this;var B=this.getSchedulingView();var G=B.getOuterEl();var v=B.getScrollEventSource();if(this.isFirstZoom){this.isFirstZoom=false;v.on("scroll",this.clearCenterDateCache,this)}var F=this.orientation=="vertical";var H=w?new Date((w.start.getTime()+w.end.getTime())/2):this.getViewportCenterDateCached();var A=F?G.getHeight():G.getWidth();var z=Sch.preset.Manager.getPreset(C.preset).clone();var y=z.getBottomHeader();var I=Boolean(w);w=this.calculateOptimalDateRange(H,A,C,w);z[F?"timeRowHeight":"timeColumnWidth"]=J.customWidth||C.width;y.increment=C.increment;this.isZooming=true;this.viewPreset=C.preset;var L=this.timeAxis;z.increment=C.increment;z.resolutionUnit=Sch.util.Date.getUnitByName(C.resolutionUnit||y.unit);z.resolutionIncrement=C.resolution;this.switchViewPreset(z,w.start||this.getStart(),w.end||this.getEnd(),false,true);C.actualWidth=this.timeAxisViewModel.getTickWidth();if(I){H=J.centerDate||new Date((L.getStart().getTime()+L.getEnd().getTime())/2)}v.on("scroll",function(){u.cachedCenterDate=H},this,{single:true});if(F){var E=B.getYFromDate(H,true);B.scrollVerticallyTo(E-A/2)}else{var D=B.getXFromDate(H,true);B.scrollHorizontallyTo(D-A/2)}u.isZooming=false;this.fireEvent("zoomchange",this,M);return M},zoomToSpan:function(A,x){if(A.start&&A.end&&A.start<A.end){var L=A.start,O=A.end,N=x&&x.adjustStart>=0&&x.adjustEnd>=0;if(N){L=Sch.util.Date.add(L,this.timeAxis.mainUnit,-x.adjustStart);O=Sch.util.Date.add(O,this.timeAxis.mainUnit,x.adjustEnd)}var R=this.getSchedulingView().getTimeAxisViewModel().getAvailableWidth();var F=Math.floor(this.getCurrentZoomLevelIndex());if(F==-1){F=0}var w=this.zoomLevels;var D,Q=O-L,I=this.getMilliSecondsPerPixelForZoomLevel(w[F],true),G=Q/I>R?-1:1,M=F+G;var C,B,K=null;while(M>=0&&M<=w.length-1){C=w[M];var z=Q/this.getMilliSecondsPerPixelForZoomLevel(C,true);if(G==-1){if(z<=R){K=M;break}}else{if(z<=R){if(F!==M-G){K=M}}else{break}}M+=G}K=K!==null?K:M-G;C=w[K];var P=Sch.preset.Manager.getPreset(C.preset).getBottomHeader().unit;var y=Sch.util.Date.getDurationInUnit(L,O,P)/C.increment;if(y===0){return}var J=Math.floor(R/y);var H=new Date((L.getTime()+O.getTime())/2);var E;if(N){E={start:L,end:O}}else{E=this.calculateOptimalDateRange(H,R,C)}return this.zoomToLevel(K,E,{customWidth:J,centerDate:H})}return null},zoomIn:function(d){d=d||1;var c=this.getCurrentZoomLevelIndex();if(c>=this.zoomLevels.length-1){return null}return this.zoomToLevel(Math.floor(c)+d)},zoomOut:function(d){d=d||1;var c=this.getCurrentZoomLevelIndex();if(c<=0){return null}return this.zoomToLevel(Math.ceil(c)-d)},zoomInFull:function(){return this.zoomToLevel(this.maxZoomLevel)},zoomOutFull:function(){return this.zoomToLevel(this.minZoomLevel)},calculateOptimalDateRange:function(v,p,t,m){if(m){return m}var q=this.timeAxis;if(this.zoomKeepsOriginalTimespan){return{start:q.getStart(),end:q.getEnd()}}var w=Sch.util.Date;var o=Sch.preset.Manager.getPreset(t.preset).headerConfig;var s=o.top?o.top.unit:o.middle.unit;var n=this.getZoomLevelUnit(t);var u=Math.ceil(p/t.width*t.increment*this.visibleZoomFactor/2);var x=w.add(v,n,-u);var r=w.add(v,n,u);return{start:q.floorDate(x,false,n,t.increment),end:q.ceilDate(r,false,n,t.increment)}}});Ext.define("Sch.mixin.AbstractTimelinePanel",{requires:["Sch.data.TimeAxis","Sch.view.model.TimeAxis","Sch.feature.ColumnLines","Sch.preset.Manager"],mixins:["Sch.mixin.Zoomable"],orientation:"horizontal",weekStartDay:1,snapToIncrement:false,readOnly:false,forceFit:false,eventResizeHandles:"both",timeAxis:null,autoAdjustTimeAxis:true,timeAxisViewModel:null,viewPreset:"weekAndDay",trackHeaderOver:true,startDate:null,endDate:null,columnLines:true,getDateConstraints:Ext.emptyFn,snapRelativeToEventStartDate:false,trackMouseOver:false,readRowHeightFromPreset:true,eventBorderWidth:1,getOrientation:function(){return this.orientation},isHorizontal:function(){return this.getOrientation()==="horizontal"},isVertical:function(){return !this.isHorizontal()},cellBorderWidth:1,cellTopBorderWidth:1,cellBottomBorderWidth:1,renderers:null,_initializeTimelinePanel:function(){var c=this.viewPreset&&Sch.preset.Manager.getPreset(this.viewPreset);if(!c){throw"You must define a valid view preset object. See Sch.preset.Manager class for reference"}this.initializeZooming();this.renderers=[];this.readRowHeightFromPreset=!this.rowHeight;if(!this.timeAxis){this.timeAxis=new Sch.data.TimeAxis({autoAdjust:this.autoAdjustTimeAxis})}if(!this.timeAxisViewModel||!(this.timeAxisViewModel instanceof Sch.view.model.TimeAxis)){var d=Ext.apply({orientation:this.orientation,snapToIncrement:this.snapToIncrement,forceFit:this.forceFit,timeAxis:this.timeAxis,eventStore:this.getEventStore()},this.timeAxisViewModel||{});this.timeAxisViewModel=new Sch.view.model.TimeAxis(d)}this.timeAxisViewModel.on("update",this.onTimeAxisViewModelUpdate,this);this.timeAxisViewModel.refCount++;this.on("destroy",this.onPanelDestroyed,this);this.addCls(["sch-timelinepanel","sch-"+this.orientation])},onTimeAxisViewModelUpdate:function(){var b=this.getSchedulingView();if(b&&b.viewReady){b.refreshKeepingScroll();this.fireEvent("viewchange",this)}},onPanelDestroyed:function(){var b=this.timeAxisViewModel;b.un("update",this.onTimeAxisViewModelUpdate,this);b.refCount--;if(b.refCount<=0){b.destroy()}},getSchedulingView:function(){throw"Abstract method call"},setReadOnly:function(b){this.getSchedulingView().setReadOnly(b)},isReadOnly:function(){return this.getSchedulingView().isReadOnly()},switchViewPreset:function(j,r,o,m,q){var n=this.timeAxis;if(this.fireEvent("beforeviewchange",this,j,r,o)!==false){var k=this.getOrientation()==="horizontal";if(Ext.isString(j)){this.viewPreset=j;j=Sch.preset.Manager.getPreset(j)}if(!j){throw"View preset not found"}if(!(m&&n.isConfigured)){var p={weekStartDay:this.weekStartDay};if(m){if(n.getCount()===0||r){p.start=r||new Date()}}else{p.start=r||n.getStart()}p.end=o;n.consumeViewPreset(j);n.reconfigure(p,true);this.timeAxisViewModel.reconfigure({headerConfig:j.headerConfig,columnLinesFor:j.columnLinesFor||"middle",rowHeightHorizontal:this.readRowHeightFromPreset?j.rowHeight:this.rowHeight,tickWidth:k?j.timeColumnWidth:j.timeRowHeight||j.timeColumnWidth||60,timeColumnWidth:j.timeColumnWidth,rowHeightVertical:j.timeRowHeight||j.timeColumnWidth||60,timeAxisColumnWidth:j.timeAxisColumnWidth,resourceColumnWidth:this.resourceColumnWidth||j.resourceColumnWidth||100})}var l=this.getSchedulingView();l.setDisplayDateFormat(j.displayDateFormat);if(!k){l.setColumnWidth(this.resourceColumnWidth||j.resourceColumnWidth||100,true)}if(!q){if(k){l.scrollHorizontallyTo(0)}else{l.scrollVerticallyTo(0)}}}},getStart:function(){return this.getStartDate()},getStartDate:function(){return this.timeAxis.getStart()},getEnd:function(){return this.getEndDate()},getEndDate:function(){return this.timeAxis.getEnd()},setTimeColumnWidth:function(c,d){this.timeAxisViewModel.setTickWidth(c,d)},getTimeColumnWidth:function(){return this.timeAxisViewModel.getTickWidth()},getRowHeight:function(){return this.timeAxisViewModel.getViewRowHeight()},shiftNext:function(b){this.suspendLayouts&&this.suspendLayouts();this.timeAxis.shiftNext(b);this.suspendLayouts&&this.resumeLayouts(true)},shiftPrevious:function(b){this.suspendLayouts&&this.suspendLayouts();this.timeAxis.shiftPrevious(b);this.suspendLayouts&&this.resumeLayouts(true)},goToNow:function(){this.setTimeSpan(new Date())},setTimeSpan:function(c,d){if(this.timeAxis){this.timeAxis.setTimeSpan(c,d)}},setStart:function(b){this.setTimeSpan(b)},setEnd:function(b){this.setTimeSpan(null,b)},getTimeAxis:function(){return this.timeAxis},scrollToDate:function(h,e){var f=this.getSchedulingView();var g=f.getCoordinateFromDate(h,true);this.scrollToCoordinate(g,h,e,false)},scrollToDateCentered:function(j,f){var g=this.getSchedulingView();var h=0;if(this.orientation==="horizontal"){h=g.getBox().width/2}else{h=g.getBox().height/2}var i=Math.round(g.getCoordinateFromDate(j,true)-h);this.scrollToCoordinate(i,j,f,true)},scrollToCoordinate:function(j,l,m,n){var h=this.getSchedulingView();var k=this;if(j<0){if(this.infiniteScroll){h.shiftToDate(l,n)}else{var i=(this.timeAxis.getEnd()-this.timeAxis.getStart())/2;this.setTimeSpan(new Date(l.getTime()-i),new Date(l.getTime()+i));if(n){k.scrollToDateCentered(l,m)}else{k.scrollToDate(l,m)}}return}if(this.orientation==="horizontal"){h.scrollHorizontallyTo(j,m)}else{h.scrollVerticallyTo(j,m)}h.fireEvent("scroll",this,j)},getViewportCenterDate:function(){var d=this.getSchedulingView(),e=d.getScroll(),f;if(this.getOrientation()==="vertical"){f=[0,e.top+d.getViewportHeight()/2]}else{f=[e.left+d.getViewportWidth()/2,0]}return d.getDateFromXY(f,null,true)},addCls:function(){throw"Abstract method call"},removeCls:function(){throw"Abstract method call"},registerRenderer:function(c,d){this.renderers.push({fn:c,scope:d})},deregisterRenderer:function(c,d){Ext.each(this.renderers,function(b,a){if(c===b){Ext.Array.removeAt(this.renderers,a);return false}})}});if(!Ext.ClassManager.get("Sch.mixin.TimelinePanel")){Ext.define("Sch.mixin.TimelinePanel",{extend:"Sch.mixin.AbstractTimelinePanel",requires:["Sch.util.Patch","Sch.patches.ElementScroll","Sch.column.timeAxis.Horizontal","Sch.preset.Manager"],mixins:["Sch.mixin.Zoomable","Sch.mixin.Lockable"],bufferCoef:5,bufferThreshold:0.2,infiniteScroll:false,waitingForAutoTimeSpan:false,columnLinesFeature:null,tipCfg:{cls:"sch-tip",showDelay:1000,hideDelay:0,autoHide:true,anchor:"b"},inheritables:function(){return{columnLines:true,enableLocking:true,lockable:true,initComponent:function(){if(this.partnerTimelinePanel){this.timeAxisViewModel=this.partnerTimelinePanel.timeAxisViewModel;this.timeAxis=this.partnerTimelinePanel.getTimeAxis();this.startDate=this.timeAxis.getStart();this.endDate=this.timeAxis.getEnd()}if(this.viewConfig&&this.viewConfig.forceFit){this.forceFit=true}if(Ext.versions.extjs.isGreaterThanOrEqual("4.2.1")){this.cellTopBorderWidth=0}this._initializeTimelinePanel();this.configureColumns();var j=this.normalViewConfig=this.normalViewConfig||{};var h=this.getId();Ext.apply(this.normalViewConfig,{id:h+"-timelineview",eventPrefix:this.autoGenId?null:h,timeAxisViewModel:this.timeAxisViewModel,eventBorderWidth:this.eventBorderWidth,timeAxis:this.timeAxis,readOnly:this.readOnly,orientation:this.orientation,rtl:this.rtl,cellBorderWidth:this.cellBorderWidth,cellTopBorderWidth:this.cellTopBorderWidth,cellBottomBorderWidth:this.cellBottomBorderWidth,infiniteScroll:this.infiniteScroll,bufferCoef:this.bufferCoef,bufferThreshold:this.bufferThreshold});Ext.Array.forEach(["eventRendererScope","eventRenderer","dndValidatorFn","resizeValidatorFn","createValidatorFn","tooltipTpl","validatorFnScope","eventResizeHandles","enableEventDragDrop","enableDragCreation","resizeConfig","createConfig","tipCfg","getDateConstraints"],function(a){if(a in this){j[a]=this[a]}},this);this.mon(this.timeAxis,"reconfigure",this.onMyTimeAxisReconfigure,this);this.callParent(arguments);this.switchViewPreset(this.viewPreset,this.startDate||this.timeAxis.getStart(),this.endDate||this.timeAxis.getEnd(),true);if(!this.startDate){var g=this.getTimeSpanDefiningStore();if(Ext.data.TreeStore&&g instanceof Ext.data.TreeStore?g.getRootNode().childNodes.length:g.getCount()){var i=g.getTotalTimeSpan();this.setTimeSpan(i.start||new Date(),i.end)}else{this.bindAutoTimeSpanListeners()}}var f=this.columnLines;if(f){this.columnLinesFeature=new Sch.feature.ColumnLines(Ext.isObject(f)?f:undefined);this.columnLinesFeature.init(this);this.columnLines=true}this.relayEvents(this.getSchedulingView(),["beforetooltipshow"]);this.on("afterrender",this.__onAfterRender,this);this.on("zoomchange",function(){this.normalGrid.scrollTask.cancel()})},getState:function(){var d=this,c=d.callParent(arguments);Ext.apply(c,{viewPreset:d.viewPreset,startDate:d.getStart(),endDate:d.getEnd(),zoomMinLevel:d.zoomMinLevel,zoomMaxLevel:d.zoomMaxLevel,currentZoomLevel:d.currentZoomLevel});return c},applyState:function(c){var d=this;d.callParent(arguments);if(c&&c.viewPreset){d.switchViewPreset(c.viewPreset,c.startDate,c.endDate)}if(c&&c.currentZoomLevel){d.zoomToLevel(c.currentZoomLevel)}},setTimeSpan:function(){if(this.waitingForAutoTimeSpan){this.unbindAutoTimeSpanListeners()}this.callParent(arguments);if(!this.normalGrid.getView().viewReady){this.getView().refresh()}}}},bindAutoTimeSpanListeners:function(){var b=this.getTimeSpanDefiningStore();this.waitingForAutoTimeSpan=true;this.normalGrid.getView().on("beforerefresh",this.refreshStopper,this);this.lockedGrid.getView().on("beforerefresh",this.refreshStopper,this);this.mon(b,"load",this.applyStartEndDatesFromStore,this);if(Ext.data.TreeStore&&b instanceof Ext.data.TreeStore){this.mon(b,"rootchange",this.applyStartEndDatesFromStore,this);this.mon(b.tree,"append",this.applyStartEndDatesAfterTreeAppend,this)}else{this.mon(b,"add",this.applyStartEndDatesFromStore,this)}},refreshStopper:function(b){return b.store.getCount()===0},getTimeSpanDefiningStore:function(){throw"Abstract method called"},unbindAutoTimeSpanListeners:function(){this.waitingForAutoTimeSpan=false;var b=this.getTimeSpanDefiningStore();this.normalGrid.getView().un("beforerefresh",this.refreshStopper,this);this.lockedGrid.getView().un("beforerefresh",this.refreshStopper,this);b.un("load",this.applyStartEndDatesFromStore,this);if(Ext.data.TreeStore&&b instanceof Ext.data.TreeStore){b.un("rootchange",this.applyStartEndDatesFromStore,this);b.tree.un("append",this.applyStartEndDatesAfterTreeAppend,this)}else{b.un("add",this.applyStartEndDatesFromStore,this)}},applyStartEndDatesAfterTreeAppend:function(){var b=this.getTimeSpanDefiningStore();if(!b.isSettingRoot){this.applyStartEndDatesFromStore()}},applyStartEndDatesFromStore:function(){var e=this.getTimeSpanDefiningStore();var d=e.getTotalTimeSpan();var f=this.lockedGridDependsOnSchedule;this.lockedGridDependsOnSchedule=true;this.setTimeSpan(d.start||new Date(),d.end);this.lockedGridDependsOnSchedule=f},onMyTimeAxisReconfigure:function(b){if(this.stateful&&this.rendered){this.saveState()}},onLockedGridItemDblClick:function(f,g,j,h,i){if(this.orientation==="vertical"&&g){this.fireEvent("timeheaderdblclick",this,g.get("start"),g.get("end"),h,i)}},getSchedulingView:function(){return this.normalGrid.getView()},getTimeAxisColumn:function(){if(!this.timeAxisColumn){this.timeAxisColumn=this.down("timeaxiscolumn")}return this.timeAxisColumn},configureColumns:function(){var e=this.columns||[];if(e.items){e=e.items}else{e=this.columns=e.slice()}var f=[];var d=[];Ext.Array.each(e,function(a){if(a.position==="right"){if(!Ext.isNumber(a.width)){Ext.Error.raise('"Right" columns must have a fixed width')}a.locked=false;d.push(a)}else{a.locked=true;f.push(a)}a.lockable=false});Ext.Array.erase(e,0,e.length);Ext.Array.insert(e,0,f.concat({xtype:"timeaxiscolumn",timeAxisViewModel:this.timeAxisViewModel,trackHeaderOver:this.trackHeaderOver,renderer:this.mainRenderer,scope:this}).concat(d));this.horizontalColumns=Ext.Array.clone(e);this.verticalColumns=[Ext.apply({xtype:"verticaltimeaxis",width:100,timeAxis:this.timeAxis,timeAxisViewModel:this.timeAxisViewModel,cellTopBorderWidth:this.cellTopBorderWidth,cellBottomBorderWidth:this.cellBottomBorderWidth},this.timeAxisColumnCfg||{})];if(this.orientation==="vertical"){this.columns=this.verticalColumns;this.store=this.timeAxis;this.on("beforerender",this.refreshResourceColumns,this)}},mainRenderer:function(w,i,r,p,n){var v=this.renderers,o=this.orientation==="horizontal",u=o?r:this.resourceStore.getAt(n),x="&nbsp;";i.rowHeight=null;for(var t=0;t<v.length;t++){x+=v[t].fn.call(v[t].scope||this,w,i,u,p,n)||""}if(this.variableRowHeight){var q=this.getSchedulingView();var s=this.timeAxisViewModel.getViewRowHeight();i.style="height:"+((i.rowHeight||s)-q.cellTopBorderWidth-q.cellBottomBorderWidth)+"px"}return x},__onAfterRender:function(){var b=this;b.normalGrid.on({collapse:b.onNormalGridCollapse,expand:b.onNormalGridExpand,scope:b});b.lockedGrid.on({collapse:b.onLockedGridCollapse,itemdblclick:b.onLockedGridItemDblClick,scope:b});if(b.lockedGridDependsOnSchedule){b.normalGrid.getView().on("itemupdate",b.onNormalViewItemUpdate,b)}if(this.partnerTimelinePanel){if(this.partnerTimelinePanel.rendered){this.setupPartnerTimelinePanel()}else{this.partnerTimelinePanel.on("afterrender",this.setupPartnerTimelinePanel,this)}}},onLockedGridCollapse:function(){if(this.normalGrid.collapsed){this.normalGrid.expand()}},onNormalGridCollapse:function(){var b=this;if(!b.normalGrid.reExpander){b.normalGrid.reExpander=b.normalGrid.placeholder}if(!b.lockedGrid.rendered){b.lockedGrid.on("render",b.onNormalGridCollapse,b,{delay:1})}else{b.lockedGrid.flex=1;b.lockedGrid.doLayout();if(b.lockedGrid.collapsed){b.lockedGrid.expand()}b.addCls("sch-normalgrid-collapsed")}},onNormalGridExpand:function(){this.removeCls("sch-normalgrid-collapsed");delete this.lockedGrid.flex;this.lockedGrid.doLayout()},onNormalViewItemUpdate:function(f,e,g){if(this.lockedGridDependsOnSchedule){var h=this.lockedGrid.getView();h.suspendEvents();h.refreshNode(e);h.resumeEvents()}},setupPartnerTimelinePanel:function(){var i=this.partnerTimelinePanel;var k=i.down("splitter");var l=this.down("splitter");if(k){k.on("dragend",function(){this.lockedGrid.setWidth(i.lockedGrid.getWidth())},this)}if(l){l.on("dragend",function(){i.lockedGrid.setWidth(this.lockedGrid.getWidth())},this)}var g=i.isVisible()?i.lockedGrid.getWidth():i.lockedGrid.width;this.lockedGrid.setWidth(g);var h=i.getSchedulingView().getEl(),j=this.getSchedulingView().getEl();i.mon(j,"scroll",function(a,b){h.scrollTo("left",b.scrollLeft)});this.mon(h,"scroll",function(a,b){j.scrollTo("left",b.scrollLeft)});this.on("viewchange",function(){i.viewPreset=this.viewPreset},this);i.on("viewchange",function(){this.viewPreset=i.viewPreset},this)}},function(){var b="4.2.1";Ext.apply(Sch,{VERSION:"2.2.21"});if(Ext.versions.extjs.isLessThan(b)){alert("The Ext JS version you are using needs to be updated to at least "+b)}})}Ext.define("Sch.panel.TimelineGridPanel",{extend:"Ext.grid.Panel",mixins:["Sch.mixin.TimelinePanel"],subGridXType:"gridpanel",requires:["Sch.patches.ColumnResize"],initComponent:function(){this.callParent(arguments);this.getSchedulingView()._initializeTimelineView()}},function(){this.override(Sch.mixin.TimelinePanel.prototype.inheritables()||{})});if(!Ext.ClassManager.get("Sch.panel.TimelineTreePanel")){Ext.define("Sch.panel.TimelineTreePanel",{extend:"Ext.tree.Panel",requires:["Ext.grid.Panel","Ext.data.TreeStore","Sch.mixin.FilterableTreeView","Sch.patches.ColumnResizeTree"],mixins:["Sch.mixin.TimelinePanel"],useArrows:true,rootVisible:false,lockedXType:"treepanel",initComponent:function(){this.callParent(arguments);this.getSchedulingView()._initializeTimelineView()}},function(){this.override(Sch.mixin.TimelinePanel.prototype.inheritables()||{})})}Ext.define("Sch.plugin.Printable",{extend:"Ext.AbstractPlugin",alias:"plugin.scheduler_printable",requires:["Ext.XTemplate"],lockableScope:"top",docType:"<!DOCTYPE HTML>",beforePrint:Ext.emptyFn,afterPrint:Ext.emptyFn,autoPrintAndClose:true,fakeBackgroundColor:true,scheduler:null,constructor:function(b){Ext.apply(this,b)},init:function(b){this.scheduler=b;b.print=Ext.Function.bind(this.print,this)},mainTpl:new Ext.XTemplate('{docType}<html class="'+Ext.baseCSSPrefix+'border-box {htmlClasses}"><head><meta content="text/html; charset=UTF-8" http-equiv="Content-Type" /><title>{title}</title>{styles}</head><body class="sch-print-body {bodyClasses}"><div class="sch-print-ct {componentClasses}" style="width:{totalWidth}px"><div class="sch-print-headerbg" style="border-left-width:{totalWidth}px;height:{headerHeight}px;"></div><div class="sch-print-header-wrap">{[this.printLockedHeader(values)]}{[this.printNormalHeader(values)]}</div>{[this.printLockedGrid(values)]}{[this.printNormalGrid(values)]}</div><script type="text/javascript">{setupScript}<\/script></body></html>',{printLockedHeader:function(d){var c="";if(d.lockedGrid){c+='<div style="left:-'+d.lockedScroll+"px;margin-right:-"+d.lockedScroll+"px;width:"+(d.lockedWidth+d.lockedScroll)+'px"';c+='class="sch-print-lockedheader '+d.lockedGrid.headerCt.el.dom.className+'">';c+=d.lockedHeader;c+="</div>"}return c},printNormalHeader:function(d){var c="";if(d.normalGrid){c+='<div style="left:'+(d.lockedGrid?d.lockedWidth:"0")+"px;width:"+d.normalWidth+'px;" class="sch-print-normalheader '+d.normalGrid.headerCt.el.dom.className+'">';c+='<div style="margin-left:-'+d.normalScroll+'px">'+d.normalHeader+"</div>";c+="</div>"}return c},printLockedGrid:function(d){var c="";if(d.lockedGrid){c+='<div id="lockedRowsCt" style="left:-'+d.lockedScroll+"px;margin-right:-"+d.lockedScroll+"px;width:"+(d.lockedWidth+d.lockedScroll)+"px;top:"+d.headerHeight+'px;" class="sch-print-locked-rows-ct '+d.innerLockedClasses+" "+Ext.baseCSSPrefix+'grid-inner-locked">';c+=d.lockedRows;c+="</div>"}return c},printNormalGrid:function(d){var c="";if(d.normalGrid){c+='<div id="normalRowsCt" style="left:'+(d.lockedGrid?d.lockedWidth:"0")+"px;top:"+d.headerHeight+"px;width:"+d.normalWidth+'px" class="sch-print-normal-rows-ct '+d.innerNormalClasses+'">';c+='<div style="position:relative;overflow:visible;margin-left:-'+d.normalScroll+'px">'+d.normalRows+"</div>";c+="</div>"}return c}}),getGridContent:function(q){var r=q.normalGrid,z=q.lockedGrid,p=z.getView(),x=r.getView(),u,A,s,v,t,C,w;this.beforePrint(q);if(z.collapsed&&!r.collapsed){C=z.getWidth()+r.getWidth()}else{C=r.getWidth();w=z.getWidth()}var B=p.store.getRange();A=p.tpl.apply(p.collectData(B,0));s=x.tpl.apply(x.collectData(B,0));v=p.el.getScroll().left;t=x.el.getScroll().left;var D=document.createElement("div");D.innerHTML=A;D.firstChild.style.width=p.el.dom.style.width;if(Ext.versions.extjs.isLessThan("4.2.1")){z.headerCt.items.each(function(a,b){if(a.isHidden()){Ext.fly(D).down("colgroup:nth-child("+(b+1)+") col").setWidth(0)}})}A=D.innerHTML;if(Sch.feature&&Sch.feature.AbstractTimeSpan){var y=(q.plugins||[]).concat(q.normalGrid.plugins||[]).concat(q.columnLinesFeature||[]);Ext.each(y,function(a){if(a instanceof Sch.feature.AbstractTimeSpan&&a.generateMarkup){s=a.generateMarkup(true)+s}})}this.afterPrint(q);return{normalHeader:r.headerCt.el.dom.innerHTML,lockedHeader:z.headerCt.el.dom.innerHTML,lockedGrid:z.collapsed?false:z,normalGrid:r.collapsed?false:r,lockedRows:A,normalRows:s,lockedScroll:v,normalScroll:t,lockedWidth:w-(Ext.isWebKit?1:0),normalWidth:C,headerHeight:r.headerCt.getHeight(),innerLockedClasses:z.view.el.dom.className,innerNormalClasses:r.view.el.dom.className+(this.fakeBackgroundColor?" sch-print-fake-background":""),width:q.getWidth()}},getStylesheets:function(){return Ext.getDoc().select('link[rel="stylesheet"]')},print:function(){var l=this.scheduler;if(!(this.mainTpl instanceof Ext.Template)){var r=22;this.mainTpl=new Ext.XTemplate(this.mainTpl,{compiled:true,disableFormats:true})}var k=l.getView(),j=this.getStylesheets(),n=Ext.get(Ext.core.DomHelper.createDom({tag:"div"})),q;j.each(function(a){n.appendChild(a.dom.cloneNode(true))});q=n.dom.innerHTML+"";var m=this.getGridContent(l),p=this.mainTpl.apply(Ext.apply({waitText:this.waitText,docType:this.docType,htmlClasses:Ext.getBody().parent().dom.className,bodyClasses:Ext.getBody().dom.className,componentClasses:l.el.dom.className,title:(l.title||""),styles:q,totalWidth:l.getWidth(),setupScript:("window.onload = function(){ ("+this.setupScript.toString()+")("+l.syncRowHeight+", "+this.autoPrintAndClose+", "+Ext.isChrome+", "+Ext.isIE+"); };")},m));var o=window.open("","printgrid");if(!o||!o.document){return false}this.printWindow=o;o.document.write(p);o.document.close()},setupScript:function(h,g,i,f){var j=function(){if(h){var s=document.getElementById("lockedRowsCt"),a=document.getElementById("normalRowsCt"),r=s&&s.getElementsByTagName("tr"),c=a&&a.getElementsByTagName("tr"),e=c&&r?c.length:0;for(var p=0;p<e;p++){var q=c[p].clientHeight;var d=r[p].clientHeight;var b=Math.max(q,d)+"px";r[p].style.height=c[p].style.height=b}}document._loaded=true;if(g){window.print();if(!i){window.close()}}};if(f){setTimeout(j,0)}else{j()}}});Ext.define("Sch.plugin.Export",{extend:"Ext.util.Observable",alternateClassName:"Sch.plugin.PdfExport",alias:"plugin.scheduler_export",mixins:["Ext.AbstractPlugin"],requires:["Ext.XTemplate"],lockableScope:"top",printServer:undefined,tpl:null,exportDialogClassName:"Sch.widget.ExportDialog",exportDialogConfig:{},defaultConfig:{format:"A4",orientation:"portrait",range:"complete",showHeader:true,singlePageExport:false},expandAllBeforeExport:false,pageSizes:{A5:{width:5.8,height:8.3},A4:{width:8.3,height:11.7},A3:{width:11.7,height:16.5},Letter:{width:8.5,height:11},Legal:{width:8.5,height:14}},openAfterExport:true,beforeExport:Ext.emptyFn,afterExport:Ext.emptyFn,fileFormat:"pdf",DPI:72,constructor:function(b){b=b||{};if(b.exportDialogConfig){Ext.Object.each(this.defaultConfig,function(h,a,f){var g=b.exportDialogConfig[h];if(g){f[h]=g}})}this.callParent([b]);if(!this.tpl){this.tpl=new Ext.XTemplate('<!DOCTYPE html><html class="'+Ext.baseCSSPrefix+'border-box {htmlClasses}"><head><meta content="text/html; charset=UTF-8" http-equiv="Content-Type" /><title>{column}/{row}</title>{styles}</head><body class="'+Ext.baseCSSPrefix+'webkit sch-export {bodyClasses}"><tpl if="showHeader"><div class="sch-export-header" style="width:{totalWidth}px"><h2>{column}/{row}</h2></div></tpl><div class="{componentClasses}" style="height:{bodyHeight}px; width:{totalWidth}px; position: relative !important">{HTML}</div></body></html>',{disableFormats:true})}this.setFileFormat(this.fileFormat)},init:function(b){this.scheduler=b;b.showExportDialog=Ext.Function.bind(this.showExportDialog,this);b.doExport=Ext.Function.bind(this.doExport,this)},setFileFormat:function(b){if(typeof b!=="string"){this.fileFormat="pdf"}else{b=b.toLowerCase();if(b==="png"){this.fileFormat=b}else{this.fileFormat="pdf"}}},showExportDialog:function(){var c=this,d=c.scheduler.getSchedulingView();if(c.win){c.win.destroy();c.win=null}c.win=Ext.create(c.exportDialogClassName,{plugin:c,exportDialogConfig:Ext.apply({startDate:c.scheduler.getStart(),endDate:c.scheduler.getEnd(),rowHeight:d.timeAxisViewModel.getViewRowHeight(),columnWidth:d.timeAxisViewModel.getTickWidth(),defaultConfig:c.defaultConfig},c.exportDialogConfig)});c.saveRestoreData();c.win.show()},saveRestoreData:function(){var e=this.scheduler,f=e.getSchedulingView(),h=e.normalGrid,g=e.lockedGrid;this.restoreSettings={width:e.getWidth(),height:e.getHeight(),rowHeight:f.timeAxisViewModel.getViewRowHeight(),columnWidth:f.timeAxisViewModel.getTickWidth(),startDate:e.getStart(),endDate:e.getEnd(),normalWidth:h.getWidth(),normalLeft:h.getEl().getStyle("left"),lockedWidth:g.getWidth(),lockedCollapse:g.collapsed,normalCollapse:h.collapsed}},getStylesheets:function(){var f=Ext.getDoc().select('link[rel="stylesheet"]'),e=Ext.get(Ext.core.DomHelper.createDom({tag:"div"})),d;f.each(function(a){e.appendChild(a.dom.cloneNode(true))});d=e.dom.innerHTML+"";return d},doExport:function(af,ai,ab){this.mask();var l=this,ad=l.scheduler,Z=ad.getSchedulingView(),ag=l.getStylesheets(),O=af||l.defaultConfig,W=ad.normalGrid,T=ad.lockedGrid,ac=W.headerCt.getHeight();l.saveRestoreData();W.expand();T.expand();l.fireEvent("updateprogressbar",0.1);if(this.expandAllBeforeExport&&ad.expandAll){ad.expandAll()}var M=ad.timeAxis.getTicks(),V=Z.timeAxisViewModel.getTickWidth(),X,am,ak;if(!O.singlePageExport){if(O.orientation==="landscape"){X=l.pageSizes[O.format].height*l.DPI;ak=l.pageSizes[O.format].width*l.DPI}else{X=l.pageSizes[O.format].width*l.DPI;ak=l.pageSizes[O.format].height*l.DPI}var P=41;am=Math.floor(ak)-ac-(O.showHeader?P:0)}Z.timeAxisViewModel.suppressFit=true;var U=0;var ah=0;if(O.range!=="complete"){var an,ap;switch(O.range){case"date":an=new Date(O.dateFrom);ap=new Date(O.dateTo);if(Sch.util.Date.getDurationInDays(an,ap)<1){ap=Sch.util.Date.add(ap,Sch.util.Date.DAY,1)}an=Sch.util.Date.constrain(an,ad.getStart(),ad.getEnd());ap=Sch.util.Date.constrain(ap,ad.getStart(),ad.getEnd());break;case"current":var a=Z.getVisibleDateRange();an=a.startDate;ap=a.endDate||Z.timeAxis.getEnd();if(O.cellSize){V=O.cellSize[0];if(O.cellSize.length>1){Z.setRowHeight(O.cellSize[1])}}break}ad.setTimeSpan(an,ap);var ao=Math.floor(Z.timeAxis.getTickFromDate(an));var N=Math.floor(Z.timeAxis.getTickFromDate(ap));M=ad.timeAxis.getTicks();M=Ext.Array.filter(M,function(c,b){if(b<ao){U++;return false}else{if(b>N){ah++;return false}}return true})}this.beforeExport(ad,M);var Y,i,aj;if(!O.singlePageExport){ad.setWidth(X);ad.setTimeColumnWidth(V);Z.timeAxisViewModel.setTickWidth(V);aj=l.calculatePages(O,M,V,X,am);i=l.getExportJsonHtml(aj,{styles:ag,config:O,ticks:M,skippedColsBefore:U,skippedColsAfter:ah,printHeight:am,paperWidth:X,headerHeight:ac});Y=O.format}else{i=l.getExportJsonHtml(null,{styles:ag,config:O,ticks:M,skippedColsBefore:U,skippedColsAfter:ah,timeColumnWidth:V});var al=l.getRealSize(),R=Ext.Number.toFixed(al.width/l.DPI,1),S=Ext.Number.toFixed(al.height/l.DPI,1);Y=R+"in*"+S+"in"}l.fireEvent("updateprogressbar",0.4);if(l.printServer){if(!l.debug&&!l.test){Ext.Ajax.request({type:"POST",url:l.printServer,timeout:60000,params:Ext.apply({html:{array:i},startDate:ad.getStartDate(),endDate:ad.getEndDate(),format:Y,orientation:O.orientation,range:O.range,fileFormat:l.fileFormat},this.getParameters()),success:function(b){l.onSuccess(b,ai,ab)},failure:function(b){l.onFailure(b,ab)},scope:l})}else{if(l.debug){var ae,Q=Ext.JSON.decode(i);for(var aa=0,w=Q.length;aa<w;aa++){ae=window.open();ae.document.write(Q[aa].html);ae.document.close()}}}}else{throw"Print server URL is not defined, please specify printServer config"}Z.timeAxisViewModel.suppressFit=false;l.restorePanel();this.afterExport(ad);if(l.test){return{htmlArray:Ext.JSON.decode(i),calculatedPages:aj}}},getParameters:function(){return{}},getRealSize:function(){var j=this.scheduler,f=j.normalGrid.headerCt.getHeight(),h="."+Ext.baseCSSPrefix+(Ext.versions.extjs.isLessThan("5.0")?"grid-table":"grid-item-container"),g=(f+j.lockedGrid.getView().getEl().down(h).getHeight()),i=(j.lockedGrid.headerCt.getEl().first().getWidth()+j.normalGrid.body.down(h).getWidth());return{width:i,height:g}},calculatePages:function(y,x,G,A,O){var w=this,H=w.scheduler,z=H.lockedGrid,N=H.getSchedulingView().timeAxisViewModel.getViewRowHeight(),v=z.headerCt,B=v.getEl().first().getWidth(),I=null,F=0;if(B>z.getWidth()){var J=0,M=0,D=0,C=false,L;I=[];z.headerCt.items.each(function(d,b,c){L=d.width;if(!D||D+L<A){D+=L;if(b===c-1){C=true;var a=A-D;F=Math.floor(a/G)}}else{C=true}if(C){M=b;I.push({firstColumnIdx:J,lastColumnIdx:M,totalColumnsWidth:D||L});J=M+1;D=0}})}else{F=Math.floor((A-B)/G)}var E=Math.floor(A/G),P=Math.ceil((x.length-F)/E),K=Math.floor(O/N);if(!I||P===0){P+=1}return{columnsAmountLocked:F,columnsAmountNormal:E,lockedColumnPages:I,rowsAmount:K,rowPages:Math.ceil(H.getSchedulingView().store.getCount()/K),columnPages:P,timeColumnWidth:G,lockedGridWidth:B,rowHeight:N,panelHTML:{}}},getExportJsonHtml:function(ag,Q){var K=this,aa=K.scheduler,k=[],M=new RegExp(Ext.baseCSSPrefix+"ie\\d?|"+Ext.baseCSSPrefix+"gecko","g"),V=Ext.getBody().dom.className.replace(M,""),W=aa.el.dom.className,ab=Q.styles,O=Q.config,L=Q.ticks,Z,ai,ah,Y,U;if(Ext.isIE){V+=" sch-ie-export"}aa.timeAxis.autoAdjust=false;if(!O.singlePageExport){var S=ag.columnsAmountLocked,N=ag.columnsAmountNormal,ac=ag.lockedColumnPages,ae=ag.rowsAmount,P=ag.rowPages,al=ag.columnPages,T=Q.paperWidth,aj=Q.printHeight,i=Q.headerHeight,ad=null,ak,af;U=ag.timeColumnWidth;Z=ag.panelHTML;Z.skippedColsBefore=Q.skippedColsBefore;Z.skippedColsAfter=Q.skippedColsAfter;if(ac){af=ac.length;al+=af}for(var X=0;X<al;X++){if(ac&&X<af){if(X===af-1&&S!==0){aa.normalGrid.show();ad=Ext.Number.constrain((S-1),0,(L.length-1));aa.setTimeSpan(L[0].start,L[ad].end)}else{aa.normalGrid.hide()}var R=ac[X];this.showLockedColumns();this.hideLockedColumns(R.firstColumnIdx,R.lastColumnIdx);aa.lockedGrid.setWidth(R.totalColumnsWidth+1)}else{if(X===0){this.showLockedColumns();if(S!==0){aa.normalGrid.show()}ad=Ext.Number.constrain(S-1,0,L.length-1);aa.setTimeSpan(L[0].start,L[ad].end)}else{aa.lockedGrid.hide();aa.normalGrid.show();if(ad===null){ad=-1}if(L[ad+N]){aa.setTimeSpan(L[ad+1].start,L[ad+N].end);ad=ad+N}else{aa.setTimeSpan(L[ad+1].start,L[L.length-1].end)}}}aa.setTimeColumnWidth(U,true);aa.getSchedulingView().timeAxisViewModel.setTickWidth(U);for(var I=0;I<P;I+=1){K.hideRows(ae,I);Z.dom=aa.body.dom.innerHTML;Z.k=I;Z.i=X;ai=K.resizePanelHTML(Z);Y=K.tpl.apply(Ext.apply({bodyClasses:V,bodyHeight:aj+i,componentClasses:W,styles:ab,showHeader:O.showHeader,HTML:ai.dom.innerHTML,totalWidth:T,headerHeight:i,column:X+1,row:I+1}));ah={html:Y};k.push(ah);K.showRows()}}}else{U=Q.timeColumnWidth;Z=ag?ag.panelHTML:{};aa.setTimeSpan(L[0].start,L[L.length-1].end);aa.lockedGrid.setWidth(aa.lockedGrid.headerCt.getEl().first().getWidth());aa.setTimeColumnWidth(U);aa.getSchedulingView().timeAxisViewModel.setTickWidth(U);var J=K.getRealSize();Ext.apply(Z,{dom:aa.body.dom.innerHTML,column:1,row:1,timeColumnWidth:Q.timeColumnWidth,skippedColsBefore:Q.skippedColsBefore,skippedColsAfter:Q.skippedColsAfter});ai=K.resizePanelHTML(Z);Y=K.tpl.apply(Ext.apply({bodyClasses:V,bodyHeight:J.height,componentClasses:W,styles:ab,showHeader:false,HTML:ai.dom.innerHTML,totalWidth:J.width}));ah={html:Y};k.push(ah)}aa.timeAxis.autoAdjust=true;return Ext.JSON.encode(k)},resizePanelHTML:function(q){var l=Ext.get(Ext.core.DomHelper.createDom({tag:"div",html:q.dom})),m=this.scheduler,s=m.lockedGrid,n=m.normalGrid,p,r,u;if(Ext.isIE6||Ext.isIE7||Ext.isIEQuirks){var o=document.createDocumentFragment(),v,t;if(o.getElementById){v="getElementById";t=""}else{v="querySelector";t="#"}o.appendChild(l.dom);p=s.view.el;r=[o[v](t+m.id+"-targetEl"),o[v](t+m.id+"-innerCt"),o[v](t+s.id),o[v](t+s.body.id),o[v](t+p.id)];u=[o[v](t+n.id),o[v](t+n.headerCt.id),o[v](t+n.body.id),o[v](t+n.getView().id)];Ext.Array.each(r,function(a){if(a!==null){a.style.height="100%";a.style.width="100%"}});Ext.Array.each(u,function(a,b){if(a!==null){if(b===1){a.style.width="100%"}else{a.style.height="100%";a.style.width="100%"}}});l.dom.innerHTML=o.firstChild.innerHTML}else{p=s.view.el;r=[l.select("#"+m.id+"-targetEl").first(),l.select("#"+m.id+"-innerCt").first(),l.select("#"+s.id).first(),l.select("#"+s.body.id).first(),l.select("#"+p.id)];u=[l.select("#"+n.id).first(),l.select("#"+n.headerCt.id).first(),l.select("#"+n.body.id).first(),l.select("#"+n.getView().id).first()];Ext.Array.each(r,function(a,b){if(a){a.setHeight("100%");if(b!==3&&b!==2){a.setWidth("100%")}}});Ext.Array.each(u,function(a,b){if(b===1){a.setWidth("100%")}else{a.applyStyles({height:"100%",width:"100%"})}})}return l},getWin:function(){return this.win||null},hideDialogWindow:function(d){var c=this;c.fireEvent("hidedialogwindow",d);c.unmask();if(c.openAfterExport){window.open(d.url,"ExportedPanel")}},onSuccess:function(n,j,e){var m=this,k=m.getWin(),i;try{i=Ext.JSON.decode(n.responseText)}catch(l){this.onFailure(n,e);return}m.fireEvent("updateprogressbar",1,i);if(i.success){setTimeout(function(){m.hideDialogWindow(i)},k?k.hideTime:3000)}else{m.fireEvent("showdialogerror",k,i.msg,i)}m.unmask();if(j){j.call(this,n)}},onFailure:function(e,f){var h=this.getWin(),g=e.status===200?e.responseText:e.statusText;this.fireEvent("showdialogerror",h,g);this.unmask();if(f){f.call(this,e)}},hideRows:function(n,l){var o=this.scheduler.lockedGrid.view.getNodes(),j=this.scheduler.normalGrid.view.getNodes(),k=n*l,p=k+n;for(var m=0,i=j.length;m<i;m++){if(m<k||m>=p){o[m].className+=" sch-none";j[m].className+=" sch-none"}}},showRows:function(){this.scheduler.getEl().select(this.scheduler.getSchedulingView().getItemSelector()).each(function(b){b.removeCls("sch-none")})},hideLockedColumns:function(j,h){var i=this.scheduler.lockedGrid.headerCt.items.items;for(var f=0,g=i.length;f<g;f++){if(f<j||f>h){i[f].hide()}}},showLockedColumns:function(){this.scheduler.lockedGrid.headerCt.items.each(function(b){b.show()})},mask:function(){var b=Ext.getBody().mask();b.addCls("sch-export-mask")},unmask:function(){Ext.getBody().unmask()},restorePanel:function(){var c=this.scheduler,d=this.restoreSettings;c.setWidth(d.width);c.setHeight(d.height);c.setTimeSpan(d.startDate,d.endDate);c.setTimeColumnWidth(d.columnWidth,true);c.getSchedulingView().setRowHeight(d.rowHeight);c.lockedGrid.show();c.normalGrid.setWidth(d.normalWidth);c.normalGrid.getEl().setStyle("left",d.normalLeft);c.lockedGrid.setWidth(d.lockedWidth);if(d.lockedCollapse){c.lockedGrid.collapse()}if(d.normalCollapse){c.normalGrid.collapse()}c.getSchedulingView().timeAxisViewModel.update()},destroy:function(){if(this.win){this.win.destroy()}}});Ext.define("Sch.plugin.HeaderZoom",{extend:"Sch.util.DragTracker",mixins:["Ext.AbstractPlugin"],alias:"plugin.scheduler_headerzoom",lockableScope:"top",scheduler:null,proxy:null,headerRegion:null,init:function(b){b.on({destroy:this.onSchedulerDestroy,scope:this});this.scheduler=b;this.onOrientationChange();b.on("orientationchange",this.onOrientationChange,this)},onOrientationChange:function(){var b=this.scheduler.down("timeaxiscolumn");if(b){if(b.rendered){this.onTimeAxisColumnRender(b)}else{b.on({afterrender:this.onTimeAxisColumnRender,scope:this})}}},onTimeAxisColumnRender:function(b){this.proxy=b.el.createChild({cls:"sch-drag-selector"});this.initEl(b.el)},onStart:function(b){this.proxy.show();this.headerRegion=this.scheduler.normalGrid.headerCt.getRegion()},onDrag:function(d){var f=this.headerRegion;var e=this.getRegion().constrainTo(f);e.top=f.top;e.bottom=f.bottom;this.proxy.setRegion(e)},onEnd:function(i){if(this.proxy){this.proxy.setDisplayed(false);var e=this.scheduler;var k=e.timeAxis;var j=this.getRegion();var l=e.getSchedulingView().timeAxisViewModel.getBottomHeader().unit;var h=e.getSchedulingView().getStartEndDatesFromRegion(j);e.zoomToSpan({start:k.floorDate(h.start,false,l,1),end:k.ceilDate(h.end,false,l,1)})}},onSchedulerDestroy:function(){if(this.proxy){Ext.destroy(this.proxy);this.proxy=null}this.destroy()}});Ext.define("Sch.widget.ResizePicker",{extend:"Ext.Panel",alias:"widget.dualrangepicker",width:200,height:200,border:true,collapsible:false,bodyStyle:"position:absolute; margin:5px",verticalCfg:{height:120,value:24,increment:2,minValue:20,maxValue:80,reverse:true,disabled:true},horizontalCfg:{width:120,value:100,minValue:25,increment:5,maxValue:200,disable:true},initComponent:function(){var b=this;b.horizontalCfg.value=b.dialogConfig.columnWidth;b.verticalCfg.value=b.dialogConfig.rowHeight;b.verticalCfg.disabled=b.dialogConfig.scrollerDisabled||false;b.dockedItems=[b.vertical=new Ext.slider.Single(Ext.apply({dock:"left",style:"margin-top:10px",vertical:true,listeners:{change:b.onSliderChange,changecomplete:b.onSliderChangeComplete,scope:b}},b.verticalCfg)),b.horizontal=new Ext.slider.Single(Ext.apply({dock:"top",style:"margin-left:28px",listeners:{change:b.onSliderChange,changecomplete:b.onSliderChangeComplete,scope:b}},b.horizontalCfg))];b.callParent(arguments)},afterRender:function(){var c=this;c.addCls("sch-ux-range-picker");c.valueHandle=this.body.createChild({cls:"sch-ux-range-value",cn:{tag:"span"}});c.valueSpan=this.valueHandle.down("span");var d=new Ext.dd.DD(this.valueHandle);Ext.apply(d,{startDrag:function(){c.dragging=true;this.constrainTo(c.body)},onDrag:function(){c.onHandleDrag.apply(c,arguments)},endDrag:function(){c.onHandleEndDrag.apply(c,arguments);c.dragging=false},scope:this});this.setValues(this.getValues());this.callParent(arguments);this.body.on("click",this.onBodyClick,this)},onBodyClick:function(f,e){var d=[f.getXY()[0]-8-this.body.getX(),f.getXY()[1]-8-this.body.getY()];this.valueHandle.setLeft(Ext.Number.constrain(d[0],0,this.getAvailableWidth()));this.valueHandle.setTop(Ext.Number.constrain(d[1],0,this.getAvailableHeight()));this.setValues(this.getValuesFromXY([this.valueHandle.getLeft(true),this.valueHandle.getTop(true)]));this.onSliderChangeComplete()},getAvailableWidth:function(){return this.body.getWidth()-18},getAvailableHeight:function(){return this.body.getHeight()-18},onHandleDrag:function(){this.setValues(this.getValuesFromXY([this.valueHandle.getLeft(true),this.valueHandle.getTop(true)]))},onHandleEndDrag:function(){this.setValues(this.getValuesFromXY([this.valueHandle.getLeft(true),this.valueHandle.getTop(true)]))},getValuesFromXY:function(i){var j=i[0]/this.getAvailableWidth();var g=i[1]/this.getAvailableHeight();var h=Math.round((this.horizontalCfg.maxValue-this.horizontalCfg.minValue)*j);var f=Math.round((this.verticalCfg.maxValue-this.verticalCfg.minValue)*g)+this.verticalCfg.minValue;return[h+this.horizontalCfg.minValue,f]},getXYFromValues:function(k){var g=this.horizontalCfg.maxValue-this.horizontalCfg.minValue;var i=this.verticalCfg.maxValue-this.verticalCfg.minValue;var h=Math.round((k[0]-this.horizontalCfg.minValue)*this.getAvailableWidth()/g);var l=k[1]-this.verticalCfg.minValue;var j=Math.round(l*this.getAvailableHeight()/i);return[h,j]},updatePosition:function(){var d=this.getValues();var c=this.getXYFromValues(d);this.valueHandle.setLeft(Ext.Number.constrain(c[0],0,this.getAvailableWidth()));if(this.verticalCfg.disabled){this.valueHandle.setTop(this.dialogConfig.rowHeight)}else{this.valueHandle.setTop(Ext.Number.constrain(c[1],0,this.getAvailableHeight()))}this.positionValueText();this.setValueText(d)},positionValueText:function(){var d=this.valueHandle.getTop(true);var c=this.valueHandle.getLeft(true);this.valueSpan.setLeft(c>30?-30:10);this.valueSpan.setTop(d>10?-20:20)},setValueText:function(b){if(this.verticalCfg.disabled){b[1]=this.dialogConfig.rowHeight}this.valueSpan.update("["+b.toString()+"]")},setValues:function(b){this.horizontal.setValue(b[0]);if(this.verticalCfg.reverse){if(!this.verticalCfg.disabled){this.vertical.setValue(this.verticalCfg.maxValue+this.verticalCfg.minValue-b[1])}}else{if(!this.verticalCfg.disabled){this.vertical.setValue(b[1])}}if(!this.dragging){this.updatePosition()}this.positionValueText();this.setValueText(b)},getValues:function(){if(!this.verticalCfg.disabled){var b=this.vertical.getValue();if(this.verticalCfg.reverse){b=this.verticalCfg.maxValue-b+this.verticalCfg.minValue}return[this.horizontal.getValue(),b]}return[this.horizontal.getValue()]},onSliderChange:function(){this.fireEvent("change",this,this.getValues());if(!this.dragging){this.updatePosition()}},onSliderChangeComplete:function(){this.fireEvent("changecomplete",this,this.getValues())},afterLayout:function(){this.callParent(arguments);this.updatePosition()}});Ext.define("Sch.widget.ExportDialogForm",{extend:"Ext.form.Panel",requires:["Ext.data.Store","Ext.ProgressBar","Ext.form.field.ComboBox","Ext.form.field.Date","Ext.form.FieldContainer","Ext.form.field.Checkbox","Sch.widget.ResizePicker"],border:false,bodyPadding:"10 10 0 10",autoHeight:true,initComponent:function(){var b=this;if(Ext.getVersion("extjs").isLessThan("4.2.1")){if(typeof Ext.tip!=="undefined"&&Ext.tip.Tip&&Ext.tip.Tip.prototype.minWidth!="auto"){Ext.tip.Tip.prototype.minWidth="auto"}}b.createFields();Ext.apply(this,{fieldDefaults:{labelAlign:"left",labelWidth:120,anchor:"99%"},items:[b.rangeField,b.resizerHolder,b.datesHolder,b.showHeaderField,b.exportToSingleField,b.formatField,b.orientationField,b.progressBar||b.createProgressBar()]});b.callParent(arguments);b.onRangeChange(null,b.dialogConfig.defaultConfig.range);b.on({hideprogressbar:b.hideProgressBar,showprogressbar:b.showProgressBar,updateprogressbar:b.updateProgressBar,scope:b})},isValid:function(){var b=this;if(b.rangeField.getValue()==="date"){return b.dateFromField.isValid()&&b.dateToField.isValid()}return true},getValues:function(j,l,k,g){var h=this.callParent(arguments);var i=this.resizePicker.getValues();if(!j){h.cellSize=i}else{h+="&cellSize[0]="+i[0]+"&cellSize[1]="+i[1]}return h},createFields:function(){var k=this,h=k.dialogConfig,i='<table class="sch-fieldcontainer-label-wrap"><td width="1" class="sch-fieldcontainer-label">',j='<td><div class="sch-fieldcontainer-separator"></div></table>';k.rangeField=new Ext.form.field.ComboBox({value:h.defaultConfig.range,triggerAction:"all",cls:"sch-export-dialog-range",forceSelection:true,editable:false,fieldLabel:h.rangeFieldLabel,name:"range",queryMode:"local",displayField:"name",valueField:"value",store:new Ext.data.Store({fields:["name","value"],data:[{name:h.completeViewText,value:"complete"},{name:h.dateRangeText,value:"date"},{name:h.currentViewText,value:"current"}]}),listeners:{change:k.onRangeChange,scope:k}});k.resizePicker=new Sch.widget.ResizePicker({dialogConfig:h,margin:"10 20"});k.resizerHolder=new Ext.form.FieldContainer({fieldLabel:h.scrollerDisabled?h.adjustCols:h.adjustColsAndRows,labelAlign:"top",hidden:true,labelSeparator:"",beforeLabelTextTpl:i,afterLabelTextTpl:j,layout:"vbox",defaults:{flex:1,allowBlank:false},items:[k.resizePicker]});k.dateFromField=new Ext.form.field.Date({fieldLabel:h.dateRangeFromText,baseBodyCls:"sch-exportdialogform-date",name:"dateFrom",format:h.dateRangeFormat||Ext.Date.defaultFormat,allowBlank:false,maxValue:h.endDate,minValue:h.startDate,value:h.startDate});k.dateToField=new Ext.form.field.Date({fieldLabel:h.dateRangeToText,name:"dateTo",format:h.dateRangeFormat||Ext.Date.defaultFormat,baseBodyCls:"sch-exportdialogform-date",allowBlank:false,maxValue:h.endDate,minValue:h.startDate,value:h.endDate});k.datesHolder=new Ext.form.FieldContainer({fieldLabel:h.specifyDateRange,labelAlign:"top",hidden:true,labelSeparator:"",beforeLabelTextTpl:i,afterLabelTextTpl:j,layout:"vbox",defaults:{flex:1,allowBlank:false},items:[k.dateFromField,k.dateToField]});k.showHeaderField=new Ext.form.field.Checkbox({xtype:"checkboxfield",boxLabel:k.dialogConfig.showHeaderLabel,name:"showHeader",checked:!!h.defaultConfig.showHeaderLabel});k.exportToSingleField=new Ext.form.field.Checkbox({xtype:"checkboxfield",boxLabel:k.dialogConfig.exportToSingleLabel,name:"singlePageExport",checked:!!h.defaultConfig.singlePageExport});k.formatField=new Ext.form.field.ComboBox({value:h.defaultConfig.format,triggerAction:"all",forceSelection:true,editable:false,fieldLabel:h.formatFieldLabel,name:"format",queryMode:"local",store:["A5","A4","A3","Letter","Legal"]});var l=h.defaultConfig.orientation==="portrait"?'class="sch-none"':"",g=h.defaultConfig.orientation==="landscape"?'class="sch-none"':"";k.orientationField=new Ext.form.field.ComboBox({value:h.defaultConfig.orientation,triggerAction:"all",baseBodyCls:"sch-exportdialogform-orientation",forceSelection:true,editable:false,fieldLabel:k.dialogConfig.orientationFieldLabel,afterSubTpl:new Ext.XTemplate('<span id="sch-exportdialog-imagePortrait" '+g+'></span><span id="sch-exportdialog-imageLandscape" '+l+"></span>"),name:"orientation",displayField:"name",valueField:"value",queryMode:"local",store:new Ext.data.Store({fields:["name","value"],data:[{name:h.orientationPortraitText,value:"portrait"},{name:h.orientationLandscapeText,value:"landscape"}]}),listeners:{change:function(a,b){switch(b){case"landscape":Ext.fly("sch-exportdialog-imagePortrait").toggleCls("sch-none");Ext.fly("sch-exportdialog-imageLandscape").toggleCls("sch-none");break;case"portrait":Ext.fly("sch-exportdialog-imagePortrait").toggleCls("sch-none");Ext.fly("sch-exportdialog-imageLandscape").toggleCls("sch-none");break}}}})},createProgressBar:function(){return this.progressBar=new Ext.ProgressBar({text:this.config.progressBarText,animate:true,hidden:true,margin:"4px 0 10px 0"})},onRangeChange:function(c,d){switch(d){case"complete":this.datesHolder.hide();this.resizerHolder.hide();break;case"date":this.datesHolder.show();this.resizerHolder.hide();break;case"current":this.datesHolder.hide();this.resizerHolder.show();this.resizePicker.expand(true);break}},showProgressBar:function(){if(this.progressBar){this.progressBar.show()}},hideProgressBar:function(){if(this.progressBar){this.progressBar.hide()}},updateProgressBar:function(b){if(this.progressBar){this.progressBar.updateProgress(b)}}});Ext.define("Sch.widget.ExportDialog",{alternateClassName:"Sch.widget.PdfExportDialog",extend:"Ext.window.Window",requires:["Sch.widget.ExportDialogForm"],mixins:["Sch.mixin.Localizable"],alias:"widget.exportdialog",modal:false,width:350,cls:"sch-exportdialog",frame:false,layout:"fit",draggable:true,padding:0,plugin:null,buttonsPanel:null,buttonsPanelScope:null,progressBar:null,dateRangeFormat:"",constructor:function(b){Ext.apply(this,b.exportDialogConfig);Ext.Array.forEach(["generalError","title","formatFieldLabel","orientationFieldLabel","rangeFieldLabel","showHeaderLabel","orientationPortraitText","orientationLandscapeText","completeViewText","currentViewText","dateRangeText","dateRangeFromText","pickerText","dateRangeToText","exportButtonText","cancelButtonText","progressBarText","exportToSingleLabel"],function(a){if(a in b){this[a]=b[a]}},this);this.title=this.L("title");this.config=Ext.apply({progressBarText:this.L("progressBarText"),dateRangeToText:this.L("dateRangeToText"),pickerText:this.L("pickerText"),dateRangeFromText:this.L("dateRangeFromText"),dateRangeText:this.L("dateRangeText"),currentViewText:this.L("currentViewText"),formatFieldLabel:this.L("formatFieldLabel"),orientationFieldLabel:this.L("orientationFieldLabel"),rangeFieldLabel:this.L("rangeFieldLabel"),showHeaderLabel:this.L("showHeaderLabel"),exportToSingleLabel:this.L("exportToSingleLabel"),orientationPortraitText:this.L("orientationPortraitText"),orientationLandscapeText:this.L("orientationLandscapeText"),completeViewText:this.L("completeViewText"),adjustCols:this.L("adjustCols"),adjustColsAndRows:this.L("adjustColsAndRows"),specifyDateRange:this.L("specifyDateRange"),dateRangeFormat:this.dateRangeFormat,defaultConfig:this.defaultConfig},b.exportDialogConfig);this.callParent(arguments)},initComponent:function(){var c=this,d={hidedialogwindow:c.destroy,showdialogerror:c.showError,updateprogressbar:function(a){c.fireEvent("updateprogressbar",a)},scope:this};c.form=c.buildForm(c.config);Ext.apply(this,{items:c.form,fbar:c.buildButtons(c.buttonsPanelScope||c)});c.callParent(arguments);c.plugin.on(d)},afterRender:function(){var b=this;b.relayEvents(b.form.resizePicker,["change","changecomplete","select"]);b.form.relayEvents(b,["updateprogressbar","hideprogressbar","showprogressbar"]);b.callParent(arguments)},buildButtons:function(b){return[{xtype:"button",scale:"medium",text:this.L("exportButtonText"),handler:function(){if(this.form.isValid()){this.fireEvent("showprogressbar");this.plugin.doExport(this.form.getValues())}},scope:b},{xtype:"button",scale:"medium",text:this.L("cancelButtonText"),handler:function(){this.destroy()},scope:b}]},buildForm:function(b){return new Sch.widget.ExportDialogForm({progressBar:this.progressBar,dialogConfig:b})},showError:function(e,f){var h=e,g=f||h.L("generalError");h.fireEvent("hideprogressbar");Ext.Msg.alert("",g)}});Ext.define("Gnt.locale.En",{extend:"Sch.locale.Locale",requires:"Sch.locale.En",singleton:true,l10n:{"Gnt.util.DurationParser":{unitsRegex:{MILLI:/^ms$|^mil/i,SECOND:/^s$|^sec/i,MINUTE:/^m$|^min/i,HOUR:/^h$|^hr$|^hour/i,DAY:/^d$|^day/i,WEEK:/^w$|^wk|^week/i,MONTH:/^mo|^mnt/i,QUARTER:/^q$|^quar|^qrt/i,YEAR:/^y$|^yr|^year/i}},"Gnt.field.Duration":{invalidText:"Invalid duration value"},"Gnt.feature.DependencyDragDrop":{fromText:"From",toText:"To",startText:"Start",endText:"End"},"Gnt.Tooltip":{startText:"Starts: ",endText:"Ends: ",durationText:"Duration: "},"Gnt.plugin.TaskContextMenu":{taskInformation:"Task information...",newTaskText:"New task",deleteTask:"Delete task(s)",editLeftLabel:"Edit left label",editRightLabel:"Edit right label",add:"Add...",deleteDependency:"Delete dependency...",addTaskAbove:"Task above",addTaskBelow:"Task below",addMilestone:"Milestone",addSubtask:"Sub-task",addSuccessor:"Successor",addPredecessor:"Predecessor",convertToMilestone:"Convert to milestone",convertToRegular:"Convert to regular task"},"Gnt.plugin.DependencyEditor":{fromText:"From",toText:"To",typeText:"Type",lagText:"Lag",endToStartText:"Finish-To-Start",startToStartText:"Start-To-Start",endToEndText:"Finish-To-Finish",startToEndText:"Start-To-Finish"},"Gnt.widget.calendar.Calendar":{dayOverrideNameHeaderText:"Name",overrideName:"Name",startDate:"Start Date",endDate:"End Date",error:"Error",dateText:"Date",addText:"Add",editText:"Edit",removeText:"Remove",workingDayText:"Working day",weekendsText:"Weekends",overriddenDayText:"Overridden day",overriddenWeekText:"Overridden week",workingTimeText:"Working time",nonworkingTimeText:"Non-working time",dayOverridesText:"Day overrides",weekOverridesText:"Week overrides",okText:"OK",cancelText:"Cancel",parentCalendarText:"Parent calendar",noParentText:"No parent",selectParentText:"Select parent",newDayName:"[Without name]",calendarNameText:"Calendar name",tplTexts:{tplWorkingHours:"Working hours for",tplIsNonWorking:"is non-working",tplOverride:"override",tplInCalendar:"in calendar",tplDayInCalendar:"standard day in calendar",tplBasedOn:"Based on"},overrideErrorText:"There is already an override for this day",overrideDateError:"There is already a week override on this date: {0}",startAfterEndError:"Start date should be less than end date",weeksIntersectError:"Week overrides should not intersect"},"Gnt.widget.calendar.AvailabilityGrid":{startText:"Start",endText:"End",addText:"Add",removeText:"Remove",error:"Error"},"Gnt.widget.calendar.DayEditor":{workingTimeText:"Working time",nonworkingTimeText:"Non-working time"},"Gnt.widget.calendar.WeekEditor":{defaultTimeText:"Default time",workingTimeText:"Working time",nonworkingTimeText:"Non-working time",error:"Error",noOverrideError:"Week override contains only 'default' days - can't save it"},"Gnt.widget.calendar.ResourceCalendarGrid":{name:"Name",calendar:"Calendar"},"Gnt.widget.calendar.CalendarWindow":{ok:"Ok",cancel:"Cancel"},"Gnt.field.Assignment":{cancelText:"Cancel",closeText:"Save and Close"},"Gnt.column.AssignmentUnits":{text:"Units"},"Gnt.column.Duration":{text:"Duration"},"Gnt.column.Effort":{text:"Effort"},"Gnt.column.EndDate":{text:"Finish"},"Gnt.column.PercentDone":{text:"% Done"},"Gnt.column.ResourceAssignment":{text:"Assigned Resources"},"Gnt.column.ResourceName":{text:"Resource Name"},"Gnt.column.SchedulingMode":{text:"Mode"},"Gnt.column.Predecessor":{text:"Predecessors"},"Gnt.column.Successor":{text:"Successors"},"Gnt.column.StartDate":{text:"Start"},"Gnt.column.WBS":{text:"WBS"},"Gnt.column.Sequence":{text:"#"},"Gnt.widget.taskeditor.TaskForm":{taskNameText:"Name",durationText:"Duration",datesText:"Dates",baselineText:"Baseline",startText:"Start",finishText:"Finish",percentDoneText:"Percent Complete",baselineStartText:"Start",baselineFinishText:"Finish",baselinePercentDoneText:"Percent Complete",effortText:"Effort",invalidEffortText:"Invalid effort value",calendarText:"Calendar",schedulingModeText:"Scheduling Mode"},"Gnt.widget.DependencyGrid":{idText:"ID",snText:"SN",taskText:"Task Name",blankTaskText:"Please select task",invalidDependencyText:"Invalid dependency",parentChildDependencyText:"Dependency between child and parent found",duplicatingDependencyText:"Duplicate dependency found",transitiveDependencyText:"Transitive dependency",cyclicDependencyText:"Cyclic dependency",typeText:"Type",lagText:"Lag",clsText:"CSS class",endToStartText:"Finish-To-Start",startToStartText:"Start-To-Start",endToEndText:"Finish-To-Finish",startToEndText:"Start-To-Finish"},"Gnt.widget.AssignmentEditGrid":{confirmAddResourceTitle:"Confirm",confirmAddResourceText:"Resource &quot;{0}&quot; not found in list. Would you like to add it?",noValueText:"Please select resource to assign",noResourceText:"No resource &quot;{0}&quot; found in the list"},"Gnt.widget.taskeditor.TaskEditor":{generalText:"General",resourcesText:"Resources",dependencyText:"Predecessors",addDependencyText:"Add new",dropDependencyText:"Remove",notesText:"Notes",advancedText:"Advanced",wbsCodeText:"WBS code",addAssignmentText:"Add new",dropAssignmentText:"Remove"},"Gnt.plugin.TaskEditor":{title:"Task Information",alertCaption:"Information",alertText:"Please correct marked errors to save changes",okText:"Ok",cancelText:"Cancel"},"Gnt.field.EndDate":{endBeforeStartText:"End date is before start date"},"Gnt.column.Note":{text:"Note"},"Gnt.column.AddNew":{text:"Add new column..."},"Gnt.column.EarlyStartDate":{text:"Early Start"},"Gnt.column.EarlyEndDate":{text:"Early Finish"},"Gnt.column.LateStartDate":{text:"Late Start"},"Gnt.column.LateEndDate":{text:"Late Finish"},"Gnt.field.Calendar":{calendarNotApplicable:"Task calendar has no overlapping with assigned resources calendars"},"Gnt.column.Slack":{text:"Slack"},"Gnt.column.Name":{text:"Task Name"},"Gnt.column.BaselineStartDate":{text:"Baseline Start Date"},"Gnt.column.BaselineEndDate":{text:"Baseline End Date"},"Gnt.column.Milestone":{text:"Milestone"},"Gnt.field.Milestone":{yes:"Yes",no:"No"},"Gnt.field.Dependency":{invalidFormatText:"Invalid dependency format",invalidDependencyText:"Invalid dependency found, please make sure you have no cyclic paths between your tasks",invalidDependencyType:"Invalid dependency type {0}. Allowed values are: {1}."}}});Ext.define("Gnt.mixin.Localizable",{extend:"Sch.mixin.Localizable",requires:["Gnt.locale.En"]});Ext.define("Gnt.model.CalendarDay",{requires:["Ext.data.Types"],extend:"Sch.model.Customizable",idProperty:"Id",customizableFields:[{name:"Date",type:"date",dateFormat:"c",convert:function(d,e){if(!d){return}var f=Ext.data.Types.DATE.convert.call(this,d);if(f){Ext.Date.clearTime(f)}return f}},{name:"Weekday",type:"int"},{name:"OverrideStartDate",type:"date",dateFormat:"c"},{name:"OverrideEndDate",type:"date",dateFormat:"c"},{name:"Type",defaultValue:"DAY"},{name:"Id"},{name:"IsWorkingDay",type:"boolean",defaultValue:false},{name:"Cls",defaultValue:"gnt-holiday"},"Name",{name:"Availability",convert:function(c,d){if(c){return Ext.typeOf(c)==="string"?[c]:c}else{return[]}}}],availabilityCache:null,weekDayField:"Weekday",overrideStartDateField:"OverrideStartDate",overrideEndDateField:"OverrideEndDate",typeField:"Type",dateField:"Date",isWorkingDayField:"IsWorkingDay",clsField:"Cls",nameField:"Name",availabilityField:"Availability",setDate:function(b){if(b){b=Ext.Date.clearTime(b,true)}this.set(this.dateField,b)},clearDate:function(){this.set(this.dateField,null)},getAvailability:function(d){var f=this;if(d){return this.get(this.availabilityField)}if(this.availabilityCache){return this.availabilityCache}var e=[];Ext.Array.each(this.get(this.availabilityField),function(a){e.push(Ext.typeOf(a)==="string"?f.parseInterval(a):a)});this.verifyAvailability(e);return this.availabilityCache=e},setAvailability:function(b){this.availabilityCache=null;this.set(this.availabilityField,this.stringifyIntervals(b));this.getAvailability()},verifyAvailability:function(e){e.sort(function(a,b){return a.startTime-b.startTime});Ext.Array.each(e,function(a){if(a.startTime>a.endTime){throw new Error("Start time "+Ext.Date.format(a.startTime,"H:i")+" is greater than end time "+Ext.Date.format(a.endTime,"H:i"))}});for(var f=1;f<e.length;f++){var h=e[f-1];var g=e[f];if(h.endTime>g.startTime){throw new Error("Availability intervals should not intersect: ["+this.stringifyInterval(h)+"] and ["+this.stringifyInterval(g)+"]")}}},prependZero:function(b){return b<10?"0"+b:b},stringifyInterval:function(d){var f=d.startTime;var e=d.endTime;return this.prependZero(f.getHours())+":"+this.prependZero(f.getMinutes())+"-"+(e.getDate()==1?24:this.prependZero(e.getHours()))+":"+this.prependZero(e.getMinutes())},stringifyIntervals:function(d){var f=this;var e=[];Ext.Array.each(d,function(a){if(Ext.typeOf(a)==="string"){e.push(a)}else{e.push(f.stringifyInterval(a))}});return e},parseInterval:function(c){var d=/(\d\d):(\d\d)-(\d\d):(\d\d)/.exec(c);if(!d){throw"Invalid format for availability string: "+c+". It should have exact format: hh:mm-hh:mm"}return{startTime:new Date(0,0,0,d[1],d[2]),endTime:new Date(0,0,0,d[3],d[4])}},getTotalHours:function(){return this.getTotalMS()/1000/60/60},getTotalMS:function(){var b=0;Ext.Array.each(this.getAvailability(),function(a){b+=a.endTime-a.startTime});return b},addAvailabilityInterval:function(g,e){var f;if(g instanceof Date){f={startTime:g,endTime:e}}else{f=this.parseInterval(g+(e?"-"+e:""))}var h=this.getAvailability().concat(f);this.verifyAvailability(h);this.setAvailability(h)},removeAvailbilityInterval:function(d){var c=this.getAvailability();c.splice(d,1);this.setAvailability(c)},getAvailabilityIntervalsFor:function(i){i=typeof i=="number"?new Date(i):i;var j=i.getFullYear();var h=i.getMonth();var f=i.getDate();var g=[];Ext.Array.each(this.getAvailability(),function(b){var a=b.endTime.getDate();g.push({startDate:new Date(j,h,f,b.startTime.getHours(),b.startTime.getMinutes()),endDate:new Date(j,h,f+(a==1?1:0),b.endTime.getHours(),b.endTime.getMinutes())})});return g},getAvailabilityStartFor:function(c){var d=this.getAvailabilityIntervalsFor(c);if(!d.length){return null}return d[0].startDate},getAvailabilityEndFor:function(c){var d=this.getAvailabilityIntervalsFor(c);if(!d.length){return null}return d[d.length-1].endDate}});Ext.define("Gnt.model.Assignment",{extend:"Sch.model.Customizable",idProperty:"Id",customizableFields:[{name:"Id"},{name:"ResourceId"},{name:"TaskId"},{name:"Units",type:"float",defaultValue:100}],resourceIdField:"ResourceId",taskIdField:"TaskId",unitsField:"Units",isPersistable:function(){var d=this.getTask(),c=this.getResource();return d&&!d.phantom&&c&&!c.phantom},getUnits:function(){return Math.max(0,this.get(this.unitsField))},setUnits:function(b){if(b<0){throw"`Units` value for an assignment can't be less than 0"}this.set(this.unitsField,b)},getResourceName:function(){var b=this.getResource();if(b){return b.getName()}return""},getTask:function(b){b=b||this.stores[0].getTaskStore();return b&&b.getByInternalId(this.getTaskId())},getResource:function(){return this.stores[0]&&this.stores[0].getResourceStore().getByInternalId(this.getResourceId())},getInternalId:function(){return this.getId()||this.internalId},getEffort:function(d){var e=this.getTask();var f=0;e.forEachAvailabilityIntervalWithResources({startDate:e.getStartDate(),endDate:e.getEndDate(),resources:[this.getResource()]},function(b,c,i){var a;for(var j in i){a=i[j].units}f+=(c-b)*a/100});return e.getProjectCalendar().convertMSDurationToUnit(f,d||e.getEffortUnit())}});Ext.define("Gnt.model.Dependency",{extend:"Sch.model.Customizable",inheritableStatics:{Type:{StartToStart:0,StartToEnd:1,EndToStart:2,EndToEnd:3}},idProperty:"Id",customizableFields:[{name:"Id"},{name:"From"},{name:"To"},{name:"Type",type:"int",defaultValue:2},{name:"Lag",type:"number",defaultValue:0},{name:"LagUnit",type:"string",defaultValue:"d",convert:function(b){return b||"d"}},{name:"Cls"}],fromField:"From",toField:"To",typeField:"Type",lagField:"Lag",lagUnitField:"LagUnit",clsField:"Cls",isHighlighted:false,constructor:function(b){this.callParent(arguments);if(b){if(b[this.fromField]&&b[this.fromField] instanceof Gnt.model.Task){this.setSourceTask(b[this.fromField]);delete b.fromField}if(b[this.toField]&&b[this.toField] instanceof Gnt.model.Task){this.setTargetTask(b[this.toField]);delete b.toField}}},getTaskStore:function(){return this.stores[0].taskStore},getSourceTask:function(b){return(b||this.getTaskStore()).getById(this.getSourceId())},setSourceTask:function(b){this.setSourceId(b.getId()||b.internalId)},getTargetTask:function(b){return(b||this.getTaskStore()).getById(this.getTargetId())},setTargetTask:function(b){this.setTargetId(b.getId()||b.internalId)},getSourceId:function(){return this.get(this.fromField)},setSourceId:function(b){this.set(this.fromField,b)},getTargetId:function(){return this.get(this.toField)},setTargetId:function(b){this.set(this.toField,b)},getLagUnit:function(){return this.get(this.lagUnitField)||"d"},isPersistable:function(){var d=this.getSourceTask(),c=this.getTargetTask();return d&&!d.phantom&&c&&!c.phantom},isValid:function(f){var i=this.callParent(arguments),h=this.getSourceId(),g=this.getTargetId(),j=this.getType();if(i){i=Ext.isNumber(j)&&!Ext.isEmpty(h)&&!Ext.isEmpty(g)&&h!=g}if(i&&f!==false&&this.stores[0]){i=this.stores[0].isValidDependency(h,g,j,null,null,this)}return i},getInternalId:function(){return this.getId()||this.internalId}});Ext.define("Gnt.model.Resource",{extend:"Sch.model.Resource",customizableFields:["CalendarId"],calendarIdField:"CalendarId",normalized:false,calendarWaitingListener:null,getTaskStore:function(){return this.stores[0].getTaskStore()},getEventStore:function(){return this.getTaskStore()},getEvents:function(){return this.getTasks()},getTasks:function(){var b=[];this.forEachAssignment(function(a){var d=a.getTask();if(d){b.push(d)}});return b},getCalendar:function(b){return b?this.getOwnCalendar():this.getOwnCalendar()||this.getProjectCalendar()},getOwnCalendar:function(){var b=this.getCalendarId();return b?Gnt.data.Calendar.getCalendar(b):null},getProjectCalendar:function(){return this.stores[0].getTaskStore().getCalendar()},setCalendar:function(c){var d=c instanceof Gnt.data.Calendar;if(d&&!c.calendarId){throw new Error("Can't set calendar w/o `calendarId` property")}this.setCalendarId(d?c.calendarId:c)},setCalendarId:function(l,k){if(l instanceof Gnt.data.Calendar){l=l.calendarId}var g=this.getCalendarId();if(g!=l||k){if(this.calendarWaitingListener){this.calendarWaitingListener.destroy();this.calendarWaitingListener=null}var h={calendarchange:this.adjustToCalendar,scope:this};var i=this.calendar||Gnt.data.Calendar.getCalendar(g);this.calendar=null;i&&i.un(h);this.set(this.calendarIdField,l);var j=Gnt.data.Calendar.getCalendar(l);if(j){j.on(h);if(!k){this.adjustToCalendar()}}else{this.calendarWaitingListener=Ext.data.StoreManager.on("add",function(c,a,b){j=Gnt.data.Calendar.getCalendar(l);if(j){this.calendarWaitingListener.destroy();this.calendarWaitingListener=null;j.on(h);this.adjustToCalendar()}},this,{destroyable:true})}}},adjustToCalendar:function(){this.forEachTask(function(b){b.adjustToCalendar()})},getInternalId:function(){return this.getId()||this.internalId},assignTo:function(e,f){var d=e instanceof Gnt.model.Task?e:this.getTaskStore().getById(e);return d.assign(this,f)},unassignFrom:function(){return this.unAssignFrom.apply(this,arguments)},unAssignFrom:function(d){var c=d instanceof Gnt.model.Task?d:this.getTaskStore().getById(d);c.unAssign(this)},forEachAssignment:function(d,e){e=e||this;var f=this.getInternalId();this.getTaskStore().getAssignmentStore().each(function(a){if(a.getResourceId()==f){return d.call(e,a)}})},forEachTask:function(d,e){e=e||this;var f=this.getInternalId();this.getTaskStore().getAssignmentStore().each(function(a){if(a.getResourceId()==f){var b=a.getTask();if(b){return d.call(e,b)}}})},collectAvailabilityIntervalPoints:function(q,p,w,l,t){var u=Ext.isFunction(p)?function(a){l[a].push(p(a))}:function(a){l[a].push(p)};var r=Ext.isFunction(w)?function(a){l[a].push(w(a))}:function(a){l[a].push(w)};for(var s=0,v=q.length;s<v;s++){var x=q[s];var o=x.startDate-0;var k=x.endDate-0;if(!l[o]){l[o]=[];t.push(o)}u(o);if(!l[k]){l[k]=[];t.push(k)}r(k)}},forEachAvailabilityIntervalWithTasks:function(ac,aa,ag){ag=ag||this;var ad=ac.startDate;var T=ac.endDate;if(!ad||!T){throw"Both `startDate` and `endDate` are required for `forEachAvailabilityIntervalWithTasks`"}var Z=new Date(ad);var Q=ac.includeAllIntervals;var R=ac.includeResCalIntervals;var O=this.getCalendar();var U=[];var S=[];var af=[];var I=[ad-0,T-0];var X={};X[ad-0]=[{type:"00-intervalStart"}];X[T-0]=[{type:"00-intervalEnd"}];this.forEachAssignment(function(d){var c=d.getTask();if(!c){return}var e=c.getStartDate();var a=c.getEndDate();var b=c.getInternalId();if(e>T||a<ad){return}S.push(c);af.push(c.getCalendar());this.collectAvailabilityIntervalPoints([{startDate:e,endDate:a}],{type:"05-taskStart",assignment:d,taskId:b,units:d.getUnits()},{type:"04-taskEnd",taskId:b},X,I);U.push(d)});if(!S.length&&!Q&&!R){return}var ab=Sch.util.Date;var W,M,ae;while(Z<T){this.collectAvailabilityIntervalPoints(O.getAvailabilityIntervalsFor(Z),{type:"00-resourceAvailabilityStart"},{type:"01-resourceAvailabilityEnd"},X,I);for(W=0,M=af.length;W<M;W++){ae=S[W].getInternalId();this.collectAvailabilityIntervalPoints(af[W].getAvailabilityIntervalsFor(Z),{type:"02-taskAvailabilityStart",taskId:ae},{type:"03-taskAvailabilityEnd",taskId:ae},X,I)}Z=ab.getStartOfNextDay(Z)}I.sort(function(a,b){return a-b});var k=false,L=false,N={},ah=0,i=0;for(W=0,M=I.length-1;W<M;W++){var j=X[I[W]];j.sort(function(a,b){return a.type<b.type?1:-1});for(var K=0,l=j.length;K<l;K++){var P=j[K];switch(P.type){case"00-resourceAvailabilityStart":L=true;break;case"01-resourceAvailabilityEnd":L=false;break;case"02-taskAvailabilityStart":ah++;break;case"03-taskAvailabilityEnd":ah--;break;case"05-taskStart":N[P.taskId]=P;i++;break;case"04-taskEnd":delete N[P.taskId];i--;break;case"00-intervalStart":k=true;break;case"00-intervalEnd":return}}if(k&&(Q||R&&L||L&&ah&&i)){var V={inResourceCalendar:!!L,inTasksCalendar:!!ah,inTask:i};var J=I[W];var Y=I[W+1];if(J>T||Y<ad){continue}if(J<ad){J=ad-0}if(Y>T){Y=T-0}if(aa.call(ag,J,Y,N,V)===false){return false}}}},getAllocationInfo:function(d){var c=[];this.forEachAvailabilityIntervalWithTasks(d,function(b,i,l,a){var m=0,o=[],p={};if(a.inResourceCalendar&&a.inTasksCalendar&&a.inTask){for(var n in l){m+=l[n].units;o.push(l[n].assignment);p[n]=l[n].assignment}}c.push(Ext.apply({startDate:new Date(b),endDate:new Date(i),totalAllocation:m,assignments:o,assignmentsHash:p},a))});return c}});Ext.define("Gnt.model.task.More",{indent:function(){var f=this.previousSibling;if(f){var e={parentNode:this.parentNode,previousSibling:this.previousSibling,nextSibling:this.nextSibling};var d=this.getTaskStore();d.suspendEvents(true);f.appendChild(this);this.removeContext=e;f.removeInvalidDependencies();d.resumeEvents();f.set("leaf",false);f.expand()}},outdent:function(){var d=this.parentNode;if(d&&!d.isRoot()){var e={parentNode:this.parentNode,previousSibling:this.previousSibling,nextSibling:this.nextSibling};if(this.convertEmptyParentToLeaf){d.set("leaf",d.childNodes.length===1)}var f=this.getTaskStore();f.suspendEvents(true);if(d.nextSibling){d.parentNode.insertBefore(this,d.nextSibling)}else{d.parentNode.appendChild(this)}this.removeContext=e;f.resumeEvents();if(f.recalculateParents&&d.childNodes.length){d.childNodes[0].recalculateParents()}}},removeInvalidDependencies:function(){var e=this.getDependencyStore(),f=this.getAllDependencies();for(var d=0;d<f.length;d++){if(!f[d].isValid(true)){e.remove(f[d])}}},getAllDependencies:function(){return this.predecessors.concat(this.successors)},hasIncomingDependencies:function(){return this.predecessors.length>0},hasOutgoingDependencies:function(){return this.successors.length>0},getIncomingDependencies:function(b){return b?this.predecessors:this.predecessors.slice()},getOutgoingDependencies:function(b){return b?this.successors:this.successors.slice()},constrain:function(j){if(this.isManuallyScheduled()){return false}var h=false;j=j||this.getTaskStore();var f=this.getConstrainContext(j);if(f){var g=f.startDate;var i=f.endDate;if(g&&g-this.getStartDate()!==0){this.setStartDate(g,true,j.skipWeekendsDuringDragDrop);h=true}else{if(i&&i-this.getEndDate()!==0){this.setEndDate(i,true,j.skipWeekendsDuringDragDrop);h=true}}}return h},getConstrainContext:function(m){var l=this.getIncomingDependencies(true);if(!l.length){return null}var r=Gnt.model.Dependency.Type,p=new Date(0),q=new Date(0),j=this.getProjectCalendar(),k=this.getCalendar(),o;var n=(m||this.getTaskStore()).dependenciesCalendar;Ext.each(l,function(b){var c=b.getSourceTask();if(c){var g;if(n=="project"){g=j}else{if(n=="source"){g=c.getCalendar()}else{if(n=="target"){g=k}else{throw"Unsupported value for `dependenciesCalendar` config option"}}}var e=b.getLag()||0,a=b.getLagUnit(),f=c.getStartDate(),d=c.getEndDate();switch(b.getType()){case r.StartToEnd:f=g.skipWorkingTime(f,e,a);if(q<f){q=f;o=c}break;case r.StartToStart:f=g.skipWorkingTime(f,e,a);if(p<f){p=f;o=c}break;case r.EndToStart:d=g.skipWorkingTime(d,e,a);if(p<d){p=d;o=c}break;case r.EndToEnd:d=g.skipWorkingTime(d,e,a);if(q<d){q=d;o=c}break;default:throw"Invalid dependency type: "+b.getType()}}});return{startDate:p>0?p:null,endDate:q>0?q:null,constrainingTask:o}},getCriticalPaths:function(){var c=[this],d=this.getConstrainContext();while(d){c.push(d.constrainingTask);d=d.constrainingTask.getConstrainContext()}return c},cascadeChanges:function(f,j,i){j=j||{nbrAffected:0,affected:{}};f=f||this.getTaskStore();var g=f.currentCascadeBatch;if(g){if(g.visitedCounters[this.internalId]>this.predecessors.length){return}g.addVisited(this)}if(this.isLeaf()||f.enableDependenciesForParentTasks){var h=this.constrain(f);if(h){j.nbrAffected++;j.affected[this.internalId]=this;if(g){g.addAffected(this)}Ext.each(this.getOutgoingDependencies(true),function(b){var a=b.getTargetTask();if(a&&!a.isManuallyScheduled()){a.cascadeChanges(f,j,b)}})}}return j},addSubtask:function(b){this.set("leaf",false);this.appendChild(b);this.expand();return b},addSuccessor:function(e){var g=this.getTaskStore(),h=this.getDependencyStore();e=e||new this.self();e.calendar=e.calendar||this.getCalendar();e.taskStore=g;if(this.getEndDate()){e.setStartDate(this.getEndDate(),true,g.skipWeekendsDuringDragDrop);e.setDuration(1,Sch.util.Date.DAY)}this.addTaskBelow(e);var f=new h.model();f.setSourceTask(this);f.setTargetTask(e);f.setType(h.model.Type.EndToStart);h.add(f);return e},addMilestone:function(f){var d=this.getTaskStore();f=f||new this.self();var e=this.getEndDate();if(e){f.calendar=f.calendar||this.getCalendar();f.setStartEndDate(e,e,d.skipWeekendsDuringDragDrop)}return this.addTaskBelow(f)},addPredecessor:function(f){var d=this.getDependencyStore();f=f||new this.self();f.calendar=f.calendar||this.getCalendar();f.beginEdit();if(this.getStartDate()){f.set(this.startDateField,f.calculateStartDate(this.getStartDate(),1,Sch.util.Date.DAY));f.set(this.endDateField,this.getStartDate());f.set(this.durationField,1);f.set(this.durationUnitField,Sch.util.Date.DAY)}f.endEdit();this.addTaskAbove(f);var e=new d.model();e.setSourceTask(f);e.setTargetTask(this);e.setType(d.model.Type.EndToStart);d.add(e);return f},getSuccessors:function(){var h=this.successors,i=[];for(var j=0,g=h.length;j<g;j++){var f=h[j].getTargetTask();if(f){i.push(f)}}return i},getPredecessors:function(){var h=this.predecessors,i=[];for(var j=0,g=h.length;j<g;j++){var f=h[j].getSourceTask();if(f){i.push(f)}}return i},addTaskAbove:function(b){b=b||new this.self();return this.parentNode.insertBefore(b,this)},addTaskBelow:function(b){b=b||new this.self();if(this.nextSibling){return this.parentNode.insertBefore(b,this.nextSibling)}else{return this.parentNode.appendChild(b)}},isAbove:function(f){var e=this,g=Math.min(e.data.depth,f.data.depth);var h=this;while(h.data.depth>g){h=h.parentNode;if(h==f){return false}}while(f.data.depth>g){f=f.parentNode;if(f==e){return true}}while(f.parentNode!==h.parentNode){f=f.parentNode;h=h.parentNode}return f.data.index>h.data.index},cascadeChildren:function(k,l){var j=this;if(j.isLeaf()){return}var i=this.childNodes;for(var g=0,h=i.length;g<h;g++){i[g].cascadeBy(k,l)}},getViolatedConstraints:function(){if(!this.get("leaf")||this.isManuallyScheduled()){return false}var b=this.getEarlyStartDate();if(this.getStartDate()<b){return[{task:this,startDate:b}]}return null},resolveViolatedConstraints:function(h){h=h||this.getViolatedConstraints();if(!h){return}if(!Ext.isArray(h)){h=[h]}var f=this.getTaskStore();for(var j,i=0,g=h.length;i<g;i++){j=h[i];if(j.startDate){j.task.setStartDate(j.startDate,true,f.skipWeekendsDuringDragDrop)}else{if(j.endDate){j.task.setEndDate(j.endDate,true,f.skipWeekendsDuringDragDrop)}}}},getSlack:function(d){d=d||Sch.util.Date.DAY;var f=this.getEarlyStartDate(),e=this.getLateStartDate();if(!f||!e){return null}return this.getCalendar().calculateDuration(this.getEarlyStartDate(),this.getLateStartDate(),d)},getEarlyStartDate:function(){var o=this.getTaskStore();if(!o){return this.getEndDate()}var q=this.internalId;if(o.earlyStartDates[q]){return o.earlyStartDates[q]}var w,i=0,s,t;if(this.childNodes.length){for(s=0,t=this.childNodes.length;s<t;s++){w=this.childNodes[s].getEarlyStartDate();if(w<i||!i){i=w}}o.earlyStartDates[q]=i;return i}if(this.isManuallyScheduled()){i=o.earlyStartDates[q]=this.getStartDate();return i}var l=this.getIncomingDependencies(true),p;if(!l.length){i=o.earlyStartDates[q]=this.getStartDate();return i}var r=Gnt.model.Dependency.Type,x=this.getCalendar(),u=this.getProjectCalendar(),v;for(s=0,t=l.length;s<t;s++){p=l[s].getSourceTask();if(p){switch(l[s].getType()){case r.StartToStart:w=p.getEarlyStartDate();break;case r.StartToEnd:w=p.getEarlyStartDate();w=x.calculateStartDate(w,this.getDuration(),this.getDurationUnit());break;case r.EndToStart:w=p.getEarlyEndDate();break;case r.EndToEnd:w=p.getEarlyEndDate();w=x.calculateStartDate(w,this.getDuration(),this.getDurationUnit());break}v=l[s].getLag();if(v){w=u.skipWorkingTime(w,v,l[s].getLagUnit())}w=u.skipNonWorkingTime(w,true)}if(w>i){i=w}}o.earlyStartDates[q]=i;return o.earlyStartDates[q]},getEarlyEndDate:function(){var m=this.getTaskStore();if(!m){return this.getEndDate()}var n=this.internalId;if(m.earlyEndDates[n]){return m.earlyEndDates[n]}var i=0;if(this.childNodes.length){var k,l,h;for(l=0,h=this.childNodes.length;l<h;l++){k=this.childNodes[l].getEarlyEndDate();if(k>i){i=k}}m.earlyEndDates[n]=i;return i}if(this.isManuallyScheduled()){i=m.earlyEndDates[n]=this.getEndDate();return i}var j=this.getEarlyStartDate();if(!j){return null}i=m.earlyEndDates[n]=this.getCalendar().calculateEndDate(j,this.getDuration(),this.getDurationUnit());return i},getLateEndDate:function(){var o=this.getTaskStore();if(!o){return this.getEndDate()}var p=this.internalId;if(o.lateEndDates[p]){return o.lateEndDates[p]}var w,i=0,r,t;if(this.childNodes.length){for(r=0,t=this.childNodes.length;r<t;r++){w=this.childNodes[r].getLateEndDate();if(w>i){i=w}}o.lateEndDates[p]=i;return i}if(this.isManuallyScheduled()){i=o.lateEndDates[p]=this.getEndDate();return i}var l=this.getOutgoingDependencies(true);if(!l.length){i=o.lateEndDates[p]=o.getProjectEndDate();return i}var q=Gnt.model.Dependency.Type,x=this.getCalendar(),u=this.getProjectCalendar(),s,v;for(r=0,t=l.length;r<t;r++){s=l[r].getTargetTask();if(s){switch(l[r].getType()){case q.StartToStart:w=s.getLateStartDate();w=x.calculateEndDate(w,this.getDuration(),this.getDurationUnit());break;case q.StartToEnd:w=s.getLateEndDate();w=x.calculateEndDate(w,this.getDuration(),this.getDurationUnit());break;case q.EndToStart:w=s.getLateStartDate();break;case q.EndToEnd:w=s.getLateEndDate();break}v=l[r].getLag();if(v){w=u.skipWorkingTime(w,-v,l[r].getLagUnit())}w=u.skipNonWorkingTime(w,false);if(w<i||!i){i=w}}}o.lateEndDates[p]=i||o.getProjectEndDate();return o.lateEndDates[p]},getLateStartDate:function(){var m=this.getTaskStore();if(!m){return this.getStartDate()}var n=this.internalId;if(m.lateStartDates[n]){return m.lateStartDates[n]}var i;if(this.childNodes.length){var k,l,h;for(l=0,h=this.childNodes.length;l<h;l++){k=this.childNodes[l].getLateStartDate();if(k<i||!i){i=k}}m.lateStartDates[n]=i;return i}if(this.isManuallyScheduled()){i=m.lateStartDates[n]=this.getStartDate();return i}var j=this.getLateEndDate();if(!j){return null}i=m.lateStartDates[n]=this.getCalendar().calculateStartDate(j,this.getDuration(),this.getDurationUnit());return i},resetEarlyDates:function(){var c=this.getTaskStore();if(!c){return}var d=this.internalId;c.earlyStartDates[d]=null;c.earlyEndDates[d]=null},resetLateDates:function(){var c=this.getTaskStore();if(!c){return}var d=this.internalId;c.lateStartDates[d]=null;c.lateEndDates[d]=null},getTopParent:function(j){var f=this.getTaskStore().getRootNode(),h=this,i=[this],g;while(h){if(h===f){return j?i:g}i.push(h);g=h;h=h.parentNode}}});Ext.define("Gnt.model.Task",{extend:"Sch.model.Range",requires:["Sch.util.Date","Ext.data.NodeInterface"],mixins:["Gnt.model.task.More"],idProperty:"Id",customizableFields:[{name:"Id"},{name:"Duration",type:"number",useNull:true},{name:"Effort",type:"number",useNull:true},{name:"EffortUnit",type:"string",defaultValue:"h"},{name:"CalendarId",type:"string"},{name:"Note",type:"string"},{name:"DurationUnit",type:"string",defaultValue:"d",convert:function(b){return b||"d"}},{name:"PercentDone",type:"number",defaultValue:0},{name:"ManuallyScheduled",type:"boolean",defaultValue:false},{name:"SchedulingMode",type:"string",defaultValue:"Normal"},{name:"BaselineStartDate",type:"date",dateFormat:"c"},{name:"BaselineEndDate",type:"date",dateFormat:"c"},{name:"BaselinePercentDone",type:"int",defaultValue:0},{name:"Draggable",type:"boolean",persist:false,defaultValue:true},{name:"Resizable",persist:false},{name:"PhantomId",type:"string"},{name:"PhantomParentId",type:"string"},{name:"index",type:"int",persist:true}],draggableField:"Draggable",resizableField:"Resizable",nameField:"Name",durationField:"Duration",durationUnitField:"DurationUnit",effortField:"Effort",effortUnitField:"EffortUnit",percentDoneField:"PercentDone",manuallyScheduledField:"ManuallyScheduled",schedulingModeField:"SchedulingMode",calendarIdField:"CalendarId",baselineStartDateField:"BaselineStartDate",baselineEndDateField:"BaselineEndDate",baselinePercentDoneField:"BaselinePercentDone",noteField:"Note",calendar:null,dependencyStore:null,taskStore:null,phantomIdField:"PhantomId",phantomParentIdField:"PhantomParentId",normalized:false,recognizedSchedulingModes:["Normal","Manual","FixedDuration","EffortDriven","DynamicAssignment"],convertEmptyParentToLeaf:true,autoCalculateEffortForParentTask:true,autoCalculatePercentDoneForParentTask:true,isHighlighted:false,calendarWaitingListener:null,childTasksDuration:null,completedChildTasksDuration:null,totalCount:null,predecessors:null,successors:null,assignments:null,removeChildIsCalledFromReplaceChild:false,savedDirty:null,constructor:function(){this.callParent(arguments);if(this.idgen.type!="default"){this.internalId=this.getId()}if(this.phantom){this.data[this.phantomIdField]=this.internalId;this._phantomId=this.internalId}this.predecessors=[];this.successors=[];this.assignments=[]},normalize:function(){var y=this.getDuration(),u=this.getDurationUnit(),z=this.getStartDate(),v=this.getEndDate(),w=this.getSchedulingMode(),x=this.data,s=this.getTaskStore(true);this.assignments=s&&s.cachedAssignments&&s.cachedAssignments[this.getId()]||[];var A=this.endDateField;var r=this.effortField;if(v&&this.inclusiveEndDate){var q=this.fields.getByKey(A).dateFormat;var B=(q&&!Ext.Date.formatContainsHourInfo(q))||(v.getHours()===0&&v.getMinutes()===0&&v.getSeconds()===0&&v.getMilliseconds()===0);if(B){if(Ext.isNumber(y)){v=x[A]=this.calculateEndDate(z,y,u)}else{v=x[A]=Ext.Date.add(v,Ext.Date.DAY,1)}}}if(y==null&&z&&v){y=x[this.durationField]=this.calculateDuration(z,v,u)}if((w=="Normal"||this.isManuallyScheduled())&&v==null&&z&&Ext.isNumber(y)){v=x[A]=this.calculateEndDate(z,y,u)}var o=this.get(r),t=this.getEffortUnit();if(w=="FixedDuration"){if(v==null&&z&&Ext.isNumber(y)){v=x[A]=this.calculateEndDate(z,y,u)}if(o==null&&z&&v){x[r]=this.calculateEffort(z,v,t)}}else{if(w=="EffortDriven"){if(o==null&&z&&v){x[r]=this.calculateEffort(z,v,t)}if(v==null&&z&&o){x[A]=this.calculateEffortDrivenEndDate(z,o,t);if(y==null){x[this.durationField]=this.calculateDuration(z,x[A],u)}}}else{if(v==null&&z&&Ext.isNumber(y)){v=x[A]=this.calculateEndDate(z,y,u)}}}var p=this.getCalendarId();if(p){this.setCalendarId(p,true)}this.normalized=true},normalizeParent:function(){var i=this.childNodes;var v=0;var s=0;var o=0;var n=this.autoCalculatePercentDoneForParentTask;var q=this.autoCalculateEffortForParentTask;for(var r=0;r<i.length;r++){var t=i[r];var u=t.isLeaf();if(!u){t.normalizeParent()}if(q){v+=t.getEffort("MILLI")}if(n){var m=u?t.getDuration("MILLI")||0:t.childTasksDuration;s+=m;o+=u?m*(t.getPercentDone()||0):t.completedChildTasksDuration}}if(n){this.childTasksDuration=s;this.completedChildTasksDuration=o;var p=s?o/s:0;if(this.getPercentDone()!=p){this.data[this.percentDoneField]=p}}if(q){if(this.getEffort("MILLI")!=v){this.data[this.effortField]=this.getProjectCalendar().convertMSDurationToUnit(v,this.getEffortUnit())}}},getInternalId:function(){return this.getId()||this.internalId},getCalendar:function(b){return b?this.getOwnCalendar():this.getOwnCalendar()||this.parentNode&&this.parentNode.getCalendar()||this.getProjectCalendar()},getOwnCalendar:function(){var b=this.get(this.calendarIdField);return b?Gnt.data.Calendar.getCalendar(b):this.calendar},getProjectCalendar:function(){var d=this.getTaskStore(true);var c=d&&d.getCalendar()||this.parentNode&&this.parentNode.getProjectCalendar()||this.isRoot()&&this.calendar;if(!c){Ext.Error.raise("Can't find a project calendar in `getProjectCalendar`")}return c},setCalendar:function(c){var d=c instanceof Gnt.data.Calendar;if(d&&!c.calendarId){throw new Error("Can't set calendar w/o `calendarId` property")}this.setCalendarId(d?c.calendarId:c)},setCalendarId:function(l,k){if(l instanceof Gnt.data.Calendar){l=l.calendarId}var g=this.getCalendarId();if(g!=l||k){if(this.calendarWaitingListener){this.calendarWaitingListener.destroy();this.calendarWaitingListener=null}var h={calendarchange:this.adjustToCalendar,scope:this};var i=this.calendar||Gnt.data.Calendar.getCalendar(g);this.calendar=null;i&&i.un(h);this.set(this.calendarIdField,l);var j=Gnt.data.Calendar.getCalendar(l);if(j){j.on(h);if(!k){this.adjustToCalendar()}}else{this.calendarWaitingListener=Ext.data.StoreManager.on("add",function(c,a,b){j=Gnt.data.Calendar.getCalendar(l);if(j){this.calendarWaitingListener.destroy();this.calendarWaitingListener=null;j.on(h);this.adjustToCalendar()}},this,{destroyable:true})}}},getDependencyStore:function(){var b=this.dependencyStore||this.getTaskStore().dependencyStore;if(!b){Ext.Error.raise("Can't find a dependencyStore in `getDependencyStore`")}return b},getResourceStore:function(){return this.getTaskStore().getResourceStore()},getAssignmentStore:function(){return this.getTaskStore().getAssignmentStore()},getTaskStore:function(c){if(this.taskStore){return this.taskStore}var d=(this.stores[0]&&this.stores[0].treeStore)||this.parentNode&&this.parentNode.getTaskStore(c);if(!d&&!c){Ext.Error.raise("Can't find a taskStore in `getTaskStore`")}this.taskStore=d;return d},setTaskStore:function(b){this.taskStore=b},isManuallyScheduled:function(){return this.get(this.schedulingModeField)==="Manual"||this.get(this.manuallyScheduledField)},setManuallyScheduled:function(b){if(b){this.set(this.schedulingModeField,"Manual")}else{if(this.get(this.schedulingModeField)=="Manual"){this.set(this.schedulingModeField,"Normal")}}return this.set(this.manuallyScheduledField,b)},setSchedulingMode:function(b){if(!Ext.Array.contains(this.recognizedSchedulingModes,b)){throw"Unrecognized scheduling mode: "+b}this.beginEdit();this.set(this.schedulingModeField,b);switch(b){case"FixedDuration":this.updateEffortBasedOnDuration();break;case"EffortDriven":this.updateSpanBasedOnEffort();break}this.endEdit()},skipNonWorkingTime:function(d,f){var e=false;this.forEachAvailabilityIntervalWithResources(f?{startDate:d}:{endDate:d,isForward:false},function(a,b,c){if(a!==b){d=f?a:b;e=true;return false}});return e?new Date(d):this.getCalendar().skipNonWorkingTime(d,f)},setStartDate:function(v,x,w,q){q=q!==false;var u,r;this.beginEdit();var n=this.getStartDate();if(!v){this.set(this.durationField,null);this.set(this.startDateField,null)}else{var s=this.getCalendar();if(w&&!this.isManuallyScheduled()){v=this.skipNonWorkingTime(v,!this.isMilestone())}var o=this.getTaskStore(true);var t=this.getSchedulingMode();this.set(this.startDateField,v);if(this.isLeaf()||!o||!o.moveParentAsGroup||!q||!this.childNodes.length||this.isManuallyScheduled()){if(x!==false){this.set(this.endDateField,this.recalculateEndDate(v))}else{r=this.getEndDate();if(r){this.set(this.durationField,this.calculateDuration(v,r,this.getDurationUnit()))}}}else{if(v!=n){var m={};o.startBatchCascade();o.suspendAutoRecalculateParents++;o.suspendAutoCascade++;var p=o.getParentsContext();this.cascadeChildren(function(d){var a=d.isLeaf();if(a||!d.childNodes.length){if(!m[d.internalId]){var c=d.calculateDuration(n,d.getStartDate());o.currentCascadeBatch.addAffected(d);d.setStartDate(d.calculateEndDate(v,c),true,w,false);if(o.cascadeChanges){var b=o.cascadeChangesForTask(d,true);Ext.apply(m,b.affected)}}}if(!a){o.addTaskToParentsContext(p,d)}});if(o.recalculateParents||o.cascadeChanges){o.addTaskToParentsContext(p,this);o.recalculateAffectedParents(m,p)}o.suspendAutoRecalculateParents--;o.suspendAutoCascade--;o.endBatchCascade()}}}u=this.getDuration();r=this.getEndDate();if(v&&r&&(u===undefined||u===null)){this.set(this.durationField,this.calculateDuration(v,r,this.getDurationUnit()))}this.onPotentialEffortChange();this.endEdit()},setEndDate:function(v,x,w,q){q=q!==false;var t,y;this.beginEdit();var r=this.getEndDate();if(!v){this.set(this.durationField,null);this.set(this.endDateField,null)}else{var s=this.getCalendar();y=this.getStartDate();if(v<y&&x===false){v=y}if(w&&!this.isManuallyScheduled()){v=this.skipNonWorkingTime(v,false)}var o=this.getTaskStore(true);if(this.isLeaf()||!o||!o.moveParentAsGroup||!q||!this.childNodes.length){if(x!==false){t=this.getDuration();if(Ext.isNumber(t)){this.set(this.startDateField,this.calculateStartDate(v,t,this.getDurationUnit()));this.set(this.endDateField,v)}else{this.set(this.endDateField,v)}}else{var u=this.isMilestone();if(v<y){this.set(this.startDateField,v)}this.set(this.endDateField,v);if(y){this.set(this.durationField,this.calculateDuration(y,v,this.getDurationUnit()));if(u&&!this.isMilestone()){var z=this.skipNonWorkingTime(y,true);if(z-y!==0){this.set(this.startDateField,z)}}}}}else{if(v!=r){var n={};o.startBatchCascade();o.suspendAutoRecalculateParents++;o.suspendAutoCascade++;var p=o.getParentsContext();this.cascadeChildren(function(c){var d=c.isLeaf();if(d||!c.childNodes.length){if(!n[c.internalId]){var b=c.calculateDuration(c.getEndDate(),r);o.currentCascadeBatch.addAffected(c);c.setEndDate(c.calculateStartDate(v,b),true,w,false);if(o.cascadeChanges){var a=o.cascadeChangesForTask(c,true);Ext.apply(n,a.affected)}}}if(!d){o.addTaskToParentsContext(p,c)}});if(o.recalculateParents||o.cascadeChanges){o.addTaskToParentsContext(p,this);o.recalculateAffectedParents(n,p)}o.suspendAutoRecalculateParents--;o.suspendAutoCascade--;o.endBatchCascade()}}}t=this.getDuration();y=this.getStartDate();if(v&&y&&(t===undefined||t===null)){this.set(this.durationField,this.calculateDuration(y,v,this.getDurationUnit()))}this.onPotentialEffortChange();this.endEdit()},setStartEndDate:function(e,d,f){this.beginEdit();if(f&&!this.isManuallyScheduled()){e=e&&this.skipNonWorkingTime(e,true);d=d&&this.skipNonWorkingTime(d,false);if(d<e){e=d}}this.set(this.startDateField,e);this.set(this.endDateField,d);this.set(this.durationField,this.calculateDuration(e,d,this.getDurationUnit()));this.onPotentialEffortChange();this.endEdit()},getDuration:function(e){if(!e){return this.get(this.durationField)}var d=this.getProjectCalendar(),f=d.convertDurationToMs(this.get(this.durationField),this.get(this.durationUnitField));return d.convertMSDurationToUnit(f,e)},getEffort:function(f){var e=this.get(this.effortField)||0;if(!f){return e}var h=this.getProjectCalendar(),g=h.convertDurationToMs(e,this.getEffortUnit());return h.convertMSDurationToUnit(g,f)},setEffort:function(c,d){d=d||this.get(this.effortUnitField);this.beginEdit();this.set(this.effortField,c);this.set(this.effortUnitField,d);switch(this.getSchedulingMode()){case"EffortDriven":this.updateSpanBasedOnEffort();break;case"DynamicAssignment":this.updateAssignments();break}this.endEdit()},getCalendarDuration:function(b){return this.getProjectCalendar().convertMSDurationToUnit(this.getEndDate()-this.getStartDate(),b||this.get(this.durationUnitField))},setDuration:function(o,j){j=j||this.get(this.durationUnitField);var n=this.isMilestone();this.beginEdit();if(Ext.isNumber(o)&&!this.getStartDate()){var k=this.getTaskStore(true);var r=(k&&k.getProjectStartDate())||Ext.Date.clearTime(new Date());this.setStartDate(r)}var m=null;if(Ext.isNumber(o)){m=this.calculateEndDate(this.getStartDate(),o,j)}this.set(this.endDateField,m);this.set(this.durationField,o);this.set(this.durationUnitField,j);if(this.isMilestone()!=n){if(n){var p=this.getStartDate();if(p){var q=this.skipNonWorkingTime(p,true);if(q-p!==0){this.set(this.startDateField,q)}}}else{if(m){var l=this.skipNonWorkingTime(m,false);if(l-m!==0){this.set(this.startDateField,l);this.set(this.endDateField,l)}}}}this.onPotentialEffortChange();this.endEdit()},calculateStartDate:function(h,i,j){j=j||this.getDurationUnit();if(!i){return h}if(this.isManuallyScheduled()){return Sch.util.Date.add(h,j,-i)}else{if(this.getTaskStore(true)&&this.hasResources()){var f=this.getProjectCalendar().convertDurationToMs(i,j||this.getDurationUnit());var g;this.forEachAvailabilityIntervalWithResources({endDate:h,isForward:false},function(a,b,c){var d=b-a;if(d>=f){g=new Date(b-f);return false}else{f-=d}});return g}else{return this.getCalendar().calculateStartDate(h,i,j)}}},endEdit:function(d,c){this.savedDirty=this.dirty;this.dirty=false;this.callParent(arguments);if(this.savedDirty!=null){this.dirty=this.savedDirty;this.savedDirty=null}},recalculateEndDate:function(d){d=d||this.getStartDate();if(this.getSchedulingMode()=="EffortDriven"){return this.calculateEffortDrivenEndDate(d,this.getEffort())}else{var c=this.getDuration();if(Ext.isNumber(c)){return this.calculateEndDate(d,c,this.getDurationUnit())}else{return this.getEndDate()}}},calculateEndDate:function(h,i,k){k=k||this.getDurationUnit();if(!i){return h}if(this.isManuallyScheduled()){return Sch.util.Date.add(h,k,i)}else{var l=this.getSchedulingMode();if(this.getTaskStore(true)&&this.hasResources()&&l!="FixedDuration"&&l!="DynamicAssignment"&&l!="EffortDriven"){var g=this.getProjectCalendar().convertDurationToMs(i,k||this.getDurationUnit());var j;this.forEachAvailabilityIntervalWithResources({startDate:h},function(a,b,c){var d=b-a;if(d>=g){j=new Date(a+g);return false}else{g-=d}});return j}else{return this.getCalendar().calculateEndDate(h,i,k)}}},calculateDuration:function(f,h,e){e=e||this.getDurationUnit();if(!f||!h){return 0}if(this.isManuallyScheduled()){return this.getProjectCalendar().convertMSDurationToUnit(h-f,e)}else{if(this.getTaskStore(true)&&this.hasResources()){var g=0;this.forEachAvailabilityIntervalWithResources({startDate:f,endDate:h},function(a,b,c){g+=b-a});return this.getProjectCalendar().convertMSDurationToUnit(g,e)}else{return this.getCalendar().calculateDuration(f,h,e)}}},isCalendarApplicable:function(i){var q=this.getStartDate();if(!q){return true}var k=this.getTaskStore(true);if(!k){return true}var l=Sch.util.Date.add(q,"d",(k&&k.availabilitySearchLimit)||5*365);var r=this.getAssignments();var p=[];Ext.each(r,function(a){var b=a.getResource();if(b){p.push(b.getCalendar())}});if(!p.length){return true}var n=Gnt.data.Calendar.getCalendar(i);for(var m=0,o=p.length;m<o;m++){if(n.isAvailabilityIntersected(p[m],q,l)){return true}}return false},forEachAvailabilityIntervalWithResources:function(ae,ac,aj){aj=aj||this;var S=this;var ag=ae.startDate;var i=ae.endDate;var U=ae.isForward!==false;if(U?!ag:!i){throw new Error("At least `startDate` or `endDate` is required, depending from the `isForward` option")}var aa=new Date(U?ag:i);var ai=ae.includeEmptyIntervals;var ah=this.getOwnCalendar();var J=Boolean(ah);var O=this.getProjectCalendar();var W,K,Q;if(ae.resources){W=ae.resources;Q=[];K=[];Ext.each(W,function(a){K.push(a.getCalendar());Q.push(S.getAssignmentFor(a))})}else{Q=this.getAssignments();W=[];K=[];Ext.each(Q,function(a){var b=a.getResource();if(b){W.push(b);K.push(b.getCalendar())}})}if(!W.length){return}var ad=Sch.util.Date;var k,M,T,P,X;var ab=this.getTaskStore(true);if(U){if(!i){i=ad.add(ag,"d",ae.availabilitySearchLimit||ab.availabilitySearchLimit||5*365)}}else{if(!ag){ag=ad.add(i,"d",-(ae.availabilitySearchLimit||ab.availabilitySearchLimit||5*365))}}while(U?aa<i:aa>ag){var R={};var L=[];if(J){var Z=ah.getAvailabilityIntervalsFor(aa-(U?0:1));for(M=0;M<Z.length;M++){T=Z[M];P=T.startDate-0;X=T.endDate-0;if(!R[P]){R[P]=[];L.push(P)}R[P].push({type:"00-taskAvailailabilityStart",typeBackward:"01-taskAvailailabilityStart"});L.push(X);R[X]=R[X]||[];R[X].push({type:"01-taskAvailailabilityEnd",typeBackward:"00-taskAvailailabilityEnd"})}}for(k=0;k<K.length;k++){var af=K[k].getAvailabilityIntervalsFor(aa-(U?0:1));for(M=0;M<af.length;M++){T=af[M];P=T.startDate-0;X=T.endDate-0;if(!R[P]){R[P]=[];L.push(P)}R[P].push({type:"02-resourceAvailailabilityStart",typeBackward:"03-resourceAvailailabilityStart",assignment:Q[k],resourceId:W[k].getInternalId(),units:Q[k].getUnits()});if(!R[X]){R[X]=[];L.push(X)}R[X].push({type:"03-resourceAvailailabilityEnd",typeBackward:"02-resourceAvailailabilityEnd",assignment:Q[k],resourceId:W[k].getInternalId(),units:Q[k].getUnits()})}}L.sort();var H=false;var V={};var Y=0;var I,N;if(U){for(k=0;k<L.length;k++){I=R[L[k]];I.sort(function(a,b){return a.type<b.type?1:-1});for(M=0;M<I.length;M++){N=I[M];switch(N.type){case"00-taskAvailailabilityStart":H=true;break;case"01-taskAvailailabilityEnd":H=false;break;case"02-resourceAvailailabilityStart":V[N.resourceId]=N;Y++;break;case"03-resourceAvailailabilityEnd":delete V[N.resourceId];Y--;break}}if((H||!J)&&(Y||ai)){P=L[k];X=L[k+1];if(P>=i||X<=ag){continue}if(P<ag){P=ag-0}if(X>i){X=i-0}if(ac.call(aj,P,X,V)===false){return false}}}}else{for(k=L.length-1;k>=0;k--){I=R[L[k]];I.sort(function(a,b){return a.typeBackward<b.typeBackward?1:-1});for(M=0;M<I.length;M++){N=I[M];switch(N.typeBackward){case"00-taskAvailailabilityEnd":H=true;break;case"01-taskAvailailabilityStart":H=false;break;case"02-resourceAvailailabilityEnd":V[N.resourceId]=N;Y++;break;case"03-resourceAvailailabilityStart":delete V[N.resourceId];Y--;break}}if((H||!J)&&(Y||ai)){P=L[k-1];X=L[k];if(P>i||X<=ag){continue}if(P<ag){P=ag-0}if(X>i){X=i-0}if(ac.call(aj,P,X,V)===false){return false}}}}aa=U?ad.getStartOfNextDay(aa):ad.getEndOfPreviousDay(aa)}},calculateEffortDrivenEndDate:function(g,j,f){var h=this.getProjectCalendar().convertDurationToMs(j,f||this.getEffortUnit());var i=new Date(g);this.forEachAvailabilityIntervalWithResources({startDate:g},function(b,c,d){var a=0;for(var e in d){a+=d[e].units}var n=c-b;var o=a*n/100;if(o>=h){i=new Date(b+h/o*n);return false}else{h-=o}});return i},refreshCalculatedParentNodeData:function(){var D=new Date(9999,0,0),i=new Date(0);var r=this.autoCalculatePercentDoneForParentTask;var E=this.autoCalculateEffortForParentTask;var L=this.childNodes;var I=L.length;var G={};if(I>0&&(E||r)){var F=0;var A=0;var y=0;for(var x=0;x<I;x++){var K=L[x];var k=K.isLeaf();if(E){F+=K.getEffort("MILLI")}if(r){var J=k?K.getDuration("MILLI")||0:K.childTasksDuration;A+=J;y+=k?J*(K.getPercentDone()||0):K.completedChildTasksDuration}}if(E&&this.getEffort("MILLI")!=F){G.Effort=true;this.setEffort(this.getProjectCalendar().convertMSDurationToUnit(F,this.getEffortUnit()))}if(r){this.childTasksDuration=A;this.completedChildTasksDuration=y;var z=A?y/A:0;if(this.getPercentDone()!=z){G.PercentDone=true;this.setPercentDone(z)}}}var H,C;if(!this.isRoot()&&I>0){if(!this.isManuallyScheduled()){for(var w=0;w<I;w++){var B=L[w];D=Sch.util.Date.min(D,B.getStartDate()||D);i=Sch.util.Date.max(i,B.getEndDate()||i)}H=G.StartDate=D-new Date(9999,0,0)!==0&&this.getStartDate()-D!==0;C=G.EndDate=i-new Date(0)!==0&&this.getEndDate()-i!==0;if(H&&C){this.setStartEndDate(D,i,false)}else{if(H){this.setStartDate(D,false,false,false)}else{if(C){this.setEndDate(i,false,false,false)}}}}}return G},recalculateParents:function(){var f=this.parentNode;if(f){var e=f.refreshCalculatedParentNodeData();var g=e.StartDate;var h=e.EndDate;if((this.getTaskStore().cascading&&(g||h))||(!g&&!h)){if(!f.isRoot()){f.recalculateParents()}}}},isMilestone:function(b){return b?this.isBaselineMilestone():this.getDuration()===0},convertToMilestone:function(){if(!this.isMilestone()){this.setStartDate(this.getEndDate(),false);this.setDuration(0)}},convertToRegular:function(){if(this.isMilestone()){var c=this.get(this.durationUnitField);this.setDuration(1,c);var d=this.calculateStartDate(this.getStartDate(),1,c);this.setStartDate(d,true,false,false)}},isBaselineMilestone:function(){var c=this.getBaselineStartDate(),d=this.getBaselineEndDate();if(c&&d){return d-c===0}return false},afterEdit:function(c){if(this.savedDirty!=null){this.dirty=this.savedDirty;this.savedDirty=null}if(this.stores.length>0||!this.normalized){this.callParent(arguments)}else{var d=this.taskStore||this.getTaskStore(true);if(d&&!d.isFillingRoot){d.afterEdit(this,c)}this.callParent(arguments)}},afterCommit:function(){this.callParent(arguments);if(this.stores.length>0||!this.normalized){return}var b=this.taskStore||this.getTaskStore(true);if(b&&!b.isFillingRoot){b.afterCommit(this)}},afterReject:function(){if(this.stores.length>0){this.callParent(arguments)}else{var b=this.getTaskStore(true);if(b&&!b.isFillingRoot){b.afterReject(this)}this.callParent(arguments)}},getDurationUnit:function(){return this.get(this.durationUnitField)||"d"},getEffortUnit:function(){return this.get(this.effortUnitField)||"h"},getBaselinePercentDone:function(){return this.get(this.baselinePercentDoneField)||0},isPersistable:function(){var b=this.parentNode;return !b.phantom},getResources:function(){var b=[];Ext.each(this.assignments,function(a){b.push(a.getResource())});return b},getAssignments:function(){return this.assignments},hasAssignments:function(){return this.assignments.length>0},hasResources:function(){var b=false;Ext.each(this.assignments,function(a){if(a.getResource()){b=true;return false}});return b},getAssignmentFor:function(d){var e=null,f=d instanceof Gnt.model.Resource?d.getInternalId():d;Ext.each(this.assignments,function(a){if(a.getResourceId()==f){e=a;return false}});return e},isAssignedTo:function(b){return !!this.getAssignmentFor(b)},unassign:function(){return this.unAssign.apply(this,arguments)},unAssign:function(j){var i=this.getAssignmentStore();var f=this.getInternalId();var h=j instanceof Gnt.model.Resource?j.getInternalId():j;var g=i.findBy(function(a){return a.getResourceId()==h&&a.getTaskId()==f});if(g>=0){i.removeAt(g)}},assign:function(n,j){var i=this.getTaskStore(),k=this.getInternalId(),m=i.getAssignmentStore(),o=i.getResourceStore();var l=n instanceof Gnt.model.Resource?n.getInternalId():n;m.each(function(a){if(a.getTaskId()==k&&a.getResourceId()==l){throw"Resource can't be assigned twice to the same task"}});if(n instanceof Gnt.model.Resource&&o.indexOf(n)==-1){o.add(n)}var p=new Gnt.model.Assignment({TaskId:k,ResourceId:l,Units:j});m.add(p);return p},calculateEffort:function(f,h,e){if(!f||!h){return 0}var g=0;this.forEachAvailabilityIntervalWithResources({startDate:f,endDate:h},function(b,c,d){var a=0;for(var i in d){a+=d[i].units}g+=(c-b)*a/100});return this.getProjectCalendar().convertMSDurationToUnit(g,e||this.getEffortUnit())},updateAssignments:function(){var f={};var g=this.getStartDate();var i=this.getEndDate();if(!g||!i){return}var j=0;this.forEachAvailabilityIntervalWithResources({startDate:g,endDate:i},function(b,c,d){for(var a in d){j+=c-b}});if(!j){return}var h=this.getEffort(Sch.util.Date.MILLI);Ext.Array.each(this.getAssignments(),function(a){a.setUnits(h/j*100)})},updateEffortBasedOnDuration:function(){this.setEffort(this.calculateEffort(this.getStartDate(),this.getEndDate()))},updateEffortBasedOnSpan:function(){this.updateEffortBasedOnDuration()},updateSpanBasedOnEffort:function(){this.setStartEndDate(this.getStartDate(),this.recalculateEndDate(),this.getTaskStore().skipWeekendsDuringDragDrop)},onPotentialEffortChange:function(){switch(this.getSchedulingMode()){case"FixedDuration":this.updateEffortBasedOnDuration();break;case"DynamicAssignment":this.updateAssignments();break}},onAssignmentMutation:function(){switch(this.getSchedulingMode()){case"FixedDuration":this.updateEffortBasedOnDuration();break;case"EffortDriven":this.updateSpanBasedOnEffort();break}},onAssignmentStructureMutation:function(){switch(this.getSchedulingMode()){case"FixedDuration":this.updateEffortBasedOnDuration();break;case"EffortDriven":this.updateSpanBasedOnEffort();break;case"DynamicAssignment":this.updateAssignments();break}},adjustToCalendar:function(){if(this.get("leaf")&&!this.isManuallyScheduled()){this.setStartDate(this.getStartDate(),true,this.getTaskStore().skipWeekendsDuringDragDrop);var j=this.getTaskStore(true);if(j&&j.cascadeChanges){var h=this.getViolatedConstraints();if(h){for(var i=0,g=h.length,f;i<g;i++){f=h[i];this.resolveViolatedConstraints(!i?f:null)}}}}},isEditable:function(b){if(!this.isLeaf()){if(b===this.effortField&&this.autoCalculateEffortForParentTask){return false}if(b===this.percentDoneField&&this.autoCalculatePercentDoneForParentTask){return false}}if((b===this.durationField||b===this.endDateField)&&this.getSchedulingMode()==="EffortDriven"){return false}if(b===this.effortField&&this.getSchedulingMode()==="FixedDuration"){return false}return true},isDraggable:function(){return this.getDraggable()},isResizable:function(){return this.getResizable()},getWBSCode:function(){var c=[],d=this;while(d.parentNode){c.push(d.data.index+1);d=d.parentNode}return c.reverse().join(".")},resetTotalCount:function(c){var d=this;while(d){d.totalCount=c?-1:null;d=d.parentNode}},getTotalCount:function(){var f=this.totalCount;var j=f==-1;if(f==null||j){var h=this.childNodes;f=h.length;for(var i=0,g=h.length;i<g;i++){f+=h[i].getTotalCount()}if(j){return f}else{this.totalCount=f}}return f},getPredecessorsCount:function(){var d=this.previousSibling,c=this.data.index;while(d){c+=d.getTotalCount();d=d.previousSibling}return c},getSequenceNumber:function(){var c=0,d=this;while(d.parentNode){c+=d.getPredecessorsCount()+1;d=d.parentNode}return c},getBySequenceNumber:function(i){var l=null,j,g;if(i===0){l=this}else{if(i>0&&i<=this.getTotalCount()){i--;for(var k=0,h=this.childNodes.length;k<h;k++){j=this.childNodes[k];g=j.getTotalCount();if(i>g){i-=g+1}else{j=this.childNodes[k];l=j.getBySequenceNumber(i);break}}}}return l},getDisplayStartDate:function(j,m,l,h,n){var k=this.getEndDate(),i=this.getStartDate();if(arguments.length<3){l=this.getStartDate();if(arguments.length<2){m=true}}if(l&&m&&this.isMilestone(n)&&l-Ext.Date.clearTime(l,true)===0&&!Ext.Date.formatContainsHourInfo(j)){l=Sch.util.Date.add(l,Sch.util.Date.MILLI,-1)}return h?l:(l?Ext.util.Format.date(l,j):"")},getDisplayEndDate:function(h,j,i,g,f){if(arguments.length<3){i=this.getEndDate();if(arguments.length<2){j=true}}if(i&&(!this.isMilestone(f)||j)&&i-Ext.Date.clearTime(i,true)===0&&!Ext.Date.formatContainsHourInfo(h)){i=Sch.util.Date.add(i,Sch.util.Date.MILLI,-1)}return g?i:(i?Ext.util.Format.date(i,h):"")},getId:function(){var b=this.data[this.idProperty];return b&&b!=="root"?b:null}},function(){Ext.data.NodeInterface.decorate(this);if(Ext.getVersion("extjs").isGreaterThan("4.2.0.663")){var b={idchanged:true,append:true,remove:true,move:true,insert:true,beforeappend:true,beforeremove:true,beforemove:true,beforeinsert:true,expand:true,collapse:true,beforeexpand:true,beforecollapse:true,sort:true,rootchange:true};this.override({fireEventArgs:function(k,j){var h=Ext.data.Model.prototype.fireEventArgs,a,i,l;if(b[k]){for(i=this;a!==false&&i;i=(l=i).parentNode){if(i.hasListeners[k]){a=h.call(i,k,j)}}i=l.rootOf;if(a!==false&&i){if(i.hasListeners[k]){a=i.fireEventArgs.call(i,k,j)}i=i.treeStore;if(a!==false&&i){if(i.hasListeners[k]){a=i.fireEventArgs.call(i,k,j)}}}return a}else{return h.apply(this,arguments)}}})}this.override({remove:function(){var f=this.parentNode;var a=this.getTaskStore();var e=this.callParent(arguments);if(a.recalculateParents){if(f.convertEmptyParentToLeaf&&f.childNodes.length===0){f.set("leaf",true)}else{if(!f.isRoot()&&f.childNodes.length>0){f.childNodes[0].recalculateParents()}}}return e},insertBefore:function(e){e=this.createNode(e);if(this.phantom){this.data[this.phantomIdField]=e.data[this.phantomParentIdField]=this.internalId}var f=e.parentNode;this.resetTotalCount(f);var a=this.callParent(arguments);if(f){this.resetTotalCount()}return a},appendChild:function(a,i,h){var j=false;a=a instanceof Array?a:[a];for(var k=0;k<a.length;k++){a[k]=this.createNode(a[k]);if(a[k].parentNode){j=true}if(this.phantom){a[k].data[this.phantomParentIdField]=this.internalId}}if(this.phantom){this.data[this.phantomIdField]=this.internalId}this.resetTotalCount(j);var l=this.callParent([a.length>1?a:a[0],i,h]);if(j){this.resetTotalCount()}return l},removeChild:function(k,m,l,a){this.resetTotalCount();var i=this.childNodes;var n=!this.removeChildIsCalledFromReplaceChild&&this.convertEmptyParentToLeaf&&i.length==1;this.removeChildIsCalledFromReplaceChild=false;var j=this.callParent(arguments);if(a){this.resetTotalCount()}if(this.getTaskStore().recalculateParents){if(n){this.set("leaf",true)}else{if(!this.isRoot()&&i.length>0){i[0].recalculateParents()}}}return j},replaceChild:function(){this.removeChildIsCalledFromReplaceChild=true;this.callParent(arguments)},removeAll:function(){this.resetTotalCount();this.callParent(arguments)},createNode:function(d){d=this.callParent(arguments);if(!d.normalized&&!d.normalizeScheduled){var a=d.updateInfo;d.updateInfo=function(){a.apply(this,arguments);delete d.updateInfo;d.normalize()};d.normalizeScheduled=true}return d}})});Ext.define("Gnt.util.DurationParser",{requires:["Sch.util.Date"],mixins:["Gnt.mixin.Localizable"],parseNumberFn:null,durationRegex:null,allowDecimals:true,constructor:function(b){Ext.apply(this,b);if(this.unitsRegex){Ext.apply(this.l10n.unitsRegex,this.unitsRegex)}if(!this.durationRegex){this.durationRegex=this.allowDecimals?/^\s*([\-+]?\d+(?:[.,]\d+)?)\s*(\w+)?/i:/^\s*([\-+]?\d+)(?![.,])\s*(\w+)?/i}},parse:function(j){var g=this.durationRegex.exec(j);if(j==null||!g){return null}var h=this.parseNumberFn(g[1]);var f=g[2];var i;if(f){Ext.iterate(this.L("unitsRegex"),function(b,a){if(a.test(f)){i=Sch.util.Date.getUnitByName(b);return false}});if(!i){return null}}return{value:h,unit:i}}});Ext.define("Gnt.util.DependencyParser",{requires:["Gnt.util.DurationParser"],separator:/\s*;\s*/,parseNumberFn:null,dependencyRegex:/(-?\d+)(SS|SF|FS|FF)?([\+\-].*)?/i,types:["SS","SF","FS","FF"],constructor:function(b){this.durationParser=new Gnt.util.DurationParser(b);Ext.apply(this,b)},parse:function(l){if(!l){return[]}var q=l.split(this.separator);var i=[];var r=this.dependencyRegex;for(var o=0;o<q.length;o++){var t=q[o];if(!t&&o==q.length-1){continue}var n=r.exec(t);var p={};if(!n){return null}p.taskId=parseInt(n[1],10);p.type=Ext.Array.indexOf(this.types,(n[2]||"FS").toUpperCase());var m=n[3];if(m){var s=this.durationParser.parse(m);if(!s){return null}p.lag=s.value;p.lagUnit=s.unit||"d"}i.push(p)}return i}});Ext.define("Gnt.util.Data",{requires:["Ext.data.Model"],singleton:true,cloneModelSet:function(g,k,l){var j=[],h;var i=function(a){h=a.copy();Ext.data.Model.id(h);h.phantom=false;h.originalRecord=a;if(k){if(k.call(l||g,h,a)===false){return}}j.push(h)};if(g.each){g.each(i)}else{Ext.Array.each(g,i)}return j},applyCloneChanges:function(x,t,v,l){var D=[];var B=t.autoSyncSuspended;if(t.autoSync&&!B){t.suspendAutoSync()}var y=x.getRemovedRecords();for(var z=0,C=y.length;z<C;z++){if(y[z].originalRecord){D.push(y[z].originalRecord)}}if(D.length){t.remove(D);x.removed.length=0}var s=x.getModifiedRecords(),i,A,r,w;for(z=0,C=s.length;z<C;z++){i=s[z].originalRecord;A=s[z].getData();delete A[s[z].idProperty];if(i){i.beginEdit();for(var u in A){i.set(u,A[u])}if(v){v.call(l||s[z],A,s[z])}i.endEdit()}else{if(v){v.call(l||s[z],A,s[z])}w=t.add(A);s[z].originalRecord=w&&w[0]}s[z].commit(true)}if(t.autoSync&&!B){t.resumeAutoSync();t.sync()}}});Ext.define("Gnt.patches.Tree",{override:"Ext.data.Tree",onNodeRemove:function(d,f,e){if(!e){this.unregisterNode(f,true)}}});Ext.define("Gnt.data.Calendar",{extend:"Ext.data.Store",requires:["Ext.Date","Gnt.model.CalendarDay","Sch.model.Range","Sch.util.Date"],model:"Gnt.model.CalendarDay",daysPerMonth:30,daysPerWeek:7,hoursPerDay:24,unitsInMs:null,defaultNonWorkingTimeCssCls:"gnt-holiday",weekendsAreWorkdays:false,weekendFirstDay:6,weekendSecondDay:0,holidaysCache:null,availabilityIntervalsCache:null,daysIndex:null,weekAvailability:null,defaultWeekAvailability:null,nonStandardWeeksByStartDate:null,nonStandardWeeksStartDates:null,calendarId:null,parent:null,defaultAvailability:["00:00-24:00"],name:null,suspendCacheUpdate:0,availabilitySearchLimit:1825,statics:{getCalendar:function(b){if(b instanceof Gnt.data.Calendar){return b}return Ext.data.StoreManager.lookup("GNT_CALENDAR:"+b)},getAllCalendars:function(){var b=[];Ext.data.StoreManager.each(function(a){if(a instanceof Gnt.data.Calendar){b.push(a)}});return b}},constructor:function(e){e=e||{};var d=e.parent;delete e.parent;var f=e.calendarId;delete e.calendarId;this.callParent(arguments);this.setParent(d);this.setCalendarId(f);this.unitsInMs={MILLI:1,SECOND:1000,MINUTE:60*1000,HOUR:60*60*1000,DAY:this.hoursPerDay*60*60*1000,WEEK:this.daysPerWeek*this.hoursPerDay*60*60*1000,MONTH:this.daysPerMonth*this.hoursPerDay*60*60*1000,QUARTER:3*this.daysPerMonth*24*60*60*1000,YEAR:4*3*this.daysPerMonth*24*60*60*1000};this.defaultWeekAvailability=this.getDefaultWeekAvailability();this.on({update:this.clearCache,datachanged:this.clearCache,clear:this.clearCache,load:this.clearCache,scope:this});this.clearCache()},getCalendarId:function(){return this.calendarId},setCalendarId:function(c){if(this.calendarId!=null){Ext.data.StoreManager.unregister(this)}this.calendarId=c;if(c!=null){this.storeId="GNT_CALENDAR:"+c;Ext.data.StoreManager.register(this)}else{this.storeId=null}var d=this.proxy;if(d&&d.extraParams){d.extraParams.calendarId=c}},getDefaultWeekAvailability:function(){var h=this.defaultAvailability;var i=this.weekendFirstDay;var g=this.weekendSecondDay;var j=[];for(var f=0;f<7;f++){j.push(this.weekendsAreWorkdays||f!=i&&f!=g?new Gnt.model.CalendarDay({Type:"WEEKDAY",Weekday:f,Availability:Ext.Array.clone(h),IsWorkingDay:true}):new Gnt.model.CalendarDay({Type:"WEEKDAY",Weekday:f,Availability:[]}))}return j},clearCache:function(){if(this.suspendCacheUpdate>0){return}this.holidaysCache={};this.availabilityIntervalsCache={};var h=this.daysIndex={};var f=this.weekAvailability=[];var g=this.nonStandardWeeksStartDates=[];var e=this.nonStandardWeeksByStartDate={};this.each(function(d){var t=d.getId();var a=/^(\d)-(\d\d\d\d\/\d\d\/\d\d)-(\d\d\d\d\/\d\d\/\d\d)$/.exec(t);var o=/^WEEKDAY:(\d+)$/.exec(t);var b=d.getType();var c=d.getWeekday();if(b=="WEEKDAYOVERRIDE"||a){var s,p;if(b=="WEEKDAYOVERRIDE"){s=d.getOverrideStartDate();p=d.getOverrideEndDate()}if(a){s=Ext.Date.parse(a[2],"Y/m/d");p=Ext.Date.parse(a[3],"Y/m/d");c=a[1]}if(s&&p&&c!=null){var q=s-0;if(!e[q]){e[q]={startDate:new Date(s),endDate:new Date(p),name:d.getName(),weekAvailability:[],mainDay:null};g.push(q)}if(c>=0){e[q].weekAvailability[c]=d}else{e[q].mainDay=d}}}else{if(b=="WEEKDAY"||o){if(o){c=o[1]}if(c!=null){if(c<0||c>6){throw new Error("Incorrect week day index")}f[c]=d}}else{var r=d.getDate();if(r){h[r-0]=d}}}});g.sort();this.fireEvent("calendarchange",this)},intersectsWithCurrentWeeks:function(d,f){var e=false;this.forEachNonStandardWeek(function(a){var c=a.startDate;var b=a.endDate;if(c<=d&&d<b||c<f&&f<=b){e=true;return false}});return e},addNonStandardWeek:function(h,k,i,n){h=Ext.Date.clearTime(new Date(h));k=Ext.Date.clearTime(new Date(k));if(this.intersectsWithCurrentWeeks(h,k)){throw new Error("Can not add intersecting week")}var l=this.model;var j=[];Ext.Array.each(i,function(c,b){if(c instanceof Gnt.model.CalendarDay){c.setType("WEEKDAYOVERRIDE");c.setOverrideStartDate(h);c.setOverrideEndDate(k);c.setWeekday(b);c.setName(n||"Week override");j.push(c)}else{if(Ext.isArray(c)){var a=new l();a.setType("WEEKDAYOVERRIDE");a.setOverrideStartDate(h);a.setOverrideEndDate(k);a.setWeekday(b);a.setName(n||"Week override");a.setAvailability(c);j.push(a)}}});var m=new l();m.setType("WEEKDAYOVERRIDE");m.setOverrideStartDate(h);m.setOverrideEndDate(k);m.setWeekday(-1);m.setName(n||"Week override");j.push(m);this.add(j)},getNonStandardWeekByStartDate:function(b){return this.nonStandardWeeksByStartDate[Ext.Date.clearTime(new Date(b))-0]||null},getNonStandardWeekByDate:function(i){i=Ext.Date.clearTime(new Date(i))-0;var h=this.nonStandardWeeksStartDates;var g=this.nonStandardWeeksByStartDate;for(var j=0;j<h.length;j++){var f=g[h[j]];if(f.startDate>i){break}if(f.startDate<=i&&i<=f.endDate){return f}}return null},removeNonStandardWeek:function(d){d=Ext.Date.clearTime(new Date(d))-0;var c=this.getNonStandardWeekByStartDate(d);if(!c){return}this.remove(Ext.Array.clean(c.weekAvailability).concat(c.mainDay))},forEachNonStandardWeek:function(j,l){var k=this;var i=this.nonStandardWeeksStartDates;var h=this.nonStandardWeeksByStartDate;for(var g=0;g<i.length;g++){if(j.call(l||k,h[i[g]])===false){return false}}},setWeekendsAreWorkDays:function(b){if(b!==this.weekendsAreWorkdays){this.weekendsAreWorkdays=b;this.defaultWeekAvailability=this.getDefaultWeekAvailability();this.clearCache()}},areWeekendsWorkDays:function(){return this.weekendsAreWorkdays},getCalendarDay:function(b){b=typeof b=="number"?new Date(b):b;return this.getOverrideDay(b)||this.getWeekDay(b.getDay(),b)||this.getDefaultCalendarDay(b.getDay())},getOverrideDay:function(b){return this.getOwnCalendarDay(b)||this.parent&&this.parent.getOverrideDay(b)||null},getOwnCalendarDay:function(b){b=typeof b=="number"?new Date(b):b;return this.daysIndex[Ext.Date.clearTime(b,true)-0]},getWeekDay:function(f,d){if(d){var e=this.getNonStandardWeekByDate(d);if(e&&e.weekAvailability[f]){return e.weekAvailability[f]}}return this.weekAvailability[f]||this.parent&&this.parent.getWeekDay(f,d)||null},getDefaultCalendarDay:function(b){if(!this.hasOwnProperty("defaultAvailability")&&!this.hasOwnProperty("weekendsAreWorkdays")&&this.parent){return this.parent.getDefaultCalendarDay(b)}return this.defaultWeekAvailability[b]},isHoliday:function(h){var e=h-0;var g=this.holidaysCache;if(g[e]!=null){return g[e]}h=typeof h=="number"?new Date(h):h;var f=this.getCalendarDay(h);if(!f){throw"Can't find day for "+h}return g[e]=!f.getIsWorkingDay()},isWeekend:function(c){var d=c.getDay();return d===this.weekendFirstDay||d===this.weekendSecondDay},isWorkingDay:function(b){return !this.isHoliday(b)},convertMSDurationToUnit:function(d,c){return d/this.unitsInMs[Sch.util.Date.getNameOfUnit(c)]},convertDurationToMs:function(c,d){return c*this.unitsInMs[Sch.util.Date.getNameOfUnit(d)]},getHolidaysRanges:function(q,n,t){if(q>n){Ext.Error.raise("startDate can't be bigger than endDate")}q=Ext.Date.clearTime(q,true);n=Ext.Date.clearTime(n,true);var r=[],m,p;for(p=q;p<n;p=Sch.util.Date.getNext(p,Sch.util.Date.DAY,1)){if(this.isHoliday(p)||(this.weekendsAreWorkdays&&t&&this.isWeekend(p))){var l=this.getCalendarDay(p);var k=l&&l.getCls()||this.defaultNonWorkingTimeCssCls;var o=Sch.util.Date.getNext(p,Sch.util.Date.DAY,1);if(!m){m={StartDate:p,EndDate:o,Cls:k}}else{if(m.Cls==k){m.EndDate=o}else{r.push(m);m={StartDate:p,EndDate:o,Cls:k}}}}else{if(m){r.push(m);m=null}}}if(m){r.push(m)}var s=[];Ext.each(r,function(a){s.push(Ext.create("Sch.model.Range",{StartDate:a.StartDate,EndDate:a.EndDate,Cls:a.Cls}))});return s},forEachAvailabilityInterval:function(i,C,s){s=s||this;var w=this;var E=i.startDate;var y=i.endDate;var t=i.isForward!==false;if(t?!E:!y){throw new Error("At least `startDate` or `endDate` is required, depending from the `isForward` option")}var H=new Date(t?E:y);var F=Sch.util.Date;if(t){if(!y){y=F.add(E,"d",i.availabilitySearchLimit||this.availabilitySearchLimit||5*365)}}else{if(!E){E=F.add(y,"d",-(i.availabilitySearchLimit||this.availabilitySearchLimit||5*365))}}var B=false;while(t?H<y:H>E){var z=this.getAvailabilityIntervalsFor(H-(t?0:1),t?B:false);for(var A=t?0:z.length-1;t?A<z.length:A>=0;t?A++:A--){var G=z[A];var x=G.startDate;var u=G.endDate;if(x>=y||u<=E){continue}var D=x<E?E:x;var v=u>y?y:u;if(C.call(s,D,v)===false){return false}}H=t?F.getStartOfNextDay(H,false,B):F.getEndOfPreviousDay(H,B);B=true}},calculateDuration:function(f,g,e){var h=0;this.forEachAvailabilityInterval({startDate:f,endDate:g},function(a,b){var c=a.getTimezoneOffset()-b.getTimezoneOffset();h+=b-a+c*60*1000});return this.convertMSDurationToUnit(h,e)},calculateEndDate:function(h,i,g){if(!i){return new Date(h)}var j=Sch.util.Date,k;i=this.convertDurationToMs(i,g);var l=i===0&&Ext.Date.clearTime(h,true)-h===0?j.add(h,Sch.util.Date.DAY,-1):h;this.forEachAvailabilityInterval({startDate:l},function(b,c){var a=c-b;var d=b.getTimezoneOffset()-c.getTimezoneOffset();if(a>=i){k=new Date(b-0+i);return false}else{i-=a+d*60*1000}});return k},calculateStartDate:function(g,h,e){if(!h){return new Date(g)}var f;h=this.convertDurationToMs(h,e);this.forEachAvailabilityInterval({endDate:g,isForward:false},function(b,c){var a=c-b;if(a>=h){f=new Date(c-h);return false}else{h-=a}});return f},skipNonWorkingTime:function(e,f){var d=false;this.forEachAvailabilityInterval(f?{startDate:e}:{endDate:e,isForward:false},function(a,b){e=f?a:b;d=true;return false});if(!d){throw"skipNonWorkingTime: Cannot skip non-working time, please ensure that this calendar has any working period of time specified"}return new Date(e)},skipWorkingTime:function(e,f,d){return f>=0?this.calculateEndDate(e,f,d):this.calculateStartDate(e,-f,d)},getAvailabilityIntervalsFor:function(d,c){d=c?d-0:Ext.Date.clearTime(new Date(d))-0;if(this.availabilityIntervalsCache[d]){return this.availabilityIntervalsCache[d]}return this.availabilityIntervalsCache[d]=this.getCalendarDay(d).getAvailabilityIntervalsFor(d)},getByInternalId:function(b){return this.data.map[b]},getParentableCalendars:function(){var h=this,f=[],g=Gnt.data.Calendar.getAllCalendars();var e=function(a){if(!a.parent){return false}if(a.parent==h){return true}return e(a.parent)};Ext.Array.each(g,function(a){if(a===h){return}if(!e(a)){f.push({Id:a.calendarId,Name:a.name||a.calendarId})}});return f},setParent:function(h){var i=Gnt.data.Calendar.getCalendar(h);if(h&&!i){throw new Error("Invalid parent specified for the calendar")}if(this.parent!=i){var f=this.proxy;var j={calendarchange:this.clearCache,scope:this};var g=this.parent;if(g){g.un(j)}this.parent=i;if(i){i.on(j)}if(f&&f.extraParams){f.extraParams.parentId=i?i.calendarId:null}this.clearCache();this.fireEvent("parentchange",this,i,g)}},isAvailabilityIntersected:function(j,y,r){var l,z,v,s;for(var t=0;t<7;t++){l=this.getWeekDay(t)||this.getDefaultCalendarDay(t);v=j.getWeekDay(t)||j.getDefaultCalendarDay(t);if(!l||!v){continue}z=l.getAvailability();s=v.getAvailability();for(var u=0,x=z.length;u<x;u++){for(var w=0,k=s.length;w<k;w++){if(s[w].startTime<z[u].endTime&&s[w].endTime>z[u].startTime){return true}}}}var i=false;this.forEachNonStandardWeek(function(a){if(a.startDate>=r){return false}if(y<a.endDate){i=true;return false}});return i}});Ext.define("Gnt.data.calendar.BusinessTime",{extend:"Gnt.data.Calendar",daysPerMonth:20,daysPerWeek:5,hoursPerDay:8,defaultAvailability:["08:00-12:00","13:00-17:00"]});Ext.define("Gnt.data.DependencyStore",{extend:"Ext.data.Store",model:"Gnt.model.Dependency",taskStore:null,methodsCache:null,strictDependencyValidation:false,ignoreInitial:true,isLoadingRecords:false,allowedDependencyTypes:null,constructor:function(){this.mixins.observable.constructor.apply(this,arguments);this.init();this.callParent(arguments);this.ignoreInitial=false},init:function(){this.methodsCache={};this.on({add:this.onDependencyAdd,update:this.onDependencyUpdate,load:this.onDependencyLoad,datachanged:this.onDependencyDataChanged,remove:this.onDependecyRemove,clear:this.onDependencyStoreClear,beforesync:this.onBeforeSyncOperation,scope:this})},onDependencyLoad:function(){var b=this.getTaskStore();b&&b.fillTasksWithDepInfo()},onDependencyDataChanged:function(){var b=this.getTaskStore();if(this.isLoadingRecords&&b){b.fillTasksWithDepInfo()}},loadRecords:function(){this.isLoadingRecords=true;this.callParent(arguments);this.isLoadingRecords=false},scheduleTask:function(d){var c=this.getTaskStore();d.beginEdit();if(!d.getStartDate()){d.setStartDate(c.getProjectStartDate(),undefined!==d.getDuration(),c.skipWeekendsDuringDragDrop)}if(!d.getEndDate()){d.setDuration(1)}d.endEdit()},scheduleLinkedTasks:function(c,d){this.scheduleTask(c);if(!d.getStartDate()&&!c.getTaskStore().cascadeChanges){d.constrain()}this.scheduleTask(d)},onDependencyAdd:function(l,k){if(this.ignoreInitial){return}for(var g=0;g<k.length;g++){var h=k[g];if(!this.isValidDependencyType(h.getType())){throw"This dependency type is invalid. Check Gnt.data.DependencyStore#allowedDependencyTypes value"}var i=h.getSourceTask(),j=h.getTargetTask();if(i&&j){i.successors.push(h);j.predecessors.push(h);this.scheduleLinkedTasks(i,j)}}l.resetMethodsCache()},onDependecyRemove:function(j,f){var g=this.getTaskStore();var h=f.getSourceTask(g),i=f.getTargetTask(g);if(h){Ext.Array.remove(h.successors,f)}if(i){Ext.Array.remove(i.predecessors,f)}j.resetMethodsCache()},onDependencyUpdate:function(n,u,t){if(t!=Ext.data.Model.COMMIT){var m=this.getTaskStore();var r=u.previous;var o=u.getSourceTask();var q=u.getTargetTask();var p=u.fromField in r;var v=u.toField in r;if(p){var l=m.getById(r[u.fromField]);l&&Ext.Array.remove(l.successors,u);o&&o.successors.push(u)}if(v){var s=m.getById(r[u.toField]);s&&Ext.Array.remove(s.predecessors,u);q&&q.predecessors.push(u)}if((p||v)&&o&&q){this.scheduleLinkedTasks(o,q)}this.resetMethodsCache()}},onDependencyStoreClear:function(c){var d=c.getTaskStore();d&&d.fillTasksWithDepInfo()},onBeforeSyncOperation:function(e){if(e.create){for(var f,d=e.create.length-1;d>=0;d--){f=e.create[d];if(!f.isPersistable()){Ext.Array.remove(e.create,f)}}if(e.create.length===0){delete e.create}}return Boolean((e.create&&e.create.length>0)||(e.update&&e.update.length>0)||(e.destroy&&e.destroy.length>0))},getDependenciesForTask:function(b){return b.successors.concat(b.predecessors)},getIncomingDependenciesForTask:function(d,c){return c?d.predecessors:d.predecessors.slice()},getOutgoingDependenciesForTask:function(d,c){return c?d.successors:d.successors.slice()},getKeyByDeps:function(l,j,h){if(!l||!l.length){return""}var m="";for(var n=0,i=l.length;n<i;n++){var k=l[n];m+=(k.getSourceId&&k.getSourceId()||k[j])+":"+(k.getTargetId&&k.getTargetId()||k[h])+","}return m},buildCacheKey:function(m,l,p,n,r){var j=r.fromField||(r.fromField=this.model.prototype.fromField),o=r.toField||(r.toField=this.model.prototype.toField),q=r.ignoreDepKey,k=r.addDepKey;if(!r.hasOwnProperty("ignoreDepKey")){r.ignoreDepKey=q=p&&this.getKeyByDeps(p,j,o)||"";r.addDepKey=k=n&&this.getKeyByDeps(n,j,o)||""}return m+"-"+l+"-"+q+"-"+k},hasTransitiveDependency:function(G,K,J,z,L){L=L||{visitedTasks:{}};var I=this.buildCacheKey(G,K,J,z,L);var w=L.visitedTasks,y=L.extraSuccessors;if(this.isCachedResultAvailable("hasTransitiveDependency",I)){return this.methodsCache.hasTransitiveDependency[I]}var x=this,i=L.fromField,F=L.toField,v=this.getTaskById(G),A,C;if(w[G]){return false}w[G]=true;if(v){if(z&&!y){y=L.extraSuccessors={};for(A=0,C=z.length;A<C;A++){var H=z[A];var B=H.getSourceId&&H.getSourceId()||H[i];y[B]=y[B]||[];y[B].push(H)}}var D,E=v.successors;if(y&&y[G]){E=E.concat(y[G])}for(A=0,C=E.length;A<C;A++){D=E[A];var l=D.getTargetId&&D.getTargetId()||D[F];if((!J||Ext.Array.indexOf(J,D)==-1)&&(l===K||x.hasTransitiveDependency(l,K,J,z,L))){return this.setCachedResult("hasTransitiveDependency",I,true)}}}return this.setCachedResult("hasTransitiveDependency",I,false)},successorsHaveTransitiveDependency:function(l,i,p,m,s){s=s||{};var n=this.buildCacheKey(l,i,p,m,s);var r=i instanceof Gnt.model.Task?i:this.getTaskById(i);if(this.isCachedResultAvailable("successorsHaveTransitiveDependency",n)){return this.methodsCache.successorsHaveTransitiveDependency[n]}for(var o=0,q=r.successors.length;o<q;o++){var t=r.successors[o].getTargetId();if(this.hasTransitiveDependency(l,t,p,m)||this.predecessorsHaveTransitiveDependency(l,t,p,m)||this.successorsHaveTransitiveDependency(l,t,p,m,s)){return this.setCachedResult("successorsHaveTransitiveDependency",n,true)}}return this.setCachedResult("successorsHaveTransitiveDependency",n,false)},predecessorsHaveTransitiveDependency:function(l,i,q,m,t){t=t||{};var n=this.buildCacheKey(l,i,q,m,t);var s=l instanceof Gnt.model.Task?l:this.getTaskById(l);if(this.isCachedResultAvailable("predecessorsHaveTransitiveDependency",n)){return this.methodsCache.predecessorsHaveTransitiveDependency[n]}for(var o=0,r=s.predecessors.length;o<r;o++){var p=s.predecessors[o].getSourceId();if(this.hasTransitiveDependency(p,i,q,m)||this.successorsHaveTransitiveDependency(p,i,q,m)||this.predecessorsHaveTransitiveDependency(p,i,q,m,t)){return this.setCachedResult("predecessorsHaveTransitiveDependency",n,true)}}return this.setCachedResult("predecessorsHaveTransitiveDependency",n,false)},isPartOfTransitiveDependency:function(h,j,i,g){var f=h instanceof Gnt.model.Task?h:this.getTaskById(h);if(!f.predecessors.length&&!f.successors.length){return false}if(f.predecessors.length){return this.predecessorsHaveTransitiveDependency.apply(this,arguments)}else{return this.successorsHaveTransitiveDependency.apply(this,arguments)}},getCycle:function(t){t=t||{};Ext.applyIf(t,{ignoreTasks:{},visitedTasks:{},path:[],task:this.getAt(0).getSourceTask()});var o=t.visitedTasks,n=t.ignoreTasks,i=t.path,s=t.task,l=s.getInternalId();if(n[l]){return}i.push(s);if(o[l]){return i}o[l]=true;var r=s.successors;for(var m=0,q=r.length;m<q;m++){t.task=r[m].getTargetTask();var p=this.getCycle(t);if(p){return p}}i.pop();delete o[l]},getCycles:function(){var f=this,e=[],d={};this.each(function(a){var b=f.getCycle({task:a.getSourceTask(),ignoreTasks:d});if(b){for(var c=0,h=b.length;c<h;c++){d[b[c]]=true}e.push(b)}});return e},resetMethodsCache:function(){this.methodsCache={}},isCachedResultAvailable:function(c,d){return this.methodsCache[c]&&this.methodsCache[c].hasOwnProperty(d)},getCachedResult:function(c,d){return this.methodsCache[c][d]},setCachedResult:function(f,e,d){this.methodsCache[f]=this.methodsCache[f]||{};this.methodsCache[f][e]=d;return d},getGroupTopTasks:function(l,k){var i=l.length,m=k.length,o=i,j=m,n,p;do{n=l[o];p=k[j];o--;j--}while(n==p&&o>=0&&j>=0);return[n,p]},groupsHasTransitiveDependency:function(S,X,W,F,Y){var K=Y||{targets:null,visitedTasks:{}};var I=this.getTaskStore().getRootNode(),R=false,l=this,N=this.getTaskById(S),M=this.getTaskById(X),i=K.visitedTasks,C=K.targets;if(!K.targetGroup){K.targetGroup=M.getTopParent(true)}var J=K.fromField||(K.fromField=this.model.prototype.fromField),Q=K.toField||(K.toField=this.model.prototype.toField),O=K.ignoreDepKey,Z=K.addDepKey;var E=this.getGroupTopTasks(N.getTopParent(true),K.targetGroup),P=E[0],U=E[1];if(P===N&&U===M&&N.isLeaf()&&M.isLeaf()){return this.hasTransitiveDependency(S,X,W)}if(!K.hasOwnProperty("ignoreDepKey")){K.ignoreDepKey=O=W&&this.getKeyByDeps(W,J,Q)||"";K.addDepKey=Z=F&&this.getKeyByDeps(F,J,Q)||""}var V=P.getInternalId()+"-"+U.getInternalId()+"-"+O+"-"+Z;if(this.isCachedResultAvailable("groupsHasTransitiveDependency",V)){return this.methodsCache.groupsHasTransitiveDependency[V]}if(U!==K.targetTopParent){K.targetTopParent=U;C=K.targets={};U.cascadeBy(function(a){C[a.getInternalId()]=true})}var D=K.extraSuccessors;if(F&&!D){D=K.extraSuccessors={};for(var G=0,L=F.length;G<L;G++){var T=F[G];var H=T.getSourceId&&T.getSourceId()||T[J];D[H]=D[H]||[];D[H].push(T)}}P.cascadeBy(function(e){if(e!==I){var b=e.getInternalId();if(i[b]){return false}i[b]=true;var a=e.successors;if(D&&D[b]){a=a.concat(D[b])}for(var c=0,f=a.length;c<f;c++){var d=a[c],g=d.getTargetId&&d.getTargetId()||d[Q];if((!W||Ext.Array.indexOf(W,d)==-1)&&(C[g]||l.groupsHasTransitiveDependency(g,X,W,F,K))){R=true;return false}}}});return this.setCachedResult("groupsHasTransitiveDependency",V,R)},getDependencyError:function(v,x,o,q,m,s){var u,p,t;var w=v instanceof Gnt.model.Dependency;if(w){u=v.getSourceId();p=this.getTaskById(u);q=x;m=o;if(q&&Ext.Array.contains(q,v)){q=Ext.Array.slice(q,0);Ext.Array.remove(q,v)}o=v.getType();x=v.getTargetId();t=this.getTaskById(x);if(v.stores.length){s=v}}else{u=v;p=this.getTaskById(u);t=this.getTaskById(x);if(o===undefined){var r=this.model.prototype.fields.getByKey("Type").defaultValue;o=r!==undefined?r:Gnt.model.Dependency.Type.EndToStart}}if(!s&&w&&!v.isValid()){return -1}else{if(!u||!x||u==x){return -1}}if(!p||!t){return -2}if(!this.isValidDependencyType(o)){return -10}if(p.contains(t)||t.contains(p)){return -9}var n;if(m||s){n=[];if(s){n.push(s)}if(m){n=n.concat(m)}}if(this.hasTransitiveDependency(u,x,n,q)){return -3}if(this.hasTransitiveDependency(x,u,n,q)){return -4}if(this.isPartOfTransitiveDependency(u,x,n,q)){return -5}if(this.strictDependencyValidation){if(this.groupsHasTransitiveDependency(t.getInternalId(),p.getInternalId(),n,q)){return -7}if(this.groupsHasTransitiveDependency(p.getInternalId(),t.getInternalId(),n,q)){return -8}}return 0},isValidDependencyType:function(c){if(this.allowedDependencyTypes){var d=false;Ext.each(this.allowedDependencyTypes,function(a){if(Gnt.model.Dependency.Type[a]==c){d=true;return false}});return d}return true},isValidDependency:function(i,g,k,h,l,j){return !this.getDependencyError(i,g,k,h,l,j)},areTasksLinked:function(r,o){var k=r instanceof Gnt.model.Task?r:this.getTaskById(r);var i=o instanceof Gnt.model.Task?o:this.getTaskById(o);if(!k||!i){return false}var n=k.getInternalId()+"-"+i.getInternalId();if(this.isCachedResultAvailable("areTasksLinked",n)){return this.methodsCache.areTasksLinked[n]}var l={};var m={};for(var p=0,q=i.predecessors.length;p<q;p++){l[i.predecessors[p].id]=true}for(p=0,q=i.successors.length;p<q;p++){m[i.successors[p].id]=true}for(p=0,q=k.successors.length;p<q;p++){if(l[k.successors[p].id]){return this.setCachedResult("areTasksLinked",n,true)}}for(p=0,q=k.predecessors.length;p<q;p++){if(m[k.predecessors[p].id]){return this.setCachedResult("areTasksLinked",n,true)}}return this.setCachedResult("areTasksLinked",n,false)},getByTaskIds:function(f,d){var e=this.findBy(function(a){var c=a.getTargetId(),b=a.getSourceId();if((b===f&&c===d)||(b===d&&c===f)){return true}});return this.getAt(e)},getTaskById:function(f){var d=this.getTaskStore().getById(f);if(!d){var e=this.getTaskStore().getRootNode();e.cascadeBy(function(a){if(a!==e&&a._phantomId==f){d=a;return false}})}return d},getSourceTask:function(d){var c=d instanceof Gnt.model.Dependency?d.getSourceId():d;return this.getTaskById(c)},getTargetTask:function(d){var c=d instanceof Gnt.model.Dependency?d.getTargetId():d;return this.getTaskById(c)},getTaskStore:function(){return this.taskStore}});Ext.define("Gnt.data.TaskStore",{extend:"Ext.data.TreeStore",requires:["Gnt.model.Task","Gnt.data.Calendar","Gnt.data.DependencyStore","Gnt.patches.Tree"],mixins:["Sch.data.mixin.FilterableTreeStore","Sch.data.mixin.EventStore"],model:"Gnt.model.Task",calendar:null,dependencyStore:null,resourceStore:null,assignmentStore:null,weekendsAreWorkdays:false,cascadeChanges:false,batchSync:true,recalculateParents:true,skipWeekendsDuringDragDrop:true,cascadeDelay:0,moveParentAsGroup:true,enableDependenciesForParentTasks:true,availabilitySearchLimit:1825,cascading:false,isFillingRoot:false,isSettingRoot:false,earlyStartDates:null,earlyEndDates:null,lateStartDates:null,lateEndDates:null,lastTotalTimeSpan:null,suspendAutoRecalculateParents:0,suspendAutoCascade:0,currentCascadeBatch:null,batchCascadeLevel:0,fillTasksWithDepInfoCounter:0,fillTasksWithAssignmentInfoCounter:0,dependenciesCalendar:"project",cachedAssignments:null,constructor:function(l){this.addEvents("filter","clearfilter","beforecascade","cascade");l=l||{};if(!l.calendar){var h={};if(l.hasOwnProperty("weekendsAreWorkdays")){h.weekendsAreWorkdays=l.weekendsAreWorkdays}else{if(this.self.prototype.hasOwnProperty("weekendsAreWorkdays")&&this.self!=Gnt.data.TaskStore){h.weekendsAreWorkdays=this.weekendsAreWorkdays}}l.calendar=new Gnt.data.Calendar(h)}var g=l.dependencyStore||this.dependencyStore||Ext.create("Gnt.data.DependencyStore");delete l.dependencyStore;this.setDependencyStore(g);var k=l.resourceStore||this.resourceStore||Ext.create("Gnt.data.ResourceStore");delete l.resourceStore;this.setResourceStore(k);var i=l.assignmentStore||this.assignmentStore||Ext.create("Gnt.data.AssignmentStore",{resourceStore:k});delete l.assignmentStore;this.setAssignmentStore(i);var j=l.calendar;if(j){delete l.calendar;this.setCalendar(j,true)}this.resetEarlyDates();this.resetLateDates();this.mixins.observable.constructor.call(this);this.on({beforefill:this.onRootBeforeFill,fillcomplete:this.onRootFillEnd,remove:this.onTaskDeleted,write:this.onTaskStoreWrite,sort:this.onSorted,load:this.onTasksLoaded,rootchange:this.onTasksLoaded,scope:this});this.callParent([l]);this.fillTasksWithDepInfo();if(this.autoSync){if(this.batchSync){this.sync=Ext.Function.createBuffered(this.sync,500)}else{this.on("beforesync",this.onTaskStoreBeforeSync,this)}}this.initTreeFiltering();this.treeStore=this},onTasksLoaded:function(){this.fillTasksWithDepInfoCounter=1;this.fillTasksWithAssignmentInfoCounter=1;this.fillTasksWithDepInfo()},load:function(b){this.un("remove",this.onTaskDeleted,this);this.callParent(arguments);this.on("remove",this.onTaskDeleted,this)},loadData:function(J,l){var N=this,K=N.getRootNode(),ad=l?l.addRecords:false,H=l?l.syncStore:false;N.suspendAutoSync();N.suspendEvents();if(!ad&&K){K.removeAll()}if(!N.getRootNode()){K=N.setRootNode()}if(J.length){var aa=J.length,ab=N.model,T=[],G=(typeof J[0].get==="function"),ae,O,S,i,Q,M,F,U,Y,P;var R=N.sortNewNodesByIndex(J);for(var I=0;I<aa;I++){O=N.getById(J[I].getId?J[I].getId():J[I].Id);P=false;ae=0;if(O){i=G?J[I].get("parentId"):J[I].parentId;Q=O.parentNode.getId();M=G?J[I].get("index"):J[I].index;F=O.get("index");if(((typeof i!=="undefined"||i===null)?(i!==Q):false)||(typeof M!=="undefined"?(M!==F):false)){U=i===null?K:N.getById(i);Y=Q===null?K:N.getById(Q);if(U&&(U.get("parentId")===O.getId())&&N.selfChildInRecordsData(O.getId(),i,R)){P=true}}else{ae=1}}else{O=G?new ab(J[I].data):new ab(J[I]);Q=O.get("parentId");if(Q){U=N.getById(Q)}else{if(Q===null){U=K}}}if(!P){if(G){O.set(J[I].data)}else{O.set(J[I])}}else{continue}if(U&&!ae){N.moveChildren(O,U,Y,R);N.fixNodeDates(O)}else{if(typeof U==="undefined"&&!ae){S={node:O,index:O.get("index")||0,parentId:O.get("parentId")};T.push(S)}else{N.fixNodeDates(O)}}if(U&&!H){U.commit();O.commit();if(Y){Y.commit()}}}var Z=0,V=0,X=T.length,ac,W;while(T.length){if(Z>T.length-1){Z=0;V=1}ac=T[Z];W=ac.parentId===null?K:N.getById(ac.parentId);if(W){var af=N.nodeIsChild(ac.node,U);if(af){W.insertChild(ac.index,ac.node);N.fixNodeDates(ac.node);T.splice(Z,1);if(!H){W.commit();ac.node.commit()}Z-=1}}Z+=1;if(V&&Z===X-1&&T.length===X){throw"Invalid data, possible infinite loop."}}if(N.nodesToExpand){I=0;for(var L=N.nodesToExpand.length;I<L;I+=1){O=N.nodesToExpand[I];if(O.childNodes&&O.childNodes.length){O.expand()}}delete N.nodesToExpand}}N.resumeAutoSync();N.resumeEvents();this.fireEvent("datachanged");this.fireEvent("refresh");if(H){N.sync()}if(this.buffered){}},selfChildInRecordsData:function(g,h,e){var f=false;f=typeof e[h]==="undefined"?true:e[h]===g;return f},sortNewNodesByIndex:function(f){var d={},e=function(b,a){if(typeof b.get==="function"){return b.get(a)}return b[a]};Ext.Array.each(f,function(a){d[e(a,"Id")]=e(a,"parentId")});Ext.Array.sort(f,function(k,a){var b=e(k,"index"),c=e(a,"index"),j=e(k,"parentId"),l=e(a,"parentId");if(typeof b!=="undefined"&&typeof c!=="undefined"){if(j===l){return(b<c)?-1:(b>c)?1:0}else{if(j===null){return 1}else{if(l===null){return -1}else{return(j<l)?-1:1}}}}return 0});return d},fixNodeDates:function(d){var f=d.calculateDuration(d.getStartDate(),d.getEndDate(),d.getDurationUnit()),e;d.set({Duration:f});if(this.recalculateParents){if(d.childNodes.length){e=d.getChildAt(0);e.recalculateParents()}else{d.recalculateParents()}}},nodeIsChild:function(h,e){var g=e.getId(),f=true;if(h.childNodes.length){h.cascadeBy(function(a){if(a.getId()===g){f=false;return false}})}return f},moveChildren:function(n,o,p,m){if(n.get("expanded")){if(!this.nodesToExpand){this.nodesToExpand=[]}this.nodesToExpand.push(n);n.set("expanded",false)}var i,k=this.nodeIsChild(n,o),l=m?!this.selfChildInRecordsData(n.getId(),o.getId(),m):true,j=p||this.getById(n.get("parentId"));if(!k&&l){o.set("parentId",null);this.moveChildren(o,this.getRootNode(),n)}if(k||l){if(n.childNodes.length){i=n.copy(null,true);n.removeAll()}if(j&&j.getId()!==o.getId()){j.removeChild(n)}typeof n.get("index")!=="undefined"?o.insertChild(n.get("index"),n):o.appendChild(n);if(i){i.cascadeBy(function(a){if(a!==i){var b=a.copy(null);b.get("index")?n.insertChild(b.get("index"),b):n.appendChild(b)}})}this.fixNodeDates(n)}},setRootNode:function(){var c=this;this.isSettingRoot=true;this.tree.setRootNode=Ext.Function.createInterceptor(this.tree.setRootNode,function(a){Ext.apply(a,{calendar:c.calendar,taskStore:c,dependencyStore:c.dependencyStore,phantom:false,dirty:false})});var d=this.callParent(arguments);this.isSettingRoot=false;delete this.tree.setRootNode;return d},onRootBeforeFill:function(c,d){if(d.isRoot()){this.cachedAssignments=this.fillAssignmentsCache()}this.isFillingRoot=true;this.un({append:this.onNodeUpdated,insert:this.onNodeUpdated,update:this.onTaskUpdated,scope:this})},onRootFillEnd:function(c,d){if(d.isRoot()){this.cachedAssignments=null}d.normalizeParent();this.on({append:this.onNodeUpdated,insert:this.onNodeUpdated,update:this.onTaskUpdated,scope:this});this.isFillingRoot=false;if(Ext.data.reader.Xml&&this.proxy.reader instanceof Ext.data.reader.Xml){this.lazyFill=true}},getDependencyStore:function(){return this.dependencyStore},fillTasksWithDepInfo:function(){if(!this.tree||!this.tree.nodeHash){return}var b=this.getDependencyStore();if(this.fillTasksWithDepInfoCounter++>0){this.forEachTaskUnOrdered(function(a){a.successors=[];a.predecessors=[]})}if(b){b.each(function(a){var e=a.getSourceTask(),f=a.getTargetTask();if(e&&f){e.successors.push(a);f.predecessors.push(a)}})}},setDependencyStore:function(d){var c={add:this.onDependencyAddOrUpdate,update:this.onDependencyAddOrUpdate,remove:this.onDependencyDelete,scope:this};if(this.dependencyStore){this.dependencyStore.un(c)}if(d){this.dependencyStore=Ext.StoreMgr.lookup(d);if(d){d.taskStore=this;d.on(c);this.fillTasksWithDepInfo()}}else{this.dependencyStore=null}},setResourceStore:function(b){if(b){this.resourceStore=Ext.StoreMgr.lookup(b);b.taskStore=this;b.normalizeResources()}else{this.resourceStore=null}},getResourceStore:function(){return this.resourceStore||null},fillAssignmentsCache:function(){var c=this.getAssignmentStore(),d={};if(this.fillTasksWithAssignmentInfoCounter++>0){this.forEachTaskUnOrdered(function(a){a.assignments=[]})}if(c){c.each(function(b){var a=b.getTaskId();d[a]?d[a].push(b):d[a]=[b]})}return d},fillTasksWithAssignmentInfo:function(){if(!this.tree||!this.tree.nodeHash){return}var b=this.getAssignmentStore();if(this.fillTasksWithAssignmentInfoCounter++>0){this.forEachTaskUnOrdered(function(a){a.assignments=[]})}if(b){b.each(function(d){var a=d.getTask();a&&a.assignments.push(d)})}},setAssignmentStore:function(c){var d={add:this.onAssignmentStructureMutation,update:this.onAssignmentMutation,remove:this.onAssignmentStructureMutation,scope:this};if(this.assignmentStore){this.assignmentStore.un(d)}if(c){this.assignmentStore=Ext.StoreMgr.lookup(c);c.taskStore=this;c.on(d);this.fillTasksWithAssignmentInfo()}else{this.assignmentStore=null}},getAssignmentStore:function(){return this.assignmentStore||null},renormalizeTasks:function(f,d){this.resetEarlyDates();this.resetLateDates();if(d instanceof Gnt.model.Task){d.adjustToCalendar()}else{var e=this.getRootNode();if(e){e.cascadeBy(function(a){a.adjustToCalendar()})}}},getCalendar:function(){return this.calendar||null},setCalendar:function(g,e){var h={calendarchange:this.renormalizeTasks,scope:this};if(this.calendar){this.calendar.un(h)}this.calendar=g;if(g){g.on(h);var f=this.tree&&this.getRootNode();if(f){f.calendar=g}if(!e){this.renormalizeTasks()}}},getCriticalPaths:function(){var e=this.getRootNode(),f=[],g=new Date(0);e.cascadeBy(function(a){g=Sch.util.Date.max(a.getEndDate(),g)});e.cascadeBy(function(a){if(g-a.getEndDate()===0&&!a.isRoot()&&!(!a.isLeaf()&&a.childNodes.length)){f.push(a)}});var h=[];Ext.each(f,function(a){h.push(a.getCriticalPaths())});return h},onNodeUpdated:function(d,f){if(!f.isRoot()){if(this.lastTotalTimeSpan){var e=this.getTotalTimeSpan();if(f.getEndDate()>e.end||f.getStartDate()<e.start){this.lastTotalTimeSpan=null}}if(f.getEndDate()-this.getProjectEndDate()===0){this.resetLateDates()}if(!this.cascading&&this.recalculateParents){f.recalculateParents()}}},getViolatedConstraints:function(f){var h=this,e=0,g=[];this.dependencyStore.each(function(c){var a=c.getSourceTask();var b=c.getTargetTask();if(a&&b){var d=b.getViolatedConstraints();if(d){e++;g.push(d)}if(f&&(e>=f)){return false}}});return g},onTaskUpdated:function(p,i,j){var m=i.previous;if(this.lastTotalTimeSpan){var o=this.getTotalTimeSpan();if(m&&(m[i.endDateField]-o.end===0||m[i.startDateField]-o.start===0)||(i.getEndDate()>o.end||i.getStartDate()<o.start)){this.lastTotalTimeSpan=null}}if(!this.cascading&&j!==Ext.data.Model.COMMIT&&m){var l=i.percentDoneField in m;if(i.startDateField in m||i.endDateField in m||"parentId" in m||i.effortField in m||m[i.schedulingModeField]==="Manual"){var n=i;if(this.cascadeChanges&&!this.suspendAutoCascade){if(m[n.schedulingModeField]=="Manual"){var k=n.getIncomingDependencies(true);if(k.length){n=k[0].getSourceTask()}}Ext.Function.defer(this.cascadeChangesForTask,this.cascadeDelay,this,[n])}else{this.resetEarlyDates();this.resetLateDates()}l=true}else{if(m[i.schedulingModeField]&&i.isManuallyScheduled()){this.resetEarlyDates();this.resetLateDates()}}if(l&&this.recalculateParents&&!this.suspendAutoRecalculateParents){i.recalculateParents()}}},startBatchCascade:function(){if(!this.batchCascadeLevel){this.currentCascadeBatch={nbrAffected:0,affected:{},visitedCounters:{},addVisited:function(c){var d=c.internalId;if(!this.visitedCounters[d]){this.visitedCounters[d]=1}else{this.visitedCounters[d]++}},addAffected:function(c){var d=c.internalId;if(!this.affected[d]){this.affected[d]=c;this.nbrAffected++}}}}this.batchCascadeLevel++;return this.currentCascadeBatch},endBatchCascade:function(){this.batchCascadeLevel--;if(!this.batchCascadeLevel){var b=this.currentCascadeBatch;this.currentCascadeBatch=null;if(b.nbrAffected>0){this.resetEarlyDates();this.resetLateDates()}if(this.cascading){this.cascading=false;this.fireEvent("cascade",this,b)}}},cascadeChangesForTask:function(g,h){var f=this.currentCascadeBatch;if(f&&f.visitedCounters[g.internalId]>g.predecessors.length){return{nbrAffected:0,affected:{}}}this.startBatchCascade();var i=this,j={nbrAffected:0,affected:{}};Ext.each(g.getOutgoingDependencies(true),function(b){var a=b.getTargetTask();if(a){if(!i.cascading){i.fireEvent("beforecascade",i);i.cascading=true}a.cascadeChanges(i,j,b)}});if(i.cascading){if(!h&&i.recalculateParents){i.recalculateAffectedParents(j.affected)}}this.endBatchCascade();return j},getParentsContext:function(){return{array:[],byInternalId:{}}},addTaskToParentsContext:function(h,g){var f=h.byInternalId;var i=h.array;var j=g.isLeaf()?g.parentNode:g;while(j){if(f[j.internalId]){break}f[j.internalId]=j;i.push(j);j=j.parentNode}},recalculateAffectedParents:function(j,h){h=h||this.getParentsContext();this.suspendAutoCascade++;this.suspendAutoRecalculateParents++;var f=this;Ext.Object.each(j,function(a,b){f.addTaskToParentsContext(h,b)});var i=h.array;i.sort(function(a,b){return a.data.depth-b.data.depth});var g;if(this.recalculateParents){for(g=i.length-1;g>=0;g--){i[g].refreshCalculatedParentNodeData()}}if(this.cascadeChanges){for(g=0;g<i.length;g++){this.cascadeChangesForTask(i[g])}}this.suspendAutoRecalculateParents--;this.suspendAutoCascade--},removeTaskDependencies:function(e){var d=this.dependencyStore,f=e.getAllDependencies(d);if(f.length){d.remove(f)}},removeTaskAssignments:function(d){var f=this.getAssignmentStore(),e=d.getAssignments();if(e.length){f.remove(e)}},onTaskDeleted:function(m,n,i){var p=this.dependencyStore;if(p&&!n.isReplace&&!i){n.cascadeBy(this.removeTaskDependencies,this)}var k=this.getAssignmentStore();if(k&&!n.isReplace&&!i){k.fireEvent("beforetaskassignmentschange",k,n.getInternalId(),[]);n.cascadeBy(this.removeTaskAssignments,this);k.fireEvent("taskassignmentschanged",k,n.getInternalId(),[])}var o=this.getTotalTimeSpan();var j=n.getStartDate();var l=n.getEndDate();if(l-o.end===0||j-o.start===0){this.lastTotalTimeSpan=null}this.resetEarlyDates();this.resetLateDates()},onAssignmentMutation:function(f,e){var d=this;Ext.each(e,function(a){var b=a.getTask(d);if(b){b.onAssignmentMutation(a)}})},onAssignmentStructureMutation:function(f,e){var d=this;Ext.each(e,function(a){var b=a.getTask(d);if(b){b.onAssignmentStructureMutation(a)}})},onDependencyAddOrUpdate:function(e,g){this.resetEarlyDates();this.resetLateDates();if(this.cascadeChanges){var h=this,f;Ext.each(g,function(a){f=a.getTargetTask();if(f){f.constrain(h)}})}},onDependencyDelete:function(d,c){this.resetEarlyDates();this.resetLateDates()},getNewRecords:function(){return Ext.Array.filter(this.tree.flatten(),this.filterNew,this)},getUpdatedRecords:function(){return Ext.Array.filter(this.tree.flatten(),this.filterUpdated,this)},filterNew:function(b){return b.phantom&&b.isValid()&&b!=this.tree.root},filterUpdated:function(b){return b.dirty&&!b.phantom&&b.isValid()&&b!=this.tree.root},onTaskStoreBeforeSync:function(f,j){var g=f.create;if(g){for(var h,i=g.length-1;i>=0;i--){h=g[i];if(!h.isPersistable()){Ext.Array.remove(g,h)}}if(g.length===0){delete f.create}}return Boolean((f.create&&f.create.length>0)||(f.update&&f.update.length>0)||(f.destroy&&f.destroy.length>0))},onTaskStoreWrite:function(j,f){var i=this.dependencyStore;if(!i||f.action!=="create"){return}var g=f.getRecords(),h;Ext.each(g,function(a){h=a.getId();if(!a.phantom&&h!==a._phantomId){Ext.each(i.getNewRecords(),function(d){var b=d.getSourceId();var c=d.getTargetId();if(b===a._phantomId){d.setSourceId(h)}else{if(c===a._phantomId){d.setTargetId(h)}}});Ext.each(a.childNodes,function(b){if(b.phantom){b.set("parentId",h)}});delete a._phantomId}})},forEachTaskUnOrdered:function(j,f){var h=this.tree.nodeHash;var g=this.getRootNode();for(var i in h){if(h[i]!==g){if(j.call(f||this,h[i])===false){return false}}}},getTasksTimeSpan:function(g){var f=new Date(9999,0,1),e=new Date(0);var h=function(b){var c=b.getStartDate();var a=b.getEndDate();if(c&&c<f){f=c}if(c&&a&&a>e){e=a}};if(g){if(!Ext.isArray(g)){g=[g]}Ext.Array.each(g,h)}else{this.forEachTaskUnOrdered(h)}f=f<new Date(9999,0,1)?f:null;e=e>new Date(0)?e:null;return{start:f,end:e||(f&&Ext.Date.add(f,Ext.Date.DAY,1))||null}},getTotalTimeSpan:function(){if(this.lastTotalTimeSpan){return this.lastTotalTimeSpan}this.lastTotalTimeSpan=this.getTasksTimeSpan();return this.lastTotalTimeSpan},getProjectStartDate:function(){return this.getTotalTimeSpan().start},getProjectEndDate:function(){return this.getTotalTimeSpan().end},getCount:function(c){var d=c===false?0:-1;this.getRootNode().cascadeBy(function(){d++});return d},toArray:function(){var b=[];this.getRootNode().cascadeBy(function(a){b.push(a)});return b},remove:function(b){Ext.each(b,function(a){a.remove()})},indent:function(b){this.fireEvent("beforeindentationchange",this,b);b=Ext.isArray(b)?b.slice():[b];b.sort(function(a,e){return a.data.index-e.data.index});this.suspendEvents(true);Ext.each(b,function(a){a.indent()});this.resumeEvents();this.fireEvent("indentationchange",this,b)},outdent:function(b){this.fireEvent("beforeindentationchange",this,b);b=Ext.isArray(b)?b.slice():[b];b.sort(function(a,e){return e.data.index-a.data.index});this.suspendEvents(true);Ext.each(b,function(a){a.outdent()});this.resumeEvents();this.fireEvent("indentationchange",this,b)},getTasksForResource:function(b){return b.getTasks()},getEventsForResource:function(b){return this.getTasksForResource(b)},indexOf:function(b){return b&&this.tree.getNodeById(b.internalId)?0:-1},getByInternalId:function(b){return this.tree.getNodeById(b)},queryBy:function(e,f){var g=[];var h=this;this.getRootNode().cascadeBy(function(a){if(e.call(f||h,a)){g.push(a)}});return g},onSorted:function(){if(this.lastTreeFilter){this.filterTreeBy(this.lastTreeFilter)}},append:function(b){this.getRootNode().appendChild(b)},resetEarlyDates:function(){this.earlyStartDates={};this.earlyEndDates={};this.fireEvent("resetearlydates")},resetLateDates:function(){this.lateStartDates={};this.lateEndDates={};this.fireEvent("resetlatedates")},getBySequenceNumber:function(b){return this.getRootNode().getBySequenceNumber(b)},destroy:function(){this.setCalendar(null);this.setAssignmentStore(null);this.setDependencyStore(null);this.setResourceStore(null);this.callParent(arguments)}},function(){this.override(Sch.data.mixin.FilterableTreeStore.prototype.inheritables()||{})});Ext.define("Gnt.data.ResourceStore",{requires:["Gnt.model.Resource"],extend:"Sch.data.ResourceStore",model:"Gnt.model.Resource",taskStore:null,constructor:function(){this.mixins.observable.constructor.call(this);this.on({load:this.normalizeResources,remove:this.onResourceRemoved,scope:this});this.callParent(arguments)},normalizeResources:function(){this.each(function(c){if(!c.normalized){var d=c.getCalendarId();if(d){c.setCalendarId(d,true)}c.normalized=true}})},onResourceRemoved:function(e,d){var f=this.getAssignmentStore();f.removeAssignmentsForResource(d)},getTaskStore:function(){return this.taskStore||null},getAssignmentStore:function(){return this.assignmentStore=(this.assignmentStore||this.getTaskStore().getAssignmentStore())},getByInternalId:function(b){return this.data.getByKey(b)||this.getById(b)}});Ext.define("Gnt.data.AssignmentStore",{extend:"Ext.data.Store",requires:["Gnt.model.Assignment"],model:"Gnt.model.Assignment",ignoreInitial:true,isLoadingRecords:false,isRemovingAll:false,taskStore:null,constructor:function(){this.mixins.observable.constructor.apply(this,arguments);this.init();this.callParent(arguments);this.ignoreInitial=false},init:function(){this.on({add:this.onAssignmentAdd,update:this.onAssignmentUpdate,load:this.onAssignmentsLoad,datachanged:this.onAssignmentDataChanged,remove:this.onAssignmentRemove,scope:this})},onAssignmentsLoad:function(){var b=this.getTaskStore();b&&b.fillTasksWithAssignmentInfo()},onAssignmentDataChanged:function(){var b=this.getTaskStore();if(b&&(this.isLoadingRecords||this.isRemovingAll)){b.fillTasksWithAssignmentInfo()}},removeAll:function(){this.isRemovingAll=true;this.callParent(arguments);this.isRemovingAll=false},loadRecords:function(){this.isLoadingRecords=true;this.callParent(arguments);this.isLoadingRecords=false},onAssignmentAdd:function(i,f){if(this.ignoreInitial){return}for(var j=0;j<f.length;j++){var h=f[j];var g=h.getTask();g&&g.assignments.push(h)}},onAssignmentRemove:function(h,g){var e=this.getTaskStore();if(!e){return}var f=g.getTask(e);f&&Ext.Array.remove(f.assignments,g)},onAssignmentUpdate:function(k,j,h){if(h!=Ext.data.Model.COMMIT){var n=this.getTaskStore();if(!n){return}var l=j.previous;var i=j.getTask();if(l&&j.taskIdField in l){var m=n.getById(l[j.taskIdField]);m&&Ext.Array.remove(m.assignments,j);i&&i.assignments.push(j)}}},getTaskStore:function(){return this.taskStore},getResourceStore:function(){return this.getTaskStore().resourceStore},getByInternalId:function(b){return this.data.getByKey(b)||this.getById(b)},removeAssignmentsForResource:function(d){var f=d.getId();if(f){var e=this.queryBy(function(a){return a.getResourceId()===f}).items;this.remove(e)}}});Ext.define("Gnt.patches.IETreeStore",{extend:"Sch.util.Patch",requires:["Gnt.data.TaskStore"],target:"Gnt.data.TaskStore",ieOnly:true,overrides:{onNodeAdded:function(n,l){var m=this,h=m.getProxy(),i=h.getReader(),k=l.raw||l[l.persistenceProperty],j;Ext.Array.remove(m.removed,l);l.join(m);if(!l.isLeaf()){j=i.getRoot(k);if(j){m.fillNode(l,i.extractData(j));if(k[i.root]){delete k[i.root]}}}if(m.autoSync&&!m.autoSyncSuspended&&(l.phantom||l.dirty)){m.sync()}}}});Ext.define("Gnt.template.Template",{extend:"Ext.XTemplate",isLegacyIE:Ext.isIE8m||Ext.isIEQuirks,getInnerTpl:Ext.emptyFn,innerTpl:null,dependencyTerminalMarkup:'<div class="sch-gantt-terminal sch-gantt-terminal-start"></div><div class="sch-gantt-terminal sch-gantt-terminal-end"></div>',constructor:function(e){Ext.apply(this,e);var f=e.rtl?"right":"left";var d=this.getInnerTpl(e)||"";this.callParent(['<div class="sch-event-wrap {ctcls} '+Ext.baseCSSPrefix+'unselectable" style="'+f+':{offset}px">'+(e.leftLabel?'<div class="sch-gantt-labelct sch-gantt-labelct-left"><label class="sch-gantt-label sch-gantt-label-left">{leftLabel}</label></div>':"")+(e.rightLabel?'<div class="sch-gantt-labelct sch-gantt-labelct-right" style="left:{width}px"><label class="sch-gantt-label sch-gantt-label-right">{rightLabel}</label></div>':"")+(e.topLabel?'<div class="sch-gantt-labelct sch-gantt-labelct-top"><label class="sch-gantt-label sch-gantt-label-top">{topLabel}</label></div>':"")+d+(e.bottomLabel?'<div class="sch-gantt-labelct sch-gantt-labelct-bottom"><label class="sch-gantt-label sch-gantt-label-bottom">{bottomLabel}</label></div>':"")+"</div>",{compiled:true,disableFormats:true}])}});Ext.define("Gnt.template.Task",{extend:"Gnt.template.Template",innerTpl:'<div class="sch-gantt-progress-bar" style="width:{percentDone}%;{progressBarStyle}" unselectable="on">&#160;</div>',getInnerTpl:function(d){var c=d.rtl?"right":"left";return'<div id="'+d.prefix+'{id}" class="sch-gantt-item sch-gantt-task-bar {cls}" unselectable="on" style="width:{width}px;{style}">'+((d.resizeHandles==="both"||d.resizeHandles==="left")?'<div class="sch-resizable-handle sch-gantt-task-handle sch-resizable-handle-start sch-resizable-handle-west"></div>':"")+this.innerTpl+((d.resizeHandles==="both"||d.resizeHandles==="right")?'<div class="sch-resizable-handle sch-gantt-task-handle sch-resizable-handle-end sch-resizable-handle-east"></div>':"")+(d.enableProgressBarResize?'<div style="'+c+':{percentDone}%" class="sch-gantt-progressbar-handle"></div>':"")+(d.enableDependencyDragDrop?this.dependencyTerminalMarkup:"")+"</div>"}});Ext.define("Gnt.template.Milestone",{extend:"Gnt.template.Template",innerTpl:(Ext.isIE8m||Ext.isIEQuirks?('<div style="border-width:{[Math.floor(values.side*0.7)]}px" class="sch-gantt-milestone-diamond-top {cls}" unselectable="on" style="{style}"></div><div style="border-width:{[Math.floor(values.side*0.7)]}px" class="sch-gantt-milestone-diamond-bottom {cls}" unselectable="on" style="{style}"></div>'):('<img style="{[values.print ? "height:" + values.side + "px;border-left-width:" + values.side + "px" : ""]};{style}" src="'+Ext.BLANK_IMAGE_URL+'" class="sch-gantt-milestone-diamond {cls}" unselectable="on"/>')),getInnerTpl:function(b){return"<div "+(this.isLegacyIE?'style="width:{[Math.floor(values.side*0.7)]}px"':"")+' id="'+b.prefix+'{id}" class="sch-gantt-item sch-gantt-milestone-diamond-ct">'+this.innerTpl+(b.enableDependencyDragDrop?this.dependencyTerminalMarkup:"")+"</div>"}});Ext.define("Gnt.template.ParentTask",{extend:"Gnt.template.Template",innerTpl:'<div class="sch-gantt-progress-bar" style="width:{percentDone}%;{progressBarStyle}">&#160;</div><div class="sch-gantt-parenttask-arrow sch-gantt-parenttask-leftarrow"></div><div class="sch-gantt-parenttask-arrow sch-gantt-parenttask-rightarrow"></div>',getInnerTpl:function(b){return'<div id="'+b.prefix+'{id}" class="sch-gantt-item sch-gantt-parenttask-bar {cls}" style="width:{width}px; {style}">'+this.innerTpl+(b.enableDependencyDragDrop?this.dependencyTerminalMarkup:"")+"</div>"}});Ext.define("Gnt.Tooltip",{extend:"Ext.ToolTip",alias:"widget.gantt_task_tooltip",requires:["Ext.Template"],mixins:["Gnt.mixin.Localizable"],mode:"startend",cls:"sch-tip",height:40,autoHide:false,anchor:"b-tl",maskOnDisable:false,startEndTemplate:null,durationTemplate:null,initComponent:function(){this.rtl=this.gantt.rtl;if(this.mode==="startend"&&!this.startEndTemplate){this.startEndTemplate=new Ext.Template('<div class="sch-timetipwrap {cls}"><div>'+this.L("startText")+"{startText}</div><div>"+this.L("endText")+"{endText}</div></div>").compile()}if(this.mode==="duration"&&!this.durationTemplate){this.durationTemplate=new Ext.Template('<div class="sch-timetipwrap {cls}">',"<div>"+this.L("startText")+" {startText}</div>","<div>"+this.L("durationText")+" {duration} {unit}</div>","</div>").compile()}this.callParent(arguments)},update:function(h,f,i,g){var j;if(this.mode==="duration"){j=this.getDurationContent(h,f,i,g)}else{j=this.getStartEndContent(h,f,i,g)}this.callParent([j])},getStartEndContent:function(k,i,m,j){var p=this.gantt,n=p.getFormattedDate(k),o=n;if(i-k>0){o=p.getFormattedEndDate(i,k)}var l={cls:m?"sch-tip-ok":"sch-tip-notok",startText:n,endText:o,task:j};return this.startEndTemplate.apply(l)},getDurationContent:function(i,g,k,h){var l=h.getDurationUnit()||Sch.util.Date.DAY;var j=h.calculateDuration(i,g,l);return this.durationTemplate.apply({cls:k?"sch-tip-ok":"sch-tip-notok",startText:this.gantt.getFormattedDate(i),duration:parseFloat(Ext.Number.toFixed(j,1)),unit:Sch.util.Date.getReadableNameOfUnit(l,j>1),task:h})},show:function(d,c){if(d){this.setTarget(d)}this.callParent([]);if(c!==undefined){this.setX(c)}}});Ext.define("Gnt.feature.TaskDragDrop",{extend:"Ext.dd.DragZone",requires:["Gnt.Tooltip","Ext.dd.StatusProxy"],useTooltip:true,tooltipConfig:null,validatorFn:function(f,e,g,h){return true},validatorFnScope:null,showExactDropPosition:false,containerScroll:false,dropAllowed:"sch-gantt-dragproxy",dropNotAllowed:"sch-gantt-dragproxy",valid:false,gantt:null,onDragEnter:Ext.emptyFn,onDragOut:Ext.emptyFn,tip:null,constructor:function(h,e){e=e||{};Ext.apply(this,e);if(Ext.isIE&&(Ext.isIE8||Ext.isIE7||Ext.ieVersion<9)&&window.top!==window){Ext.dd.DragDropManager.notifyOccluded=true}this.proxy=this.proxy||new Ext.dd.StatusProxy({shadow:false,dropAllowed:"sch-gantt-dragproxy",dropNotAllowed:"sch-gantt-dragproxy",ensureAttachedToBody:Ext.emptyFn});var g=this,f=g.gantt;if(g.useTooltip){g.tip=new Gnt.Tooltip(Ext.apply({cls:"gnt-dragdrop-tip",gantt:f},g.tooltipConfig))}g.callParent([h,Ext.apply(e,{ddGroup:f.id+"-task-dd"})]);g.scroll=false;g.isTarget=true;g.ignoreSelf=false;g.addInvalidHandleClass("sch-resizable-handle");g.addInvalidHandleClass(Ext.baseCSSPrefix+"resizable-handle");g.addInvalidHandleClass("sch-gantt-terminal");g.addInvalidHandleClass("sch-gantt-progressbar-handle");f.ownerCt.el.appendChild(this.proxy.el);f.on({destroy:g.destroy,scope:g})},destroy:function(){if(this.tip){this.tip.destroy()}this.callParent(arguments)},autoOffset:function(d,c){this.setDelta(0,0)},setXConstraint:function(f,d,e){this.leftConstraint=f;this.rightConstraint=d;this.minX=f;this.maxX=d;if(e){this.setXTicks(this.initPageX,e)}this.constrainX=true},setYConstraint:function(e,f,d){this.topConstraint=e;this.bottomConstraint=f;this.minY=e;this.maxY=f;if(d){this.setYTicks(this.initPageY,d)}this.constrainY=true},constrainTo:function(e,h,f,g){this.resetConstraints();this.initPageX=e.left+f;this.initPageY=h.top+g;this.setXConstraint(e.left,e.right,this.xTickSize);this.setYConstraint(h.top-1,h.top-1,this.yTickSize)},onDragOver:function(q){var u=this.dragData,z=u.record,y=this.gantt;if(!u.hidden){Ext.fly(u.sourceNode).hide();u.hidden=true}var B=y.getDateFromCoordinate(q.getXY()[0])-u.sourceDate;var e=new Date(u.origStart-0+B);var w=this.proxy.el;var t;if(y.timeAxis.isContinuous()){t=y.timeAxis.roundDate(e,y.snapRelativeToEventStartDate?u.origStart:false)}else{var p=w.getX()+(y.rtl?w.getWidth():0)+y.getXOffset(z)-u.offsets[0];t=y.getDateFromXY([p,0],"round")}if(this.showExactDropPosition&&y.taskStore.skipWeekendsDuringDragDrop&&!z.isManuallyScheduled()){var A=Ext.fly(u.ddel.id);var s=0;var r=z.skipNonWorkingTime(t,!z.isMilestone());if(e.getTime()!=r.getTime()){s=y.timeAxisViewModel.getDistanceBetweenDates(e,r)}var x=z.recalculateEndDate(r);if(e>y.timeAxis.getStart()){A.setWidth(y.timeAxisViewModel.getDistanceBetweenDates(r,Sch.util.Date.min(x,y.timeAxis.getEnd())));if(s){w.setX(w.getX()+s)}}}if(!t||t-u.start===0){return}u.start=t;this.valid=this.validatorFn.call(this.validatorFnScope||y,z,t,u.duration,q)!==false;if(this.tip){var v=z.calculateEndDate(t,z.getDuration(),z.getDurationUnit());this.updateTip(z,t,v,this.valid)}},startDrag:function(){var b=Ext.dd.ScrollManager;this.gantt.el.ddScrollConfig={increment:b.increment,hthresh:b.hthresh,vthresh:-1};return this.callParent(arguments)},endDrag:function(){delete this.gantt.el.ddScrollConfig;return this.callParent(arguments)},onStartDrag:function(){var b=this.dragData.record;if(this.tip){Ext.suspendLayouts();this.tip.enable();this.tip.show(this.dragData.ddel);this.updateTip(b,b.getStartDate(),b.getEndDate());Ext.resumeLayouts()}this.gantt.fireEvent("taskdragstart",this.gantt,b)},updateTip:function(e,g,f,h){h=h!==false;if(e.isMilestone()&&g-Ext.Date.clearTime(g,true)===0){g=Sch.util.Date.add(g,Sch.util.Date.MILLI,-1);f=Sch.util.Date.add(f,Sch.util.Date.MILLI,-1)}this.tip.update(g,f,h,e)},getDragData:function(p){var q=this.gantt,r=p.getTarget(q.eventSelector);if(r&&!p.getTarget(".sch-gantt-baseline-item")){var t=q.resolveTaskRecord(r),u=t.isMilestone();if(q.fireEvent("beforetaskdrag",q,t,p)===false){return null}var e=p.getXY();var v=r.cloneNode(true),n=this.showExactDropPosition?0:q.getSnapPixelAmount(),o=Ext.fly(r).getXY();var s=[e[0]-o[0],e[1]-o[1]];v.id=Ext.id();var g=Ext.fly(r).getHeight();Ext.fly(v).setHeight(g-(Ext.isIE7&&!u?2:0));if(Ext.isIE8m&&u){Ext.fly(v).setSize(g+5,g+5)}v.style.left=-s[0]+"px";this.constrainTo(Ext.fly(q.findItemByChild(r)).getRegion(),Ext.fly(r).getRegion(),s[0],s[1]);this.valid=false;if(n>=1){this.setXConstraint(this.leftConstraint,this.rightConstraint,n)}return{sourceNode:r,repairXY:o,offsets:s,ddel:v,record:t,duration:Sch.util.Date.getDurationInMinutes(t.getStartDate(),t.getEndDate()),sourceDate:q.getDateFromCoordinate(e[0]),origStart:t.getStartDate(),start:null}}return null},afterRepair:function(){Ext.fly(this.dragData.sourceNode).show();if(this.tip){this.tip.hide()}this.dragging=false},getRepairXY:function(){this.gantt.fireEvent("aftertaskdrop",this.gantt);return this.dragData.repairXY},onDragDrop:function(m,r){var k=this,l=k.cachedTarget||Ext.dd.DragDropMgr.getDDById(r),n=k.dragData,o=k.gantt,p=n.record,q=n.start,e=true;n.ddCallbackArgs=[l,m,r];if(this.tip){this.tip.disable()}if(this.valid&&q&&p.getStartDate()-q!==0){n.finalize=function(){k.finalize.apply(k,arguments)};e=o.fireEvent("beforetaskdropfinalize",k,n,m)!==false}if(e){this.finalize(this.valid)}},finalize:function(l){var j=this.dragData,g=this.gantt,h=j.record,i=j.start,k=false;if(l){g.taskStore.on("update",function(){k=true},null,{single:true});h.setStartDate(i,true,g.taskStore.skipWeekendsDuringDragDrop);if(k){g.fireEvent("taskdrop",g,h);if(Ext.isIE9){this.proxy.el.setStyle("visibility","hidden");Ext.Function.defer(this.onValidDrop,10,this,j.ddCallbackArgs)}else{this.onValidDrop.apply(this,j.ddCallbackArgs)}}else{this.onInvalidDrop.apply(this,j.ddCallbackArgs)}}else{this.onInvalidDrop.apply(this,j.ddCallbackArgs)}g.fireEvent("aftertaskdrop",g,h)},onInvalidDrop:function(d,e,f){if(Ext.isIE&&!e){e=d;d=d.getTarget()||document.body}return this.callParent([d,e,f])}});Ext.define("Gnt.feature.DependencyDragZone",{extend:"Ext.dd.DragZone",mixins:{observable:"Ext.util.Observable"},rtl:null,useLineProxy:null,terminalSelector:null,ganttView:null,fromText:null,toText:null,startText:null,endText:null,toolTipTpl:null,constructor:function(c,d){this.mixins.observable.constructor.call(this,d);this.callParent(arguments)},initLineProxy:function(f,g){var i=this.lineProxyEl=this.lineProxyEl||this.el.createChild({cls:"sch-gantt-connector-proxy"});var h=(Ext.isIE9m||Ext.isIEQuirks)?0:4;var j=this.rtl?(g?"r":"l"):(g?"l":"r");i.alignTo(f,j,[g?-h:h,0]);Ext.apply(this,{containerTop:this.el.getTop(),containerLeft:this.el.getLeft(),startXY:i.getXY(),startScrollLeft:this.el.dom.scrollLeft,startScrollTop:this.el.dom.scrollTop})},onDrag:function(c,d){if(this.useLineProxy){this.updateLineProxy(c.getXY())}},updateLineProxy:function(n){var z=this.lineProxyEl,q=n[0]-this.startXY[0]+this.el.dom.scrollLeft-this.startScrollLeft,r=n[1]-this.startXY[1]+this.el.dom.scrollTop-this.startScrollTop,y=Math.max(1,Math.sqrt(Math.pow(q,2)+Math.pow(r,2))-2),s=Math.atan2(r,q)-(Math.PI/2),v;if((Ext.isIE9m||Ext.isIEQuirks)){var p=Math.cos(s),t=Math.sin(s),o='progid:DXImageTransform.Microsoft.Matrix(sizingMethod="auto expand", M11 = '+p+", M12 = "+(-t)+", M21 = "+t+", M22 = "+p+")",w,u;if(this.el.dom.scrollTop!==this.startScrollTop){w=this.startScrollTop-this.containerTop}else{w=this.el.dom.scrollTop-this.containerTop}if(this.el.dom.scrollLeft!==this.startScrollLeft){u=this.startScrollLeft-this.containerLeft}else{u=this.el.dom.scrollLeft-this.containerLeft}v={height:y+"px",top:Math.min(0,r)+this.startXY[1]+w+(r<0?2:0)+"px",left:Math.min(0,q)+this.startXY[0]+u+(q<0?2:0)+"px",filter:o,"-ms-filter":o}}else{var x="rotate("+s+"rad)";v={height:y+"px","-o-transform":x,"-webkit-transform":x,"-ms-transform":x,"-moz-transform":x,transform:x}}z.setStyle(v)},onStartDrag:function(){this.el.addCls("sch-gantt-dep-dd-dragging");this.proxy.el.addCls("sch-dd-dependency-proxy");this.fireEvent("dndstart",this);if(this.useLineProxy){var b=this.dragData;this.initLineProxy(b.sourceNode,b.isStart);this.lineProxyEl.show()}},getDragData:function(j){var k=j.getTarget(this.terminalSelector);if(k){var l=this.ganttView.resolveTaskRecord(k);if(this.fireEvent("beforednd",this,l)===false){return null}var e=!!k.className.match("sch-gantt-terminal-start");var h={fromLabel:this.fromText,fromTaskName:Ext.String.htmlEncode(l.getName()),fromSide:e?this.startText:this.endText,toLabel:this.toText,toTaskName:"",toSide:""};var i=Ext.core.DomHelper.createDom({html:this.toolTipTpl.apply(h)}).firstChild;return{fromId:l.getId()||l.internalId,tplData:h,isStart:e,repairXY:Ext.fly(k).getXY(),ddel:i,sourceNode:Ext.fly(k).up(this.ganttView.eventSelector)}}return false},afterRepair:function(){this.el.removeCls("sch-gantt-dep-dd-dragging");this.dragging=false;this.fireEvent("afterdnd",this)},onMouseUp:function(){this.el.removeCls("sch-gantt-dep-dd-dragging");if(this.lineProxyEl){var c=(Ext.isIE9m||Ext.isIEQuirks)?0:400;var d=this.lineProxyEl;d.animate({to:{height:0},duration:c,callback:function(){Ext.destroy(d)}});this.lineProxyEl=null}},getRepairXY:function(){return this.dragData.repairXY},destroy:function(){Ext.destroy(this.lineProxyEl);this.callParent(arguments)}});Ext.define("Gnt.feature.DependencyDropZone",{extend:"Ext.dd.DropZone",mixins:{observable:"Ext.util.Observable"},terminalSelector:null,dependencyStore:null,toText:null,startText:null,endText:null,ganttView:null,constructor:function(c,d){this.mixins.observable.constructor.call(this,d);this.callParent(arguments)},getTargetFromEvent:function(b){return b.getTarget(this.terminalSelector)},onNodeEnter:function(g,f,h,e){Ext.fly(g).addCls("sch-gantt-terminal-drophover")},onNodeOut:function(g,f,h,e){Ext.fly(g).removeCls("sch-gantt-terminal-drophover");this.toolTipTpl.overwrite(f.proxy.el.down(".sch-dd-dependency"),e.tplData)},onNodeOver:function(o,e,n,p){var r=this.ganttView.resolveTaskRecord(o),k=r.getId()||r.internalId,q=o.className.match("sch-gantt-terminal-start");var l={};Ext.apply(l,{toLabel:this.toText,toTaskName:Ext.String.htmlEncode(r.getName()),toSide:q?this.startText:this.endText},p.tplData);this.toolTipTpl.overwrite(e.proxy.el.down(".sch-dd-dependency"),l);var m=this.resolveType(p.isStart,o);if(this.dependencyStore.isValidDependency(p.fromId,k,m)){return this.dropAllowed}else{return this.dropNotAllowed}},onNodeDrop:function(k,j,l,n){var o=this.resolveType(n.isStart,k),m,p=this.ganttView.resolveTaskRecord(k),e=p.getId()||p.internalId;this.el.removeCls("sch-gantt-dep-dd-dragging");m=this.dependencyStore.isValidDependency(n.fromId,e,o);if(m){this.fireEvent("drop",this,n.fromId,e,o)}this.fireEvent("afterdnd",this);return m},resolveType:function(f,g){var h=Gnt.model.Dependency.Type,e;if(f){if(g.className.match("sch-gantt-terminal-start")){e=h.StartToStart}else{e=h.StartToEnd}}else{if(g.className.match("sch-gantt-terminal-start")){e=h.EndToStart}else{e=h.EndToEnd}}return e}});Ext.define("Gnt.feature.DependencyDragDrop",{extend:"Ext.util.Observable",mixins:{localizable:"Gnt.mixin.Localizable"},requires:["Gnt.feature.DependencyDragZone","Gnt.feature.DependencyDropZone","Ext.XTemplate"],useLineProxy:true,dragZoneConfig:null,dropZoneConfig:null,toolTipTpl:['<div class="sch-dd-dependency">',"<table><tbody>","<tr>",'<td><span class="sch-dd-dependency-from">{fromLabel}:</span></td>','<td><span class="sch-dd-dependency-from-name">{fromTaskName}</span> - {fromSide}</td>',"</tr>","<tr>",'<td><span class="sch-dd-dependency-to">{toLabel}:</span></td>','<td><span class="sch-dd-dependency-to-name">{toTaskName}</span> - {toSide}</td>',"</tr>","</tbody></table>","</div>"],terminalSelector:".sch-gantt-terminal",el:null,rtl:null,ddGroup:null,ganttView:null,dependencyStore:null,constructor:function(c){this.addEvents("beforednd","dndstart","drop","afterdnd");var d=c.ganttView;Ext.apply(this,c);this.ddGroup=d.id+"-sch-dependency-dd";this.el.on("mousemove",this.doSetup,this,{single:true});this.callParent(arguments)},doSetup:function(){var b=this;this.dragZone=new Gnt.feature.DependencyDragZone(this.el,Ext.apply({rtl:this.rtl,terminalSelector:this.terminalSelector,useLineProxy:this.useLineProxy,ddGroup:this.ddGroup,ganttView:this.ganttView,startText:this.L("startText"),endText:this.L("endText"),fromText:this.L("fromText"),toText:this.L("toText"),toolTipTpl:Ext.XTemplate.getTpl(this,"toolTipTpl")},this.dragZoneConfig));this.relayEvents(this.dragZone,["beforednd","dndstart","afterdnd"]);this.dropZone=Ext.create("Gnt.feature.DependencyDropZone",this.el,Ext.apply({rtl:this.rtl,terminalSelector:this.terminalSelector,ddGroup:this.ddGroup,ganttView:this.ganttView,dependencyStore:this.dependencyStore,startText:this.L("startText"),endText:this.L("endText"),toText:this.L("toText"),toolTipTpl:Ext.XTemplate.getTpl(this,"toolTipTpl")},this.dropZoneConfig));this.relayEvents(this.dropZone,["drop","afterdnd"]);this.configureAllowedSourceTerminals();if(this.dependencyStore.allowedDependencyTypes){this.dragZone.on("dndstart",this.configureAllowedTargetTerminals,this)}else{this.el.addCls(["sch-gantt-terminal-allow-target-start","sch-gantt-terminal-allow-target-end"])}},configureAllowedSourceTerminals:function(){var c=this.dependencyStore.allowedDependencyTypes;var d=["sch-gantt-terminal-allow-source-start","sch-gantt-terminal-allow-source-end"];if(c){d=[];if(Ext.Array.indexOf(c,"EndToEnd")>-1||Ext.Array.indexOf(c,"EndToStart")>-1){d.push("sch-gantt-terminal-allow-source-end")}if(Ext.Array.indexOf(c,"StartToStart")>-1||Ext.Array.indexOf(c,"StartToEnd")>-1){d.push("sch-gantt-terminal-allow-source-start")}}this.el.addCls(d)},configureAllowedTargetTerminals:function(){var c=this.dependencyStore.allowedDependencyTypes;var d=[];this.el.removeCls(["sch-gantt-terminal-allow-target-start","sch-gantt-terminal-allow-target-end"]);if(Ext.Array.contains(c,"EndToEnd")||Ext.Array.contains(c,"StartToEnd")){d.push("sch-gantt-terminal-allow-target-end")}if(Ext.Array.contains(c,"StartToStart")||Ext.Array.contains(c,"EndToStart")){d.push("sch-gantt-terminal-allow-target-start")}this.el.addCls(d)},destroy:function(){if(this.dragZone){this.dragZone.destroy()}if(this.dropZone){this.dropZone.destroy()}}});Ext.define("Gnt.feature.DragCreator",{requires:["Ext.Template","Sch.util.DragTracker","Gnt.Tooltip"],constructor:function(b){Ext.apply(this,b||{});this.init()},disabled:false,showDragTip:true,tooltipConfig:null,dragTolerance:2,validatorFn:Ext.emptyFn,validatorFnScope:null,setDisabled:function(b){this.disabled=b;if(this.dragTip){this.dragTip.setDisabled(b)}},getProxy:function(){if(!this.proxy){this.proxy=this.template.append(this.ganttView.ownerCt.el,{},true)}return this.proxy},onBeforeDragStart:function(h){var j=this.ganttView,e=h.getTarget("."+j.timeCellCls,2);if(e){var g=j.resolveTaskRecord(e);var i=j.getDateFromDomEvent(h);if(!this.disabled&&e&&!g.getStartDate()&&!g.getEndDate()&&j.fireEvent("beforedragcreate",j,g,i,h)!==false){h.stopEvent();this.taskRecord=g;this.originalStart=i;this.rowRegion=j.getScheduleRegion(this.taskRecord,this.originalStart);this.dateConstraints=j.getDateConstraints(this.resourceRecord,this.originalStart);return true}}return false},onDragStart:function(){var f=this,e=f.ganttView,d=f.getProxy();f.start=f.originalStart;f.end=f.start;f.rowBoundaries={top:f.rowRegion.top,bottom:f.rowRegion.bottom};d.setRegion({top:f.rowBoundaries.top,right:f.tracker.startXY[0],bottom:f.rowBoundaries.bottom,left:f.tracker.startXY[0]});d.show();f.ganttView.fireEvent("dragcreatestart",f.ganttView);if(f.showDragTip){f.dragTip.update(f.start,f.end,true,this.taskRecord);f.dragTip.enable();f.dragTip.show(d)}},onDrag:function(i){var k=this,l=k.ganttView,e=k.tracker.getRegion().constrainTo(k.rowRegion),j=l.getStartEndDatesFromRegion(e,"round");if(!j){return}k.start=j.start||k.start;k.end=j.end||k.end;var h=k.dateConstraints;if(h){k.end=Sch.util.Date.constrain(k.end,h.start,h.end);k.start=Sch.util.Date.constrain(k.start,h.start,h.end)}k.valid=this.validatorFn.call(k.validatorFnScope||k,this.taskRecord,k.start,k.end,i)!==false;if(k.showDragTip){k.dragTip.update(k.start,k.end,k.valid,this.taskRecord)}Ext.apply(e,k.rowBoundaries);this.getProxy().setRegion(e)},onDragEnd:function(d){var c=this.ganttView;if(this.showDragTip){this.dragTip.disable()}if(!this.start||!this.end||(this.end<this.start)){this.valid=false}if(this.valid){this.taskRecord.setStartEndDate(this.start,this.end,this.taskRecord.getTaskStore().skipWeekendsDuringDragDrop);c.fireEvent("dragcreateend",c,this.taskRecord,d)}this.proxy.hide();c.fireEvent("afterdragcreate",c)},init:function(){var f=this.ganttView,e=f.el,d=Ext.Function.bind;this.lastTime=new Date();this.template=this.template||Ext.create("Ext.Template",'<div class="sch-gantt-dragcreator-proxy"></div>',{compiled:true,disableFormats:true});f.on({destroy:this.onGanttDestroy,scope:this});this.tracker=new Sch.util.DragTracker({el:e,tolerance:this.dragTolerance,onBeforeStart:d(this.onBeforeDragStart,this),onStart:d(this.onDragStart,this),onDrag:d(this.onDrag,this),onEnd:d(this.onDragEnd,this)});if(this.showDragTip){this.dragTip=new Gnt.Tooltip(Ext.apply({mode:"duration",cls:"sch-gantt-dragcreate-tip",gantt:f},this.tooltipConfig))}},onGanttDestroy:function(){if(this.dragTip){this.dragTip.destroy()}if(this.tracker){this.tracker.destroy()}if(this.proxy){Ext.destroy(this.proxy);this.proxy=null}}});Ext.define("Gnt.feature.LabelEditor",{extend:"Ext.Editor",labelPosition:"",constructor:function(c,d){this.ganttView=c;this.ganttView.on("afterrender",this.onGanttRender,this);Ext.apply(this,d);if(this.labelPosition==="left"){this.alignment="r-r"}else{if(this.labelPosition==="right"){this.alignment="l-l"}}this.delegate=".sch-gantt-label-"+this.labelPosition;this.callParent([d])},edit:function(d){var c=this.ganttView.getElementFromEventRecord(d).up(this.ganttView.eventWrapSelector);this.record=d;if(!this.rendered){this.render(this.ganttView.getSecondaryCanvasEl())}this.startEdit(c.down(this.delegate),this.dataIndex?d.get(this.dataIndex):"")},triggerEvent:"dblclick",delegate:null,dataIndex:null,shadow:false,completeOnEnter:true,cancelOnEsc:true,ignoreNoChange:true,onGanttRender:function(b){if(!this.field.width){this.autoSize="width"}this.on({beforestartedit:function(f,a,e){return b.fireEvent("labeledit_beforestartedit",b,this.record,e,f)},beforecomplete:function(f,e,a){return b.fireEvent("labeledit_beforecomplete",b,e,a,this.record,f)},complete:function(f,e,a){this.record.set(this.dataIndex,e);b.fireEvent("labeledit_complete",b,e,a,this.record,f)},scope:this});b.el.on(this.triggerEvent,function(d,a){this.edit(b.resolveTaskRecord(a))},this,{delegate:this.delegate})}});Ext.define("Gnt.feature.ProgressBarResize",{requires:["Ext.ToolTip","Ext.resizer.Resizer"],constructor:function(d){Ext.apply(this,d||{});var c=this.ganttView;c.on({destroy:this.cleanUp,scope:this});c.el.on("mousedown",this.onMouseDown,this,{delegate:".sch-gantt-progressbar-handle"});this.callParent(arguments)},useTooltip:true,increment:10,tip:null,resizable:null,ganttView:null,onMouseDown:function(i,e){var j=this.ganttView,h=j.resolveTaskRecord(e);if(j.fireEvent("beforeprogressbarresize",j,h)!==false){var g=Ext.fly(e).prev(".sch-gantt-progress-bar");i.stopEvent();this.resizable=this.createResizable(g,h,i);j.fireEvent("progressbarresizestart",j,h);Ext.getBody().on("mouseup",this.onBodyMouseUp,this,{single:true,delay:1})}},createResizable:function(q,m,o){var k=o.getTarget(),l=this.ganttView.rtl,n=q.up(this.ganttView.eventSelector),e=n.getWidth()-2,p=e*this.increment/100;var r=Ext.create("Ext.resizer.Resizer",{target:q,taskRecord:m,handles:l?"w":"e",minWidth:0,maxWidth:e,minHeight:1,widthIncrement:p,listeners:{resizedrag:this.partialResize,resize:this.afterResize,scope:this}});r.resizeTracker.onMouseDown(o,r[l?"west":"east"].dom);n.select("."+Ext.baseCSSPrefix+"resizable-handle, .sch-gantt-terminal, .sch-gantt-progressbar-handle").hide();if(this.useTooltip){this.tip=Ext.create("Ext.ToolTip",{autoHide:false,anchor:"b",html:"%"});this.tip.setTarget(q);this.tip.update(m.getPercentDone()+"%");this.tip.show()}return r},partialResize:function(f,d){var e=Math.round(d*100/(f.maxWidth*this.increment))*this.increment;if(this.tip){this.tip.body.update(e+"%")}},afterResize:function(l,e,n,k){var j=l.taskRecord;if(this.tip){this.tip.destroy();this.tip=null}var h=l.taskRecord.getPercentDone();if(Ext.isNumber(e)){var m=Math.round(e*100/(l.maxWidth*this.increment))*this.increment;l.taskRecord.setPercentDone(m)}if(h===l.taskRecord.getPercentDone()){this.ganttView.refreshNode(this.ganttView.indexOf(l.taskRecord))}l.destroy();this.resizable=null;this.ganttView.fireEvent("afterprogressbarresize",this.ganttView,j)},onBodyMouseUp:function(){if(this.resizable){this.afterResize(this.resizable)}},cleanUp:function(){if(this.tip){this.tip.destroy()}}});Ext.define("Gnt.feature.TaskResize",{requires:["Gnt.Tooltip"],constructor:function(d){Ext.apply(this,d);var c=this.ganttView;c.on({destroy:this.cleanUp,scope:this});c.mon(c.el,"mousedown",this.onMouseDown,this,{delegate:".sch-resizable-handle"});this.callParent(arguments)},showDuration:true,showExactResizePosition:false,useTooltip:true,tooltipConfig:null,validatorFn:Ext.emptyFn,validatorFnScope:null,taskRec:null,isStart:null,ganttView:null,resizable:null,onMouseDown:function(j,l){var e=this.ganttView,h=j.getTarget(e.eventSelector),i=e.resolveTaskRecord(h);var k=i.isResizable();if(j.button!==0||k===false||typeof k==="string"&&!h.className.match(k)){return}if(e.fireEvent("beforetaskresize",e,i,j)===false){return}j.stopEvent();this.taskRec=i;this.isStart=!!l.className.match("sch-resizable-handle-start");e.el.on({mousemove:this.onMouseMove,mouseup:this.onMouseUp,scope:this,single:true});e.fireEvent("taskresizestart",e,i)},onMouseMove:function(q,e){var r=this.ganttView,o=this.taskRec,p=r.getElementFromEventRecord(o),n=r.rtl,v=this.isStart,s=(n&&!v)||(!n&&v),t=r.getSnapPixelAmount(),u=p.getWidth(),g=p.up(r.getItemSelector()).getRegion();this.resizable=Ext.create("Ext.resizer.Resizer",{otherEdgeX:s?p.getRight():p.getLeft(),target:p,taskRecord:o,isStart:v,isWest:s,handles:s?"w":"e",constrainTo:g,minHeight:1,minWidth:t,widthIncrement:t,listeners:{resizedrag:this.partialResize,resize:this.afterResize,scope:this}});this.resizable.resizeTracker.onMouseDown(q,this.resizable[s?"west":"east"].dom);if(this.useTooltip){if(!this.tip){this.tip=Ext.create("Gnt.Tooltip",Ext.apply({mode:this.showDuration?"duration":"startend",gantt:this.ganttView},this.tooltipConfig))}this.tip.show(p,q.getX()-15);this.tip.update(o.getStartDate(),o.getEndDate(),true,o);Ext.getBody().on("mouseup",function(){this.tip.hide()},this,{single:true})}},onMouseUp:function(f,e){var d=this.ganttView;d.el.un({mousemove:this.onMouseMove,scope:this,single:true})},partialResize:function(A,B,z,v){var D=this.ganttView,F=A.isWest,w=A.taskRecord,E;if(F){E=D.getDateFromCoordinate(A.otherEdgeX-Math.min(B,this.resizable.maxWidth),!this.showExactResizePosition?"round":null)}else{E=D.getDateFromCoordinate(A.otherEdgeX+Math.min(B,this.resizable.maxWidth),!this.showExactResizePosition?"round":null)}if(!E||A.date-E===0){return}var I,J,G;if(this.showExactResizePosition){var x=D.timeAxis.roundDate(E,D.snapRelativeToEventStartDate?w.getStartDate():false);x=w.skipNonWorkingTime(x,!w.isMilestone());var e=A.target.el,H;if(F){I=w.skipNonWorkingTime(x,!w.isMilestone());G=I;H=D.timeAxisViewModel.getDistanceBetweenDates(I,w.getEndDate());e.setWidth(H);var u=D.timeAxisViewModel.getDistanceBetweenDates(E,I);e.setX(e.getX()+u)}else{var t=Gnt.util.Data.cloneModelSet([w])[0];var C=w.getTaskStore();t.setTaskStore(C);t.setCalendar(w.getCalendar());t.setEndDate(x,false,C.skipWeekendsDuringDragDrop);J=t.getEndDate();G=J;H=D.timeAxisViewModel.getDistanceBetweenDates(w.getStartDate(),J);e.setWidth(H)}}else{I=A.isStart?E:A.taskRecord.getStartDate();J=A.isStart?A.taskRecord.getEndDate():E;G=E}A.date=G;D.fireEvent("partialtaskresize",D,w,I,J,A.el,v);if(this.useTooltip){var y=this.validatorFn.call(this.validatorFnScope||this,w,I,J)!==false;this.tip.update(I,J,y,w)}},afterResize:function(h,p,t,r){if(this.useTooltip){this.tip.hide()}var q=h.taskRecord,w=q.getStartDate(),e=q.getEndDate(),y=h.isStart?h.date:w,x=h.isStart?e:h.date,s=this.ganttView;h.destroy();if(y&&x&&(y-w||x-e)&&this.validatorFn.call(this.validatorFnScope||this,q,y,x,r)!==false){var u,v=function(){u=true};s.on("itemupdate",v,null,{single:true});var z=s.taskStore.skipWeekendsDuringDragDrop;if(y-w!==0){q.setStartDate(y<=x?y:x,false,z)}else{q.setEndDate(y<=x?x:y,false,z)}s.un("itemupdate",v,null,{single:true});if(!u){s.refreshNode(s.store.indexOf(q))}}else{s.refreshKeepingScroll()}s.fireEvent("aftertaskresize",s,q)},cleanUp:function(){if(this.tip){this.tip.destroy()}}});Ext.define("Gnt.feature.WorkingTime",{extend:"Sch.plugin.Zones",requires:["Ext.data.Store","Sch.model.Range"],expandToFitView:true,calendar:null,init:function(b){if(!this.calendar){Ext.Error.raise("Required attribute 'calendar' missed during initialization of 'Gnt.feature.WorkingTime'")}this.bindCalendar(this.calendar);Ext.apply(this,{store:new Ext.data.Store({model:"Sch.model.Range"})});this.callParent(arguments);b.on("viewchange",this.onViewChange,this);this.onViewChange()},bindCalendar:function(c){var d={datachanged:this.refresh,update:this.refresh,scope:this,delay:1};if(this.calendar){this.calendar.un(d)}if(c){c.on(d)}this.calendar=c},onViewChange:function(){var b=Sch.util.Date;if(b.compareUnits(this.timeAxis.unit,b.WEEK)>0){this.setDisabled(true)}else{this.setDisabled(false);this.refresh()}},refresh:function(){var b=this.schedulerView;this.store.removeAll(true);this.store.add(this.calendar.getHolidaysRanges(b.timeAxis.getStart(),b.timeAxis.getEnd(),true))},destroy:function(){this.bindCalendar(null);this.callParent(arguments)}});Ext.define("Gnt.plugin.DependencyEditor",{extend:"Ext.form.Panel",alias:"plugin.gantt_dependencyeditor",mixins:["Ext.AbstractPlugin","Gnt.mixin.Localizable"],lockableScope:"top",header:false,requires:["Ext.util.Filter","Ext.form.field.Display","Ext.form.field.ComboBox","Ext.form.field.Number","Gnt.model.Dependency","Ext.data.ArrayStore"],hideOnBlur:true,showLag:false,border:false,height:150,width:260,frame:true,labelWidth:60,triggerEvent:"dependencydblclick",constrain:false,initComponent:function(){Ext.apply(this,{items:this.buildFields(),defaults:{width:240},floating:true,hideMode:"offsets"});this.callParent(arguments);this.addCls("sch-gantt-dependencyeditor")},init:function(b){b.on(this.triggerEvent,this.onDependencyDblClick,this);b.on("destroy",this.destroy,this);b.on("afterrender",this.onGanttRender,this,{delay:50});this.gantt=b;this.taskStore=b.getTaskStore()},onGanttRender:function(){this.render(Ext.getBody());this.collapse(Ext.Component.DIRECTION_TOP,true);this.hide();if(this.hideOnBlur){this.on({show:function(){this.mon(Ext.getBody(),{click:this.onMouseClick,scope:this})},hide:function(){this.mun(Ext.getBody(),{click:this.onMouseClick,scope:this})},delay:50})}},show:function(e,h){this.dependencyRecord=e;if(this.lagField){this.lagField.name=e.lagField}if(this.typeField){this.typeField.name=e.typeField}this.getForm().loadRecord(e);this.fromLabel.setValue(Ext.String.htmlEncode(this.dependencyRecord.getSourceTask().getName()));this.toLabel.setValue(Ext.String.htmlEncode(this.dependencyRecord.getTargetTask().getName()));if(this.typeField){var f=this.taskStore&&this.taskStore.getDependencyStore(),g=f&&f.allowedDependencyTypes;this.typeField.store.filter();this.typeField.setReadOnly(g&&g.length<2)}this.callParent([]);this.el.setXY(h);this.expand(!this.constrain);if(this.constrain){this.doConstrain(Ext.util.Region.getRegion(Ext.getBody()))}},buildFields:function(){var d=this,f=Gnt.model.Dependency;var e=[this.fromLabel=new Ext.form.DisplayField({fieldLabel:this.L("fromText")}),this.toLabel=new Ext.form.DisplayField({fieldLabel:this.L("toText")}),this.typeField=this.buildTypeField()];if(this.showLag){e.push(this.lagField=new Ext.form.NumberField({name:f.prototype.lagField,fieldLabel:this.L("lagText")}))}return e},onDependencyDblClick:function(h,f,g,e){if(f!=this.dependencyRecord){this.show(f,g.getXY())}},filterAllowedTypes:function(h){var n=this.taskStore&&this.taskStore.getDependencyStore();if(!n||!n.allowedDependencyTypes){return true}var k=n.allowedDependencyTypes;var j=n.model.Type;for(var m=0,i=k.length;m<i;m++){var l=j[k[m]];if(h.getId()==l){return true}}return false},buildTypeField:function(){var d=Gnt.model.Dependency;var f=d.Type;this.typesFilter=new Ext.util.Filter({filterFn:this.filterAllowedTypes,scope:this});var e=new Ext.data.ArrayStore({fields:[{name:"id",type:"int"},"text"],data:[[f.EndToStart,this.L("endToStartText")],[f.StartToStart,this.L("startToStartText")],[f.EndToEnd,this.L("endToEndText")],[f.StartToEnd,this.L("startToEndText")]]});e.filter(this.typesFilter);return new Ext.form.field.ComboBox({name:d.prototype.nameField,fieldLabel:this.L("typeText"),triggerAction:"all",queryMode:"local",editable:false,valueField:"id",displayField:"text",store:e})},onMouseClick:function(b){if(this.collapsed||b.within(this.getEl())||b.getTarget("."+Ext.baseCSSPrefix+"layer")||b.getTarget(".sch-ignore-click")){return}this.collapse()},afterCollapse:function(){delete this.dependencyRecord;this.hide();this.callParent(arguments);if(this.hideOnBlur){this.mun(Ext.getBody(),"click",this.onMouseClick,this)}}});Ext.define("Gnt.plugin.TaskContextMenu",{extend:"Ext.menu.Menu",alias:"plugin.gantt_taskcontextmenu",mixins:["Ext.AbstractPlugin","Gnt.mixin.Localizable"],lockableScope:"top",requires:["Gnt.model.Dependency"],legacyHolderProp:"texts",plain:true,triggerEvent:"itemcontextmenu",grid:null,rec:null,lastHighlightedItem:null,taskEditorInjected:false,createMenuItems:function(){return[{handler:this.deleteTask,requiresTask:true,itemId:"deleteTask",text:this.L("deleteTask")},{handler:this.editLeftLabel,requiresTask:true,itemId:"editLeftLabel",text:this.L("editLeftLabel")},{handler:this.editRightLabel,requiresTask:true,itemId:"editRightLabel",text:this.L("editRightLabel")},{handler:this.toggleMilestone,requiresTask:true,itemId:"toggleMilestone",text:this.L("convertToMilestone")},{text:this.L("add"),itemId:"addTaskMenu",menu:{plain:true,defaults:{scope:this},items:[{handler:this.addTaskAboveAction,requiresTask:true,itemId:"addTaskAbove",text:this.L("addTaskAbove")},{handler:this.addTaskBelowAction,itemId:"addTaskBelow",text:this.L("addTaskBelow")},{handler:this.addMilestone,itemId:"addMilestone",requiresTask:true,text:this.L("addMilestone")},{handler:this.addSubtask,requiresTask:true,itemId:"addSubtask",text:this.L("addSubtask")},{handler:this.addSuccessor,requiresTask:true,itemId:"addSuccessor",text:this.L("addSuccessor")},{handler:this.addPredecessor,requiresTask:true,itemId:"addPredecessor",text:this.L("addPredecessor")}]}},{text:this.L("deleteDependency"),requiresTask:true,itemId:"deleteDependencyMenu",isDependenciesMenu:true,menu:{plain:true,listeners:{beforeshow:this.populateDependencyMenu,mouseover:this.onDependencyMouseOver,mouseleave:this.onDependencyMouseOut,scope:this}}}]},buildMenuItems:function(){this.items=this.createMenuItems()},initComponent:function(){this.defaults=this.defaults||{};this.defaults.scope=this;this.buildMenuItems();this.callParent(arguments)},init:function(d){d.on("destroy",this.cleanUp,this);var e=d.getSchedulingView(),f=d.lockedGrid.getView();if(this.triggerEvent==="itemcontextmenu"){f.on("itemcontextmenu",this.onItemContextMenu,this);e.on("itemcontextmenu",this.onItemContextMenu,this)}e.on("taskcontextmenu",this.onTaskContextMenu,this);e.on("containercontextmenu",this.onContainerContextMenu,this);f.on("containercontextmenu",this.onContainerContextMenu,this);this.grid=d},populateDependencyMenu:function(i){var k=this.grid,g=k.getTaskStore(),j=this.rec.getAllDependencies(),h=k.dependencyStore;i.removeAll();if(j.length===0){return false}var l=this.rec.getId()||this.rec.internalId;Ext.each(j,function(a){var b=a.getSourceId(),c=g.getById(b==l?a.getTargetId():b);if(c){i.add({depId:a.internalId,text:Ext.util.Format.ellipsis(Ext.String.htmlEncode(c.getName()),30),scope:this,handler:function(d){var e;h.each(function(f){if(f.internalId==d.depId){e=f;return false}});h.remove(e)}})}},this)},onDependencyMouseOver:function(g,f,e){if(f){var h=this.grid.getSchedulingView();if(this.lastHighlightedItem){h.unhighlightDependency(this.lastHighlightedItem.depId)}this.lastHighlightedItem=f;h.highlightDependency(f.depId)}},onDependencyMouseOut:function(c,d){if(this.lastHighlightedItem){this.grid.getSchedulingView().unhighlightDependency(this.lastHighlightedItem.depId)}},cleanUp:function(){this.destroy()},onTaskContextMenu:function(d,e,f){this.activateMenu(e,f)},onItemContextMenu:function(e,g,i,j,h){this.activateMenu(g,h)},onContainerContextMenu:function(d,c){this.activateMenu(null,c)},activateMenu:function(c,d){if(this.grid.isReadOnly()||this.grid.taskStore.getRootNode()===c){return}d.stopEvent();this.rec=c;this.configureMenuItems();this.showAt(d.getXY())},configureMenuItems:function(){if(this.grid.taskEditor&&!this.taskEditorInjected){this.insert(0,{text:this.L("taskInformation"),requiresTask:true,handler:function(){this.grid.taskEditor.showTask(this.rec)},scope:this});this.taskEditorInjected=true}var e=this.query("[requiresTask]");var h=this.rec;Ext.each(e,function(a){a.setDisabled(!h)});var f=this.query("[isDependenciesMenu]")[0];if(h&&f){f.setDisabled(!h.getAllDependencies().length)}var g=this.down("#toggleMilestone");if(h&&g){g.setText(h.isMilestone()?this.L("convertToRegular"):this.L("convertToMilestone"))}},copyTask:function(f){var d=this.grid.getTaskStore().model;var e=new d({leaf:true});e.setPercentDone(0);e.setName(this.L("newTaskText",this.texts));e.set(e.startDateField,(f&&f.getStartDate())||null);e.set(e.endDateField,(f&&f.getEndDate())||null);e.set(e.durationField,(f&&f.getDuration())||null);e.set(e.durationUnitField,(f&&f.getDurationUnit())||"d");return e},addTaskAbove:function(d){var c=this.rec;if(c){c.addTaskAbove(d)}else{this.grid.taskStore.getRootNode().appendChild(d)}},addTaskBelow:function(d){var c=this.rec;if(c){c.addTaskBelow(d)}else{this.grid.taskStore.getRootNode().appendChild(d)}},deleteTask:function(){var b=this.grid.getSelectionModel().selected;this.grid.taskStore.remove(b.getRange())},editLeftLabel:function(){this.grid.getSchedulingView().editLeftLabel(this.rec)},editRightLabel:function(){this.grid.getSchedulingView().editRightLabel(this.rec)},addTaskAboveAction:function(){this.addTaskAbove(this.copyTask(this.rec))},addTaskBelowAction:function(){this.addTaskBelow(this.copyTask(this.rec))},addSubtask:function(){var b=this.rec;b.addSubtask(this.copyTask(b))},addSuccessor:function(){var b=this.rec;b.addSuccessor(this.copyTask(b))},addPredecessor:function(){var b=this.rec;b.addPredecessor(this.copyTask(b))},addMilestone:function(){var c=this.rec,d=this.copyTask(c);c.addTaskBelow(d);d.setStartEndDate(c.getEndDate(),c.getEndDate())},toggleMilestone:function(){if(this.rec.isMilestone()){this.rec.convertToRegular()}else{this.rec.convertToMilestone()}}});Ext.define("Gnt.plugin.Export",{extend:"Sch.plugin.Export",alias:"plugin.gantt_export",alternateClassName:"Gnt.plugin.PdfExport",showExportDialog:function(){this.exportDialogConfig.scrollerDisabled=true;this.callParent(arguments)},getExportJsonHtml:function(n,k){var p=this.scheduler.getSchedulingView(),o=p.dependencyView,j=o.painter.getDependencyTplData(p.dependencyStore.getRange()),m=o.lineTpl.apply(j),i=k.config,l;if(!i.singlePageExport){l={dependencies:m,rowsAmount:n.rowsAmount,columnsAmountNormal:n.columnsAmountNormal,columnsAmountLocked:n.columnsAmountLocked,timeColumnWidth:n.timeColumnWidth,lockedGridWidth:n.lockedGridWidth,rowHeight:n.rowHeight}}else{n={};l={dependencies:m,singlePageExport:true}}l.lockedColumnPages=n.lockedColumnPages;n.panelHTML=l;return this.callParent(arguments)},getRealSize:function(){var b=this.callParent(arguments);b.width+=this.scheduler.down("splitter").getWidth();return b},resizePanelHTML:function(p){var k=this.callParent(arguments),n=k.select(".sch-dependencyview-ct").first(),l=k.select("."+Ext.baseCSSPrefix+"splitter").first(),q=0,m=0,r,o;q=p.skippedColsBefore*p.timeColumnWidth;if(!p.singlePageExport){m=p.k*p.rowsAmount*p.rowHeight;r=p.lockedColumnPages?p.lockedColumnPages.length:0;o=p.i;if(r){if(o>=r-1){var i=o-r+1;q+=(i===r-1)?p.timeColumnWidth*p.columnsAmountLocked:p.timeColumnWidth*p.columnsAmountLocked+(i-1)*p.timeColumnWidth*p.columnsAmountNormal}else{l&&l.hide()}}else{if(o){q+=(o-1)*p.timeColumnWidth*p.columnsAmountNormal+p.timeColumnWidth*p.columnsAmountLocked}}}n.dom.innerHTML=p.dependencies;n.applyStyles({top:-m+"px",left:-q+"px"});l&&l.setHeight("100%");return k}});Ext.define("Gnt.plugin.Printable",{extend:"Sch.plugin.Printable",alias:"plugin.gantt_printable",getGridContent:function(z){var v=z.getSchedulingView();v._print=true;var D=this.callParent(arguments),w=v.dependencyView,s=w.painter.getDependencyTplData(v.dependencyStore.getRange()),A='<div class="'+w.containerEl.dom.className+'">'+w.lineTpl.apply(s)+"</div>",t=D.normalRows;if(Ext.select(".sch-gantt-critical-chain").first()){var C=Ext.DomHelper.createDom({tag:"div",html:A});C=Ext.get(C);var l=Ext.DomHelper.createDom({tag:"div",html:t});l=Ext.get(l);var i=v.getCriticalPaths(),B=v.dependencyStore,r,x,y,u;Ext.each(i,function(a){for(x=0,y=a.length;x<y;x++){r=a[x];this.highlightTask(r,z,l);if(x<(y-1)){u=B.getAt(B.findBy(function(b){return b.getTargetId()===(r.getId()||r.internalId)&&b.getSourceId()===(a[x+1].getId()||a[x+1].internalId)}));this.highlightDependency(u,C,w)}}},this);t=l.getHTML();A=C.getHTML()}D.normalRows=A+t;delete v._print;return D},highlightTask:function(f,g,h){var i=g.getSchedulingView().getElementFromEventRecord(f),j=i.id;if(i){h.select("#"+j).first().parent("tr").addCls("sch-gantt-task-highlighted")}},highlightDependency:function(h,e,f){var g=h instanceof Ext.data.Model?h.internalId:h;return e.select(".sch-dep-"+g).addCls(f.selectedCls)}});Ext.define("Gnt.view.DependencyPainter",{ganttView:null,rowHeight:null,topArrowOffset:8,arrowOffset:8,lineWidth:2,xOffset:6,constructor:function(b){b=b||{};Ext.apply(this,b)},setRowHeight:function(b){this.rowHeight=b},getTaskBox:function(B){var L=Sch.util.Date,J=B.getStartDate(),C=B.getEndDate(),F=this.ganttView,G=F.bufferedRenderer,O=F.timeAxis.getStart(),Q=F.timeAxis.getEnd();if(!B.isVisible()||!J||!C||!L.intersectSpans(J,C,O,Q)){return null}if(F.store.indexOf(B)<0){var H=F.taskStore;if(!G){return null}if(H.isTreeFiltered()&&!H.lastTreeFilter.filter.call(H.lastTreeFilter.scope||H,B)){return null}}var N,R=F.getXFromDate(L.max(J,O)),S=F.getXFromDate(L.min(C,Q)),T=F.getNodeByRecord(B);if(T||G){var y=F.getXOffset(B),E,K,x=B.isMilestone(),z=true;if(R>y){R-=y}S+=y;if(!x&&Ext.isIE){if((Ext.isIE6||Ext.isIE7||Ext.isIE8)&&Ext.isIEQuirks){S+=1;R-=2}}var M=F.el;var I=M.getScroll().top;if(T){var A=F.getEventNodeByRecord(B);if(!A){return null}N=Ext.fly(A).getOffsetsTo(M);E=N[1]+I+(x&&Ext.isIE8?3:0);K=E+Ext.fly(A).getHeight();if(x){S+=1}}else{var D=F.all.elements;var P=F.store.getAt(F.all.startIndex);if(B.isAbove(P)){T=D[F.all.startIndex];N=Ext.fly(T).getOffsetsTo(M);N[1]-=F.getRowHeight()}else{T=D[F.all.endIndex];N=Ext.fly(T).getOffsetsTo(M);N[1]+=F.getRowHeight()}E=N[1]+I;K=E+this.rowHeight;z=false}return{top:E,end:S,bottom:K,start:R,rendered:z}}},getRenderData:function(l){var m=l.getSourceTask(),o=l.getTargetTask();if(!m||m.stores.length===0||!o||o.stores.length===0){return null}var j=this.getTaskBox(m);var n=this.getTaskBox(o);var p=this.ganttView;if(p.bufferRender&&j&&!j.rendered&&n&&!n.rendered){var k=p.store.getAt(p.all.startIndex);var i=p.store.getAt(p.all.endIndex);if((m.isAbove(k)&&o.isAbove(k))||(i.isAbove(m)&&i.isAbove(o))){return null}}return{fromBox:j,toBox:n}},getDependencyTplData:function(i){var r=this,p=r.ganttView;if(i instanceof Ext.data.Model){i=[i]}if(i.length===0||p.store.getCount()===0){return}var z=[],l,s,u,q,t,y;for(var v=0,x=i.length;v<x;v++){y=i[v];var w=this.getRenderData(y);if(w){q=w.fromBox;t=w.toBox;if(q&&t){l=r.getLineCoordinates(q,t,y);if(l){z.push({dependency:y,id:y.internalId,cls:y.getCls(),lineCoordinates:l})}}}}return z},getLineCoordinates:function(w,y,D){var G,v,x=[0,w.top-1+((w.bottom-w.top)/2)],L=[0,y.top-1+((y.bottom-y.top)/2)],K=L[1]>x[1],F=Gnt.model.Dependency.Type,I=this.arrowOffset+this.xOffset,J=D.getType(),A=[],u=D.getTargetTask().isMilestone(),C,E,i;switch(J){case F.StartToEnd:x[0]=w.start;L[0]=y.end+I;G="l";v="r";break;case F.StartToStart:x[0]=w.start;L[0]=y.start-I;G="l";v="l";break;case F.EndToStart:x[0]=w.end;L[0]=y.start-I;G="r";v="l";break;case F.EndToEnd:x[0]=w.end;L[0]=y.end+I;G="r";v="r";break;default:throw"Invalid dependency type: "+D.getType()}A.push(x);var z=x[0]+(G==="r"?this.xOffset:-this.xOffset);if(K&&J===F.EndToStart&&w.end<(y.start+5)){C=Math.min(y.start,y.end)+this.xOffset;A.push([C,x[1]]);A.push([C,y.top-this.arrowOffset-(u?2:0)])}else{if(G!==v&&((G==="r"&&z>L[0])||(G==="l"&&z<L[0]))){E=y[v==="l"?"start":"end"];i=L[1]+(K?-1:1)*(this.rowHeight/2);A.push([z,x[1]]);A.push([z,i]);A.push([L[0],i]);A.push(L);A.push([E+(L[0]<E?-this.arrowOffset:this.arrowOffset)-(u&&v==="l"?2:0),L[1]])}else{E=y[v==="l"?"start":"end"];if(G==="r"){C=Math.max(z,L[0])}else{C=Math.min(z,L[0])}A.push([C,x[1]]);A.push([C,L[1]]);A.push([E+(C<E?-this.arrowOffset:this.arrowOffset)-(u&&v==="l"?2:0),L[1]])}}var H=[];for(var B=0;B<A.length-1;B++){H.push({x1:A[B][0],y1:A[B][1],x2:A[B+1][0],y2:A[B+1][1]})}return H}});Ext.define("Gnt.view.Dependency",{extend:"Ext.util.Observable",requires:["Gnt.feature.DependencyDragDrop","Gnt.view.DependencyPainter"],lineWidth:1,dragZoneConfig:null,dropZoneConfig:null,dependencyPainterClass:"Gnt.view.DependencyPainter",containerEl:null,ganttView:null,painter:null,taskStore:null,store:null,dnd:null,lineTpl:null,renderTimer:null,enableDependencyDragDrop:true,renderAllDepsBuffered:false,dependencyCls:"sch-dependency",selectedCls:"sch-dependency-selected",constructor:function(f){this.callParent(arguments);var h=this.ganttView;h.on({refresh:this.renderAllDependenciesBuffered,bufferedrefresh:this.renderAllDependenciesBuffered,itemupdate:this.onTaskUpdated,scope:this});this.bindTaskStore(h.getTaskStore());this.bindDependencyStore(f.store);if(!this.lineTpl){var g=this.rtl;var e=g?"right":"left";this.lineTpl=Ext.create("Ext.XTemplate",'<tpl for=".">'+Ext.String.format('<tpl for="lineCoordinates"><div class="{0} {[ parent.dependency.isHighlighted ? "{1}" : "" ]} {[values.x1==values.x2 ? "sch-dependency-line-v" : "sch-dependency-line-h"]} {lineCls} sch-dep-{parent.id} {0}-line {[this.getSuffixedCls(parent.cls, "-line")]}" style="'+e+":{[Math.min(values.x1, values.x2)]}px;top:{[Math.min(values.y1, values.y2)]}px;width:{[Math.abs(values.x1-values.x2)+"+this.lineWidth+"]}px;height:{[Math.abs(values.y1-values.y2)+"+this.lineWidth+']}px"></div></tpl><div style="'+e+':{[values.lineCoordinates[values.lineCoordinates.length - 1].x2]}px;top:{[values.lineCoordinates[values.lineCoordinates.length - 1].y2]}px"    class="{0}-arrow-ct {0} {[ values.dependency.isHighlighted ? "{1}" : "" ]} sch-dep-{id} {[this.getSuffixedCls(values.cls, "-arrow-ct")]}"><img src="'+Ext.BLANK_IMAGE_URL+'" class="{0}-arrow {0}-arrow-{[this.getArrowDirection(values.lineCoordinates)]} {[this.getSuffixedCls(values.cls, "-arrow")]}" /></div>',this.dependencyCls,this.selectedCls)+"</tpl>",{compiled:true,disableFormats:true,getArrowDirection:function(a){var b=a[a.length-1];if(b.y2<b.y1){return"up"}if(b.x1===b.x2){return"down"}else{if((!g&&b.x1>b.x2)||(g&&b.x1<b.x2)){return"left"}else{return"right"}}},getSuffixedCls:function(b,a){if(b&&b.indexOf(" ")!=-1){return b.replace(/^\s*(.*)\s*$/,"$1").split(/\s+/).join(a+" ")+a}else{return b+a}}})}this.painter=Ext.create(this.dependencyPainterClass,Ext.apply({rowHeight:h.getRowHeight(),ganttView:h},f));this.addEvents("beforednd","dndstart","drop","afterdnd","dependencyclick","dependencycontextmenu","dependencydblclick","refresh");if(this.enableDependencyDragDrop){this.dnd=Ext.create("Gnt.feature.DependencyDragDrop",{el:h.getEl(),rtl:h.rtl,ganttView:h,dragZoneConfig:this.dragZoneConfig,dropZoneConfig:this.dropZoneConfig,dependencyStore:this.store});this.dnd.on("drop",this.onDependencyDrop,this);this.relayEvents(this.dnd,["beforednd","dndstart","afterdnd","drop"])}this.containerEl=this.containerEl.createChild({cls:"sch-dependencyview-ct "+(this.lineWidth===1?" sch-dependencyview-thin ":"")});this.ganttView.mon(this.containerEl,{dblclick:this.onDependencyClick,click:this.onDependencyClick,contextmenu:this.onDependencyClick,scope:this,delegate:"."+this.dependencyCls});if(h.rendered){this.renderAllDependenciesBuffered()}},bindDependencyStore:function(b){this.depStoreListeners={refresh:this.renderAllDependenciesBuffered,clear:this.renderAllDependenciesBuffered,load:this.renderAllDependenciesBuffered,add:this.onDependencyAdd,update:this.onDependencyUpdate,remove:this.onDependencyDelete,scope:this};b.on(this.depStoreListeners);this.store=b},unBindDependencyStore:function(){if(this.depStoreListeners){this.store.un(this.depStoreListeners)}},bindTaskStore:function(d){var c=this.ganttView;this.taskStoreListeners={cascade:this.onTaskStoreCascade,beforefill:this.onRootFillStart,remove:this.renderAllDependenciesBuffered,insert:this.renderAllDependenciesBuffered,append:this.renderAllDependenciesBuffered,move:this.renderAllDependenciesBuffered,sort:this.renderAllDependenciesBuffered,scope:this};Ext.apply(this.taskStoreListeners,{expand:this.renderAllDependenciesBuffered,collapse:this.renderAllDependenciesBuffered});d.on(this.taskStoreListeners);this.taskStore=d},onTaskStoreCascade:function(d,c){if(c&&c.nbrAffected>0){this.renderAllDependenciesBuffered()}},unBindTaskStore:function(b){b=b||this.taskStore;if(!b){return}if(this.ganttViewListeners){this.ganttView.un(this.ganttViewListeners)}b.un(this.taskStoreListeners)},onRootFillStart:function(){var b=this.taskStore;this.unBindTaskStore(b);this.mon(this.taskStore,"fillcomplete",function(){this.bindTaskStore(b)},this,{single:true})},onDependencyClick:function(d,e){var f=this.getRecordForDependencyEl(e);this.fireEvent("dependency"+d.type,this,f,d,e)},highlightDependency:function(b){if(!(b instanceof Ext.data.Model)){b=this.getDependencyRecordByInternalId(b)}if(b){b.isHighlighted=true;this.getElementsForDependency(b).addCls(this.selectedCls)}},unhighlightDependency:function(b){if(!(b instanceof Ext.data.Model)){b=this.getDependencyRecordByInternalId(b)}if(b){b.isHighlighted=false;this.getElementsForDependency(b).removeCls(this.selectedCls)}},getElementsForDependency:function(d){var c=d instanceof Ext.data.Model?d.internalId:d;return this.containerEl.select(".sch-dep-"+c)},depRe:new RegExp("sch-dep-([^\\s]+)"),getDependencyRecordByInternalId:function(g){var h,e,f;for(e=0,f=this.store.getCount();e<f;e++){h=this.store.getAt(e);if(h.internalId==g){return h}}return null},getRecordForDependencyEl:function(h){var f=h.className.match(this.depRe),g=null;if(f&&f[1]){var e=f[1];g=this.getDependencyRecordByInternalId(e)}return g},renderAllDependenciesBuffered:function(){var c=this;var d=this.ganttView.up("{isHidden()}");if(d){clearTimeout(c.renderTimer);c.renderTimer=null;d.on("show",this.renderAllDependenciesBuffered,this,{single:true});return}if(c.renderTimer){return}this.containerEl.update("");this.renderTimer=setTimeout(function(){c.renderTimer=null;if(!c.ganttView.isDestroyed){c.renderAllDependencies()}},0)},renderAllDependencies:function(){if(!this.containerEl.dom){return}this.containerEl.update("");this.renderDependencies(this.store.data.items);this.fireEvent("refresh",this)},getDependencyElements:function(){return this.containerEl.select("."+this.dependencyCls)},renderDependencies:function(c){if(c){var d=this.painter.getDependencyTplData(c);this.lineTpl[Ext.isIE?"insertFirst":"append"](this.containerEl,d)}},renderTaskDependencies:function(g){var h=[];if(g instanceof Ext.data.Model){g=[g]}for(var f=0,e=g.length;f<e;f++){h=h.concat(g[f].getAllDependencies())}this.renderDependencies(h)},onDependencyUpdate:function(c,d){this.removeDependencyElements(d,false);this.renderDependencies(d)},onDependencyAdd:function(d,c){this.renderDependencies(c)},removeDependencyElements:function(d,c){if(c!==false){this.getElementsForDependency(d).fadeOut({remove:true})}else{this.getElementsForDependency(d).remove()}},onDependencyDelete:function(c,d){this.removeDependencyElements(d)},dimEventDependencies:function(b){this.containerEl.select(this.depRe+b).setOpacity(0.2)},clearSelectedDependencies:function(){this.containerEl.select("."+this.selectedCls).removeCls(this.selectedCls);this.store.each(function(b){b.isHighlighted=false})},onTaskUpdated:function(b){if(!this.taskStore.cascading&&(!b.previous||b.startDateField in b.previous||b.endDateField in b.previous)){this.updateDependencies(b)}},updateDependencies:function(c){if(c instanceof Ext.data.Model){c=[c]}var d=this;Ext.each(c,function(a){Ext.each(a.getAllDependencies(),function(b){d.removeDependencyElements(b,false)})});this.renderTaskDependencies(c)},onNewDependencyCreated:function(){},onDependencyDrop:function(i,k,g,j){var l=this.store;var h=new l.model();h.setSourceId(k);h.setTargetId(g);h.setType(j);if(l.isValidDependency(h)&&this.onNewDependencyCreated(h)!==false){l.add(h)}},destroy:function(){if(this.dnd){this.dnd.destroy()}this.unBindTaskStore();this.unBindDependencyStore()},setRowHeight:function(d,c){this.rowHeight=d;this.painter.setRowHeight(d);if(!c){this.renderAllDependencies()}}});Ext.define("Gnt.view.Gantt",{extend:"Sch.view.TimelineGridView",alias:["widget.ganttview"],requires:["Ext.dd.ScrollManager","Gnt.view.Dependency","Gnt.model.Task","Gnt.template.Task","Gnt.template.ParentTask","Gnt.template.Milestone","Gnt.feature.TaskDragDrop","Gnt.feature.ProgressBarResize","Gnt.feature.TaskResize","Sch.view.Horizontal"],uses:["Gnt.feature.LabelEditor","Gnt.feature.DragCreator"],mixins:["Sch.mixin.FilterableTreeView"],_cmpCls:"sch-ganttview",barMargin:4,scheduledEventName:"task",trackOver:false,toggleOnDblClick:false,parentTaskOffset:6,eventSelector:".sch-gantt-item",eventWrapSelector:".sch-event-wrap",progressBarResizer:null,taskResizer:null,taskDragDrop:null,dragCreator:null,dependencyView:null,resizeConfig:null,createConfig:null,dragDropConfig:null,progressBarResizeConfig:null,dependencyViewConfig:null,externalGetRowClass:null,constructor:function(b){b=b||{};if(b){this.externalGetRowClass=b.getRowClass;delete b.getRowClass}this.addEvents("taskclick","taskdblclick","taskcontextmenu","beforetaskresize","taskresizestart","partialtaskresize","aftertaskresize","beforeprogressbarresize","progressbarresizestart","afterprogressbarresize","beforetaskdrag","taskdragstart","beforetaskdropfinalize","taskdrop","aftertaskdrop","labeledit_beforestartedit","labeledit_beforecomplete","labeledit_complete","beforedependencydrag","dependencydragstart","dependencydrop","afterdependencydragdrop","beforedragcreate","dragcreatestart","dragcreateend","afterdragcreate","scheduleclick","scheduledblclick","schedulecontextmenu");this.callParent(arguments);this.initTreeFiltering();this.addCls("sch-ganttview")},onRender:function(){this.configureLabels();this.setupGanttEvents();this.setupTemplates();this.callParent(arguments)},getDependencyStore:function(){return this.dependencyStore},configureFeatures:function(){if(this.enableProgressBarResize!==false){this.progressBarResizer=Ext.create("Gnt.feature.ProgressBarResize",Ext.apply({ganttView:this},this.progressBarResizeConfig||{}));this.on({beforeprogressbarresize:this.onBeforeTaskProgressBarResize,progressbarresizestart:this.onTaskProgressBarResizeStart,afterprogressbarresize:this.onTaskProgressBarResizeEnd,scope:this})}if(this.resizeHandles!=="none"){this.taskResizer=Ext.create("Gnt.feature.TaskResize",Ext.apply({ganttView:this,validatorFn:this.resizeValidatorFn||Ext.emptyFn,validatorFnScope:this},this.resizeConfig||{}));this.on({beforedragcreate:this.onBeforeDragCreate,beforetaskresize:this.onBeforeTaskResize,taskresizestart:this.onTaskResizeStart,aftertaskresize:this.onTaskResizeEnd,scope:this})}if(this.enableTaskDragDrop){this.taskDragDrop=Ext.create("Gnt.feature.TaskDragDrop",this.ownerCt.el,Ext.apply({gantt:this,validatorFn:this.dndValidatorFn||Ext.emptyFn,validatorFnScope:this},this.dragDropConfig));this.on({beforetaskdrag:this.onBeforeTaskDrag,taskdragstart:this.onDragDropStart,aftertaskdrop:this.onDragDropEnd,scope:this})}if(this.enableDragCreation){this.dragCreator=Ext.create("Gnt.feature.DragCreator",Ext.apply({ganttView:this,validatorFn:this.createValidatorFn||Ext.emptyFn,validatorFnScope:this},this.createConfig))}},getTemplateForTask:function(c,d){if(c.isMilestone(d)){return this.milestoneTemplate}if(c.isLeaf()){return this.eventTemplate}return this.parentEventTemplate},columnRenderer:function(D,T,ag){var af=ag.getStartDate(),ac=this.timeAxis,R=Sch.util.Date,aq={},Q="",Y="",ak=ac.getStart(),al=ac.getEnd(),K=ag.isMilestone(),X=ag.isLeaf(),aa,W,L;if(af){var ab=ag.getEndDate()||Sch.util.Date.add(af,ag.getDurationUnit()||Sch.util.Date.DAY,1),an=Sch.util.Date.intersectSpans(af,ab,ak,al);if(an){L=ab>al;W=R.betweenLesser(af,ak,al);var S=Math.floor(this.getXFromDate(W?af:ak)),ao=Math.floor(this.getXFromDate(L?al:ab)),am=K?0:ao-S,P=this.leftLabelField,ah=this.rightLabelField,N=this.topLabelField,ai=this.bottomLabelField,M=this.getTemplateForTask(ag);if(!K&&!X){if(L){am+=this.parentTaskOffset}else{am+=2*this.parentTaskOffset}}aq=Ext.apply({},{id:ag.internalId,offset:K?(ao||S)-this.getXOffset(ag):S,width:Math.max(1,am),ctcls:"",cls:"",print:this._print,record:ag,percentDone:Math.min(ag.getPercentDone()||0,100)},ag.data);aa=this.eventRenderer.call(this.eventRendererScope||this,ag,aq,ag.store)||{};if(P){aq.leftLabel=Ext.util.Format.htmlEncode(P.renderer.call(P.scope||this,ag.data[P.dataIndex],ag))}if(ah){aq.rightLabel=Ext.util.Format.htmlEncode(ah.renderer.call(ah.scope||this,ag.data[ah.dataIndex],ag))}if(N){aq.topLabel=Ext.util.Format.htmlEncode(N.renderer.call(N.scope||this,ag.data[N.dataIndex],ag))}if(ai){aq.bottomLabel=Ext.util.Format.htmlEncode(ai.renderer.call(ai.scope||this,ag.data[ai.dataIndex],ag))}Ext.apply(aq,aa);var aj=" sch-event-resizable-"+ag.getResizable();if(K){aq.side=Math.round((this.enableBaseline?0.4:0.5)*this.getRowHeight());Y+=" sch-gantt-milestone"}else{aq.width=Math.max(1,am);if(L){Y+=" sch-event-endsoutside "}if(!W){Y+=" sch-event-startsoutside "}if(X){Y+=" sch-gantt-task"}else{Y+=" sch-gantt-parent-task"}}if(ag.dirty){aj+=" sch-dirty "}if(ag.isDraggable()===false){aj+=" sch-event-fixed "}aq.cls=(aq.cls||"")+(ag.getCls()||"")+aj;aq.ctcls+=" "+Y;Q+=M.apply(aq)}}if(this.enableBaseline){var V=ag.getBaselineStartDate(),ar=ag.getBaselineEndDate();if(!aa){aa=this.eventRenderer.call(this,ag,aq,ag.store)||{}}if(V&&ar&&Sch.util.Date.intersectSpans(V,ar,ak,al)){L=ar>al;W=R.betweenLesser(V,ak,al);var ap=ag.isBaselineMilestone(),ad=Math.floor(this.getXFromDate(W?V:ak)),ae=Math.floor(this.getXFromDate(L?al:ar)),U=ap?0:ae-ad,Z=this.getTemplateForTask(ag,true),O={progressBarStyle:aa.baseProgressBarStyle||"",id:ag.internalId+"-base",percentDone:ag.getBaselinePercentDone(),offset:ap?(ae||ad)-this.getXOffset(ag,true):ad,print:this._print,width:Math.max(1,U),baseline:true};Y="";if(ap){O.side=Math.round(0.4*this.getRowHeight());Y="sch-gantt-milestone-baseline sch-gantt-baseline-item"}else{if(ag.isLeaf()){Y="sch-gantt-task-baseline sch-gantt-baseline-item"}else{Y="sch-gantt-parenttask-baseline sch-gantt-baseline-item"}}if(L){Y+=" sch-event-endsoutside "}if(!W){Y+=" sch-event-startsoutside "}O.ctcls=Y+" "+(aa.basecls||"");Q+=Z.apply(O)}}return Q},setupTemplates:function(){var d={leftLabel:this.leftLabelField,rightLabel:this.rightLabelField,topLabel:this.topLabelField,bottomLabel:this.bottomLabelField,prefix:this.eventPrefix,resizeHandles:this.resizeHandles,enableDependencyDragDrop:this.enableDependencyDragDrop!==false,enableProgressBarResize:this.enableProgressBarResize,rtl:this.rtl};var c;if(!this.eventTemplate){c=this.taskBodyTemplate?Ext.apply({innerTpl:this.taskBodyTemplate},d):d;this.eventTemplate=Ext.create("Gnt.template.Task",c)}if(!this.parentEventTemplate){c=this.parentTaskBodyTemplate?Ext.apply({innerTpl:this.parentTaskBodyTemplate},d):d;this.parentEventTemplate=Ext.create("Gnt.template.ParentTask",c)}if(!this.milestoneTemplate){c=this.milestoneBodyTemplate?Ext.apply({innerTpl:this.milestoneBodyTemplate},d):d;this.milestoneTemplate=Ext.create("Gnt.template.Milestone",c)}},getDependencyView:function(){return this.dependencyView},getTaskStore:function(){return this.taskStore},initDependencies:function(){if(this.dependencyStore){var c=this,d=Ext.create("Gnt.view.Dependency",Ext.apply({containerEl:c.el,ganttView:c,enableDependencyDragDrop:c.enableDependencyDragDrop,store:c.dependencyStore,rtl:c.rtl},this.dependencyViewConfig));d.on({beforednd:c.onBeforeDependencyDrag,dndstart:c.onDependencyDragStart,drop:c.onDependencyDrop,afterdnd:c.onAfterDependencyDragDrop,scope:c});c.dependencyView=d;c.relayEvents(d,["dependencyclick","dependencycontextmenu","dependencydblclick"])}},updateBufferedView:function(){this.bufferedRenderer.scrollTo(this.bufferedRenderer.getFirstVisibleRowIndex())},setupGanttEvents:function(){var c=this.getSelectionModel();var d=this.taskStore;if(this.toggleParentTasksOnClick){this.on({taskclick:function(b,a){if(!a.isLeaf()&&(!d.isTreeFiltered()||d.allowExpandCollapseWhileFiltered)){a.isExpanded()?a.collapse():a.expand()}}})}if(this.bufferedRenderer){this.getStore().on({collapse:this.updateBufferedView,expand:this.updateBufferedView,scope:this})}},configureLabels:function(){var b={renderer:function(a){return a},dataIndex:undefined};Ext.Array.forEach(["left","right","top","bottom"],function(d){var a=this[d+"LabelField"];if(a){if(Ext.isString(a)){a=this[d+"LabelField"]={dataIndex:a}}Ext.applyIf(a,b);if(a.editor){a.editor=Ext.create("Gnt.feature.LabelEditor",this,{labelPosition:d,field:a.editor,dataIndex:a.dataIndex})}}},this);this.on("labeledit_beforestartedit",this.onBeforeLabelEdit,this)},onBeforeTaskDrag:function(c,d){return !this.readOnly&&d.isDraggable()!==false&&(this.allowParentTaskMove||d.isLeaf())},onDragDropStart:function(){if(this.tip){this.tip.disable()}},onDragDropEnd:function(){if(this.tip){this.tip.enable()}},onTaskProgressBarResizeStart:function(){if(this.tip){this.tip.hide();this.tip.disable()}},onTaskProgressBarResizeEnd:function(){if(this.tip){this.tip.enable()}},onTaskResizeStart:function(){if(this.tip){this.tip.hide();this.tip.disable()}},onTaskResizeEnd:function(){if(this.tip){this.tip.enable()}},onBeforeDragCreate:function(){return !this.readOnly},onBeforeTaskResize:function(d,c){return !this.readOnly&&c.getSchedulingMode()!=="EffortDriven"},onBeforeTaskProgressBarResize:function(){return !this.readOnly},onBeforeLabelEdit:function(){return !this.readOnly},onBeforeEdit:function(){return !this.readOnly},afterRender:function(){this.initDependencies();this.callParent(arguments);this.el.on("mousemove",this.configureFeatures,this,{single:true});Ext.dd.ScrollManager.register(this.el)},resolveTaskRecord:function(d){var c=this.findItemByChild(d);if(c){return this.getRecord(this.findItemByChild(d))}return null},resolveEventRecord:function(b){return this.resolveTaskRecord(b)},highlightTask:function(l,g){if(!(l instanceof Ext.data.Model)){l=this.taskStore.getById(l)}if(l){l.isHighlighted=true;var j=this.getNode(l);if(j){Ext.fly(j).addCls("sch-gantt-task-highlighted")}if(g!==false){for(var k=0,h=l.successors.length;k<h;k++){var i=l.successors[k];this.highlightDependency(i);this.highlightTask(i.getTargetTask(),g)}}}},unhighlightTask:function(f,h){if(!(f instanceof Ext.data.Model)){f=this.taskStore.getById(f)}if(f){f.isHighlighted=false;Ext.fly(this.getNode(f)).removeCls("sch-gantt-task-highlighted");if(h!==false){for(var j=0,g=f.successors.length;j<g;j++){var i=f.successors[j];this.unhighlightDependency(i);this.unhighlightTask(i.getTargetTask(),h)}}}},getRowClass:function(c){var d="";if(c.isHighlighted){d="sch-gantt-task-highlighted"}if(this.externalGetRowClass){d+=" "+(this.externalGetRowClass.apply(this,arguments)||"")}return d},clearSelectedTasksAndDependencies:function(){this.getDependencyView().clearSelectedDependencies();this.el.select("tr.sch-gantt-task-highlighted").removeCls("sch-gantt-task-highlighted");this.taskStore.getRootNode().cascadeBy(function(b){b.isHighlighted=false})},getCriticalPaths:function(){return this.taskStore.getCriticalPaths()},highlightCriticalPaths:function(){this.clearSelectedTasksAndDependencies();var j=this.getCriticalPaths(),n=this.getDependencyView(),k=this.dependencyStore,l,m,h,i;Ext.each(j,function(a){for(m=0,h=a.length;m<h;m++){l=a[m];this.highlightTask(l,false);if(m<h-1){for(var b=0,c=l.predecessors.length;b<c;b++){if(l.predecessors[b].getSourceId()==a[m+1].getInternalId()){i=l.predecessors[b];break}}n.highlightDependency(i)}}},this);this.addCls("sch-gantt-critical-chain")},unhighlightCriticalPaths:function(){this.el.removeCls("sch-gantt-critical-chain");this.clearSelectedTasksAndDependencies()},getXOffset:function(d,e){var f=0;if(d.isMilestone(e)){f=Math.floor(this.getRowHeight()*Math.sqrt(2)/4)-2}else{if(!d.isLeaf()&&!e){f=this.parentTaskOffset}}return f},onDestroy:function(){if(this.dependencyView){this.dependencyView.destroy()}if(this.rendered){Ext.dd.ScrollManager.unregister(this.el)}this.callParent(arguments)},highlightDependency:function(b){this.dependencyView.highlightDependency(b)},unhighlightDependency:function(b){this.dependencyView.unhighlightDependency(b)},onBeforeDependencyDrag:function(c,d){return this.fireEvent("beforedependencydrag",this,d)},onDependencyDragStart:function(b){this.fireEvent("dependencydragstart",this);if(this.tip){this.tip.disable()}this.preventOverCls=true},onDependencyDrop:function(e,h,f,g){this.fireEvent("dependencydrop",this,this.taskStore.getById(h),this.taskStore.getById(f),g)},onAfterDependencyDragDrop:function(){this.fireEvent("afterdependencydragdrop",this);if(this.tip){this.tip.enable()}this.preventOverCls=false},getLeftEditor:function(){return this.leftLabelField.editor},getRightEditor:function(){return this.rightLabelField.editor},getTopEditor:function(){return this.topLabelField.editor},getBottomEditor:function(){return this.bottomLabelField.editor},editLeftLabel:function(d){var c=this.leftLabelField&&this.leftLabelField.editor;if(c){c.edit(d)}},editRightLabel:function(d){var c=this.rightLabelField&&this.rightLabelField.editor;if(c){c.edit(d)}},editTopLabel:function(d){var c=this.topLabelField&&this.topLabelField.editor;if(c){c.edit(d)}},editBottomLabel:function(d){var c=this.bottomLabelField&&this.bottomLabelField.editor;if(c){c.edit(d)}},getOuterElementFromEventRecord:function(d){var c=this.callParent([d]);return c&&c.up(this.eventWrapSelector)||null},getDependenciesForTask:function(b){console.warn("`ganttPanel.getDependenciesForTask()` is deprecated, use `task.getAllDependencies()` instead");return b.getAllDependencies()},onAdd:function(){Ext.suspendLayouts();this.callParent(arguments);Ext.resumeLayouts()},onRemove:function(){Ext.suspendLayouts();this.callParent(arguments);Ext.resumeLayouts()},onUpdate:function(h,f,e,g){Ext.suspendLayouts();this.callParent(arguments);Ext.resumeLayouts()},handleScheduleEvent:function(f){var e=f.getTarget("."+this.timeCellCls,3);if(e){var d=this.findRowByChild(e);this.fireEvent("schedule"+f.type,this,this.getDateFromDomEvent(f,"floor"),this.indexOf(d),f)}},scrollEventIntoView:function(y,x,A,p,o){o=o||this;var t=this;var s=this.taskStore;var r=function(a,b){t.up("panel").scrollTask.cancel();t.scrollElementIntoView(a,t.el,b,A);if(x){if(typeof x==="boolean"){a.highlight()}else{a.highlight(null,x)}}p&&p.call(o)};if(!y.isVisible()){y.bubble(function(a){a.expand()})}var q;var z=y.getStartDate();var u=y.getEndDate();var B=Boolean(z&&u);if(B){var v=this.timeAxis;if(!v.dateInAxis(z)||!v.dateInAxis(u)){var w=v.getEnd()-v.getStart();v.setTimeSpan(new Date(z.getTime()-w/2),new Date(u.getTime()+w/2))}q=this.getElementFromEventRecord(y)}else{q=this.getNode(y);if(q){q=Ext.fly(q).down(this.getCellSelector())}}if(q){r(q,B)}else{if(this.bufferedRenderer){Ext.Function.defer(function(){t.bufferedRenderer.scrollTo(s.getIndexInTotalDataset(y),false,function(){var a=t.getElementFromEventRecord(y);if(a){r(a,true)}else{p&&p.call(o)}})},10)}}}});Ext.define("Gnt.view.ResourceHistogram",{extend:"Sch.view.TimelineGridView",alias:"widget.resourcehistogramview",requires:["Ext.XTemplate","Ext.util.Format","Sch.util.Date","Gnt.model.Resource"],_cmpCls:"gnt-resourcehistogramview",scheduledEventName:"bar",eventSelector:".gnt-resourcehistogram-bar",barTpl:null,barRenderer:Ext.emptyFn,barCls:"gnt-resourcehistogram-bar",lineTpl:null,lineCls:"gnt-resourcehistogram-line",limitLineTpl:null,limitLineCls:"gnt-resourcehistogram-limitline",limitLineWidth:1,rowHeight:60,labelMode:false,labelPercentFormat:"0",labelUnitsFormat:"0.0",unitHeight:null,availableRowHeight:null,initComponent:function(b){if(this.barCls){this.eventSelector="."+this.barCls}if(!this.barTpl){this.barTpl=new Ext.XTemplate('<tpl for=".">','<div id="{id}" class="'+this.barCls+' {cls}" gnt-bar-index="{index}" style="left:{left}px;top:{top}px;height:{height}px;width:{width}px"></div>',"<tpl if=\"text !== ''\">",'<span class="'+this.barCls+'-text" style="left:{left}px;">{text}</span>',"</tpl>","</tpl>")}if(!this.lineTpl){this.lineTpl=new Ext.XTemplate('<tpl for=".">','<div class="'+this.lineCls+' {cls}" style="top:{top}px;"></div>',"</tpl>")}if(!this.limitLineTpl){this.limitLineTpl=new Ext.XTemplate('<tpl for=".">','<div class="'+this.limitLineCls+' {cls}" style="left:{left}px;top:{top}px;width:{width}px;height:{height}px"></div>',"</tpl>")}this.addEvents("barclick","bardblclick","barcontextmenu");this.callParent(arguments);this.unitHeight=this.getAvailableRowHeight()/(this.scaleMax-this.scaleMin+this.scaleStep)},onUpdate:function(f,i,g,j){if(Ext.Array.indexOf(Gnt.model.Resource.prototype.calendarIdField,j)>-1){this.histogram.loadAllocationData(i,true);this.histogram.unbindResourceCalendarListeners(i);var h=i.getOwnCalendar();if(h&&h!==this.histogram.calendar){this.histogram.bindResourceCalendarListeners(i,h)}}this.callParent(arguments)},onDataRefresh:function(){this.histogram.loadAllocationData(null,true);this.histogram.bindCalendarListeners();this.callParent(arguments)},renderLines:function(b){return this.lineTpl.apply(this.prepareLines(b))},prepareLines:function(p){var o=p.scaleMin,s=p.scaleLabelStep,v=this.getAvailableRowHeight(),r=[],i={},l=this.lineCls,n=l+"min";if(p.scalePoints){var q;for(var t=0,u=p.scalePoints.length;t<u;t++){q=p.scalePoints[t];r.push({value:q.value,top:q.top||Math.round(v-this.unitHeight*(q.value-p.scaleMin)),cls:q.cls+(q.label?" "+l+"-label":"")+(t===0?" "+l+"-min":(t==u?" "+l+"-max":""))})}}else{while(o<=p.scaleMax){r.push({value:o,top:Math.round(v-this.unitHeight*(o-p.scaleMin)),cls:n});o+=p.scaleStep;n=o%s?"":l+"-label";if(o==p.scaleMax){n+=" "+l+"-max"}}if(r.length&&r[r.length-1].value!==p.scaleMax){r.push({value:p.scaleMax,top:Math.round(v-this.unitHeight*(p.scaleMax-p.scaleMin)),cls:(p.scaleMax%s?"":l+"-label")+" "+l+"-max"})}}return r},renderLimitLines:function(c,d){return this.limitLineTpl.apply(this.prepareLimitLines(c,d))},prepareLimitLines:function(l,r){var o=[],x=this.getAvailableRowHeight(),i=this.limitLineCls,w;for(var q=0,s=r.length;q<s;q++){var t=this.getXFromDate(r[q].startDate||l.getStart(),true);var v={left:t,width:this.getXFromDate(r[q].endDate||l.getEnd(),true)-t,top:"",height:0,cls:""};var p=l.calendar.convertMSDurationToUnit(r[q].allocationMS,l.scaleUnit);var u=true;if(p*this.unitHeight>x){p=l.scaleMax+l.scaleStep;u=false}else{if(p<l.scaleMin){p=l.scaleMin;u=false}}v.top=Math.round(x-(p-l.scaleMin)*this.unitHeight);if(u){v.cls+=" "+i+"-top"}if(o[0]){o.push({left:t,width:1,top:Math.min(v.top,o[o.length-1].top),height:Math.round(Math.abs(o[o.length-1].top-v.top)+this.limitLineWidth),cls:i+"-top"})}w=p;o.push(v)}return o},renderBars:function(d,e,f){return this.barTpl.apply(this.prepareBars(d,e,f))},prepareBars:function(l,p,o){var m=[],t=this.getAvailableRowHeight(),i=this.barCls,s,n;for(var q=0,r=p.length;q<r;q++){if(p[q].totalAllocation){n=l.calendar.convertMSDurationToUnit(p[q].allocationMS,l.scaleUnit);s=Ext.apply({id:o+"-"+q,index:q,left:this.getXFromDate(p[q].startDate,true),width:this.getXFromDate(p[q].endDate,true)-this.getXFromDate(p[q].startDate,true),height:t,top:0,text:"",cls:""},this.barRenderer(o,p[q]));if(this.labelMode){switch(this.labelMode){case"percent":s.text=Ext.util.Format.number(p[q].totalAllocation,this.labelPercentFormat)+"%";break;case"units":s.text=Ext.util.Format.number(n,this.labelUnitsFormat)+Sch.util.Date.getShortNameOfUnit(l.scaleUnit);break;default:s.text=this.labelMode.apply({allocation:n,percent:p[q].totalAllocation})}}if(n<=l.scaleMax+l.scaleStep){s.height=n>=l.scaleMin?Math.round((n-l.scaleMin)*this.unitHeight):0;s.top=t-s.height}else{s.cls=i+"-partofbar"}if(p[q].totalAllocation>100){s.cls=i+"-overwork"}m.push(s)}}return m},columnRenderer:function(l,m,n,j,h){var k=n.getInternalId(),i=this.normalGrid.getView();return(this.showScaleLines?i.renderLines(this):"")+i.renderBars(this,this.allocationData[k].bars,k)+(this.showLimitLines?i.renderLimitLines(this,this.allocationData[k].maxBars):"")},getAvailableRowHeight:function(){if(this.availableRowHeight){return this.availableRowHeight}this.availableRowHeight=this.rowHeight-this.cellTopBorderWidth-this.cellBottomBorderWidth;return this.availableRowHeight},resolveEventRecord:function(n){var l=this.findItemByChild(n);if(l){var j=this.getRecord(l);if(j){var i={resource:j};var k=this.histogram.allocationData[j.getInternalId()];var h=n.getAttribute("gnt-bar-index");var m=k.bars[h];i.startDate=m.startDate;i.endDate=m.endDate;i.assignments=m.assignments;i.allocationMS=m.allocationMS;i.totalAllocation=m.totalAllocation;return i}}return null},getDataForTooltipTpl:function(b){return b}});Ext.define("Gnt.column.Scale",{extend:"Ext.grid.column.Template",alias:"widget.scalecolumn",tpl:null,sortable:false,scalePoints:null,scaleStep:2,scaleLabelStep:4,scaleMin:0,scaleMax:24,width:40,availableHeight:48,scaleCellCls:"gnt-scalecolumn",_isGanttColumn:false,initComponent:function(){this.tdCls=(this.tdCls||"")+" "+this.scaleCellCls;if(!this.tpl){this.tpl=new Ext.XTemplate('<div class="'+this.scaleCellCls+'-wrap" style="height:{scaleHeight}px;">','<tpl for="scalePoints">',"<tpl if=\"label !== ''\">",'<span class="'+this.scaleCellCls+'-label-line {cls}" style="top:{top}px"><span class="'+this.scaleCellCls+'-label">{label}</span></span>',"<tpl else>",'<span class="'+this.scaleCellCls+'-line {cls}" style="top:{top}px"></span>',"</tpl>","</tpl>","</div>")}this.setAvailableHeight(this.availableHeight,true);this.callParent(arguments)},setAvailableHeight:function(d,c){this.availableHeight=d;if(!this.scalePoints){this.scaleStepHeight=this.availableHeight/(this.scaleMax-this.scaleMin+this.scaleStep);this.scalePoints=this.buildScalePoints()}else{if(c){this.scalePoints.sort(function(a,b){return a.value>b.value?1:-1});this.scaleMin=this.scalePoints[0].value;this.scaleMax=this.scalePoints[this.scalePoints.length-1].value;this.scaleStep=(this.scaleMax-this.scaleMin)/10}this.scaleStepHeight=this.availableHeight/(this.scaleMax-this.scaleMin+this.scaleStep);this.updateScalePointsTops()}},defaultRenderer:function(h,g,f){var e={record:Ext.apply({},f.data,f.getAssociatedData()),scaleHeight:this.availableHeight,scalePoints:this.scalePoints};return this.tpl.apply(e)},buildScalePoints:function(){var n=this.scaleMin,m=n,r=this.scaleStep,o=this.scaleLabelStep,q=this.scaleStepHeight,s=this.availableHeight,t=this.scaleCellCls,l=t+"-min",k=[];var p=function(a,b,c){return{top:Math.round(s-(a-n)*q),value:a,label:b!="undefined"?b:"",cls:c||""}};while(m<this.scaleMax){k.push(p(m,m%o||m===n?"":m,l));l="";m+=r}k.push(p(this.scaleMax,this.scaleMax,t+"-max"));return k},updateScalePointsTops:function(){var i=this.scaleStepHeight,h=this.availableHeight,g;for(var j=0,f=this.scalePoints.length;j<f;j++){g=this.scalePoints[j];g.top=Math.round(h-g.value*i)}}});Ext.define("Gnt.panel.Gantt",{extend:"Sch.panel.TimelineTreePanel",alias:["widget.ganttpanel"],alternateClassName:["Sch.gantt.GanttPanel"],requires:["Ext.layout.container.Border","Gnt.model.Dependency","Gnt.data.ResourceStore","Gnt.data.AssignmentStore","Gnt.feature.WorkingTime","Gnt.data.Calendar","Gnt.data.TaskStore","Gnt.data.DependencyStore","Gnt.view.Gantt"],uses:["Sch.plugin.CurrentTimeLine"],viewType:"ganttview",layout:"border",rowLines:true,syncRowHeight:false,useSpacer:false,rowHeight:24,topLabelField:null,leftLabelField:null,bottomLabelField:null,rightLabelField:null,highlightWeekends:true,weekendsAreWorkdays:false,skipWeekendsDuringDragDrop:true,enableTaskDragDrop:true,enableDependencyDragDrop:true,enableProgressBarResize:false,toggleParentTasksOnClick:true,addRowOnTab:true,recalculateParents:true,cascadeChanges:false,showTodayLine:false,enableBaseline:false,baselineVisible:false,enableAnimations:false,animate:false,workingTimePlugin:null,todayLinePlugin:null,allowParentTaskMove:true,enableDragCreation:true,eventRenderer:Ext.emptyFn,eventRendererScope:null,eventTemplate:null,parentEventTemplate:null,milestoneTemplate:null,taskBodyTemplate:null,parentTaskBodyTemplate:null,milestoneBodyTemplate:null,autoHeight:null,calendar:null,taskStore:null,dependencyStore:null,resourceStore:null,assignmentStore:null,columnLines:false,dndValidatorFn:Ext.emptyFn,createValidatorFn:Ext.emptyFn,resizeHandles:"both",resizeValidatorFn:Ext.emptyFn,resizeConfig:null,progressBarResizeConfig:null,dragDropConfig:null,createConfig:null,autoFitOnLoad:false,refreshLockedTreeOnDependencyUpdate:false,_lockedDependencyListeners:null,earlyStartColumn:null,earlyEndColumn:null,lateStartColumn:null,lateEndColumn:null,earlyDatesListeners:null,lateDatesListeners:null,slackListeners:null,refreshTimeout:100,lastFocusedRecord:null,lastFocusedRecordFrom:null,simpleCascadeThreshold:30,getEventSelectionModel:function(){return this.getSelectionModel()},initStores:function(){if(!this.taskStore){Ext.Error.raise("You must specify a taskStore config.")}var f=Ext.StoreMgr.lookup(this.taskStore);if(!f){Ext.Error.raise("You have provided an incorrect taskStore identifier")}if(!(f instanceof Gnt.data.TaskStore)){Ext.Error.raise("A `taskStore` should be an instance of `Gnt.data.TaskStore` (or of a subclass)")}Ext.apply(this,{store:f,taskStore:f});var g=this.calendar=f.calendar;if(this.dependencyStore){this.dependencyStore=Ext.StoreMgr.lookup(this.dependencyStore);f.setDependencyStore(this.dependencyStore)}else{this.dependencyStore=f.dependencyStore}if(!(this.dependencyStore instanceof Gnt.data.DependencyStore)){Ext.Error.raise("The Gantt dependency store should be a Gnt.data.DependencyStore, or a subclass thereof.")}var e=this.resourceStore?Ext.StoreMgr.lookup(this.resourceStore):f.getResourceStore();if(!(e instanceof Gnt.data.ResourceStore)){Ext.Error.raise("A `ResourceStore` should be an instance of `Gnt.data.ResourceStore` (or of a subclass)")}var h=this.assignmentStore?Ext.StoreMgr.lookup(this.assignmentStore):f.getAssignmentStore();if(!(h instanceof Gnt.data.AssignmentStore)){Ext.Error.raise("An `assignmentStore` should be an instance of `Gnt.data.AssignmentStore` (or of a subclass)")}this.bindAssignmentStore(h,true);this.bindResourceStore(e,true);if(this.needToTranslateOption("weekendsAreWorkdays")){g.setWeekendsAreWorkDays(this.weekendsAreWorkdays)}},initComponent:function(){var j=this;if(Ext.isBoolean(this.showBaseline)){this.enableBaseline=this.baselineVisible=this.showBaseline;this.showBaseline=Gnt.panel.Gantt.prototype.showBaseline}this.autoHeight=false;this.initStores();if(this.needToTranslateOption("cascadeChanges")){this.setCascadeChanges(this.cascadeChanges)}if(this.needToTranslateOption("recalculateParents")){this.setRecalculateParents(this.recalculateParents)}if(this.needToTranslateOption("skipWeekendsDuringDragDrop")){this.setSkipWeekendsDuringDragDrop(this.skipWeekendsDuringDragDrop)}var k=this.normalViewConfig=this.normalViewConfig||{};Ext.apply(this.normalViewConfig,{taskStore:this.taskStore,dependencyStore:this.dependencyStore,snapRelativeToEventStartDate:this.snapRelativeToEventStartDate,enableDependencyDragDrop:this.enableDependencyDragDrop,enableTaskDragDrop:this.enableTaskDragDrop,enableProgressBarResize:this.enableProgressBarResize,enableDragCreation:this.enableDragCreation,allowParentTaskMove:this.allowParentTaskMove,toggleParentTasksOnClick:this.toggleParentTasksOnClick,resizeHandles:this.resizeHandles,enableBaseline:this.baselineVisible||this.enableBaseline,leftLabelField:this.leftLabelField,rightLabelField:this.rightLabelField,topLabelField:this.topLabelField,bottomLabelField:this.bottomLabelField,eventTemplate:this.eventTemplate,parentEventTemplate:this.parentEventTemplate,milestoneTemplate:this.milestoneTemplate,taskBodyTemplate:this.taskBodyTemplate,parentTaskBodyTemplate:this.parentTaskBodyTemplate,milestoneBodyTemplate:this.milestoneBodyTemplate,resizeConfig:this.resizeConfig,dragDropConfig:this.dragDropConfig});if(this.topLabelField||this.bottomLabelField){this.addCls("sch-gantt-topbottom-labels "+(this.topLabelField?"sch-gantt-top-label":""));this.normalViewConfig.rowHeight=52}this.configureFunctionality();this.mon(this.taskStore,{beforecascade:this.onBeforeCascade,cascade:this.onAfterCascade,beforeindentationchange:this.onBeforeIndentChange,indentationchange:this.onIndentChange,scope:this});this.callParent(arguments);if(this.autoFitOnLoad){if(this.store.getCount()){this.zoomToFit()}this.mon(this.store,"load",function(){this.zoomToFit()},this)}this.bodyCls=(this.bodyCls||"")+" sch-ganttpanel-container-body";var l=this.getSchedulingView();l.store.calendar=this.calendar;this.relayEvents(l,["taskclick","taskdblclick","taskcontextmenu","beforetaskresize","taskresizestart","partialtaskresize","aftertaskresize","beforeprogressbarresize","progressbarresizestart","afterprogressbarresize","beforetaskdrag","taskdragstart","beforetaskdropfinalize","taskdrop","aftertaskdrop","labeledit_beforestartedit","labeledit_beforecomplete","labeledit_complete","beforedependencydrag","dependencydragstart","dependencydrop","afterdependencydragdrop","dependencyclick","dependencycontextmenu","dependencydblclick","scheduleclick","scheduledblclick","schedulecontextmenu"]);if(this.addRowOnTab){var i=this.getSelectionModel();i.onEditorTab=Ext.Function.createInterceptor(i.onEditorTab,this.onEditorTabPress,this)}var g=this.getSchedulingView();this.registerRenderer(g.columnRenderer,g);var h=" sch-ganttpanel sch-horizontal ";if(this.highlightWeekends){h+=" sch-ganttpanel-highlightweekends "}if(!this.rtl){h+=" sch-ltr "}this.addCls(h);if(this.baselineVisible){this.showBaseline()}this.on("add",function(a,b){if(b instanceof Ext.Editor){a.lockedGrid.suspendLayouts();Ext.suspendLayouts();a.lockedGrid.add(b);Ext.resumeLayouts();a.lockedGrid.resumeLayouts()}})},getTimeSpanDefiningStore:function(){return this.taskStore},bindAutoTimeSpanListeners:function(){if(!this.autoFitOnLoad){this.callParent(arguments)}},onBeforeCascade:function(){var b=this.normalGrid.getView().store;b.suspendEvents();Ext.suspendLayouts()},onAfterCascade:function(y,K){var u=this;var v=this.normalGrid.getView().store;v.resumeEvents();Ext.resumeLayouts();if(K.nbrAffected>0){var C=this.lockedGrid.getView();if(K.nbrAffected<u.simpleCascadeThreshold){var z=this.getView();var A=this.getSchedulingView();var D={};A.suspendEvents(true);for(var x in K.affected){var w=K.affected[x];var B=w.parentNode;var E=C.store.indexOf(w);if(E>=0){z.refreshNode(C.store.indexOf(w))}if(B&&!B.data.root&&!D[B.id]){var J=C.store.indexOf(B);D[B.id]=true;if(J>=0){z.refreshNode(J)}}}A.resumeEvents();return}var t=this.normalGrid.getView();var F=this.lockedGrid.plugins[0]&&this.lockedGrid.plugins[0].activeEditor;var L,G,H,I;if(F){L=F.realign;G=F.alignTo;H=F.setPosition;I=C.preserveScrollOnRefresh;F.realign=Ext.emptyFn;F.alignTo=Ext.emptyFn;F.setPosition=Ext.emptyFn;C.preserveScrollOnRefresh=true}t.refreshKeepingScroll(true);Ext.suspendLayouts();C.refresh();Ext.resumeLayouts(true);if(F){F.realign=L;F.alignTo=G;F.setPosition=H;C.preserveScrollOnRefresh=I}}},onBeforeIndentChange:function(g){var h=this.lockedGrid.view;var i=document.activeElement;Ext.suspendLayouts();h.blockRefresh=true;h.saveScrollState();if(!h.rendered||!i||!i.tagName){return}var f=Ext.fly(i).findParent(h.itemSelector);if(f){var j=h.getRecord(f);if(j){this.lastFocusedRecordFrom=h.el.contains(f)?"lockedGrid":"normalGrid"}this.lastFocusedRecord=j}},onIndentChange:function(e){var d=this.lastFocusedRecord;var f=this.lockedGrid.view;if(d){this[this.lastFocusedRecordFrom].view.focusRow(d);this.lastFocusedRecord=null}f.blockRefresh=false;Ext.resumeLayouts();f.restoreScrollState();if(f.bufferedRenderer){f.refresh()}},bindFullRefreshListeners:function(f){var h=this;var g;var e=function(){if(g){return}g=setTimeout(function(){g=null;h.redrawColumns([f])},h.refreshTimeout)};this.mon(this.taskStore,{append:e,insert:e,remove:e,scope:this})},bindSequentialDataListeners:function(d){var f=this.lockedGrid.view;var e=this.taskStore;if(f.bufferedRenderer){return}this.mon(e,{append:function(a,b){if(!e.fillCount){this.updateAutoGeneratedCells(d,f.store.indexOf(b))}},insert:function(a,b,c){this.updateAutoGeneratedCells(d,f.store.indexOf(c))},move:function(b,i,c){if(b.__recordBelow){var a=f.store;var j=Math.min(a.indexOf(b),a.indexOf(b.__recordBelow));this.updateAutoGeneratedCells(d,j)}},remove:function(c,k,j){var l=k.removeContext;var a=l.nextSibling||(l.parentNode&&l.parentNode.nextSibling);var b=a?f.store.indexOf(a):-1;if(j){k.__recordBelow=a}else{if(b>=0){this.updateAutoGeneratedCells(d,b)}}},scope:this})},bindSlackListeners:function(){var b=Ext.Function.createBuffered(this.updateSlackColumns,this.refreshTimeout,this,[]);this.slackListeners=this.mon(this.taskStore,{resetearlydates:b,resetlatedates:b,scope:this,destroyable:true})},bindEarlyDatesListeners:function(){var b=Ext.Function.createBuffered(this.updateEarlyDateColumns,this.refreshTimeout,this,[]);this.earlyDatesListeners=this.mon(this.taskStore,{resetearlydates:b,scope:this,destroyable:true})},bindLateDatesListeners:function(){var b=Ext.Function.createBuffered(this.updateLateDateColumns,this.refreshTimeout,this,[]);this.lateDatesListeners=this.mon(this.taskStore,{resetlatedates:b,scope:this,destroyable:true})},onEditorTabPress:function(l,m){var e=this.lockedGrid.view,o=l.getActiveRecord(),q=l.getActiveColumn(),n=e.getPosition(o,q),t=this.lockedGrid.headerCt,p=n.row===this.lockedGrid.view.store.getCount()-1,r=function(a){return t.items.indexOf(a)>n.column&&a.isVisible()&&a.getEditor()};if(p&&t.items.findIndexBy(r)<0){var s=o.addTaskBelow({leaf:true});l.on("beforeedit",function(c,d){var a=d.column;var b=l.getEditor(s,a);b.on("startedit",function(){e.scrollCellIntoView(e.getCell(s,a))},null,{single:true})},this,{single:true})}},needToTranslateOption:function(b){return this.hasOwnProperty(b)||this.self.prototype.hasOwnProperty(b)&&this.self!=Gnt.panel.Gantt},getDependencyView:function(){return this.getSchedulingView().getDependencyView()},disableWeekendHighlighting:function(b){this.workingTimePlugin.setDisabled(b)},resolveTaskRecord:function(b){return this.getSchedulingView().resolveTaskRecord(b)},fitTimeColumns:function(){this.getSchedulingView().fitColumns()},getResourceStore:function(){return this.getTaskStore().getResourceStore()},getAssignmentStore:function(){return this.getTaskStore().getAssignmentStore()},getTaskStore:function(){return this.taskStore},getEventStore:function(){return this.taskStore},getDependencyStore:function(){return this.dependencyStore},onDragDropStart:function(){if(this.tip){this.tip.hide();this.tip.disable()}},onDragDropEnd:function(){if(this.tip){this.tip.enable()}},configureFunctionality:function(){var b=this.plugins=[].concat(this.plugins||[]);if(this.highlightWeekends){this.workingTimePlugin=Ext.create("Gnt.feature.WorkingTime",{calendar:this.calendar});b.push(this.workingTimePlugin)}if(this.showTodayLine){this.todayLinePlugin=new Sch.plugin.CurrentTimeLine();b.push(this.todayLinePlugin)}},getWorkingTimePlugin:function(){return this.workingTimePlugin},registerLockedDependencyListeners:function(){var c=this;var d=this.getDependencyStore();this._lockedDependencyListeners=this._lockedDependencyListeners||{load:function(){var a=c.getTaskStore();a.resetEarlyDates();a.resetLateDates();c.lockedGrid.getView().refresh()},clear:function(){var a=c.getTaskStore();a.resetEarlyDates();a.resetLateDates();c.lockedGrid.getView().refresh()},add:function(b,f){for(var a=0;a<f.length;a++){c.updateDependencyTasks(f[a])}},update:function(a,i){var j=c.lockedGrid.view;var b=j.store;if(i.previous[i.fromField]){var k=c.taskStore.getByInternalId(i.previous[i.fromField]);if(k){j.refreshNode(b.indexOf(k))}}if(i.previous[i.toField]){var l=c.taskStore.getByInternalId(i.previous[i.toField]);if(l){j.refreshNode(b.indexOf(l))}}c.updateDependencyTasks(i)},remove:function(a,b){c.updateDependencyTasks(b)}};this.mun(d,this._lockedDependencyListeners);this.mon(d,this._lockedDependencyListeners)},updateDependencyTasks:function(l){var g=l.getSourceTask(this.taskStore);var j=l.getTargetTask(this.taskStore);var i=this.lockedGrid.getView();var h=i.store.indexOf(g);var k=i.store.indexOf(j);if(g&&h>=0){i.refreshNode(h)}if(j&&k>=0){i.refreshNode(k)}},showBaseline:function(){this.addCls("sch-ganttpanel-showbaseline")},hideBaseline:function(){this.removeCls("sch-ganttpanel-showbaseline")},toggleBaseline:function(){this.toggleCls("sch-ganttpanel-showbaseline")},zoomToFit:function(c){var d=c?this.taskStore.getTasksTimeSpan(c):this.taskStore.getTotalTimeSpan();if(this.zoomToSpan(d,{adjustStart:1,adjustEnd:1})===null){if(!c){this.fitTimeColumns()}}},getCascadeChanges:function(){return this.taskStore.cascadeChanges},setCascadeChanges:function(b){this.taskStore.cascadeChanges=b},getRecalculateParents:function(){return this.taskStore.recalculateParents},setRecalculateParents:function(b){this.taskStore.recalculateParents=b},setSkipWeekendsDuringDragDrop:function(b){this.taskStore.skipWeekendsDuringDragDrop=this.skipWeekendsDuringDragDrop=b},getSkipWeekendsDuringDragDrop:function(){return this.taskStore.skipWeekendsDuringDragDrop},bindResourceStore:function(g,f){var h=this;var e={scope:h,update:h.onResourceStoreUpdate,datachanged:h.onResourceStoreDataChanged};if(!f&&h.resourceStore){if(g!==h.resourceStore&&h.resourceStore.autoDestroy){h.resourceStore.destroy()}else{h.mun(h.resourceStore,e)}if(!g){h.resourceStore=null}}if(g){g=Ext.data.StoreManager.lookup(g);h.mon(g,e);this.taskStore.setResourceStore(g)}h.resourceStore=g;if(g&&!f){h.refreshViews()}},refreshViews:function(){if(!this.rendered){return}var d=this.lockedGrid.getView(),f=d.el.dom.scrollLeft,e=d.el.dom.scrollTop;d.refresh();this.getSchedulingView().refreshKeepingScroll();d.el.dom.scrollLeft=f;d.el.dom.scrollTop=e},bindAssignmentStore:function(g,f){var h=this;var e={scope:h,beforetaskassignmentschange:h.onBeforeSingleTaskAssignmentChange,taskassignmentschanged:h.onSingleTaskAssignmentChange,update:h.onAssignmentStoreUpdate,datachanged:h.onAssignmentStoreDataChanged};if(!f&&h.assignmentStore){if(g!==h.assignmentStore&&h.assignmentStore.autoDestroy){h.assignmentStore.destroy()}else{h.mun(h.assignmentStore,e)}if(!g){h.assignmentStore=null}}if(g){g=Ext.data.StoreManager.lookup(g);h.mon(g,e);this.taskStore.setAssignmentStore(g)}h.assignmentStore=g;if(g&&!f){h.refreshViews()}},onResourceStoreUpdate:function(e,d){var f=d.getTasks();Ext.Array.each(f,function(b){var a=this.lockedGrid.view.store.indexOf(b);if(a>=0){this.getView().refreshNode(a)}},this)},onResourceStoreDataChanged:function(){if(this.taskStore.getRootNode().childNodes.length>0){this.refreshViews()}},onAssignmentStoreDataChanged:function(){if(this.taskStore.getRootNode().childNodes.length>0){this.refreshViews()}},onAssignmentStoreUpdate:function(e,g){var f=g.getTask();if(f){var h=this.lockedGrid.view.store.indexOf(f);if(h>=0){this.getView().refreshNode(h)}}},onBeforeSingleTaskAssignmentChange:function(){this.assignmentStore.un("datachanged",this.onAssignmentStoreDataChanged,this)},onSingleTaskAssignmentChange:function(h,i,j){this.assignmentStore.on("datachanged",this.onAssignmentStoreDataChanged,this);var g=this.taskStore.getById(i);if(g){var f=this.lockedGrid.view.store.indexOf(g);if(f>=0){this.getView().refreshNode(f)}}},updateAutoGeneratedCells:function(n,p){var i=this.lockedGrid.view;var k=i.all.startIndex;var m=i.all.endIndex;if(p<0||p>m){return}for(var o=Math.max(k,p);o<=m;o++){var l=i.store.getAt(o);var j=this.getCellDom(i,l,n);if(j){j.firstChild.innerHTML=n.renderer(null,null,l)}}},getCellDom:function(e,f,h){var g=e.getNode(f,true);return Ext.fly(g).down(h.getCellSelector(),true)},redrawColumns:function(m){if(m.length&&!this.isDestroyed){var j=this.lockedGrid.view;var r=Ext.getVersion("extjs").isLessThan("4.2.2.1144");for(var n=j.all.startIndex;n<=j.all.endIndex;n++){var q=j.store.getAt(n);for(var o=0,l=m.length;o<l;o++){var i=this.getCellDom(j,q,m[o]);var p=[];if(r){j.renderCell(m[o],q,n,m[o].getIndex(),p)}else{j.renderCell(m[o],q,n,m[o].getIndex(),n,p)}i.innerHTML=p.join("")}}}},updateSlackColumns:function(){var b=this.lockedGrid.view;if(this.slackColumn){this.redrawColumns([this.slackColumn])}},updateEarlyDateColumns:function(){var d=this.lockedGrid.view;var c=[];if(this.earlyStartColumn){c.push(this.earlyStartColumn)}if(this.earlyEndColumn){c.push(this.earlyEndColumn)}if(c.length){this.redrawColumns(c)}},updateLateDateColumns:function(){var d=this.lockedGrid.view;var c=[];if(this.lateStartColumn){c.push(this.lateStartColumn)}if(this.lateEndColumn){c.push(this.lateEndColumn)}if(c.length){this.redrawColumns(c)}},afterRender:function(){this.callParent(arguments);this.getSelectionModel().view=this.lockedGrid.getView();this.on("beforeedit",function(a,d){return !this.isReadOnly()&&d.record.isEditable(d.field)},this);this.setupColumnListeners();var b=this.getDependencyView();this.getView().on({expandbody:b.renderAllDependencies,collapsebody:b.renderAllDependencies,scope:b})},setupColumnListeners:function(){var d=this;var c=this.lockedGrid.headerCt;c.on("add",this.onLockedColumnAdded,this);c.items.each(function(a){d.onLockedColumnAdded(c,a)})},onLockedColumnAdded:function(d,e){var f=Gnt.column;if((f.WBS&&e instanceof f.WBS)||(f.Sequence&&e instanceof f.Sequence)){this.bindSequentialDataListeners(e)}else{if(f.Dependency&&e instanceof f.Dependency&&e.useSequenceNumber){this.bindFullRefreshListeners(e)}else{if(f.EarlyStartDate&&e instanceof f.EarlyStartDate){this.earlyStartColumn=e}else{if(f.EarlyEndDate&&e instanceof f.EarlyEndDate){this.earlyEndColumn=e}else{if(f.LateStartDate&&e instanceof f.LateStartDate){this.lateStartColumn=e}else{if(f.LateEndDate&&e instanceof f.LateEndDate){this.lateEndColumn=e}else{if(f.Slack&&e instanceof f.Slack){this.slackColumn=e}}}}}}}if(!this.slackListeners&&this.slackColumn){this.bindSlackListeners()}if(!this.earlyDatesListeners&&(this.earlyStartColumn||this.earlyEndColumn)){this.bindEarlyDatesListeners()}if(!this.lateDatesListeners&&(this.lateStartColumn||this.lateEndColumn)){this.bindLateDatesListeners()}},getState:function(){var d=this,c=d.callParent(arguments);c.lockedWidth=d.lockedGrid.getWidth();return c},applyState:function(c){var d=this;d.callParent(arguments);if(c&&c.lockedWidth){d.lockedGrid.setWidth(c.lockedWidth)}},expandAll:function(){var b=this.taskStore.nodeStore;b.suspendEvents();this.callParent(arguments);b.resumeEvents();this.view.refresh()},collapseAll:function(){var b=this.taskStore.nodeStore;b.suspendEvents();this.callParent(arguments);b.resumeEvents();this.view.refresh()}});Ext.define("Gnt.panel.ResourceHistogram",{extend:"Sch.panel.TimelineGridPanel",requires:["Ext.XTemplate","Sch.util.Date","Gnt.feature.WorkingTime","Gnt.column.Scale","Gnt.view.ResourceHistogram"],alias:"widget.resourcehistogram",viewType:"resourcehistogramview",layout:"border",preserveScrollOnRefresh:true,showScaleLines:false,showLimitLines:true,calendarListeners:null,calendarListenersHash:null,calendar:null,taskStore:null,resourceStore:null,assignmentStore:null,startDate:null,endDate:null,timelinePanel:null,highlightWeekends:true,allocationData:null,scaleUnit:"HOUR",scaleMin:0,scaleMax:24,scaleLabelStep:4,scaleStep:2,rowHeight:50,resourceText:"Resource",initComponent:function(){this.partnerTimelinePanel=this.partnerTimelinePanel||this.timelinePanel;this.lockedViewConfig=this.lockedViewConfig||{};this.normalViewConfig=this.normalViewConfig||{};this.normalViewConfig.histogram=this;this.normalViewConfig.trackOver=false;this.lockedGridConfig=this.lockedGridConfig||{};Ext.applyIf(this.lockedGridConfig,{width:300,forceFit:true});this.lockedViewConfig.rowHeight=this.normalViewConfig.rowHeight=this.rowHeight;this.lockedViewConfig.preserveScrollOnRefresh=this.normalViewConfig.preserveScrollOnRefresh=this.preserveScrollOnRefresh;if(this.scalePoints){this.scalePoints.sort(function(a,b){return a.value>b.value?1:-1});this.scaleMin=this.scalePoints[0].value;this.scaleMax=this.scalePoints[this.scalePoints.length-1].value;this.scaleStep=(this.scaleMax-this.scaleMin)/10}if(!this.columns){var t,q;this.columns=[];t=this.resourceNameCol=new Ext.grid.column.Column({header:this.resourceText,dataIndex:this.resourceStore.model.prototype.nameField});this.columns.push(t);q={width:40,fixed:true};Ext.Array.forEach(["scalePoints","scaleStep","scaleLabelStep","scaleMin","scaleMax","scaleLabelStep","scaleStep"],function(a){q[a]=this[a]},this);q=this.scaleCol=new Gnt.column.Scale(q);this.mon(q,{beforerender:function(){q.setAvailableHeight(this.getSchedulingView().getAvailableRowHeight());if(this.scalePoints){this.scalePoints=q.scalePoints}},scope:this,single:true});if(this.scalePoints){this.scaleMin=q.scaleMin;this.scaleMax=q.scaleMax;this.scaleStep=q.scaleStep}this.columns.push(q)}else{var r=!Ext.isArray(this.columns)?[this.columns]:this.columns,s;for(var p=0;p<r.length;p++){s=r[p];if(s instanceof Gnt.column.Scale||s.xtype=="scalecolumn"){Ext.Array.forEach(["scalePoints","scaleStep","scaleLabelStep","scaleMin","scaleMax","scaleLabelStep","scaleStep"],function(a){if(!(a in s)){s[a]=this[a]}},this);if(!(s instanceof Gnt.column.Scale)){s=r[p]=Ext.ComponentManager.create(s,"scalecolumn")}this.mon(s,{beforerender:function(){s.setAvailableHeight(this.getSchedulingView().getAvailableRowHeight())},scope:this,single:true})}}}Ext.Array.forEach(["barCls","barTpl","barRenderer","lineTpl","lineCls","limitLineTpl","limitLineCls","limitLineWidth","labelMode","labelPercentFormat","labelUnitsFormat","scaleMin","scaleMax","scaleStep","loadMask"],function(a){if(a in this){this.normalViewConfig[a]=this[a]}},this);this.store=this.resourceStore;this.taskStore=this.taskStore||this.store.getTaskStore();if(this.taskStore){this.mon(this.taskStore,{refresh:this.onTaskStoreRefresh,update:this.onTaskUpdate,append:this.onTaskUpdate,scope:this})}this.calendar=this.calendar||this.taskStore&&this.taskStore.getCalendar();if(!this.calendar){throw'Cannot get project calendar instance: please specify either "calendar" or "taskStore" option'}this.mon(this.calendar,{calendarchange:this.onProjectCalendarChange,scope:this});this.bindCalendarListeners();this.assignmentStore=this.assignmentStore||this.store.getAssignmentStore()||this.taskStore&&this.taskStore.getAssignmentStore();if(this.assignmentStore){this.mon(this.assignmentStore,{refresh:this.onAssignmentsRefresh,remove:this.onAssignmentsChange,update:this.onAssignmentsChange,add:this.onAssignmentsChange,scope:this})}this.plugins=[].concat(this.plugins||[]);if(this.highlightWeekends){this.workingTimePlugin=new Gnt.feature.WorkingTime({calendar:this.calendar});this.plugins.push(this.workingTimePlugin)}this.callParent(arguments);var m="gnt-resourcehistogram sch-horizontal ";if(this.highlightWeekends){m+=" gnt-resourcehistogram-highlightweekends "}this.addCls(m);var o=this.getSchedulingView();this.registerRenderer(o.columnRenderer,this);this.relayEvents(o,["barclick","bardblclick","barcontextmenu"]);if(!this.syncRowHeight){this.enableRowHeightInjection(this.lockedGrid.getView(),this.normalGrid.getView())}this.loadAllocationData(null,true);this.mon(this.timeAxis,"reconfigure",this.onTimeAxisReconfigure,this);var u=this.lockedGrid.headerCt.layout;var n=u.getContainerSize;var v=Ext.getScrollbarSize;var i=Ext.getScrollbarSize();u.scrollbarWidth=0;u.getContainerSize=function(b){Ext.getScrollbarSize=function(){return{width:0,height:i.height}};var a=n.apply(this,arguments);Ext.getScrollbarSize=v;return a}},destroy:function(){this.unbindCalendarListeners();if(this.assignmentStore){this.mun(this.assignmentStore,{refresh:this.onAssignmentsRefresh,remove:this.onAssignmentsChange,update:this.onAssignmentsChange,add:this.onAssignmentsChange,scope:this})}if(this.taskStore){this.mun(this.taskStore,{refresh:this.onTaskStoreRefresh,update:this.onTaskUpdate,append:this.onTaskUpdate,scope:this})}this.mun(this.calendar,{calendarchange:this.onProjectCalendarChange,scope:this});this.mun(this.timeAxis,"reconfigure",this.onTimeAxisReconfigure,this)},getEventStore:function(){return this.taskStore},onTaskStoreRefresh:function(){this.loadAllocationData()},onProjectCalendarChange:function(){this.loadAllocationData()},onTimeAxisReconfigure:function(){this.loadAllocationData()},unbindResourceCalendarListeners:function(c){var d=this.calendarListenersHash&&this.calendarListenersHash[c.getInternalId()];if(d){Ext.Array.remove(this.calendarListeners,d);Ext.destroy(d)}},bindResourceCalendarListeners:function(i,h){var j=this;h=h||i.getOwnCalendar();var f=function(){j.loadAllocationData(i)};var g=j.mon(h,{load:f,calendarchange:f,scope:j,destroyable:true});j.calendarListenersHash[i.getInternalId()]=g;j.calendarListeners.push(g)},bindCalendarListeners:function(){this.unbindCalendarListeners();var b=this;this.store.each(function(a){var d=a.getOwnCalendar();if(d&&d!==b.calendar){b.bindResourceCalendarListeners(a,d)}})},unbindCalendarListeners:function(){if(this.calendarListeners&&this.calendarListeners.length){Ext.destroy.apply(Ext,this.calendarListeners)}this.calendarListeners=[];this.calendarListenersHash={}},onResourcesLoad:function(){this.loadAllocationData();this.bindCalendarListeners()},onTaskUpdate:function(f,d){var e;if(this.assignmentStore){e=this.assignmentStore.queryBy(function(a){return a.getTaskId()==d.getInternalId()});e=e.getRange()}else{e=d.getAssignments()}this.onAssignmentsChange(this.assignmentStore,e)},onAssignmentsRefresh:function(b){this.onAssignmentsChange(b,b.getRange())},onAssignmentsChange:function(h,f){var i;if(!Ext.isArray(f)){f=[f]}for(var j=0,g=f.length;j<g;j++){i=this.resourceStore.getByInternalId(f[j].getResourceId());if(i){this.loadAllocationData(i)}}},enableRowHeightInjection:function(j,h){var f=j.renderRow;var g=j.renderCell;var i=new Ext.XTemplate("{%","this.processCellValues(values);","this.nextTpl.applyOut(values, out, parent);","%}",{priority:1,processCellValues:function(a){if(h.orientation=="horizontal"){var b=h.getAvailableRowHeight();a.style=(a.style||"")+";height:"+b+"px;"}}});j.addCellTpl(i);h.addCellTpl(i)},loadAllocationData:function(i,f){if(this.resourceStore){if(!i){this.allocationData={};var j=this;var h=this.getStartDate();var g=this.getEndDate();this.store.each(function(a){j.allocationData[a.getInternalId()]=j.processAllocationData(a.getAllocationInfo({startDate:h,endDate:g,includeResCalIntervals:true}))});if(!f&&this.rendered){this.getView().refresh()}}else{this.allocationData=this.allocationData||{};this.allocationData[i.getInternalId()]=this.processAllocationData(i.getAllocationInfo({startDate:this.getStartDate(),endDate:this.getEndDate(),includeResCalIntervals:true}));if(!f&&this.rendered){this.getView().refreshNode(this.store.indexOf(i))}}}},processAllocationData:function(i){var B,l,O,D,K,T,U,M,S,I,G=[],P=[],V=false,j=this;var J=function(){if(!l.assignments||!B.inResourceCalendar||!B.totalAllocation||!B.inTasksCalendar){return false}for(var b=0,a=l.assignments.length;b<a;b++){if(B.assignmentsHash[l.assignments[b].getTaskId()]){return false}}return true};var L=function(a){l={startDate:a,totalAllocation:B.totalAllocation,allocationMS:U*B.totalAllocation/100,assignments:B.assignments};V=true};var Q=function(a){if(!V){return false}if(a){l.endDate=a}G.push(l);V=false};var N=function(b,c){if(!b){return false}var d=Sch.util.Date.getDurationInDays(b,c);if(d<2){return false}var a=true;if(O){if(!O.allocationMS){a=false}else{O.endDate=Sch.util.Date.getStartOfNextDay(b,true);P.push(O)}}if(a){O={startDate:O&&O.endDate||j.getStart(),allocationMS:0}}S=0;return true};var H;for(var C=0,F=i.length;C<F;C++){B=i[C];H=Ext.Date.clearTime(B.startDate,true);if(H-D!==0){this.showLimitLines&&N(D,H);D=H;M=U;I=S;U=0;S=0;var E=C;while(i[E]&&Ext.Date.clearTime(i[E].startDate,true)-H===0){if(i[E].inResourceCalendar){S+=i[E].endDate-i[E].startDate;if(i[E].totalAllocation&&i[E].inTasksCalendar){U+=i[E].endDate-i[E].startDate}}E++}}else{H=false}if(this.showLimitLines){if(H&&S!=I){if(O){O.endDate=H;P.push(O)}O={startDate:H,allocationMS:S}}O.endDate=B.endDate}if(!V){if(B.inTask){L(new Date(B.startDate))}}else{if(!B.inTask){Q()}else{var R=false;if(H&&l.endDate<=Sch.util.Date.add(H,Sch.util.Date.DAY,-1)){K=Ext.Date.clearTime(l.endDate,true);if(K<l.endDate){K=Sch.util.Date.add(K,Sch.util.Date.DAY,1)}T=Ext.Date.clearTime(B.startDate,true);R=true}else{if(H&&U!==M){K=T=B.startDate;R=true}else{if(B.totalAllocation&&J()){K=l.endDate;T=new Date(B.startDate);R=true}else{if(B.totalAllocation&&B.totalAllocation!=l.totalAllocation){K=T=B.totalAllocation>l.totalAllocation?new Date(B.startDate):l.endDate;R=true}}}}if(R){Q(K);L(T)}}}if(V){l.endDate=B.endDate}}Q();if(this.showLimitLines){N(D||this.getStart(),this.getEnd());if(O){P.push(O)}if(P.length){P[0].startDate=null;P[P.length-1].endDate=null}}return{bars:G,maxBars:P}}});Ext.define("Gnt.field.mixin.TaskField",{taskField:"",task:null,taskStore:null,suppressTaskUpdate:0,highlightTaskUpdates:true,highlightColor:"#009900",lastHighlight:0,instantUpdate:true,setTask:function(b){if(!b){return}this.destroyTaskListener();this.updateReadOnly(b);this.task=b;b.on("taskupdated",this.onTaskUpdateProcess,this);if(!b.getCalendar(true)&&!b.getTaskStore(true)){b.taskStore=b.getTaskStore(true)||this.taskStore;if(!b.taskStore){throw"Configuration issue: Gnt.data.taskStore instance should be provided."}if(!b.getCalendar(true)&&!b.taskStore.getCalendar()){throw"Configuration issue: Gnt.data.Calendar instance should be provided."}}this.setSuppressTaskUpdate(true);if(this.onSetTask){this.onSetTask(b)}this.setSuppressTaskUpdate(false)},setSuppressTaskUpdate:function(b){b?this.suppressTaskUpdate++:this.suppressTaskUpdate--},getSuppressTaskUpdate:function(){return this.suppressTaskUpdate},updateReadOnly:function(b){if(!this.disabled){if(this.editable===false){if(!b.isEditable(b[this.taskField])){this.setReadOnly(true)}else{if(this.inputEl){this.setReadOnly(false);this.inputEl.dom.readOnly=true}}}else{this.setReadOnly(!b.isEditable(b[this.taskField]))}}},onTaskUpdateProcess:function(g,i){if(i!==this){var j=this.getValue();this.updateReadOnly(g);this.setSuppressTaskUpdate(true);if(this.onTaskUpdate){this.onTaskUpdate(g,i)}else{if(this.onSetTask){this.onSetTask()}}this.setSuppressTaskUpdate(false);if(this.highlightTaskUpdates){var h=this.getValue(),f=Ext.isDate(j);if(f&&(j-h!==0)||(!f&&String(j)!==String(h))){this.highlightField()}}}},highlightField:function(d,c){if(this.rendered&&(new Date()-this.lastHighlight>1000)){this.lastHighlight=new Date();this.inputEl.highlight(d||this.highlightColor,c||{attr:"color"})}},destroyTaskListener:function(){if(this.task){this.task.un("taskupdated",this.onTaskUpdateProcess,this)}}});Ext.define("Gnt.field.EndDate",{extend:"Ext.form.field.Date",requires:["Sch.util.Date"],mixins:["Gnt.field.mixin.TaskField","Gnt.mixin.Localizable"],alias:"widget.enddatefield",adjustMilestones:true,keepDuration:false,taskField:"endDateField",validateStartDate:true,constructor:function(b){b=b||{};Ext.apply(this,b);if(b.task&&!b.value){b.value=b.task.getEndDate()}this.setSuppressTaskUpdate(true);this.callParent([b]);this.setSuppressTaskUpdate(false);if(this.task){this.setTask(this.task)}},destroy:function(){this.destroyTaskListener();this.callParent()},onSetTask:function(){this.setValue(this.task.getEndDate())},rawToValue:function(b){if(!b){return null}return this.visibleToValue(this.parseDate(b))},valueToRaw:function(b){if(!b){return b}return Ext.Date.format(this.valueToVisible(b),this.format)},valueToVisible:function(c,d){d=d||this.task;return d.getDisplayEndDate(this.format,this.adjustMilestones,c,true)},visibleToValue:function(b){if(b&&this.task){if(!Ext.Date.formatContainsHourInfo(this.format)&&b-Ext.Date.clearTime(b,true)===0){b=this.task.getCalendar().getCalendarDay(b).getAvailabilityEndFor(b)||Sch.util.Date.add(b,Sch.util.Date.DAY,1)}}else{b=null}return b},getErrors:function(d){var c=this.callParent([d]);if(c&&c.length){return c}if(this.validateStartDate){d=this.rawToValue(d);if(this.task&&d){if(d<this.task.getStartDate()){return[this.L("endBeforeStartText")]}}}},onExpand:function(){var b=this.valueToVisible(this.getValue());if(!this.isValid()){b=this.getRawValue();if(b){b=Ext.Date.parse(b,this.format)}}this.picker.setValue(Ext.isDate(b)?b:new Date())},onSelect:function(m,i){var n=this.task.getEndDate();if(Ext.Date.formatContainsHourInfo(this.format)&&n){i.setHours(n.getHours());i.setMinutes(n.getMinutes())}var l=this;var h=l.getValue();var j=this.visibleToValue(i);var k=Ext.Date.format(i,this.format);if(h!=j){if(this.getErrors(k)){l.setRawValue(k);l.collapse();l.validate()}else{l.setValue(j,true);l.fireEvent("select",l,j);l.collapse()}}},applyChanges:function(d){d=d||this.task;var c=d.getTaskStore(true)||this.taskStore;if(this.value){d.setEndDate(this.value,this.keepDuration,c.skipWeekendsDuringDragDrop)}else{d.setEndDate(null)}},setVisibleValue:function(b){this.setValue(this.rawToValue(Ext.Date.format(b,this.format)))},getVisibleValue:function(){if(!this.getValue()){return null}return Ext.Date.parse(this.valueToRaw(this.getValue()),this.format)},setValue:function(d,e){this.callParent([d]);if((e||this.instantUpdate)&&!this.getSuppressTaskUpdate()&&this.task){this.applyChanges();var f=this.task.getEndDate();if(f-this.getValue()!==0){this.callParent([f])}this.task.fireEvent("taskupdated",this.task,this)}},getValue:function(){return this.value},assertValue:function(){var l=this,k=l.rawValue,i=l.getRawValue(),h=l.getValue(),j=l.rawToValue(i),g=l.focusTask;if(g){g.cancel()}if((k!=i)&&(j-h!==0)){if(!l.validateOnBlur||l.isValid()){l.setValue(j,true)}}},beforeBlur:function(){this.assertValue()}});Ext.define("Gnt.field.StartDate",{extend:"Ext.form.field.Date",requires:["Sch.util.Date"],mixins:["Gnt.field.mixin.TaskField"],alias:"widget.startdatefield",adjustMilestones:true,keepDuration:true,taskField:"startDateField",constructor:function(b){b=b||{};if(b.task&&!b.value){b.value=b.task.getStartDate()}this.setSuppressTaskUpdate(true);this.callParent([b]);this.setSuppressTaskUpdate(false);if(this.task){this.setTask(this.task)}},destroy:function(){this.destroyTaskListener();this.callParent()},onSetTask:function(){this.setValue(this.task.getStartDate())},rawToValue:function(b){if(!b){return null}return this.visibleToValue(this.parseDate(b))},valueToRaw:function(b){if(!b){return b}return Ext.Date.format(this.valueToVisible(b),this.format)},valueToVisible:function(c,d){d=d||this.task;return d.getDisplayStartDate(this.format,this.adjustMilestones,c,true)},visibleToValue:function(h){var e=this.task;if(e&&h){var g=e.getEndDate();var f=!this.lastValue||this.lastValue-Ext.Date.clearTime(this.lastValue,true)===0;if(this.adjustMilestones&&e.isMilestone()&&h-Ext.Date.clearTime(h,true)===0&&f){h=e.getCalendar().getCalendarDay(h).getAvailabilityEndFor(h)||h}}return h},onExpand:function(){var b=this.valueToVisible(this.getValue());if(!this.isValid()){b=this.getRawValue();if(b){b=Ext.Date.parse(b,this.format)}}this.picker.setValue(Ext.isDate(b)?b:new Date())},onSelect:function(o,j){var p=this.task.getStartDate();if(Ext.Date.formatContainsHourInfo(this.format)&&p){j.setHours(p.getHours());j.setMinutes(p.getMinutes())}var n=this,m=Ext.Date.format(j,this.format),i=n.getValue(),l=this.visibleToValue(j),k=this.getErrors(m);if(i!=l){if(k&&k.length){n.setRawValue(m);n.collapse();n.validate()}else{n.setValue(l);n.fireEvent("select",n,l);n.collapse()}}},applyChanges:function(d){d=d||this.task;var c=d.getTaskStore(true)||this.taskStore;d.setStartDate(this.value,this.keepDuration,c.skipWeekendsDuringDragDrop)},setVisibleValue:function(b){this.setValue(this.rawToValue(Ext.Date.format(b,this.format)))},getVisibleValue:function(){if(!this.getValue()){return null}return Ext.Date.parse(this.valueToRaw(this.getValue()),this.format)},setValue:function(g,h){this.callParent([g]);var e=this.task;if((h||this.instantUpdate)&&!this.getSuppressTaskUpdate()&&e&&e.taskStore&&g){this.applyChanges();var f=e.getStartDate();if(f-this.getValue()!==0){this.callParent([f])}e.fireEvent("taskupdated",e,this)}},getValue:function(){return this.value},assertValue:function(){var l=this,k=l.rawValue,i=l.getRawValue(),h=l.getValue(),j=l.rawToValue(i),g=l.focusTask;if(g){g.cancel()}if((k!=i)&&(j-h!==0)){if(!l.validateOnBlur||l.isValid()){l.setValue(j,true)}}},beforeBlur:function(){this.assertValue()}});Ext.define("Gnt.field.Duration",{extend:"Ext.form.field.Number",requires:["Gnt.util.DurationParser"],mixins:["Gnt.field.mixin.TaskField","Gnt.mixin.Localizable"],alias:"widget.durationfield",alternateClassName:["Gnt.column.duration.Field","Gnt.widget.DurationField"],disableKeyFilter:true,allowExponential:false,minValue:0,durationUnit:"h",useAbbreviation:false,getDurationUnitMethod:"getDurationUnit",setDurationMethod:"setDuration",getDurationMethod:"getDuration",taskField:"durationField",durationParser:null,durationParserConfig:null,constructor:function(d){var c=this;Ext.apply(this,d);this.durationParser=new Gnt.util.DurationParser(Ext.apply({parseNumberFn:function(){return c.parseValue.apply(c,arguments)},allowDecimals:this.decimalPrecision>0},this.durationParserConfig));this.setSuppressTaskUpdate(true);this.callParent(arguments);this.setSuppressTaskUpdate(false);this.invalidText=this.L("invalidText");if(this.task){this.setTask(this.task)}},destroy:function(){this.destroyTaskListener();this.callParent()},onSetTask:function(){this.durationUnit=this.task[this.getDurationUnitMethod]();var b=this.getDurationMethod?this.task[this.getDurationMethod]():this.task.get(this.task[this.taskField]);this.setValue(b);this.setSpinUpEnabled(b==null||b<this.maxValue,true);this.setSpinDownEnabled(b>this.minValue,true)},rawToValue:function(c){var d=this.parseDuration(c);if(!d){return null}this.durationUnit=d.unit;return d.value!=null?d.value:null},valueToVisible:function(h,g){if(Ext.isNumber(h)){var e=parseInt(h,10),f=Ext.Number.toFixed(h,this.decimalPrecision);return String(e==f?e:f).replace(".",this.decimalSeparator)+" "+Sch.util.Date[this.useAbbreviation?"getShortNameOfUnit":"getReadableNameOfUnit"](g||this.durationUnit,h!==1)}return""},valueToRaw:function(b){return this.valueToVisible(b,this.durationUnit,this.decimalPrecision,this.useAbbreviation)},parseDuration:function(d){if(d==null){return null}var e=this;var f=this.durationParser.parse(d);if(!f){return null}f.unit=f.unit||this.durationUnit;return f},getDurationValue:function(){return this.parseDuration(this.getRawValue())},getErrors:function(c){var d;if(c){d=this.parseDuration(c);if(!d){return[this.L("invalidText")]}c=d.value}return this.callParent([c])},checkChange:function(){if(!this.suspendCheckChange){var g=this,h=g.getDurationValue(),f=g.lastValue;var e=h&&!f||!h&&f||h&&f&&(h.value!=f.value||h.unit!=f.unit);if(e&&!g.isDestroyed){g.lastValue=h;g.fireEvent("change",g,h,f);g.onChange(h,f)}}},getValue:function(){return this.value},applyChanges:function(b){b=b||this.task;b[this.setDurationMethod](this.getValue(),this.durationUnit)},setValue:function(d,e){var f=d;if(Ext.isObject(d)){this.durationUnit=d.unit;f=d.value}this.callParent([f]);if((e||this.instantUpdate)&&!this.getSuppressTaskUpdate()&&this.task){this.applyChanges();this.task.fireEvent("taskupdated",this.task,this)}},assertValue:function(){var i=this,g=i.getValue(),h=i.durationUnit,j=i.getDurationValue();if(this.isValid()){var f=j&&!g||!j&&g||j&&(j.value!=g||j.unit!=h);if(f){i.setValue(j,true)}}},beforeBlur:function(){this.assertValue()},onSpinUp:function(){var d=this;if(!d.readOnly){var c=d.getValue()||0;d.setSpinValue(Ext.Number.constrain(c+d.step,d.minValue,d.maxValue))}},onSpinDown:function(){var d=this;if(!d.readOnly){var c=d.getValue()||0;d.setSpinValue(Ext.Number.constrain(c-d.step,d.minValue,d.maxValue))}}});Ext.define("Gnt.field.Effort",{extend:"Gnt.field.Duration",requires:["Gnt.util.DurationParser"],alias:"widget.effortfield",alternateClassName:["Gnt.column.effort.Field","Gnt.widget.EffortField"],invalidText:"Invalid effort value",taskField:"effortField",getDurationUnitMethod:"getEffortUnit",setDurationMethod:"setEffort",getDurationMethod:"getEffort"});Ext.define("Gnt.field.SchedulingMode",{extend:"Ext.form.field.ComboBox",mixins:["Gnt.field.mixin.TaskField"],alias:"widget.schedulingmodefield",alternateClassName:["Gnt.column.schedulingmode.Field"],taskField:"schedulingModeField",store:[["Normal","Normal"],["Manual","Manual"],["FixedDuration","Fixed duration"],["EffortDriven","Effort driven"],["DynamicAssignment","Dynamic assignment"]],pickerAlign:"tl-bl?",matchFieldWidth:true,editable:false,forceSelection:true,triggerAction:"all",constructor:function(d){var c=this;Ext.apply(this,d);this.setSuppressTaskUpdate(true);this.callParent(arguments);this.setSuppressTaskUpdate(false);if(this.task){this.setTask(this.task)}},destroy:function(){this.destroyTaskListener();this.callParent()},onSetTask:function(){this.setValue(this.task.getSchedulingMode())},valueToVisible:function(h,f){var j=this,i=[];var g=this.findRecordByValue(h);if(g){i.push(g.data)}else{if(Ext.isDefined(j.valueNotFoundText)){i.push(j.valueNotFoundText)}}return j.displayTpl.apply(i)},applyChanges:function(b){b=b||this.task;b.setSchedulingMode(this.getValue())},getValue:function(){return this.value},setValue:function(b){this.callParent([b]);if(this.instantUpdate&&!this.getSuppressTaskUpdate()&&this.task&&this.value){this.applyChanges();this.task.fireEvent("taskupdated",this.task,this)}}});Ext.define("Gnt.field.Calendar",{extend:"Ext.form.field.ComboBox",requires:["Gnt.data.Calendar"],mixins:["Gnt.field.mixin.TaskField","Gnt.mixin.Localizable"],alias:"widget.calendarfield",alternateClassName:["Gnt.column.calendar.Field"],taskField:"calendarIdField",pickerAlign:"tl-bl?",matchFieldWidth:true,editable:true,triggerAction:"all",valueField:"Id",displayField:"Name",queryMode:"local",forceSelection:true,allowBlank:true,constructor:function(d){var c=this;Ext.apply(this,d);this.store=this.store||Ext.create("Ext.data.Store",{fields:["Id","Name"]});this.setSuppressTaskUpdate(true);this.callParent(arguments);this.setSuppressTaskUpdate(false);if(this.rendered){this.store.loadData(this.getCalendarData())}else{this.on({render:function(){this.store.loadData(this.getCalendarData())},show:this.setReadOnlyIfEmpty,scope:this})}if(this.task){this.setTask(this.task)}},destroy:function(){this.destroyTaskListener();this.callParent()},setReadOnlyIfEmpty:function(){var b=Gnt.data.Calendar.getAllCalendars();if(!b||!b.length){this.setReadOnly(true)}},getCalendarData:function(){var b=[];Ext.Array.each(Gnt.data.Calendar.getAllCalendars(),function(a){b.push({Id:a.calendarId,Name:a.name||a.calendarId})});return b},onSetTask:function(){this.setReadOnlyIfEmpty();this.setValue(this.task.getCalendarId())},onTaskUpdate:function(d,c){this.setReadOnlyIfEmpty();this.setValue(this.task.getCalendarId())},valueToVisible:function(h,f){var j=this,i=[];var g=this.findRecordByValue(h);if(g){i.push(g.data)}else{if(Ext.isDefined(j.valueNotFoundText)){i.push(j.valueNotFoundText)}}return j.displayTpl.apply(i)},getValue:function(){return this.value},applyChanges:function(b){b=b||this.task;b.setCalendarId(this.value)},getErrors:function(c){if(c){var d=this.findRecordByDisplay(c);if(d){if(this.task&&!this.task.isCalendarApplicable(d.data.Id)){return[this.L("calendarNotApplicable")]}}}return this.callParent(arguments)},setValue:function(b){this.callParent([b]);if(undefined===b||null===b||""===b){this.value=""}if(!this.getSuppressTaskUpdate()&&this.task){if(this.task.getCalendarId()!=this.value){this.applyChanges();this.task.fireEvent("taskupdated",this.task,this)}}},assertValue:function(){var b=this.getRawValue();if(!b&&this.value){this.setValue("")}else{this.callParent(arguments)}}});Ext.define("Gnt.field.Percent",{extend:"Ext.form.field.Number",alias:"widget.percentfield",alternateClassName:["Gnt.widget.PercentField"],disableKeyFilter:false,minValue:0,maxValue:100,allowExponential:false,invalidText:"Invalid percent value",baseChars:"0123456789%",valueToRaw:function(b){if(Ext.isNumber(b)){return parseFloat(Ext.Number.toFixed(b,this.decimalPrecision))+"%"}return""},getErrors:function(c){var d=this.parseValue(c);if(d===null){if(c!==null&&c!==""){return[this.invalidText]}else{d=""}}return this.callParent([d])}});Ext.define("Gnt.field.Dependency",{extend:"Ext.form.field.Text",alternateClassName:"Gnt.widget.DependencyField",alias:"widget.dependencyfield",requires:["Gnt.util.DependencyParser"],mixins:["Gnt.mixin.Localizable"],type:"predecessors",separator:";",task:null,dependencyParser:null,useSequenceNumber:false,constructor:function(d){var c=this;Ext.apply(this,d);this.dependencyParser=new Gnt.util.DependencyParser({parseNumberFn:function(){return Gnt.widget.DurationField.prototype.parseValue.apply(c,arguments)}});this.callParent(arguments);this.addCls("gnt-field-dependency")},isPredecessor:function(){return this.type==="predecessors"},setTask:function(b){this.task=b;this.setRawValue(this.getDisplayValue(b))},getDependencies:function(){return this.dependencyParser.parse(this.getRawValue())},getTaskIdFromDependency:function(h){var e=this.task.getTaskStore(),g=h.taskId,f;if(this.useSequenceNumber){f=e.getBySequenceNumber(g);g=f&&f.getInternalId()}return g},getErrors:function(z){if(!z){return}var F=this.dependencyParser.parse(z);if(!F){return[this.L("invalidFormatText")]}var D=this.getDependencies(),A=this.isPredecessor(),k=this.task,i=k.getTaskStore().dependencyStore,B=k[A?"predecessors":"successors"],J;var j=[];for(var v=0;v<D.length;v++){var x=D[v];J=this.getTaskIdFromDependency(x);if(!J){return[this.L("invalidDependencyText")]}if(i.allowedDependencyTypes&&!i.isValidDependencyType(x.type)){var C=this.dependencyParser.types,G=i.allowedDependencyTypes,E=i.model.Type,I="";for(var w=0,y=G.length;w<y;w++){I+=C[E[G[w]]]+","}return[Ext.String.format(this.L("invalidDependencyType"),C[x.type],I.substring(0,I.length-1))]}var H=new i.model();H.setSourceId(A?J:k.getInternalId());H.setTargetId(A?k.getInternalId():J);H.setType(x.type);H.setLag(x.lag);H.setLagUnit(x.lagUnit);j.push(H)}for(v=0;v<j.length;v++){if(!i.isValidDependency(j[v],j,B)){return[this.invalidDependencyText]}}return this.callParent([F.value])},getDisplayValue:function(x){var q=this.isPredecessor(),n=q?x.getIncomingDependencies(true):x.getOutgoingDependencies(true),p=Gnt.util.DependencyParser.prototype.types,t=Gnt.model.Dependency.Type.EndToStart,o=[],i;for(var u=0;u<n.length;u++){var r=n[u];i=q?r.getSourceTask():r.getTargetTask();if(i&&r.isValid(false)){var s=r.getType(),w=r.getLag(),v=r.getLagUnit();o.push(Ext.String.format("{0}{1}{2}{3}{4}",this.useSequenceNumber?i.getSequenceNumber():i.getInternalId(),w||s!==t?p[s]:"",w>0?"+":"",w||"",w&&v!=="d"?v:""))}}return o.join(this.separator)},isDirty:function(p){p=p||this.task;if(!p){return false}var j=this.isPredecessor(),o=p.getTaskStore().dependencyStore,k=j?p.getIncomingDependencies():p.getOutgoingDependencies(),m=p.getInternalId();for(var n=0,i=k.length;n<i;n++){if(k[n].dirty||k[n].phantom){return true}}if(o){var l=j?"getTargetId":"getSourceId";k=o.getRemovedRecords();for(n=0,i=k.length;n<i;n++){if(k[n][l]()==m){return true}}}return false},applyChanges:function(w){w=w||this.task;var l=w.getTaskStore().dependencyStore,s=this.getDependencies(),z=[],q=this.isPredecessor(),p=q?w.getIncomingDependencies(true):w.getOutgoingDependencies(true),x=[];for(var t=0,u=s.length;t<u;t++){z.push(this.getTaskIdFromDependency(s[t]))}for(t=0;t<p.length;t++){if(!Ext.Array.contains(z,p[t][q?"getSourceId":"getTargetId"]())){x.push(p[t])}}if(x.length>0){l.remove(x)}var i=[];for(t=0;t<s.length;t++){var v=s[t];var y=this.getTaskIdFromDependency(v);var r=l.getByTaskIds(y,w.getInternalId());if(r){r.beginEdit();r.setType(v.type);r.setLag(v.lag);r.setLagUnit(v.lagUnit);r.endEdit()}else{r=new l.model();r.setSourceId(q?y:w.getInternalId());r.setTargetId(q?w.getInternalId():y);r.setType(v.type);r.setLag(v.lag);r.setLagUnit(v.lagUnit);i.push(r)}}if(i.length>0){l.add(i)}if(i.length||x.length){w.triggerUIUpdate()}}});Ext.define("Gnt.field.Milestone",{extend:"Ext.form.field.ComboBox",requires:"Ext.data.JsonStore",mixins:["Gnt.field.mixin.TaskField","Gnt.mixin.Localizable"],alias:"widget.milestonefield",instantUpdate:false,allowBlank:false,forceSelection:true,displayField:"text",valueField:"value",queryMode:"local",constructor:function(b){Ext.apply(this,b);this.store=new Ext.data.JsonStore({fields:["value","text"],data:[{value:0,text:this.L("no")},{value:1,text:this.L("yes")}]});this.setSuppressTaskUpdate(true);this.callParent(arguments);this.setSuppressTaskUpdate(false);if(this.task){this.setTask(this.task)}},destroy:function(){this.destroyTaskListener();this.callParent()},onSetTask:function(){this.setValue(this.task.isMilestone()?1:0)},valueToVisible:function(b){return b?this.L("yes"):this.L("no")},setValue:function(b){this.callParent([b]);if(this.instantUpdate&&!this.getSuppressTaskUpdate()&&this.task){if(this.task.isMilestone()!=Boolean(this.value)){this.applyChanges();this.task.fireEvent("taskupdated",this.task,this)}}},getValue:function(){return this.value},applyChanges:function(b){b=b||this.task;if(this.getValue()){b.convertToMilestone()}else{b.convertToRegular()}}});Ext.define("Gnt.column.ResourceName",{extend:"Ext.grid.column.Column",alias:"widget.resourcenamecolumn",mixins:["Gnt.mixin.Localizable"],dataIndex:"ResourceName",flex:1,align:"left",_isGanttColumn:false,constructor:function(b){b=b||{};this.text=b.text||this.L("text");Ext.apply(this,b);this.callParent(arguments)}});Ext.define("Gnt.column.AssignmentUnits",{extend:"Ext.grid.column.Number",mixins:["Gnt.mixin.Localizable"],alias:"widget.assignmentunitscolumn",dataIndex:"Units",format:"0 %",align:"left",_isGanttColumn:false,constructor:function(b){b=b||{};this.text=b.text||this.L("text");this.callParent(arguments)}});Ext.define("Gnt.widget.AssignmentGrid",{extend:"Ext.grid.Panel",alias:"widget.assignmentgrid",requires:["Gnt.model.Resource","Gnt.model.Assignment","Gnt.column.ResourceName","Gnt.column.AssignmentUnits","Ext.grid.plugin.CellEditing"],assignmentStore:null,resourceStore:null,readOnly:false,cls:"gnt-assignmentgrid",defaultAssignedUnits:100,taskId:null,cellEditing:null,sorter:{sorterFn:function(e,f){var g=e.getUnits(),h=f.getUnits();if((!g&&!h)||(g&&h)){return e.get("ResourceName")<f.get("ResourceName")?-1:1}return g?-1:1}},constructor:function(b){this.store=Ext.create("Ext.data.JsonStore",{model:Ext.define("Gnt.model.AssignmentEditing",{extend:"Gnt.model.Assignment",fields:["ResourceName"]})});this.columns=this.buildColumns();if(!this.readOnly){this.plugins=this.buildPlugins()}Ext.apply(this,{selModel:{selType:"checkboxmodel",mode:"MULTI",checkOnly:true,selectByPosition:function(a){var d=this.store.getAt(a.row);this.select(d,true)}}});this.callParent(arguments)},initComponent:function(){this.loadResources();this.mon(this.resourceStore,{datachanged:this.loadResources,scope:this});this.getSelectionModel().on("select",this.onSelect,this,{delay:50});this.callParent(arguments)},onSelect:function(c,d){if((!this.cellEditing||!this.cellEditing.getActiveEditor())&&!d.getUnits()){d.setUnits(this.defaultAssignedUnits)}},loadResources:function(){var j=[],g=this.resourceStore,i;for(var l=0,h=g.getCount();l<h;l++){var k=g.getAt(l);i=k.getId();j.push({ResourceId:i,ResourceName:k.getName(),Units:""})}this.store.loadData(j)},buildPlugins:function(){var b=this.cellEditing=Ext.create("Ext.grid.plugin.CellEditing",{clicksToEdit:1});b.on("edit",this.onEditingDone,this);return[b]},hide:function(){this.cellEditing.cancelEdit();this.callParent(arguments)},onEditingDone:function(d,c){if(c.value){this.getSelectionModel().select(c.record,true)}else{this.getSelectionModel().deselect(c.record);c.record.reject()}},buildColumns:function(){return[{xtype:"resourcenamecolumn"},{xtype:"assignmentunitscolumn",assignmentStore:this.assignmentStore,editor:{xtype:"numberfield",minValue:0,step:10}}]},loadTaskAssignments:function(k){var g=this.store,i=this.getSelectionModel();this.taskId=k;i.deselectAll(true);for(var l=0,h=g.getCount();l<h;l++){g.getAt(l).data.Units="";g.getAt(l).data.Id=null;delete g.getAt(l).__id__}g.suspendEvents();var j=this.assignmentStore.queryBy(function(a){return a.getTaskId()==k});j.each(function(a){var b=g.findRecord("ResourceId",a.getResourceId(),0,false,true,true);if(b){b.setUnits(a.getUnits());b.__id__=a.getId();i.select(b,true,true)}});g.resumeEvents();g.sort(this.sorter);this.getView().refresh()},saveTaskAssignments:function(){var g=this.assignmentStore,h=this.taskId;var i={};var j=[];this.getSelectionModel().selected.each(function(c){var d=c.getUnits();if(d>0){var a=c.__id__;if(a){i[a]=true;g.getById(a).setUnits(d)}else{var b=Ext.create(g.model);b.setTaskId(h);b.setResourceId(c.getResourceId());b.setUnits(d);i[b.internalId]=true;j.push(b)}}});var f=[];g.each(function(a){if(a.getTaskId()==h&&!i[a.getId()||a.internalId]){f.push(a)}});g.fireEvent("beforetaskassignmentschange",g,h,j);g.suspendAutoSync();g.remove(f);g.add(j);g.resumeAutoSync();g.fireEvent("taskassignmentschanged",g,h,j);if(g.autoSync){g.sync()}}});Ext.define("Gnt.field.Assignment",{extend:"Ext.form.field.Picker",alias:["widget.assignmentfield","widget.assignmenteditor"],alternateClassName:"Gnt.widget.AssignmentField",requires:["Gnt.widget.AssignmentGrid"],mixins:["Gnt.mixin.Localizable"],matchFieldWidth:false,editable:false,task:null,assignmentStore:null,resourceStore:null,gridConfig:null,formatString:"{0} [{1}%]",expandPickerOnFocus:false,afterRender:function(){this.callParent(arguments);this.on("expand",this.onPickerExpand,this);if(this.expandPickerOnFocus){this.on("focus",function(){this.expand()},this)}},createPicker:function(){var b=new Gnt.widget.AssignmentGrid(Ext.apply({ownerCt:this.ownerCt,renderTo:document.body,frame:true,floating:true,hidden:true,height:200,width:300,resourceStore:this.task.getResourceStore(),assignmentStore:this.task.getAssignmentStore(),fbar:this.buildButtons()},this.gridConfig||{}));return b},buildButtons:function(){return["->",{text:this.L("closeText"),handler:function(){Ext.Function.defer(this.onSaveClick,Ext.isIE&&!Ext.isIE9?60:30,this)},scope:this},{text:this.L("cancelText"),handler:function(){this.collapse();this.fireEvent("blur",this)},scope:this}]},setTask:function(b){this.task=b;this.setRawValue(this.getDisplayValue(b))},onPickerExpand:function(){this.picker.loadTaskAssignments(this.task.getInternalId())},onSaveClick:function(){var c=this.picker.getSelectionModel(),d=c.selected;this.collapse();this.fireEvent("blur",this);this.fireEvent("select",this,d);Ext.Function.defer(this.picker.saveTaskAssignments,1,this.picker)},collapseIf:function(c){var d=this;if(this.picker&&!c.getTarget("."+Ext.baseCSSPrefix+"editor")&&!c.getTarget("."+Ext.baseCSSPrefix+"menu-item")){d.callParent(arguments)}},mimicBlur:function(c){var d=this;if(!c.getTarget("."+Ext.baseCSSPrefix+"editor")&&!c.getTarget("."+Ext.baseCSSPrefix+"menu-item")){d.callParent(arguments)}},isDirty:function(l){l=l||this.task;if(!l){return false}var j=this.picker&&this.picker.assignmentStore||l.getAssignmentStore(),g=l.getAssignments(),i;for(var k=0,h=g.length;k<h;k++){if(g[k].dirty||g[k].phantom){return true}}if(j){g=j.getRemovedRecords();for(k=0,h=g.length;k<h;k++){if(g[k].getTaskId()==l.getInternalId()){return true}}}return false},getDisplayValue:function(p){p=p||this.task;var l=[],m=this.assignmentStore,k,n=p.getInternalId(),i=p.getAssignments();for(var o=0,j=i.length;o<j;o++){k=i[o];if(k.data.Units>0){l.push(Ext.String.format(this.formatString,k.getResourceName(),k.getUnits()))}}return l.join(", ")}},function(){Gnt.widget.AssignmentCellEditor=function(){var b=console;if(b&&b.log){b.log("Gnt.widget.AssignmentCellEditor is deprecated and should no longer be used. Instead simply use Gnt.field.Assignment.")}}});Ext.define("Gnt.column.ResourceAssignment",{extend:"Ext.grid.column.Column",alias:"widget.resourceassignmentcolumn",requires:["Gnt.field.Assignment"],mixins:["Gnt.mixin.Localizable"],tdCls:"sch-assignment-cell",showUnits:true,field:null,constructor:function(d){d=d||{};this.text=d.text||this.L("text");var f=d.field||d.editor;var e=d.showUnits||this.showUnits;delete d.field;delete d.editor;d.editor=f||{};if(!(d.editor instanceof Ext.form.Field)){d.editor=Ext.ComponentManager.create(Ext.applyIf(d.editor,{expandPickerOnFocus:true,formatString:"{0}"+(e?" [{1}%]":"")}),"assignmentfield")}d.field=d.editor;this.callParent([d]);this.scope=this},getContainingPanel:function(){if(!this.panel){this.panel=this.up("tablepanel")}return this.panel},setDirtyClass:function(f,d){var e=this.getContainingPanel().getView();if(e.markDirty&&this.field.isDirty(d)){f.tdCls=e.dirtyCls}},renderer:function(d,f,e){this.setDirtyClass(f,e);return this.field.getDisplayValue(e)}});Ext.define("Gnt.column.Name",{extend:"Ext.tree.Column",alias:"widget.namecolumn",mixins:["Gnt.mixin.Localizable"],draggable:true,constructor:function(d){d=d||{};this.text=d.text||this.L("text");var c=d.field||d.editor;delete d.field;delete d.editor;Ext.apply(this,d);d.editor=c||{xtype:"textfield",allowBlank:false};this.scope=this;this.callParent([d])},afterRender:function(){var c=this,d=this.up("treepanel");if(!this.dataIndex){this.dataIndex=d.store.model.prototype.nameField}this.callParent(arguments)},renderer:function(d,f,e){if(!e.isEditable(this.dataIndex)){f.tdCls=(f.tdCls||"")+" sch-column-readonly"}return Ext.util.Format.htmlEncode(d)}});Ext.define("Gnt.column.Note",{extend:"Ext.grid.column.Column",mixins:["Gnt.mixin.Localizable"],alias:"widget.notecolumn",field:{xtype:"textfield"},constructor:function(b){b=b||{};this.text=b.text||this.L("text");this.callParent(arguments);this.scope=this},afterRender:function(){var b=this.up("treepanel");if(!this.dataIndex){this.dataIndex=b.store.model.prototype.noteField}this.callParent(arguments)},renderer:function(d,f,e){if(!e.isEditable(this.dataIndex)){f.tdCls=(f.tdCls||"")+" sch-column-readonly"}return d}});Ext.define("Gnt.column.EndDate",{extend:"Ext.grid.column.Date",alias:"widget.enddatecolumn",requires:["Ext.grid.CellEditor","Gnt.field.EndDate"],mixins:["Gnt.mixin.Localizable"],width:100,align:"left",editorFormat:null,adjustMilestones:true,validateStartDate:true,instantUpdate:false,keepDuration:false,field:null,constructor:function(d){d=d||{};this.text=d.text||this.L("text");var f=d.field||d.editor;delete d.field;var e={format:d.editorFormat||d.format||this.format||Ext.Date.defaultFormat,instantUpdate:this.instantUpdate,adjustMilestones:this.adjustMilestones,keepDuration:this.keepDuration,validateStartDate:this.validateStartDate};Ext.Array.forEach(["instantUpdate","adjustMilestones","keepDuration","validateStartDate"],function(a){if(a in d){e[a]=d[a]}},this);d.editor=f||e;if(!(d.editor instanceof Gnt.field.EndDate)){Ext.applyIf(d.editor,e);d.editor=Ext.ComponentManager.create(d.editor,"enddatefield")}d.field=d.editor;this.hasCustomRenderer=true;this.callParent([d]);this.scope=this;this.renderer=d.renderer||this.rendererFunc;this.editorFormat=this.editorFormat||this.format},rendererFunc:function(d,f,e){if(!d){return}if(!e.isEditable(this.dataIndex)){f.tdCls=(f.tdCls||"")+" sch-column-readonly"}d=this.field.valueToVisible(d,e);return Ext.util.Format.date(d,this.format)},afterRender:function(){var b=this.ownerCt.up("treepanel");if(!this.dataIndex){this.dataIndex=b.store.model.prototype.endDateField}this.callParent(arguments)}});Ext.define("Gnt.column.PercentDone",{extend:"Ext.grid.column.Number",alias:"widget.percentdonecolumn",mixins:["Gnt.mixin.Localizable"],width:50,format:"0",align:"center",field:{xtype:"percentfield",decimalPrecision:0,minValue:0,maxValue:100},constructor:function(b){b=b||{};this.text=b.text||this.L("text");this.callParent(arguments);this.scope=this},afterRender:function(){var b=this.up("treepanel");if(!this.dataIndex){this.dataIndex=b.store.model.prototype.percentDoneField}this.callParent(arguments)},renderer:function(d,f,e){if(!e.isEditable(this.dataIndex)){f.tdCls=(f.tdCls||"")+" sch-column-readonly"}return this.defaultRenderer(d,f,e)}});Ext.define("Gnt.column.StartDate",{extend:"Ext.grid.column.Date",alias:"widget.startdatecolumn",requires:["Gnt.field.StartDate"],mixins:["Gnt.mixin.Localizable"],width:100,align:"left",editorFormat:null,adjustMilestones:true,instantUpdate:false,keepDuration:true,field:null,constructor:function(d){d=d||{};this.text=d.text||this.L("text");var f=d.field||d.editor;delete d.field;var e={format:d.editorFormat||d.format||this.format||Ext.Date.defaultFormat,instantUpdate:this.instantUpdate,adjustMilestones:this.adjustMilestones,keepDuration:this.keepDuration};Ext.Array.forEach(["instantUpdate","adjustMilestones","keepDuration"],function(a){if(a in d){e[a]=d[a]}},this);d.editor=f||e;if(!(d.editor instanceof Gnt.field.StartDate)){Ext.applyIf(d.editor,e);d.editor=Ext.ComponentManager.create(d.editor,"startdatefield")}d.field=d.editor;this.hasCustomRenderer=true;this.callParent([d]);this.renderer=d.renderer||this.rendererFunc;this.editorFormat=this.editorFormat||this.format},afterRender:function(){var d=this.up("treepanel");var c=d.store;if(!this.dataIndex){this.dataIndex=c.model.prototype.startDateField}this.callParent(arguments)},rendererFunc:function(d,f,e){if(!d){return}if(!e.isEditable(this.dataIndex)){f.tdCls=(f.tdCls||"")+" sch-column-readonly"}d=this.field.valueToVisible(d,e);return Ext.util.Format.date(d,this.format)}});Ext.define("Gnt.column.WBS",{extend:"Ext.grid.column.Column",alias:"widget.wbscolumn",mixins:["Gnt.mixin.Localizable"],width:40,align:"left",sortable:false,dataIndex:"index",constructor:function(b){b=b||{};this.text=b.text||this.L("text");this.callParent(arguments)},renderer:function(d,f,e){return e.getWBSCode()}});Ext.define("Gnt.column.Sequence",{extend:"Ext.grid.column.Column",alias:"widget.sequencecolumn",mixins:["Gnt.mixin.Localizable"],width:40,align:"right",sortable:false,dataIndex:"index",constructor:function(b){b=b||{};this.text=b.text||this.L("text");this.callParent(arguments)},renderer:function(d,f,e){return e.getSequenceNumber()}});Ext.define("Gnt.column.SchedulingMode",{extend:"Ext.grid.column.Column",requires:["Gnt.field.SchedulingMode"],mixins:["Gnt.mixin.Localizable"],alias:"widget.schedulingmodecolumn",width:100,align:"left",data:null,instantUpdate:false,field:null,constructor:function(d){d=d||{};this.text=d.text||this.L("text");var c=d.field||d.editor||new Gnt.field.SchedulingMode({store:d.data||Gnt.field.SchedulingMode.prototype.store,instantUpdate:this.instantUpdate});delete d.field;delete d.editor;if(!(c instanceof Gnt.field.SchedulingMode)){Ext.applyIf(c,{instantUpdate:this.instantUpdate});c=Ext.ComponentManager.create(c,"schedulingmodefield")}d.field=d.editor=c;this.scope=this;this.callParent([d])},renderer:function(d,f,e){return this.field.valueToVisible(d,e)},afterRender:function(){this.callParent(arguments);var b=this.up("treepanel");this.mon(b,"beforeedit",function(a,d){if(this.field.setTask){this.field.setTask(d.record)}},this);if(!this.dataIndex){this.dataIndex=b.store.model.prototype.schedulingModeField}}});Ext.define("Gnt.column.AddNew",{extend:"Ext.grid.column.Column",alias:"widget.addnewcolumn",requires:["Ext.form.field.ComboBox","Ext.Editor"],mixins:["Gnt.mixin.Localizable"],width:100,resizable:false,sortable:false,draggable:false,colEditor:null,columnList:null,initComponent:function(){if(!this.text){this.text=this.L("text")}this.addCls("gnt-addnewcolumn");this.on({headerclick:this.myOnHeaderClick,headertriggerclick:this.myOnHeaderClick,scope:this});this.callParent(arguments)},getGantt:function(){if(!this.gantt){this.gantt=this.up("ganttpanel")}return this.gantt},getContainingPanel:function(){if(!this.panel){this.panel=this.up("tablepanel")}return this.panel},myOnHeaderClick:function(){if(!this.combo){var g=this.getContainingPanel();var h,i=this;if(this.columnList){h=this.columnList}else{h=Ext.Array.map(Ext.ClassManager.getNamesByExpression("Gnt.column.*"),function(a){var b=Ext.ClassManager.get(a);if(b.prototype._isGanttColumn===false||i instanceof b){return null}return{clsName:a,text:b.prototype.localize?b.prototype.localize("text"):b.prototype.text}});h=Ext.Array.clean(h).sort(function(a,b){return a.text>b.text?1:-1})}var j=this.colEditor=new Ext.Editor({shadow:false,updateEl:false,itemId:"addNewEditor",renderTo:this.el,offsets:[20,0],field:new Ext.form.field.ComboBox({displayField:"text",valueField:"clsName",hideTrigger:true,queryMode:"local",listConfig:{itemId:"addNewEditorComboList",minWidth:150},store:new Ext.data.Store({fields:["text","clsName"],data:h}),listeners:{render:function(){this.on("blur",function(){j.cancelEdit()})},select:this.onSelect,scope:this}})})}var f=this.el.down("."+Ext.baseCSSPrefix+"column-header-text");this.colEditor.startEdit(f,"");this.colEditor.field.setWidth(this.getWidth()-20);this.colEditor.field.expand();return false},onSelect:function(l,p){var k=p[0];var j=this.ownerCt;var m=k.get("clsName");var i=this.getContainingPanel().getView();var n,o=function(){n=true};i.on("refresh",o);this.colEditor.cancelEdit();Ext.require(m,function(){var a=Ext.create(m);j.insert(j.items.indexOf(this),a);if(!n){i.refresh()}i.un("refresh",o)},this)}});Ext.define("Gnt.column.EarlyStartDate",{extend:"Ext.grid.column.Date",mixins:["Gnt.mixin.Localizable"],alias:"widget.earlystartdatecolumn",width:100,align:"left",adjustMilestones:true,constructor:function(b){b=b||{};this.text=b.text||this.L("text");this.callParent(arguments);this.renderer=b.renderer||this.rendererFunc;this.scope=b.scope||this;this.hasCustomRenderer=true},afterRender:function(){var b=this.up("ganttpanel");b.registerLockedDependencyListeners();this.callParent(arguments)},rendererFunc:function(d,f,e){f.tdCls=(f.tdCls||"")+" sch-column-readonly";return e.getDisplayStartDate(this.format,this.adjustMilestones,e.getEarlyStartDate())}});Ext.define("Gnt.column.EarlyEndDate",{extend:"Ext.grid.column.Date",mixins:["Gnt.mixin.Localizable"],alias:"widget.earlyenddatecolumn",width:100,align:"left",adjustMilestones:true,constructor:function(b){b=b||{};this.text=b.text||this.L("text");this.callParent(arguments);this.renderer=b.renderer||this.rendererFunc;this.scope=b.scope||this;this.hasCustomRenderer=true},afterRender:function(){var b=this.up("ganttpanel");b.registerLockedDependencyListeners();this.callParent(arguments)},rendererFunc:function(d,f,e){f.tdCls=(f.tdCls||"")+" sch-column-readonly";return e.getDisplayEndDate(this.format,this.adjustMilestones,e.getEarlyEndDate())}});Ext.define("Gnt.column.LateStartDate",{extend:"Ext.grid.column.Date",mixins:["Gnt.mixin.Localizable"],alias:"widget.latestartdatecolumn",width:100,align:"left",adjustMilestones:true,constructor:function(b){b=b||{};this.text=b.text||this.L("text");this.callParent(arguments);this.renderer=b.renderer||this.rendererFunc;this.scope=b.scope||this;this.hasCustomRenderer=true},afterRender:function(){var b=this.up("ganttpanel");b.registerLockedDependencyListeners();this.callParent(arguments)},rendererFunc:function(d,f,e){f.tdCls=(f.tdCls||"")+" sch-column-readonly";return e.getDisplayStartDate(this.format,this.adjustMilestones,e.getLateStartDate())}});Ext.define("Gnt.column.LateEndDate",{extend:"Ext.grid.column.Date",mixins:["Gnt.mixin.Localizable"],alias:"widget.lateenddatecolumn",width:100,align:"left",adjustMilestones:true,constructor:function(b){b=b||{};this.text=b.text||this.L("text");this.callParent(arguments);this.renderer=b.renderer||this.rendererFunc;this.scope=b.scope||this;this.hasCustomRenderer=true},afterRender:function(){var b=this.up("ganttpanel");b.registerLockedDependencyListeners();this.callParent(arguments)},rendererFunc:function(d,f,e){f.tdCls=(f.tdCls||"")+" sch-column-readonly";return e.getDisplayEndDate(this.format,this.adjustMilestones,e.getLateEndDate())}});Ext.define("Gnt.column.Slack",{extend:"Ext.grid.column.Column",requires:["Ext.Number","Sch.util.Date"],mixins:["Gnt.mixin.Localizable"],alias:"widget.slackcolumn",decimalPrecision:2,useAbbreviation:false,slackUnit:"d",width:100,align:"left",constructor:function(b){b=b||{};this.text=b.text||this.L("text");this.callParent(arguments);this.renderer=b.renderer||this.rendererFunc;this.scope=b.scope||this;this.hasCustomRenderer=true},afterRender:function(){var b=this.up("ganttpanel");b.registerLockedDependencyListeners();this.callParent(arguments)},rendererFunc:function(d,f,e){f.tdCls=(f.tdCls||"")+" sch-column-readonly";d=e.getSlack();if(Ext.isNumber(d)){return parseFloat(Ext.Number.toFixed(d,this.decimalPrecision))+" "+Sch.util.Date[this.useAbbreviation?"getShortNameOfUnit":"getReadableNameOfUnit"](this.slackUnit,d!==1)}return""}});Ext.define("Gnt.column.BaselineStartDate",{extend:"Ext.grid.column.Date",mixins:["Gnt.mixin.Localizable"],alias:"widget.baselinestartdatecolumn",width:100,adjustMilestones:true,constructor:function(b){b=b||{};this.text=b.text||this.L("text");this.callParent(arguments);this.renderer=b.renderer||this.rendererFunc;this.scope=b.scope||this;this.hasCustomRenderer=true},rendererFunc:function(d,f,e){f.tdCls=(f.tdCls||"")+" sch-column-readonly";return e.getDisplayStartDate(this.format,this.adjustMilestones,e.getBaselineStartDate(),false,true)}});Ext.define("Gnt.column.BaselineEndDate",{extend:"Ext.grid.column.Date",mixins:["Gnt.mixin.Localizable"],alias:"widget.baselineenddatecolumn",width:100,adjustMilestones:true,constructor:function(b){b=b||{};this.text=b.text||this.L("text");this.callParent(arguments);this.renderer=b.renderer||this.rendererFunc;this.scope=b.scope||this;this.hasCustomRenderer=true},rendererFunc:function(d,f,e){f.tdCls=(f.tdCls||"")+" sch-column-readonly";return e.getDisplayEndDate(this.format,this.adjustMilestones,e.getBaselineEndDate(),false,true)}});Ext.define("Gnt.column.Milestone",{extend:"Ext.grid.column.Column",alias:"widget.milestonecolumn",mixins:["Gnt.mixin.Localizable"],width:50,align:"center",constructor:function(b){b=b||{};b.editor=b.editor||new Gnt.field.Milestone();this.text=b.text||this.L("text");this.field=b.editor;this.callParent(arguments);this.scope=this},renderer:function(d,f,e){return this.field.valueToVisible(e.isMilestone())}});Ext.define("Gnt.widget.AssignmentEditGrid",{extend:"Ext.grid.Panel",alias:"widget.assignmenteditgrid",requires:["Ext.data.JsonStore","Ext.window.MessageBox","Ext.form.field.ComboBox","Ext.grid.plugin.CellEditing","Gnt.util.Data","Gnt.data.AssignmentStore","Gnt.data.ResourceStore","Gnt.model.Resource","Gnt.model.Assignment","Gnt.column.ResourceName","Gnt.column.AssignmentUnits"],mixins:["Gnt.mixin.Localizable"],assignmentStore:null,resourceStore:null,readOnly:false,cls:"gnt-assignmentgrid",defaultAssignedUnits:100,confirmAddResource:true,addResources:true,taskId:null,refreshTimeout:100,resourceDupStore:null,resourceComboStore:null,constructor:function(b){Ext.apply(this,b);this.confirmAddResource=this.confirmAddResourceText!==false;this.store=b.store||new Gnt.data.AssignmentStore({taskStore:b.taskStore||b.assignmentStore.getTaskStore()});this.resourceDupStore=b.resourceDupStore||new Gnt.data.ResourceStore({taskStore:b.taskStore||b.assignmentStore.getTaskStore()});this.resourceComboStore=new Ext.data.JsonStore({model:Gnt.model.Resource});if(b.addResources!==undefined){this.addResources=b.addResources}this.columns=this.buildColumns();if(!this.readOnly){this.plugins=this.buildPlugins()}this.callParent(arguments)},initComponent:function(){this.loadResources();var d=Ext.Function.createBuffered(this.loadResources,this.refreshTimeout,this,[]);this.mon(this.resourceStore,{add:d,remove:d,load:d,clear:d});this.loadTaskAssignments();var c=Ext.Function.createBuffered(this.loadTaskAssignments,this.refreshTimeout,this,[]);this.mon(this.assignmentStore,{add:c,remove:c,load:c,clear:c});this.callParent(arguments)},loadResources:function(c){if(!this.resourceStore){return false}var d=Gnt.util.Data.cloneModelSet(this.resourceStore,function(b,a){if(!b.getId()){b.setId(a.getInternalId())}});this.resourceDupStore.loadData(d);this.resourceComboStore.loadData(d);if(!c){this.loadTaskAssignments()}return true},loadTaskAssignments:function(m){m=m||this.taskId;if(!m){return false}var n=this.taskStore||this.assignmentStore.getTaskStore(),h=n&&n.getByInternalId(m),j;if(h){j=h.assignments}else{if(!this.assignmentStore){return false}j=this.assignmentStore.queryBy(function(a){return a.getTaskId()==m})}this.taskId=m;var i=this.store,l=this.resourceDupStore,k=Gnt.util.Data.cloneModelSet(j,function(c,d){var a=d.getResourceId();var b=l.queryBy(function(e){var f=e.originalRecord;return(f.getId()||f.internalId)==a});if(b.getCount()){b=b.first();c.setResourceId(b.getId()||b.internalId)}});i.loadData(k);return true},insertAssignment:function(h,j){if(!this.store){return}var m=this.store.model.prototype,n={};if(h){n=h}else{n[m.unitsField]=this.defaultAssignedUnits}n[m.taskIdField]=this.taskId;var l=this.store.insert(0,n);var k=this,i=l[0].isValid;l[0].isValid=function(){return i.apply(this,arguments)&&k.isValidAssignment(this)};if(!j){this.cellEditing.startEditByPosition({row:0,column:0})}return l},isValid:function(){var b=true;this.store.each(function(a){if(!a.isValid()){b=false;return false}});return b},getAssignmentErrors:function(d){var c=d.getResourceId();if(!c){return[this.L("noValueText")]}if(!this.resourceDupStore.getByInternalId(c)){return[Ext.String.format(this.L("noResourceText"),c)]}},isValidAssignment:function(b){return !this.getAssignmentErrors(b)},buildPlugins:function(){var d=this.cellEditing=Ext.create("Ext.grid.plugin.CellEditing",{clicksToEdit:1});var c=d.startEdit;d.startEdit=function(){this.completeEdit();return c.apply(this,arguments)};d.on({beforeedit:this.onEditingStart,scope:this});return[d]},hide:function(){this.cellEditing.cancelEdit();return this.callParent(arguments)},onEditingStart:function(e,f){var d=this.store.model.prototype;if(f.field==d.resourceIdField){this.assignment=f.record;this.resourceId=f.record.getResourceId();this.resourceComboStore.loadData(this.resourceDupStore.getRange());this.resourceComboStore.filter(this.resourcesFilter)}},resourceRender:function(f,j,i){var h=this.getAssignmentErrors(i);if(h&&h.length){j.tdCls=Ext.baseCSSPrefix+"form-invalid";j.tdAttr='data-errorqtip="'+h.join("<br>")+'"'}else{j.tdCls="";j.tdAttr='data-errorqtip=""'}var g=this.resourceDupStore.getByInternalId(f);return Ext.String.htmlEncode((g&&g.getName())||f)},filterResources:function(h){var g=h.getInternalId(),e=Gnt.model.Assignment.prototype.resourceIdField,f=true;if(g!==this.resourceId){this.store.each(function(a){if(g==a.get(e)){f=false;return false}})}return f},onResourceComboAssert:function(m){var n=m.getRawValue();if(n){var j=this.resourceDupStore.findExact(m.displayField,n);var i=j!==-1?this.resourceDupStore.getAt(j):false;if(!i){var k=this.assignment;var o=this;var p=function(c){var b=Gnt.model.Resource.prototype,d={};d[b.nameField]=m.rawValue;d=Ext.ModelManager.create(d,Gnt.model.Resource);d.setId(d.internalId);var a=o.resourceDupStore.add(d);if(a&&a.length){if(!c){m.getStore().add(d);m.setValue(a[0].getId())}else{k.setResourceId(a[0].getId())}}};if(this.confirmAddResource){var l=Ext.String.format(this.L("confirmAddResourceText"),Ext.String.htmlEncode(n));Ext.Msg.confirm(this.L("confirmAddResourceTitle"),l,function(a){if(a=="yes"){p(true)}})}else{p()}}else{m.select(i,true)}}},buildColumns:function(){var b=this;this.resourceCombo=new Ext.form.field.ComboBox({queryMode:"local",store:this.resourceComboStore,allowBlank:false,editing:this.addResources,validateOnChange:false,autoSelect:false,forceSelection:!this.addResources,valueField:Gnt.model.Resource.prototype.idProperty,displayField:Gnt.model.Resource.prototype.nameField,queryCaching:false,listConfig:{getInnerTpl:function(){return"{"+this.displayField+":htmlEncode}"}}});if(this.addResources){this.resourcesFilter=Ext.create("Ext.util.Filter",{filterFn:this.filterResources,scope:this});Ext.Function.interceptBefore(this.resourceCombo,"assertValue",function(){b.onResourceComboAssert(this)})}return[{xtype:"resourcenamecolumn",editor:this.resourceCombo,dataIndex:Gnt.model.Assignment.prototype.resourceIdField,renderer:this.resourceRender,scope:this},{xtype:"assignmentunitscolumn",assignmentStore:this.assignmentStore,editor:{xtype:"percentfield",step:10}}]},saveResources:function(){Gnt.util.Data.applyCloneChanges(this.resourceDupStore,this.resourceStore)},saveTaskAssignments:function(){this.resourceStore.suspendEvents(true);this.assignmentStore.suspendEvents(true);this.saveResources();var d=this.store.model,f=this.resourceDupStore,e=true;Gnt.util.Data.applyCloneChanges(this.store,this.assignmentStore,function(a){var b=f.getByInternalId(this.getResourceId());if(!b||!b.originalRecord){e=false;return}var c=b.originalRecord;a[d.prototype.resourceIdField]=c.getId()||c.internalId});this.resourceStore.resumeEvents();this.assignmentStore.resumeEvents();return e}});Ext.define("Gnt.widget.DependencyGrid",{extend:"Ext.grid.Panel",alias:"widget.dependencygrid",requires:["Ext.data.JsonStore","Ext.grid.plugin.CellEditing","Ext.form.field.ComboBox","Ext.util.Filter","Gnt.model.Dependency","Gnt.util.Data","Gnt.field.Duration"],mixins:["Gnt.mixin.Localizable"],readOnly:false,showCls:false,cls:"gnt-dependencygrid",task:null,dependencyStore:null,taskModel:null,direction:"predecessors",oppositeStore:null,taskStoreListeners:null,refreshTimeout:100,allowParentTaskDependencies:false,useSequenceNumber:false,constructor:function(c){c=c||{};Ext.Array.each(["idText","taskText","blankTaskText","invalidDependencyText","parentChildDependencyText","duplicatingDependencyText","transitiveDependencyText","cyclicDependencyText","typeText","lagText","clsText","endToStartText","startToStartText","endToEndText","startToEndText"],function(a){if(a in c){this[a]=c[a]}},this);this.store=c.store||new Ext.data.JsonStore({model:"Gnt.model.Dependency"});if(!this.readOnly){this.plugins=this.buildPlugins()}this.direction=c.direction||this.direction;if(!c.taskModel){c.taskModel=Ext.ClassManager.get("Gnt.model.Task");if(c.dependencyStore){var d=c.dependencyStore.getTaskStore();if(d){c.taskModel=d.model}}}if(c.oppositeStore){this.setOppositeStore(c.oppositeStore)}if(c.task){this.loadDependencies(c.task)}this.callParent([c])},initComponent:function(){this.columns=this.buildColumns();this.callParent(arguments)},destroy:function(){this.cellEditing.destroy();if(this.deferredStoreBind){this.tasksCombo.un("render",this.bindTaskStore,this)}this.tasksCombo.destroy();this.lagEditor.destroy();this.callParent(arguments)},setTask:function(d){if(!d){return}this.task=d;var c=d.dependencyStore||d.getTaskStore().dependencyStore;if(c&&c!==this.dependencyStore){this.dependencyStore=c;if(this.typesCombo){this.typesCombo.store.filter()}this.mon(this.dependencyStore,{datachanged:function(){this.loadDependencies()},scope:this})}},buildPlugins:function(){var b=this.cellEditing=new Ext.grid.plugin.CellEditing({clicksToEdit:1});b.on({beforeedit:this.onEditingStart,edit:this.onEditingDone,scope:this});return[b]},hide:function(){this.cellEditing.cancelEdit();this.callParent(arguments)},onEditingStart:function(e,f){var d=this.store.model.prototype;switch(f.field){case d.lagField:this.lagEditor.durationUnit=f.record.getLagUnit();break;case d.typeField:this.typesCombo.store.filter();if(this.typesCombo.store.count()<2){return false}break}},onEditingDone:function(e,f){var d=this.store.model.prototype;if(f.field==d.lagField){f.record.setLagUnit(this.lagEditor.durationUnit)}this.getView().refresh()},dependencyTypeRender:function(c){var d=this.store.model.Type;switch(c){case d.EndToStart:return this.L("endToStartText");case d.StartToStart:return this.L("startToStartText");case d.EndToEnd:return this.L("endToEndText");case d.StartToEnd:return this.L("startToEndText")}return c},taskValidate:function(d,e){if(!d){return[this.L("blankTaskText")]}if(!e.isValid()){var f=this.getDependencyErrors(e);if(f&&f.length){return f}return[this.L("invalidDependencyText")]}},taskRender:function(k,j,g){var i=this.taskValidate(k,g),h;if(i&&i.length){j.tdCls=Ext.baseCSSPrefix+"form-invalid";j.tdAttr='data-errorqtip="'+i.join("<br>")+'"'}else{j.tdCls="";j.tdAttr='data-errorqtip=""'}var l=this.dependencyStore&&this.dependencyStore.getTaskStore();if(l){h=l.getById(k)||l.getByInternalId(k);return(h&&Ext.String.htmlEncode(h.getName()))||""}return""},filterTasks:function(f){var h=this,e=f.getInternalId(),g;if(this.direction==="predecessors"){g="getSourceId"}else{g="getTargetId"}return e!=this.task.getInternalId()&&!this.task.contains(f)&&!f.contains(this.task)&&(this.allowParentTaskDependencies||f.isLeaf())},bindTaskStore:function(){var h=this.dependencyStore&&this.dependencyStore.getTaskStore();if(h){if(!this.taskStoreListeners){var g=Ext.Function.createBuffered(this.bindTaskStore,this.refreshTimeout,this,[]);this.taskStoreListeners=this.mon(h,{append:g,insert:g,update:g,remove:g,refresh:g,clear:g,"nodestore-datachange-end":g,scope:this,destroyable:true})}var e=new Ext.data.JsonStore({model:h.model,sorters:h.model.prototype.nameField});var f=h.tree.getRootNode();e.loadData(Gnt.util.Data.cloneModelSet(h.tree.flatten(),function(a,b){if(b===f||b.hidden){return false}if(!b.getId()){a.setId(b.getPhantomId())}}));this.tasksFilter=new Ext.util.Filter({filterFn:this.filterTasks,scope:this});e.filter(this.tasksFilter);this.tasksCombo.bindStore(e)}},buildTasksCombo:function(){var b=this;return new Ext.form.field.ComboBox({queryMode:"local",alowBlank:false,editing:false,forceSelection:true,valueField:this.taskModel.prototype.idProperty,displayField:this.taskModel.prototype.nameField,queryCaching:false,listConfig:{getInnerTpl:function(){return"{"+this.displayField+":htmlEncode}"}},validator:function(a){if(!a){return b.L("blankTaskText")}return true}})},filterAllowedTypes:function(g){if(!this.dependencyStore||!this.dependencyStore.allowedDependencyTypes){return true}var j=this.dependencyStore.allowedDependencyTypes;var i=this.store.model.Type;for(var l=0,h=j.length;l<h;l++){var k=i[j[l]];if(g.getId()==k){return true}}return false},buildTypesCombo:function(){var c=this.store.model.Type;this.typesFilter=new Ext.util.Filter({filterFn:this.filterAllowedTypes,scope:this});var d=new Ext.data.ArrayStore({fields:[{name:"id",type:"int"},"text"],data:[[c.EndToStart,this.L("endToStartText")],[c.StartToStart,this.L("startToStartText")],[c.EndToEnd,this.L("endToEndText")],[c.StartToEnd,this.L("startToEndText")]]});d.filter(this.typesFilter);return new Ext.form.field.ComboBox({triggerAction:"all",queryMode:"local",editable:false,valueField:"id",displayField:"text",store:d})},buildColumns:function(){var k=this,g=this.store.model.prototype,i=this.store.model.Type,j=[],h=this.dependencyStore&&this.dependencyStore.getTaskStore();this.tasksCombo=this.buildTasksCombo();if(!h){this.deferredStoreBind=true;this.tasksCombo.on("render",this.bindTaskStore,this)}else{this.bindTaskStore()}var l={};if(this.useSequenceNumber){l={text:this.L("snText"),dataIndex:g.fromField,renderer:function(b,a,e){var d=k.dependencyStore&&k.dependencyStore.getTaskStore(),c=d&&d.getNodeById(e.get("From"));return c?c.getSequenceNumber():""},width:50}}else{l={text:this.L("idText"),dataIndex:g.fromField,width:50}}if(this.direction==="predecessors"){j.push(l,{text:this.L("taskText"),dataIndex:g.fromField,flex:1,editor:this.tasksCombo,renderer:function(b,a,c){return k.taskRender(b,a,c)}})}else{j.push(l,{text:this.L("taskText"),dataIndex:g.toField,flex:1,editor:this.tasksCombo,renderer:function(b,a,c){return k.taskRender(b,a,c)}})}this.lagEditor=new Gnt.field.Duration({minValue:Number.NEGATIVE_INFINITY});this.typesCombo=this.buildTypesCombo();j.push({text:this.L("typeText"),dataIndex:g.typeField,width:120,renderer:function(a){return k.dependencyTypeRender(a)},editor:this.typesCombo},{text:this.L("lagText"),dataIndex:g.lagField,width:100,editor:this.lagEditor,renderer:function(b,a,c){return k.lagEditor.valueToVisible(b,c.get(g.lagUnitField),2)}},{text:this.L("clsText"),dataIndex:g.clsField,hidden:!this.showCls,width:100});return j},insertDependency:function(i,k){if(!this.dependencyStore){return}var n=this.task.getInternalId(),o=this.store.model.prototype,p={},l=this;if(i){p=i}else{p[o.typeField]=this.typesCombo.store.getAt(0).getId();p[o.lagField]=0;p[o.lagUnitField]="d"}if(this.direction==="predecessors"){p[o.toField]=n}else{p[o.fromField]=n}var m=this.store.insert(0,p);if(m.length){var j=m[0].isValid;m[0].isValid=function(){return j.call(this,false)&&l.isValidDependency(this)}}if(!k){this.cellEditing.startEditByPosition({row:0,column:1})}return m},onOppositeStoreChange:function(){this.getView().refresh()},setOppositeStore:function(d){var c={update:this.onOppositeStoreChange,datachanged:this.onOppositeStoreChange,scope:this};if(this.oppositeStore){this.mun(this.oppositeStore,c)}this.oppositeStore=d;this.mon(this.oppositeStore,c)},loadDependencies:function(e){var h=this;e=e||this.task;if(!e){return}if(this.task!==e){this.setTask(e)}var g;if(this.direction==="predecessors"){g=e.getIncomingDependencies(true);if(!this.oppositeStore){this.oppositeData=e.getOutgoingDependencies(true)}}else{g=e.getOutgoingDependencies(true);if(!this.oppositeStore){this.oppositeData=e.getIncomingDependencies(true)}}var f=Gnt.util.Data.cloneModelSet(g,function(a){var b=a.isValid;a.isValid=function(){return b.call(this,false)&&h.isValidDependency(this)}});this.store.loadData(f);this.fireEvent("loaddependencies",this,this.store,f,e)},getDependencyErrors:function(t){var o=this,m=o.dependencyStore,s=o.task.getInternalId(),u=s,n=[];if(o.direction==="predecessors"){s=t.getSourceId()}else{u=t.getTargetId()}var q=m.getSourceTask(s);var r=m.getTargetTask(u);o.store.each(function(c){var a=c.getSourceId(),b=c.getTargetId();if((s==a)&&(u==b)&&(c!==t)){n.push(o.L("duplicatingDependencyText"));return false}});if(n.length){return n}var l=o.store.getRange();l.splice(Ext.Array.indexOf(l,t),1);var v=o.task[o.direction];var p=m.getDependencyError(t,l,v);if(p){switch(p){case -3:case -8:case -5:case -6:return[o.L("transitiveDependencyText")];case -4:case -7:return[o.L("cyclicDependencyText")];case -9:return[o.L("parentChildDependencyText")]}return[this.L("invalidDependencyText")]}return n},isValidDependency:function(d){var c=this.getDependencyErrors(d);return !c||!c.length},isValid:function(){var b=true;this.store.each(function(a){if(!a.isValid()){b=false;return false}});return b},saveDependencies:function(){if(!this.dependencyStore||!this.isValid()){return}Gnt.util.Data.applyCloneChanges(this.store,this.dependencyStore)}});Ext.define("Gnt.widget.taskeditor.TaskForm",{extend:"Ext.form.Panel",alias:"widget.taskform",requires:["Gnt.model.Task","Ext.form.FieldContainer","Ext.form.field.Text","Ext.form.field.Date","Gnt.field.Percent","Gnt.field.StartDate","Gnt.field.EndDate","Gnt.field.Duration","Gnt.field.SchedulingMode","Gnt.field.Effort"],mixins:["Gnt.mixin.Localizable"],alternateClassName:["Gnt.widget.TaskForm"],task:null,taskBuffer:null,taskStore:null,highlightTaskUpdates:true,showBaseline:true,editBaseline:false,showCalendar:false,showSchedulingMode:false,taskNameConfig:null,durationConfig:null,startConfig:null,finishConfig:null,percentDoneConfig:null,baselineStartConfig:null,baselineFinishConfig:null,baselinePercentDoneConfig:null,effortConfig:null,calendarConfig:null,schedulingModeConfig:null,constructor:function(c){c=c||{};this.showBaseline=c.showBaseline;this.editBaseline=c.editBaseline;var d=Gnt.model.Task.prototype;this.fieldNames={baselineEndDateField:d.baselineEndDateField,baselinePercentDoneField:d.baselinePercentDoneField,baselineStartDateField:d.baselineStartDateField,calendarIdField:d.calendarIdField,clsField:d.clsField,draggableField:d.draggableField,durationField:d.durationField,durationUnitField:d.durationUnitField,effortField:d.effortField,effortUnitField:d.effortUnitField,endDateField:d.endDateField,manuallyScheduledField:d.manuallyScheduledField,nameField:d.nameField,percentDoneField:d.percentDoneField,resizableField:d.resizableField,schedulingModeField:d.schedulingModeField,startDateField:d.startDateField,noteField:d.noteField};Ext.apply(this,c,{border:false,layout:"anchor",defaultType:"textfield"});if(this.task){this.fieldNames=this.getFieldNames(this.task)}if(!this.items){this.buildFields()}this.callParent(arguments);if(this.task){this.loadRecord(this.task,this.taskBuffer)}},getFieldNames:function(d){if(!d){return}var e={};for(var f in this.fieldNames){e[f]=d[f]}return e},renameFields:function(g){var h=this.getFieldNames(g);if(!h){return}var k=this.getForm(),i=false,j;for(var l in this.fieldNames){j=k.findField(this.fieldNames[l]);if(j&&h[l]&&h[l]!=j.name){i=true;j.name=h[l]}}if(i){this.fieldNames=h}},buildFields:function(){var o=this,n=this.fieldNames,p=this.task,f=this.taskStore,k='<table class="gnt-fieldcontainer-label-wrap"><td width="1" class="gnt-fieldcontainer-label">',l='<td><div class="gnt-fieldcontainer-separator"></div></table>';var m=function(a){return p?p.get(n[a]):""};var j=function(a,c){var b={taskStore:o.taskStore,task:o.task,highlightTaskUpdates:o.highlightTaskUpdates};if(!a.readOnly&&o.task){b.readOnly=!o.task.isEditable(a.name)}return Ext.apply(a,b,c)};this.items=this.items||[];this.items.push.call(this.items,{xtype:"fieldcontainer",layout:"hbox",defaults:{allowBlank:false},items:[j({xtype:"textfield",fieldLabel:this.L("taskNameText"),name:n.nameField,labelWidth:110,flex:1,value:m(n.nameField)},this.taskNameConfig),j({xtype:"durationfield",fieldLabel:this.L("durationText"),name:n.durationField,margins:"0 0 0 6",labelWidth:90,width:170,value:m(n.durationField)},this.durationConfig)]},j({xtype:"percentfield",fieldLabel:this.L("percentDoneText"),name:n.percentDoneField,labelWidth:110,width:200,allowBlank:false,value:m(n.percentDoneField)},this.percentDoneConfig),{xtype:"fieldcontainer",fieldLabel:this.L("datesText"),labelAlign:"top",labelSeparator:"",beforeLabelTextTpl:k,afterLabelTextTpl:l,layout:"hbox",defaults:{labelWidth:110,flex:1,allowBlank:false},items:[j({xtype:"startdatefield",fieldLabel:this.L("startText"),name:n.startDateField,value:m(n.startDateField)},this.startConfig),j({xtype:"enddatefield",fieldLabel:this.L("finishText"),name:n.endDateField,margins:"0 0 0 6",value:m(n.endDateField)},this.finishConfig)]},j({xtype:"effortfield",fieldLabel:this.L("effortText"),name:n.effortField,invalidText:this.L("invalidEffortText"),labelWidth:110,width:200,margins:"0 0 0 6",allowBlank:true,value:m(n.effortField)},this.effortConfig));if(this.showBaseline){this.items.push.call(this.items,{xtype:"fieldcontainer",fieldLabel:this.L("baselineText"),labelAlign:"top",labelSeparator:"",beforeLabelTextTpl:k,afterLabelTextTpl:l,layout:"hbox",defaultType:"datefield",defaults:{labelWidth:110,flex:1,cls:"gnt-baselinefield"},items:[j({fieldLabel:this.L("baselineStartText"),name:n.baselineStartDateField,value:m(n.baselineStartDateField),readOnly:!this.editBaseline},this.baselineStartConfig),j({fieldLabel:this.L("baselineFinishText"),name:n.baselineEndDateField,margins:"0 0 0 6",value:m(n.baselineEndDateField),readOnly:!this.editBaseline},this.baselineFinishConfig)]},j({xtype:"percentfield",fieldLabel:this.L("baselinePercentDoneText"),name:n.baselinePercentDoneField,labelWidth:110,width:200,cls:"gnt-baselinefield",value:m(n.baselinePercentDoneField),readOnly:!this.editBaseline},this.baselinePercentDoneConfig))}if(this.showCalendar){this.items.push(j({xtype:"calendarfield",fieldLabel:this.L("calendarText"),name:n.calendarIdField,value:m(n.calendarIdField)},this.calendarConfig))}if(this.showSchedulingMode){this.items.push(j({xtype:"schedulingmodefield",fieldLabel:this.L("schedulingModeText"),name:n.schedulingModeField,value:m(n.schedulingModeField),allowBlank:false},this.schedulingModeConfig))}},setSuppressTaskUpdate:function(c){var d=this.getForm().getFields();d.each(function(a){a.setSuppressTaskUpdate&&a.setSuppressTaskUpdate(c)})},loadRecord:function(e,f){if(e&&e!==this.task){this.renameFields(e)}this.task=e;this.taskBuffer=f;if(!this.taskBuffer){this.taskBuffer=e.copy();this.taskBuffer.taskStore=e.taskStore}var g=this,h=g.getForm();h._record=e;this.suspendLayouts();Ext.iterate(e.getData(),function(c,a){var b=h.findField(c);if(b){if(b.setTask){b.setSuppressTaskUpdate(true);b.setTask(g.taskBuffer);b.setSuppressTaskUpdate(false)}else{b.setValue(a);if(!b.disabled){if(b.editable===false){if(!g.taskBuffer.isEditable(b.name)){b.setReadOnly(true)}else{if(b.inputEl){b.setReadOnly(false);b.inputEl.dom.readOnly=true}}}else{b.setReadOnly(!g.taskBuffer.isEditable(b.name))}}}if(h.trackResetOnLoad){b.resetOriginalValue()}}});this.resumeLayouts(true);this.fireEvent("afterloadrecord",this,e)},updateRecord:function(c){c=c||this.task;var d=Ext.Function.bind(function(){this.setSuppressTaskUpdate(true);var a=this.getForm().getFields();c.beginEdit();a.each(function(b){if(b.applyChanges){b.applyChanges(c)}else{var f=c.fields.getByKey(b.name);if(f&&f.persist){c.set(b.name,b.getValue())}}});c.endEdit();this.setSuppressTaskUpdate(false);this.fireEvent("afterupdaterecord",this,c)},this);if(c&&this.fireEvent("beforeupdaterecord",this,c,d)!==false){d();return true}return false}});Ext.define("Gnt.widget.taskeditor.TaskEditor",{extend:"Ext.tab.Panel",alias:"widget.taskeditor",requires:["Ext.form.Panel","Gnt.widget.taskeditor.TaskForm","Gnt.widget.AssignmentEditGrid","Gnt.widget.DependencyGrid","Gnt.field.Calendar","Gnt.field.SchedulingMode","Ext.form.field.HtmlEditor","Gnt.util.Data"],mixins:["Gnt.mixin.Localizable"],margin:"5 0 0 0",alternateClassName:["Gnt.widget.TaskEditor"],border:false,plain:true,defaults:{margin:5,border:false},task:null,taskStore:null,assignmentStore:null,resourceStore:null,taskFormClass:"Gnt.widget.taskeditor.TaskForm",advancedFormClass:"Gnt.widget.taskeditor.TaskForm",showAssignmentGrid:true,showDependencyGrid:true,allowParentTaskDependencies:false,showNotes:true,showStyle:true,showAdvancedForm:true,showBaseline:true,tabsConfig:null,taskFormConfig:null,dependencyGridClass:"Gnt.widget.DependencyGrid",dependencyGridConfig:null,assignmentGridClass:"Gnt.widget.AssignmentEditGrid",assignmentGridConfig:null,styleFormConfig:null,advancedFormConfig:null,notesConfig:null,height:340,width:600,layout:"fit",tabs:null,taskForm:null,assignmentGrid:null,dependencyGrid:null,advancedForm:null,stylingText:"Styling",clsText:"CSS Class",backgroundText:"Background",doneBackgroundText:"Progress Background",clonedStores:null,constructor:function(h){var k=this,l=Gnt.model.Task.prototype;h=h||{};Ext.apply(this,h);this.taskFormConfig=this.taskFormConfig||{};Ext.applyIf(this.taskFormConfig,{showBaseline:this.showBaseline});var m=this.clonedStores=(this.task||this.taskStore)?this.cloneStores():{};var i=[];this.taskForm=Ext.create(this.taskFormClass||"Gnt.widget.taskeditor.TaskForm",Ext.applyIf(this.taskFormConfig,{task:this.task,taskStore:this.taskStore}));i.push(this.taskForm);if(this.showDependencyGrid){this.dependencyGrid=Ext.create(this.dependencyGridClass,Ext.apply({allowParentTaskDependencies:this.allowParentTaskDependencies,taskModel:this.taskStore.model,task:this.task,margin:5,tbar:{layout:"auto",items:[{xtype:"button",iconCls:"gnt-action-add",text:this.L("addDependencyText"),handler:function(){k.dependencyGrid.insertDependency()}},{xtype:"button",iconCls:"gnt-action-remove",text:this.L("dropDependencyText"),itemId:"drop-dependency-btn",disabled:true,handler:function(){var a=k.dependencyGrid.getSelectionModel().getSelection();if(a&&a.length){k.dependencyGrid.store.remove(a)}}}]},listeners:{selectionchange:function(a,b){var c=k.dependencyGrid;if(!c.dropDepBtn){c.dropDepBtn=c.down("#drop-dependency-btn")}c.dropDepBtn&&c.dropDepBtn.setDisabled(!b.length)}}},this.dependencyGridConfig));i.push(this.dependencyGrid)}if(this.showAssignmentGrid&&this.assignmentStore&&this.resourceStore){if(!m.assignmentStore){m.assignmentStore=this.cloneAssignmentStore(this.task)}if(!m.resourceStore){m.resourceStore=this.cloneResourceStore(this.task)}this.assignmentGrid=Ext.create(this.assignmentGridClass,Ext.apply({assignmentStore:this.assignmentStore,resourceStore:this.resourceStore,store:m.assignmentStore,resourceDupStore:m.resourceStore,tbar:{layout:"auto",items:[{xtype:"button",iconCls:"gnt-action-add",text:this.L("addAssignmentText"),handler:function(){k.assignmentGrid.insertAssignment()}},{xtype:"button",iconCls:"gnt-action-remove",text:this.L("dropAssignmentText"),itemId:"drop-assignment-btn",disabled:true,handler:function(){var a=k.assignmentGrid.getSelectionModel().getSelection();if(a&&a.length){k.assignmentGrid.store.remove(a)}}}]},listeners:{afterrender:{fn:function(a){a.loadTaskAssignments(k.task.get(k.task.idProperty))},single:true},selectionchange:function(a,b){var c=k.assignmentGrid;if(!c.dropBtn){c.dropBtn=c.down("#drop-assignment-btn")}c.dropBtn&&c.dropBtn.setDisabled(!b.length)}}},this.assignmentGridConfig));i.push(this.assignmentGrid)}if(this.showAdvancedForm){var j=Ext.ClassManager.get(this.advancedFormClass||"Gnt.widget.taskeditor.TaskForm").prototype;this.advancedFormConfig=this.advancedFormConfig||{};this.advancedForm=Ext.create(this.advancedFormClass||"Gnt.widget.taskeditor.TaskForm",Ext.applyIf(this.advancedFormConfig,{items:[{xtype:"calendarfield",fieldLabel:j.L("calendarText"),name:this.task?this.task.calendarIdField:l.calendarIdField,value:this.task&&this.task.getCalendarId(true),taskStore:this.taskStore,task:this.task},{xtype:"schedulingmodefield",fieldLabel:j.L("schedulingModeText"),name:this.task?this.task.schedulingModeField:l.schedulingModeField,value:this.task&&this.task.getSchedulingMode(),allowBlank:false,taskStore:this.taskStore,task:this.task},{xtype:"displayfield",fieldLabel:this.L("wbsCodeText"),name:"wbsCode",value:this.task&&this.task.getWBSCode()}],task:this.task,taskStore:this.taskStore}));i.push(this.advancedForm)}if(this.showNotes){this.notesEditor=Ext.create("Ext.form.field.HtmlEditor",Ext.apply({listeners:{afterrender:function(a){k.notesEditor.setValue(k.task.get(k.task.noteField))}}},this.notesConfig));this.notesPanel=Ext.create("Ext.panel.Panel",{border:false,layout:"fit",items:this.notesEditor});i.push(this.notesPanel)}if(!this.taskForm.title){this.taskForm.title=this.L("generalText")}if(this.dependencyGrid&&!this.dependencyGrid.title){this.dependencyGrid.title=this.L("dependencyText")}if(this.assignmentGrid&&!this.assignmentGrid.title){this.assignmentGrid.title=this.L("resourcesText")}if(this.advancedForm&&!this.advancedForm.title){this.advancedForm.title=this.L("advancedText")}if(this.notesPanel&&!this.notesPanel.title){this.notesPanel.title=this.L("notesText")}if(this.styleForm&&!this.styleForm.title){this.styleForm.title=this.stylingText}var n=this.items||(this.tabsConfig&&this.tabsConfig.items);if(n){i.push.apply(i,Ext.isArray(n)?n:[n]);delete h.items;if(this.tabsConfig&&this.tabsConfig.items){delete this.tabsConfig.items}}this.items=i;Ext.apply(this,this.tabsConfig);if(i.length<=1){h.tabBar=h.tabBar||{};Ext.applyIf(h.tabBar,{hidden:true})}this.tabs=this;this.callParent(arguments)},getTaskStore:function(){return this.taskStore||this.task&&this.task.getTaskStore()},cloneTaskStore:function(d,f){var e=this.getTaskStore();if(!e){return null}return new (Ext.getClass(e))(Ext.apply({isCloned:true,calendar:e.getCalendar(),model:e.model,weekendsAreWorkdays:e.weekendsAreWorkdays,cascadeChanges:e.cascadeChanges,batchSync:false,recalculateParents:false,skipWeekendsDuringDragDrop:e.skipWeekendsDuringDragDrop,moveParentAsGroup:e.moveParentAsGroup,enableDependenciesForParentTasks:e.enableDependenciesForParentTasks,availabilitySearchLimit:e.availabilitySearchLimit,dependenciesCalendar:"project",proxy:{type:"memory",reader:{type:"json"}}},f))},cloneDependencyStore:function(e,g){var h=this.getTaskStore();var f=this.dependencyStore||h&&h.getDependencyStore();if(!f){return null}return new (Ext.getClass(f))(Ext.apply({isCloned:true,model:f.model,strictDependencyValidation:f.strictDependencyValidation,allowedDependencyTypes:f.allowedDependencyTypes,proxy:{type:"memory",reader:{type:"json"}}},g))},cloneAssignmentStore:function(e,g){var h=this.getTaskStore();var f=this.assignmentStore||h&&h.getAssignmentStore();if(!f){return null}return new (Ext.getClass(f))(Ext.apply({isCloned:true,model:f.model,proxy:{type:"memory",reader:{type:"json"}}},g))},cloneResourceStore:function(e,g){var h=this.getTaskStore();var f=this.resourceStore||h&&h.getResourceStore();if(!f){return null}return new (Ext.getClass(f))(Ext.apply({isCloned:true,model:f.model,proxy:{type:"memory",reader:{type:"json"}}},g))},cloneStores:function(k){var h=this.task,j=this.cloneResourceStore(h,k&&k.resourceStore),i=this.cloneAssignmentStore(h,k&&k.assignmentStore),l=this.cloneDependencyStore(h,k&&k.dependencyStore);var g=this.cloneTaskStore(h,Ext.apply({assignmentStore:i,resourceStore:j,dependencyStore:l},k&&k.taskStore));return{resourceStore:j,assignmentStore:i,dependencyStore:l,taskStore:g}},cloneTask:function(b){return b.copy(b.getInternalId(),false)},bindDependencyGrid:function(){var d=this.clonedStores.dependencyStore;var c=this.dependencyGrid;c.store.taskStore=this.clonedStores.taskStore;if(d){this.mon(c,{loaddependencies:function(a,b){d.loadData(b.getRange().concat(Gnt.util.Data.cloneModelSet(a.oppositeData)))}});this.mon(c.store,{add:function(a,b){d.add(b)},remove:function(a,b){d.remove(b)}});this.dependencyGridBound=true}},loadTask:function(u){if(!u){return}var q=this;this.task=u;var v=this.taskForm;v.setSuppressTaskUpdate(true);v.getForm().reset();var m=this.clonedStores;var p=this.getTaskStore();var r=this.cloneTask(u);var t=[r];Ext.Array.each(u.predecessors,function(b){var a=q.cloneTask(b.getSourceTask());a.taskStore=m.taskStore;t.push(a)});Ext.Array.each(u.successors,function(b){var a=q.cloneTask(b.getTargetTask());a.taskStore=m.taskStore;t.push(a)});if(!m.dependencyStore){m.dependencyStore=this.cloneDependencyStore(u)}if(!m.assignmentStore){m.assignmentStore=this.cloneAssignmentStore(u)}if(!m.resourceStore){m.resourceStore=this.cloneResourceStore(u)}if(!m.taskStore){m.taskStore=this.cloneTaskStore(u,{assignmentStore:m.assignmentStore,resourceStore:m.resourceStore,dependencyStore:m.dependencyStore})}r.taskStore=m.taskStore;var x=function(b,a){b.setId(a.getId())};var s=this.assignmentGrid;if(s){if(m.assignmentStore!==s.getStore()){s.reconfigure(m.assignmentStore)}if(s.resourceDupStore!==m.resourceStore){s.resourceDupStore=m.resourceStore}s.loadResources();s.loadTaskAssignments(u.getId()||u.getPhantomId())}else{if(m.resourceStore){m.resourceStore.loadData(Gnt.util.Data.cloneModelSet(this.resourceStore||this.getTaskStore().getResourceStore(),x))}if(m.assignmentStore){m.assignmentStore.loadData(Gnt.util.Data.cloneModelSet(u.assignments,x))}}var n=this.dependencyGrid;if(n){if(!this.dependencyGridBound){this.bindDependencyGrid()}n.loadDependencies(u);if(this.allowParentTaskDependencies||u.isLeaf()){n.tab.show()}else{n.tab.hide()}}else{if(m.dependencyStore){m.dependencyStore.loadData(Gnt.util.Data.cloneModelSet(u.getAllDependencies(),x))}}m.taskStore.setRootNode({expanded:true,children:t});v.loadRecord(u,r);if(this.advancedForm){this.advancedForm.setSuppressTaskUpdate(true);var w=this.advancedForm.getForm();w.reset();this.advancedForm.loadRecord(u,v.taskBuffer);var o=w.findField("wbsCode");if(o){o.setValue(u.getWBSCode())}this.advancedForm.setSuppressTaskUpdate(false)}v.setSuppressTaskUpdate(false);if(this.styleForm){this.styleForm.loadRecord(u)}if(this.notesEditor){this.notesEditor.setValue(u.get(u.noteField))}this.fireEvent("loadtask",this,u)},getTabByComponent:function(c){var d;this.items.each(function(a){if(c===a||c.isDescendantOf(a)){d=a;return false}},this);return d},validate:function(){var d=this.getActiveTab(),e=true,f;if(d){if(!this.taskForm.isValid()){if(this.taskForm===d||this.taskForm.isDescendantOf(d)){return false}e=false;f=this.getTabByComponent(this.taskForm)}if(this.dependencyGrid&&!this.dependencyGrid.isValid()){if(this.dependencyGrid===d||this.dependencyGrid.isDescendantOf(d)){return false}e=false;f=f||this.getTabByComponent(this.dependencyGrid)}if(this.assignmentGrid&&!this.assignmentGrid.isValid()){if(this.assignmentGrid===d||this.assignmentGrid.isDescendantOf(d)){return false}e=false;f=f||this.getTabByComponent(this.assignmentGrid)}if(this.advancedForm&&!this.advancedForm.isValid()){if(this.advancedForm===d||this.advancedForm.isDescendantOf(d)){return false}e=false;f=f||this.getTabByComponent(this.advancedForm)}}if(f){this.setActiveTab(f)}return(this.fireEvent("validate",this,f)!==false)&&e},updateTask:function(){var b=Ext.Function.bind(function(){this.taskForm.updateRecord();if(this.advancedForm){this.advancedForm.updateRecord()}if(this.notesEditor){this.task.set(this.task.noteField,this.notesEditor.getValue())}if(this.styleForm){this.styleForm.getForm().updateRecord()}if(this.assignmentGrid){this.assignmentGrid.saveTaskAssignments()}if(this.dependencyGrid){this.dependencyGrid.saveDependencies()}this.fireEvent("afterupdatetask",this)},this);if(this.fireEvent("beforeupdatetask",this,b)!==false){b();return true}return false},onDestroy:function(){if(this.clonedStores.taskStore){this.clonedStores.taskStore.destroy()}this.callParent(arguments)}});Ext.define("Gnt.plugin.TaskEditor",{extend:"Ext.window.Window",requires:["Ext.window.MessageBox","Gnt.widget.taskeditor.TaskEditor"],alias:"plugin.gantt_taskeditor",mixins:["Ext.AbstractPlugin","Gnt.mixin.Localizable"],lockableScope:"top",taskEditor:null,panelConfig:null,height:340,width:600,layout:"fit",triggerEvent:"taskdblclick",closeAction:"hide",modal:true,gantt:null,assignmentStore:null,resourceStore:null,taskStore:null,constructor:function(b){b=b||{};Ext.apply(this,b);this.title=this.L("title");if(!b.buttons){this.buttons=["->",{text:this.L("okText"),handler:function(){this.completeEditing()||Ext.Msg.alert(this.L("alertCaption"),this.L("alertText"))},scope:this},{text:this.L("cancelText"),handler:this.close,scope:this}]}this.callParent(arguments);this.addCls("gnt-taskeditor-window")},init:function(i){this.assignmentStore=this.assignmentStore||i.getAssignmentStore();this.resourceStore=this.resourceStore||i.getResourceStore();this.taskStore=this.taskStore||i.getTaskStore();var f={width:null,height:null,border:false},h=["l10n","task","taskStore","assignmentStore","resourceStore","generalText","resourcesText","dependencyText","addDependencyText","dropDependencyText","notesText","advancedText","wbsCodeText","addAssignmentText","dropAssignmentText","showAssignmentGrid","showDependencyGrid","allowParentTaskDependencies","showNotes","showStyle","showAdvancedForm","taskFormClass","advancedFormClass","tabsConfig","taskFormConfig","dependencyGridConfig","assignmentGridConfig","advancedFormConfig","styleFormConfig","dependencyGridClass","assignmentGridClass"];for(var j=0,g=h.length;j<g;j++){if(this[h[j]]!==undefined){f[h[j]]=this[h[j]]}}f.showBaseline=i.enableBaseline;Ext.apply(f,this.panelConfig);this.buildTaskEditor(f);this.add(this.taskEditor);this.relayEvents(this.taskEditor,["validate","beforeupdatetask","afterupdatetask","loadtask"]);this.mon(i,this.triggerEvent,this.onTriggerEvent,this);this.gantt=i;i.taskEditor=this},buildTaskEditor:function(b){this.taskEditor=new Gnt.widget.taskeditor.TaskEditor(b)},onTriggerEvent:function(c,d){this.showTask(d)},showTask:function(b){if(this.taskEditor&&b){this.taskEditor.loadTask(b);this.show()}},validate:function(){if(this.taskEditor){return this.taskEditor.validate()}},completeEditing:function(){if(this.taskEditor){var b=this.taskEditor.getActiveTab();if(b.editingPlugin&&b.editingPlugin.completeEdit){b.editingPlugin.completeEdit()}if(!this.taskEditor.validate()){return false}if(this.taskEditor.updateTask()){this.hide();return true}return false}},updateTask:function(){if(this.taskEditor){return this.taskEditor.updateTask()}}});Ext.define("Gnt.column.Dependency",{extend:"Ext.grid.column.Column",requires:["Gnt.field.Dependency"],separator:";",type:"predecessors",field:null,useSequenceNumber:false,constructor:function(d){d=d||{};var c=d.field||d.editor;delete d.field;delete d.editor;Ext.apply(this,d);d.editor=c||Ext.create("Gnt.field.Dependency",{type:this.type,separator:this.separator,useSequenceNumber:this.useSequenceNumber});if(!(d.editor instanceof Gnt.widget.DependencyField)){d.editor=Ext.ComponentManager.create(d.editor,"dependencyfield")}d.field=d.editor;this.scope=this;this.callParent([d])},afterRender:function(){var b=this.up("ganttpanel");b.registerLockedDependencyListeners();this.callParent(arguments)},getContainingPanel:function(){if(!this.panel){this.panel=this.up("tablepanel")}return this.panel},setDirtyClass:function(f,d){var e=this.getContainingPanel().getView();if(e.markDirty&&this.field.isDirty(d)){f.tdCls=e.dirtyCls}},renderer:function(d,f,e){if(!e.isEditable(this.dataIndex)){f.tdCls=(f.tdCls||"")+" sch-column-readonly"}else{this.setDirtyClass(f,e)}return this.field.getDisplayValue(e)}});Ext.define("Gnt.column.Successor",{extend:"Gnt.column.Dependency",mixins:["Gnt.mixin.Localizable"],alias:"widget.successorcolumn",type:"successors",constructor:function(b){b=b||{};this.text=b.text||this.L("text");this.callParent(arguments)}});Ext.define("Gnt.column.Predecessor",{extend:"Gnt.column.Dependency",mixins:["Gnt.mixin.Localizable"],alias:"widget.predecessorcolumn",type:"predecessors",constructor:function(b){b=b||{};this.text=b.text||this.L("text");this.callParent(arguments)}});Ext.define("Gnt.column.Duration",{extend:"Ext.grid.column.Column",alias:"widget.durationcolumn",requires:["Gnt.field.Duration"],mixins:["Gnt.mixin.Localizable"],width:80,align:"left",decimalPrecision:2,useAbbreviation:false,instantUpdate:true,field:null,constructor:function(d){d=d||{};this.text=d.text||this.L("text");var c=d.field||d.editor;delete d.field;delete d.editor;Ext.apply(this,d);d.editor=c||Ext.create("Gnt.field.Duration",{useAbbreviation:this.useAbbreviation,decimalPrecision:this.decimalPrecision,instantUpdate:this.instantUpdate});if(!(d.editor instanceof Gnt.field.Duration)){Ext.applyIf(d.editor,{instantUpdate:this.instantUpdate});d.editor=Ext.ComponentManager.create(d.editor,"durationfield")}this.field=d.editor;this.scope=this;this.hasCustomRenderer=true;this.callParent([d])},afterRender:function(){var b=this.up("treepanel");if(!this.dataIndex){this.dataIndex=b.store.model.prototype[this.field.taskField]}this.callParent(arguments)},renderer:function(e,g,f){if(!Ext.isNumber(e)){return""}if(!f.isEditable(this.dataIndex)){g.tdCls=(g.tdCls||"")+" sch-column-readonly"}var h=f.getDurationUnit();return this.field.valueToVisible(e,h)}});Ext.define("Gnt.column.Effort",{extend:"Gnt.column.Duration",alias:"widget.effortcolumn",requires:["Gnt.field.Effort"],width:80,align:"left",decimalPrecision:2,field:null,constructor:function(d){d=d||{};this.text=d.text||this.L("text");var c=d.field||d.editor;delete d.field;delete d.editor;Ext.apply(this,d);d.editor=c||Ext.create("Gnt.field.Effort",{useAbbreviation:this.useAbbreviation,decimalPrecision:this.decimalPrecision,getDurationMethod:null,instantUpdate:this.instantUpdate});if(!(d.editor instanceof Gnt.field.Effort)){Ext.applyIf(d.editor,{useAbbreviation:this.useAbbreviation,decimalPrecision:this.decimalPrecision,getDurationMethod:null,instantUpdate:this.instantUpdate});d.editor=Ext.ComponentManager.create(d.editor,"effortfield")}this.field=d.editor;this.scope=this;this.hasCustomRenderer=true;this.callParent([d])},afterRender:function(){var b=this.up("treepanel");if(!this.dataIndex){this.dataIndex=b.store.model.prototype[this.field.taskField]}this.callParent(arguments)},renderer:function(h,g,f){if(!Ext.isNumber(h)){return""}if(!f.isEditable(this.dataIndex)){g.tdCls=(g.tdCls||"")+" sch-column-readonly"}var e=f.getEffortUnit();return this.field.valueToVisible(h,e)}});Ext.define("Gnt.widget.Calendar",{extend:"Ext.picker.Date",alias:"widget.ganttcalendar",requires:["Gnt.data.Calendar","Sch.util.Date"],mixins:["Gnt.mixin.Localizable"],calendar:null,startDate:null,endDate:null,initComponent:function(){if(!this.calendar){Ext.Error.raise('Required attribute "calendar" missing during initialization of `Gnt.widget.Calendar`')}if(!this.startDate){Ext.Error.raise('Required attribute "startDate" missing during initialization of `Gnt.widget.Calendar`')}if(!this.endDate){this.endDate=Sch.util.Date.add(this.startDate,Sch.util.Date.MONTH,1)}this.setCalendar(this.calendar);this.minDate=this.value=this.startDate;this.callParent(arguments);this.injectDates()},injectDates:function(){var d=this;var c=d.disabledDates=[];Ext.each(d.calendar.getHolidaysRanges(d.startDate,d.endDate),function(a){a.forEachDate(function(b){c.push(Ext.Date.format(b,d.format))})});d.setDisabledDates(c)},setCalendar:function(c){var d={update:this.injectDates,remove:this.injectDates,add:this.injectDates,load:this.injectDates,clear:this.injectDates,scope:this};if(this.calendar){this.mun(c,d)}this.calendar=c;if(c){this.mon(c,d)}}});Ext.define("Gnt.widget.calendar.ResourceCalendarGrid",{extend:"Ext.grid.Panel",requires:["Gnt.data.Calendar","Sch.util.Date"],mixins:["Gnt.mixin.Localizable"],alias:"widget.resourcecalendargrid",resourceStore:null,calendarStore:null,initComponent:function(){var b=this;this.calendarStore=this.calendarStore||Ext.create("Ext.data.Store",{fields:["Id","Name"]});Ext.apply(b,{store:b.resourceStore,columns:[{header:this.L("name"),dataIndex:"Name",flex:1},{header:this.L("calendar"),dataIndex:"CalendarId",flex:1,renderer:function(m,k,a,n,o,p){if(!m){var l=a.getCalendar();m=l?l.calendarId:""}var j=b.calendarStore.getById(m);return j?j.get("Name"):m},editor:{xtype:"combobox",store:b.calendarStore,queryMode:"local",displayField:"Name",valueField:"Id",editable:false,allowBlank:false}}],border:true,height:180,plugins:Ext.create("Ext.grid.plugin.CellEditing",{clicksToEdit:2})});this.calendarStore.loadData(this.getCalendarData());this.callParent(arguments)},getCalendarData:function(){var b=[];Ext.Array.each(Gnt.data.Calendar.getAllCalendars(),function(a){b.push({Id:a.calendarId,Name:a.name||a.calendarId})});return b}});Ext.define("Gnt.widget.calendar.AvailabilityGrid",{extend:"Ext.grid.Panel",requires:["Ext.Button","Ext.data.Store","Ext.grid.plugin.CellEditing","Ext.window.MessageBox","Gnt.data.Calendar","Sch.util.Date"],mixins:["Gnt.mixin.Localizable"],alias:"widget.calendaravailabilitygrid",calendarDay:null,height:160,addButton:null,removeButton:null,maxIntervalsNum:5,initComponent:function(){Ext.applyIf(this,{store:new Ext.data.Store({fields:["startTime","endTime"],data:this.calendarDay.getAvailability()}),plugins:[new Ext.grid.plugin.CellEditing({clicksToEdit:2})],tbar:this.buildToolbar(),columns:[{xtype:"datecolumn",header:this.L("startText"),format:"g:i a",dataIndex:"startTime",flex:1,editor:{xtype:"timefield",allowBlank:false,initDate:"31/12/1899"}},{xtype:"datecolumn",header:this.L("endText"),format:"g:i a",dataIndex:"endTime",flex:1,editor:{xtype:"timefield",allowBlank:false,initDate:"31/12/1899"}}],listeners:{selectionchange:this.onAvailabilityGridSelectionChange,scope:this}});this.callParent(arguments)},buildToolbar:function(){this.addButton=new Ext.Button({text:this.L("addText"),iconCls:"gnt-action-add",handler:this.addAvailability,scope:this});this.removeButton=new Ext.Button({text:this.L("removeText"),iconCls:"gnt-action-remove",handler:this.removeAvailability,scope:this,disabled:true});return[this.addButton,this.removeButton]},onAvailabilityGridSelectionChange:function(b){this.removeButton.setDisabled(!b||b.getSelection().length===0)},setAvailability:function(b){this.store.loadData(b);this.addButton.setDisabled(this.store.getCount()>=this.maxIntervalsNum)},addAvailability:function(){var d=this.getStore(),c=d.count();if(c>=this.maxIntervalsNum){return}d.add({startTime:new Date(0,0,0,12,0),endTime:new Date(0,0,0,13,0)});if(c+1>=this.maxIntervalsNum&&this.addButton){this.addButton.disable()}},removeAvailability:function(){var e=this.getStore(),f=e.getCount(),d=this.getSelectionModel().getSelection();if(d.length===0){return}e.remove(d[0]);if(f<this.maxIntervalsNum&&this.addButton){this.addButton.enable()}},isValid:function(c){try{this.calendarDay.verifyAvailability(this.getIntervals())}catch(d){if(!c){Ext.MessageBox.show({title:this.L("error"),msg:d,modal:true,icon:Ext.MessageBox.ERROR,buttons:Ext.MessageBox.OK})}return false}return true},extractTimeFromDate:function(b){return new Date(0,0,0,b.getHours(),b.getMinutes(),b.getSeconds())},getIntervals:function(){var d=[];var c=this;this.getStore().each(function(a){var b=c.extractTimeFromDate(a.get("endTime"));if(b-new Date(0,0,0,0,0,0)===0){b=new Date(0,0,1,0,0)}d.push({startTime:c.extractTimeFromDate(a.get("startTime")),endTime:b})});return d}});Ext.define("Gnt.widget.calendar.DayEditor",{extend:"Gnt.widget.calendar.AvailabilityGrid",requires:["Ext.grid.plugin.CellEditing","Gnt.data.Calendar","Sch.util.Date"],mixins:["Gnt.mixin.Localizable"],alias:"widget.calendardayeditor",height:160,initComponent:function(){var b=this.calendarDay.getIsWorkingDay();Ext.applyIf(this,{dockedItems:[{xtype:"radiogroup",dock:"top",name:"dayType",padding:"0 5px",margin:0,items:[{boxLabel:this.L("workingTimeText"),name:"IsWorkingDay",inputValue:true,checked:b},{boxLabel:this.L("nonworkingTimeText"),name:"IsWorkingDay",inputValue:false,checked:!b}],listeners:{change:this.onDayTypeChanged,scope:this}}]});this.on("viewready",this.applyState,this);this.callParent(arguments)},getDayTypeRadioGroup:function(){return this.down('radiogroup[name="dayType"]')},applyState:function(){if(!this.isWorkingDay()){this.getView().disable();this.addButton.disable()}},onDayTypeChanged:function(d){var c=d.getValue();if(Ext.isArray(c.IsWorkingDay)){return}this.getView().setDisabled(!c.IsWorkingDay);this.addButton.setDisabled(!c.IsWorkingDay||this.getStore().getCount()>=this.maxIntervalsNum)},isWorkingDay:function(){return this.getDayTypeRadioGroup().getValue().IsWorkingDay},isValid:function(){if(this.isWorkingDay()){return this.callParent()}return true},getIntervals:function(){if(!this.isWorkingDay()){return[]}return this.callParent()}});Ext.define("Gnt.widget.calendar.WeekEditor",{extend:"Ext.form.Panel",requires:["Ext.grid.Panel","Gnt.data.Calendar","Sch.util.Date","Gnt.widget.calendar.AvailabilityGrid"],mixins:["Gnt.mixin.Localizable"],alias:"widget.calendarweekeditor",weekName:null,startDate:null,endDate:null,weekAvailability:null,calendarWeekAvailability:null,defaultWeekAvailability:null,backupWeekAvailability:null,layout:"anchor",defaults:{border:false,anchor:"100%"},currentDayIndex:null,_weekDaysGrid:null,_availabilityGrid:null,initComponent:function(){this.backupWeekAvailability=[];this.items=[{xtype:"radiogroup",padding:"0 5px",name:"dayType",items:[{boxLabel:this.L("defaultTimeText"),name:"IsWorkingDay",inputValue:0},{boxLabel:this.L("workingTimeText"),name:"IsWorkingDay",inputValue:1},{boxLabel:this.L("nonworkingTimeText"),name:"IsWorkingDay",inputValue:2}],listeners:{change:this.onDayTypeChanged,scope:this}},{layout:"column",padding:"0 0 5px 0",defaults:{border:false},items:[{margin:"0 10px 0 5px",columnWidth:0.5,items:this.getWeekDaysGrid()},{columnWidth:0.5,margin:"0 5px 0 0",items:this.getAvailabilityGrid()}]}];this.callParent(arguments)},getWeekDaysGrid:function(){if(this._weekDaysGrid!=null){return this._weekDaysGrid}var b=Ext.Date.dayNames;return this._weekDaysGrid=new Ext.grid.Panel({hideHeaders:true,height:160,columns:[{header:"",dataIndex:"name",flex:1}],store:new Ext.data.Store({fields:["id","name"],idProperty:"id",data:[{id:1,name:b[1]},{id:2,name:b[2]},{id:3,name:b[3]},{id:4,name:b[4]}]})})},lityGrid:function(){if(!this._availabilityGrid){this._availabilityGrid=new Gnt.widget.calendar.AvailabilityGrid({calendarDay:new Gnt.model.CalendarDay()})}return this._availabilityGrid},getDayTypeRadioGroup:function(){if(!this.dayTypeRadioGroup){this.dayTypeRadioGroup=this.down('radiogroup[name="dayType"]')}return this.dayTypeRadioGroup},getWeekAvailability:function(){return this.weekAvailability},onWeekDaysListViewReady:function(){var c=this.getWeekDaysGrid(),d=c.getStore().getAt(0);this.currentDayIndex=d.getId();this.readFromData();c.getSelectionModel().select(d,false,true)},onWeekDaysListBeforeSelect:function(){if(!this.saveToData()){return false}},applyChanges:function(h){if(!this.saveToData()){return false}var f=this.weekAvailability;var i=false;for(var j=0;j<7;j++){var g=f[j];if(g){i=true}if(!g){h[j]=null}if(g&&!h[j]){h[j]=g}if(g&&h[j]){h[j].setIsWorkingDay(g.getIsWorkingDay());h[j].setAvailability(g.getAvailability())}}if(!i){Ext.MessageBox.show({title:this.L("error"),msg:this.L("noOverrideError"),modal:true,icon:Ext.MessageBox.ERROR,buttons:Ext.MessageBox.OK});return false}return true},onWeekDaysListSelectionChange:function(d,c){this.currentDayIndex=c[0].getId();this.readFromData()},getCurrentTypeOfWeekDay:function(b){return this.weekAvailability[b]?(this.weekAvailability[b].getIsWorkingDay()?1:2):0},getCurrentWeekDay:function(b){return this.weekAvailability[b]||this.calendarWeekAvailability[b]||this.defaultWeekAvailability[b]},saveToData:function(){var h=this.currentDayIndex;var g=this.getDayTypeRadioGroup().getValue().IsWorkingDay;var f=this.weekAvailability;if(g===0){f[h]=null;return true}var e=this.getAvailabilityGrid();if(g==1){if(!e.isValid()){return false}if(!f[h]){f[h]=this.copyDefaultWeekDay(h)}f[h].setIsWorkingDay(true);f[h].setAvailability(e.getIntervals());this.backupWeekAvailability[h]=null;return true}if(!f[h]){f[h]=this.copyDefaultWeekDay(h)}f[h].setIsWorkingDay(false);f[h].setAvailability([]);return true},copyDefaultWeekDay:function(d){var c=(this.calendarWeekAvailability[d]||this.defaultWeekAvailability[d]).copy();c.setType("WEEKDAYOVERRIDE");c.setOverrideStartDate(this.startDate);c.setOverrideEndDate(this.endDate);c.setName(this.weekName);return c},readFromData:function(f){var g=this.getCurrentWeekDay(this.currentDayIndex);var i=this.getCurrentTypeOfWeekDay(this.currentDayIndex);var j=this.getAvailabilityGrid();j.setAvailability(f||g.getAvailability());var h=this.getDayTypeRadioGroup();h.suspendEvents();h.setValue({IsWorkingDay:[i]});h.resumeEvents();j.setDisabled(i!=1)},onDayTypeChanged:function(o,q,r){var l=o.getValue();if(l.IsWorkingDay==null||Ext.isArray(l.IsWorkingDay)){return}var n=this.weekAvailability;var m=this.backupWeekAvailability;var k=this.currentDayIndex;var p=this.getAvailabilityGrid();var j;if(r.IsWorkingDay==1){m[k]=p.getIntervals()}switch(l.IsWorkingDay){case 0:n[k]=null;break;case 1:if(!n[k]){n[k]=this.copyDefaultWeekDay(k)}j=m[k];n[k].setIsWorkingDay(true);break;case 2:if(!n[k]){n[k]=this.copyDefaultWeekDay(k)}n[k].setAvailability([]);n[k].setIsWorkingDay(false);break;default:throw"Unrecognized day type"}this.readFromData(j)}});Ext.define("Gnt.widget.calendar.DatePicker",{extend:"Ext.picker.Date",alias:"widget.gntdatepicker",workingDayCls:"gnt-datepicker-workingday",nonWorkingDayCls:"gnt-datepicker-nonworkingday",overriddenDayCls:"gnt-datepicker-overriddenday",overriddenWeekDayCls:"gnt-datepicker-overriddenweekday",weekOverridesStore:null,dayOverridesCalendar:null,update:function(){this.callParent(arguments);this.refreshCssClasses()},refreshCssClasses:function(){var g=this,e=g.cells.elements;this.removeCustomCls();for(var h=0;h<g.numDays;h++){var f=e[h].firstChild.dateValue;e[h].className+=" "+this.getDateCls(new Date(f))}},getDateCls:function(j){var g="";if(j.getMonth()!==this.getActive().getMonth()){return}var l=this.dayOverridesCalendar;if(l.getOwnCalendarDay(j)){g+=" "+this.overriddenDayCls;if(!l.isWorkingDay(j)){g+=" "+this.nonWorkingDayCls}}else{var i=null;this.weekOverridesStore.each(function(a){if(Ext.Date.between(j,a.get("startDate"),a.get("endDate"))){i=a;return false}});if(i){g+=" "+this.overriddenWeekDayCls;var k=j.getDay(),h=i.get("weekAvailability");if(h&&h[k]&&!h[k].getIsWorkingDay()){g+=" "+this.nonWorkingDayCls}}else{if(!l.isWorkingDay(j)){g+=" "+this.nonWorkingDayCls}}}return g||this.workingDayCls},removeCustomCls:function(){this.cells.removeCls([this.overriddenDayCls,this.nonWorkingDayCls,this.workingDayCls,this.overriddenWeekDayCls])}});Ext.define("Gnt.widget.calendar.Calendar",{extend:"Ext.form.Panel",requires:["Ext.XTemplate","Ext.data.Store","Ext.grid.Panel","Ext.grid.plugin.CellEditing","Gnt.data.Calendar","Gnt.model.CalendarDay","Gnt.widget.calendar.DayEditor","Gnt.widget.calendar.WeekEditor","Gnt.widget.calendar.DatePicker"],mixins:["Gnt.mixin.Localizable"],alias:"widget.calendar",defaults:{padding:10,border:false},workingDayCls:"gnt-datepicker-workingday",nonWorkingDayCls:"gnt-datepicker-nonworkingday",overriddenDayCls:"gnt-datepicker-overriddenday",overriddenWeekDayCls:"gnt-datepicker-overriddenweekday",calendar:null,dayGridConfig:null,weekGridConfig:null,datePickerConfig:null,dayGrid:null,weekGrid:null,datePicker:null,legendTpl:'<ul class="gnt-calendar-legend"><li class="gnt-calendar-legend-item"><div class="gnt-calendar-legend-itemstyle {workingDayCls}"></div><span class="gnt-calendar-legend-itemname">{workingDayText}</span><div style="clear: both"></div></li><li><div class="gnt-calendar-legend-itemstyle {nonWorkingDayCls}"></div><span class="gnt-calendar-legend-itemname">{weekendsText}</span><div style="clear: both"></div></li><li class="gnt-calendar-legend-override"><div class="gnt-calendar-legend-itemstyle {overriddenDayCls}">31</div><span class="gnt-calendar-legend-itemname">{overriddenDayText}</span><div style="clear: both"></div></li><li class="gnt-calendar-legend-override"><div class="gnt-calendar-legend-itemstyle {overriddenWeekDayCls}">31</div><span class="gnt-calendar-legend-itemname">{overriddenWeekText}</span><div style="clear: both"></div></li></ul>',dateInfoTpl:null,dayOverridesCalendar:null,weekOverridesStore:null,copiesIndexByOriginalId:null,currentDayOverrideEditor:null,getDayGrid:function(){if(!this.dayGrid){var b=this.calendar.model.prototype;this.dayGrid=new Ext.grid.Panel(Ext.apply({title:this.L("dayOverridesText"),tbar:[{text:this.L("addText"),action:"add",iconCls:"gnt-action-add",handler:this.addDay,scope:this},{text:this.L("editText"),action:"edit",iconCls:"gnt-action-edit",handler:this.editDay,scope:this},{text:this.L("removeText"),action:"remove",iconCls:"gnt-action-remove",handler:this.removeDay,scope:this}],store:new Gnt.data.Calendar(),plugins:[new Ext.grid.plugin.CellEditing({clicksToEdit:2})],columns:[{header:this.L("dayOverrideNameHeaderText"),dataIndex:b.nameField,flex:1,editor:{allowBlank:false}},{header:this.L("dateText"),dataIndex:b.dateField,width:100,xtype:"datecolumn",editor:{xtype:"datefield"}}]},this.dayGridConfig||{}));this.dayOverridesCalendar=this.dayGrid.store}return this.dayGrid},getWeekGrid:function(){if(!this.weekGrid){this.weekGrid=new Ext.grid.Panel(Ext.apply({title:this.L("weekOverridesText"),border:true,plugins:[new Ext.grid.plugin.CellEditing({clicksToEdit:2})],store:new Ext.data.Store({fields:["name","startDate","endDate","weekAvailability","mainDay"]}),tbar:[{text:this.L("addText"),action:"add",iconCls:"gnt-action-add",handler:this.addWeek,scope:this},{text:this.L("editText"),action:"edit",iconCls:"gnt-action-edit",handler:this.editWeek,scope:this},{text:this.L("removeText"),action:"remove",iconCls:"gnt-action-remove",handler:this.removeWeek,scope:this}],columns:[{header:this.L("overrideName"),dataIndex:"name",flex:1,editor:{allowBlank:false}},{xtype:"datecolumn",header:this.L("startDate"),dataIndex:"startDate",width:100,editor:{xtype:"datefield"}},{xtype:"datecolumn",header:this.L("endDate"),dataIndex:"endDate",width:100,editor:{xtype:"datefield"}}]},this.weekGridConfig||{}));this.weekOverridesStore=this.weekGrid.store}return this.weekGrid},getDatePicker:function(){if(!this.datePicker){this.datePicker=new Gnt.widget.calendar.DatePicker(Ext.apply({dayOverridesCalendar:this.getDayGrid().store,weekOverridesStore:this.getWeekGrid().store},this.datePickerConfig))}return this.datePicker},initComponent:function(){this.copiesIndexByOriginalId={};var i=this;i.setupTemplates();if(!(this.legendTpl instanceof Ext.Template)){this.legendTpl=new Ext.XTemplate(this.legendTpl)}if(!(this.dateInfoTpl instanceof Ext.Template)){this.dateInfoTpl=new Ext.XTemplate(this.dateInfoTpl)}var h=this.calendar;if(!h){Ext.Error.raise('Required attribute "calendar" is missed during initialization of `Gnt.widget.Calendar`')}var f=this.getWeekGrid(),g=this.getDayGrid(),j=this.getDatePicker();g.on({selectionchange:this.onDayGridSelectionChange,validateedit:this.onDayGridValidateEdit,edit:this.onDayGridEdit,scope:this});g.store.on({update:this.refreshView,remove:this.refreshView,add:this.refreshView,scope:this});f.on({selectionchange:this.onWeekGridSelectionChange,validateedit:this.onWeekGridValidateEdit,edit:this.onWeekGridEdit,scope:this});f.store.on({update:this.refreshView,remove:this.refreshView,add:this.refreshView,scope:this});j.on({select:this.onDateSelect,scope:this});this.fillDaysStore();this.fillWeeksStore();this.mon(h,{load:this.onCalendarChange,add:this.onCalendarChange,remove:this.onCalendarChange,update:this.onCalendarChange,scope:this});this.dateInfoPanel=new Ext.Panel({cls:"gnt-calendar-dateinfo",columnWidth:0.33,border:false,height:200});this.items=[{xtype:"container",layout:"hbox",pack:"start",align:"stretch",items:[{html:Ext.String.format('{0}: "{1}"',this.L("calendarNameText"),h.name),border:false,flex:1},{xtype:"combobox",name:"cmb_parentCalendar",fieldLabel:this.L("parentCalendarText"),store:new Ext.data.Store({fields:["Id","Name"],data:[{Id:-1,Name:this.L("noParentText")}].concat(h.getParentableCalendars())}),queryMode:"local",displayField:"Name",valueField:"Id",editable:false,emptyText:this.L("selectParentText"),value:h.parent?h.parent.calendarId:-1,flex:1}]},{layout:"column",defaults:{border:false},items:[{margin:"0 15px 0 0",columnWidth:0.3,html:this.legendTpl.apply({workingDayText:this.L("workingDayText"),weekendsText:this.L("weekendsText"),overriddenDayText:this.L("overriddenDayText"),overriddenWeekText:this.L("overriddenWeekText"),workingDayCls:this.workingDayCls,nonWorkingDayCls:this.nonWorkingDayCls,overriddenDayCls:this.overriddenDayCls,overriddenWeekDayCls:this.overriddenWeekDayCls})},{columnWidth:0.37,margin:"0 5px 0 0",items:[j]},this.dateInfoPanel]},{xtype:"tabpanel",height:220,items:[g,f]}];this.callParent(arguments)},onCalendarChange:function(){this.fillDaysStore();this.fillWeeksStore();this.refreshView()},setupTemplates:function(){var b=this.L("tplTexts");this.dateInfoTpl=this.dateInfoTpl||Ext.String.format('<tpl if="isWorkingDay == true"><div>{0} {date}:</div></tpl><tpl if="isWorkingDay == false"><div>{date} {1}</div></tpl><ul class="gnt-calendar-availabilities"><tpl for="availability"><li>{.}</li></tpl></ul><span>{5}: <tpl if="override == true">{2} "{name}" {3} "{calendarName}"</tpl><tpl if="override == false">{4} "{calendarName}"</tpl></span>',b.tplWorkingHours,b.tplIsNonWorking,b.tplOverride,b.tplInCalendar,b.tplDayInCalendar,b.tplBasedOn)},afterRender:function(){this.callParent(arguments);this.onDateSelect(this.getDatePicker(),new Date())},fillDaysStore:function(){var b=Gnt.util.Data.cloneModelSet(this.calendar,function(a){return(a.getType()=="DAY"&&a.getDate())});this.dayOverridesCalendar.loadData(b)},copyCalendarDay:function(d){var c=d.copy();c.__COPYOF__=d.internalId;this.copiesIndexByOriginalId[d.internalId]=c.internalId;return c},fillWeeksStore:function(){var d=this;var c=[];this.calendar.forEachNonStandardWeek(function(b){var a=Ext.apply({},b);a.weekAvailability=Ext.Array.map(a.weekAvailability,function(f){return f&&d.copyCalendarDay(f)||null});a.mainDay=d.copyCalendarDay(a.mainDay);c.push(a)});this.weekOverridesStore.loadData(c)},addDay:function(){var d=this.getDatePicker().getValue();if(this.dayOverridesCalendar.getOwnCalendarDay(d)){this.alert({msg:this.L("overrideErrorText")});return}var c=Ext.create("Gnt.model.CalendarDay",{Name:this.L("newDayName"),Type:"DAY",Date:d,IsWorkingDay:false});this.dayOverridesCalendar.insert(0,c);this.getDayGrid().getSelectionModel().select([c],false,false)},editDay:function(){var h=this,j=this.getDayGrid().getSelectionModel().getSelection();if(j.length===0){return}var g=j[0];var f=this.currentDayOverrideEditor=new Gnt.widget.calendar.DayEditor({addText:this.L("addText"),removeText:this.L("removeText"),workingTimeText:this.L("workingTimeText"),nonworkingTimeText:this.L("nonworkingTimeText"),calendarDay:g});var i=Ext.create("Ext.window.Window",{title:this.L("dayOverridesText"),modal:true,width:280,height:260,layout:"fit",items:f,buttons:[{text:this.L("okText"),handler:function(){if(f.isValid()){var a=f.calendarDay;a.setIsWorkingDay(f.isWorkingDay());a.setAvailability(f.getIntervals());h.applyCalendarDay(a,g);h.refreshView();i.close()}}},{text:this.L("cancelText"),handler:function(){i.close()}}]});i.show()},removeDay:function(){var d=this.getDayGrid(),c=d.getSelectionModel().getSelection();if(!c.length){return}d.getStore().remove(c[0]);this.refreshView()},refreshView:function(){var m=this.getDatePicker().getValue(),i=this.getCalendarDay(m),n=this.getWeekGrid(),j=this.getDayGrid(),o=this.dayOverridesCalendar.getOwnCalendarDay(m),k;var p;if(o){j.getSelectionModel().select([o],false,true);p=o.getName()}else{k=this.getWeekOverrideByDate(m);if(k){n.getSelectionModel().select([k],false,true);p=k.get("name")}}var l={name:p||i.getName(),date:Ext.Date.format(m,"M j, Y"),calendarName:this.calendar.name||this.calendar.calendarId,availability:i.getAvailability(true),override:Boolean(o||k),isWorkingDay:i.getIsWorkingDay()};this.dateInfoPanel.update(this.dateInfoTpl.apply(l));this.datePicker.refreshCssClasses()},onDayGridSelectionChange:function(c){if(c.getSelection().length===0){return}var d=c.getSelection()[0];this.getDatePicker().setValue(d.getDate());this.refreshView()},onDayGridEdit:function(c,d){if(d.field==="Date"){d.grid.getStore().clearCache();this.getDatePicker().setValue(d.value)}this.refreshView()},onDayGridValidateEdit:function(d,e){var f=this.getDayGrid().store;if(e.field===f.model.prototype.dateField&&f.getOwnCalendarDay(e.value)&&e.value!==e.originalValue){this.alert({msg:this.L("overrideErrorText")});return false}},onDateSelect:function(c,d){this.refreshView()},getCalendarDay:function(c){var d=this.dayOverridesCalendar.getOwnCalendarDay(c);if(d){return d}d=this.getWeekOverrideDay(c);if(d){return d}return this.calendar.weekAvailability[c.getDay()]||this.calendar.defaultWeekAvailability[c.getDay()]},getWeekOverrideDay:function(i){var h=new Date(i),f=this.getWeekOverrideByDate(i),j=h.getDay();if(f==null){return null}var g=f.get("weekAvailability");if(!g){return null}return g[j]},getWeekOverrideByDate:function(d){var c=null;this.weekOverridesStore.each(function(a){if(Ext.Date.between(d,a.get("startDate"),a.get("endDate"))){c=a;return false}});return c},intersectsWithCurrentWeeks:function(e,g,h){var f=false;this.weekOverridesStore.each(function(b){if(b==h){return}var c=b.get("startDate");var a=b.get("endDate");if(c<=e&&e<a||c<g&&g<=a){f=true;return false}});return f},addWeek:function(){var l=this.weekOverridesStore;var h=this.getDatePicker().getValue();var i;for(var j=7;j>0;j--){i=Sch.util.Date.add(h,Sch.util.Date.DAY,j);if(!this.intersectsWithCurrentWeeks(h,i)){break}}if(!j){this.alert({msg:Ext.String.format(this.L("overrideDateError"),Ext.Date.format(h,"Y/m/d"))});return}var k=new this.calendar.model();k.setType("WEEKDAYOVERRIDE");k.setName(this.L("newDayName"));k.setOverrideStartDate(h);k.setOverrideEndDate(i);k.setWeekday(-1);var g=l.insert(0,{name:this.L("newDayName"),startDate:h,endDate:i,weekAvailability:[],mainDay:k})[0];this.getWeekGrid().getSelectionModel().select([g],false,false)},editWeek:function(){var j=this.getWeekGrid().getSelectionModel().getSelection(),h=this;if(j.length===0){return}var f=j[0];var g=new Gnt.widget.calendar.WeekEditor({startDate:f.get("startDate"),endDate:f.get("endDate"),weekName:f.get("name"),weekAvailability:f.get("weekAvailability"),calendarWeekAvailability:this.calendar.weekAvailability,defaultWeekAvailability:this.calendar.defaultWeekAvailability});var i=Ext.create("Ext.window.Window",{title:this.L("weekOverridesText"),modal:true,width:370,defaults:{border:false},layout:"fit",items:g,buttons:[{action:"ok",text:this.L("okText"),handler:function(){if(g.applyChanges(f.get("weekAvailability"))){h.refreshView();i.close()}}},{text:this.L("cancelText"),handler:function(){i.close()}}]});i.show()},removeWeek:function(){var d=this.getWeekGrid().getSelectionModel().getSelection(),c=this;if(d.length===0){return}this.weekOverridesStore.remove(d[0]);this.refreshView()},onWeekGridSelectionChange:function(d){var c=d.getSelection();if(c.length===0){return}this.getDatePicker().setValue(c[0].get("startDate"))},onWeekGridEdit:function(i,f){var j=f.record,g=j.get("startDate"),h=j.get("endDate");if(f.field=="startDate"||f.field=="endDate"){Ext.Array.each(j.get("weekAvailability").concat(j.get("mainDay")),function(a){if(a){a.setOverrideStartDate(g);a.setOverrideEndDate(h)}});this.getDatePicker().setValue(g)}if(f.field=="name"){Ext.Array.each(j.get("weekAvailability").concat(j.get("mainDay")),function(a){if(a){a.setName(j.get("name"))}})}this.refreshView()},alert:function(b){b=b||{};Ext.MessageBox.show(Ext.applyIf(b,{title:this.L("error"),icon:Ext.MessageBox.WARNING,buttons:Ext.MessageBox.OK}))},onWeekGridValidateEdit:function(i,f){var j=f.record,g=f.field=="startDate"?f.value:j.get("startDate"),h=f.field=="endDate"?f.value:j.get("endDate");if(g>h){this.alert({msg:this.L("startAfterEndError")});return false}if(this.intersectsWithCurrentWeeks(g,h,j)){this.alert({msg:this.L("weeksIntersectError")});return false}},applyCalendarDay:function(g,h){h.beginEdit();h.setId(g.getId());h.setName(g.getName());h.setIsWorkingDay(g.getIsWorkingDay());h.setDate(g.getDate());h.setOverrideStartDate(g.getOverrideStartDate());h.setOverrideEndDate(g.getOverrideEndDate());var e=g.getAvailability(true);var f=h.getAvailability(true);if(e+""!=f+""){h.setAvailability(g.getAvailability())}h.endEdit()},applySingleDay:function(c,d){if(c.__COPYOF__){this.applyCalendarDay(c,this.calendar.getByInternalId(c.__COPYOF__))}else{c.unjoin(c.stores[0]);d.push(c)}},applyChanges:function(){var j=this;var i=this.calendar;var k=this.down('combobox[name="cmb_parentCalendar"]').getValue();i.suspendEvents(true);i.suspendCacheUpdate++;i.setParent(k?Gnt.data.Calendar.getCalendar(k):null);i.proxy.extraParams.calendarId=i.calendarId;Gnt.util.Data.applyCloneChanges(this.dayOverridesCalendar,i);var g=[];var h=[];var l={};this.weekOverridesStore.each(function(a){Ext.Array.each(a.get("weekAvailability").concat(a.get("mainDay")),function(b){if(b){if(b.__COPYOF__){l[b.__COPYOF__]=true}j.applySingleDay(b,g)}})});i.forEachNonStandardWeek(function(a){Ext.Array.each(a.weekAvailability.concat(a.mainDay),function(b){if(b&&!l[b.internalId]){h.push(b)}})});i.add(g);i.remove(h);i.suspendCacheUpdate--;i.resumeEvents();i.clearCache()}});Ext.define("Gnt.widget.calendar.CalendarWindow",{extend:"Ext.window.Window",requires:["Gnt.widget.calendar.Calendar"],mixins:["Gnt.mixin.Localizable"],alias:"widget.calendarwindow",calendarConfig:null,calendar:null,calendarWidget:null,initComponent:function(){Ext.apply(this,{width:600,layout:"fit",items:this.calendarWidget=new Gnt.widget.calendar.Calendar(Ext.apply({calendar:this.calendar},this.calendarConfig)),buttons:[{text:this.L("ok"),handler:function(){this.applyChanges();this.close()},scope:this},{text:this.L("cancel"),handler:this.close,scope:this}]});this.callParent(arguments)},applyChanges:function(){this.calendarWidget.applyChanges()}});Ext.data.Connection.override({parseStatus:function(c){var d=this.callOverridden(arguments);if(c===0){d.success=true}return d}});if(false){var log=function(b){if(window.console){console.log(b)}};log("BRYNTUM TRIAL LICENSE, for purchasing and licensing options please visit: www.bryntum.com/store (btw, we're hiring: www.bryntum.com/company/careers )");function newRefresh(){this.callOverridden(arguments);if(this.__injected||!this.rendered){return}this.__injected=true;Ext.Function.defer(function(){this.el&&this.el.select(this.eventSelector).setOpacity(0.15);log("TRIAL VERSION: PRODUCT DEACTIVATED")},10*60*1000,this);var f=this.el.parent().createChild({tag:"a",cls:"bryntum-trial",href:"http://www.bryntum.com/store",title:"Click here to purchase a license",style:"display:block;height:54px;width:230px;background: #fff url(http://www.bryntum.com/site-images/bryntum-trial.png) no-repeat;z-index:10000;border:1px solid #ddd;-webkit-box-shadow: 2px 2px 2px rgba(100, 100, 100, 0.5);-moz-box-shadow: 2px 2px 2px rgba(100, 100, 100, 0.5);-moz-border-radius:5px;-webkit-border-radius:5px;position:absolute;bottom:10px;right:15px;"});try{if(!Ext.util.Cookies.get("bmeval")){Ext.util.Cookies.set("bmeval",new Date().getTime(),Ext.Date.add(new Date(),Ext.Date.YEAR,2))}else{var g=Ext.util.Cookies.get("bmeval"),e=new Date(parseInt(g,10));if(Ext.Date.add(e,Ext.Date.DAY,45)<new Date()){this.el.select(this.eventSelector).hide();this.el.mask("Trial Period Expired!").setStyle("z-index",10000);log("TRIAL PERIOD EXPIRED, PURCHASE A LICENSE HERE http://bryntum.com/");this.refresh=Ext.emptyFn}}}catch(h){}}if(Sch&&Sch.view&&Sch.view.TimelineGridView){Sch.view.TimelineGridView.override({refresh:Ext.Function.clone(newRefresh)})}if(Sch&&Sch.view&&Sch.view.TimelineTreeView){Sch.view.TimelineTreeView.override({refresh:Ext.Function.clone(newRefresh)})}};