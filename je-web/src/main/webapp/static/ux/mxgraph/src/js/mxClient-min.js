var mxClient={VERSION:"2.3.0.3",IS_IE:0<=navigator.userAgent.indexOf("MSIE"),IS_IE6:0<=navigator.userAgent.indexOf("MSIE 6"),IS_QUIRKS:0<=navigator.userAgent.indexOf("MSIE")&&(null==document.documentMode||5==document.documentMode),VML_PREFIX:"v",OFFICE_PREFIX:"o",IS_NS:0<=navigator.userAgent.indexOf("Mozilla/")&&0>navigator.userAgent.indexOf("MSIE"),IS_OP:0<=navigator.userAgent.indexOf("Opera/"),IS_OT:0>navigator.userAgent.indexOf("Presto/2.4.")&&0>navigator.userAgent.indexOf("Presto/2.3.")&&0>navigator.userAgent.indexOf("Presto/2.2.")&&0>navigator.userAgent.indexOf("Presto/2.1.")&&0>navigator.userAgent.indexOf("Presto/2.0.")&&0>navigator.userAgent.indexOf("Presto/1."),IS_SF:0<=navigator.userAgent.indexOf("AppleWebKit/")&&0>navigator.userAgent.indexOf("Chrome/"),IS_IOS:navigator.userAgent.match(/(iPad|iPhone|iPod)/g)?!0:!1,IS_GC:0<=navigator.userAgent.indexOf("Chrome/"),IS_FF:0<=navigator.userAgent.indexOf("Firefox/"),IS_MT:0<=navigator.userAgent.indexOf("Firefox/")&&0>navigator.userAgent.indexOf("Firefox/1.")&&0>navigator.userAgent.indexOf("Firefox/2.")||0<=navigator.userAgent.indexOf("Iceweasel/")&&0>navigator.userAgent.indexOf("Iceweasel/1.")&&0>navigator.userAgent.indexOf("Iceweasel/2.")||0<=navigator.userAgent.indexOf("SeaMonkey/")&&0>navigator.userAgent.indexOf("SeaMonkey/1.")||0<=navigator.userAgent.indexOf("Iceape/")&&0>navigator.userAgent.indexOf("Iceape/1."),IS_SVG:0<=navigator.userAgent.indexOf("Firefox/")||0<=navigator.userAgent.indexOf("Iceweasel/")||0<=navigator.userAgent.indexOf("Seamonkey/")||0<=navigator.userAgent.indexOf("Iceape/")||0<=navigator.userAgent.indexOf("Galeon/")||0<=navigator.userAgent.indexOf("Epiphany/")||0<=navigator.userAgent.indexOf("AppleWebKit/")||0<=navigator.userAgent.indexOf("Gecko/")||0<=navigator.userAgent.indexOf("Opera/")||null!=document.documentMode&&9<=document.documentMode,NO_FO:!document.createElementNS||"[object SVGForeignObjectElement]"!=document.createElementNS("http://www.w3.org/2000/svg","foreignObject")||0<=navigator.userAgent.indexOf("Opera/"),IS_VML:"MICROSOFT INTERNET EXPLORER"==navigator.appName.toUpperCase(),IS_MAC:0<navigator.userAgent.toUpperCase().indexOf("MACINTOSH"),IS_TOUCH:"ontouchstart" in document.documentElement,IS_POINTER:null!=window.navigator.msPointerEnabled?window.navigator.msPointerEnabled:!1,IS_LOCAL:0>document.location.href.indexOf("http://")&&0>document.location.href.indexOf("https://"),isBrowserSupported:function(){return mxClient.IS_VML||mxClient.IS_SVG},link:function(f,e,h){h=h||document;if(mxClient.IS_IE6){h.write('<link rel="'+f+'" href="'+e+'" charset="ISO-8859-1" type="text/css"/>')}else{var g=h.createElement("link");g.setAttribute("rel",f);g.setAttribute("href",e);g.setAttribute("charset","ISO-8859-1");g.setAttribute("type","text/css");h.getElementsByTagName("head")[0].appendChild(g)}},include:function(b){document.write('<script src="'+b+'">\x3c/script>')},dispose:function(){for(var b=0;b<mxEvent.objects.length;b++){null!=mxEvent.objects[b].mxListenerList&&mxEvent.removeAllListeners(mxEvent.objects[b])}}};"undefined"==typeof mxLoadResources&&(mxLoadResources=!0);"undefined"==typeof mxResourceExtension&&(mxResourceExtension=".txt");"undefined"==typeof mxLoadStylesheets&&(mxLoadStylesheets=!0);"undefined"!=typeof mxBasePath&&0<mxBasePath.length?("/"==mxBasePath.substring(mxBasePath.length-1)&&(mxBasePath=mxBasePath.substring(0,mxBasePath.length-1)),mxClient.basePath=mxBasePath):mxClient.basePath=".";"undefined"!=typeof mxImageBasePath&&0<mxImageBasePath.length?("/"==mxImageBasePath.substring(mxImageBasePath.length-1)&&(mxImageBasePath=mxImageBasePath.substring(0,mxImageBasePath.length-1)),mxClient.imageBasePath=mxImageBasePath):mxClient.imageBasePath=mxClient.basePath+"/images";mxClient.language="undefined"!=typeof mxLanguage&&null!=mxLanguage?mxLanguage:mxClient.IS_IE?navigator.userLanguage:navigator.language;mxClient.defaultLanguage="undefined"!=typeof mxDefaultLanguage&&null!=mxDefaultLanguage?mxDefaultLanguage:"en";mxLoadStylesheets&&mxClient.link("stylesheet",mxClient.basePath+"/css/common.css");"undefined"!=typeof mxLanguages&&null!=mxLanguages&&(mxClient.languages=mxLanguages);if(mxClient.IS_VML){if(mxClient.IS_SVG){mxClient.IS_VML=!1}else{8==document.documentMode?(document.namespaces.add(mxClient.VML_PREFIX,"urn:schemas-microsoft-com:vml","#default#VML"),document.namespaces.add(mxClient.OFFICE_PREFIX,"urn:schemas-microsoft-com:office:office","#default#VML")):(document.namespaces.add(mxClient.VML_PREFIX,"urn:schemas-microsoft-com:vml"),document.namespaces.add(mxClient.OFFICE_PREFIX,"urn:schemas-microsoft-com:office:office"));var ss=document.createStyleSheet();ss.cssText=mxClient.VML_PREFIX+"\\:*{behavior:url(#default#VML)}"+mxClient.OFFICE_PREFIX+"\\:*{behavior:url(#default#VML)}";mxLoadStylesheets&&mxClient.link("stylesheet",mxClient.basePath+"/css/explorer.css");window.attachEvent("onunload",mxClient.dispose)}}var mxLog={consoleName:"Console",TRACE:!1,DEBUG:!0,WARN:!0,buffer:"",init:function(){if(null==mxLog.window&&null!=document.body){var h=mxLog.consoleName+" - mxGraph "+mxClient.VERSION,g=document.createElement("table");g.setAttribute("width","100%");g.setAttribute("height","100%");var m=document.createElement("tbody"),l=document.createElement("tr"),k=document.createElement("td");k.style.verticalAlign="top";mxLog.textarea=document.createElement("textarea");mxLog.textarea.setAttribute("readOnly","true");mxLog.textarea.style.height="100%";mxLog.textarea.style.resize="none";mxLog.textarea.value=mxLog.buffer;mxLog.textarea.style.width=mxClient.IS_NS&&"BackCompat"!=document.compatMode?"99%":"100%";k.appendChild(mxLog.textarea);l.appendChild(k);m.appendChild(l);l=document.createElement("tr");mxLog.td=document.createElement("td");mxLog.td.style.verticalAlign="top";mxLog.td.setAttribute("height","30px");l.appendChild(mxLog.td);m.appendChild(l);g.appendChild(m);mxLog.addButton("Info",function(b){mxLog.info()});mxLog.addButton("DOM",function(b){b=mxUtils.getInnerHtml(document.body);mxLog.debug(b)});mxLog.addButton("Trace",function(b){mxLog.TRACE=!mxLog.TRACE;mxLog.TRACE?mxLog.debug("Tracing enabled"):mxLog.debug("Tracing disabled")});mxLog.addButton("Copy",function(d){try{mxUtils.copy(mxLog.textarea.value)}catch(c){mxUtils.alert(c)}});mxLog.addButton("Show",function(d){try{mxUtils.popup(mxLog.textarea.value)}catch(c){mxUtils.alert(c)}});mxLog.addButton("Clear",function(b){mxLog.textarea.value=""});l=m=0;"number"===typeof window.innerWidth?(m=window.innerHeight,l=window.innerWidth):(m=document.documentElement.clientHeight||document.body.clientHeight,l=document.body.clientWidth);mxLog.window=new mxWindow(h,g,Math.max(0,l-320),Math.max(0,m-210),300,160);mxLog.window.setMaximizable(!0);mxLog.window.setScrollable(!1);mxLog.window.setResizable(!0);mxLog.window.setClosable(!0);mxLog.window.destroyOnClose=!1;if((mxClient.IS_NS||mxClient.IS_IE)&&!mxClient.IS_GC&&!mxClient.IS_SF&&"BackCompat"!=document.compatMode||11==document.documentMode){var i=mxLog.window.getElement(),h=function(d,c){mxLog.textarea.style.height=Math.max(0,i.offsetHeight-70)+"px"};mxLog.window.addListener(mxEvent.RESIZE_END,h);mxLog.window.addListener(mxEvent.MAXIMIZE,h);mxLog.window.addListener(mxEvent.NORMALIZE,h);mxLog.textarea.style.height="92px"}}},info:function(){mxLog.writeln(mxUtils.toString(navigator))},addButton:function(e,d){var f=document.createElement("button");mxUtils.write(f,e);mxEvent.addListener(f,"click",d);mxLog.td.appendChild(f)},isVisible:function(){return null!=mxLog.window?mxLog.window.isVisible():!1},show:function(){mxLog.setVisible(!0)},setVisible:function(b){null==mxLog.window&&mxLog.init();null!=mxLog.window&&mxLog.window.setVisible(b)},enter:function(b){if(mxLog.TRACE){return mxLog.writeln("Entering "+b),(new Date).getTime()}},leave:function(e,d){if(mxLog.TRACE){var f=0!=d?" ("+((new Date).getTime()-d)+" ms)":"";mxLog.writeln("Leaving "+e+f)}},debug:function(){mxLog.DEBUG&&mxLog.writeln.apply(this,arguments)},warn:function(){mxLog.WARN&&mxLog.writeln.apply(this,arguments)},write:function(){for(var d="",c=0;c<arguments.length;c++){d+=arguments[c],c<arguments.length-1&&(d+=" ")}null!=mxLog.textarea?(mxLog.textarea.value+=d,0<=navigator.userAgent.indexOf("Presto/2.5")&&(mxLog.textarea.style.visibility="hidden",mxLog.textarea.style.visibility="visible"),mxLog.textarea.scrollTop=mxLog.textarea.scrollHeight):mxLog.buffer+=d},writeln:function(){for(var d="",c=0;c<arguments.length;c++){d+=arguments[c],c<arguments.length-1&&(d+=" ")}mxLog.write(d+"\n")}},mxObjectIdentity={FIELD_NAME:"mxObjectId",counter:0,get:function(d){if("object"==typeof d&&null==d[mxObjectIdentity.FIELD_NAME]){var c=mxUtils.getFunctionName(d.constructor);d[mxObjectIdentity.FIELD_NAME]=c+"#"+mxObjectIdentity.counter++}return d[mxObjectIdentity.FIELD_NAME]},clear:function(b){"object"==typeof b&&delete b[mxObjectIdentity.FIELD_NAME]}};function mxDictionary(){this.clear()}mxDictionary.prototype.map=null;mxDictionary.prototype.clear=function(){this.map={}};mxDictionary.prototype.get=function(b){b=mxObjectIdentity.get(b);return this.map[b]};mxDictionary.prototype.put=function(f,e){var h=mxObjectIdentity.get(f),g=this.map[h];this.map[h]=e;return g};mxDictionary.prototype.remove=function(d){d=mxObjectIdentity.get(d);var c=this.map[d];delete this.map[d];return c};mxDictionary.prototype.getKeys=function(){var d=[],c;for(c in this.map){d.push(c)}return d};mxDictionary.prototype.getValues=function(){var d=[],c;for(c in this.map){d.push(this.map[c])}return d};mxDictionary.prototype.visit=function(d){for(var c in this.map){d(c,this.map[c])}};var mxResources={resources:[],extension:mxResourceExtension,resourcesEncoded:!1,loadDefaultBundle:!0,loadSpecialBundle:!0,isLanguageSupported:function(b){return null!=mxClient.languages?0<=mxUtils.indexOf(mxClient.languages,b):!0},getDefaultBundle:function(d,c){return mxResources.loadDefaultBundle||!mxResources.isLanguageSupported(c)?d+mxResources.extension:null},getSpecialBundle:function(e,d){if(null==mxClient.languages||!this.isLanguageSupported(d)){var f=d.indexOf("-");0<f&&(d=d.substring(0,f))}return mxResources.loadSpecialBundle&&mxResources.isLanguageSupported(d)&&d!=mxClient.defaultLanguage?e+"_"+d+mxResources.extension:null},add:function(h,g){g=null!=g?g:mxClient.language.toLowerCase();if(g!=mxConstants.NONE){var m=mxResources.getDefaultBundle(h,g);if(null!=m){try{var l=mxUtils.load(m);l.isReady()&&mxResources.parse(l.getText())}catch(k){}}m=mxResources.getSpecialBundle(h,g);if(null!=m){try{l=mxUtils.load(m),l.isReady()&&mxResources.parse(l.getText())}catch(i){}}}},parse:function(g){if(null!=g){g=g.split("\n");for(var f=0;f<g.length;f++){if("#"!=g[f].charAt(0)){var k=g[f].indexOf("=");if(0<k){var i=g[f].substring(0,k),h=g[f].length;13==g[f].charCodeAt(h-1)&&h--;k=g[f].substring(k+1,h);this.resourcesEncoded?(k=k.replace(/\\(?=u[a-fA-F\d]{4})/g,"%"),mxResources.resources[i]=unescape(k)):mxResources.resources[i]=k}}}}},get:function(h,g,m){h=mxResources.resources[h];null==h&&(h=m);if(null!=h&&null!=g){m=[];for(var l=null,k=0;k<h.length;k++){var i=h.charAt(k);"{"==i?l="":null!=l&&"}"==i?(l=parseInt(l)-1,0<=l&&l<g.length&&m.push(g[l]),l=null):null!=l?l+=i:m.push(i)}h=m.join("")}return h}};function mxPoint(d,c){this.x=null!=d?d:0;this.y=null!=c?c:0}mxPoint.prototype.x=null;mxPoint.prototype.y=null;mxPoint.prototype.equals=function(b){return null!=b&&b.x==this.x&&b.y==this.y};mxPoint.prototype.clone=function(){return mxUtils.clone(this)};function mxRectangle(f,e,h,g){mxPoint.call(this,f,e);this.width=null!=h?h:0;this.height=null!=g?g:0}mxRectangle.prototype=new mxPoint;mxRectangle.prototype.constructor=mxRectangle;mxRectangle.prototype.width=null;mxRectangle.prototype.height=null;mxRectangle.prototype.setRect=function(f,e,h,g){this.x=f;this.y=e;this.width=h;this.height=g};mxRectangle.prototype.getCenterX=function(){return this.x+this.width/2};mxRectangle.prototype.getCenterY=function(){return this.y+this.height/2};mxRectangle.prototype.add=function(f){if(null!=f){var e=Math.min(this.x,f.x),h=Math.min(this.y,f.y),g=Math.max(this.x+this.width,f.x+f.width);f=Math.max(this.y+this.height,f.y+f.height);this.x=e;this.y=h;this.width=g-e;this.height=f-h}};mxRectangle.prototype.grow=function(b){this.x-=b;this.y-=b;this.width+=2*b;this.height+=2*b};mxRectangle.prototype.getPoint=function(){return new mxPoint(this.x,this.y)};mxRectangle.prototype.equals=function(b){return null!=b&&b.x==this.x&&b.y==this.y&&b.width==this.width&&b.height==this.height};var mxEffects={animateChanges:function(h,g,m){var l=0,k=function(){for(var e=!1,d=0;d<g.length;d++){var c=g[d];if(c instanceof mxGeometryChange||c instanceof mxTerminalChange||c instanceof mxValueChange||c instanceof mxChildChange||c instanceof mxStyleChange){var b=h.getView().getState(c.cell||c.child,!1);if(null!=b){if(e=!0,c.constructor!=mxGeometryChange||h.model.isEdge(c.cell)){mxUtils.setOpacity(b.shape.node,100*l/10)}else{var a=h.getView().scale,r=(c.geometry.x-c.previous.x)*a,o=(c.geometry.y-c.previous.y)*a,f=(c.geometry.width-c.previous.width)*a,a=(c.geometry.height-c.previous.height)*a;0==l?(b.x-=r,b.y-=o,b.width-=f,b.height-=a):(b.x+=r/10,b.y+=o/10,b.width+=f/10,b.height+=a/10);h.cellRenderer.redraw(b);mxEffects.cascadeOpacity(h,c.cell,100*l/10)}}}}10>l&&e?(l++,window.setTimeout(k,i)):null!=m&&m()},i=30;k()},cascadeOpacity:function(i,h,o){for(var n=i.model.getChildCount(h),m=0;m<n;m++){var l=i.model.getChildAt(h,m),k=i.getView().getState(l);null!=k&&(mxUtils.setOpacity(k.shape.node,o),mxEffects.cascadeOpacity(i,l,o))}h=i.model.getEdges(h);if(null!=h){for(m=0;m<h.length;m++){n=i.getView().getState(h[m]),null!=n&&mxUtils.setOpacity(n.shape.node,o)}}},fadeOut:function(k,i,q,p,o,n){p=p||40;o=o||30;var m=i||100;mxUtils.setOpacity(k,m);if(n||null==n){var l=function(){m=Math.max(m-p,0);mxUtils.setOpacity(k,m);0<m?window.setTimeout(l,o):(k.style.visibility="hidden",q&&k.parentNode&&k.parentNode.removeChild(k))};window.setTimeout(l,o)}else{k.style.visibility="hidden",q&&k.parentNode&&k.parentNode.removeChild(k)}}},mxUtils={errorResource:"none"!=mxClient.language?"error":"",closeResource:"none"!=mxClient.language?"close":"",errorImage:mxClient.imageBasePath+"/error.gif",removeCursors:function(e){null!=e.style&&(e.style.cursor="");e=e.childNodes;if(null!=e){for(var d=e.length,f=0;f<d;f+=1){mxUtils.removeCursors(e[f])}}},getCurrentStyle:function(){return mxClient.IS_IE?function(b){return null!=b?b.currentStyle:null}:function(b){return null!=b?window.getComputedStyle(b,""):null}}(),setPrefixedStyle:function(){var b=null;mxClient.IS_OP&&mxClient.IS_OT?b="O":mxClient.IS_SF||mxClient.IS_GC?b="Webkit":mxClient.IS_MT?b="Moz":mxClient.IS_IE&&(9<=document.documentMode&&10>document.documentMode)&&(b="ms");return function(a,f,e){a[f]=e;null!=b&&0<f.length&&(f=b+f.substring(0,1).toUpperCase()+f.substring(1),a[f]=e)}}(),hasScrollbars:function(b){b=mxUtils.getCurrentStyle(b);return null!=b&&("scroll"==b.overflow||"auto"==b.overflow)},bind:function(d,c){return function(){return c.apply(d,arguments)}},eval:function(a){var b=null;if(0<=a.indexOf("function")){try{eval("var _mxJavaScriptExpression="+a),b=_mxJavaScriptExpression,_mxJavaScriptExpression=null}catch(c){mxLog.warn(c.message+" while evaluating "+a)}}else{try{b=eval(a)}catch(d){mxLog.warn(d.message+" while evaluating "+a)}}return b},findNode:function(f,e,h){var g=f.getAttribute(e);if(null!=g&&g==h){return f}for(f=f.firstChild;null!=f;){g=mxUtils.findNode(f,e,h);if(null!=g){return g}f=f.nextSibling}return null},findNodeByAttribute:function(){return 9<=document.documentMode?function(f,e,h){var g=null;if(null!=f){if(f.nodeType==mxConstants.NODETYPE_ELEMENT&&f.getAttribute(e)==h){g=f}else{for(f=f.firstChild;null!=f&&null==g;){g=mxUtils.findNodeByAttribute(f,e,h),f=f.nextSibling}}}return g}:mxClient.IS_IE?function(e,d,f){return null==e?null:e.ownerDocument.selectSingleNode("//*[@"+d+"='"+f+"']")}:function(e,d,f){return null==e?null:e.ownerDocument.evaluate("//*[@"+d+"='"+f+"']",e.ownerDocument,null,XPathResult.ANY_TYPE,null).iterateNext()}}(),getFunctionName:function(e){var d=null;if(null!=e){if(null!=e.name){d=e.name}else{e=e.toString();for(d=9;" "==e.charAt(d);){d++}var f=e.indexOf("(",d),d=e.substring(d,f)}}return d},indexOf:function(e,d){if(null!=e&&null!=d){for(var f=0;f<e.length;f++){if(e[f]==d){return f}}}return -1},remove:function(g,f){var k=null;if("object"==typeof f){for(var i=mxUtils.indexOf(f,g);0<=i;){f.splice(i,1),k=g,i=mxUtils.indexOf(f,g)}}for(var h in f){f[h]==g&&(delete f[h],k=g)}return k},isNode:function(f,e,h,g){return null!=f&&!isNaN(f.nodeType)&&(null==e||f.nodeName.toLowerCase()==e.toLowerCase())?null==h||f.getAttribute(h)==g:!1},getChildNodes:function(f,e){e=e||mxConstants.NODETYPE_ELEMENT;for(var h=[],g=f.firstChild;null!=g;){g.nodeType==e&&h.push(g),g=g.nextSibling}return h},createXmlDocument:function(){var b=null;document.implementation&&document.implementation.createDocument?b=document.implementation.createDocument("","",null):window.ActiveXObject&&(b=new ActiveXObject("Microsoft.XMLDOM"));return b},parseXml:function(){return mxClient.IS_IE&&("undefined"===typeof document.documentMode||9>document.documentMode)?function(d){var c=mxUtils.createXmlDocument();c.async="false";c.loadXML(d);return c}:function(b){return(new DOMParser).parseFromString(b,"text/xml")}}(),clearSelection:function(){if(document.selection){return function(){document.selection.empty()}}if(window.getSelection){return function(){window.getSelection().removeAllRanges()}}}(),getPrettyXml:function(i,h,o){var n=[];if(null!=i){if(h=h||"  ",o=o||"",i.nodeType==mxConstants.NODETYPE_TEXT){n.push(i.nodeValue)}else{n.push(o+"<"+i.nodeName);var m=i.attributes;if(null!=m){for(var l=0;l<m.length;l++){var k=mxUtils.htmlEntities(m[l].nodeValue);n.push(" "+m[l].nodeName+'="'+k+'"')}}m=i.firstChild;if(null!=m){for(n.push(">\n");null!=m;){n.push(mxUtils.getPrettyXml(m,h,o+h)),m=m.nextSibling}n.push(o+"</"+i.nodeName+">\n")}else{n.push("/>\n")}}}return n.join("")},removeWhitespace:function(g,f){for(var k=f?g.previousSibling:g.nextSibling;null!=k&&k.nodeType==mxConstants.NODETYPE_TEXT;){var i=f?k.previousSibling:k.nextSibling,h=mxUtils.getTextContent(k);0==mxUtils.trim(h).length&&k.parentNode.removeChild(k);k=i}},htmlEntities:function(d,c){d=(d||"").replace(/&/g,"&amp;");d=d.replace(/"/g,"&quot;");d=d.replace(/\'/g,"&#39;");d=d.replace(/</g,"&lt;");d=d.replace(/>/g,"&gt;");if(null==c||c){d=d.replace(/\n/g,"&#xa;")}return d},isVml:function(b){return null!=b&&"urn:schemas-microsoft-com:vml"==b.tagUrn},getXml:function(e,d){var f="";null!=window.XMLSerializer?f=(new XMLSerializer).serializeToString(e):null!=e.xml&&(f=e.xml.replace(/\r\n\t[\t]*/g,"").replace(/>\r\n/g,">").replace(/\r\n/g,"\n"));return f=f.replace(/\n/g,d||"&#xa;")},getTextContent:function(d){var c="";null!=d&&(null!=d.firstChild&&(d=d.firstChild),c=d.nodeValue||"");return c},getInnerHtml:function(){return mxClient.IS_IE?function(b){return null!=b?b.innerHTML:""}:function(b){return null!=b?(new XMLSerializer).serializeToString(b):""}}(),getOuterHtml:function(){return mxClient.IS_IE?function(g){if(null!=g){if(null!=g.outerHTML){return g.outerHTML}var f=[];f.push("<"+g.nodeName);var k=g.attributes;if(null!=k){for(var i=0;i<k.length;i++){var h=k[i].nodeValue;null!=h&&0<h.length&&(f.push(" "),f.push(k[i].nodeName),f.push('="'),f.push(h),f.push('"'))}}0==g.innerHTML.length?f.push("/>"):(f.push(">"),f.push(g.innerHTML),f.push("</"+g.nodeName+">"));return f.join("")}return""}:function(b){return null!=b?(new XMLSerializer).serializeToString(b):""}}(),write:function(e,d){var f=e.ownerDocument.createTextNode(d);null!=e&&e.appendChild(f);return f},writeln:function(e,d){var f=e.ownerDocument.createTextNode(d);null!=e&&(e.appendChild(f),e.appendChild(document.createElement("br")));return f},br:function(f,e){e=e||1;for(var h=null,g=0;g<e;g++){null!=f&&(h=f.ownerDocument.createElement("br"),f.appendChild(h))}return h},button:function(e,d,f){f=null!=f?f:document;f=f.createElement("button");mxUtils.write(f,e);mxEvent.addListener(f,"click",function(b){d(b)});return f},para:function(e,d){var f=document.createElement("p");mxUtils.write(f,d);null!=e&&e.appendChild(f);return f},addTransparentBackgroundFilter:function(b){b.style.filter+="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+mxClient.imageBasePath+"/transparent.gif', sizingMethod='scale')"},linkAction:function(g,f,k,i,h){return mxUtils.link(g,f,function(){k.execute(i)},h)},linkInvoke:function(h,g,m,l,k,i){return mxUtils.link(h,g,function(){m[l](k)},i)},link:function(g,f,k,i){var h=document.createElement("span");h.style.color="blue";h.style.textDecoration="underline";h.style.cursor="pointer";null!=i&&(h.style.paddingLeft=i+"px");mxEvent.addListener(h,"click",k);mxUtils.write(h,f);null!=g&&g.appendChild(h);return h},fit:function(h){var g=parseInt(h.offsetLeft),m=parseInt(h.offsetWidth),l=document.body,k=document.documentElement,i=(l.scrollLeft||k.scrollLeft)+(l.clientWidth||k.clientWidth);g+m>i&&(h.style.left=Math.max(l.scrollLeft||k.scrollLeft,i-m)+"px");g=parseInt(h.offsetTop);m=parseInt(h.offsetHeight);i=(l.scrollTop||k.scrollTop)+Math.max(l.clientHeight||0,k.clientHeight);g+m>i&&(h.style.top=Math.max(l.scrollTop||k.scrollTop,i-m)+"px")},open:function(e){if(mxClient.IS_NS){try{netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect")}catch(d){return mxUtils.alert("Permission to read file denied."),""}var f=Components.classes["@mozilla.org/file/local;1"].createInstance(Components.interfaces.nsILocalFile);f.initWithPath(e);if(!f.exists()){return mxUtils.alert("File not found."),""}e=Components.classes["@mozilla.org/network/file-input-stream;1"].createInstance(Components.interfaces.nsIFileInputStream);e.init(f,1,4,null);f=Components.classes["@mozilla.org/scriptableinputstream;1"].createInstance(Components.interfaces.nsIScriptableInputStream);f.init(e);return f.read(f.available())}f=(new ActiveXObject("Scripting.FileSystemObject")).OpenTextFile(e,1);e=f.readAll();f.close();return e},save:function(g,f){if(mxClient.IS_NS){try{netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect")}catch(k){mxUtils.alert("Permission to write file denied.");return}var i=Components.classes["@mozilla.org/file/local;1"].createInstance(Components.interfaces.nsILocalFile);i.initWithPath(g);i.exists()||i.create(0,420);var h=Components.classes["@mozilla.org/network/file-output-stream;1"].createInstance(Components.interfaces.nsIFileOutputStream);h.init(i,34,4,null);h.write(f,f.length);h.flush();h.close()}else{i=(new ActiveXObject("Scripting.FileSystemObject")).CreateTextFile(g,!0),i.Write(f),i.Close()}},saveAs:function(f){var e=document.createElement("iframe");e.setAttribute("src","");e.style.visibility="hidden";document.body.appendChild(e);try{if(mxClient.IS_NS){var h=e.contentDocument;h.open();h.write(f);h.close();try{netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect"),e.focus(),saveDocument(h)}catch(g){mxUtils.alert("Permission to save document denied.")}}else{h=e.contentWindow.document,h.write(f),h.execCommand("SaveAs",!1,document.location)}}finally{document.body.removeChild(e)}},copy:function(f){if(window.clipboardData){window.clipboardData.setData("Text",f)}else{netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");var e=Components.classes["@mozilla.org/widget/clipboard;1"].createInstance(Components.interfaces.nsIClipboard);if(e){var h=Components.classes["@mozilla.org/widget/transferable;1"].createInstance(Components.interfaces.nsITransferable);if(h){h.addDataFlavor("text/unicode");var g=Components.classes["@mozilla.org/supports-string;1"].createInstance(Components.interfaces.nsISupportsString);g.data=f;h.setTransferData("text/unicode",g,2*f.length);e.setData(h,null,Components.interfaces.nsIClipboard.kGlobalClipboard)}}}},load:function(b){b=new mxXmlRequest(b,null,"GET",!1);b.send();return b},get:function(e,d,f){return(new mxXmlRequest(e,null,"GET")).send(d,f)},post:function(f,e,h,g){return(new mxXmlRequest(f,e)).send(h,g)},submit:function(f,e,h,g){return(new mxXmlRequest(f,e)).simulate(h,g)},loadInto:function(e,d,f){mxClient.IS_IE?d.onreadystatechange=function(){4==d.readyState&&f()}:d.addEventListener("load",f,!1);d.load(e)},getValue:function(e,d,f){e=null!=e?e[d]:null;null==e&&(e=f);return e},getNumber:function(e,d,f){e=null!=e?e[d]:null;null==e&&(e=f||0);return Number(e)},getColor:function(e,d,f){e=null!=e?e[d]:null;null==e?e=f:e==mxConstants.NONE&&(e=null);return e},clone:function(g,f,k){k=null!=k?k:!1;var i=null;if(null!=g&&"function"==typeof g.constructor){var i=new g.constructor,h;for(h in g){if(h!=mxObjectIdentity.FIELD_NAME&&(null==f||0>mxUtils.indexOf(f,h))){i[h]=!k&&"object"==typeof g[h]?mxUtils.clone(g[h]):g[h]}}}return i},equalPoints:function(e,d){if(null==e&&null!=d||null!=e&&null==d||null!=e&&null!=d&&e.length!=d.length){return !1}if(null!=e&&null!=d){for(var f=0;f<e.length;f++){if(e[f]==d[f]||null!=e[f]&&!e[f].equals(d[f])){return !1}}}return !0},equalEntries:function(e,d){if(null==e&&null!=d||null!=e&&null==d||null!=e&&null!=d&&e.length!=d.length){return !1}if(null!=e&&null!=d){for(var f in e){if((!mxUtils.isNaN(e[f])||!mxUtils.isNaN(d[f]))&&e[f]!=d[f]){return !1}}}return !0},isNaN:function(b){return"number"==typeof b&&isNaN(b)},extend:function(e,d){var f=function(){};f.prototype=d.prototype;e.prototype=new f;e.prototype.constructor=e},toString:function(g){var f="",k;for(k in g){try{if(null==g[k]){f+=k+" = [null]\n"}else{if("function"==typeof g[k]){f+=k+" => [Function]\n"}else{if("object"==typeof g[k]){var i=mxUtils.getFunctionName(g[k].constructor),f=f+(k+" => ["+i+"]\n")}else{f+=k+" = "+g[k]+"\n"}}}}catch(h){f+=k+"="+h.message}}return f},toRadians:function(b){return Math.PI*b/180},arcToCurves:function(Q,P,O,N,M,L,K,J,I){J-=Q;I-=P;if(0===O||0===N){return E}O=Math.abs(O);N=Math.abs(N);var H=-J/2,G=-I/2,F=Math.cos(M*Math.PI/180),E=Math.sin(M*Math.PI/180);M=F*H+E*G;var H=-1*E*H+F*G,G=M*M,D=H*H,B=O*O,C=N*N,A=G/B+D/C;1<A?(O*=Math.sqrt(A),N*=Math.sqrt(A),L=0):(A=1,L===K&&(A=-1),L=A*Math.sqrt((B*C-B*D-C*G)/(B*D+C*G)));G=L*O*H/N;D=-1*L*N*M/O;J=F*G-E*D+J/2;I=E*G+F*D+I/2;B=Math.atan2((H-D)/N,(M-G)/O)-Math.atan2(0,1);L=0<=B?B:2*Math.PI+B;B=Math.atan2((-H-D)/N,(-M-G)/O)-Math.atan2((H-D)/N,(M-G)/O);M=0<=B?B:2*Math.PI+B;0==K&&0<M?M-=2*Math.PI:0!=K&&0>M&&(M+=2*Math.PI);K=2*M/Math.PI;K=Math.ceil(0>K?-1*K:K);M/=K;H=8/3*Math.sin(M/4)*Math.sin(M/4)/Math.sin(M/2);G=F*O;F*=N;O*=E;N*=E;for(var z=Math.cos(L),x=Math.sin(L),D=-H*(G*x+N*z),B=-H*(O*x-F*z),A=C=0,E=[],o=0;o<K;++o){L+=M;var z=Math.cos(L),x=Math.sin(L),C=G*z-N*x+J,A=O*z+F*x+I,i=-H*(G*x+N*z),z=-H*(O*x-F*z),x=6*o;E[x]=Number(D+Q);E[x+1]=Number(B+P);E[x+2]=Number(C-i+Q);E[x+3]=Number(A-z+P);E[x+4]=Number(C+Q);E[x+5]=Number(A+P);D=C+i;B=A+z}return E},getBoundingBox:function(s,r){var q=null;if(null!=s&&null!=r&&0!=r){var p=mxUtils.toRadians(r),q=Math.cos(p),o=Math.sin(p),n=new mxPoint(s.x+s.width/2,s.y+s.height/2),m=new mxPoint(s.x,s.y),p=new mxPoint(s.x+s.width,s.y),l=new mxPoint(p.x,s.y+s.height),i=new mxPoint(s.x,l.y),m=mxUtils.getRotatedPoint(m,q,o,n),p=mxUtils.getRotatedPoint(p,q,o,n),l=mxUtils.getRotatedPoint(l,q,o,n),i=mxUtils.getRotatedPoint(i,q,o,n),q=new mxRectangle(m.x,m.y,0,0);q.add(new mxRectangle(p.x,p.y,0,0));q.add(new mxRectangle(l.x,l.y,0,0));q.add(new mxRectangle(i.x,i.y,0,0))}return q},getRotatedPoint:function(g,f,k,i){i=null!=i?i:new mxPoint;var h=g.x-i.x;g=g.y-i.y;return new mxPoint(h*f-g*k+i.x,g*f+h*k+i.y)},getPortConstraints:function(f,e,h,g){f=mxUtils.getValue(f.style,mxConstants.STYLE_PORT_CONSTRAINT,null);if(null==f){return g}g=f.toString();f=mxConstants.DIRECTION_MASK_NONE;0<=g.indexOf(mxConstants.DIRECTION_NORTH)&&(f|=mxConstants.DIRECTION_MASK_NORTH);0<=g.indexOf(mxConstants.DIRECTION_WEST)&&(f|=mxConstants.DIRECTION_MASK_WEST);0<=g.indexOf(mxConstants.DIRECTION_SOUTH)&&(f|=mxConstants.DIRECTION_MASK_SOUTH);0<=g.indexOf(mxConstants.DIRECTION_EAST)&&(f|=mxConstants.DIRECTION_MASK_EAST);return f},reversePortConstraints:function(d){var c=0,c=(d&mxConstants.DIRECTION_MASK_WEST)<<3,c=c|(d&mxConstants.DIRECTION_MASK_NORTH)<<1,c=c|(d&mxConstants.DIRECTION_MASK_SOUTH)>>1;return c|=(d&mxConstants.DIRECTION_MASK_EAST)>>3},findNearestSegment:function(k,i,q){var p=-1;if(0<k.absolutePoints.length){for(var o=k.absolutePoints[0],n=null,m=1;m<k.absolutePoints.length;m++){var l=k.absolutePoints[m],o=mxUtils.ptSegDistSq(o.x,o.y,l.x,l.y,i,q);if(null==n||o<n){n=o,p=m-1}o=l}}return p},rectangleIntersectsSegment:function(s,r,q){var p=s.y,o=s.x,n=p+s.height,m=o+s.width;s=r.x;var l=q.x;r.x>q.x&&(s=q.x,l=r.x);l>m&&(l=m);s<o&&(s=o);if(s>l){return !1}var o=r.y,m=q.y,i=q.x-r.x;1e-7<Math.abs(i)&&(q=(q.y-r.y)/i,r=r.y-q*r.x,o=q*s+r,m=q*l+r);o>m&&(r=m,m=o,o=r);m>n&&(m=n);o<p&&(o=p);return o>m?!1:!0},contains:function(e,d,f){return e.x<=d&&e.x+e.width>=d&&e.y<=f&&e.y+e.height>=f},intersects:function(u,t){var s=u.width,r=u.height,q=t.width,p=t.height;if(0>=q||0>=p||0>=s||0>=r){return !1}var o=u.x,n=u.y,m=t.x,i=t.y,q=q+m,p=p+i,s=s+o,r=r+n;return(q<m||q>o)&&(p<i||p>n)&&(s<o||s>m)&&(r<n||r>i)},intersectsHotspot:function(w,v,u,t,s,r){t=null!=t?t:1;s=null!=s?s:0;r=null!=r?r:0;if(0<t){var q=w.getCenterX(),p=w.getCenterY(),o=w.width,n=w.height,i=mxUtils.getValue(w.style,mxConstants.STYLE_STARTSIZE)*w.view.scale;0<i&&(mxUtils.getValue(w.style,mxConstants.STYLE_HORIZONTAL,!0)?(p=w.y+i/2,n=i):(q=w.x+i/2,o=i));o=Math.max(s,o*t);n=Math.max(s,n*t);0<r&&(o=Math.min(o,r),n=Math.min(n,r));t=new mxRectangle(q-o/2,p-n/2,o,n);q=mxUtils.toRadians(mxUtils.getValue(w.style,mxConstants.STYLE_ROTATION)||0);0!=q&&(s=Math.cos(-q),r=Math.sin(-q),q=new mxPoint(w.getCenterX(),w.getCenterY()),w=mxUtils.getRotatedPoint(new mxPoint(v,u),s,r,q),v=w.x,u=w.y);return mxUtils.contains(t,v,u)}return !0},getOffset:function(h,g){var m=0,l=0;if(null!=g&&g){var k=document.body,i=document.documentElement,m=m+(k.scrollLeft||i.scrollLeft),l=l+(k.scrollTop||i.scrollTop)}for(;h.offsetParent;){m+=h.offsetLeft,l+=h.offsetTop,h=h.offsetParent}return new mxPoint(m,l)},getScrollOrigin:function(f){for(var e=document.body,h=document.documentElement,g=new mxPoint(e.scrollLeft||h.scrollLeft,e.scrollTop||h.scrollTop);null!=f&&f!=e&&f!=h;){!isNaN(f.scrollLeft)&&!isNaN(f.scrollTop)&&(g.x+=f.scrollLeft,g.y+=f.scrollTop),f=f.parentNode}return g},convertPoint:function(f,e,h){var g=mxUtils.getScrollOrigin(f);f=mxUtils.getOffset(f);f.x-=g.x;f.y-=g.y;return new mxPoint(e-f.x,h-f.y)},ltrim:function(d,c){return d.replace(RegExp("^["+(c||"\\s")+"]+","g"),"")},rtrim:function(d,c){return d.replace(RegExp("["+(c||"\\s")+"]+$","g"),"")},trim:function(d,c){return mxUtils.ltrim(mxUtils.rtrim(d,c),c)},isNumeric:function(b){return !isNaN(parseFloat(b))&&isFinite(b)&&("string"!=typeof b||0>b.toLowerCase().indexOf("0x"))},mod:function(d,c){return(d%c+c)%c},intersection:function(s,r,q,p,o,n,m,l){var i=(l-n)*(q-s)-(m-o)*(p-r);m=((m-o)*(r-n)-(l-n)*(s-o))/i;o=((q-s)*(r-n)-(p-r)*(s-o))/i;return 0<=m&&1>=m&&0<=o&&1>=o?new mxPoint(s+m*(q-s),r+m*(p-r)):null},ptSegDistSq:function(h,g,m,l,k,i){m-=h;l-=g;k-=h;i-=g;0>=k*m+i*l?m=0:(k=m-k,i=l-i,h=k*m+i*l,m=0>=h?0:h*h/(m*m+l*l));k=k*k+i*i-m;0>k&&(k=0);return k},relativeCcw:function(h,g,m,l,k,i){m-=h;l-=g;k-=h;i-=g;h=k*l-i*m;0==h&&(h=k*m+i*l,0<h&&(h=(k-m)*m+(i-l)*l,0>h&&(h=0)));return 0>h?-1:0<h?1:0},animateChanges:function(d,c){mxEffects.animateChanges.apply(this,arguments)},cascadeOpacity:function(e,d,f){mxEffects.cascadeOpacity.apply(this,arguments)},fadeOut:function(h,g,m,l,k,i){mxEffects.fadeOut.apply(this,arguments)},setOpacity:function(d,c){mxUtils.isVml(d)?d.style.filter=100<=c?null:"alpha(opacity="+c/5+")":mxClient.IS_IE&&("undefined"===typeof document.documentMode||9>document.documentMode)?d.style.filter=100<=c?null:"alpha(opacity="+c+")":d.style.opacity=c/100},createImage:function(d){var c=null;mxClient.IS_IE6&&"CSS1Compat"!=document.compatMode?(c=document.createElement(mxClient.VML_PREFIX+":image"),c.setAttribute("src",d),c.style.borderStyle="none"):(c=document.createElement("img"),c.setAttribute("src",d),c.setAttribute("border","0"));return c},sortCells:function(e,d){d=null!=d?d:!0;var f=new mxDictionary;e.sort(function(b,i){var h=f.get(b);null==h&&(h=mxCellPath.create(b).split(mxCellPath.PATH_SEPARATOR),f.put(b,h));var c=f.get(i);null==c&&(c=mxCellPath.create(i).split(mxCellPath.PATH_SEPARATOR),f.put(i,c));h=mxCellPath.compare(h,c);return 0==h?0:0<h==d?1:-1});return e},getStylename:function(b){return null!=b&&(b=b.split(";")[0],0>b.indexOf("="))?b:""},getStylenames:function(e){var d=[];if(null!=e){e=e.split(";");for(var f=0;f<e.length;f++){0>e[f].indexOf("=")&&d.push(e[f])}}return d},indexOfStylename:function(g,f){if(null!=g&&null!=f){for(var k=g.split(";"),i=0,h=0;h<k.length;h++){if(k[h]==f){return i}i+=k[h].length+1}}return -1},addStylename:function(d,c){0>mxUtils.indexOfStylename(d,c)&&(null==d?d="":0<d.length&&";"!=d.charAt(d.length-1)&&(d+=";"),d+=c);return d},removeStylename:function(g,f){var k=[];if(null!=g){for(var i=g.split(";"),h=0;h<i.length;h++){i[h]!=f&&k.push(i[h])}}return k.join(";")},removeAllStylenames:function(e){var d=[];if(null!=e){e=e.split(";");for(var f=0;f<e.length;f++){0<=e[f].indexOf("=")&&d.push(e[f])}}return d.join(";")},setCellStyles:function(h,g,m,l){if(null!=g&&0<g.length){h.beginUpdate();try{for(var k=0;k<g.length;k++){if(null!=g[k]){var i=mxUtils.setStyle(h.getStyle(g[k]),m,l);h.setStyle(g[k],i)}}}finally{h.endUpdate()}}},setStyle:function(g,f,k){var i=null!=k&&("undefined"==typeof k.length||0<k.length);if(null==g||0==g.length){i&&(g=f+"="+k)}else{var h=g.indexOf(f+"=");0>h?i&&(i=";"==g.charAt(g.length-1)?"":";",g=g+i+f+"="+k):(f=i?f+"="+k:"",k=g.indexOf(";",h),i||k++,g=g.substring(0,h)+f+(k>h?g.substring(k):""))}return g},setCellStyleFlags:function(i,h,o,n,m){if(null!=h&&0<h.length){i.beginUpdate();try{for(var l=0;l<h.length;l++){if(null!=h[l]){var k=mxUtils.setStyleFlag(i.getStyle(h[l]),o,n,m);i.setStyle(h[l],k)}}}finally{i.endUpdate()}}},setStyleFlag:function(i,h,o,n){if(null==i||0==i.length){i=n||null==n?h+"="+o:h+"=0"}else{var m=i.indexOf(h+"=");if(0>m){m=";"==i.charAt(i.length-1)?"":";",i=n||null==n?i+m+h+"="+o:i+m+h+"=0"}else{var l=i.indexOf(";",m),k="",k=0>l?i.substring(m+h.length+1):i.substring(m+h.length+1,l),k=null==n?parseInt(k)^o:n?parseInt(k)|o:parseInt(k)&~o;i=i.substring(0,m)+h+"="+k+(0<=l?i.substring(l):"")}}return i},getAlignmentAsPoint:function(f,e){var h=0,g=0;f==mxConstants.ALIGN_CENTER?h=-0.5:f==mxConstants.ALIGN_RIGHT&&(h=-1);e==mxConstants.ALIGN_MIDDLE?g=-0.5:e==mxConstants.ALIGN_BOTTOM&&(g=-1);return new mxPoint(h,g)},getSizeForString:function(g,f,k,i){f=null!=f?f:mxConstants.DEFAULT_FONTSIZE;k=null!=k?k:mxConstants.DEFAULT_FONTFAMILY;var h=document.createElement("div");h.style.fontFamily=k;h.style.fontSize=Math.round(f)+"px";h.style.lineHeight=Math.round(f*mxConstants.LINE_HEIGHT)+"px";h.style.position="absolute";h.style.visibility="hidden";h.style.display=mxClient.IS_QUIRKS?"inline":"inline-block";h.style.zoom="1";null!=i?(h.style.width=i+"px",h.style.whiteSpace="normal"):h.style.whiteSpace="nowrap";h.innerHTML=g;document.body.appendChild(h);g=new mxRectangle(0,0,h.offsetWidth,h.offsetHeight);document.body.removeChild(h);return g},getViewXml:function(w,v,u,t,s){t=null!=t?t:0;s=null!=s?s:0;v=null!=v?v:1;null==u&&(u=[w.getModel().getRoot()]);var r=w.getView(),q=null,p=r.isEventsEnabled();r.setEventsEnabled(!1);var o=r.drawPane,n=r.overlayPane;w.dialect==mxConstants.DIALECT_SVG?(r.drawPane=document.createElementNS(mxConstants.NS_SVG,"g"),r.canvas.appendChild(r.drawPane),r.overlayPane=document.createElementNS(mxConstants.NS_SVG,"g")):(r.drawPane=r.drawPane.cloneNode(!1),r.canvas.appendChild(r.drawPane),r.overlayPane=r.overlayPane.cloneNode(!1));r.canvas.appendChild(r.overlayPane);var i=r.getTranslate();r.translate=new mxPoint(t,s);v=new mxTemporaryCellStates(w.getView(),v,u);try{q=(new mxCodec).encode(w.getView())}finally{v.destroy(),r.translate=i,r.canvas.removeChild(r.drawPane),r.canvas.removeChild(r.overlayPane),r.drawPane=o,r.overlayPane=n,r.setEventsEnabled(p)}return q},getScaleForPageCount:function(k,i,q,p){if(1>k){return 1}q=null!=q?q:mxConstants.PAGE_FORMAT_A4_PORTRAIT;p=null!=p?p:0;var o=q.width-2*p;q=q.height-2*p;p=i.getGraphBounds().clone();i=i.getView().getScale();p.width/=i;p.height/=i;i=p.width;q=i/p.height/(o/q);p=Math.sqrt(k);var n=Math.sqrt(q);q=p*n;p/=n;if(1>q&&p>k){var m=p/k;p=k;q/=m}1>p&&q>k&&(m=q/k,q=k,p/=m);m=Math.ceil(q)*Math.ceil(p);for(n=0;m>k;){var m=Math.floor(q)/q,l=Math.floor(p)/p;1==m&&(m=Math.floor(q-1)/q);1==l&&(l=Math.floor(p-1)/p);m=m>l?m:l;q*=m;p*=m;m=Math.ceil(q)*Math.ceil(p);n++;if(10<n){break}}return 0.99999*(o*q/i)},show:function(u,t,s,r,q,p){s=null!=s?s:0;r=null!=r?r:0;null==t?t=window.open().document:t.open();var o=u.getGraphBounds(),n=-o.x+s,m=-o.y+r;null==q&&(q=o.width+s);null==p&&(p=o.height+r);if(mxClient.IS_IE||11==document.documentMode){r="<html><head>";o=document.getElementsByTagName("base");for(s=0;s<o.length;s++){r+=o[s].outerHTML}r+="<style>";for(s=0;s<document.styleSheets.length;s++){try{r+=document.styleSheets(s).cssText}catch(i){}}r=r+"</style></head><body>"+('<div style="position:absolute;overflow:hidden;width:'+q+"px;height:"+p+'px;"><div style="position:relative;left:'+n+"px;top:"+m+'px;">');r+=u.container.innerHTML;r+="</div></div></body><html>";t.writeln(r);t.close()}else{t.writeln("<html><head>");o=document.getElementsByTagName("base");for(s=0;s<o.length;s++){t.writeln(mxUtils.getOuterHtml(o[s]))}r=document.getElementsByTagName("link");for(s=0;s<r.length;s++){t.writeln(mxUtils.getOuterHtml(r[s]))}r=document.getElementsByTagName("style");for(s=0;s<r.length;s++){t.writeln(mxUtils.getOuterHtml(r[s]))}t.writeln("</head><body></body></html>");t.close();s=t.createElement("div");s.position="absolute";s.overflow="hidden";s.style.width=q+"px";s.style.height=p+"px";q=t.createElement("div");q.style.position="relative";q.style.left=n+"px";q.style.top=m+"px";for(u=u.container.firstChild;null!=u;){n=u.cloneNode(!0),q.appendChild(n),u=u.nextSibling}s.appendChild(q);t.body.appendChild(s)}mxUtils.removeCursors(t.body);return t},printScreen:function(d){var c=window.open();mxUtils.show(d,c.document);d=function(){c.focus();c.print();c.close()};mxClient.IS_GC?c.setTimeout(d,500):d()},popup:function(f,e){if(e){var h=document.createElement("div");h.style.overflow="scroll";h.style.width="636px";h.style.height="460px";var g=document.createElement("pre");g.innerHTML=mxUtils.htmlEntities(f,!1).replace(/\n/g,"<br>").replace(/ /g,"&nbsp;");h.appendChild(g);h=new mxWindow("Popup Window",h,document.body.clientWidth/2-320,(document.body.clientHeight||document.documentElement.clientHeight)/2-240,640,480,!1,!0);h.setClosable(!0);h.setVisible(!0)}else{mxClient.IS_NS?(h=window.open(),h.document.writeln("<pre>"+mxUtils.htmlEntities(f)+"</pre"),h.document.close()):(h=window.open(),g=h.document.createElement("pre"),g.innerHTML=mxUtils.htmlEntities(f,!1).replace(/\n/g,"<br>").replace(/ /g,"&nbsp;"),h.document.body.appendChild(g))}},alert:function(b){alert(b)},prompt:function(d,c){return prompt(d,null!=c?c:"")},confirm:function(b){return confirm(b)},error:function(i,h,o,n){var m=document.createElement("div");m.style.padding="20px";var l=document.createElement("img");l.setAttribute("src",n||mxUtils.errorImage);l.setAttribute("valign","bottom");l.style.verticalAlign="middle";m.appendChild(l);m.appendChild(document.createTextNode("\u00a0"));m.appendChild(document.createTextNode("\u00a0"));m.appendChild(document.createTextNode("\u00a0"));mxUtils.write(m,i);i=document.body.clientWidth;n=document.body.clientHeight||document.documentElement.clientHeight;var k=new mxWindow(mxResources.get(mxUtils.errorResource)||mxUtils.errorResource,m,(i-h)/2,n/4,h,null,!1,!0);o&&(mxUtils.br(m),h=document.createElement("p"),o=document.createElement("button"),mxClient.IS_IE?o.style.cssText="float:right":o.setAttribute("style","float:right"),mxEvent.addListener(o,"click",function(b){k.destroy()}),mxUtils.write(o,mxResources.get(mxUtils.closeResource)||mxUtils.closeResource),h.appendChild(o),m.appendChild(h),mxUtils.br(m),k.setClosable(!0));k.setVisible(!0);return k},makeDraggable:function(u,t,s,r,q,p,o,n,m,i){u=new mxDragSource(u,s);u.dragOffset=new mxPoint(null!=q?q:0,null!=p?p:mxConstants.TOOLTIP_VERTICAL_OFFSET);u.autoscroll=o;u.setGuidesEnabled(!1);null!=m&&(u.highlightDropTargets=m);null!=i&&(u.getDropTarget=i);u.getGraphForEvent=function(b){return"function"==typeof t?t(b):t};null!=r&&(u.createDragElement=function(){return r.cloneNode(!0)},n&&(u.createPreviewElement=function(f){var d=r.cloneNode(!0),h=parseInt(d.style.width),g=parseInt(d.style.height);d.style.width=Math.round(h*f.view.scale)+"px";d.style.height=Math.round(g*f.view.scale)+"px";return d}));return u}},mxConstants={DEFAULT_HOTSPOT:0.3,MIN_HOTSPOT_SIZE:8,MAX_HOTSPOT_SIZE:0,RENDERING_HINT_EXACT:"exact",RENDERING_HINT_FASTER:"faster",RENDERING_HINT_FASTEST:"fastest",DIALECT_SVG:"svg",DIALECT_VML:"vml",DIALECT_MIXEDHTML:"mixedHtml",DIALECT_PREFERHTML:"preferHtml",DIALECT_STRICTHTML:"strictHtml",NS_SVG:"http://www.w3.org/2000/svg",NS_XHTML:"http://www.w3.org/1999/xhtml",NS_XLINK:"http://www.w3.org/1999/xlink",SHADOWCOLOR:"gray",SHADOW_OFFSET_X:2,SHADOW_OFFSET_Y:3,SHADOW_OPACITY:1,NODETYPE_ELEMENT:1,NODETYPE_ATTRIBUTE:2,NODETYPE_TEXT:3,NODETYPE_CDATA:4,NODETYPE_ENTITY_REFERENCE:5,NODETYPE_ENTITY:6,NODETYPE_PROCESSING_INSTRUCTION:7,NODETYPE_COMMENT:8,NODETYPE_DOCUMENT:9,NODETYPE_DOCUMENTTYPE:10,NODETYPE_DOCUMENT_FRAGMENT:11,NODETYPE_NOTATION:12,TOOLTIP_VERTICAL_OFFSET:16,DEFAULT_VALID_COLOR:"#00FF00",DEFAULT_INVALID_COLOR:"#FF0000",HIGHLIGHT_STROKEWIDTH:3,CURSOR_MOVABLE_VERTEX:"move",CURSOR_MOVABLE_EDGE:"move",CURSOR_LABEL_HANDLE:"default",CURSOR_BEND_HANDLE:"pointer",CURSOR_CONNECT:"pointer",HIGHLIGHT_COLOR:"#00FF00",CONNECT_TARGET_COLOR:"#0000FF",INVALID_CONNECT_TARGET_COLOR:"#FF0000",DROP_TARGET_COLOR:"#0000FF",VALID_COLOR:"#00FF00",INVALID_COLOR:"#FF0000",EDGE_SELECTION_COLOR:"#00FF00",VERTEX_SELECTION_COLOR:"#00FF00",VERTEX_SELECTION_STROKEWIDTH:1,EDGE_SELECTION_STROKEWIDTH:1,VERTEX_SELECTION_DASHED:!0,EDGE_SELECTION_DASHED:!0,GUIDE_COLOR:"#FF0000",GUIDE_STROKEWIDTH:1,OUTLINE_COLOR:"#0099FF",OUTLINE_STROKEWIDTH:mxClient.IS_IE?2:3,HANDLE_SIZE:7,LABEL_HANDLE_SIZE:4,HANDLE_FILLCOLOR:"#00FF00",HANDLE_STROKECOLOR:"black",LABEL_HANDLE_FILLCOLOR:"yellow",CONNECT_HANDLE_FILLCOLOR:"#0000FF",LOCKED_HANDLE_FILLCOLOR:"#FF0000",OUTLINE_HANDLE_FILLCOLOR:"#00FFFF",OUTLINE_HANDLE_STROKECOLOR:"#0033FF",DEFAULT_FONTFAMILY:"Arial,Helvetica",DEFAULT_FONTSIZE:11,LINE_HEIGHT:1.2,DEFAULT_FONTSTYLE:0,DEFAULT_STARTSIZE:40,DEFAULT_MARKERSIZE:6,DEFAULT_IMAGESIZE:24,ENTITY_SEGMENT:30,RECTANGLE_ROUNDING_FACTOR:0.15,LINE_ARCSIZE:20,ARROW_SPACING:10,ARROW_WIDTH:30,ARROW_SIZE:30,PAGE_FORMAT_A4_PORTRAIT:new mxRectangle(0,0,826,1169),PAGE_FORMAT_A4_LANDSCAPE:new mxRectangle(0,0,1169,826),PAGE_FORMAT_LETTER_PORTRAIT:new mxRectangle(0,0,850,1100),PAGE_FORMAT_LETTER_LANDSCAPE:new mxRectangle(0,0,1100,850),NONE:"none",STYLE_PERIMETER:"perimeter",STYLE_SOURCE_PORT:"sourcePort",STYLE_TARGET_PORT:"targetPort",STYLE_PORT_CONSTRAINT:"portConstraint",STYLE_OPACITY:"opacity",STYLE_TEXT_OPACITY:"textOpacity",STYLE_OVERFLOW:"overflow",STYLE_ORTHOGONAL:"orthogonal",STYLE_EXIT_X:"exitX",STYLE_EXIT_Y:"exitY",STYLE_EXIT_PERIMETER:"exitPerimeter",STYLE_ENTRY_X:"entryX",STYLE_ENTRY_Y:"entryY",STYLE_ENTRY_PERIMETER:"entryPerimeter",STYLE_WHITE_SPACE:"whiteSpace",STYLE_ROTATION:"rotation",STYLE_FILLCOLOR:"fillColor",STYLE_SWIMLANE_FILLCOLOR:"swimlaneFillColor",STYLE_MARGIN:"margin",STYLE_GRADIENTCOLOR:"gradientColor",STYLE_GRADIENT_DIRECTION:"gradientDirection",STYLE_STROKECOLOR:"strokeColor",STYLE_SEPARATORCOLOR:"separatorColor",STYLE_STROKEWIDTH:"strokeWidth",STYLE_ALIGN:"align",STYLE_VERTICAL_ALIGN:"verticalAlign",STYLE_LABEL_POSITION:"labelPosition",STYLE_VERTICAL_LABEL_POSITION:"verticalLabelPosition",STYLE_IMAGE_ASPECT:"imageAspect",STYLE_IMAGE_ALIGN:"imageAlign",STYLE_IMAGE_VERTICAL_ALIGN:"imageVerticalAlign",STYLE_GLASS:"glass",STYLE_IMAGE:"image",STYLE_IMAGE_WIDTH:"imageWidth",STYLE_IMAGE_HEIGHT:"imageHeight",STYLE_IMAGE_BACKGROUND:"imageBackground",STYLE_IMAGE_BORDER:"imageBorder",STYLE_FLIPH:"flipH",STYLE_FLIPV:"flipV",STYLE_NOLABEL:"noLabel",STYLE_NOEDGESTYLE:"noEdgeStyle",STYLE_LABEL_BACKGROUNDCOLOR:"labelBackgroundColor",STYLE_LABEL_BORDERCOLOR:"labelBorderColor",STYLE_LABEL_PADDING:"labelPadding",STYLE_INDICATOR_SHAPE:"indicatorShape",STYLE_INDICATOR_IMAGE:"indicatorImage",STYLE_INDICATOR_COLOR:"indicatorColor",STYLE_INDICATOR_STROKECOLOR:"indicatorStrokeColor",STYLE_INDICATOR_GRADIENTCOLOR:"indicatorGradientColor",STYLE_INDICATOR_SPACING:"indicatorSpacing",STYLE_INDICATOR_WIDTH:"indicatorWidth",STYLE_INDICATOR_HEIGHT:"indicatorHeight",STYLE_INDICATOR_DIRECTION:"indicatorDirection",STYLE_SHADOW:"shadow",STYLE_SEGMENT:"segment",STYLE_ENDARROW:"endArrow",STYLE_STARTARROW:"startArrow",STYLE_ENDSIZE:"endSize",STYLE_STARTSIZE:"startSize",STYLE_SWIMLANE_LINE:"swimlaneLine",STYLE_ENDFILL:"endFill",STYLE_STARTFILL:"startFill",STYLE_DASHED:"dashed",STYLE_DASH_PATTERN:"dashPattern",STYLE_ROUNDED:"rounded",STYLE_CURVED:"curved",STYLE_ARCSIZE:"arcSize",STYLE_SMOOTH:"smooth",STYLE_SOURCE_PERIMETER_SPACING:"sourcePerimeterSpacing",STYLE_TARGET_PERIMETER_SPACING:"targetPerimeterSpacing",STYLE_PERIMETER_SPACING:"perimeterSpacing",STYLE_SPACING:"spacing",STYLE_SPACING_TOP:"spacingTop",STYLE_SPACING_LEFT:"spacingLeft",STYLE_SPACING_BOTTOM:"spacingBottom",STYLE_SPACING_RIGHT:"spacingRight",STYLE_HORIZONTAL:"horizontal",STYLE_DIRECTION:"direction",STYLE_ELBOW:"elbow",STYLE_FONTCOLOR:"fontColor",STYLE_FONTFAMILY:"fontFamily",STYLE_FONTSIZE:"fontSize",STYLE_FONTSTYLE:"fontStyle",STYLE_AUTOSIZE:"autosize",STYLE_FOLDABLE:"foldable",STYLE_EDITABLE:"editable",STYLE_BENDABLE:"bendable",STYLE_MOVABLE:"movable",STYLE_RESIZABLE:"resizable",STYLE_ROTATABLE:"rotatable",STYLE_CLONEABLE:"cloneable",STYLE_DELETABLE:"deletable",STYLE_SHAPE:"shape",STYLE_EDGE:"edgeStyle",STYLE_LOOP:"loopStyle",STYLE_ROUTING_CENTER_X:"routingCenterX",STYLE_ROUTING_CENTER_Y:"routingCenterY",FONT_BOLD:1,FONT_ITALIC:2,FONT_UNDERLINE:4,FONT_SHADOW:8,SHAPE_RECTANGLE:"rectangle",SHAPE_ELLIPSE:"ellipse",SHAPE_DOUBLE_ELLIPSE:"doubleEllipse",SHAPE_RHOMBUS:"rhombus",SHAPE_LINE:"line",SHAPE_IMAGE:"image",SHAPE_ARROW:"arrow",SHAPE_LABEL:"label",SHAPE_CYLINDER:"cylinder",SHAPE_SWIMLANE:"swimlane",SHAPE_CONNECTOR:"connector",SHAPE_ACTOR:"actor",SHAPE_CLOUD:"cloud",SHAPE_TRIANGLE:"triangle",SHAPE_HEXAGON:"hexagon",ARROW_CLASSIC:"classic",ARROW_BLOCK:"block",ARROW_OPEN:"open",ARROW_OVAL:"oval",ARROW_DIAMOND:"diamond",ARROW_DIAMOND_THIN:"diamondThin",ALIGN_LEFT:"left",ALIGN_CENTER:"center",ALIGN_RIGHT:"right",ALIGN_TOP:"top",ALIGN_MIDDLE:"middle",ALIGN_BOTTOM:"bottom",DIRECTION_NORTH:"north",DIRECTION_SOUTH:"south",DIRECTION_EAST:"east",DIRECTION_WEST:"west",DIRECTION_MASK_NONE:0,DIRECTION_MASK_WEST:1,DIRECTION_MASK_NORTH:2,DIRECTION_MASK_SOUTH:4,DIRECTION_MASK_EAST:8,DIRECTION_MASK_ALL:15,ELBOW_VERTICAL:"vertical",ELBOW_HORIZONTAL:"horizontal",EDGESTYLE_ELBOW:"elbowEdgeStyle",EDGESTYLE_ENTITY_RELATION:"entityRelationEdgeStyle",EDGESTYLE_LOOP:"loopEdgeStyle",EDGESTYLE_SIDETOSIDE:"sideToSideEdgeStyle",EDGESTYLE_TOPTOBOTTOM:"topToBottomEdgeStyle",EDGESTYLE_ORTHOGONAL:"orthogonalEdgeStyle",EDGESTYLE_SEGMENT:"segmentEdgeStyle",PERIMETER_ELLIPSE:"ellipsePerimeter",PERIMETER_RECTANGLE:"rectanglePerimeter",PERIMETER_RHOMBUS:"rhombusPerimeter",PERIMETER_TRIANGLE:"trianglePerimeter"};function mxEventObject(d){this.name=d;this.properties=[];for(var c=1;c<arguments.length;c+=2){null!=arguments[c+1]&&(this.properties[arguments[c]]=arguments[c+1])}}mxEventObject.prototype.name=null;mxEventObject.prototype.properties=null;mxEventObject.prototype.consumed=!1;mxEventObject.prototype.getName=function(){return this.name};mxEventObject.prototype.getProperties=function(){return this.properties};mxEventObject.prototype.getProperty=function(b){return this.properties[b]};mxEventObject.prototype.isConsumed=function(){return this.consumed};mxEventObject.prototype.consume=function(){this.consumed=!0};function mxMouseEvent(d,c){this.evt=d;this.state=c}mxMouseEvent.prototype.consumed=!1;mxMouseEvent.prototype.evt=null;mxMouseEvent.prototype.graphX=null;mxMouseEvent.prototype.graphY=null;mxMouseEvent.prototype.state=null;mxMouseEvent.prototype.getEvent=function(){return this.evt};mxMouseEvent.prototype.getSource=function(){return mxEvent.getSource(this.evt)};mxMouseEvent.prototype.isSource=function(d){if(null!=d){for(var c=this.getSource();null!=c;){if(c==d.node){return !0}c=c.parentNode}}return !1};mxMouseEvent.prototype.getX=function(){return mxEvent.getClientX(this.getEvent())};mxMouseEvent.prototype.getY=function(){return mxEvent.getClientY(this.getEvent())};mxMouseEvent.prototype.getGraphX=function(){return this.graphX};mxMouseEvent.prototype.getGraphY=function(){return this.graphY};mxMouseEvent.prototype.getState=function(){return this.state};mxMouseEvent.prototype.getCell=function(){var b=this.getState();return null!=b?b.cell:null};mxMouseEvent.prototype.isPopupTrigger=function(){return mxEvent.isPopupTrigger(this.getEvent())};mxMouseEvent.prototype.isConsumed=function(){return this.consumed};mxMouseEvent.prototype.consume=function(b){(null!=b?b:1)&&this.evt.preventDefault&&this.evt.preventDefault();this.evt.returnValue=!1;this.consumed=!0};function mxEventSource(b){this.setEventSource(b)}mxEventSource.prototype.eventListeners=null;mxEventSource.prototype.eventsEnabled=!0;mxEventSource.prototype.eventSource=null;mxEventSource.prototype.isEventsEnabled=function(){return this.eventsEnabled};mxEventSource.prototype.setEventsEnabled=function(b){this.eventsEnabled=b};mxEventSource.prototype.getEventSource=function(){return this.eventSource};mxEventSource.prototype.setEventSource=function(b){this.eventSource=b};mxEventSource.prototype.addListener=function(d,c){null==this.eventListeners&&(this.eventListeners=[]);this.eventListeners.push(d);this.eventListeners.push(c)};mxEventSource.prototype.removeListener=function(d){if(null!=this.eventListeners){for(var c=0;c<this.eventListeners.length;){this.eventListeners[c+1]==d?this.eventListeners.splice(c,2):c+=2}}};mxEventSource.prototype.fireEvent=function(g,f){if(null!=this.eventListeners&&this.isEventsEnabled()){null==g&&(g=new mxEventObject);null==f&&(f=this.getEventSource());null==f&&(f=this);for(var k=[f,g],i=0;i<this.eventListeners.length;i+=2){var h=this.eventListeners[i];(null==h||h==g.getName())&&this.eventListeners[i+1].apply(this,k)}}};var mxEvent={objects:[],addListener:function(){var b=function(e,g,f){null==e.mxListenerList&&(e.mxListenerList=[],mxEvent.objects.push(e));e.mxListenerList.push({name:g,f:f})};return window.addEventListener?function(a,f,e){a.addEventListener(f,e,!1);b(a,f,e)}:function(a,f,e){a.attachEvent("on"+f,e);b(a,f,e)}}(),removeListener:function(){var b=function(f,i,h){if(null!=f.mxListenerList){i=f.mxListenerList.length;for(var g=0;g<i;g++){if(f.mxListenerList[g].f==h){f.mxListenerList.splice(g,1);break}}0==f.mxListenerList.length&&(f.mxListenerList=null,f=mxUtils.indexOf(mxEvent.objects,f),0<=f&&mxEvent.objects.splice(f,1))}};return window.removeEventListener?function(a,f,e){a.removeEventListener(f,e,!1);b(a,f,e)}:function(a,f,e){a.detachEvent("on"+f,e);b(a,f,e)}}(),removeAllListeners:function(e){var d=e.mxListenerList;if(null!=d){for(;0<d.length;){var f=d[0];mxEvent.removeListener(e,f.name,f.f)}}},addGestureListeners:function(f,e,h,g){null!=e&&mxEvent.addListener(f,mxClient.IS_POINTER?"MSPointerDown":"mousedown",e);null!=h&&mxEvent.addListener(f,mxClient.IS_POINTER?"MSPointerMove":"mousemove",h);null!=g&&mxEvent.addListener(f,mxClient.IS_POINTER?"MSPointerUp":"mouseup",g);!mxClient.IS_POINTER&&mxClient.IS_TOUCH&&(null!=e&&mxEvent.addListener(f,"touchstart",e),null!=h&&mxEvent.addListener(f,"touchmove",h),null!=g&&mxEvent.addListener(f,"touchend",g))},removeGestureListeners:function(f,e,h,g){null!=e&&mxEvent.removeListener(f,mxClient.IS_POINTER?"MSPointerDown":"mousedown",e);null!=h&&mxEvent.removeListener(f,mxClient.IS_POINTER?"MSPointerMove":"mousemove",h);null!=g&&mxEvent.removeListener(f,mxClient.IS_POINTER?"MSPointerUp":"mouseup",g);!mxClient.IS_POINTER&&mxClient.IS_TOUCH&&(null!=e&&mxEvent.removeListener(f,"touchstart",e),null!=h&&mxEvent.removeListener(f,"touchmove",h),null!=g&&mxEvent.removeListener(f,"touchend",g))},redirectMouseEvents:function(k,i,q,p,o,n,m){var l=function(b){return"function"==typeof q?q(b):q};mxEvent.addGestureListeners(k,function(b){null!=p?p(b):mxEvent.isConsumed(b)||i.fireMouseEvent(mxEvent.MOUSE_DOWN,new mxMouseEvent(b,l(b)))},function(b){null!=o?o(b):mxEvent.isConsumed(b)||i.fireMouseEvent(mxEvent.MOUSE_MOVE,new mxMouseEvent(b,l(b)))},function(b){null!=n?n(b):mxEvent.isConsumed(b)||i.fireMouseEvent(mxEvent.MOUSE_UP,new mxMouseEvent(b,l(b)))});mxEvent.addListener(k,"dblclick",function(b){if(null!=m){m(b)}else{if(!mxEvent.isConsumed(b)){var d=l(b);i.dblClick(b,null!=d?d.cell:null)}}})},release:function(e){if(null!=e&&(mxEvent.removeAllListeners(e),e=e.childNodes,null!=e)){for(var d=e.length,f=0;f<d;f+=1){mxEvent.release(e[f])}}},addMouseWheelListener:function(d){if(null!=d){var c=function(a){null==a&&(a=window.event);var e=0,e=mxClient.IS_FF?-a.detail/2:a.wheelDelta/120;0!=e&&d(a,0<e)};mxClient.IS_NS?mxEvent.addListener(window,mxClient.IS_SF||mxClient.IS_GC?"mousewheel":"DOMMouseScroll",c):mxEvent.addListener(document,"mousewheel",c)}},disableContextMenu:function(){return mxClient.IS_IE&&("undefined"===typeof document.documentMode||9>document.documentMode)?function(b){mxEvent.addListener(b,"contextmenu",function(){return !1})}:function(b){b.setAttribute("oncontextmenu","return false;")}}(),getSource:function(b){return null!=b.srcElement?b.srcElement:b.target},isConsumed:function(b){return null!=b.isConsumed&&b.isConsumed},isTouchEvent:function(b){return null!=b.pointerType?"touch"==b.pointerType||b.pointerType===b.MSPOINTER_TYPE_TOUCH:0==b.type.indexOf("touch")},isMouseEvent:function(b){return null!=b.pointerType?"mouse"==b.pointerType||b.pointerType===b.MSPOINTER_TYPE_MOUSE:0==b.type.indexOf("mouse")},isLeftMouseButton:function(b){return b.button==(mxClient.IS_IE&&("undefined"===typeof document.documentMode||9>document.documentMode)?1:0)},isRightMouseButton:function(b){return 2==b.button},isPopupTrigger:function(b){return mxEvent.isRightMouseButton(b)||mxEvent.isShiftDown(b)&&!mxEvent.isControlDown(b)},isShiftDown:function(b){return null!=b?b.shiftKey:!1},isAltDown:function(b){return null!=b?b.altKey:!1},isControlDown:function(b){return null!=b?b.ctrlKey:!1},isMetaDown:function(b){return null!=b?b.metaKey:!1},getMainEvent:function(b){("touchstart"==b.type||"touchmove"==b.type)&&null!=b.touches&&null!=b.touches[0]?b=b.touches[0]:"touchend"==b.type&&(null!=b.changedTouches&&null!=b.changedTouches[0])&&(b=b.changedTouches[0]);return b},getClientX:function(b){return mxEvent.getMainEvent(b).clientX},getClientY:function(b){return mxEvent.getMainEvent(b).clientY},consume:function(e,d,f){f=null!=f?f:!0;if(null!=d?d:1){e.preventDefault?(f&&e.stopPropagation(),e.preventDefault()):f&&(e.cancelBubble=!0)}e.isConsumed=!0;e.returnValue=!1},LABEL_HANDLE:-1,ROTATION_HANDLE:-2,MOUSE_DOWN:"mouseDown",MOUSE_MOVE:"mouseMove",MOUSE_UP:"mouseUp",ACTIVATE:"activate",RESIZE_START:"resizeStart",RESIZE:"resize",RESIZE_END:"resizeEnd",MOVE_START:"moveStart",MOVE:"move",MOVE_END:"moveEnd",PAN_START:"panStart",PAN:"pan",PAN_END:"panEnd",MINIMIZE:"minimize",NORMALIZE:"normalize",MAXIMIZE:"maximize",HIDE:"hide",SHOW:"show",CLOSE:"close",DESTROY:"destroy",REFRESH:"refresh",SIZE:"size",SELECT:"select",FIRED:"fired",FIRE_MOUSE_EVENT:"fireMouseEvent",GESTURE:"gesture",TAP_AND_HOLD:"tapAndHold",GET:"get",RECEIVE:"receive",CONNECT:"connect",DISCONNECT:"disconnect",SUSPEND:"suspend",RESUME:"resume",MARK:"mark",SESSION:"session",ROOT:"root",POST:"post",OPEN:"open",SAVE:"save",BEFORE_ADD_VERTEX:"beforeAddVertex",ADD_VERTEX:"addVertex",AFTER_ADD_VERTEX:"afterAddVertex",DONE:"done",EXECUTE:"execute",EXECUTED:"executed",BEGIN_UPDATE:"beginUpdate",START_EDIT:"startEdit",END_UPDATE:"endUpdate",END_EDIT:"endEdit",BEFORE_UNDO:"beforeUndo",UNDO:"undo",REDO:"redo",CHANGE:"change",NOTIFY:"notify",LAYOUT_CELLS:"layoutCells",CLICK:"click",SCALE:"scale",TRANSLATE:"translate",SCALE_AND_TRANSLATE:"scaleAndTranslate",UP:"up",DOWN:"down",ADD:"add",REMOVE:"remove",CLEAR:"clear",ADD_CELLS:"addCells",CELLS_ADDED:"cellsAdded",MOVE_CELLS:"moveCells",CELLS_MOVED:"cellsMoved",RESIZE_CELLS:"resizeCells",CELLS_RESIZED:"cellsResized",TOGGLE_CELLS:"toggleCells",CELLS_TOGGLED:"cellsToggled",ORDER_CELLS:"orderCells",CELLS_ORDERED:"cellsOrdered",REMOVE_CELLS:"removeCells",CELLS_REMOVED:"cellsRemoved",GROUP_CELLS:"groupCells",UNGROUP_CELLS:"ungroupCells",REMOVE_CELLS_FROM_PARENT:"removeCellsFromParent",FOLD_CELLS:"foldCells",CELLS_FOLDED:"cellsFolded",ALIGN_CELLS:"alignCells",LABEL_CHANGED:"labelChanged",CONNECT_CELL:"connectCell",CELL_CONNECTED:"cellConnected",SPLIT_EDGE:"splitEdge",FLIP_EDGE:"flipEdge",START_EDITING:"startEditing",ADD_OVERLAY:"addOverlay",REMOVE_OVERLAY:"removeOverlay",UPDATE_CELL_SIZE:"updateCellSize",ESCAPE:"escape",CLICK:"click",DOUBLE_CLICK:"doubleClick",START:"start",RESET:"reset"};function mxXmlRequest(h,g,m,l,k,i){this.url=h;this.params=g;this.method=m||"POST";this.async=null!=l?l:!0;this.username=k;this.password=i}mxXmlRequest.prototype.url=null;mxXmlRequest.prototype.params=null;mxXmlRequest.prototype.method=null;mxXmlRequest.prototype.async=null;mxXmlRequest.prototype.binary=!1;mxXmlRequest.prototype.username=null;mxXmlRequest.prototype.password=null;mxXmlRequest.prototype.request=null;mxXmlRequest.prototype.isBinary=function(){return this.binary};mxXmlRequest.prototype.setBinary=function(b){this.binary=b};mxXmlRequest.prototype.getText=function(){return this.request.responseText};mxXmlRequest.prototype.isReady=function(){return 4==this.request.readyState};mxXmlRequest.prototype.getDocumentElement=function(){var b=this.getXml();return null!=b?b.documentElement:null};mxXmlRequest.prototype.getXml=function(){var b=this.request.responseXML;if(9<=document.documentMode||null==b||null==b.documentElement){b=mxUtils.parseXml(this.request.responseText)}return b};mxXmlRequest.prototype.getText=function(){return this.request.responseText};mxXmlRequest.prototype.getStatus=function(){return this.request.status};mxXmlRequest.prototype.create=function(){if(window.XMLHttpRequest){return function(){var b=new XMLHttpRequest;this.isBinary()&&b.overrideMimeType&&b.overrideMimeType("text/plain; charset=x-user-defined");return b}}if("undefined"!=typeof ActiveXObject){return function(){return new ActiveXObject("Microsoft.XMLHTTP")}}}();mxXmlRequest.prototype.send=function(d,c){this.request=this.create();null!=this.request&&(null!=d&&(this.request.onreadystatechange=mxUtils.bind(this,function(){this.isReady()&&(d(this),this.onreadystatechaange=null)})),this.request.open(this.method,this.url,this.async,this.username,this.password),this.setRequestHeaders(this.request,this.params),this.request.send(this.params))};mxXmlRequest.prototype.setRequestHeaders=function(d,c){null!=c&&d.setRequestHeader("Content-Type","application/x-www-form-urlencoded")};mxXmlRequest.prototype.simulate=function(s,r){s=s||document;var q=null;s==document&&(q=window.onbeforeunload,window.onbeforeunload=null);var p=s.createElement("form");p.setAttribute("method",this.method);p.setAttribute("action",this.url);null!=r&&p.setAttribute("target",r);p.style.display="none";p.style.visibility="hidden";for(var o=0<this.params.indexOf("&")?this.params.split("&"):this.params.split(),n=0;n<o.length;n++){var m=o[n].indexOf("=");if(0<m){var l=o[n].substring(0,m),i=o[n].substring(m+1),m=s.createElement("textarea");m.setAttribute("name",l);i=i.replace(/\n/g,"&#xa;");l=s.createTextNode(i);m.appendChild(l);p.appendChild(m)}}s.body.appendChild(p);p.submit();s.body.removeChild(p);null!=q&&(window.onbeforeunload=q)};var mxClipboard={STEPSIZE:10,insertCount:1,cells:null,setCells:function(b){mxClipboard.cells=b},getCells:function(){return mxClipboard.cells},isEmpty:function(){return null==mxClipboard.getCells()},cut:function(d,c){c=mxClipboard.copy(d,c);mxClipboard.insertCount=0;mxClipboard.removeCells(d,c);return c},removeCells:function(d,c){d.removeCells(c)},copy:function(e,d){d=d||e.getSelectionCells();var f=e.getExportableCells(d);mxClipboard.insertCount=1;mxClipboard.setCells(e.cloneCells(f));return f},paste:function(f){if(!mxClipboard.isEmpty()){var e=f.getImportableCells(mxClipboard.getCells()),h=mxClipboard.insertCount*mxClipboard.STEPSIZE,g=f.getDefaultParent(),e=f.importCells(e,h,h,g);mxClipboard.insertCount++;f.setSelectionCells(e)}}};function mxWindow(u,t,s,r,q,p,o,n,m,i){null!=t&&(o=null!=o?o:!0,this.content=t,this.init(s,r,q,p,i),this.installMaximizeHandler(),this.installMinimizeHandler(),this.installCloseHandler(),this.setMinimizable(o),this.setTitle(u),(null==n||n)&&this.installMoveHandler(),null!=m&&null!=m.parentNode?m.parentNode.replaceChild(this.div,m):document.body.appendChild(this.div))}mxWindow.prototype=new mxEventSource;mxWindow.prototype.constructor=mxWindow;mxWindow.prototype.closeImage=mxClient.imageBasePath+"/close.gif";mxWindow.prototype.minimizeImage=mxClient.imageBasePath+"/minimize.gif";mxWindow.prototype.normalizeImage=mxClient.imageBasePath+"/normalize.gif";mxWindow.prototype.maximizeImage=mxClient.imageBasePath+"/maximize.gif";mxWindow.prototype.resizeImage=mxClient.imageBasePath+"/resize.gif";mxWindow.prototype.visible=!1;mxWindow.prototype.minimumSize=new mxRectangle(0,0,50,40);mxWindow.prototype.destroyOnClose=!0;mxWindow.prototype.contentHeightCorrection=8==document.documentMode||7==document.documentMode?6:2;mxWindow.prototype.title=null;mxWindow.prototype.content=null;mxWindow.prototype.init=function(g,f,k,i,h){h=null!=h?h:"mxWindow";this.div=document.createElement("div");this.div.className=h;this.div.style.left=g+"px";this.div.style.top=f+"px";this.table=document.createElement("table");this.table.className=h;mxClient.IS_POINTER&&(this.div.style.msTouchAction="none");null!=k&&(mxClient.IS_QUIRKS||(this.div.style.width=k+"px"),this.table.style.width=k+"px");null!=i&&(mxClient.IS_QUIRKS||(this.div.style.height=i+"px"),this.table.style.height=i+"px");g=document.createElement("tbody");f=document.createElement("tr");this.title=document.createElement("td");this.title.className=h+"Title";f.appendChild(this.title);g.appendChild(f);f=document.createElement("tr");this.td=document.createElement("td");this.td.className=h+"Pane";7==document.documentMode&&(this.td.style.height="100%");this.contentWrapper=document.createElement("div");this.contentWrapper.className=h+"Pane";this.contentWrapper.style.width="100%";this.contentWrapper.appendChild(this.content);if(mxClient.IS_QUIRKS||"DIV"!=this.content.nodeName.toUpperCase()){this.contentWrapper.style.height="100%"}this.td.appendChild(this.contentWrapper);f.appendChild(this.td);g.appendChild(f);this.table.appendChild(g);this.div.appendChild(this.table);h=mxUtils.bind(this,function(b){this.activate()});mxEvent.addGestureListeners(this.title,h);mxEvent.addGestureListeners(this.table,h);this.hide()};mxWindow.prototype.setTitle=function(e){for(var d=this.title.firstChild;null!=d;){var f=d.nextSibling;d.nodeType==mxConstants.NODETYPE_TEXT&&d.parentNode.removeChild(d);d=f}mxUtils.write(this.title,e||"")};mxWindow.prototype.setScrollable=function(b){0>navigator.userAgent.indexOf("Presto/2.5")&&(this.contentWrapper.style.overflow=b?"auto":"hidden")};mxWindow.prototype.activate=function(){if(mxWindow.activeWindow!=this){var d=mxUtils.getCurrentStyle(this.getElement()),d=null!=d?d.zIndex:3;if(mxWindow.activeWindow){var c=mxWindow.activeWindow.getElement();null!=c&&null!=c.style&&(c.style.zIndex=d)}c=mxWindow.activeWindow;this.getElement().style.zIndex=parseInt(d)+1;mxWindow.activeWindow=this;this.fireEvent(new mxEventObject(mxEvent.ACTIVATE,"previousWindow",c))}};mxWindow.prototype.getElement=function(){return this.div};mxWindow.prototype.fit=function(){mxUtils.fit(this.div)};mxWindow.prototype.isResizable=function(){return null!=this.resize?"none"!=this.resize.style.display:!1};mxWindow.prototype.setResizable=function(i){if(i){if(null==this.resize){this.resize=document.createElement("img");this.resize.style.position="absolute";this.resize.style.bottom="2px";this.resize.style.right="2px";this.resize.setAttribute("src",mxClient.imageBasePath+"/resize.gif");this.resize.style.cursor="nw-resize";var h=null,o=null,n=null,m=null;i=mxUtils.bind(this,function(b){this.activate();h=mxEvent.getClientX(b);o=mxEvent.getClientY(b);n=this.div.offsetWidth;m=this.div.offsetHeight;mxEvent.addGestureListeners(document,null,l,k);this.fireEvent(new mxEventObject(mxEvent.RESIZE_START,"event",b));mxEvent.consume(b)});var l=mxUtils.bind(this,function(b){if(null!=h&&null!=o){var d=mxEvent.getClientX(b)-h,c=mxEvent.getClientY(b)-o;this.setSize(n+d,m+c);this.fireEvent(new mxEventObject(mxEvent.RESIZE,"event",b));mxEvent.consume(b)}}),k=mxUtils.bind(this,function(b){null!=h&&null!=o&&(o=h=null,mxEvent.removeGestureListeners(document,null,l,k),this.fireEvent(new mxEventObject(mxEvent.RESIZE_END,"event",b)),mxEvent.consume(b))});mxEvent.addGestureListeners(this.resize,i,l,k);this.div.appendChild(this.resize)}else{this.resize.style.display="inline"}}else{null!=this.resize&&(this.resize.style.display="none")}};mxWindow.prototype.setSize=function(d,c){d=Math.max(this.minimumSize.width,d);c=Math.max(this.minimumSize.height,c);mxClient.IS_QUIRKS||(this.div.style.width=d+"px",this.div.style.height=c+"px");this.table.style.width=d+"px";this.table.style.height=c+"px";mxClient.IS_QUIRKS||(this.contentWrapper.style.height=this.div.offsetHeight-this.title.offsetHeight-this.contentHeightCorrection+"px")};mxWindow.prototype.setMinimizable=function(b){this.minimize.style.display=b?"":"none"};mxWindow.prototype.getMinimumSize=function(){return new mxRectangle(0,0,0,this.title.offsetHeight)};mxWindow.prototype.installMinimizeHandler=function(){this.minimize=document.createElement("img");this.minimize.setAttribute("src",this.minimizeImage);this.minimize.setAttribute("align","right");this.minimize.setAttribute("title","Minimize");this.minimize.style.cursor="pointer";this.minimize.style.marginRight="1px";this.minimize.style.display="none";this.title.appendChild(this.minimize);var f=!1,e=null,h=null,g=mxUtils.bind(this,function(b){this.activate();if(f){f=!1,this.minimize.setAttribute("src",this.minimizeImage),this.minimize.setAttribute("title","Minimize"),this.contentWrapper.style.display="",this.maximize.style.display=e,mxClient.IS_QUIRKS||(this.div.style.height=h),this.table.style.height=h,null!=this.resize&&(this.resize.style.visibility=""),this.fireEvent(new mxEventObject(mxEvent.NORMALIZE,"event",b))}else{f=!0;this.minimize.setAttribute("src",this.normalizeImage);this.minimize.setAttribute("title","Normalize");this.contentWrapper.style.display="none";e=this.maximize.style.display;this.maximize.style.display="none";h=this.table.style.height;var a=this.getMinimumSize();0<a.height&&(mxClient.IS_QUIRKS||(this.div.style.height=a.height+"px"),this.table.style.height=a.height+"px");0<a.width&&(mxClient.IS_QUIRKS||(this.div.style.width=a.width+"px"),this.table.style.width=a.width+"px");null!=this.resize&&(this.resize.style.visibility="hidden");this.fireEvent(new mxEventObject(mxEvent.MINIMIZE,"event",b))}mxEvent.consume(b)});mxEvent.addGestureListeners(this.minimize,g)};mxWindow.prototype.setMaximizable=function(b){this.maximize.style.display=b?"":"none"};mxWindow.prototype.installMaximizeHandler=function(){this.maximize=document.createElement("img");this.maximize.setAttribute("src",this.maximizeImage);this.maximize.setAttribute("align","right");this.maximize.setAttribute("title","Maximize");this.maximize.style.cursor="default";this.maximize.style.marginLeft="1px";this.maximize.style.cursor="pointer";this.maximize.style.display="none";this.title.appendChild(this.maximize);var h=!1,g=null,m=null,l=null,k=null,i=mxUtils.bind(this,function(b){this.activate();if("none"!=this.maximize.style.display){if(h){h=!1;this.maximize.setAttribute("src",this.maximizeImage);this.maximize.setAttribute("title","Maximize");this.contentWrapper.style.display="";this.minimize.style.visibility="";this.div.style.left=g+"px";this.div.style.top=m+"px";if(!mxClient.IS_QUIRKS&&(this.div.style.height=l,this.div.style.width=k,a=mxUtils.getCurrentStyle(this.contentWrapper),"auto"==a.overflow||null!=this.resize)){this.contentWrapper.style.height=this.div.offsetHeight-this.title.offsetHeight-this.contentHeightCorrection+"px"}this.table.style.height=l;this.table.style.width=k;null!=this.resize&&(this.resize.style.visibility="");this.fireEvent(new mxEventObject(mxEvent.NORMALIZE,"event",b))}else{h=!0;this.maximize.setAttribute("src",this.normalizeImage);this.maximize.setAttribute("title","Normalize");this.contentWrapper.style.display="";this.minimize.style.visibility="hidden";g=parseInt(this.div.style.left);m=parseInt(this.div.style.top);l=this.table.style.height;k=this.table.style.width;this.div.style.left="0px";this.div.style.top="0px";a=Math.max(document.body.clientHeight||0,document.documentElement.clientHeight||0);mxClient.IS_QUIRKS||(this.div.style.width=document.body.clientWidth-2+"px",this.div.style.height=a-2+"px");this.table.style.width=document.body.clientWidth-2+"px";this.table.style.height=a-2+"px";null!=this.resize&&(this.resize.style.visibility="hidden");if(!mxClient.IS_QUIRKS){var a=mxUtils.getCurrentStyle(this.contentWrapper);if("auto"==a.overflow||null!=this.resize){this.contentWrapper.style.height=this.div.offsetHeight-this.title.offsetHeight-this.contentHeightCorrection+"px"}}this.fireEvent(new mxEventObject(mxEvent.MAXIMIZE,"event",b))}mxEvent.consume(b)}});mxEvent.addGestureListeners(this.maximize,i);mxEvent.addListener(this.title,"dblclick",i)};mxWindow.prototype.installMoveHandler=function(){this.title.style.cursor="move";mxEvent.addGestureListeners(this.title,mxUtils.bind(this,function(i){var h=mxEvent.getClientX(i),o=mxEvent.getClientY(i),n=this.getX(),m=this.getY(),l=mxUtils.bind(this,function(b){var d=mxEvent.getClientX(b)-h,c=mxEvent.getClientY(b)-o;this.setLocation(n+d,m+c);this.fireEvent(new mxEventObject(mxEvent.MOVE,"event",b));mxEvent.consume(b)}),k=mxUtils.bind(this,function(b){mxEvent.removeGestureListeners(document,null,l,k);this.fireEvent(new mxEventObject(mxEvent.MOVE_END,"event",b));mxEvent.consume(b)});mxEvent.addGestureListeners(document,null,l,k);this.fireEvent(new mxEventObject(mxEvent.MOVE_START,"event",i));mxEvent.consume(i)}));mxClient.IS_POINTER&&(this.title.style.msTouchAction="none")};mxWindow.prototype.setLocation=function(d,c){this.div.style.left=d+"px";this.div.style.top=c+"px"};mxWindow.prototype.getX=function(){return parseInt(this.div.style.left)};mxWindow.prototype.getY=function(){return parseInt(this.div.style.top)};mxWindow.prototype.installCloseHandler=function(){this.closeImg=document.createElement("img");this.closeImg.setAttribute("src",this.closeImage);this.closeImg.setAttribute("align","right");this.closeImg.setAttribute("title","Close");this.closeImg.style.marginLeft="2px";this.closeImg.style.cursor="pointer";this.closeImg.style.display="none";this.title.insertBefore(this.closeImg,this.title.firstChild);mxEvent.addGestureListeners(this.closeImg,mxUtils.bind(this,function(b){this.fireEvent(new mxEventObject(mxEvent.CLOSE,"event",b));this.destroyOnClose?this.destroy():this.setVisible(!1);mxEvent.consume(b)}))};mxWindow.prototype.setImage=function(b){this.image=document.createElement("img");this.image.setAttribute("src",b);this.image.setAttribute("align","left");this.image.style.marginRight="4px";this.image.style.marginLeft="0px";this.image.style.marginTop="-2px";this.title.insertBefore(this.image,this.title.firstChild)};mxWindow.prototype.setClosable=function(b){this.closeImg.style.display=b?"":"none"};mxWindow.prototype.isVisible=function(){return null!=this.div?"hidden"!=this.div.style.visibility:!1};mxWindow.prototype.setVisible=function(b){null!=this.div&&this.isVisible()!=b&&(b?this.show():this.hide())};mxWindow.prototype.show=function(){this.div.style.visibility="";this.activate();var b=mxUtils.getCurrentStyle(this.contentWrapper);if(!mxClient.IS_QUIRKS&&("auto"==b.overflow||null!=this.resize)){this.contentWrapper.style.height=this.div.offsetHeight-this.title.offsetHeight-this.contentHeightCorrection+"px"}this.fireEvent(new mxEventObject(mxEvent.SHOW))};mxWindow.prototype.hide=function(){this.div.style.visibility="hidden";this.fireEvent(new mxEventObject(mxEvent.HIDE))};mxWindow.prototype.destroy=function(){this.fireEvent(new mxEventObject(mxEvent.DESTROY));null!=this.div&&(mxEvent.release(this.div),this.div.parentNode.removeChild(this.div),this.div=null);this.contentWrapper=this.content=this.title=null};function mxForm(b){this.table=document.createElement("table");this.table.className=b;this.body=document.createElement("tbody");this.table.appendChild(this.body)}mxForm.prototype.table=null;mxForm.prototype.body=!1;mxForm.prototype.getTable=function(){return this.table};mxForm.prototype.addButtons=function(g,f){var k=document.createElement("tr"),i=document.createElement("td");k.appendChild(i);var i=document.createElement("td"),h=document.createElement("button");mxUtils.write(h,mxResources.get("ok")||"OK");i.appendChild(h);mxEvent.addListener(h,"click",function(){g()});h=document.createElement("button");mxUtils.write(h,mxResources.get("cancel")||"Cancel");i.appendChild(h);mxEvent.addListener(h,"click",function(){f()});k.appendChild(i);this.body.appendChild(k)};mxForm.prototype.addText=function(e,d){var f=document.createElement("input");f.setAttribute("type","text");f.value=d;return this.addField(e,f)};mxForm.prototype.addCheckbox=function(e,d){var f=document.createElement("input");f.setAttribute("type","checkbox");this.addField(e,f);d&&(f.checked=!0);return f};mxForm.prototype.addTextarea=function(f,e,h){var g=document.createElement("textarea");mxClient.IS_NS&&h--;g.setAttribute("rows",h||2);g.value=e;return this.addField(f,g)};mxForm.prototype.addCombo=function(f,e,h){var g=document.createElement("select");null!=h&&g.setAttribute("size",h);e&&g.setAttribute("multiple","true");return this.addField(f,g)};mxForm.prototype.addOption=function(g,f,k,i){var h=document.createElement("option");mxUtils.writeln(h,f);h.setAttribute("value",k);i&&h.setAttribute("selected",i);g.appendChild(h)};mxForm.prototype.addField=function(f,e){var h=document.createElement("tr"),g=document.createElement("td");mxUtils.write(g,f);h.appendChild(g);g=document.createElement("td");g.appendChild(e);h.appendChild(g);this.body.appendChild(h);return e};function mxImage(e,d,f){this.src=e;this.width=d;this.height=f}mxImage.prototype.src=null;mxImage.prototype.width=null;mxImage.prototype.height=null;function mxDivResizer(e,d){if("div"==e.nodeName.toLowerCase()){null==d&&(d=window);this.div=e;var f=mxUtils.getCurrentStyle(e);null!=f&&(this.resizeWidth="auto"==f.width,this.resizeHeight="auto"==f.height);mxEvent.addListener(d,"resize",mxUtils.bind(this,function(b){this.handlingResize||(this.handlingResize=!0,this.resize(),this.handlingResize=!1)}));this.resize()}}mxDivResizer.prototype.resizeWidth=!0;mxDivResizer.prototype.resizeHeight=!0;mxDivResizer.prototype.handlingResize=!1;mxDivResizer.prototype.resize=function(){var h=this.getDocumentWidth(),g=this.getDocumentHeight(),m=parseInt(this.div.style.left),l=parseInt(this.div.style.right),k=parseInt(this.div.style.top),i=parseInt(this.div.style.bottom);this.resizeWidth&&(!isNaN(m)&&!isNaN(l)&&0<=m&&0<=l&&0<h-l-m)&&(this.div.style.width=h-l-m+"px");this.resizeHeight&&(!isNaN(k)&&!isNaN(i)&&0<=k&&0<=i&&0<g-k-i)&&(this.div.style.height=g-k-i+"px")};mxDivResizer.prototype.getDocumentWidth=function(){return document.body.clientWidth};mxDivResizer.prototype.getDocumentHeight=function(){return document.body.clientHeight};function mxDragSource(d,c){this.element=d;this.dropHandler=c;mxEvent.addGestureListeners(d,mxUtils.bind(this,function(b){this.mouseDown(b)}))}mxDragSource.prototype.element=null;mxDragSource.prototype.dropHandler=null;mxDragSource.prototype.dragOffset=null;mxDragSource.prototype.dragElement=null;mxDragSource.prototype.previewElement=null;mxDragSource.prototype.enabled=!0;mxDragSource.prototype.currentGraph=null;mxDragSource.prototype.currentDropTarget=null;mxDragSource.prototype.currentPoint=null;mxDragSource.prototype.currentGuide=null;mxDragSource.prototype.currentHighlight=null;mxDragSource.prototype.autoscroll=!0;mxDragSource.prototype.guidesEnabled=!0;mxDragSource.prototype.gridEnabled=!0;mxDragSource.prototype.highlightDropTargets=!0;mxDragSource.prototype.dragElementZIndex=100;mxDragSource.prototype.dragElementOpacity=70;mxDragSource.prototype.isEnabled=function(){return this.enabled};mxDragSource.prototype.setEnabled=function(b){this.enabled=b};mxDragSource.prototype.isGuidesEnabled=function(){return this.guidesEnabled};mxDragSource.prototype.setGuidesEnabled=function(b){this.guidesEnabled=b};mxDragSource.prototype.isGridEnabled=function(){return this.gridEnabled};mxDragSource.prototype.setGridEnabled=function(b){this.gridEnabled=b};mxDragSource.prototype.getGraphForEvent=function(b){return null};mxDragSource.prototype.getDropTarget=function(e,d,f){return e.getCellAt(d,f)};mxDragSource.prototype.createDragElement=function(b){return this.element.cloneNode(!0)};mxDragSource.prototype.createPreviewElement=function(b){return null};mxDragSource.prototype.mouseDown=function(b){this.enabled&&(!mxEvent.isConsumed(b)&&null==this.mouseMoveHandler)&&(this.startDrag(b),this.mouseMoveHandler=mxUtils.bind(this,this.mouseMove),this.mouseUpHandler=mxUtils.bind(this,this.mouseUp),mxEvent.addGestureListeners(document,null,this.mouseMoveHandler,this.mouseUpHandler),mxClient.IS_TOUCH&&!mxEvent.isMouseEvent(b)&&(this.eventSource=mxEvent.getSource(b),mxEvent.addGestureListeners(this.eventSource,null,this.mouseMoveHandler,this.mouseUpHandler)),mxEvent.consume(b,!0,!1))};mxDragSource.prototype.startDrag=function(b){this.dragElement=this.createDragElement(b);this.dragElement.style.position="absolute";this.dragElement.style.zIndex=this.dragElementZIndex;mxUtils.setOpacity(this.dragElement,this.dragElementOpacity)};mxDragSource.prototype.stopDrag=function(b){null!=this.dragElement&&(null!=this.dragElement.parentNode&&this.dragElement.parentNode.removeChild(this.dragElement),this.dragElement=null)};mxDragSource.prototype.graphContainsEvent=function(h,g){var m=mxEvent.getClientX(g),l=mxEvent.getClientY(g),k=mxUtils.getOffset(h.container),i=mxUtils.getScrollOrigin();return m>=k.x-i.x&&l>=k.y-i.y&&m<=k.x-i.x+h.container.offsetWidth&&l<=k.y-i.y+h.container.offsetHeight};mxDragSource.prototype.mouseMove=function(e){var d=this.getGraphForEvent(e);null!=d&&!this.graphContainsEvent(d,e)&&(d=null);d!=this.currentGraph&&(null!=this.currentGraph&&this.dragExit(this.currentGraph,e),this.currentGraph=d,null!=this.currentGraph&&this.dragEnter(this.currentGraph,e));null!=this.currentGraph&&this.dragOver(this.currentGraph,e);if(null!=this.dragElement&&(null==this.previewElement||"visible"!=this.previewElement.style.visibility)){var d=mxEvent.getClientX(e),f=mxEvent.getClientY(e);null==this.dragElement.parentNode&&document.body.appendChild(this.dragElement);this.dragElement.style.visibility="visible";null!=this.dragOffset&&(d+=this.dragOffset.x,f+=this.dragOffset.y);d+=document.body.scrollLeft||document.documentElement.scrollLeft;f+=document.body.scrollTop||document.documentElement.scrollTop;this.dragElement.style.left=d+"px";this.dragElement.style.top=f+"px"}else{null!=this.dragElement&&(this.dragElement.style.visibility="hidden")}mxEvent.consume(e)};mxDragSource.prototype.mouseUp=function(e){if(null!=this.currentGraph){if(null!=this.currentPoint&&(null==this.previewElement||"hidden"!=this.previewElement.style.visibility)){var d=this.currentGraph.view.scale,f=this.currentGraph.view.translate;this.drop(this.currentGraph,e,this.currentDropTarget,this.currentPoint.x/d-f.x,this.currentPoint.y/d-f.y)}this.dragExit(this.currentGraph)}this.stopDrag(e);null!=this.eventSource&&(mxEvent.removeGestureListeners(this.eventSource,null,this.mouseMoveHandler,this.mouseUpHandler),this.eventSource=null);mxEvent.removeGestureListeners(document,null,this.mouseMoveHandler,this.mouseUpHandler);this.currentGraph=this.mouseUpHandler=this.mouseMoveHandler=null;mxEvent.consume(e)};mxDragSource.prototype.dragEnter=function(d,c){d.isMouseDown=!0;d.isMouseTrigger=mxEvent.isMouseEvent(c);this.previewElement=this.createPreviewElement(d);this.isGuidesEnabled()&&null!=this.previewElement&&(this.currentGuide=new mxGuide(d,d.graphHandler.getGuideStates()));this.highlightDropTargets&&(this.currentHighlight=new mxCellHighlight(d,mxConstants.DROP_TARGET_COLOR))};mxDragSource.prototype.dragExit=function(d,c){this.currentPoint=this.currentDropTarget=null;d.isMouseDown=!1;null!=this.previewElement&&(null!=this.previewElement.parentNode&&this.previewElement.parentNode.removeChild(this.previewElement),this.previewElement=null);null!=this.currentGuide&&(this.currentGuide.destroy(),this.currentGuide=null);null!=this.currentHighlight&&(this.currentHighlight.destroy(),this.currentHighlight=null)};mxDragSource.prototype.dragOver=function(k,i){var q=mxUtils.getOffset(k.container),p=mxUtils.getScrollOrigin(k.container),o=mxEvent.getClientX(i)-q.x+p.x,q=mxEvent.getClientY(i)-q.y+p.y;k.autoScroll&&(null==this.autoscroll||this.autoscroll)&&k.scrollPointToVisible(o,q,k.autoExtend);null!=this.currentHighlight&&k.isDropEnabled()&&(this.currentDropTarget=this.getDropTarget(k,o,q),p=k.getView().getState(this.currentDropTarget),!k.disconnerctNode&&this.currentHighlight.highlight(p));if(null!=this.previewElement){null==this.previewElement.parentNode&&(k.container.appendChild(this.previewElement),this.previewElement.style.zIndex="3",this.previewElement.style.position="absolute");var p=this.isGridEnabled()&&k.isGridEnabledEvent(i),n=!0;if(null!=this.currentGuide&&this.currentGuide.isEnabledForEvent(i)){var n=parseInt(this.previewElement.style.width),m=parseInt(this.previewElement.style.height),n=new mxRectangle(0,0,n,m),q=new mxPoint(o,q),q=this.currentGuide.move(n,q,p),n=!1,o=q.x,q=q.y}else{if(p){var p=k.view.scale,m=k.view.translate,l=k.gridSize/2,o=(k.snap(o/p-m.x-l)+m.x)*p,q=(k.snap(q/p-m.y-l)+m.y)*p}}null!=this.currentGuide&&n&&this.currentGuide.hide();null!=this.previewOffset&&(o+=this.previewOffset.x,q+=this.previewOffset.y);this.previewElement.style.left=Math.round(o)+"px";this.previewElement.style.top=Math.round(q)+"px";this.previewElement.style.visibility="visible"}this.currentPoint=new mxPoint(o,q)};mxDragSource.prototype.drop=function(g,f,k,i,h){this.dropHandler(g,f,k,i,h);g.container.focus()};function mxToolbar(b){this.container=b}mxToolbar.prototype=new mxEventSource;mxToolbar.prototype.constructor=mxToolbar;mxToolbar.prototype.container=null;mxToolbar.prototype.enabled=!0;mxToolbar.prototype.noReset=!1;mxToolbar.prototype.updateDefaultMode=!0;mxToolbar.prototype.addItem=function(k,i,q,p,o,n){var m=document.createElement(null!=i?"img":"button"),l=o||(null!=n?"mxToolbarMode":"mxToolbarItem");m.className=l;m.setAttribute("src",i);null!=k&&(null!=i?m.setAttribute("title",k):mxUtils.write(m,k));this.container.appendChild(m);null!=q&&(mxEvent.addListener(m,"click",q),mxClient.IS_TOUCH&&mxEvent.addListener(m,"touchend",q));k=mxUtils.bind(this,function(b){null!=p?m.setAttribute("src",i):m.style.backgroundColor=""});mxEvent.addGestureListeners(m,mxUtils.bind(this,function(d){null!=p?m.setAttribute("src",p):m.style.backgroundColor="gray";if(null!=n){null==this.menu&&(this.menu=new mxPopupMenu,this.menu.init());var c=this.currentImg;this.menu.isMenuShowing()&&this.menu.hideMenu();c!=m&&(this.currentImg=m,this.menu.factoryMethod=n,c=new mxPoint(m.offsetLeft,m.offsetTop+m.offsetHeight),this.menu.popup(c.x,c.y,null,d),this.menu.isMenuShowing()&&(m.className=l+"Selected",this.menu.hideMenu=function(){mxPopupMenu.prototype.hideMenu.apply(this);m.className=l;this.currentImg=null}))}}),null,k);mxEvent.addListener(m,"mouseout",k);return m};mxToolbar.prototype.addCombo=function(e){var d=document.createElement("div");d.style.display="inline";d.className="mxToolbarComboContainer";var f=document.createElement("select");f.className=e||"mxToolbarCombo";d.appendChild(f);this.container.appendChild(d);return f};mxToolbar.prototype.addActionCombo=function(e,d){var f=document.createElement("select");f.className=d||"mxToolbarCombo";this.addOption(f,e,null);mxEvent.addListener(f,"change",function(g){var c=f.options[f.selectedIndex];f.selectedIndex=0;null!=c.funct&&c.funct(g)});this.container.appendChild(f);return f};mxToolbar.prototype.addOption=function(f,e,h){var g=document.createElement("option");mxUtils.writeln(g,e);"function"==typeof h?g.funct=h:g.setAttribute("value",h);f.appendChild(g);return g};mxToolbar.prototype.addSwitchMode=function(h,g,m,l,k){var i=document.createElement("img");i.initialClassName=k||"mxToolbarMode";i.className=i.initialClassName;i.setAttribute("src",g);i.altIcon=l;null!=h&&i.setAttribute("title",h);mxEvent.addListener(i,"click",mxUtils.bind(this,function(b){b=this.selectedMode.altIcon;null!=b?(this.selectedMode.altIcon=this.selectedMode.getAttribute("src"),this.selectedMode.setAttribute("src",b)):this.selectedMode.className=this.selectedMode.initialClassName;this.updateDefaultMode&&(this.defaultMode=i);this.selectedMode=i;b=i.altIcon;null!=b?(i.altIcon=i.getAttribute("src"),i.setAttribute("src",b)):i.className=i.initialClassName+"Selected";this.fireEvent(new mxEventObject(mxEvent.SELECT));m()}));this.container.appendChild(i);null==this.defaultMode&&(this.defaultMode=i,this.selectMode(i),m());return i};mxToolbar.prototype.addMode=function(i,h,o,n,m,l){l=null!=l?l:!0;var k=document.createElement(null!=h?"img":"button");k.initialClassName=m||"mxToolbarMode";k.className=k.initialClassName;k.setAttribute("src",h);k.altIcon=n;null!=i&&k.setAttribute("title",i);this.enabled&&l&&(mxEvent.addListener(k,"click",mxUtils.bind(this,function(b){this.selectMode(k,o);this.noReset=!1})),mxEvent.addListener(k,"dblclick",mxUtils.bind(this,function(b){this.selectMode(k,o);this.noReset=!0})),null==this.defaultMode&&(this.defaultMode=k,this.defaultFunction=o,this.selectMode(k,o)));this.container.appendChild(k);return k};mxToolbar.prototype.selectMode=function(e,d){if(this.selectedMode!=e){if(null!=this.selectedMode){var f=this.selectedMode.altIcon;null!=f?(this.selectedMode.altIcon=this.selectedMode.getAttribute("src"),this.selectedMode.setAttribute("src",f)):this.selectedMode.className=this.selectedMode.initialClassName}this.selectedMode=e;f=this.selectedMode.altIcon;null!=f?(this.selectedMode.altIcon=this.selectedMode.getAttribute("src"),this.selectedMode.setAttribute("src",f)):this.selectedMode.className=this.selectedMode.initialClassName+"Selected";this.fireEvent(new mxEventObject(mxEvent.SELECT,"function",d))}};mxToolbar.prototype.resetMode=function(b){(b||!this.noReset)&&this.selectedMode!=this.defaultMode&&this.selectMode(this.defaultMode,this.defaultFunction)};mxToolbar.prototype.addSeparator=function(b){return this.addItem(null,b,null)};mxToolbar.prototype.addBreak=function(){mxUtils.br(this.container)};mxToolbar.prototype.addLine=function(){var b=document.createElement("hr");b.style.marginRight="6px";b.setAttribute("size","1");this.container.appendChild(b)};mxToolbar.prototype.destroy=function(){mxEvent.release(this.container);this.selectedMode=this.defaultFunction=this.defaultMode=this.container=null;null!=this.menu&&this.menu.destroy()};function mxSession(f,e,h,g){this.model=f;this.urlInit=e;this.urlPoll=h;this.urlNotify=g;null!=f&&(this.codec=new mxCodec,this.codec.lookup=function(a){return f.getCell(a)});f.addListener(mxEvent.NOTIFY,mxUtils.bind(this,function(i,d){var k=d.getProperty("edit");(null!=k&&this.debug||this.connected&&!this.suspended)&&this.notify("<edit>"+this.encodeChanges(k.changes,k.undone)+"</edit>")}))}mxSession.prototype=new mxEventSource;mxSession.prototype.constructor=mxSession;mxSession.prototype.model=null;mxSession.prototype.urlInit=null;mxSession.prototype.urlPoll=null;mxSession.prototype.urlNotify=null;mxSession.prototype.codec=null;mxSession.prototype.linefeed="&#xa;";mxSession.prototype.escapePostData=!0;mxSession.prototype.significantRemoteChanges=!0;mxSession.prototype.sent=0;mxSession.prototype.received=0;mxSession.prototype.debug=!1;mxSession.prototype.connected=!1;mxSession.prototype.suspended=!1;mxSession.prototype.polling=!1;mxSession.prototype.start=function(){this.debug?(this.connected=!0,this.fireEvent(new mxEventObject(mxEvent.CONNECT))):this.connected||this.get(this.urlInit,mxUtils.bind(this,function(b){this.connected=!0;this.fireEvent(new mxEventObject(mxEvent.CONNECT));this.poll()}))};mxSession.prototype.suspend=function(){this.connected&&!this.suspended&&(this.suspended=!0,this.fireEvent(new mxEventObject(mxEvent.SUSPEND)))};mxSession.prototype.resume=function(e,d,f){this.connected&&this.suspended&&(this.suspended=!1,this.fireEvent(new mxEventObject(mxEvent.RESUME)),this.polling||this.poll())};mxSession.prototype.stop=function(b){this.connected&&(this.connected=!1);this.fireEvent(new mxEventObject(mxEvent.DISCONNECT,"reason",b))};mxSession.prototype.poll=function(){this.connected&&!this.suspended&&null!=this.urlPoll?(this.polling=!0,this.get(this.urlPoll,mxUtils.bind(this,function(){this.poll()}))):this.polling=!1};mxSession.prototype.notify=function(e,d,f){null!=e&&0<e.length&&(null!=this.urlNotify&&(this.debug?(mxLog.show(),mxLog.debug("mxSession.notify: "+this.urlNotify+" xml="+e)):(e="<message><delta>"+e+"</delta></message>",this.escapePostData&&(e=encodeURIComponent(e)),mxUtils.post(this.urlNotify,"xml="+e,d,f))),this.sent+=e.length,this.fireEvent(new mxEventObject(mxEvent.NOTIFY,"url",this.urlNotify,"xml",e)))};mxSession.prototype.get=function(f,e,h){if("undefined"!=typeof mxUtils){var g=mxUtils.bind(this,function(b){null!=h?h(b):this.stop(b)});mxUtils.get(f,mxUtils.bind(this,function(b){if("undefined"!=typeof mxUtils){if(b.isReady()&&404!=b.getStatus()){if(this.received+=b.getText().length,this.fireEvent(new mxEventObject(mxEvent.GET,"url",f,"request",b)),this.isValidResponse(b)){if(0<b.getText().length){var a=b.getDocumentElement();null==a?g("Invalid response: "+b.getText()):this.receive(a)}null!=e&&e(b)}}else{g("Response not ready")}}}),function(b){g("Transmission error")})}};mxSession.prototype.isValidResponse=function(b){return 0>b.getText().indexOf("<?php")};mxSession.prototype.encodeChanges=function(h,g){for(var m="",l=g?-1:1,k=g?h.length-1:0;0<=k&&k<h.length;k+=l){var i=this.codec.encode(h[k]),m=m+mxUtils.getXml(i,this.linefeed)}return m};mxSession.prototype.receive=function(e){if(null!=e&&e.nodeType==mxConstants.NODETYPE_ELEMENT){var d=e.getAttribute("namespace");null!=d&&(this.model.prefix=d+"-");for(d=e.firstChild;null!=d;){var f=d.nodeName.toLowerCase();"state"==f?this.processState(d):"delta"==f&&this.processDelta(d);d=d.nextSibling}this.fireEvent(new mxEventObject(mxEvent.RECEIVE,"node",e))}};mxSession.prototype.processState=function(b){(new mxCodec(b.ownerDocument)).decode(b.firstChild,this.model)};mxSession.prototype.processDelta=function(b){for(b=b.firstChild;null!=b;){"edit"==b.nodeName&&this.processEdit(b),b=b.nextSibling}};mxSession.prototype.processEdit=function(d){d=this.decodeChanges(d);if(0<d.length){var c=this.createUndoableEdit(d);this.model.fireEvent(new mxEventObject(mxEvent.CHANGE,"edit",c,"changes",d));this.model.fireEvent(new mxEventObject(mxEvent.UNDO,"edit",c));this.fireEvent(new mxEventObject(mxEvent.FIRED,"edit",c))}};mxSession.prototype.createUndoableEdit=function(d){var c=new mxUndoableEdit(this.model,this.significantRemoteChanges);c.changes=d;c.notify=function(){c.source.fireEvent(new mxEventObject(mxEvent.CHANGE,"edit",c,"changes",c.changes));c.source.fireEvent(new mxEventObject(mxEvent.NOTIFY,"edit",c,"changes",c.changes))};return c};mxSession.prototype.decodeChanges=function(e){this.codec.document=e.ownerDocument;var d=[];for(e=e.firstChild;null!=e;){var f=this.decodeChange(e);null!=f&&d.push(f);e=e.nextSibling}return d};mxSession.prototype.decodeChange=function(d){var c=null;d.nodeType==mxConstants.NODETYPE_ELEMENT&&(c="mxRootChange"==d.nodeName?(new mxCodec(d.ownerDocument)).decode(d):this.codec.decode(d),null!=c&&(c.model=this.model,c.execute(),"mxChildChange"==d.nodeName&&null==c.parent&&this.cellRemoved(c.child)));return c};mxSession.prototype.cellRemoved=function(f,e){this.codec.putObject(f.getId(),f);for(var h=this.model.getChildCount(f),g=0;g<h;g++){this.cellRemoved(this.model.getChildAt(f,g))}};function mxUndoableEdit(d,c){this.source=d;this.changes=[];this.significant=null!=c?c:!0}mxUndoableEdit.prototype.source=null;mxUndoableEdit.prototype.changes=null;mxUndoableEdit.prototype.significant=null;mxUndoableEdit.prototype.undone=!1;mxUndoableEdit.prototype.redone=!1;mxUndoableEdit.prototype.isEmpty=function(){return 0==this.changes.length};mxUndoableEdit.prototype.isSignificant=function(){return this.significant};mxUndoableEdit.prototype.add=function(b){this.changes.push(b)};mxUndoableEdit.prototype.notify=function(){};mxUndoableEdit.prototype.die=function(){};mxUndoableEdit.prototype.undo=function(){if(!this.undone){this.source.fireEvent(new mxEventObject(mxEvent.START_EDIT));for(var d=this.changes.length-1;0<=d;d--){var c=this.changes[d];null!=c.execute?c.execute():null!=c.undo&&c.undo();this.source.fireEvent(new mxEventObject(mxEvent.EXECUTED,"change",c))}this.undone=!0;this.redone=!1;this.source.fireEvent(new mxEventObject(mxEvent.END_EDIT))}this.notify()};mxUndoableEdit.prototype.redo=function(){if(!this.redone){this.source.fireEvent(new mxEventObject(mxEvent.START_EDIT));for(var e=this.changes.length,d=0;d<e;d++){var f=this.changes[d];null!=f.execute?f.execute():null!=f.redo&&f.redo();this.source.fireEvent(new mxEventObject(mxEvent.EXECUTED,"change",f))}this.undone=!1;this.redone=!0;this.source.fireEvent(new mxEventObject(mxEvent.END_EDIT))}this.notify()};function mxUndoManager(b){this.size=null!=b?b:100;this.clear()}mxUndoManager.prototype=new mxEventSource;mxUndoManager.prototype.constructor=mxUndoManager;mxUndoManager.prototype.size=null;mxUndoManager.prototype.history=null;mxUndoManager.prototype.indexOfNextAdd=0;mxUndoManager.prototype.isEmpty=function(){return 0==this.history.length};mxUndoManager.prototype.clear=function(){this.history=[];this.indexOfNextAdd=0;this.fireEvent(new mxEventObject(mxEvent.CLEAR))};mxUndoManager.prototype.canUndo=function(){return 0<this.indexOfNextAdd};mxUndoManager.prototype.undo=function(){for(;0<this.indexOfNextAdd;){var b=this.history[--this.indexOfNextAdd];b.undo();if(b.isSignificant()){this.fireEvent(new mxEventObject(mxEvent.UNDO,"edit",b));break}}};mxUndoManager.prototype.canRedo=function(){return this.indexOfNextAdd<this.history.length};mxUndoManager.prototype.redo=function(){for(var d=this.history.length;this.indexOfNextAdd<d;){var c=this.history[this.indexOfNextAdd++];c.redo();if(c.isSignificant()){this.fireEvent(new mxEventObject(mxEvent.REDO,"edit",c));break}}};mxUndoManager.prototype.undoableEditHappened=function(b){this.trim();0<this.size&&this.size==this.history.length&&this.history.shift();this.history.push(b);this.indexOfNextAdd=this.history.length;this.fireEvent(new mxEventObject(mxEvent.ADD,"edit",b))};mxUndoManager.prototype.trim=function(){if(this.history.length>this.indexOfNextAdd){for(var d=this.history.splice(this.indexOfNextAdd,this.history.length-this.indexOfNextAdd),c=0;c<d.length;c++){d[c].die()}}};var mxUrlConverter=function(f){var e=!0,h=null,g=null;return{isEnabled:function(){return e},setEnabled:function(b){e=b},getBaseUrl:function(){return h},setBaseUrl:function(b){h=b},getBaseDomain:function(){return h},setBaseDomain:function(b){h=b},isRelativeUrl:function(b){return"//"!=b.substring(0,2)&&"http://"!=b.substring(0,7)&&"https://"!=b.substring(0,8)&&"data:image"!=b.substring(0,10)},convert:function(b){if(e&&this.isRelativeUrl(b)){if(null==h){g=location.protocol+"//"+location.host;h=g+location.pathname;var c=h.lastIndexOf("/");0<c&&(h=h.substring(0,c+1))}b="/"==b.charAt(0)?g+b:h+b}return b}}};function mxPanningManager(d){this.thread=null;this.active=!1;this.dy=this.dx=this.t0y=this.t0x=this.tdy=this.tdx=0;this.scrollbars=!1;this.scrollTop=this.scrollLeft=0;this.mouseListener={mouseDown:function(f,e){},mouseMove:function(f,e){},mouseUp:mxUtils.bind(this,function(f,e){this.active&&this.stop()})};d.addMouseListener(this.mouseListener);mxEvent.addListener(document,"mouseup",mxUtils.bind(this,function(){this.active&&this.stop()}));var c=mxUtils.bind(this,function(){this.scrollbars=mxUtils.hasScrollbars(d.container);this.scrollLeft=d.container.scrollLeft;this.scrollTop=d.container.scrollTop;return window.setInterval(mxUtils.bind(this,function(){this.tdx-=this.dx;this.tdy-=this.dy;if(this.scrollbars){var a=-d.container.scrollLeft-Math.ceil(this.dx),e=-d.container.scrollTop-Math.ceil(this.dy);d.panGraph(a,e);d.panDx=this.scrollLeft-d.container.scrollLeft;d.panDy=this.scrollTop-d.container.scrollTop;d.fireEvent(new mxEventObject(mxEvent.PAN))}else{d.panGraph(this.getDx(),this.getDy())}}),this.delay)});this.isActive=function(){return active};this.getDx=function(){return Math.round(this.tdx)};this.getDy=function(){return Math.round(this.tdy)};this.start=function(){this.t0x=d.view.translate.x;this.t0y=d.view.translate.y;this.active=!0};this.panTo=function(k,i,h,b){this.active||this.start();this.scrollLeft=d.container.scrollLeft;this.scrollTop=d.container.scrollTop;b=null!=b?b:0;var a=d.container;this.dx=k+(null!=h?h:0)-a.scrollLeft-a.clientWidth;0>this.dx&&Math.abs(this.dx)<this.border?this.dx=this.border+this.dx:this.dx=this.handleMouseOut?Math.max(this.dx,0):0;0==this.dx&&(this.dx=k-a.scrollLeft,this.dx=0<this.dx&&this.dx<this.border?this.dx-this.border:this.handleMouseOut?Math.min(0,this.dx):0);this.dy=i+b-a.scrollTop-a.clientHeight;0>this.dy&&Math.abs(this.dy)<this.border?this.dy=this.border+this.dy:this.dy=this.handleMouseOut?Math.max(this.dy,0):0;0==this.dy&&(this.dy=i-a.scrollTop,this.dy=0<this.dy&&this.dy<this.border?this.dy-this.border:this.handleMouseOut?Math.min(0,this.dy):0);0!=this.dx||0!=this.dy?(this.dx*=this.damper,this.dy*=this.damper,null==this.thread&&(this.thread=c())):null!=this.thread&&(window.clearInterval(this.thread),this.thread=null)};this.stop=function(){if(this.active){if(this.active=!1,null!=this.thread&&(window.clearInterval(this.thread),this.thread=null),this.tdy=this.tdx=0,this.scrollbars){d.panDx=0,d.panDy=0,d.fireEvent(new mxEventObject(mxEvent.PAN))}else{var a=d.panDx,e=d.panDy;if(0!=a||0!=e){d.panGraph(0,0),d.view.setTranslate(this.t0x+a/d.view.scale,this.t0y+e/d.view.scale)}}}};this.destroy=function(){d.removeMouseListener(this.mouseListener)}}mxPanningManager.prototype.damper=1/6;mxPanningManager.prototype.delay=10;mxPanningManager.prototype.handleMouseOut=!0;mxPanningManager.prototype.border=0;function mxPopupMenu(b){this.factoryMethod=b;null!=b&&this.init()}mxPopupMenu.prototype=new mxEventSource;mxPopupMenu.prototype.constructor=mxPopupMenu;mxPopupMenu.prototype.submenuImage=mxClient.imageBasePath+"/submenu.gif";mxPopupMenu.prototype.zIndex=10006;mxPopupMenu.prototype.factoryMethod=null;mxPopupMenu.prototype.useLeftButtonForPopup=!1;mxPopupMenu.prototype.enabled=!0;mxPopupMenu.prototype.itemCount=0;mxPopupMenu.prototype.autoExpand=!1;mxPopupMenu.prototype.smartSeparators=!1;mxPopupMenu.prototype.labels=!0;mxPopupMenu.prototype.init=function(){this.table=document.createElement("table");this.table.className="mxPopupMenu";this.tbody=document.createElement("tbody");this.table.appendChild(this.tbody);this.div=document.createElement("div");this.div.className="mxPopupMenu";this.div.style.display="inline";this.div.style.zIndex=this.zIndex;this.div.appendChild(this.table);mxEvent.disableContextMenu(this.div)};mxPopupMenu.prototype.isEnabled=function(){return this.enabled};mxPopupMenu.prototype.setEnabled=function(b){this.enabled=b};mxPopupMenu.prototype.isPopupTrigger=function(b){return b.isPopupTrigger()||this.useLeftButtonForPopup&&mxEvent.isLeftMouseButton(b.getEvent())};mxPopupMenu.prototype.addItem=function(k,i,q,p,o,n){p=p||this;this.itemCount++;p.willAddSeparator&&(p.containsItems&&this.addSeparator(p,!0),p.willAddSeparator=!1);p.containsItems=!0;var m=document.createElement("tr");m.className="mxPopupMenuItem";var l=document.createElement("td");l.className="mxPopupMenuIcon";null!=i?(o=document.createElement("img"),o.src=i,l.appendChild(o)):null!=o&&(i=document.createElement("div"),i.className=o,l.appendChild(i));m.appendChild(l);this.labels&&(l=document.createElement("td"),l.className="mxPopupMenuItem"+(null!=n&&!n?" disabled":""),mxUtils.write(l,k),l.align="left",m.appendChild(l),k=document.createElement("td"),k.className="mxPopupMenuItem"+(null!=n&&!n?" disabled":""),k.style.paddingRight="6px",k.style.textAlign="right",m.appendChild(k),null==p.div&&this.createSubmenu(p));p.tbody.appendChild(m);if(null==n||n){mxEvent.addGestureListeners(m,mxUtils.bind(this,function(b){this.eventReceiver=m;p.activeRow!=m&&p.activeRow!=p&&(null!=p.activeRow&&null!=p.activeRow.div.parentNode&&this.hideSubmenu(p),null!=m.div&&(this.showSubmenu(p,m),p.activeRow=m));mxEvent.consume(b)}),mxUtils.bind(this,function(b){p.activeRow!=m&&p.activeRow!=p&&(null!=p.activeRow&&null!=p.activeRow.div.parentNode&&this.hideSubmenu(p),this.autoExpand&&null!=m.div&&(this.showSubmenu(p,m),p.activeRow=m));m.className="mxPopupMenuItemHover"}),mxUtils.bind(this,function(b){this.eventReceiver==m&&(p.activeRow!=m&&this.hideMenu(),null!=q&&q(b));this.eventReceiver=null;mxEvent.consume(b)})),mxEvent.addListener(m,"mouseout",mxUtils.bind(this,function(b){m.className="mxPopupMenuItem"}))}return m};mxPopupMenu.prototype.createSubmenu=function(d){d.table=document.createElement("table");d.table.className="mxPopupMenu";d.tbody=document.createElement("tbody");d.table.appendChild(d.tbody);d.div=document.createElement("div");d.div.className="mxPopupMenu";d.div.style.position="absolute";d.div.style.display="inline";d.div.style.zIndex=this.zIndex;d.div.appendChild(d.table);var c=document.createElement("img");c.setAttribute("src",this.submenuImage);td=d.firstChild.nextSibling.nextSibling;td.appendChild(c)};mxPopupMenu.prototype.showSubmenu=function(h,g){if(null!=g.div){g.div.style.left=h.div.offsetLeft+g.offsetLeft+g.offsetWidth-1+"px";g.div.style.top=h.div.offsetTop+g.offsetTop+"px";document.body.appendChild(g.div);var m=parseInt(g.div.offsetLeft),l=parseInt(g.div.offsetWidth),k=document.body,i=document.documentElement;if(m+l>(k.scrollLeft||i.scrollLeft)+(k.clientWidth||i.clientWidth)){g.div.style.left=h.div.offsetLeft-l+(mxClient.IS_IE?6:-6)+"px"}mxUtils.fit(g.div)}};mxPopupMenu.prototype.addSeparator=function(g,f){g=g||this;if(this.smartSeparators&&!f){g.willAddSeparator=!0}else{if(null!=g.tbody){g.willAddSeparator=!1;var k=document.createElement("tr"),i=document.createElement("td");i.className="mxPopupMenuIcon";i.style.padding="0 0 0 0px";k.appendChild(i);i=document.createElement("td");i.style.padding="0 0 0 0px";i.setAttribute("colSpan","2");var h=document.createElement("hr");h.setAttribute("size","1");i.appendChild(h);k.appendChild(i);g.tbody.appendChild(k)}}};mxPopupMenu.prototype.popup=function(f,e,h,g){if(null!=this.div&&null!=this.tbody&&null!=this.factoryMethod){this.div.style.left=f+"px";for(this.div.style.top=e+"px";null!=this.tbody.firstChild;){mxEvent.release(this.tbody.firstChild),this.tbody.removeChild(this.tbody.firstChild)}this.itemCount=0;this.factoryMethod(this,h,g);0<this.itemCount&&(this.showMenu(),this.fireEvent(new mxEventObject(mxEvent.SHOW)))}};mxPopupMenu.prototype.isMenuShowing=function(){return null!=this.div&&this.div.parentNode==document.body};mxPopupMenu.prototype.showMenu=function(){9<=document.documentMode&&(this.div.style.filter="none");document.body.appendChild(this.div);mxUtils.fit(this.div)};mxPopupMenu.prototype.hideMenu=function(){null!=this.div&&(null!=this.div.parentNode&&this.div.parentNode.removeChild(this.div),this.hideSubmenu(this),this.containsItems=!1)};mxPopupMenu.prototype.hideSubmenu=function(b){null!=b.activeRow&&(this.hideSubmenu(b.activeRow),null!=b.activeRow.div.parentNode&&b.activeRow.div.parentNode.removeChild(b.activeRow.div),b.activeRow=null)};mxPopupMenu.prototype.destroy=function(){null!=this.div&&(mxEvent.release(this.div),null!=this.div.parentNode&&this.div.parentNode.removeChild(this.div),this.div=null)};function mxAutoSaveManager(b){this.changeHandler=mxUtils.bind(this,function(d,e){this.isEnabled()&&this.graphModelChanged(e.getProperty("edit").changes)});this.setGraph(b)}mxAutoSaveManager.prototype=new mxEventSource;mxAutoSaveManager.prototype.constructor=mxAutoSaveManager;mxAutoSaveManager.prototype.graph=null;mxAutoSaveManager.prototype.autoSaveDelay=10;mxAutoSaveManager.prototype.autoSaveThrottle=2;mxAutoSaveManager.prototype.autoSaveThreshold=5;mxAutoSaveManager.prototype.ignoredChanges=0;mxAutoSaveManager.prototype.lastSnapshot=0;mxAutoSaveManager.prototype.enabled=!0;mxAutoSaveManager.prototype.changeHandler=null;mxAutoSaveManager.prototype.isEnabled=function(){return this.enabled};mxAutoSaveManager.prototype.setEnabled=function(b){this.enabled=b};mxAutoSaveManager.prototype.setGraph=function(b){null!=this.graph&&this.graph.getModel().removeListener(this.changeHandler);this.graph=b;null!=this.graph&&this.graph.getModel().addListener(mxEvent.CHANGE,this.changeHandler)};mxAutoSaveManager.prototype.save=function(){};mxAutoSaveManager.prototype.graphModelChanged=function(b){b=((new Date).getTime()-this.lastSnapshot)/1000;b>this.autoSaveDelay||this.ignoredChanges>=this.autoSaveThreshold&&b>this.autoSaveThrottle?(this.save(),this.reset()):this.ignoredChanges++};mxAutoSaveManager.prototype.reset=function(){this.lastSnapshot=(new Date).getTime();this.ignoredChanges=0};mxAutoSaveManager.prototype.destroy=function(){this.setGraph(null)};function mxAnimation(b){this.delay=null!=b?b:20}mxAnimation.prototype=new mxEventSource;mxAnimation.prototype.constructor=mxAnimation;mxAnimation.prototype.delay=null;mxAnimation.prototype.thread=null;mxAnimation.prototype.startAnimation=function(){null==this.thread&&(this.thread=window.setInterval(mxUtils.bind(this,this.updateAnimation),this.delay))};mxAnimation.prototype.updateAnimation=function(){this.fireEvent(new mxEventObject(mxEvent.EXECUTE))};mxAnimation.prototype.stopAnimation=function(){null!=this.thread&&(window.clearInterval(this.thread),this.thread=null,this.fireEvent(new mxEventObject(mxEvent.DONE)))};function mxMorphing(f,e,h,g){mxAnimation.call(this,g);this.graph=f;this.steps=null!=e?e:6;this.ease=null!=h?h:1.5}mxMorphing.prototype=new mxAnimation;mxMorphing.prototype.constructor=mxMorphing;mxMorphing.prototype.graph=null;mxMorphing.prototype.steps=null;mxMorphing.prototype.step=0;mxMorphing.prototype.ease=null;mxMorphing.prototype.cells=null;mxMorphing.prototype.updateAnimation=function(){var d=new mxCellStatePreview(this.graph);if(null!=this.cells){for(var c=0;c<this.cells.length;c++){this.animateCell(cells[c],d,!1)}}else{this.animateCell(this.graph.getModel().getRoot(),d,!0)}this.show(d);(d.isEmpty()||this.step++>=this.steps)&&this.stopAnimation()};mxMorphing.prototype.show=function(b){b.show()};mxMorphing.prototype.animateCell=function(i,h,o){var n=this.graph.getView().getState(i),m=null;if(null!=n&&(m=this.getDelta(n),this.graph.getModel().isVertex(i)&&(0!=m.x||0!=m.y))){var l=this.graph.view.getTranslate(),k=this.graph.view.getScale();m.x+=l.x*k;m.y+=l.y*k;h.moveState(n,-m.x/this.ease,-m.y/this.ease)}if(o&&!this.stopRecursion(n,m)){n=this.graph.getModel().getChildCount(i);for(m=0;m<n;m++){this.animateCell(this.graph.getModel().getChildAt(i,m),h,o)}}};mxMorphing.prototype.stopRecursion=function(d,c){return null!=c&&(0!=c.x||0!=c.y)};mxMorphing.prototype.getDelta=function(f){var e=this.getOriginForCell(f.cell),h=this.graph.getView().getTranslate(),g=this.graph.getView().getScale();f=new mxPoint(f.x/g-h.x,f.y/g-h.y);return new mxPoint((e.x-f.x)*g,(e.y-f.y)*g)};mxMorphing.prototype.getOriginForCell=function(d){var c=null;null!=d&&(c=this.getOriginForCell(this.graph.getModel().getParent(d)),d=this.graph.getCellGeometry(d),null!=d&&(c.x+=d.x,c.y+=d.y));null==c&&(c=this.graph.view.getTranslate(),c=new mxPoint(-c.x,-c.y));return c};function mxImageBundle(b){this.images=[];this.alt=null!=b?b:!1}mxImageBundle.prototype.images=null;mxImageBundle.prototype.images=null;mxImageBundle.prototype.putImage=function(e,d,f){this.images[e]={value:d,fallback:f}};mxImageBundle.prototype.getImage=function(d){var c=null;null!=d&&(d=this.images[d],null!=d&&(c=this.alt?d.fallback:d.value));return c};function mxImageExport(){}mxImageExport.prototype.includeOverlays=!1;mxImageExport.prototype.drawState=function(d,c){null!=d&&(this.visitStatesRecursive(d,c,this.drawCellState),this.includeOverlays&&this.visitStatesRecursive(d,c,this.drawOverlays))};mxImageExport.prototype.visitStatesRecursive=function(i,h,o){if(null!=i){o(i,h);for(var n=i.view.graph,m=n.model.getChildCount(i.cell),l=0;l<m;l++){var k=n.view.getState(n.model.getChildAt(i.cell,l));this.visitStatesRecursive(k,h,o)}}};mxImageExport.prototype.drawCellState=function(d,c){d.shape instanceof mxShape&&(c.save(),d.shape.paint(c),c.restore());null!=d.text&&(c.save(),d.text.paint(c),c.restore())};mxImageExport.prototype.drawOverlays=function(d,c){null!=d.overlays&&d.overlays.visit(function(b,e){e instanceof mxShape&&e.paint(c)})};function mxAbstractCanvas2D(){this.converter=this.createUrlConverter();this.reset()}mxAbstractCanvas2D.prototype.state=null;mxAbstractCanvas2D.prototype.states=null;mxAbstractCanvas2D.prototype.path=null;mxAbstractCanvas2D.prototype.rotateHtml=!0;mxAbstractCanvas2D.prototype.lastX=0;mxAbstractCanvas2D.prototype.lastY=0;mxAbstractCanvas2D.prototype.moveOp="M";mxAbstractCanvas2D.prototype.lineOp="L";mxAbstractCanvas2D.prototype.quadOp="Q";mxAbstractCanvas2D.prototype.curveOp="C";mxAbstractCanvas2D.prototype.closeOp="Z";mxAbstractCanvas2D.prototype.pointerEvents=!1;mxAbstractCanvas2D.prototype.createUrlConverter=function(){return new mxUrlConverter};mxAbstractCanvas2D.prototype.reset=function(){this.state=this.createState();this.states=[]};mxAbstractCanvas2D.prototype.createState=function(){return{dx:0,dy:0,scale:1,alpha:1,fillColor:null,fillAlpha:1,gradientColor:null,gradientAlpha:1,gradientDirection:null,strokeColor:null,strokeWidth:1,dashed:!1,dashPattern:"3 3",lineCap:"flat",lineJoin:"miter",miterLimit:10,fontColor:"#000000",fontBackgroundColor:null,fontBorderColor:null,fontSize:mxConstants.DEFAULT_FONTSIZE,fontFamily:mxConstants.DEFAULT_FONTFAMILY,fontStyle:0,shadow:!1,shadowColor:mxConstants.SHADOWCOLOR,shadowAlpha:mxConstants.SHADOW_OPACITY,shadowDx:mxConstants.SHADOW_OFFSET_X,shadowDy:mxConstants.SHADOW_OFFSET_Y,rotation:0,rotationCx:0,rotationCy:0}};mxAbstractCanvas2D.prototype.format=function(b){return Math.round(parseFloat(b))};mxAbstractCanvas2D.prototype.addOp=function(){if(null!=this.path&&(this.path.push(arguments[0]),2<arguments.length)){for(var d=this.state,c=2;c<arguments.length;c+=2){this.lastX=arguments[c-1],this.lastY=arguments[c],this.path.push(this.format((this.lastX+d.dx)*d.scale)),this.path.push(this.format((this.lastY+d.dy)*d.scale))}}};mxAbstractCanvas2D.prototype.rotatePoint=function(g,f,k,i,h){k*=Math.PI/180;return mxUtils.getRotatedPoint(new mxPoint(g,f),Math.cos(k),Math.sin(k),new mxPoint(i,h))};mxAbstractCanvas2D.prototype.save=function(){this.states.push(this.state);this.state=mxUtils.clone(this.state)};mxAbstractCanvas2D.prototype.restore=function(){this.state=this.states.pop()};mxAbstractCanvas2D.prototype.scale=function(b){this.state.scale*=b;this.state.strokeWidth*=b};mxAbstractCanvas2D.prototype.translate=function(d,c){this.state.dx+=d;this.state.dy+=c};mxAbstractCanvas2D.prototype.setAlpha=function(b){this.state.alpha=b};mxAbstractCanvas2D.prototype.setFillColor=function(b){b==mxConstants.NONE&&(b=null);this.state.fillColor=b;this.state.gradientColor=null};mxAbstractCanvas2D.prototype.setGradient=function(s,r,q,p,o,n,m,l,i){q=this.state;q.fillColor=s;q.fillAlpha=null!=l?l:1;q.gradientColor=r;q.gradientAlpha=null!=i?i:1;q.gradientDirection=m};mxAbstractCanvas2D.prototype.setStrokeColor=function(b){b==mxConstants.NONE&&(b=null);this.state.strokeColor=b};mxAbstractCanvas2D.prototype.setStrokeWidth=function(b){this.state.strokeWidth=b};mxAbstractCanvas2D.prototype.setDashed=function(b){this.state.dashed=b};mxAbstractCanvas2D.prototype.setDashPattern=function(b){this.state.dashPattern=b};mxAbstractCanvas2D.prototype.setLineCap=function(b){this.state.lineCap=b};mxAbstractCanvas2D.prototype.setLineJoin=function(b){this.state.lineJoin=b};mxAbstractCanvas2D.prototype.setMiterLimit=function(b){this.state.miterLimit=b};mxAbstractCanvas2D.prototype.setFontColor=function(b){b==mxConstants.NONE&&(b=null);this.state.fontColor=b};mxAbstractCanvas2D.prototype.setFontBackgroundColor=function(b){b==mxConstants.NONE&&(b=null);this.state.fontBackgroundColor=b};mxAbstractCanvas2D.prototype.setFontBorderColor=function(b){b==mxConstants.NONE&&(b=null);this.state.fontBorderColor=b};mxAbstractCanvas2D.prototype.setFontSize=function(b){this.state.fontSize=b};mxAbstractCanvas2D.prototype.setFontFamily=function(b){this.state.fontFamily=b};mxAbstractCanvas2D.prototype.setFontStyle=function(b){null==b&&(b=0);this.state.fontStyle=b};mxAbstractCanvas2D.prototype.setShadow=function(b){this.state.shadow=b};mxAbstractCanvas2D.prototype.setShadowColor=function(b){b==mxConstants.NONE&&(b=null);this.state.shadowColor=b};mxAbstractCanvas2D.prototype.setShadowAlpha=function(b){this.state.shadowAlpha=b};mxAbstractCanvas2D.prototype.setShadowOffset=function(d,c){this.state.shadowDx=d;this.state.shadowDy=c};mxAbstractCanvas2D.prototype.begin=function(){this.lastY=this.lastX=0;this.path=[]};mxAbstractCanvas2D.prototype.moveTo=function(d,c){this.addOp(this.moveOp,d,c)};mxAbstractCanvas2D.prototype.lineTo=function(d,c){this.addOp(this.lineOp,d,c)};mxAbstractCanvas2D.prototype.quadTo=function(f,e,h,g){this.addOp(this.quadOp,f,e,h,g)};mxAbstractCanvas2D.prototype.curveTo=function(h,g,m,l,k,i){this.addOp(this.curveOp,h,g,m,l,k,i)};mxAbstractCanvas2D.prototype.arcTo=function(i,h,o,n,m,l,k){i=mxUtils.arcToCurves(this.lastX,this.lastY,i,h,o,n,m,l,k);if(null!=i){for(h=0;h<i.length;h+=6){this.curveTo(i[h],i[h+1],i[h+2],i[h+3],i[h+4],i[h+5])}}};mxAbstractCanvas2D.prototype.close=function(h,g,m,l,k,i){this.addOp(this.closeOp)};mxAbstractCanvas2D.prototype.end=function(){};function mxXmlCanvas2D(b){mxAbstractCanvas2D.call(this);this.root=b;this.writeDefaults()}mxUtils.extend(mxXmlCanvas2D,mxAbstractCanvas2D);mxXmlCanvas2D.prototype.textEnabled=!0;mxXmlCanvas2D.prototype.compressed=!0;mxXmlCanvas2D.prototype.writeDefaults=function(){var b;b=this.createElement("fontfamily");b.setAttribute("family",mxConstants.DEFAULT_FONTFAMILY);this.root.appendChild(b);b=this.createElement("fontsize");b.setAttribute("size",mxConstants.DEFAULT_FONTSIZE);this.root.appendChild(b);b=this.createElement("shadowcolor");b.setAttribute("color",mxConstants.SHADOWCOLOR);this.root.appendChild(b);b=this.createElement("shadowalpha");b.setAttribute("alpha",mxConstants.SHADOW_OPACITY);this.root.appendChild(b);b=this.createElement("shadowoffset");b.setAttribute("dx",mxConstants.SHADOW_OFFSET_X);b.setAttribute("dy",mxConstants.SHADOW_OFFSET_Y);this.root.appendChild(b)};mxXmlCanvas2D.prototype.format=function(b){return parseFloat(parseFloat(b).toFixed(2))};mxXmlCanvas2D.prototype.createElement=function(b){return this.root.ownerDocument.createElement(b)};mxXmlCanvas2D.prototype.save=function(){this.compressed&&mxAbstractCanvas2D.prototype.save.apply(this,arguments);this.root.appendChild(this.createElement("save"))};mxXmlCanvas2D.prototype.restore=function(){this.compressed&&mxAbstractCanvas2D.prototype.restore.apply(this,arguments);this.root.appendChild(this.createElement("restore"))};mxXmlCanvas2D.prototype.scale=function(d){if(this.compressed){if(this.state.scale==d){return}mxAbstractCanvas2D.prototype.setAlpha.apply(this,arguments)}var c=this.createElement("scale");c.setAttribute("scale",d);this.root.appendChild(c)};mxXmlCanvas2D.prototype.translate=function(e,d){var f=this.createElement("translate");f.setAttribute("dx",this.format(e));f.setAttribute("dy",this.format(d));this.root.appendChild(f)};mxXmlCanvas2D.prototype.rotate=function(h,g,m,l,k){var i=this.createElement("rotate");if(0!=h||g||m){i.setAttribute("theta",this.format(h)),i.setAttribute("flipH",g?"1":"0"),i.setAttribute("flipV",m?"1":"0"),i.setAttribute("cx",this.format(l)),i.setAttribute("cy",this.format(k)),this.root.appendChild(i)}};mxXmlCanvas2D.prototype.setAlpha=function(d){if(this.compressed){if(this.state.alpha==d){return}mxAbstractCanvas2D.prototype.setAlpha.apply(this,arguments)}var c=this.createElement("alpha");c.setAttribute("alpha",this.format(d));this.root.appendChild(c)};mxXmlCanvas2D.prototype.setFillColor=function(d){d==mxConstants.NONE&&(d=null);if(this.compressed){if(this.state.fillColor==d){return}mxAbstractCanvas2D.prototype.setFillColor.apply(this,arguments)}var c=this.createElement("fillcolor");c.setAttribute("color",null!=d?d:mxConstants.NONE);this.root.appendChild(c)};mxXmlCanvas2D.prototype.setGradient=function(u,t,s,r,q,p,o,n,m){if(null!=u&&null!=t){mxAbstractCanvas2D.prototype.setGradient.apply(this,arguments);var i=this.createElement("gradient");i.setAttribute("c1",u);i.setAttribute("c2",t);i.setAttribute("x",this.format(s));i.setAttribute("y",this.format(r));i.setAttribute("w",this.format(q));i.setAttribute("h",this.format(p));null!=o&&i.setAttribute("direction",o);null!=n&&i.setAttribute("alpha1",n);null!=m&&i.setAttribute("alpha2",m);this.root.appendChild(i)}};mxXmlCanvas2D.prototype.setStrokeColor=function(d){d==mxConstants.NONE&&(d=null);if(this.compressed){if(this.state.strokeColor==d){return}mxAbstractCanvas2D.prototype.setStrokeColor.apply(this,arguments)}var c=this.createElement("strokecolor");c.setAttribute("color",null!=d?d:mxConstants.NONE);this.root.appendChild(c)};mxXmlCanvas2D.prototype.setStrokeWidth=function(d){if(this.compressed){if(this.state.strokeWidth==d){return}mxAbstractCanvas2D.prototype.setStrokeWidth.apply(this,arguments)}var c=this.createElement("strokewidth");c.setAttribute("width",this.format(d));this.root.appendChild(c)};mxXmlCanvas2D.prototype.setDashed=function(d){if(this.compressed){if(this.state.dashed==d){return}mxAbstractCanvas2D.prototype.setDashed.apply(this,arguments)}var c=this.createElement("dashed");c.setAttribute("dashed",d?"1":"0");this.root.appendChild(c)};mxXmlCanvas2D.prototype.setDashPattern=function(d){if(this.compressed){if(this.state.dashPattern==d){return}mxAbstractCanvas2D.prototype.setDashPattern.apply(this,arguments)}var c=this.createElement("dashpattern");c.setAttribute("pattern",d);this.root.appendChild(c)};mxXmlCanvas2D.prototype.setLineCap=function(d){if(this.compressed){if(this.state.lineCap==d){return}mxAbstractCanvas2D.prototype.setLineCap.apply(this,arguments)}var c=this.createElement("linecap");c.setAttribute("cap",d);this.root.appendChild(c)};mxXmlCanvas2D.prototype.setLineJoin=function(d){if(this.compressed){if(this.state.lineJoin==d){return}mxAbstractCanvas2D.prototype.setLineJoin.apply(this,arguments)}var c=this.createElement("linejoin");c.setAttribute("join",d);this.root.appendChild(c)};mxXmlCanvas2D.prototype.setMiterLimit=function(d){if(this.compressed){if(this.state.miterLimit==d){return}mxAbstractCanvas2D.prototype.setMiterLimit.apply(this,arguments)}var c=this.createElement("miterlimit");c.setAttribute("limit",d);this.root.appendChild(c)};mxXmlCanvas2D.prototype.setFontColor=function(d){if(this.textEnabled){d==mxConstants.NONE&&(d=null);if(this.compressed){if(this.state.fontColor==d){return}mxAbstractCanvas2D.prototype.setFontColor.apply(this,arguments)}var c=this.createElement("fontcolor");c.setAttribute("color",null!=d?d:mxConstants.NONE);this.root.appendChild(c)}};mxXmlCanvas2D.prototype.setFontBackgroundColor=function(d){if(this.textEnabled){d==mxConstants.NONE&&(d=null);if(this.compressed){if(this.state.fontBackgroundColor==d){return}mxAbstractCanvas2D.prototype.setFontBackgroundColor.apply(this,arguments)}var c=this.createElement("fontbackgroundcolor");c.setAttribute("color",null!=d?d:mxConstants.NONE);this.root.appendChild(c)}};mxXmlCanvas2D.prototype.setFontBorderColor=function(d){if(this.textEnabled){d==mxConstants.NONE&&(d=null);if(this.compressed){if(this.state.fontBorderColor==d){return}mxAbstractCanvas2D.prototype.setFontBorderColor.apply(this,arguments)}var c=this.createElement("fontbordercolor");c.setAttribute("color",null!=d?d:mxConstants.NONE);this.root.appendChild(c)}};mxXmlCanvas2D.prototype.setFontSize=function(d){if(this.textEnabled){if(this.compressed){if(this.state.fontSize==d){return}mxAbstractCanvas2D.prototype.setFontSize.apply(this,arguments)}var c=this.createElement("fontsize");c.setAttribute("size",d);this.root.appendChild(c)}};mxXmlCanvas2D.prototype.setFontFamily=function(d){if(this.textEnabled){if(this.compressed){if(this.state.fontFamily==d){return}mxAbstractCanvas2D.prototype.setFontFamily.apply(this,arguments)}var c=this.createElement("fontfamily");c.setAttribute("family",d);this.root.appendChild(c)}};mxXmlCanvas2D.prototype.setFontStyle=function(d){if(this.textEnabled){null==d&&(d=0);if(this.compressed){if(this.state.fontStyle==d){return}mxAbstractCanvas2D.prototype.setFontStyle.apply(this,arguments)}var c=this.createElement("fontstyle");c.setAttribute("style",d);this.root.appendChild(c)}};mxXmlCanvas2D.prototype.setShadow=function(d){if(this.compressed){if(this.state.shadow==d){return}mxAbstractCanvas2D.prototype.setShadow.apply(this,arguments)}var c=this.createElement("shadow");c.setAttribute("enabled",d?"1":"0");this.root.appendChild(c)};mxXmlCanvas2D.prototype.setShadowColor=function(d){if(this.compressed){d==mxConstants.NONE&&(d=null);if(this.state.shadowColor==d){return}mxAbstractCanvas2D.prototype.setShadowColor.apply(this,arguments)}var c=this.createElement("shadowcolor");c.setAttribute("color",null!=d?d:mxConstants.NONE);this.root.appendChild(c)};mxXmlCanvas2D.prototype.setShadowAlpha=function(d){if(this.compressed){if(this.state.shadowAlpha==d){return}mxAbstractCanvas2D.prototype.setShadowAlpha.apply(this,arguments)}var c=this.createElement("shadowalpha");c.setAttribute("alpha",d);this.root.appendChild(c)};mxXmlCanvas2D.prototype.setShadowOffset=function(e,d){if(this.compressed){if(this.state.shadowDx==e&&this.state.shadowDy==d){return}mxAbstractCanvas2D.prototype.setShadowOffset.apply(this,arguments)}var f=this.createElement("shadowoffset");f.setAttribute("dx",e);f.setAttribute("dy",d);this.root.appendChild(f)};mxXmlCanvas2D.prototype.rect=function(g,f,k,i){var h=this.createElement("rect");h.setAttribute("x",this.format(g));h.setAttribute("y",this.format(f));h.setAttribute("w",this.format(k));h.setAttribute("h",this.format(i));this.root.appendChild(h)};mxXmlCanvas2D.prototype.roundrect=function(i,h,o,n,m,l){var k=this.createElement("roundrect");k.setAttribute("x",this.format(i));k.setAttribute("y",this.format(h));k.setAttribute("w",this.format(o));k.setAttribute("h",this.format(n));k.setAttribute("dx",this.format(m));k.setAttribute("dy",this.format(l));this.root.appendChild(k)};mxXmlCanvas2D.prototype.ellipse=function(g,f,k,i){var h=this.createElement("ellipse");h.setAttribute("x",this.format(g));h.setAttribute("y",this.format(f));h.setAttribute("w",this.format(k));h.setAttribute("h",this.format(i));this.root.appendChild(h)};mxXmlCanvas2D.prototype.image=function(s,r,q,p,o,n,m,l){o=this.converter.convert(o);var i=this.createElement("image");i.setAttribute("x",this.format(s));i.setAttribute("y",this.format(r));i.setAttribute("w",this.format(q));i.setAttribute("h",this.format(p));i.setAttribute("src",o);i.setAttribute("aspect",n?"1":"0");i.setAttribute("flipH",m?"1":"0");i.setAttribute("flipV",l?"1":"0");this.root.appendChild(i)};mxXmlCanvas2D.prototype.begin=function(){this.root.appendChild(this.createElement("begin"));this.lastY=this.lastX=0};mxXmlCanvas2D.prototype.moveTo=function(e,d){var f=this.createElement("move");f.setAttribute("x",this.format(e));f.setAttribute("y",this.format(d));this.root.appendChild(f);this.lastX=e;this.lastY=d};mxXmlCanvas2D.prototype.lineTo=function(e,d){var f=this.createElement("line");f.setAttribute("x",this.format(e));f.setAttribute("y",this.format(d));this.root.appendChild(f);this.lastX=e;this.lastY=d};mxXmlCanvas2D.prototype.quadTo=function(g,f,k,i){var h=this.createElement("quad");h.setAttribute("x1",this.format(g));h.setAttribute("y1",this.format(f));h.setAttribute("x2",this.format(k));h.setAttribute("y2",this.format(i));this.root.appendChild(h);this.lastX=k;this.lastY=i};mxXmlCanvas2D.prototype.curveTo=function(i,h,o,n,m,l){var k=this.createElement("curve");k.setAttribute("x1",this.format(i));k.setAttribute("y1",this.format(h));k.setAttribute("x2",this.format(o));k.setAttribute("y2",this.format(n));k.setAttribute("x3",this.format(m));k.setAttribute("y3",this.format(l));this.root.appendChild(k);this.lastX=m;this.lastY=l};mxXmlCanvas2D.prototype.close=function(){this.root.appendChild(this.createElement("close"))};mxXmlCanvas2D.prototype.text=function(A,z,y,x,w,v,u,t,s,r,q,o){if(this.textEnabled&&null!=w){mxUtils.isNode(w)&&(w=mxUtils.getOuterHtml(w));var i=this.createElement("text");i.setAttribute("x",this.format(A));i.setAttribute("y",this.format(z));i.setAttribute("w",this.format(y));i.setAttribute("h",this.format(x));i.setAttribute("str",w);null!=v&&i.setAttribute("align",v);null!=u&&i.setAttribute("valign",u);i.setAttribute("wrap",t?"1":"0");null==s&&(s="");i.setAttribute("format",s);null!=r&&i.setAttribute("overflow",r);null!=q&&i.setAttribute("clip",q?"1":"0");null!=o&&i.setAttribute("rotation",o);this.root.appendChild(i)}};mxXmlCanvas2D.prototype.stroke=function(){this.root.appendChild(this.createElement("stroke"))};mxXmlCanvas2D.prototype.fill=function(){this.root.appendChild(this.createElement("fill"))};mxXmlCanvas2D.prototype.fillAndStroke=function(){this.root.appendChild(this.createElement("fillstroke"))};function mxSvgCanvas2D(e,d){mxAbstractCanvas2D.call(this);this.root=e;this.gradients=[];this.defs=null;this.styleEnabled=null!=d?d:!1;var f=null;if(e.ownerDocument!=document){for(f=e;null!=f&&"svg"!=f.nodeName;){f=f.parentNode}}null!=f&&(0<f.getElementsByTagName("defs").length&&(this.defs=f.getElementsByTagName("defs")[0]),null==this.defs&&(this.defs=this.createElement("defs"),null!=f.firstChild?f.insertBefore(this.defs,f.firstChild):f.appendChild(this.defs)),this.styleEnabled&&this.defs.appendChild(this.createStyle()))}mxUtils.extend(mxSvgCanvas2D,mxAbstractCanvas2D);mxSvgCanvas2D.prototype.node=null;mxSvgCanvas2D.prototype.matchHtmlAlignment=!0;mxSvgCanvas2D.prototype.textEnabled=!0;mxSvgCanvas2D.prototype.foEnabled=!0;mxSvgCanvas2D.prototype.foAltText="[Object]";mxSvgCanvas2D.prototype.strokeTolerance=0;mxSvgCanvas2D.prototype.refCount=0;mxSvgCanvas2D.prototype.blockImagePointerEvents=!1;mxSvgCanvas2D.prototype.reset=function(){mxAbstractCanvas2D.prototype.reset.apply(this,arguments);this.gradients=[]};mxSvgCanvas2D.prototype.createStyle=function(b){b=this.createElement("style");b.setAttribute("type","text/css");mxUtils.write(b,"svg{font-family:"+mxConstants.DEFAULT_FONTFAMILY+";font-size:"+mxConstants.DEFAULT_FONTSIZE+";fill:none;stroke-miterlimit:10}");return b};mxSvgCanvas2D.prototype.createElement=function(e,d){if(null!=this.root.ownerDocument.createElementNS){return this.root.ownerDocument.createElementNS(d||mxConstants.NS_SVG,e)}var f=this.root.ownerDocument.createElement(e);null!=d&&f.setAttribute("xmlns",d);return f};mxSvgCanvas2D.prototype.createAlternateContent=function(A,z,y,x,w,v,u,t,s,r,q,o,i){return null!=this.foAltText?(A=this.state,z=this.createElement("text"),z.setAttribute("x",Math.round(x/2)),z.setAttribute("y",Math.round((w+A.fontSize)/2)),z.setAttribute("fill",A.fontColor||"black"),z.setAttribute("text-anchor","middle"),z.setAttribute("font-size",Math.round(A.fontSize)+"px"),z.setAttribute("font-family",A.fontFamily),(A.fontStyle&mxConstants.FONT_BOLD)==mxConstants.FONT_BOLD&&z.setAttribute("font-weight","bold"),(A.fontStyle&mxConstants.FONT_ITALIC)==mxConstants.FONT_ITALIC&&z.setAttribute("font-style","italic"),(A.fontStyle&mxConstants.FONT_UNDERLINE)==mxConstants.FONT_UNDERLINE&&z.setAttribute("text-decoration","underline"),mxUtils.write(z,this.foAltText),z):null};mxSvgCanvas2D.prototype.createGradientId=function(g,f,k,i,h){"#"==g.charAt(0)&&(g=g.substring(1));"#"==f.charAt(0)&&(f=f.substring(1));g=g.toLowerCase()+"-"+k;f=f.toLowerCase()+"-"+i;k=null;null==h||h==mxConstants.DIRECTION_SOUTH?k="s":h==mxConstants.DIRECTION_EAST?k="e":(i=g,g=f,f=i,h==mxConstants.DIRECTION_NORTH?k="s":h==mxConstants.DIRECTION_WEST&&(k="e"));return"mx-gradient-"+g+"-"+f+"-"+k};mxSvgCanvas2D.prototype.getSvgGradient=function(u,t,s,r,q){var p=this.createGradientId(u,t,s,r,q),o=this.gradients[p];if(null==o){var n=this.root.ownerSVGElement,m=0,i=p+"-"+m;if(null!=n){for(o=n.ownerDocument.getElementById(i);null!=o&&o.ownerSVGElement!=n;){i=p+"-"+m++,o=n.ownerDocument.getElementById(i)}}else{i="id"+ ++this.refCount}null==o&&(o=this.createSvgGradient(u,t,s,r,q),o.setAttribute("id",i),null!=this.defs?this.defs.appendChild(o):n.appendChild(o));this.gradients[p]=o}return o.getAttribute("id")};mxSvgCanvas2D.prototype.createSvgGradient=function(h,g,m,l,k){var i=this.createElement("linearGradient");i.setAttribute("x1","0%");i.setAttribute("y1","0%");i.setAttribute("x2","0%");i.setAttribute("y2","0%");null==k||k==mxConstants.DIRECTION_SOUTH?i.setAttribute("y2","100%"):k==mxConstants.DIRECTION_EAST?i.setAttribute("x2","100%"):k==mxConstants.DIRECTION_NORTH?i.setAttribute("y1","100%"):k==mxConstants.DIRECTION_WEST&&i.setAttribute("x1","100%");m=1>m?";stop-opacity:"+m:"";k=this.createElement("stop");k.setAttribute("offset","0%");k.setAttribute("style","stop-color:"+h+m);i.appendChild(k);m=1>l?";stop-opacity:"+l:"";k=this.createElement("stop");k.setAttribute("offset","100%");k.setAttribute("style","stop-color:"+g+m);i.appendChild(k);return i};mxSvgCanvas2D.prototype.addNode=function(f,e){var h=this.node,g=this.state;if(null!=h){if("path"==h.nodeName){if(null!=this.path&&0<this.path.length){h.setAttribute("d",this.path.join(" "))}else{return}}f&&null!=g.fillColor?this.updateFill():this.styleEnabled||("ellipse"==h.nodeName&&mxClient.IS_FF?h.setAttribute("fill","transparent"):h.setAttribute("fill","none"),f=!1);e&&null!=g.strokeColor?this.updateStroke():this.styleEnabled||h.setAttribute("stroke","none");null!=g.transform&&0<g.transform.length&&h.setAttribute("transform",g.transform);g.shadow&&this.root.appendChild(this.createShadow(h));0<this.strokeTolerance&&!f&&this.root.appendChild(this.createTolerance(h));this.pointerEvents&&("path"!=h.nodeName||this.path[this.path.length-1]==this.closeOp)?h.setAttribute("pointer-events","all"):this.pointerEvents||h.setAttribute("pointer-events","none");this.root.appendChild(h)}};mxSvgCanvas2D.prototype.updateFill=function(){var b=this.state;1>b.alpha&&this.node.setAttribute("fill-opacity",b.alpha);null!=b.fillColor&&(null!=b.gradientColor?(b=this.getSvgGradient(b.fillColor,b.gradientColor,b.fillAlpha,b.gradientAlpha,b.gradientDirection),this.node.setAttribute("fill","url(#"+b+")")):this.node.setAttribute("fill",b.fillColor.toLowerCase()))};mxSvgCanvas2D.prototype.updateStroke=function(){var d=this.state;this.node.setAttribute("stroke",d.strokeColor.toLowerCase());1>d.alpha&&this.node.setAttribute("stroke-opacity",d.alpha);var c=Math.max(1,this.format(d.strokeWidth*d.scale));1!=c&&this.node.setAttribute("stroke-width",c);"path"==this.node.nodeName&&this.updateStrokeAttributes();d.dashed&&this.node.setAttribute("stroke-dasharray",this.createDashPattern(d.strokeWidth*d.scale))};mxSvgCanvas2D.prototype.updateStrokeAttributes=function(){var d=this.state;null!=d.lineJoin&&"miter"!=d.lineJoin&&this.node.setAttribute("stroke-linejoin",d.lineJoin);if(null!=d.lineCap){var c=d.lineCap;"flat"==c&&(c="butt");"butt"!=c&&this.node.setAttribute("stroke-linecap",c)}null!=d.miterLimit&&(!this.styleEnabled||10!=d.miterLimit)&&this.node.setAttribute("stroke-miterlimit",d.miterLimit)};mxSvgCanvas2D.prototype.createDashPattern=function(f){var e=this.state.dashPattern.split(" "),h=[];if(0<e.length){for(var g=0;g<e.length;g++){h[g]=Number(e[g])*f}}return h.join(" ")};mxSvgCanvas2D.prototype.createTolerance=function(d){d=d.cloneNode(!0);var c=parseFloat(d.getAttribute("stroke-width")||1)+this.strokeTolerance;d.setAttribute("pointer-events","stroke");d.setAttribute("visibility","hidden");d.removeAttribute("stroke-dasharray");d.setAttribute("stroke-width",c);d.setAttribute("fill","none");d.setAttribute("stroke",mxClient.IS_OP?"none":"white");return d};mxSvgCanvas2D.prototype.createShadow=function(d){d=d.cloneNode(!0);var c=this.state;"none"!=d.getAttribute("fill")&&d.setAttribute("fill",c.shadowColor);"none"!=d.getAttribute("stroke")&&d.setAttribute("stroke",c.shadowColor);d.setAttribute("transform","translate("+this.format(c.shadowDx*c.scale)+","+this.format(c.shadowDy*c.scale)+")"+(c.transform||""));d.setAttribute("opacity",c.shadowAlpha);return d};mxSvgCanvas2D.prototype.rotate=function(u,t,s,r,q){if(0!=u||t||s){var p=this.state;r+=p.dx;q+=p.dy;r*=p.scale;q*=p.scale;p.transform=p.transform||"";if(t&&s){u+=180}else{if(t^s){var o=t?r:0,n=t?-1:1,m=s?q:0,i=s?-1:1;p.transform+="translate("+this.format(o)+","+this.format(m)+")scale("+this.format(n)+","+this.format(i)+")translate("+this.format(-o)+","+this.format(-m)+")"}}if(t?!s:s){u*=-1}0!=u&&(p.transform+="rotate("+this.format(u)+","+this.format(r)+","+this.format(q)+")");p.rotation+=u;p.rotationCx=r;p.rotationCy=q}};mxSvgCanvas2D.prototype.begin=function(){mxAbstractCanvas2D.prototype.begin.apply(this,arguments);this.node=this.createElement("path")};mxSvgCanvas2D.prototype.rect=function(h,g,m,l){var k=this.state,i=this.createElement("rect");i.setAttribute("x",this.format((h+k.dx)*k.scale));i.setAttribute("y",this.format((g+k.dy)*k.scale));i.setAttribute("width",this.format(m*k.scale));i.setAttribute("height",this.format(l*k.scale));this.node=i};mxSvgCanvas2D.prototype.roundrect=function(h,g,m,l,k,i){this.rect(h,g,m,l);0<k&&this.node.setAttribute("rx",this.format(k*this.state.scale));0<i&&this.node.setAttribute("ry",this.format(i*this.state.scale))};mxSvgCanvas2D.prototype.ellipse=function(h,g,m,l){var k=this.state,i=this.createElement("ellipse");i.setAttribute("cx",Math.round((h+m/2+k.dx)*k.scale));i.setAttribute("cy",Math.round((g+l/2+k.dy)*k.scale));i.setAttribute("rx",m/2*k.scale);i.setAttribute("ry",l/2*k.scale);this.node=i};mxSvgCanvas2D.prototype.image=function(A,z,y,x,w,v,u,t){w=this.converter.convert(w);v=null!=v?v:!0;u=null!=u?u:!1;t=null!=t?t:!1;var s=this.state;A+=s.dx;z+=s.dy;var r=this.createElement("image");r.setAttribute("x",this.format(A*s.scale));r.setAttribute("y",this.format(z*s.scale));r.setAttribute("width",this.format(y*s.scale));r.setAttribute("height",this.format(x*s.scale));null==r.setAttributeNS||this.root.ownerDocument!=document?r.setAttribute("xlink:href",w):r.setAttributeNS(mxConstants.NS_XLINK,"href",w);v||r.setAttribute("preserveAspectRatio","none");1>s.alpha&&r.setAttribute("opacity",s.alpha);w=this.state.transform||"";if(u||t){var q=v=1,o=0,i=0;u&&(v=-1,o=-y-2*A);t&&(q=-1,i=-x-2*z);w+="scale("+v+","+q+")translate("+o+","+i+")"}0<w.length&&r.setAttribute("transform",w);this.pointerEvents||r.setAttribute("pointer-events","none");this.root.appendChild(r);this.blockImagePointerEvents&&(r.setAttribute("style","pointer-events:none"),r=this.createElement("rect"),r.setAttribute("visibility","hidden"),r.setAttribute("pointer-events","fill"),r.setAttribute("x",this.format(A*s.scale)),r.setAttribute("y",this.format(z*s.scale)),r.setAttribute("width",this.format(y*s.scale)),r.setAttribute("height",this.format(x*s.scale)),this.root.appendChild(r))};mxSvgCanvas2D.prototype.createDiv=function(g,f,k,i,h){k=this.state;i="display:inline-block;font-size:"+Math.round(k.fontSize)+"px;font-family:"+k.fontFamily+";color:"+k.fontColor+";line-height:"+Math.round(k.fontSize*mxConstants.LINE_HEIGHT)+"px;"+i;(k.fontStyle&mxConstants.FONT_BOLD)==mxConstants.FONT_BOLD&&(i+="font-weight:bold;");(k.fontStyle&mxConstants.FONT_ITALIC)==mxConstants.FONT_ITALIC&&(i+="font-style:italic;");(k.fontStyle&mxConstants.FONT_UNDERLINE)==mxConstants.FONT_UNDERLINE&&(i+="text-decoration:underline;");f==mxConstants.ALIGN_CENTER?i+="text-align:center;":f==mxConstants.ALIGN_RIGHT&&(i+="text-align:right;");f="";null!=k.fontBackgroundColor&&(f+="background-color:"+k.fontBackgroundColor+";");null!=k.fontBorderColor&&(f+="border:1px solid "+k.fontBorderColor+";");mxUtils.isNode(g)||(k=document.createElement("textarea"),k.innerHTML=g.replace(/&lt;/g,"&amp;lt;").replace(/&gt;/g,"&amp;gt;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),g=k.value,"fill"!=h&&"width"!=h?0<f.length&&(g='<div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;'+f+'">'+g+"</div>"):i+=f);if(!mxClient.IS_IE&&document.createElementNS){return h=document.createElementNS("http://www.w3.org/1999/xhtml","div"),h.setAttribute("style",i),mxUtils.isNode(g)?this.root.ownerDocument!=document?h.appendChild(g.cloneNode(!0)):h.appendChild(g):h.innerHTML=g,h}mxUtils.isNode(g)&&this.root.ownerDocument!=document&&(g=g.outerHTML);g=g.replace(/<br>/g,"<br />").replace(/<hr>/g,"<hr />");return mxUtils.parseXml('<div xmlns="http://www.w3.org/1999/xhtml" style="'+i+'">'+g+"</div>").documentElement};mxSvgCanvas2D.prototype.text=function(M,L,K,J,I,H,G,F,E,D,C,B){if(this.textEnabled&&null!=I){B=null!=B?B:0;var A=this.state;M+=A.dx;L+=A.dy;if(this.foEnabled&&"html"==E){var z="vertical-align:top;";C?(z+="overflow:hidden;",0<J&&(z+="max-height:"+Math.round(J)+"px;"),0<K&&(z+="width:"+Math.round(K)+"px;")):"fill"==D?(z+="width:"+Math.round(K)+"px;",z+="height:"+Math.round(J)+"px;"):"width"==D&&(z+="width:"+Math.round(K)+"px;",0<J&&(z+="max-height:"+Math.round(J)+"px;"));F&&0<K?(C||(z+="width:"+Math.round(K)+"px;"),z+="white-space:normal;"):z+="white-space:nowrap;";var x=this.createElement("g");1>A.alpha&&x.setAttribute("opacity",A.alpha);var y=this.createElement("foreignObject");y.setAttribute("pointer-events","all");z=this.createDiv(I,H,G,z,D);if(null!=z){x.appendChild(y);this.root.appendChild(x);var w=0,o=0;if(mxClient.IS_IE&&!mxClient.IS_SVG){var i=document.createElement("div");i.style.cssText=z.getAttribute("style");i.style.display=mxClient.IS_QUIRKS?"inline":"inline-block";i.style.visibility="hidden";i.innerHTML=mxUtils.isNode(I)?I.outerHTML:I;document.body.appendChild(i);w=i.offsetWidth;o=mxClient.IS_QUIRKS&&0<J&&C?Math.min(J,i.offsetHeight+2):i.offsetHeight;i.parentNode.removeChild(i);y.appendChild(z)}else{this.root.ownerDocument!=document||0<=navigator.userAgent.indexOf("Firefox/3.")?(z.style.visibility="hidden",document.body.appendChild(z),w=z.offsetWidth,o=z.offsetHeight,y.appendChild(z),z.style.visibility=""):(y.appendChild(z),w=z.offsetWidth,o=z.offsetHeight)}!C&&(F&&z.scrollWidth>w)&&(w=Math.max(w,z.scrollWidth),z.style.width=w+"px");"fill"==D?(K=Math.max(K,w),J=Math.max(J,o)):(K="width"==D?Math.max(K,w):w,J=o);1>A.alpha&&x.setAttribute("opacity",A.alpha);w=z=0;H==mxConstants.ALIGN_CENTER?z-=K/2:H==mxConstants.ALIGN_RIGHT&&(z-=K);M+=z;G==mxConstants.ALIGN_MIDDLE?w-=J/2:G==mxConstants.ALIGN_BOTTOM&&(w-=J);L+=w;o=1!=A.scale?"scale("+A.scale+")":"";0!=A.rotation&&this.rotateHtml?(o+="rotate("+A.rotation+","+K/2+","+J/2+")",L=this.rotatePoint((M+K/2)*A.scale,(L+J/2)*A.scale,A.rotation,A.rotationCx,A.rotationCy),M=L.x-K*A.scale/2,L=L.y-J*A.scale/2):(M*=A.scale,L*=A.scale);0!=B&&(o+="rotate("+B+","+-z+","+-w+")");x.setAttribute("transform","translate("+Math.round(M)+","+Math.round(L)+")"+o);y.setAttribute("width",Math.round(Math.max(1,K)));y.setAttribute("height",Math.round(Math.max(1,J)));this.root.ownerDocument!=document&&(M=this.createAlternateContent(y,M,L,K,J,I,H,G,F,E,D,C,B),null!=M&&(y.setAttribute("requiredFeatures","http://www.w3.org/TR/SVG11/feature#Extensibility"),K=this.createElement("switch"),K.appendChild(y),K.appendChild(M),x.appendChild(K)))}}else{this.plainText(M,L,K,J,I,H,G,F,D,C,B)}}};mxSvgCanvas2D.prototype.createClip=function(i,h,o,n){i=Math.round(i);h=Math.round(h);o=Math.round(o);n=Math.round(n);for(var m="mx-clip-"+i+"-"+h+"-"+o+"-"+n,l=0,k=m+"-"+l;null!=document.getElementById(k);){k=m+"-"+ ++l}clip=this.createElement("clipPath");clip.setAttribute("id",k);m=this.createElement("rect");m.setAttribute("x",i);m.setAttribute("y",h);m.setAttribute("width",o);m.setAttribute("height",n);clip.appendChild(m);return clip};mxSvgCanvas2D.prototype.plainText=function(F,E,D,C,B,A,z,y,x,w,v){v=null!=v?v:0;y=this.state;var u=Math.round(y.fontSize),t=this.createElement("g"),o=y.transform||"";0!=v&&(o+="rotate("+v+","+this.format(F*y.scale)+","+this.format(E*y.scale)+")");if(w&&0<D&&0<C){var G=F;v=E;A==mxConstants.ALIGN_CENTER?G-=D/2:A==mxConstants.ALIGN_RIGHT&&(G-=D);"fill"!=x&&(z==mxConstants.ALIGN_MIDDLE?v-=C/2:z==mxConstants.ALIGN_BOTTOM&&(v-=C));v=this.createClip(G*y.scale-2,v*y.scale-2,D*y.scale+4,C*y.scale+4);null!=this.defs?this.defs.appendChild(v):this.root.appendChild(v);t.setAttribute("clip-path","url(#"+v.getAttribute("id")+")")}v=A==mxConstants.ALIGN_RIGHT?"end":A==mxConstants.ALIGN_CENTER?"middle":"start";"start"!=v&&t.setAttribute("text-anchor",v);(!this.styleEnabled||u!=mxConstants.DEFAULT_FONTSIZE)&&t.setAttribute("font-size",Math.round(u*y.scale)+"px");0<o.length&&t.setAttribute("transform",o);1>y.alpha&&t.setAttribute("opacity",y.alpha);var o=B.split("\n"),G=Math.round(u*mxConstants.LINE_HEIGHT),i=u+(o.length-1)*G;v=E+u-1;z==mxConstants.ALIGN_MIDDLE?"fill"==x?v-=C/2:(w=(this.matchHtmlAlignment&&w&&0<C?Math.min(i,C):i)/2,v-=w+1):z==mxConstants.ALIGN_BOTTOM&&("fill"==x?v-=C:(w=this.matchHtmlAlignment&&w&&0<C?Math.min(i,C):i,v-=w+2));for(w=0;w<o.length;w++){0<o[w].length&&0<mxUtils.trim(o[w]).length&&(u=this.createElement("text"),u.setAttribute("x",this.format(F*y.scale)),u.setAttribute("y",this.format(v*y.scale)),this.updateFont(u),mxUtils.write(u,o[w]),t.appendChild(u)),v+=G}this.root.appendChild(t);this.addTextBackground(t,B,F,E,D,"fill"==x?C:i,A,z,x)};mxSvgCanvas2D.prototype.updateFont=function(d){var c=this.state;d.setAttribute("fill",c.fontColor);(!this.styleEnabled||c.fontFamily!=mxConstants.DEFAULT_FONTFAMILY)&&d.setAttribute("font-family",c.fontFamily);(c.fontStyle&mxConstants.FONT_BOLD)==mxConstants.FONT_BOLD&&d.setAttribute("font-weight","bold");(c.fontStyle&mxConstants.FONT_ITALIC)==mxConstants.FONT_ITALIC&&d.setAttribute("font-style","italic");(c.fontStyle&mxConstants.FONT_UNDERLINE)==mxConstants.FONT_UNDERLINE&&d.setAttribute("text-decoration","underline")};mxSvgCanvas2D.prototype.addTextBackground=function(w,v,u,t,s,r,q,p,o){var n=this.state;if(null!=n.fontBackgroundColor||null!=n.fontBorderColor){var i=null;"fill"==o||"width"==o?(q==mxConstants.ALIGN_CENTER?u-=s/2:q==mxConstants.ALIGN_RIGHT&&(u-=s),p==mxConstants.ALIGN_MIDDLE?t-=r/2:p==mxConstants.ALIGN_BOTTOM&&(t-=r),i=new mxRectangle((u+1)*n.scale,t*n.scale,(s-2)*n.scale,(r+2)*n.scale)):null!=w.getBBox&&this.root.ownerDocument==document?(i=w.getBBox(),v=mxClient.IS_IE&&mxClient.IS_SVG,i=new mxRectangle(i.x,i.y+(v?0:1),i.width,i.height+(v?1:0))):(i=document.createElement("div"),i.style.lineHeight=Math.round(n.fontSize*mxConstants.LINE_HEIGHT)+"px",i.style.fontSize=Math.round(n.fontSize)+"px",i.style.fontFamily=n.fontFamily,i.style.whiteSpace="nowrap",i.style.position="absolute",i.style.visibility="hidden",i.style.display=mxClient.IS_QUIRKS?"inline":"inline-block",i.style.zoom="1",(n.fontStyle&mxConstants.FONT_BOLD)==mxConstants.FONT_BOLD&&(i.style.fontWeight="bold"),(n.fontStyle&mxConstants.FONT_ITALIC)==mxConstants.FONT_ITALIC&&(i.style.fontStyle="italic"),v=mxUtils.htmlEntities(v,!1),i.innerHTML=v.replace(/\n/g,"<br/>"),document.body.appendChild(i),s=i.offsetWidth,r=i.offsetHeight,i.parentNode.removeChild(i),q==mxConstants.ALIGN_CENTER?u-=s/2:q==mxConstants.ALIGN_RIGHT&&(u-=s),p==mxConstants.ALIGN_MIDDLE?t-=r/2:p==mxConstants.ALIGN_BOTTOM&&(t-=r),i=new mxRectangle((u+1)*n.scale,(t+2)*n.scale,s*n.scale,(r+1)*n.scale));null!=i&&(v=this.createElement("rect"),v.setAttribute("fill",n.fontBackgroundColor||"none"),v.setAttribute("stroke",n.fontBorderColor||"none"),v.setAttribute("x",Math.floor(i.x-1)),v.setAttribute("y",Math.floor(i.y-1)),v.setAttribute("width",Math.ceil(i.width+2)),v.setAttribute("height",Math.ceil(i.height)),n=null!=n.fontBorderColor?Math.max(1,this.format(n.scale)):0,v.setAttribute("stroke-width",n),this.root.ownerDocument==document&&1==mxUtils.mod(n,2)&&v.setAttribute("transform","translate(0.5, 0.5)"),w.insertBefore(v,w.firstChild))}};mxSvgCanvas2D.prototype.stroke=function(){this.addNode(!1,!0)};mxSvgCanvas2D.prototype.fill=function(){this.addNode(!0,!1)};mxSvgCanvas2D.prototype.fillAndStroke=function(){this.addNode(!0,!0)};var mxVmlCanvas2D=function(b){mxAbstractCanvas2D.call(this);this.root=b};mxUtils.extend(mxVmlCanvas2D,mxAbstractCanvas2D);mxVmlCanvas2D.prototype.node=null;mxVmlCanvas2D.prototype.textEnabled=!0;mxVmlCanvas2D.prototype.moveOp="m";mxVmlCanvas2D.prototype.lineOp="l";mxVmlCanvas2D.prototype.curveOp="c";mxVmlCanvas2D.prototype.closeOp="x";mxVmlCanvas2D.prototype.rotatedHtmlBackground="";mxVmlCanvas2D.prototype.vmlScale=1;mxVmlCanvas2D.prototype.addNode=function(f,e){var h=this.node,g=this.state;if(null!=h){if("shape"==h.nodeName){if(null!=this.path&&0<this.path.length){h.path=this.path.join(" ")+" e",h.style.width=this.root.style.width,h.style.height=this.root.style.height,h.coordsize=parseInt(h.style.width)+" "+parseInt(h.style.height)}else{return}}h.strokeweight=this.format(Math.max(1,g.strokeWidth*g.scale/this.vmlScale))+"px";g.shadow&&this.root.appendChild(this.createShadow(h,f&&null!=g.fillColor,e&&null!=g.strokeColor));e&&null!=g.strokeColor?(h.stroked="true",h.strokecolor=g.strokeColor):h.stroked="false";h.appendChild(this.createStroke());f&&null!=g.fillColor?h.appendChild(this.createFill()):this.pointerEvents&&("shape"!=h.nodeName||this.path[this.path.length-1]==this.closeOp)?h.appendChild(this.createTransparentFill()):h.filled="false";this.root.appendChild(h)}};mxVmlCanvas2D.prototype.createTransparentFill=function(){var b=document.createElement(mxClient.VML_PREFIX+":fill");b.src=mxClient.imageBasePath+"/transparent.gif";b.type="tile";return b};mxVmlCanvas2D.prototype.createFill=function(){var e=this.state,d=document.createElement(mxClient.VML_PREFIX+":fill");d.color=e.fillColor;if(null!=e.gradientColor){d.type="gradient";d.method="none";d.color2=e.gradientColor;var f=180-e.rotation,f=e.gradientDirection==mxConstants.DIRECTION_WEST?f-(90+("x"==this.root.style.flip?180:0)):e.gradientDirection==mxConstants.DIRECTION_EAST?f+(90+("x"==this.root.style.flip?180:0)):e.gradientDirection==mxConstants.DIRECTION_NORTH?f-(180+("y"==this.root.style.flip?-180:0)):f+("y"==this.root.style.flip?-180:0);if("x"==this.root.style.flip||"y"==this.root.style.flip){f*=-1}d.angle=mxUtils.mod(f,360);d.opacity=100*e.alpha*e.fillAlpha+"%";d.setAttribute(mxClient.OFFICE_PREFIX+":opacity2",100*e.alpha*e.gradientAlpha+"%")}else{1>e.alpha&&(d.opacity=100*e.alpha+"%")}return d};mxVmlCanvas2D.prototype.createStroke=function(){var d=this.state,c=document.createElement(mxClient.VML_PREFIX+":stroke");c.endcap=d.lineCap||"flat";c.joinstyle=d.lineJoin||"miter";c.miterlimit=d.miterLimit||"10";1>d.alpha&&(c.opacity=100*d.alpha+"%");d.dashed&&(c.dashstyle=this.getVmlDashStyle());return c};mxVmlCanvas2D.prototype.getVmlDashStyle=function(){var d="dash";if(null!=this.state.dashPattern){var c=this.state.dashPattern.split(" ");0<c.length&&1==c[0]&&(d="0 2")}return d};mxVmlCanvas2D.prototype.createShadow=function(s,r,q){var p=this.state,o=-p.rotation*(Math.PI/180),n=Math.cos(o),o=Math.sin(o),m=p.shadowDx*p.scale,l=p.shadowDy*p.scale;"x"==this.root.style.flip?m*=-1:"y"==this.root.style.flip&&(l*=-1);var i=s.cloneNode(!0);i.style.marginLeft=Math.round(m*n-l*o)+"px";i.style.marginTop=Math.round(m*o+l*n)+"px";8==document.documentMode&&(i.strokeweight=s.strokeweight,"shape"==s.nodeName&&(i.path=this.path.join(" ")+" e",i.style.width=this.root.style.width,i.style.height=this.root.style.height,i.coordsize=parseInt(s.style.width)+" "+parseInt(s.style.height)));q?(i.strokecolor=p.shadowColor,i.appendChild(this.createShadowStroke())):i.stroked="false";r?i.appendChild(this.createShadowFill()):i.filled="false";return i};mxVmlCanvas2D.prototype.createShadowFill=function(){var b=document.createElement(mxClient.VML_PREFIX+":fill");b.color=this.state.shadowColor;b.opacity=100*this.state.alpha*this.state.shadowAlpha+"%";return b};mxVmlCanvas2D.prototype.createShadowStroke=function(){var b=this.createStroke();b.opacity=100*this.state.alpha*this.state.shadowAlpha+"%";return b};mxVmlCanvas2D.prototype.rotate=function(g,f,k,i,h){f&&k?g+=180:f?this.root.style.flip="x":k&&(this.root.style.flip="y");if(f?!k:k){g*=-1}this.root.style.rotation=g;this.state.rotation+=g;this.state.rotationCx=i;this.state.rotationCy=h};mxVmlCanvas2D.prototype.begin=function(){mxAbstractCanvas2D.prototype.begin.apply(this,arguments);this.node=document.createElement(mxClient.VML_PREFIX+":shape");this.node.style.position="absolute"};mxVmlCanvas2D.prototype.quadTo=function(k,i,q,p){var o=this.state,n=(this.lastX+o.dx)*o.scale,m=(this.lastY+o.dy)*o.scale;k=(k+o.dx)*o.scale;i=(i+o.dy)*o.scale;q=(q+o.dx)*o.scale;p=(p+o.dy)*o.scale;var m=m+2/3*(i-m),l=q+2/3*(k-q);i=p+2/3*(i-p);this.path.push("c "+this.format(n+2/3*(k-n))+" "+this.format(m)+" "+this.format(l)+" "+this.format(i)+" "+this.format(q)+" "+this.format(p));this.lastX=q/o.scale-o.dx;this.lastY=p/o.scale-o.dy};mxVmlCanvas2D.prototype.createRect=function(h,g,m,l,k){var i=this.state;h=document.createElement(h);h.style.position="absolute";h.style.left=this.format((g+i.dx)*i.scale)+"px";h.style.top=this.format((m+i.dy)*i.scale)+"px";h.style.width=this.format(l*i.scale)+"px";h.style.height=this.format(k*i.scale)+"px";return h};mxVmlCanvas2D.prototype.rect=function(f,e,h,g){this.node=this.createRect(mxClient.VML_PREFIX+":rect",f,e,h,g)};mxVmlCanvas2D.prototype.roundrect=function(h,g,m,l,k,i){this.node=this.createRect(mxClient.VML_PREFIX+":roundrect",h,g,m,l);this.node.setAttribute("arcsize",Math.max(100*k/m,100*i/l)+"%")};mxVmlCanvas2D.prototype.ellipse=function(f,e,h,g){this.node=this.createRect(mxClient.VML_PREFIX+":oval",f,e,h,g)};mxVmlCanvas2D.prototype.image=function(s,r,q,p,o,n,m,l){var i=null;n?(i=this.createRect(mxClient.VML_PREFIX+":rect",s,r,q,p),i.stroked="false",s=document.createElement(mxClient.VML_PREFIX+":fill"),s.aspect=n?"atmost":"ignore",s.rotate="true",s.type="frame",s.src=o,i.appendChild(s)):(i=this.createRect(mxClient.VML_PREFIX+":image",s,r,q,p),i.src=o);m&&l?i.style.rotation="180":m?i.style.flip="x":l&&(i.style.flip="y");1>this.state.alpha&&(i.style.filter+="alpha(opacity="+100*this.state.alpha+")");this.root.appendChild(i)};mxVmlCanvas2D.prototype.createDiv=function(h,g,m,l){m=document.createElement("div");var k=this.state,i="";null!=k.fontBackgroundColor&&(i+="background-color:"+k.fontBackgroundColor+";");null!=k.fontBorderColor&&(i+="border:1px solid "+k.fontBorderColor+";");mxUtils.isNode(h)?m.appendChild(h):0<i.length&&"fill"!=l&&"width"!=l?(l=document.createElement("div"),l.style.cssText=i,l.style.display=mxClient.IS_QUIRKS?"inline":"inline-block",l.style.zoom="1",l.innerHTML=h,m.appendChild(l)):(m.style.cssText=i,m.innerHTML=h);h=m.style;h.fontSize=Math.round(k.fontSize/this.vmlScale)+"px";h.fontFamily=k.fontFamily;h.color=k.fontColor;h.verticalAlign="top";h.textAlign=g||"left";h.lineHeight=Math.round(k.fontSize*mxConstants.LINE_HEIGHT/this.vmlScale)+"px";(k.fontStyle&mxConstants.FONT_BOLD)==mxConstants.FONT_BOLD&&(h.fontWeight="bold");(k.fontStyle&mxConstants.FONT_ITALIC)==mxConstants.FONT_ITALIC&&(h.fontStyle="italic");(k.fontStyle&mxConstants.FONT_UNDERLINE)==mxConstants.FONT_UNDERLINE&&(h.textDecoration="underline");return m};mxVmlCanvas2D.prototype.text=function(K,J,I,H,G,F,E,D,C,B,A,z){if(this.textEnabled&&null!=G){var y=this.state;if("html"==C){null!=y.rotation&&(J=this.rotatePoint(K,J,y.rotation,y.rotationCx,y.rotationCy),K=J.x,J=J.y);8==document.documentMode?(K+=y.dx,J+=y.dy):(K*=y.scale,J*=y.scale);C=8==document.documentMode?document.createElement(mxClient.VML_PREFIX+":group"):document.createElement("div");C.style.position="absolute";C.style.display="inline";C.style.left=this.format(K)+"px";C.style.top=this.format(J)+"px";C.style.zoom=y.scale;var x=document.createElement("div");x.style.position="relative";x.style.display="inline";var v=mxUtils.getAlignmentAsPoint(F,E),w=v.x,v=v.y;G=this.createDiv(G,F,E,B);F=document.createElement("div");D&&0<I?(A||(G.style.width=Math.round(I)+"px"),G.style.whiteSpace="normal"):G.style.whiteSpace="nowrap";z=y.rotation+(z||0);this.rotateHtml&&0!=z?(F.style.display="inline",F.style.zoom="1",F.appendChild(G),8==document.documentMode&&"DIV"!=this.root.nodeName?(x.appendChild(F),C.appendChild(x)):C.appendChild(F)):8==document.documentMode?(x.appendChild(G),C.appendChild(x)):(G.style.display="inline",C.appendChild(G));"DIV"!=this.root.nodeName?(E=document.createElement(mxClient.VML_PREFIX+":rect"),E.stroked="false",E.filled="false",E.appendChild(C),this.root.appendChild(E)):this.root.appendChild(C);A?(G.style.overflow="hidden",0<I&&(G.style.width=Math.round(I)+"px"),0<H&&8==document.documentMode&&(G.style.maxHeight=Math.round(H)+"px")):"fill"==B?(G.style.width=I+"px",G.style.height=H+"px"):"width"==B&&(G.style.width=I+"px",0<H&&(G.style.maxHeight=Math.round(H)+"px"));if(this.rotateHtml&&0!=z){I=z*(Math.PI/180);z=parseFloat(parseFloat(Math.cos(I)).toFixed(8));E=parseFloat(parseFloat(Math.sin(-I)).toFixed(8));I%=2*Math.PI;0>I&&(I+=2*Math.PI);I%=Math.PI;I>Math.PI/2&&(I=Math.PI-I);var o=Math.cos(I),i=Math.sin(I);8==document.documentMode&&(G.style.display="inline-block",F.style.display="inline-block",x.style.display="inline-block");G.style.visibility="hidden";document.body.appendChild(G);I=G.offsetWidth;x=G.offsetHeight;!A&&D&&(I=Math.max(I,G.scrollWidth),G.style.width=I+"px");if(mxClient.IS_QUIRKS&&(A||"width"==B)&&x>H){x=H,G.style.height=x+"px"}H=x;A=(H-H*o+I*-i)/2-E*I*(w+0.5)+z*H*(v+0.5);D=(I-I*o+H*-i)/2+z*I*(w+0.5)+E*H*(v+0.5);"group"==C.nodeName&&"DIV"==this.root.nodeName?(B=document.createElement("div"),B.style.display="inline-block",B.style.position="absolute",B.style.left=this.format(K+(D-I/2)*y.scale)+"px",B.style.top=this.format(J+(A-H/2)*y.scale)+"px",C.parentNode.appendChild(B),B.appendChild(C)):(y=8==document.documentMode?1:y.scale,C.style.left=this.format(K+(D-I/2)*y)+"px",C.style.top=this.format(J+(A-H/2)*y)+"px");F.style.filter="progid:DXImageTransform.Microsoft.Matrix(M11="+z+", M12="+E+", M21="+-E+", M22="+z+", sizingMethod='auto expand')";F.style.backgroundColor=this.rotatedHtmlBackground;1>this.state.alpha&&(F.style.filter+="alpha(opacity="+100*this.state.alpha+")");G.style.visibility="";F.appendChild(G)}else{8!=document.documentMode?(G.style.verticalAlign="top",1>this.state.alpha&&(C.style.filter="alpha(opacity="+100*this.state.alpha+")"),y=G.parentNode,G.style.visibility="hidden",document.body.appendChild(G),I=G.offsetWidth,x=G.offsetHeight,mxClient.IS_QUIRKS&&(A&&x>H)&&(x=H,G.style.height=x+"px"),H=x,G.style.visibility="",y.appendChild(G),C.style.left=this.format(K+I*w*this.state.scale)+"px",C.style.top=this.format(J+H*v*this.state.scale)+"px"):(1>this.state.alpha&&(G.style.filter="alpha(opacity="+100*this.state.alpha+")"),x.style.left=100*w+"%",x.style.top=100*v+"%")}}else{this.plainText(K,J,I,H,mxUtils.htmlEntities(G,!1),F,E,D,C,B,A,z)}}};mxVmlCanvas2D.prototype.plainText=function(y,x,w,v,u,t,s,r,q,p,o,i){r=this.state;y=(y+r.dx)*r.scale;x=(x+r.dy)*r.scale;w=document.createElement(mxClient.VML_PREFIX+":shape");w.style.width="1px";w.style.height="1px";w.stroked="false";v=document.createElement(mxClient.VML_PREFIX+":fill");v.color=r.fontColor;v.opacity=100*r.alpha+"%";w.appendChild(v);v=document.createElement(mxClient.VML_PREFIX+":path");v.textpathok="true";v.v="m "+this.format(0)+" "+this.format(0)+" l "+this.format(1)+" "+this.format(0);w.appendChild(v);v=document.createElement(mxClient.VML_PREFIX+":textpath");v.style.cssText="v-text-align:"+t;v.style.align=t;v.style.fontFamily=r.fontFamily;v.string=u;v.on="true";t=Math.round(r.fontSize*r.scale/this.vmlScale);v.style.fontSize=t+"px";(r.fontStyle&mxConstants.FONT_BOLD)==mxConstants.FONT_BOLD&&(v.style.fontWeight="bold");(r.fontStyle&mxConstants.FONT_ITALIC)==mxConstants.FONT_ITALIC&&(v.style.fontStyle="italic");(r.fontStyle&mxConstants.FONT_UNDERLINE)==mxConstants.FONT_UNDERLINE&&(v.style.textDecoration="underline");u=u.split("\n");r=t+(u.length-1)*t*mxConstants.LINE_HEIGHT;t=u=0;s==mxConstants.ALIGN_BOTTOM?t=-r/2:s!=mxConstants.ALIGN_MIDDLE&&(t=r/2);null!=i&&(w.style.rotation=i,s=i*(Math.PI/180),u=Math.sin(s)*t,t*=Math.cos(s));w.appendChild(v);w.style.left=this.format(y-u)+"px";w.style.top=this.format(x+t)+"px";this.root.appendChild(w)};mxVmlCanvas2D.prototype.stroke=function(){this.addNode(!1,!0)};mxVmlCanvas2D.prototype.fill=function(){this.addNode(!0,!1)};mxVmlCanvas2D.prototype.fillAndStroke=function(){this.addNode(!0,!0)};function mxGuide(d,c){this.graph=d;this.setStates(c)}mxGuide.prototype.graph=null;mxGuide.prototype.states=null;mxGuide.prototype.horizontal=!0;mxGuide.prototype.vertical=!0;mxGuide.prototype.guideX=null;mxGuide.prototype.guideY=null;mxGuide.prototype.setStates=function(b){this.states=b};mxGuide.prototype.isEnabledForEvent=function(b){return !0};mxGuide.prototype.getGuideTolerance=function(){return this.graph.gridSize*this.graph.view.scale/2};mxGuide.prototype.createGuideShape=function(b){b=new mxPolyline([],mxConstants.GUIDE_COLOR,mxConstants.GUIDE_STROKEWIDTH);b.isDashed=!0;return b};mxGuide.prototype.move=function(O,N,M){if(null!=this.states&&(this.horizontal||this.vertical)&&null!=O&&null!=N){var L=this.graph.getView().translate,K=this.graph.getView().scale,J=N.x,I=N.y,H=!1,G=!1,F=this.getGuideTolerance(),E=F,D=F,F=O.clone();F.x+=N.x;F.y+=N.y;var C=F.x,B=F.x+F.width,z=F.getCenterX(),A=F.y,y=F.y+F.height,x=F.getCenterY();N=function(a){a+=this.graph.panDx;var f=!1;Math.abs(a-z)<E?(J=a-O.getCenterX(),E=Math.abs(a-z),f=!0):Math.abs(a-C)<E?(J=a-O.x,E=Math.abs(a-C),f=!0):Math.abs(a-B)<E&&(J=a-O.x-O.width,E=Math.abs(a-B),f=!0);if(f){null==this.guideX&&(this.guideX=this.createGuideShape(!0),this.guideX.dialect=this.graph.dialect!=mxConstants.DIALECT_SVG?mxConstants.DIALECT_VML:mxConstants.DIALECT_SVG,this.guideX.pointerEvents=!1,this.guideX.init(this.graph.getView().getOverlayPane()));var e=this.graph.container;a-=this.graph.panDx;this.guideX.points=[new mxPoint(a,-this.graph.panDy),new mxPoint(a,e.scrollHeight-3-this.graph.panDy)]}H=H||f};for(var F=function(a){a+=this.graph.panDy;var f=!1;Math.abs(a-x)<D?(I=a-O.getCenterY(),D=Math.abs(a-x),f=!0):Math.abs(a-A)<D?(I=a-O.y,D=Math.abs(a-A),f=!0):Math.abs(a-y)<D&&(I=a-O.y-O.height,D=Math.abs(a-y),f=!0);if(f){null==this.guideY&&(this.guideY=this.createGuideShape(!1),this.guideY.dialect=this.graph.dialect!=mxConstants.DIALECT_SVG?mxConstants.DIALECT_VML:mxConstants.DIALECT_SVG,this.guideY.pointerEvents=!1,this.guideY.init(this.graph.getView().getOverlayPane()));var e=this.graph.container;a-=this.graph.panDy;this.guideY.points=[new mxPoint(-this.graph.panDx,a),new mxPoint(e.scrollWidth-3-this.graph.panDx,a)]}G=G||f},o=0;o<this.states.length;o++){var i=this.states[o];null!=i&&(this.horizontal&&(N.call(this,i.getCenterX()),N.call(this,i.x),N.call(this,i.x+i.width)),this.vertical&&(F.call(this,i.getCenterY()),F.call(this,i.y),F.call(this,i.y+i.height)))}!H&&null!=this.guideX?this.guideX.node.style.visibility="hidden":null!=this.guideX&&(this.guideX.node.style.visibility="visible",this.guideX.redraw());!G&&null!=this.guideY?this.guideY.node.style.visibility="hidden":null!=this.guideY&&(this.guideY.node.style.visibility="visible",this.guideY.redraw());M&&(H||(M=O.x-(this.graph.snap(O.x/K-L.x)+L.x)*K,J=this.graph.snap(J/K)*K-M),G||(L=O.y-(this.graph.snap(O.y/K-L.y)+L.y)*K,I=this.graph.snap(I/K)*K-L));N=new mxPoint(J,I)}return N};mxGuide.prototype.hide=function(){null!=this.guideX&&(this.guideX.node.style.visibility="hidden");null!=this.guideY&&(this.guideY.node.style.visibility="hidden")};mxGuide.prototype.destroy=function(){null!=this.guideX&&(this.guideX.destroy(),this.guideX=null);null!=this.guideY&&(this.guideY.destroy(),this.guideY=null)};function mxStencil(b){this.desc=b;this.parseDescription();this.parseConstraints()}mxStencil.defaultLocalized=!1;mxStencil.prototype.desc=null;mxStencil.prototype.constraints=null;mxStencil.prototype.aspect=null;mxStencil.prototype.w0=null;mxStencil.prototype.h0=null;mxStencil.prototype.bgNode=null;mxStencil.prototype.fgNode=null;mxStencil.prototype.strokewidth=null;mxStencil.prototype.parseDescription=function(){this.fgNode=this.desc.getElementsByTagName("foreground")[0];this.bgNode=this.desc.getElementsByTagName("background")[0];this.w0=Number(this.desc.getAttribute("w")||100);this.h0=Number(this.desc.getAttribute("h")||100);var b=this.desc.getAttribute("aspect");this.aspect=null!=b?b:"variable";b=this.desc.getAttribute("strokewidth");this.strokewidth=null!=b?b:"1"};mxStencil.prototype.parseConstraints=function(){var d=this.desc.getElementsByTagName("connections")[0];if(null!=d&&(d=mxUtils.getChildNodes(d),null!=d&&0<d.length)){this.constraints=[];for(var c=0;c<d.length;c++){this.constraints.push(this.parseConstraint(d[c]))}}};mxStencil.prototype.parseConstraint=function(e){var d=Number(e.getAttribute("x")),f=Number(e.getAttribute("y"));e="1"==e.getAttribute("perimeter");return new mxConnectionConstraint(new mxPoint(d,f),e)};mxStencil.prototype.evaluateTextAttribute=function(e,d,f){d=this.evaluateAttribute(e,d,f);e=e.getAttribute("localized");if(mxStencil.defaultLocalized&&null==e||"1"==e){d=mxResources.get(d)}return d};mxStencil.prototype.evaluateAttribute=function(a,b,c){b=a.getAttribute(b);null==b&&(a=mxUtils.getTextContent(a),null!=a&&(a=mxUtils.eval(a),"function"==typeof a&&(b=a(c))));return b};mxStencil.prototype.drawShape=function(h,g,m,l,k,i){this.drawChildren(h,g,m,l,k,i,this.bgNode,!1);this.drawChildren(h,g,m,l,k,i,this.fgNode,!0)};mxStencil.prototype.drawChildren=function(s,r,q,p,o,n,m,l){if(null!=m&&0<o&&0<n){var i=mxUtils.getValue(r.style,mxConstants.STYLE_DIRECTION,null);q=this.computeAspect(r.style,q,p,o,n,i);p=Math.min(q.width,q.height);p="inherit"==this.strokewidth?Number(mxUtils.getNumber(r.style,mxConstants.STYLE_STROKEWIDTH,1)):Number(this.strokewidth)*p;s.setStrokeWidth(p);for(m=m.firstChild;null!=m;){m.nodeType==mxConstants.NODETYPE_ELEMENT&&this.drawNode(s,r,m,q,l),m=m.nextSibling}}};mxStencil.prototype.computeAspect=function(k,i,q,p,o,n){k=i;i=p/this.w0;var m=o/this.h0;if(n=n==mxConstants.DIRECTION_NORTH||n==mxConstants.DIRECTION_SOUTH){m=p/this.h0;i=o/this.w0;var l=(p-o)/2;k+=l;q-=l}"fixed"==this.aspect&&(i=m=Math.min(i,m),n?(k+=(o-this.w0*i)/2,q+=(p-this.h0*m)/2):(k+=(p-this.w0*i)/2,q+=(o-this.h0*m)/2));return new mxRectangle(k,q,i,m)};mxStencil.prototype.drawNode=function(A,z,y,x,w){var v=y.nodeName,u=x.x,t=x.y,s=x.width,r=x.height,q=Math.min(s,r);if("save"==v){A.save()}else{if("restore"==v){A.restore()}else{if("path"==v){A.begin();for(y=y.firstChild;null!=y;){y.nodeType==mxConstants.NODETYPE_ELEMENT&&this.drawNode(A,z,y,x,w),y=y.nextSibling}}else{if("close"==v){A.close()}else{if("move"==v){A.moveTo(u+Number(y.getAttribute("x"))*s,t+Number(y.getAttribute("y"))*r)}else{if("line"==v){A.lineTo(u+Number(y.getAttribute("x"))*s,t+Number(y.getAttribute("y"))*r)}else{if("quad"==v){A.quadTo(u+Number(y.getAttribute("x1"))*s,t+Number(y.getAttribute("y1"))*r,u+Number(y.getAttribute("x2"))*s,t+Number(y.getAttribute("y2"))*r)}else{if("curve"==v){A.curveTo(u+Number(y.getAttribute("x1"))*s,t+Number(y.getAttribute("y1"))*r,u+Number(y.getAttribute("x2"))*s,t+Number(y.getAttribute("y2"))*r,u+Number(y.getAttribute("x3"))*s,t+Number(y.getAttribute("y3"))*r)}else{if("arc"==v){A.arcTo(Number(y.getAttribute("rx"))*s,Number(y.getAttribute("ry"))*r,Number(y.getAttribute("x-axis-rotation")),Number(y.getAttribute("large-arc-flag")),Number(y.getAttribute("sweep-flag")),u+Number(y.getAttribute("x"))*s,t+Number(y.getAttribute("y"))*r)}else{if("rect"==v){A.rect(u+Number(y.getAttribute("x"))*s,t+Number(y.getAttribute("y"))*r,Number(y.getAttribute("w"))*s,Number(y.getAttribute("h"))*r)}else{if("roundrect"==v){z=Number(y.getAttribute("arcsize")),0==z&&(z=100*mxConstants.RECTANGLE_ROUNDING_FACTOR),q=Number(y.getAttribute("w"))*s,x=Number(y.getAttribute("h"))*r,z=Number(z)/100,z=Math.min(q*z,x*z),A.roundrect(u+Number(y.getAttribute("x"))*s,t+Number(y.getAttribute("y"))*r,q,x,z,z)}else{if("ellipse"==v){A.ellipse(u+Number(y.getAttribute("x"))*s,t+Number(y.getAttribute("y"))*r,Number(y.getAttribute("w"))*s,Number(y.getAttribute("h"))*r)}else{if("image"==v){z=this.evaluateAttribute(y,"src",z),A.image(u+Number(y.getAttribute("x"))*s,t+Number(y.getAttribute("y"))*r,Number(y.getAttribute("w"))*s,Number(y.getAttribute("h"))*r,z,!1,"1"==y.getAttribute("flipH"),"1"==y.getAttribute("flipV"))}else{if("text"==v){q=this.evaluateTextAttribute(y,"str",z);x="1"==y.getAttribute("vertical")?-90:0;if("0"==y.getAttribute("align-shape")){var o=z.rotation,i=1==mxUtils.getValue(z.style,mxConstants.STYLE_FLIPH,0);z=1==mxUtils.getValue(z.style,mxConstants.STYLE_FLIPV,0);x=i&&z?x-o:i||z?x+o:x-o}x-=y.getAttribute("rotation");A.text(u+Number(y.getAttribute("x"))*s,t+Number(y.getAttribute("y"))*r,0,0,q,y.getAttribute("align")||"left",y.getAttribute("valign")||"top",!1,"",null,!1,x)}else{if("include-shape"==v){o=mxStencilRegistry.getStencil(y.getAttribute("name")),null!=o&&(u+=Number(y.getAttribute("x"))*s,t+=Number(y.getAttribute("y"))*r,q=Number(y.getAttribute("w"))*s,x=Number(y.getAttribute("h"))*r,o.drawShape(A,z,u,t,q,x))}else{if("fillstroke"==v){A.fillAndStroke()}else{if("fill"==v){A.fill()}else{if("stroke"==v){A.stroke()}else{if("strokewidth"==v){s="1"==y.getAttribute("fixed")?1:q,A.setStrokeWidth(Number(y.getAttribute("width"))*s)}else{if("dashed"==v){A.setDashed("1"==y.getAttribute("dashed"))}else{if("dashpattern"==v){if(y=y.getAttribute("pattern"),null!=y){y=y.split(" ");s=[];for(r=0;r<y.length;r++){0<y[r].length&&s.push(Number(y[r])*q)}y=s.join(" ");A.setDashPattern(y)}}else{"strokecolor"==v?A.setStrokeColor(y.getAttribute("color")):"linecap"==v?A.setLineCap(y.getAttribute("cap")):"linejoin"==v?A.setLineJoin(y.getAttribute("join")):"miterlimit"==v?A.setMiterLimit(Number(y.getAttribute("limit"))):"fillcolor"==v?A.setFillColor(y.getAttribute("color")):"alpha"==v?A.setAlpha(y.getAttribute("alpha")):"fontcolor"==v?A.setFontColor(y.getAttribute("color")):"fontstyle"==v?A.setFontStyle(y.getAttribute("style")):"fontfamily"==v?A.setFontFamily(y.getAttribute("family")):"fontsize"==v&&A.setFontSize(Number(y.getAttribute("size"))*q)}}}}}}}}}}}}}}}}}}}}}w&&("fillstroke"==v||"fill"==v||"stroke"==v)&&A.setShadow(!1)};function mxShape(b){this.stencil=b;this.strokewidth=1;this.rotation=0;this.opacity=100;this.flipV=this.flipH=!1}mxShape.prototype.dialect=null;mxShape.prototype.scale=1;mxShape.prototype.bounds=null;mxShape.prototype.points=null;mxShape.prototype.node=null;mxShape.prototype.state=null;mxShape.prototype.style=null;mxShape.prototype.boundingBox=null;mxShape.prototype.stencil=null;mxShape.prototype.svgStrokeTolerance=6;mxShape.prototype.pointerEvents=!0;mxShape.prototype.stencilPointerEvents=!1;mxShape.prototype.vmlScale=1;mxShape.prototype.init=function(b){null==this.node&&(this.node=this.create(b),null!=b&&b.appendChild(this.node))};mxShape.prototype.isParseVml=function(){return !0};mxShape.prototype.isHtmlAllowed=function(){return !1};mxShape.prototype.getSvgScreenOffset=function(){return 1==mxUtils.mod(Math.max(1,Math.round((this.stencil&&"inherit"!=this.stencil.strokewidth?Number(this.stencil.strokewidth):this.strokewidth)*this.scale)),2)?0.5:0};mxShape.prototype.create=function(d){var c=null;return c=null!=d.ownerSVGElement?this.createSvg(d):8==document.documentMode||this.dialect==mxConstants.DIALECT_SVG||this.dialect!=mxConstants.DIALECT_VML&&this.isHtmlAllowed()?this.createHtml(d):this.createVml(d)};mxShape.prototype.createSvg=function(){return document.createElementNS(mxConstants.NS_SVG,"g")};mxShape.prototype.createVml=function(){var b=document.createElement(mxClient.VML_PREFIX+":group");b.style.position="absolute";return b};mxShape.prototype.createHtml=function(){var b=document.createElement("div");b.style.position="absolute";return b};mxShape.prototype.reconfigure=function(){this.redraw()};mxShape.prototype.redraw=function(){this.updateBoundsFromPoints();this.checkBounds()?(this.clear(),"DIV"==this.node.nodeName&&this.isHtmlAllowed()?this.redrawHtmlShape():this.redrawShape(),this.updateBoundingBox()):(this.node.style.visibility="hidden",this.boundingBox=null)};mxShape.prototype.clear=function(){if(null!=this.node.ownerSVGElement){for(this.node.style.visibility="visible";null!=this.node.lastChild;){this.node.removeChild(this.node.lastChild)}}else{this.node.style.cssText="position:absolute;",this.node.innerHTML=""}};mxShape.prototype.updateBoundsFromPoints=function(){var d=this.points;if(null!=d&&0<d.length&&null!=d[0]){this.bounds=new mxRectangle(Number(d[0].x),Number(d[0].y),1,1);for(var c=1;c<this.points.length;c++){null!=d[c]&&this.bounds.add(new mxRectangle(Number(d[c].x),Number(d[c].y),1,1))}}};mxShape.prototype.getLabelBounds=function(b){return b};mxShape.prototype.checkBounds=function(){return null!=this.bounds&&!isNaN(this.bounds.x)&&!isNaN(this.bounds.y)&&!isNaN(this.bounds.width)&&!isNaN(this.bounds.height)&&0<this.bounds.width&&0<this.bounds.height};mxShape.prototype.createVmlGroup=function(){var b=document.createElement(mxClient.VML_PREFIX+":group");b.style.position="absolute";b.style.width=this.node.style.width;b.style.height=this.node.style.height;return b};mxShape.prototype.redrawShape=function(){var b=this.createCanvas();b.pointerEvents=this.pointerEvents;this.paint(b);this.node!=b.root&&this.node.insertAdjacentHTML("beforeend",b.root.outerHTML);"DIV"==this.node.nodeName&&8==document.documentMode&&(this.node.style.filter="",(null==this.stencil||null!=this.stencil&&!this.stencilPointerEvents)&&mxUtils.addTransparentBackgroundFilter(this.node));this.destroyCanvas(b)};mxShape.prototype.createCanvas=function(){var b=null;null!=this.node.ownerSVGElement?b=this.createSvgCanvas():(this.updateVmlContainer(),b=this.createVmlCanvas(null));return b};mxShape.prototype.createSvgCanvas=function(){var d=new mxSvgCanvas2D(this.node,!1);d.strokeTolerance=this.pointerEvents?this.svgStrokeTolerance:0;d.blockImagePointerEvents=mxClient.IS_FF;var c=this.getSvgScreenOffset();0!=c?this.node.setAttribute("transform","translate("+c+","+c+")"):this.node.removeAttribute("transform");return d};mxShape.prototype.createVmlCanvas=function(){var f=8==document.documentMode&&this.isParseVml()?this.createVmlGroup():this.node,e=new mxVmlCanvas2D(f,!1);if(""!=f.tagUrn){var h=Math.max(1,Math.round(this.bounds.width)),g=Math.max(1,Math.round(this.bounds.height));f.coordsize=h*this.vmlScale+","+g*this.vmlScale;e.scale(this.vmlScale);e.vmlScale=this.vmlScale}f=this.scale;e.translate(-Math.round(this.bounds.x/f),-Math.round(this.bounds.y/f));return e};mxShape.prototype.updateVmlContainer=function(){this.node.style.left=Math.round(this.bounds.x)+"px";this.node.style.top=Math.round(this.bounds.y)+"px";var d=Math.max(1,Math.round(this.bounds.width)),c=Math.max(1,Math.round(this.bounds.height));this.node.style.width=d+"px";this.node.style.height=c+"px";this.node.style.overflow="visible"};mxShape.prototype.destroyCanvas=function(e){if(e instanceof mxSvgCanvas2D){for(var d in e.gradients){var f=e.gradients[d];f.mxRefCount=(f.mxRefCount||0)+1}this.releaseSvgGradients(this.oldGradients);this.oldGradients=e.gradients}};mxShape.prototype.paint=function(i){var h=this.scale,o=this.bounds.x/h,n=this.bounds.y/h,m=this.bounds.width/h,l=this.bounds.height/h;if(this.isPaintBoundsInverted()){var k=(m-l)/2,o=o+k,n=n-k,k=m,m=l,l=k}this.updateTransform(i,o,n,m,l);this.configureCanvas(i,o,n,m,l);if(null!=this.stencil){this.paintStencilShape(i,o,n,m,l)}else{if(i.setStrokeWidth(this.strokewidth),null!=this.points){o=[];for(n=0;n<this.points.length;n++){null!=this.points[n]&&o.push(new mxPoint(this.points[n].x/h,this.points[n].y/h))}this.paintEdgeShape(i,o)}else{this.paintVertexShape(i,o,n,m,l)}}};mxShape.prototype.configureCanvas=function(h,g,m,l,k){var i=null;null!=this.style&&(i=this.style.dashPattern);h.setAlpha(this.opacity/100);null!=this.isShadow&&h.setShadow(this.isShadow);null!=this.isDashed&&h.setDashed(this.isDashed);null!=i&&h.setDashPattern(i);null!=this.gradient?(g=this.getGradientBounds(h,g,m,l,k),h.setGradient(this.fill,this.gradient,g.x,g.y,g.width,g.height,this.gradientDirection)):h.setFillColor(this.fill);h.setStrokeColor(this.stroke)};mxShape.prototype.getGradientBounds=function(g,f,k,i,h){return new mxRectangle(f,k,i,h)};mxShape.prototype.updateTransform=function(g,f,k,i,h){g.scale(this.scale);g.rotate(this.getShapeRotation(),this.flipH,this.flipV,f+i/2,k+h/2)};mxShape.prototype.paintStencilShape=function(g,f,k,i,h){this.stencilPointerEvents&&(this.dialect==mxConstants.DIALECT_SVG?this.addTransparentBackgroundRectangle(this.node,f,k,i,h):8!=document.documentMode&&this.setTransparentBackgroundImage(this.node));this.stencil.drawShape(g,this,f,k,i,h)};mxShape.prototype.paintVertexShape=function(g,f,k,i,h){this.paintBackground(g,f,k,i,h);g.setShadow(!1);this.paintForeground(g,f,k,i,h)};mxShape.prototype.paintBackground=function(g,f,k,i,h){};mxShape.prototype.paintForeground=function(g,f,k,i,h){};mxShape.prototype.paintEdgeShape=function(d,c){};mxShape.prototype.getArcSize=function(e,d){var f=mxUtils.getValue(this.style,mxConstants.STYLE_ARCSIZE,100*mxConstants.RECTANGLE_ROUNDING_FACTOR)/100;return Math.min(e*f,d*f)};mxShape.prototype.paintGlassEffect=function(i,h,o,n,m,l){var k=Math.ceil(this.strokewidth/2);i.setGradient("#ffffff","#ffffff",h,o,n,0.6*m,"south",0.9,0.1);i.begin();l+=2*k;this.isRounded?(i.moveTo(h-k+l,o-k),i.quadTo(h-k,o-k,h-k,o-k+l),i.lineTo(h-k,o+0.4*m),i.quadTo(h+0.5*n,o+0.7*m,h+n+k,o+0.4*m),i.lineTo(h+n+k,o-k+l),i.quadTo(h+n+k,o-k,h+n+k-l,o-k)):(i.moveTo(h-k,o-k),i.lineTo(h-k,o+0.4*m),i.quadTo(h+0.5*n,o+0.7*m,h+n+k,o+0.4*m),i.lineTo(h+n+k,o-k));i.close();i.fill()};mxShape.prototype.apply=function(b){this.state=b;this.style=b.style;if(null!=this.style){this.fill=mxUtils.getValue(this.style,mxConstants.STYLE_FILLCOLOR,this.fill);this.gradient=mxUtils.getValue(this.style,mxConstants.STYLE_GRADIENTCOLOR,this.gradient);this.gradientDirection=mxUtils.getValue(this.style,mxConstants.STYLE_GRADIENT_DIRECTION,this.gradientDirection);this.opacity=mxUtils.getValue(this.style,mxConstants.STYLE_OPACITY,this.opacity);this.stroke=mxUtils.getValue(this.style,mxConstants.STYLE_STROKECOLOR,this.stroke);this.strokewidth=mxUtils.getNumber(this.style,mxConstants.STYLE_STROKEWIDTH,this.strokewidth);this.spacing=mxUtils.getValue(this.style,mxConstants.STYLE_SPACING,this.spacing);this.startSize=mxUtils.getNumber(this.style,mxConstants.STYLE_STARTSIZE,this.startSize);this.endSize=mxUtils.getNumber(this.style,mxConstants.STYLE_ENDSIZE,this.endSize);this.startArrow=mxUtils.getValue(this.style,mxConstants.STYLE_STARTARROW,this.startArrow);this.endArrow=mxUtils.getValue(this.style,mxConstants.STYLE_ENDARROW,this.endArrow);this.rotation=mxUtils.getValue(this.style,mxConstants.STYLE_ROTATION,this.rotation);this.direction=mxUtils.getValue(this.style,mxConstants.STYLE_DIRECTION,this.direction);this.flipH=1==mxUtils.getValue(this.style,mxConstants.STYLE_FLIPH,0);this.flipV=1==mxUtils.getValue(this.style,mxConstants.STYLE_FLIPV,0);null!=this.stencil&&(this.flipH=1==mxUtils.getValue(this.style,"stencilFlipH",0)||this.flipH,this.flipV=1==mxUtils.getValue(this.style,"stencilFlipV",0)||this.flipV);if(this.direction==mxConstants.DIRECTION_NORTH||this.direction==mxConstants.DIRECTION_SOUTH){b=this.flipH,this.flipH=this.flipV,this.flipV=b}this.isShadow=1==mxUtils.getValue(this.style,mxConstants.STYLE_SHADOW,this.isShadow);this.isDashed=1==mxUtils.getValue(this.style,mxConstants.STYLE_DASHED,this.isDashed);this.isRounded=1==mxUtils.getValue(this.style,mxConstants.STYLE_ROUNDED,this.isRounded);this.glass=1==mxUtils.getValue(this.style,mxConstants.STYLE_GLASS,this.glass);"none"==this.fill&&(this.fill=null);"none"==this.gradient&&(this.gradient=null);"none"==this.stroke&&(this.stroke=null)}};mxShape.prototype.setCursor=function(b){null==b&&(b="");this.cursor=b;null!=this.node&&(this.node.style.cursor=b)};mxShape.prototype.getCursor=function(){return this.cursor};mxShape.prototype.updateBoundingBox=function(){if(null!=this.bounds){var d=this.createBoundingBox();if(null!=d){this.augmentBoundingBox(d);var c=this.getShapeRotation();0!=c&&(d=mxUtils.getBoundingBox(d,c));d.x=Math.floor(d.x);d.y=Math.floor(d.y);d.width=Math.ceil(d.width);d.height=Math.ceil(d.height)}this.boundingBox=d}};mxShape.prototype.createBoundingBox=function(){var d=this.bounds.clone();if(null!=this.stencil&&(this.direction==mxConstants.DIRECTION_NORTH||this.direction==mxConstants.DIRECTION_SOUTH)||this.isPaintBoundsInverted()){var c=(d.width-d.height)/2;d.x+=c;d.y-=c;c=d.width;d.width=d.height;d.height=c}return d};mxShape.prototype.augmentBoundingBox=function(d){this.isShadow&&(d.width+=Math.ceil(mxConstants.SHADOW_OFFSET_X*this.scale),d.height+=Math.ceil(mxConstants.SHADOW_OFFSET_Y*this.scale));var c=Math.ceil(this.strokewidth*this.scale);d.grow(Math.ceil(c/2))};mxShape.prototype.isPaintBoundsInverted=function(){return null==this.stencil&&(this.direction==mxConstants.DIRECTION_NORTH||this.direction==mxConstants.DIRECTION_SOUTH)};mxShape.prototype.getRotation=function(){return null!=this.rotation?this.rotation:0};mxShape.prototype.getTextRotation=function(){var b=this.getRotation();1!=mxUtils.getValue(this.style,mxConstants.STYLE_HORIZONTAL,1)&&(b+=mxText.prototype.verticalTextRotation);return b};mxShape.prototype.getShapeRotation=function(){var b=this.getRotation();null!=this.direction&&(this.direction==mxConstants.DIRECTION_NORTH?b+=270:this.direction==mxConstants.DIRECTION_WEST?b+=180:this.direction==mxConstants.DIRECTION_SOUTH&&(b+=90));return b};mxShape.prototype.addTransparentBackgroundRectangle=function(g,f,k,i,h){g=document.createElementNS(mxConstants.NS_SVG,"rect");g.setAttribute("x",f);g.setAttribute("y",k);g.setAttribute("width",i);g.setAttribute("height",h);g.setAttribute("fill","none");g.setAttribute("stroke","none");g.setAttribute("pointer-events","all");this.node.appendChild(g)};mxShape.prototype.setTransparentBackgroundImage=function(b){b.style.backgroundImage="url('"+mxClient.imageBasePath+"/transparent.gif')"};mxShape.prototype.releaseSvgGradients=function(e){if(null!=e){for(var d in e){var f=e[d];f.mxRefCount=(f.mxRefCount||0)-1;0==f.mxRefCount&&null!=f.parentNode&&f.parentNode.removeChild(f)}}};mxShape.prototype.destroy=function(){null!=this.node&&(mxEvent.release(this.node),null!=this.node.parentNode&&this.node.parentNode.removeChild(this.node),this.node=null);this.releaseSvgGradients(this.oldGradients);this.oldGradients=null};var mxStencilRegistry={stencils:[],addStencil:function(d,c){mxStencilRegistry.stencils[d]=c},getStencil:function(b){return mxStencilRegistry.stencils[b]}},mxMarker={markers:[],addMarker:function(d,c){mxMarker.markers[d]=c},createMarker:function(w,v,u,t,s,r,q,p,o,n){var i=mxMarker.markers[u];return null!=i?i(w,v,u,t,s,r,q,p,o,n):null}};(function(){function d(y,x,w,v,u,t,s,r,q,o){x=1.118*u*q;r=1.118*t*q;u*=s+q;t*=s+q;var i=v.clone();i.x-=x;i.y-=r;s=w!=mxConstants.ARROW_CLASSIC?1:0.75;v.x+=-u*s-x;v.y+=-t*s-r;return function(){y.begin();y.moveTo(i.x,i.y);y.lineTo(i.x-u-t/2,i.y-t+u/2);w==mxConstants.ARROW_CLASSIC&&y.lineTo(i.x-3*u/4,i.y-3*t/4);y.lineTo(i.x+t/2-u,i.y-t-u/2);y.close();o?y.fillAndStroke():y.stroke()}}function c(A,z,y,x,w,v,u,t,s,r){t=y==mxConstants.ARROW_DIAMOND?0.7071:0.9862;z=w*s*t;t*=v*s;w*=u+s;v*=u+s;var o=x.clone();o.x-=z;o.y-=t;x.x+=-w-z;x.y+=-v-t;var i=y==mxConstants.ARROW_DIAMOND?2:3.4;return function(){A.begin();A.moveTo(o.x,o.y);A.lineTo(o.x-w/2-v/i,o.y+w/i-v/2);A.lineTo(o.x-w,o.y-v);A.lineTo(o.x-w/2+v/i,o.y-v/2-w/i);A.close();r?A.fillAndStroke():A.stroke()}}mxMarker.addMarker("classic",d);mxMarker.addMarker("block",d);mxMarker.addMarker("open",function(y,x,w,v,u,t,s,r,q,o){x=1.118*u*q;w=1.118*t*q;u*=s+q;t*=s+q;var i=v.clone();i.x-=x;i.y-=w;v.x+=2*-x;v.y+=2*-w;return function(){y.begin();y.moveTo(i.x-u-t/2,i.y-t+u/2);y.lineTo(i.x,i.y);y.lineTo(i.x+t/2-u,i.y-t-u/2);y.stroke()}});mxMarker.addMarker("oval",function(A,z,y,x,w,v,u,t,s,r){var o=u/2,i=x.clone();x.x-=w*o;x.y-=v*o;return function(){A.ellipse(i.x-o,i.y-o,u,u);r?A.fillAndStroke():A.stroke()}});mxMarker.addMarker("diamond",c);mxMarker.addMarker("diamondThin",c)})();function mxActor(f,e,h,g){mxShape.call(this);this.bounds=f;this.fill=e;this.stroke=h;this.strokewidth=null!=g?g:1}mxUtils.extend(mxActor,mxShape);mxActor.prototype.paintVertexShape=function(g,f,k,i,h){g.translate(f,k);g.begin();this.redrawPath(g,f,k,i,h);g.fillAndStroke()};mxActor.prototype.redrawPath=function(g,f,k,i,h){f=i/3;g.moveTo(0,h);g.curveTo(0,3*h/5,0,2*h/5,i/2,2*h/5);g.curveTo(i/2-f,2*h/5,i/2-f,0,i/2,0);g.curveTo(i/2+f,0,i/2+f,2*h/5,i/2,2*h/5);g.curveTo(i,2*h/5,i,3*h/5,i,h);g.close()};function mxCloud(f,e,h,g){mxActor.call(this);this.bounds=f;this.fill=e;this.stroke=h;this.strokewidth=null!=g?g:1}mxUtils.extend(mxCloud,mxActor);mxCloud.prototype.redrawPath=function(g,f,k,i,h){g.moveTo(0.25*i,0.25*h);g.curveTo(0.05*i,0.25*h,0,0.5*h,0.16*i,0.55*h);g.curveTo(0,0.66*h,0.18*i,0.9*h,0.31*i,0.8*h);g.curveTo(0.4*i,h,0.7*i,h,0.8*i,0.8*h);g.curveTo(i,0.8*h,i,0.6*h,0.875*i,0.5*h);g.curveTo(i,0.3*h,0.8*i,0.1*h,0.625*i,0.2*h);g.curveTo(0.5*i,0.05*h,0.3*i,0.05*h,0.25*i,0.25*h);g.close()};function mxRectangleShape(f,e,h,g){mxShape.call(this);this.bounds=f;this.fill=e;this.stroke=h;this.strokewidth=null!=g?g:1}mxUtils.extend(mxRectangleShape,mxShape);mxRectangleShape.prototype.isHtmlAllowed=function(){return !this.isRounded&&!this.glass&&0==this.rotation};mxRectangleShape.prototype.paintBackground=function(h,g,m,l,k){if(this.isRounded){var i=mxUtils.getValue(this.style,mxConstants.STYLE_ARCSIZE,100*mxConstants.RECTANGLE_ROUNDING_FACTOR)/100,i=Math.min(l*i,k*i);h.roundrect(g,m,l,k,i,i)}else{h.rect(g,m,l,k)}h.fillAndStroke()};mxRectangleShape.prototype.paintForeground=function(g,f,k,i,h){this.glass&&this.paintGlassEffect(g,f,k,i,h,this.getArcSize(i+this.strokewidth,h+this.strokewidth))};mxRectangleShape.prototype.redrawHtmlShape=function(){this.updateHtmlBounds(this.node);this.updateHtmlFilters(this.node);this.updateHtmlColors(this.node)};mxRectangleShape.prototype.updateHtmlBounds=function(d){var c=9<=document.documentMode?0:Math.ceil(this.strokewidth*this.scale);d.style.borderWidth=Math.max(1,c)+"px";d.style.overflow="hidden";d.style.left=Math.round(this.bounds.x-c/2)+"px";d.style.top=Math.round(this.bounds.y-c/2)+"px";"CSS1Compat"==document.compatMode&&(c=-c);d.style.width=Math.round(Math.max(0,this.bounds.width+c))+"px";d.style.height=Math.round(Math.max(0,this.bounds.height+c))+"px"};mxRectangleShape.prototype.updateHtmlColors=function(d){var c=this.stroke;null!=c&&c!=mxConstants.NONE?(d.style.borderColor=c,this.isDashed?d.style.borderStyle="dashed":0<this.strokewidth&&(d.style.borderStyle="solid"),d.style.borderWidth=Math.max(1,Math.ceil(this.strokewidth*this.scale))+"px"):d.style.borderWidth="0px";c=this.fill;null!=c&&c!=mxConstants.NONE?(d.style.backgroundColor=c,d.style.backgroundImage="none"):this.pointerEvents?d.style.backgroundColor="transparent":8==document.documentMode?mxUtils.addTransparentBackgroundFilter(d):this.setTransparentBackgroundImage(d)};mxRectangleShape.prototype.updateHtmlFilters=function(i){var h="";100>this.opacity&&(h+="alpha(opacity="+this.opacity+")");this.isShadow&&(h+="progid:DXImageTransform.Microsoft.dropShadow (OffX='"+Math.round(mxConstants.SHADOW_OFFSET_X*this.scale)+"', OffY='"+Math.round(mxConstants.SHADOW_OFFSET_Y*this.scale)+"', Color='"+mxConstants.SHADOWCOLOR+"')");if(this.gradient){var o=this.fill,n=this.gradient,m="0",l={east:0,south:1,west:2,north:3},k=null!=this.direction?l[this.direction]:0;null!=this.gradientDirection&&(k=mxUtils.mod(k+l[this.gradientDirection]-1,4));1==k?(m="1",l=o,o=n,n=l):2==k?(l=o,o=n,n=l):3==k&&(m="1");h+="progid:DXImageTransform.Microsoft.gradient(startColorStr='"+o+"', endColorStr='"+n+"', gradientType='"+m+"')"}i.style.filter=h};function mxEllipse(f,e,h,g){mxShape.call(this);this.bounds=f;this.fill=e;this.stroke=h;this.strokewidth=null!=g?g:1}mxUtils.extend(mxEllipse,mxShape);mxEllipse.prototype.paintVertexShape=function(g,f,k,i,h){g.ellipse(f,k,i,h);g.fillAndStroke()};function mxDoubleEllipse(f,e,h,g){mxShape.call(this);this.bounds=f;this.fill=e;this.stroke=h;this.strokewidth=null!=g?g:1}mxUtils.extend(mxDoubleEllipse,mxShape);mxDoubleEllipse.prototype.vmlScale=10;mxDoubleEllipse.prototype.paintBackground=function(g,f,k,i,h){g.ellipse(f,k,i,h);g.fillAndStroke()};mxDoubleEllipse.prototype.paintForeground=function(h,g,m,l,k){var i=mxUtils.getValue(this.style,mxConstants.STYLE_MARGIN,Math.min(3+this.strokewidth,Math.min(l/5,k/5)));l-=2*i;k-=2*i;0<l&&0<k&&h.ellipse(g+i,m+i,l,k);h.stroke()};function mxRhombus(f,e,h,g){mxShape.call(this);this.bounds=f;this.fill=e;this.stroke=h;this.strokewidth=null!=g?g:1}mxUtils.extend(mxRhombus,mxShape);mxRhombus.prototype.paintVertexShape=function(i,h,o,n,m){var l=n/2,k=m/2;i.begin();i.moveTo(h+l,o);i.lineTo(h+n,o+k);i.lineTo(h+l,o+m);i.lineTo(h,o+k);i.close();i.fillAndStroke()};function mxPolyline(e,d,f){mxShape.call(this);this.points=e;this.stroke=d;this.strokewidth=null!=f?f:1}mxUtils.extend(mxPolyline,mxShape);mxPolyline.prototype.getRotation=function(){return 0};mxPolyline.prototype.getShapeRotation=function(){return 0};mxPolyline.prototype.isPaintBoundsInverted=function(){return !1};mxPolyline.prototype.paintEdgeShape=function(d,c){this.paintLine(d,c,this.isRounded)};mxPolyline.prototype.paintLine=function(u,t,s){var r=mxUtils.getValue(this.style,mxConstants.STYLE_ARCSIZE,mxConstants.LINE_ARCSIZE)/2,q=t[0],p=t[t.length-1];u.begin();u.moveTo(q.x,q.y);for(var o=1;o<t.length-1;o++){var n=t[o],m=q.x-n.x,q=q.y-n.y;if(s&&o<t.length-1&&(0!=m||0!=q)){var i=Math.sqrt(m*m+q*q),m=m*Math.min(r,i/2)/i,q=q*Math.min(r,i/2)/i;u.lineTo(n.x+m,n.y+q);for(q=t[o+1];o<t.length-2&&0==Math.round(q.x-n.x)&&0==Math.round(q.y-n.y);){q=t[o+2],o++}m=q.x-n.x;q=q.y-n.y;i=Math.max(1,Math.sqrt(m*m+q*q));m=m*Math.min(r,i/2)/i;q=q*Math.min(r,i/2)/i;m=n.x+m;q=n.y+q;u.quadTo(n.x,n.y,m,q);n=new mxPoint(m,q)}else{u.lineTo(n.x,n.y)}q=n}u.lineTo(p.x,p.y);u.stroke()};function mxArrow(i,h,o,n,m,l,k){mxShape.call(this);this.points=i;this.fill=h;this.stroke=o;this.strokewidth=null!=n?n:1;this.arrowWidth=null!=m?m:mxConstants.ARROW_WIDTH;this.spacing=null!=l?l:mxConstants.ARROW_SPACING;this.endSize=null!=k?k:mxConstants.ARROW_SIZE}mxUtils.extend(mxArrow,mxShape);mxArrow.prototype.paintEdgeShape=function(K,J){var I=mxConstants.ARROW_SPACING,H=mxConstants.ARROW_WIDTH,G=mxConstants.ARROW_SIZE,F=J[0],E=J[J.length-1],D=E.x-F.x,C=E.y-F.y,B=Math.sqrt(D*D+C*C),A=B-2*I-G,D=D/B,C=C/B,B=H*C/3,H=-H*D/3,G=F.x-B/2+I*D,F=F.y-H/2+I*C,z=G+B,y=F+H,x=z+A*D,A=y+A*C,v=x+B,w=A+H,o=v-3*B,i=w-3*H;K.begin();K.moveTo(G,F);K.lineTo(z,y);K.lineTo(x,A);K.lineTo(v,w);K.lineTo(E.x-I*D,E.y-I*C);K.lineTo(o,i);K.lineTo(o+B,i+H);K.close();K.fillAndStroke()};function mxText(O,N,M,L,K,J,I,H,G,F,E,D,C,B,z,A,y,x,o,i){mxShape.call(this);this.value=O;this.bounds=N;this.color=null!=K?K:"black";this.align=null!=M?M:"";this.valign=null!=L?L:"";this.family=null!=J?J:mxConstants.DEFAULT_FONTFAMILY;this.size=null!=I?I:mxConstants.DEFAULT_FONTSIZE;this.fontStyle=null!=H?H:mxConstants.DEFAULT_FONTSTYLE;this.spacing=parseInt(G||2);this.spacingTop=this.spacing+parseInt(F||0);this.spacingRight=this.spacing+parseInt(E||0);this.spacingBottom=this.spacing+parseInt(D||0);this.spacingLeft=this.spacing+parseInt(C||0);this.horizontal=null!=B?B:!0;this.background=z;this.border=A;this.wrap=null!=y?y:!1;this.clipped=null!=x?x:!1;this.overflow=null!=o?o:"visible";this.labelPadding=null!=i?i:0;this.rotation=0;this.updateMargin()}mxUtils.extend(mxText,mxShape);mxText.prototype.baseSpacingTop=0;mxText.prototype.baseSpacingBottom=0;mxText.prototype.baseSpacingLeft=0;mxText.prototype.baseSpacingRight=0;mxText.prototype.replaceLinefeeds=!0;mxText.prototype.verticalTextRotation=-90;mxText.prototype.ignoreClippedStringSize=!0;mxText.prototype.ignoreStringSize=!1;mxText.prototype.isParseVml=function(){return !1};mxText.prototype.isHtmlAllowed=function(){return 8!=document.documentMode};mxText.prototype.getSvgScreenOffset=function(){return 0};mxText.prototype.checkBounds=function(){return null!=this.bounds&&!isNaN(this.bounds.x)&&!isNaN(this.bounds.y)&&!isNaN(this.bounds.width)&&!isNaN(this.bounds.height)};mxText.prototype.apply=function(b){mxShape.prototype.apply.apply(this,arguments);null!=this.style&&(this.fontStyle=mxUtils.getValue(this.style,mxConstants.STYLE_FONTSTYLE,this.fontStyle),this.family=mxUtils.getValue(this.style,mxConstants.STYLE_FONTFAMILY,this.family),this.size=mxUtils.getValue(this.style,mxConstants.STYLE_FONTSIZE,this.size),this.color=mxUtils.getValue(this.style,mxConstants.STYLE_FONTCOLOR,this.color),this.align=mxUtils.getValue(this.style,mxConstants.STYLE_ALIGN,this.align),this.valign=mxUtils.getValue(this.style,mxConstants.STYLE_VERTICAL_ALIGN,this.valign),this.spacingTop=mxUtils.getValue(this.style,mxConstants.STYLE_SPACING_TOP,this.spacingTop),this.spacingRight=mxUtils.getValue(this.style,mxConstants.STYLE_SPACING_RIGHT,this.spacingRight),this.spacingBottom=mxUtils.getValue(this.style,mxConstants.STYLE_SPACING_BOTTOM,this.spacingBottom),this.spacingLeft=mxUtils.getValue(this.style,mxConstants.STYLE_SPACING_LEFT,this.spacingLeft),this.horizontal=mxUtils.getValue(this.style,mxConstants.STYLE_HORIZONTAL,this.horizontal),this.background=mxUtils.getValue(this.style,mxConstants.STYLE_LABEL_BACKGROUNDCOLOR,this.background),this.border=mxUtils.getValue(this.style,mxConstants.STYLE_LABEL_BORDERCOLOR,this.border),this.updateMargin())};mxText.prototype.updateBoundingBox=function(){var h=this.node;8==document.documentMode&&null!=h.firstChild&&(h=h.firstChild,null!=h.firstChild&&(h=h.firstChild));this.boundingBox=this.bounds.clone();var g=this.getTextRotation();if(!this.ignoreStringSize&&null!=h&&"fill"!=this.overflow&&(!this.clipped||!this.ignoreClippedStringSize)){var m=null,l=null;if(null!=h.ownerSVGElement){if(null!=h.firstChild&&null!=h.firstChild.firstChild&&"foreignObject"==h.firstChild.firstChild.nodeName){h=h.firstChild.firstChild,m=this.wrap?this.bounds.width:parseInt(h.getAttribute("width"))*this.scale,l=parseInt(h.getAttribute("height"))*this.scale}else{try{var k=h.getBBox();if(0==k.width&&0==k.height){return}this.boundingBox=new mxRectangle(k.x,k.y,k.width,k.height);g=0}catch(i){}}}else{l=null!=this.state?this.state.view.textDiv:null,null!=this.offsetWidth&&null!=this.offsetHeight?(m=this.wrap?this.bounds.width:this.offsetWidth*this.scale,l=this.offsetHeight*this.scale):null!=l?(this.updateFont(l),this.updateSize(l),mxUtils.isNode(this.value)?l.innerHTML=this.value.outerHTML:(h=this.replaceLinefeeds?this.value.replace(/\n/g,"<br/>"):this.value,l.innerHTML=h),m=this.wrap?this.bounds.width:l.offsetWidth*this.scale,l=l.offsetHeight*this.scale):(m=this.wrap?this.bounds.width:h.offsetWidth*this.scale,l=h.offsetHeight*this.scale)}null!=m&&null!=l&&(this.boundingBox=new mxRectangle(this.bounds.x+this.margin.x*m,this.bounds.y+this.margin.y*l,m,l))}else{this.boundingBox.x+=this.margin.x*this.boundingBox.width,this.boundingBox.y+=this.margin.y*this.boundingBox.height}null!=this.boundingBox&&(0!=g&&(g=mxUtils.getBoundingBox(this.boundingBox,g),this.boundingBox.x=g.x,this.boundingBox.y=g.y,mxClient.IS_QUIRKS||(this.boundingBox.width=g.width,this.boundingBox.height=g.height)),this.boundingBox.x=Math.floor(this.boundingBox.x),this.boundingBox.y=Math.floor(this.boundingBox.y),this.boundingBox.width=Math.ceil(this.boundingBox.width),this.boundingBox.height=Math.ceil(this.boundingBox.height))};mxText.prototype.getShapeRotation=function(){return 0};mxText.prototype.getTextRotation=function(){return null!=this.state&&null!=this.state.shape?this.state.shape.getTextRotation():0};mxText.prototype.isPaintBoundsInverted=function(){return !this.horizontal&&null!=this.state&&this.state.view.graph.model.isVertex(this.state.cell)};mxText.prototype.configureCanvas=function(g,f,k,i,h){mxShape.prototype.configureCanvas.apply(this,arguments);g.setFontColor(this.color);g.setFontBackgroundColor(this.background);g.setFontBorderColor(this.border);g.setFontFamily(this.family);g.setFontSize(this.size);g.setFontStyle(this.fontStyle)};mxText.prototype.updateVmlContainer=function(){this.node.style.left=Math.round(this.bounds.x)+"px";this.node.style.top=Math.round(this.bounds.y)+"px";this.node.style.width="1px";this.node.style.height="1px";this.node.style.overflow="visible"};mxText.prototype.paint=function(k){var i=this.scale,q=this.bounds.x/i,p=this.bounds.y/i,o=this.bounds.width/i,i=this.bounds.height/i;this.updateTransform(k,q,p,o,i);this.configureCanvas(k,q,p,o,i);var n=mxUtils.isNode(this.value)||this.dialect==mxConstants.DIALECT_STRICTHTML,m=n||k instanceof mxVmlCanvas2D?"html":"",l=this.value;!n&&"html"==m&&(l=mxUtils.htmlEntities(l,!1));l=!mxUtils.isNode(this.value)&&this.replaceLinefeeds&&"html"==m?l.replace(/\n/g,"<br/>"):l;k.text(q,p,o,i,l,this.align,this.valign,this.wrap,m,this.overflow,this.clipped,this.getTextRotation())};mxText.prototype.redrawHtmlShape=function(){var b=this.node.style;b.opacity=1>this.opacity?this.opacity:"";b.whiteSpace="normal";b.overflow="";b.width="";b.height="";this.updateValue();this.updateFont(this.node);this.updateSize(this.node);this.offsetHeight=this.offsetWidth=null;mxClient.IS_IE&&(null==document.documentMode||8>=document.documentMode)?this.updateHtmlFilter():this.updateHtmlTransform()};mxText.prototype.updateHtmlTransform=function(){var f=this.getTextRotation(),e=this.node.style,h=this.margin.x,g=this.margin.y;0!=f?(mxUtils.setPrefixedStyle(e,"transformOrigin",100*-h+"% "+100*-g+"%"),mxUtils.setPrefixedStyle(e,"transform","translate("+100*h+"%,"+100*g+"%)scale("+this.scale+") rotate("+f+"deg)")):(mxUtils.setPrefixedStyle(e,"transformOrigin","0% 0%"),mxUtils.setPrefixedStyle(e,"transform","scale("+this.scale+")translate("+100*h+"%,"+100*g+"%)"));e.left=Math.round(this.bounds.x)+"px";e.top=Math.round(this.bounds.y)+"px"};mxText.prototype.updateHtmlFilter=function(){var y=this.node.style,x=this.margin.x,w=this.margin.y,v=this.scale;y.filter="";var u=0,t=0,s=null!=this.state?this.state.view.textDiv:null;if(null!=s){s.style.overflow="";s.style.height="";s.style.width="";this.updateFont(s);this.updateSize(s);if(mxUtils.isNode(this.value)){s.innerHTML=this.value.outerHTML}else{var r=this.value;this.dialect!=mxConstants.DIALECT_STRICTHTML&&(r=mxUtils.htmlEntities(r,!1));r=this.replaceLinefeeds?r.replace(/\n/g,"<br/>"):r;s.innerHTML=r}u=s.offsetWidth+2;t=s.offsetHeight+2}else{u=this.node.offsetWidth,t=this.node.offsetHeight+1}this.offsetWidth=u;this.offsetHeight=t;s=this.bounds.width/v;r=this.bounds.height/v;mxClient.IS_QUIRKS&&(this.clipped||"width"==this.overflow)&&0<r?(r=Math.min(r,t),y.height=Math.round(r)+"px"):r=t;"fill"!=this.overflow&&"width"!=this.overflow&&(mxClient.IS_QUIRKS&&this.clipped&&0<s?(s=Math.min(s,u),y.width=Math.round(s)+"px"):(s=u,this.wrap&&!this.clipped&&(y.width=Math.round(s)+"px")));var r=r*v,s=s*v,u=this.getTextRotation()*(Math.PI/180),t=parseFloat(parseFloat(Math.cos(u)).toFixed(8)),q=parseFloat(parseFloat(Math.sin(-u)).toFixed(8)),u=u%(2*Math.PI);0>u&&(u+=2*Math.PI);u%=Math.PI;u>Math.PI/2&&(u=Math.PI-u);var p=Math.cos(u),o=Math.sin(-u),x=s*-(x+0.5),w=r*-(w+0.5),i=(r-r*p+s*o)/2+q*x-t*w;0!=u&&(y.filter="progid:DXImageTransform.Microsoft.Matrix(M11="+t+", M12="+q+", M21="+-q+", M22="+t+", sizingMethod='auto expand')");y.zoom=v;y.left=Math.round(this.bounds.x+((s-s*p+r*o)/2-t*x-q*w)-s/2)+"px";y.top=Math.round(this.bounds.y+i-r/2)+"px"};mxText.prototype.updateValue=function(){if(mxUtils.isNode(this.value)){this.node.innerHTML="",this.node.appendChild(this.value)}else{var f=this.value;this.dialect!=mxConstants.DIALECT_STRICTHTML&&(f=mxUtils.htmlEntities(f,!1));var f=this.replaceLinefeeds?f.replace(/\n/g,"<br/>"):f,e=null!=this.background&&this.background!=mxConstants.NONE?this.background:null,h=null!=this.border&&this.border!=mxConstants.NONE?this.border:null;if(null!=e||null!=h){if("fill"==this.overflow||"width"==this.overflow){null!=e&&(this.node.style.backgroundColor=e),null!=h&&(this.node.style.border="1px solid "+h)}else{var g="";null!=e&&(g+="background-color:"+e+";");null!=h&&(g+="border:1px solid "+h+";");f='<div style="zoom:1;'+g+"display:inline-block;_display:inline;text-decoration:inherit;padding-bottom:1px;padding-right:1px;line-height:"+this.node.style.lineHeight+'">'+f+"</div>";this.node.style.lineHeight=""}}this.node.innerHTML=f}};mxText.prototype.updateFont=function(b){b=b.style;b.lineHeight=Math.round(this.size*mxConstants.LINE_HEIGHT)+"px";b.fontSize=Math.round(this.size)+"px";b.fontFamily=this.family;b.verticalAlign="top";b.color=this.color;b.fontWeight=(this.fontStyle&mxConstants.FONT_BOLD)==mxConstants.FONT_BOLD?"bold":"";b.fontStyle=(this.fontStyle&mxConstants.FONT_ITALIC)==mxConstants.FONT_ITALIC?"italic":"";b.textDecoration=(this.fontStyle&mxConstants.FONT_UNDERLINE)==mxConstants.FONT_UNDERLINE?"underline":"";b.textAlign=this.align==mxConstants.ALIGN_CENTER?"center":this.align==mxConstants.ALIGN_RIGHT?"right":"left"};mxText.prototype.updateSize=function(f){var e=Math.round(this.bounds.width/this.scale),h=Math.round(this.bounds.height/this.scale),g=f.style;this.clipped?(g.overflow="hidden",0<h&&(g.maxHeight=h+"px"),0<e&&(g.width=e+"px")):"fill"==this.overflow?(g.width=e+"px",g.height=h+"px"):"width"==this.overflow&&(g.width=e+"px",0<h&&(g.maxHeight=h+"px"));this.wrap&&0<e?(this.clipped||(g.width=e+"px",g.width=Math.max(e,f.scrollWidth+(mxClient.IS_QUIRKS?2:0))+"px"),g.whiteSpace="normal"):g.whiteSpace="nowrap"};mxText.prototype.updateMargin=function(){this.margin=mxUtils.getAlignmentAsPoint(this.align,this.valign)};mxText.prototype.getSpacing=function(){var d=0,c=0,d=this.align==mxConstants.ALIGN_CENTER?(this.spacingLeft-this.spacingRight)/2:this.align==mxConstants.ALIGN_RIGHT?-this.spacingRight-this.baseSpacingRight:this.spacingLeft+this.baseSpacingLeft,c=this.valign==mxConstants.ALIGN_MIDDLE?(this.spacingTop-this.spacingBottom)/2:this.valign==mxConstants.ALIGN_BOTTOM?-this.spacingBottom-this.baseSpacingBottom:this.spacingTop+this.baseSpacingTop;return new mxPoint(d,c)};function mxTriangle(){mxActor.call(this)}mxUtils.extend(mxTriangle,mxActor);mxTriangle.prototype.redrawPath=function(g,f,k,i,h){g.moveTo(0,0);g.lineTo(i,0.5*h);g.lineTo(0,h);g.close()};function mxHexagon(){mxActor.call(this)}mxUtils.extend(mxHexagon,mxActor);mxHexagon.prototype.redrawPath=function(g,f,k,i,h){g.moveTo(0.25*i,0);g.lineTo(0.75*i,0);g.lineTo(i,0.5*h);g.lineTo(0.75*i,h);g.lineTo(0.25*i,h);g.lineTo(0,0.5*h);g.close()};function mxLine(e,d,f){mxShape.call(this);this.bounds=e;this.stroke=d;this.strokewidth=null!=f?f:1}mxUtils.extend(mxLine,mxShape);mxLine.prototype.paintVertexShape=function(g,f,k,i,h){k+=h/2;g.begin();g.moveTo(f,k);g.lineTo(f+i,k);g.stroke()};function mxImageShape(g,f,k,i,h){mxShape.call(this);this.bounds=g;this.image=f;this.fill=k;this.stroke=i;this.strokewidth=null!=h?h:1;this.shadow=!1}mxUtils.extend(mxImageShape,mxRectangleShape);mxImageShape.prototype.preserveImageAspect=!0;mxImageShape.prototype.getSvgScreenOffset=function(){return !mxClient.IS_IE?0.5:0};mxImageShape.prototype.apply=function(b){mxShape.prototype.apply.apply(this,arguments);this.gradient=this.stroke=this.fill=null;null!=this.style&&(this.preserveImageAspect=1==mxUtils.getNumber(this.style,mxConstants.STYLE_IMAGE_ASPECT,1),this.flipH=this.flipH||1==mxUtils.getValue(this.style,"imageFlipH",0),this.flipV=this.flipV||1==mxUtils.getValue(this.style,"imageFlipV",0))};mxImageShape.prototype.isHtmlAllowed=function(){return !this.preserveImageAspect};mxImageShape.prototype.createHtml=function(){var b=document.createElement("div");b.style.position="absolute";return b};mxImageShape.prototype.paintVertexShape=function(i,h,o,n,m){if(null!=this.image){var l=mxUtils.getValue(this.style,mxConstants.STYLE_IMAGE_BACKGROUND,null),k=mxUtils.getValue(this.style,mxConstants.STYLE_IMAGE_BORDER,null);if(null!=l||null!=k){i.setFillColor(l),i.setStrokeColor(k),i.rect(h,o,n,m),i.fillAndStroke()}i.image(h,o,n,m,this.image,this.preserveImageAspect,!1,!1)}else{mxRectangleShape.prototype.paintBackground.apply(this,arguments)}};mxImageShape.prototype.redrawHtmlShape=function(){this.node.style.left=Math.round(this.bounds.x)+"px";this.node.style.top=Math.round(this.bounds.y)+"px";this.node.style.width=Math.max(0,Math.round(this.bounds.width))+"px";this.node.style.height=Math.max(0,Math.round(this.bounds.height))+"px";this.node.innerHTML="";if(null!=this.image){var d=mxUtils.getValue(this.style,mxConstants.STYLE_IMAGE_BACKGROUND,""),c=mxUtils.getValue(this.style,mxConstants.STYLE_IMAGE_BORDER,"");this.node.style.backgroundColor=d;this.node.style.borderColor=c;d=document.createElement(mxClient.IS_IE6||(null==document.documentMode||8>=document.documentMode)&&0!=this.rotation?mxClient.VML_PREFIX+":image":"img");d.style.position="absolute";d.src=this.image;c=100>this.opacity?"alpha(opacity="+this.opacity+")":"";this.node.style.filter=c;this.flipH&&this.flipV?c+="progid:DXImageTransform.Microsoft.BasicImage(rotation=2)":this.flipH?c+="progid:DXImageTransform.Microsoft.BasicImage(mirror=1)":this.flipV&&(c+="progid:DXImageTransform.Microsoft.BasicImage(rotation=2, mirror=1)");d.style.filter!=c&&(d.style.filter=c);"image"==d.nodeName?d.style.rotation=this.rotation:0!=this.rotation?mxUtils.setPrefixedStyle(d.style,"transform","rotate("+this.rotation+"deg)"):mxUtils.setPrefixedStyle(d.style,"transform","");d.style.width=this.node.style.width;d.style.height=this.node.style.height;this.node.style.backgroundImage="";this.node.appendChild(d)}else{this.setTransparentBackgroundImage(this.node)}};function mxLabel(f,e,h,g){mxRectangleShape.call(this,f,e,h,g)}mxUtils.extend(mxLabel,mxRectangleShape);mxLabel.prototype.imageSize=mxConstants.DEFAULT_IMAGESIZE;mxLabel.prototype.spacing=2;mxLabel.prototype.indicatorSize=10;mxLabel.prototype.indicatorSpacing=2;mxLabel.prototype.init=function(b){mxShape.prototype.init.apply(this,arguments);null!=this.indicatorShape&&(this.indicator=new this.indicatorShape,this.indicator.dialect=this.dialect,this.indicator.init(this.node))};mxLabel.prototype.redraw=function(){null!=this.indicator&&(this.indicator.fill=this.indicatorColor,this.indicator.stroke=this.indicatorColor,this.indicator.gradient=this.indicatorGradientColor,this.indicator.direction=this.indicatorDirection);mxShape.prototype.redraw.apply(this,arguments)};mxLabel.prototype.isHtmlAllowed=function(){return mxRectangleShape.prototype.isHtmlAllowed.apply(this,arguments)&&null==this.indicatorColor&&null==this.indicatorShape};mxLabel.prototype.paintForeground=function(g,f,k,i,h){this.paintImage(g,f,k,i,h);this.paintIndicator(g,f,k,i,h);mxRectangleShape.prototype.paintForeground.apply(this,arguments)};mxLabel.prototype.paintImage=function(g,f,k,i,h){null!=this.image&&(f=this.getImageBounds(f,k,i,h),g.image(f.x,f.y,f.width,f.height,this.image,!1,!1,!1))};mxLabel.prototype.getImageBounds=function(s,r,q,p){var o=mxUtils.getValue(this.style,mxConstants.STYLE_IMAGE_ALIGN,mxConstants.ALIGN_LEFT),n=mxUtils.getValue(this.style,mxConstants.STYLE_IMAGE_VERTICAL_ALIGN,mxConstants.ALIGN_MIDDLE),m=mxUtils.getNumber(this.style,mxConstants.STYLE_IMAGE_WIDTH,mxConstants.DEFAULT_IMAGESIZE),l=mxUtils.getNumber(this.style,mxConstants.STYLE_IMAGE_HEIGHT,mxConstants.DEFAULT_IMAGESIZE),i=mxUtils.getNumber(this.style,mxConstants.STYLE_SPACING,this.spacing)+5;s=o==mxConstants.ALIGN_CENTER?s+(q-m)/2:o==mxConstants.ALIGN_RIGHT?s+(q-m-i):s+i;r=n==mxConstants.ALIGN_TOP?r+i:n==mxConstants.ALIGN_BOTTOM?r+(p-l-i):r+(p-l)/2;return new mxRectangle(s,r,m,l)};mxLabel.prototype.paintIndicator=function(g,f,k,i,h){null!=this.indicator?(this.indicator.bounds=this.getIndicatorBounds(f,k,i,h),this.indicator.paint(g)):null!=this.indicatorImage&&(f=this.getIndicatorBounds(f,k,i,h),g.image(f.x,f.y,f.width,f.height,this.indicatorImage,!1,!1,!1))};mxLabel.prototype.getIndicatorBounds=function(s,r,q,p){var o=mxUtils.getValue(this.style,mxConstants.STYLE_IMAGE_ALIGN,mxConstants.ALIGN_LEFT),n=mxUtils.getValue(this.style,mxConstants.STYLE_IMAGE_VERTICAL_ALIGN,mxConstants.ALIGN_MIDDLE),m=mxUtils.getNumber(this.style,mxConstants.STYLE_INDICATOR_WIDTH,this.indicatorSize),l=mxUtils.getNumber(this.style,mxConstants.STYLE_INDICATOR_HEIGHT,this.indicatorSize),i=this.spacing+5;s=o==mxConstants.ALIGN_RIGHT?s+(q-m-i):o==mxConstants.ALIGN_CENTER?s+(q-m)/2:s+i;r=n==mxConstants.ALIGN_BOTTOM?r+(p-l-i):n==mxConstants.ALIGN_TOP?r+i:r+(p-l)/2;return new mxRectangle(s,r,m,l)};mxLabel.prototype.redrawHtmlShape=function(){for(mxRectangleShape.prototype.redrawHtmlShape.apply(this,arguments);this.node.hasChildNodes();){this.node.removeChild(this.node.lastChild)}if(null!=this.image){var d=document.createElement("img");d.style.position="relative";d.setAttribute("border","0");var c=this.getImageBounds(this.bounds.x,this.bounds.y,this.bounds.width,this.bounds.height);c.x-=this.bounds.x;c.y-=this.bounds.y;d.style.left=Math.round(c.x)+"px";d.style.top=Math.round(c.y)+"px";d.style.width=Math.round(c.width)+"px";d.style.height=Math.round(c.height)+"px";d.src=this.image;this.node.appendChild(d)}};function mxCylinder(f,e,h,g){mxShape.call(this);this.bounds=f;this.fill=e;this.stroke=h;this.strokewidth=null!=g?g:1}mxUtils.extend(mxCylinder,mxShape);mxCylinder.prototype.maxHeight=40;mxCylinder.prototype.svgStrokeTolerance=0;mxCylinder.prototype.paintVertexShape=function(g,f,k,i,h){g.translate(f,k);g.begin();this.redrawPath(g,f,k,i,h,!1);g.fillAndStroke();g.setShadow(!1);g.begin();this.redrawPath(g,f,k,i,h,!0);g.stroke()};mxCylinder.prototype.redrawPath=function(h,g,m,l,k,i){g=Math.min(this.maxHeight,Math.round(k/5));if(i&&null!=this.fill||!i&&null==this.fill){h.moveTo(0,g),h.curveTo(0,2*g,l,2*g,l,g),i||(h.stroke(),h.begin())}i||(h.moveTo(0,g),h.curveTo(0,-g/3,l,-g/3,l,g),h.lineTo(l,k-g),h.curveTo(l,k+g/3,0,k+g/3,0,k-g),h.close())};function mxConnector(e,d,f){mxPolyline.call(this,e,d,f)}mxUtils.extend(mxConnector,mxPolyline);mxConnector.prototype.paintEdgeShape=function(f,e){var h=this.createMarker(f,e,!0),g=this.createMarker(f,e,!1);null==this.style||1!=this.style[mxConstants.STYLE_CURVED]?this.paintLine(f,e,this.isRounded):this.paintCurvedLine(f,e);f.setFillColor(this.stroke);f.setShadow(!1);f.setDashed(!1);null!=h&&h();null!=g&&g()};mxConnector.prototype.paintCurvedLine=function(h,g){h.begin();var m=g[0],l=g.length;h.moveTo(m.x,m.y);for(m=1;m<l-2;m++){var k=g[m],i=g[m+1];h.quadTo(k.x,k.y,(k.x+i.x)/2,(k.y+i.y)/2)}k=g[l-2];i=g[l-1];h.quadTo(k.x,k.y,i.x,i.y);h.stroke()};mxConnector.prototype.createMarker=function(i,h,o){var n=null,m=h.length,l=o?h[1]:h[m-2],k=o?h[0]:h[m-1];if(null!=l&&null!=k){for(n=1;n<m-1&&0==Math.round(l.x-k.x)&&0==Math.round(l.y-k.y);){l=o?h[1+n]:h[m-2-n],n++}h=k.x-l.x;m=k.y-l.y;n=Math.max(1,Math.sqrt(h*h+m*m));l=h/n;h=m/n;m=mxUtils.getNumber(this.style,o?mxConstants.STYLE_STARTSIZE:mxConstants.STYLE_ENDSIZE,mxConstants.DEFAULT_MARKERSIZE);n=mxUtils.getValue(this.style,o?mxConstants.STYLE_STARTARROW:mxConstants.STYLE_ENDARROW);n=mxMarker.createMarker(i,this,n,k,l,h,m,o,this.strokewidth,0!=this.style[o?mxConstants.STYLE_STARTFILL:mxConstants.STYLE_ENDFILL])}return n};mxConnector.prototype.augmentBoundingBox=function(d){mxShape.prototype.augmentBoundingBox.apply(this,arguments);var c=0;mxUtils.getValue(this.style,mxConstants.STYLE_STARTARROW,mxConstants.NONE)!=mxConstants.NONE&&(c=mxUtils.getNumber(this.style,mxConstants.STYLE_STARTSIZE,mxConstants.DEFAULT_MARKERSIZE)+1);mxUtils.getValue(this.style,mxConstants.STYLE_ENDARROW,mxConstants.NONE)!=mxConstants.NONE&&(c=Math.max(c,mxUtils.getNumber(this.style,mxConstants.STYLE_ENDSIZE,mxConstants.DEFAULT_MARKERSIZE))+1);d.grow(Math.ceil(c*this.scale))};function mxSwimlane(f,e,h,g){mxShape.call(this);this.bounds=f;this.fill=e;this.stroke=h;this.strokewidth=null!=g?g:1}mxUtils.extend(mxSwimlane,mxShape);mxSwimlane.prototype.imageSize=16;mxSwimlane.prototype.getGradientBounds=function(g,f,k,i,h){g=Math.min(h,mxUtils.getValue(this.style,mxConstants.STYLE_STARTSIZE,mxConstants.DEFAULT_STARTSIZE));return new mxRectangle(f,k,i,g)};mxSwimlane.prototype.getRotation=function(){var b=mxShape.prototype.getRotation.apply(this,arguments);1!=mxUtils.getValue(this.style,mxConstants.STYLE_HORIZONTAL,1)&&(b+=mxText.prototype.verticalTextRotation);return b};mxSwimlane.prototype.getTextRotation=function(){return this.getRotation()};mxSwimlane.prototype.isPaintBoundsInverted=function(){return mxShape.prototype.isPaintBoundsInverted.apply(this,arguments)||1!=mxUtils.getValue(this.style,mxConstants.STYLE_HORIZONTAL,1)};mxSwimlane.prototype.getArcSize=function(e,d,f){e=mxUtils.getValue(this.style,mxConstants.STYLE_ARCSIZE,100*mxConstants.RECTANGLE_ROUNDING_FACTOR)/100;return 3*f*e};mxSwimlane.prototype.paintVertexShape=function(s,r,q,p,o){var n=Math.min(o,mxUtils.getValue(this.style,mxConstants.STYLE_STARTSIZE,mxConstants.DEFAULT_STARTSIZE)),m=mxUtils.getValue(this.style,mxConstants.STYLE_SWIMLANE_FILLCOLOR,mxConstants.NONE),l=1==mxUtils.getValue(this.style,mxConstants.STYLE_SWIMLANE_LINE,1),i=0;s.translate(r,q);this.isRounded?(i=this.getArcSize(p,o,n),this.paintRoundedSwimlane(s,r,q,p,o,n,i,m,l)):this.paintSwimlane(s,r,q,p,o,n,m,l);m=mxUtils.getValue(this.style,mxConstants.STYLE_SEPARATORCOLOR,mxConstants.NONE);this.paintSeparator(s,p,n,o,m);null!=this.image&&(o=this.getImageBounds(r,q,p,o),s.image(o.x-r,o.y-q,o.width,o.height,this.image,!1,!1,!1));this.glass&&(s.setShadow(!1),this.paintGlassEffect(s,0,0,p,n,i))};mxSwimlane.prototype.paintSwimlane=function(k,i,q,p,o,n,m,l){m!=mxConstants.NONE&&(k.save(),k.setFillColor(m),k.rect(0,0,p,o),k.fillAndStroke(),k.restore(),k.setShadow(!1));k.begin();k.moveTo(0,n);k.lineTo(0,0);k.lineTo(p,0);k.lineTo(p,n);l&&k.close();k.fillAndStroke();n<o&&m==mxConstants.NONE&&(k.pointerEvents=!1,k.begin(),k.moveTo(0,n),k.lineTo(0,o),k.lineTo(p,o),k.lineTo(p,n),k.stroke())};mxSwimlane.prototype.paintRoundedSwimlane=function(s,r,q,p,o,n,m,l,i){l!=mxConstants.NONE&&(s.save(),s.setFillColor(l),s.roundrect(0,0,p,o,m,m),s.fillAndStroke(),s.restore(),s.setShadow(!1));s.begin();s.moveTo(p,n);s.lineTo(p,m);s.quadTo(p,0,p-Math.min(p/2,m),0);s.lineTo(Math.min(p/2,m),0);s.quadTo(0,0,0,m);s.lineTo(0,n);i&&s.close();s.fillAndStroke();n<o&&l==mxConstants.NONE&&(s.pointerEvents=!1,s.begin(),s.moveTo(0,n),s.lineTo(0,o-m),s.quadTo(0,o,Math.min(p/2,m),o),s.lineTo(p-Math.min(p/2,m),o),s.quadTo(p,o,p,o-m),s.lineTo(p,n),s.stroke())};mxSwimlane.prototype.paintSeparator=function(g,f,k,i,h){h!=mxConstants.NONE&&(g.setStrokeColor(h),g.setDashed(!0),g.begin(),g.moveTo(f,k),g.lineTo(f,i),g.stroke(),g.setDashed(!1))};mxSwimlane.prototype.getImageBounds=function(f,e,h,g){return new mxRectangle(f+h-this.imageSize,e,this.imageSize,this.imageSize)};function mxGraphLayout(b){this.graph=b}mxGraphLayout.prototype.graph=null;mxGraphLayout.prototype.useBoundingBox=!0;mxGraphLayout.prototype.parent=null;mxGraphLayout.prototype.moveCell=function(e,d,f){};mxGraphLayout.prototype.execute=function(b){};mxGraphLayout.prototype.getGraph=function(){return this.graph};mxGraphLayout.prototype.getConstraint=function(f,e,h,g){h=this.graph.view.getState(e);e=null!=h?h.style:this.graph.getCellStyle(e);return null!=e?e[f]:null};mxGraphLayout.traverse=function(k,i,q,p,o){if(null!=q&&null!=k){i=null!=i?i:!0;o=o||[];var n=mxCellPath.create(k);if(null==o[n]&&(o[n]=k,p=q(k,p),null==p||p)){if(p=this.graph.model.getEdgeCount(k),0<p){for(n=0;n<p;n++){var m=this.graph.model.getEdgeAt(k,n),l=this.graph.model.getTerminal(m,!0)==k;if(!i||l){l=this.graph.view.getVisibleTerminal(m,!l),this.traverse(l,i,q,m,o)}}}}}};mxGraphLayout.prototype.isVertexMovable=function(b){return this.graph.isCellMovable(b)};mxGraphLayout.prototype.isVertexIgnored=function(b){return !this.graph.getModel().isVertex(b)||!this.graph.isCellVisible(b)};mxGraphLayout.prototype.isEdgeIgnored=function(d){var c=this.graph.getModel();return !c.isEdge(d)||!this.graph.isCellVisible(d)||null==c.getTerminal(d,!0)||null==c.getTerminal(d,!1)};mxGraphLayout.prototype.setEdgeStyleEnabled=function(d,c){this.graph.setCellStyles(mxConstants.STYLE_NOEDGESTYLE,c?"0":"1",[d])};mxGraphLayout.prototype.setOrthogonalEdge=function(d,c){this.graph.setCellStyles(mxConstants.STYLE_ORTHOGONAL,c?"1":"0",[d])};mxGraphLayout.prototype.getParentOffset=function(f){var e=new mxPoint;if(null!=f&&f!=this.parent){var h=this.graph.getModel();if(h.isAncestor(this.parent,f)){for(var g=h.getGeometry(f);f!=this.parent;){e.x+=g.x,e.y+=g.y,f=h.getParent(f),g=h.getGeometry(f)}}}return e};mxGraphLayout.prototype.setEdgePoints=function(h,g){if(null!=h){var m=this.graph.model,l=m.getGeometry(h);null==l?(l=new mxGeometry,l.setRelative(!0)):l=l.clone();if(null!=this.parent&&null!=g){for(var k=m.getParent(h),k=this.getParentOffset(k),i=0;i<g.length;i++){g[i].x-=k.x,g[i].y-=k.y}}l.points=g;m.setGeometry(h,l)}};mxGraphLayout.prototype.setVertexLocation=function(s,r,q){var p=this.graph.getModel(),o=p.getGeometry(s),n=null;if(null!=o){n=new mxRectangle(r,q,o.width,o.height);if(this.useBoundingBox){var m=this.graph.getView().getState(s);if(null!=m&&null!=m.text&&null!=m.text.boundingBox){var l=this.graph.getView().scale,i=m.text.boundingBox;m.text.boundingBox.x<m.x&&(r+=(m.x-i.x)/l,n.width=i.width);m.text.boundingBox.y<m.y&&(q+=(m.y-i.y)/l,n.height=i.height)}}null!=this.parent&&(m=p.getParent(s),null!=m&&m!=this.parent&&(m=this.getParentOffset(m),r-=m.x,q-=m.y));if(o.x!=r||o.y!=q){o=o.clone(),o.x=r,o.y=q,p.setGeometry(s,o)}}return n};mxGraphLayout.prototype.getVertexBounds=function(k){var i=this.graph.getModel().getGeometry(k);if(this.useBoundingBox){var q=this.graph.getView().getState(k);if(null!=q&&null!=q.text&&null!=q.text.boundingBox){var p=this.graph.getView().scale,o=q.text.boundingBox,n=Math.max(q.x-o.x,0)/p,m=Math.max(q.y-o.y,0)/p,l=Math.max(o.x+o.width-(q.x+q.width),0)/p,q=Math.max(o.y+o.height-(q.y+q.height),0)/p,i=new mxRectangle(i.x-n,i.y-m,i.width+n+l,i.height+m+q)}}null!=this.parent&&(k=this.graph.getModel().getParent(k),i=i.clone(),null!=k&&k!=this.parent&&(k=this.getParentOffset(k),i.x+=k.x,i.y+=k.y));return new mxRectangle(i.x,i.y,i.width,i.height)};mxGraphLayout.prototype.arrangeGroups=function(u,t){this.graph.getModel().beginUpdate();try{for(var s=u.length-1;0<=s;s--){var r=u[s],q=this.graph.getChildVertices(r),p=this.graph.getBoundingBoxFromGeometry(q),o=this.graph.getCellGeometry(r),n=0,m=0;if(this.graph.isSwimlane(r)){var i=this.graph.getStartSize(r),n=i.width,m=i.height}null!=p&&null!=o&&(o=o.clone(),o.x=o.x+p.x-t-n,o.y=o.y+p.y-t-m,o.width=p.width+2*t+n,o.height=p.height+2*t+m,this.graph.getModel().setGeometry(r,o),this.graph.moveCells(q,t+n-p.x,t+m-p.y))}}finally{this.graph.getModel().endUpdate()}};function mxStackLayout(h,g,m,l,k,i){mxGraphLayout.call(this,h);this.horizontal=null!=g?g:!0;this.spacing=null!=m?m:0;this.x0=null!=l?l:0;this.y0=null!=k?k:0;this.border=null!=i?i:0}mxStackLayout.prototype=new mxGraphLayout;mxStackLayout.prototype.constructor=mxStackLayout;mxStackLayout.prototype.horizontal=null;mxStackLayout.prototype.spacing=null;mxStackLayout.prototype.x0=null;mxStackLayout.prototype.y0=null;mxStackLayout.prototype.border=0;mxStackLayout.prototype.marginTop=0;mxStackLayout.prototype.marginLeft=0;mxStackLayout.prototype.marginRight=0;mxStackLayout.prototype.marginBottom=0;mxStackLayout.prototype.keepFirstLocation=!1;mxStackLayout.prototype.fill=!1;mxStackLayout.prototype.resizeParent=!1;mxStackLayout.prototype.resizeLast=!1;mxStackLayout.prototype.wrap=null;mxStackLayout.prototype.isHorizontal=function(){return this.horizontal};mxStackLayout.prototype.moveCell=function(s,r,q){var p=this.graph.getModel(),o=p.getParent(s),n=this.isHorizontal();if(null!=s&&null!=o){var m=0,l=0,i=p.getChildCount(o);r=n?r:q;m=this.graph.getView().getState(o);null!=m&&(r-=n?m.x:m.y);for(m=0;m<i;m++){if(q=p.getChildAt(o,m),q!=s&&(q=p.getGeometry(q),null!=q)){q=n?q.x+q.width/2:q.y+q.height/2;if(l<r&&q>r){break}l=q}}n=o.getIndex(s);n=Math.max(0,m-(m>n?1:0));p.add(o,s,n)}};mxStackLayout.prototype.getParentSize=function(e){var d=this.graph.getModel(),f=d.getGeometry(e);if(null!=this.graph.container&&(null==f&&d.isLayer(e)||e==this.graph.getView().currentRoot)){f=new mxRectangle(0,0,this.graph.container.offsetWidth-1,this.graph.container.offsetHeight-1)}return f};mxStackLayout.prototype.execute=function(A){if(null!=A){var z=this.getParentSize(A),y=this.isHorizontal(),x=this.graph.getModel(),w=null;null!=z&&(w=y?z.height-this.marginTop-this.marginBottom:z.width-this.marginLeft-this.marginRight);var w=w-(2*this.spacing+2*this.border),v=this.x0+this.border+this.marginLeft,u=this.y0+this.border+this.marginTop;if(this.graph.isSwimlane(A)){var t=this.graph.getCellStyle(A),s=mxUtils.getNumber(t,mxConstants.STYLE_STARTSIZE,mxConstants.DEFAULT_STARTSIZE),t=1==mxUtils.getValue(t,mxConstants.STYLE_HORIZONTAL,!0);null!=z&&(s=t?Math.min(s,z.height):Math.min(s,z.width));y==t&&(w-=s);t?u+=s:v+=s}x.beginUpdate();try{for(var s=0,t=null,r=x.getChildCount(A),q=0;q<r;q++){var o=x.getChildAt(A,q);if(!this.isVertexIgnored(o)&&this.isVertexMovable(o)){var i=x.getGeometry(o);if(null!=i){i=i.clone();if(null!=this.wrap&&null!=t&&(y&&t.x+t.width+i.width+2*this.spacing>this.wrap||!y&&t.y+t.height+i.height+2*this.spacing>this.wrap)){t=null,y?u+=s+this.spacing:v+=s+this.spacing,s=0}s=Math.max(s,y?i.height:i.width);null!=t?y?i.x=t.x+t.width+this.spacing:i.y=t.y+t.height+this.spacing:this.keepFirstLocation||(y?i.x=v:i.y=u);y?i.y=u:i.x=v;this.fill&&null!=w&&(y?i.height=w:i.width=w);this.setChildGeometry(o,i);t=i}}}this.resizeParent&&null!=z&&null!=t&&!this.graph.isCellCollapsed(A)?this.updateParentGeometry(A,z,t):this.resizeLast&&(null!=z&&null!=t)&&(y?t.width=z.width-t.x-this.spacing-this.marginRight-this.marginLeft:t.height=z.height-t.y-this.spacing-this.marginBottom)}finally{x.endUpdate()}}};mxStackLayout.prototype.setChildGeometry=function(d,c){this.graph.getModel().setGeometry(d,c)};mxStackLayout.prototype.updateParentGeometry=function(g,f,k){var i=this.isHorizontal(),h=this.graph.getModel();f=f.clone();i?f.width=k.x+k.width+this.spacing+this.marginRight:f.height=k.y+k.height+this.spacing+this.marginBottom;h.setGeometry(g,f)};function mxPartitionLayout(f,e,h,g){mxGraphLayout.call(this,f);this.horizontal=null!=e?e:!0;this.spacing=h||0;this.border=g||0}mxPartitionLayout.prototype=new mxGraphLayout;mxPartitionLayout.prototype.constructor=mxPartitionLayout;mxPartitionLayout.prototype.horizontal=null;mxPartitionLayout.prototype.spacing=null;mxPartitionLayout.prototype.border=null;mxPartitionLayout.prototype.resizeVertices=!0;mxPartitionLayout.prototype.isHorizontal=function(){return this.horizontal};mxPartitionLayout.prototype.moveCell=function(k,i,q){q=this.graph.getModel();var p=q.getParent(k);if(null!=k&&null!=p){for(var o=0,n=0,m=q.getChildCount(p),o=0;o<m;o++){var l=q.getChildAt(p,o),l=this.getVertexBounds(l);if(null!=l){l=l.x+l.width/2;if(n<i&&l>i){break}n=l}}i=p.getIndex(k);i=Math.max(0,o-(o>i?1:0));q.add(p,k,i)}};mxPartitionLayout.prototype.execute=function(y){var x=this.isHorizontal(),w=this.graph.getModel(),v=w.getGeometry(y);if(null!=this.graph.container&&(null==v&&w.isLayer(y)||y==this.graph.getView().currentRoot)){v=new mxRectangle(0,0,this.graph.container.offsetWidth-1,this.graph.container.offsetHeight-1)}if(null!=v){for(var u=[],t=w.getChildCount(y),s=0;s<t;s++){var r=w.getChildAt(y,s);!this.isVertexIgnored(r)&&this.isVertexMovable(r)&&u.push(r)}t=u.length;if(0<t){var q=this.border,p=this.border,o=x?v.height:v.width,o=o-2*this.border;y=this.graph.isSwimlane(y)?this.graph.getStartSize(y):new mxRectangle;o-=x?y.height:y.width;q+=y.width;p+=y.height;y=this.border+(t-1)*this.spacing;v=x?(v.width-q-y)/t:(v.height-p-y)/t;if(0<v){w.beginUpdate();try{for(s=0;s<t;s++){var r=u[s],i=w.getGeometry(r);null!=i&&(i=i.clone(),i.x=q,i.y=p,x?(this.resizeVertices&&(i.width=v,i.height=o),q+=v+this.spacing):(this.resizeVertices&&(i.height=v,i.width=o),p+=v+this.spacing),w.setGeometry(r,i))}}finally{w.endUpdate()}}}}};function mxCompactTreeLayout(e,d,f){mxGraphLayout.call(this,e);this.horizontal=null!=d?d:!0;this.invert=null!=f?f:!1}mxCompactTreeLayout.prototype=new mxGraphLayout;mxCompactTreeLayout.prototype.constructor=mxCompactTreeLayout;mxCompactTreeLayout.prototype.horizontal=null;mxCompactTreeLayout.prototype.invert=null;mxCompactTreeLayout.prototype.resizeParent=!0;mxCompactTreeLayout.prototype.groupPadding=10;mxCompactTreeLayout.prototype.parentsChanged=null;mxCompactTreeLayout.prototype.moveTree=!1;mxCompactTreeLayout.prototype.levelDistance=10;mxCompactTreeLayout.prototype.nodeDistance=20;mxCompactTreeLayout.prototype.resetEdges=!0;mxCompactTreeLayout.prototype.prefHozEdgeSep=5;mxCompactTreeLayout.prototype.prefVertEdgeOff=4;mxCompactTreeLayout.prototype.minEdgeJetty=8;mxCompactTreeLayout.prototype.channelBuffer=4;mxCompactTreeLayout.prototype.edgeRouting=!0;mxCompactTreeLayout.prototype.sortEdges=!1;mxCompactTreeLayout.prototype.alignRanks=!1;mxCompactTreeLayout.prototype.maxRankHeight=null;mxCompactTreeLayout.prototype.isVertexIgnored=function(b){return mxGraphLayout.prototype.isVertexIgnored.apply(this,arguments)||0==this.graph.getConnections(b).length};mxCompactTreeLayout.prototype.isHorizontal=function(){return this.horizontal};mxCompactTreeLayout.prototype.execute=function(s,r){this.parent=s;var q=this.graph.getModel();if(null==r){if(0<this.graph.getEdges(s,q.getParent(s),this.invert,!this.invert,!1).length){r=s}else{var p=this.graph.findTreeRoots(s,!0,this.invert);if(0<p.length){for(var o=0;o<p.length;o++){if(!this.isVertexIgnored(p[o])&&0<this.graph.getEdges(p[o],null,this.invert,!this.invert,!1).length){r=p[o];break}}}}}if(null!=r){this.parentsChanged=this.resizeParent?{}:null;q.beginUpdate();try{var n=this.dfs(r,s);this.alignRanks&&(this.maxRankHeight=[],this.findRankHeights(n,0),this.setCellHeights(n,0));if(null!=n){this.layout(n);var m=this.graph.gridSize,p=m;if(!this.moveTree){var l=this.getVertexBounds(r);null!=l&&(m=l.x,p=l.y)}l=null;l=this.isHorizontal()?this.horizontalLayout(n,m,p):this.verticalLayout(n,null,m,p);if(null!=l){var i=o=0;0>l.x&&(o=Math.abs(m-l.x));0>l.y&&(i=Math.abs(p-l.y));(0!=o||0!=i)&&this.moveNode(n,o,i);this.resizeParent&&this.adjustParents();this.edgeRouting&&this.localEdgeProcessing(n)}}}finally{q.endUpdate()}}};mxCompactTreeLayout.prototype.moveNode=function(e,d,f){e.x+=d;e.y+=f;this.apply(e);for(e=e.child;null!=e;){this.moveNode(e,d,f),e=e.next}};mxCompactTreeLayout.prototype.sortOutgoingEdges=function(e,d){var f=new mxDictionary;d.sort(function(a,l){var k=a.getTerminal(a.getTerminal(!1)==e),i=f.get(k);null==i&&(i=mxCellPath.create(k).split(mxCellPath.PATH_SEPARATOR),f.put(k,i));var k=l.getTerminal(l.getTerminal(!1)==e),c=f.get(k);null==c&&(c=mxCellPath.create(k).split(mxCellPath.PATH_SEPARATOR),f.put(k,c));return mxCellPath.compare(i,c)})};mxCompactTreeLayout.prototype.findRankHeights=function(e,d){if(null==this.maxRankHeight[d]||this.maxRankHeight[d]<e.height){this.maxRankHeight[d]=e.height}for(var f=e.child;null!=f;){this.findRankHeights(f,d+1),f=f.next}};mxCompactTreeLayout.prototype.setCellHeights=function(e,d){null!=this.maxRankHeight[d]&&this.maxRankHeight[d]>e.height&&(e.height=this.maxRankHeight[d]);for(var f=e.child;null!=f;){this.setCellHeights(f,d+1),f=f.next}};mxCompactTreeLayout.prototype.dfs=function(u,t,s){s=null!=s?s:[];var r=mxCellPath.create(u),q=null;if(null!=u&&null==s[r]&&!this.isVertexIgnored(u)){s[r]=u;var q=this.createNode(u),r=this.graph.getModel(),p=null,o=this.graph.getEdges(u,t,this.invert,!this.invert,!1,!0),n=this.graph.getView();this.sortEdges&&this.sortOutgoingEdges(u,o);for(u=0;u<o.length;u++){var m=o[u];if(!this.isEdgeIgnored(m)){this.resetEdges&&this.setEdgePoints(m,null);this.edgeRouting&&(this.setEdgeStyleEnabled(m,!1),this.setEdgePoints(m,null));var i=n.getState(m),m=null!=i?i.getVisibleTerminal(this.invert):n.getVisibleTerminal(m,this.invert),i=this.dfs(m,t,s);null!=i&&null!=r.getGeometry(m)&&(null==p?q.child=i:p.next=i,p=i)}}}return q};mxCompactTreeLayout.prototype.layout=function(d){if(null!=d){for(var c=d.child;null!=c;){this.layout(c),c=c.next}null!=d.child?this.attachParent(d,this.join(d)):this.layoutLeaf(d)}};mxCompactTreeLayout.prototype.horizontalLayout=function(g,f,k,i){g.x+=f+g.offsetX;g.y+=k+g.offsetY;i=this.apply(g,i);f=g.child;if(null!=f){i=this.horizontalLayout(f,g.x,g.y,i);k=g.y+f.offsetY;for(var h=f.next;null!=h;){i=this.horizontalLayout(h,g.x+f.offsetX,k,i),k+=h.offsetY,h=h.next}}return i};mxCompactTreeLayout.prototype.verticalLayout=function(g,f,k,i,h){g.x+=k+g.offsetY;g.y+=i+g.offsetX;h=this.apply(g,h);f=g.child;if(null!=f){h=this.verticalLayout(f,g,g.x,g.y,h);k=g.x+f.offsetY;for(i=f.next;null!=i;){h=this.verticalLayout(i,g,k,g.y+f.offsetX,h),k+=i.offsetY,i=i.next}}return h};mxCompactTreeLayout.prototype.attachParent=function(g,f){var k=this.nodeDistance+this.levelDistance,i=(f-g.width)/2-this.nodeDistance,h=i+g.width+2*this.nodeDistance-f;g.child.offsetX=k+g.height;g.child.offsetY=h;g.contour.upperHead=this.createLine(g.height,0,this.createLine(k,h,g.contour.upperHead));g.contour.lowerHead=this.createLine(g.height,0,this.createLine(k,i,g.contour.lowerHead))};mxCompactTreeLayout.prototype.layoutLeaf=function(d){var c=2*this.nodeDistance;d.contour.upperTail=this.createLine(d.height+c,0);d.contour.upperHead=d.contour.upperTail;d.contour.lowerTail=this.createLine(0,-d.width-c);d.contour.lowerHead=this.createLine(d.height+c,0,d.contour.lowerTail)};mxCompactTreeLayout.prototype.join=function(h){var g=2*this.nodeDistance,m=h.child;h.contour=m.contour;for(var l=m.width+g,k=l,m=m.next;null!=m;){var i=this.merge(h.contour,m.contour);m.offsetY=i+l;m.offsetX=0;l=m.width+g;k+=i+l;m=m.next}return k};mxCompactTreeLayout.prototype.merge=function(k,i){for(var q=0,p=0,o=0,n=k.lowerHead,m=i.upperHead;null!=m&&null!=n;){var l=this.offset(q,p,m.dx,m.dy,n.dx,n.dy),p=p+l,o=o+l;q+m.dx<=n.dx?(q+=m.dx,p+=m.dy,m=m.next):(q-=n.dx,p-=n.dy,n=n.next)}null!=m?(q=this.bridge(k.upperTail,0,0,m,q,p),k.upperTail=null!=q.next?i.upperTail:q,k.lowerTail=i.lowerTail):(q=this.bridge(i.lowerTail,q,p,n,0,0),null==q.next&&(k.lowerTail=q));k.lowerHead=i.lowerHead;return o};mxCompactTreeLayout.prototype.offset=function(i,h,o,n,m,l){var k=0;if(m<=i||0>=i+o){return 0}k=0<m*n-o*l?0>i?i*n/o-h:0<i?i*l/m-h:-h:m<i+o?l-(h+(m-i)*n/o):m>i+o?(o+i)*l/m-(h+n):l-(h+n);return 0<k?k:0};mxCompactTreeLayout.prototype.bridge=function(h,g,m,l,k,i){g=k+l.dx-g;k=k=0;0==l.dx?k=l.dy:(k=g*l.dy,k/=l.dx);g=this.createLine(g,k,l.next);h.next=this.createLine(0,i+l.dy-k-m,g);return g};mxCompactTreeLayout.prototype.createNode=function(d){var c={};c.cell=d;c.x=0;c.y=0;c.width=0;c.height=0;d=this.getVertexBounds(d);null!=d&&(this.isHorizontal()?(c.width=d.height,c.height=d.width):(c.width=d.width,c.height=d.height));c.offsetX=0;c.offsetY=0;c.contour={};return c};mxCompactTreeLayout.prototype.apply=function(g,f){var k=this.graph.getModel(),i=g.cell,h=k.getGeometry(i);null!=i&&null!=h&&(this.isVertexMovable(i)&&(h=this.setVertexLocation(i,g.x,g.y),this.resizeParent&&(k=k.getParent(i),i=mxCellPath.create(k),null==this.parentsChanged[i]&&(this.parentsChanged[i]=k))),f=null==f?new mxRectangle(h.x,h.y,h.width,h.height):new mxRectangle(Math.min(f.x,h.x),Math.min(f.y,h.y),Math.max(f.x+f.width,h.x+h.width),Math.max(f.y+f.height,h.y+h.height)));return f};mxCompactTreeLayout.prototype.createLine=function(f,e,h){var g={};g.dx=f;g.dy=e;g.next=h;return g};mxCompactTreeLayout.prototype.adjustParents=function(){var d=[],c;for(c in this.parentsChanged){d.push(this.parentsChanged[c])}this.arrangeGroups(mxUtils.sortCells(d,!0),this.groupPadding)};mxCompactTreeLayout.prototype.localEdgeProcessing=function(b){this.processNodeOutgoing(b);for(b=b.child;null!=b;){this.localEdgeProcessing(b),b=b.next}};mxCompactTreeLayout.prototype.processNodeOutgoing=function(D){for(var C=D.child,B=D.cell,A=0,z=[];null!=C;){A++;var y=C.x;this.horizontal&&(y=C.y);z.push(new WeightedCellSorter(C,y));C=C.next}z.sort(WeightedCellSorter.prototype.compare);var y=D.width,x=(A+1)*this.prefHozEdgeSep;y>x+2*this.prefHozEdgeSep&&(y-=2*this.prefHozEdgeSep);D=y/A;C=D/2;y>x+2*this.prefHozEdgeSep&&(C+=this.prefHozEdgeSep);for(var y=this.minEdgeJetty-this.prefVertEdgeOff,x=0,w=this.getVertexBounds(B),v=0;v<z.length;v++){for(var u=z[v].cell.cell,t=this.getVertexBounds(u),u=this.graph.getEdgesBetween(B,u,!1),r=[],o=0,i=0,E=0;E<u.length;E++){this.horizontal?(o=w.x+w.width,i=w.y+C,r.push(new mxPoint(o,i)),o=w.x+w.width+y,r.push(new mxPoint(o,i)),i=t.y+t.height/2):(o=w.x+C,i=w.y+w.height,r.push(new mxPoint(o,i)),i=w.y+w.height+y,r.push(new mxPoint(o,i)),o=t.x+t.width/2),r.push(new mxPoint(o,i)),this.setEdgePoints(u[E],r)}v<A/2?y+=this.prefVertEdgeOff:v>A/2&&(y-=this.prefVertEdgeOff);C+=D;x=Math.max(x,y)}};function WeightedCellSorter(d,c){this.cell=d;this.weightedValue=c}WeightedCellSorter.prototype.weightedValue=0;WeightedCellSorter.prototype.nudge=!1;WeightedCellSorter.prototype.visited=!1;WeightedCellSorter.prototype.rankIndex=null;WeightedCellSorter.prototype.cell=null;WeightedCellSorter.prototype.compare=function(d,c){return null!=d&&null!=c?c.weightedValue>d.weightedValue?1:c.weightedValue<d.weightedValue?-1:c.nudge?1:-1:0};function mxFastOrganicLayout(b){mxGraphLayout.call(this,b)}mxFastOrganicLayout.prototype=new mxGraphLayout;mxFastOrganicLayout.prototype.constructor=mxFastOrganicLayout;mxFastOrganicLayout.prototype.useInputOrigin=!0;mxFastOrganicLayout.prototype.resetEdges=!0;mxFastOrganicLayout.prototype.disableEdgeStyle=!0;mxFastOrganicLayout.prototype.forceConstant=50;mxFastOrganicLayout.prototype.forceConstantSquared=0;mxFastOrganicLayout.prototype.minDistanceLimit=2;mxFastOrganicLayout.prototype.maxDistanceLimit=500;mxFastOrganicLayout.prototype.minDistanceLimitSquared=4;mxFastOrganicLayout.prototype.initialTemp=200;mxFastOrganicLayout.prototype.temperature=0;mxFastOrganicLayout.prototype.maxIterations=0;mxFastOrganicLayout.prototype.iteration=0;mxFastOrganicLayout.prototype.allowedToRun=!0;mxFastOrganicLayout.prototype.isVertexIgnored=function(b){return mxGraphLayout.prototype.isVertexIgnored.apply(this,arguments)||0==this.graph.getConnections(b).length};mxFastOrganicLayout.prototype.execute=function(D){var C=this.graph.getModel();this.vertexArray=[];for(var B=this.graph.getChildVertices(D),A=0;A<B.length;A++){this.isVertexIgnored(B[A])||this.vertexArray.push(B[A])}var z=this.useInputOrigin?this.graph.getBoundingBoxFromGeometry(this.vertexArray):null,y=this.vertexArray.length;this.indices=[];this.dispX=[];this.dispY=[];this.cellLocation=[];this.isMoveable=[];this.neighbours=[];this.radius=[];this.radiusSquared=[];0.001>this.forceConstant&&(this.forceConstant=0.001);this.forceConstantSquared=this.forceConstant*this.forceConstant;for(A=0;A<this.vertexArray.length;A++){var x=this.vertexArray[A];this.cellLocation[A]=[];var w=mxCellPath.create(x);this.indices[w]=A;var v=this.getVertexBounds(x),u=v.width,t=v.height,r=v.x,o=v.y;this.cellLocation[A][0]=r+u/2;this.cellLocation[A][1]=o+t/2;this.radius[A]=Math.min(u,t);this.radiusSquared[A]=this.radius[A]*this.radius[A]}C.beginUpdate();try{for(A=0;A<y;A++){this.dispX[A]=0;this.dispY[A]=0;this.isMoveable[A]=this.isVertexMovable(this.vertexArray[A]);var i=this.graph.getConnections(this.vertexArray[A],D),B=this.graph.getOpposites(i,this.vertexArray[A]);this.neighbours[A]=[];for(u=0;u<B.length;u++){this.resetEdges&&this.graph.resetEdge(i[u]);this.disableEdgeStyle&&this.setEdgeStyleEnabled(i[u],!1);var w=mxCellPath.create(B[u]),E=this.indices[w];this.neighbours[A][u]=null!=E?E:A}}this.temperature=this.initialTemp;0==this.maxIterations&&(this.maxIterations=20*Math.sqrt(y));for(this.iteration=0;this.iteration<this.maxIterations;this.iteration++){if(!this.allowedToRun){return}this.calcRepulsion();this.calcAttraction();this.calcPositions();this.reduceTemperature()}D=B=null;for(A=0;A<this.vertexArray.length;A++){x=this.vertexArray[A],this.isVertexMovable(x)&&(v=this.getVertexBounds(x),null!=v&&(this.cellLocation[A][0]-=v.width/2,this.cellLocation[A][1]-=v.height/2,r=this.graph.snap(this.cellLocation[A][0]),o=this.graph.snap(this.cellLocation[A][1]),this.setVertexLocation(x,r,o),B=null==B?r:Math.min(B,r),D=null==D?o:Math.min(D,o)))}A=-(B||0)+1;x=-(D||0)+1;null!=z&&(A+=z.x,x+=z.y);this.graph.moveCells(this.vertexArray,A,x)}finally{C.endUpdate()}};mxFastOrganicLayout.prototype.calcPositions=function(){for(var e=0;e<this.vertexArray.length;e++){if(this.isMoveable[e]){var d=Math.sqrt(this.dispX[e]*this.dispX[e]+this.dispY[e]*this.dispY[e]);0.001>d&&(d=0.001);var f=this.dispX[e]/d*Math.min(d,this.temperature),d=this.dispY[e]/d*Math.min(d,this.temperature);this.dispX[e]=0;this.dispY[e]=0;this.cellLocation[e][0]+=f;this.cellLocation[e][1]+=d}}};mxFastOrganicLayout.prototype.calcAttraction=function(){for(var i=0;i<this.vertexArray.length;i++){for(var h=0;h<this.neighbours[i].length;h++){var o=this.neighbours[i][h];if(i!=o&&this.isMoveable[i]&&this.isMoveable[o]){var n=this.cellLocation[i][0]-this.cellLocation[o][0],m=this.cellLocation[i][1]-this.cellLocation[o][1],l=n*n+m*m-this.radiusSquared[i]-this.radiusSquared[o];l<this.minDistanceLimitSquared&&(l=this.minDistanceLimitSquared);var k=Math.sqrt(l),l=l/this.forceConstant,n=n/k*l,m=m/k*l;this.dispX[i]-=n;this.dispY[i]-=m;this.dispX[o]+=n;this.dispY[o]+=m}}}};mxFastOrganicLayout.prototype.calcRepulsion=function(){for(var i=this.vertexArray.length,h=0;h<i;h++){for(var o=h;o<i;o++){if(!this.allowedToRun){return}if(o!=h&&this.isMoveable[h]&&this.isMoveable[o]){var n=this.cellLocation[h][0]-this.cellLocation[o][0],m=this.cellLocation[h][1]-this.cellLocation[o][1];0==n&&(n=0.01+Math.random());0==m&&(m=0.01+Math.random());var l=Math.sqrt(n*n+m*m),k=l-this.radius[h]-this.radius[o];k>this.maxDistanceLimit||(k<this.minDistanceLimit&&(k=this.minDistanceLimit),k=this.forceConstantSquared/k,n=n/l*k,m=m/l*k,this.dispX[h]+=n,this.dispY[h]+=m,this.dispX[o]-=n,this.dispY[o]-=m)}}}};mxFastOrganicLayout.prototype.reduceTemperature=function(){this.temperature=this.initialTemp*(1-this.iteration/this.maxIterations)};function mxCircleLayout(d,c){mxGraphLayout.call(this,d);this.radius=null!=c?c:100}mxCircleLayout.prototype=new mxGraphLayout;mxCircleLayout.prototype.constructor=mxCircleLayout;mxCircleLayout.prototype.radius=null;mxCircleLayout.prototype.moveCircle=!1;mxCircleLayout.prototype.x0=0;mxCircleLayout.prototype.y0=0;mxCircleLayout.prototype.resetEdges=!0;mxCircleLayout.prototype.disableEdgeStyle=!0;mxCircleLayout.prototype.execute=function(w){var v=this.graph.getModel();v.beginUpdate();try{for(var u=0,t=null,s=null,r=[],q=v.getChildCount(w),p=0;p<q;p++){var o=v.getChildAt(w,p);if(this.isVertexIgnored(o)){this.isEdgeIgnored(o)||(this.resetEdges&&this.graph.resetEdge(o),this.disableEdgeStyle&&this.setEdgeStyleEnabled(o,!1))}else{r.push(o);var n=this.getVertexBounds(o),t=null==t?n.y:Math.min(t,n.y),s=null==s?n.x:Math.min(s,n.x),u=Math.max(u,Math.max(n.width,n.height))}}var i=this.getRadius(r.length,u);this.moveCircle&&(s=this.x0,t=this.y0);this.circle(r,i,s,t)}finally{v.endUpdate()}};mxCircleLayout.prototype.getRadius=function(d,c){return Math.max(d*c/Math.PI,this.radius)};mxCircleLayout.prototype.circle=function(i,h,o,n){for(var m=i.length,l=2*Math.PI/m,k=0;k<m;k++){this.isVertexMovable(i[k])&&this.setVertexLocation(i[k],o+h+h*Math.sin(k*l),n+h+h*Math.cos(k*l))}};function mxParallelEdgeLayout(b){mxGraphLayout.call(this,b)}mxParallelEdgeLayout.prototype=new mxGraphLayout;mxParallelEdgeLayout.prototype.constructor=mxParallelEdgeLayout;mxParallelEdgeLayout.prototype.spacing=20;mxParallelEdgeLayout.prototype.execute=function(e){e=this.findParallels(e);this.graph.model.beginUpdate();try{for(var d in e){var f=e[d];1<f.length&&this.layout(f)}}finally{this.graph.model.endUpdate()}};mxParallelEdgeLayout.prototype.findParallels=function(i){for(var h=this.graph.getModel(),o=[],n=h.getChildCount(i),m=0;m<n;m++){var l=h.getChildAt(i,m);if(!this.isEdgeIgnored(l)){var k=this.getEdgeId(l);null!=k&&(null==o[k]&&(o[k]=[]),o[k].push(l))}}return o};mxParallelEdgeLayout.prototype.getEdgeId=function(e){var d=this.graph.getView(),f=d.getVisibleTerminal(e,!0);e=d.getVisibleTerminal(e,!1);return null!=f&&null!=e?(f=mxCellPath.create(f),e=mxCellPath.create(e),f>e?e+"-"+f:f+"-"+e):null};mxParallelEdgeLayout.prototype.layout=function(i){var h=i[0],o=this.graph.getView(),n=this.graph.getModel(),m=n.getGeometry(o.getVisibleTerminal(h,!0)),n=n.getGeometry(o.getVisibleTerminal(h,!1));if(m==n){for(var h=m.x+m.width+this.spacing,o=m.y+m.height/2,l=0;l<i.length;l++){this.route(i[l],h,o),h+=this.spacing}}else{if(null!=m&&null!=n){var h=m.x+m.width/2,o=m.y+m.height/2,l=n.x+n.width/2-h,k=n.y+n.height/2-o,n=Math.sqrt(l*l+k*k);if(0<n){m=k*this.spacing/n;n=l*this.spacing/n;h=h+l/2+m*(i.length-1)/2;o=o+k/2-n*(i.length-1)/2;for(l=0;l<i.length;l++){this.route(i[l],h,o),h-=m,o+=n}}}}};mxParallelEdgeLayout.prototype.route=function(e,d,f){this.graph.isCellMovable(e)&&this.setEdgePoints(e,[new mxPoint(d,f)])};function mxCompositeLayout(e,d,f){mxGraphLayout.call(this,e);this.layouts=d;this.master=f}mxCompositeLayout.prototype=new mxGraphLayout;mxCompositeLayout.prototype.constructor=mxCompositeLayout;mxCompositeLayout.prototype.layouts=null;mxCompositeLayout.prototype.master=null;mxCompositeLayout.prototype.moveCell=function(e,d,f){null!=this.master?this.master.move.apply(this.master,arguments):this.layouts[0].move.apply(this.layouts[0],arguments)};mxCompositeLayout.prototype.execute=function(e){var d=this.graph.getModel();d.beginUpdate();try{for(var f=0;f<this.layouts.length;f++){this.layouts[f].execute.apply(this.layouts[f],arguments)}}finally{d.endUpdate()}};function mxEdgeLabelLayout(d,c){mxGraphLayout.call(this,d)}mxEdgeLabelLayout.prototype=new mxGraphLayout;mxEdgeLabelLayout.prototype.constructor=mxEdgeLabelLayout;mxEdgeLabelLayout.prototype.execute=function(s){for(var r=this.graph.view,q=this.graph.getModel(),p=[],o=[],n=q.getChildCount(s),m=0;m<n;m++){var l=q.getChildAt(s,m),i=r.getState(l);null!=i&&(this.isVertexIgnored(l)?this.isEdgeIgnored(l)||p.push(i):o.push(i))}this.placeLabels(o,p)};mxEdgeLabelLayout.prototype.placeLabels=function(i,h){var o=this.graph.getModel();o.beginUpdate();try{for(var n=0;n<h.length;n++){var m=h[n];if(null!=m&&null!=m.text&&null!=m.text.boundingBox){for(var l=0;l<i.length;l++){var k=i[l];null!=k&&this.avoid(m,k)}}}}finally{o.endUpdate()}};mxEdgeLabelLayout.prototype.avoid=function(h,g){var m=this.graph.getModel(),l=h.text.boundingBox;if(mxUtils.intersects(l,g)){var k=-l.y-l.height+g.y,i=-l.y+g.y+g.height,k=Math.abs(k)<Math.abs(i)?k:i,i=-l.x-l.width+g.x,l=-l.x+g.x+g.width,l=Math.abs(i)<Math.abs(l)?i:l;Math.abs(l)<Math.abs(k)?k=0:l=0;i=m.getGeometry(h.cell);null!=i&&(i=i.clone(),null!=i.offset?(i.offset.x+=l,i.offset.y+=k):i.offset=new mxPoint(l,k),m.setGeometry(h.cell,i))}};function mxGraphAbstractHierarchyCell(){this.x=[];this.y=[];this.temp=[]}mxGraphAbstractHierarchyCell.prototype.maxRank=-1;mxGraphAbstractHierarchyCell.prototype.minRank=-1;mxGraphAbstractHierarchyCell.prototype.x=null;mxGraphAbstractHierarchyCell.prototype.y=null;mxGraphAbstractHierarchyCell.prototype.width=0;mxGraphAbstractHierarchyCell.prototype.height=0;mxGraphAbstractHierarchyCell.prototype.nextLayerConnectedCells=null;mxGraphAbstractHierarchyCell.prototype.previousLayerConnectedCells=null;mxGraphAbstractHierarchyCell.prototype.temp=null;mxGraphAbstractHierarchyCell.prototype.getNextLayerConnectedCells=function(b){return null};mxGraphAbstractHierarchyCell.prototype.getPreviousLayerConnectedCells=function(b){return null};mxGraphAbstractHierarchyCell.prototype.isEdge=function(){return !1};mxGraphAbstractHierarchyCell.prototype.isVertex=function(){return !1};mxGraphAbstractHierarchyCell.prototype.getGeneralPurposeVariable=function(b){return null};mxGraphAbstractHierarchyCell.prototype.setGeneralPurposeVariable=function(d,c){return null};mxGraphAbstractHierarchyCell.prototype.setX=function(d,c){this.isVertex()?this.x[0]=c:this.isEdge()&&(this.x[d-this.minRank-1]=c)};mxGraphAbstractHierarchyCell.prototype.getX=function(b){return this.isVertex()?this.x[0]:this.isEdge()?this.x[b-this.minRank-1]:0};mxGraphAbstractHierarchyCell.prototype.setY=function(d,c){this.isVertex()?this.y[0]=c:this.isEdge()&&(this.y[d-this.minRank-1]=c)};function mxGraphHierarchyNode(b){mxGraphAbstractHierarchyCell.apply(this,arguments);this.cell=b;this.connectsAsTarget=[];this.connectsAsSource=[]}mxGraphHierarchyNode.prototype=new mxGraphAbstractHierarchyCell;mxGraphHierarchyNode.prototype.constructor=mxGraphHierarchyNode;mxGraphHierarchyNode.prototype.cell=null;mxGraphHierarchyNode.prototype.connectsAsTarget=null;mxGraphHierarchyNode.prototype.connectsAsSource=null;mxGraphHierarchyNode.prototype.hashCode=!1;mxGraphHierarchyNode.prototype.getRankValue=function(b){return this.maxRank};mxGraphHierarchyNode.prototype.getNextLayerConnectedCells=function(e){if(null==this.nextLayerConnectedCells){this.nextLayerConnectedCells=[];this.nextLayerConnectedCells[0]=[];for(var d=0;d<this.connectsAsTarget.length;d++){var f=this.connectsAsTarget[d];-1==f.maxRank||f.maxRank==e+1?this.nextLayerConnectedCells[0].push(f.source):this.nextLayerConnectedCells[0].push(f)}}return this.nextLayerConnectedCells[0]};mxGraphHierarchyNode.prototype.getPreviousLayerConnectedCells=function(e){if(null==this.previousLayerConnectedCells){this.previousLayerConnectedCells=[];this.previousLayerConnectedCells[0]=[];for(var d=0;d<this.connectsAsSource.length;d++){var f=this.connectsAsSource[d];-1==f.minRank||f.minRank==e-1?this.previousLayerConnectedCells[0].push(f.target):this.previousLayerConnectedCells[0].push(f)}}return this.previousLayerConnectedCells[0]};mxGraphHierarchyNode.prototype.isVertex=function(){return !0};mxGraphHierarchyNode.prototype.getGeneralPurposeVariable=function(b){return this.temp[0]};mxGraphHierarchyNode.prototype.setGeneralPurposeVariable=function(d,c){this.temp[0]=c};mxGraphHierarchyNode.prototype.isAncestor=function(d){if(null!=d&&null!=this.hashCode&&null!=d.hashCode&&this.hashCode.length<d.hashCode.length){if(this.hashCode==d.hashCode){return !0}if(null==this.hashCode||null==this.hashCode){return !1}for(var c=0;c<this.hashCode.length;c++){if(this.hashCode[c]!=d.hashCode[c]){return !1}}return !0}return !1};mxGraphHierarchyNode.prototype.getCoreCell=function(){return this.cell};function mxGraphHierarchyEdge(b){mxGraphAbstractHierarchyCell.apply(this,arguments);this.edges=b}mxGraphHierarchyEdge.prototype=new mxGraphAbstractHierarchyCell;mxGraphHierarchyEdge.prototype.constructor=mxGraphHierarchyEdge;mxGraphHierarchyEdge.prototype.edges=null;mxGraphHierarchyEdge.prototype.source=null;mxGraphHierarchyEdge.prototype.target=null;mxGraphHierarchyEdge.prototype.isReversed=!1;mxGraphHierarchyEdge.prototype.invert=function(b){b=this.source;this.source=this.target;this.target=b;this.isReversed=!this.isReversed};mxGraphHierarchyEdge.prototype.getNextLayerConnectedCells=function(d){if(null==this.nextLayerConnectedCells){this.nextLayerConnectedCells=[];for(var c=0;c<this.temp.length;c++){this.nextLayerConnectedCells[c]=[],c==this.temp.length-1?this.nextLayerConnectedCells[c].push(this.source):this.nextLayerConnectedCells[c].push(this)}}return this.nextLayerConnectedCells[d-this.minRank-1]};mxGraphHierarchyEdge.prototype.getPreviousLayerConnectedCells=function(d){if(null==this.previousLayerConnectedCells){this.previousLayerConnectedCells=[];for(var c=0;c<this.temp.length;c++){this.previousLayerConnectedCells[c]=[],0==c?this.previousLayerConnectedCells[c].push(this.target):this.previousLayerConnectedCells[c].push(this)}}return this.previousLayerConnectedCells[d-this.minRank-1]};mxGraphHierarchyEdge.prototype.isEdge=function(){return !0};mxGraphHierarchyEdge.prototype.getGeneralPurposeVariable=function(b){return this.temp[b-this.minRank-1]};mxGraphHierarchyEdge.prototype.setGeneralPurposeVariable=function(d,c){this.temp[d-this.minRank-1]=c};mxGraphHierarchyEdge.prototype.getCoreCell=function(){return null!=this.edges&&0<this.edges.length?this.edges[0]:null};function mxGraphHierarchyModel(s,r,q,p,o){s.getGraph();this.tightenToSource=o;this.roots=q;this.parent=p;this.vertexMapper={};this.edgeMapper={};this.maxRank=0;q=[];null==r&&(r=this.graph.getChildVertices(p));this.maxRank=this.SOURCESCANSTARTRANK;this.createInternalCells(s,r,q);for(p=0;p<r.length;p++){o=q[p].connectsAsSource;for(var n=0;n<o.length;n++){var m=o[n],l=m.edges;if(null!=l&&0<l.length){var l=l[0],i=s.getVisibleTerminal(l,!1),i=mxCellPath.create(i),i=this.vertexMapper[i];q[p]==i&&(i=s.getVisibleTerminal(l,!0),i=mxCellPath.create(i),i=this.vertexMapper[i]);null!=i&&q[p]!=i&&(m.target=i,0==i.connectsAsTarget.length&&(i.connectsAsTarget=[]),0>mxUtils.indexOf(i.connectsAsTarget,m)&&i.connectsAsTarget.push(m))}}q[p].temp[0]=1}}mxGraphHierarchyModel.prototype.maxRank=null;mxGraphHierarchyModel.prototype.vertexMapper=null;mxGraphHierarchyModel.prototype.edgeMapper=null;mxGraphHierarchyModel.prototype.ranks=null;mxGraphHierarchyModel.prototype.roots=null;mxGraphHierarchyModel.prototype.parent=null;mxGraphHierarchyModel.prototype.dfsCount=0;mxGraphHierarchyModel.prototype.SOURCESCANSTARTRANK=100000000;mxGraphHierarchyModel.prototype.tightenToSource=!1;mxGraphHierarchyModel.prototype.createInternalCells=function(y,x,w){for(var v=y.getGraph(),u=0;u<x.length;u++){w[u]=new mxGraphHierarchyNode(x[u]);var t=mxCellPath.create(x[u]);this.vertexMapper[t]=w[u];t=y.getEdges(x[u]);w[u].connectsAsSource=[];for(var s=0;s<t.length;s++){var r=y.getVisibleTerminal(t[s],!1);if(r!=x[u]&&y.graph.model.isVertex(r)&&!y.isVertexIgnored(r)){var q=y.getEdgesBetween(x[u],r,!1),p=y.getEdgesBetween(x[u],r,!0),r=mxCellPath.create(q[0]);if(null!=q&&0<q.length&&null==this.edgeMapper[r]&&2*p.length>=q.length){for(var p=new mxGraphHierarchyEdge(q),o=0;o<q.length;o++){var i=q[o],r=mxCellPath.create(i);this.edgeMapper[r]=p;v.resetEdge(i);y.disableEdgeStyle&&(y.setEdgeStyleEnabled(i,!1),y.setOrthogonalEdge(i,!0))}p.source=w[u];0>mxUtils.indexOf(w[u].connectsAsSource,p)&&w[u].connectsAsSource.push(p)}}}w[u].temp[0]=0}};mxGraphHierarchyModel.prototype.initialRank=function(){var u=[];if(null!=this.roots){for(var t=0;t<this.roots.length;t++){var s=mxCellPath.create(this.roots[t]),s=this.vertexMapper[s];null!=s&&u.push(s)}}for(var r in this.vertexMapper){s=this.vertexMapper[r],s.temp[0]=-1}for(var q=u.slice();0<u.length;){var s=u[0],p,o;p=s.connectsAsTarget;o=s.connectsAsSource;for(var n=!0,m=this.SOURCESCANSTARTRANK,t=0;t<p.length;t++){var i=p[t];if(5270620==i.temp[0]){i=i.source,m=Math.min(m,i.temp[0]-1)}else{n=!1;break}}if(n){s.temp[0]=m;this.maxRank=Math.min(this.maxRank,m);if(null!=o){for(t=0;t<o.length;t++){i=o[t],i.temp[0]=5270620,i=i.target,-1==i.temp[0]&&(u.push(i),i.temp[0]=-2)}}u.shift()}else{if(t=u.shift(),u.push(s),t==s&&1==u.length){break}}}for(r in this.vertexMapper){s=this.vertexMapper[r],s.temp[0]-=this.maxRank}for(t=0;t<q.length;t++){s=q[t];u=0;p=s.connectsAsSource;for(r=0;r<p.length;r++){i=p[r],i=i.target,s.temp[0]=Math.max(u,i.temp[0]+1),u=s.temp[0]}}this.maxRank=this.SOURCESCANSTARTRANK-this.maxRank};mxGraphHierarchyModel.prototype.fixRanks=function(){var g=[];this.ranks=[];for(var f=0;f<this.maxRank+1;f++){g[f]=[],this.ranks[f]=g[f]}var k=null;if(null!=this.roots){for(var i=this.roots,k=[],f=0;f<i.length;f++){var h=mxCellPath.create(i[f]);k[f]=this.vertexMapper[h]}}this.visit(function(a,p,o,n,m){0==m&&(0>p.maxRank&&0>p.minRank)&&(g[p.temp[0]].push(p),p.maxRank=p.temp[0],p.minRank=p.temp[0],p.temp[0]=g[p.maxRank].length-1);if(null!=a&&null!=o&&1<a.maxRank-p.maxRank){o.maxRank=a.maxRank;o.minRank=p.maxRank;o.temp=[];o.x=[];o.y=[];for(a=o.minRank+1;a<o.maxRank;a++){g[a].push(o),o.setGeneralPurposeVariable(a,g[a].length-1)}}},k,!1,null)};mxGraphHierarchyModel.prototype.visit=function(h,g,m,l){if(null!=g){for(var k=0;k<g.length;k++){var i=g[k];null!=i&&(null==l&&(l={}),m?(i.hashCode=[],i.hashCode[0]=this.dfsCount,i.hashCode[1]=k,this.extendedDfs(null,i,null,h,l,i.hashCode,k,0)):this.dfs(null,i,null,h,l,0))}this.dfsCount++}};mxGraphHierarchyModel.prototype.dfs=function(i,h,o,n,m,l){if(null!=h){var k=mxCellPath.create(h.cell);if(null==m[k]){m[k]=h;n(i,h,o,l,0);i=h.connectsAsSource.slice();for(o=0;o<i.length;o++){k=i[o],this.dfs(h,k.target,k,n,m,l+1)}}else{n(i,h,o,l,1)}}};mxGraphHierarchyModel.prototype.extendedDfs=function(k,i,q,p,o,n,m,l){if(null!=i){if(null!=k&&(null==i.hashCode||i.hashCode[0]!=k.hashCode[0])){n=k.hashCode.length+1,i.hashCode=k.hashCode.slice(),i.hashCode[n-1]=m}m=mxCellPath.create(i.cell);if(null==o[m]){o[m]=i;p(k,i,q,l,0);k=i.connectsAsSource.slice();for(q=0;q<k.length;q++){m=k[q],this.extendedDfs(i,m.target,m,p,o,i.hashCode,q,l+1)}}else{p(k,i,q,l,1)}}};function mxSwimlaneModel(s,r,q,p,o){s.getGraph();this.tightenToSource=o;this.roots=q;this.parent=p;this.vertexMapper={};this.edgeMapper={};this.maxRank=0;q=[];null==r&&(r=this.graph.getChildVertices(p));this.maxRank=this.SOURCESCANSTARTRANK;this.createInternalCells(s,r,q);for(p=0;p<r.length;p++){o=q[p].connectsAsSource;for(var n=0;n<o.length;n++){var m=o[n],l=m.edges;if(null!=l&&0<l.length){var l=l[0],i=s.getVisibleTerminal(l,!1),i=mxCellPath.create(i),i=this.vertexMapper[i];q[p]==i&&(i=s.getVisibleTerminal(l,!0),i=mxCellPath.create(i),i=this.vertexMapper[i]);null!=i&&q[p]!=i&&(m.target=i,0==i.connectsAsTarget.length&&(i.connectsAsTarget=[]),0>mxUtils.indexOf(i.connectsAsTarget,m)&&i.connectsAsTarget.push(m))}}q[p].temp[0]=1}}mxSwimlaneModel.prototype.maxRank=null;mxSwimlaneModel.prototype.vertexMapper=null;mxSwimlaneModel.prototype.edgeMapper=null;mxSwimlaneModel.prototype.ranks=null;mxSwimlaneModel.prototype.roots=null;mxSwimlaneModel.prototype.parent=null;mxSwimlaneModel.prototype.dfsCount=0;mxSwimlaneModel.prototype.SOURCESCANSTARTRANK=100000000;mxSwimlaneModel.prototype.ranksPerGroup=null;mxSwimlaneModel.prototype.createInternalCells=function(A,z,y){for(var x=A.getGraph(),w=A.swimlanes,v=0;v<z.length;v++){y[v]=new mxGraphHierarchyNode(z[v]);var u=mxCellPath.create(z[v]);this.vertexMapper[u]=y[v];y[v].swimlaneIndex=-1;for(u=0;u<w.length;u++){if(x.model.getParent(z[v])==w[u]){y[v].swimlaneIndex=u;break}}u=A.getEdges(z[v]);y[v].connectsAsSource=[];for(var t=0;t<u.length;t++){var s=A.getVisibleTerminal(u[t],!1);if(s!=z[v]&&A.graph.model.isVertex(s)&&!A.isVertexIgnored(s)){var r=A.getEdgesBetween(z[v],s,!1),q=A.getEdgesBetween(z[v],s,!0),s=mxCellPath.create(r[0]);if(null!=r&&0<r.length&&null==this.edgeMapper[s]&&2*q.length>=r.length){for(var q=new mxGraphHierarchyEdge(r),o=0;o<r.length;o++){var i=r[o],s=mxCellPath.create(i);this.edgeMapper[s]=q;x.resetEdge(i);A.disableEdgeStyle&&(A.setEdgeStyleEnabled(i,!1),A.setOrthogonalEdge(i,!0))}q.source=y[v];0>mxUtils.indexOf(y[v].connectsAsSource,q)&&y[v].connectsAsSource.push(q)}}}y[v].temp[0]=0}};mxSwimlaneModel.prototype.initialRank=function(){this.ranksPerGroup=[];var s=[],r={};if(null!=this.roots){for(var q=0;q<this.roots.length;q++){var p=mxCellPath.create(this.roots[q]),p=this.vertexMapper[p];this.maxChainDfs(null,p,null,r,0);null!=p&&s.push(p)}}p=[];r=[];for(q=this.ranksPerGroup.length-1;0<=q;q--){p[q]=q==this.ranksPerGroup.length-1?0:r[q+1]+1,r[q]=p[q]+this.ranksPerGroup[q]}this.maxRank=r[0];for(var o in this.vertexMapper){p=this.vertexMapper[o],p.temp[0]=-1}for(s.slice();0<s.length;){var p=s[0],n;o=p.connectsAsTarget;n=p.connectsAsSource;for(var m=!0,l=r[0],q=0;q<o.length;q++){var i=o[q];if(5270620==i.temp[0]){i=i.source,l=Math.min(l,i.temp[0]-1)}else{m=!1;break}}if(m){l>r[p.swimlaneIndex]&&(l=r[p.swimlaneIndex]);p.temp[0]=l;if(null!=n){for(q=0;q<n.length;q++){i=n[q],i.temp[0]=5270620,i=i.target,-1==i.temp[0]&&(s.push(i),i.temp[0]=-2)}}s.shift()}else{if(q=s.shift(),s.push(p),q==p&&1==s.length){break}}}};mxSwimlaneModel.prototype.maxChainDfs=function(i,h,o,n,m){if(null!=h&&(i=mxCellPath.create(h.cell),null==n[i])){n[i]=h;i=h.swimlaneIndex;if(null==this.ranksPerGroup[i]||this.ranksPerGroup[i]<m){this.ranksPerGroup[i]=m}i=h.connectsAsSource.slice();for(o=0;o<i.length;o++){var l=i[o],k=l.target;h.swimlaneIndex<k.swimlaneIndex?this.maxChainDfs(h,k,l,mxUtils.clone(n,null,!0),0):h.swimlaneIndex==k.swimlaneIndex&&this.maxChainDfs(h,k,l,mxUtils.clone(n,null,!0),m+1)}}};mxSwimlaneModel.prototype.fixRanks=function(){var g=[];this.ranks=[];for(var f=0;f<this.maxRank+1;f++){g[f]=[],this.ranks[f]=g[f]}var k=null;if(null!=this.roots){for(var i=this.roots,k=[],f=0;f<i.length;f++){var h=mxCellPath.create(i[f]);k[f]=this.vertexMapper[h]}}this.visit(function(a,p,o,n,m){0==m&&(0>p.maxRank&&0>p.minRank)&&(null==g[p.temp[0]]&&mxLog.show(),g[p.temp[0]].push(p),p.maxRank=p.temp[0],p.minRank=p.temp[0],p.temp[0]=g[p.maxRank].length-1);if(null!=a&&null!=o&&1<a.maxRank-p.maxRank){o.maxRank=a.maxRank;o.minRank=p.maxRank;o.temp=[];o.x=[];o.y=[];for(a=o.minRank+1;a<o.maxRank;a++){g[a].push(o),o.setGeneralPurposeVariable(a,g[a].length-1)}}},k,!1,null)};mxSwimlaneModel.prototype.visit=function(h,g,m,l){if(null!=g){for(var k=0;k<g.length;k++){var i=g[k];null!=i&&(null==l&&(l={}),m?(i.hashCode=[],i.hashCode[0]=this.dfsCount,i.hashCode[1]=k,this.extendedDfs(null,i,null,h,l,i.hashCode,k,0)):this.dfs(null,i,null,h,l,0))}this.dfsCount++}};mxSwimlaneModel.prototype.dfs=function(i,h,o,n,m,l){if(null!=h){var k=mxCellPath.create(h.cell);if(null==m[k]){m[k]=h;n(i,h,o,l,0);i=h.connectsAsSource.slice();for(o=0;o<i.length;o++){k=i[o],this.dfs(h,k.target,k,n,m,l+1)}}else{n(i,h,o,l,1)}}};mxSwimlaneModel.prototype.extendedDfs=function(s,r,q,p,o,n,m,l){if(null!=r){if(null!=s&&(null==r.hashCode||r.hashCode[0]!=s.hashCode[0])){n=s.hashCode.length+1,r.hashCode=s.hashCode.slice(),r.hashCode[n-1]=m}m=mxCellPath.create(r.cell);if(null==o[m]){o[m]=r;p(s,r,q,l,0);s=r.connectsAsSource.slice();q=r.connectsAsTarget.slice();for(m=0;m<s.length;m++){n=s[m];var i=n.target;null==i&&mxLog.show();r.swimlaneIndex<=i.swimlaneIndex&&this.extendedDfs(r,i,n,p,o,r.hashCode,m,l+1)}for(m=0;m<q.length;m++){n=q[m],i=n.source,r.swimlaneIndex<i.swimlaneIndex&&this.extendedDfs(r,i,n,p,o,r.hashCode,m,l+1)}}else{p(s,r,q,l,1)}}};function mxHierarchicalLayoutStage(){}mxHierarchicalLayoutStage.prototype.execute=function(b){};function mxMedianHybridCrossingReduction(b){this.layout=b}mxMedianHybridCrossingReduction.prototype=new mxHierarchicalLayoutStage;mxMedianHybridCrossingReduction.prototype.constructor=mxMedianHybridCrossingReduction;mxMedianHybridCrossingReduction.prototype.layout=null;mxMedianHybridCrossingReduction.prototype.maxIterations=24;mxMedianHybridCrossingReduction.prototype.nestedBestRanks=null;mxMedianHybridCrossingReduction.prototype.currentBestCrossings=0;mxMedianHybridCrossingReduction.prototype.iterationsWithoutImprovement=0;mxMedianHybridCrossingReduction.prototype.maxNoImprovementIterations=2;mxMedianHybridCrossingReduction.prototype.execute=function(k){k=this.layout.getModel();this.nestedBestRanks=[];for(var i=0;i<k.ranks.length;i++){this.nestedBestRanks[i]=k.ranks[i].slice()}for(var q=0,p=this.calculateCrossings(k),i=0;i<this.maxIterations&&q<this.maxNoImprovementIterations;i++){this.weightedMedian(i,k);this.transpose(i,k);var o=this.calculateCrossings(k);if(o<p){p=o;for(o=q=0;o<this.nestedBestRanks.length;o++){for(var n=k.ranks[o],m=0;m<n.length;m++){var l=n[m];this.nestedBestRanks[o][l.getGeneralPurposeVariable(o)]=l}}}else{q++;for(o=0;o<this.nestedBestRanks.length;o++){n=k.ranks[o];for(m=0;m<n.length;m++){l=n[m],l.setGeneralPurposeVariable(o,m)}}}if(0==p){break}}q=[];p=[];for(i=0;i<k.maxRank+1;i++){p[i]=[],q[i]=p[i]}for(i=0;i<this.nestedBestRanks.length;i++){for(o=0;o<this.nestedBestRanks[i].length;o++){p[i].push(this.nestedBestRanks[i][o])}}k.ranks=q};mxMedianHybridCrossingReduction.prototype.calculateCrossings=function(f){for(var e=f.ranks.length,h=0,g=1;g<e;g++){h+=this.calculateRankCrossing(g,f)}return h};mxMedianHybridCrossingReduction.prototype.calculateRankCrossing=function(y,x){for(var w=0,v=x.ranks[y],u=v.length,t=x.ranks[y-1].length,s=[],r=0;r<u;r++){s[r]=[]}for(r=0;r<v.length;r++){for(var q=v[r],p=q.getGeneralPurposeVariable(y),o=q.getPreviousLayerConnectedCells(y),q=0;q<o.length;q++){var i=o[q].getGeneralPurposeVariable(y-1);s[p][i]=201207}}for(r=0;r<u;r++){for(q=0;q<t;q++){if(201207==s[r][q]){for(v=r+1;v<u;v++){for(p=0;p<q;p++){201207==s[v][p]&&w++}}for(v=0;v<r;v++){for(p=q+1;p<t;p++){201207==s[v][p]&&w++}}}}}return w/2};mxMedianHybridCrossingReduction.prototype.transpose=function(U,T){for(var S=!0,R=0;S&&10>R++;){for(var Q=1==U%2&&1==R%2,S=!1,P=0;P<T.ranks.length;P++){for(var O=T.ranks[P],N=[],M=0;M<O.length;M++){var L=O[M],K=L.getGeneralPurposeVariable(P);0>K&&(K=M);N[K]=L}for(var J=K=L=null,I=null,H=null,F=null,G=null,E=null,D=null,C=null,M=0;M<O.length-1;M++){if(0==M){for(var D=N[M],L=D.getNextLayerConnectedCells(P),K=D.getPreviousLayerConnectedCells(P),H=[],F=[],B=0;B<L.length;B++){H[B]=L[B].getGeneralPurposeVariable(P+1)}for(B=0;B<K.length;B++){F[B]=K[B].getGeneralPurposeVariable(P-1)}}else{L=J,K=I,H=G,F=E,D=C}C=N[M+1];J=C.getNextLayerConnectedCells(P);I=C.getPreviousLayerConnectedCells(P);G=[];E=[];for(B=0;B<J.length;B++){G[B]=J[B].getGeneralPurposeVariable(P+1)}for(B=0;B<I.length;B++){E[B]=I[B].getGeneralPurposeVariable(P-1)}for(var o=0,i=0,B=0;B<H.length;B++){for(var A=0;A<G.length;A++){H[B]>G[A]&&o++,H[B]<G[A]&&i++}}for(B=0;B<F.length;B++){for(A=0;A<E.length;A++){F[B]>E[A]&&o++,F[B]<E[A]&&i++}}if(i<o||i==o&&Q){J=D.getGeneralPurposeVariable(P),D.setGeneralPurposeVariable(P,C.getGeneralPurposeVariable(P)),C.setGeneralPurposeVariable(P,J),J=L,I=K,G=H,E=F,C=D,Q||(S=!0)}}}}};mxMedianHybridCrossingReduction.prototype.weightedMedian=function(f,e){var h=0==f%2;if(h){for(var g=e.maxRank-1;0<=g;g--){this.medianRank(g,h)}}else{for(g=1;g<e.maxRank;g++){this.medianRank(g,h)}}};mxMedianHybridCrossingReduction.prototype.medianRank=function(u,t){for(var s=this.nestedBestRanks[u].length,r=[],q=[],p=0;p<s;p++){var o=this.nestedBestRanks[u][p],n=new MedianCellSorter;n.cell=o;var m;m=t?o.getNextLayerConnectedCells(u):o.getPreviousLayerConnectedCells(u);var i;i=t?u+1:u-1;null!=m&&0!=m.length?(n.medianValue=this.medianValue(m,i),r.push(n)):q[o.getGeneralPurposeVariable(u)]=!0}r.sort(MedianCellSorter.prototype.compare);for(p=0;p<s;p++){null==q[p]&&(o=r.shift().cell,o.setGeneralPurposeVariable(u,p))}};mxMedianHybridCrossingReduction.prototype.medianValue=function(h,g){for(var m=[],l=0,k=0;k<h.length;k++){var i=h[k];m[l++]=i.getGeneralPurposeVariable(g)}m.sort(function(d,c){return d-c});if(1==l%2){return m[Math.floor(l/2)]}if(2==l){return(m[0]+m[1])/2}k=l/2;i=m[k-1]-m[0];l=m[l-1]-m[k];return(m[k-1]*l+m[k]*i)/(i+l)};function MedianCellSorter(){}MedianCellSorter.prototype.medianValue=0;MedianCellSorter.prototype.cell=!1;MedianCellSorter.prototype.compare=function(d,c){return null!=d&&null!=c?c.medianValue>d.medianValue?-1:c.medianValue<d.medianValue?1:0:0};function mxMinimumCycleRemover(b){this.layout=b}mxMinimumCycleRemover.prototype=new mxHierarchicalLayoutStage;mxMinimumCycleRemover.prototype.constructor=mxMinimumCycleRemover;mxMinimumCycleRemover.prototype.layout=null;mxMinimumCycleRemover.prototype.execute=function(i){var h=this.layout.getModel(),o={},n=mxUtils.clone(h.vertexMapper,null,!0),m=null;if(null!=h.roots){var l=h.roots,m=[];for(i=0;i<l.length;i++){var k=mxCellPath.create(l[i]);m[i]=h.vertexMapper[k]}}h.visit(function(d,c,r,q,p){c.isAncestor(d)&&(r.invert(),mxUtils.remove(r,d.connectsAsSource),d.connectsAsTarget.push(r),mxUtils.remove(r,c.connectsAsTarget),c.connectsAsSource.push(r));d=mxCellPath.create(c.cell);o[d]=c;delete n[d]},m,!0,null);m=null;0<n.lenth&&(m=mxUtils.clone(n,null,!0));i=mxUtils.clone(o,null,!0);h.visit(function(d,c,r,q,p){c.isAncestor(d)&&(r.invert(),mxUtils.remove(r,d.connectsAsSource),c.connectsAsSource.push(r),d.connectsAsTarget.push(r),mxUtils.remove(r,c.connectsAsTarget));d=mxCellPath.create(c.cell);o[d]=c;delete n[d]},n,!0,i);l=this.layout.getGraph();if(null!=m&&0<m.length){h=h.roots;for(i=0;i<m.length;i++){k=m[i].cell,0==l.getIncomingEdges(k).length&&h.push(k)}}};function mxCoordinateAssignment(h,g,m,l,k,i){this.layout=h;this.intraCellSpacing=g;this.interRankCellSpacing=m;this.orientation=l;this.initialX=k;this.parallelEdgeSpacing=i}var mxHierarchicalEdgeStyle={ORTHOGONAL:1,POLYLINE:2,STRAIGHT:3,CURVE:4};mxCoordinateAssignment.prototype=new mxHierarchicalLayoutStage;mxCoordinateAssignment.prototype.constructor=mxCoordinateAssignment;mxCoordinateAssignment.prototype.layout=null;mxCoordinateAssignment.prototype.intraCellSpacing=30;mxCoordinateAssignment.prototype.interRankCellSpacing=100;mxCoordinateAssignment.prototype.parallelEdgeSpacing=10;mxCoordinateAssignment.prototype.maxIterations=8;mxCoordinateAssignment.prototype.prefHozEdgeSep=5;mxCoordinateAssignment.prototype.prefVertEdgeOff=2;mxCoordinateAssignment.prototype.minEdgeJetty=12;mxCoordinateAssignment.prototype.channelBuffer=4;mxCoordinateAssignment.prototype.jettyPositions=null;mxCoordinateAssignment.prototype.orientation=mxConstants.DIRECTION_NORTH;mxCoordinateAssignment.prototype.initialX=null;mxCoordinateAssignment.prototype.limitX=null;mxCoordinateAssignment.prototype.currentXDelta=null;mxCoordinateAssignment.prototype.widestRank=null;mxCoordinateAssignment.prototype.rankTopY=null;mxCoordinateAssignment.prototype.rankBottomY=null;mxCoordinateAssignment.prototype.widestRankValue=null;mxCoordinateAssignment.prototype.rankWidths=null;mxCoordinateAssignment.prototype.rankY=null;mxCoordinateAssignment.prototype.fineTuning=!0;mxCoordinateAssignment.prototype.edgeStyle=mxHierarchicalEdgeStyle.POLYLINE;mxCoordinateAssignment.prototype.nextLayerConnectedCache=null;mxCoordinateAssignment.prototype.previousLayerConnectedCache=null;mxCoordinateAssignment.prototype.groupPadding=10;mxCoordinateAssignment.prototype.printStatus=function(){var f=this.layout.getModel();mxLog.show();mxLog.writeln("======Coord assignment debug=======");for(var e=0;e<f.ranks.length;e++){mxLog.write("Rank ",e," : ");for(var h=f.ranks[e],g=0;g<h.length;g++){mxLog.write(h[g].getGeneralPurposeVariable(e),"  ")}mxLog.writeln()}mxLog.writeln("====================================")};mxCoordinateAssignment.prototype.execute=function(i){this.jettyPositions=[];i=this.layout.getModel();this.currentXDelta=0;this.initialCoords(this.layout.getGraph(),i);this.fineTuning&&this.minNode(i);var h=100000000;if(this.fineTuning){for(var o=0;o<this.maxIterations;o++){0!=o&&(this.medianPos(o,i),this.minNode(i));if(this.currentXDelta<h){for(var n=0;n<i.ranks.length;n++){for(var m=i.ranks[n],l=0;l<m.length;l++){var k=m[l];k.setX(n,k.getGeneralPurposeVariable(n))}}h=this.currentXDelta}else{for(n=0;n<i.ranks.length;n++){m=i.ranks[n];for(l=0;l<m.length;l++){k=m[l],k.setGeneralPurposeVariable(n,k.getX(n))}}}this.minPath(this.layout.getGraph(),i);this.currentXDelta=0}}this.setCellLocations(this.layout.getGraph(),i)};mxCoordinateAssignment.prototype.minNode=function(K){for(var J=[],I=[],H=[],G=0;G<=K.maxRank;G++){H[G]=K.ranks[G];for(var F=0;F<H[G].length;F++){var E=H[G][F],D=new WeightedCellSorter(E,G);D.rankIndex=F;D.visited=!0;J.push(D);E=mxCellPath.create(E.getCoreCell());I[E]=D}}K=10*J.length;for(F=0;0<J.length&&F<=K;){var D=J.shift(),G=D.cell,C=D.weightedValue,B=parseInt(D.rankIndex),E=G.getNextLayerConnectedCells(C),A=G.getPreviousLayerConnectedCells(C),z=E.length,y=A.length,x=this.medianXValue(E,C+1),v=this.medianXValue(A,C-1),w=z+y,o=G.getGeneralPurposeVariable(C),i=o;0<w&&(i=(x*z+v*y)/w);z=!1;i<o-1?0==B?(G.setGeneralPurposeVariable(C,i),z=!0):(B=H[C][B-1],o=B.getGeneralPurposeVariable(C),o=o+B.width/2+this.intraCellSpacing+G.width/2,o<i?(G.setGeneralPurposeVariable(C,i),z=!0):o<G.getGeneralPurposeVariable(C)-1&&(G.setGeneralPurposeVariable(C,o),z=!0)):i>o+1&&(B==H[C].length-1?(G.setGeneralPurposeVariable(C,i),z=!0):(B=H[C][B+1],o=B.getGeneralPurposeVariable(C),o=o-B.width/2-this.intraCellSpacing-G.width/2,o>i?(G.setGeneralPurposeVariable(C,i),z=!0):o>G.getGeneralPurposeVariable(C)+1&&(G.setGeneralPurposeVariable(C,o),z=!0)));if(z){for(G=0;G<E.length;G++){C=E[G],C=mxCellPath.create(C.getCoreCell()),C=I[C],null!=C&&!1==C.visited&&(C.visited=!0,J.push(C))}for(G=0;G<A.length;G++){C=A[G],C=mxCellPath.create(C.getCoreCell()),C=I[C],null!=C&&!1==C.visited&&(C.visited=!0,J.push(C))}}D.visited=!1;F++}};mxCoordinateAssignment.prototype.medianPos=function(e,d){if(0==e%2){for(var f=d.maxRank;0<f;f--){this.rankMedianPosition(f-1,d,f)}}else{for(f=0;f<d.maxRank-1;f++){this.rankMedianPosition(f+1,d,f)}}};mxCoordinateAssignment.prototype.rankMedianPosition=function(C,B,A){B=B.ranks[C];for(var z=[],y=[],x=0;x<B.length;x++){var w=B[x];z[x]=new WeightedCellSorter;z[x].cell=w;z[x].rankIndex=x;var v=mxCellPath.create(w.getCoreCell());y[v]=z[x];var u=null,u=A<C?w.getPreviousLayerConnectedCells(C):w.getNextLayerConnectedCells(C);z[x].weightedValue=this.calculatedWeightedValue(w,u)}z.sort(WeightedCellSorter.prototype.compare);for(x=0;x<z.length;x++){v=0;w=z[x].cell;v=0;u=A<C?w.getPreviousLayerConnectedCells(C).slice():w.getNextLayerConnectedCells(C).slice();null!=u&&(v=u.length,v=0<v?this.medianXValue(u,A):w.getGeneralPurposeVariable(C));for(var t=0,u=-100000000,s=z[x].rankIndex-1;0<=s;){var r=mxCellPath.create(B[s].getCoreCell()),r=y[r];if(null!=r){var o=r.cell;r.visited?(u=o.getGeneralPurposeVariable(C)+o.width/2+this.intraCellSpacing+t+w.width/2,s=-1):(t+=o.width+this.intraCellSpacing,s--)}}t=0;o=100000000;for(s=z[x].rankIndex+1;s<z.length;){if(r=mxCellPath.create(B[s].getCoreCell()),r=y[r],null!=r){var i=r.cell;r.visited?(o=i.getGeneralPurposeVariable(C)-i.width/2-this.intraCellSpacing-t-w.width/2,s=z.length):(t+=i.width+this.intraCellSpacing,s++)}}v>=u&&v<=o?w.setGeneralPurposeVariable(C,v):v<u?(w.setGeneralPurposeVariable(C,u),this.currentXDelta+=u-v):v>o&&(w.setGeneralPurposeVariable(C,o),this.currentXDelta+=v-o);z[x].visited=!0}};mxCoordinateAssignment.prototype.calculatedWeightedValue=function(g,f){for(var k=0,i=0;i<f.length;i++){var h=f[i];g.isVertex()&&h.isVertex()?k++:k=g.isEdge()&&h.isEdge()?k+8:k+2}return k};mxCoordinateAssignment.prototype.medianXValue=function(f,e){if(0==f.length){return 0}for(var h=[],g=0;g<f.length;g++){h[g]=f[g].getGeneralPurposeVariable(e)}h.sort(function(d,c){return d-c});if(1==f.length%2){return h[Math.floor(f.length/2)]}g=f.length/2;return(h[g-1]+h[g])/2};mxCoordinateAssignment.prototype.initialCoords=function(e,d){this.calculateWidestRank(e,d);for(var f=this.widestRank;0<=f;f--){f<d.maxRank&&this.rankCoordinates(f,e,d)}for(f=this.widestRank+1;f<=d.maxRank;f++){0<f&&this.rankCoordinates(f,e,d)}};mxCoordinateAssignment.prototype.rankCoordinates=function(k,i,q){i=q.ranks[k];q=0;for(var p=this.initialX+(this.widestRankValue-this.rankWidths[k])/2,o=!1,n=0;n<i.length;n++){var m=i[n];if(m.isVertex()){var l=this.layout.getVertexBounds(m.cell);null!=l?this.orientation==mxConstants.DIRECTION_NORTH||this.orientation==mxConstants.DIRECTION_SOUTH?(m.width=l.width,m.height=l.height):(m.width=l.height,m.height=l.width):o=!0;q=Math.max(q,m.height)}else{m.isEdge()&&(l=1,null!=m.edges?l=m.edges.length:mxLog.warn("edge.edges is null"),m.width=(l-1)*this.parallelEdgeSpacing)}p+=m.width/2;m.setX(k,p);m.setGeneralPurposeVariable(k,p);p+=m.width/2;p+=this.intraCellSpacing}!0==o&&mxLog.warn("At least one cell has no bounds")};mxCoordinateAssignment.prototype.calculateWidestRank=function(y,x){var w=-this.interRankCellSpacing,v=0;this.rankWidths=[];this.rankY=[];for(var u=x.maxRank;0<=u;u--){for(var t=0,s=x.ranks[u],r=this.initialX,q=!1,p=0;p<s.length;p++){var o=s[p];if(o.isVertex()){var i=this.layout.getVertexBounds(o.cell);null!=i?this.orientation==mxConstants.DIRECTION_NORTH||this.orientation==mxConstants.DIRECTION_SOUTH?(o.width=i.width,o.height=i.height):(o.width=i.height,o.height=i.width):q=!0;t=Math.max(t,o.height)}else{o.isEdge()&&(i=1,null!=o.edges?i=o.edges.length:mxLog.warn("edge.edges is null"),o.width=(i-1)*this.parallelEdgeSpacing)}r+=o.width/2;o.setX(u,r);o.setGeneralPurposeVariable(u,r);r+=o.width/2;r+=this.intraCellSpacing;r>this.widestRankValue&&(this.widestRankValue=r,this.widestRank=u);this.rankWidths[u]=r}!0==q&&mxLog.warn("At least one cell has no bounds");this.rankY[u]=w;r=t/2+v/2+this.interRankCellSpacing;v=t;w=this.orientation==mxConstants.DIRECTION_NORTH||this.orientation==mxConstants.DIRECTION_WEST?w+r:w-r;for(p=0;p<s.length;p++){s[p].setY(u,w)}}};mxCoordinateAssignment.prototype.minPath=function(A,z){var y=z.edgeMapper,x;for(x in y){var w=y[x];if(!(1>w.maxRank-w.minRank-1)){for(var v=w.getGeneralPurposeVariable(w.minRank+1),u=!0,t=0,s=w.minRank+2;s<w.maxRank;s++){var r=w.getGeneralPurposeVariable(s);v!=r?(u=!1,v=r):t++}if(!u){for(var u=v=0,r=[],q=[],o=w.getGeneralPurposeVariable(w.minRank+1),s=w.minRank+1;s<w.maxRank-1;s++){var i=w.getX(s+1);o==i?(r[s-w.minRank-1]=o,v++):this.repositionValid(z,w,s+1,o)?(r[s-w.minRank-1]=o,v++):o=r[s-w.minRank-1]=i}o=w.getX(s);for(s=w.maxRank-1;s>w.minRank+1;s--){i=w.getX(s-1),o==i?(q[s-w.minRank-2]=o,u++):this.repositionValid(z,w,s-1,o)?(q[s-w.minRank-2]=o,u++):(q[s-w.minRank-2]=w.getX(s-1),o=i)}if(u>t||v>t){if(u>=v){for(s=w.maxRank-2;s>w.minRank;s--){w.setX(s,q[s-w.minRank-1])}}else{if(v>u){for(s=w.minRank+2;s<w.maxRank;s++){w.setX(s,r[s-w.minRank-2])}}}}}}}};mxCoordinateAssignment.prototype.repositionValid=function(h,g,m,l){h=h.ranks[m];for(var k=-1,i=0;i<h.length;i++){if(g==h[i]){k=i;break}}if(0>k){return !1}i=g.getGeneralPurposeVariable(m);if(l<i){if(0==k){return !0}h=h[k-1];m=h.getGeneralPurposeVariable(m);m=m+h.width/2+this.intraCellSpacing+g.width/2;if(!(m<=l)){return !1}}else{if(l>i){if(k==h.length-1){return !0}h=h[k+1];m=h.getGeneralPurposeVariable(m);m=m-h.width/2-this.intraCellSpacing-g.width/2;if(!(m>=l)){return !1}}}return !0};mxCoordinateAssignment.prototype.setCellLocations=function(k,i){this.rankTopY=[];this.rankBottomY=[];for(var q=0;q<i.ranks.length;q++){this.rankTopY[q]=Number.MAX_VALUE,this.rankBottomY[q]=0}q=null;this.layout.resizeParent&&(q={});var p=i.edgeMapper,o=i.vertexMapper,n;for(n in o){var m=o[n];this.setVertexLocation(m);if(this.layout.resizeParent){var m=k.model.getParent(m.cell),l=mxCellPath.create(m);null==q[l]&&(q[l]=m)}}this.layout.resizeParent&&null!=q&&this.adjustParents(q);(this.edgeStyle==mxHierarchicalEdgeStyle.ORTHOGONAL||this.edgeStyle==mxHierarchicalEdgeStyle.POLYLINE||this.edgeStyle==mxHierarchicalEdgeStyle.CURVE)&&this.localEdgeProcessing(i);for(n in p){this.setEdgePosition(p[n])}};mxCoordinateAssignment.prototype.adjustParents=function(e){var d=[],f;for(f in e){d.push(e[f])}this.layout.arrangeGroups(mxUtils.sortCells(d,!0),this.groupPadding)};mxCoordinateAssignment.prototype.localEdgeProcessing=function(F){for(var E=0;E<F.ranks.length;E++){for(var D=F.ranks[E],C=0;C<D.length;C++){var B=D[C];if(B.isVertex()){for(var A=B.getPreviousLayerConnectedCells(E),z=E-1,y=0;2>y;y++){if(-1<z&&z<F.ranks.length&&null!=A&&0<A.length){for(var x=[],w=0;w<A.length;w++){var v=new WeightedCellSorter(A[w],A[w].getX(z));x.push(v)}x.sort(WeightedCellSorter.prototype.compare);for(var v=B.x[0]-B.width/2,u=v+B.width,t=A=0,z=[],w=0;w<x.length;w++){var o=x[w].cell,G;if(o.isVertex()){G=0==y?B.connectsAsSource:B.connectsAsTarget;for(var i=0;i<G.length;i++){if(G[i].source==o||G[i].target==o){A+=G[i].edges.length,t++,z.push(G[i])}}}else{A+=o.edges.length,t++,z.push(o)}}B.width>(A+1)*this.prefHozEdgeSep+2*this.prefHozEdgeSep&&(v+=this.prefHozEdgeSep,u-=this.prefHozEdgeSep);x=(u-v)/A;v+=x/2;u=this.minEdgeJetty-this.prefVertEdgeOff;for(w=t=0;w<z.length;w++){o=z[w].edges.length;i=mxCellPath.create(z[w].edges[0]);G=this.jettyPositions[i];null==G&&(G=[],this.jettyPositions[i]=G);w<A/2?u+=this.prefVertEdgeOff:w>A/2&&(u-=this.prefVertEdgeOff);for(i=0;i<o;i++){G[4*i+2*y]=v,v+=x,G[4*i+2*y+1]=u}t=Math.max(t,u)}}A=B.getNextLayerConnectedCells(E);z=E+1}}}}};mxCoordinateAssignment.prototype.setEdgePosition=function(O){var N=0;if(101207!=O.temp[0]){var M=O.maxRank,L=O.minRank;M==L&&(M=O.source.maxRank,L=O.target.minRank);for(var K=0,J=mxCellPath.create(O.edges[0]),J=this.jettyPositions[J],I=O.isReversed?O.target.cell:O.source.cell,H=this.layout.graph,G=0;G<O.edges.length;G++){var F=O.edges[G],E=this.layout.getVisibleTerminal(F,!0),D=H.model.getTerminal(F,!0),C=[],B=O.isReversed;E!=I&&(B=!B);if(null!=J){var z=B?2:0,A=B?this.rankTopY[L]:this.rankBottomY[M],y=J[4*K+1+z];B&&(y=-y);A+=y;z=J[4*K+z];D=H.model.getTerminal(F,!0);this.layout.isPort(D)&&H.model.getParent(D)==E&&(z=H.view.getState(D),z=null!=z?z.x:E.geometry.x+O.source.width*D.geometry.x);this.orientation==mxConstants.DIRECTION_NORTH||this.orientation==mxConstants.DIRECTION_SOUTH?(C.push(new mxPoint(z,A)),this.edgeStyle==mxHierarchicalEdgeStyle.CURVE&&C.push(new mxPoint(z,A+y))):(C.push(new mxPoint(A,z)),this.edgeStyle==mxHierarchicalEdgeStyle.CURVE&&C.push(new mxPoint(A+y,z)))}z=O.x.length-1;A=y=-1;E=O.maxRank-1;B&&(z=0,y=O.x.length,A=1,E=O.minRank+1);for(;O.maxRank!=O.minRank&&z!=y;z+=A){var D=O.x[z]+N,x=(this.rankTopY[E]+this.rankBottomY[E+1])/2,o=(this.rankTopY[E-1]+this.rankBottomY[E])/2;if(B){var i=x,x=o,o=i}this.orientation==mxConstants.DIRECTION_NORTH||this.orientation==mxConstants.DIRECTION_SOUTH?(C.push(new mxPoint(D,x)),C.push(new mxPoint(D,o))):(C.push(new mxPoint(x,D)),C.push(new mxPoint(o,D)));this.limitX=Math.max(this.limitX,D);E+=A}null!=J&&(z=B?2:0,A=B?this.rankBottomY[M]:this.rankTopY[L],y=J[4*K+3-z],B&&(y=-y),A-=y,z=J[4*K+2-z],B=H.model.getTerminal(F,!1),E=this.layout.getVisibleTerminal(F,!1),this.layout.isPort(B)&&H.model.getParent(B)==E&&(z=H.view.getState(B),z=null!=z?z.x:E.geometry.x+O.target.width*B.geometry.x),this.orientation==mxConstants.DIRECTION_NORTH||this.orientation==mxConstants.DIRECTION_SOUTH?(this.edgeStyle==mxHierarchicalEdgeStyle.CURVE&&C.push(new mxPoint(z,A-y)),C.push(new mxPoint(z,A))):(this.edgeStyle==mxHierarchicalEdgeStyle.CURVE&&C.push(new mxPoint(A-y,z)),C.push(new mxPoint(A,z))));O.isReversed&&this.processReversedEdge(O,F);this.layout.setEdgePoints(F,C);N=0==N?this.parallelEdgeSpacing:0<N?-N:-N+this.parallelEdgeSpacing;K++}O.temp[0]=101207}};mxCoordinateAssignment.prototype.setVertexLocation=function(f){var e=f.cell,h=f.x[0]-f.width/2,g=f.y[0]-f.height/2;this.rankTopY[f.minRank]=Math.min(this.rankTopY[f.minRank],g);this.rankBottomY[f.minRank]=Math.max(this.rankBottomY[f.minRank],g+f.height);this.orientation==mxConstants.DIRECTION_NORTH||this.orientation==mxConstants.DIRECTION_SOUTH?this.layout.setVertexLocation(e,h,g):this.layout.setVertexLocation(e,g,h);this.limitX=Math.max(this.limitX,h+f.width)};mxCoordinateAssignment.prototype.processReversedEdge=function(d,c){};function WeightedCellSorter(d,c){this.cell=d;this.weightedValue=c}WeightedCellSorter.prototype.weightedValue=0;WeightedCellSorter.prototype.nudge=!1;WeightedCellSorter.prototype.visited=!1;WeightedCellSorter.prototype.rankIndex=null;WeightedCellSorter.prototype.cell=null;WeightedCellSorter.prototype.compare=function(d,c){return null!=d&&null!=c?c.weightedValue>d.weightedValue?-1:c.weightedValue<d.weightedValue?1:c.nudge?-1:1:0};function mxSwimlaneOrdering(b){this.layout=b}mxSwimlaneOrdering.prototype=new mxHierarchicalLayoutStage;mxSwimlaneOrdering.prototype.constructor=mxSwimlaneOrdering;mxSwimlaneOrdering.prototype.layout=null;mxSwimlaneOrdering.prototype.execute=function(h){h=this.layout.getModel();var g=mxUtils.clone(h.vertexMapper,null,!0),m=null;if(null!=h.roots){for(var l=h.roots,m=[],k=0;k<l.length;k++){var i=mxCellPath.create(l[k]);m[k]=h.vertexMapper[i]}}h.visit(function(b,q,p,o,n){o=null!=b&&b.swimlaneIndex==q.swimlaneIndex&&q.isAncestor(b);n=null!=b&&null!=p&&b.swimlaneIndex<q.swimlaneIndex&&p.source==q;o?(p.invert(),mxUtils.remove(p,b.connectsAsSource),q.connectsAsSource.push(p),b.connectsAsTarget.push(p),mxUtils.remove(p,q.connectsAsTarget)):n&&(p.invert(),mxUtils.remove(p,b.connectsAsTarget),q.connectsAsTarget.push(p),b.connectsAsSource.push(p),mxUtils.remove(p,q.connectsAsSource));b=mxCellPath.create(q.cell);delete g[b]},m,!0,null)};function mxHierarchicalLayout(e,d,f){mxGraphLayout.call(this,e);this.orientation=null!=d?d:mxConstants.DIRECTION_NORTH;this.deterministic=null!=f?f:!0}mxHierarchicalLayout.prototype=new mxGraphLayout;mxHierarchicalLayout.prototype.constructor=mxHierarchicalLayout;mxHierarchicalLayout.prototype.roots=null;mxHierarchicalLayout.prototype.resizeParent=!1;mxHierarchicalLayout.prototype.moveParent=!1;mxHierarchicalLayout.prototype.parentBorder=0;mxHierarchicalLayout.prototype.intraCellSpacing=30;mxHierarchicalLayout.prototype.interRankCellSpacing=100;mxHierarchicalLayout.prototype.interHierarchySpacing=60;mxHierarchicalLayout.prototype.parallelEdgeSpacing=10;mxHierarchicalLayout.prototype.orientation=mxConstants.DIRECTION_NORTH;mxHierarchicalLayout.prototype.fineTuning=!0;mxHierarchicalLayout.prototype.tightenToSource=!0;mxHierarchicalLayout.prototype.disableEdgeStyle=!0;mxHierarchicalLayout.prototype.traverseAncestors=!0;mxHierarchicalLayout.prototype.model=null;mxHierarchicalLayout.prototype.edgesCache=null;mxHierarchicalLayout.prototype.getModel=function(){return this.model};mxHierarchicalLayout.prototype.execute=function(g,f){this.parent=g;var k=this.graph.model;this.edgesCache={};null!=f&&!(f instanceof Array)&&(f=[f]);if(!(null==f&&null==g)){if(null!=f&&null!=g){for(var i=[],h=0;h<f.length;h++){k.isAncestor(g,f[h])&&i.push(f[h])}this.roots=i}else{this.roots=f}k.beginUpdate();try{this.run(g),this.resizeParent&&!this.graph.isCellCollapsed(g)&&this.graph.updateGroupBounds([g],this.parentBorder,this.moveParent)}finally{k.endUpdate()}}};mxHierarchicalLayout.prototype.findRoots=function(y,x){var w=[];if(null!=y&&null!=x){var v=this.graph.model,u=null,t=-100000,s;for(s in x){var r=x[s];if(v.isVertex(r)&&this.graph.isCellVisible(r)){for(var q=this.getEdges(r),p=0,o=0,i=0;i<q.length;i++){this.getVisibleTerminal(q[i],!0)==r?p++:o++}0==o&&0<p&&w.push(r);q=p-o;q>t&&(t=q,u=r)}}0==w.length&&null!=u&&w.push(u)}return w};mxHierarchicalLayout.prototype.getEdges=function(k){var i=mxCellPath.create(k);if(null!=this.edgesCache[i]){return this.edgesCache[i]}for(var q=this.graph.model,p=[],o=this.graph.isCellCollapsed(k),n=q.getChildCount(k),m=0;m<n;m++){var l=q.getChildAt(k,m);if(this.isPort(l)){p=p.concat(q.getEdges(l,!0,!0))}else{if(o||!this.graph.isCellVisible(l)){p=p.concat(q.getEdges(l,!0,!0))}}}p=p.concat(q.getEdges(k,!0,!0));q=[];for(m=0;m<p.length;m++){o=this.getVisibleTerminal(p[m],!0),n=this.getVisibleTerminal(p[m],!1),(o==n||o!=n&&(n==k&&(null==this.parent||this.graph.isValidAncestor(o,this.parent,this.traverseAncestors))||o==k&&(null==this.parent||this.graph.isValidAncestor(n,this.parent,this.traverseAncestors))))&&q.push(p[m])}return this.edgesCache[i]=q};mxHierarchicalLayout.prototype.getVisibleTerminal=function(e,d){var f=this.graph.view.getState(e),f=null!=f?f.getVisibleTerminal(d):this.graph.view.getVisibleTerminal(e,d);this.isPort(f)&&(f=this.graph.model.getParent(f));return f};mxHierarchicalLayout.prototype.run=function(k){var i=[],q=[];if(null==this.roots&&null!=k){var p={};this.filterDescendants(k,p);this.roots=[];var o=!0,n;for(n in p){if(null!=p[n]){o=!1;break}}for(;!o;){for(var m=this.findRoots(k,p),o=0;o<m.length;o++){var l={};i.push(l);this.traverse(m[o],!0,null,q,l,i,p)}for(o=0;o<m.length;o++){this.roots.push(m[o])}o=!0;for(n in p){if(null!=p[n]){o=!1;break}}}}else{for(o=0;o<this.roots.length;o++){l={},i.push(l),this.traverse(this.roots[o],!0,null,q,l,i,null)}}for(o=q=0;o<i.length;o++){l=i[o];p=[];for(n in l){p.push(l[n])}this.model=new mxGraphHierarchyModel(this,p,this.roots,k,this.tightenToSource);this.cycleStage(k);this.layeringStage();this.crossingStage(k);q=this.placementStage(q,k)}};mxHierarchicalLayout.prototype.filterDescendants=function(h,g){var m=this.graph.model;m.isVertex(h)&&(h!=this.parent&&this.graph.isCellVisible(h))&&(g[mxCellPath.create(h)]=h);if(this.traverseAncestors||h==this.parent&&this.graph.isCellVisible(h)){for(var l=m.getChildCount(h),k=0;k<l;k++){var i=m.getChildAt(h,k);this.isPort(i)||this.filterDescendants(i,g)}}};mxHierarchicalLayout.prototype.isPort=function(b){return b.geometry.relative?!0:!1};mxHierarchicalLayout.prototype.getEdgesBetween=function(k,i,q){q=null!=q?q:!1;for(var p=this.getEdges(k),o=[],n=0;n<p.length;n++){var m=this.getVisibleTerminal(p[n],!0),l=this.getVisibleTerminal(p[n],!1);(m==k&&l==i||!q&&m==i&&l==k)&&o.push(p[n])}return o};mxHierarchicalLayout.prototype.traverse=function(s,r,q,p,o,n,m){if(null!=s&&null!=p){var l=mxCellPath.create(s);if(null==p[l]&&(null==m||null!=m[l])){null==o[l]&&(o[l]=s);null==p[l]&&(p[l]=s);null!==m&&delete m[l];var i=this.getEdges(s);for(q=0;q<i.length;q++){if(l=this.getVisibleTerminal(i[q],!0)==s,!r||l){l=this.getVisibleTerminal(i[q],!l),o=this.traverse(l,r,i[q],p,o,n,m)}}}else{if(null==o[l]){for(q=0;q<n.length;q++){if(s=n[q],null!=s[l]){for(i in s){o[i]=s[i]}n.splice(q,1);break}}}}}return o};mxHierarchicalLayout.prototype.cycleStage=function(b){(new mxMinimumCycleRemover(this)).execute(b)};mxHierarchicalLayout.prototype.layeringStage=function(){this.model.initialRank();this.model.fixRanks()};mxHierarchicalLayout.prototype.crossingStage=function(b){(new mxMedianHybridCrossingReduction(this)).execute(b)};mxHierarchicalLayout.prototype.placementStage=function(e,d){var f=new mxCoordinateAssignment(this,this.intraCellSpacing,this.interRankCellSpacing,this.orientation,e,this.parallelEdgeSpacing);f.fineTuning=this.fineTuning;f.execute(d);return f.limitX+this.interHierarchySpacing};function mxSwimlaneLayout(e,d,f){mxGraphLayout.call(this,e);this.orientation=null!=d?d:mxConstants.DIRECTION_NORTH;this.deterministic=null!=f?f:!0}mxSwimlaneLayout.prototype=new mxGraphLayout;mxSwimlaneLayout.prototype.constructor=mxSwimlaneLayout;mxSwimlaneLayout.prototype.roots=null;mxSwimlaneLayout.prototype.swimlanes=null;mxSwimlaneLayout.prototype.dummyVertices=null;mxSwimlaneLayout.prototype.dummyVertexWidth=50;mxSwimlaneLayout.prototype.resizeParent=!1;mxSwimlaneLayout.prototype.moveParent=!1;mxSwimlaneLayout.prototype.parentBorder=30;mxSwimlaneLayout.prototype.intraCellSpacing=30;mxSwimlaneLayout.prototype.interRankCellSpacing=100;mxSwimlaneLayout.prototype.interHierarchySpacing=60;mxSwimlaneLayout.prototype.parallelEdgeSpacing=10;mxSwimlaneLayout.prototype.orientation=mxConstants.DIRECTION_NORTH;mxSwimlaneLayout.prototype.fineTuning=!0;mxSwimlaneLayout.prototype.tightenToSource=!0;mxSwimlaneLayout.prototype.disableEdgeStyle=!0;mxSwimlaneLayout.prototype.traverseAncestors=!0;mxSwimlaneLayout.prototype.model=null;mxSwimlaneLayout.prototype.edgesCache=null;mxSwimlaneLayout.prototype.getModel=function(){return this.model};mxSwimlaneLayout.prototype.execute=function(g,f){this.parent=g;var k=this.graph.model;this.edgesCache={};if(!(null==f||1>f.length)){null==g&&(g=k.getParent(f[0]));this.swimlanes=f;this.dummyVertices=[];for(var i=0;i<f.length;i++){var h=this.graph.getChildCells(f[i]);if(null==h||0==h.length){h=this.graph.insertVertex(f[i],null,null,0,0,this.dummyVertexWidth,0),this.dummyVertices.push(h)}}k.beginUpdate();try{this.run(g),this.resizeParent&&!this.graph.isCellCollapsed(g)&&this.updateGroupBounds(),this.graph.removeCells(this.dummyVertices)}finally{k.endUpdate()}}};mxSwimlaneLayout.prototype.updateGroupBounds=function(){var s=[],r=this.model,q;for(q in r.edgeMapper){for(var p=r.edgeMapper[q],o=0;o<p.edges.length;o++){s.push(p.edges[o])}}s=this.graph.getBoundingBoxFromGeometry(s,!0);r=[];for(o=0;o<this.swimlanes.length;o++){var n=this.swimlanes[o];q=this.graph.getCellGeometry(n);if(null!=q){var m=this.graph.getChildCells(n),p=this.graph.isSwimlane(n)?this.graph.getStartSize(n):new mxRectangle,n=this.graph.getBoundingBoxFromGeometry(m);r[o]=n;p=n.y+q.y-p.height-this.parentBorder;q=n.y+q.y+n.height;null==s?s=new mxRectangle(0,p,0,q-p):(s.y=Math.min(s.y,p),q=Math.max(s.y+s.height,q),s.height=q-s.y)}}for(o=0;o<this.swimlanes.length;o++){if(n=this.swimlanes[o],q=this.graph.getCellGeometry(n),null!=q){var m=this.graph.getChildCells(n),p=this.graph.isSwimlane(n)?this.graph.getStartSize(n):new mxRectangle,l=q.clone(),i=0==o?this.parentBorder:this.interRankCellSpacing/2;l.x+=r[o].x-p.width-i;l.y=l.y+s.y-q.y-this.parentBorder;l.width=r[o].width+p.width+this.interRankCellSpacing/2+i;l.height=s.height+p.height+2*this.parentBorder;this.graph.model.setGeometry(n,l);this.graph.moveCells(m,-r[o].x+p.width+i,q.y-s.y+this.parentBorder)}}};mxSwimlaneLayout.prototype.findRoots=function(A,z){var y=[];if(null!=A&&null!=z){var x=this.graph.model,w=null,v=-100000,u;for(u in z){var t=z[u];if(null!=t&&x.isVertex(t)&&this.graph.isCellVisible(t)&&x.isAncestor(A,t)){for(var s=this.getEdges(t),r=0,q=0,o=0;o<s.length;o++){var i=this.getVisibleTerminal(s[o],!0);i==t?(i=this.getVisibleTerminal(s[o],!1),x.isAncestor(A,i)&&r++):x.isAncestor(A,i)&&q++}0==q&&0<r&&y.push(t);s=r-q;s>v&&(v=s,w=t)}}0==y.length&&null!=w&&y.push(w)}return y};mxSwimlaneLayout.prototype.getEdges=function(k){var i=mxCellPath.create(k);if(null!=this.edgesCache[i]){return this.edgesCache[i]}for(var q=this.graph.model,p=[],o=this.graph.isCellCollapsed(k),n=q.getChildCount(k),m=0;m<n;m++){var l=q.getChildAt(k,m);if(this.isPort(l)){p=p.concat(q.getEdges(l,!0,!0))}else{if(o||!this.graph.isCellVisible(l)){p=p.concat(q.getEdges(l,!0,!0))}}}p=p.concat(q.getEdges(k,!0,!0));q=[];for(m=0;m<p.length;m++){o=this.getVisibleTerminal(p[m],!0),n=this.getVisibleTerminal(p[m],!1),(o==n||o!=n&&(n==k&&(null==this.parent||this.graph.isValidAncestor(o,this.parent,this.traverseAncestors))||o==k&&(null==this.parent||this.graph.isValidAncestor(n,this.parent,this.traverseAncestors))))&&q.push(p[m])}return this.edgesCache[i]=q};mxSwimlaneLayout.prototype.getVisibleTerminal=function(e,d){var f=this.graph.view.getState(e),f=null!=f?f.getVisibleTerminal(d):this.graph.view.getVisibleTerminal(e,d);this.isPort(f)&&(f=this.graph.model.getParent(f));return f};mxSwimlaneLayout.prototype.run=function(s){var r=[],q=[];if(null!=this.swimlanes&&0<this.swimlanes.length&&null!=s){for(var p={},o=0;o<this.swimlanes.length;o++){this.filterDescendants(this.swimlanes[o],p)}this.roots=[];var o=!0,n;for(n in p){if(null!=p[n]){o=!1;break}}for(var m=0;!o&&m<this.swimlanes.length;){var l=this.findRoots(this.swimlanes[m],p);if(0==l.length){m++}else{for(o=0;o<l.length;o++){var i={};r.push(i);this.traverse(l[o],!0,null,q,i,r,p,m)}for(o=0;o<l.length;o++){this.roots.push(l[o])}o=!0;for(n in p){if(null!=p[n]){o=!1;break}}}}}else{for(o=0;o<this.roots.length;o++){i={},r.push(i),this.traverse(this.roots[o],!0,null,q,i,r,null)}}r=[];for(n in q){r.push(q[n])}this.model=new mxSwimlaneModel(this,r,this.roots,s,this.tightenToSource);this.cycleStage(s);this.layeringStage();this.crossingStage(s);initialX=this.placementStage(0,s)};mxSwimlaneLayout.prototype.filterDescendants=function(h,g){var m=this.graph.model;m.isVertex(h)&&(h!=this.parent&&m.getParent(h)!=this.parent&&this.graph.isCellVisible(h))&&(g[mxCellPath.create(h)]=h);if(this.traverseAncestors||h==this.parent&&this.graph.isCellVisible(h)){for(var l=m.getChildCount(h),k=0;k<l;k++){var i=m.getChildAt(h,k);this.isPort(i)||this.filterDescendants(i,g)}}};mxSwimlaneLayout.prototype.isPort=function(b){return b.geometry.relative?!0:!1};mxSwimlaneLayout.prototype.getEdgesBetween=function(k,i,q){q=null!=q?q:!1;for(var p=this.getEdges(k),o=[],n=0;n<p.length;n++){var m=this.getVisibleTerminal(p[n],!0),l=this.getVisibleTerminal(p[n],!1);(m==k&&l==i||!q&&m==i&&l==k)&&o.push(p[n])}return o};mxSwimlaneLayout.prototype.traverse=function(A,z,y,x,w,v,u,t){if(null!=A&&null!=x){var s=mxCellPath.create(A);if(null==x[s]&&(null==u||null!=u[s])){null==w[s]&&(w[s]=A);null==x[s]&&(x[s]=A);null!==u&&delete u[s];var r=this.getEdges(A),s=this.graph.model;for(y=0;y<r.length;y++){var q=this.getVisibleTerminal(r[y],!0),o=q==A;o&&(q=this.getVisibleTerminal(r[y],!1));for(var i=0,i=0;i<this.swimlanes.length&&!s.isAncestor(this.swimlanes[i],q);i++){}if(!(i>=this.swimlanes.length)&&(i>t||(!z||o)&&i==t)){w=this.traverse(q,z,r[y],x,w,v,u,i)}}}else{if(null==w[s]){for(y=0;y<v.length;y++){if(A=v[y],null!=A[s]){for(r in A){w[r]=A[r]}v.splice(y,1);break}}}}}return w};mxSwimlaneLayout.prototype.cycleStage=function(b){(new mxSwimlaneOrdering(this)).execute(b)};mxSwimlaneLayout.prototype.layeringStage=function(){this.model.initialRank();this.model.fixRanks()};mxSwimlaneLayout.prototype.crossingStage=function(b){(new mxMedianHybridCrossingReduction(this)).execute(b)};mxSwimlaneLayout.prototype.placementStage=function(e,d){var f=new mxCoordinateAssignment(this,this.intraCellSpacing,this.interRankCellSpacing,this.orientation,e,this.parallelEdgeSpacing);f.fineTuning=this.fineTuning;f.execute(d);return f.limitX+this.interHierarchySpacing};function mxGraphModel(b){this.currentEdit=this.createUndoableEdit();null!=b?this.setRoot(b):this.clear()}mxGraphModel.prototype=new mxEventSource;mxGraphModel.prototype.constructor=mxGraphModel;mxGraphModel.prototype.root=null;mxGraphModel.prototype.cells=null;mxGraphModel.prototype.maintainEdgeParent=!0;mxGraphModel.prototype.createIds=!0;mxGraphModel.prototype.prefix="";mxGraphModel.prototype.postfix="";mxGraphModel.prototype.nextId=0;mxGraphModel.prototype.currentEdit=null;mxGraphModel.prototype.updateLevel=0;mxGraphModel.prototype.endingUpdate=!1;mxGraphModel.prototype.clear=function(){this.setRoot(this.createRoot())};mxGraphModel.prototype.isCreateIds=function(){return this.createIds};mxGraphModel.prototype.setCreateIds=function(b){this.createIds=b};mxGraphModel.prototype.createRoot=function(){var b=new mxCell;b.insert(new mxCell);return b};mxGraphModel.prototype.getCell=function(b){return null!=this.cells?this.cells[b]:null};mxGraphModel.prototype.filterCells=function(f,e){var h=null;if(null!=f){for(var h=[],g=0;g<f.length;g++){e(f[g])&&h.push(f[g])}}return h};mxGraphModel.prototype.getDescendants=function(b){return this.filterDescendants(null,b)};mxGraphModel.prototype.filterDescendants=function(h,g){var m=[];g=g||this.getRoot();(null==h||h(g))&&m.push(g);for(var l=this.getChildCount(g),k=0;k<l;k++){var i=this.getChildAt(g,k),m=m.concat(this.filterDescendants(h,i))}return m};mxGraphModel.prototype.getRoot=function(d){var c=d||this.root;if(null!=d){for(;null!=d;){c=d,d=this.getParent(d)}}return c};mxGraphModel.prototype.setRoot=function(b){this.execute(new mxRootChange(this,b));return b};mxGraphModel.prototype.rootChanged=function(d){var c=this.root;this.root=d;this.nextId=0;this.cells=null;this.cellAdded(d);return c};mxGraphModel.prototype.isRoot=function(b){return null!=b&&this.root==b};mxGraphModel.prototype.isLayer=function(b){return this.isRoot(this.getParent(b))};mxGraphModel.prototype.isAncestor=function(d,c){for(;null!=c&&c!=d;){c=this.getParent(c)}return c==d};mxGraphModel.prototype.contains=function(b){return this.isAncestor(this.root,b)};mxGraphModel.prototype.getParent=function(b){return null!=b?b.getParent():null};mxGraphModel.prototype.add=function(f,e,h){if(e!=f&&null!=f&&null!=e){null==h&&(h=this.getChildCount(f));var g=f!=this.getParent(e);this.execute(new mxChildChange(this,f,e,h));this.maintainEdgeParent&&g&&this.updateEdgeParents(e)}return e};mxGraphModel.prototype.cellAdded=function(e){if(null!=e){null==e.getId()&&this.createIds&&e.setId(this.createId(e));if(null!=e.getId()){var d=this.getCell(e.getId());if(d!=e){for(;null!=d;){e.setId(this.createId(e)),d=this.getCell(e.getId())}null==this.cells&&(this.cells={});this.cells[e.getId()]=e}}mxUtils.isNumeric(e.getId())&&(this.nextId=Math.max(this.nextId,e.getId()));for(var d=this.getChildCount(e),f=0;f<d;f++){this.cellAdded(this.getChildAt(e,f))}}};mxGraphModel.prototype.createId=function(b){b=this.nextId;this.nextId++;return this.prefix+b+this.postfix};mxGraphModel.prototype.updateEdgeParents=function(g,f){f=f||this.getRoot(g);for(var k=this.getChildCount(g),i=0;i<k;i++){var h=this.getChildAt(g,i);this.updateEdgeParents(h,f)}h=this.getEdgeCount(g);k=[];for(i=0;i<h;i++){k.push(this.getEdgeAt(g,i))}for(i=0;i<k.length;i++){h=k[i],this.isAncestor(f,h)&&this.updateEdgeParent(h,f)}};mxGraphModel.prototype.updateEdgeParent=function(i,h){for(var o=this.getTerminal(i,!0),n=this.getTerminal(i,!1),m=null;null!=o&&!this.isEdge(o)&&null!=o.geometry&&o.geometry.relative;){o=this.getParent(o)}for(;null!=n&&!this.isEdge(n)&&null!=n.geometry&&n.geometry.relative;){n=this.getParent(n)}if(this.isAncestor(h,o)&&this.isAncestor(h,n)&&(m=o==n?this.getParent(o):this.getNearestCommonAncestor(o,n),null!=m&&(this.getParent(m)!=this.root||this.isAncestor(m,i))&&this.getParent(i)!=m)){o=this.getGeometry(i);if(null!=o){var l=this.getOrigin(this.getParent(i)),k=this.getOrigin(m),n=k.x-l.x,l=k.y-l.y,o=o.clone();o.translate(-n,-l);this.setGeometry(i,o)}this.add(m,i,this.getChildCount(m))}};mxGraphModel.prototype.getOrigin=function(d){var c=null;null!=d?(c=this.getOrigin(this.getParent(d)),this.isEdge(d)||(d=this.getGeometry(d),null!=d&&(c.x+=d.x,c.y+=d.y))):c=new mxPoint;return c};mxGraphModel.prototype.getNearestCommonAncestor=function(h,g){if(null!=h&&null!=g){var m=mxCellPath.create(g);if(null!=m&&0<m.length){var l=h,k=mxCellPath.create(l);if(m.length<k.length){var l=g,i=k,k=m,m=i}for(;null!=l;){i=this.getParent(l);if(0==m.indexOf(k+mxCellPath.PATH_SEPARATOR)&&null!=i){return l}k=mxCellPath.getParentPath(k);l=i}}}return null};mxGraphModel.prototype.remove=function(b){b==this.root?this.setRoot(null):null!=this.getParent(b)&&this.execute(new mxChildChange(this,null,b));return b};mxGraphModel.prototype.cellRemoved=function(d){if(null!=d&&null!=this.cells){for(var c=this.getChildCount(d)-1;0<=c;c--){this.cellRemoved(this.getChildAt(d,c))}null!=this.cells&&null!=d.getId()&&delete this.cells[d.getId()]}};mxGraphModel.prototype.parentForCellChanged=function(f,e,h){var g=this.getParent(f);null!=e?(e!=g||g.getIndex(f)!=h)&&e.insert(f,h):null!=g&&(h=g.getIndex(f),g.remove(h));!this.contains(g)&&null!=e?this.cellAdded(f):null==e&&this.cellRemoved(f);return g};mxGraphModel.prototype.getChildCount=function(b){return null!=b?b.getChildCount():0};mxGraphModel.prototype.getChildAt=function(d,c){return null!=d?d.getChildAt(c):null};mxGraphModel.prototype.getChildren=function(b){return null!=b?b.children:null};mxGraphModel.prototype.getChildVertices=function(b){return this.getChildCells(b,!0,!1)};mxGraphModel.prototype.getChildEdges=function(b){return this.getChildCells(b,!1,!0)};mxGraphModel.prototype.getChildCells=function(i,h,o){h=null!=h?h:!1;o=null!=o?o:!1;for(var n=this.getChildCount(i),m=[],l=0;l<n;l++){var k=this.getChildAt(i,l);(!o&&!h||o&&this.isEdge(k)||h&&this.isVertex(k))&&m.push(k)}return m};mxGraphModel.prototype.getTerminal=function(d,c){return null!=d?d.getTerminal(c):null};mxGraphModel.prototype.setTerminal=function(f,e,h){var g=e!=this.getTerminal(f,h);this.execute(new mxTerminalChange(this,f,e,h));this.maintainEdgeParent&&g&&this.updateEdgeParent(f,this.getRoot());return e};mxGraphModel.prototype.setTerminals=function(e,d,f){this.beginUpdate();try{this.setTerminal(e,d,!0),this.setTerminal(e,f,!1)}finally{this.endUpdate()}};mxGraphModel.prototype.terminalForCellChanged=function(f,e,h){var g=this.getTerminal(f,h);null!=e?e.insertEdge(f,h):null!=g&&g.removeEdge(f,h);return g};mxGraphModel.prototype.getEdgeCount=function(b){return null!=b?b.getEdgeCount():0};mxGraphModel.prototype.getEdgeAt=function(d,c){return null!=d?d.getEdgeAt(c):null};mxGraphModel.prototype.getDirectedEdgeCount=function(i,h,o){for(var n=0,m=this.getEdgeCount(i),l=0;l<m;l++){var k=this.getEdgeAt(i,l);k!=o&&this.getTerminal(k,h)==i&&n++}return n};mxGraphModel.prototype.getConnections=function(b){return this.getEdges(b,!0,!0,!1)};mxGraphModel.prototype.getIncomingEdges=function(b){return this.getEdges(b,!0,!1,!1)};mxGraphModel.prototype.getOutgoingEdges=function(b){return this.getEdges(b,!1,!0,!1)};mxGraphModel.prototype.getEdges=function(u,t,s,r){t=null!=t?t:!0;s=null!=s?s:!0;r=null!=r?r:!0;for(var q=this.getEdgeCount(u),p=[],o=0;o<q;o++){var n=this.getEdgeAt(u,o),m=this.getTerminal(n,!0),i=this.getTerminal(n,!1);(r&&m==i||m!=i&&(t&&i==u||s&&m==u))&&p.push(n)}return p};mxGraphModel.prototype.getEdgesBetween=function(w,v,u){u=null!=u?u:!1;var t=this.getEdgeCount(w),s=this.getEdgeCount(v),r=w,q=t;s<t&&(q=s,r=v);t=[];for(s=0;s<q;s++){var p=this.getEdgeAt(r,s),o=this.getTerminal(p,!0),n=this.getTerminal(p,!1),i=n==w&&o==v;(o==w&&n==v||!u&&i)&&t.push(p)}return t};mxGraphModel.prototype.getOpposites=function(k,i,q,p){q=null!=q?q:!0;p=null!=p?p:!0;var o=[];if(null!=k){for(var n=0;n<k.length;n++){var m=this.getTerminal(k[n],!0),l=this.getTerminal(k[n],!1);m==i&&null!=l&&l!=i&&p?o.push(l):l==i&&(null!=m&&m!=i&&q)&&o.push(m)}}return o};mxGraphModel.prototype.getTopmostCells=function(h){for(var g=[],m=0;m<h.length;m++){for(var l=h[m],k=!0,i=this.getParent(l);null!=i;){if(0<=mxUtils.indexOf(h,i)){k=!1;break}i=this.getParent(i)}k&&g.push(l)}return g};mxGraphModel.prototype.isVertex=function(b){return null!=b?b.isVertex():!1};mxGraphModel.prototype.isEdge=function(b){return null!=b?b.isEdge():!1};mxGraphModel.prototype.isConnectable=function(b){return null!=b?b.isConnectable():!1};mxGraphModel.prototype.getValue=function(b){return null!=b?b.getValue():null};mxGraphModel.prototype.setValue=function(d,c){this.execute(new mxValueChange(this,d,c));return c};mxGraphModel.prototype.valueForCellChanged=function(d,c){return d.valueChanged(c)};mxGraphModel.prototype.getGeometry=function(d,c){return null!=d?d.getGeometry():null};mxGraphModel.prototype.setGeometry=function(d,c){c!=this.getGeometry(d)&&this.execute(new mxGeometryChange(this,d,c));return c};mxGraphModel.prototype.geometryForCellChanged=function(e,d){var f=this.getGeometry(e);e.setGeometry(d);return f};mxGraphModel.prototype.getStyle=function(b){return null!=b?b.getStyle():null};mxGraphModel.prototype.setStyle=function(d,c){c!=this.getStyle(d)&&this.execute(new mxStyleChange(this,d,c));return c};mxGraphModel.prototype.styleForCellChanged=function(e,d){var f=this.getStyle(e);e.setStyle(d);return f};mxGraphModel.prototype.isCollapsed=function(b){return null!=b?b.isCollapsed():!1};mxGraphModel.prototype.setCollapsed=function(d,c){c!=this.isCollapsed(d)&&this.execute(new mxCollapseChange(this,d,c));return c};mxGraphModel.prototype.collapsedStateForCellChanged=function(e,d){var f=this.isCollapsed(e);e.setCollapsed(d);return f};mxGraphModel.prototype.isVisible=function(b){return null!=b?b.isVisible():!1};mxGraphModel.prototype.setVisible=function(d,c){c!=this.isVisible(d)&&this.execute(new mxVisibleChange(this,d,c));return c};mxGraphModel.prototype.visibleStateForCellChanged=function(e,d){var f=this.isVisible(e);e.setVisible(d);return f};mxGraphModel.prototype.execute=function(b){b.execute();this.beginUpdate();this.currentEdit.add(b);this.fireEvent(new mxEventObject(mxEvent.EXECUTE,"change",b));this.fireEvent(new mxEventObject(mxEvent.EXECUTED,"change",b));this.endUpdate()};mxGraphModel.prototype.beginUpdate=function(){this.updateLevel++;this.fireEvent(new mxEventObject(mxEvent.BEGIN_UPDATE));1==this.updateLevel&&this.fireEvent(new mxEventObject(mxEvent.START_EDIT))};mxGraphModel.prototype.endUpdate=function(){this.updateLevel--;0==this.updateLevel&&this.fireEvent(new mxEventObject(mxEvent.END_EDIT));if(!this.endingUpdate){this.endingUpdate=0==this.updateLevel;this.fireEvent(new mxEventObject(mxEvent.END_UPDATE,"edit",this.currentEdit));try{if(this.endingUpdate&&!this.currentEdit.isEmpty()){this.fireEvent(new mxEventObject(mxEvent.BEFORE_UNDO,"edit",this.currentEdit));var b=this.currentEdit;this.currentEdit=this.createUndoableEdit();b.notify();this.fireEvent(new mxEventObject(mxEvent.UNDO,"edit",b))}}finally{this.endingUpdate=!1}}};mxGraphModel.prototype.createUndoableEdit=function(){var b=new mxUndoableEdit(this,!0);b.notify=function(){b.source.fireEvent(new mxEventObject(mxEvent.CHANGE,"edit",b,"changes",b.changes));b.source.fireEvent(new mxEventObject(mxEvent.NOTIFY,"edit",b,"changes",b.changes))};return b};mxGraphModel.prototype.mergeChildren=function(i,h,o){o=null!=o?o:!0;this.beginUpdate();try{var n={};this.mergeChildrenImpl(i,h,o,n);for(var m in n){var l=n[m],k=this.getTerminal(l,!0);null!=k&&(k=n[mxCellPath.create(k)],this.setTerminal(l,k,!0));k=this.getTerminal(l,!1);null!=k&&(k=n[mxCellPath.create(k)],this.setTerminal(l,k,!1))}}finally{this.endUpdate()}};mxGraphModel.prototype.mergeChildrenImpl=function(u,t,s,r){this.beginUpdate();try{for(var q=u.getChildCount(),p=0;p<q;p++){var o=u.getChildAt(p);if("function"==typeof o.getId){var n=o.getId(),m=null!=n&&(!this.isEdge(o)||!s)?this.getCell(n):null;if(null==m){var i=o.clone();i.setId(n);i.setTerminal(o.getTerminal(!0),!0);i.setTerminal(o.getTerminal(!1),!1);m=t.insert(i);this.cellAdded(m)}r[mxCellPath.create(o)]=m;this.mergeChildrenImpl(o,m,s,r)}}}finally{this.endUpdate()}};mxGraphModel.prototype.getParents=function(h){var g=[];if(null!=h){for(var m={},l=0;l<h.length;l++){var k=this.getParent(h[l]);if(null!=k){var i=mxCellPath.create(k);null==m[i]&&(m[i]=k,g.push(k))}}}return g};mxGraphModel.prototype.cloneCell=function(b){return null!=b?this.cloneCells([b],!0)[0]:null};mxGraphModel.prototype.cloneCells=function(g,f){for(var k={},i=[],h=0;h<g.length;h++){null!=g[h]?i.push(this.cloneCellImpl(g[h],k,f)):i.push(null)}for(h=0;h<i.length;h++){null!=i[h]&&this.restoreClone(i[h],g[h],k)}return i};mxGraphModel.prototype.cloneCellImpl=function(h,g,m){var l=this.cellCloned(h);g[mxObjectIdentity.get(h)]=l;if(m){m=this.getChildCount(h);for(var k=0;k<m;k++){var i=this.cloneCellImpl(this.getChildAt(h,k),g,!0);l.insert(i)}}return l};mxGraphModel.prototype.cellCloned=function(b){return b.clone()};mxGraphModel.prototype.restoreClone=function(g,f,k){var i=this.getTerminal(f,!0);null!=i&&(i=k[mxObjectIdentity.get(i)],null!=i&&i.insertEdge(g,!0));i=this.getTerminal(f,!1);null!=i&&(i=k[mxObjectIdentity.get(i)],null!=i&&i.insertEdge(g,!1));for(var i=this.getChildCount(g),h=0;h<i;h++){this.restoreClone(this.getChildAt(g,h),this.getChildAt(f,h),k)}};function mxRootChange(d,c){this.model=d;this.previous=this.root=c}mxRootChange.prototype.execute=function(){this.root=this.previous;this.previous=this.model.rootChanged(this.previous)};function mxChildChange(f,e,h,g){this.model=f;this.previous=this.parent=e;this.child=h;this.previousIndex=this.index=g}mxChildChange.prototype.execute=function(){var d=this.model.getParent(this.child),c=null!=d?d.getIndex(this.child):0;null==this.previous&&this.connect(this.child,!1);d=this.model.parentForCellChanged(this.child,this.previous,this.previousIndex);null!=this.previous&&this.connect(this.child,!0);this.parent=this.previous;this.previous=d;this.index=this.previousIndex;this.previousIndex=c};mxChildChange.prototype.connect=function(f,e){e=null!=e?e:!0;var h=f.getTerminal(!0),g=f.getTerminal(!1);null!=h&&(e?this.model.terminalForCellChanged(f,h,!0):this.model.terminalForCellChanged(f,null,!0));null!=g&&(e?this.model.terminalForCellChanged(f,g,!1):this.model.terminalForCellChanged(f,null,!1));f.setTerminal(h,!0);f.setTerminal(g,!1);h=this.model.getChildCount(f);for(g=0;g<h;g++){this.connect(this.model.getChildAt(f,g),e)}};function mxTerminalChange(f,e,h,g){this.model=f;this.cell=e;this.previous=this.terminal=h;this.source=g}mxTerminalChange.prototype.execute=function(){this.terminal=this.previous;this.previous=this.model.terminalForCellChanged(this.cell,this.previous,this.source)};function mxValueChange(e,d,f){this.model=e;this.cell=d;this.previous=this.value=f}mxValueChange.prototype.execute=function(){this.value=this.previous;this.previous=this.model.valueForCellChanged(this.cell,this.previous)};function mxStyleChange(e,d,f){this.model=e;this.cell=d;this.previous=this.style=f}mxStyleChange.prototype.execute=function(){this.style=this.previous;this.previous=this.model.styleForCellChanged(this.cell,this.previous)};function mxGeometryChange(e,d,f){this.model=e;this.cell=d;this.previous=this.geometry=f}mxGeometryChange.prototype.execute=function(){this.geometry=this.previous;this.previous=this.model.geometryForCellChanged(this.cell,this.previous)};function mxCollapseChange(e,d,f){this.model=e;this.cell=d;this.previous=this.collapsed=f}mxCollapseChange.prototype.execute=function(){this.collapsed=this.previous;this.previous=this.model.collapsedStateForCellChanged(this.cell,this.previous)};function mxVisibleChange(e,d,f){this.model=e;this.cell=d;this.previous=this.visible=f}mxVisibleChange.prototype.execute=function(){this.visible=this.previous;this.previous=this.model.visibleStateForCellChanged(this.cell,this.previous)};function mxCellAttributeChange(e,d,f){this.cell=e;this.attribute=d;this.previous=this.value=f}mxCellAttributeChange.prototype.execute=function(){var b=this.cell.getAttribute(this.attribute);null==this.previous?this.cell.value.removeAttribute(this.attribute):this.cell.setAttribute(this.attribute,this.previous);this.previous=b};function mxCell(e,d,f){this.value=e;this.setGeometry(d);this.setStyle(f);if(null!=this.onInit){this.onInit()}}mxCell.prototype.id=null;mxCell.prototype.value=null;mxCell.prototype.geometry=null;mxCell.prototype.style=null;mxCell.prototype.vertex=!1;mxCell.prototype.edge=!1;mxCell.prototype.connectable=!0;mxCell.prototype.visible=!0;mxCell.prototype.collapsed=!1;mxCell.prototype.parent=null;mxCell.prototype.source=null;mxCell.prototype.target=null;mxCell.prototype.children=null;mxCell.prototype.edges=null;mxCell.prototype.mxTransient="id value parent source target children edges".split(" ");mxCell.prototype.getId=function(){return this.id};mxCell.prototype.setId=function(b){this.id=b};mxCell.prototype.getValue=function(){return this.value};mxCell.prototype.setValue=function(b){this.value=b};mxCell.prototype.valueChanged=function(d){var c=this.getValue();this.setValue(d);return c};mxCell.prototype.getGeometry=function(){return this.geometry};mxCell.prototype.setGeometry=function(b){this.geometry=b};mxCell.prototype.getStyle=function(){return this.style};mxCell.prototype.setStyle=function(b){this.style=b};mxCell.prototype.isVertex=function(){return this.vertex};mxCell.prototype.setVertex=function(b){this.vertex=b};mxCell.prototype.isEdge=function(){return this.edge};mxCell.prototype.setEdge=function(b){this.edge=b};mxCell.prototype.isConnectable=function(){return this.connectable};mxCell.prototype.setConnectable=function(b){this.connectable=b};mxCell.prototype.isVisible=function(){return this.visible};mxCell.prototype.setVisible=function(b){this.visible=b};mxCell.prototype.isCollapsed=function(){return this.collapsed};mxCell.prototype.setCollapsed=function(b){this.collapsed=b};mxCell.prototype.getParent=function(){return this.parent};mxCell.prototype.setParent=function(b){this.parent=b};mxCell.prototype.getTerminal=function(b){return b?this.source:this.target};mxCell.prototype.setTerminal=function(d,c){c?this.source=d:this.target=d;return d};mxCell.prototype.getChildCount=function(){return null==this.children?0:this.children.length};mxCell.prototype.getIndex=function(b){return mxUtils.indexOf(this.children,b)};mxCell.prototype.getChildAt=function(b){return null==this.children?null:this.children[b]};mxCell.prototype.insert=function(d,c){null!=d&&(null==c&&(c=this.getChildCount(),d.getParent()==this&&c--),d.removeFromParent(),d.setParent(this),null==this.children?(this.children=[],this.children.push(d)):this.children.splice(c,0,d));return d};mxCell.prototype.remove=function(d){var c=null;null!=this.children&&0<=d&&(c=this.getChildAt(d),null!=c&&(this.children.splice(d,1),c.setParent(null)));return c};mxCell.prototype.removeFromParent=function(){if(null!=this.parent){var b=this.parent.getIndex(this);this.parent.remove(b)}};mxCell.prototype.getEdgeCount=function(){return null==this.edges?0:this.edges.length};mxCell.prototype.getEdgeIndex=function(b){return mxUtils.indexOf(this.edges,b)};mxCell.prototype.getEdgeAt=function(b){return null==this.edges?null:this.edges[b]};mxCell.prototype.insertEdge=function(d,c){if(null!=d&&(d.removeFromTerminal(c),d.setTerminal(this,c),null==this.edges||d.getTerminal(!c)!=this||0>mxUtils.indexOf(this.edges,d))){null==this.edges&&(this.edges=[]),this.edges.push(d)}return d};mxCell.prototype.removeEdge=function(e,d){if(null!=e){if(e.getTerminal(!d)!=this&&null!=this.edges){var f=this.getEdgeIndex(e);0<=f&&this.edges.splice(f,1)}e.setTerminal(null,d)}return e};mxCell.prototype.removeFromTerminal=function(d){var c=this.getTerminal(d);null!=c&&c.removeEdge(this,d)};mxCell.prototype.getAttribute=function(e,d){var f=this.getValue();return(null!=f&&f.nodeType==mxConstants.NODETYPE_ELEMENT?f.getAttribute(e):null)||d};mxCell.prototype.setAttribute=function(e,d){var f=this.getValue();null!=f&&f.nodeType==mxConstants.NODETYPE_ELEMENT&&f.setAttribute(e,d)};mxCell.prototype.clone=function(){var b=mxUtils.clone(this,this.mxTransient);b.setValue(this.cloneValue());return b};mxCell.prototype.cloneValue=function(){var b=this.getValue();null!=b&&("function"==typeof b.clone?b=b.clone():isNaN(b.nodeType)||(b=b.cloneNode(!0)));return b};function mxGeometry(f,e,h,g){mxRectangle.call(this,f,e,h,g)}mxGeometry.prototype=new mxRectangle;mxGeometry.prototype.constructor=mxGeometry;mxGeometry.prototype.TRANSLATE_CONTROL_POINTS=!0;mxGeometry.prototype.alternateBounds=null;mxGeometry.prototype.sourcePoint=null;mxGeometry.prototype.targetPoint=null;mxGeometry.prototype.points=null;mxGeometry.prototype.offset=null;mxGeometry.prototype.relative=!1;mxGeometry.prototype.swap=function(){if(null!=this.alternateBounds){var b=new mxRectangle(this.x,this.y,this.width,this.height);this.x=this.alternateBounds.x;this.y=this.alternateBounds.y;this.width=this.alternateBounds.width;this.height=this.alternateBounds.height;this.alternateBounds=b}};mxGeometry.prototype.getTerminalPoint=function(b){return b?this.sourcePoint:this.targetPoint};mxGeometry.prototype.setTerminalPoint=function(d,c){c?this.sourcePoint=d:this.targetPoint=d;return d};mxGeometry.prototype.translate=function(g,f){this.clone();this.relative||(this.x+=g,this.y+=f);null!=this.sourcePoint&&(this.sourcePoint.x+=g,this.sourcePoint.y+=f);null!=this.targetPoint&&(this.targetPoint.x+=g,this.targetPoint.y+=f);if(this.TRANSLATE_CONTROL_POINTS&&null!=this.points){for(var k=this.points.length,i=0;i<k;i++){var h=this.points[i];null!=h&&(h.x+=g,h.y+=f)}}};mxGeometry.prototype.equals=function(b){return mxRectangle.prototype.equals.apply(this,arguments)&&this.relative==b.relative&&(null==this.sourcePoint&&null==b.sourcePoint||null!=this.sourcePoint&&this.sourcePoint.equals(b.sourcePoint))&&(null==this.targetPoint&&null==b.targetPoint||null!=this.targetPoint&&this.targetPoint.equals(b.targetPoint))&&(null==this.points&&null==b.points||null!=this.points&&mxUtils.equalPoints(this.points,b.points))&&(null==this.alternateBounds&&null==b.alternateBounds||null!=this.alternateBounds&&this.alternateBounds.equals(b.alternateBounds))&&(null==this.offset&&null==b.offset||null!=this.offset&&this.offset.equals(b.offset))};var mxCellPath={PATH_SEPARATOR:".",create:function(e){var d="";if(null!=e){for(var f=e.getParent();null!=f;){d=f.getIndex(e)+mxCellPath.PATH_SEPARATOR+d,e=f,f=e.getParent()}}e=d.length;1<e&&(d=d.substring(0,e-1));return d},getParentPath:function(d){if(null!=d){var c=d.lastIndexOf(mxCellPath.PATH_SEPARATOR);if(0<=c){return d.substring(0,c)}if(0<d.length){return""}}return null},resolve:function(g,f){var k=g;if(null!=f){for(var i=f.split(mxCellPath.PATH_SEPARATOR),h=0;h<i.length;h++){k=k.getChildAt(parseInt(i[h]))}}return k},compare:function(g,f){for(var k=Math.min(g.length,f.length),i=0,h=0;h<k;h++){if(g[h]!=f[h]){0==g[h].length||0==f[h].length?i=g[h]==f[h]?0:g[h]>f[h]?1:-1:(k=parseInt(g[h]),h=parseInt(f[h]),i=k==h?0:k>h?1:-1);break}}0==i&&(k=g.length,h=f.length,k!=h&&(i=k>h?1:-1));return i}},mxPerimeter={RectanglePerimeter:function(u,t,s,r){t=u.getCenterX();var q=u.getCenterY(),p=Math.atan2(s.y-q,s.x-t),o=new mxPoint(0,0),n=Math.PI,m=Math.PI/2-p,i=Math.atan2(u.height,u.width);p<-n+i||p>n-i?(o.x=u.x,o.y=q-u.width*Math.tan(p)/2):p<-i?(o.y=u.y,o.x=t-u.height*Math.tan(m)/2):p<i?(o.x=u.x+u.width,o.y=q+u.width*Math.tan(p)/2):(o.y=u.y+u.height,o.x=t+u.height*Math.tan(m)/2);r&&(s.x>=u.x&&s.x<=u.x+u.width?o.x=s.x:s.y>=u.y&&s.y<=u.y+u.height&&(o.y=s.y),s.x<u.x?o.x=u.x:s.x>u.x+u.width&&(o.x=u.x+u.width),s.y<u.y?o.y=u.y:s.y>u.y+u.height&&(o.y=u.y+u.height));return o},EllipsePerimeter:function(y,x,w,v){var u=y.x,t=y.y,s=y.width/2,r=y.height/2,q=u+s,p=t+r;x=w.x;w=w.y;var o=parseInt(x-q),i=parseInt(w-p);if(0==o&&0!=i){return new mxPoint(q,p+r*i/Math.abs(i))}if(0==o&&0==i){return new mxPoint(x,w)}if(v){if(w>=t&&w<=t+y.height){return y=w-p,y=Math.sqrt(s*s*(1-y*y/(r*r)))||0,x<=u&&(y=-y),new mxPoint(q+y,w)}if(x>=u&&x<=u+y.width){return y=x-q,y=Math.sqrt(r*r*(1-y*y/(s*s)))||0,w<=t&&(y=-y),new mxPoint(x,p+y)}}u=i/o;p-=u*q;t=s*s*u*u+r*r;y=-2*q*t;r=Math.sqrt(y*y-4*t*(s*s*u*u*q*q+r*r*q*q-s*s*r*r));s=(-y+r)/(2*t);r=(-y-r)/(2*t);q=u*s+p;p=u*r+p;u=Math.sqrt(Math.pow(s-x,2)+Math.pow(q-w,2));x=Math.sqrt(Math.pow(r-x,2)+Math.pow(p-w,2));t=w=0;u<x?(w=s,t=q):(w=r,t=p);return new mxPoint(w,t)},RhombusPerimeter:function(w,v,u,t){v=w.x;var s=w.y,r=w.width;w=w.height;var q=v+r/2,p=s+w/2,o=u.x;u=u.y;if(q==o){return p>u?new mxPoint(q,s):new mxPoint(q,s+w)}if(p==u){return q>o?new mxPoint(v,p):new mxPoint(v+r,p)}var n=q,i=p;t&&(o>=v&&o<=v+r?n=o:u>=s&&u<=s+w&&(i=u));return o<q?u<p?mxUtils.intersection(o,u,n,i,q,s,v,p):mxUtils.intersection(o,u,n,i,q,s+w,v,p):u<p?mxUtils.intersection(o,u,n,i,q,s,v+r,p):mxUtils.intersection(o,u,n,i,q,s+w,v+r,p)},TrianglePerimeter:function(F,E,D,C){E=null!=E?E.style[mxConstants.STYLE_DIRECTION]:null;var B=E==mxConstants.DIRECTION_NORTH||E==mxConstants.DIRECTION_SOUTH,A=F.x,z=F.y,y=F.width;F=F.height;var x=A+y/2,w=z+F/2,v=new mxPoint(A,z),u=new mxPoint(A+y,w),t=new mxPoint(A,z+F);E==mxConstants.DIRECTION_NORTH?(v=t,u=new mxPoint(x,z),t=new mxPoint(A+y,z+F)):E==mxConstants.DIRECTION_SOUTH?(u=new mxPoint(x,z+F),t=new mxPoint(A+y,z)):E==mxConstants.DIRECTION_WEST&&(v=new mxPoint(A+y,z),u=new mxPoint(A,w),t=new mxPoint(A+y,z+F));var o=D.x-x,G=D.y-w,o=B?Math.atan2(o,G):Math.atan2(G,o),i=B?Math.atan2(y,F):Math.atan2(F,y),G=!1,G=E==mxConstants.DIRECTION_NORTH||E==mxConstants.DIRECTION_WEST?o>-i&&o<i:o<-Math.PI+i||o>Math.PI-i,i=null;G?i=C&&(B&&D.x>=v.x&&D.x<=t.x||!B&&D.y>=v.y&&D.y<=t.y)?B?new mxPoint(D.x,v.y):new mxPoint(v.x,D.y):E==mxConstants.DIRECTION_NORTH?new mxPoint(A+y/2+F*Math.tan(o)/2,z+F):E==mxConstants.DIRECTION_SOUTH?new mxPoint(A+y/2-F*Math.tan(o)/2,z):E==mxConstants.DIRECTION_WEST?new mxPoint(A+y,z+F/2+y*Math.tan(o)/2):new mxPoint(A,z+F/2-y*Math.tan(o)/2):(C&&(C=new mxPoint(x,w),D.y>=z&&D.y<=z+F?(C.x=B?x:E==mxConstants.DIRECTION_WEST?A+y:A,C.y=D.y):D.x>=A&&D.x<=A+y&&(C.x=D.x,C.y=!B?w:E==mxConstants.DIRECTION_NORTH?z+F:z),x=C.x,w=C.y),i=B&&D.x<=A+y/2||!B&&D.y<=z+F/2?mxUtils.intersection(D.x,D.y,x,w,v.x,v.y,u.x,u.y):mxUtils.intersection(D.x,D.y,x,w,u.x,u.y,t.x,t.y));null==i&&(i=new mxPoint(x,w));return i}};function mxPrintPreview(s,r,q,p,o,n,m,l,i){this.graph=s;this.scale=null!=r?r:1/s.pageScale;this.border=null!=p?p:0;this.pageFormat=null!=q?q:s.pageFormat;this.title=null!=l?l:"Printer-friendly version";this.x0=null!=o?o:0;this.y0=null!=n?n:0;this.borderColor=m;this.pageSelector=null!=i?i:!0}mxPrintPreview.prototype.graph=null;mxPrintPreview.prototype.pageFormat=null;mxPrintPreview.prototype.scale=null;mxPrintPreview.prototype.border=0;mxPrintPreview.prototype.x0=0;mxPrintPreview.prototype.y0=0;mxPrintPreview.prototype.autoOrigin=!0;mxPrintPreview.prototype.printOverlays=!1;mxPrintPreview.prototype.borderColor=null;mxPrintPreview.prototype.title=null;mxPrintPreview.prototype.pageSelector=null;mxPrintPreview.prototype.wnd=null;mxPrintPreview.prototype.pageCount=0;mxPrintPreview.prototype.getWindow=function(){return this.wnd};mxPrintPreview.prototype.getDoctype=function(){var b="";5==document.documentMode?b='<meta http-equiv="X-UA-Compatible" content="IE=5">':8==document.documentMode?b='<meta http-equiv="X-UA-Compatible" content="IE=8">':8<document.documentMode&&(b='<meta http-equiv="X-UA-Compatible" content="IE=edge">');return b};mxPrintPreview.prototype.open=function(Q){var P=this.graph.cellRenderer.initializeOverlay,O=null;try{this.printOverlays&&(this.graph.cellRenderer.initializeOverlay=function(d,c){c.init(d.view.getDrawPane())});if(null==this.wnd){this.wnd=window.open();var N=this.wnd.document,M=this.getDoctype();null!=M&&0<M.length&&N.writeln(M);mxClient.IS_VML?N.writeln('<html xmlns:v="urn:schemas-microsoft-com:vml" xmlns:o="urn:schemas-microsoft-com:office:office">'):N.writeln("<html>");N.writeln("<head>");this.writeHead(N,Q);N.writeln("</head>");N.writeln('<body class="mxPage">');var L=this.graph.getGraphBounds().clone(),K=this.graph.getView().getScale(),J=K/this.scale,I=this.graph.getView().getTranslate();this.autoOrigin||(this.x0=-I.x*this.scale,this.y0=-I.y*this.scale,L.width+=L.x,L.height+=L.y,L.x=0,this.border=L.y=0);L.width/=J;L.height/=J;var H=this.pageFormat.width-2*this.border,G=this.pageFormat.height-2*this.border,F=Math.max(1,Math.ceil((L.width+this.x0)/H)),E=Math.max(1,Math.ceil((L.height+this.y0)/G));this.pageCount=F*E;var D=mxUtils.bind(this,function(){if(this.pageSelector&&(1<E||1<F)){var d=this.createPageSelector(E,F);N.body.appendChild(d);if(mxClient.IS_IE&&null==N.documentMode||5==N.documentMode||8==N.documentMode||7==N.documentMode){d.style.position="absolute";var c=function(){d.style.top=(N.body.scrollTop||N.documentElement.scrollTop)+10+"px"};mxEvent.addListener(this.wnd,"scroll",function(b){c()});mxEvent.addListener(this.wnd,"resize",function(b){c()})}}});Q=function(e,d){null!=this.borderColor&&(e.style.borderColor=this.borderColor,e.style.borderStyle="solid",e.style.borderWidth="1px");e.style.background="white";d&&(e.style.pageBreakAfter="always");mxClient.IS_IE||11<=document.documentMode?(N.writeln(e.outerHTML),e.parentNode.removeChild(e)):(e.parentNode.removeChild(e),N.body.appendChild(e));if(d){var f=N.createElement("hr");f.className="mxPageBreak";N.body.appendChild(f)}};var B=this.getCoverPages(this.pageFormat.width,this.pageFormat.height);if(null!=B){for(var C=0;C<B.length;C++){Q(B[C],!0)}}for(var A=this.getAppendices(this.pageFormat.width,this.pageFormat.height),C=0;C<E;C++){for(var z=C*G/this.scale-this.y0/this.scale+(L.y-I.y*K)/K,B=0;B<F;B++){if(null==this.wnd){return null}var x=B*H/this.scale-this.x0/this.scale+(L.x-I.x*K)/K,o=C*F+B+1,O=8==N.documentMode||9==N.documentMode||10==N.documentMode?this.renderPage(this.pageFormat.width,this.pageFormat.height,-x,-z,mxUtils.bind(this,function(b){this.addGraphFragment(0,0,this.scale,o,b)})):this.renderPage(this.pageFormat.width,this.pageFormat.height,0,0,mxUtils.bind(this,function(b){this.addGraphFragment(-x,-z,this.scale,o,b)}));O.setAttribute("id","mxPage-"+o);Q(O,null!=A||C<E-1||B<F-1)}}if(null!=A){for(C=0;C<A.length;C++){Q(A[C],C<A.length)}}N.writeln("</body>");N.writeln("</html>");N.close();D();mxEvent.release(N.body)}this.wnd.focus()}catch(i){null!=O&&null!=O.parentNode&&O.parentNode.removeChild(O)}finally{this.graph.cellRenderer.initializeOverlay=P}return this.wnd};mxPrintPreview.prototype.writeHead=function(d,c){null!=this.title&&d.writeln("<title>"+this.title+"</title>");mxClient.IS_VML&&d.writeln('<style type="text/css">v\\:*{behavior:url(#default#VML)}o\\:*{behavior:url(#default#VML)}</style>');mxClient.link("stylesheet",mxClient.basePath+"/css/common.css",d);d.writeln('<style type="text/css">');d.writeln("@media print {");d.writeln("  table.mxPageSelector { display: none; }");d.writeln("  hr.mxPageBreak { display: none; }");d.writeln("}");d.writeln("@media screen {");d.writeln("  table.mxPageSelector { position: fixed; right: 10px; top: 10px;font-family: Arial; font-size:10pt; border: solid 1px darkgray;background: white; border-collapse:collapse; }");d.writeln("  table.mxPageSelector td { border: solid 1px gray; padding:4px; }");d.writeln("  body.mxPage { background: gray; }");d.writeln("}");null!=c&&d.writeln(c);d.writeln("</style>")};mxPrintPreview.prototype.createPageSelector=function(w,v){var u=this.wnd.document,t=u.createElement("table");t.className="mxPageSelector";t.setAttribute("border","0");for(var s=u.createElement("tbody"),r=0;r<w;r++){for(var q=u.createElement("tr"),p=0;p<v;p++){var o=r*v+p+1,n=u.createElement("td"),i=u.createElement("a");i.setAttribute("href","#mxPage-"+o);mxClient.IS_NS&&(!mxClient.IS_SF&&!mxClient.IS_GC)&&i.setAttribute("onclick","var page = document.getElementById('mxPage-"+o+"');page.scrollIntoView(true);event.preventDefault();");mxUtils.write(i,o,u);n.appendChild(i);q.appendChild(n)}s.appendChild(q)}t.appendChild(s);return t};mxPrintPreview.prototype.renderPage=function(u,t,s,r,q){var p=this.wnd.document,o=document.createElement("div");try{if(0!=s||0!=r){o.style.position="relative";o.style.width=u+"px";o.style.height=t+"px";o.style.pageBreakInside="avoid";var n=document.createElement("div");n.style.position="relative";n.style.top=this.border+"px";n.style.left=this.border+"px";n.style.width=u-2*this.border+"px";n.style.height=t-2*this.border+"px";n.style.overflow="hidden";var m=document.createElement("div");m.style.position="relative";m.style.marginLeft=s+"px";m.style.marginTop=r+"px";8==p.documentMode&&(n.style.position="absolute",m.style.position="absolute");10==p.documentMode&&(mxLog.show(),mxLog.debug("10"),m.style.width="100%",m.style.height="100%");n.appendChild(m);o.appendChild(n);document.body.appendChild(o);q(m)}else{o.style.width=u+"px",o.style.height=t+"px",o.style.overflow="hidden",o.style.pageBreakInside="avoid",8==p.documentMode&&(o.style.position="relative"),n=document.createElement("div"),n.style.width=u-2*this.border+"px",n.style.height=t-2*this.border+"px",n.style.overflow="hidden",mxClient.IS_IE&&(null==p.documentMode||5==p.documentMode||8==p.documentMode||7==p.documentMode)?(n.style.marginTop=this.border+"px",n.style.marginLeft=this.border+"px"):(n.style.top=this.border+"px",n.style.left=this.border+"px"),this.graph.dialect==mxConstants.DIALECT_VML&&(n.style.position="absolute"),o.appendChild(n),document.body.appendChild(o),q(n)}}catch(i){throw o.parentNode.removeChild(o),i}return o};mxPrintPreview.prototype.getRoot=function(){var b=this.graph.view.currentRoot;null==b&&(b=this.graph.getModel().getRoot());return b};mxPrintPreview.prototype.addGraphFragment=function(C,B,A,z,y){z=this.graph.getView();var x=this.graph.container;this.graph.container=y;var w=z.getCanvas(),v=z.getBackgroundPane(),u=z.getDrawPane(),t=z.getOverlayPane();this.graph.dialect==mxConstants.DIALECT_SVG?z.createSvg():this.graph.dialect==mxConstants.DIALECT_VML?z.createVml():z.createHtml();var s=z.isEventsEnabled();z.setEventsEnabled(!1);var r=this.graph.isEnabled();this.graph.setEnabled(!1);var o=z.getTranslate();z.translate=new mxPoint(C,B);C=null;try{var i=[this.getRoot()];C=new mxTemporaryCellStates(z,A,i)}finally{if(mxClient.IS_IE){z.overlayPane.innerHTML=""}else{for(A=y.firstChild;null!=A;){i=A.nextSibling,B=A.nodeName.toLowerCase(),"svg"==B?(A.setAttribute("width",parseInt(y.style.width)),A.setAttribute("height",parseInt(y.style.height))):"default"!=A.style.cursor&&"div"!=B&&A.parentNode.removeChild(A),A=i}}z.overlayPane.parentNode.removeChild(z.overlayPane);this.graph.setEnabled(r);this.graph.container=x;z.canvas=w;z.backgroundPane=v;z.drawPane=u;z.overlayPane=t;z.translate=o;C.destroy();z.setEventsEnabled(s)}};mxPrintPreview.prototype.getCoverPages=function(){return null};mxPrintPreview.prototype.getAppendices=function(){return null};mxPrintPreview.prototype.print=function(b){b=this.open(b);null!=b&&b.print()};mxPrintPreview.prototype.close=function(){null!=this.wnd&&(this.wnd.close(),this.wnd=null)};function mxStylesheet(){this.styles={};this.putDefaultVertexStyle(this.createDefaultVertexStyle());this.putDefaultEdgeStyle(this.createDefaultEdgeStyle())}mxStylesheet.prototype.createDefaultVertexStyle=function(){var b={};b[mxConstants.STYLE_SHAPE]=mxConstants.SHAPE_RECTANGLE;b[mxConstants.STYLE_PERIMETER]=mxPerimeter.RectanglePerimeter;b[mxConstants.STYLE_VERTICAL_ALIGN]=mxConstants.ALIGN_MIDDLE;b[mxConstants.STYLE_ALIGN]=mxConstants.ALIGN_CENTER;b[mxConstants.STYLE_FILLCOLOR]="#C3D9FF";b[mxConstants.STYLE_STROKECOLOR]="#6482B9";b[mxConstants.STYLE_FONTCOLOR]="#774400";return b};mxStylesheet.prototype.createDefaultEdgeStyle=function(){var b={};b[mxConstants.STYLE_SHAPE]=mxConstants.SHAPE_CONNECTOR;b[mxConstants.STYLE_ENDARROW]=mxConstants.ARROW_CLASSIC;b[mxConstants.STYLE_VERTICAL_ALIGN]=mxConstants.ALIGN_MIDDLE;b[mxConstants.STYLE_ALIGN]=mxConstants.ALIGN_CENTER;b[mxConstants.STYLE_STROKECOLOR]="#6482B9";b[mxConstants.STYLE_FONTCOLOR]="#446299";return b};mxStylesheet.prototype.putDefaultVertexStyle=function(b){this.putCellStyle("defaultVertex",b)};mxStylesheet.prototype.putDefaultEdgeStyle=function(b){this.putCellStyle("defaultEdge",b)};mxStylesheet.prototype.getDefaultVertexStyle=function(){return this.styles.defaultVertex};mxStylesheet.prototype.getDefaultEdgeStyle=function(){return this.styles.defaultEdge};mxStylesheet.prototype.putCellStyle=function(d,c){this.styles[d]=c};mxStylesheet.prototype.getCellStyle=function(k,i){var q=i;if(null!=k&&0<k.length){for(var p=k.split(";"),q=null!=q&&";"!=k.charAt(0)?mxUtils.clone(q):{},o=0;o<p.length;o++){var n=p[o],m=n.indexOf("=");if(0<=m){var l=n.substring(0,m),n=n.substring(m+1);n==mxConstants.NONE?delete q[l]:mxUtils.isNumeric(n)?q[l]=parseFloat(n):q[l]=n}else{if(n=this.styles[n],null!=n){for(l in n){q[l]=n[l]}}}}}return q};function mxCellState(e,d,f){this.view=e;this.cell=d;this.style=f;this.origin=new mxPoint;this.absoluteOffset=new mxPoint}mxCellState.prototype=new mxRectangle;mxCellState.prototype.constructor=mxCellState;mxCellState.prototype.view=null;mxCellState.prototype.cell=null;mxCellState.prototype.style=null;mxCellState.prototype.invalid=!0;mxCellState.prototype.origin=null;mxCellState.prototype.absolutePoints=null;mxCellState.prototype.absoluteOffset=null;mxCellState.prototype.visibleSourceState=null;mxCellState.prototype.visibleTargetState=null;mxCellState.prototype.terminalDistance=0;mxCellState.prototype.length=0;mxCellState.prototype.segments=null;mxCellState.prototype.shape=null;mxCellState.prototype.text=null;mxCellState.prototype.getPerimeterBounds=function(e,d){e=e||0;d=null!=d?d:new mxRectangle(this.x,this.y,this.width,this.height);if(null!=this.shape&&null!=this.shape.stencil){var f=this.shape.stencil.computeAspect(this.style,d.x,d.y,d.width,d.height);d.x=f.x;d.y=f.y;d.width=this.shape.stencil.w0*f.width;d.height=this.shape.stencil.h0*f.height}0!=e&&d.grow(e);return d};mxCellState.prototype.setAbsoluteTerminalPoint=function(d,c){c?(null==this.absolutePoints&&(this.absolutePoints=[]),0==this.absolutePoints.length?this.absolutePoints.push(d):this.absolutePoints[0]=d):null==this.absolutePoints?(this.absolutePoints=[],this.absolutePoints.push(null),this.absolutePoints.push(d)):1==this.absolutePoints.length?this.absolutePoints.push(d):this.absolutePoints[this.absolutePoints.length-1]=d};mxCellState.prototype.setCursor=function(b){null!=this.shape&&this.shape.setCursor(b);null!=this.text&&this.text.setCursor(b)};mxCellState.prototype.getVisibleTerminal=function(b){b=this.getVisibleTerminalState(b);return null!=b?b.cell:null};mxCellState.prototype.getVisibleTerminalState=function(b){return b?this.visibleSourceState:this.visibleTargetState};mxCellState.prototype.setVisibleTerminalState=function(d,c){c?this.visibleSourceState=d:this.visibleTargetState=d};mxCellState.prototype.destroy=function(){this.view.graph.cellRenderer.destroy(this)};mxCellState.prototype.clone=function(){var d=new mxCellState(this.view,this.cell,this.style);if(null!=this.absolutePoints){d.absolutePoints=[];for(var c=0;c<this.absolutePoints.length;c++){d.absolutePoints[c]=this.absolutePoints[c].clone()}}null!=this.origin&&(d.origin=this.origin.clone());null!=this.absoluteOffset&&(d.absoluteOffset=this.absoluteOffset.clone());null!=this.boundingBox&&(d.boundingBox=this.boundingBox.clone());d.terminalDistance=this.terminalDistance;d.segments=this.segments;d.length=this.length;d.x=this.x;d.y=this.y;d.width=this.width;d.height=this.height;return d};function mxGraphSelectionModel(b){this.graph=b;this.cells=[]}mxGraphSelectionModel.prototype=new mxEventSource;mxGraphSelectionModel.prototype.constructor=mxGraphSelectionModel;mxGraphSelectionModel.prototype.doneResource="none"!=mxClient.language?"done":"";mxGraphSelectionModel.prototype.updatingSelectionResource="none"!=mxClient.language?"updatingSelection":"";mxGraphSelectionModel.prototype.graph=null;mxGraphSelectionModel.prototype.singleSelection=!1;mxGraphSelectionModel.prototype.isSingleSelection=function(){return this.singleSelection};mxGraphSelectionModel.prototype.setSingleSelection=function(b){this.singleSelection=b};mxGraphSelectionModel.prototype.isSelected=function(b){return null!=b?0<=mxUtils.indexOf(this.cells,b):!1};mxGraphSelectionModel.prototype.isEmpty=function(){return 0==this.cells.length};mxGraphSelectionModel.prototype.clear=function(){this.changeSelection(null,this.cells)};mxGraphSelectionModel.prototype.setCell=function(b){null!=b&&this.setCells([b])};mxGraphSelectionModel.prototype.setCells=function(e){if(null!=e){this.singleSelection&&(e=[this.getFirstSelectableCell(e)]);for(var d=[],f=0;f<e.length;f++){this.graph.isCellSelectable(e[f])&&d.push(e[f])}this.changeSelection(d,this.cells)}};mxGraphSelectionModel.prototype.getFirstSelectableCell=function(d){if(null!=d){for(var c=0;c<d.length;c++){if(this.graph.isCellSelectable(d[c])){return d[c]}}}return null};mxGraphSelectionModel.prototype.addCell=function(b){null!=b&&this.addCells([b])};mxGraphSelectionModel.prototype.addCells=function(f){if(null!=f){var e=null;this.singleSelection&&(e=this.cells,f=[this.getFirstSelectableCell(f)]);for(var h=[],g=0;g<f.length;g++){!this.isSelected(f[g])&&this.graph.isCellSelectable(f[g])&&h.push(f[g])}this.changeSelection(h,e)}};mxGraphSelectionModel.prototype.removeCell=function(b){null!=b&&this.removeCells([b])};mxGraphSelectionModel.prototype.removeCells=function(e){if(null!=e){for(var d=[],f=0;f<e.length;f++){this.isSelected(e[f])&&d.push(e[f])}this.changeSelection(null,d)}};mxGraphSelectionModel.prototype.changeSelection=function(f,e){if(null!=f&&0<f.length&&null!=f[0]||null!=e&&0<e.length&&null!=e[0]){var h=new mxSelectionChange(this,f,e);h.execute();var g=new mxUndoableEdit(this,!1);g.add(h);this.fireEvent(new mxEventObject(mxEvent.UNDO,"edit",g))}};mxGraphSelectionModel.prototype.cellAdded=function(b){null!=b&&!this.isSelected(b)&&this.cells.push(b)};mxGraphSelectionModel.prototype.cellRemoved=function(b){null!=b&&(b=mxUtils.indexOf(this.cells,b),0<=b&&this.cells.splice(b,1))};function mxSelectionChange(e,d,f){this.selectionModel=e;this.added=null!=d?d.slice():null;this.removed=null!=f?f.slice():null}mxSelectionChange.prototype.execute=function(){var d=mxLog.enter("mxSelectionChange.execute");window.status=mxResources.get(this.selectionModel.updatingSelectionResource)||this.selectionModel.updatingSelectionResource;if(null!=this.removed){for(var c=0;c<this.removed.length;c++){this.selectionModel.cellRemoved(this.removed[c])}}if(null!=this.added){for(c=0;c<this.added.length;c++){this.selectionModel.cellAdded(this.added[c])}}c=this.added;this.added=this.removed;this.removed=c;window.status=mxResources.get(this.selectionModel.doneResource)||this.selectionModel.doneResource;mxLog.leave("mxSelectionChange.execute",d);this.selectionModel.fireEvent(new mxEventObject(mxEvent.CHANGE,"added",this.added,"removed",this.removed))};function mxCellEditor(b){this.graph=b}mxCellEditor.prototype.graph=null;mxCellEditor.prototype.textarea=null;mxCellEditor.prototype.editingCell=null;mxCellEditor.prototype.trigger=null;mxCellEditor.prototype.modified=!1;mxCellEditor.prototype.autoSize=!0;mxCellEditor.prototype.selectText=!0;mxCellEditor.prototype.emptyLabelText="";mxCellEditor.prototype.textNode="";mxCellEditor.prototype.init=function(){this.textarea=document.createElement("textarea");this.textarea.className="mxCellEditor";this.textarea.style.position="absolute";this.textarea.style.overflow="visible";this.textarea.setAttribute("cols","20");this.textarea.setAttribute("rows","4");mxClient.IS_NS&&(this.textarea.style.resize="none");mxEvent.addListener(this.textarea,"blur",mxUtils.bind(this,function(b){this.focusLost()}));mxEvent.addListener(this.textarea,"change",mxUtils.bind(this,function(b){this.setModified(!0)}));mxEvent.addListener(this.textarea,"keydown",mxUtils.bind(this,function(b){mxEvent.isConsumed(b)||(113==b.keyCode||this.graph.isEnterStopsCellEditing()&&13==b.keyCode&&!mxEvent.isControlDown(b)&&!mxEvent.isShiftDown(b)?(this.graph.stopEditing(!1),mxEvent.consume(b)):27==b.keyCode?(this.graph.stopEditing(!0),mxEvent.consume(b)):(this.clearOnChange&&(this.clearOnChange=!1,this.textarea.value=""),this.setModified(!0)))}));this.changeHandler=mxUtils.bind(this,function(b){null!=this.editingCell&&null==this.graph.getView().getState(this.editingCell)&&this.stopEditing(!0)});this.graph.getModel().addListener(mxEvent.CHANGE,this.changeHandler);mxEvent.addListener(this.textarea,!mxClient.IS_IE||9<=document.documentMode?"input":"keypress",mxUtils.bind(this,function(b){this.autoSize&&!mxEvent.isConsumed(b)&&setTimeout(mxUtils.bind(this,function(){this.resize()}),0)}))};mxCellEditor.prototype.isEventSource=function(b){return mxEvent.getSource(b)==this.textarea};mxCellEditor.prototype.resize=function(){if(null!=this.textDiv){var s=this.graph.getView().getState(this.editingCell);if(null==s){this.stopEditing(!0)}else{var r=this.graph.isLabelClipped(s.cell),q=this.graph.isWrapping(s.cell),p=this.graph.getModel().isEdge(s.cell),o=this.graph.getView().scale,n=parseInt(s.style[mxConstants.STYLE_SPACING]||0)*o,m=(parseInt(s.style[mxConstants.STYLE_SPACING_TOP]||0)+mxText.prototype.baseSpacingTop)*o+n,l=(parseInt(s.style[mxConstants.STYLE_SPACING_RIGHT]||0)+mxText.prototype.baseSpacingRight)*o+n,i=(parseInt(s.style[mxConstants.STYLE_SPACING_BOTTOM]||0)+mxText.prototype.baseSpacingBottom)*o+n,o=(parseInt(s.style[mxConstants.STYLE_SPACING_LEFT]||0)+mxText.prototype.baseSpacingLeft)*o+n,m=new mxRectangle(s.x,s.y,s.width-o-l,s.height-m-i),m=null!=s.shape?s.shape.getLabelBounds(m):m;p?(this.bounds.x=s.absoluteOffset.x,this.bounds.y=s.absoluteOffset.y,this.bounds.width=0,this.bounds.height=0):null!=this.bounds&&(this.bounds.x=m.x,this.bounds.y=m.y,this.bounds.width=m.width,this.bounds.height=m.height,p=mxUtils.getValue(s.style,mxConstants.STYLE_LABEL_POSITION,mxConstants.ALIGN_CENTER),p==mxConstants.ALIGN_LEFT?this.bounds.x-=s.width:p==mxConstants.ALIGN_RIGHT&&(this.bounds.x+=s.width),p=mxUtils.getValue(s.style,mxConstants.STYLE_VERTICAL_LABEL_POSITION,mxConstants.ALIGN_MIDDLE),p==mxConstants.ALIGN_TOP?this.bounds.y-=s.height:p==mxConstants.ALIGN_BOTTOM&&(this.bounds.y+=s.height));p=this.textarea.value;if("\n"==p.charAt(p.length-1)||""==p){p+="&nbsp;"}p=mxUtils.htmlEntities(p,!1);q?(this.textDiv.style.whiteSpace="normal",this.textDiv.style.width=this.bounds.width+"px"):p=p.replace(/ /g,"&nbsp;");p=p.replace(/\n/g,"<br/>");this.textDiv.innerHTML=p;p=this.textDiv.offsetWidth+30;m=this.textDiv.offsetHeight+16;p=Math.max(p,40);m=Math.max(m,20);r?(p=Math.min(this.bounds.width,p),m=Math.min(this.bounds.height,m)):q&&(p=Math.max(this.bounds.width,this.textDiv.scrollWidth));r=null!=s.text?s.text.margin:null;null==r&&(r=mxUtils.getValue(s.style,mxConstants.STYLE_ALIGN,mxConstants.ALIGN_CENTER),s=mxUtils.getValue(s.style,mxConstants.STYLE_VERTICAL_ALIGN,mxConstants.ALIGN_MIDDLE),r=mxUtils.getAlignmentAsPoint(r,s));null!=r&&(this.textarea.style.left=Math.max(0,Math.round(this.bounds.x-r.x*this.bounds.width+r.x*p)-3)+"px",this.textarea.style.top=Math.max(0,Math.round(this.bounds.y-r.y*this.bounds.height+r.y*m)+4)+"px");this.textarea.style.width=p+(this.textarea.offsetWidth-this.textarea.clientWidth+4)+"px";this.textarea.style.height=m+"px"}}};mxCellEditor.prototype.isModified=function(){return this.modified};mxCellEditor.prototype.setModified=function(b){this.modified=b};mxCellEditor.prototype.focusLost=function(){this.stopEditing(!this.graph.isInvokesStopCellEditing())};mxCellEditor.prototype.startEditing=function(u,t){null==this.textarea&&this.init();this.stopEditing(!0);var s=this.graph.getView().getState(u);if(null!=s){this.editingCell=u;this.trigger=t;this.textNode=null;null!=s.text&&this.isHideLabel(s)&&(this.textNode=s.text.node,this.textNode.style.visibility="hidden");var r=this.graph.getView().scale,r=mxUtils.getValue(s.style,mxConstants.STYLE_FONTSIZE,mxConstants.DEFAULT_FONTSIZE)*r,q=mxUtils.getValue(s.style,mxConstants.STYLE_FONTFAMILY,mxConstants.DEFAULT_FONTFAMILY),p=mxUtils.getValue(s.style,mxConstants.STYLE_FONTCOLOR,"black"),o=mxUtils.getValue(s.style,mxConstants.STYLE_ALIGN,mxConstants.ALIGN_LEFT),n=(mxUtils.getValue(s.style,mxConstants.STYLE_FONTSTYLE,0)&mxConstants.FONT_BOLD)==mxConstants.FONT_BOLD,m=(mxUtils.getValue(s.style,mxConstants.STYLE_FONTSTYLE,0)&mxConstants.FONT_ITALIC)==mxConstants.FONT_ITALIC,i=(mxUtils.getValue(s.style,mxConstants.STYLE_FONTSTYLE,0)&mxConstants.FONT_UNDERLINE)==mxConstants.FONT_UNDERLINE;this.textarea.style.fontSize=Math.round(r)+"px";this.textarea.style.lineHeight=Math.round(r*mxConstants.LINE_HEIGHT)+"px";this.textarea.style.fontFamily=q;this.textarea.style.textAlign=o;this.textarea.style.color=p;this.textarea.style.fontWeight=n?"bold":"normal";this.textarea.style.fontStyle=m?"italic":"";this.textarea.style.textDecoration=i?"underline":"";this.textarea.style.overflow="auto";this.textarea.style.outline="none";this.bounds=r=this.getEditorBounds(s);this.textarea.style.left=r.x+"px";this.textarea.style.top=r.y+"px";this.textarea.style.width=r.width+"px";this.textarea.style.height=r.height+"px";this.textarea.style.zIndex=5;s=this.getInitialValue(s,t);null==s||0==s.length?(s=this.getEmptyLabelText(),this.clearOnChange=!0):this.clearOnChange=!1;this.setModified(!1);this.textarea.value=s;this.graph.container.appendChild(this.textarea);"none"!=this.textarea.style.display&&(this.autoSize&&(this.textDiv=this.createTextDiv(),document.body.appendChild(this.textDiv),this.resize()),this.textarea.focus(),this.selectText&&(mxClient.IS_IOS?window.setTimeout(mxUtils.bind(this,function(){this.textarea.setSelectionRange(0,9999)}),1):this.textarea.select()))}};mxCellEditor.prototype.createTextDiv=function(){var d=document.createElement("div"),c=d.style;c.position="absolute";c.whiteSpace="nowrap";c.visibility="hidden";c.display=mxClient.IS_QUIRKS?"inline":"inline-block";c.zoom="1";c.verticalAlign="top";c.lineHeight=this.textarea.style.lineHeight;c.fontSize=this.textarea.style.fontSize;c.fontFamily=this.textarea.style.fontFamily;c.fontWeight=this.textarea.style.fontWeight;c.textAlign=this.textarea.style.textAlign;c.fontStyle=this.textarea.style.fontStyle;c.textDecoration=this.textarea.style.textDecoration;return d};mxCellEditor.prototype.stopEditing=function(b){null!=this.editingCell&&(null!=this.textNode&&(this.textNode.style.visibility="visible",this.textNode=null),!b&&this.isModified()&&this.graph.labelChanged(this.editingCell,this.getCurrentValue(),this.trigger),null!=this.textDiv&&(document.body.removeChild(this.textDiv),this.textDiv=null),this.bounds=this.trigger=this.editingCell=null,this.textarea.blur(),this.textarea.parentNode.removeChild(this.textarea))};mxCellEditor.prototype.getInitialValue=function(d,c){return this.graph.getEditingValue(d.cell,c)};mxCellEditor.prototype.getCurrentValue=function(){return this.textarea.value.replace(/\r/g,"")};mxCellEditor.prototype.isHideLabel=function(b){return !0};mxCellEditor.prototype.getMinimumSize=function(d){var c=this.graph.getView().scale;return new mxRectangle(0,0,null==d.text?30:d.text.size*c+20,"left"==this.textarea.style.textAlign?120:40)};mxCellEditor.prototype.getEditorBounds=function(s){var r=this.graph.getModel().isEdge(s.cell),q=this.graph.getView().scale,p=this.getMinimumSize(s),o=p.width,p=p.height,n=parseInt(s.style[mxConstants.STYLE_SPACING]||0)*q,m=(parseInt(s.style[mxConstants.STYLE_SPACING_TOP]||0)+mxText.prototype.baseSpacingTop)*q+n,l=(parseInt(s.style[mxConstants.STYLE_SPACING_RIGHT]||0)+mxText.prototype.baseSpacingRight)*q+n,i=(parseInt(s.style[mxConstants.STYLE_SPACING_BOTTOM]||0)+mxText.prototype.baseSpacingBottom)*q+n,q=(parseInt(s.style[mxConstants.STYLE_SPACING_LEFT]||0)+mxText.prototype.baseSpacingLeft)*q+n,l=new mxRectangle(s.x,s.y,Math.max(o,s.width-q-l),Math.max(p,s.height-m-i)),l=null!=s.shape?s.shape.getLabelBounds(l):l;r?(l.x=s.absoluteOffset.x,l.y=s.absoluteOffset.y,null!=s.text&&null!=s.text.boundingBox&&(0<s.text.boundingBox.x&&(l.x=s.text.boundingBox.x),0<s.text.boundingBox.y&&(l.y=s.text.boundingBox.y))):null!=s.text&&null!=s.text.boundingBox&&(l.x=Math.min(l.x,s.text.boundingBox.x),l.y=Math.min(l.y,s.text.boundingBox.y));l.x+=q;l.y+=m;null!=s.text&&null!=s.text.boundingBox&&(r?(l.width=Math.max(o,s.text.boundingBox.width),l.height=Math.max(p,s.text.boundingBox.height)):(l.width=Math.max(l.width,s.text.boundingBox.width),l.height=Math.max(l.height,s.text.boundingBox.height)));this.graph.getModel().isVertex(s.cell)&&(r=mxUtils.getValue(s.style,mxConstants.STYLE_LABEL_POSITION,mxConstants.ALIGN_CENTER),r==mxConstants.ALIGN_LEFT?l.x-=s.width:r==mxConstants.ALIGN_RIGHT&&(l.x+=s.width),r=mxUtils.getValue(s.style,mxConstants.STYLE_VERTICAL_LABEL_POSITION,mxConstants.ALIGN_MIDDLE),r==mxConstants.ALIGN_TOP?l.y-=s.height:r==mxConstants.ALIGN_BOTTOM&&(l.y+=s.height));return l};mxCellEditor.prototype.getEmptyLabelText=function(b){return this.emptyLabelText};mxCellEditor.prototype.getEditingCell=function(){return this.editingCell};mxCellEditor.prototype.destroy=function(){null!=this.textarea&&(mxEvent.release(this.textarea),null!=this.textarea.parentNode&&this.textarea.parentNode.removeChild(this.textarea),this.textarea=null,null!=this.changeHandler&&(this.graph.getModel().removeListener(this.changeHandler),this.changeHandler=null))};function mxCellRenderer(){}mxCellRenderer.prototype.defaultEdgeShape=mxConnector;mxCellRenderer.prototype.defaultVertexShape=mxRectangleShape;mxCellRenderer.prototype.defaultTextShape=mxText;mxCellRenderer.prototype.legacyControlPosition=!0;mxCellRenderer.prototype.defaultShapes={};mxCellRenderer.registerShape=function(d,c){mxCellRenderer.prototype.defaultShapes[d]=c};mxCellRenderer.registerShape(mxConstants.SHAPE_RECTANGLE,mxRectangleShape);mxCellRenderer.registerShape(mxConstants.SHAPE_ELLIPSE,mxEllipse);mxCellRenderer.registerShape(mxConstants.SHAPE_RHOMBUS,mxRhombus);mxCellRenderer.registerShape(mxConstants.SHAPE_CYLINDER,mxCylinder);mxCellRenderer.registerShape(mxConstants.SHAPE_CONNECTOR,mxConnector);mxCellRenderer.registerShape(mxConstants.SHAPE_ACTOR,mxActor);mxCellRenderer.registerShape(mxConstants.SHAPE_TRIANGLE,mxTriangle);mxCellRenderer.registerShape(mxConstants.SHAPE_HEXAGON,mxHexagon);mxCellRenderer.registerShape(mxConstants.SHAPE_CLOUD,mxCloud);mxCellRenderer.registerShape(mxConstants.SHAPE_LINE,mxLine);mxCellRenderer.registerShape(mxConstants.SHAPE_ARROW,mxArrow);mxCellRenderer.registerShape(mxConstants.SHAPE_DOUBLE_ELLIPSE,mxDoubleEllipse);mxCellRenderer.registerShape(mxConstants.SHAPE_SWIMLANE,mxSwimlane);mxCellRenderer.registerShape(mxConstants.SHAPE_IMAGE,mxImageShape);mxCellRenderer.registerShape(mxConstants.SHAPE_LABEL,mxLabel);mxCellRenderer.prototype.initializeShape=function(b){b.shape.dialect=b.view.graph.dialect;b.shape.init(b.view.getDrawPane())};mxCellRenderer.prototype.createShape=function(d){if(null!=d.style){var c=mxStencilRegistry.getStencil(d.style[mxConstants.STYLE_SHAPE]);null!=c?d.shape=new mxShape(c):(c=this.getShapeConstructor(d),d.shape=new c);this.createIndicatorShape(d);this.initializeShape(d);this.createCellOverlays(d);this.installListeners(d)}};mxCellRenderer.prototype.createIndicatorShape=function(b){b.shape.indicatorShape=this.getShape(b.view.graph.getIndicatorShape(b))};mxCellRenderer.prototype.getShape=function(b){return null!=b?mxCellRenderer.prototype.defaultShapes[b]:null};mxCellRenderer.prototype.getShapeConstructor=function(d){var c=this.getShape(d.style[mxConstants.STYLE_SHAPE]);null==c&&(c=d.view.graph.getModel().isEdge(d.cell)?this.defaultEdgeShape:this.defaultVertexShape);return c};mxCellRenderer.prototype.configureShape=function(b){b.shape.apply(b);b.shape.image=b.view.graph.getImage(b);b.shape.indicatorColor=b.view.graph.getIndicatorColor(b);b.shape.indicatorGradientColor=b.view.graph.getIndicatorGradientColor(b);b.shape.indicatorDirection=b.style[mxConstants.STYLE_INDICATOR_DIRECTION];b.shape.indicatorImage=b.view.graph.getIndicatorImage(b);this.postConfigureShape(b)};mxCellRenderer.prototype.postConfigureShape=function(b){null!=b.shape&&(this.resolveColor(b,"indicatorColor",mxConstants.STYLE_FILLCOLOR),this.resolveColor(b,"indicatorGradientColor",mxConstants.STYLE_GRADIENTCOLOR),this.resolveColor(b,"fill",mxConstants.STYLE_FILLCOLOR),this.resolveColor(b,"stroke",mxConstants.STYLE_STROKECOLOR),this.resolveColor(b,"gradient",mxConstants.STYLE_GRADIENTCOLOR))};mxCellRenderer.prototype.resolveColor=function(h,g,m){var l=h.shape[g],k=h.view.graph,i=null;"inherit"==l?i=k.model.getParent(h.cell):"swimlane"==l?(i=null!=k.model.getTerminal(h.cell,!1)?k.model.getTerminal(h.cell,!1):h.cell,i=k.getSwimlane(i),m=k.swimlaneIndicatorColorAttribute):"indicated"==l&&(h.shape[g]=h.shape.indicatorColor);null!=i&&(l=k.getView().getState(i),h.shape[g]=null,null!=l&&(h.shape[g]=null!=l.shape&&"indicatorColor"!=g?l.shape[g]:l.style[m]))};mxCellRenderer.prototype.getLabelValue=function(b){return b.view.graph.getLabel(b.cell)};mxCellRenderer.prototype.createLabel=function(h,g){var m=h.view.graph;m.getModel().isEdge(h.cell);if(0<h.style[mxConstants.STYLE_FONTSIZE]||null==h.style[mxConstants.STYLE_FONTSIZE]){var l=m.isHtmlLabel(h.cell)||null!=g&&mxUtils.isNode(g);h.text=new this.defaultTextShape(g,new mxRectangle,h.style[mxConstants.STYLE_ALIGN]||mxConstants.ALIGN_CENTER,m.getVerticalAlign(h),h.style[mxConstants.STYLE_FONTCOLOR],h.style[mxConstants.STYLE_FONTFAMILY],h.style[mxConstants.STYLE_FONTSIZE],h.style[mxConstants.STYLE_FONTSTYLE],h.style[mxConstants.STYLE_SPACING],h.style[mxConstants.STYLE_SPACING_TOP],h.style[mxConstants.STYLE_SPACING_RIGHT],h.style[mxConstants.STYLE_SPACING_BOTTOM],h.style[mxConstants.STYLE_SPACING_LEFT],h.style[mxConstants.STYLE_HORIZONTAL],h.style[mxConstants.STYLE_LABEL_BACKGROUNDCOLOR],h.style[mxConstants.STYLE_LABEL_BORDERCOLOR],m.isWrapping(h.cell)&&m.isHtmlLabel(h.cell),m.isLabelClipped(h.cell),h.style[mxConstants.STYLE_OVERFLOW],h.style[mxConstants.STYLE_LABEL_PADDING]);h.text.opacity=mxUtils.getValue(h.style,mxConstants.STYLE_TEXT_OPACITY,100);h.text.dialect=l?mxConstants.DIALECT_STRICTHTML:h.view.graph.dialect;h.text.state=h;this.initializeLabel(h);var k=!1,i=function(a){var c=h;if(mxClient.IS_TOUCH||k){c=mxEvent.getClientX(a),a=mxEvent.getClientY(a),a=mxUtils.convertPoint(m.container,c,a),c=m.view.getState(m.getCellAt(a.x,a.y))}return c};mxEvent.addGestureListeners(h.text.node,mxUtils.bind(this,function(a){this.isLabelEvent(h,a)&&(m.fireMouseEvent(mxEvent.MOUSE_DOWN,new mxMouseEvent(a,h)),k=m.dialect!=mxConstants.DIALECT_SVG&&"IMG"==mxEvent.getSource(a).nodeName)}),mxUtils.bind(this,function(a){this.isLabelEvent(h,a)&&m.fireMouseEvent(mxEvent.MOUSE_MOVE,new mxMouseEvent(a,i(a)))}),mxUtils.bind(this,function(a){this.isLabelEvent(h,a)&&(m.fireMouseEvent(mxEvent.MOUSE_UP,new mxMouseEvent(a,i(a))),k=!1)}));m.nativeDblClickEnabled&&mxEvent.addListener(h.text.node,"dblclick",mxUtils.bind(this,function(a){this.isLabelEvent(h,a)&&(m.dblClick(a,h.cell),mxEvent.consume(a))}))}};mxCellRenderer.prototype.initializeLabel=function(b){mxClient.IS_SVG&&mxClient.NO_FO&&b.text.dialect!=mxConstants.DIALECT_SVG?b.text.init(b.view.graph.container):b.text.init(b.view.getDrawPane())};mxCellRenderer.prototype.createCellOverlays=function(g){var f=g.view.graph.getCellOverlays(g.cell),k=null;if(null!=f){for(var k=new mxDictionary,i=0;i<f.length;i++){var h=null!=g.overlays?g.overlays.remove(f[i]):null;null==h&&(h=new mxImageShape(new mxRectangle,f[i].image.src),h.dialect=g.view.graph.dialect,h.preserveImageAspect=!1,h.overlay=f[i],this.initializeOverlay(g,h),this.installCellOverlayListeners(g,f[i],h),null!=f[i].cursor&&(h.node.style.cursor=f[i].cursor));k.put(f[i],h)}}null!=g.overlays&&g.overlays.visit(function(d,c){c.destroy()});g.overlays=k};mxCellRenderer.prototype.initializeOverlay=function(d,c){c.init(d.view.getOverlayPane())};mxCellRenderer.prototype.installCellOverlayListeners=function(f,e,h){var g=f.view.graph;mxEvent.addListener(h.node,"click",function(a){g.isEditing()&&g.stopEditing(!g.isInvokesStopCellEditing());e.fireEvent(new mxEventObject(mxEvent.CLICK,"event",a,"cell",f.cell))});mxEvent.addGestureListeners(h.node,function(b){mxEvent.consume(b)},function(a){g.fireMouseEvent(mxEvent.MOUSE_MOVE,new mxMouseEvent(a,f))});mxClient.IS_TOUCH&&mxEvent.addListener(h.node,"touchend",function(a){e.fireEvent(new mxEventObject(mxEvent.CLICK,"event",a,"cell",f.cell))})};mxCellRenderer.prototype.createControl=function(f){var e=f.view.graph,h=e.getFoldingImage(f);if(e.foldingEnabled&&null!=h){if(null==f.control){var g=new mxRectangle(0,0,h.width,h.height);f.control=new mxImageShape(g,h.src);f.control.preserveImageAspect=!1;f.control.dialect=e.dialect;this.initControl(f,f.control,!0,function(b){if(e.isEnabled()){var a=!e.isCellCollapsed(f.cell);e.foldCells(a,!1,[f.cell]);mxEvent.consume(b)}})}}else{null!=f.control&&(f.control.destroy(),f.control=null)}};mxCellRenderer.prototype.initControl=function(g,f,k,i){var h=g.view.graph;h.isHtmlLabel(g.cell)&&mxClient.NO_FO&&h.dialect==mxConstants.DIALECT_SVG?(f.dialect=mxConstants.DIALECT_PREFERHTML,f.init(h.container),f.node.style.zIndex=1):f.init(g.view.getOverlayPane());f=f.innerNode||f.node;i&&(h.isEnabled()&&(f.style.cursor="pointer"),mxEvent.addListener(f,"click",i));k&&mxEvent.addGestureListeners(f,function(a){h.fireMouseEvent(mxEvent.MOUSE_DOWN,new mxMouseEvent(a,g));mxEvent.consume(a)},function(a){h.fireMouseEvent(mxEvent.MOUSE_MOVE,new mxMouseEvent(a,g))});return f};mxCellRenderer.prototype.isShapeEvent=function(d,c){return !0};mxCellRenderer.prototype.isLabelEvent=function(d,c){return !0};mxCellRenderer.prototype.installListeners=function(f){var e=f.view.graph,h=function(b){var a=f;if(e.dialect!=mxConstants.DIALECT_SVG&&"IMG"==mxEvent.getSource(b).nodeName||mxClient.IS_TOUCH){a=mxEvent.getClientX(b),b=mxEvent.getClientY(b),b=mxUtils.convertPoint(e.container,a,b),a=e.view.getState(e.getCellAt(b.x,b.y))}return a},g=!1;mxClient.IS_TOUCH&&(mxEvent.addListener(f.shape.node,"gesturestart",mxUtils.bind(this,function(b){e.lastTouchTime=0;g=!0;mxEvent.consume(b)})),mxEvent.addListener(f.shape.node,"gestureend",mxUtils.bind(this,function(a){g=!1;e.fireGestureEvent(a,f.cell);mxEvent.consume(a)})));mxEvent.addGestureListeners(f.shape.node,mxUtils.bind(this,function(a){this.isShapeEvent(f,a)&&!g?e.fireMouseEvent(mxEvent.MOUSE_DOWN,new mxMouseEvent(a,null!=f.shape&&mxEvent.getSource(a)==f.shape.content?null:f)):g&&mxEvent.consume(a)}),mxUtils.bind(this,function(a){this.isShapeEvent(f,a)&&!g?e.fireMouseEvent(mxEvent.MOUSE_MOVE,new mxMouseEvent(a,null!=f.shape&&mxEvent.getSource(a)==f.shape.content?null:h(a))):g&&mxEvent.consume(a)}),mxUtils.bind(this,function(a){this.isShapeEvent(f,a)&&!g?e.fireMouseEvent(mxEvent.MOUSE_UP,new mxMouseEvent(a,null!=f.shape&&mxEvent.getSource(a)==f.shape.content?null:h(a))):g&&mxEvent.consume(a)}));e.nativeDblClickEnabled&&mxEvent.addListener(f.shape.node,"dblclick",mxUtils.bind(this,function(a){this.isShapeEvent(f,a)&&(e.dblClick(a,f.cell),mxEvent.consume(a))}))};mxCellRenderer.prototype.redrawLabel=function(h,g){var m=this.getLabelValue(h);if(null==h.text&&null!=m&&(mxUtils.isNode(m)||0<m.length)){this.createLabel(h,m)}else{if(null!=h.text&&(null==m||0==m.length)){h.text.destroy(),h.text=null}}if(null!=h.text){var l=h.view.graph,k=l.isWrapping(h.cell),l=l.isLabelClipped(h.cell),i=this.getLabelBounds(h);if(g||h.text.value!=m||h.text.isWrapping!=k||h.text.isClipping!=l||h.text.scale!=h.view.scale||!h.text.bounds.equals(i)){h.text.value=m,h.text.bounds=i,h.text.scale=this.getTextScale(h),h.text.isWrapping=k,h.text.isClipping=l,h.text.redraw()}}};mxCellRenderer.prototype.getTextScale=function(b){return b.view.scale};mxCellRenderer.prototype.getLabelBounds=function(h){var g=h.view.graph,m=h.view.scale,l=g.getModel().isEdge(h.cell),k=new mxRectangle(h.absoluteOffset.x,h.absoluteOffset.y);if(l){var i=h.text.getSpacing();k.x+=i.x*m;k.y+=i.y*m;g=g.getCellGeometry(h.cell);null!=g&&(k.width=Math.max(0,g.width*m),k.height=Math.max(0,g.height*m))}else{h.text.isPaintBoundsInverted()&&(i=k.x,k.x=k.y,k.y=i),k.x+=h.x,k.y+=h.y,k.width=Math.max(1,h.width),k.height=Math.max(1,h.height),g.isSwimlane(h.cell)&&(g=g.getStartSize(h.cell),0<g.width?(i=Math.min(k.width,g.width*m),h.shape.flipH&&(k.x+=k.width-i),k.width=i):0<g.height&&(i=Math.min(k.height,g.height*m),h.shape.flipV&&(k.y+=k.height-i),k.height=i))}null!=h.shape&&(k=h.shape.getLabelBounds(k));l||this.rotateLabelBounds(h,k);return k};mxCellRenderer.prototype.rotateLabelBounds=function(g,f){if(g.text.isPaintBoundsInverted()){var k=(g.width-g.height)/2;f.x+=k;f.y-=k;k=f.width;f.width=f.height;f.height=k}f.x-=g.text.margin.x*f.width;f.y-=g.text.margin.y*f.height;if("fill"!=g.style[mxConstants.STYLE_OVERFLOW]&&"width"!=g.style[mxConstants.STYLE_OVERFLOW]){var k=g.view.scale,i=g.text.getSpacing();f.x+=i.x*k;f.y+=i.y*k;f.width=Math.max(0,f.width-g.text.spacingLeft*k-g.text.spacingRight*k);f.height=Math.max(0,f.height-g.text.spacingTop*k-g.text.spacingBottom*k)}var h=g.text.getTextRotation();if(0!=h&&(null!=g&&g.view.graph.model.isVertex(g.cell))&&(k=g.getCenterX(),i=g.getCenterY(),f.x!=k||f.y!=i)){h*=Math.PI/180,pt=mxUtils.getRotatedPoint(new mxPoint(f.x,f.y),Math.cos(h),Math.sin(h),new mxPoint(k,i)),f.x=pt.x,f.y=pt.y}};mxCellRenderer.prototype.redrawCellOverlays=function(h,g){this.createCellOverlays(h);if(null!=h.overlays){var m=mxUtils.mod(mxUtils.getValue(h.style,mxConstants.STYLE_ROTATION,0),90),l=mxUtils.toRadians(m),k=Math.cos(l),i=Math.sin(l);h.overlays.visit(function(f,e){var c=e.overlay.getBounds(h);if(!h.view.graph.getModel().isEdge(h.cell)&&null!=h.shape&&0!=m){var b=c.getCenterX(),a=c.getCenterY(),a=mxUtils.getRotatedPoint(new mxPoint(b,a),k,i,new mxPoint(h.getCenterX(),h.getCenterY())),b=a.x,a=a.y;c.x=Math.round(b-c.width/2);c.y=Math.round(a-c.height/2)}if(g||null==e.bounds||e.scale!=h.view.scale||!e.bounds.equals(c)){e.bounds=c,e.scale=h.view.scale,e.redraw()}})}};mxCellRenderer.prototype.redrawControl=function(g,f){if(null!=g.control){var k=this.getControlBounds(g),i=this.legacyControlPosition?mxUtils.getValue(g.style,mxConstants.STYLE_ROTATION,0):g.shape.getTextRotation(),h=g.view.scale;if(f||g.control.scale!=h||!g.control.bounds.equals(k)||g.control.rotation!=i){g.control.rotation=i,g.control.bounds=k,g.control.scale=h,g.control.redraw()}}};mxCellRenderer.prototype.getControlBounds=function(k){if(null!=k.control){var i=k.control.scale,q=k.control.bounds.width/i,i=k.control.bounds.height/i,p=k.view.scale,o=k.getCenterX(),n=k.getCenterY();if(!k.view.graph.getModel().isEdge(k.cell)&&(o=k.x+q*p,n=k.y+i*p,null!=k.shape)){var m=k.shape.getShapeRotation();if(this.legacyControlPosition){m=mxUtils.getValue(k.style,mxConstants.STYLE_ROTATION,0)}else{if(k.shape.isPaintBoundsInverted()){var l=(k.width-k.height)/2,o=o+l,n=n-l}}0!=m&&(l=mxUtils.toRadians(m),m=Math.cos(l),l=Math.sin(l),n=mxUtils.getRotatedPoint(new mxPoint(o,n),m,l,new mxPoint(k.getCenterX(),k.getCenterY())),o=n.x,n=n.y)}return k.view.graph.getModel().isEdge(k.cell),new mxRectangle(Math.round(o-q/2*p),Math.round(n-i/2*p),Math.round(q*p),Math.round(i*p))}return null};mxCellRenderer.prototype.insertStateAfter=function(i,h,o){for(var n=this.getShapesForState(i),m=0;m<n.length;m++){if(null!=n[m]){var l=n[m].node.parentNode==i.view.graph.container,k=l?o:h;null!=k&&k.nextSibling!=n[m].node&&(null==k.nextSibling?k.parentNode.appendChild(n[m].node):k.parentNode.insertBefore(n[m].node,k.nextSibling));l?o=n[m].node:h=n[m].node}}return[h,o]};mxCellRenderer.prototype.getShapesForState=function(b){return[b.shape,b.text]};mxCellRenderer.prototype.redraw=function(e,d,f){d=this.redrawShape(e,d,f);if(null!=e.shape&&(null==f||f)){this.redrawLabel(e,d),this.redrawCellOverlays(e,d),this.redrawControl(e,d)}};mxCellRenderer.prototype.redrawShape=function(g,f,k){var i=!1,h=g.view.graph.getModel();null==g.shape&&(null!=g.view.graph.container&&g.cell!=g.view.currentRoot&&(h.isVertex(g.cell)||h.isEdge(g.cell)))&&this.createShape(g);if(null!=g.shape&&(this.createControl(g),mxUtils.equalEntries(g.shape.style,g.style)||(this.configureShape(g),f=!0),f||null==g.shape.bounds||g.shape.scale!=g.view.scale||null==g.absolutePoints&&!g.shape.bounds.equals(g)||null!=g.absolutePoints&&!mxUtils.equalPoints(g.shape.points,g.absolutePoints))){null!=g.absolutePoints?(g.shape.points=g.absolutePoints.slice(),g.shape.bounds=null):(g.shape.points=null,g.shape.bounds=new mxRectangle(g.x,g.y,g.width,g.height)),g.shape.scale=g.view.scale,null==k||k?g.shape.redraw():g.shape.updateBoundingBox(),i=!0}return i};mxCellRenderer.prototype.destroy=function(b){null!=b.shape&&(null!=b.text&&(b.text.destroy(),b.text=null),null!=b.overlays&&(b.overlays.visit(function(d,e){e.destroy()}),b.overlays=null),null!=b.control&&(b.control.destroy(),b.control=null),b.shape.destroy(),b.shape=null)};var mxEdgeStyle={EntityRelation:function(w,v,u,t,s){var r=w.view,q=r.graph;t=mxUtils.getValue(w.style,mxConstants.STYLE_SEGMENT,mxConstants.ENTITY_SEGMENT)*r.scale;var p=w.absolutePoints,o=p[0],n=p[p.length-1],p=!1;if(null!=o){v=new mxCellState,v.x=o.x,v.y=o.y}else{if(null!=v){var i=mxUtils.getPortConstraints(v,w,!0,mxConstants.DIRECTION_MASK_NONE);i!=mxConstants.DIRECTION_MASK_NONE?p=i==mxConstants.DIRECTION_MASK_WEST:(o=q.getCellGeometry(v.cell),o.relative?p=0.5>=o.x:null!=u&&(p=u.x+u.width<v.x))}else{return}}o=!0;null!=n?(u=new mxCellState,u.x=n.x,u.y=n.y):null!=u&&(i=mxUtils.getPortConstraints(u,w,!1,mxConstants.DIRECTION_MASK_NONE),i!=mxConstants.DIRECTION_MASK_NONE?o=i==mxConstants.DIRECTION_MASK_WEST:(w=q.getCellGeometry(u.cell),w.relative?o=0.5>=w.x:null!=v&&(o=v.x+v.width<u.x)));null!=v&&null!=u&&(w=p?v.x:v.x+v.width,v=r.getRoutingCenterY(v),q=o?u.x:u.x+u.width,u=r.getRoutingCenterY(u),r=new mxPoint(w+(p?-t:t),v),n=new mxPoint(q+(o?-t:t),u),p==o?(t=p?Math.min(w,q)-t:Math.max(w,q)+t,s.push(new mxPoint(t,v)),s.push(new mxPoint(t,u))):(r.x<n.x==p?(t=v+(u-v)/2,s.push(r),s.push(new mxPoint(r.x,t)),s.push(new mxPoint(n.x,t))):s.push(r),s.push(n)))},Loop:function(u,t,s,r,q){if(null!=t){s=u.view;var p=s.graph;r=null!=r&&0<r.length?r[0]:null;null!=r&&(r=s.transformControlPoint(u,r),mxUtils.contains(t,r.x,r.y)&&(r=null));var o=0,n=0,m=0,i=0,p=mxUtils.getValue(u.style,mxConstants.STYLE_SEGMENT,p.gridSize)*s.scale;u=mxUtils.getValue(u.style,mxConstants.STYLE_DIRECTION,mxConstants.DIRECTION_WEST);u==mxConstants.DIRECTION_NORTH||u==mxConstants.DIRECTION_SOUTH?(o=s.getRoutingCenterX(t),n=p):(m=s.getRoutingCenterY(t),i=p);null==r||r.x<t.x||r.x>t.x+t.width?null!=r?(o=r.x,i=Math.max(Math.abs(m-r.y),i)):u==mxConstants.DIRECTION_NORTH?m=t.y-2*n:u==mxConstants.DIRECTION_SOUTH?m=t.y+t.height+2*n:o=u==mxConstants.DIRECTION_EAST?t.x-2*i:t.x+t.width+2*i:null!=r&&(o=s.getRoutingCenterX(t),n=Math.max(Math.abs(o-r.x),i),m=r.y,i=0);q.push(new mxPoint(o-n,m-i));q.push(new mxPoint(o+n,m+i))}},ElbowConnector:function(w,v,u,t,s){var r=null!=t&&0<t.length?t[0]:null,q=!1,p=!1;if(null!=v&&null!=u){if(null!=r){var o=Math.min(v.x,u.x),n=Math.max(v.x+v.width,u.x+u.width),p=Math.min(v.y,u.y),i=Math.max(v.y+v.height,u.y+u.height),r=w.view.transformControlPoint(w,r),q=r.y<p||r.y>i,p=r.x<o||r.x>n}else{o=Math.max(v.x,u.x),n=Math.min(v.x+v.width,u.x+u.width),q=o==n,q||(p=Math.max(v.y,u.y),i=Math.min(v.y+v.height,u.y+u.height),p=p==i)}}!p&&(q||w.style[mxConstants.STYLE_ELBOW]==mxConstants.ELBOW_VERTICAL)?mxEdgeStyle.TopToBottom(w,v,u,t,s):mxEdgeStyle.SideToSide(w,v,u,t,s)},SideToSide:function(k,i,q,p,o){var n=k.view;p=null!=p&&0<p.length?p[0]:null;var m=k.absolutePoints,l=m[0],m=m[m.length-1];null!=p&&(p=n.transformControlPoint(k,p));null!=l&&(i=new mxCellState,i.x=l.x,i.y=l.y);null!=m&&(q=new mxCellState,q.x=m.x,q.y=m.y);null!=i&&null!=q&&(k=Math.max(i.x,q.x),l=Math.min(i.x+i.width,q.x+q.width),k=null!=p?p.x:l+(k-l)/2,l=n.getRoutingCenterY(i),n=n.getRoutingCenterY(q),null!=p&&(p.y>=i.y&&p.y<=i.y+i.height&&(l=p.y),p.y>=q.y&&p.y<=q.y+q.height&&(n=p.y)),!mxUtils.contains(q,k,l)&&!mxUtils.contains(i,k,l)&&o.push(new mxPoint(k,l)),!mxUtils.contains(q,k,n)&&!mxUtils.contains(i,k,n)&&o.push(new mxPoint(k,n)),1==o.length&&(null!=p?!mxUtils.contains(q,k,p.y)&&!mxUtils.contains(i,k,p.y)&&o.push(new mxPoint(k,p.y)):(n=Math.max(i.y,q.y),i=Math.min(i.y+i.height,q.y+q.height),o.push(new mxPoint(k,n+(i-n)/2)))))},TopToBottom:function(k,i,q,p,o){var n=k.view;p=null!=p&&0<p.length?p[0]:null;var m=k.absolutePoints,l=m[0],m=m[m.length-1];null!=p&&(p=n.transformControlPoint(k,p));null!=l&&(i=new mxCellState,i.x=l.x,i.y=l.y);null!=m&&(q=new mxCellState,q.x=m.x,q.y=m.y);null!=i&&null!=q&&(l=Math.max(i.y,q.y),m=Math.min(i.y+i.height,q.y+q.height),k=n.getRoutingCenterX(i),null!=p&&(p.x>=i.x&&p.x<=i.x+i.width)&&(k=p.x),l=null!=p?p.y:m+(l-m)/2,!mxUtils.contains(q,k,l)&&!mxUtils.contains(i,k,l)&&o.push(new mxPoint(k,l)),k=null!=p&&p.x>=q.x&&p.x<=q.x+q.width?p.x:n.getRoutingCenterX(q),!mxUtils.contains(q,k,l)&&!mxUtils.contains(i,k,l)&&o.push(new mxPoint(k,l)),1==o.length&&(null!=p&&1==o.length?!mxUtils.contains(q,p.x,l)&&!mxUtils.contains(i,p.x,l)&&o.push(new mxPoint(p.x,l)):(n=Math.max(i.x,q.x),i=Math.min(i.x+i.width,q.x+q.width),o.push(new mxPoint(n+(i-n)/2,l)))))},SegmentConnector:function(M,L,K,J,I){var H=M.absolutePoints,G=!0,F=null,E=H[0];null==E&&null!=L?E=new mxPoint(M.view.getRoutingCenterX(L),M.view.getRoutingCenterY(L)):null!=E&&(E=E.clone());var D=H.length-1;if(null!=J&&0<J.length){for(var F=M.view.transformControlPoint(M,J[0]),C=L,B=H[0],A=!1,z=!1,A=F,x=J.length,y=0;2>y;y++){var w=null!=B&&B.x==A.x,o=null!=B&&B.y==A.y,i=null!=C&&A.y>=C.y&&A.y<=C.y+C.height,C=null!=C&&A.x>=C.x&&A.x<=C.x+C.width,A=o||null==B&&i,z=w||null==B&&C;if(null!=B&&!o&&!w&&(i||C)){G=i?!1:!0;break}if(z||A){G=A;1==y&&(G=0==J.length%2?A:z);break}C=K;B=H[D];A=M.view.transformControlPoint(M,J[x-1])}G&&(null!=H[0]&&H[0].y!=F.y||null==H[0]&&null!=L&&(F.y<L.y||F.y>L.y+L.height))?I.push(new mxPoint(E.x,F.y)):!G&&(null!=H[0]&&H[0].x!=F.x||null==H[0]&&null!=L&&(F.x<L.x||F.x>L.x+L.width))&&I.push(new mxPoint(F.x,E.y));G?E.y=F.y:E.x=F.x;for(y=0;y<J.length;y++){G=!G,F=M.view.transformControlPoint(M,J[y]),G?E.y=F.y:E.x=F.x,I.push(E.clone())}}else{F=E,G=!0}E=H[D];null==E&&null!=K&&(E=new mxPoint(M.view.getRoutingCenterX(K),M.view.getRoutingCenterY(K)));G&&(null!=H[D]&&H[D].y!=F.y||null==H[D]&&null!=K&&(F.y<K.y||F.y>K.y+K.height))?I.push(new mxPoint(E.x,F.y)):!G&&(null!=H[D]&&H[D].x!=F.x||null==H[D]&&null!=K&&(F.x<K.x||F.x>K.x+K.width))&&I.push(new mxPoint(F.x,E.y));if(null==H[0]&&null!=L){for(;1<I.length&&mxUtils.contains(L,I[1].x,I[1].y);){I=I.splice(1,1)}}if(null==H[D]&&null!=K){for(;1<I.length&&mxUtils.contains(K,I[I.length-1].x,I[I.length-1].y);){I=I.splice(I.length-1,1)}}},orthBuffer:10,orthPointsFallback:!0,dirVectors:[[-1,0],[0,-1],[1,0],[0,1],[-1,0],[0,-1],[1,0]],wayPoints1:[[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0]],routePatterns:[[[513,2308,2081,2562],[513,1090,514,2184,2114,2561],[513,1090,514,2564,2184,2562],[513,2308,2561,1090,514,2568,2308]],[[514,1057,513,2308,2081,2562],[514,2184,2114,2561],[514,2184,2562,1057,513,2564,2184],[514,1057,513,2568,2308,2561]],[[1090,514,1057,513,2308,2081,2562],[2114,2561],[1090,2562,1057,513,2564,2184],[1090,514,1057,513,2308,2561,2568]],[[2081,2562],[1057,513,1090,514,2184,2114,2561],[1057,513,1090,514,2184,2562,2564],[1057,2561,1090,514,2568,2308]]],inlineRoutePatterns:[[null,[2114,2568],null,null],[null,[514,2081,2114,2568],null,null],[null,[2114,2561],null,null],[[2081,2562],[1057,2114,2568],[2184,2562],null]],vertexSeperations:[],limits:[[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0]],LEFT_MASK:32,TOP_MASK:64,RIGHT_MASK:128,BOTTOM_MASK:256,LEFT:1,TOP:2,RIGHT:4,BOTTOM:8,SIDE_MASK:480,CENTER_MASK:512,SOURCE_MASK:1024,TARGET_MASK:2048,VERTEX_MASK:3072,OrthConnector:function(G,F,E,D,C){var B=G.view.graph,A=null==F?!1:B.getModel().isEdge(F.cell),B=null==E?!1:B.getModel().isEdge(E.cell);if(mxEdgeStyle.orthPointsFallback&&null!=D&&0<D.length||A||B){mxEdgeStyle.SegmentConnector(G,F,E,D,C)}else{D=G.absolutePoints;var z=D[0],y=D[D.length-1];D=null!=F?F.x:z.x;var A=null!=F?F.y:z.y,x=null!=F?F.width:1,w=null!=F?F.height:1,v=null!=E?E.x:y.x,u=null!=E?E.y:y.y,o=null!=E?E.width:1,I=null!=E?E.height:1,B=G.view.scale*mxEdgeStyle.orthBuffer,i=[mxConstants.DIRECTION_MASK_ALL,mxConstants.DIRECTION_MASK_ALL];null!=F&&(i[0]=mxUtils.getPortConstraints(F,G,!0,mxConstants.DIRECTION_MASK_ALL));null!=E&&(i[1]=mxUtils.getPortConstraints(E,G,!1,mxConstants.DIRECTION_MASK_ALL));G=[0,0];D=[[D,A,x,w],[v,u,o,I]];for(x=0;2>x;x++){mxEdgeStyle.limits[x][1]=D[x][0]-B,mxEdgeStyle.limits[x][2]=D[x][1]-B,mxEdgeStyle.limits[x][4]=D[x][0]+D[x][2]+B,mxEdgeStyle.limits[x][8]=D[x][1]+D[x][3]+B}x=D[0][0]+D[0][2]/2-(D[1][0]+D[1][2]/2);w=D[0][1]+D[0][3]/2-(D[1][1]+D[1][3]/2);A=0;0>x?A=0>w?2:1:0>=w&&(A=3,0==x&&(A=2));w=null;null!=F&&(w=z);F=[[0.5,0.5],[0.5,0.5]];for(x=0;2>x;x++){null!=w&&(F[x][0]=(w.x-D[x][0])/D[x][2],0.01>F[x][0]?G[x]=mxConstants.DIRECTION_MASK_WEST:0.99<F[x][0]&&(G[x]=mxConstants.DIRECTION_MASK_EAST),F[x][1]=(w.y-D[x][1])/D[x][3],0.01>F[x][1]?G[x]=mxConstants.DIRECTION_MASK_NORTH:0.99<F[x][1]&&(G[x]=mxConstants.DIRECTION_MASK_SOUTH)),w=null,null!=E&&(w=y)}x=D[0][1]-(D[1][1]+D[1][3]);w=D[0][0]-(D[1][0]+D[1][2]);v=D[1][1]-(D[0][1]+D[0][3]);u=D[1][0]-(D[0][0]+D[0][2]);mxEdgeStyle.vertexSeperations[1]=Math.max(w-2*B,0);mxEdgeStyle.vertexSeperations[2]=Math.max(x-2*B,0);mxEdgeStyle.vertexSeperations[4]=Math.max(v-2*B,0);mxEdgeStyle.vertexSeperations[3]=Math.max(u-2*B,0);E=[];z=[];y=[];z[0]=w>=u?mxConstants.DIRECTION_MASK_WEST:mxConstants.DIRECTION_MASK_EAST;y[0]=x>=v?mxConstants.DIRECTION_MASK_NORTH:mxConstants.DIRECTION_MASK_SOUTH;z[1]=mxUtils.reversePortConstraints(z[0]);y[1]=mxUtils.reversePortConstraints(y[0]);w=w>=u?w:u;v=x>=v?x:v;u=[[0,0],[0,0]];o=!1;for(x=0;2>x;x++){0==G[x]&&(0==(z[x]&i[x])&&(z[x]=mxUtils.reversePortConstraints(z[x])),0==(y[x]&i[x])&&(y[x]=mxUtils.reversePortConstraints(y[x])),u[x][0]=y[x],u[x][1]=z[x])}v>2*B&&w>2*B&&(0<(z[0]&i[0])&&0<(y[1]&i[1])?(u[0][0]=z[0],u[0][1]=y[0],u[1][0]=y[1],u[1][1]=z[1],o=!0):0<(y[0]&i[0])&&0<(z[1]&i[1])&&(u[0][0]=y[0],u[0][1]=z[0],u[1][0]=z[1],u[1][1]=y[1],o=!0));v>2*B&&!o&&(u[0][0]=y[0],u[0][1]=z[0],u[1][0]=y[1],u[1][1]=z[1],o=!0);w>2*B&&!o&&(u[0][0]=z[0],u[0][1]=y[0],u[1][0]=z[1],u[1][1]=y[1]);for(x=0;2>x;x++){if(0==G[x]&&(0==(u[x][0]&i[x])&&(u[x][0]=u[x][1]),E[x]=u[x][0]&i[x],E[x]|=(u[x][1]&i[x])<<8,E[x]|=(u[1-x][x]&i[x])<<16,E[x]|=(u[1-x][1-x]&i[x])<<24,0==(E[x]&15)&&(E[x]<<=8),0==(E[x]&3840)&&(E[x]=E[x]&15|E[x]>>8),0==(E[x]&983040)&&(E[x]=E[x]&65535|(E[x]&251658240)>>8),G[x]=E[x]&15,i[x]==mxConstants.DIRECTION_MASK_WEST||i[x]==mxConstants.DIRECTION_MASK_NORTH||i[x]==mxConstants.DIRECTION_MASK_EAST||i[x]==mxConstants.DIRECTION_MASK_SOUTH)){G[x]=i[x]}}x=G[0]==mxConstants.DIRECTION_MASK_EAST?3:G[0];i=G[1]==mxConstants.DIRECTION_MASK_EAST?3:G[1];x-=A;i-=A;1>x&&(x+=4);1>i&&(i+=4);i=mxEdgeStyle.routePatterns[x-1][i-1];mxEdgeStyle.wayPoints1[0][0]=D[0][0];mxEdgeStyle.wayPoints1[0][1]=D[0][1];switch(G[0]){case mxConstants.DIRECTION_MASK_WEST:mxEdgeStyle.wayPoints1[0][0]-=B;mxEdgeStyle.wayPoints1[0][1]+=F[0][1]*D[0][3];break;case mxConstants.DIRECTION_MASK_SOUTH:mxEdgeStyle.wayPoints1[0][0]+=F[0][0]*D[0][2];mxEdgeStyle.wayPoints1[0][1]+=D[0][3]+B;break;case mxConstants.DIRECTION_MASK_EAST:mxEdgeStyle.wayPoints1[0][0]+=D[0][2]+B;mxEdgeStyle.wayPoints1[0][1]+=F[0][1]*D[0][3];break;case mxConstants.DIRECTION_MASK_NORTH:mxEdgeStyle.wayPoints1[0][0]+=F[0][0]*D[0][2],mxEdgeStyle.wayPoints1[0][1]-=B}B=0;z=E=0<(G[0]&(mxConstants.DIRECTION_MASK_EAST|mxConstants.DIRECTION_MASK_WEST))?0:1;for(x=y=0;x<i.length;x++){y=i[x]&15;I=y==mxConstants.DIRECTION_MASK_EAST?3:y;I+=A;4<I&&(I-=4);w=mxEdgeStyle.dirVectors[I-1];y=0<I%2?0:1;y!=E&&(B++,mxEdgeStyle.wayPoints1[B][0]=mxEdgeStyle.wayPoints1[B-1][0],mxEdgeStyle.wayPoints1[B][1]=mxEdgeStyle.wayPoints1[B-1][1]);var H=0<(i[x]&mxEdgeStyle.TARGET_MASK),o=0<(i[x]&mxEdgeStyle.SOURCE_MASK),v=(i[x]&mxEdgeStyle.SIDE_MASK)>>5,v=v<<A;15<v&&(v>>=4);u=0<(i[x]&mxEdgeStyle.CENTER_MASK);(o||H)&&9>v?(I=0,o=o?0:1,I=u&&0==y?D[o][0]+F[o][0]*D[o][2]:u?D[o][1]+F[o][1]*D[o][3]:mxEdgeStyle.limits[o][v],0==y?(v=(I-mxEdgeStyle.wayPoints1[B][0])*w[0],0<v&&(mxEdgeStyle.wayPoints1[B][0]+=w[0]*v)):(v=(I-mxEdgeStyle.wayPoints1[B][1])*w[1],0<v&&(mxEdgeStyle.wayPoints1[B][1]+=w[1]*v))):u&&(mxEdgeStyle.wayPoints1[B][0]+=w[0]*Math.abs(mxEdgeStyle.vertexSeperations[I]/2),mxEdgeStyle.wayPoints1[B][1]+=w[1]*Math.abs(mxEdgeStyle.vertexSeperations[I]/2));0<B&&mxEdgeStyle.wayPoints1[B][y]==mxEdgeStyle.wayPoints1[B-1][y]?B--:E=y}for(x=0;x<=B&&!(x==B&&((0<(G[1]&(mxConstants.DIRECTION_MASK_EAST|mxConstants.DIRECTION_MASK_WEST))?0:1)==z?0:1)!=(B+1)%2);x++){C.push(new mxPoint(mxEdgeStyle.wayPoints1[x][0],mxEdgeStyle.wayPoints1[x][1]))}}},getRoutePattern:function(g,f,k,i){var h=g[0]==mxConstants.DIRECTION_MASK_EAST?3:g[0];g=g[1]==mxConstants.DIRECTION_MASK_EAST?3:g[1];h-=f;g-=f;1>h&&(h+=4);1>g&&(g+=4);f=routePatterns[h-1][g-1];if(0==k||0==i){null!=inlineRoutePatterns[h-1][g-1]&&(f=inlineRoutePatterns[h-1][g-1])}return f}},mxStyleRegistry={values:[],putValue:function(d,c){mxStyleRegistry.values[d]=c},getValue:function(b){return mxStyleRegistry.values[b]},getName:function(d){for(var c in mxStyleRegistry.values){if(mxStyleRegistry.values[c]==d){return c}}return null}};mxStyleRegistry.putValue(mxConstants.EDGESTYLE_ELBOW,mxEdgeStyle.ElbowConnector);mxStyleRegistry.putValue(mxConstants.EDGESTYLE_ENTITY_RELATION,mxEdgeStyle.EntityRelation);mxStyleRegistry.putValue(mxConstants.EDGESTYLE_LOOP,mxEdgeStyle.Loop);mxStyleRegistry.putValue(mxConstants.EDGESTYLE_SIDETOSIDE,mxEdgeStyle.SideToSide);mxStyleRegistry.putValue(mxConstants.EDGESTYLE_TOPTOBOTTOM,mxEdgeStyle.TopToBottom);mxStyleRegistry.putValue(mxConstants.EDGESTYLE_ORTHOGONAL,mxEdgeStyle.OrthConnector);mxStyleRegistry.putValue(mxConstants.EDGESTYLE_SEGMENT,mxEdgeStyle.SegmentConnector);mxStyleRegistry.putValue(mxConstants.PERIMETER_ELLIPSE,mxPerimeter.EllipsePerimeter);mxStyleRegistry.putValue(mxConstants.PERIMETER_RECTANGLE,mxPerimeter.RectanglePerimeter);mxStyleRegistry.putValue(mxConstants.PERIMETER_RHOMBUS,mxPerimeter.RhombusPerimeter);mxStyleRegistry.putValue(mxConstants.PERIMETER_TRIANGLE,mxPerimeter.TrianglePerimeter);function mxGraphView(b){this.graph=b;this.translate=new mxPoint;this.graphBounds=new mxRectangle;this.states=new mxDictionary}mxGraphView.prototype=new mxEventSource;mxGraphView.prototype.constructor=mxGraphView;mxGraphView.prototype.EMPTY_POINT=new mxPoint;mxGraphView.prototype.doneResource="none"!=mxClient.language?"done":"";mxGraphView.prototype.updatingDocumentResource="none"!=mxClient.language?"updatingDocument":"";mxGraphView.prototype.allowEval=!1;mxGraphView.prototype.captureDocumentGesture=!0;mxGraphView.prototype.optimizeVmlReflows=!0;mxGraphView.prototype.rendering=!0;mxGraphView.prototype.graph=null;mxGraphView.prototype.currentRoot=null;mxGraphView.prototype.graphBounds=null;mxGraphView.prototype.scale=1;mxGraphView.prototype.translate=null;mxGraphView.prototype.updateStyle=!1;mxGraphView.prototype.lastNode=null;mxGraphView.prototype.lastHtmlNode=null;mxGraphView.prototype.lastEdgeNode=null;mxGraphView.prototype.lastHtmlEdgeNode=null;mxGraphView.prototype.getGraphBounds=function(){return this.graphBounds};mxGraphView.prototype.setGraphBounds=function(b){this.graphBounds=b};mxGraphView.prototype.getBounds=function(g){var f=null;if(null!=g&&0<g.length){for(var k=this.graph.getModel(),i=0;i<g.length;i++){if(k.isVertex(g[i])||k.isEdge(g[i])){var h=this.getState(g[i]);null!=h&&(null==f?f=new mxRectangle(h.x,h.y,h.width,h.height):f.add(h))}}}return f};mxGraphView.prototype.setCurrentRoot=function(e){if(this.currentRoot!=e){var d=new mxCurrentRootChange(this,e);d.execute();var f=new mxUndoableEdit(this,!1);f.add(d);this.fireEvent(new mxEventObject(mxEvent.UNDO,"edit",f));this.graph.sizeDidChange()}return e};mxGraphView.prototype.scaleAndTranslate=function(g,f,k){var i=this.scale,h=new mxPoint(this.translate.x,this.translate.y);if(this.scale!=g||this.translate.x!=f||this.translate.y!=k){this.scale=g,this.translate.x=f,this.translate.y=k,this.isEventsEnabled()&&(this.revalidate(),this.graph.sizeDidChange())}this.fireEvent(new mxEventObject(mxEvent.SCALE_AND_TRANSLATE,"scale",g,"previousScale",i,"translate",this.translate,"previousTranslate",h))};mxGraphView.prototype.getScale=function(){return this.scale};mxGraphView.prototype.setScale=function(d){var c=this.scale;this.scale!=d&&(this.scale=d,this.isEventsEnabled()&&(this.revalidate(),this.graph.sizeDidChange()));this.fireEvent(new mxEventObject(mxEvent.SCALE,"scale",d,"previousScale",c))};mxGraphView.prototype.getTranslate=function(){return this.translate};mxGraphView.prototype.setTranslate=function(e,d){var f=new mxPoint(this.translate.x,this.translate.y);if(this.translate.x!=e||this.translate.y!=d){this.translate.x=e,this.translate.y=d,this.isEventsEnabled()&&(this.revalidate(),this.graph.sizeDidChange())}this.fireEvent(new mxEventObject(mxEvent.TRANSLATE,"translate",this.translate,"previousTranslate",f))};mxGraphView.prototype.refresh=function(){null!=this.currentRoot&&this.clear();this.revalidate()};mxGraphView.prototype.revalidate=function(){this.invalidate();this.validate()};mxGraphView.prototype.clear=function(g,f,k){var i=this.graph.getModel();g=g||i.getRoot();f=null!=f?f:!1;k=null!=k?k:!0;this.removeState(g);if(k&&(f||g!=this.currentRoot)){k=i.getChildCount(g);for(var h=0;h<k;h++){this.clear(i.getChildAt(g,h),f)}}else{this.invalidate(g)}};mxGraphView.prototype.invalidate=function(i,h,o){var n=this.graph.getModel();i=i||n.getRoot();h=null!=h?h:!0;o=null!=o?o:!0;var m=this.getState(i);null!=m&&(m.invalid=!0);if(!i.invalidating){i.invalidating=!0;if(h){for(var l=n.getChildCount(i),m=0;m<l;m++){var k=n.getChildAt(i,m);this.invalidate(k,h,o)}}if(o){l=n.getEdgeCount(i);for(m=0;m<l;m++){this.invalidate(n.getEdgeAt(i,m),h,o)}}delete i.invalidating}};mxGraphView.prototype.resetValidationState=function(){this.lastHtmlEdgeNode=this.lastEdgeNode=this.lastHtmlNode=this.lastNode=null};mxGraphView.prototype.validate=function(e){var d=mxLog.enter("mxGraphView.validate");window.status=mxResources.get(this.updatingDocumentResource)||this.updatingDocumentResource;this.resetValidationState();var f=null;if(this.optimizeVmlReflows&&null!=this.canvas&&null==this.textDiv&&(8==document.documentMode||mxClient.IS_QUIRKS)){this.placeholder=document.createElement("div"),this.placeholder.style.position="absolute",this.placeholder.style.width=this.canvas.clientWidth+"px",this.placeholder.style.height=this.canvas.clientHeight+"px",this.canvas.parentNode.appendChild(this.placeholder),f=this.drawPane.style.display,this.canvas.style.display="none",this.textDiv=document.createElement("div"),this.textDiv.style.position="absolute",this.textDiv.style.whiteSpace="nowrap",this.textDiv.style.visibility="hidden",this.textDiv.style.display=mxClient.IS_QUIRKS?"inline":"inline-block",this.textDiv.style.zoom="1",document.body.appendChild(this.textDiv)}e=e||(null!=this.currentRoot?this.currentRoot:this.graph.getModel().getRoot());this.validateBounds(null,e);e=this.validatePoints(null,e);null==e&&(e=new mxRectangle);this.setGraphBounds(e);this.validateBackground();null!=f&&(this.canvas.style.display=f,this.placeholder.parentNode.removeChild(this.placeholder),this.textDiv.parentNode.removeChild(this.textDiv),this.textDiv=null);this.resetValidationState();window.status=mxResources.get(this.doneResource)||this.doneResource;mxLog.leave("mxGraphView.validate",d)};mxGraphView.prototype.createBackgroundPageShape=function(b){return new mxRectangleShape(b,"white","black")};mxGraphView.prototype.validateBackground=function(){this.validateBackgroundImage();this.validateBackgroundPage()};mxGraphView.prototype.validateBackgroundImage=function(){var d=this.graph.getBackgroundImage();if(null!=d){if(null==this.backgroundImage||this.backgroundImage.image!=d.src){null!=this.backgroundImage&&this.backgroundImage.destroy();var c=new mxRectangle(0,0,1,1);this.backgroundImage=new mxImageShape(c,d.src);this.backgroundImage.dialect=this.graph.dialect;this.backgroundImage.init(this.backgroundPane);this.backgroundImage.redraw();8==document.documentMode&&mxEvent.addGestureListeners(this.backgroundImage.node,mxUtils.bind(this,function(b){this.graph.fireMouseEvent(mxEvent.MOUSE_DOWN,new mxMouseEvent(b))}),mxUtils.bind(this,function(b){this.graph.fireMouseEvent(mxEvent.MOUSE_MOVE,new mxMouseEvent(b))}),mxUtils.bind(this,function(b){this.graph.fireMouseEvent(mxEvent.MOUSE_UP,new mxMouseEvent(b))}))}this.redrawBackgroundImage(this.backgroundImage,d)}else{null!=this.backgroundImage&&(this.backgroundImage.destroy(),this.backgroundImage=null)}};mxGraphView.prototype.validateBackgroundPage=function(){if(this.graph.pageVisible){var b=this.getBackgroundPageBounds();null==this.backgroundPageShape?(this.backgroundPageShape=this.createBackgroundPageShape(b),this.backgroundPageShape.scale=this.scale,this.backgroundPageShape.isShadow=!0,this.backgroundPageShape.dialect=this.graph.dialect,this.backgroundPageShape.init(this.backgroundPane),this.backgroundPageShape.redraw(),graph.nativeDblClickEnabled&&mxEvent.addListener(this.backgroundPageShape.node,"dblclick",mxUtils.bind(this,function(c){this.graph.dblClick(c)})),mxEvent.addGestureListeners(this.backgroundPageShape.node,mxUtils.bind(this,function(c){this.graph.fireMouseEvent(mxEvent.MOUSE_DOWN,new mxMouseEvent(c))}),mxUtils.bind(this,function(c){null!=this.graph.tooltipHandler&&this.graph.tooltipHandler.isHideOnHover()&&this.graph.tooltipHandler.hide();this.graph.isMouseDown&&!mxEvent.isConsumed(c)&&this.graph.fireMouseEvent(mxEvent.MOUSE_MOVE,new mxMouseEvent(c))}),mxUtils.bind(this,function(c){this.graph.fireMouseEvent(mxEvent.MOUSE_UP,new mxMouseEvent(c))}))):(this.backgroundPageShape.scale=this.scale,this.backgroundPageShape.bounds=b,this.backgroundPageShape.redraw())}else{null!=this.backgroundPageShape&&(this.backgroundPageShape.destroy(),this.backgroundPageShape=null)}};mxGraphView.prototype.getBackgroundPageBounds=function(){var d=this.graph.pageFormat,c=this.scale*this.graph.pageScale;return new mxRectangle(this.scale*this.translate.x,this.scale*this.translate.y,d.width*c,d.height*c)};mxGraphView.prototype.redrawBackgroundImage=function(d,c){d.scale=this.scale;d.bounds.x=this.scale*this.translate.x;d.bounds.y=this.scale*this.translate.y;d.bounds.width=this.scale*c.width;d.bounds.height=this.scale*c.height;d.redraw()};mxGraphView.prototype.validateBounds=function(k,i){var q=this.graph.getModel(),p=this.getState(i,!0);if(null!=p){if(this.graph.isCellVisible(i)){if(p.invalid&&i!=this.currentRoot&&null!=k){p.absoluteOffset.x=0;p.absoluteOffset.y=0;p.origin.x=k.origin.x;p.origin.y=k.origin.y;var o=this.graph.getCellGeometry(i);if(null!=o){if(!q.isEdge(i)){var n=o.offset||this.EMPTY_POINT;o.relative?(p.origin.x+=o.x*k.width/this.scale+n.x,p.origin.y+=o.y*k.height/this.scale+n.y):(p.absoluteOffset.x=this.scale*n.x,p.absoluteOffset.y=this.scale*n.y,p.origin.x+=o.x,p.origin.y+=o.y)}p.x=this.scale*(this.translate.x+p.origin.x);p.y=this.scale*(this.translate.y+p.origin.y);p.width=this.scale*o.width;p.height=this.scale*o.height;if(q.isVertex(i)){if(o.relative&&(n=mxUtils.toRadians(k.style[mxConstants.STYLE_ROTATION]||"0"),0!=n)){var o=Math.cos(n),n=Math.sin(n),m=new mxPoint(p.getCenterX(),p.getCenterY()),l=new mxPoint(k.getCenterX(),k.getCenterY()),o=mxUtils.getRotatedPoint(m,o,n,l);p.x=o.x-p.width/2;p.y=o.y-p.height/2}this.updateVertexLabelOffset(p)}}}n=this.graph.getChildOffsetForCell(i);null!=n&&(p.origin.x+=n.x,p.origin.y+=n.y)}else{this.removeState(i)}if(!this.graph.isCellCollapsed(i)||i==this.currentRoot){o=q.getChildCount(i);for(n=0;n<o;n++){m=q.getChildAt(i,n),this.validateBounds(p,m)}}}};mxGraphView.prototype.updateVertexLabelOffset=function(d){var c=mxUtils.getValue(d.style,mxConstants.STYLE_LABEL_POSITION,mxConstants.ALIGN_CENTER);c==mxConstants.ALIGN_LEFT?d.absoluteOffset.x-=d.width:c==mxConstants.ALIGN_RIGHT&&(d.absoluteOffset.x+=d.width);c=mxUtils.getValue(d.style,mxConstants.STYLE_VERTICAL_LABEL_POSITION,mxConstants.ALIGN_MIDDLE);c==mxConstants.ALIGN_TOP?d.absoluteOffset.y-=d.height:c==mxConstants.ALIGN_BOTTOM&&(d.absoluteOffset.y+=d.height)};mxGraphView.prototype.validatePoints=function(s,r){var q=this.graph.getModel(),p=this.getState(r),o=null;if(null!=p){if(p.invalid){var n=this.graph.getCellGeometry(r);if(null!=n&&q.isEdge(r)){var m=this.getState(this.getVisibleTerminal(r,!0));p.setVisibleTerminalState(m,!0);if(null!=m&&q.isEdge(m.cell)&&!q.isAncestor(m.cell,r)){var l=this.getState(q.getParent(m.cell));this.validatePoints(l,m.cell)}var i=this.getState(this.getVisibleTerminal(r,!1));p.setVisibleTerminalState(i,!1);null!=i&&(q.isEdge(i.cell)&&!q.isAncestor(i.cell,r))&&(l=this.getState(q.getParent(i.cell)),this.validatePoints(l,i.cell));this.updateFixedTerminalPoints(p,m,i);this.updatePoints(p,n.points,m,i);this.updateFloatingTerminalPoints(p,m,i);if(p.cell!=this.currentRoot&&(null==p.absolutePoints||2>p.absolutePoints.length||null==p.absolutePoints[0]||null==p.absolutePoints[p.absolutePoints.length-1])){this.clear(p.cell,!0);return}this.updateEdgeBounds(p);this.updateEdgeLabelOffset(p)}else{null!=n&&(n.relative&&null!=s&&q.isEdge(s.cell))&&(n=this.getPoint(s,n),null!=n&&(p.x=n.x,p.y=n.y,n.x=n.x/this.scale-this.translate.x,n.y=n.y/this.scale-this.translate.y,p.origin=n,this.childMoved(s,p)))}p.invalid=!1;r!=this.currentRoot&&this.graph.cellRenderer.redraw(p,!1,this.isRendering())}if(q.isEdge(r)||q.isVertex(r)){this.stateValidated(p),null!=p.shape&&null!=p.shape.boundingBox&&(o=p.shape.boundingBox.clone()),null!=p.text&&!this.graph.isLabelClipped(p.cell)&&null!=p.text.boundingBox&&(null!=o?o.add(p.text.boundingBox):o=p.text.boundingBox.clone())}}if(null!=p&&(!this.graph.isCellCollapsed(r)||r==this.currentRoot)){n=q.getChildCount(r);for(m=0;m<n;m++){l=q.getChildAt(r,m),l=this.validatePoints(p,l),null!=l&&(null==o?o=l:o.add(l))}}return o};mxGraphView.prototype.stateValidated=function(d){var c=this.graph.getModel().isEdge(d.cell)&&this.graph.keepEdgesInForeground;d=this.graph.cellRenderer.insertStateAfter(d,c?this.lastEdgeNode||this.lastNode:this.lastNode,c?this.lastEdgeHtmlNode||this.lastHtmlNode:this.lastHtmlNode);c?(this.lastEdgeHtmlNode=d[1],this.lastEdgeNode=d[0]):(this.lastHtmlNode=d[1],this.lastNode=d[0])};mxGraphView.prototype.childMoved=function(h,g){var m=g.cell;if(!this.graph.isCellCollapsed(m)||m==this.currentRoot){for(var l=this.graph.getModel(),k=l.getChildCount(m),i=0;i<k;i++){this.validateBounds(g,l.getChildAt(m,i))}}};mxGraphView.prototype.updateFixedTerminalPoints=function(e,d,f){this.updateFixedTerminalPoint(e,d,!0,this.graph.getConnectionConstraint(e,d,!0));this.updateFixedTerminalPoint(e,f,!1,this.graph.getConnectionConstraint(e,f,!1))};mxGraphView.prototype.updateFixedTerminalPoint=function(h,g,m,l){var k=null;null!=l&&(k=this.graph.getConnectionPoint(g,l));if(null==k&&null==g){g=this.scale;l=this.translate;var i=h.origin,k=this.graph.getCellGeometry(h.cell).getTerminalPoint(m);null!=k&&(k=new mxPoint(g*(l.x+k.x+i.x),g*(l.y+k.y+i.y)))}h.setAbsoluteTerminalPoint(k,m)};mxGraphView.prototype.updatePoints=function(h,g,m,l){if(null!=h){var k=[];k.push(h.absolutePoints[0]);var i=this.getEdgeStyle(h,g,m,l);if(null!=i){m=this.getTerminalPort(h,m,!0),l=this.getTerminalPort(h,l,!1),i(h,m,l,g,k)}else{if(null!=g){for(i=0;i<g.length;i++){null!=g[i]&&(l=mxUtils.clone(g[i]),k.push(this.transformControlPoint(h,l)))}}}g=h.absolutePoints;k.push(g[g.length-1]);h.absolutePoints=k}};mxGraphView.prototype.transformControlPoint=function(e,d){var f=e.origin;return new mxPoint(this.scale*(d.x+this.translate.x+f.x),this.scale*(d.y+this.translate.y+f.y))};mxGraphView.prototype.getEdgeStyle=function(a,b,c,d){a=null!=c&&c==d?mxUtils.getValue(a.style,mxConstants.STYLE_LOOP,this.graph.defaultLoopStyle):!mxUtils.getValue(a.style,mxConstants.STYLE_NOEDGESTYLE,!1)?a.style[mxConstants.STYLE_EDGE]:null;"string"==typeof a&&(b=mxStyleRegistry.getValue(a),null==b&&this.isAllowEval()&&(b=mxUtils.eval(a)),a=b);return"function"==typeof a?a:null};mxGraphView.prototype.updateFloatingTerminalPoints=function(g,f,k){var i=g.absolutePoints,h=i[0];null==i[i.length-1]&&null!=k&&this.updateFloatingTerminalPoint(g,k,f,!1);null==h&&null!=f&&this.updateFloatingTerminalPoint(g,f,k,!0)};mxGraphView.prototype.updateFloatingTerminalPoint=function(s,r,q,p){r=this.getTerminalPort(s,r,p);var o=this.getNextPoint(s,q,p),n=this.graph.isOrthogonal(s);q=mxUtils.toRadians(Number(r.style[mxConstants.STYLE_ROTATION]||"0"));var m=new mxPoint(r.getCenterX(),r.getCenterY());if(0!=q){var l=Math.cos(-q),i=Math.sin(-q),o=mxUtils.getRotatedPoint(o,l,i,m)}l=parseFloat(s.style[mxConstants.STYLE_PERIMETER_SPACING]||0);l+=parseFloat(s.style[p?mxConstants.STYLE_SOURCE_PERIMETER_SPACING:mxConstants.STYLE_TARGET_PERIMETER_SPACING]||0);r=this.getPerimeterPoint(r,o,0==q&&n,l);0!=q&&(l=Math.cos(q),i=Math.sin(q),r=mxUtils.getRotatedPoint(r,l,i,m));s.setAbsoluteTerminalPoint(r,p)};mxGraphView.prototype.getTerminalPort=function(e,d,f){e=mxUtils.getValue(e.style,f?mxConstants.STYLE_SOURCE_PORT:mxConstants.STYLE_TARGET_PORT);null!=e&&(e=this.getState(this.graph.getModel().getCell(e)),null!=e&&(d=e));return d};mxGraphView.prototype.getPerimeterPoint=function(h,g,m,l){var k=null;if(null!=h){var i=this.getPerimeterFunction(h);if(null!=i&&null!=g&&(l=this.getPerimeterBounds(h,l),0<l.width||0<l.height)){k=i(l,h,g,m)}null==k&&(k=this.getPoint(h))}return k};mxGraphView.prototype.getRoutingCenterX=function(d){var c=null!=d.style?parseFloat(d.style[mxConstants.STYLE_ROUTING_CENTER_X])||0:0;return d.getCenterX()+c*d.width};mxGraphView.prototype.getRoutingCenterY=function(d){var c=null!=d.style?parseFloat(d.style[mxConstants.STYLE_ROUTING_CENTER_Y])||0:0;return d.getCenterY()+c*d.height};mxGraphView.prototype.getPerimeterBounds=function(d,c){c=null!=c?c:0;null!=d&&(c+=parseFloat(d.style[mxConstants.STYLE_PERIMETER_SPACING]||0));return d.getPerimeterBounds(c*this.scale)};mxGraphView.prototype.getPerimeterFunction=function(a){a=a.style[mxConstants.STYLE_PERIMETER];if("string"==typeof a){var b=mxStyleRegistry.getValue(a);null==b&&this.isAllowEval()&&(b=mxUtils.eval(a));a=b}return"function"==typeof a?a:null};mxGraphView.prototype.getNextPoint=function(f,e,h){f=f.absolutePoints;var g=null;if(null!=f&&(h||2<f.length||null==e)){g=f.length,g=f[h?Math.min(1,g-1):Math.max(0,g-2)]}null==g&&null!=e&&(g=new mxPoint(e.getCenterX(),e.getCenterY()));return g};mxGraphView.prototype.getVisibleTerminal=function(g,f){for(var k=this.graph.getModel(),i=k.getTerminal(g,f),h=i;null!=i&&i!=this.currentRoot;){if(!this.graph.isCellVisible(h)||this.graph.isCellCollapsed(i)){h=i}i=k.getParent(i)}k.getParent(h)==k.getRoot()&&(h=null);return h};mxGraphView.prototype.updateEdgeBounds=function(y){var x=y.absolutePoints;y.length=0;if(null!=x&&0<x.length){var w=x[0],v=x[x.length-1];if(w.x!=v.x||w.y!=v.y){var u=v.x-w.x,t=v.y-w.y;y.terminalDistance=Math.sqrt(u*u+t*t)}else{y.terminalDistance=0}var v=0,s=[],t=w;if(null!=t){for(var w=t.x,r=t.y,q=w,p=r,o=1;o<x.length;o++){var i=x[o];null!=i&&(u=t.x-i.x,t=t.y-i.y,u=Math.sqrt(u*u+t*t),s.push(u),v+=u,t=i,w=Math.min(t.x,w),r=Math.min(t.y,r),q=Math.max(t.x,q),p=Math.max(t.y,p))}y.length=v;y.segments=s;y.x=w;y.y=r;y.width=Math.max(1,q-w);y.height=Math.max(1,p-r)}}};mxGraphView.prototype.getPoint=function(u,t){var s=u.getCenterX(),r=u.getCenterY();if(null!=u.segments&&(null==t||t.relative)){for(var q=u.absolutePoints.length,p=((null!=t?t.x/2:0)+0.5)*u.length,o=u.segments[0],n=0,m=1;p>n+o&&m<q-1;){n+=o,o=u.segments[m++]}q=0==o?0:(p-n)/o;p=u.absolutePoints[m-1];m=u.absolutePoints[m];if(null!=p&&null!=m){n=s=r=0;if(null!=t){var r=t.y,i=t.offset;null!=i&&(s=i.x,n=i.y)}i=m.x-p.x;m=m.y-p.y;s=p.x+i*q+((0==o?0:m/o)*r+s)*this.scale;r=p.y+m*q-((0==o?0:i/o)*r-n)*this.scale}}else{null!=t&&(i=t.offset,null!=i&&(s+=i.x,r+=i.y))}return new mxPoint(s,r)};mxGraphView.prototype.getRelativePoint=function(A,z,y){var x=this.graph.getModel().getGeometry(A.cell);if(null!=x){var w=A.absolutePoints.length;if(x.relative&&1<w){for(var x=A.length,v=A.segments,u=A.absolutePoints[0],t=A.absolutePoints[1],s=mxUtils.ptSegDistSq(u.x,u.y,t.x,t.y,z,y),r=0,q=0,o=0,i=2;i<w;i++){q+=v[i-2],t=A.absolutePoints[i],u=mxUtils.ptSegDistSq(u.x,u.y,t.x,t.y,z,y),u<=s&&(s=u,r=i-1,o=q),u=t}w=v[r];u=A.absolutePoints[r];t=A.absolutePoints[r+1];s=t.x;v=t.y;A=u.x-s;r=u.y-v;s=z-s;v=y-v;s=A-s;v=r-v;v=s*A+v*r;A=Math.sqrt(0>=v?0:v*v/(A*A+r*r));A>w&&(A=w);w=Math.sqrt(mxUtils.ptSegDistSq(u.x,u.y,t.x,t.y,z,y));-1==mxUtils.relativeCcw(u.x,u.y,t.x,t.y,z,y)&&(w=-w);return new mxPoint(-2*((x/2-o-A)/x),w/this.scale)}}return new mxPoint};mxGraphView.prototype.updateEdgeLabelOffset=function(i){var h=i.absolutePoints;i.absoluteOffset.x=i.getCenterX();i.absoluteOffset.y=i.getCenterY();if(null!=h&&0<h.length&&null!=i.segments){var o=this.graph.getCellGeometry(i.cell);if(o.relative){var n=this.getPoint(i,o);null!=n&&(i.absoluteOffset=n)}else{var n=h[0],m=h[h.length-1];if(null!=n&&null!=m){var h=m.x-n.x,l=m.y-n.y,k=m=0,o=o.offset;null!=o&&(m=o.x,k=o.y);o=n.y+l/2+k*this.scale;i.absoluteOffset.x=n.x+h/2+m*this.scale;i.absoluteOffset.y=o}}}};mxGraphView.prototype.getState=function(e,d){d=d||!1;var f=null;if(null!=e&&(f=this.states.get(e),d&&(null==f||this.updateStyle)&&this.graph.isCellVisible(e))){null==f?(f=this.createState(e),this.states.put(e,f)):f.style=this.graph.getCellStyle(e)}return f};mxGraphView.prototype.isRendering=function(){return this.rendering};mxGraphView.prototype.setRendering=function(b){this.rendering=b};mxGraphView.prototype.isAllowEval=function(){return this.allowEval};mxGraphView.prototype.setAllowEval=function(b){this.allowEval=b};mxGraphView.prototype.getStates=function(){return this.states};mxGraphView.prototype.setStates=function(b){this.states=b};mxGraphView.prototype.getCellStates=function(f){if(null==f){return this.states}for(var e=[],h=0;h<f.length;h++){var g=this.getState(f[h]);null!=g&&e.push(g)}return e};mxGraphView.prototype.removeState=function(d){var c=null;null!=d&&(c=this.states.remove(d),null!=c&&(this.graph.cellRenderer.destroy(c),c.destroy()));return c};mxGraphView.prototype.createState=function(b){return new mxCellState(this,b,this.graph.getCellStyle(b))};mxGraphView.prototype.getCanvas=function(){return this.canvas};mxGraphView.prototype.getBackgroundPane=function(){return this.backgroundPane};mxGraphView.prototype.getDrawPane=function(){return this.drawPane};mxGraphView.prototype.getOverlayPane=function(){return this.overlayPane};mxGraphView.prototype.isContainerEvent=function(b){b=mxEvent.getSource(b);return b==this.graph.container||b.parentNode==this.backgroundPane||null!=b.parentNode&&b.parentNode.parentNode==this.backgroundPane||b==this.canvas.parentNode||b==this.canvas||b==this.backgroundPane||b==this.drawPane||b==this.overlayPane};mxGraphView.prototype.isScrollEvent=function(e){var d=mxUtils.getOffset(this.graph.container);e=new mxPoint(e.clientX-d.x,e.clientY-d.y);var d=this.graph.container.offsetWidth,f=this.graph.container.clientWidth;if(d>f&&e.x>f+2&&e.x<=d){return !0}d=this.graph.container.offsetHeight;f=this.graph.container.clientHeight;return d>f&&e.y>f+2&&e.y<=d?!0:!1};mxGraphView.prototype.init=function(){this.installListeners();var b=this.graph;b.dialect==mxConstants.DIALECT_SVG?this.createSvg():b.dialect==mxConstants.DIALECT_VML?this.createVml():this.createHtml()};mxGraphView.prototype.installListeners=function(){var e=this.graph,d=e.container;if(null!=d){mxEvent.addGestureListeners(d,mxUtils.bind(this,function(a){this.isContainerEvent(a)&&(!mxClient.IS_IE&&!mxClient.IS_GC&&!mxClient.IS_OP&&!mxClient.IS_SF||!this.isScrollEvent(a))&&e.fireMouseEvent(mxEvent.MOUSE_DOWN,new mxMouseEvent(a))}),mxUtils.bind(this,function(a){this.isContainerEvent(a)&&e.fireMouseEvent(mxEvent.MOUSE_MOVE,new mxMouseEvent(a))}),mxUtils.bind(this,function(a){this.isContainerEvent(a)&&e.fireMouseEvent(mxEvent.MOUSE_UP,new mxMouseEvent(a))}));mxEvent.addListener(d,"dblclick",mxUtils.bind(this,function(a){this.isContainerEvent(a)&&e.dblClick(a)}));var f=function(b){var a=null;mxClient.IS_TOUCH&&(a=mxEvent.getClientX(b),b=mxEvent.getClientY(b),b=mxUtils.convertPoint(d,a,b),a=e.view.getState(e.getCellAt(b.x,b.y)));return a};e.addMouseListener({mouseDown:function(a,g){e.popupMenuHandler.hideMenu()},mouseMove:function(){},mouseUp:function(){}});this.moveHandler=mxUtils.bind(this,function(a){null!=e.tooltipHandler&&e.tooltipHandler.isHideOnHover()&&e.tooltipHandler.hide();this.captureDocumentGesture&&(e.isMouseDown&&!mxEvent.isConsumed(a))&&e.fireMouseEvent(mxEvent.MOUSE_MOVE,new mxMouseEvent(a,f(a)))});this.endHandler=mxUtils.bind(this,function(a){this.captureDocumentGesture&&e.fireMouseEvent(mxEvent.MOUSE_UP,new mxMouseEvent(a))});mxEvent.addGestureListeners(document,null,this.moveHandler,this.endHandler)}};mxGraphView.prototype.createHtml=function(){var b=this.graph.container;null!=b&&(this.canvas=this.createHtmlPane("100%","100%"),this.backgroundPane=this.createHtmlPane("1px","1px"),this.drawPane=this.createHtmlPane("1px","1px"),this.overlayPane=this.createHtmlPane("1px","1px"),this.canvas.appendChild(this.backgroundPane),this.canvas.appendChild(this.drawPane),this.canvas.appendChild(this.overlayPane),b.appendChild(this.canvas),mxClient.IS_QUIRKS&&(b=mxUtils.bind(this,function(c){c=this.getGraphBounds();this.updateHtmlCanvasSize(c.x+c.width+this.graph.border,c.y+c.height+this.graph.border)}),mxEvent.addListener(window,"resize",b)))};mxGraphView.prototype.updateHtmlCanvasSize=function(e,d){if(null!=this.graph.container){var f=this.graph.container.offsetHeight;this.canvas.style.width=this.graph.container.offsetWidth<e?e+"px":"100%";this.canvas.style.height=f<d?d+"px":"100%"}};mxGraphView.prototype.createHtmlPane=function(e,d){var f=document.createElement("DIV");null!=e&&null!=d?(f.style.position="absolute",f.style.left="0px",f.style.top="0px",f.style.width=e,f.style.height=d):f.style.position="relative";return f};mxGraphView.prototype.createVml=function(){var e=this.graph.container;if(null!=e){var d=e.offsetWidth,f=e.offsetHeight;this.canvas=this.createVmlPane(d,f);this.backgroundPane=this.createVmlPane(d,f);this.drawPane=this.createVmlPane(d,f);this.overlayPane=this.createVmlPane(d,f);this.canvas.appendChild(this.backgroundPane);this.canvas.appendChild(this.drawPane);this.canvas.appendChild(this.overlayPane);e.appendChild(this.canvas)}};mxGraphView.prototype.createVmlPane=function(e,d){var f=document.createElement(mxClient.VML_PREFIX+":group");f.style.position="absolute";f.style.left="0px";f.style.top="0px";f.style.width=e+"px";f.style.height=d+"px";f.setAttribute("coordsize",e+","+d);f.setAttribute("coordorigin","0,0");return f};mxGraphView.prototype.createSvg=function(){var d=this.graph.container;this.canvas=document.createElementNS(mxConstants.NS_SVG,"g");this.backgroundPane=document.createElementNS(mxConstants.NS_SVG,"g");this.canvas.appendChild(this.backgroundPane);this.drawPane=document.createElementNS(mxConstants.NS_SVG,"g");this.canvas.appendChild(this.drawPane);this.overlayPane=document.createElementNS(mxConstants.NS_SVG,"g");this.canvas.appendChild(this.overlayPane);var c=document.createElementNS(mxConstants.NS_SVG,"svg");c.style.width="100%";c.style.height="100%";c.style.display="block";c.appendChild(this.canvas);null!=d&&(d.appendChild(c),this.updateContainerStyle(d))};mxGraphView.prototype.updateContainerStyle=function(b){"static"==mxUtils.getCurrentStyle(b).position&&(b.style.position="relative");mxClient.IS_POINTER&&(b.style.msTouchAction="none")};mxGraphView.prototype.destroy=function(){var b=null!=this.canvas?this.canvas.ownerSVGElement:null;null==b&&(b=this.canvas);null!=b&&null!=b.parentNode&&(this.clear(this.currentRoot,!0),mxEvent.removeGestureListeners(document,null,this.moveHandler,this.endHandler),mxEvent.release(this.graph.container),b.parentNode.removeChild(b),this.overlayPane=this.drawPane=this.backgroundPane=this.canvas=this.endHandler=this.moveHandler=null)};function mxCurrentRootChange(f,e){this.view=f;this.previous=this.root=e;this.isUp=null==e;if(!this.isUp){for(var h=this.view.currentRoot,g=this.view.graph.getModel();null!=h;){if(h==e){this.isUp=!0;break}h=g.getParent(h)}}}mxCurrentRootChange.prototype.execute=function(){var b=this.view.currentRoot;this.view.currentRoot=this.previous;this.previous=b;b=this.view.graph.getTranslateForRoot(this.view.currentRoot);null!=b&&(this.view.translate=new mxPoint(-b.x,-b.y));this.view.fireEvent(new mxEventObject(this.isUp?mxEvent.UP:mxEvent.DOWN,"root",this.view.currentRoot,"previous",this.previous));this.isUp?(this.view.clear(this.view.currentRoot,!0),this.view.validate()):this.view.refresh();this.isUp=!this.isUp};function mxGraph(f,e,h,g){this.mouseListeners=null;this.renderHint=h;this.dialect=mxClient.IS_SVG?mxConstants.DIALECT_SVG:h==mxConstants.RENDERING_HINT_EXACT&&mxClient.IS_VML?mxConstants.DIALECT_VML:h==mxConstants.RENDERING_HINT_FASTEST?mxConstants.DIALECT_STRICTHTML:h==mxConstants.RENDERING_HINT_FASTER?mxConstants.DIALECT_PREFERHTML:mxConstants.DIALECT_MIXEDHTML;this.model=null!=e?e:new mxGraphModel;this.multiplicities=[];this.imageBundles=[];this.cellRenderer=this.createCellRenderer();this.setSelectionModel(this.createSelectionModel());this.setStylesheet(null!=g?g:this.createStylesheet());this.view=this.createGraphView();this.graphModelChangeListener=mxUtils.bind(this,function(d,c){this.graphModelChanged(c.getProperty("edit").changes)});this.model.addListener(mxEvent.CHANGE,this.graphModelChangeListener);this.createHandlers();null!=f&&this.init(f);this.view.revalidate()}mxLoadResources&&mxResources.add(mxClient.basePath+"/resources/graph");mxGraph.prototype=new mxEventSource;mxGraph.prototype.constructor=mxGraph;mxGraph.prototype.EMPTY_ARRAY=[];mxGraph.prototype.mouseListeners=null;mxGraph.prototype.isMouseDown=!1;mxGraph.prototype.model=null;mxGraph.prototype.view=null;mxGraph.prototype.stylesheet=null;mxGraph.prototype.selectionModel=null;mxGraph.prototype.cellEditor=null;mxGraph.prototype.cellRenderer=null;mxGraph.prototype.multiplicities=null;mxGraph.prototype.renderHint=null;mxGraph.prototype.dialect=null;mxGraph.prototype.gridSize=10;mxGraph.prototype.gridEnabled=!0;mxGraph.prototype.portsEnabled=!0;mxGraph.prototype.nativeDblClickEnabled=!mxClient.IS_QUIRKS&&(null==document.documentMode||10>document.documentMode);mxGraph.prototype.doubleTapEnabled=!0;mxGraph.prototype.doubleTapTimeout=500;mxGraph.prototype.doubleTapTolerance=25;mxGraph.prototype.lastTouchY=0;mxGraph.prototype.lastTouchY=0;mxGraph.prototype.lastTouchTime=0;mxGraph.prototype.tapAndHoldEnabled=!0;mxGraph.prototype.tapAndHoldDelay=500;mxGraph.prototype.tapAndHoldInProgress=!1;mxGraph.prototype.tapAndHoldValid=!1;mxGraph.prototype.initialTouchX=0;mxGraph.prototype.initialTouchY=0;mxGraph.prototype.tolerance=4;mxGraph.prototype.defaultOverlap=0.5;mxGraph.prototype.defaultParent=null;mxGraph.prototype.alternateEdgeStyle=null;mxGraph.prototype.backgroundImage=null;mxGraph.prototype.pageVisible=!1;mxGraph.prototype.pageBreaksVisible=!1;mxGraph.prototype.pageBreakColor="gray";mxGraph.prototype.pageBreakDashed=!0;mxGraph.prototype.minPageBreakDist=20;mxGraph.prototype.preferPageSize=!1;mxGraph.prototype.pageFormat=mxConstants.PAGE_FORMAT_A4_PORTRAIT;mxGraph.prototype.pageScale=1.5;mxGraph.prototype.enabled=!0;mxGraph.prototype.escapeEnabled=!0;mxGraph.prototype.invokesStopCellEditing=!0;mxGraph.prototype.enterStopsCellEditing=!1;mxGraph.prototype.useScrollbarsForPanning=!0;mxGraph.prototype.exportEnabled=!0;mxGraph.prototype.importEnabled=!0;mxGraph.prototype.cellsLocked=!1;mxGraph.prototype.cellsCloneable=!0;mxGraph.prototype.foldingEnabled=!0;mxGraph.prototype.cellsEditable=!0;mxGraph.prototype.cellsDeletable=!0;mxGraph.prototype.cellsMovable=!0;mxGraph.prototype.edgeLabelsMovable=!0;mxGraph.prototype.vertexLabelsMovable=!1;mxGraph.prototype.dropEnabled=!1;mxGraph.prototype.splitEnabled=!0;mxGraph.prototype.cellsResizable=!0;mxGraph.prototype.cellsBendable=!0;mxGraph.prototype.cellsSelectable=!0;mxGraph.prototype.cellsDisconnectable=!0;mxGraph.prototype.autoSizeCells=!1;mxGraph.prototype.autoSizeCellsOnAdd=!1;mxGraph.prototype.autoScroll=!0;mxGraph.prototype.timerAutoScroll=!1;mxGraph.prototype.allowAutoPanning=!1;mxGraph.prototype.ignoreScrollbars=!1;mxGraph.prototype.autoExtend=!0;mxGraph.prototype.maximumGraphBounds=null;mxGraph.prototype.minimumGraphSize=null;mxGraph.prototype.minimumContainerSize=null;mxGraph.prototype.maximumContainerSize=null;mxGraph.prototype.resizeContainer=!1;mxGraph.prototype.border=0;mxGraph.prototype.keepEdgesInForeground=!1;mxGraph.prototype.allowNegativeCoordinates=!0;mxGraph.prototype.constrainChildren=!0;mxGraph.prototype.constrainChildrenOnResize=!1;mxGraph.prototype.extendParents=!0;mxGraph.prototype.extendParentsOnAdd=!0;mxGraph.prototype.extendParentsOnMove=!1;mxGraph.prototype.recursiveResize=!1;mxGraph.prototype.collapseToPreferredSize=!0;mxGraph.prototype.zoomFactor=1.2;mxGraph.prototype.keepSelectionVisibleOnZoom=!1;mxGraph.prototype.centerZoom=!0;mxGraph.prototype.resetViewOnRootChange=!0;mxGraph.prototype.resetEdgesOnResize=!1;mxGraph.prototype.resetEdgesOnMove=!1;mxGraph.prototype.resetEdgesOnConnect=!0;mxGraph.prototype.allowLoops=!1;mxGraph.prototype.defaultLoopStyle=mxEdgeStyle.Loop;mxGraph.prototype.multigraph=!0;mxGraph.prototype.connectableEdges=!1;mxGraph.prototype.allowDanglingEdges=!0;mxGraph.prototype.cloneInvalidEdges=!1;mxGraph.prototype.disconnectOnMove=!0;mxGraph.prototype.labelsVisible=!0;mxGraph.prototype.htmlLabels=!1;mxGraph.prototype.swimlaneSelectionEnabled=!0;mxGraph.prototype.swimlaneNesting=!0;mxGraph.prototype.swimlaneIndicatorColorAttribute=mxConstants.STYLE_FILLCOLOR;mxGraph.prototype.imageBundles=null;mxGraph.prototype.minFitScale=0.1;mxGraph.prototype.maxFitScale=8;mxGraph.prototype.panDx=0;mxGraph.prototype.panDy=0;mxGraph.prototype.collapsedImage=new mxImage(mxClient.imageBasePath+"/collapsed.gif",9,9);mxGraph.prototype.expandedImage=new mxImage(mxClient.imageBasePath+"/expanded.gif",9,9);mxGraph.prototype.warningImage=new mxImage(mxClient.imageBasePath+"/warning"+(mxClient.IS_MAC?".png":".gif"),16,16);mxGraph.prototype.alreadyConnectedResource="none"!=mxClient.language?"alreadyConnected":"";mxGraph.prototype.containsValidationErrorsResource="none"!=mxClient.language?"containsValidationErrors":"";mxGraph.prototype.collapseExpandResource="none"!=mxClient.language?"collapse-expand":"";mxGraph.prototype.init=function(b){this.container=b;this.cellEditor=this.createCellEditor();this.view.init();this.sizeDidChange();mxEvent.addListener(b,"mouseleave",mxUtils.bind(this,function(){null!=this.tooltipHandler&&this.tooltipHandler.hide()}));mxClient.IS_IE&&(mxEvent.addListener(window,"unload",mxUtils.bind(this,function(){this.destroy()})),mxEvent.addListener(b,"selectstart",mxUtils.bind(this,function(){return this.isEditing()})));8==document.documentMode&&b.insertAdjacentHTML("beforeend",'<v:group style="DISPLAY: none;"></v:group>')};mxGraph.prototype.createHandlers=function(b){this.tooltipHandler=new mxTooltipHandler(this);this.tooltipHandler.setEnabled(!1);this.selectionCellsHandler=new mxSelectionCellsHandler(this);this.connectionHandler=new mxConnectionHandler(this);this.connectionHandler.setEnabled(!1);this.graphHandler=new mxGraphHandler(this);this.panningHandler=new mxPanningHandler(this);this.panningHandler.panningEnabled=!1;this.popupMenuHandler=new mxPopupMenuHandler(this)};mxGraph.prototype.createSelectionModel=function(){return new mxGraphSelectionModel(this)};mxGraph.prototype.createStylesheet=function(){return new mxStylesheet};mxGraph.prototype.createGraphView=function(){return new mxGraphView(this)};mxGraph.prototype.createCellRenderer=function(){return new mxCellRenderer};mxGraph.prototype.createCellEditor=function(){return new mxCellEditor(this)};mxGraph.prototype.getModel=function(){return this.model};mxGraph.prototype.getView=function(){return this.view};mxGraph.prototype.getStylesheet=function(){return this.stylesheet};mxGraph.prototype.setStylesheet=function(b){this.stylesheet=b};mxGraph.prototype.getSelectionModel=function(){return this.selectionModel};mxGraph.prototype.setSelectionModel=function(b){this.selectionModel=b};mxGraph.prototype.getSelectionCellsForChanges=function(g){for(var f=[],k=0;k<g.length;k++){var i=g[k];if(i.constructor!=mxRootChange){var h=null;i instanceof mxChildChange&&null==i.previous?h=i.child:null!=i.cell&&i.cell instanceof mxCell&&(h=i.cell);null!=h&&0>mxUtils.indexOf(f,h)&&f.push(h)}}return this.getModel().getTopmostCells(f)};mxGraph.prototype.graphModelChanged=function(d){for(var c=0;c<d.length;c++){this.processChange(d[c])}this.removeSelectionCells(this.getRemovedCellsForChanges(d));this.view.validate();this.sizeDidChange()};mxGraph.prototype.getRemovedCellsForChanges=function(f){for(var e=[],h=0;h<f.length;h++){var g=f[h];if(g instanceof mxRootChange){break}else{g instanceof mxChildChange?null!=g.previous&&null==g.parent&&(e=e.concat(this.model.getDescendants(g.child))):g instanceof mxVisibleChange&&(e=e.concat(this.model.getDescendants(g.cell)))}}return e};mxGraph.prototype.processChange=function(d){if(d instanceof mxRootChange){this.clearSelection(),this.removeStateForCell(d.previous),this.resetViewOnRootChange&&(this.view.scale=1,this.view.translate.x=0,this.view.translate.y=0),this.fireEvent(new mxEventObject(mxEvent.ROOT))}else{if(d instanceof mxChildChange){var c=this.model.getParent(d.child);null!=c?this.view.invalidate(d.child,!0,!1):(this.removeStateForCell(d.child),this.view.currentRoot==d.child&&this.home());c!=d.previous&&(null!=c&&this.view.invalidate(c,!1,!1),null!=d.previous&&this.view.invalidate(d.previous,!1,!1))}else{d instanceof mxTerminalChange||d instanceof mxGeometryChange?(d instanceof mxTerminalChange||null==d.previous&&null!=d.geometry||null!=d.previous&&!d.previous.equals(d.geometry))&&this.view.invalidate(d.cell):d instanceof mxValueChange?this.view.invalidate(d.cell,!1,!1):d instanceof mxStyleChange?(this.view.invalidate(d.cell,!0,!0),this.view.removeState(d.cell)):null!=d.cell&&d.cell instanceof mxCell&&this.removeStateForCell(d.cell)}}};mxGraph.prototype.removeStateForCell=function(e){for(var d=this.model.getChildCount(e),f=0;f<d;f++){this.removeStateForCell(this.model.getChildAt(e,f))}this.view.removeState(e)};mxGraph.prototype.addCellOverlay=function(e,d){null==e.overlays&&(e.overlays=[]);e.overlays.push(d);var f=this.view.getState(e);null!=f&&this.cellRenderer.redraw(f);this.fireEvent(new mxEventObject(mxEvent.ADD_OVERLAY,"cell",e,"overlay",d));return d};mxGraph.prototype.getCellOverlays=function(b){return b.overlays};mxGraph.prototype.removeCellOverlay=function(e,d){if(null==d){this.removeCellOverlays(e)}else{var f=mxUtils.indexOf(e.overlays,d);0<=f?(e.overlays.splice(f,1),0==e.overlays.length&&(e.overlays=null),f=this.view.getState(e),null!=f&&this.cellRenderer.redraw(f),this.fireEvent(new mxEventObject(mxEvent.REMOVE_OVERLAY,"cell",e,"overlay",d))):d=null}return d};mxGraph.prototype.removeCellOverlays=function(e){var d=e.overlays;if(null!=d){e.overlays=null;var f=this.view.getState(e);null!=f&&this.cellRenderer.redraw(f);for(f=0;f<d.length;f++){this.fireEvent(new mxEventObject(mxEvent.REMOVE_OVERLAY,"cell",e,"overlay",d[f]))}}return d};mxGraph.prototype.clearCellOverlays=function(f){f=null!=f?f:this.model.getRoot();this.removeCellOverlays(f);for(var e=this.model.getChildCount(f),h=0;h<e;h++){var g=this.model.getChildAt(f,h);this.clearCellOverlays(g)}};mxGraph.prototype.setCellWarning=function(f,e,h,g){if(null!=e&&0<e.length){return h=null!=h?h:this.warningImage,e=new mxCellOverlay(h,"<font color=red>"+e+"</font>"),g&&e.addListener(mxEvent.CLICK,mxUtils.bind(this,function(a,d){this.isEnabled()&&this.setSelectionCell(f)})),this.addCellOverlay(f,e)}this.removeCellOverlays(f);return null};mxGraph.prototype.startEditing=function(b){this.startEditingAtCell(null,b)};mxGraph.prototype.startEditingAtCell=function(d,c){null==d&&(d=this.getSelectionCell(),null!=d&&!this.isCellEditable(d)&&(d=null));null!=d&&(this.fireEvent(new mxEventObject(mxEvent.START_EDITING,"cell",d,"event",c)),this.cellEditor.startEditing(d,c))};mxGraph.prototype.getEditingValue=function(d,c){return this.convertValueToString(d)};mxGraph.prototype.stopEditing=function(b){this.cellEditor.stopEditing(b)};mxGraph.prototype.labelChanged=function(f,e,h){this.model.beginUpdate();try{var g=f.value;this.cellLabelChanged(f,e,this.isAutoSizeCell(f));this.fireEvent(new mxEventObject(mxEvent.LABEL_CHANGED,"cell",f,"value",e,"old",g,"event",h))}finally{this.model.endUpdate()}return f};mxGraph.prototype.cellLabelChanged=function(e,d,f){this.model.beginUpdate();try{this.model.setValue(e,d),f&&this.cellSizeUpdated(e,!1)}finally{this.model.endUpdate()}};mxGraph.prototype.escape=function(e){this.stopEditing(!0);this.connectionHandler.reset();this.graphHandler.reset();e=this.getSelectionCells();for(var d=0;d<e.length;d++){var f=this.view.getState(e[d]);null!=f&&null!=f.handler&&f.handler.reset()}};mxGraph.prototype.click=function(f){var e=f.getEvent(),h=f.getCell(),g=new mxEventObject(mxEvent.CLICK,"event",e,"cell",h);f.isConsumed()&&g.consume();this.fireEvent(g);this.isEnabled()&&(!mxEvent.isConsumed(e)&&!g.isConsumed())&&(null!=h?this.selectCellForEvent(h,e):(h=null,this.isSwimlaneSelectionEnabled()&&(h=this.getSwimlaneAt(f.getGraphX(),f.getGraphY())),null!=h?this.selectCellForEvent(h,e):this.isToggleEvent(e)||this.clearSelection()))};mxGraph.prototype.dblClick=function(e,d){var f=new mxEventObject(mxEvent.DOUBLE_CLICK,"event",e,"cell",d);this.fireEvent(f);this.isEnabled()&&(!mxEvent.isConsumed(e)&&!f.isConsumed()&&null!=d&&this.isCellEditable(d)&&!this.isEditing(d))&&(this.startEditingAtCell(d,e),mxEvent.consume(e))};mxGraph.prototype.tapAndHold=function(e){var d=e.getEvent(),f=new mxEventObject(mxEvent.TAP_AND_HOLD,"event",d,"cell",e.getCell());this.fireEvent(f);f.isConsumed()&&(this.panningHandler.panningTrigger=!1);this.isEnabled()&&(!mxEvent.isConsumed(d)&&!f.isConsumed()&&this.connectionHandler.isEnabled())&&(d=this.view.getState(this.connectionHandler.marker.getCell(e)),null!=d&&(this.connectionHandler.marker.currentColor=this.connectionHandler.marker.validColor,this.connectionHandler.marker.markedState=d,this.connectionHandler.marker.mark(),this.connectionHandler.first=new mxPoint(e.getGraphX(),e.getGraphY()),this.connectionHandler.edgeState=this.connectionHandler.createEdgeState(e),this.connectionHandler.previous=d,this.connectionHandler.fireEvent(new mxEventObject(mxEvent.START,"state",this.connectionHandler.previous))))};mxGraph.prototype.scrollPointToVisible=function(i,h,o,n){if(!this.timerAutoScroll&&(this.ignoreScrollbars||mxUtils.hasScrollbars(this.container))){var m=this.container;n=null!=n?n:20;if(i>=m.scrollLeft&&h>=m.scrollTop&&i<=m.scrollLeft+m.clientWidth&&h<=m.scrollTop+m.clientHeight){var l=m.scrollLeft+m.clientWidth-i;if(l<n){if(i=m.scrollLeft,m.scrollLeft+=n-l,o&&i==m.scrollLeft){if(this.dialect==mxConstants.DIALECT_SVG){i=this.view.getDrawPane().ownerSVGElement;var k=this.container.scrollWidth+n-l}else{k=Math.max(m.clientWidth,m.scrollWidth)+n-l,i=this.view.getCanvas()}i.style.width=k+"px";m.scrollLeft+=n-l}}else{l=i-m.scrollLeft,l<n&&(m.scrollLeft-=n-l)}l=m.scrollTop+m.clientHeight-h;l<n?(i=m.scrollTop,m.scrollTop+=n-l,i==m.scrollTop&&o&&(this.dialect==mxConstants.DIALECT_SVG?(i=this.view.getDrawPane().ownerSVGElement,h=this.container.scrollHeight+n-l):(h=Math.max(m.clientHeight,m.scrollHeight)+n-l,i=this.view.getCanvas()),i.style.height=h+"px",m.scrollTop+=n-l)):(l=h-m.scrollTop,l<n&&(m.scrollTop-=n-l))}}else{this.allowAutoPanning&&!this.panningHandler.active&&(null==this.panningManager&&(this.panningManager=this.createPanningManager()),this.panningManager.panTo(i+this.panDx,h+this.panDy))}};mxGraph.prototype.createPanningManager=function(){return new mxPanningManager(this)};mxGraph.prototype.getBorderSizes=function(){function e(g){var c=0,c="thin"==g?2:"medium"==g?4:"thick"==g?6:parseInt(g);isNaN(c)&&(c=0);return c}var d=mxUtils.getCurrentStyle(this.container),f=new mxRectangle;f.x=e(d.borderLeftWidth)+parseInt(d.paddingLeft||0);f.y=e(d.borderTopWidth)+parseInt(d.paddingTop||0);f.width=e(d.borderRightWidth)+parseInt(d.paddingRight||0);f.height=e(d.borderBottomWidth)+parseInt(d.paddingBottom||0);return f};mxGraph.prototype.getPreferredPageSize=function(h,g,m){h=this.view.scale;var l=this.view.translate,k=this.pageFormat,i=h*this.pageScale,k=new mxRectangle(0,0,k.width*i,k.height*i);g=this.pageBreaksVisible?Math.ceil(g/k.width):1;m=this.pageBreaksVisible?Math.ceil(m/k.height):1;return new mxRectangle(0,0,g*k.width+2+l.x/h,m*k.height+2+l.y/h)};mxGraph.prototype.sizeDidChange=function(){var f=this.getGraphBounds();if(null!=this.container){var e=this.getBorder(),h=Math.max(0,f.x+f.width+1+e),e=Math.max(0,f.y+f.height+1+e);null!=this.minimumContainerSize&&(h=Math.max(h,this.minimumContainerSize.width),e=Math.max(e,this.minimumContainerSize.height));this.resizeContainer&&this.doResizeContainer(h,e);if(this.preferPageSize||!mxClient.IS_IE&&this.pageVisible){var g=this.getPreferredPageSize(f,h,e);null!=g&&(h=g.width,e=g.height)}null!=this.minimumGraphSize&&(h=Math.max(h,this.minimumGraphSize.width*this.view.scale),e=Math.max(e,this.minimumGraphSize.height*this.view.scale));h=Math.ceil(h-1);e=Math.ceil(e-1);this.dialect==mxConstants.DIALECT_SVG?(g=this.view.getDrawPane().ownerSVGElement,g.style.minWidth=Math.max(1,h)+"px",g.style.minHeight=Math.max(1,e)+"px",g.style.width="100%",g.style.height="100%"):mxClient.IS_QUIRKS?this.view.updateHtmlCanvasSize(Math.max(1,h),Math.max(1,e)):(this.view.canvas.style.minWidth=Math.max(1,h)+"px",this.view.canvas.style.minHeight=Math.max(1,e)+"px");this.updatePageBreaks(this.pageBreaksVisible,h-1,e-1)}this.fireEvent(new mxEventObject(mxEvent.SIZE,"bounds",f))};mxGraph.prototype.doResizeContainer=function(e,d){if(mxClient.IS_IE){if(mxClient.IS_QUIRKS){var f=this.getBorderSizes();e+=Math.max(2,f.x+f.width+1);d+=Math.max(2,f.y+f.height+1)}else{9<=document.documentMode?(e+=3,d+=5):(e+=1,d+=1)}}else{d+=1}null!=this.maximumContainerSize&&(e=Math.min(this.maximumContainerSize.width,e),d=Math.min(this.maximumContainerSize.height,d));this.container.style.width=Math.ceil(e)+"px";this.container.style.height=Math.ceil(d)+"px"};mxGraph.prototype.updatePageBreaks=function(k,i,q){var p=this.view.scale,o=this.view.translate,n=this.pageFormat,m=p*this.pageScale,o=new mxRectangle(p*o.x,p*o.y,n.width*m,n.height*m);k=k&&Math.min(o.width,o.height)>this.minPageBreakDist;o.x=mxUtils.mod(o.x,o.width);o.y=mxUtils.mod(o.y,o.height);n=k?Math.ceil((i-o.x)/o.width):0;k=k?Math.ceil((q-o.y)/o.height):0;null==this.horizontalPageBreaks&&0<n&&(this.horizontalPageBreaks=[]);if(null!=this.horizontalPageBreaks){for(m=0;m<=n;m++){var l=[new mxPoint(o.x+m*o.width,1),new mxPoint(o.x+m*o.width,q)];null!=this.horizontalPageBreaks[m]?(this.horizontalPageBreaks[m].points=l,this.horizontalPageBreaks[m].redraw()):(l=new mxPolyline(l,this.pageBreakColor,this.scale),l.dialect=this.dialect,l.isDashed=this.pageBreakDashed,l.init(this.view.backgroundPane),l.redraw(),this.horizontalPageBreaks[m]=l)}for(m=n;m<this.horizontalPageBreaks.length;m++){this.horizontalPageBreaks[m].destroy()}this.horizontalPageBreaks.splice(n,this.horizontalPageBreaks.length-n)}null==this.verticalPageBreaks&&0<k&&(this.verticalPageBreaks=[]);if(null!=this.verticalPageBreaks){for(m=0;m<=k;m++){l=[new mxPoint(1,o.y+m*o.height),new mxPoint(i,o.y+m*o.height)],null!=this.verticalPageBreaks[m]?(this.verticalPageBreaks[m].points=l,this.verticalPageBreaks[m].redraw()):(l=new mxPolyline(l,this.pageBreakColor,p),l.dialect=this.dialect,l.isDashed=this.pageBreakDashed,l.init(this.view.backgroundPane),l.redraw(),this.verticalPageBreaks[m]=l)}for(m=k;m<this.verticalPageBreaks.length;m++){this.verticalPageBreaks[m].destroy()}this.verticalPageBreaks.splice(k,this.verticalPageBreaks.length-k)}};mxGraph.prototype.getCellStyle=function(e){var d=this.model.getStyle(e),f=null,f=this.model.isEdge(e)?this.stylesheet.getDefaultEdgeStyle():this.stylesheet.getDefaultVertexStyle();null!=d&&(f=this.postProcessCellStyle(this.stylesheet.getCellStyle(d,f)));null==f&&(f=mxGraph.prototype.EMPTY_ARRAY);return f};mxGraph.prototype.postProcessCellStyle=function(e){if(null!=e){var d=e[mxConstants.STYLE_IMAGE],f=this.getImageFromBundles(d);null!=f?e[mxConstants.STYLE_IMAGE]=f:f=d;null!=f&&"data:image/"==f.substring(0,11)&&("data:image/svg+xml,"!=f.substring(0,19)&&(d=f.indexOf(","),0<d&&(f=f.substring(0,d)+";base64,"+f.substring(d+1))),e[mxConstants.STYLE_IMAGE]=f)}return e};mxGraph.prototype.setCellStyle=function(e,d){d=d||this.getSelectionCells();if(null!=d){this.model.beginUpdate();try{for(var f=0;f<d.length;f++){this.model.setStyle(d[f],e)}}finally{this.model.endUpdate()}}};mxGraph.prototype.toggleCellStyle=function(e,d,f){f=f||this.getSelectionCell();this.toggleCellStyles(e,d,[f])};mxGraph.prototype.toggleCellStyles=function(f,e,h){e=null!=e?e:!1;h=h||this.getSelectionCells();if(null!=h&&0<h.length){var g=this.view.getState(h[0]),g=null!=g?g.style:this.getCellStyle(h[0]);null!=g&&(e=mxUtils.getValue(g,f,e)?0:1,this.setCellStyles(f,e,h))}};mxGraph.prototype.setCellStyles=function(e,d,f){f=f||this.getSelectionCells();mxUtils.setCellStyles(this.model,f,e,d)};mxGraph.prototype.toggleCellStyleFlags=function(e,d,f){this.setCellStyleFlags(e,d,null,f)};mxGraph.prototype.setCellStyleFlags=function(g,f,k,i){i=i||this.getSelectionCells();if(null!=i&&0<i.length){if(null==k){var h=this.view.getState(i[0]),h=null!=h?h.style:this.getCellStyle(i[0]);null!=h&&(k=(parseInt(h[g]||0)&f)!=f)}mxUtils.setCellStyleFlags(this.model,i,g,f,k)}};mxGraph.prototype.alignCells=function(i,h,o){null==h&&(h=this.getSelectionCells());if(null!=h&&1<h.length){if(null==o){for(var n=0;n<h.length;n++){var m=this.view.getState(h[n]);if(null!=m&&!this.model.isEdge(h[n])){if(null==o){if(i==mxConstants.ALIGN_CENTER){o=m.x+m.width/2;break}else{if(i==mxConstants.ALIGN_RIGHT){o=m.x+m.width}else{if(i==mxConstants.ALIGN_TOP){o=m.y}else{if(i==mxConstants.ALIGN_MIDDLE){o=m.y+m.height/2;break}else{o=i==mxConstants.ALIGN_BOTTOM?m.y+m.height:m.x}}}}}else{o=i==mxConstants.ALIGN_RIGHT?Math.max(o,m.x+m.width):i==mxConstants.ALIGN_TOP?Math.min(o,m.y):i==mxConstants.ALIGN_BOTTOM?Math.max(o,m.y+m.height):Math.min(o,m.x)}}}}if(null!=o){var l=this.view.scale;this.model.beginUpdate();try{for(n=0;n<h.length;n++){if(m=this.view.getState(h[n]),null!=m){var k=this.getCellGeometry(h[n]);null!=k&&!this.model.isEdge(h[n])&&(k=k.clone(),i==mxConstants.ALIGN_CENTER?k.x+=(o-m.x-m.width/2)/l:i==mxConstants.ALIGN_RIGHT?k.x+=(o-m.x-m.width)/l:i==mxConstants.ALIGN_TOP?k.y+=(o-m.y)/l:i==mxConstants.ALIGN_MIDDLE?k.y+=(o-m.y-m.height/2)/l:i==mxConstants.ALIGN_BOTTOM?k.y+=(o-m.y-m.height)/l:k.x+=(o-m.x)/l,this.resizeCell(h[n],k))}}this.fireEvent(new mxEventObject(mxEvent.ALIGN_CELLS,"align",i,"cells",h))}finally{this.model.endUpdate()}}}return h};mxGraph.prototype.flipEdge=function(d){if(null!=d&&null!=this.alternateEdgeStyle){this.model.beginUpdate();try{var c=this.model.getStyle(d);null==c||0==c.length?this.model.setStyle(d,this.alternateEdgeStyle):this.model.setStyle(d,null);this.resetEdge(d);this.fireEvent(new mxEventObject(mxEvent.FLIP_EDGE,"edge",d))}finally{this.model.endUpdate()}}return d};mxGraph.prototype.addImageBundle=function(b){this.imageBundles.push(b)};mxGraph.prototype.removeImageBundle=function(e){for(var d=[],f=0;f<this.imageBundles.length;f++){this.imageBundles[f]!=e&&d.push(this.imageBundles[f])}this.imageBundles=d};mxGraph.prototype.getImageFromBundles=function(e){if(null!=e){for(var d=0;d<this.imageBundles.length;d++){var f=this.imageBundles[d].getImage(e);if(null!=f){return f}}}return null};mxGraph.prototype.orderCells=function(d,c){null==c&&(c=mxUtils.sortCells(this.getSelectionCells(),!0));this.model.beginUpdate();try{this.cellsOrdered(c,d),this.fireEvent(new mxEventObject(mxEvent.ORDER_CELLS,"back",d,"cells",c))}finally{this.model.endUpdate()}return c};mxGraph.prototype.cellsOrdered=function(f,e){if(null!=f){this.model.beginUpdate();try{for(var h=0;h<f.length;h++){var g=this.model.getParent(f[h]);e?this.model.add(g,f[h],h):this.model.add(g,f[h],this.model.getChildCount(g)-1)}this.fireEvent(new mxEventObject(mxEvent.CELLS_ORDERED,"back",e,"cells",f))}finally{this.model.endUpdate()}}};mxGraph.prototype.groupCells=function(h,g,m){null==m&&(m=mxUtils.sortCells(this.getSelectionCells(),!0));m=this.getCellsForGroup(m);null==h&&(h=this.createGroupCell(m));var l=this.getBoundsForGroup(h,m,g);if(0<m.length&&null!=l){var k=this.model.getParent(h);null==k&&(k=this.model.getParent(m[0]));this.model.beginUpdate();try{null==this.getCellGeometry(h)&&this.model.setGeometry(h,new mxGeometry);var i=this.model.getChildCount(k);this.cellsAdded([h],k,i,null,null,!1);i=this.model.getChildCount(h);this.cellsAdded(m,h,i,null,null,!1,!1);this.cellsMoved(m,-l.x,-l.y,!1,!0);this.cellsResized([h],[l],!1);this.fireEvent(new mxEventObject(mxEvent.GROUP_CELLS,"group",h,"border",g,"cells",m))}finally{this.model.endUpdate()}}return h};mxGraph.prototype.getCellsForGroup=function(f){var e=[];if(null!=f&&0<f.length){var h=this.model.getParent(f[0]);e.push(f[0]);for(var g=1;g<f.length;g++){this.model.getParent(f[g])==h&&e.push(f[g])}}return e};mxGraph.prototype.getBoundsForGroup=function(e,d,f){d=this.getBoundingBoxFromGeometry(d);null!=d&&(this.isSwimlane(e)&&(e=this.getStartSize(e),d.x-=e.width,d.y-=e.height,d.width+=e.width,d.height+=e.height),d.x-=f,d.y-=f,d.width+=2*f,d.height+=2*f);return d};mxGraph.prototype.createGroupCell=function(b){b=new mxCell("");b.setVertex(!0);b.setConnectable(!1);return b};mxGraph.prototype.ungroupCells=function(i){var h=[];if(null==i){i=this.getSelectionCells();for(var o=[],n=0;n<i.length;n++){0<this.model.getChildCount(i[n])&&o.push(i[n])}i=o}if(null!=i&&0<i.length){this.model.beginUpdate();try{for(n=0;n<i.length;n++){var m=this.model.getChildren(i[n]);if(null!=m&&0<m.length){var m=m.slice(),l=this.model.getParent(i[n]),k=this.model.getChildCount(l);this.cellsAdded(m,l,k,null,null,!0);h=h.concat(m)}}this.cellsRemoved(this.addAllEdges(i));this.fireEvent(new mxEventObject(mxEvent.UNGROUP_CELLS,"cells",i))}finally{this.model.endUpdate()}}return h};mxGraph.prototype.removeCellsFromParent=function(e){null==e&&(e=this.getSelectionCells());this.model.beginUpdate();try{var d=this.getDefaultParent(),f=this.model.getChildCount(d);this.cellsAdded(e,d,f,null,null,!0);this.fireEvent(new mxEventObject(mxEvent.REMOVE_CELLS_FROM_PARENT,"cells",e))}finally{this.model.endUpdate()}return e};mxGraph.prototype.updateGroupBounds=function(k,i,q){null==k&&(k=this.getSelectionCells());i=null!=i?i:0;q=null!=q?q:!1;this.model.beginUpdate();try{for(var p=0;p<k.length;p++){var o=this.getCellGeometry(k[p]);if(null!=o){var n=this.getChildCells(k[p]);if(null!=n&&0<n.length){var m=this.getBoundingBoxFromGeometry(n);if(0<m.width&&0<m.height){var l=this.isSwimlane(k[p])?this.getStartSize(k[p]):new mxRectangle,o=o.clone();q&&(o.x+=m.x-l.width-i,o.y+=m.y-l.height-i);o.width=m.width+l.width+2*i;o.height=m.height+l.height+2*i;this.model.setGeometry(k[p],o);this.moveCells(n,-m.x+l.width+i,-m.y+l.height+i)}}}}}finally{this.model.endUpdate()}return k};mxGraph.prototype.cloneCells=function(A,z){z=null!=z?z:!0;var y=null;if(null!=A){for(var x={},y=[],w=0;w<A.length;w++){var v=mxCellPath.create(A[w]);x[v]=A[w];y.push(A[w])}if(0<y.length){for(var v=this.view.scale,u=this.view.translate,y=this.model.cloneCells(A,!0),w=0;w<A.length;w++){if(!z&&this.model.isEdge(y[w])&&null!=this.getEdgeValidationError(y[w],this.model.getTerminal(y[w],!0),this.model.getTerminal(y[w],!1))){y[w]=null}else{var t=this.model.getGeometry(y[w]);if(null!=t){var s=this.view.getState(A[w]),r=this.view.getState(this.model.getParent(A[w]));if(null!=s&&null!=r){var q=r.origin.x,r=r.origin.y;if(this.model.isEdge(y[w])){for(var s=s.absolutePoints,o=this.model.getTerminal(A[w],!0),i=mxCellPath.create(o);null!=o&&null==x[i];){o=this.model.getParent(o),i=mxCellPath.create(o)}null==o&&t.setTerminalPoint(new mxPoint(s[0].x/v-u.x,s[0].y/v-u.y),!0);o=this.model.getTerminal(A[w],!1);for(i=mxCellPath.create(o);null!=o&&null==x[i];){o=this.model.getParent(o),i=mxCellPath.create(o)}null==o&&(o=s.length-1,t.setTerminalPoint(new mxPoint(s[o].x/v-u.x,s[o].y/v-u.y),!1));t=t.points;if(null!=t){for(s=0;s<t.length;s++){t[s].x+=q,t[s].y+=r}}}else{t.x+=q,t.y+=r}}}}}}else{y=[]}}return y};mxGraph.prototype.insertVertex=function(s,r,q,p,o,n,m,l,i){r=this.createVertex(s,r,q,p,o,n,m,l,i);return this.addCell(r,s)};mxGraph.prototype.createVertex=function(s,r,q,p,o,n,m,l,i){s=new mxGeometry(p,o,n,m);s.relative=null!=i?i:!1;q=new mxCell(q,s,l);q.setId(r);q.setVertex(!0);q.setConnectable(!0);return q};mxGraph.prototype.insertEdge=function(h,g,m,l,k,i){g=this.createEdge(h,g,m,l,k,i);return this.addEdge(g,h,l,k)};mxGraph.prototype.createEdge=function(h,g,m,l,k,i){h=new mxCell(m,new mxGeometry,i);h.setId(g);h.setEdge(!0);h.geometry.relative=!0;return h};mxGraph.prototype.addEdge=function(g,f,k,i,h){return this.addCell(g,f,h,k,i)};mxGraph.prototype.addCell=function(g,f,k,i,h){return this.addCells([g],f,k,i,h)[0]};mxGraph.prototype.addCells=function(g,f,k,i,h){null==f&&(f=this.getDefaultParent());null==k&&(k=this.model.getChildCount(f));this.model.beginUpdate();try{this.cellsAdded(g,f,k,i,h,!1,!0),this.fireEvent(new mxEventObject(mxEvent.ADD_CELLS,"cells",g,"parent",f,"index",k,"source",i,"target",h))}finally{this.model.endUpdate()}return g};mxGraph.prototype.cellsAdded=function(F,E,D,C,B,A,z){if(null!=F&&null!=E&&null!=D){this.model.beginUpdate();try{for(var y=A?this.view.getState(E):null,x=null!=y?y.origin:null,w=new mxPoint(0,0),y=0;y<F.length;y++){if(null==F[y]){D--}else{var v=this.model.getParent(F[y]);if(null!=x&&F[y]!=E&&E!=v){var u=this.view.getState(v),t=null!=u?u.origin:w,o=this.model.getGeometry(F[y]);if(null!=o){var G=t.x-x.x,i=t.y-x.y,o=o.clone();o.translate(G,i);!o.relative&&(this.model.isVertex(F[y])&&!this.isAllowNegativeCoordinates())&&(o.x=Math.max(0,o.x),o.y=Math.max(0,o.y));this.model.setGeometry(F[y],o)}}E==v&&D+y>this.model.getChildCount(E)&&D--;this.model.add(E,F[y],D+y);this.autoSizeCellsOnAdd&&this.autoSizeCell(F[y],!0);this.isExtendParentsOnAdd()&&this.isExtendParent(F[y])?this.extendParent(F[y]):(null==z||z)&&this.constrainChild(F[y]);null!=C&&this.cellConnected(F[y],C,!0);null!=B&&this.cellConnected(F[y],B,!1)}}this.fireEvent(new mxEventObject(mxEvent.CELLS_ADDED,"cells",F,"parent",E,"index",D,"source",C,"target",B,"absolute",A))}finally{this.model.endUpdate()}}};mxGraph.prototype.autoSizeCell=function(f,e){if(null!=e?e:1){for(var h=this.model.getChildCount(f),g=0;g<h;g++){this.autoSizeCell(this.model.getChildAt(f,g))}}this.getModel().isVertex(f)&&this.isAutoSizeCell(f)&&this.updateCellSize(f)};mxGraph.prototype.removeCells=function(d,c){c=null!=c?c:!0;null==d&&(d=this.getDeletableCells(this.getSelectionCells()));c&&(d=this.getDeletableCells(this.addAllEdges(d)));this.model.beginUpdate();try{this.cellsRemoved(d),this.fireEvent(new mxEventObject(mxEvent.REMOVE_CELLS,"cells",d,"includeEdges",c))}finally{this.model.endUpdate()}return d};mxGraph.prototype.cellsRemoved=function(A){if(null!=A&&0<A.length){var z=this.view.scale,y=this.view.translate;this.model.beginUpdate();try{for(var x={},w=0;w<A.length;w++){var v=mxCellPath.create(A[w]);x[v]=A[w]}for(w=0;w<A.length;w++){for(var u=this.getConnections(A[w]),t=0;t<u.length;t++){if(v=mxCellPath.create(u[t]),null==x[v]){var s=this.model.getGeometry(u[t]);if(null!=s){var r=this.view.getState(u[t]);if(null!=r){var s=s.clone(),q=r.getVisibleTerminal(!0)==A[w],o=r.absolutePoints,i=q?0:o.length-1;s.setTerminalPoint(new mxPoint(o[i].x/z-y.x,o[i].y/z-y.y),q);this.model.setTerminal(u[t],null,q);this.model.setGeometry(u[t],s)}}}}this.model.remove(A[w])}this.fireEvent(new mxEventObject(mxEvent.CELLS_REMOVED,"cells",A))}finally{this.model.endUpdate()}}};mxGraph.prototype.splitEdge=function(i,h,o,n,m){n=n||0;m=m||0;null==o&&(o=this.cloneCells([i])[0]);var l=this.model.getParent(i),k=this.model.getTerminal(i,!0);this.model.beginUpdate();try{this.cellsMoved(h,n,m,!1,!1),this.cellsAdded(h,l,this.model.getChildCount(l),null,null,!0),this.cellsAdded([o],l,this.model.getChildCount(l),k,h[0],!1),this.cellConnected(i,h[0],!0),this.fireEvent(new mxEventObject(mxEvent.SPLIT_EDGE,"edge",i,"cells",h,"newEdge",o,"dx",n,"dy",m))}finally{this.model.endUpdate()}return o};mxGraph.prototype.toggleCells=function(e,d,f){null==d&&(d=this.getSelectionCells());f&&(d=this.addAllEdges(d));this.model.beginUpdate();try{this.cellsToggled(d,e),this.fireEvent(new mxEventObject(mxEvent.TOGGLE_CELLS,"show",e,"cells",d,"includeEdges",f))}finally{this.model.endUpdate()}return d};mxGraph.prototype.cellsToggled=function(e,d){if(null!=e&&0<e.length){this.model.beginUpdate();try{for(var f=0;f<e.length;f++){this.model.setVisible(e[f],d)}}finally{this.model.endUpdate()}}};mxGraph.prototype.foldCells=function(f,e,h,g){e=null!=e?e:!1;null==h&&(h=this.getFoldableCells(this.getSelectionCells(),f));this.stopEditing(!1);this.model.beginUpdate();try{this.cellsFolded(h,f,e,g),this.fireEvent(new mxEventObject(mxEvent.FOLD_CELLS,"collapse",f,"recurse",e,"cells",h))}finally{this.model.endUpdate()}return h};mxGraph.prototype.cellsFolded=function(h,g,m,l){if(null!=h&&0<h.length){this.model.beginUpdate();try{for(var k=0;k<h.length;k++){if((!l||this.isCellFoldable(h[k],g))&&g!=this.isCellCollapsed(h[k])){if(this.model.setCollapsed(h[k],g),this.swapBounds(h[k],g),this.isExtendParent(h[k])&&this.extendParent(h[k]),m){var i=this.model.getChildren(h[k]);this.foldCells(i,g,m)}}}this.fireEvent(new mxEventObject(mxEvent.CELLS_FOLDED,"cells",h,"collapse",g,"recurse",m))}finally{this.model.endUpdate()}}};mxGraph.prototype.swapBounds=function(e,d){if(null!=e){var f=this.model.getGeometry(e);null!=f&&(f=f.clone(),this.updateAlternateBounds(e,f,d),f.swap(),this.model.setGeometry(e,f))}};mxGraph.prototype.updateAlternateBounds=function(g,f,k){if(null!=g&&null!=f){k=this.view.getState(g);k=null!=k?k.style:this.getCellStyle(g);if(null==f.alternateBounds){var i=f;this.collapseToPreferredSize&&(g=this.getPreferredSizeForCell(g),null!=g&&(i=g,g=mxUtils.getValue(k,mxConstants.STYLE_STARTSIZE),0<g&&(i.height=Math.max(i.height,g))));f.alternateBounds=new mxRectangle(0,0,i.width,i.height)}if(null!=f.alternateBounds){f.alternateBounds.x=f.x;f.alternateBounds.y=f.y;var h=mxUtils.toRadians(k[mxConstants.STYLE_ROTATION]||"0");0!=h&&(g=f.alternateBounds.getCenterX()-f.getCenterX(),k=f.alternateBounds.getCenterY()-f.getCenterY(),i=Math.cos(h),h=Math.sin(h),f.alternateBounds.x+=i*g-h*k-g,f.alternateBounds.y+=h*g+i*k-k)}}};mxGraph.prototype.addAllEdges=function(d){var c=d.slice();return c=c.concat(this.getAllEdges(d))};mxGraph.prototype.getAllEdges=function(g){var f=[];if(null!=g){for(var k=0;k<g.length;k++){for(var i=this.model.getEdgeCount(g[k]),h=0;h<i;h++){f.push(this.model.getEdgeAt(g[k],h))}i=this.model.getChildren(g[k]);f=f.concat(this.getAllEdges(i))}}return f};mxGraph.prototype.updateCellSize=function(d,c){c=null!=c?c:!1;this.model.beginUpdate();try{this.cellSizeUpdated(d,c),this.fireEvent(new mxEventObject(mxEvent.UPDATE_CELL_SIZE,"cell",d,"ignoreChildren",c))}finally{this.model.endUpdate()}return d};mxGraph.prototype.cellSizeUpdated=function(y,x){if(null!=y){this.model.beginUpdate();try{var w=this.getPreferredSizeForCell(y),v=this.model.getGeometry(y);if(null!=w&&null!=v){var u=this.isCellCollapsed(y),v=v.clone();if(this.isSwimlane(y)){var t=this.view.getState(y),s=null!=t?t.style:this.getCellStyle(y),r=this.model.getStyle(y);null==r&&(r="");mxUtils.getValue(s,mxConstants.STYLE_HORIZONTAL,!0)?(r=mxUtils.setStyle(r,mxConstants.STYLE_STARTSIZE,w.height+8),u&&(v.height=w.height+8),v.width=w.width):(r=mxUtils.setStyle(r,mxConstants.STYLE_STARTSIZE,w.width+8),u&&(v.width=w.width+8),v.height=w.height);this.model.setStyle(y,r)}else{v.width=w.width,v.height=w.height}if(!x&&!u){var q=this.view.getBounds(this.model.getChildren(y));if(null!=q){var p=this.view.translate,o=this.view.scale,i=(q.y+q.height)/o-v.y-p.y;v.width=Math.max(v.width,(q.x+q.width)/o-v.x-p.x);v.height=Math.max(v.height,i)}}this.cellsResized([y],[v],!1)}}finally{this.model.endUpdate()}}};mxGraph.prototype.getPreferredSizeForCell=function(h){var g=null;if(null!=h){var m=this.view.getState(h),l=null!=m?m.style:this.getCellStyle(h);if(null!=l&&!this.model.isEdge(h)){var k=l[mxConstants.STYLE_FONTSIZE]||mxConstants.DEFAULT_FONTSIZE,i=0,g=0;if((null!=this.getImage(m)||null!=l[mxConstants.STYLE_IMAGE])&&l[mxConstants.STYLE_SHAPE]==mxConstants.SHAPE_LABEL){l[mxConstants.STYLE_VERTICAL_ALIGN]==mxConstants.ALIGN_MIDDLE&&(i+=parseFloat(l[mxConstants.STYLE_IMAGE_WIDTH])||mxLabel.prototype.imageSize),l[mxConstants.STYLE_ALIGN]!=mxConstants.ALIGN_CENTER&&(g+=parseFloat(l[mxConstants.STYLE_IMAGE_HEIGHT])||mxLabel.prototype.imageSize)}i+=2*(l[mxConstants.STYLE_SPACING]||0);i+=l[mxConstants.STYLE_SPACING_LEFT]||0;i+=l[mxConstants.STYLE_SPACING_RIGHT]||0;g+=2*(l[mxConstants.STYLE_SPACING]||0);g+=l[mxConstants.STYLE_SPACING_TOP]||0;g+=l[mxConstants.STYLE_SPACING_BOTTOM]||0;m=this.getFoldingImage(m);null!=m&&(i+=m.width+8);m=this.getLabel(h);null!=m&&0<m.length?(this.isHtmlLabel(h)||(m=m.replace(/\n/g,"<br>")),k=mxUtils.getSizeForString(m,k,l[mxConstants.STYLE_FONTFAMILY]),h=k.width+i,g=k.height+g,mxUtils.getValue(l,mxConstants.STYLE_HORIZONTAL,!0)||(l=g,g=h,h=l),this.gridEnabled&&(h=this.snap(h+this.gridSize/2),g=this.snap(g+this.gridSize/2)),g=new mxRectangle(0,0,h,g)):(l=4*this.gridSize,g=new mxRectangle(0,0,l,l))}}return g};mxGraph.prototype.resizeCell=function(e,d,f){return this.resizeCells([e],[d],f)[0]};mxGraph.prototype.resizeCells=function(e,d,f){f=null!=f?f:this.isRecursiveResize();this.model.beginUpdate();try{this.cellsResized(e,d,f),this.fireEvent(new mxEventObject(mxEvent.RESIZE_CELLS,"cells",e,"bounds",d))}finally{this.model.endUpdate()}return e};mxGraph.prototype.cellsResized=function(f,e,h){h=null!=h?h:!1;if(null!=f&&null!=e&&f.length==e.length){this.model.beginUpdate();try{for(var g=0;g<f.length;g++){this.cellResized(f[g],e[g],!1,h),this.isExtendParent(f[g])?this.extendParent(f[g]):this.isConstrainChildrenOnResize()&&this.constrainChild(f[g])}this.resetEdgesOnResize&&this.resetEdges(f);this.fireEvent(new mxEventObject(mxEvent.CELLS_RESIZED,"cells",f,"bounds",e))}finally{this.model.endUpdate()}}};mxGraph.prototype.cellResized=function(g,f,k,i){var h=this.model.getGeometry(g);if(null!=h&&(h.x!=f.x||h.y!=f.y||h.width!=f.width||h.height!=f.height)){h=h.clone();!k&&h.relative?(k=h.offset,null!=k&&(k.x+=f.x-h.x,k.y+=f.y-h.y)):(h.x=f.x,h.y=f.y);h.width=f.width;h.height=f.height;!h.relative&&(this.model.isVertex(g)&&!this.isAllowNegativeCoordinates())&&(h.x=Math.max(0,h.x),h.y=Math.max(0,h.y));this.model.beginUpdate();try{i&&this.resizeChildCells(g,h),this.model.setGeometry(g,h),this.isConstrainChildrenOnResize()&&this.constrainChildCells(g)}finally{this.model.endUpdate()}}};mxGraph.prototype.resizeChildCells=function(h,g){for(var m=this.model.getGeometry(h),l=g.width/m.width,m=g.height/m.height,k=this.model.getChildCount(h),i=0;i<k;i++){this.scaleCell(this.model.getChildAt(h,i),l,m,!0)}};mxGraph.prototype.constrainChildCells=function(e){for(var d=this.model.getChildCount(e),f=0;f<d;f++){this.constrainChild(this.model.getChildAt(e,f))}};mxGraph.prototype.scaleCell=function(h,g,m,l){var k=this.model.getGeometry(h);if(null!=k){var k=k.clone(),i=k.points;if(null!=i){for(l=0;l<i.length;l++){i[l].x*=g,i[l].y*=m}this.model.setGeometry(h,k)}else{this.model.isVertex(h)&&(k.x*=g,k.y*=m,k.width*=g,k.height*=m,this.cellResized(h,k,!0,l))}}};mxGraph.prototype.extendParent=function(e){if(null!=e){var d=this.model.getParent(e),f=this.model.getGeometry(d);if(null!=d&&(null!=f&&!this.isCellCollapsed(d))&&(e=this.model.getGeometry(e),null!=e&&(f.width<e.x+e.width||f.height<e.y+e.height))){f=f.clone(),f.width=Math.max(f.width,e.x+e.width),f.height=Math.max(f.height,e.y+e.height),this.cellsResized([d],[f],!1)}}};mxGraph.prototype.importCells=function(g,f,k,i,h){return this.moveCells(g,f,k,!0,i,h)};mxGraph.prototype.moveCells=function(k,i,q,p,o,n){i=null!=i?i:0;q=null!=q?q:0;p=null!=p?p:!1;if(null!=k&&(0!=i||0!=q||p||null!=o)){this.model.beginUpdate();try{p&&(k=this.cloneCells(k,this.isCloneInvalidEdges()),null==o&&(o=this.getDefaultParent()));var m=this.isAllowNegativeCoordinates();null!=o&&this.setAllowNegativeCoordinates(!0);this.cellsMoved(k,i,q,!p&&this.isDisconnectOnMove()&&this.isAllowDanglingEdges(),null==o,this.isExtendParentsOnMove()&&null==o);this.setAllowNegativeCoordinates(m);if(null!=o){var l=this.model.getChildCount(o);this.cellsAdded(k,o,l,null,null,!0)}this.fireEvent(new mxEventObject(mxEvent.MOVE_CELLS,"cells",k,"dx",i,"dy",q,"clone",p,"target",o,"event",n))}finally{this.model.endUpdate()}}return k};mxGraph.prototype.cellsMoved=function(i,h,o,n,m,l){if(null!=i&&(0!=h||0!=o)){l=null!=l?l:!1;this.model.beginUpdate();try{n&&this.disconnectGraph(i);for(var k=0;k<i.length;k++){this.translateCell(i[k],h,o),l&&this.isExtendParent(i[k])?this.extendParent(i[k]):m&&this.constrainChild(i[k])}this.resetEdgesOnMove&&this.resetEdges(i);this.fireEvent(new mxEventObject(mxEvent.CELLS_MOVED,"cells",i,"dx",h,"dy",o,"disconnect",n))}finally{this.model.endUpdate()}}};mxGraph.prototype.translateCell=function(f,e,h){var g=this.model.getGeometry(f);null!=g&&(g=g.clone(),g.translate(e,h),!g.relative&&(this.model.isVertex(f)&&!this.isAllowNegativeCoordinates())&&(g.x=Math.max(0,g.x),g.y=Math.max(0,g.y)),g.relative&&!this.model.isEdge(f)&&(null==g.offset?g.offset=new mxPoint(e,h):(g.offset.x+=e,g.offset.y+=h)),this.model.setGeometry(f,g))};mxGraph.prototype.getCellContainmentArea=function(g){if(null!=g&&!this.model.isEdge(g)){var f=this.model.getParent(g);if(f==this.getDefaultParent()||f==this.getCurrentRoot()){return this.getMaximumGraphBounds()}if(null!=f&&f!=this.getDefaultParent()){var k=this.model.getGeometry(f);if(null!=k){var i=g=0,h=k.width,k=k.height;this.isSwimlane(f)&&(f=this.getStartSize(f),g=f.width,h-=f.width,i=f.height,k-=f.height);return new mxRectangle(g,i,h,k)}}}return null};mxGraph.prototype.getMaximumGraphBounds=function(){return this.maximumGraphBounds};mxGraph.prototype.constrainChild=function(f){if(null!=f){var e=this.model.getGeometry(f),h=this.isConstrainChild(f)?this.getCellContainmentArea(f):this.getMaximumGraphBounds();if(null!=e&&null!=h&&!e.relative&&(e.x<h.x||e.y<h.y||h.width<e.x+e.width||h.height<e.y+e.height)){var g=this.getOverlap(f),e=e.clone();0<h.width&&(e.x=Math.min(e.x,h.x+h.width-(1-g)*e.width));0<h.height&&(e.y=Math.min(e.y,h.y+h.height-(1-g)*e.height));e.x=Math.max(e.x,h.x-e.width*g);e.y=Math.max(e.y,h.y-e.height*g);e.width=Math.min(e.width,h.width);e.height=Math.min(e.height,h.height);this.model.setGeometry(f,e)}}};mxGraph.prototype.resetEdges=function(u){if(null!=u){for(var t={},s=0;s<u.length;s++){var r=mxCellPath.create(u[s]);t[r]=u[s]}this.model.beginUpdate();try{for(s=0;s<u.length;s++){var q=this.model.getEdges(u[s]);if(null!=q){for(r=0;r<q.length;r++){var p=this.view.getState(q[r]),o=null!=p?p.getVisibleTerminal(!0):this.view.getVisibleTerminal(q[r],!0),n=null!=p?p.getVisibleTerminal(!1):this.view.getVisibleTerminal(q[r],!1),m=mxCellPath.create(o),i=mxCellPath.create(n);(null==t[m]||null==t[i])&&this.resetEdge(q[r])}}this.resetEdges(this.model.getChildren(u[s]))}}finally{this.model.endUpdate()}}};mxGraph.prototype.resetEdge=function(d){var c=this.model.getGeometry(d);null!=c&&(null!=c.points&&0<c.points.length)&&(c=c.clone(),c.points=[],this.model.setGeometry(d,c));return d};mxGraph.prototype.getAllConnectionConstraints=function(d,c){return null!=d&&null!=d.shape&&null!=d.shape.stencil?d.shape.stencil.constraints:null};mxGraph.prototype.getConnectionConstraint=function(g,f,k){f=null;var i=g.style[k?mxConstants.STYLE_EXIT_X:mxConstants.STYLE_ENTRY_X];if(null!=i){var h=g.style[k?mxConstants.STYLE_EXIT_Y:mxConstants.STYLE_ENTRY_Y];null!=h&&(f=new mxPoint(parseFloat(i),parseFloat(h)))}i=!1;null!=f&&(i=mxUtils.getValue(g.style,k?mxConstants.STYLE_EXIT_PERIMETER:mxConstants.STYLE_ENTRY_PERIMETER,!0));return new mxConnectionConstraint(f,i)};mxGraph.prototype.setConnectionConstraint=function(f,e,h,g){if(null!=g){this.model.beginUpdate();try{null==g||null==g.point?(this.setCellStyles(h?mxConstants.STYLE_EXIT_X:mxConstants.STYLE_ENTRY_X,null,[f]),this.setCellStyles(h?mxConstants.STYLE_EXIT_Y:mxConstants.STYLE_ENTRY_Y,null,[f]),this.setCellStyles(h?mxConstants.STYLE_EXIT_PERIMETER:mxConstants.STYLE_ENTRY_PERIMETER,null,[f])):null!=g.point&&(this.setCellStyles(h?mxConstants.STYLE_EXIT_X:mxConstants.STYLE_ENTRY_X,g.point.x,[f]),this.setCellStyles(h?mxConstants.STYLE_EXIT_Y:mxConstants.STYLE_ENTRY_Y,g.point.y,[f]),g.perimeter?this.setCellStyles(h?mxConstants.STYLE_EXIT_PERIMETER:mxConstants.STYLE_ENTRY_PERIMETER,null,[f]):this.setCellStyles(h?mxConstants.STYLE_EXIT_PERIMETER:mxConstants.STYLE_ENTRY_PERIMETER,"0",[f]))}finally{this.model.endUpdate()}}};mxGraph.prototype.getConnectionPoint=function(A,z){var y=null;if(null!=A){var x=this.view.getPerimeterBounds(A),w=new mxPoint(x.getCenterX(),x.getCenterY()),v=A.style[mxConstants.STYLE_DIRECTION],u=0;if(null!=v&&(v==mxConstants.DIRECTION_NORTH?u+=270:v==mxConstants.DIRECTION_WEST?u+=180:v==mxConstants.DIRECTION_SOUTH&&(u+=90),v==mxConstants.DIRECTION_NORTH||v==mxConstants.DIRECTION_SOUTH)){x.x+=x.width/2-x.height/2;x.y+=x.height/2-x.width/2;var t=x.width;x.width=x.height;x.height=t}if(null!=z.point){var s=y=1,r=0,q=0;if(this.getModel().isVertex(A.cell)){var o=A.style[mxConstants.STYLE_FLIPH],i=A.style[mxConstants.STYLE_FLIPV];null!=A.shape&&null!=A.shape.stencil&&(o=1==mxUtils.getValue(A.style,"stencilFlipH",0)||o,i=1==mxUtils.getValue(A.style,"stencilFlipV",0)||i);if("north"==v||"south"==v){t=o,o=i,i=t}o&&(y=-1,r=-x.width);i&&(s=-1,q=-x.height)}y=new mxPoint(x.x+z.point.x*x.width*y-r,x.y+z.point.y*x.height*s-q)}v=A.style[mxConstants.STYLE_ROTATION]||0;z.perimeter?(0!=u&&null!=y&&(t=x=0,90==u?t=1:180==u?x=-1:270==v&&(t=-1),y=mxUtils.getRotatedPoint(y,x,t,w)),null!=y&&z.perimeter&&(y=this.view.getPerimeterPoint(A,y,!1))):v+=u;0!=v&&null!=y&&(u=mxUtils.toRadians(v),x=Math.cos(u),t=Math.sin(u),y=mxUtils.getRotatedPoint(y,x,t,w))}return y};mxGraph.prototype.connectCell=function(g,f,k,i){this.model.beginUpdate();try{var h=this.model.getTerminal(g,k);this.cellConnected(g,f,k,i);this.fireEvent(new mxEventObject(mxEvent.CONNECT_CELL,"edge",g,"terminal",f,"source",k,"previous",h))}finally{this.model.endUpdate()}return g};mxGraph.prototype.cellConnected=function(g,f,k,i){if(null!=g){this.model.beginUpdate();try{var h=this.model.getTerminal(g,k);this.setConnectionConstraint(g,f,k,i);this.isPortsEnabled()&&(i=null,this.isPort(f)&&(i=f.getId(),f=this.getTerminalForPort(f,k)),this.setCellStyles(k?mxConstants.STYLE_SOURCE_PORT:mxConstants.STYLE_TARGET_PORT,i,[g]));this.model.setTerminal(g,f,k);this.resetEdgesOnConnect&&this.resetEdge(g);this.fireEvent(new mxEventObject(mxEvent.CELL_CONNECTED,"edge",g,"terminal",f,"source",k,"previous",h))}finally{this.model.endUpdate()}}};mxGraph.prototype.disconnectGraph=function(G){if(null!=G){this.model.beginUpdate();try{for(var F=this.view.scale,E=this.view.translate,D={},C=0;C<G.length;C++){var B=mxCellPath.create(G[C]);D[B]=G[C]}for(C=0;C<G.length;C++){if(this.model.isEdge(G[C])){var A=this.model.getGeometry(G[C]);if(null!=A){var z=this.view.getState(G[C]),y=this.view.getState(this.model.getParent(G[C]));if(null!=z&&null!=y){var A=A.clone(),x=-y.origin.x,w=-y.origin.y,v=z.absolutePoints,u=this.model.getTerminal(G[C],!0);if(null!=u&&this.isCellDisconnectable(G[C],u,!0)){for(var o=mxCellPath.create(u);null!=u&&null==D[o];){u=this.model.getParent(u),o=mxCellPath.create(u)}null==u&&(A.setTerminalPoint(new mxPoint(v[0].x/F-E.x+x,v[0].y/F-E.y+w),!0),this.model.setTerminal(G[C],null,!0))}var I=this.model.getTerminal(G[C],!1);if(null!=I&&this.isCellDisconnectable(G[C],I,!1)){for(var i=mxCellPath.create(I);null!=I&&null==D[i];){I=this.model.getParent(I),i=mxCellPath.create(I)}if(null==I){var H=v.length-1;A.setTerminalPoint(new mxPoint(v[H].x/F-E.x+x,v[H].y/F-E.y+w),!1);this.model.setTerminal(G[C],null,!1)}}this.model.setGeometry(G[C],A)}}}}}finally{this.model.endUpdate()}}};mxGraph.prototype.getCurrentRoot=function(){return this.view.currentRoot};mxGraph.prototype.getTranslateForRoot=function(b){return null};mxGraph.prototype.isPort=function(b){return !1};mxGraph.prototype.getTerminalForPort=function(d,c){return this.model.getParent(d)};mxGraph.prototype.getChildOffsetForCell=function(b){return null};mxGraph.prototype.enterGroup=function(b){b=b||this.getSelectionCell();null!=b&&this.isValidRoot(b)&&(this.view.setCurrentRoot(b),this.clearSelection())};mxGraph.prototype.exitGroup=function(){var e=this.model.getRoot(),d=this.getCurrentRoot();if(null!=d){for(var f=this.model.getParent(d);f!=e&&!this.isValidRoot(f)&&this.model.getParent(f)!=e;){f=this.model.getParent(f)}f==e||this.model.getParent(f)==e?this.view.setCurrentRoot(null):this.view.setCurrentRoot(f);null!=this.view.getState(d)&&this.setSelectionCell(d)}};mxGraph.prototype.home=function(){var b=this.getCurrentRoot();null!=b&&(this.view.setCurrentRoot(null),null!=this.view.getState(b)&&this.setSelectionCell(b))};mxGraph.prototype.isValidRoot=function(b){return null!=b};mxGraph.prototype.getGraphBounds=function(){return this.view.getGraphBounds()};mxGraph.prototype.getCellBounds=function(h,g,m){var l=[h];g&&(l=l.concat(this.model.getEdges(h)));l=this.view.getBounds(l);if(m){m=this.model.getChildCount(h);for(var k=0;k<m;k++){var i=this.getCellBounds(this.model.getChildAt(h,k),g,!0);null!=l?l.add(i):l=i}}return l};mxGraph.prototype.getBoundingBoxFromGeometry=function(s,r){r=null!=r?r:!1;var q=null;if(null!=s){for(var p=0;p<s.length;p++){if(r||this.model.isVertex(s[p])){var o=this.getCellGeometry(s[p]);if(null!=o){var n=o.points;if(null!=n&&0<n.length){for(var m=new mxRectangle(n[0].x,n[0].y,0,0),l=function(b){null!=b&&m.add(new mxRectangle(b.x,b.y,0,0))},i=1;i<n.length;i++){l(n[i])}l(o.getTerminalPoint(!0));l(o.getTerminalPoint(!1));o=m}null==q?q=new mxRectangle(o.x,o.y,o.width,o.height):q.add(o)}}}}return q};mxGraph.prototype.refresh=function(b){this.view.clear(b,null==b);this.view.validate();this.sizeDidChange();this.fireEvent(new mxEventObject(mxEvent.REFRESH))};mxGraph.prototype.snap=function(b){this.gridEnabled&&(b=Math.round(b/this.gridSize)*this.gridSize);return b};mxGraph.prototype.panGraph=function(h,g){if(this.useScrollbarsForPanning&&mxUtils.hasScrollbars(this.container)){this.container.scrollLeft=-h,this.container.scrollTop=-g}else{var m=this.view.getCanvas();if(this.dialect==mxConstants.DIALECT_SVG){if(0==h&&0==g){if(mxClient.IS_IE?m.setAttribute("transform","translate("+h+","+g+")"):m.removeAttribute("transform"),null!=this.shiftPreview1){for(var l=this.shiftPreview1.firstChild;null!=l;){var k=l.nextSibling;this.container.appendChild(l);l=k}this.shiftPreview1.parentNode.removeChild(this.shiftPreview1);this.shiftPreview1=null;this.container.appendChild(m.parentNode);for(l=this.shiftPreview2.firstChild;null!=l;){k=l.nextSibling,this.container.appendChild(l),l=k}this.shiftPreview2.parentNode.removeChild(this.shiftPreview2);this.shiftPreview2=null}}else{m.setAttribute("transform","translate("+h+","+g+")");if(null==this.shiftPreview1){this.shiftPreview1=document.createElement("div");this.shiftPreview1.style.position="absolute";this.shiftPreview1.style.overflow="visible";this.shiftPreview2=document.createElement("div");this.shiftPreview2.style.position="absolute";this.shiftPreview2.style.overflow="visible";for(var i=this.shiftPreview1,l=this.container.firstChild;null!=l;){k=l.nextSibling,l!=m.parentNode?i.appendChild(l):i=this.shiftPreview2,l=k}this.container.insertBefore(this.shiftPreview1,m.parentNode);this.container.appendChild(this.shiftPreview2)}this.shiftPreview1.style.left=h+"px";this.shiftPreview1.style.top=g+"px";this.shiftPreview2.style.left=h+"px";this.shiftPreview2.style.top=g+"px"}}else{m.style.left=h+"px",m.style.top=g+"px"}this.panDx=h;this.panDy=g;this.fireEvent(new mxEventObject(mxEvent.PAN))}};mxGraph.prototype.zoomIn=function(){this.zoom(this.zoomFactor)};mxGraph.prototype.zoomOut=function(){this.zoom(1/this.zoomFactor)};mxGraph.prototype.zoomActual=function(){1==this.view.scale?this.view.setTranslate(0,0):(this.view.translate.x=0,this.view.translate.y=0,this.view.setScale(1))};mxGraph.prototype.zoomTo=function(d,c){this.zoom(d/this.view.scale,c)};mxGraph.prototype.zoom=function(h,g){g=null!=g?g:this.centerZoom;var m=this.view.scale*h,l=this.view.getState(this.getSelectionCell());if(this.keepSelectionVisibleOnZoom&&null!=l){l=new mxRectangle(l.x*h,l.y*h,l.width*h,l.height*h),this.view.scale=m,this.scrollRectToVisible(l)||(this.view.revalidate(),this.view.setScale(m))}else{if(g&&!mxUtils.hasScrollbars(this.container)){var l=this.container.offsetWidth,k=this.container.offsetHeight;if(1<h){var i=(h-1)/(2*m),l=l*-i,k=k*-i}else{i=(1/h-1)/(2*this.view.scale),l*=i,k*=i}this.view.scaleAndTranslate(m,this.view.translate.x+l,this.view.translate.y+k)}else{this.view.setScale(m),mxUtils.hasScrollbars(this.container)&&(k=l=0,g&&(l=this.container.offsetWidth*(h-1)/2,k=this.container.offsetHeight*(h-1)/2),this.container.scrollLeft=Math.round(this.container.scrollLeft*h+l),this.container.scrollTop=Math.round(this.container.scrollTop*h+k))}}};mxGraph.prototype.zoomToRect=function(f){var e=this.container.clientWidth/f.width/(this.container.clientHeight/f.height);f.x=Math.max(0,f.x);f.y=Math.max(0,f.y);var h=Math.min(this.container.scrollWidth,f.x+f.width),g=Math.min(this.container.scrollHeight,f.y+f.height);f.width=h-f.x;f.height=g-f.y;1>e?(e=f.height/e,h=(e-f.height)/2,f.height=e,e=Math.min(f.y,h),f.y-=e,g=Math.min(this.container.scrollHeight,f.y+f.height),f.height=g-f.y):(e*=f.width,h=(e-f.width)/2,f.width=e,e=Math.min(f.x,h),f.x-=e,h=Math.min(this.container.scrollWidth,f.x+f.width),f.width=h-f.x);e=this.container.clientWidth/f.width;h=this.view.scale*e;mxUtils.hasScrollbars(this.container)?(this.view.setScale(h),this.container.scrollLeft=Math.round(f.x*e),this.container.scrollTop=Math.round(f.y*e)):this.view.scaleAndTranslate(h,this.view.translate.x-f.x/this.view.scale,this.view.translate.y-f.y/this.view.scale)};mxGraph.prototype.fit=function(s,r){if(null!=this.container){s=null!=s?s:0;r=null!=r?r:!1;var q=this.container.clientWidth,p=this.container.clientHeight,o=this.view.getGraphBounds();r&&(null!=o.x&&null!=o.y)&&(o.width+=o.x,o.height+=o.y,o.x=0,o.y=0);var n=this.view.scale,m=o.width/n,l=o.height/n;null!=this.backgroundImage&&(m=Math.max(m,this.backgroundImage.width-o.x/n),l=Math.max(l,this.backgroundImage.height-o.y/n));var i=r?s:2*s,q=Math.floor(100*Math.min(q/(m+i),p/(l+i)))/100;null!=this.minFitScale&&(q=Math.max(q,this.minFitScale));null!=this.maxFitScale&&(q=Math.min(q,this.maxFitScale));r?this.view.scale!=q&&this.view.setScale(q):mxUtils.hasScrollbars(this.container)?(this.view.setScale(q),null!=o.x&&(this.container.scrollLeft=Math.round(o.x/n)*q-s-Math.max(0,(this.container.clientWidth-m*q)/2)),null!=o.y&&(this.container.scrollTop=Math.round(o.y/n)*q-s-Math.max(0,(this.container.clientHeight-l*q)/2))):this.view.scaleAndTranslate(q,null!=o.x?Math.floor(this.view.translate.x-o.x/n+s+1):s,null!=o.y?Math.floor(this.view.translate.y-o.y/n+s+1):s)}return this.view.scale};mxGraph.prototype.scrollCellToVisible=function(g,f){var k=-this.view.translate.x,i=-this.view.translate.y,h=this.view.getState(g);null!=h&&(k=new mxRectangle(k+h.x,i+h.y,h.width,h.height),f&&null!=this.container&&(i=this.container.clientWidth,h=this.container.clientHeight,k.x=k.getCenterX()-i/2,k.width=i,k.y=k.getCenterY()-h/2,k.height=h),this.scrollRectToVisible(k)&&this.view.setTranslate(this.view.translate.x,this.view.translate.y))};mxGraph.prototype.scrollRectToVisible=function(s){var r=!1;if(null!=s){var q=this.container.offsetWidth,p=this.container.offsetHeight,o=Math.min(q,s.width),n=Math.min(p,s.height);if(mxUtils.hasScrollbars(this.container)){q=this.container;s.x+=this.view.translate.x;s.y+=this.view.translate.y;var m=q.scrollLeft-s.x,p=Math.max(m-q.scrollLeft,0);0<m?q.scrollLeft-=m+2:(m=s.x+o-q.scrollLeft-q.clientWidth,0<m&&(q.scrollLeft+=m+2));o=q.scrollTop-s.y;m=Math.max(0,o-q.scrollTop);0<o?q.scrollTop-=o+2:(o=s.y+n-q.scrollTop-q.clientHeight,0<o&&(q.scrollTop+=o+2));!this.useScrollbarsForPanning&&(0!=p||0!=m)&&this.view.setTranslate(p,m)}else{var m=-this.view.translate.x,l=-this.view.translate.y,i=this.view.scale;s.x+o>m+q&&(this.view.translate.x-=(s.x+o-q-m)/i,r=!0);s.y+n>l+p&&(this.view.translate.y-=(s.y+n-p-l)/i,r=!0);s.x<m&&(this.view.translate.x+=(m-s.x)/i,r=!0);s.y<l&&(this.view.translate.y+=(l-s.y)/i,r=!0);r&&(this.view.refresh(),null!=this.selectionCellsHandler&&this.selectionCellsHandler.refresh())}}return r};mxGraph.prototype.getCellGeometry=function(b){return this.model.getGeometry(b)};mxGraph.prototype.isCellVisible=function(b){return this.model.isVisible(b)};mxGraph.prototype.isCellCollapsed=function(b){return this.model.isCollapsed(b)};mxGraph.prototype.isCellConnectable=function(b){return this.model.isConnectable(b)};mxGraph.prototype.isOrthogonal=function(d){var c=d.style[mxConstants.STYLE_ORTHOGONAL];if(null!=c){return c}d=this.view.getEdgeStyle(d);return d==mxEdgeStyle.SegmentConnector||d==mxEdgeStyle.ElbowConnector||d==mxEdgeStyle.SideToSide||d==mxEdgeStyle.TopToBottom||d==mxEdgeStyle.EntityRelation||d==mxEdgeStyle.OrthConnector};mxGraph.prototype.isLoop=function(d){var c=d.getVisibleTerminalState(!0);d=d.getVisibleTerminalState(!1);return null!=c&&c==d};mxGraph.prototype.isCloneEvent=function(b){return mxEvent.isControlDown(b)};mxGraph.prototype.isToggleEvent=function(b){return mxClient.IS_MAC?mxEvent.isMetaDown(b):mxEvent.isControlDown(b)};mxGraph.prototype.isGridEnabledEvent=function(b){return null!=b&&!mxEvent.isAltDown(b)};mxGraph.prototype.isConstrainedEvent=function(b){return mxEvent.isShiftDown(b)};mxGraph.prototype.validationAlert=function(b){mxUtils.alert(b)};mxGraph.prototype.isEdgeValid=function(e,d,f){return null==this.getEdgeValidationError(e,d,f)};mxGraph.prototype.getEdgeValidationError=function(k,i,q){if(null!=k&&!this.isAllowDanglingEdges()&&(null==i||null==q)){return""}if(null!=k&&null==this.model.getTerminal(k,!0)&&null==this.model.getTerminal(k,!1)){return null}if(!this.allowLoops&&i==q&&null!=i||!this.isValidConnection(i,q)){return""}if(null!=i&&null!=q){var p="";if(!this.multigraph){var o=this.model.getEdgesBetween(i,q,!0);if(1<o.length||1==o.length&&o[0]!=k){p+=(mxResources.get(this.alreadyConnectedResource)||this.alreadyConnectedResource)+"\n"}}var o=this.model.getDirectedEdgeCount(i,!0,k),n=this.model.getDirectedEdgeCount(q,!1,k);if(null!=this.multiplicities){for(var m=0;m<this.multiplicities.length;m++){var l=this.multiplicities[m].check(this,k,i,q,o,n);null!=l&&(p+=l)}}l=this.validateEdge(k,i,q);null!=l&&(p+=l);return 0<p.length?p:null}return this.allowDanglingEdges?null:""};mxGraph.prototype.validateEdge=function(e,d,f){return null};mxGraph.prototype.validateGraph=function(i,h){i=null!=i?i:this.model.getRoot();h=null!=h?h:{};for(var o=!0,n=this.model.getChildCount(i),m=0;m<n;m++){var l=this.model.getChildAt(i,m),k=h;this.isValidRoot(l)&&(k={});k=this.validateGraph(l,k);null!=k?this.setCellWarning(l,k.replace(/\n/g,"<br>")):this.setCellWarning(l,null);o=o&&null==k}n="";this.isCellCollapsed(i)&&!o&&(n+=(mxResources.get(this.containsValidationErrorsResource)||this.containsValidationErrorsResource)+"\n");n=this.model.isEdge(i)?n+(this.getEdgeValidationError(i,this.model.getTerminal(i,!0),this.model.getTerminal(i,!1))||""):n+(this.getCellValidationError(i)||"");m=this.validateCell(i,h);null!=m&&(n+=m);null==this.model.getParent(i)&&this.view.validate();return 0<n.length||!o?n:null};mxGraph.prototype.getCellValidationError=function(h){var g=this.model.getDirectedEdgeCount(h,!0),m=this.model.getDirectedEdgeCount(h,!1);h=this.model.getValue(h);var l="";if(null!=this.multiplicities){for(var k=0;k<this.multiplicities.length;k++){var i=this.multiplicities[k];if(i.source&&mxUtils.isNode(h,i.type,i.attr,i.value)&&(0==i.max&&0<g||1==i.min&&0==g||1==i.max&&1<g)){l+=i.countError+"\n"}else{if(!i.source&&mxUtils.isNode(h,i.type,i.attr,i.value)&&(0==i.max&&0<m||1==i.min&&0==m||1==i.max&&1<m)){l+=i.countError+"\n"}}}}return 0<l.length?l:null};mxGraph.prototype.validateCell=function(d,c){return null};mxGraph.prototype.getBackgroundImage=function(){return this.backgroundImage};mxGraph.prototype.setBackgroundImage=function(b){this.backgroundImage=b};mxGraph.prototype.getFoldingImage=function(d){if(null!=d&&this.foldingEnabled&&!this.getModel().isEdge(d.cell)){var c=this.isCellCollapsed(d.cell);if(this.isCellFoldable(d.cell,!c)){return c?this.collapsedImage:this.expandedImage}}return null};mxGraph.prototype.convertValueToString=function(b){b=this.model.getValue(b);if(null!=b){if(mxUtils.isNode(b)){return b.nodeName}if("function"==typeof b.toString){return b.toString()}}return""};mxGraph.prototype.getLabel=function(e){var d="";if(this.labelsVisible&&null!=e){var f=this.view.getState(e),f=null!=f?f.style:this.getCellStyle(e);mxUtils.getValue(f,mxConstants.STYLE_NOLABEL,!1)||(d=this.convertValueToString(e))}return d};mxGraph.prototype.isHtmlLabel=function(b){return this.isHtmlLabels()};mxGraph.prototype.isHtmlLabels=function(){return this.htmlLabels};mxGraph.prototype.setHtmlLabels=function(b){this.htmlLabels=b};mxGraph.prototype.isWrapping=function(d){var c=this.view.getState(d);d=null!=c?c.style:this.getCellStyle(d);return null!=d?"wrap"==d[mxConstants.STYLE_WHITE_SPACE]:!1};mxGraph.prototype.isLabelClipped=function(d){var c=this.view.getState(d);d=null!=c?c.style:this.getCellStyle(d);return null!=d?"hidden"==d[mxConstants.STYLE_OVERFLOW]:!1};mxGraph.prototype.getTooltip=function(g,f,k,i){var h=null;if(null!=g){if(null!=g.control&&(f==g.control.node||f.parentNode==g.control.node)){h=this.collapseExpandResource,h=mxResources.get(h)||h}null==h&&null!=g.overlays&&g.overlays.visit(function(b,d){if(null==h&&(f==d.node||f.parentNode==d.node)){h=d.overlay.toString()}});null==h&&(k=this.selectionCellsHandler.getHandler(g.cell),null!=k&&"function"==typeof k.getTooltipForNode&&(h=k.getTooltipForNode(f)));null==h&&(h=this.getTooltipForCell(g.cell))}return h};mxGraph.prototype.getTooltipForCell=function(d){var c=null;return c=null!=d&&null!=d.getTooltip?d.getTooltip():this.convertValueToString(d)};mxGraph.prototype.getCursorForCell=function(b){return null};mxGraph.prototype.getStartSize=function(e){var d=new mxRectangle,f=this.view.getState(e);e=null!=f?f.style:this.getCellStyle(e);null!=e&&(f=parseInt(mxUtils.getValue(e,mxConstants.STYLE_STARTSIZE,mxConstants.DEFAULT_STARTSIZE)),mxUtils.getValue(e,mxConstants.STYLE_HORIZONTAL,!0)?d.height=f:d.width=f);return d};mxGraph.prototype.getImage=function(b){return null!=b&&null!=b.style?b.style[mxConstants.STYLE_IMAGE]:null};mxGraph.prototype.getVerticalAlign=function(b){return null!=b&&null!=b.style?b.style[mxConstants.STYLE_VERTICAL_ALIGN]||mxConstants.ALIGN_MIDDLE:null};mxGraph.prototype.getIndicatorColor=function(b){return null!=b&&null!=b.style?b.style[mxConstants.STYLE_INDICATOR_COLOR]:null};mxGraph.prototype.getIndicatorGradientColor=function(b){return null!=b&&null!=b.style?b.style[mxConstants.STYLE_INDICATOR_GRADIENTCOLOR]:null};mxGraph.prototype.getIndicatorShape=function(b){return null!=b&&null!=b.style?b.style[mxConstants.STYLE_INDICATOR_SHAPE]:null};mxGraph.prototype.getIndicatorImage=function(b){return null!=b&&null!=b.style?b.style[mxConstants.STYLE_INDICATOR_IMAGE]:null};mxGraph.prototype.getBorder=function(){return this.border};mxGraph.prototype.setBorder=function(b){this.border=b};mxGraph.prototype.isSwimlane=function(d){if(null!=d&&this.model.getParent(d)!=this.model.getRoot()){var c=this.view.getState(d),c=null!=c?c.style:this.getCellStyle(d);if(null!=c&&!this.model.isEdge(d)){return c[mxConstants.STYLE_SHAPE]==mxConstants.SHAPE_SWIMLANE}}return !1};mxGraph.prototype.isResizeContainer=function(){return this.resizeContainer};mxGraph.prototype.setResizeContainer=function(b){this.resizeContainer=b};mxGraph.prototype.isEnabled=function(){return this.enabled};mxGraph.prototype.setEnabled=function(b){this.enabled=b};mxGraph.prototype.isEscapeEnabled=function(){return this.escapeEnabled};mxGraph.prototype.setEscapeEnabled=function(b){this.escapeEnabled=b};mxGraph.prototype.isInvokesStopCellEditing=function(){return this.invokesStopCellEditing};mxGraph.prototype.setInvokesStopCellEditing=function(b){this.invokesStopCellEditing=b};mxGraph.prototype.isEnterStopsCellEditing=function(){return this.enterStopsCellEditing};mxGraph.prototype.setEnterStopsCellEditing=function(b){this.enterStopsCellEditing=b};mxGraph.prototype.isCellLocked=function(d){var c=this.model.getGeometry(d);return this.isCellsLocked()||null!=c&&this.model.isVertex(d)&&c.relative};mxGraph.prototype.isCellsLocked=function(){return this.cellsLocked};mxGraph.prototype.setCellsLocked=function(b){this.cellsLocked=b};mxGraph.prototype.getCloneableCells=function(b){return this.model.filterCells(b,mxUtils.bind(this,function(c){return this.isCellCloneable(c)}))};mxGraph.prototype.isCellCloneable=function(d){var c=this.view.getState(d);d=null!=c?c.style:this.getCellStyle(d);return this.isCellsCloneable()&&0!=d[mxConstants.STYLE_CLONEABLE]};mxGraph.prototype.isCellsCloneable=function(){return this.cellsCloneable};mxGraph.prototype.setCellsCloneable=function(b){this.cellsCloneable=b};mxGraph.prototype.getExportableCells=function(b){return this.model.filterCells(b,mxUtils.bind(this,function(c){return this.canExportCell(c)}))};mxGraph.prototype.canExportCell=function(b){return this.exportEnabled};mxGraph.prototype.getImportableCells=function(b){return this.model.filterCells(b,mxUtils.bind(this,function(c){return this.canImportCell(c)}))};mxGraph.prototype.canImportCell=function(b){return this.importEnabled};mxGraph.prototype.isCellSelectable=function(b){return this.isCellsSelectable()};mxGraph.prototype.isCellsSelectable=function(){return this.cellsSelectable};mxGraph.prototype.setCellsSelectable=function(b){this.cellsSelectable=b};mxGraph.prototype.getDeletableCells=function(b){return this.model.filterCells(b,mxUtils.bind(this,function(c){return this.isCellDeletable(c)}))};mxGraph.prototype.isCellDeletable=function(d){var c=this.view.getState(d);d=null!=c?c.style:this.getCellStyle(d);return this.isCellsDeletable()&&0!=d[mxConstants.STYLE_DELETABLE]};mxGraph.prototype.isCellsDeletable=function(){return this.cellsDeletable};mxGraph.prototype.setCellsDeletable=function(b){this.cellsDeletable=b};mxGraph.prototype.isLabelMovable=function(b){return !this.isCellLocked(b)&&(this.model.isEdge(b)&&this.edgeLabelsMovable||this.model.isVertex(b)&&this.vertexLabelsMovable)};mxGraph.prototype.isCellRotatable=function(d){var c=this.view.getState(d);return 0!=(null!=c?c.style:this.getCellStyle(d))[mxConstants.STYLE_ROTATABLE]};mxGraph.prototype.getMovableCells=function(b){return this.model.filterCells(b,mxUtils.bind(this,function(c){return this.isCellMovable(c)}))};mxGraph.prototype.isCellMovable=function(d){var c=this.view.getState(d),c=null!=c?c.style:this.getCellStyle(d);return this.isCellsMovable()&&!this.isCellLocked(d)&&0!=c[mxConstants.STYLE_MOVABLE]};mxGraph.prototype.isCellsMovable=function(){return this.cellsMovable};mxGraph.prototype.setCellsMovable=function(b){this.cellsMovable=b};mxGraph.prototype.isGridEnabled=function(){return this.gridEnabled};mxGraph.prototype.setGridEnabled=function(b){this.gridEnabled=b};mxGraph.prototype.isPortsEnabled=function(){return this.portsEnabled};mxGraph.prototype.setPortsEnabled=function(b){this.portsEnabled=b};mxGraph.prototype.getGridSize=function(){return this.gridSize};mxGraph.prototype.setGridSize=function(b){this.gridSize=b};mxGraph.prototype.getTolerance=function(){return this.tolerance};mxGraph.prototype.setTolerance=function(b){this.tolerance=b};mxGraph.prototype.isVertexLabelsMovable=function(){return this.vertexLabelsMovable};mxGraph.prototype.setVertexLabelsMovable=function(b){this.vertexLabelsMovable=b};mxGraph.prototype.isEdgeLabelsMovable=function(){return this.edgeLabelsMovable};mxGraph.prototype.setEdgeLabelsMovable=function(b){this.edgeLabelsMovable=b};mxGraph.prototype.isSwimlaneNesting=function(){return this.swimlaneNesting};mxGraph.prototype.setSwimlaneNesting=function(b){this.swimlaneNesting=b};mxGraph.prototype.isSwimlaneSelectionEnabled=function(){return this.swimlaneSelectionEnabled};mxGraph.prototype.setSwimlaneSelectionEnabled=function(b){this.swimlaneSelectionEnabled=b};mxGraph.prototype.isMultigraph=function(){return this.multigraph};mxGraph.prototype.setMultigraph=function(b){this.multigraph=b};mxGraph.prototype.isAllowLoops=function(){return this.allowLoops};mxGraph.prototype.setAllowDanglingEdges=function(b){this.allowDanglingEdges=b};mxGraph.prototype.isAllowDanglingEdges=function(){return this.allowDanglingEdges};mxGraph.prototype.setConnectableEdges=function(b){this.connectableEdges=b};mxGraph.prototype.isConnectableEdges=function(){return this.connectableEdges};mxGraph.prototype.setCloneInvalidEdges=function(b){this.cloneInvalidEdges=b};mxGraph.prototype.isCloneInvalidEdges=function(){return this.cloneInvalidEdges};mxGraph.prototype.setAllowLoops=function(b){this.allowLoops=b};mxGraph.prototype.isDisconnectOnMove=function(){return this.disconnectOnMove};mxGraph.prototype.setDisconnectOnMove=function(b){this.disconnectOnMove=b};mxGraph.prototype.isDropEnabled=function(){return this.dropEnabled};mxGraph.prototype.setDropEnabled=function(b){this.dropEnabled=b};mxGraph.prototype.isSplitEnabled=function(){return this.splitEnabled};mxGraph.prototype.setSplitEnabled=function(b){this.splitEnabled=b};mxGraph.prototype.isCellResizable=function(d){var c=this.view.getState(d),c=null!=c?c.style:this.getCellStyle(d);return this.isCellsResizable()&&!this.isCellLocked(d)&&0!=c[mxConstants.STYLE_RESIZABLE]};mxGraph.prototype.isCellsResizable=function(){return this.cellsResizable};mxGraph.prototype.setCellsResizable=function(b){this.cellsResizable=b};mxGraph.prototype.isTerminalPointMovable=function(d,c){return !0};mxGraph.prototype.isCellBendable=function(d){var c=this.view.getState(d),c=null!=c?c.style:this.getCellStyle(d);return this.isCellsBendable()&&!this.isCellLocked(d)&&0!=c[mxConstants.STYLE_BENDABLE]};mxGraph.prototype.isCellsBendable=function(){return this.cellsBendable};mxGraph.prototype.setCellsBendable=function(b){this.cellsBendable=b};mxGraph.prototype.isCellEditable=function(d){var c=this.view.getState(d),c=null!=c?c.style:this.getCellStyle(d);return this.isCellsEditable()&&!this.isCellLocked(d)&&0!=c[mxConstants.STYLE_EDITABLE]};mxGraph.prototype.isCellsEditable=function(){return this.cellsEditable};mxGraph.prototype.setCellsEditable=function(b){this.cellsEditable=b};mxGraph.prototype.isCellDisconnectable=function(e,d,f){return this.isCellsDisconnectable()&&!this.isCellLocked(e)};mxGraph.prototype.isCellsDisconnectable=function(){return this.cellsDisconnectable};mxGraph.prototype.setCellsDisconnectable=function(b){this.cellsDisconnectable=b};mxGraph.prototype.isValidSource=function(b){return null==b&&this.allowDanglingEdges||null!=b&&(!this.model.isEdge(b)||this.connectableEdges)&&this.isCellConnectable(b)};mxGraph.prototype.isValidTarget=function(b){return this.isValidSource(b)};mxGraph.prototype.isValidConnection=function(d,c){return this.isValidSource(d)&&this.isValidTarget(c)};mxGraph.prototype.setConnectable=function(b){this.connectionHandler.setEnabled(b)};mxGraph.prototype.isConnectable=function(b){return this.connectionHandler.isEnabled()};mxGraph.prototype.setTooltips=function(b){this.tooltipHandler.setEnabled(b)};mxGraph.prototype.setPanning=function(b){this.panningHandler.panningEnabled=b};mxGraph.prototype.isEditing=function(d){if(null!=this.cellEditor){var c=this.cellEditor.getEditingCell();return null==d?null!=c:d==c}return !1};mxGraph.prototype.isAutoSizeCell=function(d){var c=this.view.getState(d);d=null!=c?c.style:this.getCellStyle(d);return this.isAutoSizeCells()||1==d[mxConstants.STYLE_AUTOSIZE]};mxGraph.prototype.isAutoSizeCells=function(){return this.autoSizeCells};mxGraph.prototype.setAutoSizeCells=function(b){this.autoSizeCells=b};mxGraph.prototype.isExtendParent=function(b){return !this.getModel().isEdge(b)&&this.isExtendParents()};mxGraph.prototype.isExtendParents=function(){return this.extendParents};mxGraph.prototype.setExtendParents=function(b){this.extendParents=b};mxGraph.prototype.isExtendParentsOnAdd=function(){return this.extendParentsOnAdd};mxGraph.prototype.setExtendParentsOnAdd=function(b){this.extendParentsOnAdd=b};mxGraph.prototype.isExtendParentsOnMove=function(){return this.extendParentsOnMove};mxGraph.prototype.setExtendParentsOnMove=function(b){this.extendParentsOnMove=b};mxGraph.prototype.isRecursiveResize=function(){return this.recursiveResize};mxGraph.prototype.setRecursiveResize=function(b){this.recursiveResize=b};mxGraph.prototype.isConstrainChild=function(b){return this.isConstrainChildren()&&!this.getModel().isEdge(this.getModel().getParent(b))};mxGraph.prototype.isConstrainChildren=function(){return this.constrainChildren};mxGraph.prototype.setConstrainChildrenOnResize=function(b){this.constrainChildrenOnResize=b};mxGraph.prototype.isConstrainChildrenOnResize=function(){return this.constrainChildrenOnResize};mxGraph.prototype.setConstrainChildren=function(b){this.constrainChildren=b};mxGraph.prototype.isAllowNegativeCoordinates=function(){return this.allowNegativeCoordinates};mxGraph.prototype.setAllowNegativeCoordinates=function(b){this.allowNegativeCoordinates=b};mxGraph.prototype.getOverlap=function(b){return this.isAllowOverlapParent(b)?this.defaultOverlap:0};mxGraph.prototype.isAllowOverlapParent=function(b){return !1};mxGraph.prototype.getFoldableCells=function(d,c){return this.model.filterCells(d,mxUtils.bind(this,function(b){return this.isCellFoldable(b,c)}))};mxGraph.prototype.isCellFoldable=function(e,d){var f=this.view.getState(e),f=null!=f?f.style:this.getCellStyle(e);return 0<this.model.getChildCount(e)&&0!=f[mxConstants.STYLE_FOLDABLE]};mxGraph.prototype.isValidDropTarget=function(e,d,f){return null!=e&&(this.isSplitEnabled()&&this.isSplitTarget(e,d,f)||!this.model.isEdge(e)&&(this.isSwimlane(e)||0<this.model.getChildCount(e)&&!this.isCellCollapsed(e)))};mxGraph.prototype.isSplitTarget=function(e,d,f){return this.model.isEdge(e)&&null!=d&&1==d.length&&this.isCellConnectable(d[0])&&null==this.getEdgeValidationError(e,this.model.getTerminal(e,!0),d[0])?(f=this.model.getTerminal(e,!0),e=this.model.getTerminal(e,!1),!this.model.isAncestor(d[0],f)&&!this.model.isAncestor(d[0],e)):!1};mxGraph.prototype.getDropTarget=function(g,f,k){if(!this.isSwimlaneNesting()){for(var i=0;i<g.length;i++){if(this.isSwimlane(g[i])){return null}}}i=mxUtils.convertPoint(this.container,mxEvent.getClientX(f),mxEvent.getClientY(f));i.x-=this.panDx;i.y-=this.panDy;i=this.getSwimlaneAt(i.x,i.y);if(null==k){k=i}else{if(null!=i){for(var h=this.model.getParent(i);null!=h&&this.isSwimlane(h)&&h!=k;){h=this.model.getParent(h)}h==k&&(k=i)}}for(;null!=k&&!this.isValidDropTarget(k,g,f)&&!this.model.isLayer(k);){k=this.model.getParent(k)}return !this.model.isLayer(k)&&0>mxUtils.indexOf(g,k)?k:null};mxGraph.prototype.getDefaultParent=function(){var b=this.getCurrentRoot();null==b&&(b=this.defaultParent,null==b&&(b=this.model.getRoot(),b=this.model.getChildAt(b,0)));return b};mxGraph.prototype.setDefaultParent=function(b){this.defaultParent=b};mxGraph.prototype.getSwimlane=function(b){for(;null!=b&&!this.isSwimlane(b);){b=this.model.getParent(b)}return b};mxGraph.prototype.getSwimlaneAt=function(i,h,o){o=o||this.getDefaultParent();if(null!=o){for(var n=this.model.getChildCount(o),m=0;m<n;m++){var l=this.model.getChildAt(o,m),k=this.getSwimlaneAt(i,h,l);if(null!=k){return k}if(this.isSwimlane(l)&&(k=this.view.getState(l),this.intersects(k,i,h))){return l}}}return null};mxGraph.prototype.getCellAt=function(k,i,q,p,o){p=null!=p?p:!0;o=null!=o?o:!0;q=null!=q?q:this.getDefaultParent();if(null!=q){for(var n=this.model.getChildCount(q)-1;0<=n;n--){var m=this.model.getChildAt(q,n),l=this.getCellAt(k,i,m,p,o);if(null!=l){return l}if(this.isCellVisible(m)&&(o&&this.model.isEdge(m)||p&&this.model.isVertex(m))){if(l=this.view.getState(m),this.intersects(l,k,i)){return m}}}}return null};mxGraph.prototype.intersects=function(i,h,o){if(null!=i){var n=i.absolutePoints;if(null!=n){i=this.tolerance*this.tolerance;for(var m=n[0],l=1;l<n.length;l++){var k=n[l];if(mxUtils.ptSegDistSq(m.x,m.y,k.x,k.y,h,o)<=i){return !0}m=k}}else{if(m=mxUtils.toRadians(mxUtils.getValue(i.style,mxConstants.STYLE_ROTATION)||0),0!=m&&(n=Math.cos(-m),m=Math.sin(-m),l=new mxPoint(i.getCenterX(),i.getCenterY()),m=mxUtils.getRotatedPoint(new mxPoint(h,o),n,m,l),h=m.x,o=m.y),mxUtils.contains(i,h,o)){return !0}}}return !1};mxGraph.prototype.hitsSwimlaneContent=function(g,f,k){var i=this.getView().getState(g);g=this.getStartSize(g);if(null!=i){var h=this.getView().getScale();f-=i.x;k-=i.y;if(0<g.width&&0<f&&f>g.width*h||0<g.height&&0<k&&k>g.height*h){return !0}}return !1};mxGraph.prototype.getChildVertices=function(b){return this.getChildCells(b,!0,!1)};mxGraph.prototype.getChildEdges=function(b){return this.getChildCells(b,!1,!0)};mxGraph.prototype.getChildCells=function(e,d,f){e=null!=e?e:this.getDefaultParent();e=this.model.getChildCells(e,null!=d?d:!1,null!=f?f:!1);d=[];for(f=0;f<e.length;f++){this.isCellVisible(e[f])&&d.push(e[f])}return d};mxGraph.prototype.getConnections=function(d,c){return this.getEdges(d,c,!0,!0,!1)};mxGraph.prototype.getIncomingEdges=function(d,c){return this.getEdges(d,c,!0,!1,!1)};mxGraph.prototype.getOutgoingEdges=function(d,c){return this.getEdges(d,c,!1,!0,!1)};mxGraph.prototype.getEdges=function(w,v,u,t,s,r){u=null!=u?u:!0;t=null!=t?t:!0;s=null!=s?s:!0;r=null!=r?r:!1;for(var q=[],p=this.isCellCollapsed(w),o=this.model.getChildCount(w),n=0;n<o;n++){var i=this.model.getChildAt(w,n);if(p||!this.isCellVisible(i)){q=q.concat(this.model.getEdges(i,u,t))}}q=q.concat(this.model.getEdges(w,u,t));p=[];for(n=0;n<q.length;n++){i=this.view.getState(q[n]),o=null!=i?i.getVisibleTerminal(!0):this.view.getVisibleTerminal(q[n],!0),i=null!=i?i.getVisibleTerminal(!1):this.view.getVisibleTerminal(q[n],!1),(s&&o==i||o!=i&&(u&&i==w&&(null==v||this.isValidAncestor(o,v,r))||t&&o==w&&(null==v||this.isValidAncestor(i,v,r))))&&p.push(q[n])}return p};mxGraph.prototype.isValidAncestor=function(e,d,f){return f?this.model.isAncestor(d,e):this.model.getParent(e)==d};mxGraph.prototype.getOpposites=function(u,t,s,r){s=null!=s?s:!0;r=null!=r?r:!0;var q=[],p={};if(null!=u){for(var o=0;o<u.length;o++){var n=this.view.getState(u[o]),m=null!=n?n.getVisibleTerminal(!0):this.view.getVisibleTerminal(u[o],!0),n=null!=n?n.getVisibleTerminal(!1):this.view.getVisibleTerminal(u[o],!1);if(m==t&&null!=n&&n!=t&&r){var i=mxCellPath.create(n);null==p[i]&&(p[i]=n,q.push(n))}else{n==t&&(null!=m&&m!=t&&s)&&(i=mxCellPath.create(m),null==p[i]&&(p[i]=m,q.push(m)))}}}return q};mxGraph.prototype.getEdgesBetween=function(k,i,q){q=null!=q?q:!1;for(var p=this.getEdges(k),o=[],n=0;n<p.length;n++){var m=this.view.getState(p[n]),l=null!=m?m.getVisibleTerminal(!0):this.view.getVisibleTerminal(p[n],!0),m=null!=m?m.getVisibleTerminal(!1):this.view.getVisibleTerminal(p[n],!1);(l==k&&m==i||!q&&l==i&&m==k)&&o.push(p[n])}return o};mxGraph.prototype.getPointForEvent=function(h,g){var m=mxUtils.convertPoint(this.container,mxEvent.getClientX(h),mxEvent.getClientY(h)),l=this.view.scale,k=this.view.translate,i=!1!=g?this.gridSize/2:0;m.x=this.snap(m.x/l-k.x-i);m.y=this.snap(m.y/l-k.y-i);return m};mxGraph.prototype.getCells=function(A,z,y,x,w,v){v=null!=v?v:[];if(0<y||0<x){var u=A+y,t=z+x;w=w||this.getDefaultParent();if(null!=w){for(var s=this.model.getChildCount(w),r=0;r<s;r++){var q=this.model.getChildAt(w,r),o=this.view.getState(q);if(this.isCellVisible(q)&&null!=o){var i=o,o=mxUtils.getValue(o.style,mxConstants.STYLE_ROTATION)||0;0!=o&&(i=mxUtils.getBoundingBox(i,o));i.x>=A&&i.y+i.height<=t&&i.y>=z&&i.x+i.width<=u?v.push(q):this.getCells(A,z,y,x,q,v)}}}}return v};mxGraph.prototype.getCellsBeyond=function(u,t,s,r,q){var p=[];if(r||q){if(null==s&&(s=this.getDefaultParent()),null!=s){for(var o=this.model.getChildCount(s),n=0;n<o;n++){var m=this.model.getChildAt(s,n),i=this.view.getState(m);this.isCellVisible(m)&&null!=i&&(!r||i.x>=u)&&(!q||i.y>=t)&&p.push(m)}}}return p};mxGraph.prototype.findTreeRoots=function(C,B,A){B=null!=B?B:!1;A=null!=A?A:!1;var z=[];if(null!=C){for(var y=this.getModel(),x=y.getChildCount(C),w=null,v=0,u=0;u<x;u++){var t=y.getChildAt(C,u);if(this.model.isVertex(t)&&this.isCellVisible(t)){for(var s=this.getConnections(t,B?C:null),r=0,o=0,i=0;i<s.length;i++){this.view.getVisibleTerminal(s[i],!0)==t?r++:o++}(A&&0==r&&0<o||!A&&0==o&&0<r)&&z.push(t);s=A?o-r:r-o;s>v&&(v=s,w=t)}}0==z.length&&null!=w&&z.push(w)}return z};mxGraph.prototype.traverse=function(k,i,q,p,o){if(null!=q&&null!=k){i=null!=i?i:!0;o=o||[];var n=mxCellPath.create(k);if(null==o[n]&&(o[n]=k,p=q(k,p),null==p||p)){if(p=this.model.getEdgeCount(k),0<p){for(n=0;n<p;n++){var m=this.model.getEdgeAt(k,n),l=this.model.getTerminal(m,!0)==k;if(!i||l){l=this.model.getTerminal(m,!l),this.traverse(l,i,q,m,o)}}}}}};mxGraph.prototype.isCellSelected=function(b){return this.getSelectionModel().isSelected(b)};mxGraph.prototype.isSelectionEmpty=function(){return this.getSelectionModel().isEmpty()};mxGraph.prototype.clearSelection=function(){return this.getSelectionModel().clear()};mxGraph.prototype.getSelectionCount=function(){return this.getSelectionModel().cells.length};mxGraph.prototype.getSelectionCell=function(){return this.getSelectionModel().cells[0]};mxGraph.prototype.getSelectionCells=function(){return this.getSelectionModel().cells.slice()};mxGraph.prototype.setSelectionCell=function(b){this.getSelectionModel().setCell(b)};mxGraph.prototype.setSelectionCells=function(b){this.getSelectionModel().setCells(b)};mxGraph.prototype.addSelectionCell=function(b){this.getSelectionModel().addCell(b)};mxGraph.prototype.addSelectionCells=function(b){this.getSelectionModel().addCells(b)};mxGraph.prototype.removeSelectionCell=function(b){this.getSelectionModel().removeCell(b)};mxGraph.prototype.removeSelectionCells=function(b){this.getSelectionModel().removeCells(b)};mxGraph.prototype.selectRegion=function(e,d){var f=this.getCells(e.x,e.y,e.width,e.height);this.selectCellsForEvent(f,d);return f};mxGraph.prototype.selectNextCell=function(){this.selectCell(!0)};mxGraph.prototype.selectPreviousCell=function(){this.selectCell()};mxGraph.prototype.selectParentCell=function(){this.selectCell(!1,!0)};mxGraph.prototype.selectChildCell=function(){this.selectCell(!1,!1,!0)};mxGraph.prototype.selectCell=function(h,g,m){var l=this.selectionModel,k=0<l.cells.length?l.cells[0]:null;1<l.cells.length&&l.clear();var l=null!=k?this.model.getParent(k):this.getDefaultParent(),i=this.model.getChildCount(l);null==k&&0<i?(h=this.model.getChildAt(l,0),this.setSelectionCell(h)):(null==k||g)&&null!=this.view.getState(l)&&null!=this.model.getGeometry(l)?this.getCurrentRoot()!=l&&this.setSelectionCell(l):null!=k&&m?0<this.model.getChildCount(k)&&(h=this.model.getChildAt(k,0),this.setSelectionCell(h)):0<i&&(g=l.getIndex(k),h?(g++,h=this.model.getChildAt(l,g%i)):(g--,h=this.model.getChildAt(l,0>g?i-1:g)),this.setSelectionCell(h))};mxGraph.prototype.selectAll=function(b){b=b||this.getDefaultParent();b=this.model.getChildren(b);null!=b&&this.setSelectionCells(b)};mxGraph.prototype.selectVertices=function(b){this.selectCells(!0,!1,b)};mxGraph.prototype.selectEdges=function(b){this.selectCells(!1,!0,b)};mxGraph.prototype.selectCells=function(f,e,h){h=h||this.getDefaultParent();var g=mxUtils.bind(this,function(a){return null!=this.view.getState(a)&&0==this.model.getChildCount(a)&&(this.model.isVertex(a)&&f||this.model.isEdge(a)&&e)});h=this.model.filterDescendants(g,h);this.setSelectionCells(h)};mxGraph.prototype.selectCellForEvent=function(e,d){var f=this.isCellSelected(e);this.isToggleEvent(d)?f?this.removeSelectionCell(e):this.addSelectionCell(e):(!f||1!=this.getSelectionCount())&&this.setSelectionCell(e)};mxGraph.prototype.selectCellsForEvent=function(d,c){this.isToggleEvent(c)?this.addSelectionCells(d):this.setSelectionCells(d)};mxGraph.prototype.createHandler=function(d){var c=null;null!=d&&(this.model.isEdge(d.cell)?(c=this.view.getEdgeStyle(d),c=this.isLoop(d)||c==mxEdgeStyle.ElbowConnector||c==mxEdgeStyle.SideToSide||c==mxEdgeStyle.TopToBottom?new mxElbowEdgeHandler(d):c==mxEdgeStyle.SegmentConnector||c==mxEdgeStyle.OrthConnector?new mxEdgeSegmentHandler(d):new mxEdgeHandler(d)):c=new mxVertexHandler(d));return c};mxGraph.prototype.addMouseListener=function(b){null==this.mouseListeners&&(this.mouseListeners=[]);this.mouseListeners.push(b)};mxGraph.prototype.removeMouseListener=function(d){if(null!=this.mouseListeners){for(var c=0;c<this.mouseListeners.length;c++){if(this.mouseListeners[c]==d){this.mouseListeners.splice(c,1);break}}}};mxGraph.prototype.updateMouseEvent=function(d){if(null==d.graphX||null==d.graphY){var c=mxUtils.convertPoint(this.container,d.getX(),d.getY());d.graphX=c.x-this.panDx;d.graphY=c.y-this.panDy}return d};mxGraph.prototype.getStateForTouchEvent=function(d){var c=mxEvent.getClientX(d);d=mxEvent.getClientY(d);c=mxUtils.convertPoint(this.container,c,d);return this.view.getState(this.getCellAt(c.x,c.y))};mxGraph.prototype.isEventIgnored=function(g,f,k){var i=mxEvent.isMouseEvent(f.getEvent()),h=this.isEditing();f.getEvent()==this.lastEvent?h=!0:this.lastEvent=f.getEvent();null!=this.eventSource&&g!=mxEvent.MOUSE_MOVE?(mxEvent.removeGestureListeners(this.eventSource,null,this.mouseMoveRedirect,this.mouseUpRedirect),this.eventSource=this.mouseUpRedirect=this.mouseMoveRedirect=null):null!=this.eventSource&&f.getSource()!=this.eventSource?h=!0:mxClient.IS_TOUCH&&(g==mxEvent.MOUSE_DOWN&&!i)&&(this.eventSource=f.getSource(),this.mouseMoveRedirect=mxUtils.bind(this,function(b){this.fireMouseEvent(mxEvent.MOUSE_MOVE,new mxMouseEvent(b,this.getStateForTouchEvent(b)))}),this.mouseUpRedirect=mxUtils.bind(this,function(b){this.fireMouseEvent(mxEvent.MOUSE_UP,new mxMouseEvent(b,this.getStateForTouchEvent(b)))}),mxEvent.addGestureListeners(this.eventSource,null,this.mouseMoveRedirect,this.mouseUpRedirect));this.isSyntheticEventIgnored(g,f,k)&&(h=!0);if(!mxEvent.isPopupTrigger(this.lastEvent)&&g!=mxEvent.MOUSE_MOVE&&2==this.lastEvent.detail){return !0}if(g==mxEvent.MOUSE_UP&&this.isMouseDown){this.isMouseDown=!1}else{if(g==mxEvent.MOUSE_DOWN&&!this.isMouseDown){this.isMouseDown=!0,this.isMouseTrigger=i}else{if(!h&&((!mxClient.IS_FF||g!=mxEvent.MOUSE_MOVE)&&this.isMouseDown&&this.isMouseTrigger!=i||g==mxEvent.MOUSE_DOWN&&this.isMouseDown||g==mxEvent.MOUSE_UP&&!this.isMouseDown)){h=!0}}}!h&&g==mxEvent.MOUSE_DOWN&&(this.lastMouseX=f.getX(),this.lastMouseY=f.getY());return h};mxGraph.prototype.isSyntheticEventIgnored=function(e,d,f){f=!1;d=mxEvent.isMouseEvent(d.getEvent());this.ignoreMouseEvents&&d&&e!=mxEvent.MOUSE_MOVE?(this.ignoreMouseEvents=e!=mxEvent.MOUSE_UP,f=!0):mxClient.IS_FF&&(!d&&e==mxEvent.MOUSE_UP)&&(this.ignoreMouseEvents=!0);return f};mxGraph.prototype.isEventSourceIgnored=function(e,d){var f=d.getSource().nodeName.toLowerCase();return"select"==f||"option"==f||"button"==f||"a"==f||"input"==f};mxGraph.prototype.fireMouseEvent=function(g,f,k){if(this.isEventSourceIgnored(g,f)){null!=this.tooltipHandler&&this.tooltipHandler.hide()}else{null==k&&(k=this);f=this.updateMouseEvent(f);g==mxEvent.MOUSE_DOWN&&(this.isEditing()&&!this.cellEditor.isEventSource(f.getEvent()))&&this.stopEditing(!this.isInvokesStopCellEditing());if(!this.nativeDblClickEnabled&&!mxEvent.isPopupTrigger(f.getEvent())||this.doubleTapEnabled&&mxClient.IS_TOUCH&&mxEvent.isTouchEvent(f.getEvent())){var i=(new Date).getTime();if(this.isEnabled()){if(!mxClient.IS_QUIRKS&&g==mxEvent.MOUSE_DOWN||mxClient.IS_QUIRKS&&g==mxEvent.MOUSE_UP&&!this.fireDoubleClick){if(null!=this.lastTouchEvent&&this.lastTouchEvent!=f.getEvent()&&i-this.lastTouchTime<this.doubleTapTimeout&&Math.abs(this.lastTouchX-f.getX())<this.doubleTapTolerance&&Math.abs(this.lastTouchY-f.getY())<this.doubleTapTolerance&&2>this.doubleClickCounter){this.doubleClickCounter++;g==mxEvent.MOUSE_UP?f.getCell()==this.lastTouchCell&&null!=this.lastTouchCell&&(this.lastTouchTime=0,g=this.lastTouchCell,this.lastTouchCell=null,this.dblClick(f.getEvent(),g)):(this.fireDoubleClick=!0,this.lastTouchTime=0);mxEvent.consume(f.getEvent());return}if(null==this.lastTouchEvent||this.lastTouchEvent!=f.getEvent()){this.lastTouchCell=f.getCell(),this.lastTouchX=f.getX(),this.lastTouchY=f.getY(),this.lastTouchTime=i,this.lastTouchEvent=f.getEvent(),this.doubleClickCounter=0}}else{if((this.isMouseDown||g==mxEvent.MOUSE_UP)&&this.fireDoubleClick){this.fireDoubleClick=!1;g=this.lastTouchCell;this.lastTouchCell=null;(null!=g||mxEvent.isTouchEvent(f.getEvent())&&(mxClient.IS_GC||mxClient.IS_SF))&&Math.abs(this.lastTouchX-f.getX())<this.doubleTapTolerance&&Math.abs(this.lastTouchY-f.getY())<this.doubleTapTolerance?this.dblClick(f.getEvent(),g):mxEvent.consume(f.getEvent());return}}}}if(!this.isEventIgnored(g,f,k)){this.fireEvent(new mxEventObject(mxEvent.FIRE_MOUSE_EVENT,"eventName",g,"event",f));if(mxClient.IS_OP||mxClient.IS_SF||mxClient.IS_GC||mxClient.IS_IE&&mxClient.IS_SVG||f.getEvent().target!=this.container){g==mxEvent.MOUSE_MOVE&&(this.isMouseDown&&this.autoScroll)&&this.scrollPointToVisible(f.getGraphX(),f.getGraphY(),this.autoExtend);if(null!=this.mouseListeners){k=[k,f];f.getEvent().returnValue=!0;for(i=0;i<this.mouseListeners.length;i++){var h=this.mouseListeners[i];g==mxEvent.MOUSE_DOWN?h.mouseDown.apply(h,k):g==mxEvent.MOUSE_MOVE?h.mouseMove.apply(h,k):g==mxEvent.MOUSE_UP&&h.mouseUp.apply(h,k)}}g==mxEvent.MOUSE_UP&&this.click(f)}mxEvent.isTouchEvent(f.getEvent())&&g==mxEvent.MOUSE_DOWN&&this.tapAndHoldEnabled&&!this.tapAndHoldInProgress?(this.tapAndHoldInProgress=!0,this.initialTouchX=f.getGraphX(),this.initialTouchY=f.getGraphY(),this.tapAndHoldThread&&window.clearTimeout(this.tapAndHoldThread),this.tapAndHoldThread=window.setTimeout(mxUtils.bind(this,function(){this.tapAndHoldValid&&this.tapAndHold(f);this.tapAndHoldValid=this.tapAndHoldInProgress=!1}),this.tapAndHoldDelay),this.tapAndHoldValid=!0):g==mxEvent.MOUSE_UP?this.tapAndHoldValid=this.tapAndHoldInProgress=!1:this.tapAndHoldValid&&(this.tapAndHoldValid=Math.abs(this.initialTouchX-f.getGraphX())<this.tolerance&&Math.abs(this.initialTouchY-f.getGraphY())<this.tolerance);g==mxEvent.MOUSE_DOWN&&mxEvent.isTouchEvent(f.getEvent())&&f.consume(!1)}}};mxGraph.prototype.fireGestureEvent=function(d,c){this.lastTouchTime=0;this.fireEvent(new mxEventObject(mxEvent.GESTURE,"event",d,"cell",c))};mxGraph.prototype.destroy=function(){this.destroyed||(this.destroyed=!0,null!=this.tooltipHandler&&this.tooltipHandler.destroy(),null!=this.selectionCellsHandler&&this.selectionCellsHandler.destroy(),null!=this.panningHandler&&this.panningHandler.destroy(),null!=this.popupMenuHandler&&this.popupMenuHandler.destroy(),null!=this.connectionHandler&&this.connectionHandler.destroy(),null!=this.graphHandler&&this.graphHandler.destroy(),null!=this.cellEditor&&this.cellEditor.destroy(),null!=this.view&&this.view.destroy(),null!=this.model&&null!=this.graphModelChangeListener&&(this.model.removeListener(this.graphModelChangeListener),this.graphModelChangeListener=null),this.container=null)};function mxCellOverlay(h,g,m,l,k,i){this.image=h;this.tooltip=g;this.align=null!=m?m:this.align;this.verticalAlign=null!=l?l:this.verticalAlign;this.offset=null!=k?k:new mxPoint;this.cursor=null!=i?i:"help"}mxCellOverlay.prototype=new mxEventSource;mxCellOverlay.prototype.constructor=mxCellOverlay;mxCellOverlay.prototype.image=null;mxCellOverlay.prototype.tooltip=null;mxCellOverlay.prototype.align=mxConstants.ALIGN_RIGHT;mxCellOverlay.prototype.verticalAlign=mxConstants.ALIGN_BOTTOM;mxCellOverlay.prototype.offset=null;mxCellOverlay.prototype.cursor=null;mxCellOverlay.prototype.defaultOverlap=0.5;mxCellOverlay.prototype.getBounds=function(h){var g=h.view.graph.getModel().isEdge(h.cell),m=h.view.scale,l=null,k=this.image.width,i=this.image.height;g?(g=h.absolutePoints,1==g.length%2?l=g[Math.floor(g.length/2)]:(l=g.length/2,h=g[l-1],g=g[l],l=new mxPoint(h.x+(g.x-h.x)/2,h.y+(g.y-h.y)/2))):(l=new mxPoint,l.x=this.align==mxConstants.ALIGN_LEFT?h.x:this.align==mxConstants.ALIGN_CENTER?h.x+h.width/2:h.x+h.width,l.y=this.verticalAlign==mxConstants.ALIGN_TOP?h.y:this.verticalAlign==mxConstants.ALIGN_MIDDLE?h.y+h.height/2:h.y+h.height);return new mxRectangle(Math.round(l.x-(k*this.defaultOverlap-this.offset.x)*m),Math.round(l.y-(i*this.defaultOverlap-this.offset.y)*m),k*m,i*m)};mxCellOverlay.prototype.toString=function(){return this.tooltip};function mxOutline(d,c){this.source=d;null!=c&&this.init(c)}mxOutline.prototype.source=null;mxOutline.prototype.outline=null;mxOutline.prototype.graphRenderHint=mxConstants.RENDERING_HINT_FASTER;mxOutline.prototype.enabled=!0;mxOutline.prototype.showViewport=!0;mxOutline.prototype.border=10;mxOutline.prototype.sizerSize=8;mxOutline.prototype.labelsVisible=!1;mxOutline.prototype.updateOnPan=!1;mxOutline.prototype.sizerImage=null;mxOutline.prototype.suspended=!1;mxOutline.prototype.forceVmlHandles=8==document.documentMode;mxOutline.prototype.init=function(d){this.outline=new mxGraph(d,this.source.getModel(),this.graphRenderHint,this.source.getStylesheet());this.outline.foldingEnabled=!1;this.outline.autoScroll=!1;var c=this.outline.graphModelChanged;this.outline.graphModelChanged=mxUtils.bind(this,function(b){!this.suspended&&null!=this.outline&&c.apply(this.outline,arguments)});mxClient.IS_SVG&&(d=this.outline.getView().getCanvas().parentNode,d.setAttribute("shape-rendering","optimizeSpeed"),d.setAttribute("image-rendering","optimizeSpeed"));this.outline.labelsVisible=this.labelsVisible;this.outline.setEnabled(!1);this.updateHandler=mxUtils.bind(this,function(f,e){!this.suspended&&!this.active&&this.update()});this.source.getModel().addListener(mxEvent.CHANGE,this.updateHandler);this.outline.addMouseListener(this);d=this.source.getView();d.addListener(mxEvent.SCALE,this.updateHandler);d.addListener(mxEvent.TRANSLATE,this.updateHandler);d.addListener(mxEvent.SCALE_AND_TRANSLATE,this.updateHandler);d.addListener(mxEvent.DOWN,this.updateHandler);d.addListener(mxEvent.UP,this.updateHandler);mxEvent.addListener(this.source.container,"scroll",this.updateHandler);this.panHandler=mxUtils.bind(this,function(b){this.updateOnPan&&this.updateHandler.apply(this,arguments)});this.source.addListener(mxEvent.PAN,this.panHandler);this.refreshHandler=mxUtils.bind(this,function(b){this.outline.setStylesheet(this.source.getStylesheet());this.outline.refresh()});this.source.addListener(mxEvent.REFRESH,this.refreshHandler);this.bounds=new mxRectangle(0,0,0,0);this.selectionBorder=new mxRectangleShape(this.bounds,null,mxConstants.OUTLINE_COLOR,mxConstants.OUTLINE_STROKEWIDTH);this.selectionBorder.dialect=this.outline.dialect;this.forceVmlHandles&&(this.selectionBorder.isHtmlAllowed=function(){return !1});this.selectionBorder.init(this.outline.getView().getOverlayPane());d=mxUtils.bind(this,function(h){var g=mxEvent.getSource(h),k=mxUtils.bind(this,function(b){this.outline.fireMouseEvent(mxEvent.MOUSE_MOVE,new mxMouseEvent(b))}),i=mxUtils.bind(this,function(b){mxEvent.removeGestureListeners(g,null,k,i);this.outline.fireMouseEvent(mxEvent.MOUSE_UP,new mxMouseEvent(b))});mxEvent.addGestureListeners(g,null,k,i);this.outline.fireMouseEvent(mxEvent.MOUSE_DOWN,new mxMouseEvent(h))});mxEvent.addGestureListeners(this.selectionBorder.node,d);this.sizer=this.createSizer();this.forceVmlHandles&&(this.sizer.isHtmlAllowed=function(){return !1});this.sizer.init(this.outline.getView().getOverlayPane());this.enabled&&(this.sizer.node.style.cursor="pointer");mxEvent.addGestureListeners(this.sizer.node,d);this.selectionBorder.node.style.display=this.showViewport?"":"none";this.sizer.node.style.display=this.selectionBorder.node.style.display;this.selectionBorder.node.style.cursor="move";this.update(!1)};mxOutline.prototype.isEnabled=function(){return this.enabled};mxOutline.prototype.setEnabled=function(b){this.enabled=b};mxOutline.prototype.setZoomEnabled=function(b){this.sizer.node.style.visibility=b?"visible":"hidden"};mxOutline.prototype.refresh=function(){this.update(!0)};mxOutline.prototype.createSizer=function(){var b=null!=this.sizerImage?new mxImageShape(new mxRectangle(0,0,this.sizerImage.width,this.sizerImage.height),this.sizerImage.src):new mxRectangleShape(new mxRectangle(0,0,this.sizerSize,this.sizerSize),mxConstants.OUTLINE_HANDLE_FILLCOLOR,mxConstants.OUTLINE_HANDLE_STROKECOLOR);b.dialect=this.outline.dialect;return b};mxOutline.prototype.getSourceContainerSize=function(){return new mxRectangle(0,0,this.source.container.scrollWidth,this.source.container.scrollHeight)};mxOutline.prototype.getOutlineOffset=function(b){return null};mxOutline.prototype.update=function(k){if(null!=this.source){var i=this.source.view.scale,q=this.source.getGraphBounds(),q=new mxRectangle(q.x/i+this.source.panDx,q.y/i+this.source.panDy,q.width/i,q.height/i),p=new mxRectangle(0,0,this.source.container.clientWidth/i,this.source.container.clientHeight/i),o=q.clone();o.add(p);var n=this.getSourceContainerSize(),p=Math.max(n.width/i,o.width),i=Math.max(n.height/i,o.height),o=Math.max(0,this.outline.container.clientWidth-this.border),n=Math.max(0,this.outline.container.clientHeight-this.border),o=Math.min(o/p,n/i);if(0<o){this.outline.getView().scale!=o&&(this.outline.getView().scale=o,k=!0);p=this.outline.getView();p.currentRoot!=this.source.getView().currentRoot&&p.setCurrentRoot(this.source.getView().currentRoot);var i=this.source.view.translate,n=i.x+this.source.panDx,m=i.y+this.source.panDy,o=this.getOutlineOffset(o);null!=o&&(n+=o.x,m+=o.y);0>q.x&&(n-=q.x);0>q.y&&(m-=q.y);if(p.translate.x!=n||p.translate.y!=m){p.translate.x=n,p.translate.y=m,k=!0}var q=p.translate,o=this.source.getView().scale,n=o/p.scale,m=1/p.scale,l=this.source.container;this.bounds=new mxRectangle((q.x-i.x-this.source.panDx)/m,(q.y-i.y-this.source.panDy)/m,l.clientWidth/n,l.clientHeight/n);this.bounds.x+=this.source.container.scrollLeft*p.scale/o;this.bounds.y+=this.source.container.scrollTop*p.scale/o;q=this.selectionBorder.bounds;if(q.x!=this.bounds.x||q.y!=this.bounds.y||q.width!=this.bounds.width||q.height!=this.bounds.height){this.selectionBorder.bounds=this.bounds,this.selectionBorder.redraw()}q=this.sizer.bounds;p=new mxRectangle(this.bounds.x+this.bounds.width-q.width/2,this.bounds.y+this.bounds.height-q.height/2,q.width,q.height);if(q.x!=p.x||q.y!=p.y||q.width!=p.width||q.height!=p.height){this.sizer.bounds=p,"hidden"!=this.sizer.node.style.visibility&&this.sizer.redraw()}k&&this.outline.view.revalidate()}}};mxOutline.prototype.mouseDown=function(e,d){if(this.enabled&&this.showViewport){var f=!mxEvent.isMouseEvent(d.getEvent())?this.source.tolerance:0,f=this.source.allowHandleBoundsCheck&&(mxClient.IS_IE||0<f)?new mxRectangle(d.getGraphX()-f,d.getGraphY()-f,2*f,2*f):null;this.zoom=d.isSource(this.sizer)||null!=f&&mxUtils.intersects(shape.bounds,f);this.startX=d.getX();this.startY=d.getY();this.active=!0;this.source.useScrollbarsForPanning&&mxUtils.hasScrollbars(this.source.container)?(this.dx0=this.source.container.scrollLeft,this.dy0=this.source.container.scrollTop):this.dy0=this.dx0=0}d.consume()};mxOutline.prototype.mouseMove=function(h,g){if(this.active){this.selectionBorder.node.style.display=this.showViewport?"":"none";this.sizer.node.style.display=this.selectionBorder.node.style.display;var m=this.getTranslateForEvent(g),l=m.x,k=m.y,m=null;if(this.zoom){m=this.source.container,k=l/(m.clientWidth/m.clientHeight),m=new mxRectangle(this.bounds.x,this.bounds.y,Math.max(1,this.bounds.width+l),Math.max(1,this.bounds.height+k)),this.selectionBorder.bounds=m,this.selectionBorder.redraw()}else{var i=this.outline.getView().scale,m=new mxRectangle(this.bounds.x+l,this.bounds.y+k,this.bounds.width,this.bounds.height);this.selectionBorder.bounds=m;this.selectionBorder.redraw();l=l/i*this.source.getView().scale;k=k/i*this.source.getView().scale;this.source.panGraph(-l-this.dx0,-k-this.dy0)}l=this.sizer.bounds;this.sizer.bounds=new mxRectangle(m.x+m.width-l.width/2,m.y+m.height-l.height/2,l.width,l.height);"hidden"!=this.sizer.node.style.visibility&&this.sizer.redraw();g.consume()}};mxOutline.prototype.getTranslateForEvent=function(b){return new mxPoint(b.getX()-this.startX,b.getY()-this.startY)};mxOutline.prototype.mouseUp=function(g,f){if(this.active){var k=this.getTranslateForEvent(f),i=k.x,k=k.y;if(0<Math.abs(i)||0<Math.abs(k)){if(this.zoom){var k=this.selectionBorder.bounds.width,h=this.source.getView().scale;this.source.zoomTo(h-i*h/k,!1)}else{if(!this.source.useScrollbarsForPanning||!mxUtils.hasScrollbars(this.source.container)){this.source.panGraph(0,0),i/=this.outline.getView().scale,k/=this.outline.getView().scale,h=this.source.getView().translate,this.source.getView().setTranslate(h.x-i,h.y-k)}}this.update();f.consume()}this.index=null;this.active=!1}};mxOutline.prototype.destroy=function(){null!=this.source&&(this.source.removeListener(this.panHandler),this.source.removeListener(this.refreshHandler),this.source.getModel().removeListener(this.updateHandler),this.source.getView().removeListener(this.updateHandler),mxEvent.addListener(this.source.container,"scroll",this.updateHandler),this.source=null);null!=this.outline&&(this.outline.removeMouseListener(this),this.outline.destroy(),this.outline=null);null!=this.selectionBorder&&(this.selectionBorder.destroy(),this.selectionBorder=null);null!=this.sizer&&(this.sizer.destroy(),this.sizer=null)};function mxMultiplicity(u,t,s,r,q,p,o,n,m,i){this.source=u;this.type=t;this.attr=s;this.value=r;this.min=null!=q?q:0;this.max=null!=p?p:"n";this.validNeighbors=o;this.countError=mxResources.get(n)||n;this.typeError=mxResources.get(m)||m;this.validNeighborsAllowed=null!=i?i:!0}mxMultiplicity.prototype.type=null;mxMultiplicity.prototype.attr=null;mxMultiplicity.prototype.value=null;mxMultiplicity.prototype.source=null;mxMultiplicity.prototype.min=null;mxMultiplicity.prototype.max=null;mxMultiplicity.prototype.validNeighbors=null;mxMultiplicity.prototype.validNeighborsAllowed=!0;mxMultiplicity.prototype.countError=null;mxMultiplicity.prototype.typeError=null;mxMultiplicity.prototype.check=function(i,h,o,n,m,l){var k="";if(this.source&&this.checkTerminal(i,o,h)||!this.source&&this.checkTerminal(i,n,h)){if(null!=this.countError&&(this.source&&(0==this.max||m>=this.max)||!this.source&&(0==this.max||l>=this.max))){k+=this.countError+"\n"}null!=this.validNeighbors&&(null!=this.typeError&&0<this.validNeighbors.length)&&(this.checkNeighbors(i,h,o,n)||(k+=this.typeError+"\n"))}return 0<k.length?k:null};mxMultiplicity.prototype.checkNeighbors=function(h,g,m,l){g=h.model.getValue(m);l=h.model.getValue(l);m=!this.validNeighborsAllowed;for(var k=this.validNeighbors,i=0;i<k.length;i++){if(this.source&&this.checkType(h,l,k[i])){m=this.validNeighborsAllowed;break}else{if(!this.source&&this.checkType(h,g,k[i])){m=this.validNeighborsAllowed;break}}}return m};mxMultiplicity.prototype.checkTerminal=function(e,d,f){d=e.model.getValue(d);return this.checkType(e,d,this.type,this.attr,this.value)};mxMultiplicity.prototype.checkType=function(g,f,k,i,h){return null!=f?isNaN(f.nodeType)?f==k:mxUtils.isNode(f,k,i,h):!1};function mxLayoutManager(b){this.undoHandler=mxUtils.bind(this,function(d,e){this.isEnabled()&&this.beforeUndo(e.getProperty("edit"))});this.moveHandler=mxUtils.bind(this,function(d,e){this.isEnabled()&&this.cellsMoved(e.getProperty("cells"),e.getProperty("event"))});this.setGraph(b)}mxLayoutManager.prototype=new mxEventSource;mxLayoutManager.prototype.constructor=mxLayoutManager;mxLayoutManager.prototype.graph=null;mxLayoutManager.prototype.bubbling=!0;mxLayoutManager.prototype.enabled=!0;mxLayoutManager.prototype.updateHandler=null;mxLayoutManager.prototype.moveHandler=null;mxLayoutManager.prototype.isEnabled=function(){return this.enabled};mxLayoutManager.prototype.setEnabled=function(b){this.enabled=b};mxLayoutManager.prototype.isBubbling=function(){return this.bubbling};mxLayoutManager.prototype.setBubbling=function(b){this.bubbling=b};mxLayoutManager.prototype.getGraph=function(){return this.graph};mxLayoutManager.prototype.setGraph=function(d){if(null!=this.graph){var c=this.graph.getModel();c.removeListener(this.undoHandler);this.graph.removeListener(this.moveHandler)}this.graph=d;null!=this.graph&&(c=this.graph.getModel(),c.addListener(mxEvent.BEFORE_UNDO,this.undoHandler),this.graph.addListener(mxEvent.MOVE_CELLS,this.moveHandler))};mxLayoutManager.prototype.getLayout=function(b){return null};mxLayoutManager.prototype.beforeUndo=function(e){e=this.getCellsForChanges(e.changes);var d=this.getGraph().getModel();if(this.isBubbling()){for(var f=d.getParents(e);0<f.length;){e=e.concat(f),f=d.getParents(f)}}this.layoutCells(mxUtils.sortCells(e,!1))};mxLayoutManager.prototype.cellsMoved=function(h,g){if(null!=h&&null!=g){for(var m=mxUtils.convertPoint(this.getGraph().container,mxEvent.getClientX(g),mxEvent.getClientY(g)),l=this.getGraph().getModel(),k=0;k<h.length;k++){var i=this.getLayout(l.getParent(h[k]));null!=i&&i.moveCell(h[k],m.x,m.y)}}};mxLayoutManager.prototype.getCellsForChanges=function(i){for(var h=[],o={},n=0;n<i.length;n++){var m=i[n];if(m instanceof mxRootChange){return[]}for(var m=this.getCellsForChange(m),l=0;l<m.length;l++){if(null!=m[l]){var k=mxCellPath.create(m[l]);null==o[k]&&(o[k]=m[l],h.push(m[l]))}}}return h};mxLayoutManager.prototype.getCellsForChange=function(d){var c=this.getGraph().getModel();return d instanceof mxChildChange?[d.child,d.previous,c.getParent(d.child)]:d instanceof mxTerminalChange||d instanceof mxGeometryChange?[d.cell,c.getParent(d.cell)]:[]};mxLayoutManager.prototype.layoutCells=function(f){if(0<f.length){var e=this.getGraph().getModel();e.beginUpdate();try{for(var h=null,g=0;g<f.length;g++){f[g]!=e.getRoot()&&f[g]!=h&&(h=f[g],this.executeLayout(this.getLayout(h),h))}this.fireEvent(new mxEventObject(mxEvent.LAYOUT_CELLS,"cells",f))}finally{e.endUpdate()}}};mxLayoutManager.prototype.executeLayout=function(d,c){null!=d&&null!=c&&d.execute(c)};mxLayoutManager.prototype.destroy=function(){this.setGraph(null)};function mxSpaceManager(f,e,h,g){this.resizeHandler=mxUtils.bind(this,function(d,c){this.isEnabled()&&this.cellsResized(c.getProperty("cells"))});this.foldHandler=mxUtils.bind(this,function(d,c){this.isEnabled()&&this.cellsResized(c.getProperty("cells"))});this.shiftRightwards=null!=e?e:!0;this.shiftDownwards=null!=h?h:!0;this.extendParents=null!=g?g:!0;this.setGraph(f)}mxSpaceManager.prototype=new mxEventSource;mxSpaceManager.prototype.constructor=mxSpaceManager;mxSpaceManager.prototype.graph=null;mxSpaceManager.prototype.enabled=!0;mxSpaceManager.prototype.shiftRightwards=!0;mxSpaceManager.prototype.shiftDownwards=!0;mxSpaceManager.prototype.extendParents=!0;mxSpaceManager.prototype.resizeHandler=null;mxSpaceManager.prototype.foldHandler=null;mxSpaceManager.prototype.isCellIgnored=function(b){return !this.getGraph().getModel().isVertex(b)};mxSpaceManager.prototype.isCellShiftable=function(b){return this.getGraph().getModel().isVertex(b)&&this.getGraph().isCellMovable(b)};mxSpaceManager.prototype.isEnabled=function(){return this.enabled};mxSpaceManager.prototype.setEnabled=function(b){this.enabled=b};mxSpaceManager.prototype.isShiftRightwards=function(){return this.shiftRightwards};mxSpaceManager.prototype.setShiftRightwards=function(b){this.shiftRightwards=b};mxSpaceManager.prototype.isShiftDownwards=function(){return this.shiftDownwards};mxSpaceManager.prototype.setShiftDownwards=function(b){this.shiftDownwards=b};mxSpaceManager.prototype.isExtendParents=function(){return this.extendParents};mxSpaceManager.prototype.setExtendParents=function(b){this.extendParents=b};mxSpaceManager.prototype.getGraph=function(){return this.graph};mxSpaceManager.prototype.setGraph=function(b){null!=this.graph&&(this.graph.removeListener(this.resizeHandler),this.graph.removeListener(this.foldHandler));this.graph=b;null!=this.graph&&(this.graph.addListener(mxEvent.RESIZE_CELLS,this.resizeHandler),this.graph.addListener(mxEvent.FOLD_CELLS,this.foldHandler))};mxSpaceManager.prototype.cellsResized=function(e){if(null!=e){var d=this.graph.getModel();d.beginUpdate();try{for(var f=0;f<e.length;f++){if(!this.isCellIgnored(e[f])){this.cellResized(e[f]);break}}}finally{d.endUpdate()}}};mxSpaceManager.prototype.cellResized=function(C){var B=this.getGraph(),A=B.getView(),z=B.getModel(),y=A.getState(C),x=A.getState(z.getParent(C));if(null!=y&&null!=x){var w=this.getCellsToShift(y),v=z.getGeometry(C);if(null!=w&&null!=v){var u=A.translate,t=A.scale,A=y.x-x.origin.x-u.x*t,x=y.y-x.origin.y-u.y*t,u=y.x+y.width,s=y.y+y.height,r=y.width-v.width*t+A-v.x*t,o=y.height-v.height*t+x-v.y*t,i=1-v.width*t/y.width,y=1-v.height*t/y.height;z.beginUpdate();try{for(v=0;v<w.length;v++){w[v]!=C&&this.isCellShiftable(w[v])&&this.shiftCell(w[v],r,o,A,x,u,s,i,y,this.isExtendParents()&&B.isExtendParent(w[v]))}}finally{z.endUpdate()}}}};mxSpaceManager.prototype.shiftCell=function(D,C,B,A,z,y,x,w,v,u){A=this.getGraph();var t=A.getView().getState(D);if(null!=t){var r=A.getModel(),o=r.getGeometry(D);if(null!=o){r.beginUpdate();try{if(this.isShiftRightwards()){if(t.x>=y){o=o.clone(),o.translate(-C,0)}else{var i=Math.max(0,t.x-x0),o=o.clone();o.translate(-w*i,0)}}if(this.isShiftDownwards()){if(t.y>=x){o=o.clone(),o.translate(0,-B)}else{var E=Math.max(0,t.y-z),o=o.clone();o.translate(0,-v*E)}}o!=r.getGeometry(D)&&(r.setGeometry(D,o),u&&A.extendParent(D))}finally{r.endUpdate()}}}};mxSpaceManager.prototype.getCellsToShift=function(g){var f=this.getGraph(),k=f.getModel().getParent(g.cell),i=this.isShiftDownwards(),h=this.isShiftRightwards();return f.getCellsBeyond(g.x+(i?0:g.width),g.y+(i&&h?0:g.height),k,h,i)};mxSpaceManager.prototype.destroy=function(){this.setGraph(null)};function mxSwimlaneManager(f,e,h,g){this.horizontal=null!=e?e:!0;this.addEnabled=null!=h?h:!0;this.resizeEnabled=null!=g?g:!0;this.addHandler=mxUtils.bind(this,function(d,c){this.isEnabled()&&this.isAddEnabled()&&this.cellsAdded(c.getProperty("cells"))});this.resizeHandler=mxUtils.bind(this,function(d,c){this.isEnabled()&&this.isResizeEnabled()&&this.cellsResized(c.getProperty("cells"))});this.setGraph(f)}mxSwimlaneManager.prototype=new mxEventSource;mxSwimlaneManager.prototype.constructor=mxSwimlaneManager;mxSwimlaneManager.prototype.graph=null;mxSwimlaneManager.prototype.enabled=!0;mxSwimlaneManager.prototype.horizontal=!0;mxSwimlaneManager.prototype.addEnabled=!0;mxSwimlaneManager.prototype.resizeEnabled=!0;mxSwimlaneManager.prototype.addHandler=null;mxSwimlaneManager.prototype.resizeHandler=null;mxSwimlaneManager.prototype.isEnabled=function(){return this.enabled};mxSwimlaneManager.prototype.setEnabled=function(b){this.enabled=b};mxSwimlaneManager.prototype.isHorizontal=function(){return this.horizontal};mxSwimlaneManager.prototype.setHorizontal=function(b){this.horizontal=b};mxSwimlaneManager.prototype.isAddEnabled=function(){return this.addEnabled};mxSwimlaneManager.prototype.setAddEnabled=function(b){this.addEnabled=b};mxSwimlaneManager.prototype.isResizeEnabled=function(){return this.resizeEnabled};mxSwimlaneManager.prototype.setResizeEnabled=function(b){this.resizeEnabled=b};mxSwimlaneManager.prototype.getGraph=function(){return this.graph};mxSwimlaneManager.prototype.setGraph=function(b){null!=this.graph&&(this.graph.removeListener(this.addHandler),this.graph.removeListener(this.resizeHandler));this.graph=b;null!=this.graph&&(this.graph.addListener(mxEvent.ADD_CELLS,this.addHandler),this.graph.addListener(mxEvent.CELLS_RESIZED,this.resizeHandler))};mxSwimlaneManager.prototype.isSwimlaneIgnored=function(b){return !this.getGraph().isSwimlane(b)};mxSwimlaneManager.prototype.isCellHorizontal=function(b){return this.graph.isSwimlane(b)?(b=this.graph.getCellStyle(b),1==mxUtils.getValue(b,mxConstants.STYLE_HORIZONTAL,1)):!this.isHorizontal()};mxSwimlaneManager.prototype.cellsAdded=function(e){if(null!=e){var d=this.getGraph().getModel();d.beginUpdate();try{for(var f=0;f<e.length;f++){this.isSwimlaneIgnored(e[f])||this.swimlaneAdded(e[f])}}finally{d.endUpdate()}}};mxSwimlaneManager.prototype.swimlaneAdded=function(i){for(var h=this.getGraph().getModel(),o=h.getParent(i),n=h.getChildCount(o),m=null,l=0;l<n;l++){var k=h.getChildAt(o,l);if(k!=i&&!this.isSwimlaneIgnored(k)&&(m=h.getGeometry(k),null!=m)){break}}null!=m&&(h=null!=o?this.isCellHorizontal(o):this.horizontal,this.resizeSwimlane(i,m.width,m.height,h))};mxSwimlaneManager.prototype.cellsResized=function(s){if(null!=s){var r=this.getGraph().getModel();r.beginUpdate();try{for(var q=0;q<s.length;q++){if(!this.isSwimlaneIgnored(s[q])){var p=r.getGeometry(s[q]);if(null!=p){for(var o=new mxRectangle(0,0,p.width,p.height),n=s[q],m=n;null!=m;){var n=m,m=r.getParent(m),l=this.graph.isSwimlane(m)?this.graph.getStartSize(m):new mxRectangle;o.width+=l.width;o.height+=l.height}var i=null!=m?this.isCellHorizontal(m):this.horizontal;this.resizeSwimlane(n,o.width,o.height,i)}}}}finally{r.endUpdate()}}};mxSwimlaneManager.prototype.resizeSwimlane=function(u,t,s,r){var q=this.getGraph().getModel();q.beginUpdate();try{var p=this.isCellHorizontal(u);if(!this.isSwimlaneIgnored(u)){var o=q.getGeometry(u);if(null!=o&&(r&&o.height!=s||!r&&o.width!=t)){o=o.clone(),r?o.height=s:o.width=t,q.setGeometry(u,o)}}var n=this.graph.isSwimlane(u)?this.graph.getStartSize(u):new mxRectangle;t-=n.width;s-=n.height;var m=q.getChildCount(u);for(r=0;r<m;r++){var i=q.getChildAt(u,r);this.resizeSwimlane(i,t,s,p)}}finally{q.endUpdate()}};mxSwimlaneManager.prototype.destroy=function(){this.setGraph(null)};function mxTemporaryCellStates(h,g,m){this.view=h;g=null!=g?g:1;this.oldBounds=h.getGraphBounds();this.oldStates=h.getStates();this.oldScale=h.getScale();h.setStates(new mxDictionary);h.setScale(g);if(null!=m){h.resetValidationState();g=h.createState(new mxCell);for(var l=0;l<m.length;l++){h.validateBounds(g,m[l])}for(var k=null,l=0;l<m.length;l++){var i=h.validatePoints(g,m[l]);null==k?k=i:k.add(i)}null==k&&(k=new mxRectangle);h.setGraphBounds(k)}}mxTemporaryCellStates.prototype.view=null;mxTemporaryCellStates.prototype.oldStates=null;mxTemporaryCellStates.prototype.oldBounds=null;mxTemporaryCellStates.prototype.oldScale=null;mxTemporaryCellStates.prototype.destroy=function(){this.view.setScale(this.oldScale);this.view.setStates(this.oldStates);this.view.setGraphBounds(this.oldBounds)};function mxCellStatePreview(b){this.graph=b;this.deltas={}}mxCellStatePreview.prototype.graph=null;mxCellStatePreview.prototype.deltas=null;mxCellStatePreview.prototype.count=0;mxCellStatePreview.prototype.isEmpty=function(){return 0==this.count};mxCellStatePreview.prototype.moveState=function(i,h,o,n,m){n=null!=n?n:!0;m=null!=m?m:!0;var l=mxCellPath.create(i.cell),k=this.deltas[l];null==k?(k=new mxPoint(h,o),this.deltas[l]=k,this.count++):n?(k.X+=h,k.Y+=o):(k.X=h,k.Y=o);m&&this.addEdges(i);return k};mxCellStatePreview.prototype.show=function(i){var h=this.graph.getModel(),o=h.getRoot(),n;for(n in this.deltas){var m=mxCellPath.resolve(o,n),l=this.graph.view.getState(m),k=this.deltas[n],m=this.graph.view.getState(h.getParent(m));this.translateState(m,l,k.x,k.y)}for(n in this.deltas){m=mxCellPath.resolve(o,n),l=this.graph.view.getState(m),k=this.deltas[n],m=this.graph.view.getState(h.getParent(m)),this.revalidateState(m,l,k.x,k.y,i)}};mxCellStatePreview.prototype.translateState=function(h,g,m,l){if(null!=g){var k=this.graph.getModel();if(k.isVertex(g.cell)){g.invalid=!0;this.graph.view.validateBounds(h,g.cell);h=k.getGeometry(g.cell);var i=mxCellPath.create(g.cell);if((0!=m||0!=l)&&null!=h&&(!h.relative||null!=this.deltas[i])){g.x+=m,g.y+=l}}h=k.getChildCount(g.cell);for(i=0;i<h;i++){this.translateState(g,this.graph.view.getState(k.getChildAt(g.cell,i)),m,l)}}};mxCellStatePreview.prototype.revalidateState=function(k,i,q,p,o){if(null!=i){i.invalid=!0;this.graph.view.validatePoints(k,i.cell);var n=mxCellPath.create(i.cell),m=this.graph.getModel(),l=this.graph.getCellGeometry(i.cell);if((0!=q||0!=p)&&null!=l&&l.relative&&m.isVertex(i.cell)&&(null==k||m.isVertex(k.cell)||null!=this.deltas[n])){i.x+=q,i.y+=p,this.graph.cellRenderer.redraw(i)}null!=o&&o(i);k=m.getChildCount(i.cell);for(n=0;n<k;n++){this.revalidateState(i,this.graph.view.getState(m.getChildAt(i.cell,n)),q,p,o)}}};mxCellStatePreview.prototype.addEdges=function(g){for(var f=this.graph.getModel(),k=f.getEdgeCount(g.cell),i=0;i<k;i++){var h=this.graph.view.getState(f.getEdgeAt(g.cell,i));null!=h&&this.moveState(h,0,0)}};function mxConnectionConstraint(d,c){this.point=d;this.perimeter=null!=c?c:!0}mxConnectionConstraint.prototype.point=null;mxConnectionConstraint.prototype.perimeter=null;function mxGraphHandler(b){this.graph=b;this.graph.addMouseListener(this);this.panHandler=mxUtils.bind(this,function(){this.updatePreviewShape()});this.graph.addListener(mxEvent.PAN,this.panHandler)}mxGraphHandler.prototype.graph=null;mxGraphHandler.prototype.maxCells=mxClient.IS_IE?20:50;mxGraphHandler.prototype.enabled=!0;mxGraphHandler.prototype.highlightEnabled=!0;mxGraphHandler.prototype.cloneEnabled=!0;mxGraphHandler.prototype.moveEnabled=!0;mxGraphHandler.prototype.guidesEnabled=!1;mxGraphHandler.prototype.guide=null;mxGraphHandler.prototype.currentDx=null;mxGraphHandler.prototype.currentDy=null;mxGraphHandler.prototype.updateCursor=!0;mxGraphHandler.prototype.selectEnabled=!0;mxGraphHandler.prototype.removeCellsFromParent=!0;mxGraphHandler.prototype.connectOnDrop=!1;mxGraphHandler.prototype.scrollOnMove=!0;mxGraphHandler.prototype.minimumSize=6;mxGraphHandler.prototype.previewColor="black";mxGraphHandler.prototype.htmlPreview=!1;mxGraphHandler.prototype.shape=null;mxGraphHandler.prototype.scaleGrid=!1;mxGraphHandler.prototype.rotationEnabled=!0;mxGraphHandler.prototype.isEnabled=function(){return this.enabled};mxGraphHandler.prototype.setEnabled=function(b){this.enabled=b};mxGraphHandler.prototype.isCloneEnabled=function(){return this.cloneEnabled};mxGraphHandler.prototype.setCloneEnabled=function(b){this.cloneEnabled=b};mxGraphHandler.prototype.isMoveEnabled=function(){return this.moveEnabled};mxGraphHandler.prototype.setMoveEnabled=function(b){this.moveEnabled=b};mxGraphHandler.prototype.isSelectEnabled=function(){return this.selectEnabled};mxGraphHandler.prototype.setSelectEnabled=function(b){this.selectEnabled=b};mxGraphHandler.prototype.isRemoveCellsFromParent=function(){return this.removeCellsFromParent};mxGraphHandler.prototype.setRemoveCellsFromParent=function(b){this.removeCellsFromParent=b};mxGraphHandler.prototype.getInitialCellForEvent=function(b){return b.getCell()};mxGraphHandler.prototype.isDelayedSelection=function(b){return this.graph.isCellSelected(b)};mxGraphHandler.prototype.mouseDown=function(g,f){if(!f.isConsumed()&&this.isEnabled()&&this.graph.isEnabled()&&null!=f.getState()){var k=this.getInitialCellForEvent(f);this.delayedSelection=this.isDelayedSelection(k);this.cell=null;this.isSelectEnabled()&&!this.delayedSelection&&this.graph.selectCellForEvent(k,f.getEvent());if(this.isMoveEnabled()){var i=this.graph.model,h=i.getGeometry(k);this.graph.isCellMovable(k)&&(!i.isEdge(k)||1<this.graph.getSelectionCount()||null!=h.points&&0<h.points.length||null==i.getTerminal(k,!0)||null==i.getTerminal(k,!1)||this.graph.allowDanglingEdges||this.graph.isCloneEvent(f.getEvent())&&this.graph.isCellsCloneable())&&this.start(k,f.getX(),f.getY());this.cellWasClicked=!0;f.consume()}}};mxGraphHandler.prototype.getGuideStates=function(){var e=this.graph.getDefaultParent(),d=this.graph.getModel(),f=mxUtils.bind(this,function(b){return null!=this.graph.view.getState(b)&&d.isVertex(b)&&null!=d.getGeometry(b)&&!d.getGeometry(b).relative});return this.graph.view.getCellStates(d.filterDescendants(f,e))};mxGraphHandler.prototype.getCells=function(b){return !this.delayedSelection&&this.graph.isCellMovable(b)?[b]:this.graph.getMovableCells(this.graph.getSelectionCells())};mxGraphHandler.prototype.getPreviewBounds=function(b){b=this.getBoundingBox(b);null!=b&&(b.grow(-1,-1),b.width<this.minimumSize&&(b.x-=(this.minimumSize-b.width)/2,b.width=this.minimumSize),b.height<this.minimumSize&&(b.y-=(this.minimumSize-b.height)/2,b.height=this.minimumSize));return b};mxGraphHandler.prototype.getBoundingBox=function(h){var g=null;if(null!=h&&0<h.length){for(var m=this.graph.getModel(),l=0;l<h.length;l++){if(m.isVertex(h[l])||m.isEdge(h[l])){var k=this.graph.view.getState(h[l]);if(null!=k){var i=k;m.isVertex(h[l])&&(null!=k.shape&&null!=k.shape.boundingBox)&&(i=k.shape.boundingBox);null==g?g=new mxRectangle(i.x,i.y,i.width,i.height):g.add(i)}}}}return g};mxGraphHandler.prototype.createPreviewShape=function(b){b=new mxRectangleShape(b,null,this.previewColor);b.isDashed=!0;this.htmlPreview?(b.dialect=mxConstants.DIALECT_STRICTHTML,b.init(this.graph.container)):(b.dialect=this.graph.dialect!=mxConstants.DIALECT_SVG?mxConstants.DIALECT_VML:mxConstants.DIALECT_SVG,b.init(this.graph.getView().getOverlayPane()),b.pointerEvents=!1);return b};mxGraphHandler.prototype.start=function(e,d,f){this.cell=e;this.first=mxUtils.convertPoint(this.graph.container,d,f);this.cells=this.getCells(this.cell);this.bounds=this.graph.getView().getBounds(this.cells);this.pBounds=this.getPreviewBounds(this.cells);this.guidesEnabled&&(this.guide=new mxGuide(this.graph,this.getGuideStates()))};mxGraphHandler.prototype.useGuidesForEvent=function(b){return null!=this.guide?this.guide.isEnabledForEvent(b.getEvent()):!0};mxGraphHandler.prototype.snap=function(d){var c=this.scaleGrid?this.graph.view.scale:1;d.x=this.graph.snap(d.x/c)*c;d.y=this.graph.snap(d.y/c)*c;return d};mxGraphHandler.prototype.getDelta=function(b){b=mxUtils.convertPoint(this.graph.container,b.getX(),b.getY());return new mxPoint(b.x-this.first.x,b.y-this.first.y)};mxGraphHandler.prototype.mouseMove=function(u,t){var s=this.graph;if(this.cell&&this.cell.getAttribute("moveDisable")=="1"){return}if(!t.isConsumed()&&s.isMouseDown&&null!=this.cell&&null!=this.first&&null!=this.bounds){var r=this.getDelta(t),q=r.x,r=r.y,p=s.tolerance;if(null!=this.shape||Math.abs(q)>p||Math.abs(r)>p){null==this.highlight&&(this.highlight=new mxCellHighlight(this.graph,mxConstants.DROP_TARGET_COLOR,3));null==this.shape&&(this.shape=this.createPreviewShape(this.bounds));var o=s.isGridEnabledEvent(t.getEvent()),p=!0;if(null!=this.guide&&this.useGuidesForEvent(t)){r=this.guide.move(this.bounds,new mxPoint(q,r),o),p=!1,q=r.x,r=r.y}else{if(o){var n=s.getView().translate,m=s.getView().scale,o=this.bounds.x-(s.snap(this.bounds.x/m-n.x)+n.x)*m,n=this.bounds.y-(s.snap(this.bounds.y/m-n.y)+n.y)*m,r=this.snap(new mxPoint(q,r)),q=r.x-o,r=r.y-n}}null!=this.guide&&p&&this.guide.hide();s.isConstrainedEvent(t.getEvent())&&(Math.abs(q)>Math.abs(r)?r=0:q=0);this.currentDx=q;this.currentDy=r;this.updatePreviewShape();if(!s.disconnerctNode){p=null;r=t.getCell();s.isDropEnabled()&&this.highlightEnabled&&(p=s.getDropTarget(this.cells,t.getEvent(),r));o=p;for(n=s.getModel();null!=o&&o!=this.cells[0];){o=n.getParent(o)}var m=s.isCloneEvent(t.getEvent())&&s.isCellsCloneable()&&this.isCloneEnabled(),q=s.getView().getState(p),i=!1;null!=q&&null==o&&(n.getParent(this.cell)!=p||m)?(this.target!=p&&(this.target=p,this.setHighlightColor(mxConstants.DROP_TARGET_COLOR)),i=!0):(this.target=null,this.connectOnDrop&&(null!=r&&1==this.cells.length&&s.getModel().isVertex(r)&&s.isCellConnectable(r))&&(q=s.getView().getState(r),null!=q&&(s=null==s.getEdgeValidationError(null,this.cell,r)?mxConstants.VALID_COLOR:mxConstants.INVALID_CONNECT_TARGET_COLOR,this.setHighlightColor(s),i=!0)));null!=q&&i?this.highlight.highlight(q):this.highlight.hide()}}t.consume();mxEvent.consume(t.getEvent())}else{if((this.isMoveEnabled()||this.isCloneEnabled())&&this.updateCursor&&!t.isConsumed()&&null!=t.getState()&&!s.isMouseDown){q=s.getCursorForCell(t.getCell()),null==q&&(s.isEnabled()&&s.isCellMovable(t.getCell()))&&(q=s.getModel().isEdge(t.getCell())?mxConstants.CURSOR_MOVABLE_EDGE:mxConstants.CURSOR_MOVABLE_VERTEX),t.getState().setCursor(q)}}};mxGraphHandler.prototype.updatePreviewShape=function(){null!=this.shape&&(this.shape.bounds=new mxRectangle(Math.round(this.pBounds.x+this.currentDx-this.graph.panDx),Math.round(this.pBounds.y+this.currentDy-this.graph.panDy),this.pBounds.width,this.pBounds.height),this.shape.redraw())};mxGraphHandler.prototype.setHighlightColor=function(b){null!=this.highlight&&this.highlight.setHighlightColor(b)};mxGraphHandler.prototype.mouseUp=function(i,h){if(!h.isConsumed()){var o=this.graph;if(null!=this.cell&&null!=this.first&&null!=this.shape&&null!=this.currentDx&&null!=this.currentDy){var n=o.getView().scale,m=o.isCloneEvent(h.getEvent())&&o.isCellsCloneable()&&this.isCloneEnabled(),l=this.currentDx/n,n=this.currentDy/n,k=h.getCell();this.connectOnDrop&&null==this.target&&null!=k&&o.getModel().isVertex(k)&&o.isCellConnectable(k)&&o.isEdgeValid(null,this.cell,k)?o.connectionHandler.connect(this.cell,k,h.getEvent()):(k=this.target,o.isSplitEnabled()&&o.isSplitTarget(k,this.cells,h.getEvent())?o.splitEdge(k,this.cells,null,l,n):this.moveCells(this.cells,l,n,m,this.target,h.getEvent()))}else{this.isSelectEnabled()&&(this.delayedSelection&&null!=this.cell)&&this.selectDelayed(h)}}this.cellWasClicked&&h.consume();this.reset()};mxGraphHandler.prototype.selectDelayed=function(b){(!this.graph.isCellSelected(this.cell)||!this.graph.popupMenuHandler.isPopupTrigger(b))&&this.graph.selectCellForEvent(this.cell,b.getEvent())};mxGraphHandler.prototype.reset=function(){this.destroyShapes();this.delayedSelection=this.cellWasClicked=!1;this.target=this.cell=this.first=this.guides=this.currentDy=this.currentDx=null};mxGraphHandler.prototype.shouldRemoveCellsFromParent=function(g,f,k){if(this.graph.getModel().isVertex(g)){g=this.graph.getView().getState(g);k=mxUtils.convertPoint(this.graph.container,mxEvent.getClientX(k),mxEvent.getClientY(k));var i=mxUtils.toRadians(mxUtils.getValue(g.style,mxConstants.STYLE_ROTATION)||0);if(0!=i){f=Math.cos(-i);var i=Math.sin(-i),h=new mxPoint(g.getCenterX(),g.getCenterY());k=mxUtils.getRotatedPoint(k,f,i,h)}return null!=g&&!mxUtils.contains(g,k.x,k.y)}return !1};mxGraphHandler.prototype.moveCells=function(h,g,m,l,k,i){l&&(h=this.graph.getCloneableCells(h));null==k&&(this.isRemoveCellsFromParent()&&this.shouldRemoveCellsFromParent(this.graph.getModel().getParent(this.cell),h,i))&&(k=this.graph.getDefaultParent());h=this.graph.moveCells(h,g-this.graph.panDx/this.graph.view.scale,m-this.graph.panDy/this.graph.view.scale,l,k,i);this.isSelectEnabled()&&this.scrollOnMove&&this.graph.scrollCellToVisible(h[0]);l&&this.graph.setSelectionCells(h)};mxGraphHandler.prototype.destroyShapes=function(){null!=this.shape&&(this.shape.destroy(),this.shape=null);null!=this.guide&&(this.guide.destroy(),this.guide=null);null!=this.highlight&&(this.highlight.destroy(),this.highlight=null)};mxGraphHandler.prototype.destroy=function(){this.graph.removeMouseListener(this);this.graph.removeListener(this.panHandler);this.destroyShapes()};function mxPanningHandler(b){null!=b&&(this.graph=b,this.graph.addMouseListener(this),this.forcePanningHandler=mxUtils.bind(this,function(f,i){var h=i.getProperty("eventName"),g=i.getProperty("event");h==mxEvent.MOUSE_DOWN&&this.isForcePanningEvent(g)&&(this.start(g),this.active=!0,g.consume())}),this.graph.addListener(mxEvent.FIRE_MOUSE_EVENT,this.forcePanningHandler))}mxPanningHandler.prototype=new mxEventSource;mxPanningHandler.prototype.constructor=mxPanningHandler;mxPanningHandler.prototype.graph=null;mxPanningHandler.prototype.useLeftButtonForPanning=!1;mxPanningHandler.prototype.usePopupTrigger=!0;mxPanningHandler.prototype.ignoreCell=!1;mxPanningHandler.prototype.previewEnabled=!0;mxPanningHandler.prototype.useGrid=!1;mxPanningHandler.prototype.panningEnabled=!0;mxPanningHandler.prototype.isPanningEnabled=function(){return this.panningEnabled};mxPanningHandler.prototype.setPanningEnabled=function(b){this.panningEnabled=b};mxPanningHandler.prototype.isPanningTrigger=function(d){var c=d.getEvent();return this.useLeftButtonForPanning&&(this.ignoreCell||null==d.getState())&&mxEvent.isLeftMouseButton(c)||mxEvent.isControlDown(c)&&mxEvent.isShiftDown(c)||this.usePopupTrigger&&mxEvent.isPopupTrigger(c)};mxPanningHandler.prototype.isForcePanningEvent=function(b){return !1};mxPanningHandler.prototype.mouseDown=function(d,c){!c.isConsumed()&&(this.isPanningEnabled()&&!this.active&&this.isPanningTrigger(c))&&(this.start(c),this.consumePanningTrigger(c))};mxPanningHandler.prototype.start=function(b){this.dx0=-this.graph.container.scrollLeft;this.dy0=-this.graph.container.scrollTop;this.startX=b.getX();this.startY=b.getY();this.panningTrigger=!0};mxPanningHandler.prototype.consumePanningTrigger=function(b){b.consume()};mxPanningHandler.prototype.mouseMove=function(g,f){var k=f.getX()-this.startX,i=f.getY()-this.startY;if(this.active){var h=f.getEvent().scale;null!=h&&1!=h?this.scaleGraph(h,!0):this.previewEnabled&&(this.useGrid&&(k=this.graph.snap(k),i=this.graph.snap(i)),this.graph.panGraph(k+this.dx0,i+this.dy0));this.fireEvent(new mxEventObject(mxEvent.PAN,"event",f))}else{this.panningTrigger&&(h=this.active,this.active=Math.abs(k)>this.graph.tolerance||Math.abs(i)>this.graph.tolerance,!h&&this.active&&this.fireEvent(new mxEventObject(mxEvent.PAN_START,"event",f)))}(this.active||this.panningTrigger)&&f.consume()};mxPanningHandler.prototype.mouseUp=function(i,h){var o=Math.abs(h.getX()-this.startX),n=Math.abs(h.getY()-this.startY);if(this.active){if(!this.graph.useScrollbarsForPanning||!mxUtils.hasScrollbars(this.graph.container)){o=h.getX()-this.startX;n=h.getY()-this.startY;this.useGrid&&(o=this.graph.snap(o),n=this.graph.snap(n));var m=this.graph.getView().scale,l=this.graph.getView().translate;this.graph.panGraph(0,0);var k=h.getEvent().scale;null!=k&&1!=k?this.scaleGraph(k,!1):this.panGraph(l.x+o/m,l.y+n/m)}this.active=!1;this.fireEvent(new mxEventObject(mxEvent.PAN_END,"event",h));h.consume()}this.panningTrigger=!1};mxPanningHandler.prototype.scaleGraph=function(d,c){c?this.graph.view.getCanvas().setAttribute("transform","scale("+d+")"):(this.graph.view.getCanvas().removeAttribute("transform"),this.graph.view.setScale(this.graph.view.scale*d))};mxPanningHandler.prototype.panGraph=function(d,c){this.graph.getView().setTranslate(d,c)};mxPanningHandler.prototype.destroy=function(){this.graph.removeMouseListener(this);this.graph.removeListener(mxEvent.FIRE_MOUSE_EVENT,this.forcePanningHandler)};function mxPopupMenuHandler(d,c){null!=d&&(this.graph=d,this.factoryMethod=c,this.graph.addMouseListener(this),this.init())}mxPopupMenuHandler.prototype=new mxPopupMenu;mxPopupMenuHandler.prototype.constructor=mxPanningHandler;mxPopupMenuHandler.prototype.graph=null;mxPopupMenuHandler.prototype.selectOnPopup=!0;mxPopupMenuHandler.prototype.clearSelectionOnBackground=!0;mxPopupMenuHandler.prototype.triggerX=null;mxPopupMenuHandler.prototype.triggerY=null;mxPopupMenuHandler.prototype.init=function(){mxPopupMenu.prototype.init.apply(this);mxEvent.addGestureListeners(this.div,mxUtils.bind(this,function(b){this.graph.tooltipHandler.hide()}))};mxPopupMenuHandler.prototype.isSelectOnPopup=function(b){return this.selectOnPopup};mxPopupMenuHandler.prototype.mouseDown=function(d,c){this.isEnabled()&&(this.hideMenu(),this.triggerX=c.getGraphX(),this.triggerY=c.getGraphY(),this.popupTrigger=this.isPopupTrigger(c),this.inTolerance=!0)};mxPopupMenuHandler.prototype.mouseMove=function(d,c){if(this.inTolerance&&(null!=this.triggerX&&null!=this.triggerY)&&(Math.abs(c.getGraphX()-this.triggerX)>this.graph.tolerance||Math.abs(c.getGraphY()-this.triggerY)>this.graph.tolerance)){this.inTolerance=!1}};mxPopupMenuHandler.prototype.mouseUp=function(f,e){if(this.popupTrigger&&this.inTolerance&&null!=this.triggerX&&null!=this.triggerY){var h=this.getCellForPopupEvent(e);this.graph.isEnabled()&&this.isSelectOnPopup(e)&&null!=h&&!this.graph.isCellSelected(h)?this.graph.setSelectionCell(h):this.clearSelectionOnBackground&&null==h&&this.graph.clearSelection();this.graph.tooltipHandler.hide();var g=mxUtils.getScrollOrigin();this.popup(e.getX()+g.x+1,e.getY()+g.y+1,h,e.getEvent());e.consume()}this.inTolerance=this.popupTrigger=!1};mxPopupMenuHandler.prototype.getCellForPopupEvent=function(b){return b.getCell()};mxPopupMenuHandler.prototype.destroy=function(){this.graph.removeMouseListener(this);mxPopupMenu.prototype.destroy.apply(this)};function mxCellMarker(f,e,h,g){mxEventSource.call(this);null!=f&&(this.graph=f,this.validColor=null!=e?e:mxConstants.DEFAULT_VALID_COLOR,this.invalidColor=null!=e?h:mxConstants.DEFAULT_INVALID_COLOR,this.hotspot=null!=g?g:mxConstants.DEFAULT_HOTSPOT,this.highlight=new mxCellHighlight(f))}mxUtils.extend(mxCellMarker,mxEventSource);mxCellMarker.prototype.graph=null;mxCellMarker.prototype.enabled=!0;mxCellMarker.prototype.hotspot=mxConstants.DEFAULT_HOTSPOT;mxCellMarker.prototype.hotspotEnabled=!1;mxCellMarker.prototype.validColor=null;mxCellMarker.prototype.invalidColor=null;mxCellMarker.prototype.currentColor=null;mxCellMarker.prototype.validState=null;mxCellMarker.prototype.markedState=null;mxCellMarker.prototype.setEnabled=function(b){this.enabled=b};mxCellMarker.prototype.isEnabled=function(){return this.enabled};mxCellMarker.prototype.setHotspot=function(b){this.hotspot=b};mxCellMarker.prototype.getHotspot=function(){return this.hotspot};mxCellMarker.prototype.setHotspotEnabled=function(b){this.hotspotEnabled=b};mxCellMarker.prototype.isHotspotEnabled=function(){return this.hotspotEnabled};mxCellMarker.prototype.hasValidState=function(){return null!=this.validState};mxCellMarker.prototype.getValidState=function(){return this.validState};mxCellMarker.prototype.getMarkedState=function(){return this.markedState};mxCellMarker.prototype.reset=function(){this.validState=null;null!=this.markedState&&(this.markedState=null,this.unmark())};mxCellMarker.prototype.process=function(e){var d=null;if(this.isEnabled()){var d=this.getState(e),f=null!=d?this.isValidState(d):!1;e=this.getMarkerColor(e.getEvent(),d,f);this.validState=f?d:null;if(d!=this.markedState||e!=this.currentColor){this.currentColor=e,null!=d&&null!=this.currentColor?(this.markedState=d,this.mark()):null!=this.markedState&&(this.markedState=null,this.unmark())}}return d};mxCellMarker.prototype.markCell=function(e,d){var f=this.graph.getView().getState(e);null!=f&&(this.currentColor=null!=d?d:this.validColor,this.markedState=f,this.mark())};mxCellMarker.prototype.mark=function(){this.highlight.setHighlightColor(this.currentColor);this.highlight.highlight(this.markedState);this.fireEvent(new mxEventObject(mxEvent.MARK,"state",this.markedState))};mxCellMarker.prototype.unmark=function(){this.mark()};mxCellMarker.prototype.isValidState=function(b){return !0};mxCellMarker.prototype.getMarkerColor=function(e,d,f){return f?this.validColor:this.invalidColor};mxCellMarker.prototype.getState=function(d){var c=this.graph.getView();cell=this.getCell(d);c=this.getStateToMark(c.getState(cell));return null!=c&&this.intersects(c,d)?c:null};mxCellMarker.prototype.getCell=function(b){return b.getCell()};mxCellMarker.prototype.getStateToMark=function(b){return b};mxCellMarker.prototype.intersects=function(d,c){return this.hotspotEnabled?mxUtils.intersectsHotspot(d,c.getGraphX(),c.getGraphY(),this.hotspot,mxConstants.MIN_HOTSPOT_SIZE,mxConstants.MAX_HOTSPOT_SIZE):!0};mxCellMarker.prototype.destroy=function(){this.graph.getView().removeListener(this.resetHandler);this.graph.getModel().removeListener(this.resetHandler);this.highlight.destroy()};function mxSelectionCellsHandler(b){mxEventSource.call(this);this.graph=b;this.handlers=new mxDictionary;this.graph.addMouseListener(this);this.refreshHandler=mxUtils.bind(this,function(d,e){this.isEnabled()&&this.refresh()});this.graph.getSelectionModel().addListener(mxEvent.CHANGE,this.refreshHandler);this.graph.getModel().addListener(mxEvent.CHANGE,this.refreshHandler);this.graph.getView().addListener(mxEvent.SCALE,this.refreshHandler);this.graph.getView().addListener(mxEvent.TRANSLATE,this.refreshHandler);this.graph.getView().addListener(mxEvent.SCALE_AND_TRANSLATE,this.refreshHandler);this.graph.getView().addListener(mxEvent.DOWN,this.refreshHandler);this.graph.getView().addListener(mxEvent.UP,this.refreshHandler)}mxUtils.extend(mxSelectionCellsHandler,mxEventSource);mxSelectionCellsHandler.prototype.graph=null;mxSelectionCellsHandler.prototype.enabled=!0;mxSelectionCellsHandler.prototype.refreshHandler=null;mxSelectionCellsHandler.prototype.maxHandlers=100;mxSelectionCellsHandler.prototype.handlers=null;mxSelectionCellsHandler.prototype.isEnabled=function(){return this.enabled};mxSelectionCellsHandler.prototype.setEnabled=function(b){this.enabled=b};mxSelectionCellsHandler.prototype.getHandler=function(b){return this.handlers.get(b)};mxSelectionCellsHandler.prototype.reset=function(){this.handlers.visit(function(d,c){c.reset.apply(c)})};mxSelectionCellsHandler.prototype.refresh=function(){var g=this.handlers;this.handlers=new mxDictionary;for(var f=this.graph.getSelectionCells(),k=0;k<f.length;k++){var i=this.graph.view.getState(f[k]);if(null!=i){var h=g.remove(f[k]);null!=h&&(h.state!=i?(h.destroy(),h=null):h.redraw());null==h&&(h=this.graph.createHandler(i),this.fireEvent(new mxEventObject(mxEvent.ADD,"state",i)));null!=h&&this.handlers.put(f[k],h)}}g.visit(mxUtils.bind(this,function(d,c){this.fireEvent(new mxEventObject(mxEvent.REMOVE,"state",c.state));c.destroy()}))};mxSelectionCellsHandler.prototype.mouseDown=function(e,d){if(this.graph.isEnabled()&&this.isEnabled()){var f=[e,d];this.handlers.visit(function(g,c){c.mouseDown.apply(c,f)})}};mxSelectionCellsHandler.prototype.mouseMove=function(e,d){if(this.graph.isEnabled()&&this.isEnabled()){var f=[e,d];this.handlers.visit(function(g,c){c.mouseMove.apply(c,f)})}};mxSelectionCellsHandler.prototype.mouseUp=function(e,d){if(this.graph.isEnabled()&&this.isEnabled()){var f=[e,d];this.handlers.visit(function(g,c){c.mouseUp.apply(c,f)})}};mxSelectionCellsHandler.prototype.destroy=function(){this.graph.removeMouseListener(this);null!=this.refreshHandler&&(this.graph.getSelectionModel().removeListener(this.refreshHandler),this.graph.getModel().removeListener(this.refreshHandler),this.graph.getView().removeListener(this.refreshHandler),this.refreshHandler=null)};function mxConnectionHandler(d,c){mxEventSource.call(this);null!=d&&(this.graph=d,this.factoryMethod=c,this.init())}mxUtils.extend(mxConnectionHandler,mxEventSource);mxConnectionHandler.prototype.graph=null;mxConnectionHandler.prototype.factoryMethod=!0;mxConnectionHandler.prototype.moveIconFront=!1;mxConnectionHandler.prototype.moveIconBack=!1;mxConnectionHandler.prototype.connectImage=null;mxConnectionHandler.prototype.targetConnectImage=!1;mxConnectionHandler.prototype.enabled=!0;mxConnectionHandler.prototype.select=!0;mxConnectionHandler.prototype.createTarget=!1;mxConnectionHandler.prototype.marker=null;mxConnectionHandler.prototype.constraintHandler=null;mxConnectionHandler.prototype.error=null;mxConnectionHandler.prototype.waypointsEnabled=!1;mxConnectionHandler.prototype.ignoreMouseDown=!1;mxConnectionHandler.prototype.first=null;mxConnectionHandler.prototype.connectIconOffset=new mxPoint(0,mxConstants.TOOLTIP_VERTICAL_OFFSET);mxConnectionHandler.prototype.edgeState=null;mxConnectionHandler.prototype.changeHandler=null;mxConnectionHandler.prototype.drillHandler=null;mxConnectionHandler.prototype.mouseDownCounter=0;mxConnectionHandler.prototype.movePreviewAway=mxClient.IS_VML;mxConnectionHandler.prototype.isEnabled=function(){return this.enabled};mxConnectionHandler.prototype.setEnabled=function(b){this.enabled=b};mxConnectionHandler.prototype.isCreateTarget=function(){return this.createTarget};mxConnectionHandler.prototype.setCreateTarget=function(b){this.createTarget=b};mxConnectionHandler.prototype.createShape=function(){var b=new mxPolyline([],mxConstants.INVALID_COLOR);b.dialect=this.graph.dialect!=mxConstants.DIALECT_SVG?mxConstants.DIALECT_VML:mxConstants.DIALECT_SVG;b.pointerEvents=!1;b.isDashed=!0;b.init(this.graph.getView().getOverlayPane());mxEvent.redirectMouseEvents(b.node,this.graph,null);return b};mxConnectionHandler.prototype.init=function(){this.graph.addMouseListener(this);this.marker=this.createMarker();this.constraintHandler=new mxConstraintHandler(this.graph);this.changeHandler=mxUtils.bind(this,function(b){null!=this.iconState&&(this.iconState=this.graph.getView().getState(this.iconState.cell));null!=this.iconState?(this.redrawIcons(this.icons,this.iconState),this.constraintHandler.reset()):this.reset()});this.graph.getModel().addListener(mxEvent.CHANGE,this.changeHandler);this.graph.getView().addListener(mxEvent.SCALE,this.changeHandler);this.graph.getView().addListener(mxEvent.TRANSLATE,this.changeHandler);this.graph.getView().addListener(mxEvent.SCALE_AND_TRANSLATE,this.changeHandler);this.drillHandler=mxUtils.bind(this,function(b){this.reset()});this.graph.addListener(mxEvent.START_EDITING,this.drillHandler);this.graph.getView().addListener(mxEvent.DOWN,this.drillHandler);this.graph.getView().addListener(mxEvent.UP,this.drillHandler)};mxConnectionHandler.prototype.isConnectableCell=function(b){return !0};mxConnectionHandler.prototype.createMarker=function(){var b=new mxCellMarker(this.graph);b.hotspotEnabled=!0;b.getCell=mxUtils.bind(this,function(a,f){f=mxCellMarker.prototype.getCell.apply(b,arguments);var e=this.graph.view.scale,e=new mxPoint(this.graph.snap(a.getGraphX()/e)*e,this.graph.snap(a.getGraphY()/e)*e);this.error=null;null==f&&(f=this.graph.getCellAt(e.x,e.y));if(this.graph.isSwimlane(f)&&this.graph.hitsSwimlaneContent(f,e.x,e.y)||!this.isConnectableCell(f)){f=null}null!=f?this.isConnecting()?null!=this.previous&&(this.error=this.validateConnection(this.previous.cell,f),null!=this.error&&0==this.error.length&&(f=null,this.isCreateTarget()&&(this.error=null))):this.isValidSource(f)||(f=null):this.isConnecting()&&(!this.isCreateTarget()&&!this.graph.allowDanglingEdges)&&(this.error="");return f});b.isValidState=mxUtils.bind(this,function(a){return this.isConnecting()?null==this.error:mxCellMarker.prototype.isValidState.apply(b,arguments)});b.getMarkerColor=mxUtils.bind(this,function(a,f,e){return null==this.connectImage||this.isConnecting()?mxCellMarker.prototype.getMarkerColor.apply(b,arguments):null});b.intersects=mxUtils.bind(this,function(a,d){return null!=this.connectImage||this.isConnecting()?!0:mxCellMarker.prototype.intersects.apply(b,arguments)});return b};mxConnectionHandler.prototype.start=function(f,e,h,g){this.previous=f;this.first=new mxPoint(e,h);this.edgeState=null!=g?g:this.createEdgeState(null);this.marker.currentColor=this.marker.validColor;this.marker.markedState=f;this.marker.mark();this.fireEvent(new mxEventObject(mxEvent.START,"state",this.previous))};mxConnectionHandler.prototype.isConnecting=function(){return null!=this.first&&null!=this.shape};mxConnectionHandler.prototype.isValidSource=function(b){return this.graph.isValidSource(b)};mxConnectionHandler.prototype.isValidTarget=function(b){return !0};mxConnectionHandler.prototype.validateConnection=function(d,c){return !this.isValidTarget(c)?"":this.graph.getEdgeValidationError(null,d,c)};mxConnectionHandler.prototype.getConnectImage=function(b){return this.connectImage};mxConnectionHandler.prototype.isMoveIconToFrontForState=function(b){return null!=b.text&&b.text.node.parentNode==this.graph.container?!0:this.moveIconFront};mxConnectionHandler.prototype.createIcons=function(h){var g=this.getConnectImage(h);if(null!=g&&null!=h){this.iconState=h;var m=[],l=new mxRectangle(0,0,g.width,g.height),k=new mxImageShape(l,g.src,null,null,0);k.preserveImageAspect=!1;this.isMoveIconToFrontForState(h)?(k.dialect=mxConstants.DIALECT_STRICTHTML,k.init(this.graph.container)):(k.dialect=this.graph.dialect==mxConstants.DIALECT_SVG?mxConstants.DIALECT_SVG:mxConstants.DIALECT_VML,k.init(this.graph.getView().getOverlayPane()),this.moveIconBack&&null!=k.node.previousSibling&&k.node.parentNode.insertBefore(k.node,k.node.parentNode.firstChild));k.node.style.cursor=mxConstants.CURSOR_CONNECT;var i=mxUtils.bind(this,function(){return null!=this.currentState?this.currentState:h}),g=mxUtils.bind(this,function(b){mxEvent.isConsumed(b)||(this.icon=k,this.graph.fireMouseEvent(mxEvent.MOUSE_DOWN,new mxMouseEvent(b,i())))});mxEvent.redirectMouseEvents(k.node,this.graph,i,g);m.push(k);this.redrawIcons(m,this.iconState);return m}return null};mxConnectionHandler.prototype.redrawIcons=function(e,d){if(null!=e&&null!=e[0]&&null!=d){var f=this.getIconPosition(e[0],d);e[0].bounds.x=f.x;e[0].bounds.y=f.y;e[0].redraw()}};mxConnectionHandler.prototype.getIconPosition=function(i,h){var o=this.graph.getView().scale,n=h.getCenterX(),m=h.getCenterY();if(this.graph.isSwimlane(h.cell)){var l=this.graph.getStartSize(h.cell),n=0!=l.width?h.x+l.width*o/2:n,m=0!=l.height?h.y+l.height*o/2:m,l=mxUtils.toRadians(mxUtils.getValue(h.style,mxConstants.STYLE_ROTATION)||0);if(0!=l){var o=Math.cos(l),l=Math.sin(l),k=new mxPoint(h.getCenterX(),h.getCenterY()),m=mxUtils.getRotatedPoint(new mxPoint(n,m),o,l,k),n=m.x,m=m.y}}return new mxPoint(n-i.bounds.width/2,m-i.bounds.height/2)};mxConnectionHandler.prototype.destroyIcons=function(){if(null!=this.icons){for(var b=0;b<this.icons.length;b++){this.icons[b].destroy()}this.iconState=this.selectedIcon=this.icon=this.icons=null}};mxConnectionHandler.prototype.isStartEvent=function(b){return null!=this.constraintHandler.currentFocus&&null!=this.constraintHandler.currentConstraint||null!=this.previous&&null==this.error&&(null==this.icons||null!=this.icons&&null!=this.icon)};mxConnectionHandler.prototype.mouseDown=function(e,d){this.mouseDownCounter++;if(this.isEnabled()&&this.graph.isEnabled()&&!d.isConsumed()&&!this.isConnecting()&&this.isStartEvent(d)){null!=this.constraintHandler.currentConstraint&&null!=this.constraintHandler.currentFocus&&null!=this.constraintHandler.currentPoint?(this.sourceConstraint=this.constraintHandler.currentConstraint,this.previous=this.constraintHandler.currentFocus,this.first=this.constraintHandler.currentPoint.clone()):this.first=new mxPoint(d.getGraphX(),d.getGraphY());this.edgeState=this.createEdgeState(d);this.mouseDownCounter=1;this.waypointsEnabled&&null==this.shape&&(this.waypoints=null,this.shape=this.createShape());if(null==this.previous&&null!=this.edgeState){var f=this.graph.getPointForEvent(d.getEvent());this.edgeState.cell.geometry.setTerminalPoint(f,!0)}this.fireEvent(new mxEventObject(mxEvent.START,"state",this.previous));d.consume()}this.selectedIcon=this.icon;this.icon=null};mxConnectionHandler.prototype.isImmediateConnectSource=function(b){return !this.graph.isCellMovable(b.cell)};mxConnectionHandler.prototype.createEdgeState=function(b){return null};mxConnectionHandler.prototype.updateCurrentState=function(d){var c=this.marker.process(d);this.constraintHandler.update(d,null==this.first);this.currentState=c};mxConnectionHandler.prototype.convertWaypoint=function(e){var d=this.graph.getView().getScale(),f=this.graph.getView().getTranslate();e.x=e.x/d-f.x;e.y=e.y/d-f.y};mxConnectionHandler.prototype.mouseMove=function(k,i){if(!i.isConsumed()&&(this.ignoreMouseDown||null!=this.first||!this.graph.isMouseDown)){!this.isEnabled()&&null!=this.currentState&&(this.destroyIcons(),this.currentState=null);(null!=this.first||this.isEnabled()&&this.graph.isEnabled())&&this.updateCurrentState(i);if(null!=this.first){var q=this.graph.getView().scale,q=new mxPoint(this.graph.snap(i.getGraphX()/q)*q,this.graph.snap(i.getGraphY()/q)*q),p=null,o=q;null!=this.constraintHandler.currentConstraint&&(null!=this.constraintHandler.currentFocus&&null!=this.constraintHandler.currentPoint)&&(p=this.constraintHandler.currentConstraint,o=this.constraintHandler.currentPoint.clone());var n=this.first;if(null!=this.selectedIcon){var m=this.selectedIcon.bounds.width,l=this.selectedIcon.bounds.height;null!=this.currentState&&this.targetConnectImage?(m=this.getIconPosition(this.selectedIcon,this.currentState),this.selectedIcon.bounds.x=m.x,this.selectedIcon.bounds.y=m.y):(m=new mxRectangle(i.getGraphX()+this.connectIconOffset.x,i.getGraphY()+this.connectIconOffset.y,m,l),this.selectedIcon.bounds=m);this.selectedIcon.redraw()}if(null!=this.edgeState){this.edgeState.absolutePoints=[null,null!=this.currentState?null:o];this.graph.view.updateFixedTerminalPoint(this.edgeState,this.previous,!0,this.sourceConstraint);null!=this.currentState&&(null==p&&(p=this.graph.getConnectionConstraint(this.edgeState,this.previous,!1)),this.edgeState.setAbsoluteTerminalPoint(null,!1),this.graph.view.updateFixedTerminalPoint(this.edgeState,this.currentState,!1,p));n=null;if(null!=this.waypoints){n=[];for(o=0;o<this.waypoints.length;o++){p=this.waypoints[o].clone(),this.convertWaypoint(p),n[o]=p}}this.graph.view.updatePoints(this.edgeState,n,this.previous,this.currentState);this.graph.view.updateFloatingTerminalPoints(this.edgeState,this.previous,this.currentState);o=this.edgeState.absolutePoints[this.edgeState.absolutePoints.length-1];n=this.edgeState.absolutePoints[0]}else{null!=this.currentState&&null==this.constraintHandler.currentConstraint&&(m=this.getTargetPerimeterPoint(this.currentState,i),null!=m&&(o=m)),null==this.sourceConstraint&&null!=this.previous&&(m=this.getSourcePerimeterPoint(this.previous,null!=this.waypoints&&0<this.waypoints.length?this.waypoints[0]:o,i),null!=m&&(n=m))}if(null==this.currentState&&this.movePreviewAway){m=n;null!=this.edgeState&&2<this.edgeState.absolutePoints.length&&(p=this.edgeState.absolutePoints[this.edgeState.absolutePoints.length-2],null!=p&&(m=p));p=o.x-m.x;m=o.y-m.y;l=Math.sqrt(p*p+m*m);if(0==l){return}o.x-=4*p/l;o.y-=4*m/l}if(null==this.shape&&(p=Math.abs(q.x-this.first.x),m=Math.abs(q.y-this.first.y),p>this.graph.tolerance||m>this.graph.tolerance)){this.shape=this.createShape(),this.updateCurrentState(i)}null!=this.shape&&(null!=this.edgeState?this.shape.points=this.edgeState.absolutePoints:(q=[n],null!=this.waypoints&&(q=q.concat(this.waypoints)),q.push(o),this.shape.points=q),this.drawPreview());mxEvent.consume(i.getEvent());i.consume()}else{!this.isEnabled()||!this.graph.isEnabled()?this.constraintHandler.reset():this.previous!=this.currentState&&null==this.edgeState?(this.destroyIcons(),null!=this.currentState&&null==this.error&&(this.icons=this.createIcons(this.currentState),null==this.icons&&(this.currentState.setCursor(mxConstants.CURSOR_CONNECT),i.consume())),this.previous=this.currentState):this.previous==this.currentState&&(null!=this.currentState&&null==this.icons&&!this.graph.isMouseDown)&&i.consume()}null!=this.constraintHandler.currentConstraint&&this.marker.reset();if(!this.graph.isMouseDown&&null!=this.currentState&&null!=this.icons){q=!1;n=i.getSource();for(o=0;o<this.icons.length&&!q;o++){q=n==this.icons[o].node||n.parentNode==this.icons[o].node}q||this.updateIcons(this.currentState,this.icons,i)}}else{this.constraintHandler.reset()}};mxConnectionHandler.prototype.getTargetPerimeterPoint=function(h,g){var m=null,l=h.view,k=l.getPerimeterFunction(h);if(null!=k){var i=null!=this.waypoints&&0<this.waypoints.length?this.waypoints[this.waypoints.length-1]:new mxPoint(this.previous.getCenterX(),this.previous.getCenterY()),l=k(l.getPerimeterBounds(h),this.edgeState,i,!1);null!=l&&(m=l)}else{m=new mxPoint(h.getCenterX(),h.getCenterY())}return m};mxConnectionHandler.prototype.getSourcePerimeterPoint=function(k,i,q){q=null;var p=k.view,o=p.getPerimeterFunction(k),n=new mxPoint(k.getCenterX(),k.getCenterY());if(null!=o){var m=mxUtils.getValue(k.style,mxConstants.STYLE_ROTATION,0),l=-m*(Math.PI/180);0!=m&&(i=mxUtils.getRotatedPoint(new mxPoint(i.x,i.y),Math.cos(l),Math.sin(l),n));k=o(p.getPerimeterBounds(k),k,i,!1);null!=k&&(0!=m&&(k=mxUtils.getRotatedPoint(new mxPoint(k.x,k.y),Math.cos(-l),Math.sin(-l),n)),q=k)}else{q=n}return q};mxConnectionHandler.prototype.updateIcons=function(e,d,f){};mxConnectionHandler.prototype.isStopEvent=function(b){return null!=b.getState()};mxConnectionHandler.prototype.addWaypointForEvent=function(e){var d=mxUtils.convertPoint(this.graph.container,e.getX(),e.getY()),f=Math.abs(d.x-this.first.x),d=Math.abs(d.y-this.first.y);if(null!=this.waypoints||1<this.mouseDownCounter&&(f>this.graph.tolerance||d>this.graph.tolerance)){null==this.waypoints&&(this.waypoints=[]),f=this.graph.view.scale,d=new mxPoint(this.graph.snap(e.getGraphX()/f)*f,this.graph.snap(e.getGraphY()/f)*f),this.waypoints.push(d)}};mxConnectionHandler.prototype.mouseUp=function(f,e){if(!e.isConsumed()&&this.isConnecting()){if(this.waypointsEnabled&&!this.isStopEvent(e)){this.addWaypointForEvent(e);e.consume();return}if(null==this.error){var h=null!=this.previous?this.previous.cell:null,g=null;null!=this.constraintHandler.currentConstraint&&null!=this.constraintHandler.currentFocus&&(g=this.constraintHandler.currentFocus.cell);null==g&&this.marker.hasValidState()&&(g=this.marker.validState.cell);this.connect(h,g,e.getEvent(),e.getCell())}else{null!=this.previous&&(null!=this.marker.validState&&this.previous.cell==this.marker.validState.cell)&&this.graph.selectCellForEvent(this.marker.source,evt),0<this.error.length&&this.graph.validationAlert(this.error)}this.destroyIcons();e.consume()}null!=this.first&&this.reset()};mxConnectionHandler.prototype.reset=function(){null!=this.shape&&(this.shape.destroy(),this.shape=null);this.destroyIcons();this.marker.reset();this.constraintHandler.reset();this.sourceConstraint=this.error=this.previous=this.edgeState=null;this.mouseDownCounter=0;this.first=null;this.fireEvent(new mxEventObject(mxEvent.RESET))};mxConnectionHandler.prototype.drawPreview=function(){var b=null==this.error;this.shape.strokewidth=this.getEdgeWidth(b);b=this.getEdgeColor(b);this.shape.stroke=b;this.shape.redraw()};mxConnectionHandler.prototype.getEdgeColor=function(b){return b?mxConstants.VALID_COLOR:mxConstants.INVALID_COLOR};mxConnectionHandler.prototype.getEdgeWidth=function(b){return b?3:1};mxConnectionHandler.prototype.connect=function(C,B,A,z){if(null!=B||this.isCreateTarget()||this.graph.allowDanglingEdges){var y=this.graph.getModel(),x=null;y.beginUpdate();try{if(null!=C&&(null==B&&this.isCreateTarget())&&(B=this.createTargetVertex(A,C),null!=B)){z=this.graph.getDropTarget([B],A,z);if(null==z||!this.graph.getModel().isEdge(z)){var w=this.graph.getView().getState(z);if(null!=w){var v=y.getGeometry(B);v.x-=w.origin.x;v.y-=w.origin.y}}else{z=this.graph.getDefaultParent()}this.graph.addCell(B,z)}var u=this.graph.getDefaultParent();null!=C&&(null!=B&&y.getParent(C)==y.getParent(B)&&y.getParent(y.getParent(C))!=y.getRoot())&&(u=y.getParent(C),null!=C.geometry&&C.geometry.relative&&(null!=B.geometry&&B.geometry.relative)&&(u=y.getParent(u)));v=w=null;null!=this.edgeState&&(w=this.edgeState.cell.value,v=this.edgeState.cell.style);x=this.insertEdge(u,null,w,C,B,v);if(null!=x){this.graph.setConnectionConstraint(x,C,!0,this.sourceConstraint);this.graph.setConnectionConstraint(x,B,!1,this.constraintHandler.currentConstraint);null!=this.edgeState&&y.setGeometry(x,this.edgeState.cell.geometry);var t=y.getGeometry(x);null==t&&(t=new mxGeometry,t.relative=!0,y.setGeometry(x,t));if(null!=this.waypoints&&0<this.waypoints.length){var s=this.graph.view.scale,r=this.graph.view.translate;t.points=[];for(C=0;C<this.waypoints.length;C++){var o=this.waypoints[C];t.points.push(new mxPoint(o.x/s-r.x,o.y/s-r.y))}}null==B&&(o=this.graph.getPointForEvent(A,!1),o.x-=this.graph.panDx/this.graph.view.scale,o.y-=this.graph.panDy/this.graph.view.scale,t.setTerminalPoint(o,!1));this.fireEvent(new mxEventObject(mxEvent.CONNECT,"cell",x,"event",A,"target",z))}}catch(i){mxLog.show(),mxLog.debug(i.message)}finally{y.endUpdate()}this.select&&this.selectCells(x,B)}};mxConnectionHandler.prototype.selectCells=function(d,c){this.graph.setSelectionCell(d)};mxConnectionHandler.prototype.insertEdge=function(h,g,m,l,k,i){if(null==this.factoryMethod){return this.graph.insertEdge(h,g,m,l,k,i)}g=this.createEdge(m,l,k,i);return g=this.graph.addEdge(g,h,l,k)};mxConnectionHandler.prototype.createTargetVertex=function(i,h){for(var o=this.graph.getCellGeometry(h);null!=o&&o.relative;){h=this.graph.getModel().getParent(h),o=this.graph.getCellGeometry(h)}var n=this.graph.cloneCells([h])[0],o=this.graph.getModel().getGeometry(n);if(null!=o){var m=this.graph.getPointForEvent(i);o.x=this.graph.snap(m.x-o.width/2)-this.graph.panDx/this.graph.view.scale;o.y=this.graph.snap(m.y-o.height/2)-this.graph.panDy/this.graph.view.scale;if(null!=this.first){var l=this.graph.view.getState(h);if(null!=l){var k=this.getAlignmentTolerance();Math.abs(this.graph.snap(this.first.x)-this.graph.snap(m.x))<=k?o.x=l.x:Math.abs(this.graph.snap(this.first.y)-this.graph.snap(m.y))<=k&&(o.y=l.y)}}}return n};mxConnectionHandler.prototype.getAlignmentTolerance=function(){return this.graph.isGridEnabled()?this.graph.gridSize:this.graph.tolerance};mxConnectionHandler.prototype.createEdge=function(g,f,k,i){var h=null;null!=this.factoryMethod&&(h=this.factoryMethod(f,k,i));null==h&&(h=new mxCell(g||""),h.setEdge(!0),h.setStyle(i),g=new mxGeometry,g.relative=!0,h.setGeometry(g));return h};mxConnectionHandler.prototype.destroy=function(){this.graph.removeMouseListener(this);null!=this.shape&&(this.shape.destroy(),this.shape=null);null!=this.marker&&(this.marker.destroy(),this.marker=null);null!=this.constraintHandler&&(this.constraintHandler.destroy(),this.constraintHandler=null);null!=this.changeHandler&&(this.graph.getModel().removeListener(this.changeHandler),this.graph.getView().removeListener(this.changeHandler),this.changeHandler=null);null!=this.drillHandler&&(this.graph.removeListener(this.drillHandler),this.graph.getView().removeListener(this.drillHandler),this.drillHandler=null)};function mxConstraintHandler(b){this.graph=b}mxConstraintHandler.prototype.pointImage=new mxImage(mxClient.imageBasePath+"/point.gif",5,5);mxConstraintHandler.prototype.graph=null;mxConstraintHandler.prototype.enabled=!0;mxConstraintHandler.prototype.highlightColor=mxConstants.DEFAULT_VALID_COLOR;mxConstraintHandler.prototype.isEnabled=function(){return this.enabled};mxConstraintHandler.prototype.setEnabled=function(b){this.enabled=b};mxConstraintHandler.prototype.reset=function(){if(null!=this.focusIcons){for(var b=0;b<this.focusIcons.length;b++){this.focusIcons[b].destroy()}this.focusIcons=null}null!=this.focusHighlight&&(this.focusHighlight.destroy(),this.focusHighlight=null);this.focusPoints=this.currentFocus=this.currentPoint=this.currentFocusArea=this.currentConstraint=null};mxConstraintHandler.prototype.getTolerance=function(){return this.graph.getTolerance()};mxConstraintHandler.prototype.getImageForConstraint=function(e,d,f){return this.pointImage};mxConstraintHandler.prototype.isEventIgnored=function(d,c){return !1};mxConstraintHandler.prototype.isStateIgnored=function(d,c){return !1};mxConstraintHandler.prototype.destroyIcons=function(){if(null!=this.focusIcons){for(var b=0;b<this.focusIcons.length;b++){this.focusIcons[b].destroy()}this.focusPoints=this.focusIcons=null}};mxConstraintHandler.prototype.destroyFocusHighlight=function(){null!=this.focusHighlight&&(this.focusHighlight.destroy(),this.focusHighlight=null)};mxConstraintHandler.prototype.update=function(k,i){if(this.isEnabled()&&!this.isEventIgnored(k)){var q=this.getTolerance(),p=new mxRectangle(k.getGraphX()-q,k.getGraphY()-q,2*q,2*q),o=null!=k.getCell()?this.graph.isCellConnectable(k.getCell()):!1;if(null==this.currentFocusArea||!mxUtils.intersects(this.currentFocusArea,p)||null!=k.getState()&&null!=this.currentFocus&&o){if(this.currentFocusArea=null,k.getState()!=this.currentFocus){if(this.currentFocus=null,this.constraints=null!=k.getState()&&o&&!this.isStateIgnored(k.getState(),i)?this.graph.getAllConnectionConstraints(k.getState(),i):null,null!=this.constraints){this.currentFocus=k.getState();this.currentFocusArea=new mxRectangle(k.getState().x,k.getState().y,k.getState().width,k.getState().height);if(null!=this.focusIcons){for(o=0;o<this.focusIcons.length;o++){this.focusIcons[o].destroy()}this.focusPoints=this.focusIcons=null}this.focusIcons=[];this.focusPoints=[];for(o=0;o<this.constraints.length;o++){var n=this.graph.getConnectionPoint(k.getState(),this.constraints[o]),m=this.getImageForConstraint(k.getState(),this.constraints[o],n),l=m.src,m=new mxRectangle(n.x-m.width/2,n.y-m.height/2,m.width,m.height),m=new mxImageShape(m,l);m.dialect=this.graph.dialect!=mxConstants.DIALECT_SVG?mxConstants.DIALECT_MIXEDHTML:mxConstants.DIALECT_SVG;m.preserveImageAspect=!1;m.init(this.graph.getView().getOverlayPane());null!=m.node.previousSibling&&m.node.parentNode.insertBefore(m.node,m.node.parentNode.firstChild);l=mxUtils.bind(this,function(){return null!=this.currentFocus?this.currentFocus:k.getState()});m.redraw();mxEvent.redirectMouseEvents(m.node,this.graph,l);this.currentFocusArea.add(m.bounds);this.focusIcons.push(m);this.focusPoints.push(n)}this.currentFocusArea.grow(q)}else{this.destroyIcons(),this.destroyFocusHighlight()}}}this.currentPoint=this.currentConstraint=null;if(null!=this.focusIcons&&null!=this.constraints&&(null==k.getState()||this.currentFocus==k.getState())){for(o=0;o<this.focusIcons.length;o++){if(mxUtils.intersects(this.focusIcons[o].bounds,p)){this.currentConstraint=this.constraints[o];this.currentPoint=this.focusPoints[o];q=this.focusIcons[o].bounds.clone();q.grow(mxClient.IS_IE?3:2);mxClient.IS_IE&&(q.width-=1,q.height-=1);null==this.focusHighlight?(q=new mxRectangleShape(q,null,this.highlightColor,3),q.dialect=this.graph.dialect==mxConstants.DIALECT_SVG?mxConstants.DIALECT_SVG:mxConstants.DIALECT_VML,q.init(this.graph.getView().getOverlayPane()),this.focusHighlight=q,l=mxUtils.bind(this,function(){return null!=this.currentFocus?this.currentFocus:k.getState()}),mxEvent.redirectMouseEvents(q.node,this.graph,l)):(this.focusHighlight.bounds=q,this.focusHighlight.redraw());break}}}null==this.currentConstraint&&this.destroyFocusHighlight()}};mxConstraintHandler.prototype.destroy=function(){this.reset()};function mxRubberband(b){null!=b&&(this.graph=b,this.graph.addMouseListener(this),this.forceRubberbandHandler=mxUtils.bind(this,function(g,l){var k=l.getProperty("eventName"),i=l.getProperty("event");if(k==mxEvent.MOUSE_DOWN&&this.isForceRubberbandEvent(i)){var k=mxUtils.getOffset(this.graph.container),h=mxUtils.getScrollOrigin(this.graph.container);h.x-=k.x;h.y-=k.y;this.start(i.getX()+h.x,i.getY()+h.y);i.consume(!1)}}),this.graph.addListener(mxEvent.FIRE_MOUSE_EVENT,this.forceRubberbandHandler),this.panHandler=mxUtils.bind(this,function(){this.repaint()}),this.graph.addListener(mxEvent.PAN,this.panHandler),mxClient.IS_IE&&mxEvent.addListener(window,"unload",mxUtils.bind(this,function(){this.destroy()})))}mxRubberband.prototype.defaultOpacity=20;mxRubberband.prototype.enabled=!0;mxRubberband.prototype.div=null;mxRubberband.prototype.sharedDiv=null;mxRubberband.prototype.currentX=0;mxRubberband.prototype.currentY=0;mxRubberband.prototype.isEnabled=function(){return this.enabled};mxRubberband.prototype.setEnabled=function(b){this.enabled=b};mxRubberband.prototype.isForceRubberbandEvent=function(b){return mxEvent.isAltDown(b.getEvent())};mxRubberband.prototype.mouseDown=function(f,e){if(!e.isConsumed()&&this.isEnabled()&&this.graph.isEnabled()&&null==e.getState()){var h=mxUtils.getOffset(this.graph.container),g=mxUtils.getScrollOrigin(this.graph.container);g.x-=h.x;g.y-=h.y;this.start(e.getX()+g.x,e.getY()+g.y);e.consume(!1)}};mxRubberband.prototype.start=function(f,e){function h(d){d=new mxMouseEvent(d);var c=mxUtils.convertPoint(g,d.getX(),d.getY());d.graphX=c.x;d.graphY=c.y;return d}this.first=new mxPoint(f,e);var g=this.graph.container;this.dragHandler=mxUtils.bind(this,function(b){this.mouseMove(this.graph,h(b))});this.dropHandler=mxUtils.bind(this,function(b){this.mouseUp(this.graph,h(b))});mxClient.IS_FF&&mxEvent.addGestureListeners(document,null,this.dragHandler,this.dropHandler)};mxRubberband.prototype.mouseMove=function(i,h){if(!h.isConsumed()&&null!=this.first){var o=mxUtils.getScrollOrigin(this.graph.container),n=mxUtils.getOffset(this.graph.container);o.x-=n.x;o.y-=n.y;var n=h.getX()+o.x,o=h.getY()+o.y,m=this.first.x-n,l=this.first.y-o,k=this.graph.tolerance;if(null!=this.div||Math.abs(m)>k||Math.abs(l)>k){null==this.div&&(this.div=this.createShape()),mxUtils.clearSelection(),this.update(n,o),h.consume()}}};mxRubberband.prototype.createShape=function(){null==this.sharedDiv&&(this.sharedDiv=document.createElement("div"),this.sharedDiv.className="mxRubberband",mxUtils.setOpacity(this.sharedDiv,this.defaultOpacity));this.graph.container.appendChild(this.sharedDiv);return this.sharedDiv};mxRubberband.prototype.mouseUp=function(e,d){var f=null!=this.div;this.reset();f&&(f=new mxRectangle(this.x,this.y,this.width,this.height),this.graph.selectRegion(f,d.getEvent()),d.consume())};mxRubberband.prototype.reset=function(){null!=this.div&&this.div.parentNode.removeChild(this.div);mxEvent.removeGestureListeners(document,null,this.dragHandler,this.dropHandler);this.dropHandler=this.dragHandler=null;this.currentY=this.currentX=0;this.div=this.first=null};mxRubberband.prototype.update=function(d,c){this.currentX=d;this.currentY=c;this.repaint()};mxRubberband.prototype.repaint=function(){if(null!=this.div){var d=this.currentX-this.graph.panDx,c=this.currentY-this.graph.panDy;this.x=Math.min(this.first.x,d);this.y=Math.min(this.first.y,c);this.width=Math.max(this.first.x,d)-this.x;this.height=Math.max(this.first.y,c)-this.y;d=mxClient.IS_VML?this.graph.panDy:0;this.div.style.left=this.x+(mxClient.IS_VML?this.graph.panDx:0)+"px";this.div.style.top=this.y+d+"px";this.div.style.width=Math.max(1,this.width)+"px";this.div.style.height=Math.max(1,this.height)+"px"}};mxRubberband.prototype.destroy=function(){this.destroyed||(this.destroyed=!0,this.graph.removeMouseListener(this),this.graph.removeListener(mxEvent.FIRE_MOUSE_EVENT,this.forceRubberbandHandler),this.graph.removeListener(this.panHandler),this.reset(),null!=this.sharedDiv&&(this.sharedDiv=null))};function mxVertexHandler(b){null!=b&&(this.state=b,this.init())}mxVertexHandler.prototype.graph=null;mxVertexHandler.prototype.state=null;mxVertexHandler.prototype.singleSizer=!1;mxVertexHandler.prototype.index=null;mxVertexHandler.prototype.allowHandleBoundsCheck=!0;mxVertexHandler.prototype.handleImage=null;mxVertexHandler.prototype.tolerance=0;mxVertexHandler.prototype.rotationEnabled=!1;mxVertexHandler.prototype.rotationRaster=!0;mxVertexHandler.prototype.livePreview=!1;mxVertexHandler.prototype.manageSizers=!1;mxVertexHandler.prototype.constrainGroupByChildren=!1;mxVertexHandler.prototype.init=function(){this.graph=this.state.view.graph;this.selectionBounds=this.getSelectionBounds(this.state);this.bounds=new mxRectangle(this.selectionBounds.x,this.selectionBounds.y,this.selectionBounds.width,this.selectionBounds.height);this.selectionBorder=this.createSelectionShape(this.bounds);this.selectionBorder.dialect=this.graph.dialect!=mxConstants.DIALECT_SVG?mxConstants.DIALECT_VML:mxConstants.DIALECT_SVG;this.selectionBorder.pointerEvents=!1;this.selectionBorder.init(this.graph.getView().getOverlayPane());mxEvent.redirectMouseEvents(this.selectionBorder.node,this.graph,this.state);this.graph.isCellMovable(this.state.cell)&&(this.selectionBorder.node.style.cursor=mxConstants.CURSOR_MOVABLE_VERTEX);if(0>=mxGraphHandler.prototype.maxCells||this.graph.getSelectionCount()<mxGraphHandler.prototype.maxCells){var d=this.graph.isCellResizable(this.state.cell);this.sizers=[];if(d||this.graph.isLabelMovable(this.state.cell)&&2<=this.state.width&&2<=this.state.height){var c=0;d&&(this.singleSizer||(this.sizers.push(this.createSizer("nw-resize",c++)),this.sizers.push(this.createSizer("n-resize",c++)),this.sizers.push(this.createSizer("ne-resize",c++)),this.sizers.push(this.createSizer("w-resize",c++)),this.sizers.push(this.createSizer("e-resize",c++)),this.sizers.push(this.createSizer("sw-resize",c++)),this.sizers.push(this.createSizer("s-resize",c++))),this.sizers.push(this.createSizer("se-resize",c++)));d=this.graph.model.getGeometry(this.state.cell);null!=d&&(!d.relative&&!this.graph.isSwimlane(this.state.cell)&&this.graph.isLabelMovable(this.state.cell))&&(this.labelShape=this.createSizer(mxConstants.CURSOR_LABEL_HANDLE,mxEvent.LABEL_HANDLE,mxConstants.LABEL_HANDLE_SIZE,mxConstants.LABEL_HANDLE_FILLCOLOR),this.sizers.push(this.labelShape))}else{this.graph.isCellMovable(this.state.cell)&&(!this.graph.isCellResizable(this.state.cell)&&2>this.state.width&&2>this.state.height)&&(this.labelShape=this.createSizer(mxConstants.CURSOR_MOVABLE_VERTEX,null,null,mxConstants.LABEL_HANDLE_FILLCOLOR),this.sizers.push(this.labelShape))}}if(this.rotationEnabled&&this.graph.isCellRotatable(this.state.cell)&&(0>=mxGraphHandler.prototype.maxCells||this.graph.getSelectionCount()<mxGraphHandler.prototype.maxCells)&&2<this.state.width&&2<this.state.height){this.rotationShape=this.createSizer("pointer",mxEvent.ROTATION_HANDLE,mxConstants.HANDLE_SIZE+3,mxConstants.HANDLE_FILLCOLOR),this.sizers.push(this.rotationShape)}this.redraw();this.constrainGroupByChildren&&this.updateMinBounds()};mxVertexHandler.prototype.updateMinBounds=function(){var d=this.graph.getChildCells(this.state.cell);if(0<d.length&&(this.minBounds=this.graph.view.getBounds(d),null!=this.minBounds)){var d=this.state.view.scale,c=this.state.view.translate;this.minBounds.x-=this.state.x;this.minBounds.y-=this.state.y;this.minBounds.x/=d;this.minBounds.y/=d;this.minBounds.width/=d;this.minBounds.height/=d;this.x0=this.state.x/d-c.x;this.y0=this.state.y/d-c.y}};mxVertexHandler.prototype.getSelectionBounds=function(b){return new mxRectangle(Math.round(b.x),Math.round(b.y),Math.round(b.width),Math.round(b.height))};mxVertexHandler.prototype.createSelectionShape=function(b){b=new mxRectangleShape(b,null,this.getSelectionColor());b.strokewidth=this.getSelectionStrokeWidth();b.isDashed=this.isSelectionDashed();return b};mxVertexHandler.prototype.getSelectionColor=function(){return mxConstants.VERTEX_SELECTION_COLOR};mxVertexHandler.prototype.getSelectionStrokeWidth=function(){return mxConstants.VERTEX_SELECTION_STROKEWIDTH};mxVertexHandler.prototype.isSelectionDashed=function(){return mxConstants.VERTEX_SELECTION_DASHED};mxVertexHandler.prototype.createSizer=function(f,e,h,g){h=h||mxConstants.HANDLE_SIZE;h=new mxRectangle(0,0,h,h);g=this.createSizerShape(h,e,g);g.isHtmlAllowed()&&null!=this.state.text&&this.state.text.node.parentNode==this.graph.container?(g.bounds.height-=1,g.bounds.width-=1,g.dialect=mxConstants.DIALECT_STRICTHTML,g.init(this.graph.container)):(g.dialect=this.graph.dialect!=mxConstants.DIALECT_SVG?mxConstants.DIALECT_MIXEDHTML:mxConstants.DIALECT_SVG,g.init(this.graph.getView().getOverlayPane()));mxEvent.redirectMouseEvents(g.node,this.graph,this.state);this.graph.isEnabled()&&(g.node.style.cursor=f);this.isSizerVisible(e)||(g.node.style.visibility="hidden");return g};mxVertexHandler.prototype.isSizerVisible=function(b){return !0};mxVertexHandler.prototype.createSizerShape=function(e,d,f){return null!=this.handleImage?(e=new mxRectangle(e.x,e.y,this.handleImage.width,this.handleImage.height),e=new mxImageShape(e,this.handleImage.src),e.preserveImageAspect=!1,e):d==mxEvent.ROTATION_HANDLE?new mxEllipse(e,f||mxConstants.HANDLE_FILLCOLOR,mxConstants.HANDLE_STROKECOLOR):new mxRectangleShape(e,f||mxConstants.HANDLE_FILLCOLOR,mxConstants.HANDLE_STROKECOLOR)};mxVertexHandler.prototype.moveSizerTo=function(e,d,f){null!=e&&(e.bounds.x=Math.round(d-e.bounds.width/2),e.bounds.y=Math.round(f-e.bounds.height/2),e.redraw())};mxVertexHandler.prototype.getHandleForEvent=function(h){function g(a){if(null!=a&&(h.isSource(a)||null!=l&&mxUtils.intersects(a.bounds,l)&&"none"!=a.node.style.display&&"hidden"!=a.node.style.visibility)){var d=h.getGraphX()-a.bounds.getCenterX();a=h.getGraphY()-a.bounds.getCenterY();d=d*d+a*a;if(null==k||d<=k){return k=d,!0}}return !1}var m=!mxEvent.isMouseEvent(h.getEvent())?this.tolerance:1,l=this.allowHandleBoundsCheck&&(mxClient.IS_IE||0<m)?new mxRectangle(h.getGraphX()-m,h.getGraphY()-m,2*m,2*m):null,k=null,m=null;if(null!=this.sizers){for(var i=0;i<this.sizers.length;i++){g(this.sizers[i])&&(m=i)}}g(this.rotationShape)?m=mxEvent.ROTATION_HANDLE:g(this.labelShape)&&(m=mxEvent.LABEL_HANDLE);return m};mxVertexHandler.prototype.mouseDown=function(e,d){var f=!mxEvent.isMouseEvent(d.getEvent())?this.tolerance:0;if(!d.isConsumed()&&this.graph.isEnabled()&&(0<f||d.getState()==this.state)){f=this.getHandleForEvent(d),null!=f&&(this.start(d.getGraphX(),d.getGraphY(),f),d.consume())}};mxVertexHandler.prototype.start=function(e,d,f){this.inTolerance=!0;this.index=f;this.startX=e;this.startY=d;this.selectionBorder.node.style.display=f==mxEvent.ROTATION_HANDLE?"inline":"none";if(this.livePreview){this.hideSizers();f==mxEvent.ROTATION_HANDLE?this.rotationShape.node.style.display="":null!=this.sizers[f]&&(this.sizers[f].node.style.display="");e=this.graph.getEdges(this.state.cell);this.edgeHandlers=[];for(d=0;d<e.length;d++){f=this.graph.selectionCellsHandler.getHandler(e[d]),null!=f&&this.edgeHandlers.push(f)}}else{this.preview=this.createSelectionShape(this.bounds),!(mxClient.IS_SVG&&0!=Number(this.state.style[mxConstants.STYLE_ROTATION]||"0"))&&null!=this.state.text&&this.state.text.node.parentNode==this.graph.container?(this.preview.dialect=mxConstants.DIALECT_STRICTHTML,this.preview.init(this.graph.container)):(this.preview.dialect=this.graph.dialect!=mxConstants.DIALECT_SVG?mxConstants.DIALECT_VML:mxConstants.DIALECT_SVG,this.preview.init(this.graph.view.getOverlayPane()))}};mxVertexHandler.prototype.hideSizers=function(){for(var b=0;b<this.sizers.length;b++){this.sizers[b].node.style.display="none"}};mxVertexHandler.prototype.checkTolerance=function(b){if(this.inTolerance&&(null!=this.startX&&null!=this.startY)&&(mxEvent.isMouseEvent(b.getEvent())||Math.abs(b.getGraphX()-this.startX)>this.graph.tolerance||Math.abs(b.getGraphY()-this.startY)>this.graph.tolerance)){this.inTolerance=!1}};mxVertexHandler.prototype.mouseMove=function(y,x){if(!x.isConsumed()&&null!=this.index){this.checkTolerance(x);if(!this.inTolerance){var w=new mxPoint(x.getGraphX(),x.getGraphY()),v=this.graph.isGridEnabledEvent(x.getEvent()),u=this.graph.getView().scale;if(this.index==mxEvent.LABEL_HANDLE){v&&(w.x=this.graph.snap(w.x/u)*u,w.y=this.graph.snap(w.y/u)*u),this.moveSizerTo(this.sizers[this.sizers.length-1],w.x,w.y)}else{if(this.index==mxEvent.ROTATION_HANDLE){var t=this.state.x+this.state.width/2-w.x,s=this.state.y+this.state.height/2-w.y;this.currentAlpha=0!=t?180*Math.atan(s/t)/Math.PI+90:0>s?180:0;0<t&&(this.currentAlpha-=180);this.rotationRaster&&this.graph.isGridEnabledEvent(x.getEvent())&&(t=w.x-this.state.getCenterX(),s=w.y-this.state.getCenterY(),u=Math.abs(Math.sqrt(t*t+s*s)-this.state.height/2-20),u=Math.max(1,5*Math.min(3,Math.max(0,Math.round(80/Math.abs(u))))),this.currentAlpha=Math.round(this.currentAlpha/u)*u);this.selectionBorder.rotation=this.currentAlpha;this.selectionBorder.redraw();this.livePreview&&this.redrawHandles()}else{var r=mxUtils.toRadians(this.state.style[mxConstants.STYLE_ROTATION]||"0"),q=Math.cos(-r),p=Math.sin(-r),o=new mxPoint(this.state.getCenterX(),this.state.getCenterY()),t=w.x-this.startX,s=w.y-this.startY,w=this.graph.view.translate,i=p*t+q*s,t=q*t-p*s;this.bounds=this.union(this.selectionBounds,t,i,this.index,v,u,w);q=Math.cos(r);p=Math.sin(r);s=new mxPoint(this.bounds.getCenterX(),this.bounds.getCenterY());t=s.x-o.x;s=s.y-o.y;o=p*t+q*s-s;this.bounds.x+=q*t-p*s-t;this.bounds.y+=o;this.livePreview?(t=new mxRectangle(this.state.x,this.state.y,this.state.width,this.state.height),q=this.state.origin,this.state.x=this.bounds.x,this.state.y=this.bounds.y,this.state.origin=new mxPoint(this.state.x/u-w.x,this.state.y/u-w.y),this.state.width=this.bounds.width,this.state.height=this.bounds.height,this.state.view.graph.cellRenderer.redraw(this.state,!0),this.state.view.invalidate(this.state.cell),this.state.invalid=!1,this.state.view.validate(),this.redrawHandles(),this.state.x=t.x,this.state.y=t.y,this.state.width=t.width,this.state.height=t.height,this.state.origin=q):this.drawPreview()}}}x.consume()}else{!this.graph.isMouseDown&&null!=this.getHandleForEvent(x)&&x.consume(!1)}};mxVertexHandler.prototype.mouseUp=function(w,v){if(null!=this.index&&null!=this.state){var u=new mxPoint(v.getGraphX(),v.getGraphY());this.graph.getModel().beginUpdate();try{if(this.index==mxEvent.ROTATION_HANDLE){if(null!=this.currentAlpha){var t=this.currentAlpha-(this.state.style[mxConstants.STYLE_ROTATION]||0);0!=t&&this.rotateCell(this.state.cell,t)}}else{var s=this.graph.isGridEnabledEvent(v.getEvent()),r=mxUtils.toRadians(this.state.style[mxConstants.STYLE_ROTATION]||"0"),q=Math.cos(-r),p=Math.sin(-r),o=u.x-this.startX,n=u.y-this.startY,u=p*o+q*n,o=q*o-p*n,n=u,i=this.graph.view.scale;this.resizeCell(this.state.cell,o/i,n/i,this.index,s)}}finally{this.graph.getModel().endUpdate()}v.consume();this.reset()}};mxVertexHandler.prototype.rotateCell=function(k,i){var q=this.graph.getModel();if(q.isVertex(k)){var p=k==this.state?this.state:this.graph.view.getState(k);null!=p&&this.graph.setCellStyles(mxConstants.STYLE_ROTATION,(p.style[mxConstants.STYLE_ROTATION]||0)+i,[k]);if(this.state.cell!=k&&(p=this.graph.getCellGeometry(k),null!=p&&!p.relative&&0!=i)){var o=this.graph.getModel().getParent(k),n=this.graph.getCellGeometry(o);if(!p.relative&&null!=n){var m=mxUtils.toRadians(i),o=Math.cos(m),m=Math.sin(m),l=new mxPoint(p.getCenterX(),p.getCenterY()),n=new mxPoint(n.width/2,n.height/2),o=mxUtils.getRotatedPoint(l,o,m,n),p=p.clone();p.x=o.x-p.width/2;p.y=o.y-p.height/2;q.setGeometry(k,p)}}p=q.getChildCount(k);for(o=0;o<p;o++){this.rotateCell(q.getChildAt(k,o),i)}}};mxVertexHandler.prototype.reset=function(){null!=this.sizers&&(null!=this.index&&null!=this.sizers[this.index]&&"none"==this.sizers[this.index].node.style.display)&&(this.sizers[this.index].node.style.display="");this.index=this.inTolerance=this.currentAlpha=null;null!=this.preview&&(this.preview.destroy(),this.preview=null);null!=this.selectionBorder&&(this.selectionBorder.node.style.display="inline",this.selectionBounds=this.getSelectionBounds(this.state),this.bounds=new mxRectangle(this.selectionBounds.x,this.selectionBounds.y,this.selectionBounds.width,this.selectionBounds.height),this.drawPreview());if(this.livePreview&&null!=this.sizers){for(var b=0;b<this.sizers.length;b++){null!=this.sizers[b]&&(this.sizers[b].node.style.display="")}}this.redrawHandles();this.edgeHandlers=null};mxVertexHandler.prototype.resizeCell=function(u,t,s,r,q){var p=this.graph.model.getGeometry(u);if(null!=p){if(r==mxEvent.LABEL_HANDLE){r=this.graph.view.scale,t=(this.labelShape.bounds.getCenterX()-this.startX)/r,s=(this.labelShape.bounds.getCenterY()-this.startY)/r,p=p.clone(),null==p.offset?p.offset=new mxPoint(t,s):(p.offset.x+=t,p.offset.y+=s),this.graph.model.setGeometry(u,p)}else{r=this.union(p,t,s,r,q,1,new mxPoint(0,0));var o=mxUtils.toRadians(this.state.style[mxConstants.STYLE_ROTATION]||"0");if(0!=o){t=r.getCenterX()-p.getCenterX();s=r.getCenterY()-p.getCenterY();q=Math.cos(o);var n=Math.sin(o),o=q*t-n*s-t;t=n*t+q*s-s;s=r.x-p.x;var m=r.y-p.y,i=q*s-n*m;q=n*s+q*m;r.x+=o;r.y+=t;if(!this.graph.isCellCollapsed(u)&&(0!=o||0!=t)){s=p.x-r.x+i,m=p.y-r.y+q,this.moveChildren(u,s,m)}}this.graph.resizeCell(u,r)}}};mxVertexHandler.prototype.moveChildren=function(k,i,q){for(var p=this.graph.getModel(),o=p.getChildCount(k),n=0;n<o;n++){var m=p.getChildAt(k,n);if(p.isVertex(m)){var l=this.graph.getCellGeometry(m);null!=l&&!l.relative&&(l=l.clone(),l.x+=i,l.y+=q,p.setGeometry(m,l))}}};mxVertexHandler.prototype.union=function(u,t,s,r,q,p,o){if(this.singleSizer){o=u.x+u.width+t;var n=u.y+u.height+s;q&&(o=this.graph.snap(o/p)*p,n=this.graph.snap(n/p)*p);p=new mxRectangle(u.x,u.y,0,0);p.add(new mxRectangle(o,n,0,0));return p}var n=u.x-o.x*p,m=n+u.width,i=u.y-o.y*p;u=i+u.height;4<r?(u+=s,q&&(u=this.graph.snap(u/p)*p)):3>r&&(i+=s,q&&(i=this.graph.snap(i/p)*p));if(0==r||3==r||5==r){n+=t,q&&(n=this.graph.snap(n/p)*p)}else{if(2==r||4==r||7==r){m+=t,q&&(m=this.graph.snap(m/p)*p)}}q=m-n;u-=i;0>q&&(n+=q,q=Math.abs(q));0>u&&(i+=u,u=Math.abs(u));q=new mxRectangle(n+o.x*p,i+o.y*p,q,u);null!=this.minBounds&&(q.width=Math.max(q.width,this.minBounds.x*p+this.minBounds.width*p+Math.max(0,this.x0*p-q.x)),q.height=Math.max(q.height,this.minBounds.y*p+this.minBounds.height*p+Math.max(0,this.y0*p-q.y)));return q};mxVertexHandler.prototype.redraw=function(){this.selectionBounds=this.getSelectionBounds(this.state);this.bounds=new mxRectangle(this.state.x,this.state.y,this.state.width,this.state.height);this.redrawHandles();this.drawPreview()};mxVertexHandler.prototype.redrawHandles=function(){var w=this.state;if(null!=this.sizers){if(null==this.index&&this.manageSizers&&1<this.sizers.length){var v=this.tolerance;w.width<2*this.sizers[0].bounds.width-2+2*v?(this.sizers[1].node.style.display="none",this.sizers[6].node.style.display="none"):(this.sizers[1].node.style.display="",this.sizers[6].node.style.display="");w.height<2*this.sizers[0].bounds.height-2+2*v?(this.sizers[3].node.style.display="none",this.sizers[4].node.style.display="none"):(this.sizers[3].node.style.display="",this.sizers[4].node.style.display="");if(w.width<2*this.sizers[0].bounds.width-2+3*v||w.height<2*this.sizers[0].bounds.height-2+3*v){w=new mxRectangle(w.x,w.y,w.width,w.height),v/=2,w.x-=(this.sizers[0].bounds.width+v)/2,w.width+=this.sizers[0].bounds.width+v,w.y-=(this.sizers[0].bounds.height+v)/2,w.height+=this.sizers[0].bounds.height+v}}var v=w.x+w.width,u=w.y+w.height;if(this.singleSizer){this.moveSizerTo(this.sizers[0],v,u)}else{var t=w.x+w.width/2,s=w.y+w.height/2;if(1<this.sizers.length){var r="nw-resize n-resize ne-resize e-resize se-resize s-resize sw-resize w-resize".split(" "),q=mxUtils.toRadians(this.state.style[mxConstants.STYLE_ROTATION]||"0"),p=Math.cos(q),o=Math.sin(q),q=Math.round(4*q/Math.PI),n=new mxPoint(w.getCenterX(),w.getCenterY()),i=mxUtils.getRotatedPoint(new mxPoint(w.x,w.y),p,o,n);this.moveSizerTo(this.sizers[0],i.x,i.y);this.sizers[0].node.style.cursor=r[mxUtils.mod(0+q,r.length)];i.x=t;i.y=w.y;i=mxUtils.getRotatedPoint(i,p,o,n);this.moveSizerTo(this.sizers[1],i.x,i.y);this.sizers[1].node.style.cursor=r[mxUtils.mod(1+q,r.length)];i.x=v;i.y=w.y;i=mxUtils.getRotatedPoint(i,p,o,n);this.moveSizerTo(this.sizers[2],i.x,i.y);this.sizers[2].node.style.cursor=r[mxUtils.mod(2+q,r.length)];i.x=w.x;i.y=s;i=mxUtils.getRotatedPoint(i,p,o,n);this.moveSizerTo(this.sizers[3],i.x,i.y);this.sizers[3].node.style.cursor=r[mxUtils.mod(7+q,r.length)];i.x=v;i.y=s;i=mxUtils.getRotatedPoint(i,p,o,n);this.moveSizerTo(this.sizers[4],i.x,i.y);this.sizers[4].node.style.cursor=r[mxUtils.mod(3+q,r.length)];i.x=w.x;i.y=u;i=mxUtils.getRotatedPoint(i,p,o,n);this.moveSizerTo(this.sizers[5],i.x,i.y);this.sizers[5].node.style.cursor=r[mxUtils.mod(6+q,r.length)];i.x=t;i.y=u;i=mxUtils.getRotatedPoint(i,p,o,n);this.moveSizerTo(this.sizers[6],i.x,i.y);this.sizers[6].node.style.cursor=r[mxUtils.mod(5+q,r.length)];i.x=v;i.y=u;i=mxUtils.getRotatedPoint(i,p,o,n);this.moveSizerTo(this.sizers[7],i.x,i.y);this.sizers[7].node.style.cursor=r[mxUtils.mod(4+q,r.length)];this.moveSizerTo(this.sizers[8],t+this.state.absoluteOffset.x,s+this.state.absoluteOffset.y)}else{2<=this.state.width&&2<=this.state.height?this.moveSizerTo(this.sizers[0],t+this.state.absoluteOffset.x,s+this.state.absoluteOffset.y):this.moveSizerTo(this.sizers[0],w.x,w.y)}}}null!=this.rotationShape&&(q=mxUtils.toRadians(null!=this.currentAlpha?this.currentAlpha:this.state.style[mxConstants.STYLE_ROTATION]||"0"),p=Math.cos(q),o=Math.sin(q),n=new mxPoint(this.state.getCenterX(),this.state.getCenterY()),i=mxUtils.getRotatedPoint(new mxPoint(w.x+w.width/2,w.y-16),p,o,n),null!=this.rotationShape.node&&this.moveSizerTo(this.rotationShape,i.x,i.y));null!=this.selectionBorder&&(this.selectionBorder.rotation=Number(this.state.style[mxConstants.STYLE_ROTATION]||"0"));if(null!=this.edgeHandlers){for(w=0;w<this.edgeHandlers.length;w++){this.edgeHandlers[w].redraw()}}};mxVertexHandler.prototype.drawPreview=function(){null!=this.preview&&(this.preview.bounds=this.bounds,this.preview.node.parentNode==this.graph.container&&(this.preview.bounds.width=Math.max(0,this.preview.bounds.width-1),this.preview.bounds.height=Math.max(0,this.preview.bounds.height-1)),this.preview.rotation=Number(this.state.style[mxConstants.STYLE_ROTATION]||"0"),this.preview.redraw());this.selectionBorder.bounds=this.bounds;this.selectionBorder.redraw()};mxVertexHandler.prototype.destroy=function(){null!=this.preview&&(this.preview.destroy(),this.preview=null);this.selectionBorder.destroy();this.labelShape=this.selectionBorder=null;if(null!=this.sizers){for(var b=0;b<this.sizers.length;b++){this.sizers[b].destroy(),this.sizers[b]=null}this.sizers=null}};function mxEdgeHandler(b){null!=b&&(this.state=b,this.init())}mxEdgeHandler.prototype.graph=null;mxEdgeHandler.prototype.state=null;mxEdgeHandler.prototype.marker=null;mxEdgeHandler.prototype.constraintHandler=null;mxEdgeHandler.prototype.error=null;mxEdgeHandler.prototype.shape=null;mxEdgeHandler.prototype.bends=null;mxEdgeHandler.prototype.labelShape=null;mxEdgeHandler.prototype.cloneEnabled=!0;mxEdgeHandler.prototype.addEnabled=!1;mxEdgeHandler.prototype.removeEnabled=!1;mxEdgeHandler.prototype.preferHtml=!1;mxEdgeHandler.prototype.allowHandleBoundsCheck=!0;mxEdgeHandler.prototype.snapToTerminals=!1;mxEdgeHandler.prototype.handleImage=null;mxEdgeHandler.prototype.tolerance=0;mxEdgeHandler.prototype.init=function(){this.graph=this.state.view.graph;this.marker=this.createMarker();this.constraintHandler=new mxConstraintHandler(this.graph);this.points=[];this.abspoints=this.getSelectionPoints(this.state);this.shape=this.createSelectionShape(this.abspoints);this.shape.dialect=this.graph.dialect!=mxConstants.DIALECT_SVG?mxConstants.DIALECT_MIXEDHTML:mxConstants.DIALECT_SVG;this.shape.init(this.graph.getView().getOverlayPane());this.shape.pointerEvents=!1;this.shape.node.style.cursor=mxConstants.CURSOR_MOVABLE_EDGE;mxEvent.redirectMouseEvents(this.shape.node,this.graph,this.state);this.preferHtml=null!=this.state.text&&this.state.text.node.parentNode==this.graph.container;if(!this.preferHtml){var b=this.state.getVisibleTerminalState(!0);null!=b&&(this.preferHtml=null!=b.text&&b.text.node.parentNode==this.graph.container);this.preferHtml||(b=this.state.getVisibleTerminalState(!1),null!=b&&(this.preferHtml=null!=b.text&&b.text.node.parentNode==this.graph.container))}if(this.graph.getSelectionCount()<mxGraphHandler.prototype.maxCells||0>=mxGraphHandler.prototype.maxCells){this.bends=this.createBends()}this.label=new mxPoint(this.state.absoluteOffset.x,this.state.absoluteOffset.y);this.labelShape=new mxRectangleShape(new mxRectangle,mxConstants.LABEL_HANDLE_FILLCOLOR,mxConstants.HANDLE_STROKECOLOR);this.initBend(this.labelShape);this.labelShape.node.style.cursor=mxConstants.CURSOR_LABEL_HANDLE;mxEvent.redirectMouseEvents(this.labelShape.node,this.graph,this.state);this.redraw()};mxEdgeHandler.prototype.isAddPointEvent=function(b){return mxEvent.isShiftDown(b)};mxEdgeHandler.prototype.isRemovePointEvent=function(b){return mxEvent.isShiftDown(b)};mxEdgeHandler.prototype.getSelectionPoints=function(b){return b.absolutePoints};mxEdgeHandler.prototype.createSelectionShape=function(b){b=new mxPolyline(b,this.getSelectionColor());b.strokewidth=this.getSelectionStrokeWidth();b.isDashed=this.isSelectionDashed();return b};mxEdgeHandler.prototype.getSelectionColor=function(){return mxConstants.EDGE_SELECTION_COLOR};mxEdgeHandler.prototype.getSelectionStrokeWidth=function(){return mxConstants.EDGE_SELECTION_STROKEWIDTH};mxEdgeHandler.prototype.isSelectionDashed=function(){return mxConstants.EDGE_SELECTION_DASHED};mxEdgeHandler.prototype.isConnectableCell=function(b){return !0};mxEdgeHandler.prototype.createMarker=function(){var d=new mxCellMarker(this.graph),c=this;d.getCell=function(b){var i=mxCellMarker.prototype.getCell.apply(this,arguments),h=c.getPointForEvent(b);if(i==c.state.cell||null==i){i=this.graph.getCellAt(h.x,h.y),c.state.cell==i&&(i=null)}var g=c.graph.getModel();if(this.graph.isSwimlane(i)&&this.graph.hitsSwimlaneContent(i,h.x,h.y)||!c.isConnectableCell(i)||i==c.state.cell||null!=i&&!c.graph.connectableEdges&&g.isEdge(i)||g.isAncestor(c.state.cell,i)){i=null}return i};d.isValidState=function(b){var e=c.graph.getModel(),e=c.graph.view.getTerminalPort(b,c.graph.view.getState(e.getTerminal(c.state.cell,!c.isSource)),!c.isSource),e=null!=e?e.cell:null;c.error=c.validateConnection(c.isSource?b.cell:e,c.isSource?e:b.cell);return null==c.error};return d};mxEdgeHandler.prototype.validateConnection=function(d,c){return this.graph.getEdgeValidationError(this.state.cell,d,c)};mxEdgeHandler.prototype.createBends=function(){for(var g=this.state.cell,f=[],k=0;k<this.abspoints.length;k++){if(this.isHandleVisible(k)){var i=k==this.abspoints.length-1;if((i=0==k||i)||this.graph.isCellBendable(g)){var h=this.createHandleShape(k);this.initBend(h);this.isHandleEnabled(k)&&(h.node.style.cursor=mxConstants.CURSOR_BEND_HANDLE,mxEvent.redirectMouseEvents(h.node,this.graph,this.state));f.push(h);i||(this.points.push(new mxPoint(0,0)),h.node.style.visibility="hidden")}}}return f};mxEdgeHandler.prototype.isHandleEnabled=function(b){return !0};mxEdgeHandler.prototype.isHandleVisible=function(b){return !0};mxEdgeHandler.prototype.createHandleShape=function(b){if(null!=this.handleImage){return b=new mxImageShape(new mxRectangle(0,0,this.handleImage.width,this.handleImage.height),this.handleImage.src),b.preserveImageAspect=!1,b}b=mxConstants.HANDLE_SIZE;this.preferHtml&&(b-=1);return new mxRectangleShape(new mxRectangle(0,0,b,b),mxConstants.HANDLE_FILLCOLOR,mxConstants.HANDLE_STROKECOLOR)};mxEdgeHandler.prototype.initBend=function(b){this.preferHtml?(b.dialect=mxConstants.DIALECT_STRICTHTML,b.init(this.graph.container)):(b.dialect=this.graph.dialect!=mxConstants.DIALECT_SVG?mxConstants.DIALECT_MIXEDHTML:mxConstants.DIALECT_SVG,b.init(this.graph.getView().getOverlayPane()))};mxEdgeHandler.prototype.getHandleForEvent=function(h){function g(a){if(null!=a&&"none"!=a.node.style.display&&"hidden"!=a.node.style.visibility&&(h.isSource(a)||null!=l&&mxUtils.intersects(a.bounds,l))){var d=h.getGraphX()-a.bounds.getCenterX();a=h.getGraphY()-a.bounds.getCenterY();d=d*d+a*a;if(null==k||d<=k){return k=d,!0}}return !1}var m=!mxEvent.isMouseEvent(h.getEvent())?this.tolerance:1,l=this.allowHandleBoundsCheck&&(mxClient.IS_IE||0<m)?new mxRectangle(h.getGraphX()-m,h.getGraphY()-m,2*m,2*m):null,k=null,m=null;if(h.isSource(this.state.text)||g(this.labelShape)){m=mxEvent.LABEL_HANDLE}if(null!=this.bends){for(var i=0;i<this.bends.length;i++){g(this.bends[i])&&(m=i)}}return m};mxEdgeHandler.prototype.mouseDown=function(e,d){var f=null,f=this.getHandleForEvent(d);this.addEnabled&&null==f&&this.isAddPointEvent(d.getEvent())?this.addPoint(this.state,d.getEvent()):null!=f&&(!d.isConsumed()&&this.graph.isEnabled())&&(this.removeEnabled&&this.isRemovePointEvent(d.getEvent())?this.removePoint(this.state,f):(f!=mxEvent.LABEL_HANDLE||this.graph.isLabelMovable(d.getCell()))&&this.start(d.getX(),d.getY(),f),d.consume())};mxEdgeHandler.prototype.start=function(e,d,f){this.startX=e;this.startY=d;this.isSource=null==this.bends?!1:0==f;this.isTarget=null==this.bends?!1:f==this.bends.length-1;this.isLabel=f==mxEvent.LABEL_HANDLE;if(this.isSource||this.isTarget){if(e=this.state.cell,d=this.graph.model.getTerminal(e,this.isSource),null==d&&this.graph.isTerminalPointMovable(e,this.isSource)||null!=d&&this.graph.isCellDisconnectable(e,d,this.isSource)){this.index=f}}else{this.index=f}};mxEdgeHandler.prototype.clonePreviewState=function(d,c){return this.state.clone()};mxEdgeHandler.prototype.getSnapToTerminalTolerance=function(){return this.graph.gridSize*this.graph.view.scale/2};mxEdgeHandler.prototype.getPointForEvent=function(k){var i=new mxPoint(k.getGraphX(),k.getGraphY()),q=this.getSnapToTerminalTolerance(),p=this.graph.getView(),o=!1,n=!1;if(this.snapToTerminals&&0<q){var m=function(b){if(null!=b){var c=b.x;Math.abs(i.x-c)<q&&(i.x=c,o=!0);b=b.y;Math.abs(i.y-b)<q&&(i.y=b,n=!0)}},l=function(b){null!=b&&m.call(this,new mxPoint(p.getRoutingCenterX(b),p.getRoutingCenterY(b)))};l.call(this,this.state.getVisibleTerminalState(!0));l.call(this,this.state.getVisibleTerminalState(!1));if(null!=this.abspoints){for(l=0;l<this.abspoints;l++){l!=this.index&&m.call(this,this.abspoints[l])}}}this.graph.isGridEnabledEvent(k.getEvent())&&(k=p.scale,l=p.translate,o||(i.x=(this.graph.snap(i.x/k-l.x)+l.x)*k),n||(i.y=(this.graph.snap(i.y/k-l.y)+l.y)*k));return i};mxEdgeHandler.prototype.getPreviewTerminalState=function(d){this.constraintHandler.update(d,this.isSource);this.marker.process(d);d=this.marker.getValidState();var c=null;null!=this.constraintHandler.currentFocus&&null!=this.constraintHandler.currentConstraint&&this.marker.reset();null!=d?c=d:null!=this.constraintHandler.currentConstraint&&null!=this.constraintHandler.currentFocus&&(c=this.constraintHandler.currentFocus);return c};mxEdgeHandler.prototype.getPreviewPoints=function(d){var c=this.graph.getCellGeometry(this.state.cell),c=null!=c.points?c.points.slice():null;!this.isSource&&!this.isTarget?(this.convertPoint(d,!1),null==c?c=[d]:c[this.index-1]=d):this.graph.resetEdgesOnConnect&&(c=null);return c};mxEdgeHandler.prototype.updatePreviewState=function(k,i,q){var p=this.isSource?q:this.state.getVisibleTerminalState(!0),o=this.isTarget?q:this.state.getVisibleTerminalState(!1),n=this.graph.getConnectionConstraint(k,p,!0),m=this.graph.getConnectionConstraint(k,o,!1),l=this.constraintHandler.currentConstraint;null==l&&(l=new mxConnectionConstraint);this.isSource?n=l:this.isTarget&&(m=l);(!this.isSource||null!=p)&&k.view.updateFixedTerminalPoint(k,p,!0,n);(!this.isTarget||null!=o)&&k.view.updateFixedTerminalPoint(k,o,!1,m);if((this.isSource||this.isTarget)&&null==q){k.setAbsoluteTerminalPoint(i,this.isSource),null==this.marker.getMarkedState()&&(this.error=this.graph.allowDanglingEdges?null:"")}k.view.updatePoints(k,this.points,p,o);k.view.updateFloatingTerminalPoints(k,p,o)};mxEdgeHandler.prototype.mouseMove=function(g,f){if(null!=this.index&&null!=this.marker){var k=this.getPointForEvent(f);if(this.isLabel){this.label.x=k.x,this.label.y=k.y}else{this.points=this.getPreviewPoints(k);var i=null;if(!this.graph.disconnerctNode){i=this.isSource||this.isTarget?this.getPreviewTerminalState(f):null}var h=this.clonePreviewState(k,null!=i?i.cell:null);this.updatePreviewState(h,k,i);if(!this.graph.disconnerctNode){this.setPreviewColor(null==this.error?this.marker.validColor:this.marker.invalidColor)}this.abspoints=h.absolutePoints;this.active=!0}this.drawPreview();mxEvent.consume(f.getEvent());f.consume()}else{mxClient.IS_IE&&null!=this.getHandleForEvent(f)&&f.consume(!1)}};mxEdgeHandler.prototype.mouseUp=function(g,f){if(null!=this.index&&null!=this.marker){var k=this.state.cell;if(f.getX()!=this.startX||f.getY()!=this.startY){if(null!=this.error){0<this.error.length&&this.graph.validationAlert(this.error)}else{if(this.isLabel){this.moveLabel(this.state,this.label.x,this.label.y)}else{if(this.isSource||this.isTarget){var i=null;null!=this.constraintHandler.currentConstraint&&null!=this.constraintHandler.currentFocus&&(i=this.constraintHandler.currentFocus.cell);null==i&&this.marker.hasValidState()&&(i=this.marker.validState.cell);if(this.graph.disconnerctNode){i=null}if(null!=i){k=this.connect(k,i,this.isSource,this.graph.isCloneEvent(f.getEvent())&&this.cloneEnabled&&this.graph.isCellsCloneable(),f)}else{if(this.graph.isAllowDanglingEdges()){i=this.abspoints[this.isSource?0:this.abspoints.length-1];i.x=i.x/this.graph.view.scale-this.graph.view.translate.x;i.y=i.y/this.graph.view.scale-this.graph.view.translate.y;var h=this.graph.getView().getState(this.graph.getModel().getParent(k));null!=h&&(i.x-=h.origin.x,i.y-=h.origin.y);i.x-=this.graph.panDx/this.graph.view.scale;i.y-=this.graph.panDy/this.graph.view.scale;this.changeTerminalPoint(k,i,this.isSource)}}}else{this.active?this.changePoints(k,this.points):(this.graph.getView().invalidate(this.state.cell),this.graph.getView().revalidate(this.state.cell))}}}}null!=this.marker&&(this.reset(),k!=this.state.cell&&this.graph.setSelectionCell(k));f.consume()}};mxEdgeHandler.prototype.reset=function(){this.points=this.label=this.index=this.error=null;this.isTarget=this.isSource=this.isLabel=this.active=!1;this.marker.reset();this.constraintHandler.reset();this.setPreviewColor(mxConstants.EDGE_SELECTION_COLOR);this.redraw()};mxEdgeHandler.prototype.setPreviewColor=function(b){null!=this.shape&&(this.shape.stroke=b)};mxEdgeHandler.prototype.convertPoint=function(f,e){var h=this.graph.getView().getScale(),g=this.graph.getView().getTranslate();e&&(f.x=this.graph.snap(f.x),f.y=this.graph.snap(f.y));f.x=Math.round(f.x/h-g.x);f.y=Math.round(f.y/h-g.y);h=this.graph.getView().getState(this.graph.getModel().getParent(this.state.cell));null!=h&&(f.x-=h.origin.x,f.y-=h.origin.y);return f};mxEdgeHandler.prototype.moveLabel=function(i,h,o){var n=this.graph.getModel(),m=n.getGeometry(i.cell);if(null!=m){var m=m.clone(),l=this.graph.getView().getRelativePoint(i,h,o);m.x=l.x;m.y=l.y;var k=this.graph.getView().scale;m.offset=new mxPoint(0,0);l=this.graph.view.getPoint(i,m);m.offset=new mxPoint((h-l.x)/k,(o-l.y)/k);n.setGeometry(i.cell,m)}};mxEdgeHandler.prototype.connect=function(s,r,q,p,o){o=this.graph.getModel();var n=o.getParent(s);o.beginUpdate();try{if(p){var m=s.clone();o.add(n,m,o.getChildCount(n));var l=o.getTerminal(s,!q);this.graph.connectCell(m,l,!q);s=m}var i=this.constraintHandler.currentConstraint;null==i&&(i=new mxConnectionConstraint);this.graph.connectCell(s,r,q,i)}finally{o.endUpdate()}return s};mxEdgeHandler.prototype.changeTerminalPoint=function(g,f,k){var i=this.graph.getModel(),h=i.getGeometry(g);if(null!=h){i.beginUpdate();try{h=h.clone(),h.setTerminalPoint(f,k),i.setGeometry(g,h),this.graph.connectCell(g,null,k,new mxConnectionConstraint)}finally{i.endUpdate()}}};mxEdgeHandler.prototype.changePoints=function(f,e){var h=this.graph.getModel(),g=h.getGeometry(f);null!=g&&(g=g.clone(),g.points=e,h.setGeometry(f,g))};mxEdgeHandler.prototype.addPoint=function(f,e){var h=mxUtils.convertPoint(this.graph.container,mxEvent.getClientX(e),mxEvent.getClientY(e)),g=this.graph.isGridEnabledEvent(e);this.convertPoint(h,g);this.addPointAt(f,h.x,h.y);mxEvent.consume(e)};mxEdgeHandler.prototype.addPointAt=function(g,f,k){var i=this.graph.getCellGeometry(g.cell);f=new mxPoint(f,k);if(null!=i){i=i.clone();k=this.graph.view.translate;var h=this.graph.view.scale;k=mxUtils.findNearestSegment(g,(f.x+k.x)*h,(f.y+k.y)*h);null==i.points?i.points=[f]:i.points.splice(k,0,f);this.graph.getModel().setGeometry(g.cell,i);this.destroy();this.init()}};mxEdgeHandler.prototype.removePoint=function(e,d){if(0<d&&d<this.abspoints.length-1){var f=this.graph.getCellGeometry(this.state.cell);null!=f&&null!=f.points&&(f=f.clone(),f.points.splice(d-1,1),this.graph.getModel().setGeometry(e.cell,f),this.destroy(),this.init())}};mxEdgeHandler.prototype.getHandleFillColor=function(f){f=0==f;var e=this.state.cell,h=this.graph.getModel().getTerminal(e,f),g=mxConstants.HANDLE_FILLCOLOR;null!=h&&!this.graph.isCellDisconnectable(e,h,f)||null==h&&!this.graph.isTerminalPointMovable(e,f)?g=mxConstants.LOCKED_HANDLE_FILLCOLOR:null!=h&&this.graph.isCellDisconnectable(e,h,f)&&(g=mxConstants.CONNECT_HANDLE_FILLCOLOR);return g};mxEdgeHandler.prototype.redraw=function(){this.abspoints=this.state.absolutePoints.slice();this.redrawHandles();var d=this.graph.getModel().getGeometry(this.state.cell).points;if(null!=this.bends&&0<this.bends.length&&null!=d){null==this.points&&(this.points=[]);for(var c=1;c<this.bends.length-1;c++){null!=this.bends[c]&&null!=this.abspoints[c]&&(this.points[c-1]=d[c-1])}}this.drawPreview()};mxEdgeHandler.prototype.redrawHandles=function(){var h=this.state.cell,g=mxConstants.LABEL_HANDLE_SIZE;this.label=new mxPoint(this.state.absoluteOffset.x,this.state.absoluteOffset.y);this.labelShape.bounds=new mxRectangle(Math.round(this.label.x-g/2),Math.round(this.label.y-g/2),g,g);this.labelShape.redraw();g=this.graph.getLabel(h);null!=g&&0<g.length&&this.graph.isLabelMovable(h)?this.labelShape.node.style.visibility="visible":this.labelShape.node.style.visibility="hidden";if(null!=this.bends&&0<this.bends.length){var m=this.abspoints.length-1,h=this.abspoints[0],l=this.abspoints[0].y,g=this.bends[0].bounds;this.bends[0].bounds=new mxRectangle(Math.round(this.abspoints[0].x-g.width/2),Math.round(l-g.height/2),g.width,g.height);this.bends[0].fill=this.getHandleFillColor(0);this.bends[0].redraw();var l=this.abspoints[m],k=this.abspoints[m].x,m=this.abspoints[m].y,i=this.bends.length-1,g=this.bends[i].bounds;this.bends[i].bounds=new mxRectangle(Math.round(k-g.width/2),Math.round(m-g.height/2),g.width,g.height);this.bends[i].fill=this.getHandleFillColor(i);this.bends[i].redraw();this.redrawInnerBends(h,l)}};mxEdgeHandler.prototype.redrawInnerBends=function(h,g){for(var m=1;m<this.bends.length-1;m++){if(null!=this.bends[m]){if(null!=this.abspoints[m]){var l=this.abspoints[m].x,k=this.abspoints[m].y,i=this.bends[m].bounds;this.bends[m].node.style.visibility="visible";this.bends[m].bounds=new mxRectangle(Math.round(l-i.width/2),Math.round(k-i.height/2),i.width,i.height);this.bends[m].redraw()}else{this.bends[m].destroy(),this.bends[m]=null}}}};mxEdgeHandler.prototype.drawPreview=function(){if(this.isLabel){var b=mxConstants.LABEL_HANDLE_SIZE,b=new mxRectangle(Math.round(this.label.x-b/2),Math.round(this.label.y-b/2),b,b);this.labelShape.bounds=b;this.labelShape.redraw()}else{this.shape.points=this.abspoints,this.shape.redraw()}};mxEdgeHandler.prototype.destroy=function(){null!=this.marker&&(this.marker.destroy(),this.marker=null);null!=this.shape&&(this.shape.destroy(),this.shape=null);null!=this.labelShape&&(this.labelShape.destroy(),this.labelShape=null);null!=this.constraintHandler&&(this.constraintHandler.destroy(),this.constraintHandler=null);if(null!=this.bends){for(var b=0;b<this.bends.length;b++){null!=this.bends[b]&&(this.bends[b].destroy(),this.bends[b]=null)}this.bends=null}};function mxElbowEdgeHandler(b){mxEdgeHandler.call(this,b)}mxUtils.extend(mxElbowEdgeHandler,mxEdgeHandler);mxElbowEdgeHandler.prototype=new mxEdgeHandler;mxElbowEdgeHandler.prototype.constructor=mxElbowEdgeHandler;mxElbowEdgeHandler.prototype.flipEnabled=!0;mxElbowEdgeHandler.prototype.doubleClickOrientationResource="none"!=mxClient.language?"doubleClickOrientation":"";mxElbowEdgeHandler.prototype.createBends=function(){var d=[],c=this.createHandleShape(0);this.initBend(c);c.node.style.cursor=mxConstants.CURSOR_BEND_HANDLE;mxEvent.redirectMouseEvents(c.node,this.graph,this.state);d.push(c);mxClient.IS_TOUCH&&c.node.setAttribute("pointer-events","none");d.push(this.createVirtualBend());this.points.push(new mxPoint(0,0));c=this.createHandleShape(2);this.initBend(c);c.node.style.cursor=mxConstants.CURSOR_BEND_HANDLE;mxEvent.redirectMouseEvents(c.node,this.graph,this.state);d.push(c);mxClient.IS_TOUCH&&c.node.setAttribute("pointer-events","none");return d};mxElbowEdgeHandler.prototype.createVirtualBend=function(){var d=this.createHandleShape();this.initBend(d);var c=this.getCursorForBend();d.node.style.cursor=c;c=mxUtils.bind(this,function(b){!mxEvent.isConsumed(b)&&this.flipEnabled&&(this.graph.flipEdge(this.state.cell,b),mxEvent.consume(b))});mxEvent.redirectMouseEvents(d.node,this.graph,this.state,null,null,null,c);this.graph.isCellBendable(this.state.cell)||(d.node.style.display="none");return d};mxElbowEdgeHandler.prototype.getCursorForBend=function(){return this.state.style[mxConstants.STYLE_EDGE]==mxEdgeStyle.TopToBottom||this.state.style[mxConstants.STYLE_EDGE]==mxConstants.EDGESTYLE_TOPTOBOTTOM||(this.state.style[mxConstants.STYLE_EDGE]==mxEdgeStyle.ElbowConnector||this.state.style[mxConstants.STYLE_EDGE]==mxConstants.EDGESTYLE_ELBOW)&&this.state.style[mxConstants.STYLE_ELBOW]==mxConstants.ELBOW_VERTICAL?"row-resize":"col-resize"};mxElbowEdgeHandler.prototype.getTooltipForNode=function(d){var c=null;if(null!=this.bends&&null!=this.bends[1]&&(d==this.bends[1].node||d.parentNode==this.bends[1].node)){c=this.doubleClickOrientationResource,c=mxResources.get(c)||c}return c};mxElbowEdgeHandler.prototype.convertPoint=function(g,f){var k=this.graph.getView().getScale(),i=this.graph.getView().getTranslate(),h=this.state.origin;f&&(g.x=this.graph.snap(g.x),g.y=this.graph.snap(g.y));g.x=Math.round(g.x/k-i.x-h.x);g.y=Math.round(g.y/k-i.y-h.y)};mxElbowEdgeHandler.prototype.redrawInnerBends=function(h,g){var m=this.graph.getModel().getGeometry(this.state.cell),l=this.state.absolutePoints,k=null;1<l.length?(h=l[1],g=l[l.length-2]):null!=m.points&&0<m.points.length&&(k=l[0]);k=null==k?new mxPoint(h.x+(g.x-h.x)/2,h.y+(g.y-h.y)/2):new mxPoint(this.graph.getView().scale*(k.x+this.graph.getView().translate.x+this.state.origin.x),this.graph.getView().scale*(k.y+this.graph.getView().translate.y+this.state.origin.y));l=this.bends[1].bounds;m=l.width;l=l.height;null==this.handleImage&&(l=m=mxConstants.HANDLE_SIZE);var i=new mxRectangle(Math.round(k.x-m/2),Math.round(k.y-l/2),m,l);null==this.handleImage&&("hidden"!=this.labelShape.node.style.visibility&&mxUtils.intersects(i,this.labelShape.bounds))&&(m+=3,l+=3,i=new mxRectangle(Math.round(k.x-m/2),Math.round(k.y-l/2),m,l));this.bends[1].bounds=i;this.bends[1].redraw()};function mxEdgeSegmentHandler(b){mxEdgeHandler.call(this,b)}mxUtils.extend(mxEdgeSegmentHandler,mxEdgeHandler);mxEdgeSegmentHandler.prototype=new mxElbowEdgeHandler;mxEdgeSegmentHandler.prototype.constructor=mxEdgeSegmentHandler;mxEdgeSegmentHandler.prototype.getPreviewPoints=function(k){if(this.isSource||this.isTarget){return mxElbowEdgeHandler.prototype.getPreviewPoints.apply(this,arguments)}this.convertPoint(k,!1);var i=this.state.absolutePoints,q=i[0].clone();this.convertPoint(q,!1);for(var p=[],o=1;o<i.length;o++){var n=i[o].clone();this.convertPoint(n,!1);o==this.index&&(q.x==n.x?(q.x=k.x,n.x=k.x):(q.y=k.y,n.y=k.y));o<i.length-1&&p.push(n);q=n}if(1==p.length){if(q=this.state.view,o=this.state.getVisibleTerminalState(!0),n=this.state.getVisibleTerminalState(!1),null!=n&null!=o){var m=this.state.origin.x,l=this.state.origin.y;mxUtils.contains(n,p[0].x+m,p[0].y+l)?i[1].y==i[2].y?p[0].y=q.getRoutingCenterY(o)-l:p[0].x=q.getRoutingCenterX(o)-m:mxUtils.contains(o,p[0].x+m,p[0].y+l)&&(i[1].y==i[0].y?p[0].y=q.getRoutingCenterY(n)-l:p[0].x=q.getRoutingCenterX(n)-m)}}else{0==p.length&&(p=[k])}return p};mxEdgeSegmentHandler.prototype.createBends=function(){var f=[],e=this.createHandleShape(0);this.initBend(e);e.node.style.cursor=mxConstants.CURSOR_BEND_HANDLE;mxEvent.redirectMouseEvents(e.node,this.graph,this.state);f.push(e);mxClient.IS_TOUCH&&e.node.setAttribute("pointer-events","none");var h=this.state.absolutePoints;if(this.graph.isCellBendable(this.state.cell)){null==this.points&&(this.points=[]);for(var g=0;g<h.length-1;g++){e=this.createVirtualBend(),f.push(e),e.node.style.cursor=0==h[g].x-h[g+1].x?"col-resize":"row-resize",this.points.push(new mxPoint(0,0)),mxClient.IS_TOUCH&&e.node.setAttribute("pointer-events","none")}}e=this.createHandleShape(h.length);this.initBend(e);e.node.style.cursor=mxConstants.CURSOR_BEND_HANDLE;mxEvent.redirectMouseEvents(e.node,this.graph,this.state);f.push(e);mxClient.IS_TOUCH&&e.node.setAttribute("pointer-events","none");return f};mxEdgeSegmentHandler.prototype.redraw=function(){this.refresh();mxEdgeHandler.prototype.redraw.apply(this,arguments)};mxEdgeSegmentHandler.prototype.refresh=function(){if(null!=this.bends){for(var b=0;b<this.bends.length;b++){null!=this.bends[b]&&(this.bends[b].destroy(),this.bends[b]=null)}this.bends=this.createBends()}};mxEdgeSegmentHandler.prototype.redrawInnerBends=function(h,g){if(this.graph.isCellBendable(this.state.cell)){var m=mxConstants.HANDLE_SIZE,l=this.state.absolutePoints;if(null!=l&&1<l.length){for(var k=0;k<this.state.absolutePoints.length-1;k++){if(null!=this.bends[k+1]){h=l[k];g=l[k+1];var i=new mxPoint(h.x+(g.x-h.x)/2,h.y+(g.y-h.y)/2);this.bends[k+1].bounds=new mxRectangle(Math.round(i.x-m/2),Math.round(i.y-m/2),m,m);this.bends[k+1].redraw()}}}}};mxEdgeSegmentHandler.prototype.changePoints=function(i,h){h=[];var o=this.abspoints;if(1<o.length){for(var n=o[0],m=o[1],l=2;l<o.length;l++){var k=o[l];if((Math.round(n.x)!=Math.round(m.x)||Math.round(m.x)!=Math.round(k.x))&&(Math.round(n.y)!=Math.round(m.y)||Math.round(m.y)!=Math.round(k.y))){n=m,m=m.clone(),this.convertPoint(m,!1),h.push(m)}m=k}}mxElbowEdgeHandler.prototype.changePoints.apply(this,arguments)};function mxKeyHandler(d,c){null!=d&&(this.graph=d,this.target=c||document.documentElement,this.normalKeys=[],this.shiftKeys=[],this.controlKeys=[],this.controlShiftKeys=[],this.keydownHandler=mxUtils.bind(this,function(b){this.keyDown(b)}),mxEvent.addListener(this.target,"keydown",this.keydownHandler),mxClient.IS_IE&&mxEvent.addListener(window,"unload",mxUtils.bind(this,function(){this.destroy()})))}mxKeyHandler.prototype.graph=null;mxKeyHandler.prototype.target=null;mxKeyHandler.prototype.normalKeys=null;mxKeyHandler.prototype.shiftKeys=null;mxKeyHandler.prototype.controlKeys=null;mxKeyHandler.prototype.controlShiftKeys=null;mxKeyHandler.prototype.enabled=!0;mxKeyHandler.prototype.isEnabled=function(){return this.enabled};mxKeyHandler.prototype.setEnabled=function(b){this.enabled=b};mxKeyHandler.prototype.bindKey=function(d,c){this.normalKeys[d]=c};mxKeyHandler.prototype.bindShiftKey=function(d,c){this.shiftKeys[d]=c};mxKeyHandler.prototype.bindControlKey=function(d,c){this.controlKeys[d]=c};mxKeyHandler.prototype.bindControlShiftKey=function(d,c){this.controlShiftKeys[d]=c};mxKeyHandler.prototype.isControlDown=function(b){return mxEvent.isControlDown(b)};mxKeyHandler.prototype.getFunction=function(b){return null!=b?this.isControlDown(b)?mxEvent.isShiftDown(b)?this.controlShiftKeys[b.keyCode]:this.controlKeys[b.keyCode]:mxEvent.isShiftDown(b)?this.shiftKeys[b.keyCode]:this.normalKeys[b.keyCode]:null};mxKeyHandler.prototype.isGraphEvent=function(b){b=mxEvent.getSource(b);if(b==this.target||b.parentNode==this.target||null!=this.graph.cellEditor&&b==this.graph.cellEditor.textarea){return !0}for(;null!=b;){if(b==this.graph.container){return !0}b=b.parentNode}return !1};mxKeyHandler.prototype.keyDown=function(d){if(this.graph.isEnabled()&&!mxEvent.isConsumed(d)&&this.isGraphEvent(d)&&this.isEnabled()){if(27==d.keyCode){this.escape(d)}else{if(!this.graph.isEditing()){var c=this.getFunction(d);null!=c&&(c(d),mxEvent.consume(d))}}}};mxKeyHandler.prototype.escape=function(b){this.graph.isEscapeEnabled()&&this.graph.escape(b)};mxKeyHandler.prototype.destroy=function(){null!=this.target&&null!=this.keydownHandler&&(mxEvent.removeListener(this.target,"keydown",this.keydownHandler),this.keydownHandler=null);this.target=null};function mxTooltipHandler(d,c){null!=d&&(this.graph=d,this.delay=c||500,this.graph.addMouseListener(this))}mxTooltipHandler.prototype.zIndex=10005;mxTooltipHandler.prototype.graph=null;mxTooltipHandler.prototype.delay=null;mxTooltipHandler.prototype.ignoreTouchEvents=!0;mxTooltipHandler.prototype.hideOnHover=!1;mxTooltipHandler.prototype.enabled=!0;mxTooltipHandler.prototype.isEnabled=function(){return this.enabled};mxTooltipHandler.prototype.setEnabled=function(b){this.enabled=b};mxTooltipHandler.prototype.isHideOnHover=function(){return this.hideOnHover};mxTooltipHandler.prototype.setHideOnHover=function(b){this.hideOnHover=b};mxTooltipHandler.prototype.init=function(){null!=document.body&&(this.div=document.createElement("div"),this.div.className="mxTooltip",this.div.style.visibility="hidden",document.body.appendChild(this.div),mxEvent.addGestureListeners(this.div,mxUtils.bind(this,function(b){this.hideTooltip()})))};mxTooltipHandler.prototype.mouseDown=function(d,c){this.reset(c,!1);this.hideTooltip()};mxTooltipHandler.prototype.mouseMove=function(d,c){if(c.getX()!=this.lastX||c.getY()!=this.lastY){this.reset(c,!0),(this.isHideOnHover()||c.getState()!=this.state||c.getSource()!=this.node&&(!this.stateSource||null!=c.getState()&&this.stateSource==(c.isSource(c.getState().shape)||!c.isSource(c.getState().text))))&&this.hideTooltip()}this.lastX=c.getX();this.lastY=c.getY()};mxTooltipHandler.prototype.mouseUp=function(d,c){this.reset(c,!0);this.hideTooltip()};mxTooltipHandler.prototype.resetTimer=function(){null!=this.thread&&(window.clearTimeout(this.thread),this.thread=null)};mxTooltipHandler.prototype.reset=function(i,h){if(!this.ignoreTouchEvents||mxEvent.isMouseEvent(i.getEvent())){if(this.resetTimer(),h&&this.isEnabled()&&null!=i.getState()&&(null==this.div||"hidden"==this.div.style.visibility)){var o=i.getState(),n=i.getSource(),m=i.getX(),l=i.getY(),k=i.isSource(o.shape)||i.isSource(o.text);this.thread=window.setTimeout(mxUtils.bind(this,function(){if(!this.graph.isEditing()&&!this.graph.popupMenuHandler.isMenuShowing()){var b=this.graph.getTooltip(o,n,m,l);this.show(b,m,l);this.state=o;this.node=n;this.stateSource=k}}),this.delay)}}};mxTooltipHandler.prototype.hide=function(){this.resetTimer();this.hideTooltip()};mxTooltipHandler.prototype.hideTooltip=function(){null!=this.div&&(this.div.style.visibility="hidden")};mxTooltipHandler.prototype.show=function(f,e,h){if(null!=f&&0<f.length){null==this.div&&this.init();var g=mxUtils.getScrollOrigin();this.div.style.zIndex=this.zIndex;this.div.style.left=e+g.x+"px";this.div.style.top=h+mxConstants.TOOLTIP_VERTICAL_OFFSET+g.y+"px";mxUtils.isNode(f)?(this.div.innerHTML="",this.div.appendChild(f)):this.div.innerHTML=f.replace(/\n/g,"<br>");this.div.style.visibility="";mxUtils.fit(this.div)}};mxTooltipHandler.prototype.destroy=function(){this.graph.removeMouseListener(this);mxEvent.release(this.div);null!=this.div&&null!=this.div.parentNode&&this.div.parentNode.removeChild(this.div);this.div=null};function mxCellTracker(e,d,f){mxCellMarker.call(this,e,d);this.graph.addMouseListener(this);null!=f&&(this.getCell=f);mxClient.IS_IE&&mxEvent.addListener(window,"unload",mxUtils.bind(this,function(){this.destroy()}))}mxUtils.extend(mxCellTracker,mxCellMarker);mxCellTracker.prototype.mouseDown=function(d,c){};mxCellTracker.prototype.mouseMove=function(d,c){this.isEnabled()&&this.process(c)};mxCellTracker.prototype.mouseUp=function(d,c){this.reset()};mxCellTracker.prototype.destroy=function(){this.destroyed||(this.destroyed=!0,this.graph.removeMouseListener(this),mxCellMarker.prototype.destroy.apply(this))};function mxCellHighlight(f,e,h,g){null!=f&&(this.graph=f,this.highlightColor=null!=e?e:mxConstants.DEFAULT_VALID_COLOR,this.strokeWidth=null!=h?h:mxConstants.HIGHLIGHT_STROKEWIDTH,this.dashed=null!=g?g:!1,this.repaintHandler=mxUtils.bind(this,function(){null!=this.state&&(this.state=this.graph.view.getState(this.state.cell),null==this.state?this.hide():this.repaint())}),this.graph.getView().addListener(mxEvent.SCALE,this.repaintHandler),this.graph.getView().addListener(mxEvent.TRANSLATE,this.repaintHandler),this.graph.getView().addListener(mxEvent.SCALE_AND_TRANSLATE,this.repaintHandler),this.graph.getModel().addListener(mxEvent.CHANGE,this.repaintHandler),this.resetHandler=mxUtils.bind(this,function(){this.hide()}),this.graph.getView().addListener(mxEvent.DOWN,this.resetHandler),this.graph.getView().addListener(mxEvent.UP,this.resetHandler))}mxCellHighlight.prototype.keepOnTop=!1;mxCellHighlight.prototype.graph=!0;mxCellHighlight.prototype.state=null;mxCellHighlight.prototype.spacing=2;mxCellHighlight.prototype.resetHandler=null;mxCellHighlight.prototype.setHighlightColor=function(b){this.highlightColor=b;null!=this.shape&&(this.shape.stroke=b)};mxCellHighlight.prototype.drawHighlight=function(){this.shape=this.createShape();this.repaint();!this.keepOnTop&&this.shape.node.parentNode.firstChild!=this.shape.node&&this.shape.node.parentNode.insertBefore(this.shape.node,this.shape.node.parentNode.firstChild)};mxCellHighlight.prototype.createShape=function(){var b=null,b=this.graph.model.isEdge(this.state.cell)?new mxPolyline(this.state.absolutePoints,this.highlightColor,this.strokeWidth):new mxRectangleShape(new mxRectangle,null,this.highlightColor,this.strokeWidth);b.dialect=this.graph.dialect!=mxConstants.DIALECT_SVG?mxConstants.DIALECT_VML:mxConstants.DIALECT_SVG;b.init(this.graph.getView().getOverlayPane());mxEvent.redirectMouseEvents(b.node,this.graph,this.state);b.pointerEvents=!1;b.isDashed=this.dashed;return b};mxCellHighlight.prototype.repaint=function(){null!=this.state&&null!=this.shape&&(this.graph.model.isEdge(this.state.cell)?this.shape.points=this.state.absolutePoints:(this.shape.bounds=new mxRectangle(this.state.x-this.spacing,this.state.y-this.spacing,this.state.width+2*this.spacing,this.state.height+2*this.spacing),this.shape.rotation=Number(this.state.style[mxConstants.STYLE_ROTATION]||"0")),null!=this.state.shape&&this.shape.setCursor(this.state.shape.getCursor()),this.shape.redraw())};mxCellHighlight.prototype.hide=function(){this.highlight(null)};mxCellHighlight.prototype.highlight=function(b){this.state!=b&&(null!=this.shape&&(this.shape.destroy(),this.shape=null),this.state=b,null!=this.state&&this.drawHighlight())};mxCellHighlight.prototype.destroy=function(){this.graph.getView().removeListener(this.repaintHandler);this.graph.getModel().removeListener(this.repaintHandler);this.graph.getView().removeListener(this.resetHandler);this.graph.getModel().removeListener(this.resetHandler);null!=this.shape&&(this.shape.destroy(),this.shape=null)};function mxDefaultKeyHandler(d){if(null!=d){this.editor=d;this.handler=new mxKeyHandler(d.graph);var c=this.handler.escape;this.handler.escape=function(a){c.apply(this,arguments);d.hideProperties();d.fireEvent(new mxEventObject(mxEvent.ESCAPE,"event",a))}}}mxDefaultKeyHandler.prototype.editor=null;mxDefaultKeyHandler.prototype.handler=null;mxDefaultKeyHandler.prototype.bindAction=function(f,e,h){var g=mxUtils.bind(this,function(){this.editor.execute(e)});h?this.handler.bindControlKey(f,g):this.handler.bindKey(f,g)};mxDefaultKeyHandler.prototype.destroy=function(){this.handler.destroy();this.handler=null};function mxDefaultPopupMenu(b){this.config=b}mxDefaultPopupMenu.prototype.imageBasePath=null;mxDefaultPopupMenu.prototype.config=null;mxDefaultPopupMenu.prototype.createMenu=function(g,f,k,i){if(null!=this.config){var h=this.createConditions(g,k,i);this.addItems(g,f,k,i,h,this.config.firstChild,null)}};mxDefaultPopupMenu.prototype.addItems=function(a,b,c,d,e,f,g){for(var h=!1;null!=f;){if("add"==f.nodeName){var k=f.getAttribute("if");if(null==k||e[k]){var k=f.getAttribute("as"),k=mxResources.get(k)||k,l=mxUtils.eval(mxUtils.getTextContent(f)),m=f.getAttribute("action"),n=f.getAttribute("icon"),p=f.getAttribute("iconCls");h&&(b.addSeparator(g),h=!1);null!=n&&this.imageBasePath&&(n=this.imageBasePath+n);k=this.addAction(b,a,k,n,l,m,c,g,p);this.addItems(a,b,c,d,e,f.firstChild,k)}}else{"separator"==f.nodeName&&(h=!0)}f=f.nextSibling}};mxDefaultPopupMenu.prototype.addAction=function(s,r,q,p,o,n,m,l,i){return s.addItem(q,p,function(b){"function"==typeof o&&o.call(r,r,m,b);null!=n&&r.execute(n,m,b)},l,i)};mxDefaultPopupMenu.prototype.createConditions=function(a,b,c){var d=a.graph.getModel(),e=d.getChildCount(b),f=[];f.nocell=null==b;f.ncells=1<a.graph.getSelectionCount();f.notRoot=d.getRoot()!=d.getParent(a.graph.getDefaultParent());f.cell=null!=b;d=null!=b&&1==a.graph.getSelectionCount();f.nonEmpty=d&&0<e;f.expandable=d&&a.graph.isCellFoldable(b,!1);f.collapsable=d&&a.graph.isCellFoldable(b,!0);f.validRoot=d&&a.graph.isValidRoot(b);f.emptyValidRoot=f.validRoot&&0==e;f.swimlane=d&&a.graph.isSwimlane(b);e=this.config.getElementsByTagName("condition");for(d=0;d<e.length;d++){var g=mxUtils.eval(mxUtils.getTextContent(e[d])),h=e[d].getAttribute("name");null!=h&&"function"==typeof g&&(f[h]=g(a,b,c))}return f};function mxDefaultToolbar(d,c){this.editor=c;null!=d&&null!=c&&this.init(d)}mxDefaultToolbar.prototype.editor=null;mxDefaultToolbar.prototype.toolbar=null;mxDefaultToolbar.prototype.resetHandler=null;mxDefaultToolbar.prototype.spacing=4;mxDefaultToolbar.prototype.connectOnDrop=!1;mxDefaultToolbar.prototype.init=function(b){null!=b&&(this.toolbar=new mxToolbar(b),this.toolbar.addListener(mxEvent.SELECT,mxUtils.bind(this,function(e,g){var f=g.getProperty("function");this.editor.insertFunction=null!=f?mxUtils.bind(this,function(){f.apply(this,arguments);this.toolbar.resetMode()}):null})),this.resetHandler=mxUtils.bind(this,function(){null!=this.toolbar&&this.toolbar.resetMode(!0)}),this.editor.graph.addListener(mxEvent.DOUBLE_CLICK,this.resetHandler),this.editor.addListener(mxEvent.ESCAPE,this.resetHandler))};mxDefaultToolbar.prototype.addItem=function(g,f,k,i){var h=mxUtils.bind(this,function(){null!=k&&0<k.length&&this.editor.execute(k)});return this.toolbar.addItem(g,f,h,i)};mxDefaultToolbar.prototype.addSeparator=function(b){b=b||mxClient.imageBasePath+"/separator.gif";this.toolbar.addSeparator(b)};mxDefaultToolbar.prototype.addCombo=function(){return this.toolbar.addCombo()};mxDefaultToolbar.prototype.addActionCombo=function(b){return this.toolbar.addActionCombo(b)};mxDefaultToolbar.prototype.addActionOption=function(f,e,h){var g=mxUtils.bind(this,function(){this.editor.execute(h)});this.addOption(f,e,g)};mxDefaultToolbar.prototype.addOption=function(e,d,f){return this.toolbar.addOption(e,d,f)};mxDefaultToolbar.prototype.addMode=function(h,g,m,l,k){var i=mxUtils.bind(this,function(){this.editor.setMode(m);null!=k&&k(this.editor)});return this.toolbar.addSwitchMode(h,g,i,l)};mxDefaultToolbar.prototype.addPrototype=function(k,i,q,p,o,n){var m=function(){return"function"==typeof q?q():null!=q?q.clone():null},l=mxUtils.bind(this,function(d,c){"function"==typeof o?o(this.editor,m(),d,c):this.drop(m(),d,c);this.toolbar.resetMode();mxEvent.consume(d)});k=this.toolbar.addMode(k,i,l,p,null,n);this.installDropHandler(k,function(e,d,f){l(d,f)});return k};mxDefaultToolbar.prototype.drop=function(g,f,k){var i=this.editor.graph,h=i.getModel();if(null==k||h.isEdge(k)||!this.connectOnDrop||!i.isCellConnectable(k)){for(;null!=k&&!i.isValidDropTarget(k,[g],f);){k=h.getParent(k)}this.insert(g,f,k)}else{this.connect(g,f,k)}};mxDefaultToolbar.prototype.insert=function(h,g,m){var l=this.editor.graph;if(l.canImportCell(h)){var k=mxEvent.getClientX(g),i=mxEvent.getClientY(g),k=mxUtils.convertPoint(l.container,k,i);return l.isSplitEnabled()&&l.isSplitTarget(m,[h],g)?l.splitEdge(m,[h],null,k.x,k.y):this.editor.addVertex(m,h,k.x,k.y)}return null};mxDefaultToolbar.prototype.connect=function(w,v,u){v=this.editor.graph;var t=v.getModel();if(null!=u&&v.isCellConnectable(w)&&v.isEdgeValid(null,u,w)){var s=null;t.beginUpdate();try{var r=t.getGeometry(u),q=t.getGeometry(w).clone();q.x=r.x+(r.width-q.width)/2;q.y=r.y+(r.height-q.height)/2;var p=this.spacing*v.gridSize,o=20*t.getDirectedEdgeCount(u,!0);this.editor.horizontalFlow?q.x+=(q.width+r.width)/2+p+o:q.y+=(q.height+r.height)/2+p+o;w.setGeometry(q);var n=t.getParent(u);v.addCell(w,n);v.constrainChild(w);s=this.editor.createEdge(u,w);if(null==t.getGeometry(s)){var i=new mxGeometry;i.relative=!0;t.setGeometry(s,i)}v.addEdge(s,n,u,w)}finally{t.endUpdate()}v.setSelectionCells([w,s]);v.scrollCellToVisible(w)}};mxDefaultToolbar.prototype.installDropHandler=function(f,e){var h=document.createElement("img");h.setAttribute("src",f.getAttribute("src"));var g=mxUtils.bind(this,function(a){h.style.width=2*f.offsetWidth+"px";h.style.height=2*f.offsetHeight+"px";mxUtils.makeDraggable(f,this.editor.graph,e,h);mxEvent.removeListener(h,"load",g)});mxClient.IS_IE?g():mxEvent.addListener(h,"load",g)};mxDefaultToolbar.prototype.destroy=function(){null!=this.resetHandler&&(this.editor.graph.removeListener("dblclick",this.resetHandler),this.editor.removeListener("escape",this.resetHandler),this.resetHandler=null);null!=this.toolbar&&(this.toolbar.destroy(),this.toolbar=null)};function mxEditor(b){this.actions=[];this.addActions();if(null!=document.body&&b!=false){this.cycleAttributeValues=[];this.popupHandler=new mxDefaultPopupMenu;this.undoManager=new mxUndoManager;this.graph=this.createGraph();this.toolbar=this.createToolbar();if(b==null||b.keyHandler!=false){this.keyHandler=new mxDefaultKeyHandler(this)}if(b!=null&&b.ownerDocument){this.configure(b)}this.graph.swimlaneIndicatorColorAttribute=this.cycleAttributeName;!mxClient.IS_LOCAL&&null!=this.urlInit&&(this.session=this.createSession());if(null!=this.onInit){this.onInit()}mxClient.IS_IE&&mxEvent.addListener(window,"unload",mxUtils.bind(this,function(){this.destroy()}))}}mxLoadResources&&mxResources.add(mxClient.basePath+"/resources/editor");mxEditor.prototype=new mxEventSource;mxEditor.prototype.constructor=mxEditor;mxEditor.prototype.askZoomResource="none"!=mxClient.language?"askZoom":"";mxEditor.prototype.lastSavedResource="none"!=mxClient.language?"lastSaved":"";mxEditor.prototype.currentFileResource="none"!=mxClient.language?"currentFile":"";mxEditor.prototype.propertiesResource="none"!=mxClient.language?"properties":"";mxEditor.prototype.tasksResource="none"!=mxClient.language?"tasks":"";mxEditor.prototype.helpResource="none"!=mxClient.language?"help":"";mxEditor.prototype.outlineResource="none"!=mxClient.language?"outline":"";mxEditor.prototype.outline=null;mxEditor.prototype.graph=null;mxEditor.prototype.graphRenderHint=null;mxEditor.prototype.toolbar=null;mxEditor.prototype.session=null;mxEditor.prototype.status=null;mxEditor.prototype.popupHandler=null;mxEditor.prototype.undoManager=null;mxEditor.prototype.keyHandler=null;mxEditor.prototype.actions=null;mxEditor.prototype.dblClickAction="edit";mxEditor.prototype.swimlaneRequired=!1;mxEditor.prototype.disableContextMenu=!0;mxEditor.prototype.insertFunction=null;mxEditor.prototype.forcedInserting=!1;mxEditor.prototype.templates=null;mxEditor.prototype.defaultEdge=null;mxEditor.prototype.defaultEdgeStyle=null;mxEditor.prototype.defaultGroup=null;mxEditor.prototype.groupBorderSize=null;mxEditor.prototype.filename=null;mxEditor.prototype.linefeed="&#xa;";mxEditor.prototype.postParameterName="xml";mxEditor.prototype.escapePostData=!0;mxEditor.prototype.urlPost=null;mxEditor.prototype.urlImage=null;mxEditor.prototype.urlInit=null;mxEditor.prototype.urlNotify=null;mxEditor.prototype.urlPoll=null;mxEditor.prototype.horizontalFlow=!1;mxEditor.prototype.layoutDiagram=!1;mxEditor.prototype.swimlaneSpacing=0;mxEditor.prototype.maintainSwimlanes=!1;mxEditor.prototype.layoutSwimlanes=!1;mxEditor.prototype.cycleAttributeValues=null;mxEditor.prototype.cycleAttributeIndex=0;mxEditor.prototype.cycleAttributeName="fillColor";mxEditor.prototype.tasks=null;mxEditor.prototype.tasksWindowImage=null;mxEditor.prototype.tasksTop=20;mxEditor.prototype.help=null;mxEditor.prototype.helpWindowImage=null;mxEditor.prototype.urlHelp=null;mxEditor.prototype.helpWidth=300;mxEditor.prototype.helpHeight=260;mxEditor.prototype.propertiesWidth=240;mxEditor.prototype.propertiesHeight=null;mxEditor.prototype.movePropertiesDialog=!1;mxEditor.prototype.validating=!1;mxEditor.prototype.modified=!1;mxEditor.prototype.isModified=function(){return this.modified};mxEditor.prototype.setModified=function(b){this.modified=b};mxEditor.prototype.addActions=function(){this.addAction("save",function(b){b.save()});this.addAction("print",function(b){(new mxPrintPreview(b.graph,1)).open()});this.addAction("show",function(b){mxUtils.show(b.graph,null,10,10)});this.addAction("exportImage",function(e){var d=e.getUrlImage();if(null==d||mxClient.IS_LOCAL){e.execute("show")}else{var f=mxUtils.getViewXml(e.graph,1),f=mxUtils.getXml(f,"\n");mxUtils.submit(d,e.postParameterName+"="+encodeURIComponent(f),document,"_blank")}});this.addAction("refresh",function(b){b.graph.refresh()});this.addAction("cut",function(b){b.graph.isEnabled()&&mxClipboard.cut(b.graph)});this.addAction("copy",function(b){b.graph.isEnabled()&&mxClipboard.copy(b.graph)});this.addAction("paste",function(b){b.graph.isEnabled()&&mxClipboard.paste(b.graph)});this.addAction("delete",function(b){b.graph.isEnabled()&&b.graph.removeCells()});this.addAction("group",function(b){b.graph.isEnabled()&&b.graph.setSelectionCell(b.groupCells())});this.addAction("ungroup",function(b){b.graph.isEnabled()&&b.graph.setSelectionCells(b.graph.ungroupCells())});this.addAction("removeFromParent",function(b){b.graph.isEnabled()&&b.graph.removeCellsFromParent()});this.addAction("undo",function(b){b.graph.isEnabled()&&b.undo()});this.addAction("redo",function(b){b.graph.isEnabled()&&b.redo()});this.addAction("zoomIn",function(b){b.graph.zoomIn()});this.addAction("zoomOut",function(b){b.graph.zoomOut()});this.addAction("actualSize",function(b){b.graph.zoomActual()});this.addAction("fit",function(b){b.graph.fit()});this.addAction("showProperties",function(d,c){d.showProperties(c)});this.addAction("selectAll",function(b){b.graph.isEnabled()&&b.graph.selectAll()});this.addAction("selectNone",function(b){b.graph.isEnabled()&&b.graph.clearSelection()});this.addAction("selectVertices",function(b){b.graph.isEnabled()&&b.graph.selectVertices()});this.addAction("selectEdges",function(b){b.graph.isEnabled()&&b.graph.selectEdges()});this.addAction("edit",function(d,c){d.graph.isEnabled()&&d.graph.isCellEditable(c)&&d.graph.startEditingAtCell(c)});this.addAction("toBack",function(d,c){d.graph.isEnabled()&&d.graph.orderCells(!0)});this.addAction("toFront",function(d,c){d.graph.isEnabled()&&d.graph.orderCells(!1)});this.addAction("enterGroup",function(d,c){d.graph.enterGroup(c)});this.addAction("exitGroup",function(b){b.graph.exitGroup()});this.addAction("home",function(b){b.graph.home()});this.addAction("selectPrevious",function(b){b.graph.isEnabled()&&b.graph.selectPreviousCell()});this.addAction("selectNext",function(b){b.graph.isEnabled()&&b.graph.selectNextCell()});this.addAction("selectParent",function(b){b.graph.isEnabled()&&b.graph.selectParentCell()});this.addAction("selectChild",function(b){b.graph.isEnabled()&&b.graph.selectChildCell()});this.addAction("collapse",function(b){b.graph.isEnabled()&&b.graph.foldCells(!0)});this.addAction("collapseAll",function(d){if(d.graph.isEnabled()){var c=d.graph.getChildVertices();d.graph.foldCells(!0,!1,c)}});this.addAction("expand",function(b){b.graph.isEnabled()&&b.graph.foldCells(!1)});this.addAction("expandAll",function(d){if(d.graph.isEnabled()){var c=d.graph.getChildVertices();d.graph.foldCells(!1,!1,c)}});this.addAction("bold",function(b){b.graph.isEnabled()&&b.graph.toggleCellStyleFlags(mxConstants.STYLE_FONTSTYLE,mxConstants.FONT_BOLD)});this.addAction("italic",function(b){b.graph.isEnabled()&&b.graph.toggleCellStyleFlags(mxConstants.STYLE_FONTSTYLE,mxConstants.FONT_ITALIC)});this.addAction("underline",function(b){b.graph.isEnabled()&&b.graph.toggleCellStyleFlags(mxConstants.STYLE_FONTSTYLE,mxConstants.FONT_UNDERLINE)});this.addAction("shadow",function(b){b.graph.isEnabled()&&b.graph.toggleCellStyleFlags(mxConstants.STYLE_FONTSTYLE,mxConstants.FONT_SHADOW)});this.addAction("alignCellsLeft",function(b){b.graph.isEnabled()&&b.graph.alignCells(mxConstants.ALIGN_LEFT)});this.addAction("alignCellsCenter",function(b){b.graph.isEnabled()&&b.graph.alignCells(mxConstants.ALIGN_CENTER)});this.addAction("alignCellsRight",function(b){b.graph.isEnabled()&&b.graph.alignCells(mxConstants.ALIGN_RIGHT)});this.addAction("alignCellsTop",function(b){b.graph.isEnabled()&&b.graph.alignCells(mxConstants.ALIGN_TOP)});this.addAction("alignCellsMiddle",function(b){b.graph.isEnabled()&&b.graph.alignCells(mxConstants.ALIGN_MIDDLE)});this.addAction("alignCellsBottom",function(b){b.graph.isEnabled()&&b.graph.alignCells(mxConstants.ALIGN_BOTTOM)});this.addAction("alignFontLeft",function(b){b.graph.setCellStyles(mxConstants.STYLE_ALIGN,mxConstants.ALIGN_LEFT)});this.addAction("alignFontCenter",function(b){b.graph.isEnabled()&&b.graph.setCellStyles(mxConstants.STYLE_ALIGN,mxConstants.ALIGN_CENTER)});this.addAction("alignFontRight",function(b){b.graph.isEnabled()&&b.graph.setCellStyles(mxConstants.STYLE_ALIGN,mxConstants.ALIGN_RIGHT)});this.addAction("alignFontTop",function(b){b.graph.isEnabled()&&b.graph.setCellStyles(mxConstants.STYLE_VERTICAL_ALIGN,mxConstants.ALIGN_TOP)});this.addAction("alignFontMiddle",function(b){b.graph.isEnabled()&&b.graph.setCellStyles(mxConstants.STYLE_VERTICAL_ALIGN,mxConstants.ALIGN_MIDDLE)});this.addAction("alignFontBottom",function(b){b.graph.isEnabled()&&b.graph.setCellStyles(mxConstants.STYLE_VERTICAL_ALIGN,mxConstants.ALIGN_BOTTOM)});this.addAction("zoom",function(d){var c=100*d.graph.getView().scale,c=parseFloat(mxUtils.prompt(mxResources.get(d.askZoomResource)||d.askZoomResource,c))/100;isNaN(c)||d.graph.getView().setScale(c)});this.addAction("toggleTasks",function(b){null!=b.tasks?b.tasks.setVisible(!b.tasks.isVisible()):b.showTasks()});this.addAction("toggleHelp",function(b){null!=b.help?b.help.setVisible(!b.help.isVisible()):b.showHelp()});this.addAction("toggleOutline",function(b){null==b.outline?b.showOutline():b.outline.setVisible(!b.outline.isVisible())});this.addAction("toggleConsole",function(b){mxLog.setVisible(!mxLog.isVisible())})};mxEditor.prototype.createSession=function(){var b=mxUtils.bind(this,function(c){this.fireEvent(new mxEventObject(mxEvent.SESSION,"session",c))});return this.connect(this.urlInit,this.urlPoll,this.urlNotify,b)};mxEditor.prototype.configure=function(b){null!=b&&((new mxCodec(b.ownerDocument)).decode(b,this),this.resetHistory())};mxEditor.prototype.resetFirstTime=function(){document.cookie="mxgraph=seen; expires=Fri, 27 Jul 2001 02:47:11 UTC; path=/"};mxEditor.prototype.resetHistory=function(){this.lastSnapshot=(new Date).getTime();this.undoManager.clear();this.ignoredChanges=0;this.setModified(!1)};mxEditor.prototype.addAction=function(d,c){this.actions[d]=c};mxEditor.prototype.execute=function(h,g,m){var l=this.actions[h];if(null!=l){try{var k=arguments;k[0]=this;l.apply(this,k)}catch(i){throw mxUtils.error("Cannot execute "+h+": "+i.message,280,!0),i}}else{mxUtils.error("Cannot find action "+h,280,!0)}};mxEditor.prototype.addTemplate=function(d,c){this.templates[d]=c};mxEditor.prototype.getTemplate=function(b){return this.templates[b]};mxEditor.prototype.createGraph=function(){var b=new mxGraph(null,null,this.graphRenderHint);b.setTooltips(!0);b.setPanning(!0);this.installDblClickHandler(b);this.installUndoHandler(b);this.installDrillHandler(b);this.installChangeHandler(b);this.installInsertHandler(b);b.popupMenuHandler.factoryMethod=mxUtils.bind(this,function(e,g,f){return this.createPopupMenu(e,g,f)});b.connectionHandler.factoryMethod=mxUtils.bind(this,function(d,e){return this.createEdge(d,e)});this.createSwimlaneManager(b);this.createLayoutManager(b);return b};mxEditor.prototype.createSwimlaneManager=function(b){b=new mxSwimlaneManager(b,!1);b.isHorizontal=mxUtils.bind(this,function(){return this.horizontalFlow});b.isEnabled=mxUtils.bind(this,function(){return this.maintainSwimlanes});return b};mxEditor.prototype.createLayoutManager=function(e){var d=new mxLayoutManager(e),f=this;d.getLayout=function(a){var g=null,c=f.graph.getModel();if(null!=c.getParent(a)){if(f.layoutSwimlanes&&e.isSwimlane(a)){null==f.swimlaneLayout&&(f.swimlaneLayout=f.createSwimlaneLayout()),g=f.swimlaneLayout}else{if(f.layoutDiagram&&(e.isValidRoot(a)||null==c.getParent(c.getParent(a)))){null==f.diagramLayout&&(f.diagramLayout=f.createDiagramLayout()),g=f.diagramLayout}}}return g};return d};mxEditor.prototype.setGraphContainer=function(b){null==this.graph.container&&(this.graph.init(b),this.rubberband=new mxRubberband(this.graph),this.disableContextMenu&&mxEvent.disableContextMenu(b),mxClient.IS_QUIRKS&&new mxDivResizer(b))};mxEditor.prototype.installDblClickHandler=function(b){b.addListener(mxEvent.DOUBLE_CLICK,mxUtils.bind(this,function(a,f){var e=f.getProperty("cell");null!=e&&(b.isEnabled()&&null!=this.dblClickAction)&&(this.execute(this.dblClickAction,e),f.consume())}))};mxEditor.prototype.installUndoHandler=function(d){var c=mxUtils.bind(this,function(g,f){var h=f.getProperty("edit");this.undoManager.undoableEditHappened(h)});d.getModel().addListener(mxEvent.UNDO,c);d.getView().addListener(mxEvent.UNDO,c);c=function(a,g){var f=g.getProperty("edit").changes;d.setSelectionCells(d.getSelectionCellsForChanges(f))};this.undoManager.addListener(mxEvent.UNDO,c);this.undoManager.addListener(mxEvent.REDO,c)};mxEditor.prototype.installDrillHandler=function(d){var c=mxUtils.bind(this,function(b){this.fireEvent(new mxEventObject(mxEvent.ROOT))});d.getView().addListener(mxEvent.DOWN,c);d.getView().addListener(mxEvent.UP,c)};mxEditor.prototype.installChangeHandler=function(d){var c=mxUtils.bind(this,function(a,l){this.setModified(!0);!0==this.validating&&d.validateGraph();for(var k=l.getProperty("edit").changes,i=0;i<k.length;i++){var h=k[i];if(h instanceof mxRootChange||h instanceof mxValueChange&&h.cell==this.graph.model.root||h instanceof mxCellAttributeChange&&h.cell==this.graph.model.root){this.fireEvent(new mxEventObject(mxEvent.ROOT));break}}});d.getModel().addListener(mxEvent.CHANGE,c)};mxEditor.prototype.installInsertHandler=function(d){var c=this;d.addMouseListener({mouseDown:function(b,e){if(null!=c.insertFunction&&!e.isPopupTrigger()&&(c.forcedInserting||null==e.getState())){c.graph.clearSelection(),c.insertFunction(e.getEvent(),e.getCell()),this.isActive=!0,e.consume()}},mouseMove:function(f,e){this.isActive&&e.consume()},mouseUp:function(f,e){this.isActive&&(this.isActive=!1,e.consume())}})};mxEditor.prototype.createDiagramLayout=function(){var d=this.graph.gridSize,c=new mxStackLayout(this.graph,!this.horizontalFlow,this.swimlaneSpacing,2*d,2*d);c.isVertexIgnored=function(b){return !c.graph.isSwimlane(b)};return c};mxEditor.prototype.createSwimlaneLayout=function(){return new mxCompactTreeLayout(this.graph,this.horizontalFlow)};mxEditor.prototype.createToolbar=function(){return new mxDefaultToolbar(null,this)};mxEditor.prototype.setToolbarContainer=function(b){this.toolbar.init(b);mxClient.IS_QUIRKS&&new mxDivResizer(b)};mxEditor.prototype.setStatusContainer=function(b){null==this.status&&(this.status=b,this.addListener(mxEvent.SAVE,mxUtils.bind(this,function(){var c=(new Date).toLocaleString();this.setStatus((mxResources.get(this.lastSavedResource)||this.lastSavedResource)+": "+c)})),this.addListener(mxEvent.OPEN,mxUtils.bind(this,function(){this.setStatus((mxResources.get(this.currentFileResource)||this.currentFileResource)+": "+this.filename)})),mxClient.IS_QUIRKS&&new mxDivResizer(b))};mxEditor.prototype.setStatus=function(b){null!=this.status&&null!=b&&(this.status.innerHTML=b)};mxEditor.prototype.setTitleContainer=function(b){this.addListener(mxEvent.ROOT,mxUtils.bind(this,function(a){b.innerHTML=this.getTitle()}));mxClient.IS_QUIRKS&&new mxDivResizer(b)};mxEditor.prototype.treeLayout=function(d,c){null!=d&&(new mxCompactTreeLayout(this.graph,c)).execute(d)};mxEditor.prototype.getTitle=function(){for(var e="",d=this.graph,f=d.getCurrentRoot();null!=f&&null!=d.getModel().getParent(d.getModel().getParent(f));){d.isValidRoot(f)&&(e=" > "+d.convertValueToString(f)+e),f=d.getModel().getParent(f)}return this.getRootTitle()+e};mxEditor.prototype.getRootTitle=function(){var b=this.graph.getModel().getRoot();return this.graph.convertValueToString(b)};mxEditor.prototype.undo=function(){this.undoManager.undo()};mxEditor.prototype.redo=function(){this.undoManager.redo()};mxEditor.prototype.groupCells=function(){var b=null!=this.groupBorderSize?this.groupBorderSize:this.graph.gridSize;return this.graph.groupCells(this.createGroup(),b)};mxEditor.prototype.createGroup=function(){return this.graph.getModel().cloneCell(this.defaultGroup)};mxEditor.prototype.open=function(d){if(null!=d){var c=mxUtils.load(d).getXml();this.readGraphModel(c.documentElement);this.filename=d;this.fireEvent(new mxEventObject(mxEvent.OPEN,"filename",d))}};mxEditor.prototype.readGraphModel=function(b){(new mxCodec(b.ownerDocument)).decode(b,this.graph.getModel());this.resetHistory()};mxEditor.prototype.save=function(e,d){e=e||this.getUrlPost();if(null!=e&&0<e.length){var f=this.writeGraphModel(d);this.postDiagram(e,f);this.setModified(!1)}this.fireEvent(new mxEventObject(mxEvent.SAVE,"url",e))};mxEditor.prototype.postDiagram=function(d,c){this.escapePostData&&(c=encodeURIComponent(c));mxUtils.post(d,this.postParameterName+"="+c,mxUtils.bind(this,function(a){this.fireEvent(new mxEventObject(mxEvent.POST,"request",a,"url",d,"data",c))}))};mxEditor.prototype.writeGraphModel=function(d){d=null!=d?d:this.linefeed;var c=(new mxCodec).encode(this.graph.getModel());return mxUtils.getXml(c,d)};mxEditor.prototype.getUrlPost=function(){return this.urlPost};mxEditor.prototype.getUrlImage=function(){return this.urlImage};mxEditor.prototype.connect=function(g,f,k,i){var h=null;mxClient.IS_LOCAL||(h=new mxSession(this.graph.getModel(),g,f,k),h.addListener(mxEvent.RECEIVE,mxUtils.bind(this,function(d,c){null!=c.getProperty("node").getAttribute("namespace")&&this.resetHistory()})),h.addListener(mxEvent.DISCONNECT,i),h.addListener(mxEvent.CONNECT,i),h.addListener(mxEvent.NOTIFY,i),h.addListener(mxEvent.GET,i),h.start());return h};mxEditor.prototype.swapStyles=function(e,d){var f=this.graph.getStylesheet().styles[d];this.graph.getView().getStylesheet().putCellStyle(d,this.graph.getStylesheet().styles[e]);this.graph.getStylesheet().putCellStyle(e,f);this.graph.refresh()};mxEditor.prototype.showProperties=function(f){f=f||this.graph.getSelectionCell();null==f&&(f=this.graph.getCurrentRoot(),null==f&&(f=this.graph.getModel().getRoot()));if(null!=f){this.graph.stopEditing(!0);var e=mxUtils.getOffset(this.graph.container),h=e.x+10,e=e.y;if(null!=this.properties&&!this.movePropertiesDialog){h=this.properties.getX(),e=this.properties.getY()}else{var g=this.graph.getCellBounds(f);null!=g&&(h+=g.x+Math.min(200,g.width),e+=g.y)}this.hideProperties();f=this.createProperties(f);null!=f&&(this.properties=new mxWindow(mxResources.get(this.propertiesResource)||this.propertiesResource,f,h,e,this.propertiesWidth,this.propertiesHeight,!1),this.properties.setVisible(!0))}};mxEditor.prototype.isPropertiesVisible=function(){return null!=this.properties};mxEditor.prototype.createProperties=function(A){var z=this.graph.getModel(),y=z.getValue(A);if(mxUtils.isNode(y)){var x=new mxForm("properties");x.addText("ID",A.getId()).setAttribute("readonly","true");var w=null,v=null,u=null,t=null,s=null;z.isVertex(A)&&(w=z.getGeometry(A),null!=w&&(v=x.addText("top",w.y),u=x.addText("left",w.x),t=x.addText("width",w.width),s=x.addText("height",w.height)));for(var r=z.getStyle(A),q=x.addText("Style",r||""),o=y.attributes,i=[],y=0;y<o.length;y++){i[y]=x.addTextarea(o[y].nodeName,o[y].nodeValue,"label"==o[y].nodeName?4:2)}y=mxUtils.bind(this,function(){this.hideProperties();z.beginUpdate();try{null!=w&&(w=w.clone(),w.x=parseFloat(u.value),w.y=parseFloat(v.value),w.width=parseFloat(t.value),w.height=parseFloat(s.value),z.setGeometry(A,w));0<q.value.length?z.setStyle(A,q.value):z.setStyle(A,null);for(var b=0;b<o.length;b++){var a=new mxCellAttributeChange(A,o[b].nodeName,i[b].value);z.execute(a)}this.graph.isAutoSizeCell(A)&&this.graph.updateCellSize(A)}finally{z.endUpdate()}});r=mxUtils.bind(this,function(){this.hideProperties()});x.addButtons(y,r);return x.table}return null};mxEditor.prototype.hideProperties=function(){null!=this.properties&&(this.properties.destroy(),this.properties=null)};mxEditor.prototype.showTasks=function(){if(null==this.tasks){var e=document.createElement("div");e.style.padding="4px";e.style.paddingLeft="20px";var d=document.body.clientWidth,d=new mxWindow(mxResources.get(this.tasksResource)||this.tasksResource,e,d-220,this.tasksTop,200);d.setClosable(!0);d.destroyOnClose=!1;var f=mxUtils.bind(this,function(a){mxEvent.release(e);e.innerHTML="";this.createTasks(e)});this.graph.getModel().addListener(mxEvent.CHANGE,f);this.graph.getSelectionModel().addListener(mxEvent.CHANGE,f);this.graph.addListener(mxEvent.ROOT,f);null!=this.tasksWindowImage&&d.setImage(this.tasksWindowImage);this.tasks=d;this.createTasks(e)}this.tasks.setVisible(!0)};mxEditor.prototype.refreshTasks=function(b){null!=this.tasks&&(b=this.tasks.content,mxEvent.release(b),b.innerHTML="",this.createTasks(b))};mxEditor.prototype.createTasks=function(b){};mxEditor.prototype.showHelp=function(f){if(null==this.help){var e=document.createElement("iframe");e.setAttribute("src",mxResources.get("urlHelp")||this.urlHelp);e.setAttribute("height","100%");e.setAttribute("width","100%");e.setAttribute("frameBorder","0");e.style.backgroundColor="white";f=document.body.clientWidth;var h=document.body.clientHeight||document.documentElement.clientHeight,g=new mxWindow(mxResources.get(this.helpResource)||this.helpResource,e,(f-this.helpWidth)/2,(h-this.helpHeight)/3,this.helpWidth,this.helpHeight);g.setMaximizable(!0);g.setClosable(!0);g.destroyOnClose=!1;g.setResizable(!0);null!=this.helpWindowImage&&g.setImage(this.helpWindowImage);mxClient.IS_NS&&(f=function(b){e.setAttribute("height",g.div.offsetHeight-26+"px")},g.addListener(mxEvent.RESIZE_END,f),g.addListener(mxEvent.MAXIMIZE,f),g.addListener(mxEvent.NORMALIZE,f),g.addListener(mxEvent.SHOW,f));this.help=g}this.help.setVisible(!0)};mxEditor.prototype.showOutline=function(){if(null==this.outline){var e=document.createElement("div");e.style.overflow="hidden";e.style.position="relative";e.style.width="100%";e.style.height="100%";e.style.background="white";e.style.cursor="move";8==document.documentMode&&(e.style.filter="progid:DXImageTransform.Microsoft.alpha(opacity=100)");var d=new mxWindow(mxResources.get(this.outlineResource)||this.outlineResource,e,600,480,200,200,!1),f=new mxOutline(this.graph,e);d.setClosable(!0);d.setResizable(!0);d.destroyOnClose=!1;d.addListener(mxEvent.RESIZE_END,function(){f.update()});this.outline=d;this.outline.outline=f}this.outline.setVisible(!0);this.outline.outline.update(!0)};mxEditor.prototype.setMode=function(b){"select"==b?(this.graph.panningHandler.useLeftButtonForPanning=!1,this.graph.setConnectable(!1)):"connect"==b?(this.graph.panningHandler.useLeftButtonForPanning=!1,this.graph.setConnectable(!0)):"pan"==b&&(this.graph.panningHandler.useLeftButtonForPanning=!0,this.graph.setConnectable(!1))};mxEditor.prototype.createPopupMenu=function(e,d,f){this.popupHandler.createMenu(this,e,d,f)};mxEditor.prototype.createEdge=function(f,e){var h=null;if(null!=this.defaultEdge){h=this.graph.getModel().cloneCell(this.defaultEdge)}else{h=new mxCell("");h.setEdge(!0);var g=new mxGeometry;g.relative=!0;h.setGeometry(g)}g=this.getEdgeStyle();null!=g&&h.setStyle(g);return h};mxEditor.prototype.getEdgeStyle=function(){return this.defaultEdgeStyle};mxEditor.prototype.consumeCycleAttribute=function(b){return null!=this.cycleAttributeValues&&0<this.cycleAttributeValues.length&&this.graph.isSwimlane(b)?this.cycleAttributeValues[this.cycleAttributeIndex++%this.cycleAttributeValues.length]:null};mxEditor.prototype.cycleAttribute=function(d){if(null!=this.cycleAttributeName){var c=this.consumeCycleAttribute(d);null!=c&&d.setStyle(d.getStyle()+";"+this.cycleAttributeName+"="+c)}};mxEditor.prototype.addVertex=function(w,v,u,t){for(var s=this.graph.getModel();null!=w&&!this.graph.isValidDropTarget(w);){w=s.getParent(w)}w=null!=w?w:this.graph.getSwimlaneAt(u,t);var r=this.graph.getView().scale,q=s.getGeometry(v),p=s.getGeometry(w);if(this.graph.isSwimlane(v)&&!this.graph.swimlaneNesting){w=null}else{if(null==w&&this.swimlaneRequired){return null}if(null!=w&&null!=p){var o=this.graph.getView().getState(w);if(null!=o){if(u-=o.origin.x*r,t-=o.origin.y*r,this.graph.isConstrainedMoving){var p=q.width,n=q.height,i=o.x+o.width;u+p>i&&(u-=u+p-i);i=o.y+o.height;t+n>i&&(t-=t+n-i)}}else{null!=p&&(u-=p.x*r,t-=p.y*r)}}}q=q.clone();q.x=this.graph.snap(u/r-this.graph.getView().translate.x-this.graph.gridSize/2);q.y=this.graph.snap(t/r-this.graph.getView().translate.y-this.graph.gridSize/2);v.setGeometry(q);null==w&&(w=this.graph.getDefaultParent());this.cycleAttribute(v);this.fireEvent(new mxEventObject(mxEvent.BEFORE_ADD_VERTEX,"vertex",v,"parent",w));s.beginUpdate();try{v=this.graph.addCell(v,w),null!=v&&(this.graph.constrainChild(v),this.fireEvent(new mxEventObject(mxEvent.ADD_VERTEX,"vertex",v)))}finally{s.endUpdate()}null!=v&&(this.graph.setSelectionCell(v),this.graph.scrollCellToVisible(v),this.fireEvent(new mxEventObject(mxEvent.AFTER_ADD_VERTEX,"vertex",v)));return v};mxEditor.prototype.destroy=function(){this.destroyed||(this.destroyed=!0,null!=this.tasks&&this.tasks.destroy(),null!=this.outline&&this.outline.destroy(),null!=this.properties&&this.properties.destroy(),null!=this.keyHandler&&this.keyHandler.destroy(),null!=this.rubberband&&this.rubberband.destroy(),null!=this.toolbar&&this.toolbar.destroy(),null!=this.graph&&this.graph.destroy(),this.templates=this.status=null)};var mxCodecRegistry={codecs:[],aliases:[],register:function(e){if(null!=e){var d=e.getName();mxCodecRegistry.codecs[d]=e;var f=mxUtils.getFunctionName(e.template.constructor);f!=d&&mxCodecRegistry.addAlias(f,d)}return e},addAlias:function(d,c){mxCodecRegistry.aliases[d]=c},getCodec:function(f){var e=null;if(null!=f){var e=mxUtils.getFunctionName(f),h=mxCodecRegistry.aliases[e];null!=h&&(e=h);e=mxCodecRegistry.codecs[e];if(null==e){try{e=new mxObjectCodec(new f),mxCodecRegistry.register(e)}catch(g){}}}return e}};function mxCodec(b){this.document=b||mxUtils.createXmlDocument();this.objects=[]}mxCodec.prototype.document=null;mxCodec.prototype.objects=null;mxCodec.prototype.encodeDefaults=!1;mxCodec.prototype.putObject=function(d,c){return this.objects[d]=c};mxCodec.prototype.getObject=function(d){var c=null;null!=d&&(c=this.objects[d],null==c&&(c=this.lookup(d),null==c&&(d=this.getElementById(d),null!=d&&(c=this.decode(d)))));return c};mxCodec.prototype.lookup=function(b){return null};mxCodec.prototype.getElementById=function(d,c){return mxUtils.findNodeByAttribute(this.document.documentElement,null!=c?c:"id",d)};mxCodec.prototype.getId=function(d){var c=null;null!=d&&(c=this.reference(d),null==c&&d instanceof mxCell&&(c=d.getId(),null==c&&(c=mxCellPath.create(d),0==c.length&&(c="root"))));return c};mxCodec.prototype.reference=function(b){return null};mxCodec.prototype.encode=function(e){var d=null;if(null!=e&&null!=e.constructor){var f=mxCodecRegistry.getCodec(e.constructor);null!=f?d=f.encode(this,e):mxUtils.isNode(e)?d=mxClient.IS_IE?e.cloneNode(!0):this.document.importNode(e,!0):mxLog.warn("mxCodec.encode: No codec for "+mxUtils.getFunctionName(e.constructor))}return d};mxCodec.prototype.decode=function(a,b){var c=null;if(null!=a&&a.nodeType==mxConstants.NODETYPE_ELEMENT){c=null;try{c=eval(a.nodeName)}catch(d){}c=mxCodecRegistry.getCodec(c);null!=c?c=c.decode(this,a,b):(c=a.cloneNode(!0),c.removeAttribute("as"))}return c};mxCodec.prototype.encodeCell=function(f,e,h){e.appendChild(this.encode(f));if(null==h||h){h=f.getChildCount();for(var g=0;g<h;g++){this.encodeCell(f.getChildAt(g),e)}}};mxCodec.prototype.isCellCodec=function(b){return null!=b&&"function"==typeof b.isCellCodec?b.isCellCodec():!1};mxCodec.prototype.decodeCell=function(f,e){e=null!=e?e:!0;var h=null;if(null!=f&&f.nodeType==mxConstants.NODETYPE_ELEMENT){h=mxCodecRegistry.getCodec(f.nodeName);if(!this.isCellCodec(h)){for(var g=f.firstChild;null!=g&&!this.isCellCodec(h);){h=mxCodecRegistry.getCodec(g.nodeName),g=g.nextSibling}}this.isCellCodec(h)||(h=mxCodecRegistry.getCodec(mxCell));h=h.decode(this,f);e&&this.insertIntoGraph(h)}return h};mxCodec.prototype.insertIntoGraph=function(f){var e=f.parent,h=f.getTerminal(!0),g=f.getTerminal(!1);f.setTerminal(null,!1);f.setTerminal(null,!0);f.parent=null;null!=e&&e.insert(f);null!=h&&h.insertEdge(f,!0);null!=g&&g.insertEdge(f,!1)};mxCodec.prototype.setAttribute=function(e,d,f){null!=d&&null!=f&&e.setAttribute(d,f)};function mxObjectCodec(g,f,k,i){this.template=g;this.exclude=null!=f?f:[];this.idrefs=null!=k?k:[];this.mapping=null!=i?i:[];this.reverse={};for(var h in this.mapping){this.reverse[this.mapping[h]]=h}}mxObjectCodec.prototype.template=null;mxObjectCodec.prototype.exclude=null;mxObjectCodec.prototype.idrefs=null;mxObjectCodec.prototype.mapping=null;mxObjectCodec.prototype.reverse=null;mxObjectCodec.prototype.getName=function(){return mxUtils.getFunctionName(this.template.constructor)};mxObjectCodec.prototype.cloneTemplate=function(){return new this.template.constructor};mxObjectCodec.prototype.getFieldName=function(d){if(null!=d){var c=this.reverse[d];null!=c&&(d=c)}return d};mxObjectCodec.prototype.getAttributeName=function(d){if(null!=d){var c=this.mapping[d];null!=c&&(d=c)}return d};mxObjectCodec.prototype.isExcluded=function(f,e,h,g){return e==mxObjectIdentity.FIELD_NAME||0<=mxUtils.indexOf(this.exclude,e)};mxObjectCodec.prototype.isReference=function(f,e,h,g){return 0<=mxUtils.indexOf(this.idrefs,e)};mxObjectCodec.prototype.encode=function(e,d){var f=e.document.createElement(this.getName());d=this.beforeEncode(e,d,f);this.encodeObject(e,d,f);return this.afterEncode(e,d,f)};mxObjectCodec.prototype.encodeObject=function(h,g,m){h.setAttribute(m,"id",h.getId(g));for(var l in g){var k=l,i=g[k];null!=i&&!this.isExcluded(g,k,i,!0)&&(mxUtils.isNumeric(k)&&(k=null),this.encodeValue(h,g,k,i,m))}};mxObjectCodec.prototype.encodeValue=function(h,g,m,l,k){if(null!=l){if(this.isReference(g,m,l,!0)){var i=h.getId(l);if(null==i){mxLog.warn("mxObjectCodec.encode: No ID for "+this.getName()+"."+m+"="+l);return}l=i}i=this.template[m];if(null==m||h.encodeDefaults||i!=l){m=this.getAttributeName(m),this.writeAttribute(h,g,m,l,k)}}};mxObjectCodec.prototype.writeAttribute=function(g,f,k,i,h){"object"!=typeof i?this.writePrimitiveAttribute(g,f,k,i,h):this.writeComplexAttribute(g,f,k,i,h)};mxObjectCodec.prototype.writePrimitiveAttribute=function(g,f,k,i,h){i=this.convertValueToXml(i);null==k?(f=g.document.createElement("add"),"function"==typeof i?f.appendChild(g.document.createTextNode(i)):g.setAttribute(f,"value",i),h.appendChild(f)):"function"!=typeof i&&g.setAttribute(h,k,i)};mxObjectCodec.prototype.writeComplexAttribute=function(g,f,k,i,h){g=g.encode(i);null!=g?(null!=k&&g.setAttribute("as",k),h.appendChild(g)):mxLog.warn("mxObjectCodec.encode: No node for "+this.getName()+"."+k+": "+i)};mxObjectCodec.prototype.convertValueToXml=function(b){if("undefined"==typeof b.length&&(!0==b||!1==b)){b=!0==b?"1":"0"}return b};mxObjectCodec.prototype.convertValueFromXml=function(b){mxUtils.isNumeric(b)&&(b=parseFloat(b));return b};mxObjectCodec.prototype.beforeEncode=function(e,d,f){return d};mxObjectCodec.prototype.afterEncode=function(e,d,f){return f};mxObjectCodec.prototype.decode=function(g,f,k){var i=f.getAttribute("id"),h=g.objects[i];null==h&&(h=k||this.cloneTemplate(),null!=i&&g.putObject(i,h));f=this.beforeDecode(g,f,h);this.decodeNode(g,f,h);return this.afterDecode(g,f,h)};mxObjectCodec.prototype.decodeNode=function(e,d,f){null!=d&&(this.decodeAttributes(e,d,f),this.decodeChildren(e,d,f))};mxObjectCodec.prototype.decodeAttributes=function(f,e,h){e=e.attributes;if(null!=e){for(var g=0;g<e.length;g++){this.decodeAttribute(f,e[g],h)}}};mxObjectCodec.prototype.decodeAttribute=function(g,f,k){var i=f.nodeName;if("as"!=i&&"id"!=i){f=this.convertValueFromXml(f.nodeValue);var h=this.getFieldName(i);if(this.isReference(k,h,f,!1)){g=g.getObject(f);if(null==g){mxLog.warn("mxObjectCodec.decode: No object for "+this.getName()+"."+i+"="+f);return}f=g}this.isExcluded(k,i,f,!1)||(k[i]=f)}};mxObjectCodec.prototype.decodeChildren=function(f,e,h){for(e=e.firstChild;null!=e;){var g=e.nextSibling;e.nodeType==mxConstants.NODETYPE_ELEMENT&&!this.processInclude(f,e,h)&&this.decodeChild(f,e,h);e=g}};mxObjectCodec.prototype.decodeChild=function(a,b,c){var d=this.getFieldName(b.getAttribute("as"));if(null==d||!this.isExcluded(c,d,b,!1)){var e=this.getFieldTemplate(c,d,b),f=null;"add"==b.nodeName?(f=b.getAttribute("value"),null==f&&(f=mxUtils.eval(mxUtils.getTextContent(b)))):f=a.decode(b,e);this.addObjectValue(c,d,f,e)}};mxObjectCodec.prototype.getFieldTemplate=function(e,d,f){e=e[d];e instanceof Array&&0<e.length&&(e=null);return e};mxObjectCodec.prototype.addObjectValue=function(f,e,h,g){null!=h&&h!=g&&(null!=e&&0<e.length?f[e]=h:f.push(h))};mxObjectCodec.prototype.processInclude=function(g,f,k){if("include"==f.nodeName){f=f.getAttribute("name");if(null!=f){try{var i=mxUtils.load(f).getDocumentElement();null!=i&&g.decode(i,k)}catch(h){}}return !0}return !1};mxObjectCodec.prototype.beforeDecode=function(e,d,f){return d};mxObjectCodec.prototype.afterDecode=function(e,d,f){return f};mxCodecRegistry.register(function(){var b=new mxObjectCodec(new mxCell,["children","edges","overlays","mxTransient"],["parent","source","target"]);b.isCellCodec=function(){return !0};b.isExcluded=function(f,i,h,g){return mxObjectCodec.prototype.isExcluded.apply(this,arguments)||g&&"value"==i&&h.nodeType==mxConstants.NODETYPE_ELEMENT};b.afterEncode=function(f,i,h){if(null!=i.value&&i.value.nodeType==mxConstants.NODETYPE_ELEMENT){var g=h;h=mxClient.IS_IE?i.value.cloneNode(!0):f.document.importNode(i.value,!0);h.appendChild(g);f=g.getAttribute("id");h.setAttribute("id",f);g.removeAttribute("id")}return h};b.beforeDecode=function(i,p,o){var n=p,m=this.getName();p.nodeName!=m?(n=p.getElementsByTagName(m)[0],null!=n&&n.parentNode==p?(mxUtils.removeWhitespace(n,!0),mxUtils.removeWhitespace(n,!1),n.parentNode.removeChild(n)):n=null,o.value=p.cloneNode(!0),p=o.value.getAttribute("id"),null!=p&&(o.setId(p),o.value.removeAttribute("id"))):o.setId(p.getAttribute("id"));if(null!=n){for(p=0;p<this.idrefs.length;p++){var m=this.idrefs[p],l=n.getAttribute(m);if(null!=l){n.removeAttribute(m);var k=i.objects[l]||i.lookup(l);null==k&&(l=i.getElementById(l),null!=l&&(k=(mxCodecRegistry.codecs[l.nodeName]||this).decode(i,l)));o[m]=k}}}return n};return b}());mxCodecRegistry.register(function(){var b=new mxObjectCodec(new mxGraphModel);b.encodeObject=function(f,i,h){var g=f.document.createElement("root");f.encodeCell(i.getRoot(),g);h.appendChild(g)};b.decodeChild=function(e,g,f){"root"==g.nodeName?this.decodeRoot(e,g,f):mxObjectCodec.prototype.decodeChild.apply(this,arguments)};b.decodeRoot=function(g,l,k){var i=null;for(l=l.firstChild;null!=l;){var h=g.decodeCell(l);null!=h&&null==h.getParent()&&(i=h);l=l.nextSibling}null!=i&&k.setRoot(i)};return b}());mxCodecRegistry.register(function(){var b=new mxObjectCodec(new mxRootChange,["model","previous","root"]);b.afterEncode=function(e,g,f){e.encodeCell(g.root,f);return f};b.beforeDecode=function(f,i,h){if(null!=i.firstChild&&i.firstChild.nodeType==mxConstants.NODETYPE_ELEMENT){i=i.cloneNode(!0);var g=i.firstChild;h.root=f.decodeCell(g,!1);h=g.nextSibling;g.parentNode.removeChild(g);for(g=h;null!=g;){h=g.nextSibling,f.decodeCell(g),g.parentNode.removeChild(g),g=h}}return i};b.afterDecode=function(e,g,f){f.previous=f.root;return f};return b}());mxCodecRegistry.register(function(){var b=new mxObjectCodec(new mxChildChange,["model","child","previousIndex"],["parent","previous"]);b.isReference=function(f,i,h,g){return"child"==i&&(null!=f.previous||!g)?!0:0<=mxUtils.indexOf(this.idrefs,i)};b.afterEncode=function(e,g,f){this.isReference(g,"child",g.child,!0)?f.setAttribute("child",e.getId(g.child)):e.encodeCell(g.child,f);return f};b.beforeDecode=function(g,l,k){if(null!=l.firstChild&&l.firstChild.nodeType==mxConstants.NODETYPE_ELEMENT){l=l.cloneNode(!0);var i=l.firstChild;k.child=g.decodeCell(i,!1);k=i.nextSibling;i.parentNode.removeChild(i);for(i=k;null!=i;){k=i.nextSibling;if(i.nodeType==mxConstants.NODETYPE_ELEMENT){var h=i.getAttribute("id");null==g.lookup(h)&&g.decodeCell(i)}i.parentNode.removeChild(i);i=k}}else{i=l.getAttribute("child"),k.child=g.getObject(i)}return l};b.afterDecode=function(e,g,f){f.child.parent=f.previous;f.previous=f.parent;f.previousIndex=f.index;return f};return b}());mxCodecRegistry.register(function(){var b=new mxObjectCodec(new mxTerminalChange,["model","previous"],["cell","terminal"]);b.afterDecode=function(e,g,f){f.previous=f.terminal;return f};return b}());var mxGenericChangeCodec=function(e,d){var f=new mxObjectCodec(e,["model","previous"],["cell"]);f.afterDecode=function(b,h,g){mxUtils.isNode(g.cell)&&(g.cell=b.decodeCell(g.cell,!1));g.previous=g[d];return g};return f};mxCodecRegistry.register(mxGenericChangeCodec(new mxValueChange,"value"));mxCodecRegistry.register(mxGenericChangeCodec(new mxStyleChange,"style"));mxCodecRegistry.register(mxGenericChangeCodec(new mxGeometryChange,"geometry"));mxCodecRegistry.register(mxGenericChangeCodec(new mxCollapseChange,"collapsed"));mxCodecRegistry.register(mxGenericChangeCodec(new mxVisibleChange,"visible"));mxCodecRegistry.register(mxGenericChangeCodec(new mxCellAttributeChange,"value"));mxCodecRegistry.register(function(){return new mxObjectCodec(new mxGraph,"graphListeners eventListeners view container cellRenderer editor selection".split(" "))}());mxCodecRegistry.register(function(){var b=new mxObjectCodec(new mxGraphView);b.encode=function(d,e){return this.encodeCell(d,e,e.graph.getModel().getRoot())};b.encodeCell=function(x,w,v){var u=w.graph.getModel(),t=w.getState(v),s=u.getParent(v);if(null==s||null!=t){var r=u.getChildCount(v),q=w.graph.getCellGeometry(v),p=null;s==u.getRoot()?p="layer":null==s?p="graph":u.isEdge(v)?p="edge":0<r&&null!=q?p="group":u.isVertex(v)&&(p="vertex");if(null!=p){var o=x.document.createElement(p);null!=w.graph.getLabel(v)&&(o.setAttribute("label",w.graph.getLabel(v)),w.graph.isHtmlLabel(v)&&o.setAttribute("html",!0));if(null==s){var i=w.getGraphBounds();null!=i&&(o.setAttribute("x",Math.round(i.x)),o.setAttribute("y",Math.round(i.y)),o.setAttribute("width",Math.round(i.width)),o.setAttribute("height",Math.round(i.height)));o.setAttribute("scale",w.scale)}else{if(null!=t&&null!=q){for(i in t.style){s=t.style[i],"function"==typeof s&&"object"==typeof s&&(s=mxStyleRegistry.getName(s)),null!=s&&("function"!=typeof s&&"object"!=typeof s)&&o.setAttribute(i,s)}s=t.absolutePoints;if(null!=s&&0<s.length){q=Math.round(s[0].x)+","+Math.round(s[0].y);for(i=1;i<s.length;i++){q+=" "+Math.round(s[i].x)+","+Math.round(s[i].y)}o.setAttribute("points",q)}else{o.setAttribute("x",Math.round(t.x)),o.setAttribute("y",Math.round(t.y)),o.setAttribute("width",Math.round(t.width)),o.setAttribute("height",Math.round(t.height))}i=t.absoluteOffset;null!=i&&(0!=i.x&&o.setAttribute("dx",Math.round(i.x)),0!=i.y&&o.setAttribute("dy",Math.round(i.y)))}}for(i=0;i<r;i++){t=this.encodeCell(x,w,u.getChildAt(v,i)),null!=t&&o.appendChild(t)}}}return o};return b}());mxCodecRegistry.register(function(){var a=new mxObjectCodec(new mxStylesheet);a.encode=function(a,c){var d=a.document.createElement(this.getName()),e;for(e in c.styles){var f=c.styles[e],g=a.document.createElement("add");if(null!=e){g.setAttribute("as",e);for(var h in f){var k=this.getStringValue(h,f[h]);if(null!=k){var l=a.document.createElement("add");l.setAttribute("value",k);l.setAttribute("as",h);g.appendChild(l)}}0<g.childNodes.length&&d.appendChild(g)}}return d};a.getStringValue=function(a,c){var d=typeof c;"function"==d?c=mxStyleRegistry.getName(style[j]):"object"==d&&(c=null);return c};a.decode=function(a,c,d){d=d||new this.template.constructor;var e=c.getAttribute("id");null!=e&&(a.objects[e]=d);for(c=c.firstChild;null!=c;){if(!this.processInclude(a,c,d)&&"add"==c.nodeName&&(e=c.getAttribute("as"),null!=e)){var f=c.getAttribute("extend"),g=null!=f?mxUtils.clone(d.styles[f]):null;null==g&&(null!=f&&mxLog.warn("mxStylesheetCodec.decode: stylesheet "+f+" not found to extend"),g={});for(f=c.firstChild;null!=f;){if(f.nodeType==mxConstants.NODETYPE_ELEMENT){var h=f.getAttribute("as");if("add"==f.nodeName){var k=mxUtils.getTextContent(f),l=null;null!=k&&0<k.length?l=mxUtils.eval(k):(l=f.getAttribute("value"),mxUtils.isNumeric(l)&&(l=parseFloat(l)));null!=l&&(g[h]=l)}else{"remove"==f.nodeName&&delete g[h]}}f=f.nextSibling}d.putCellStyle(e,g)}c=c.nextSibling}return d};return a}());mxCodecRegistry.register(function(){var b=new mxObjectCodec(new mxDefaultKeyHandler);b.encode=function(d,e){return null};b.decode=function(h,n,m){if(null!=m){for(n=n.firstChild;null!=n;){if(!this.processInclude(h,n,m)&&"add"==n.nodeName){var l=n.getAttribute("as"),k=n.getAttribute("action"),i=n.getAttribute("control");m.bindAction(l,k,i)}n=n.nextSibling}}return m};return b}());mxCodecRegistry.register(function(){var a=new mxObjectCodec(new mxDefaultToolbar);a.encode=function(a,c){return null};a.decode=function(a,c,d){if(null!=d){var e=d.editor;for(c=c.firstChild;null!=c;){if(c.nodeType==mxConstants.NODETYPE_ELEMENT&&!this.processInclude(a,c,d)){if("separator"==c.nodeName){d.addSeparator()}else{if("br"==c.nodeName){d.toolbar.addBreak()}else{if("hr"==c.nodeName){d.toolbar.addLine()}else{if("add"==c.nodeName){var f=c.getAttribute("as"),f=mxResources.get(f)||f,g=c.getAttribute("icon"),h=c.getAttribute("pressedIcon"),k=c.getAttribute("action"),l=c.getAttribute("mode"),m=c.getAttribute("template"),n="0"!=c.getAttribute("toggle"),p=mxUtils.getTextContent(c),q=null;if(null!=k){q=d.addItem(f,g,k,h)}else{if(null!=l){var s=mxUtils.eval(p),q=d.addMode(f,g,l,h,s)}else{if(null!=m||null!=p&&0<p.length){q=e.templates[m],m=c.getAttribute("style"),null!=q&&null!=m&&(q=q.clone(),q.setStyle(m)),m=null,null!=p&&0<p.length&&(m=mxUtils.eval(p)),q=d.addPrototype(f,g,q,h,m,n)}else{if(h=mxUtils.getChildNodes(c),0<h.length){if(null==g){m=d.addActionCombo(f);for(f=0;f<h.length;f++){n=h[f],"separator"==n.nodeName?d.addOption(m,"---"):"add"==n.nodeName&&(g=n.getAttribute("as"),n=n.getAttribute("action"),d.addActionOption(m,g,n))}}else{var r=null,t=d.addPrototype(f,g,function(){var a=e.templates[r.value];if(null!=a){var a=a.clone(),b=r.options[r.selectedIndex].cellStyle;null!=b&&a.setStyle(b);return a}mxLog.warn("Template "+a+" not found");return null},null,null,n),r=d.addCombo();mxEvent.addListener(r,"change",function(){d.toolbar.selectMode(t,function(a){a=mxUtils.convertPoint(e.graph.container,mxEvent.getClientX(a),mxEvent.getClientY(a));return e.addVertex(null,s(),a.x,a.y)});d.toolbar.noReset=!1});for(f=0;f<h.length;f++){n=h[f],"separator"==n.nodeName?d.addOption(r,"---"):"add"==n.nodeName&&(g=n.getAttribute("as"),p=n.getAttribute("template"),d.addOption(r,g,p||m).cellStyle=n.getAttribute("style"))}}}}}}null!=q&&(m=c.getAttribute("id"),null!=m&&0<m.length&&q.setAttribute("id",m))}}}}}c=c.nextSibling}}return d};return a}());mxCodecRegistry.register(function(){var b=new mxObjectCodec(new mxDefaultPopupMenu);b.encode=function(d,e){return null};b.decode=function(f,i,h){var g=i.getElementsByTagName("include")[0];null!=g?this.processInclude(f,g,h):null!=h&&(h.config=i);return h};return b}());mxCodecRegistry.register(function(){var b=new mxObjectCodec(new mxEditor(false),"modified lastSnapshot ignoredChanges undoManager graphContainer toolbarContainer".split(" "));b.afterDecode=function(e,g,f){e=g.getAttribute("defaultEdge");null!=e&&(g.removeAttribute("defaultEdge"),f.defaultEdge=f.templates[e]);e=g.getAttribute("defaultGroup");null!=e&&(g.removeAttribute("defaultGroup"),f.defaultGroup=f.templates[e]);return f};b.decodeChild=function(e,g,f){if("Array"==g.nodeName){if("templates"==g.getAttribute("as")){this.decodeTemplates(e,g,f);return}}else{if("ui"==g.nodeName){this.decodeUi(e,g,f);return}}mxObjectCodec.prototype.decodeChild.apply(this,arguments)};b.decodeUi=function(t,s,r){for(t=s.firstChild;null!=t;){if("add"==t.nodeName){s=t.getAttribute("as");var q=t.getAttribute("element"),p=t.getAttribute("style"),o=null;if(null!=q){o=document.getElementById(q),null!=o&&null!=p&&(o.style.cssText+=";"+p)}else{var q=parseInt(t.getAttribute("x")),n=parseInt(t.getAttribute("y")),m=t.getAttribute("width"),i=t.getAttribute("height"),o=document.createElement("div");o.style.cssText=p;(new mxWindow(mxResources.get(s)||s,o,q,n,m,i,!1,!0)).setVisible(!0)}"graph"==s?r.setGraphContainer(o):"toolbar"==s?r.setToolbarContainer(o):"title"==s?r.setTitleContainer(o):"status"==s?r.setStatusContainer(o):"map"==s&&r.setMapContainer(o)}else{"resource"==t.nodeName?mxResources.add(t.getAttribute("basename")):"stylesheet"==t.nodeName&&mxClient.link("stylesheet",t.getAttribute("name"))}t=t.nextSibling}};b.decodeTemplates=function(h,n,m){null==m.templates&&(m.templates=[]);n=mxUtils.getChildNodes(n);for(var l=0;l<n.length;l++){for(var k=n[l].getAttribute("as"),i=n[l].firstChild;null!=i&&1!=i.nodeType;){i=i.nextSibling}null!=i&&(m.templates[k]=h.decodeCell(i))}};return b}());